<h3 style="margin:0px">Class: org.apache.wss4j.dom.message.UsernameTokenTest (30 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(20)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(16)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(16)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(9)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that adds a UserNameToken with no password via WSHandler
 */
@Test public void testUsernameTokenWSHandlerNoPassword() throws Exception {
  CustomHandler handler=new CustomHandler();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  RequestData reqData=new RequestData();
  java.util.Map<String,Object> config=new java.util.TreeMap<String,Object>();
  config.put(WSHandlerConstants.PASSWORD_TYPE,WSConstants.PW_NONE);
  reqData.setUsername("wernerd");
  reqData.setMsgContext(config);
  HandlerAction action=new HandlerAction(WSConstants.UT);
  handler.send(doc,reqData,Collections.singletonList(action),true);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Username Token via WSHandler");
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
}

</code></pre>

<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing a UsernameToken where the "Created" element is in the (near)
 * future. It should be accepted by default when it is created 30 seconds in the future,
 * and then rejected once we configure "0 seconds" for future-time-to-live.
 */
@Test public void testNearFutureCreated() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Element usernameTokenElement=doc.createElementNS(WSConstants.WSSE_NS,WSConstants.WSSE_PREFIX + ":" + WSConstants.USERNAME_TOKEN_LN);
  Element usernameElement=doc.createElementNS(WSConstants.WSSE_NS,WSConstants.WSSE_PREFIX + ":" + WSConstants.USERNAME_LN);
  usernameElement.appendChild(doc.createTextNode("wernerd"));
  usernameTokenElement.appendChild(usernameElement);
  Element passwordElement=doc.createElementNS(WSConstants.WSSE_NS,WSConstants.WSSE_PREFIX + ":" + WSConstants.PASSWORD_LN);
  passwordElement.setAttributeNS(null,"Type",WSConstants.PASSWORD_TEXT);
  passwordElement.appendChild(doc.createTextNode("verySecret"));
  usernameTokenElement.appendChild(passwordElement);
  Element elementCreated=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.CREATED_LN);
  DateFormat zulu=new XmlSchemaDateFormat();
  Date createdDate=new Date();
  long currentTime=createdDate.getTime() + 30000;
  createdDate.setTime(currentTime);
  elementCreated.appendChild(doc.createTextNode(zulu.format(createdDate)));
  usernameTokenElement.appendChild(elementCreated);
  secHeader.getSecurityHeader().appendChild(usernameTokenElement);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  WSSecurityEngine secEngine=new WSSecurityEngine();
  secEngine.processSecurityHeader(doc,null,callbackHandler,null);
  try {
    RequestData requestData=new RequestData();
    requestData.setUtFutureTTL(0);
    requestData.setCallbackHandler(callbackHandler);
    secEngine.processSecurityHeader(doc,requestData);
    fail("The UsernameToken validation should have failed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.MESSAGE_EXPIRED);
  }
}

</code></pre>

<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that adds a UserNameToken with a bad password Digest to a WS-Security envelope
 */
@Test public void testUsernameTokenBadDigest() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setUserInfo("wernerd","verySecre");
  LOG.info("Before adding UsernameToken PW Digest....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Message with UserNameToken PW Digest:");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  LOG.info("After adding UsernameToken PW Digest....");
  try {
    verify(signedDoc);
    fail("Failure expected on a bad password digest");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that adds a UserNameToken with no password type to a WS-Security envelope
 * See WSS-152 - https://issues.apache.org/jira/browse/WSS-152
 * "Problem with processing Username Tokens with no password type"
 * The 1.1 spec states that the password type is optional and defaults to password text,
 * and so we should handle an incoming Username Token accordingly.
 */
@Test public void testUsernameTokenNoPasswordType() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUTMSG);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  WSSecurityEngine newEngine=new WSSecurityEngine();
  try {
    newEngine.processSecurityHeader(doc,null,callbackHandler,null);
    fail("Expected failure as it is not BSP compliant");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  RequestData data=new RequestData();
  data.setCallbackHandler(callbackHandler);
  data.setIgnoredBSPRules(Collections.singletonList(BSPRule.R4201));
  newEngine.processSecurityHeader(doc,data);
}

</code></pre>

<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * A test for WSS-66 - the created string is null
 * http://issues.apache.org/jira/browse/WSS-66
 * "Possible security hole when PasswordDigest is used by client."
 */
@Test public void testNullCreated() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordType(WSConstants.PASSWORD_DIGEST);
  builder.setUserInfo("wernerd","BAD_PASSWORD");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document utDoc=builder.build(doc,secHeader);
  Element elem=builder.getUsernameTokenElement();
  NodeList list=elem.getElementsByTagNameNS(WSConstants.WSU_NS,"Created");
  Node nonceNode=list.item(0);
  Node childNode=nonceNode.getFirstChild();
  childNode.setNodeValue("");
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(utDoc);
    LOG.debug(outputString);
  }
  try {
    verify(utDoc);
    fail("Expected failure due to a bad password");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<pre class="type-8 type-7 type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that a bad username with password digest does not leak whether the username
 * is valid or not - see WSS-141.
 */
@Test public void testUsernameTokenBadUsername() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setUserInfo("badusername","verySecret");
  LOG.info("Before adding UsernameToken PW Digest....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Message with UserNameToken PW Digest:");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  LOG.info("After adding UsernameToken PW Digest....");
  try {
    verify(signedDoc);
    fail("Failure expected on a bad username");
  }
 catch (  WSSecurityException ex) {
    String message=ex.getMessage();
    assertFalse(message.contains("badusername"));
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<pre class="type-3 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test for encoded passwords.
 */
@Test public void testUsernameTokenWithEncodedPasswordBaseline() throws Exception {
  String password="password";
  byte[] passwordHash=MessageDigest.getInstance("SHA-1").digest(password.getBytes(StandardCharsets.UTF_8));
  String nonce="0x7bXAPZVn40AdCD0Xbt0g==";
  String created="2010-06-28T15:16:37Z";
  String expectedPasswordDigest="C0rena/6gKpRZ9ATj+e6ss5sAbQ=";
  String actualPasswordDigest=UsernameToken.doPasswordDigest(nonce,created,passwordHash);
  assertEquals("the password digest is not as expected",expectedPasswordDigest,actualPasswordDigest);
}

</code></pre>

<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that adds a UserNameToken with no user (or password) to a WS-Security envelope
 * See WSS-185 - https://issues.apache.org/jira/browse/WSS-185
 * "NullPointerException on empty UsernameToken"
 */
@Test public void testUsernameTokenNoUser() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUTNOUSERMSG);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  try {
    verify(doc);
    fail("Failure expected on no password");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test with a non-standard password type. This will pass as the WSSConfig is configured to
 * handle custom token types.
 */
@Test public void testUsernameTokenCustomPass() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordType("RandomType");
  builder.setUserInfo("wernerd","verySecret");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Message with UserNameToken PW custom type:");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSSecurityEngine secEngine=new WSSecurityEngine();
  RequestData requestData=new RequestData();
  requestData.setHandleCustomPasswordTypes(true);
  requestData.setCallbackHandler(callbackHandler);
  secEngine.processSecurityHeader(doc,requestData);
}

</code></pre>

<pre class="type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test that verifies an EncodingType is set for the nonce. See WSS-169.
 */
@Test public void testUsernameTokenNonceEncodingType() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setUserInfo("wernerd","verySecret");
  LOG.info("Before adding UsernameToken PW Digest....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  assertTrue(outputString.contains("EncodingType"));
}

</code></pre>

<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that adds a UserNameToken with (bad) password text to a WS-Security envelope
 */
@Test public void testUsernameTokenBadText() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordType(WSConstants.PASSWORD_TEXT);
  builder.setUserInfo("wernerd","verySecre");
  LOG.info("Before adding UsernameToken PW Text....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Message with UserNameToken PW Text:");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  LOG.info("After adding UsernameToken PW Text....");
  try {
    verify(signedDoc);
    fail("Failure expected on a bad password text");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that adds a UserNameToken with an empty password
 */
@Test public void testUsernameTokenEmptyPassword() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordType(WSConstants.PASSWORD_TEXT);
  builder.setUserInfo("emptyuser","");
  LOG.info("Before adding UsernameToken with an empty password....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSSecurityEngine secEngine=new WSSecurityEngine();
  secEngine.processSecurityHeader(doc,null,this,null);
}

</code></pre>

<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * A test for sending multiple passwords in the UsernameToken
 */
@Test public void testMultiplePassword() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordType(WSConstants.PASSWORD_DIGEST);
  builder.setUserInfo("wernerd","verySecret");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document utDoc=builder.build(doc,secHeader);
  Element elem=builder.getUsernameTokenElement();
  NodeList list=elem.getElementsByTagNameNS(WSConstants.WSSE_NS,"Password");
  Node passwordNode=list.item(0);
  Node passwordCopy=passwordNode.cloneNode(true);
  passwordNode.getParentNode().insertBefore(passwordCopy,passwordNode);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(utDoc);
    LOG.debug(outputString);
  }
  WSSecurityEngine newEngine=new WSSecurityEngine();
  try {
    newEngine.processSecurityHeader(doc,null,callbackHandler,null);
    fail("Expected failure as it is not BSP compliant");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  RequestData data=new RequestData();
  data.setCallbackHandler(callbackHandler);
  data.setIgnoredBSPRules(Collections.singletonList(BSPRule.R4222));
  newEngine.processSecurityHeader(doc,data);
}

</code></pre>

<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test to create a "Spoofed" UsernameToken (see WSS-441)
 */
@Test public void testSpoofedUsernameToken() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setUserInfo("wernerd","verySecret");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSTimeSource spoofedTimeSource=new WSTimeSource(){
    public Date now(){
      Date currentTime=new Date();
      currentTime.setTime(currentTime.getTime() - (500L * 1000L));
      return currentTime;
    }
  }
;
  builder.setWsTimeSource(spoofedTimeSource);
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  try {
    WSSecurityEngine secEngine=new WSSecurityEngine();
    secEngine.processSecurityHeader(doc,null,callbackHandler,null);
    fail("The UsernameToken validation should have failed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.MESSAGE_EXPIRED);
  }
}

</code></pre>

<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * A test for sending multiple nonces in the UsernameToken
 */
@Test public void testMultipleNonce() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordType(WSConstants.PASSWORD_DIGEST);
  builder.setUserInfo("wernerd","verySecret");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document utDoc=builder.build(doc,secHeader);
  Element elem=builder.getUsernameTokenElement();
  NodeList list=elem.getElementsByTagNameNS(WSConstants.WSSE_NS,"Nonce");
  Node nonceNode=list.item(0);
  Node nonceCopy=nonceNode.cloneNode(true);
  nonceNode.getParentNode().insertBefore(nonceCopy,nonceNode);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(utDoc);
    LOG.debug(outputString);
  }
  WSSecurityEngine newEngine=new WSSecurityEngine();
  try {
    newEngine.processSecurityHeader(doc,null,callbackHandler,null);
    fail("Expected failure as it is not BSP compliant");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  RequestData data=new RequestData();
  data.setCallbackHandler(callbackHandler);
  data.setIgnoredBSPRules(Collections.singletonList(BSPRule.R4225));
  newEngine.processSecurityHeader(doc,data);
}

</code></pre>

<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * A test for sending multiple Created elements in the UsernameToken
 */
@Test public void testMultipleCreated() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordType(WSConstants.PASSWORD_DIGEST);
  builder.setUserInfo("wernerd","verySecret");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document utDoc=builder.build(doc,secHeader);
  Element elem=builder.getUsernameTokenElement();
  NodeList list=elem.getElementsByTagNameNS(WSConstants.WSU_NS,"Created");
  Node createdNode=list.item(0);
  Node createdCopy=createdNode.cloneNode(true);
  createdNode.getParentNode().insertBefore(createdCopy,createdNode);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(utDoc);
    LOG.debug(outputString);
  }
  WSSecurityEngine newEngine=new WSSecurityEngine();
  try {
    newEngine.processSecurityHeader(doc,null,callbackHandler,null);
    fail("Expected failure as it is not BSP compliant");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  RequestData data=new RequestData();
  data.setCallbackHandler(callbackHandler);
  data.setIgnoredBSPRules(Collections.singletonList(BSPRule.R4223));
  newEngine.processSecurityHeader(doc,data);
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that adds a UserNameToken with password Digest to a WS-Security envelope
 */
@Test public void testUsernameTokenWithEncodedPassword() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordsAreEncoded(true);
  builder.setUserInfo("wernerd",Base64.encode(MessageDigest.getInstance("SHA-1").digest("verySecret".getBytes(StandardCharsets.UTF_8))));
  LOG.info("Before adding UsernameToken PW Digest....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Message with UserNameToken PW Digest:");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  LOG.info("After adding UsernameToken PW Digest....");
  WSSecurityEngine newEngine=new WSSecurityEngine();
  RequestData requestData=new RequestData();
  requestData.setEncodePasswords(true);
  requestData.setCallbackHandler(new EncodedPasswordCallbackHandler());
  newEngine.processSecurityHeader(signedDoc,requestData);
}

</code></pre>

<pre class="type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test that adds a UserNameToken with password Digest to a WS-Security envelope
 */
@Test public void testUsernameTokenDigest() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setUserInfo("wernerd","verySecret");
  LOG.info("Before adding UsernameToken PW Digest....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Message with UserNameToken PW Digest:");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  LOG.info("After adding UsernameToken PW Digest....");
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.UT).get(0);
  UsernameToken receivedToken=(UsernameToken)actionResult.get(WSSecurityEngineResult.TAG_USERNAME_TOKEN);
  assertTrue(receivedToken != null);
  UsernameToken clone=new UsernameToken(receivedToken.getElement(),false,new BSPEnforcer());
  assertTrue(clone.equals(receivedToken));
  assertTrue(clone.hashCode() == receivedToken.hashCode());
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that processes a UserNameToken with an empty password
 */
@Test public void testEmptyPasswordProcessing() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(EMPTY_PASSWORD_MSG);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Empty password message: ");
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  WSSecurityEngine secEngine=new WSSecurityEngine();
  secEngine.processSecurityHeader(doc,null,this,null);
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that adds a UserNameToken with an empty password via WSHandler
 */
@Test public void testUsernameTokenWSHandlerEmptyPassword() throws Exception {
  CustomHandler handler=new CustomHandler();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  RequestData reqData=new RequestData();
  java.util.Map<String,Object> config=new java.util.TreeMap<String,Object>();
  config.put(WSHandlerConstants.PASSWORD_TYPE,WSConstants.PW_TEXT);
  config.put(WSHandlerConstants.PW_CALLBACK_REF,this);
  reqData.setUsername("emptyuser");
  reqData.setMsgContext(config);
  HandlerAction action=new HandlerAction(WSConstants.UT);
  handler.send(doc,reqData,Collections.singletonList(action),true);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Username Token with an empty password via WSHandler");
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
}

</code></pre>

<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * A test for WSS-66 - the nonce string is null
 * http://issues.apache.org/jira/browse/WSS-66
 * "Possible security hole when PasswordDigest is used by client."
 */
@Test public void testNullNonce() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordType(WSConstants.PASSWORD_DIGEST);
  builder.setUserInfo("wernerd","BAD_PASSWORD");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document utDoc=builder.build(doc,secHeader);
  Element elem=builder.getUsernameTokenElement();
  NodeList list=elem.getElementsByTagNameNS(WSConstants.WSSE_NS,"Nonce");
  Node nonceNode=list.item(0);
  Node childNode=nonceNode.getFirstChild();
  childNode.setNodeValue("");
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(utDoc);
    LOG.debug(outputString);
  }
  try {
    verify(utDoc);
    fail("Expected failure due to a bad password");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that adds a UserNameToken with a digested password but with type of
 * password test.
 */
@Test public void testUsernameTokenDigestText() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordType(WSConstants.PASSWORD_TEXT);
  byte[] password="verySecret".getBytes();
  MessageDigest sha=MessageDigest.getInstance("MD5");
  sha.reset();
  sha.update(password);
  String passwdDigest=Base64.encode(sha.digest());
  builder.setUserInfo("wernerd",passwdDigest);
  LOG.info("Before adding UsernameToken PW Text....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Message with UserNameToken PW Text:");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that adds a UserNameToken via WSHandler
 */
@Test public void testUsernameTokenWSHandler() throws Exception {
  CustomHandler handler=new CustomHandler();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  RequestData reqData=new RequestData();
  java.util.Map<String,Object> config=new java.util.TreeMap<String,Object>();
  config.put("password","verySecret");
  config.put(WSHandlerConstants.PASSWORD_TYPE,WSConstants.PW_TEXT);
  reqData.setUsername("wernerd");
  reqData.setMsgContext(config);
  HandlerAction action=new HandlerAction(WSConstants.UT);
  handler.send(doc,reqData,Collections.singletonList(action),true);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Username Token via WSHandler");
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
}

</code></pre>

<pre class="type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test that adds a UserNameToken with password text to a WS-Security envelope
 */
@Test public void testUsernameTokenText() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordType(WSConstants.PASSWORD_TEXT);
  builder.setUserInfo("wernerd","verySecret");
  LOG.info("Before adding UsernameToken PW Text....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Message with UserNameToken PW Text:");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  LOG.info("After adding UsernameToken PW Text....");
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.UT).get(0);
  UsernameToken receivedToken=(UsernameToken)actionResult.get(WSSecurityEngineResult.TAG_USERNAME_TOKEN);
  assertTrue(receivedToken != null);
  UsernameToken clone=new UsernameToken(receivedToken.getElement(),false,new BSPEnforcer());
  assertTrue(clone.equals(receivedToken));
  assertTrue(clone.hashCode() == receivedToken.hashCode());
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUsernameTokenWSHandlerNonceCreated() throws Exception {
  CustomHandler handler=new CustomHandler();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  RequestData reqData=new RequestData();
  java.util.Map<String,Object> config=new java.util.TreeMap<String,Object>();
  config.put("password","verySecret");
  config.put(WSHandlerConstants.PASSWORD_TYPE,WSConstants.PW_TEXT);
  config.put(WSHandlerConstants.ADD_USERNAMETOKEN_NONCE,"true");
  config.put(WSHandlerConstants.ADD_USERNAMETOKEN_CREATED,"true");
  reqData.setUsername("wernerd");
  reqData.setMsgContext(config);
  HandlerAction action=new HandlerAction(WSConstants.UT);
  handler.send(doc,reqData,Collections.singletonList(action),true);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Username Token via WSHandler");
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
}

</code></pre>

<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing a UsernameToken where the "Created" element is in the future.
 * A UsernameToken that is 120 seconds in the future should be rejected by default.
 */
@Test public void testFutureCreated() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Element usernameTokenElement=doc.createElementNS(WSConstants.WSSE_NS,WSConstants.WSSE_PREFIX + ":" + WSConstants.USERNAME_TOKEN_LN);
  Element usernameElement=doc.createElementNS(WSConstants.WSSE_NS,WSConstants.WSSE_PREFIX + ":" + WSConstants.USERNAME_LN);
  usernameElement.appendChild(doc.createTextNode("wernerd"));
  usernameTokenElement.appendChild(usernameElement);
  Element passwordElement=doc.createElementNS(WSConstants.WSSE_NS,WSConstants.WSSE_PREFIX + ":" + WSConstants.PASSWORD_LN);
  passwordElement.setAttributeNS(null,"Type",WSConstants.PASSWORD_TEXT);
  passwordElement.appendChild(doc.createTextNode("verySecret"));
  usernameTokenElement.appendChild(passwordElement);
  Element elementCreated=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.CREATED_LN);
  DateFormat zulu=new XmlSchemaDateFormat();
  Date createdDate=new Date();
  long currentTime=createdDate.getTime() + 120000;
  createdDate.setTime(currentTime);
  elementCreated.appendChild(doc.createTextNode(zulu.format(createdDate)));
  usernameTokenElement.appendChild(elementCreated);
  secHeader.getSecurityHeader().appendChild(usernameTokenElement);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  try {
    WSSecurityEngine secEngine=new WSSecurityEngine();
    secEngine.processSecurityHeader(doc,null,callbackHandler,null);
    fail("The UsernameToken validation should have failed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.MESSAGE_EXPIRED);
  }
}

</code></pre>

<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * A test for sending a nonce with a bad encoding type in the UsernameToken
 */
@Test public void testNonceBadEncodingType() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordType(WSConstants.PASSWORD_DIGEST);
  builder.setUserInfo("wernerd","verySecret");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document utDoc=builder.build(doc,secHeader);
  Element elem=builder.getUsernameTokenElement();
  NodeList list=elem.getElementsByTagNameNS(WSConstants.WSSE_NS,"Nonce");
  Node nonceNode=list.item(0);
  ((Element)nonceNode).setAttributeNS(null,"EncodingType","http://bad_encoding_type");
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(utDoc);
    LOG.debug(outputString);
  }
  WSSecurityEngine newEngine=new WSSecurityEngine();
  try {
    newEngine.processSecurityHeader(doc,null,callbackHandler,null);
    fail("Expected failure as it is not BSP compliant");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  RequestData data=new RequestData();
  data.setCallbackHandler(callbackHandler);
  data.setIgnoredBSPRules(Collections.singletonList(BSPRule.R4221));
  newEngine.processSecurityHeader(doc,data);
}

</code></pre>

<pre class="type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test that adds a UserNameToken with no password
 */
@Test public void testUsernameTokenNoPassword() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordType(null);
  builder.setUserInfo("nopassuser",null);
  LOG.info("Before adding UsernameToken with no password....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc,true);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.UT_NOPASSWORD).get(0);
  UsernameToken receivedToken=(UsernameToken)actionResult.get(WSSecurityEngineResult.TAG_USERNAME_TOKEN);
  assertTrue(receivedToken != null);
}

</code></pre>

<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing an "old" UsernameToken, i.e. one with a "Created" element that is
 * out of date
 */
@Test public void testOldUsernameToken() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setUserInfo("wernerd","verySecret");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  RequestData requestData=new RequestData();
  requestData.setUtTTL(-1);
  requestData.setCallbackHandler(callbackHandler);
  try {
    WSSecurityEngine secEngine=new WSSecurityEngine();
    secEngine.processSecurityHeader(doc,requestData);
    fail("The UsernameToken validation should have failed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.MESSAGE_EXPIRED);
  }
}

</code></pre>

<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test with a non-standard token type. This will fail as the default is to reject custom
 * token types.
 */
@Test public void testUsernameTokenCustomFail() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordType("RandomType");
  builder.setUserInfo("wernerd","verySecret");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Message with UserNameToken PW Text:");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  try {
    WSSecurityEngine secEngine=new WSSecurityEngine();
    secEngine.processSecurityHeader(signedDoc,null,this,null);
    fail("Custom token types are not permitted");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
