<h3 style="margin:0px">Class: org.apache.wss4j.dom.saml.SamlTokenTest (30 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(26)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(25)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(21)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(2)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(2)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 1.1 attribute assertion.
 */
@Test public void testSAML1AttrAssertion() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.ATTR);
  callbackHandler.setIssuer("www.example.com");
  WSHandlerResult results=createAndVerifyMessage(callbackHandler,true);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertFalse(receivedSamlAssertion.isSigned());
}

</code></pre>

<pre class="type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 2 attribute assertion. The attributeValue
 * has a custom XMLObject (not a String) value.
 */
@Test @SuppressWarnings("unchecked") public void testSAML2AttrAssertionCustomAttribute() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.ATTR);
  callbackHandler.setIssuer("www.example.com");
  XMLObjectBuilderFactory builderFactory=XMLObjectProviderRegistrySupport.getBuilderFactory();
  SAMLObjectBuilder<Conditions> conditionsV2Builder=(SAMLObjectBuilder<Conditions>)builderFactory.getBuilder(Conditions.DEFAULT_ELEMENT_NAME);
  Conditions conditions=conditionsV2Builder.buildObject();
  DateTime newNotBefore=new DateTime();
  conditions.setNotBefore(newNotBefore);
  conditions.setNotOnOrAfter(newNotBefore.plusMinutes(5));
  XMLObjectBuilder<XSAny> xsAnyBuilder=(XMLObjectBuilder<XSAny>)builderFactory.getBuilder(XSAny.TYPE_NAME);
  XSAny attributeValue=xsAnyBuilder.buildObject(AttributeValue.DEFAULT_ELEMENT_NAME);
  attributeValue.getUnknownXMLObjects().add(conditions);
  List attributeValues=new ArrayList<>();
  attributeValues.add(attributeValue);
  callbackHandler.setCustomAttributeValues(attributeValues);
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 2 Attr Assertion (sender vouches):");
    String outputString=XMLUtils.prettyDocumentToString(unsignedDoc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(unsignedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertFalse(receivedSamlAssertion.isSigned());
}

</code></pre>

<pre class="type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 2 authentication assertion.
 */
@Test public void testSAML2AuthnAssertion() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  WSHandlerResult results=createAndVerifyMessage(callbackHandler,true);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertFalse(receivedSamlAssertion.isSigned());
}

</code></pre>

<pre class="type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testSAML2Advice() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  Element adviceElement=samlAssertion.toDOM(doc);
  callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  callbackHandler.setAssertionAdviceElement(adviceElement);
  samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(unsignedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains("Advice"));
  WSHandlerResult results=verify(unsignedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertFalse(receivedSamlAssertion.isSigned());
}

</code></pre>

<pre class="type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 1.1 authorization assertion.
 */
@Test public void testSAML1AuthzAssertion() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHZ);
  callbackHandler.setIssuer("www.example.com");
  callbackHandler.setResource("http://resource.org");
  WSHandlerResult results=createAndVerifyMessage(callbackHandler,true);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertFalse(receivedSamlAssertion.isSigned());
}

</code></pre>

<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUnsignedBearer() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_BEARER);
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  WSSecurityEngine newEngine=new WSSecurityEngine();
  try {
    newEngine.processSecurityHeader(unsignedDoc,null,null,null);
    fail("Failure expected on an unsigned bearer token");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
  WSSConfig config=WSSConfig.getNewInstance();
  SamlAssertionValidator assertionValidator=new SamlAssertionValidator();
  assertionValidator.setRequireBearerSignature(false);
  config.setValidator(WSConstants.SAML_TOKEN,assertionValidator);
  config.setValidator(WSConstants.SAML2_TOKEN,assertionValidator);
  newEngine.setWssConfig(config);
  RequestData requestData=new RequestData();
  requestData.setValidateSamlSubjectConfirmation(false);
  newEngine.processSecurityHeader(doc,requestData);
}

</code></pre>

<pre class="type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 2 authentication assertion with
 * a user-specified SubjectNameIDFormat.
 */
@Test public void testSAML2SubjectNameIDFormat() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  callbackHandler.setSubjectNameIDFormat(SAML1Constants.NAMEID_FORMAT_EMAIL_ADDRESS);
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(unsignedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 2 Authn Assertion (sender vouches):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains(SAML1Constants.NAMEID_FORMAT_EMAIL_ADDRESS));
  WSHandlerResult results=verify(unsignedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertFalse(receivedSamlAssertion.isSigned());
}

</code></pre>

<pre class="type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testSAML2SpecialCharacter() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.ATTR);
  callbackHandler.setIssuer("www.example.com");
  String newSubjectName="uid=j\u00f6e,ou=people,ou=saml-demo,o=example.com";
  callbackHandler.setSubjectName(newSubjectName);
  List customAttributeValue=new ArrayList<>(1);
  customAttributeValue.add("j\u00f6an");
  callbackHandler.setCustomAttributeValues(customAttributeValue);
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(unsignedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  RequestData requestData=new RequestData();
  requestData.setValidateSamlSubjectConfirmation(false);
  WSSecurityEngine newEngine=new WSSecurityEngine();
  WSHandlerResult results=newEngine.processSecurityHeader(doc,requestData);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertFalse(receivedSamlAssertion.isSigned());
}

</code></pre>

<pre class="type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testSAML2IssuerFormat() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  callbackHandler.setIssuerFormat("urn:oasis:names:tc:SAML:2.0:nameid-format:persistent");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(unsignedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains("urn:oasis:names:tc:SAML:2.0:nameid-format:persistent"));
  WSHandlerResult results=createAndVerifyMessage(callbackHandler,true);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertFalse(receivedSamlAssertion.isSigned());
}

</code></pre>

<pre class="type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 2 authentication assertion with
 * a user-specified SubjectLocality statement.
 */
@Test public void testSAML2SubjectLocality() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  callbackHandler.setSubjectLocality(IP_ADDRESS,"test-dns");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(unsignedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 2 Authn Assertion (sender vouches):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains(IP_ADDRESS));
  assertTrue(outputString.contains("test-dns"));
  WSHandlerResult results=verify(unsignedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertFalse(receivedSamlAssertion.isSigned());
}

</code></pre>

<pre class="type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 1.1 authorization assertion
 * with a Resource URI.
 */
@Test public void testSAML1Resource() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHZ);
  callbackHandler.setIssuer("www.example.com");
  callbackHandler.setResource("http://resource.org");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(unsignedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 1.1 Authz Assertion (sender vouches):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains("http://resource.org"));
  WSHandlerResult results=verify(unsignedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertFalse(receivedSamlAssertion.isSigned());
}

</code></pre>

<pre class="type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 1.1 authentication assertion with
 * a user-specified SubjectNameIDFormat.
 */
@Test public void testSAML1SubjectNameIDFormat() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  callbackHandler.setSubjectNameIDFormat(SAML1Constants.NAMEID_FORMAT_EMAIL_ADDRESS);
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(unsignedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 1.1 Authn Assertion (sender vouches):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains(SAML1Constants.NAMEID_FORMAT_EMAIL_ADDRESS));
  WSHandlerResult results=verify(unsignedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertFalse(receivedSamlAssertion.isSigned());
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 1.1 authentication assertion.
 * The issuer is different from what the custom Validator is expecting, so it throws an
 * exception.
 */
@Test public void testSAML1AuthnBadIssuerAssertion() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example2.com");
  createAndVerifyMessage(callbackHandler,false);
}

</code></pre>

<pre class="type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 1.1 authentication assertion with
 * a user-specified SubjectLocality statement.
 */
@Test public void testSAML1SubjectLocality() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  callbackHandler.setSubjectLocality(IP_ADDRESS,"test-dns");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(unsignedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 1.1 Authn Assertion (sender vouches):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains(IP_ADDRESS));
  assertTrue(outputString.contains("test-dns"));
  WSHandlerResult results=verify(unsignedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertFalse(receivedSamlAssertion.isSigned());
}

</code></pre>

<pre class="type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 1.1 authentication assertion.
 */
@Test public void testSAML1AuthnAssertion() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  WSHandlerResult results=createAndVerifyMessage(callbackHandler,true);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertFalse(receivedSamlAssertion.isSigned());
  assertTrue(receivedSamlAssertion.getSignatureValue() == null);
}

</code></pre>

<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAssertionWrapperNoDocument() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  String assertionString=DOM2Writer.nodeToString(samlAssertion.toDOM(null));
  InputStream in=new ByteArrayInputStream(assertionString.getBytes());
  DocumentBuilderFactory dbf=DocumentBuilderFactory.newInstance();
  dbf.setNamespaceAware(true);
  Document newDoc=dbf.newDocumentBuilder().parse(in);
  SamlAssertionWrapper newAssertion=new SamlAssertionWrapper(newDoc.getDocumentElement());
  String secondAssertionString=newAssertion.assertionToString();
  assertEquals(assertionString,secondAssertionString);
}

</code></pre>

<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testStandardSubjectConfirmationMethod() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  callbackHandler.setConfirmationMethod("urn:oasis:names:tc:SAML:2.0:cm:custom");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  WSSecurityEngine newEngine=new WSSecurityEngine();
  try {
    newEngine.processSecurityHeader(unsignedDoc,null,null,null);
    fail("Failure expected on an unknown subject confirmation method");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
  WSSConfig config=WSSConfig.getNewInstance();
  SamlAssertionValidator assertionValidator=new SamlAssertionValidator();
  assertionValidator.setRequireStandardSubjectConfirmationMethod(false);
  config.setValidator(WSConstants.SAML_TOKEN,assertionValidator);
  config.setValidator(WSConstants.SAML2_TOKEN,assertionValidator);
  newEngine.setWssConfig(config);
  RequestData requestData=new RequestData();
  requestData.setValidateSamlSubjectConfirmation(false);
  newEngine.processSecurityHeader(doc,requestData);
}

</code></pre>

<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRequiredSubjectConfirmationMethod() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  WSSConfig config=WSSConfig.getNewInstance();
  SamlAssertionValidator assertionValidator=new SamlAssertionValidator();
  assertionValidator.setRequiredSubjectConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
  config.setValidator(WSConstants.SAML_TOKEN,assertionValidator);
  config.setValidator(WSConstants.SAML2_TOKEN,assertionValidator);
  WSSecurityEngine newEngine=new WSSecurityEngine();
  newEngine.setWssConfig(config);
  RequestData requestData=new RequestData();
  requestData.setValidateSamlSubjectConfirmation(false);
  newEngine.processSecurityHeader(doc,requestData);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_BEARER);
  samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  samlAssertion=new SamlAssertionWrapper(samlCallback);
  wsSign=new WSSecSAMLToken();
  doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  try {
    newEngine.processSecurityHeader(unsignedDoc,null,null,null);
    fail("Failure expected on an incorrect subject confirmation method");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
}

</code></pre>

<pre class="type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * This test checks that an unsigned SAML1 sender-vouches authentication assertion
 * can be created by the WSHandler implementation
 */
@Test public void testSaml1Action() throws Exception {
  final WSSConfig cfg=WSSConfig.getNewInstance();
  final RequestData reqData=new RequestData();
  reqData.setWssConfig(cfg);
  java.util.Map<String,Object> config=new java.util.TreeMap<String,Object>();
  config.put(WSHandlerConstants.SAML_CALLBACK_REF,new SAML1CallbackHandler());
  reqData.setMsgContext(config);
  final Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  CustomHandler handler=new CustomHandler();
  HandlerAction action=new HandlerAction(WSConstants.ST_UNSIGNED);
  handler.send(doc,reqData,Collections.singletonList(action),true);
  String outputString=XMLUtils.prettyDocumentToString(doc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Unsigned SAML 1.1 authentication assertion via an Action:");
    LOG.debug(outputString);
  }
  assertFalse(outputString.contains("Signature"));
  WSHandlerResult results=verify(doc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertFalse(receivedSamlAssertion.isSigned());
}

</code></pre>

<pre class="type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 1.1 authentication assertion.
 * It set a DOM Element on the CallbackHandler rather than creating a set of beans for
 * SamlAssertionWrapper to parse.
 */
@Test public void testSAML1AuthnAssertionViaElement() throws Exception {
  SAMLElementCallbackHandler callbackHandler=new SAMLElementCallbackHandler();
  callbackHandler.setIssuer("www.example.com");
  WSHandlerResult results=createAndVerifyMessage(callbackHandler,true);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertFalse(receivedSamlAssertion.isSigned());
  assertTrue(receivedSamlAssertion.getSignatureValue() == null);
}

</code></pre>

<pre class="type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 2.0 authentication assertion with
 * a user-specified SessionNotOnOrAfter DateTime.
 */
@Test public void testSAML2SessionNotOnOrAfter() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setSessionNotOnOrAfter(new DateTime().plusHours(1));
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(unsignedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 2.0 Authn Assertion (sender vouches):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains("SessionNotOnOrAfter"));
  WSHandlerResult results=verify(unsignedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertFalse(receivedSamlAssertion.isSigned());
}

</code></pre>

<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAssertionWrapper() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  DocumentBuilderFactory dbf=DocumentBuilderFactory.newInstance();
  dbf.setNamespaceAware(true);
  Document doc=dbf.newDocumentBuilder().newDocument();
  String assertionString=DOM2Writer.nodeToString(samlAssertion.toDOM(doc));
  InputStream in=new ByteArrayInputStream(assertionString.getBytes());
  Document newDoc=dbf.newDocumentBuilder().parse(in);
  SamlAssertionWrapper newAssertion=new SamlAssertionWrapper(newDoc.getDocumentElement());
  String secondAssertionString=newAssertion.assertionToString();
  assertEquals(assertionString,secondAssertionString);
}

</code></pre>

<pre class="type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 2 attribute assertion. The attributeValue
 * has a custom XMLObject (xsd:type="xsd:int") value.
 */
@Test @SuppressWarnings("unchecked") public void testSAML2AttrAssertionIntegerAttribute() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.ATTR);
  callbackHandler.setIssuer("www.example.com");
  XMLObjectBuilderFactory builderFactory=XMLObjectProviderRegistrySupport.getBuilderFactory();
  XMLObjectBuilder<XSInteger> xsIntegerBuilder=(XMLObjectBuilder<XSInteger>)builderFactory.getBuilder(XSInteger.TYPE_NAME);
  XSInteger attributeValue=xsIntegerBuilder.buildObject(AttributeValue.DEFAULT_ELEMENT_NAME,XSInteger.TYPE_NAME);
  attributeValue.setValue(5);
  List attributeValues=new ArrayList<>();
  attributeValues.add(attributeValue);
  callbackHandler.setCustomAttributeValues(attributeValues);
  WSHandlerResult results=createAndVerifyMessage(callbackHandler,true);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertFalse(receivedSamlAssertion.isSigned());
}

</code></pre>

<pre class="type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 2 authentication assertion with
 * SubjectConfirmationData information.
 */
@Test public void testSAML2SubjectConfirmationData() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  SubjectConfirmationDataBean subjectConfirmationData=new SubjectConfirmationDataBean();
  subjectConfirmationData.setAddress("http://apache.org");
  subjectConfirmationData.setInResponseTo("12345");
  subjectConfirmationData.setNotAfter(new DateTime().plusMinutes(5));
  subjectConfirmationData.setRecipient("http://recipient.apache.org");
  callbackHandler.setSubjectConfirmationData(subjectConfirmationData);
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(unsignedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 2 Authn Assertion (sender vouches):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains("http://recipient.apache.org"));
  WSHandlerResult results=createAndVerifyMessage(callbackHandler,true);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertFalse(receivedSamlAssertion.isSigned());
}

</code></pre>

<pre class="type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 2 authentication assertion, which
 * is encrypted in a saml2:EncryptedAssertion Element in the security header
 */
@Test public void testSAML2EncryptedAssertion() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  wsSign.prepare(doc,samlAssertion);
  Element assertionElement=wsSign.getElement();
  Element encryptedAssertionElement=doc.createElementNS(WSConstants.SAML2_NS,WSConstants.ENCRYPED_ASSERTION_LN);
  encryptedAssertionElement.appendChild(assertionElement);
  secHeader.getSecurityHeader().appendChild(encryptedAssertionElement);
  KeyGenerator keygen=KeyGenerator.getInstance("AES");
  keygen.init(128);
  SecretKey secretKey=keygen.generateKey();
  Crypto crypto=CryptoFactory.getInstance("wss40.properties");
  CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
  cryptoType.setAlias("wss40");
  X509Certificate[] certs=crypto.getX509Certificates(cryptoType);
  assertTrue(certs != null && certs.length > 0 && certs[0] != null);
  encryptElement(doc,assertionElement,WSConstants.AES_128,secretKey,WSConstants.KEYTRANSPORT_RSAOEP,certs[0],false,true);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  RequestData requestData=new RequestData();
  requestData.setValidateSamlSubjectConfirmation(false);
  requestData.setCallbackHandler(new KeystoreCallbackHandler());
  requestData.setDecCrypto(crypto);
  requestData.setSigVerCrypto(crypto);
  WSHandlerResult results=secEngine.processSecurityHeader(doc,requestData);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.getElement() != null);
  assertTrue("Assertion".equals(receivedSamlAssertion.getElement().getLocalName()));
  actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertTrue(actionResult != null);
}

</code></pre>

<pre class="type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testSAML2EncryptedAssertionViaSeparateEncryptedKey() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  wsSign.prepare(doc,samlAssertion);
  Element assertionElement=wsSign.getElement();
  Element encryptedAssertionElement=doc.createElementNS(WSConstants.SAML2_NS,WSConstants.ENCRYPED_ASSERTION_LN);
  encryptedAssertionElement.appendChild(assertionElement);
  secHeader.getSecurityHeader().appendChild(encryptedAssertionElement);
  KeyGenerator keygen=KeyGenerator.getInstance("AES");
  keygen.init(128);
  SecretKey secretKey=keygen.generateKey();
  Crypto crypto=CryptoFactory.getInstance("wss40.properties");
  CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
  cryptoType.setAlias("wss40");
  X509Certificate[] certs=crypto.getX509Certificates(cryptoType);
  assertTrue(certs != null && certs.length > 0 && certs[0] != null);
  XMLCipher cipher=XMLCipher.getInstance(WSConstants.AES_128);
  cipher.init(XMLCipher.ENCRYPT_MODE,secretKey);
  EncryptedData builder=cipher.getEncryptedData();
  KeyInfo builderKeyInfo=builder.getKeyInfo();
  if (builderKeyInfo == null) {
    builderKeyInfo=new KeyInfo(doc);
    builderKeyInfo.getElement().setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:dsig","http://www.w3.org/2000/09/xmldsig#");
    builder.setKeyInfo(builderKeyInfo);
  }
  String encryptedKeyId=IDGenerator.generateID(null);
  RetrievalMethod retrievalMethod=new RetrievalMethod(doc,"#" + encryptedKeyId,null,"http://www.w3.org/2001/04/xmlenc#EncryptedKey");
  builderKeyInfo.add(retrievalMethod);
  cipher.doFinal(doc,assertionElement,false);
  String id=IDGenerator.generateID(null);
  Element encryptedData=(Element)encryptedAssertionElement.getElementsByTagNameNS(WSConstants.ENC_NS,"EncryptedData").item(0);
  encryptedData.setAttributeNS(null,"Id",id);
  XMLCipher newCipher=XMLCipher.getInstance(WSConstants.KEYTRANSPORT_RSAOEP);
  newCipher.init(XMLCipher.WRAP_MODE,certs[0].getPublicKey());
  EncryptedKey encryptedKey=newCipher.encryptKey(doc,secretKey);
  KeyInfo encryptedKeyKeyInfo=encryptedKey.getKeyInfo();
  if (encryptedKeyKeyInfo == null) {
    encryptedKeyKeyInfo=new KeyInfo(doc);
    encryptedKeyKeyInfo.getElement().setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:dsig","http://www.w3.org/2000/09/xmldsig#");
    encryptedKey.setKeyInfo(encryptedKeyKeyInfo);
  }
  X509Data x509Data=new X509Data(doc);
  x509Data.addIssuerSerial(certs[0].getIssuerX500Principal().getName(),certs[0].getSerialNumber());
  encryptedKeyKeyInfo.add(x509Data);
  ReferenceList referenceList=newCipher.createReferenceList(ReferenceList.DATA_REFERENCE);
  Reference reference=referenceList.newDataReference("#" + id);
  referenceList.add(reference);
  encryptedKey.setReferenceList(referenceList);
  Element encryptedKeyElement=newCipher.martial(encryptedKey);
  encryptedKeyElement.setAttributeNS(null,"Id",encryptedKeyId);
  encryptedAssertionElement.appendChild(encryptedKeyElement);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  RequestData requestData=new RequestData();
  requestData.setValidateSamlSubjectConfirmation(false);
  requestData.setCallbackHandler(new KeystoreCallbackHandler());
  requestData.setDecCrypto(crypto);
  requestData.setSigVerCrypto(crypto);
  requestData.setDisableBSPEnforcement(true);
  WSHandlerResult results=secEngine.processSecurityHeader(doc,requestData);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.getElement() != null);
  assertTrue("Assertion".equals(receivedSamlAssertion.getElement().getLocalName()));
  actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertTrue(actionResult != null);
}

</code></pre>

<pre class="type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 2 authorization assertion.
 */
@Test public void testSAML2AuthzAssertion() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHZ);
  callbackHandler.setIssuer("www.example.com");
  callbackHandler.setResource("http://resource.org");
  WSHandlerResult results=createAndVerifyMessage(callbackHandler,true);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertFalse(receivedSamlAssertion.isSigned());
}

</code></pre>

<pre class="type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testSAML2EncryptedAssertionNoSTR() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  wsSign.prepare(doc,samlAssertion);
  Element assertionElement=wsSign.getElement();
  Element encryptedAssertionElement=doc.createElementNS(WSConstants.SAML2_NS,WSConstants.ENCRYPED_ASSERTION_LN);
  encryptedAssertionElement.appendChild(assertionElement);
  secHeader.getSecurityHeader().appendChild(encryptedAssertionElement);
  KeyGenerator keygen=KeyGenerator.getInstance("AES");
  keygen.init(128);
  SecretKey secretKey=keygen.generateKey();
  Crypto crypto=CryptoFactory.getInstance("wss40.properties");
  CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
  cryptoType.setAlias("wss40");
  X509Certificate[] certs=crypto.getX509Certificates(cryptoType);
  assertTrue(certs != null && certs.length > 0 && certs[0] != null);
  encryptElement(doc,assertionElement,WSConstants.AES_128,secretKey,WSConstants.KEYTRANSPORT_RSAOEP,certs[0],false,false);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  RequestData data=new RequestData();
  data.setDecCrypto(crypto);
  List<BSPRule> ignoredRules=new ArrayList<>();
  ignoredRules.add(BSPRule.R5426);
  data.setIgnoredBSPRules(ignoredRules);
  data.setCallbackHandler(new KeystoreCallbackHandler());
  data.setValidateSamlSubjectConfirmation(false);
  WSSecurityEngine newEngine=new WSSecurityEngine();
  WSSConfig config=WSSConfig.getNewInstance();
  config.setValidator(WSConstants.SAML_TOKEN,new CustomSamlAssertionValidator());
  config.setValidator(WSConstants.SAML2_TOKEN,new CustomSamlAssertionValidator());
  newEngine.setWssConfig(config);
  WSHandlerResult results=newEngine.processSecurityHeader(doc,data);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.getElement() != null);
  assertTrue("Assertion".equals(receivedSamlAssertion.getElement().getLocalName()));
  actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertTrue(actionResult != null);
}

</code></pre>

<pre class="type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 2 attribute assertion.
 */
@Test public void testSAML2AttrAssertion() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.ATTR);
  callbackHandler.setIssuer("www.example.com");
  WSHandlerResult results=createAndVerifyMessage(callbackHandler,true);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertFalse(receivedSamlAssertion.isSigned());
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 2 authentication assertion.
 * The issuer is different from what the custom Validator is expecting, so it throws an
 * exception.
 */
@Test public void testSAML2AuthnBadIssuerAssertion() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example2.com");
  createAndVerifyMessage(callbackHandler,false);
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
