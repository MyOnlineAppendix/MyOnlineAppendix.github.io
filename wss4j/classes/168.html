<h3 style="margin:0px">Class: org.apache.wss4j.stax.test.VulnerabliltyVectorsTest (13 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(11)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(11)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(10)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(7)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="16"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('16')" data-toggle="tooltip" title="Is an empty test case"><kbd id="tag-16"class="label-info"style="display: inline-block;font-size:7pt" >EmptyTester&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-16 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is an empty test case">EmptyTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Is an empty test case
"></span><br>
@Test public void testTransformationCodeInjection() throws Exception {
}

</code></pre>

<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test if the RSA 1.5 key transport algorithm will be rejected by default.
 * Standard key transport algorithm is RSA-OAEP
 */
@Test public void testDisallowRSA15Algorithm() throws Exception {
  WSSSecurityProperties outboundSecurityProperties=new WSSSecurityProperties();
  outboundSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outboundSecurityProperties.setEncryptionUser("receiver");
  outboundSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outboundSecurityProperties.setSignatureUser("transmitter");
  outboundSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outboundSecurityProperties.setEncryptionKeyTransportAlgorithm("http://www.w3.org/2001/04/xmlenc#rsa-1_5");
  List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outboundSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outboundSecurityProperties,sourceDocument);
  WSSSecurityProperties inboundsecurityProperties=new WSSSecurityProperties();
  inboundsecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inboundsecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inboundsecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inboundsecurityProperties.addIgnoreBSPRule(BSPRule.R5421);
  try {
    doInboundSecurity(inboundsecurityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.FAILED_CHECK);
  }
}

</code></pre>

<pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMaximumAllowedXMLStructureDepthInEncryptedContent() throws Exception {
  if (getJavaSpecificationVersion() >= 1.7) {
    System.out.println("testAllowMD5Algorithm skipped");
    return;
  }
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  int oldval=0;
  try {
    Init.init(WSSec.class.getClassLoader().getResource("wss/wss-config.xml").toURI(),WSSec.class);
    oldval=changeValueOfMaximumAllowedXMLStructureDepth(10);
    doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertEquals(e.getCause().getMessage(),"Maximum depth (10) of the XML structure reached. You can raise the maximum via the " + "\"MaximumAllowedXMLStructureDepth\" property in the configuration.");
  }
 finally {
    changeValueOfMaximumAllowedXMLStructureDepth(oldval);
  }
}

</code></pre>

<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMaximumAllowedReferencesPerManifest() throws Exception {
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://www.w3.org/1999/XMLSchema}complexType;{Element}{http://www.w3.org/1999/XMLSchema}simpleType;");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  try {
    doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<pre class="type-3 type-8 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests if the framework is vulnerable to recursive key references
 * @throws Exception
 */
@Test public void testRecursiveKeyReferencesDOS() throws Exception {
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey");
  Element encryptedKeyElement=(Element)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
  encryptedKeyElement.removeAttribute("Id");
  encryptedKeyElement.setAttributeNS(null,"Id","G2");
  xPathExpression=getXPath(".//dsig:X509Data");
  Element keyIdentifierElement=(Element)xPathExpression.evaluate(encryptedKeyElement,XPathConstants.NODE);
  Element securityTokenReferenceElement=(Element)keyIdentifierElement.getParentNode();
  securityTokenReferenceElement.removeChild(keyIdentifierElement);
  Element referenceElement=securedDocument.createElementNS(WSSConstants.TAG_WSSE_REFERENCE.getNamespaceURI(),WSSConstants.TAG_WSSE_REFERENCE.getLocalPart());
  referenceElement.setAttributeNS(null,"URI","#G1");
  securityTokenReferenceElement.appendChild(referenceElement);
  Element clonedEncryptedElement=(Element)encryptedKeyElement.cloneNode(true);
  clonedEncryptedElement.removeAttribute("Id");
  clonedEncryptedElement.setAttributeNS(null,"Id","G1");
  xPathExpression=getXPath(".//wsse:Reference");
  Element newReferenceElement=(Element)xPathExpression.evaluate(clonedEncryptedElement,XPathConstants.NODE);
  newReferenceElement.removeAttribute("URI");
  newReferenceElement.setAttributeNS(null,"URI","#G2");
  Element securityHeaderNode=(Element)encryptedKeyElement.getParentNode();
  securityHeaderNode.insertBefore(clonedEncryptedElement,encryptedKeyElement);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  try {
    doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Throwable throwable=e.getCause();
    Assert.assertNotNull(throwable);
    Assert.assertEquals(throwable.getMessage(),"Recursive key reference detected.");
  }
}

</code></pre>

<pre class="type-3 type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testModifiedEncryptedKeyCipherValue() throws Exception {
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  NodeList cipherValues=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_xenc_CipherValue.getNamespaceURI(),WSSConstants.TAG_xenc_CipherValue.getLocalPart());
  Element cipherValueElement=(Element)cipherValues.item(0);
  Assert.assertEquals(cipherValueElement.getParentNode().getParentNode().getLocalName(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
  String cipherValue=cipherValueElement.getTextContent();
  StringBuilder stringBuilder=new StringBuilder(cipherValue);
  int index=stringBuilder.length() / 2;
  char ch=stringBuilder.charAt(index);
  if (ch != 'A') {
    ch='A';
  }
 else {
    ch='B';
  }
  stringBuilder.setCharAt(index,ch);
  cipherValueElement.setTextContent(stringBuilder.toString());
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties inboundsecurityProperties=new WSSSecurityProperties();
  inboundsecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inboundsecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inboundsecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  try {
    doInboundSecurity(inboundsecurityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertFalse(e.getMessage().contains("data hash wrong"));
  }
}

</code></pre>

<pre class="type-3 type-8 type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Since we don't support (yet) external URI refs this shouldn't be a problem.
 * <p/>
 * @throws Exception
 */
@Test public void test_publicURIReferenceDOS() throws Exception {
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  properties.setProperty(WSHandlerConstants.ENC_SYM_ALGO,"http://www.w3.org/2001/04/xmlenc#aes256-cbc");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  XPathExpression xPathExpression=getXPath("//@URI");
  Attr uri=(Attr)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
  uri.setNodeValue("http://www.kernel.org/pub/linux/kernel/v2.6/linux-2.6.23.tar.gz");
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.addIgnoreBSPRule(BSPRule.R3006);
  try {
    doInboundSecurity(inSecurityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Throwable throwable=e.getCause();
    Assert.assertNotNull(throwable);
    Assert.assertTrue(throwable.getMessage().contains("Invalid digest of reference "));
  }
}

</code></pre>

<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDisallowMD5Algorithm() throws Exception {
  WSSSecurityProperties outboundSecurityProperties=new WSSSecurityProperties();
  outboundSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outboundSecurityProperties.setEncryptionUser("receiver");
  outboundSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outboundSecurityProperties.setSignatureUser("transmitter");
  outboundSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outboundSecurityProperties.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-md5");
  List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outboundSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outboundSecurityProperties,sourceDocument);
  WSSSecurityProperties inboundsecurityProperties=new WSSSecurityProperties();
  inboundsecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inboundsecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inboundsecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inboundsecurityProperties.addIgnoreBSPRule(BSPRule.R5421);
  try {
    doInboundSecurity(inboundsecurityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.FAILED_CHECK);
  }
}

</code></pre>

<pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMaximumAllowedXMLStructureDepth() throws Exception {
  if (getJavaSpecificationVersion() >= 1.7) {
    System.out.println("testAllowMD5Algorithm skipped");
    return;
  }
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  int oldval=0;
  try {
    Init.init(WSSec.class.getClassLoader().getResource("wss/wss-config.xml").toURI(),WSSec.class);
    oldval=changeValueOfMaximumAllowedXMLStructureDepth(10);
    doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertEquals(e.getCause().getMessage(),"Maximum depth (10) of the XML structure reached. You can raise the maximum via the " + "\"MaximumAllowedXMLStructureDepth\" property in the configuration.");
  }
 finally {
    changeValueOfMaximumAllowedXMLStructureDepth(oldval);
  }
}

</code></pre>

<pre class="type-3 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testAllowMD5Algorithm() throws Exception {
  if (getJavaSpecificationVersion() >= 1.7) {
    System.out.println("testAllowMD5Algorithm skipped");
    return;
  }
  WSSSecurityProperties outboundSecurityProperties=new WSSSecurityProperties();
  outboundSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outboundSecurityProperties.setEncryptionUser("receiver");
  outboundSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outboundSecurityProperties.setSignatureUser("transmitter");
  outboundSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outboundSecurityProperties.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-md5");
  List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outboundSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outboundSecurityProperties,sourceDocument);
  WSSSecurityProperties inboundsecurityProperties=new WSSSecurityProperties();
  inboundsecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inboundsecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inboundsecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inboundsecurityProperties.addIgnoreBSPRule(BSPRule.R5421);
  try {
    Init.init(WSSec.class.getClassLoader().getResource("wss/wss-config.xml").toURI(),WSSec.class);
    switchAllowMD5Algorithm(true);
    Document document=doInboundSecurity(inboundsecurityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.assertNotNull(document);
  }
  finally {
    switchAllowMD5Algorithm(false);
  }
}

</code></pre>

<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMaximumAllowedTransformsPerReference() throws Exception {
  if (getJavaSpecificationVersion() > 1.7) {
    System.out.println("testMaximumAllowedTransformsPerReference skipped");
    return;
  }
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  int oldval=0;
  try {
    Init.init(WSSec.class.getClassLoader().getResource("wss/wss-config.xml").toURI(),WSSec.class);
    oldval=changeValueOfMaximumAllowedTransformsPerReference(0);
    doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
 finally {
    changeValueOfMaximumAllowedTransformsPerReference(oldval);
  }
}

</code></pre>

<pre class="type-3 type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReplayAttackInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    try {
      xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.MESSAGE_EXPIRED);
    }
  }
}

</code></pre>

<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test @SuppressWarnings("unchecked") public void testMaximumAllowedDecompressedBytes() throws Exception {
  long oldval=0;
  try {
    Init.init(WSSec.class.getClassLoader().getResource("wss/wss-config.xml").toURI(),WSSec.class);
    Field algorithmsClassMapField=TransformerAlgorithmMapper.class.getDeclaredField("algorithmsClassMapOut");
    algorithmsClassMapField.setAccessible(true);
    Map<String,Class<?>> map=(Map<String,Class<?>>)algorithmsClassMapField.get(null);
    map.put("http://www.apache.org/2012/04/xmlsec/xz",XZCompressorOutputStream.class);
    algorithmsClassMapField=TransformerAlgorithmMapper.class.getDeclaredField("algorithmsClassMapIn");
    algorithmsClassMapField.setAccessible(true);
    map=(Map<String,Class<?>>)algorithmsClassMapField.get(null);
    map.put("http://www.apache.org/2012/04/xmlsec/xz",XZCompressorInputStream.class);
    oldval=changeValueOfMaximumAllowedDecompressedBytes(101L);
    WSSSecurityProperties outboundSecurityProperties=new WSSSecurityProperties();
    outboundSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
    outboundSecurityProperties.setEncryptionUser("receiver");
    outboundSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    outboundSecurityProperties.setSignatureUser("transmitter");
    outboundSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.TIMESTAMP);
    actions.add(WSSConstants.SIGNATURE);
    actions.add(WSSConstants.ENCRYPT);
    outboundSecurityProperties.setActions(actions);
    outboundSecurityProperties.setEncryptionCompressionAlgorithm("http://www.apache.org/2012/04/xmlsec/xz");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    ByteArrayOutputStream baos=doOutboundSecurity(outboundSecurityProperties,sourceDocument);
    WSSSecurityProperties inboundSecurityProperties=new WSSSecurityProperties();
    inboundSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
    inboundSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    inboundSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    doInboundSecurity(inboundSecurityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof IOException);
    Assert.assertEquals(e.getCause().getMessage(),"Maximum byte count (101) reached.");
  }
 finally {
    changeValueOfMaximumAllowedDecompressedBytes(oldval);
  }
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
