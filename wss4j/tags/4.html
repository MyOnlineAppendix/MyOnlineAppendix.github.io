<h3><span class=" glyphicon glyphicon-tag"/>&nbspHybridVerifier</h3><kbd>Contains more than 2 JUnit-based stereotypes</kbd><br><br><br><h4 style="margin:0px">Class: org.apache.wss4j.common.cache.EHCacheManagerHolderTest </h4><pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateCacheManager(){
  Configuration conf=ConfigurationFactory.parseConfiguration(EHCacheManagerHolder.class.getResource("/test-ehcache.xml"));
  assertNotNull(conf);
  conf.setName("testCache");
  CacheManager manager1=EHCacheManagerHolder.createCacheManager(conf);
  assertNotNull(manager1);
  CacheManager manager2=EHCacheManagerHolder.createCacheManager();
  assertNotNull(manager2);
  manager1.shutdown();
  assertEquals(Status.STATUS_SHUTDOWN,manager1.getStatus());
  assertEquals(Status.STATUS_ALIVE,manager2.getStatus());
  manager2.shutdown();
  assertEquals(Status.STATUS_SHUTDOWN,manager2.getStatus());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.common.crypto.AuthorityKeyIdentifierTest </h4><pre class="type-3 type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExtractKeyIdentifiers() throws Exception {
  KeyStore keyStore=loadKeyStore("keys/wss40.jks","security");
  assertNotNull(keyStore);
  X509Certificate cert=(X509Certificate)keyStore.getCertificate("wss40");
  assertNotNull(cert);
  byte[] keyIdentifierBytes=BouncyCastleUtils.getAuthorityKeyIdentifierBytes(cert);
  assertNotNull(keyIdentifierBytes);
  KeyStore caKeyStore=loadKeyStore("keys/wss40CA.jks","security");
  assertNotNull(caKeyStore);
  X509Certificate caCert=(X509Certificate)caKeyStore.getCertificate("wss40CA");
  assertNotNull(caCert);
  byte[] subjectKeyIdentifierBytes=BouncyCastleUtils.getSubjectKeyIdentifierBytes(caCert);
  assertNotNull(subjectKeyIdentifierBytes);
  assertTrue(Arrays.equals(keyIdentifierBytes,subjectKeyIdentifierBytes));
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMerlinAKI() throws Exception {
  KeyStore keyStore=loadKeyStore("keys/wss40.jks","security");
  assertNotNull(keyStore);
  X509Certificate cert=(X509Certificate)keyStore.getCertificate("wss40");
  assertNotNull(cert);
  KeyStore caKeyStore=loadKeyStore("keys/wss40CA.jks","security");
  assertNotNull(caKeyStore);
  MerlinAKI crypto=new MerlinAKI();
  crypto.setTrustStore(caKeyStore);
  crypto.verifyTrust(new X509Certificate[]{cert},false,null);
  KeyStore badKeyStore=loadKeyStore("keys/wss86.keystore","security");
  assertNotNull(badKeyStore);
  X509Certificate badCert=(X509Certificate)badKeyStore.getCertificate("wss86");
  assertNotNull(badCert);
  try {
    crypto.verifyTrust(new X509Certificate[]{badCert},false,null);
    fail("Failure expected on trying to validate an untrusted cert");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.components.crypto.CertificateStoreTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test signing a SOAP message using a BST. The certificate is not known to the
 * CertificateStore and so should throw an exception.
 */
@Test public void testSignatureDirectReferenceUntrusted() throws Exception {
  WSSecSignature sign=new WSSecSignature();
  sign.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  sign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=sign.build(doc,CryptoFactory.getInstance(),secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  try {
    verify(signedDoc,receiverCrypto);
    fail("Failure expected on an unknown certificate");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.components.crypto.CryptoProviderTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test loading a certificate using BouncyCastle, and using it to encrypt a message, but
 * decrypt the message using the Java Keystore provider. In this case though the cert doesn't
 * correspond with the cert in wss86.keystore.
 */
@Test public void testBadInterop() throws Exception {
  byte[] certBytes=Base64.decode("MIIDNDCCAp2gAwIBAgIBEDANBgkqhkiG9w0BAQQFADBmMQswCQYDVQQGEwJERTEPMA0GA1UECBMG" + "QmF5ZXJuMQ8wDQYDVQQHEwZNdW5pY2gxDTALBgNVBAoTBEhvbWUxFTATBgNVBAsTDEFwYWNoZSBX" + "U1M0SjEPMA0GA1UEAxMGV2VybmVyMB4XDTA4MDQwNDE5MzIxOFoXDTEwMDQwNDE5MzIxOFowYTEL"+ "MAkGA1UEBhMCREUxDzANBgNVBAgTBkJheWVybjEPMA0GA1UEBxMGTXVuaWNoMQ8wDQYDVQQKEwZB"+ "cGFjaGUxDjAMBgNVBAsTBVdTUzRKMQ8wDQYDVQQDEwZXZXJuZXIwgZ8wDQYJKoZIhvcNAQEBBQAD"+ "gY0AMIGJAoGBAINlL3/k0H/zvknpBtLo8jzXwx/IJU/CGSv6MsqJZ2fyZ6kpLlXCuSBUZ/tfkdxp"+ "uzhYq/Sc7A8csIk9gDf9RUbrhK0qKw0VP6DoCIJjS5IeN+NeJkx8YjmzLPmZqLYbNPXr/hy8CRrR"+ "6CqLTTSkBwoEJ+cDkfZrdH2/bND0FEIZAgMBAAGjgfYwgfMwCQYDVR0TBAIwADAsBglghkgBhvhC"+ "AQ0EHxYdT3BlblNTTCBHZW5lcmF0ZWQgQ2VydGlmaWNhdGUwHQYDVR0OBBYEFFSZXv0I5bG7XPEw"+ "jylwG3lmZGdiMIGYBgNVHSMEgZAwgY2AFL/FsHHolGIMacU1TZW/88Bd2EL6oWqkaDBmMQswCQYD"+ "VQQGEwJERTEPMA0GA1UECBMGQmF5ZXJuMQ8wDQYDVQQHEwZNdW5pY2gxDTALBgNVBAoTBEhvbWUx"+ "FTATBgNVBAsTDEFwYWNoZSBXU1M0SjEPMA0GA1UEAxMGV2VybmVyggkAuBIOAWJ19mwwDQYJKoZI"+ "hvcNAQEEBQADgYEAUiUh/wORVcQYXxIh13h3w2Btg6Kj2g6V6YO0Utc/gEYWwT310C2OuroKAwwo"+ "HapMIIWiJRclIAiA8Hnb0Sv/puuHYD4G4NWFdiVjRord90eZJe40NMGruRmlqIRIGGKCv+wv3E6U"+ "x1cWW862f5H9Eyrcocke2P+3GNAGy83vghA=");
  try {
    Security.addProvider(new BouncyCastleProvider());
    CertificateFactory factory=CertificateFactory.getInstance("X.509","BC");
    X509Certificate cert=(X509Certificate)factory.generateCertificate(new ByteArrayInputStream(certBytes));
    WSSecEncrypt encrypt=new WSSecEncrypt();
    encrypt.setUseThisCert(cert);
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
    if (LOG.isDebugEnabled()) {
      String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
      LOG.debug(outputString);
    }
    try {
      verify(encryptedDoc);
      fail("Failure expected on encryption with a key that does not exist in the keystore");
    }
 catch (    WSSecurityException ex) {
      assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
    }
  }
  finally {
    Security.removeProvider(BouncyCastleProvider.PROVIDER_NAME);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.components.crypto.CryptoTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that we can sign and verify a signature using dynamically loaded keystores/truststore
 */
@Test public void testDynamicCrypto() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("wss40","security");
  builder.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Crypto crypto=new Merlin();
  KeyStore keyStore=KeyStore.getInstance(KeyStore.getDefaultType());
  ClassLoader loader=Loader.getClassLoader(CryptoTest.class);
  InputStream input=Merlin.loadInputStream(loader,"keys/wss40.jks");
  keyStore.load(input,"security".toCharArray());
  ((Merlin)crypto).setKeyStore(keyStore);
  Document signedDoc=builder.build(doc,crypto,secHeader);
  Crypto processCrypto=new Merlin();
  KeyStore trustStore=KeyStore.getInstance(KeyStore.getDefaultType());
  input=Merlin.loadInputStream(loader,"keys/wss40CA.jks");
  trustStore.load(input,"security".toCharArray());
  ((Merlin)processCrypto).setTrustStore(trustStore);
  WSSecurityEngine secEngine=new WSSecurityEngine();
  secEngine.processSecurityHeader(signedDoc,null,null,processCrypto);
  processCrypto=new Merlin();
  trustStore=KeyStore.getInstance(KeyStore.getDefaultType());
  input=Merlin.loadInputStream(loader,"keys/wss40badca.jks");
  trustStore.load(input,"security".toCharArray());
  ((Merlin)processCrypto).setTrustStore(trustStore);
  try {
    secEngine.processSecurityHeader(signedDoc,null,null,processCrypto);
    fail("Expected failure on a bad trust store");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-9 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Ensure that we can load a custom crypto implementation using a Map
 */
@Test public void testCustomCrypto() throws Exception {
  java.util.Map<Object,Object> tmp=new java.util.TreeMap<>();
  Crypto crypto=CryptoFactory.getInstance(CustomCrypto.class,tmp);
  assertNotNull(crypto);
  assertTrue(crypto instanceof CustomCrypto);
  CustomCrypto custom=(CustomCrypto)crypto;
  assertSame(tmp,custom.getConfig());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.handler.CustomActionProcessorTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test to see that a custom action can be configured via WSSecurityUtil.decodeAction.
 * A standard Timestamp action is also configured.
 */
@Test public void testDecodeCustomAction() throws Exception {
  final WSSConfig cfg=WSSConfig.getNewInstance();
  final int customAction=0xDEADF000;
  String actionString=WSHandlerConstants.TIMESTAMP + " " + Integer.valueOf(customAction).toString();
  try {
    WSSecurityUtil.decodeHandlerAction(actionString,cfg);
    fail("Failure expected on unknown action");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
  try {
    String badActionString=WSHandlerConstants.TIMESTAMP + " " + "NewCustomAction";
    WSSecurityUtil.decodeHandlerAction(badActionString,cfg);
    fail("Failure expected on unknown action");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
  cfg.setAction(customAction,CustomAction.class);
  List<HandlerAction> actionList=WSSecurityUtil.decodeHandlerAction(actionString,cfg);
  final RequestData reqData=new RequestData();
  reqData.setWssConfig(cfg);
  final Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  CustomHandler handler=new CustomHandler();
  reqData.setMsgContext("bread");
  assertEquals(reqData.getMsgContext(),"bread");
  handler.send(doc,reqData,actionList,true);
  assertEquals(reqData.getMsgContext(),"crumb");
  if (LOG.isDebugEnabled()) {
    LOG.debug("Message:");
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.handler.SignatureConfirmationTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test to see that a signature confirmation response that does not contain a wsu:Id fails
 * the BSP compliance is enabled.
 */
@Test public void testWsuId() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  byte[] randomBytes=WSSecurityUtil.generateNonce(20);
  SignatureConfirmation sigConf=new SignatureConfirmation(doc,randomBytes);
  Element sigConfElement=sigConf.getElement();
  secHeader.getSecurityHeader().appendChild(sigConfElement);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  WSSecurityEngine newEngine=new WSSecurityEngine();
  try {
    newEngine.processSecurityHeader(doc,null,callbackHandler,crypto);
    fail("Failure expected on a request with no wsu:Id");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  RequestData data=new RequestData();
  data.setCallbackHandler(callbackHandler);
  data.setSigVerCrypto(crypto);
  data.setIgnoredBSPRules(Collections.singletonList(BSPRule.R5441));
  newEngine.processSecurityHeader(doc,data);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.AttachmentTest </h4><pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidXMLAttachmentContentSignature() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  builder.getParts().add(new WSEncryptionPart("cid:Attachments","Content"));
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  builder.setAttachmentCallbackHandler(attachmentCallbackHandler);
  LOG.info("Before Signing....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("After Signing....");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  try {
    verify(signedDoc,new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          if (!attachment.getId().equals(attachmentRequestCallback.getAttachmentId())) {
            throw new RuntimeException("wrong attachment requested");
          }
          List<Attachment> attachments=new ArrayList<>();
          attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.replace("15","16").getBytes(StandardCharsets.UTF_8)));
          attachments.add(attachment);
          attachmentRequestCallback.setAttachments(attachments);
        }
      }
    }
);
    Assert.fail();
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"The signature or decryption was invalid");
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentCompleteSignature() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  builder.getParts().add(new WSEncryptionPart("cid:Attachments","Element"));
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  builder.setAttachmentCallbackHandler(attachmentCallbackHandler);
  LOG.info("Before Signing....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("After Signing....");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  NodeList sigReferences=signedDoc.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
  Assert.assertEquals(2,sigReferences.getLength());
  attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  verify(signedDoc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentContentEncryptionExternalReferenceList() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(new WSEncryptionPart("cid:Attachments","Content"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  encrypt.setAttachmentCallbackHandler(attachmentCallbackHandler);
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  encrypt.prepare(doc,crypto);
  Element refs=encrypt.encrypt();
  encrypt.addAttachmentEncryptedDataElements(secHeader);
  encrypt.addExternalRefElement(refs,secHeader);
  encrypt.prependToHeader(secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  NodeList references=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"DataReference");
  Assert.assertEquals(2,references.getLength());
  NodeList cipherReferences=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"CipherReference");
  Assert.assertEquals(1,cipherReferences.getLength());
  NodeList encDatas=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"EncryptedData");
  Assert.assertEquals(2,encDatas.getLength());
  NodeList securityHeaderElement=doc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
  Assert.assertEquals(1,securityHeaderElement.getLength());
  NodeList childs=securityHeaderElement.item(0).getChildNodes();
  Assert.assertEquals(3,childs.getLength());
  Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
  Assert.assertEquals(childs.item(1).getLocalName(),"ReferenceList");
  Assert.assertEquals(childs.item(2).getLocalName(),"EncryptedData");
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
  verify(doc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> attHeaders=responseAttachment.getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentCompleteEncryption() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(new WSEncryptionPart("cid:Attachments","Element"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  encrypt.setAttachmentCallbackHandler(attachmentCallbackHandler);
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  Assert.assertEquals(1,encryptedAttachments.get(0).getHeaders().size());
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
  verify(encryptedDoc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> attHeaders=responseAttachment.getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultipleAttachmentCompleteEncryption() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(new WSEncryptionPart("cid:Attachments","Element"));
  final String attachment1Id=UUID.randomUUID().toString();
  final Attachment[] attachment=new Attachment[2];
  attachment[0]=new Attachment();
  attachment[0].setMimeType("text/xml");
  attachment[0].addHeaders(getHeaders(attachment1Id));
  attachment[0].setId(attachment1Id);
  attachment[0].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  final String attachment2Id=UUID.randomUUID().toString();
  attachment[1]=new Attachment();
  attachment[1].setMimeType("text/plain");
  attachment[1].addHeaders(getHeaders(attachment2Id));
  attachment[1].setId(attachment2Id);
  attachment[1].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Arrays.asList(attachment));
  encrypt.setAttachmentCallbackHandler(attachmentCallbackHandler);
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
  verify(encryptedDoc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachment1Bytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachment1Bytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> att1Headers=responseAttachment.getHeaders();
  Assert.assertEquals(6,att1Headers.size());
  responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(1);
  byte[] attachment2Bytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachment2Bytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/plain",responseAttachment.getMimeType());
  Map<String,String> att2Headers=responseAttachment.getHeaders();
  Assert.assertEquals(6,att2Headers.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidXMLAttachmentCompleteEncryption() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(new WSEncryptionPart("cid:Attachments","Element"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  encrypt.setAttachmentCallbackHandler(attachmentCallbackHandler);
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  try {
    final PushbackInputStream pis=new PushbackInputStream(encryptedAttachments.get(0).getSourceStream(),1);
    pis.unread('K');
    encryptedAttachments.get(0).setSourceStream(pis);
    attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
    verify(encryptedDoc,attachmentCallbackHandler);
  }
 catch (  WSSecurityException e) {
    return;
  }
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertFalse(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentContentSignature() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  builder.getParts().add(new WSEncryptionPart("cid:Attachments","Content"));
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  builder.setAttachmentCallbackHandler(attachmentCallbackHandler);
  LOG.info("Before Signing....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("After Signing....");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  NodeList sigReferences=signedDoc.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
  Assert.assertEquals(2,sigReferences.getLength());
  attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  verify(signedDoc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
}

</code></pre>

<br>
<pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidXMLAttachmentCmplSignCmplEnc() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecSignature signature=new WSSecSignature();
  signature.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  signature.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  signature.getParts().add(new WSEncryptionPart("cid:Attachments","Element"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment[] attachment=new Attachment[1];
  attachment[0]=new Attachment();
  attachment[0].setMimeType("text/xml");
  attachment[0].addHeaders(getHeaders(attachmentId));
  attachment[0].setId(attachmentId);
  attachment[0].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  signature.setAttachmentCallbackHandler(new CallbackHandler(){
    @Override public void handle(    Callback[] callbacks) throws IOException, UnsupportedCallbackException {
      if (callbacks[0] instanceof AttachmentRequestCallback) {
        AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
        List<Attachment> attachments=new ArrayList<>();
        attachments.add(attachment[0]);
        attachmentRequestCallback.setAttachments(attachments);
      }
 else {
        AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
        attachment[0]=attachmentResultCallback.getAttachment();
      }
    }
  }
);
  doc=signature.build(doc,crypto,secHeader);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  encrypt.getParts().addAll(signature.getParts());
  encrypt.setAttachmentCallbackHandler(new CallbackHandler(){
    @Override public void handle(    Callback[] callbacks) throws IOException, UnsupportedCallbackException {
      if (callbacks[0] instanceof AttachmentRequestCallback) {
        AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
        List<Attachment> attachments=new ArrayList<>();
        attachments.add(attachment[0]);
        attachmentRequestCallback.setAttachments(attachments);
      }
 else {
        AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
        attachment[0]=attachmentResultCallback.getAttachment();
      }
    }
  }
);
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  try {
    verify(encryptedDoc,new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          if (!attachment[0].getId().equals(attachmentRequestCallback.getAttachmentId())) {
            throw new RuntimeException("wrong attachment requested");
          }
          List<Attachment> attachments=new ArrayList<>();
          attachments.add(attachment[0]);
          if (attachment[0].getHeaders().size() == 6) {
            attachment[0].addHeader(AttachmentUtils.MIME_HEADER_CONTENT_DESCRIPTION,"Kaputt");
          }
          attachmentRequestCallback.setAttachments(attachments);
        }
 else {
          AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
          attachment[0]=attachmentResultCallback.getAttachment();
        }
      }
    }
);
    Assert.fail();
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"The signature or decryption was invalid");
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentCmplSignCmplEnc() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecSignature signature=new WSSecSignature();
  signature.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  signature.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  signature.getParts().add(new WSEncryptionPart("cid:Attachments","Element"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  signature.setAttachmentCallbackHandler(attachmentCallbackHandler);
  doc=signature.build(doc,crypto,secHeader);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  encrypt.getParts().addAll(signature.getParts());
  attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  encrypt.setAttachmentCallbackHandler(attachmentCallbackHandler);
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  NodeList securityHeaderElement=doc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
  Assert.assertEquals(1,securityHeaderElement.getLength());
  NodeList childs=securityHeaderElement.item(0).getChildNodes();
  Assert.assertEquals(3,childs.getLength());
  Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
  Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedData");
  Assert.assertEquals(childs.item(2).getLocalName(),"Signature");
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
  verify(encryptedDoc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(1);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> attHeaders=responseAttachment.getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentContentEncryptionGCM() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  encrypt.setSymmetricEncAlgorithm(WSConstants.AES_128_GCM);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(new WSEncryptionPart("cid:Attachments","Content"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  encrypt.setAttachmentCallbackHandler(attachmentCallbackHandler);
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  NodeList references=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"DataReference");
  Assert.assertEquals(2,references.getLength());
  NodeList cipherReferences=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"CipherReference");
  Assert.assertEquals(1,cipherReferences.getLength());
  NodeList encDatas=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"EncryptedData");
  Assert.assertEquals(2,encDatas.getLength());
  NodeList securityHeaderElement=doc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
  Assert.assertEquals(1,securityHeaderElement.getLength());
  NodeList childs=securityHeaderElement.item(0).getChildNodes();
  Assert.assertEquals(2,childs.getLength());
  Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
  Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedData");
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
  verify(encryptedDoc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> attHeaders=responseAttachment.getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentContentEncryption() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(new WSEncryptionPart("cid:Attachments","Content"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  encrypt.setAttachmentCallbackHandler(attachmentCallbackHandler);
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  NodeList references=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"DataReference");
  Assert.assertEquals(2,references.getLength());
  NodeList cipherReferences=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"CipherReference");
  Assert.assertEquals(1,cipherReferences.getLength());
  NodeList encDatas=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"EncryptedData");
  Assert.assertEquals(2,encDatas.getLength());
  NodeList securityHeaderElement=doc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
  Assert.assertEquals(1,securityHeaderElement.getLength());
  NodeList childs=securityHeaderElement.item(0).getChildNodes();
  Assert.assertEquals(2,childs.getLength());
  Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
  Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedData");
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
  verify(encryptedDoc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> attHeaders=responseAttachment.getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultipleAttachmentCompleteSignature() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  builder.getParts().add(new WSEncryptionPart("cid:Attachments","Element"));
  final String attachment1Id=UUID.randomUUID().toString();
  final Attachment[] attachment=new Attachment[2];
  attachment[0]=new Attachment();
  attachment[0].setMimeType("text/xml");
  attachment[0].addHeaders(getHeaders(attachment1Id));
  attachment[0].setId(attachment1Id);
  attachment[0].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  final String attachment2Id=UUID.randomUUID().toString();
  attachment[1]=new Attachment();
  attachment[1].setMimeType("text/plain");
  attachment[1].addHeaders(getHeaders(attachment2Id));
  attachment[1].setId(attachment2Id);
  attachment[1].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Arrays.asList(attachment));
  builder.setAttachmentCallbackHandler(attachmentCallbackHandler);
  LOG.info("Before Signing....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("After Signing....");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  NodeList sigReferences=signedDoc.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
  Assert.assertEquals(3,sigReferences.getLength());
  attachmentCallbackHandler=new AttachmentCallbackHandler(Arrays.asList(attachment));
  verify(signedDoc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachment1Bytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachment1Bytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(1);
  byte[] attachment2Bytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachment2Bytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/plain",responseAttachment.getMimeType());
}

</code></pre>

<br>
<pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidXMLAttachmentCmplEncCmplSign() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(new WSEncryptionPart("cid:Attachments","Element"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment[] attachment=new Attachment[1];
  attachment[0]=new Attachment();
  attachment[0].setMimeType("text/xml");
  attachment[0].addHeaders(getHeaders(attachmentId));
  attachment[0].setId(attachmentId);
  attachment[0].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  encrypt.setAttachmentCallbackHandler(new CallbackHandler(){
    @Override public void handle(    Callback[] callbacks) throws IOException, UnsupportedCallbackException {
      if (callbacks[0] instanceof AttachmentRequestCallback) {
        AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
        List<Attachment> attachments=new ArrayList<>();
        attachments.add(attachment[0]);
        attachmentRequestCallback.setAttachments(attachments);
      }
 else {
        AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
        attachment[0]=attachmentResultCallback.getAttachment();
      }
    }
  }
);
  doc=encrypt.build(doc,crypto,secHeader);
  WSSecSignature signature=new WSSecSignature();
  signature.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  signature.getParts().addAll(encrypt.getParts());
  signature.setAttachmentCallbackHandler(new CallbackHandler(){
    @Override public void handle(    Callback[] callbacks) throws IOException, UnsupportedCallbackException {
      if (callbacks[0] instanceof AttachmentRequestCallback) {
        AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
        List<Attachment> attachments=new ArrayList<>();
        attachments.add(attachment[0]);
        attachmentRequestCallback.setAttachments(attachments);
      }
 else {
        AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
        attachment[0]=attachmentResultCallback.getAttachment();
      }
    }
  }
);
  doc=signature.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  final PushbackInputStream pis=new PushbackInputStream(attachment[0].getSourceStream(),1);
  pis.unread('K');
  attachment[0].setSourceStream(pis);
  try {
    verify(doc,new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          if (!attachment[0].getId().equals(attachmentRequestCallback.getAttachmentId())) {
            throw new RuntimeException("wrong attachment requested");
          }
          List<Attachment> attachmentList=new ArrayList<>();
          attachmentList.add(attachment[0]);
          attachmentRequestCallback.setAttachments(attachmentList);
        }
 else {
          AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
          attachment[0]=attachmentResultCallback.getAttachment();
        }
      }
    }
);
    Assert.fail();
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"The signature or decryption was invalid");
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentCmplEncCmplSign() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(new WSEncryptionPart("cid:Attachments","Element"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  encrypt.setAttachmentCallbackHandler(attachmentCallbackHandler);
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  doc=encrypt.build(doc,crypto,secHeader);
  WSSecSignature signature=new WSSecSignature();
  signature.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  signature.getParts().addAll(encrypt.getParts());
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
  signature.setAttachmentCallbackHandler(attachmentCallbackHandler);
  encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  doc=signature.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  NodeList securityHeaderElement=doc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
  Assert.assertEquals(1,securityHeaderElement.getLength());
  NodeList childs=securityHeaderElement.item(0).getChildNodes();
  Assert.assertEquals(3,childs.getLength());
  Assert.assertEquals(childs.item(0).getLocalName(),"Signature");
  Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedKey");
  Assert.assertEquals(childs.item(2).getLocalName(),"EncryptedData");
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
  verify(doc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(1);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> attHeaders=responseAttachment.getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentContentEncryptionNoReference() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(new WSEncryptionPart("cid:Attachments","Content"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  encrypt.setAttachmentCallbackHandler(attachmentCallbackHandler);
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  encrypt.prepare(doc,crypto);
  encrypt.encrypt();
  encrypt.addAttachmentEncryptedDataElements(secHeader);
  encrypt.prependToHeader(secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  NodeList references=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"DataReference");
  Assert.assertEquals(0,references.getLength());
  NodeList cipherReferences=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"CipherReference");
  Assert.assertEquals(1,cipherReferences.getLength());
  NodeList encDatas=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"EncryptedData");
  Assert.assertEquals(2,encDatas.getLength());
  NodeList securityHeaderElement=doc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
  Assert.assertEquals(1,securityHeaderElement.getLength());
  NodeList childs=securityHeaderElement.item(0).getChildNodes();
  Assert.assertEquals(2,childs.getLength());
  Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
  Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedData");
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
  verify(doc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> attHeaders=responseAttachment.getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidXMLAttachmentContentEncryption() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(new WSEncryptionPart("cid:Attachments","Content"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  encrypt.setAttachmentCallbackHandler(attachmentCallbackHandler);
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  final PushbackInputStream pis=new PushbackInputStream(encryptedAttachments.get(0).getSourceStream(),1);
  pis.unread('K');
  encryptedAttachments.get(0).setSourceStream(pis);
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
  verify(encryptedDoc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  try {
    byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
    Assert.assertFalse(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
    Assert.assertEquals("text/xml",responseAttachment.getMimeType());
    Map<String,String> attHeaders=responseAttachment.getHeaders();
    Assert.assertEquals(6,attHeaders.size());
  }
 catch (  IOException ex) {
  }
}

</code></pre>

<br>
<pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidXMLAttachmentCompleteSignature() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  builder.getParts().add(new WSEncryptionPart("cid:Attachments","Element"));
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  builder.setAttachmentCallbackHandler(attachmentCallbackHandler);
  LOG.info("Before Signing....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("After Signing....");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  try {
    attachment.addHeader(AttachmentUtils.MIME_HEADER_CONTENT_DESCRIPTION,"Kaputt");
    verify(signedDoc,new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          if (!attachment.getId().equals(attachmentRequestCallback.getAttachmentId())) {
            throw new RuntimeException("wrong attachment requested");
          }
          List<Attachment> attachments=new ArrayList<>();
          attachments.add(attachment);
          attachmentRequestCallback.setAttachments(attachments);
        }
      }
    }
);
    Assert.fail();
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"The signature or decryption was invalid");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.CertErrorTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for when a bad certificate is used for Signature
 */
@Test public void testX509Signature() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("bob","security");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  try {
    builder.build(doc,CryptoFactory.getInstance(),secHeader);
    fail("Expected failure on a bad username");
  }
 catch (  WSSecurityException ex) {
    String expectedError="No certificates for user bob were found for signature";
    assertTrue(ex.getMessage().contains(expectedError));
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for when a bad certificate is used for Encryption
 */
@Test public void testEncryption() throws Exception {
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("alice");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  try {
    builder.build(doc,CryptoFactory.getInstance(),secHeader);
    fail("Expected failure on a bad username");
  }
 catch (  WSSecurityException ex) {
    String expectedError="No certificates for user alice were found for encryption";
    assertTrue(ex.getMessage().contains(expectedError));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.EncryptionAlgorithmSuiteTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryption() throws Exception {
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("wss40");
  builder.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  builder.setSymmetricEncAlgorithm(WSConstants.TRIPLE_DES);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document encryptedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  Element securityHeader=WSSecurityUtil.getSecurityHeader(encryptedDoc,null);
  AlgorithmSuite algorithmSuite=createAlgorithmSuite();
  verify(securityHeader,algorithmSuite,crypto);
  algorithmSuite.setMinimumAsymmetricKeyLength(1024);
  try {
    verify(securityHeader,algorithmSuite,crypto);
    fail("Expected failure as 512-bit keys are not allowed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptionKeyTransportRSA15NoAlgorithmSuite() throws Exception {
  Crypto wssCrypto=CryptoFactory.getInstance("wss40.properties");
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("wss40");
  builder.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  builder.setSymmetricEncAlgorithm(WSConstants.TRIPLE_DES);
  builder.setKeyEncAlgo(WSConstants.KEYTRANSPORT_RSA15);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document encryptedDoc=builder.build(doc,wssCrypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  Element securityHeader=WSSecurityUtil.getSecurityHeader(encryptedDoc,null);
  try {
    verify(securityHeader,null,wssCrypto);
    fail("Expected failure as RSA 15 is not allowed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  WSSecurityEngine secEngine=new WSSecurityEngine();
  RequestData data=new RequestData();
  data.setDecCrypto(wssCrypto);
  data.setAllowRSA15KeyTransportAlgorithm(true);
  data.setCallbackHandler(new KeystoreCallbackHandler());
  secEngine.processSecurityHeader(securityHeader,data);
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptionMethodAES128() throws Exception {
  Crypto wssCrypto=CryptoFactory.getInstance("wss40.properties");
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("wss40");
  builder.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  builder.setSymmetricEncAlgorithm(WSConstants.AES_128);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document encryptedDoc=builder.build(doc,wssCrypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  Element securityHeader=WSSecurityUtil.getSecurityHeader(encryptedDoc,null);
  AlgorithmSuite algorithmSuite=createAlgorithmSuite();
  try {
    verify(securityHeader,algorithmSuite,wssCrypto);
    fail("Expected failure as AES 128 is not allowed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  algorithmSuite.addEncryptionMethod(WSConstants.AES_128);
  verify(securityHeader,algorithmSuite,wssCrypto);
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptionKeyTransportRSA15() throws Exception {
  Crypto wssCrypto=CryptoFactory.getInstance("wss40.properties");
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("wss40");
  builder.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  builder.setSymmetricEncAlgorithm(WSConstants.TRIPLE_DES);
  builder.setKeyEncAlgo(WSConstants.KEYTRANSPORT_RSA15);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document encryptedDoc=builder.build(doc,wssCrypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  Element securityHeader=WSSecurityUtil.getSecurityHeader(encryptedDoc,null);
  AlgorithmSuite algorithmSuite=createAlgorithmSuite();
  try {
    verify(securityHeader,algorithmSuite,wssCrypto);
    fail("Expected failure as RSA 15 is not allowed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  algorithmSuite.addKeyWrapAlgorithm(WSConstants.KEYTRANSPORT_RSA15);
  verify(securityHeader,algorithmSuite,wssCrypto);
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSymmetricEncryption() throws Exception {
  KeyGenerator keyGen=KeyGenerator.getInstance("AES");
  keyGen.init(128);
  SecretKey key=keyGen.generateKey();
  byte[] keyData=key.getEncoded();
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setKeyIdentifierType(WSConstants.ENCRYPTED_KEY_SHA1_IDENTIFIER);
  builder.setSymmetricKey(key);
  builder.setEncryptSymmKey(false);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document encryptedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  byte[] encodedBytes=KeyUtils.generateDigest(keyData);
  String identifier=Base64.encode(encodedBytes);
  SecretKeyCallbackHandler secretKeyCallbackHandler=new SecretKeyCallbackHandler();
  secretKeyCallbackHandler.addSecretKey(identifier,keyData);
  Element securityHeader=WSSecurityUtil.getSecurityHeader(encryptedDoc,null);
  AlgorithmSuite algorithmSuite=createAlgorithmSuite();
  WSSecurityEngine secEngine=new WSSecurityEngine();
  RequestData data=new RequestData();
  data.setDecCrypto(crypto);
  data.setCallbackHandler(secretKeyCallbackHandler);
  data.setAlgorithmSuite(algorithmSuite);
  algorithmSuite.addEncryptionMethod(WSConstants.AES_128);
  secEngine.processSecurityHeader(securityHeader,data);
  algorithmSuite.setMinimumSymmetricKeyLength(256);
  try {
    secEngine.processSecurityHeader(securityHeader,data);
    fail("Expected failure as a 128 bit key is not allowed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  algorithmSuite.setMinimumSymmetricKeyLength(64);
  algorithmSuite.setMaximumSymmetricKeyLength(120);
  try {
    secEngine.processSecurityHeader(securityHeader,data);
    fail("Expected failure as a 128 bit key is not allowed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.EncryptionCRLTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that encrypts with certificate revocation check
 * so it should fail
 * @throws java.lang.Exception Thrown when there is any problem in encryption or decryption
 * TODO Re-enable once CRL issue fixed
 */
@Test @org.junit.Ignore public void testEncryptionWithRevocationCheck() throws Exception {
  final WSSConfig cfg=WSSConfig.getNewInstance();
  final RequestData reqData=new RequestData();
  reqData.setWssConfig(cfg);
  EncryptionActionToken actionToken=new EncryptionActionToken();
  actionToken.setUser("wss40rev");
  actionToken.setKeyIdentifierId(WSConstants.BST_DIRECT_REFERENCE);
  actionToken.setSymmetricAlgorithm(WSConstants.TRIPLE_DES);
  actionToken.setCrypto(crypto);
  reqData.setEncryptionToken(actionToken);
  java.util.Map<String,Object> messageContext=new java.util.TreeMap<String,Object>();
  messageContext.put(WSHandlerConstants.PW_CALLBACK_REF,keystoreCallbackHandler);
  reqData.setMsgContext(messageContext);
  reqData.setUsername("wss40rev");
  final Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  CustomHandler handler=new CustomHandler();
  handler.setOption(WSHandlerConstants.ENABLE_REVOCATION,"true");
  try {
    handler.send(doc,reqData,Collections.singletonList(new HandlerAction(WSConstants.ENCR)),true);
    fail("Failure expected on a revoked certificate");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.EncryptionPartsTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRequiredSOAPHeaderNotPresent() throws Exception {
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart encP=new WSEncryptionPart("foobar","urn:foo.bar","");
  encrypt.getParts().add(encP);
  String soapNamespace=WSSecurityUtil.getSOAPNamespace(doc.getDocumentElement());
  encP=new WSEncryptionPart(WSConstants.ELEM_BODY,soapNamespace,"Content");
  encrypt.getParts().add(encP);
  try {
    encrypt.build(doc,crypto,secHeader);
    fail("Failure expected on not encrypting a required element");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test encrypting a custom SOAP header with a bad localname
 */
@Test public void testBadLocalname() throws Exception {
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  Document doc=SOAPUtil.toSOAPPart(SOAPMSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart encP=new WSEncryptionPart("foobar2","urn:foo.bar","");
  encrypt.getParts().add(encP);
  try {
    encrypt.build(doc,crypto,secHeader);
    fail("Failure expected on a bad localname");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test encrypting a custom SOAP header using wsse11:EncryptedHeader
 */
@SuppressWarnings("unchecked") @Test public void testSOAPEncryptedHeader() throws Exception {
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  Document doc=SOAPUtil.toSOAPPart(SOAPMSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart encP=new WSEncryptionPart("foobar","urn:foo.bar","Header");
  encrypt.getParts().add(encP);
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains("wsse11:EncryptedHeader"));
  assertFalse(outputString.contains("foo:foobar"));
  WSHandlerResult results=verify(encryptedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertEquals(WSConstants.KEYTRANSPORT_RSAOEP,actionResult.get(WSSecurityEngineResult.TAG_ENCRYPTED_KEY_TRANSPORT_METHOD));
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/soapenv:Envelope/soapenv:Header/foo:foobar",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test getting a DOM Element from WSEncryptionPart directly
 */
@Test public void testEncryptionPartDOMElement() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPMSG);
  SOAPConstants soapConstants=WSSecurityUtil.getSOAPConstants(doc.getDocumentElement());
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart encP=new WSEncryptionPart("Incorrect Localname","Incorrect N/S","");
  Element bodyElement=WSSecurityUtil.findBodyElement(doc);
  assertTrue(bodyElement != null && "Body".equals(bodyElement.getLocalName()));
  encP.setElement(bodyElement);
  encrypt.getParts().add(encP);
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  assertTrue(!outputString.contains("testMethod"));
  WSHandlerResult results=verify(encryptedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  @SuppressWarnings("unchecked") final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  WSDataRef wsDataRef=refs.get(0);
  QName bodyName=new QName(soapConstants.getEnvelopeURI(),"Body");
  assertEquals(bodyName,wsDataRef.getName());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test encrypting a custom SOAP header using wsse11:EncryptedHeader
 */
@SuppressWarnings("unchecked") @Test public void testSOAPEncryptedHeaderWithAttributes() throws Exception {
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  Document doc=SOAPUtil.toSOAPPart(SOAPMSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart encP=new WSEncryptionPart("with-attributes","urn:foo.bar","Header");
  encrypt.getParts().add(encP);
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains("wsse11:EncryptedHeader"));
  assertFalse(outputString.contains("foo:with-attributes"));
  WSHandlerResult results=verify(encryptedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertEquals(WSConstants.KEYTRANSPORT_RSAOEP,actionResult.get(WSSecurityEngineResult.TAG_ENCRYPTED_KEY_TRANSPORT_METHOD));
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/soapenv:Envelope/soapenv:Header/foo:with-attributes",xpath);
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test encrypting a custom SOAP header with a bad namespace
 */
@Test public void testBadNamespace() throws Exception {
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  Document doc=SOAPUtil.toSOAPPart(SOAPMSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart encP=new WSEncryptionPart("foobar","urn:foo.bar2","");
  encrypt.getParts().add(encP);
  try {
    encrypt.build(doc,crypto,secHeader);
    fail("Failure expected on a bad namespace");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test encrypting a custom SOAP header
 */
@SuppressWarnings("unchecked") @Test public void testSOAPHeader() throws Exception {
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  Document doc=SOAPUtil.toSOAPPart(SOAPMSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart encP=new WSEncryptionPart("foobar","urn:foo.bar","");
  encrypt.getParts().add(encP);
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(encryptedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertEquals(WSConstants.KEYTRANSPORT_RSAOEP,actionResult.get(WSSecurityEngineResult.TAG_ENCRYPTED_KEY_TRANSPORT_METHOD));
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/soapenv:Envelope/soapenv:Header/foo:foobar",xpath);
  assertEquals(WSConstants.AES_128,wsDataRef.getAlgorithm());
  QName expectedQName=new QName("urn:foo.bar","foobar");
  assertEquals(expectedQName,wsDataRef.getName());
  Element encryptedElement=wsDataRef.getEncryptedElement();
  assertNotNull(encryptedElement);
  assertEquals(WSConstants.ENC_NS,encryptedElement.getNamespaceURI());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.EncryptionTest </h4><pre class="type-3 type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that encrypt and decrypt a WS-Security envelope.
 * This test uses the RSA_15 algorithm to transport (wrap) the symmetric
 * key.
 * <p/>
 * @throws Exception Thrown when there is any problem in signing or verification
 */
@Test public void testEncryptionDecryptionRSA15() throws Exception {
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("wss40");
  builder.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  builder.setSymmetricEncAlgorithm(WSConstants.TRIPLE_DES);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  LOG.info("Before Encryption Triple DES....");
  Document encryptedDoc=builder.build(doc,crypto,secHeader);
  LOG.info("After Encryption Triple DES....");
  String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Encrypted message, RSA-15 keytransport, 3DES:");
    LOG.debug(outputString);
  }
  assertFalse(outputString.contains("counter_port_type"));
  verify(encryptedDoc,keystoreCallbackHandler,SOAP_BODY);
  builder.getParts().clear();
  builder.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  builder.setSymmetricEncAlgorithm(WSConstants.AES_128);
  builder.setSymmetricKey(null);
  WSEncryptionPart encP=new WSEncryptionPart("add","http://ws.apache.org/counter/counter_port_type","Element");
  builder.getParts().add(encP);
  doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  LOG.info("Before Encryption AES 128/RSA-15....");
  encryptedDoc=builder.build(doc,crypto,secHeader);
  LOG.info("After Encryption AES 128/RSA-15....");
  outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Encrypted message, RSA-15 keytransport, AES 128:");
    LOG.debug(outputString);
  }
  assertFalse(outputString.contains("counter_port_type"));
  WSHandlerResult results=verify(encryptedDoc,keystoreCallbackHandler,new javax.xml.namespace.QName("http://ws.apache.org/counter/counter_port_type","add"));
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertNotNull(actionResult.get(WSSecurityEngineResult.TAG_X509_CERTIFICATE));
  assertNotNull(actionResult.get(WSSecurityEngineResult.TAG_X509_REFERENCE_TYPE));
  REFERENCE_TYPE referenceType=(REFERENCE_TYPE)actionResult.get(WSSecurityEngineResult.TAG_X509_REFERENCE_TYPE);
  assertTrue(referenceType == REFERENCE_TYPE.ISSUER_SERIAL);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that encrypt and decrypt a WS-Security envelope.
 * This test uses the RSA OAEP algorithm to transport (wrap) the symmetric
 * key and SHA-256.
 * <p/>
 * @throws Exception Thrown when there is any problem in signing or verification
 */
@Test public void testEncryptionDecryptionOAEPSHA256() throws Exception {
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("wss40");
  builder.setKeyEncAlgo(WSConstants.KEYTRANSPORT_RSAOEP);
  builder.setDigestAlgorithm(WSConstants.SHA256);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  LOG.info("Before Encryption Triple DES/RSA-OAEP....");
  Document encryptedDoc=builder.build(doc,crypto,secHeader);
  LOG.info("After Encryption Triple DES/RSA-OAEP....");
  String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Encrypted message, RSA-OAEP keytransport, 3DES:");
    LOG.debug(outputString);
  }
  assertFalse(outputString.contains("counter_port_type"));
  WSSecurityEngine newEngine=new WSSecurityEngine();
  WSHandlerResult results=newEngine.processSecurityHeader(encryptedDoc,null,keystoreCallbackHandler,crypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertNotNull(actionResult);
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBadAttribute() throws Exception {
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("wss40");
  builder.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  builder.setSymmetricEncAlgorithm(WSConstants.TRIPLE_DES);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  builder.prepare(doc,crypto);
  SOAPConstants soapConstants=WSSecurityUtil.getSOAPConstants(doc.getDocumentElement());
  java.util.List<WSEncryptionPart> parts=new ArrayList<>();
  WSEncryptionPart encP=new WSEncryptionPart(soapConstants.getBodyQName().getLocalPart(),soapConstants.getEnvelopeURI(),"Content");
  parts.add(encP);
  Element refs=builder.encrypt();
  builder.addExternalRefElement(refs,secHeader);
  Element encryptedKeyElement=builder.getEncryptedKeyElement();
  encryptedKeyElement.setAttributeNS(null,"Type","SomeType");
  WSSecurityUtil.prependChildElement(secHeader.getSecurityHeader(),encryptedKeyElement);
  builder.prependBSTElementToHeader(secHeader);
  Document encryptedDoc=doc;
  String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  WSSecurityEngine newEngine=new WSSecurityEngine();
  try {
    newEngine.processSecurityHeader(encryptedDoc,null,keystoreCallbackHandler,crypto);
    fail("Failure expected on a bad attribute type");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  RequestData data=new RequestData();
  data.setCallbackHandler(keystoreCallbackHandler);
  data.setDecCrypto(crypto);
  data.setIgnoredBSPRules(Collections.singletonList(BSPRule.R3209));
  newEngine.processSecurityHeader(encryptedDoc,data);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptionDecryptionPublicKey() throws Exception {
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setKeyIdentifierType(WSConstants.KEY_VALUE);
  builder.setKeyEncAlgo(WSConstants.KEYTRANSPORT_RSAOEP);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
  cryptoType.setAlias("wss40");
  X509Certificate[] certs=crypto.getX509Certificates(cryptoType);
  assertNotNull(certs);
  builder.setUseThisPublicKey(certs[0].getPublicKey());
  Document encryptedDoc=builder.build(doc,crypto,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  assertFalse(outputString.contains("counter_port_type"));
  WSSecurityEngine newEngine=new WSSecurityEngine();
  WSHandlerResult results=newEngine.processSecurityHeader(encryptedDoc,null,keystoreCallbackHandler,crypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertNotNull(actionResult.get(WSSecurityEngineResult.TAG_PUBLIC_KEY));
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that encrypt and decrypt a WS-Security envelope.
 * This test uses the RSA OAEP algorithm to transport (wrap) the symmetric
 * key.
 * <p/>
 * @throws Exception Thrown when there is any problem in signing or verification
 */
@Test public void testEncryptionDecryptionOAEP() throws Exception {
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("wss40");
  builder.setKeyIdentifierType(WSConstants.X509_KEY_IDENTIFIER);
  builder.setKeyEncAlgo(WSConstants.KEYTRANSPORT_RSAOEP);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  LOG.info("Before Encryption Triple DES/RSA-OAEP....");
  Document encryptedDoc=builder.build(doc,crypto,secHeader);
  LOG.info("After Encryption Triple DES/RSA-OAEP....");
  String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Encrypted message, RSA-OAEP keytransport, 3DES:");
    LOG.debug(outputString);
  }
  assertFalse(outputString.contains("counter_port_type"));
  WSSecurityEngine newEngine=new WSSecurityEngine();
  WSHandlerResult results=newEngine.processSecurityHeader(encryptedDoc,null,keystoreCallbackHandler,crypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertNotNull(actionResult.get(WSSecurityEngineResult.TAG_X509_CERTIFICATE));
  assertNotNull(actionResult.get(WSSecurityEngineResult.TAG_X509_REFERENCE_TYPE));
  REFERENCE_TYPE referenceType=(REFERENCE_TYPE)actionResult.get(WSSecurityEngineResult.TAG_X509_REFERENCE_TYPE);
  assertTrue(referenceType == REFERENCE_TYPE.KEY_IDENTIFIER);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that encrypt and decrypt a WS-Security envelope.
 * This test uses the RSA_15 algorithm to transport (wrap) the symmetric key.
 * The test case creates a ReferenceList element that references EncryptedData
 * elements. The ReferencesList element is put into the Security header, not
 * as child of the EncryptedKey. The EncryptedData elements contain a KeyInfo
 * that references the EncryptedKey via a STR/Reference structure.
 * Refer to OASIS WS Security spec 1.1, chap 7.7
 */
@Test public void testEncryptionDecryptionRSA15STR() throws Exception {
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("wss40");
  builder.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  builder.setSymmetricEncAlgorithm(WSConstants.TRIPLE_DES);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  LOG.info("Before Encryption Triple DES....");
  builder.prepare(doc,crypto);
  SOAPConstants soapConstants=WSSecurityUtil.getSOAPConstants(doc.getDocumentElement());
  WSEncryptionPart encP=new WSEncryptionPart(soapConstants.getBodyQName().getLocalPart(),soapConstants.getEnvelopeURI(),"Content");
  builder.getParts().add(encP);
  Element refs=builder.encrypt();
  builder.addExternalRefElement(refs,secHeader);
  builder.prependToHeader(secHeader);
  builder.prependBSTElementToHeader(secHeader);
  Document encryptedDoc=doc;
  LOG.info("After Encryption Triple DES....");
  String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Encrypted message, RSA-15 keytransport, 3DES:");
    LOG.debug(outputString);
  }
  assertFalse(outputString.contains("counter_port_type"));
  WSHandlerResult results=verify(encryptedDoc,crypto,keystoreCallbackHandler);
  outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  assertTrue(outputString.contains("counter_port_type"));
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertNotNull(actionResult.get(WSSecurityEngineResult.TAG_X509_CERTIFICATE));
  assertNotNull(actionResult.get(WSSecurityEngineResult.TAG_X509_REFERENCE_TYPE));
  REFERENCE_TYPE referenceType=(REFERENCE_TYPE)actionResult.get(WSSecurityEngineResult.TAG_X509_REFERENCE_TYPE);
  assertTrue(referenceType == REFERENCE_TYPE.DIRECT_REF);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that encrypts and decrypts a WS-Security envelope.
 * The test uses the ThumbprintSHA1 key identifier type.
 * <p/>
 * @throws java.lang.Exception Thrown when there is any problem in encryption or decryption
 */
@Test public void testX509EncryptionThumb() throws Exception {
  Crypto encCrypto=CryptoFactory.getInstance();
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.setKeyIdentifierType(WSConstants.THUMBPRINT_IDENTIFIER);
  LOG.info("Before Encrypting ThumbprintSHA1....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document encryptedDoc=builder.build(doc,encCrypto,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Encrypted message with THUMBPRINT_IDENTIFIER:");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains("#ThumbprintSHA1"));
  LOG.info("After Encrypting ThumbprintSHA1....");
  WSHandlerResult results=verify(encryptedDoc,encCrypto,keystoreCallbackHandler);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertNotNull(actionResult.get(WSSecurityEngineResult.TAG_X509_CERTIFICATE));
  assertNotNull(actionResult.get(WSSecurityEngineResult.TAG_X509_REFERENCE_TYPE));
  REFERENCE_TYPE referenceType=(REFERENCE_TYPE)actionResult.get(WSSecurityEngineResult.TAG_X509_REFERENCE_TYPE);
  assertTrue(referenceType == REFERENCE_TYPE.THUMBPRINT_SHA1);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.ModifiedRequestTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for when a Signature is received with a certificate that is not trusted
 */
@Test public void testUntrustedSignature() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("wss40","security");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Crypto wss40Crypto=CryptoFactory.getInstance("wss40.properties");
  Document signedDoc=builder.build(doc,wss40Crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  try {
    verify(signedDoc);
    fail("Failure expected on an untrusted Certificate");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_CHECK);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test a duplicated signed SAML Assertion.
 */
@Test public void testDuplicatedSignedSAMLAssertion() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,null,samlAssertion,crypto,"16c73ab6-b892-458f-abf5-2f875f74882e","security",secHeader);
  Element assertionElement=(Element)samlAssertion.getElement().cloneNode(true);
  assertionElement.removeChild(assertionElement.getFirstChild());
  secHeader.getSecurityHeader().appendChild(assertionElement);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 1.1 Authn Assertion (sender vouches):");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  try {
    verify(signedDoc);
    fail("Failure expected on duplicate tokens");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getMessage().contains("Multiple security tokens with the same Id have been detected"));
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for when some EncryptedData CipherValue data is modified
 * (in the security header)
 */
@Test public void testModifiedSecurityHeaderEncryptedDataCipherValue() throws Exception {
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("wss40");
  builder.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  builder.setSymmetricEncAlgorithm(WSConstants.TRIPLE_DES);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Crypto wssCrypto=CryptoFactory.getInstance("wss40.properties");
  WSSecTimestamp timestamp=new WSSecTimestamp();
  timestamp.setTimeToLive(300);
  timestamp.build(doc,secHeader);
  WSEncryptionPart encP=new WSEncryptionPart("Timestamp",WSConstants.WSU_NS,"");
  builder.getParts().add(encP);
  Document encryptedDoc=builder.build(doc,wssCrypto,secHeader);
  Element securityHeader=WSSecurityUtil.getSecurityHeader(encryptedDoc,"");
  Element encryptedTimestamp=XMLUtils.findElement(securityHeader,"EncryptedData",WSConstants.ENC_NS);
  Element cipherValue=XMLUtils.findElement(encryptedTimestamp,"CipherValue",WSConstants.ENC_NS);
  String cipherText=cipherValue.getTextContent();
  StringBuilder stringBuilder=new StringBuilder(cipherText);
  int index=stringBuilder.length() / 2;
  char ch=stringBuilder.charAt(index);
  if (ch != 'A') {
    ch='A';
  }
 else {
    ch='B';
  }
  stringBuilder.setCharAt(index,ch);
  cipherValue.setTextContent(stringBuilder.toString());
  String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  WSSecurityEngine newEngine=new WSSecurityEngine();
  try {
    newEngine.processSecurityHeader(doc,null,new KeystoreCallbackHandler(),wssCrypto);
    fail("Failure expected on a modified EncryptedData CipherValue");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_CHECK);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for when an element that a Signature Reference points to is modified
 */
@Test public void testModifiedSignatureReference() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecTimestamp timestamp=new WSSecTimestamp();
  timestamp.setTimeToLive(300);
  Document createdDoc=timestamp.build(doc,secHeader);
  WSEncryptionPart encP=new WSEncryptionPart("Timestamp",WSConstants.WSU_NS,"");
  builder.getParts().add(encP);
  Document signedDoc=builder.build(createdDoc,crypto,secHeader);
  Element timestampElement=timestamp.getElement();
  Element createdValue=XMLUtils.findElement(timestampElement,"Created",WSConstants.WSU_NS);
  DateFormat zulu=new XmlSchemaDateFormat();
  XMLGregorianCalendar createdCalendar=WSSConfig.DATATYPE_FACTORY.newXMLGregorianCalendar(createdValue.getTextContent());
  Duration duration=WSSConfig.DATATYPE_FACTORY.newDuration(5000L);
  createdCalendar.add(duration);
  Date createdDate=createdCalendar.toGregorianCalendar().getTime();
  createdValue.setTextContent(zulu.format(createdDate));
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  try {
    verify(signedDoc);
    fail("Failure expected on a modified Signature Reference");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_CHECK);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that signs a SOAP body element "value". The SOAP request is then modified
 * so that the signed "value" element is put in the header, and the value of the
 * original element is changed. The wsu:Id value of the original element is also
 * changed. Signature verification will pass, so we need to check the Elements.
 */
@Test public void testMovedElementChangedId() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  LOG.info("Before Signing....");
  Document doc=SOAPUtil.toSOAPPart(SOAPMSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart encP=new WSEncryptionPart("value","http://blah.com","");
  builder.getParts().add(encP);
  Document signedDoc=builder.build(doc,crypto,secHeader);
  Element secHeaderElement=secHeader.getSecurityHeader();
  Element envelopeElement=signedDoc.getDocumentElement();
  Node valueNode=envelopeElement.getElementsByTagNameNS("http://blah.com","value").item(0);
  Node clonedValueNode=valueNode.cloneNode(true);
  secHeaderElement.appendChild(clonedValueNode);
  valueNode.getFirstChild().setNodeValue("250");
  ((Element)valueNode).setAttributeNS(WSConstants.WSU_NS,"wsu:Id","id-250");
  if (LOG.isDebugEnabled()) {
    LOG.debug("After Signing....");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc);
  envelopeElement=signedDoc.getDocumentElement();
  Node bodyNode=envelopeElement.getElementsByTagNameNS(WSConstants.URI_SOAP11_ENV,"Body").item(0);
  valueNode=((Element)bodyNode).getElementsByTagNameNS("http://blah.com","value").item(0);
  List<WSSecurityEngineResult> signedResults=results.getActionResults().get(WSConstants.SIGN);
  try {
    SignatureUtils.verifySignedElement((Element)valueNode,signedResults);
    fail("Failure expected on the required element not being signed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_CHECK);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for when the Signature element is modified
 */
@Test public void testModifiedSignature() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  Element signatureElement=builder.getSignatureElement();
  Node firstChild=signatureElement.getFirstChild();
  while (!(firstChild instanceof Element) && firstChild != null) {
    firstChild=signatureElement.getNextSibling();
  }
  ((Element)firstChild).setAttributeNS(null,"Id","xyz");
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  try {
    verify(signedDoc);
    fail("Failure expected on a modified Signature element");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_CHECK);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test a duplicated signed UsernameToken
 */
@Test public void testDuplicatedSignedUsernameToken() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecUsernameToken usernameToken=new WSSecUsernameToken();
  usernameToken.setUserInfo("wss86","security");
  Document createdDoc=usernameToken.build(doc,secHeader);
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  WSEncryptionPart encP=new WSEncryptionPart("UsernameToken",WSConstants.WSSE_NS,"");
  builder.getParts().add(encP);
  builder.prepare(createdDoc,crypto,secHeader);
  List<javax.xml.crypto.dsig.Reference> referenceList=builder.addReferencesToSign(builder.getParts(),secHeader);
  builder.computeSignature(referenceList,false,null);
  secHeader.getSecurityHeader().appendChild(usernameToken.getUsernameTokenElement().cloneNode(true));
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed Timestamp");
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  try {
    verify(doc);
    fail("Failure expected on duplicate tokens");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getMessage().contains("Multiple security tokens with the same Id have been detected"));
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that signs a SOAP body element "value". The SOAP request is then modified
 * so that the signed "value" element is put in the header, and the value of the
 * original element is changed. This test will fail as the request will contain
 * multiple elements with the same wsu:Id.
 */
@Test public void testMovedElement() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  LOG.info("Before Signing....");
  Document doc=SOAPUtil.toSOAPPart(SOAPMSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart encP=new WSEncryptionPart("value","http://blah.com","");
  builder.getParts().add(encP);
  Document signedDoc=builder.build(doc,crypto,secHeader);
  Element secHeaderElement=secHeader.getSecurityHeader();
  Element envelopeElement=signedDoc.getDocumentElement();
  Node valueNode=envelopeElement.getElementsByTagNameNS("http://blah.com","value").item(0);
  Node clonedValueNode=valueNode.cloneNode(true);
  secHeaderElement.appendChild(clonedValueNode);
  valueNode.getFirstChild().setNodeValue("250");
  if (LOG.isDebugEnabled()) {
    LOG.debug("After Signing....");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  try {
    verify(signedDoc);
    fail("Failure expected on multiple elements with the same wsu:Id");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_CHECK);
    assertTrue(ex.getMessage().startsWith("javax.xml.crypto.URIReferenceException: " + "org.apache.xml.security.utils.resolver.ResourceResolverException: "));
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for when an EncryptedData structure is modified
 */
@Test public void testModifiedEncryptedDataStructure() throws Exception {
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("wss40");
  builder.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  builder.setSymmetricEncAlgorithm(WSConstants.TRIPLE_DES);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Crypto wssCrypto=CryptoFactory.getInstance("wss40.properties");
  Document encryptedDoc=builder.build(doc,wssCrypto,secHeader);
  Element body=WSSecurityUtil.findBodyElement(doc);
  Element encryptionMethod=XMLUtils.findElement(body,"EncryptionMethod",WSConstants.ENC_NS);
  encryptionMethod.setAttributeNS(null,"Algorithm","http://new-algorithm");
  String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  WSSecurityEngine newEngine=new WSSecurityEngine();
  try {
    newEngine.processSecurityHeader(doc,null,new KeystoreCallbackHandler(),wssCrypto);
    fail("Failure expected on a modified EncryptedData structure");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for when some EncryptedData CipherValue data is modified.
 */
@Test public void testModifiedEncryptedDataCipherValue() throws Exception {
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("wss40");
  builder.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  builder.setSymmetricEncAlgorithm(WSConstants.TRIPLE_DES);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Crypto wssCrypto=CryptoFactory.getInstance("wss40.properties");
  Document encryptedDoc=builder.build(doc,wssCrypto,secHeader);
  Element body=WSSecurityUtil.findBodyElement(doc);
  Element cipherValue=XMLUtils.findElement(body,"CipherValue",WSConstants.ENC_NS);
  String cipherText=cipherValue.getTextContent();
  StringBuilder stringBuilder=new StringBuilder(cipherText);
  int index=stringBuilder.length() / 2;
  char ch=stringBuilder.charAt(index);
  if (ch != 'A') {
    ch='A';
  }
 else {
    ch='B';
  }
  stringBuilder.setCharAt(index,ch);
  cipherValue.setTextContent(stringBuilder.toString());
  String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  WSSecurityEngine newEngine=new WSSecurityEngine();
  try {
    newEngine.processSecurityHeader(doc,null,new KeystoreCallbackHandler(),wssCrypto);
    fail("Failure expected on a modified EncryptedData CipherValue");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_CHECK);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for when some EncryptedKey CipherValue data is modified.
 */
@Test public void testModifiedEncryptedKeyCipherValue() throws Exception {
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("wss40");
  builder.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  builder.setSymmetricEncAlgorithm(WSConstants.TRIPLE_DES);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Crypto wssCrypto=CryptoFactory.getInstance("wss40.properties");
  Document encryptedDoc=builder.build(doc,wssCrypto,secHeader);
  Element encryptedKey=XMLUtils.findElement(doc.getDocumentElement(),"EncryptedKey",WSConstants.ENC_NS);
  Element cipherValue=XMLUtils.findElement(encryptedKey,"CipherValue",WSConstants.ENC_NS);
  String cipherText=cipherValue.getTextContent();
  StringBuilder stringBuilder=new StringBuilder(cipherText);
  int index=stringBuilder.length() / 2;
  char ch=stringBuilder.charAt(index);
  if (ch != 'A') {
    ch='A';
  }
 else {
    ch='B';
  }
  stringBuilder.setCharAt(index,ch);
  cipherValue.setTextContent(stringBuilder.toString());
  String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  WSSecurityEngine newEngine=new WSSecurityEngine();
  try {
    newEngine.processSecurityHeader(doc,null,new KeystoreCallbackHandler(),wssCrypto);
    fail("Failure expected on a modified EncryptedData CipherValue");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_CHECK);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.PasswordTypeTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that adds a UserNameToken with password Digest to a WS-Security envelope
 */
@Test public void testPasswordDigest() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setUserInfo("wernerd","verySecret");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Message with UserNameToken PW Digest:");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSSecurityEngine secEngine=new WSSecurityEngine();
  RequestData requestData=new RequestData();
  requestData.setCallbackHandler(callbackHandler);
  requestData.setRequiredPasswordType(WSConstants.PASSWORD_DIGEST);
  secEngine.processSecurityHeader(doc,requestData);
  requestData=new RequestData();
  requestData.setCallbackHandler(callbackHandler);
  requestData.setRequiredPasswordType(null);
  secEngine.processSecurityHeader(doc,requestData);
  try {
    requestData=new RequestData();
    requestData.setCallbackHandler(callbackHandler);
    requestData.setRequiredPasswordType(WSConstants.PASSWORD_TEXT);
    secEngine.processSecurityHeader(doc,requestData);
    fail("Expected failure on the wrong password type");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that adds a UserNameToken with password text to a WS-Security envelope
 */
@Test public void testUsernameTokenText() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordType(WSConstants.PASSWORD_TEXT);
  builder.setUserInfo("wernerd","verySecret");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Message with UserNameToken PW Text:");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSSecurityEngine secEngine=new WSSecurityEngine();
  RequestData requestData=new RequestData();
  requestData.setCallbackHandler(callbackHandler);
  requestData.setRequiredPasswordType(WSConstants.PASSWORD_TEXT);
  secEngine.processSecurityHeader(doc,requestData);
  requestData=new RequestData();
  requestData.setCallbackHandler(callbackHandler);
  requestData.setRequiredPasswordType(null);
  secEngine.processSecurityHeader(doc,requestData);
  try {
    requestData=new RequestData();
    requestData.setCallbackHandler(callbackHandler);
    requestData.setRequiredPasswordType(WSConstants.PASSWORD_DIGEST);
    secEngine.processSecurityHeader(doc,requestData);
    fail("Expected failure on the wrong password type");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that adds a UserNameToken via WSHandler
 */
@Test public void testUsernameTokenWSHandler() throws Exception {
  CustomHandler handler=new CustomHandler();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  RequestData reqData=new RequestData();
  java.util.Map<String,Object> config=new java.util.TreeMap<String,Object>();
  config.put("password","verySecret");
  config.put(WSHandlerConstants.PASSWORD_TYPE,WSConstants.PW_TEXT);
  reqData.setUsername("wernerd");
  reqData.setMsgContext(config);
  HandlerAction action=new HandlerAction(WSConstants.UT);
  handler.send(doc,reqData,Collections.singletonList(action),true);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Username Token via WSHandler");
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  config.put(WSHandlerConstants.PASSWORD_TYPE,WSConstants.PW_DIGEST);
  reqData.setMsgContext(config);
  handler.receive(Collections.singletonList(WSConstants.UT),reqData);
  WSSecurityEngine secEngine=new WSSecurityEngine();
  reqData.setCallbackHandler(callbackHandler);
  try {
    secEngine.processSecurityHeader(doc,reqData);
    fail("Expected failure on the wrong password type");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.ReplayTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReplayedTimestampNoExpires() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecTimestamp timestamp=new WSSecTimestamp();
  timestamp.setTimeToLive(0);
  Document createdDoc=timestamp.build(doc,secHeader);
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSEncryptionPart encP=new WSEncryptionPart("Timestamp",WSConstants.WSU_NS,"");
  builder.getParts().add(encP);
  builder.prepare(createdDoc,crypto,secHeader);
  List<javax.xml.crypto.dsig.Reference> referenceList=builder.addReferencesToSign(builder.getParts(),secHeader);
  builder.computeSignature(referenceList,false,null);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(createdDoc);
    LOG.debug(outputString);
  }
  WSSConfig wssConfig=WSSConfig.getNewInstance();
  RequestData data=new RequestData();
  data.setWssConfig(wssConfig);
  data.setCallbackHandler(callbackHandler);
  data.setTimestampReplayCache(new MemoryReplayCache());
  verify(createdDoc,wssConfig,data);
  try {
    verify(createdDoc,wssConfig,data);
    fail("Expected failure on a replay attack");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReplayedUsernameToken() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setUserInfo("wernerd","verySecret");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSSConfig wssConfig=WSSConfig.getNewInstance();
  RequestData data=new RequestData();
  data.setCallbackHandler(new UsernamePasswordCallbackHandler());
  data.setWssConfig(wssConfig);
  data.setNonceReplayCache(new MemoryReplayCache());
  verify(signedDoc,wssConfig,data);
  try {
    verify(signedDoc,wssConfig,data);
    fail("Expected failure on a replay attack");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEhCacheReplayedTimestampBelowSignature() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecTimestamp timestamp=new WSSecTimestamp();
  timestamp.setTimeToLive(300);
  Document createdDoc=timestamp.build(doc,secHeader);
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSEncryptionPart encP=new WSEncryptionPart("Timestamp",WSConstants.WSU_NS,"");
  builder.getParts().add(encP);
  builder.build(createdDoc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(createdDoc);
    LOG.debug(outputString);
  }
  WSSConfig wssConfig=WSSConfig.getNewInstance();
  RequestData data=new RequestData();
  data.setWssConfig(wssConfig);
  data.setCallbackHandler(callbackHandler);
  verify(createdDoc,wssConfig,data);
  try {
    verify(createdDoc,wssConfig,data);
    fail("Expected failure on a replay attack");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEhCacheReplayedUsernameToken() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setUserInfo("wernerd","verySecret");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSSConfig wssConfig=WSSConfig.getNewInstance();
  RequestData data=new RequestData();
  data.setCallbackHandler(new UsernamePasswordCallbackHandler());
  data.setWssConfig(wssConfig);
  verify(signedDoc,wssConfig,data);
  try {
    verify(signedDoc,wssConfig,data);
    fail("Expected failure on a replay attack");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEhCacheReplayedTimestampNoExpires() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecTimestamp timestamp=new WSSecTimestamp();
  timestamp.setTimeToLive(0);
  Document createdDoc=timestamp.build(doc,secHeader);
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSEncryptionPart encP=new WSEncryptionPart("Timestamp",WSConstants.WSU_NS,"");
  builder.getParts().add(encP);
  builder.prepare(createdDoc,crypto,secHeader);
  List<javax.xml.crypto.dsig.Reference> referenceList=builder.addReferencesToSign(builder.getParts(),secHeader);
  builder.computeSignature(referenceList,false,null);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(createdDoc);
    LOG.debug(outputString);
  }
  WSSConfig wssConfig=WSSConfig.getNewInstance();
  RequestData data=new RequestData();
  data.setWssConfig(wssConfig);
  data.setCallbackHandler(callbackHandler);
  verify(createdDoc,wssConfig,data);
  try {
    verify(createdDoc,wssConfig,data);
    fail("Expected failure on a replay attack");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReplayedTimestamp() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecTimestamp timestamp=new WSSecTimestamp();
  timestamp.setTimeToLive(300);
  Document createdDoc=timestamp.build(doc,secHeader);
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSEncryptionPart encP=new WSEncryptionPart("Timestamp",WSConstants.WSU_NS,"");
  builder.getParts().add(encP);
  builder.prepare(createdDoc,crypto,secHeader);
  List<javax.xml.crypto.dsig.Reference> referenceList=builder.addReferencesToSign(builder.getParts(),secHeader);
  builder.computeSignature(referenceList,false,null);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(createdDoc);
    LOG.debug(outputString);
  }
  WSSConfig wssConfig=WSSConfig.getNewInstance();
  RequestData data=new RequestData();
  data.setWssConfig(wssConfig);
  data.setCallbackHandler(callbackHandler);
  data.setTimestampReplayCache(new MemoryReplayCache());
  verify(createdDoc,wssConfig,data);
  try {
    verify(createdDoc,wssConfig,data);
    fail("Expected failure on a replay attack");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 2 authentication assertion
 * with a OneTimeUse Element
 */
@Test public void testEhCacheReplayedSAML2OneTimeUse() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_BEARER);
  ConditionsBean conditions=new ConditionsBean();
  conditions.setTokenPeriodMinutes(5);
  conditions.setOneTimeUse(true);
  callbackHandler.setConditions(conditions);
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(unsignedDoc);
  assertTrue(outputString.contains("OneTimeUse"));
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  WSSConfig wssConfig=WSSConfig.getNewInstance();
  SamlAssertionValidator assertionValidator=new SamlAssertionValidator();
  assertionValidator.setRequireBearerSignature(false);
  wssConfig.setValidator(WSConstants.SAML_TOKEN,assertionValidator);
  wssConfig.setValidator(WSConstants.SAML2_TOKEN,assertionValidator);
  RequestData data=new RequestData();
  data.setWssConfig(wssConfig);
  data.setCallbackHandler(callbackHandler);
  verify(unsignedDoc,wssConfig,data);
  try {
    verify(unsignedDoc,wssConfig,data);
    fail("Expected failure on a replay attack");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReplayedTimestampBelowSignature() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecTimestamp timestamp=new WSSecTimestamp();
  timestamp.setTimeToLive(300);
  Document createdDoc=timestamp.build(doc,secHeader);
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSEncryptionPart encP=new WSEncryptionPart("Timestamp",WSConstants.WSU_NS,"");
  builder.getParts().add(encP);
  builder.build(createdDoc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(createdDoc);
    LOG.debug(outputString);
  }
  WSSConfig wssConfig=WSSConfig.getNewInstance();
  RequestData data=new RequestData();
  data.setWssConfig(wssConfig);
  data.setCallbackHandler(callbackHandler);
  data.setTimestampReplayCache(new MemoryReplayCache());
  verify(createdDoc,wssConfig,data);
  try {
    verify(createdDoc,wssConfig,data);
    fail("Expected failure on a replay attack");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEhCacheReplayedTimestamp() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecTimestamp timestamp=new WSSecTimestamp();
  timestamp.setTimeToLive(300);
  Document createdDoc=timestamp.build(doc,secHeader);
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSEncryptionPart encP=new WSEncryptionPart("Timestamp",WSConstants.WSU_NS,"");
  builder.getParts().add(encP);
  builder.prepare(createdDoc,crypto,secHeader);
  List<javax.xml.crypto.dsig.Reference> referenceList=builder.addReferencesToSign(builder.getParts(),secHeader);
  builder.computeSignature(referenceList,false,null);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(createdDoc);
    LOG.debug(outputString);
  }
  WSSConfig wssConfig=WSSConfig.getNewInstance();
  RequestData data=new RequestData();
  data.setWssConfig(wssConfig);
  data.setCallbackHandler(callbackHandler);
  verify(createdDoc,wssConfig,data);
  try {
    verify(createdDoc,wssConfig,data);
    fail("Expected failure on a replay attack");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.RequireSignedEncryptedDataElementsTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptedKeyRefAndDuplicatedEncDataAfterWsseWrapperBody() throws Exception {
  Document encryptedSignedDoc=getRequestDocumentEncryptionFirst();
  TestMessageTransformer.duplicateEncryptedDataAfterWrapperBody(encryptedSignedDoc.getDocumentElement());
  RequestData reqData=getRequestData(true);
  try {
    verify(encryptedSignedDoc,reqData);
    fail("WSSecurityException expected");
  }
 catch (  WSSecurityException e) {
    assertTrue(e.getMessage().contains("is not signed"));
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptedKeyRefAndDuplicatedEncDataInWsseWrapperBody() throws Exception {
  Document encryptedSignedDoc=getRequestDocumentEncryptionFirst();
  RequestData reqData=getRequestData(false);
  TestMessageTransformer.duplicateEncryptedDataInWrapperBody(encryptedSignedDoc.getDocumentElement());
  try {
    verify(encryptedSignedDoc,reqData);
    fail("WSSecurityException expected");
  }
 catch (  WSSecurityException e) {
    assertTrue(e.getMessage().contains("The signature or decryption was invalid"));
  }
  encryptedSignedDoc=getRequestDocumentEncryptionFirst();
  TestMessageTransformer.duplicateEncryptedDataInWrapperBody(encryptedSignedDoc.getDocumentElement());
  reqData=getRequestData(true);
  try {
    verify(encryptedSignedDoc,reqData);
    fail("WSSecurityException expected");
  }
 catch (  WSSecurityException e) {
    assertTrue(e.getMessage().contains("is not signed"));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.SKISignatureTest </h4><pre class="type-3 type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that signs and verifies a WS-Security envelope using SubjectKeyIdentifier.
 * This test uses the SubjectKeyIdentifier to identify the certificate. It
 * uses the Direct version, that is it embeds the certificate in the message.
 * <p/>
 * @throws java.lang.Exception Thrown when there is any problem in signing or verification
 */
@Test public void testX509SignatureDSA_SKI() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("wss40DSA","security");
  builder.setKeyIdentifierType(WSConstants.SKI_KEY_IDENTIFIER);
  builder.setSignatureAlgorithm(WSConstants.DSA);
  LOG.info("Before SigningDSA_SKIDirect....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed message with DSA_SKI key identifier:");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  LOG.info("After SigningDSA_SKIDirect....");
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertNotNull(actionResult.get(WSSecurityEngineResult.TAG_X509_CERTIFICATE));
  assertNotNull(actionResult.get(WSSecurityEngineResult.TAG_X509_REFERENCE_TYPE));
  REFERENCE_TYPE referenceType=(REFERENCE_TYPE)actionResult.get(WSSecurityEngineResult.TAG_X509_REFERENCE_TYPE);
  assertTrue(referenceType == REFERENCE_TYPE.KEY_IDENTIFIER);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.SecurityContextTokenTest </h4><pre class="type-3 type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBuild(){
  try {
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    WSSecSecurityContextToken sctBuilder=new WSSecSecurityContextToken();
    sctBuilder.prepare(doc,crypto);
    sctBuilder.prependSCTElementToHeader(doc,secHeader);
    String out=XMLUtils.prettyDocumentToString(doc);
    if (LOG.isDebugEnabled()) {
      LOG.debug(out);
    }
    assertTrue("SecurityContextToken missing",out.indexOf(ConversationConstants.SECURITY_CONTEXT_TOKEN_LN) > 0);
    assertTrue("wsc:Identifier missing",out.indexOf(ConversationConstants.IDENTIFIER_LN) > 0);
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test encryption using a derived key which is based on a secret associated
 * with a security context token
 */
@Test public void testSCTDKTEncrypt(){
  try {
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    WSSecSecurityContextToken sctBuilder=new WSSecSecurityContextToken();
    sctBuilder.prepare(doc,crypto);
    byte[] tempSecret=WSSecurityUtil.generateNonce(16);
    callbackHandler.addSecretKey(sctBuilder.getIdentifier(),tempSecret);
    String tokenId=sctBuilder.getSctId();
    WSSecDKEncrypt encrBuilder=new WSSecDKEncrypt();
    encrBuilder.setSymmetricEncAlgorithm(WSConstants.AES_128);
    encrBuilder.setExternalKey(tempSecret,tokenId);
    encrBuilder.build(doc,secHeader);
    sctBuilder.prependSCTElementToHeader(doc,secHeader);
    if (LOG.isDebugEnabled()) {
      String out=XMLUtils.prettyDocumentToString(doc);
      LOG.debug(out);
    }
    WSHandlerResult results=verify(doc);
    WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.SCT).get(0);
    SecurityContextToken receivedToken=(SecurityContextToken)actionResult.get(WSSecurityEngineResult.TAG_SECURITY_CONTEXT_TOKEN);
    assertTrue(receivedToken != null);
    assertTrue(WSConstants.WSC_SCT_05_12.equals(receivedToken.getTokenType()));
    SecurityContextToken clone=new SecurityContextToken(receivedToken.getElement());
    assertTrue(clone.equals(receivedToken));
    assertTrue(clone.hashCode() == receivedToken.hashCode());
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSCTKDKTSign(){
  try {
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    WSSecSecurityContextToken sctBuilder=new WSSecSecurityContextToken();
    sctBuilder.setWscVersion(ConversationConstants.VERSION_05_12);
    sctBuilder.prepare(doc,crypto);
    byte[] tempSecret=WSSecurityUtil.generateNonce(16);
    callbackHandler.addSecretKey(sctBuilder.getIdentifier(),tempSecret);
    String tokenId=sctBuilder.getSctId();
    WSSecDKSign sigBuilder=new WSSecDKSign();
    sigBuilder.setExternalKey(tempSecret,tokenId);
    sigBuilder.setSignatureAlgorithm(WSConstants.HMAC_SHA1);
    sigBuilder.build(doc,secHeader);
    sctBuilder.prependSCTElementToHeader(doc,secHeader);
    if (LOG.isDebugEnabled()) {
      String out=XMLUtils.prettyDocumentToString(doc);
      LOG.debug(out);
    }
    WSHandlerResult results=verify(doc);
    WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.SCT).get(0);
    SecurityContextToken receivedToken=(SecurityContextToken)actionResult.get(WSSecurityEngineResult.TAG_SECURITY_CONTEXT_TOKEN);
    assertTrue(receivedToken != null);
    assertTrue(WSConstants.WSC_SCT_05_12.equals(receivedToken.getTokenType()));
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.SignatureAlgorithmSuiteTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSymmetricKey() throws Exception {
  KeyGenerator keyGen=KeyGenerator.getInstance("AES");
  keyGen.init(128);
  SecretKey key=keyGen.generateKey();
  byte[] keyData=key.getEncoded();
  WSSecSignature builder=new WSSecSignature();
  builder.setKeyIdentifierType(WSConstants.ENCRYPTED_KEY_SHA1_IDENTIFIER);
  builder.setSecretKey(keyData);
  builder.setSignatureAlgorithm(SignatureMethod.HMAC_SHA1);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  byte[] encodedBytes=KeyUtils.generateDigest(keyData);
  String identifier=Base64.encode(encodedBytes);
  SecretKeyCallbackHandler secretKeyCallbackHandler=new SecretKeyCallbackHandler();
  secretKeyCallbackHandler.addSecretKey(identifier,keyData);
  Element securityHeader=WSSecurityUtil.getSecurityHeader(signedDoc,null);
  AlgorithmSuite algorithmSuite=createAlgorithmSuite();
  WSSecurityEngine secEngine=new WSSecurityEngine();
  RequestData data=new RequestData();
  SignatureActionToken actionToken=new SignatureActionToken();
  actionToken.setCrypto(crypto);
  data.setSignatureToken(actionToken);
  data.setCallbackHandler(secretKeyCallbackHandler);
  data.setAlgorithmSuite(algorithmSuite);
  try {
    secEngine.processSecurityHeader(securityHeader,data);
    fail("Expected failure as HMAC-SHA1 is not allowed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  algorithmSuite.addSignatureMethod(WSConstants.HMAC_SHA1);
  secEngine.processSecurityHeader(securityHeader,data);
  algorithmSuite.setMinimumSymmetricKeyLength(256);
  try {
    secEngine.processSecurityHeader(securityHeader,data);
    fail("Expected failure as a 128 bit key is not allowed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  algorithmSuite.setMinimumSymmetricKeyLength(64);
  algorithmSuite.setMaximumSymmetricKeyLength(120);
  try {
    secEngine.processSecurityHeader(securityHeader,data);
    fail("Expected failure as a 128 bit key is not allowed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignature() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  builder.setSignatureAlgorithm(WSConstants.RSA_SHA1);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  Element securityHeader=WSSecurityUtil.getSecurityHeader(signedDoc,null);
  AlgorithmSuite algorithmSuite=createAlgorithmSuite();
  verify(securityHeader,algorithmSuite,crypto);
  algorithmSuite.setMinimumAsymmetricKeyLength(1024);
  try {
    verify(securityHeader,algorithmSuite,crypto);
    fail("Expected failure as 512-bit keys are not allowed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureMethodDSA() throws Exception {
  Crypto dsaCrypto=CryptoFactory.getInstance("wss40.properties");
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("wss40DSA","security");
  builder.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  builder.setSignatureAlgorithm(WSConstants.DSA);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,dsaCrypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  Element securityHeader=WSSecurityUtil.getSecurityHeader(signedDoc,null);
  AlgorithmSuite algorithmSuite=createAlgorithmSuite();
  try {
    verify(securityHeader,algorithmSuite,dsaCrypto);
    fail("Expected failure as DSA is not allowed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  algorithmSuite.addSignatureMethod(WSConstants.DSA);
  verify(securityHeader,algorithmSuite,dsaCrypto);
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testC14nMethod() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  builder.setSignatureAlgorithm(WSConstants.RSA_SHA1);
  builder.setSigCanonicalization(WSConstants.C14N_EXCL_WITH_COMMENTS);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  Element securityHeader=WSSecurityUtil.getSecurityHeader(signedDoc,null);
  AlgorithmSuite algorithmSuite=createAlgorithmSuite();
  try {
    verify(securityHeader,algorithmSuite,crypto);
    fail("Expected failure as C14n algorithm is not allowed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  algorithmSuite.addC14nAlgorithm(WSConstants.C14N_EXCL_WITH_COMMENTS);
  verify(securityHeader,algorithmSuite,crypto);
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDigestMethod() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  builder.setSignatureAlgorithm(WSConstants.RSA_SHA1);
  builder.setDigestAlgo(WSConstants.SHA256);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  Element securityHeader=WSSecurityUtil.getSecurityHeader(signedDoc,null);
  AlgorithmSuite algorithmSuite=createAlgorithmSuite();
  try {
    verify(securityHeader,algorithmSuite,crypto);
    fail("Expected failure as Digest algorithm is not allowed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  algorithmSuite.addDigestAlgorithm(WSConstants.SHA256);
  verify(securityHeader,algorithmSuite,crypto);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.SignatureCRLTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test signing a SOAP message using a BST. Revocation is enabled and so the test
 * should fail. The trust store that is used is the keystore that contains the revoked
 * certificate. See WSS-341:
 * https://issues.apache.org/jira/browse/WSS-341
 * TODO Re-enable once CRL issue fixed
 */
@Test @org.junit.Ignore public void testSignatureDirectReferenceRevocationKeyStore() throws Exception {
  WSSecSignature sign=new WSSecSignature();
  sign.setUserInfo("wss40rev","security");
  sign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=sign.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  try {
    verify(signedDoc,crypto,true);
    fail("Failure expected on a revoked certificate");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test signing a SOAP message using a BST. Revocation is enabled and so the test
 * should fail.
 * TODO Re-enable once CRL issue fixed
 */
@Test @org.junit.Ignore public void testSignatureDirectReferenceRevocation() throws Exception {
  WSSecSignature sign=new WSSecSignature();
  sign.setUserInfo("wss40rev","security");
  sign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=sign.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  try {
    verify(signedDoc,cryptoCA,true);
    fail("Failure expected on a revoked certificate");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.SignatureCertConstraintsTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * The test uses the BinarySecurityToken key identifier type.
 */
@Test public void testBSTSignaturePKIPath() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("wss40","security");
  builder.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  builder.setUseSingleCertificate(false);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed message with BST key identifier:");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  Element securityHeader=WSSecurityUtil.getSecurityHeader(signedDoc,null);
  String certConstraint=".*CN=Colm.*O=Apache.*";
  verify(securityHeader,cryptoCA,certConstraint);
  certConstraint=".*CN=Colm2.*O=Apache.*";
  try {
    verify(securityHeader,cryptoCA,certConstraint);
    fail("Failure expected on a bad cert constraint");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * The test uses the BinarySecurityToken key identifier type.
 */
@Test public void testBSTSignature() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("wss40","security");
  builder.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed message with BST key identifier:");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  Element securityHeader=WSSecurityUtil.getSecurityHeader(signedDoc,null);
  String certConstraint=".*CN=Colm.*O=Apache.*";
  verify(securityHeader,cryptoCA,certConstraint);
  certConstraint=".*CN=Colm2.*O=Apache.*";
  try {
    verify(securityHeader,cryptoCA,certConstraint);
    fail("Failure expected on a bad cert constraint");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.SignatureCertTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test signing a SOAP message using Issuer Serial. Note that this should fail, as the
 * trust-store does not contain the cert corresponding to wss40, only the CA cert
 * wss40CA.
 */
@Test public void testSignatureIssuerSerial() throws Exception {
  WSSecSignature sign=new WSSecSignature();
  sign.setUserInfo("wss40","security");
  sign.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=sign.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  try {
    verify(signedDoc,cryptoCA);
    fail("Failure expected on issuer serial");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_CHECK);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test signing a SOAP message using a BST. The signature verification passes, but the trust
 * verification will fail as the CA cert is out of date.
 */
@Test public void testSignatureBadCACert() throws Exception {
  WSSecSignature sign=new WSSecSignature();
  sign.setUserInfo("wss4jcertdsa","security");
  sign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=sign.build(doc,CryptoFactory.getInstance("wss40badca.properties"),secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  try {
    verify(signedDoc,CryptoFactory.getInstance("wss40badcatrust.properties"));
    fail("Failure expected on bad CA cert!");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExpiredCertInKeystore() throws Exception {
  Properties clientProperties=new Properties();
  clientProperties.put("org.apache.wss4j.crypto.provider","org.apache.wss4j.common.crypto.Merlin");
  clientProperties.put("org.apache.wss4j.crypto.merlin.keystore.type","jks");
  clientProperties.put("org.apache.wss4j.crypto.merlin.keystore.password","security");
  clientProperties.put("org.apache.wss4j.crypto.merlin.keystore.alias","wss40exp");
  clientProperties.put("org.apache.wss4j.crypto.merlin.keystore.file","keys/wss40exp.jks");
  Crypto clientCrypto=new Merlin(clientProperties,this.getClass().getClassLoader(),null);
  WSSecSignature sign=new WSSecSignature();
  sign.setUserInfo("wss40exp","security");
  sign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=sign.build(doc,clientCrypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSSecurityEngine newEngine=new WSSecurityEngine();
  try {
    newEngine.processSecurityHeader(doc,null,null,clientCrypto);
    fail("Failure expected on an expired cert");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_CHECK);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExpiredCert() throws Exception {
  Properties clientProperties=new Properties();
  clientProperties.put("org.apache.wss4j.crypto.provider","org.apache.wss4j.common.crypto.Merlin");
  clientProperties.put("org.apache.wss4j.crypto.merlin.keystore.type","jks");
  clientProperties.put("org.apache.wss4j.crypto.merlin.keystore.password","security");
  clientProperties.put("org.apache.wss4j.crypto.merlin.keystore.alias","wss40exp");
  clientProperties.put("org.apache.wss4j.crypto.merlin.keystore.file","keys/wss40exp.jks");
  Crypto clientCrypto=new Merlin(clientProperties,this.getClass().getClassLoader(),null);
  WSSecSignature sign=new WSSecSignature();
  sign.setUserInfo("wss40exp","security");
  sign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=sign.build(doc,clientCrypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSSecurityEngine newEngine=new WSSecurityEngine();
  try {
    newEngine.processSecurityHeader(doc,null,null,cryptoCA);
    fail("Failure expected on an expired cert");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.SignatureEncryptionTest </h4><pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that encrypts and then signs a WS-Security envelope (including the
 * encrypted element), then performs verification and decryption <p/>
 * @throws ExceptionThrown when there is any problem in signing, encryption,
 * decryption, or verification
 */
@SuppressWarnings("unchecked") @Test public void testEncryptionElementSigning() throws Exception {
  WSSecEncrypt encrypt=new WSSecEncrypt();
  WSSecSignature sign=new WSSecSignature();
  encrypt.setUserInfo("wss40");
  sign.setUserInfo("wss40","security");
  LOG.info("Before Encryption....");
  Document doc=SOAPUtil.toSOAPPart(SOAPMSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart part=new WSEncryptionPart("add","http://ws.apache.org/counter/counter_port_type","Element");
  encrypt.getParts().add(part);
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("After Encryption....");
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  WSEncryptionPart signPart=new WSEncryptionPart(WSConstants.ENC_DATA_LN,WSConstants.ENC_NS,"Element");
  sign.getParts().add(signPart);
  Document encryptedSignedDoc=sign.build(encryptedDoc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("After Signing....");
    String outputString=XMLUtils.prettyDocumentToString(encryptedSignedDoc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(encryptedSignedDoc);
  List<WSSecurityEngineResult> sigSecEngResults=results.getActionResults().get(WSConstants.SIGN);
  List<WSSecurityEngineResult> encSecEngResults=results.getActionResults().get(WSConstants.ENCR);
  assertEquals(1,sigSecEngResults.size());
  assertEquals(1,encSecEngResults.size());
  List<WSDataRef> sigDataRefs=(List<WSDataRef>)(sigSecEngResults.get(0)).get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  List<WSDataRef> encDataRefs=(List<WSDataRef>)(encSecEngResults.get(0)).get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertNotNull(sigDataRefs);
  assertNotNull(encDataRefs);
  assertEquals(1,sigDataRefs.size());
  assertEquals(1,encDataRefs.size());
  assertNull(sigDataRefs.get(0).getProtectedElement().getAttributeNodeNS(WSConstants.WSU_NS,"Id"));
  assertTrue(sigDataRefs.get(0).getWsuId().contains(encDataRefs.get(0).getWsuId()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.SignatureKeyValueTest </h4><pre class="type-3 type-8 type-7 type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Failed RSAKeyValue test, where a message is signed using a key-pair which doesn't
 * correspond to the public key in the "trust"-store.
 */
@Test public void testBadRSAKeyValue() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("wss86","security");
  builder.setKeyIdentifierType(WSConstants.KEY_VALUE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,CryptoFactory.getInstance("wss86.properties"),secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains("RSAKeyValue"));
  try {
    WSSecurityEngine secEngine=new WSSecurityEngine();
    RequestData data=new RequestData();
    data.setSigVerCrypto(crypto);
    data.setIgnoredBSPRules(Collections.singletonList(BSPRule.R5417));
    secEngine.processSecurityHeader(signedDoc,data);
    fail("Failure expected on bad public key");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.SignaturePartsTest </h4><pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test getting a DOM Element from WSEncryptionPart directly
 */
@Test public void testSignaturePartDOMElement() throws Exception {
  WSSecSignature sign=new WSSecSignature();
  sign.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  sign.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  Document doc=SOAPUtil.toSOAPPart(SOAPMSG);
  SOAPConstants soapConstants=WSSecurityUtil.getSOAPConstants(doc.getDocumentElement());
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart encP=new WSEncryptionPart("Incorrect Localname","Incorrect N/S","");
  Element bodyElement=WSSecurityUtil.findBodyElement(doc);
  assertTrue(bodyElement != null && "Body".equals(bodyElement.getLocalName()));
  encP.setElement(bodyElement);
  sign.getParts().add(encP);
  Document signedDoc=sign.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  @SuppressWarnings("unchecked") final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  WSDataRef wsDataRef=refs.get(0);
  QName bodyName=new QName(soapConstants.getEnvelopeURI(),"Body");
  assertEquals(bodyName,wsDataRef.getName());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test signing a custom SOAP header
 */
@SuppressWarnings("unchecked") @Test public void testSOAPHeader() throws Exception {
  WSSecSignature sign=new WSSecSignature();
  sign.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  sign.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  Document doc=SOAPUtil.toSOAPPart(SOAPMSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart encP=new WSEncryptionPart("foobar","urn:foo.bar","");
  sign.getParts().add(encP);
  Document signedDoc=sign.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/soapenv:Envelope/soapenv:Header/foo:foobar",xpath);
  assertEquals(WSConstants.RSA_SHA1,wsDataRef.getAlgorithm());
  assertNotNull(wsDataRef.getDigestValue());
  assertTrue(wsDataRef.getDigestValue().length > 0);
  QName expectedQName=new QName("urn:foo.bar","foobar");
  assertEquals(expectedQName,wsDataRef.getName());
  assertEquals(WSConstants.SHA1,wsDataRef.getDigestAlgorithm());
  String sigMethod=(String)actionResult.get(WSSecurityEngineResult.TAG_SIGNATURE_METHOD);
  assertEquals(WSConstants.RSA_SHA1,sigMethod);
  String c14nMethod=(String)actionResult.get(WSSecurityEngineResult.TAG_CANONICALIZATION_METHOD);
  assertEquals(WSConstants.C14N_EXCL_OMIT_COMMENTS,c14nMethod);
  List<String> transformAlgorithms=wsDataRef.getTransformAlgorithms();
  assertTrue(transformAlgorithms.size() == 1);
  assertTrue(WSConstants.C14N_EXCL_OMIT_COMMENTS.equals(transformAlgorithms.get(0)));
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test signing of a header through a STR Dereference Transform
 */
@SuppressWarnings("unchecked") @Test public void testSOAPHeaderSTRTransform() throws Exception {
  Crypto issuerCrypto=new Merlin();
  KeyStore keyStore=KeyStore.getInstance(KeyStore.getDefaultType());
  ClassLoader loader=Loader.getClassLoader(SignedSamlTokenHOKTest.class);
  InputStream input=Merlin.loadInputStream(loader,"keys/wss40_server.jks");
  keyStore.load(input,"security".toCharArray());
  ((Merlin)issuerCrypto).setKeyStore(keyStore);
  Crypto userCrypto=CryptoFactory.getInstance("wss40.properties");
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  samlCallback.setIssuer("www.example.com");
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  wsSign.setUserInfo("wss40","security");
  Document doc=SOAPUtil.toSOAPPart(SOAPMSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart encP=new WSEncryptionPart("STRTransform","","Element");
  wsSign.getParts().add(encP);
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML message (key holder):");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  Crypto trustCrypto=new Merlin();
  KeyStore trustStore=KeyStore.getInstance(KeyStore.getDefaultType());
  input=Merlin.loadInputStream(loader,"keys/wss40CA.jks");
  trustStore.load(input,"security".toCharArray());
  ((Merlin)trustCrypto).setTrustStore(trustStore);
  WSHandlerResult results=secEngine.processSecurityHeader(doc,null,null,trustCrypto);
  WSSecurityEngineResult stUnsignedActionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)stUnsignedActionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  WSSecurityEngineResult signActionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(signActionResult != null);
  assertFalse(signActionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)signActionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/soapenv:Envelope/soapenv:Header/wsse:Security/saml1:Assertion",xpath);
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRequiredSOAPHeaderNotPresent() throws Exception {
  WSSecSignature sign=new WSSecSignature();
  sign.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  sign.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart encP=new WSEncryptionPart("foobar","urn:foo.bar","");
  sign.getParts().add(encP);
  String soapNamespace=WSSecurityUtil.getSOAPNamespace(doc.getDocumentElement());
  encP=new WSEncryptionPart(WSConstants.ELEM_BODY,soapNamespace,"Content");
  sign.getParts().add(encP);
  try {
    sign.build(doc,crypto,secHeader);
    fail("Failure expected on not signing a required element");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_SIGNATURE);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test signing a custom SOAP header with a bad localname
 */
@Test public void testBadLocalname() throws Exception {
  WSSecSignature sign=new WSSecSignature();
  sign.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  sign.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  Document doc=SOAPUtil.toSOAPPart(SOAPMSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart encP=new WSEncryptionPart("foobar2","urn:foo.bar","");
  sign.getParts().add(encP);
  try {
    sign.build(doc,crypto,secHeader);
    fail("Failure expected on a bad localname");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_SIGNATURE);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test signing a custom SOAP header with a bad namespace
 */
@Test public void testBadNamespace() throws Exception {
  WSSecSignature sign=new WSSecSignature();
  sign.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  sign.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  Document doc=SOAPUtil.toSOAPPart(SOAPMSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart encP=new WSEncryptionPart("foobar","urn:foo.bar2","");
  sign.getParts().add(encP);
  try {
    sign.build(doc,crypto,secHeader);
    fail("Failure expected on a bad namespace");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_SIGNATURE);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.SignatureTest </h4><pre class="type-3 type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that signs and verifies a WS-Security envelope.
 * The test uses the ThumbprintSHA1 key identifier type.
 * <p/>
 * @throws java.lang.Exception Thrown when there is any problem in signing or verification
 */
@Test public void testX509SignatureThumb() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.setKeyIdentifierType(WSConstants.THUMBPRINT_IDENTIFIER);
  LOG.info("Before Signing ThumbprintSHA1....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed message with ThumbprintSHA1 key identifier:");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  LOG.info("After Signing ThumbprintSHA1....");
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertNotNull(actionResult.get(WSSecurityEngineResult.TAG_X509_CERTIFICATE));
  assertNotNull(actionResult.get(WSSecurityEngineResult.TAG_X509_REFERENCE_TYPE));
  REFERENCE_TYPE referenceType=(REFERENCE_TYPE)actionResult.get(WSSecurityEngineResult.TAG_X509_REFERENCE_TYPE);
  assertTrue(referenceType == REFERENCE_TYPE.THUMBPRINT_SHA1);
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that signs and verifies a WS-Security envelope
 * <p/>
 * @throws java.lang.Exception Thrown when there is any problem in signing or verification
 */
@Test public void testSignatureInclusiveC14N() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setSigCanonicalization(WSConstants.C14N_OMIT_COMMENTS);
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  LOG.info("Before Signing....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("After Signing....");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSSecurityEngine newEngine=new WSSecurityEngine();
  try {
    newEngine.processSecurityHeader(doc,null,null,crypto);
    fail("Failure expected on a bad c14n algorithm");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  RequestData data=new RequestData();
  data.setSigVerCrypto(crypto);
  List<BSPRule> ignoredRules=new ArrayList<>();
  ignoredRules.add(BSPRule.R5404);
  ignoredRules.add(BSPRule.R5406);
  data.setIgnoredBSPRules(ignoredRules);
  newEngine.processSecurityHeader(doc,data);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that signs and verifies a WS-Security envelope
 * <p/>
 * @throws java.lang.Exception Thrown when there is any problem in signing or verification
 */
@Test public void testBSTSignature() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  LOG.info("Before Signing....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("After Signing....");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertNotNull(actionResult.get(WSSecurityEngineResult.TAG_X509_CERTIFICATE));
  assertNotNull(actionResult.get(WSSecurityEngineResult.TAG_X509_REFERENCE_TYPE));
  REFERENCE_TYPE referenceType=(REFERENCE_TYPE)actionResult.get(WSSecurityEngineResult.TAG_X509_REFERENCE_TYPE);
  assertTrue(referenceType == REFERENCE_TYPE.DIRECT_REF);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * The test uses the Issuer Serial key identifier type.
 * <p/>
 * @throws java.lang.Exception Thrown when there is any problem in signing or verification
 */
@Test public void testX509SignatureIS() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  LOG.info("Before Signing IS....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed message with IssuerSerial key identifier:");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  LOG.info("After Signing IS....");
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertNotNull(actionResult.get(WSSecurityEngineResult.TAG_X509_CERTIFICATE));
  assertNotNull(actionResult.get(WSSecurityEngineResult.TAG_X509_REFERENCE_TYPE));
  REFERENCE_TYPE referenceType=(REFERENCE_TYPE)actionResult.get(WSSecurityEngineResult.TAG_X509_REFERENCE_TYPE);
  assertTrue(referenceType == REFERENCE_TYPE.ISSUER_SERIAL);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testX509SignatureISAttached() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  builder.setIncludeSignatureToken(true);
  LOG.info("Before Signing IS....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed message with IssuerSerial key identifier:");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  LOG.info("After Signing IS....");
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertNotNull(actionResult.get(WSSecurityEngineResult.TAG_X509_CERTIFICATE));
  assertNotNull(actionResult.get(WSSecurityEngineResult.TAG_X509_REFERENCE_TYPE));
  REFERENCE_TYPE referenceType=(REFERENCE_TYPE)actionResult.get(WSSecurityEngineResult.TAG_X509_REFERENCE_TYPE);
  assertTrue(referenceType == REFERENCE_TYPE.ISSUER_SERIAL);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testX509SignatureThumbAttached() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.setKeyIdentifierType(WSConstants.THUMBPRINT_IDENTIFIER);
  builder.setIncludeSignatureToken(true);
  LOG.info("Before Signing ThumbprintSHA1....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed message with ThumbprintSHA1 key identifier:");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  LOG.info("After Signing ThumbprintSHA1....");
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertNotNull(actionResult.get(WSSecurityEngineResult.TAG_X509_CERTIFICATE));
  assertNotNull(actionResult.get(WSSecurityEngineResult.TAG_X509_REFERENCE_TYPE));
  REFERENCE_TYPE referenceType=(REFERENCE_TYPE)actionResult.get(WSSecurityEngineResult.TAG_X509_REFERENCE_TYPE);
  assertTrue(referenceType == REFERENCE_TYPE.THUMBPRINT_SHA1);
}

</code></pre>

<br>
<pre class="type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that signs and verifies a WS-Security envelope
 * <p/>
 * @throws java.lang.Exception Thrown when there is any problem in signing or verification
 */
@Test public void testX509Signature() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.setKeyIdentifierType(WSConstants.X509_KEY_IDENTIFIER);
  LOG.info("Before Signing....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("After Signing....");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSSecurityEngine newEngine=new WSSecurityEngine();
  WSHandlerResult results=newEngine.processSecurityHeader(doc,null,null,crypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertNotNull(actionResult.get(WSSecurityEngineResult.TAG_X509_CERTIFICATE));
  assertNotNull(actionResult.get(WSSecurityEngineResult.TAG_X509_REFERENCE_TYPE));
  REFERENCE_TYPE referenceType=(REFERENCE_TYPE)actionResult.get(WSSecurityEngineResult.TAG_X509_REFERENCE_TYPE);
  assertTrue(referenceType == REFERENCE_TYPE.KEY_IDENTIFIER);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.TimestampTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing multiple Timestamps in the security header
 */
@Test public void testMultipleTimestamps() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecTimestamp timestamp=new WSSecTimestamp();
  timestamp.setTimeToLive(300);
  Document createdDoc=timestamp.build(doc,secHeader);
  timestamp=new WSSecTimestamp();
  timestamp.setTimeToLive(60);
  createdDoc=timestamp.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(createdDoc);
    LOG.debug(outputString);
  }
  try {
    verify(createdDoc);
    fail("Expected failure on multiple timestamps");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  verify(createdDoc,Collections.singletonList(BSPRule.R3227));
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test to create a "Spoofed" Timestamp (see WSS-441)
 */
@Test public void testSpoofedTimestamp() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecTimestamp timestamp=new WSSecTimestamp();
  timestamp.setTimeToLive(300);
  WSTimeSource spoofedTimeSource=new WSTimeSource(){
    public Date now(){
      Date currentTime=new Date();
      currentTime.setTime(currentTime.getTime() - (500L * 1000L));
      return currentTime;
    }
  }
;
  timestamp.setWsTimeSource(spoofedTimeSource);
  Document createdDoc=timestamp.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(createdDoc);
    LOG.debug(outputString);
  }
  try {
    verify(createdDoc);
    fail("Expected failure on an expired timestamp");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.MESSAGE_EXPIRED);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing an "old" Timestamp, i.e. one with a "Created" element that is
 * out of date
 */
@Test public void testOldTimestamp() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecTimestamp timestamp=new WSSecTimestamp();
  Document createdDoc=timestamp.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(createdDoc);
    LOG.debug(outputString);
  }
  RequestData requestData=new RequestData();
  requestData.setWssConfig(WSSConfig.getNewInstance());
  requestData.setTimeStampTTL(-1);
  try {
    verify(createdDoc,requestData);
    fail("The timestamp validation should have failed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.MESSAGE_EXPIRED);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing an Timestamp where it contains multiple "Expires" elements.
 * This Timestamp should be rejected.
 */
@Test public void testMultipleExpires() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Element timestampElement=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.TIMESTAMP_TOKEN_LN);
  DateFormat zulu=new XmlSchemaDateFormat();
  Element elementCreated=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.CREATED_LN);
  Date createdDate=new Date();
  long currentTime=createdDate.getTime();
  createdDate.setTime(currentTime);
  elementCreated.appendChild(doc.createTextNode(zulu.format(createdDate)));
  timestampElement.appendChild(elementCreated);
  zulu=new XmlSchemaDateFormat();
  Element elementExpires=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.EXPIRES_LN);
  createdDate.setTime(currentTime + 300000);
  elementExpires.appendChild(doc.createTextNode(zulu.format(createdDate)));
  timestampElement.appendChild(elementExpires);
  timestampElement.appendChild(elementExpires.cloneNode(true));
  secHeader.getSecurityHeader().appendChild(timestampElement);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  try {
    verify(doc);
    fail("The timestamp validation should have failed on multiple Expires elements");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  verify(doc,Collections.singletonList(BSPRule.R3224));
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing an Timestamp where the "Created" element is in the (near)
 * future. It should be accepted by default when it is created 30 seconds in the future,
 * and then rejected once we configure "0 seconds" for future-time-to-live.
 */
@Test public void testNearFutureCreated() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Element timestampElement=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.TIMESTAMP_TOKEN_LN);
  DateFormat zulu=new XmlSchemaDateFormat();
  Element elementCreated=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.CREATED_LN);
  Date createdDate=new Date();
  long currentTime=createdDate.getTime() + 30000;
  createdDate.setTime(currentTime);
  elementCreated.appendChild(doc.createTextNode(zulu.format(createdDate)));
  timestampElement.appendChild(elementCreated);
  secHeader.getSecurityHeader().appendChild(timestampElement);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  RequestData requestData=new RequestData();
  requestData.setWssConfig(WSSConfig.getNewInstance());
  requestData.setTimeStampFutureTTL(0);
  try {
    verify(doc,requestData);
    fail("The timestamp validation should have failed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.MESSAGE_EXPIRED);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing an Timestamp where it contains a CustomElement. This should
 * be rejected as per the BSP spec.
 */
@Test public void testCustomElement() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Element timestampElement=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.TIMESTAMP_TOKEN_LN);
  DateFormat zulu=new XmlSchemaDateFormat();
  Element elementCreated=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.CREATED_LN);
  Date createdDate=new Date();
  elementCreated.appendChild(doc.createTextNode(zulu.format(createdDate)));
  timestampElement.appendChild(elementCreated);
  Element elementExpires=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.EXPIRES_LN);
  createdDate.setTime(createdDate.getTime() + 300000);
  elementExpires.appendChild(doc.createTextNode(zulu.format(createdDate)));
  timestampElement.appendChild(elementExpires);
  Element elementCustom=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + "Custom");
  timestampElement.appendChild(elementCustom);
  secHeader.getSecurityHeader().appendChild(timestampElement);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  try {
    verify(doc);
    fail("The timestamp validation should have failed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  verify(doc,Collections.singletonList(BSPRule.R3222));
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing an Timestamp where it contains no "Created" element.
 * This Timestamp should be rejected.
 */
@Test public void testNoCreated() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Element timestampElement=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.TIMESTAMP_TOKEN_LN);
  DateFormat zulu=new XmlSchemaDateFormat();
  Element elementCreated=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.EXPIRES_LN);
  Date createdDate=new Date();
  long currentTime=createdDate.getTime() + 300000;
  createdDate.setTime(currentTime);
  elementCreated.appendChild(doc.createTextNode(zulu.format(createdDate)));
  timestampElement.appendChild(elementCreated);
  secHeader.getSecurityHeader().appendChild(timestampElement);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  try {
    verify(doc);
    fail("The timestamp validation should have failed on no Created element");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  List<BSPRule> rules=new ArrayList<>();
  rules.add(BSPRule.R3203);
  rules.add(BSPRule.R3221);
  verify(doc,rules);
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing an expired Timestamp.
 */
@Test public void testExpiredTimestamp() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecTimestamp timestamp=new WSSecTimestamp();
  timestamp.setTimeToLive(-1);
  Document createdDoc=timestamp.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(createdDoc);
    LOG.debug(outputString);
  }
  try {
    verify(createdDoc);
    fail("Expected failure on an expired timestamp");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.MESSAGE_EXPIRED);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing an Timestamp where the "Created" element is in the future.
 * A Timestamp that is 120 seconds in the future should be rejected by default.
 */
@Test public void testFutureCreated() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Element timestampElement=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.TIMESTAMP_TOKEN_LN);
  DateFormat zulu=new XmlSchemaDateFormat();
  Element elementCreated=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.CREATED_LN);
  Date createdDate=new Date();
  long currentTime=createdDate.getTime() + 120000;
  createdDate.setTime(currentTime);
  elementCreated.appendChild(doc.createTextNode(zulu.format(createdDate)));
  timestampElement.appendChild(elementCreated);
  secHeader.getSecurityHeader().appendChild(timestampElement);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  try {
    verify(doc);
    fail("The timestamp validation should have failed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.MESSAGE_EXPIRED);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing an Timestamp where it contains an "Expires" element before
 * the Created element. This Timestamp should be rejected as per the BSP spec.
 */
@Test public void testExpiresInFrontOfCreated() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Element timestampElement=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.TIMESTAMP_TOKEN_LN);
  DateFormat zulu=new XmlSchemaDateFormat();
  Element elementCreated=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.EXPIRES_LN);
  Date expiresDate=new Date();
  long currentTime=expiresDate.getTime() + 300000;
  expiresDate.setTime(currentTime);
  elementCreated.appendChild(doc.createTextNode(zulu.format(expiresDate)));
  timestampElement.appendChild(elementCreated);
  Element elementExpires=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.CREATED_LN);
  elementExpires.appendChild(doc.createTextNode(zulu.format(new Date())));
  timestampElement.appendChild(elementExpires);
  secHeader.getSecurityHeader().appendChild(timestampElement);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  try {
    verify(doc);
    fail("The timestamp validation should have failed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  verify(doc,Collections.singletonList(BSPRule.R3221));
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing an Timestamp where it contains multiple "Created" elements.
 * This Timestamp should be rejected.
 */
@Test public void testMultipleCreated() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Element timestampElement=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.TIMESTAMP_TOKEN_LN);
  DateFormat zulu=new XmlSchemaDateFormat();
  Element elementCreated=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.CREATED_LN);
  Date createdDate=new Date();
  elementCreated.appendChild(doc.createTextNode(zulu.format(createdDate)));
  timestampElement.appendChild(elementCreated);
  timestampElement.appendChild(elementCreated.cloneNode(true));
  secHeader.getSecurityHeader().appendChild(timestampElement);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  try {
    verify(doc);
    fail("The timestamp validation should have failed on multiple Created elements");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  verify(doc,Collections.singletonList(BSPRule.R3203));
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing an Timestamp where it contains a Created element with
 * seconds > 60. This should be rejected as per the BSP spec.
 */
@Test public void testCreatedSeconds() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Element timestampElement=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.TIMESTAMP_TOKEN_LN);
  Element elementCreated=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.CREATED_LN);
  elementCreated.appendChild(doc.createTextNode("2011-02-08T13:13:84.535Z"));
  timestampElement.appendChild(elementCreated);
  secHeader.getSecurityHeader().appendChild(timestampElement);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  WSSConfig wssConfig=WSSConfig.getNewInstance();
  wssConfig.setValidator(WSConstants.TIMESTAMP,new NoOpValidator());
  try {
    verify(doc,wssConfig,new ArrayList<BSPRule>());
    fail("The timestamp validation should have failed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing an Timestamp where the "Created" element is greater than
 * the expiration time.
 */
@Test public void testExpiresBeforeCreated() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Element timestampElement=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.TIMESTAMP_TOKEN_LN);
  DateFormat zulu=new XmlSchemaDateFormat();
  Element elementCreated=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.CREATED_LN);
  Date createdDate=new Date();
  long currentTime=createdDate.getTime();
  createdDate.setTime(currentTime);
  elementCreated.appendChild(doc.createTextNode(zulu.format(createdDate)));
  timestampElement.appendChild(elementCreated);
  Date expiresDate=new Date();
  expiresDate.setTime(expiresDate.getTime() - 300000);
  Element elementExpires=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.EXPIRES_LN);
  elementExpires.appendChild(doc.createTextNode(zulu.format(expiresDate)));
  timestampElement.appendChild(elementExpires);
  secHeader.getSecurityHeader().appendChild(timestampElement);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  try {
    verify(doc);
    fail("The timestamp validation should have failed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.MESSAGE_EXPIRED);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing an Timestamp where it contains a Created element with
 * a ValueType. This should be rejected as per the BSP spec.
 */
@Test public void testCreatedValueType() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Element timestampElement=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.TIMESTAMP_TOKEN_LN);
  DateFormat zulu=new XmlSchemaDateFormat();
  Element elementCreated=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.CREATED_LN);
  Date createdDate=new Date();
  long currentTime=createdDate.getTime() + 300000;
  createdDate.setTime(currentTime);
  elementCreated.appendChild(doc.createTextNode(zulu.format(createdDate)));
  elementCreated.setAttributeNS(null,"ValueType",WSConstants.WSS_SAML_KI_VALUE_TYPE);
  timestampElement.appendChild(elementCreated);
  secHeader.getSecurityHeader().appendChild(timestampElement);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  try {
    verify(doc);
    fail("The timestamp validation should have failed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  WSSConfig wssConfig=WSSConfig.getNewInstance();
  wssConfig.setValidator(WSConstants.TIMESTAMP,new NoOpValidator());
  verify(doc,wssConfig,Collections.singletonList(BSPRule.R3225));
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidTimestampNoExpires() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecTimestamp timestamp=new WSSecTimestamp();
  timestamp.setTimeToLive(0);
  Document createdDoc=timestamp.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(createdDoc);
    LOG.debug(outputString);
  }
  WSSecurityEngine secEngine=new WSSecurityEngine();
  RequestData requestData=new RequestData();
  requestData.setWssConfig(WSSConfig.getNewInstance());
  requestData.setRequireTimestampExpires(true);
  try {
    secEngine.processSecurityHeader(doc,requestData);
    fail("Failure expected on no Expires Element");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.SECURITY_ERROR);
  }
  requestData.setWssConfig(WSSConfig.getNewInstance());
  requestData.setRequireTimestampExpires(false);
  WSHandlerResult wsResult=secEngine.processSecurityHeader(doc,requestData);
  WSSecurityEngineResult actionResult=wsResult.getActionResults().get(WSConstants.TS).get(0);
  assertTrue(actionResult != null);
  Timestamp receivedTimestamp=(Timestamp)actionResult.get(WSSecurityEngineResult.TAG_TIMESTAMP);
  assertTrue(receivedTimestamp != null);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.UTDerivedKeyTest </h4><pre class="type-3 type-8 type-7 type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test using a UsernameToken derived key for encrypting a SOAP body. In this test the
 * derived key is modified before encryption, and so decryption should fail.
 */
@Test public void testDerivedKeyChangedEncryption() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setUserInfo("bob","security");
  builder.addDerivedKey(false,null,1000);
  builder.prepare(doc);
  byte[] derivedKey=builder.getDerivedKey();
  derivedKey[5]='z';
  derivedKey[6]='a';
  assertTrue(derivedKey.length == 20);
  String tokenIdentifier=builder.getId();
  WSSecDKEncrypt encrBuilder=new WSSecDKEncrypt();
  encrBuilder.setSymmetricEncAlgorithm(WSConstants.AES_128);
  encrBuilder.setExternalKey(derivedKey,tokenIdentifier);
  encrBuilder.setCustomValueType(WSConstants.WSS_USERNAME_TOKEN_VALUE_TYPE);
  Document encryptedDoc=encrBuilder.build(doc,secHeader);
  builder.prependToHeader(secHeader);
  String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  assertTrue(outputString.contains("wsse:Username"));
  assertFalse(outputString.contains("wsse:Password"));
  assertTrue(outputString.contains("wsse11:Salt"));
  assertTrue(outputString.contains("wsse11:Iteration"));
  assertFalse(outputString.contains("testMethod"));
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  try {
    verify(encryptedDoc);
    fail("Failure expected on a bad derived encryption");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_CHECK);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Unit test for creating a Username Token with an iteration value < 1000 that is used for
 * deriving a key for encryption.
 */
@Test public void testLowIterationEncryption() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  UsernameToken usernameToken=new UsernameToken(true,doc,null);
  usernameToken.setName("bob");
  WSSConfig config=WSSConfig.getNewInstance();
  usernameToken.setID(config.getIdAllocator().createId("UsernameToken-",usernameToken));
  usernameToken.addIteration(doc,500);
  byte[] salt=usernameToken.addSalt(doc,null,false);
  byte[] derivedKey=UsernameTokenUtil.generateDerivedKey("security",salt,500);
  WSSecDKEncrypt encrBuilder=new WSSecDKEncrypt();
  encrBuilder.setSymmetricEncAlgorithm(WSConstants.AES_128);
  encrBuilder.setExternalKey(derivedKey,usernameToken.getID());
  encrBuilder.setCustomValueType(WSConstants.WSS_USERNAME_TOKEN_VALUE_TYPE);
  Document encryptedDoc=encrBuilder.build(doc,secHeader);
  WSSecurityUtil.prependChildElement(secHeader.getSecurityHeader(),usernameToken.getElement());
  String outputString=XMLUtils.prettyDocumentToString(doc);
  assertTrue(outputString.contains("wsse:Username"));
  assertFalse(outputString.contains("wsse:Password"));
  assertTrue(outputString.contains("wsse11:Salt"));
  assertTrue(outputString.contains("wsse11:Iteration"));
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  try {
    verify(encryptedDoc);
    fail("Failure expected on a low iteration value");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  RequestData data=new RequestData();
  data.setCallbackHandler(callbackHandler);
  data.setDecCrypto(crypto);
  data.setIgnoredBSPRules(Collections.singletonList(BSPRule.R4218));
  data.setAllowUsernameTokenNoPassword(true);
  WSSecurityEngine engine=new WSSecurityEngine();
  engine.setWssConfig(config);
  engine.processSecurityHeader(doc,data);
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test using a UsernameToken derived key for signing a SOAP body. In this test the
 * user is "colm" rather than "bob", and so signature verification should fail.
 */
@Test public void testDerivedKeyBadUserSignature() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setUserInfo("colm","security");
  builder.addDerivedKey(true,null,1000);
  builder.prepare(doc);
  byte[] derivedKey=builder.getDerivedKey();
  assertTrue(derivedKey.length == 20);
  String tokenIdentifier=builder.getId();
  WSSecDKSign sigBuilder=new WSSecDKSign();
  sigBuilder.setExternalKey(derivedKey,tokenIdentifier);
  sigBuilder.setSignatureAlgorithm(WSConstants.HMAC_SHA1);
  sigBuilder.setCustomValueType(WSConstants.WSS_USERNAME_TOKEN_VALUE_TYPE);
  Document signedDoc=sigBuilder.build(doc,secHeader);
  builder.prependToHeader(secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  try {
    verify(signedDoc);
    fail("Failure expected on a bad derived signature");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test using a UsernameToken derived key for encrypting a SOAP body. The Reference to the
 * UsernameToken contains a non-standard value type, which is rejected when the corresponding
 * BSP rule is turned on.
 */
@Test public void testBadValueType() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setUserInfo("bob","security");
  builder.addDerivedKey(false,null,1000);
  builder.prepare(doc);
  byte[] derivedKey=builder.getDerivedKey();
  assertTrue(derivedKey.length == 20);
  String tokenIdentifier=builder.getId();
  WSSecDKEncrypt encrBuilder=new WSSecDKEncrypt();
  encrBuilder.setSymmetricEncAlgorithm(WSConstants.AES_128);
  encrBuilder.setExternalKey(derivedKey,tokenIdentifier);
  encrBuilder.setCustomValueType(WSConstants.WSS_SAML_TOKEN_TYPE);
  Document encryptedDoc=encrBuilder.build(doc,secHeader);
  builder.prependToHeader(secHeader);
  String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  assertTrue(outputString.contains("wsse:Username"));
  assertFalse(outputString.contains("wsse:Password"));
  assertTrue(outputString.contains("wsse11:Salt"));
  assertTrue(outputString.contains("wsse11:Iteration"));
  assertFalse(outputString.contains("testMethod"));
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  try {
    verify(encryptedDoc);
    fail("Failure expected on a bad value type");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  RequestData data=new RequestData();
  data.setCallbackHandler(callbackHandler);
  data.setDecCrypto(crypto);
  data.setAllowUsernameTokenNoPassword(true);
  WSSConfig config=WSSConfig.getNewInstance();
  WSSecurityEngine newEngine=new WSSecurityEngine();
  newEngine.setWssConfig(config);
  data.setIgnoredBSPRules(Collections.singletonList(BSPRule.R4214));
  newEngine.processSecurityHeader(encryptedDoc,data);
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test using a UsernameToken derived key for encrypting a SOAP body. In this test the
 * user is "colm" rather than "bob", and so decryption should fail.
 */
@Test public void testDerivedKeyBadUserEncryption() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setUserInfo("colm","security");
  builder.addDerivedKey(false,null,1000);
  builder.prepare(doc);
  byte[] derivedKey=builder.getDerivedKey();
  assertTrue(derivedKey.length == 20);
  String tokenIdentifier=builder.getId();
  WSSecDKEncrypt encrBuilder=new WSSecDKEncrypt();
  encrBuilder.setSymmetricEncAlgorithm(WSConstants.AES_128);
  encrBuilder.setExternalKey(derivedKey,tokenIdentifier);
  encrBuilder.setCustomValueType(WSConstants.WSS_USERNAME_TOKEN_VALUE_TYPE);
  Document encryptedDoc=encrBuilder.build(doc,secHeader);
  builder.prependToHeader(secHeader);
  String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  assertTrue(outputString.contains("wsse:Username"));
  assertFalse(outputString.contains("wsse:Password"));
  assertTrue(outputString.contains("wsse11:Salt"));
  assertTrue(outputString.contains("wsse11:Iteration"));
  assertFalse(outputString.contains("testMethod"));
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  try {
    verify(encryptedDoc);
    fail("Failure expected on a bad derived encryption");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test using a UsernameToken derived key for encrypting a SOAP body
 */
@Test public void testDerivedKeyEncryption() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setUserInfo("bob","security");
  builder.addDerivedKey(false,null,1000);
  builder.prepare(doc);
  byte[] derivedKey=builder.getDerivedKey();
  assertTrue(derivedKey.length == 20);
  String tokenIdentifier=builder.getId();
  WSSecDKEncrypt encrBuilder=new WSSecDKEncrypt();
  encrBuilder.setSymmetricEncAlgorithm(WSConstants.AES_128);
  encrBuilder.setExternalKey(derivedKey,tokenIdentifier);
  encrBuilder.setCustomValueType(WSConstants.WSS_USERNAME_TOKEN_VALUE_TYPE);
  Document encryptedDoc=encrBuilder.build(doc,secHeader);
  builder.prependToHeader(secHeader);
  String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  assertTrue(outputString.contains("wsse:Username"));
  assertFalse(outputString.contains("wsse:Password"));
  assertTrue(outputString.contains("wsse11:Salt"));
  assertTrue(outputString.contains("wsse11:Iteration"));
  assertFalse(outputString.contains("testMethod"));
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  verify(encryptedDoc);
  try {
    verify(encryptedDoc,false);
    fail("Failure expected on deriving keys from a UsernameToken not allowed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Unit test for creating a Username Token with no iteration element that is used for
 * deriving a key for encryption.
 */
@Test public void testNoIterationEncryption() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  UsernameToken usernameToken=new UsernameToken(true,doc,null);
  usernameToken.setName("bob");
  WSSConfig config=WSSConfig.getNewInstance();
  usernameToken.setID(config.getIdAllocator().createId("UsernameToken-",usernameToken));
  byte[] salt=usernameToken.addSalt(doc,null,false);
  byte[] derivedKey=UsernameTokenUtil.generateDerivedKey("security",salt,1000);
  WSSecDKEncrypt encrBuilder=new WSSecDKEncrypt();
  encrBuilder.setSymmetricEncAlgorithm(WSConstants.AES_128);
  encrBuilder.setExternalKey(derivedKey,usernameToken.getID());
  encrBuilder.setCustomValueType(WSConstants.WSS_USERNAME_TOKEN_VALUE_TYPE);
  Document encryptedDoc=encrBuilder.build(doc,secHeader);
  WSSecurityUtil.prependChildElement(secHeader.getSecurityHeader(),usernameToken.getElement());
  String outputString=XMLUtils.prettyDocumentToString(doc);
  assertTrue(outputString.contains("wsse:Username"));
  assertFalse(outputString.contains("wsse:Password"));
  assertTrue(outputString.contains("wsse11:Salt"));
  assertFalse(outputString.contains("wsse11:Iteration"));
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  try {
    verify(encryptedDoc);
    fail("Failure expected on no iteration element");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY_TOKEN);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Unit test for creating a Username Token with no salt element that is used for
 * deriving a key for encryption.
 */
@Test public void testNoSaltEncryption() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  UsernameToken usernameToken=new UsernameToken(true,doc,null);
  usernameToken.setName("bob");
  WSSConfig config=WSSConfig.getNewInstance();
  usernameToken.setID(config.getIdAllocator().createId("UsernameToken-",usernameToken));
  byte[] salt=UsernameTokenUtil.generateSalt(false);
  usernameToken.addIteration(doc,1000);
  byte[] derivedKey=UsernameTokenUtil.generateDerivedKey("security",salt,1000);
  WSSecDKEncrypt encrBuilder=new WSSecDKEncrypt();
  encrBuilder.setSymmetricEncAlgorithm(WSConstants.AES_128);
  encrBuilder.setExternalKey(derivedKey,usernameToken.getID());
  encrBuilder.setCustomValueType(WSConstants.WSS_USERNAME_TOKEN_VALUE_TYPE);
  Document encryptedDoc=encrBuilder.build(doc,secHeader);
  WSSecurityUtil.prependChildElement(secHeader.getSecurityHeader(),usernameToken.getElement());
  String outputString=XMLUtils.prettyDocumentToString(doc);
  assertTrue(outputString.contains("wsse:Username"));
  assertFalse(outputString.contains("wsse:Password"));
  assertFalse(outputString.contains("wsse11:Salt"));
  assertTrue(outputString.contains("wsse11:Iteration"));
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  try {
    verify(encryptedDoc);
    fail("Failure expected on no salt element");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test using a UsernameToken derived key for signing a SOAP body. In this test the
 * derived key is modified before signature, and so signature verification should
 * fail.
 */
@Test public void testDerivedKeyChangedSignature() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setUserInfo("bob","security");
  builder.addDerivedKey(true,null,1000);
  builder.prepare(doc);
  byte[] derivedKey=builder.getDerivedKey();
  if (derivedKey[5] != 12) {
    derivedKey[5]=12;
  }
 else {
    derivedKey[5]=13;
  }
  assertTrue(derivedKey.length == 20);
  String tokenIdentifier=builder.getId();
  WSSecDKSign sigBuilder=new WSSecDKSign();
  sigBuilder.setExternalKey(derivedKey,tokenIdentifier);
  sigBuilder.setSignatureAlgorithm(WSConstants.HMAC_SHA1);
  sigBuilder.setCustomValueType(WSConstants.WSS_USERNAME_TOKEN_VALUE_TYPE);
  Document signedDoc=sigBuilder.build(doc,secHeader);
  builder.prependToHeader(secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  try {
    verify(signedDoc);
    fail("Failure expected on a bad derived signature");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_CHECK);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test using a UsernameToken derived key for encrypting a SOAP body. A KeyIdentifier is
 * used to refer to the UsernameToken, which is forbidden by the BSP.
 */
@Test public void testKeyIdentifier() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setUserInfo("bob","security");
  builder.addDerivedKey(false,null,1000);
  builder.prepare(doc);
  byte[] derivedKey=builder.getDerivedKey();
  assertTrue(derivedKey.length == 20);
  String tokenIdentifier=builder.getId();
  WSSecDKEncrypt encrBuilder=new WSSecDKEncrypt();
  encrBuilder.setSymmetricEncAlgorithm(WSConstants.AES_128);
  SecurityTokenReference strEncKey=new SecurityTokenReference(doc);
  strEncKey.setKeyIdentifier(WSConstants.WSS_USERNAME_TOKEN_VALUE_TYPE,tokenIdentifier,true);
  encrBuilder.setExternalKey(derivedKey,strEncKey.getElement());
  Document encryptedDoc=encrBuilder.build(doc,secHeader);
  builder.prependToHeader(secHeader);
  String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  assertTrue(outputString.contains("wsse:Username"));
  assertFalse(outputString.contains("wsse:Password"));
  assertTrue(outputString.contains("wsse11:Salt"));
  assertTrue(outputString.contains("wsse11:Iteration"));
  assertFalse(outputString.contains("testMethod"));
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  try {
    verify(encryptedDoc);
    fail("Failure expected on a key identifier");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  WSSecurityEngine newEngine=new WSSecurityEngine();
  RequestData data=new RequestData();
  data.setCallbackHandler(callbackHandler);
  data.setDecCrypto(crypto);
  data.setIgnoredBSPRules(Collections.singletonList(BSPRule.R4215));
  data.setAllowUsernameTokenNoPassword(true);
  WSSConfig config=WSSConfig.getNewInstance();
  newEngine.setWssConfig(config);
  newEngine.processSecurityHeader(encryptedDoc,data);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.UTSignatureTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test using a UsernameToken derived key for signing a SOAP body. In this test the
 * user is "colm" rather than "bob", and so signature verification should fail.
 */
@Test public void testBadUserSignature() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setUserInfo("colm","security");
  builder.addDerivedKey(true,null,1000);
  builder.prepare(doc);
  WSSecSignature sign=new WSSecSignature();
  sign.setCustomTokenValueType(WSConstants.USERNAMETOKEN_NS + "#UsernameToken");
  sign.setCustomTokenId(builder.getId());
  sign.setSecretKey(builder.getDerivedKey());
  sign.setKeyIdentifierType(WSConstants.CUSTOM_SYMM_SIGNING);
  sign.setSignatureAlgorithm(WSConstants.HMAC_SHA1);
  Document signedDoc=sign.build(doc,null,secHeader);
  builder.prependToHeader(secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  try {
    verify(signedDoc);
    fail("Failure expected on a bad derived signature");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test using a UsernameToken derived key for signing a SOAP body
 */
@Test public void testSignature() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setUserInfo("bob","security");
  builder.addDerivedKey(true,null,1000);
  builder.prepare(doc);
  WSSecSignature sign=new WSSecSignature();
  sign.setCustomTokenValueType(WSConstants.USERNAMETOKEN_NS + "#UsernameToken");
  sign.setCustomTokenId(builder.getId());
  sign.setSecretKey(builder.getDerivedKey());
  sign.setKeyIdentifierType(WSConstants.CUSTOM_SYMM_SIGNING);
  sign.setSignatureAlgorithm(WSConstants.HMAC_SHA1);
  Document signedDoc=sign.build(doc,null,secHeader);
  builder.prependToHeader(secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  assertTrue(outputString.contains("wsse:Username"));
  assertFalse(outputString.contains("wsse:Password"));
  assertTrue(outputString.contains("wsse11:Salt"));
  assertTrue(outputString.contains("wsse11:Iteration"));
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.UT_SIGN).get(0);
  java.security.Principal principal=(java.security.Principal)actionResult.get(WSSecurityEngineResult.TAG_PRINCIPAL);
  assertTrue(principal.getName().contains("bob"));
  try {
    verify(signedDoc,false);
    fail("Failure expected on deriving keys from a UsernameToken not allowed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.UsernameTokenTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing a UsernameToken where the "Created" element is in the (near)
 * future. It should be accepted by default when it is created 30 seconds in the future,
 * and then rejected once we configure "0 seconds" for future-time-to-live.
 */
@Test public void testNearFutureCreated() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Element usernameTokenElement=doc.createElementNS(WSConstants.WSSE_NS,WSConstants.WSSE_PREFIX + ":" + WSConstants.USERNAME_TOKEN_LN);
  Element usernameElement=doc.createElementNS(WSConstants.WSSE_NS,WSConstants.WSSE_PREFIX + ":" + WSConstants.USERNAME_LN);
  usernameElement.appendChild(doc.createTextNode("wernerd"));
  usernameTokenElement.appendChild(usernameElement);
  Element passwordElement=doc.createElementNS(WSConstants.WSSE_NS,WSConstants.WSSE_PREFIX + ":" + WSConstants.PASSWORD_LN);
  passwordElement.setAttributeNS(null,"Type",WSConstants.PASSWORD_TEXT);
  passwordElement.appendChild(doc.createTextNode("verySecret"));
  usernameTokenElement.appendChild(passwordElement);
  Element elementCreated=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.CREATED_LN);
  DateFormat zulu=new XmlSchemaDateFormat();
  Date createdDate=new Date();
  long currentTime=createdDate.getTime() + 30000;
  createdDate.setTime(currentTime);
  elementCreated.appendChild(doc.createTextNode(zulu.format(createdDate)));
  usernameTokenElement.appendChild(elementCreated);
  secHeader.getSecurityHeader().appendChild(usernameTokenElement);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  WSSecurityEngine secEngine=new WSSecurityEngine();
  secEngine.processSecurityHeader(doc,null,callbackHandler,null);
  try {
    RequestData requestData=new RequestData();
    requestData.setUtFutureTTL(0);
    requestData.setCallbackHandler(callbackHandler);
    secEngine.processSecurityHeader(doc,requestData);
    fail("The UsernameToken validation should have failed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.MESSAGE_EXPIRED);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that adds a UserNameToken with a bad password Digest to a WS-Security envelope
 */
@Test public void testUsernameTokenBadDigest() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setUserInfo("wernerd","verySecre");
  LOG.info("Before adding UsernameToken PW Digest....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Message with UserNameToken PW Digest:");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  LOG.info("After adding UsernameToken PW Digest....");
  try {
    verify(signedDoc);
    fail("Failure expected on a bad password digest");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that adds a UserNameToken with no password type to a WS-Security envelope
 * See WSS-152 - https://issues.apache.org/jira/browse/WSS-152
 * "Problem with processing Username Tokens with no password type"
 * The 1.1 spec states that the password type is optional and defaults to password text,
 * and so we should handle an incoming Username Token accordingly.
 */
@Test public void testUsernameTokenNoPasswordType() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUTMSG);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  WSSecurityEngine newEngine=new WSSecurityEngine();
  try {
    newEngine.processSecurityHeader(doc,null,callbackHandler,null);
    fail("Expected failure as it is not BSP compliant");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  RequestData data=new RequestData();
  data.setCallbackHandler(callbackHandler);
  data.setIgnoredBSPRules(Collections.singletonList(BSPRule.R4201));
  newEngine.processSecurityHeader(doc,data);
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * A test for WSS-66 - the created string is null
 * http://issues.apache.org/jira/browse/WSS-66
 * "Possible security hole when PasswordDigest is used by client."
 */
@Test public void testNullCreated() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordType(WSConstants.PASSWORD_DIGEST);
  builder.setUserInfo("wernerd","BAD_PASSWORD");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document utDoc=builder.build(doc,secHeader);
  Element elem=builder.getUsernameTokenElement();
  NodeList list=elem.getElementsByTagNameNS(WSConstants.WSU_NS,"Created");
  Node nonceNode=list.item(0);
  Node childNode=nonceNode.getFirstChild();
  childNode.setNodeValue("");
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(utDoc);
    LOG.debug(outputString);
  }
  try {
    verify(utDoc);
    fail("Expected failure due to a bad password");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that a bad username with password digest does not leak whether the username
 * is valid or not - see WSS-141.
 */
@Test public void testUsernameTokenBadUsername() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setUserInfo("badusername","verySecret");
  LOG.info("Before adding UsernameToken PW Digest....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Message with UserNameToken PW Digest:");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  LOG.info("After adding UsernameToken PW Digest....");
  try {
    verify(signedDoc);
    fail("Failure expected on a bad username");
  }
 catch (  WSSecurityException ex) {
    String message=ex.getMessage();
    assertFalse(message.contains("badusername"));
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that adds a UserNameToken with no user (or password) to a WS-Security envelope
 * See WSS-185 - https://issues.apache.org/jira/browse/WSS-185
 * "NullPointerException on empty UsernameToken"
 */
@Test public void testUsernameTokenNoUser() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUTNOUSERMSG);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  try {
    verify(doc);
    fail("Failure expected on no password");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that adds a UserNameToken with (bad) password text to a WS-Security envelope
 */
@Test public void testUsernameTokenBadText() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordType(WSConstants.PASSWORD_TEXT);
  builder.setUserInfo("wernerd","verySecre");
  LOG.info("Before adding UsernameToken PW Text....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Message with UserNameToken PW Text:");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  LOG.info("After adding UsernameToken PW Text....");
  try {
    verify(signedDoc);
    fail("Failure expected on a bad password text");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * A test for sending multiple passwords in the UsernameToken
 */
@Test public void testMultiplePassword() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordType(WSConstants.PASSWORD_DIGEST);
  builder.setUserInfo("wernerd","verySecret");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document utDoc=builder.build(doc,secHeader);
  Element elem=builder.getUsernameTokenElement();
  NodeList list=elem.getElementsByTagNameNS(WSConstants.WSSE_NS,"Password");
  Node passwordNode=list.item(0);
  Node passwordCopy=passwordNode.cloneNode(true);
  passwordNode.getParentNode().insertBefore(passwordCopy,passwordNode);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(utDoc);
    LOG.debug(outputString);
  }
  WSSecurityEngine newEngine=new WSSecurityEngine();
  try {
    newEngine.processSecurityHeader(doc,null,callbackHandler,null);
    fail("Expected failure as it is not BSP compliant");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  RequestData data=new RequestData();
  data.setCallbackHandler(callbackHandler);
  data.setIgnoredBSPRules(Collections.singletonList(BSPRule.R4222));
  newEngine.processSecurityHeader(doc,data);
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test to create a "Spoofed" UsernameToken (see WSS-441)
 */
@Test public void testSpoofedUsernameToken() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setUserInfo("wernerd","verySecret");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSTimeSource spoofedTimeSource=new WSTimeSource(){
    public Date now(){
      Date currentTime=new Date();
      currentTime.setTime(currentTime.getTime() - (500L * 1000L));
      return currentTime;
    }
  }
;
  builder.setWsTimeSource(spoofedTimeSource);
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  try {
    WSSecurityEngine secEngine=new WSSecurityEngine();
    secEngine.processSecurityHeader(doc,null,callbackHandler,null);
    fail("The UsernameToken validation should have failed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.MESSAGE_EXPIRED);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * A test for sending multiple nonces in the UsernameToken
 */
@Test public void testMultipleNonce() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordType(WSConstants.PASSWORD_DIGEST);
  builder.setUserInfo("wernerd","verySecret");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document utDoc=builder.build(doc,secHeader);
  Element elem=builder.getUsernameTokenElement();
  NodeList list=elem.getElementsByTagNameNS(WSConstants.WSSE_NS,"Nonce");
  Node nonceNode=list.item(0);
  Node nonceCopy=nonceNode.cloneNode(true);
  nonceNode.getParentNode().insertBefore(nonceCopy,nonceNode);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(utDoc);
    LOG.debug(outputString);
  }
  WSSecurityEngine newEngine=new WSSecurityEngine();
  try {
    newEngine.processSecurityHeader(doc,null,callbackHandler,null);
    fail("Expected failure as it is not BSP compliant");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  RequestData data=new RequestData();
  data.setCallbackHandler(callbackHandler);
  data.setIgnoredBSPRules(Collections.singletonList(BSPRule.R4225));
  newEngine.processSecurityHeader(doc,data);
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * A test for sending multiple Created elements in the UsernameToken
 */
@Test public void testMultipleCreated() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordType(WSConstants.PASSWORD_DIGEST);
  builder.setUserInfo("wernerd","verySecret");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document utDoc=builder.build(doc,secHeader);
  Element elem=builder.getUsernameTokenElement();
  NodeList list=elem.getElementsByTagNameNS(WSConstants.WSU_NS,"Created");
  Node createdNode=list.item(0);
  Node createdCopy=createdNode.cloneNode(true);
  createdNode.getParentNode().insertBefore(createdCopy,createdNode);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(utDoc);
    LOG.debug(outputString);
  }
  WSSecurityEngine newEngine=new WSSecurityEngine();
  try {
    newEngine.processSecurityHeader(doc,null,callbackHandler,null);
    fail("Expected failure as it is not BSP compliant");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  RequestData data=new RequestData();
  data.setCallbackHandler(callbackHandler);
  data.setIgnoredBSPRules(Collections.singletonList(BSPRule.R4223));
  newEngine.processSecurityHeader(doc,data);
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * A test for WSS-66 - the nonce string is null
 * http://issues.apache.org/jira/browse/WSS-66
 * "Possible security hole when PasswordDigest is used by client."
 */
@Test public void testNullNonce() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordType(WSConstants.PASSWORD_DIGEST);
  builder.setUserInfo("wernerd","BAD_PASSWORD");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document utDoc=builder.build(doc,secHeader);
  Element elem=builder.getUsernameTokenElement();
  NodeList list=elem.getElementsByTagNameNS(WSConstants.WSSE_NS,"Nonce");
  Node nonceNode=list.item(0);
  Node childNode=nonceNode.getFirstChild();
  childNode.setNodeValue("");
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(utDoc);
    LOG.debug(outputString);
  }
  try {
    verify(utDoc);
    fail("Expected failure due to a bad password");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing a UsernameToken where the "Created" element is in the future.
 * A UsernameToken that is 120 seconds in the future should be rejected by default.
 */
@Test public void testFutureCreated() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Element usernameTokenElement=doc.createElementNS(WSConstants.WSSE_NS,WSConstants.WSSE_PREFIX + ":" + WSConstants.USERNAME_TOKEN_LN);
  Element usernameElement=doc.createElementNS(WSConstants.WSSE_NS,WSConstants.WSSE_PREFIX + ":" + WSConstants.USERNAME_LN);
  usernameElement.appendChild(doc.createTextNode("wernerd"));
  usernameTokenElement.appendChild(usernameElement);
  Element passwordElement=doc.createElementNS(WSConstants.WSSE_NS,WSConstants.WSSE_PREFIX + ":" + WSConstants.PASSWORD_LN);
  passwordElement.setAttributeNS(null,"Type",WSConstants.PASSWORD_TEXT);
  passwordElement.appendChild(doc.createTextNode("verySecret"));
  usernameTokenElement.appendChild(passwordElement);
  Element elementCreated=doc.createElementNS(WSConstants.WSU_NS,WSConstants.WSU_PREFIX + ":" + WSConstants.CREATED_LN);
  DateFormat zulu=new XmlSchemaDateFormat();
  Date createdDate=new Date();
  long currentTime=createdDate.getTime() + 120000;
  createdDate.setTime(currentTime);
  elementCreated.appendChild(doc.createTextNode(zulu.format(createdDate)));
  usernameTokenElement.appendChild(elementCreated);
  secHeader.getSecurityHeader().appendChild(usernameTokenElement);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  try {
    WSSecurityEngine secEngine=new WSSecurityEngine();
    secEngine.processSecurityHeader(doc,null,callbackHandler,null);
    fail("The UsernameToken validation should have failed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.MESSAGE_EXPIRED);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * A test for sending a nonce with a bad encoding type in the UsernameToken
 */
@Test public void testNonceBadEncodingType() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordType(WSConstants.PASSWORD_DIGEST);
  builder.setUserInfo("wernerd","verySecret");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document utDoc=builder.build(doc,secHeader);
  Element elem=builder.getUsernameTokenElement();
  NodeList list=elem.getElementsByTagNameNS(WSConstants.WSSE_NS,"Nonce");
  Node nonceNode=list.item(0);
  ((Element)nonceNode).setAttributeNS(null,"EncodingType","http://bad_encoding_type");
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(utDoc);
    LOG.debug(outputString);
  }
  WSSecurityEngine newEngine=new WSSecurityEngine();
  try {
    newEngine.processSecurityHeader(doc,null,callbackHandler,null);
    fail("Expected failure as it is not BSP compliant");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  RequestData data=new RequestData();
  data.setCallbackHandler(callbackHandler);
  data.setIgnoredBSPRules(Collections.singletonList(BSPRule.R4221));
  newEngine.processSecurityHeader(doc,data);
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing an "old" UsernameToken, i.e. one with a "Created" element that is
 * out of date
 */
@Test public void testOldUsernameToken() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setUserInfo("wernerd","verySecret");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  RequestData requestData=new RequestData();
  requestData.setUtTTL(-1);
  requestData.setCallbackHandler(callbackHandler);
  try {
    WSSecurityEngine secEngine=new WSSecurityEngine();
    secEngine.processSecurityHeader(doc,requestData);
    fail("The UsernameToken validation should have failed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.MESSAGE_EXPIRED);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test with a non-standard token type. This will fail as the default is to reject custom
 * token types.
 */
@Test public void testUsernameTokenCustomFail() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordType("RandomType");
  builder.setUserInfo("wernerd","verySecret");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Message with UserNameToken PW Text:");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  try {
    WSSecurityEngine secEngine=new WSSecurityEngine();
    secEngine.processSecurityHeader(signedDoc,null,this,null);
    fail("Custom token types are not permitted");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.XOPAttachmentTest </h4><pre class="type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptedHeaderAsEncryptedData() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAP_HEADER_MSG);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  AttachmentCallbackHandler outboundAttachmentCallback=new AttachmentCallbackHandler();
  encrypt.setAttachmentCallbackHandler(outboundAttachmentCallback);
  encrypt.setStoreBytesInAttachment(true);
  WSEncryptionPart encP=new WSEncryptionPart("foobar","urn:foo.bar","");
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(encP);
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  List<Attachment> encryptedAttachments=outboundAttachmentCallback.getResponseAttachments();
  assertNotNull(encryptedAttachments);
  assertTrue(encryptedAttachments.size() == 3);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  AttachmentCallbackHandler inboundAttachmentCallback=new AttachmentCallbackHandler(encryptedAttachments);
  verify(encryptedDoc,inboundAttachmentCallback);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDerivedSignedSOAPBody() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  AttachmentCallbackHandler outboundAttachmentCallback=new AttachmentCallbackHandler();
  WSSecEncryptedKey encrKeyBuilder=new WSSecEncryptedKey();
  encrKeyBuilder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e");
  encrKeyBuilder.setKeyIdentifierType(WSConstants.THUMBPRINT_IDENTIFIER);
  encrKeyBuilder.setAttachmentCallbackHandler(outboundAttachmentCallback);
  encrKeyBuilder.setStoreBytesInAttachment(true);
  encrKeyBuilder.prepare(doc,crypto);
  byte[] ek=encrKeyBuilder.getEphemeralKey();
  String tokenIdentifier=encrKeyBuilder.getId();
  WSSecDKSign sigBuilder=new WSSecDKSign();
  sigBuilder.setExternalKey(ek,tokenIdentifier);
  sigBuilder.setSignatureAlgorithm(WSConstants.HMAC_SHA1);
  sigBuilder.setAttachmentCallbackHandler(outboundAttachmentCallback);
  sigBuilder.setStoreBytesInAttachment(true);
  Document signedDoc=sigBuilder.build(doc,secHeader);
  encrKeyBuilder.prependToHeader(secHeader);
  encrKeyBuilder.prependBSTElementToHeader(secHeader);
  List<Attachment> signedAttachments=outboundAttachmentCallback.getResponseAttachments();
  assertNotNull(signedAttachments);
  assertTrue(signedAttachments.size() == 1);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  AttachmentCallbackHandler inboundAttachmentCallback=new AttachmentCallbackHandler(signedAttachments);
  verify(signedDoc,inboundAttachmentCallback);
  String processedDoc=XMLUtils.prettyDocumentToString(signedDoc);
  assertTrue(processedDoc.contains(SOAP_BODY));
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDerivedEncryptedSOAPBody() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  AttachmentCallbackHandler outboundAttachmentCallback=new AttachmentCallbackHandler();
  WSSecEncryptedKey encrKeyBuilder=new WSSecEncryptedKey();
  encrKeyBuilder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e");
  encrKeyBuilder.setKeyIdentifierType(WSConstants.THUMBPRINT_IDENTIFIER);
  encrKeyBuilder.setAttachmentCallbackHandler(outboundAttachmentCallback);
  encrKeyBuilder.setStoreBytesInAttachment(true);
  encrKeyBuilder.prepare(doc,crypto);
  byte[] ek=encrKeyBuilder.getEphemeralKey();
  String tokenIdentifier=encrKeyBuilder.getId();
  WSSecDKEncrypt encrBuilder=new WSSecDKEncrypt();
  encrBuilder.setSymmetricEncAlgorithm(WSConstants.AES_128);
  encrBuilder.setExternalKey(ek,tokenIdentifier);
  encrBuilder.setAttachmentCallbackHandler(outboundAttachmentCallback);
  encrBuilder.setStoreBytesInAttachment(true);
  Document encryptedDoc=encrBuilder.build(doc,secHeader);
  encrKeyBuilder.prependToHeader(secHeader);
  encrKeyBuilder.prependBSTElementToHeader(secHeader);
  List<Attachment> encryptedAttachments=outboundAttachmentCallback.getResponseAttachments();
  assertNotNull(encryptedAttachments);
  assertTrue(encryptedAttachments.size() == 2);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  AttachmentCallbackHandler inboundAttachmentCallback=new AttachmentCallbackHandler(encryptedAttachments);
  verify(encryptedDoc,inboundAttachmentCallback);
  String processedDoc=XMLUtils.prettyDocumentToString(encryptedDoc);
  assertTrue(processedDoc.contains(SOAP_BODY));
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignedEncryptedSOAPBody() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  AttachmentCallbackHandler outboundAttachmentCallback=new AttachmentCallbackHandler();
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  builder.setAttachmentCallbackHandler(outboundAttachmentCallback);
  builder.setStoreBytesInAttachment(true);
  builder.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  builder.build(doc,crypto,secHeader);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  encrypt.setAttachmentCallbackHandler(outboundAttachmentCallback);
  encrypt.setStoreBytesInAttachment(true);
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  List<Attachment> encryptedAttachments=outboundAttachmentCallback.getResponseAttachments();
  assertNotNull(encryptedAttachments);
  assertTrue(encryptedAttachments.size() == 3);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  AttachmentCallbackHandler inboundAttachmentCallback=new AttachmentCallbackHandler(encryptedAttachments);
  verify(encryptedDoc,inboundAttachmentCallback);
  String processedDoc=XMLUtils.prettyDocumentToString(encryptedDoc);
  assertTrue(processedDoc.contains(SOAP_BODY));
}

</code></pre>

<br>
<pre class="type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignedSOAPBody() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  AttachmentCallbackHandler outboundAttachmentCallback=new AttachmentCallbackHandler();
  builder.setAttachmentCallbackHandler(outboundAttachmentCallback);
  builder.setStoreBytesInAttachment(true);
  Document signedDoc=builder.build(doc,crypto,secHeader);
  List<Attachment> signedAttachments=outboundAttachmentCallback.getResponseAttachments();
  assertNotNull(signedAttachments);
  assertTrue(signedAttachments.size() == 1);
  if (LOG.isDebugEnabled()) {
    LOG.debug("After Signing....");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  AttachmentCallbackHandler inboundAttachmentCallback=new AttachmentCallbackHandler(signedAttachments);
  verify(signedDoc,inboundAttachmentCallback);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignedEncryptedSOAPBodyViaHandler() throws Exception {
  final WSSConfig cfg=WSSConfig.getNewInstance();
  final RequestData reqData=new RequestData();
  reqData.setWssConfig(cfg);
  reqData.setUsername("16c73ab6-b892-458f-abf5-2f875f74882e");
  AttachmentCallbackHandler outboundAttachmentCallback=new AttachmentCallbackHandler();
  reqData.setAttachmentCallbackHandler(outboundAttachmentCallback);
  java.util.Map<String,Object> config=new java.util.TreeMap<String,Object>();
  config.put(WSHandlerConstants.SIG_PROP_FILE,"crypto.properties");
  config.put(WSHandlerConstants.ENC_PROP_FILE,"crypto.properties");
  config.put(WSHandlerConstants.SIG_KEY_ID,"DirectReference");
  config.put("password","security");
  config.put(WSHandlerConstants.STORE_BYTES_IN_ATTACHMENT,"true");
  reqData.setMsgContext(config);
  final Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  CustomHandler handler=new CustomHandler();
  List<HandlerAction> actions=new ArrayList<>();
  actions.add(new HandlerAction(WSConstants.SIGN));
  actions.add(new HandlerAction(WSConstants.ENCR));
  handler.send(doc,reqData,actions,true);
  String outputString=XMLUtils.prettyDocumentToString(doc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed message:");
    LOG.debug(outputString);
  }
  List<Attachment> encryptedAttachments=outboundAttachmentCallback.getResponseAttachments();
  assertNotNull(encryptedAttachments);
  assertTrue(encryptedAttachments.size() == 3);
  AttachmentCallbackHandler inboundAttachmentCallback=new AttachmentCallbackHandler(encryptedAttachments);
  verify(doc,inboundAttachmentCallback);
  String processedDoc=XMLUtils.prettyDocumentToString(doc);
  assertTrue(processedDoc.contains(SOAP_BODY));
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptedSOAPBody() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  AttachmentCallbackHandler outboundAttachmentCallback=new AttachmentCallbackHandler();
  encrypt.setAttachmentCallbackHandler(outboundAttachmentCallback);
  encrypt.setStoreBytesInAttachment(true);
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  List<Attachment> encryptedAttachments=outboundAttachmentCallback.getResponseAttachments();
  assertNotNull(encryptedAttachments);
  assertTrue(encryptedAttachments.size() == 2);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  AttachmentCallbackHandler inboundAttachmentCallback=new AttachmentCallbackHandler(encryptedAttachments);
  verify(encryptedDoc,inboundAttachmentCallback);
  String processedDoc=XMLUtils.prettyDocumentToString(encryptedDoc);
  assertTrue(processedDoc.contains(SOAP_BODY));
}

</code></pre>

<br>
<pre class="type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptedHeaderasEncryptedHeader() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAP_HEADER_MSG);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  AttachmentCallbackHandler outboundAttachmentCallback=new AttachmentCallbackHandler();
  encrypt.setAttachmentCallbackHandler(outboundAttachmentCallback);
  encrypt.setStoreBytesInAttachment(true);
  WSEncryptionPart encP=new WSEncryptionPart("foobar","urn:foo.bar","Header");
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(encP);
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  List<Attachment> encryptedAttachments=outboundAttachmentCallback.getResponseAttachments();
  assertNotNull(encryptedAttachments);
  assertTrue(encryptedAttachments.size() == 3);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  AttachmentCallbackHandler inboundAttachmentCallback=new AttachmentCallbackHandler(encryptedAttachments);
  verify(encryptedDoc,inboundAttachmentCallback);
}

</code></pre>

<br>
<pre class="type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignedSOAPBodyAndBinarySecurityToken() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  builder.setIncludeSignatureToken(true);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  AttachmentCallbackHandler outboundAttachmentCallback=new AttachmentCallbackHandler();
  builder.setAttachmentCallbackHandler(outboundAttachmentCallback);
  builder.setStoreBytesInAttachment(true);
  Document signedDoc=builder.build(doc,crypto,secHeader);
  List<Attachment> signedAttachments=outboundAttachmentCallback.getResponseAttachments();
  assertNotNull(signedAttachments);
  assertTrue(signedAttachments.size() == 1);
  if (LOG.isDebugEnabled()) {
    LOG.debug("After Signing....");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  AttachmentCallbackHandler inboundAttachmentCallback=new AttachmentCallbackHandler(signedAttachments);
  verify(signedDoc,inboundAttachmentCallback);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testManualEncryptedSOAPBody() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(new WSEncryptionPart("cid:Attachments","Content"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAP_BODY.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  encrypt.setAttachmentCallbackHandler(attachmentCallbackHandler);
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  Element soapBody=WSSecurityUtil.findBodyElement(encryptedDoc);
  assertNotNull(soapBody);
  Element encryptedData=XMLUtils.getDirectChildElement(soapBody,"EncryptedData",WSConstants.ENC_NS);
  encryptedData.removeAttributeNS(null,"Type");
  Element cipherData=XMLUtils.getDirectChildElement(encryptedData,"CipherData",WSConstants.ENC_NS);
  assertNotNull(cipherData);
  Element cipherValue=XMLUtils.getDirectChildElement(cipherData,"CipherValue",WSConstants.ENC_NS);
  assertNotNull(cipherValue);
  XMLUtils.setNamespace(cipherValue,WSS4JConstants.XOP_NS,"xop");
  Element cipherValueChild=encryptedDoc.createElementNS(WSConstants.XOP_NS,"Include");
  cipherValueChild.setAttributeNS(null,"href","cid:" + encryptedAttachments.get(0).getId());
  cipherValue.replaceChild(cipherValueChild,cipherValue.getFirstChild());
  Element securityHeader=WSSecurityUtil.findWsseSecurityHeaderBlock(encryptedDoc,encryptedDoc.getDocumentElement(),false);
  Element encryptedAttachmentData=XMLUtils.getDirectChildElement(securityHeader,"EncryptedData",WSConstants.ENC_NS);
  assertNotNull(encryptedAttachmentData);
  String encryptedDataId=encryptedAttachmentData.getAttributeNS(null,"Id");
  securityHeader.removeChild(encryptedAttachmentData);
  Element encryptedKey=XMLUtils.getDirectChildElement(securityHeader,"EncryptedKey",WSConstants.ENC_NS);
  assertNotNull(encryptedKey);
  Element referenceList=XMLUtils.getDirectChildElement(encryptedKey,"ReferenceList",WSConstants.ENC_NS);
  assertNotNull(referenceList);
  Node child=referenceList.getFirstChild();
  while (child != null) {
    if (child instanceof Element && "DataReference".equals(child.getLocalName()) && WSConstants.ENC_NS.equals(child.getNamespaceURI())) {
      String uri=((Element)child).getAttributeNS(null,"URI");
      if (uri.equals("#" + encryptedDataId)) {
        referenceList.removeChild(child);
        break;
      }
    }
    child=child.getNextSibling();
  }
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
  verify(encryptedDoc,attachmentCallbackHandler);
  String processedDoc=XMLUtils.prettyDocumentToString(encryptedDoc);
  assertTrue(processedDoc.contains(SOAP_BODY));
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptedSignedSOAPBodyViaHandler() throws Exception {
  final WSSConfig cfg=WSSConfig.getNewInstance();
  final RequestData reqData=new RequestData();
  reqData.setWssConfig(cfg);
  reqData.setUsername("16c73ab6-b892-458f-abf5-2f875f74882e");
  AttachmentCallbackHandler outboundAttachmentCallback=new AttachmentCallbackHandler();
  reqData.setAttachmentCallbackHandler(outboundAttachmentCallback);
  java.util.Map<String,Object> config=new java.util.TreeMap<String,Object>();
  config.put(WSHandlerConstants.SIG_PROP_FILE,"crypto.properties");
  config.put(WSHandlerConstants.ENC_PROP_FILE,"crypto.properties");
  config.put(WSHandlerConstants.SIG_KEY_ID,"DirectReference");
  config.put("password","security");
  config.put(WSHandlerConstants.STORE_BYTES_IN_ATTACHMENT,"true");
  reqData.setMsgContext(config);
  final Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  CustomHandler handler=new CustomHandler();
  List<HandlerAction> actions=new ArrayList<>();
  actions.add(new HandlerAction(WSConstants.ENCR));
  actions.add(new HandlerAction(WSConstants.SIGN));
  handler.send(doc,reqData,actions,true);
  String outputString=XMLUtils.prettyDocumentToString(doc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed message:");
    LOG.debug(outputString);
  }
  List<Attachment> encryptedAttachments=outboundAttachmentCallback.getResponseAttachments();
  assertNotNull(encryptedAttachments);
  assertTrue(encryptedAttachments.size() == 0);
  AttachmentCallbackHandler inboundAttachmentCallback=new AttachmentCallbackHandler(encryptedAttachments);
  verify(doc,inboundAttachmentCallback);
  String processedDoc=XMLUtils.prettyDocumentToString(doc);
  assertTrue(processedDoc.contains(SOAP_BODY));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.token.BSTKerberosTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test Validating a Kerberos BinarySecurityToken using a custom Validator instance.
 */
@Test public void testProcessTokenCustomValidator() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  BinarySecurity bst=new BinarySecurity(doc);
  bst.setValueType(AP_REQ);
  bst.setEncodingType(BASE64_NS);
  bst.setToken("12345678".getBytes());
  WSSecurityUtil.prependChildElement(secHeader.getSecurityHeader(),bst.getElement());
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  WSSecurityEngine customEngine=new WSSecurityEngine();
  WSSConfig wssConfig=WSSConfig.getNewInstance();
  wssConfig.setValidator(WSConstants.BINARY_TOKEN,new KerberosValidator());
  customEngine.setWssConfig(wssConfig);
  customEngine.processSecurityHeader(doc,null,callbackHandler,crypto);
  bst.setToken("12345679".getBytes());
  try {
    customEngine.processSecurityHeader(doc,null,callbackHandler,crypto);
    fail("Failure expected on a bad token");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.token.BinarySecurityTokenTest </h4><pre class="type-8 type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * A unit test for a custom BinarySecurityToken
 */
@Test public void testCustomToken() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  BinarySecurity bst=new BinarySecurity(doc);
  bst.setToken("12435677".getBytes());
  WSSecurityUtil.prependChildElement(secHeader.getSecurityHeader(),bst.getElement());
  if (LOG.isDebugEnabled()) {
    LOG.debug("Custom Token output");
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  WSSecurityEngine secEngine=new WSSecurityEngine();
  secEngine.setWssConfig(WSSConfig.getNewInstance());
  try {
    secEngine.processSecurityHeader(doc,null,null,crypto);
    fail("Expected failure on no ValueType");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  bst=new BinarySecurity(doc);
  bst.setToken("12435677".getBytes());
  bst.setValueType("http://custom_value_Type");
  secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecurityUtil.prependChildElement(secHeader.getSecurityHeader(),bst.getElement());
  WSHandlerResult results=secEngine.processSecurityHeader(doc,null,null,crypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.BST).get(0);
  BinarySecurity token=(BinarySecurity)actionResult.get(WSSecurityEngineResult.TAG_BINARY_SECURITY_TOKEN);
  assertNotNull(token);
}

</code></pre>

<br>
<pre class="type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * A unit test for an X.509 BinarySecurityToken
 */
@Test public void testX509() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  X509Security bst=new X509Security(doc);
  CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
  cryptoType.setAlias("wss40");
  X509Certificate[] certs=crypto.getX509Certificates(cryptoType);
  bst.setX509Certificate(certs[0]);
  WSSecurityUtil.prependChildElement(secHeader.getSecurityHeader(),bst.getElement());
  if (LOG.isDebugEnabled()) {
    LOG.debug("BST output");
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  WSSecurityEngine secEngine=new WSSecurityEngine();
  secEngine.setWssConfig(WSSConfig.getNewInstance());
  WSHandlerResult results=secEngine.processSecurityHeader(doc,null,null,crypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.BST).get(0);
  BinarySecurity token=(BinarySecurity)actionResult.get(WSSecurityEngineResult.TAG_BINARY_SECURITY_TOKEN);
  assertNotNull(token);
  BinarySecurity clone=new BinarySecurity(token.getElement(),new BSPEnforcer(true));
  assertTrue(clone.equals(token));
  assertTrue(clone.hashCode() == token.hashCode());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.token.DerivedKeyTokenTest </h4><pre class="type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHashcode() throws Exception {
  assertEquals(token.hashCode(),tokenEqual.hashCode());
  assertFalse(token.hashCode() == tokenNotEqual.hashCode());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.token.ReferenceTest </h4><pre class="type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHashcode() throws Exception {
  assertEquals(ref.hashCode(),refEqual.hashCode());
  assertFalse(ref.hashCode() == refNotEqual.hashCode());
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testConstructor() throws Exception {
  try {
    new Reference((org.w3c.dom.Element)null);
    fail("Expected failure on null Element passed to ctor");
  }
 catch (  final WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  try {
    new Reference(createReferenceDocument(BOGUS_REFERENCE_TEMPLATE,"foo","bar").getDocumentElement());
    fail("Expected failure on bogus template");
  }
 catch (  final WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
  new Reference(createReferenceDocument(TEST_REFERENCE_TEMPLATE,"foo","bar"));
  new Reference(createReferenceDocument(TEST_REFERENCE_TEMPLATE,"foo","bar").getDocumentElement());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.token.SecurityTokenReferenceTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for a SecurityTokenReference having an Embedded Child, which in turn has a
 * SecurityTokenReference child.
 */
@Test public void testEmbeddedSTRChild() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  SecurityTokenReference str=new SecurityTokenReference(doc);
  str.addWSSENamespace();
  Element strElement=str.getElement();
  Element embedded=doc.createElementNS(WSConstants.WSSE_NS,"wsse:Embedded");
  str=new SecurityTokenReference(doc);
  str.addWSSENamespace();
  embedded.appendChild(str.getElement());
  strElement.appendChild(embedded);
  if (LOG.isDebugEnabled()) {
    LOG.debug(DOM2Writer.nodeToString(strElement));
  }
  BSPEnforcer bspEnforcer=new BSPEnforcer();
  try {
    new SecurityTokenReference(strElement,bspEnforcer);
    fail("Failure expected on an Embedded Child with a SecurityTokenReference child");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  bspEnforcer.setIgnoredBSPRules(Collections.singletonList(BSPRule.R3056));
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for a SecurityTokenReference having a Key Identifier with a bad EncodingType
 */
@Test public void testKeyIdentifierBadEncodingType() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  SecurityTokenReference str=new SecurityTokenReference(doc);
  str.addWSSENamespace();
  Element strElement=str.getElement();
  Element keyId=doc.createElementNS(WSConstants.WSSE_NS,"wsse:KeyIdentifier");
  keyId.setAttributeNS(null,"ValueType",SecurityTokenReference.ENC_KEY_SHA1_URI);
  keyId.setAttributeNS(null,"EncodingType","http://bad_encoding");
  keyId.appendChild(doc.createTextNode("#123"));
  strElement.appendChild(keyId);
  if (LOG.isDebugEnabled()) {
    LOG.debug(str.toString());
  }
  BSPEnforcer bspEnforcer=new BSPEnforcer();
  try {
    new SecurityTokenReference(strElement,bspEnforcer);
    fail("Failure expected on a Key Identifier with a Bad EncodingType");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  bspEnforcer.setIgnoredBSPRules(Collections.singletonList(BSPRule.R3071));
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for a SecurityTokenReference having a Key Identifier with no EncodingType
 */
@Test public void testKeyIdentifierNoEncodingType() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  SecurityTokenReference str=new SecurityTokenReference(doc);
  str.addWSSENamespace();
  Element strElement=str.getElement();
  Element keyId=doc.createElementNS(WSConstants.WSSE_NS,"wsse:KeyIdentifier");
  keyId.setAttributeNS(null,"ValueType",SecurityTokenReference.ENC_KEY_SHA1_URI);
  keyId.appendChild(doc.createTextNode("#123"));
  strElement.appendChild(keyId);
  if (LOG.isDebugEnabled()) {
    LOG.debug(str.toString());
  }
  BSPEnforcer bspEnforcer=new BSPEnforcer();
  try {
    new SecurityTokenReference(strElement,bspEnforcer);
    fail("Failure expected on a Key Identifier with no EncodingType");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  bspEnforcer.setIgnoredBSPRules(Collections.singletonList(BSPRule.R3070));
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for a Reference with no URI
 */
@Test public void testReferenceNoURI() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  SecurityTokenReference str=new SecurityTokenReference(doc);
  str.addWSSENamespace();
  Reference ref=new Reference(doc);
  ref.setValueType(WSConstants.WSS_ENC_KEY_VALUE_TYPE);
  ref.setURI(null);
  str.setReference(ref);
  if (LOG.isDebugEnabled()) {
    LOG.debug(str.toString());
  }
  Element strElement=str.getElement();
  try {
    new SecurityTokenReference(strElement,new BSPEnforcer(true));
    fail("Failure expected on a reference with no URI");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getMessage().contains("Reference URI is null"));
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for a SecurityTokenReference having a Key Identifier with no ValueType
 */
@Test public void testKeyIdentifierNoValueType() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  SecurityTokenReference str=new SecurityTokenReference(doc);
  str.addWSSENamespace();
  str.setKeyIdentifier(null,"#123");
  Element strElement=str.getElement();
  if (LOG.isDebugEnabled()) {
    LOG.debug(str.toString());
  }
  BSPEnforcer bspEnforcer=new BSPEnforcer();
  try {
    new SecurityTokenReference(strElement,bspEnforcer);
    fail("Failure expected on a Key Identifier with no ValueType");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  bspEnforcer.setIgnoredBSPRules(Collections.singletonList(BSPRule.R3054));
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for a SecurityTokenReference having an Embedded Child, which has multiple
 * children.
 */
@Test public void testMultipleEmbeddedChildren() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  SecurityTokenReference str=new SecurityTokenReference(doc);
  str.addWSSENamespace();
  Element strElement=str.getElement();
  Element embedded=doc.createElementNS(WSConstants.WSSE_NS,"wsse:Embedded");
  Element embedded1=doc.createElementNS(WSConstants.WSSE_NS,"wsse:Reference");
  Element embedded2=doc.createElementNS(WSConstants.WSSE_NS,"wsse:Reference");
  embedded.appendChild(embedded1);
  embedded.appendChild(embedded2);
  strElement.appendChild(embedded);
  if (LOG.isDebugEnabled()) {
    LOG.debug(DOM2Writer.nodeToString(strElement));
  }
  BSPEnforcer bspEnforcer=new BSPEnforcer();
  try {
    new SecurityTokenReference(strElement,bspEnforcer);
    fail("Failure expected on an Embedded Child with multiple children");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  bspEnforcer.setIgnoredBSPRules(Collections.singletonList(BSPRule.R3060));
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for a SecurityTokenReference having multiple data references
 */
@Test public void testMultipleChildren() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  SecurityTokenReference str=new SecurityTokenReference(doc);
  str.addWSSENamespace();
  str.setKeyIdentifierEncKeySHA1("123456");
  Element strElement=str.getElement();
  Reference ref=new Reference(doc);
  ref.setValueType(WSConstants.WSS_ENC_KEY_VALUE_TYPE);
  ref.setURI("#123");
  strElement.appendChild(ref.getElement());
  if (LOG.isDebugEnabled()) {
    LOG.debug(str.toString());
  }
  BSPEnforcer bspEnforcer=new BSPEnforcer();
  try {
    new SecurityTokenReference(strElement,bspEnforcer);
    fail("Failure expected on multiple data references");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  bspEnforcer.setIgnoredBSPRules(Collections.singletonList(BSPRule.R3061));
  new SecurityTokenReference(strElement,bspEnforcer);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.token.WCFUsernameTokenTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that adds a UserNameToken with a namespace qualified type. This should fail
 * as WSS4J rejects these tokens by default.
 */
@Test public void testNamespaceQualifiedTypeRejected() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUTMSG);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Message with UserNameToken PW Digest:");
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  try {
    verify(doc);
    fail("Failure expected on a bad password type");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.misc.FaultCodeTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for the wsse:FailedAuthentication faultcode. This will fail due to a bad password in
 * the callback handler.
 */
@Test public void testFailedAuthentication() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.addCreated();
  builder.addNonce();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document timestampedDoc=builder.build(doc,secHeader);
  try {
    verify(timestampedDoc);
    fail("Failure expected on a bad password");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
    assertEquals("The security token could not be authenticated or authorized",ex.getMessage());
    QName faultCode=new QName(WSConstants.WSSE_NS,"FailedAuthentication");
    assertTrue(ex.getFaultCode().equals(faultCode));
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for the wsse:InvalidSecurity faultcode.
 */
@Test public void testInvalidSecurity() throws Exception {
  try {
    new Reference((org.w3c.dom.Element)null);
    fail("Failure expected on processing the security header");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
    assertEquals("<Reference> token could not be retrieved",ex.getMessage());
    QName faultCode=new QName(WSConstants.WSSE_NS,"InvalidSecurity");
    assertTrue(ex.getFaultCode().equals(faultCode));
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for the wsse:MessageExpired faultcode. This will fail due to the argument
 * passed to setTimeToLive.
 */
@Test public void testMessageExpired() throws Exception {
  WSSecTimestamp builder=new WSSecTimestamp();
  builder.setTimeToLive(-1);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document timestampedDoc=builder.build(doc,secHeader);
  try {
    verify(timestampedDoc);
    fail("Failure expected on an expired message");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.MESSAGE_EXPIRED);
    assertEquals("Invalid timestamp: The message timestamp has expired",ex.getMessage());
    QName faultCode=new QName(WSConstants.WSSE_NS,"MessageExpired");
    assertTrue(ex.getFaultCode().equals(faultCode));
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for the wsse:FailedCheck faultcode. This will fail due to a bad password in
 * the callback handler.
 */
@Test public void testFailedCheck() throws Exception {
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("wss40","security");
  builder.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document encryptedDoc=builder.build(doc,crypto,secHeader);
  try {
    verify(encryptedDoc);
    fail("Failure expected with a bad password");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_CHECK);
    assertEquals("The private key for the supplied alias does not exist in the keystore",ex.getMessage());
    QName faultCode=new QName(WSConstants.WSSE_NS,"FailedCheck");
    assertTrue(ex.getFaultCode().equals(faultCode));
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for the wsse:UnsupportedAlgorithm faultcode. This will fail due to the argument
 * passed to getCipherInstance.
 */
@Test public void testUnsupportedAlgorithm() throws Exception {
  try {
    secEngine.getWssConfig();
    KeyUtils.getCipherInstance("Bad Algorithm");
    fail("Failure expected on an unsupported algorithm");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.UNSUPPORTED_ALGORITHM);
    assertEquals("unsupported key transport encryption algorithm: No such algorithm: Bad Algorithm",ex.getMessage());
    QName faultCode=new QName(WSConstants.WSSE_NS,"UnsupportedAlgorithm");
    assertTrue(ex.getFaultCode().equals(faultCode));
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for the wsse:InvalidSecurityToken faultcode. This will fail due to the fact
 * that a null username is used.
 */
@Test public void testInvalidSecurityToken() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.addCreated();
  builder.addNonce();
  builder.setUserInfo(null,"security");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  builder.build(doc,secHeader);
  try {
    new UsernameToken(doc.getDocumentElement(),false,new BSPEnforcer());
    fail("Failure expected on an invalid security token");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY_TOKEN);
    assertEquals("Bad element, expected \"{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}UsernameToken\" while got \"{http://schemas.xmlsoap.org/soap/envelope/}Envelope\"",ex.getMessage());
    QName faultCode=new QName(WSConstants.WSSE_NS,"InvalidSecurityToken");
    assertTrue(ex.getFaultCode().equals(faultCode));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.misc.PrincipalTest </h4><pre class="type-3 type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test the principal that is created after processing (and explicitly validating)
 * a BinarySecurityToken.
 */
@Test public void testBinarySecurityToken() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  X509Security bst=new X509Security(doc);
  CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
  cryptoType.setAlias("wss40");
  Crypto crypto=CryptoFactory.getInstance("wss40.properties");
  X509Certificate[] certs=crypto.getX509Certificates(cryptoType);
  bst.setX509Certificate(certs[0]);
  WSSecurityUtil.prependChildElement(secHeader.getSecurityHeader(),bst.getElement());
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(doc,new DummyValidator(),WSConstants.BINARY_TOKEN,crypto);
  List<WSSecurityEngineResult> bstResults=results.getActionResults().get(WSConstants.BST);
  WSSecurityEngineResult actionResult=bstResults.get(0);
  BinarySecurity token=(BinarySecurity)actionResult.get(WSSecurityEngineResult.TAG_BINARY_SECURITY_TOKEN);
  assertNotNull(token);
  Principal principal=(Principal)actionResult.get(WSSecurityEngineResult.TAG_PRINCIPAL);
  assertTrue(principal instanceof SAMLTokenPrincipal);
  assertTrue(principal.getName().contains("uid=joe"));
  assertTrue(((SAMLTokenPrincipal)principal).getToken() != null);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.misc.SecurityHeaderTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for processing multiple security headers with the same actor
 */
@Test public void testDuplicateActor() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(DUPLICATE_ACTOR_MSG);
  try {
    secEngine.processSecurityHeader(doc,"user",null,null);
    fail("Failure expected on a duplicate actor");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for processing multiple security headers with the same (null) actor
 */
@Test public void testDuplicateNullActor() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(DUPLICATE_NULL_ACTOR_MSG);
  try {
    secEngine.processSecurityHeader(doc,null,null,null);
    fail("Failure expected on a null actor");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.saml.SamlAlgorithmSuiteTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testC14nMethod() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("16c73ab6-b892-458f-abf5-2f875f74882e","security",crypto,false,WSConstants.C14N_EXCL_WITH_COMMENTS,WSConstants.RSA_SHA1);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,samlAssertion,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  Element securityHeader=WSSecurityUtil.getSecurityHeader(signedDoc,null);
  AlgorithmSuite algorithmSuite=createAlgorithmSuite();
  try {
    verify(securityHeader,algorithmSuite,crypto);
    fail("Expected failure as C14n algorithm is not allowed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  algorithmSuite.addC14nAlgorithm(WSConstants.C14N_EXCL_WITH_COMMENTS);
  verify(securityHeader,algorithmSuite,crypto);
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignedSAML11Assertion() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("16c73ab6-b892-458f-abf5-2f875f74882e","security",crypto,false);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,samlAssertion,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  Element securityHeader=WSSecurityUtil.getSecurityHeader(signedDoc,null);
  AlgorithmSuite algorithmSuite=createAlgorithmSuite();
  verify(securityHeader,algorithmSuite,crypto);
  algorithmSuite.setMinimumAsymmetricKeyLength(1024);
  try {
    verify(securityHeader,algorithmSuite,crypto);
    fail("Expected failure as 512-bit keys are not allowed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDSASignedSAML11Assertion() throws Exception {
  Crypto dsaCrypto=CryptoFactory.getInstance("wss40.properties");
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40DSA","security",dsaCrypto,false);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,samlAssertion,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  Element securityHeader=WSSecurityUtil.getSecurityHeader(signedDoc,null);
  AlgorithmSuite algorithmSuite=createAlgorithmSuite();
  try {
    verify(securityHeader,algorithmSuite,dsaCrypto);
    fail("Expected failure as DSA is not allowed");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
  }
  algorithmSuite.addSignatureMethod(WSConstants.DSA);
  verify(securityHeader,algorithmSuite,dsaCrypto);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.saml.SamlConditionsTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML2StaleIssueInstant() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  DateTime issueInstant=new DateTime();
  issueInstant=issueInstant.minusMinutes(31);
  samlAssertion.getSaml2().setIssueInstant(issueInstant);
  samlAssertion.getSaml2().getConditions().setNotOnOrAfter(null);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 2 Authn Assertion (sender vouches):");
    String outputString=XMLUtils.prettyDocumentToString(unsignedDoc);
    LOG.debug(outputString);
  }
  try {
    verify(unsignedDoc);
    fail("Failure expected in processing a stale SAML Assertion");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getMessage().contains("SAML token security failure"));
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML1StaleIssueInstant() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  DateTime issueInstant=new DateTime();
  issueInstant=issueInstant.minusMinutes(31);
  samlAssertion.getSaml1().setIssueInstant(issueInstant);
  samlAssertion.getSaml1().getConditions().setNotOnOrAfter(null);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 1 Authn Assertion (sender vouches):");
    String outputString=XMLUtils.prettyDocumentToString(unsignedDoc);
    LOG.debug(outputString);
  }
  try {
    verify(unsignedDoc);
    fail("Failure expected in processing a stale SAML Assertion");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getMessage().contains("SAML token security failure"));
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML2FutureIssueInstant() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  DateTime issueInstant=new DateTime();
  issueInstant=issueInstant.plusMinutes(60);
  samlAssertion.getSaml2().setIssueInstant(issueInstant);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 2 Authn Assertion (sender vouches):");
    String outputString=XMLUtils.prettyDocumentToString(unsignedDoc);
    LOG.debug(outputString);
  }
  try {
    verify(unsignedDoc);
    fail("Failure expected in processing the SAML Conditions element");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getMessage().contains("SAML token security failure"));
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML2AudienceRestrictionSeparateRestrictionsValidation() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  ConditionsBean conditions=new ConditionsBean();
  conditions.setTokenPeriodMinutes(5);
  List<AudienceRestrictionBean> audiencesRestrictions=new ArrayList<>();
  AudienceRestrictionBean audienceRestrictionBean=new AudienceRestrictionBean();
  audienceRestrictionBean.setAudienceURIs(Collections.singletonList("http://apache.org/one"));
  audiencesRestrictions.add(audienceRestrictionBean);
  audienceRestrictionBean=new AudienceRestrictionBean();
  audienceRestrictionBean.setAudienceURIs(Collections.singletonList("http://apache.org/two"));
  audiencesRestrictions.add(audienceRestrictionBean);
  conditions.setAudienceRestrictions(audiencesRestrictions);
  callbackHandler.setConditions(conditions);
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(unsignedDoc);
  assertTrue(outputString.contains("AudienceRestriction"));
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  List<String> audiences=new ArrayList<>();
  audiences.add("http://apache.org/three");
  WSSecurityEngine newEngine=new WSSecurityEngine();
  RequestData data=new RequestData();
  data.setAudienceRestrictions(audiences);
  data.setValidateSamlSubjectConfirmation(false);
  try {
    newEngine.processSecurityHeader(doc,data);
    fail("Failure expected on a bad audience restriction");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getMessage().contains("SAML token security failure"));
  }
  audiences.add("http://apache.org/one");
  data.setAudienceRestrictions(audiences);
  newEngine.processSecurityHeader(doc,data);
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML1AudienceRestrictionVerification() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  ConditionsBean conditions=new ConditionsBean();
  conditions.setTokenPeriodMinutes(5);
  List<String> audiences=new ArrayList<>();
  audiences.add("http://apache.org/one");
  audiences.add("http://apache.org/two");
  AudienceRestrictionBean audienceRestrictionBean=new AudienceRestrictionBean();
  audienceRestrictionBean.setAudienceURIs(audiences);
  conditions.setAudienceRestrictions(Collections.singletonList(audienceRestrictionBean));
  callbackHandler.setConditions(conditions);
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(unsignedDoc);
  assertTrue(outputString.contains("AudienceRestriction"));
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  audiences.clear();
  audiences.add("http://apache.org/three");
  WSSecurityEngine newEngine=new WSSecurityEngine();
  RequestData data=new RequestData();
  data.setAudienceRestrictions(audiences);
  data.setValidateSamlSubjectConfirmation(false);
  try {
    newEngine.processSecurityHeader(doc,data);
    fail("Failure expected on a bad audience restriction");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getMessage().contains("SAML token security failure"));
  }
  audiences.add("http://apache.org/one");
  data.setAudienceRestrictions(audiences);
  newEngine.processSecurityHeader(doc,data);
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML2AudienceRestrictionVerification() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  ConditionsBean conditions=new ConditionsBean();
  conditions.setTokenPeriodMinutes(5);
  List<String> audiences=new ArrayList<>();
  audiences.add("http://apache.org/one");
  audiences.add("http://apache.org/two");
  AudienceRestrictionBean audienceRestrictionBean=new AudienceRestrictionBean();
  audienceRestrictionBean.setAudienceURIs(audiences);
  conditions.setAudienceRestrictions(Collections.singletonList(audienceRestrictionBean));
  callbackHandler.setConditions(conditions);
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(unsignedDoc);
  assertTrue(outputString.contains("AudienceRestriction"));
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  audiences.clear();
  audiences.add("http://apache.org/three");
  WSSecurityEngine newEngine=new WSSecurityEngine();
  RequestData data=new RequestData();
  data.setAudienceRestrictions(audiences);
  data.setValidateSamlSubjectConfirmation(false);
  try {
    newEngine.processSecurityHeader(doc,data);
    fail("Failure expected on a bad audience restriction");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getMessage().contains("SAML token security failure"));
  }
  audiences.add("http://apache.org/one");
  data.setAudienceRestrictions(audiences);
  newEngine.processSecurityHeader(doc,data);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.saml.SamlNegativeTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates a signed SAML 1.1 authentication assertion that uses holder-of-key, but
 * does not include a KeyInfo in the Subject, and hence will fail processing.
 */
@Test public void testHOKNoKeyInfo() throws Exception {
  SAML1HOKNoKeyInfoCallbackHandler callbackHandler=new SAML1HOKNoKeyInfoCallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document signedDoc=wsSign.build(doc,samlAssertion,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 1.1 Authn Assertion (key holder):");
    LOG.debug(outputString);
  }
  try {
    verify(signedDoc,trustCrypto);
    fail("Expected failure on a holder-of-key confirmation method with no KeyInfo");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates a SAML 1.1 authentication assertion that uses holder-of-key, but is
 * not signed, and hence will fail processing.
 */
@Test public void testHOKNotSigned() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlCallback.setIssuer("www.example.com");
  samlCallback.setIssuerCrypto(issuerCrypto);
  samlCallback.setIssuerKeyName("wss40_server");
  samlCallback.setIssuerKeyPassword("security");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document signedDoc=wsSign.build(doc,samlAssertion,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 1.1 Authn Assertion (unsigned key holder):");
    LOG.debug(outputString);
  }
  try {
    verify(signedDoc,trustCrypto);
    fail("Expected failure on an unsigned assertion with holder-of-key confirmation method");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getMessage().contains("SAML token security failure"));
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 2 sender-vouches
 * authentication assertion. The assertion is altered and so the signature validation
 * should fail.
 */
@Test public void testSAML2AuthnAssertionModified() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,null,samlAssertion,userCrypto,"wss40","security",secHeader);
  Element envelope=signedDoc.getDocumentElement();
  NodeList list=envelope.getElementsByTagNameNS(WSConstants.SAML2_NS,"Assertion");
  Element assertionElement=(Element)list.item(0);
  assertionElement.setAttributeNS(null,"MinorVersion","5");
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 2 Authn Assertion (sender vouches):");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  try {
    verify(signedDoc,trustCrypto);
    fail("Failure expected on a modified SAML Assertion");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_CHECK);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates a signed SAML 1.1 Assertion using HOK, but then modifies the signature
 * object by replacing the enveloped transform with the exclusive c14n transform.
 * The signature validation should then fail - the enveloped transform is mandatory for
 * a signed assertion.
 */
@Test public void testSAML1SignedKeyHolderSigModified() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,samlAssertion,secHeader);
  Element envelope=signedDoc.getDocumentElement();
  NodeList list=envelope.getElementsByTagNameNS(WSConstants.SAML_NS,"Assertion");
  Element assertionElement=(Element)list.item(0);
  list=assertionElement.getElementsByTagNameNS(WSConstants.SIG_NS,"Signature");
  Element sigElement=(Element)list.item(0);
  list=sigElement.getElementsByTagNameNS(WSConstants.SIG_NS,"Transform");
  Element transformElement=(Element)list.item(0);
  transformElement.setAttributeNS(null,"Algorithm",WSConstants.C14N_EXCL_OMIT_COMMENTS);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed (modified) SAML message (key holder):");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  try {
    verify(signedDoc,trustCrypto);
    fail("Expected failure on a modified signature");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 2 authentication assertion, but it
 * is rejected in processing as the signature on the assertion is not trusted.
 */
@Test public void testSAML2TrustFailure() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("16c73ab6-b892-458f-abf5-2f875f74882e","security",CryptoFactory.getInstance("crypto.properties"),false);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256");
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Untrusted signed SAML 2 Authn Assertion (key holder):");
    LOG.debug(outputString);
  }
  try {
    verify(signedDoc,trustCrypto);
    fail("Failure expected on an untrusted signed assertion");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates a signed SAML 2 Assertion using HOK, but then modifies the assertion.
 * The signature verification should then fail.
 */
@Test public void testSAML2SignedKeyHolderKeyModified() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,samlAssertion,secHeader);
  Element envelope=signedDoc.getDocumentElement();
  NodeList list=envelope.getElementsByTagNameNS(WSConstants.SAML2_NS,"Assertion");
  Element assertionElement=(Element)list.item(0);
  assertionElement.setAttributeNS(null,"MinorVersion","5");
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed (modified) SAML message (key holder):");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  try {
    verify(signedDoc,trustCrypto);
    fail("Expected failure on a modified signature");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.saml.SamlReferenceTest </h4><pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an signed SAML 2 holder-of-key assertion,
 * where the SecurityTokenReference that points to the SAML Assertion uses a KeyIdentifier,
 * and not a direct reference. This tests that we can process a KeyIdentifier to a SAML
 * Assertion in the KeyInfo of a Signature.
 */
@Test @SuppressWarnings("unchecked") public void testSAML2HOKKeyIdentifier() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(doc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML2 message Key Identifier (holder-of-key):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains(WSConstants.WSS_SAML2_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML2_TOKEN_TYPE));
  WSHandlerResult results=verify(signedDoc,trustCrypto,null);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * The body of the SOAP request is encrypted using a secret key, which is in turn encrypted
 * using the certificate embedded in the SAML assertion and referenced using Direct
 * Reference. Unlike the SAML 1.1 case, this is spec-compliant. This tests that we can process
 * a Direct Reference to a SAML Assertion in the KeyInfo of an EncryptedKey.
 */
@Test @SuppressWarnings("unchecked") public void testSAML2HOKEKDirectReference() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  Node assertionNode=samlAssertion.toDOM(doc);
  secHeader.insertSecurityHeader();
  secHeader.getSecurityHeader().appendChild(assertionNode);
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("wss40");
  builder.setSymmetricEncAlgorithm(WSConstants.TRIPLE_DES);
  builder.setKeyIdentifierType(WSConstants.CUSTOM_SYMM_SIGNING);
  builder.setCustomEKTokenValueType(WSConstants.WSS_SAML2_KI_VALUE_TYPE);
  builder.setCustomEKTokenId(samlAssertion.getId());
  builder.prepare(doc,userCrypto);
  WSEncryptionPart encP=new WSEncryptionPart("add","http://ws.apache.org/counter/counter_port_type","Element");
  builder.getParts().add(encP);
  Element refElement=builder.encrypt();
  builder.addInternalRefElement(refElement);
  builder.appendToHeader(secHeader);
  String outputString=XMLUtils.prettyDocumentToString(doc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Encrypted SAML 2 message Direct Reference (holder-of-key):");
    LOG.debug(outputString);
  }
  assertFalse(outputString.contains(WSConstants.WSS_SAML2_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML2_TOKEN_TYPE));
  WSHandlerResult results=verify(doc,trustCrypto,userCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body/add",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an signed SAML 1.1 sender-vouches assertion,
 * where the SecurityTokenReference that points to the SAML Assertion uses a direct reference,
 * and not a KeyIdentifier. This method is not spec compliant and is included to make sure
 * we can process third-party Assertions referenced in this way.
 */
@Test @SuppressWarnings("unchecked") public void testSAML1SVDirectReference() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  wsSign.setUseDirectReferenceToAssertion(true);
  Document signedDoc=wsSign.build(doc,null,samlAssertion,crypto,"16c73ab6-b892-458f-abf5-2f875f74882e","security",secHeader);
  String outputString=XMLUtils.prettyDocumentToString(doc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML message Direct Reference (sender vouches):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains(WSConstants.WSS_SAML_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML_TOKEN_TYPE));
  WSHandlerResult results=verify(signedDoc,crypto,null);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 2);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
  wsDataRef=refs.get(1);
  xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Header/wsse:Security/saml1:Assertion",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an signed SAML 2 sender-vouches assertion,
 * where the SecurityTokenReference that points to the SAML Assertion uses a KeyIdentifier,
 * and not a direct reference.
 */
@Test @SuppressWarnings("unchecked") public void testSAML2SVKeyIdentifier() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document signedDoc=wsSign.build(doc,null,samlAssertion,crypto,"16c73ab6-b892-458f-abf5-2f875f74882e","security",secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML2 message Key Identifier (sender vouches):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains(WSConstants.WSS_SAML2_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML2_TOKEN_TYPE));
  WSHandlerResult results=verify(signedDoc,crypto,null);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 2);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
  wsDataRef=refs.get(1);
  xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Header/wsse:Security/saml2:Assertion",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * The body of the SOAP request is encrypted using a secret key, which is in turn encrypted
 * using the certificate embedded in the SAML assertion and referenced using Direct
 * Reference. This method is not spec compliant and is included to make sure we can process
 * third-party Assertions referenced in this way. This tests that we can process a Direct
 * Reference to a SAML Assertion in the KeyInfo of an EncryptedKey.
 */
@Test @SuppressWarnings("unchecked") public void testSAML1HOKEKDirectReference() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  Node assertionNode=samlAssertion.toDOM(doc);
  secHeader.insertSecurityHeader();
  secHeader.getSecurityHeader().appendChild(assertionNode);
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("wss40");
  builder.setSymmetricEncAlgorithm(WSConstants.TRIPLE_DES);
  builder.setKeyIdentifierType(WSConstants.CUSTOM_SYMM_SIGNING);
  builder.setCustomEKTokenValueType(WSConstants.WSS_SAML_KI_VALUE_TYPE);
  builder.setCustomEKTokenId(samlAssertion.getId());
  builder.prepare(doc,userCrypto);
  WSEncryptionPart encP=new WSEncryptionPart("add","http://ws.apache.org/counter/counter_port_type","Element");
  builder.getParts().add(encP);
  Element refElement=builder.encrypt();
  builder.addInternalRefElement(refElement);
  builder.appendToHeader(secHeader);
  String outputString=XMLUtils.prettyDocumentToString(doc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Encrypted SAML 1.1 message Direct Reference (holder-of-key):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains(WSConstants.WSS_SAML_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML_TOKEN_TYPE));
  WSHandlerResult results=verify(doc,trustCrypto,userCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body/add",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an signed SAML 1.1 sender-vouches assertion,
 * where the SecurityTokenReference that points to the SAML Assertion uses a KeyIdentifier,
 * and not a direct reference.
 */
@Test @SuppressWarnings("unchecked") public void testSAML1SVKeyIdentifier() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document signedDoc=wsSign.build(doc,null,samlAssertion,crypto,"16c73ab6-b892-458f-abf5-2f875f74882e","security",secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML message Key Identifier (sender vouches):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains(WSConstants.WSS_SAML_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML_TOKEN_TYPE));
  WSHandlerResult results=verify(signedDoc,crypto,null);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 2);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
  wsDataRef=refs.get(1);
  xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Header/wsse:Security/saml1:Assertion",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * The body of the SOAP request is encrypted using a secret key, which is in turn encrypted
 * using the certificate embedded in the SAML assertion and referenced using a Key Identifier.
 * This tests that we can process a KeyIdentifier to a SAML Assertion in the KeyInfo of an
 * EncryptedKey.
 */
@Test @SuppressWarnings("unchecked") public void testSAML2HOKEKKeyIdentifier() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  Node assertionNode=samlAssertion.toDOM(doc);
  secHeader.insertSecurityHeader();
  secHeader.getSecurityHeader().appendChild(assertionNode);
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("wss40");
  builder.setSymmetricEncAlgorithm(WSConstants.TRIPLE_DES);
  builder.setKeyIdentifierType(WSConstants.CUSTOM_KEY_IDENTIFIER);
  builder.setCustomEKTokenValueType(WSConstants.WSS_SAML2_KI_VALUE_TYPE);
  builder.setCustomEKTokenId(samlAssertion.getId());
  builder.prepare(doc,userCrypto);
  WSEncryptionPart encP=new WSEncryptionPart("add","http://ws.apache.org/counter/counter_port_type","Element");
  builder.getParts().add(encP);
  Element refElement=builder.encrypt();
  builder.addInternalRefElement(refElement);
  builder.appendToHeader(secHeader);
  String outputString=XMLUtils.prettyDocumentToString(doc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Encrypted SAML 2 message Key Identifier (holder-of-key):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains(WSConstants.WSS_SAML2_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML2_TOKEN_TYPE));
  WSHandlerResult results=verify(doc,trustCrypto,userCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body/add",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * The body of the SOAP request is encrypted using a secret key, which is in turn encrypted
 * using the certificate embedded in the SAML assertion and referenced using a Key Identifier.
 * This tests that we can process a KeyIdentifier to a SAML Assertion in the KeyInfo of an
 * EncryptedKey.
 */
@Test @SuppressWarnings("unchecked") public void testSAML1HOKEKKeyIdentifier() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  Node assertionNode=samlAssertion.toDOM(doc);
  secHeader.insertSecurityHeader();
  secHeader.getSecurityHeader().appendChild(assertionNode);
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("wss40");
  builder.setSymmetricEncAlgorithm(WSConstants.TRIPLE_DES);
  builder.setKeyIdentifierType(WSConstants.CUSTOM_KEY_IDENTIFIER);
  builder.setCustomEKTokenValueType(WSConstants.WSS_SAML_KI_VALUE_TYPE);
  builder.setCustomEKTokenId(samlAssertion.getId());
  builder.prepare(doc,userCrypto);
  WSEncryptionPart encP=new WSEncryptionPart("add","http://ws.apache.org/counter/counter_port_type","Element");
  builder.getParts().add(encP);
  Element refElement=builder.encrypt();
  builder.addInternalRefElement(refElement);
  builder.appendToHeader(secHeader);
  String outputString=XMLUtils.prettyDocumentToString(doc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Encrypted SAML 1.1 message Key Identifier (holder-of-key):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains(WSConstants.WSS_SAML_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML_TOKEN_TYPE));
  WSHandlerResult results=verify(doc,trustCrypto,userCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body/add",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an signed SAML 2 sender-vouches assertion,
 * where the SecurityTokenReference that points to the SAML Assertion uses a direct reference,
 * and not a KeyIdentifier. Unlike the SAML 1.1 case, this is spec-compliant.
 */
@Test @SuppressWarnings("unchecked") public void testSAML2SVDirectReference() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  wsSign.setUseDirectReferenceToAssertion(true);
  Document signedDoc=wsSign.build(doc,null,samlAssertion,crypto,"16c73ab6-b892-458f-abf5-2f875f74882e","security",secHeader);
  String outputString=XMLUtils.prettyDocumentToString(doc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML2 message Direct Reference (sender vouches):");
    LOG.debug(outputString);
  }
  assertFalse(outputString.contains(WSConstants.WSS_SAML2_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML2_TOKEN_TYPE));
  WSHandlerResult results=verify(signedDoc,crypto,null);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 2);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
  wsDataRef=refs.get(1);
  xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Header/wsse:Security/saml2:Assertion",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an signed SAML 1.1 holder-of-key assertion,
 * where the SecurityTokenReference that points to the SAML Assertion uses a KeyIdentifier,
 * and not a direct reference. This tests that we can process a KeyIdentifier to a SAML
 * Assertion in the KeyInfo of a Signature.
 */
@Test @SuppressWarnings("unchecked") public void testSAML1HOKKeyIdentifier() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(doc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML message Key Identifier (holder-of-key):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains(WSConstants.WSS_SAML_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML_TOKEN_TYPE));
  WSHandlerResult results=verify(signedDoc,trustCrypto,null);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an signed SAML 2 holder-of-key assertion,
 * where the SecurityTokenReference that points to the SAML Assertion uses a direct reference,
 * and not a KeyIdentifier. Unlike the SAML 1.1 case, this is spec-compliant. This tests that
 * we can process a Direct Reference to a SAML Assertion in the KeyInfo of a Signature.
 */
@Test @SuppressWarnings("unchecked") public void testSAML2HOKDirectReference() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256");
  wsSign.setUseDirectReferenceToAssertion(true);
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(doc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML2 message Direct Reference (holder-of-key):");
    LOG.debug(outputString);
  }
  assertFalse(outputString.contains(WSConstants.WSS_SAML2_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML2_TOKEN_TYPE));
  WSHandlerResult results=verify(signedDoc,trustCrypto,null);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an signed SAML 1.1 holder-of-key assertion,
 * where the SecurityTokenReference that points to the SAML Assertion uses a direct reference,
 * and not a KeyIdentifier. This method is not spec compliant and is included to make sure
 * we can process third-party Assertions referenced in this way. This tests that we can
 * process a Direct Reference to a SAML Assertion in the KeyInfo of a Signature.
 */
@Test @SuppressWarnings("unchecked") public void testSAML1HOKDirectReference() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256");
  wsSign.setUseDirectReferenceToAssertion(true);
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(doc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML message Direct Reference (holder-of-key):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains(WSConstants.WSS_SAML_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML_TOKEN_TYPE));
  WSHandlerResult results=verify(signedDoc,trustCrypto,null);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.saml.SamlTokenCustomSignatureTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 2.0 authentication assertion.
 */
@Test public void testSAML2AuthnAssertion() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_BEARER);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  Element assertionElement=samlAssertion.toDOM(doc);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  secHeader.getSecurityHeader().appendChild(assertionElement);
  signAssertion(doc,assertionElement);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 2.0 Authn Assertion (Bearer):");
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  try {
    verify(doc);
    fail("Failure expected on a signature that doesn't conform with the signature profile");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
  verifyWithoutProfile(doc);
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 1.1 authentication assertion.
 */
@Test public void testSAML1AuthnAssertion() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_BEARER);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  Element assertionElement=samlAssertion.toDOM(doc);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  secHeader.getSecurityHeader().appendChild(assertionElement);
  signAssertion(doc,assertionElement);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 1.1 Authn Assertion (Bearer):");
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  try {
    verify(doc);
    fail("Failure expected on a signature that doesn't conform with the signature profile");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
  verifyWithoutProfile(doc);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.saml.SamlTokenDerivedTest </h4><pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 1.1 authentication assertion
 * using a derived key.
 */
@Test @SuppressWarnings("unchecked") public void testSAML1AuthnAssertionDerived() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  SecurityTokenReference secRefSaml=createSamlSTR(doc,samlAssertion,WSSConfig.getNewInstance());
  secHeader.getSecurityHeader().appendChild(samlAssertion.toDOM(doc));
  secHeader.getSecurityHeader().appendChild(secRefSaml.getElement());
  WSSecDKSign sigBuilder=createDKSign(doc,secRefSaml);
  Document signedDoc=sigBuilder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 1.1 Authn Assertion Derived (sender vouches):");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 2);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
  wsDataRef=refs.get(1);
  xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Header/wsse:Security/saml1:Assertion",xpath);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.saml.SamlTokenHOKTest </h4><pre class="type-3 type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 1.1 authentication assertion.
 */
@Test public void testSAML1AuthnAssertion() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("16c73ab6-b892-458f-abf5-2f875f74882e","security",crypto,false);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,samlAssertion,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 1.1 Authn Assertion (holder-of-key):");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  assertNotNull(receivedSamlAssertion.assertionToString());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.saml.SamlTokenSVTest </h4><pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 2 attribute assertion.
 */
@Test @SuppressWarnings("unchecked") public void testSAML2AttrAssertion() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.ATTR);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,null,samlAssertion,crypto,"16c73ab6-b892-458f-abf5-2f875f74882e","security",secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 2 Attr Assertion (sender vouches):");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 2);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
  wsDataRef=refs.get(1);
  xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Header/wsse:Security/saml2:Assertion",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 1.1 attribute assertion.
 */
@Test @SuppressWarnings("unchecked") public void testSAML1AttrAssertion() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.ATTR);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,null,samlAssertion,crypto,"16c73ab6-b892-458f-abf5-2f875f74882e","security",secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 1.1 Attr Assertion (sender vouches):");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 2);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
  wsDataRef=refs.get(1);
  xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Header/wsse:Security/saml1:Assertion",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 1.1 authentication assertion.
 */
@Test @SuppressWarnings("unchecked") public void testSAML1AuthnAssertion() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,null,samlAssertion,crypto,"16c73ab6-b892-458f-abf5-2f875f74882e","security",secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 1.1 Authn Assertion (sender vouches):");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 2);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
  wsDataRef=refs.get(1);
  xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Header/wsse:Security/saml1:Assertion",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 2 authentication assertion.
 */
@Test @SuppressWarnings("unchecked") public void testSAML2AuthnAssertion() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,null,samlAssertion,crypto,"16c73ab6-b892-458f-abf5-2f875f74882e","security",secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 2 Authn Assertion (sender vouches):");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 2);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
  wsDataRef=refs.get(1);
  xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Header/wsse:Security/saml2:Assertion",xpath);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.saml.SamlTokenTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUnsignedBearer() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_BEARER);
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  WSSecurityEngine newEngine=new WSSecurityEngine();
  try {
    newEngine.processSecurityHeader(unsignedDoc,null,null,null);
    fail("Failure expected on an unsigned bearer token");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
  WSSConfig config=WSSConfig.getNewInstance();
  SamlAssertionValidator assertionValidator=new SamlAssertionValidator();
  assertionValidator.setRequireBearerSignature(false);
  config.setValidator(WSConstants.SAML_TOKEN,assertionValidator);
  config.setValidator(WSConstants.SAML2_TOKEN,assertionValidator);
  newEngine.setWssConfig(config);
  RequestData requestData=new RequestData();
  requestData.setValidateSamlSubjectConfirmation(false);
  newEngine.processSecurityHeader(doc,requestData);
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testStandardSubjectConfirmationMethod() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  callbackHandler.setConfirmationMethod("urn:oasis:names:tc:SAML:2.0:cm:custom");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  WSSecurityEngine newEngine=new WSSecurityEngine();
  try {
    newEngine.processSecurityHeader(unsignedDoc,null,null,null);
    fail("Failure expected on an unknown subject confirmation method");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
  WSSConfig config=WSSConfig.getNewInstance();
  SamlAssertionValidator assertionValidator=new SamlAssertionValidator();
  assertionValidator.setRequireStandardSubjectConfirmationMethod(false);
  config.setValidator(WSConstants.SAML_TOKEN,assertionValidator);
  config.setValidator(WSConstants.SAML2_TOKEN,assertionValidator);
  newEngine.setWssConfig(config);
  RequestData requestData=new RequestData();
  requestData.setValidateSamlSubjectConfirmation(false);
  newEngine.processSecurityHeader(doc,requestData);
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRequiredSubjectConfirmationMethod() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSAMLToken wsSign=new WSSecSAMLToken();
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  WSSConfig config=WSSConfig.getNewInstance();
  SamlAssertionValidator assertionValidator=new SamlAssertionValidator();
  assertionValidator.setRequiredSubjectConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
  config.setValidator(WSConstants.SAML_TOKEN,assertionValidator);
  config.setValidator(WSConstants.SAML2_TOKEN,assertionValidator);
  WSSecurityEngine newEngine=new WSSecurityEngine();
  newEngine.setWssConfig(config);
  RequestData requestData=new RequestData();
  requestData.setValidateSamlSubjectConfirmation(false);
  newEngine.processSecurityHeader(doc,requestData);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_BEARER);
  samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  samlAssertion=new SamlAssertionWrapper(samlCallback);
  wsSign=new WSSecSAMLToken();
  doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  unsignedDoc=wsSign.build(doc,samlAssertion,secHeader);
  try {
    newEngine.processSecurityHeader(unsignedDoc,null,null,null);
    fail("Failure expected on an incorrect subject confirmation method");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.saml.SignedSamlTokenHOKTest </h4><pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 1.1 authentication assertion,
 * where the subject cert is referenced using a Key Value
 */
@Test @SuppressWarnings("unchecked") public void testSAML1AuthnAssertionKeyValue() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  callbackHandler.setCertIdentifier(CERT_IDENTIFIER.KEY_VALUE);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256");
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 1.1 Authn Assertion Key Value (holder-of-key):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains("KeyValue"));
  WSHandlerResult results=verify(signedDoc,userCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assert receivedSamlAssertion.isSigned();
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 2 authentication assertion.
 */
@Test @SuppressWarnings("unchecked") public void testSAML2AuthnAssertion() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256");
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML 2 Authn Assertion (key holder):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains("http://www.w3.org/2001/04/xmlenc#sha256"));
  assertTrue(outputString.contains("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256"));
  WSHandlerResult results=verify(signedDoc,trustCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test @org.junit.Ignore public void testSAML2Advice() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.ATTR);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_BEARER);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  Element adviceElement=samlAssertion.toDOM(doc);
  callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.ATTR);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  callbackHandler.setAssertionAdviceElement(adviceElement);
  samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  byte[] ephemeralKey=callbackHandler.getEphemeralKey();
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm(WSConstants.HMAC_SHA256);
  wsSign.setKeyIdentifierType(WSConstants.X509_KEY_IDENTIFIER);
  wsSign.setSecretKey(ephemeralKey);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML 2 Attr Assertion (key holder):");
    LOG.debug(outputString);
  }
  System.out.println(outputString);
  WSHandlerResult results=verify(signedDoc,trustCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedAssertion != null);
  assertTrue(receivedAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  @SuppressWarnings("unchecked") final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 2 authentication assertion,
 * where the subject cert is referenced using a Key Value
 */
@Test @SuppressWarnings("unchecked") public void testSAML2AuthnAssertionKeyValue() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
  callbackHandler.setCertIdentifier(CERT_IDENTIFIER.KEY_VALUE);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256");
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 2 Authn Assertion Key Value (holder-of-key):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains("KeyValue"));
  WSHandlerResult results=verify(signedDoc,userCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 1.1 authentication assertion,
 * where the subject cert is referenced using IssuerSerial
 */
@Test @SuppressWarnings("unchecked") public void testSAML1AuthnAssertionIssuerSerial() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  callbackHandler.setCertIdentifier(CERT_IDENTIFIER.X509_ISSUER_SERIAL);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256");
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 1.1 Authn Assertion Issuer Serial (holder-of-key):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains("X509IssuerSerial"));
  WSHandlerResult results=verify(signedDoc,userCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 1.1 attribute assertion.
 */
@Test public void testSAML1AttrAssertion() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.ATTR);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  byte[] ephemeralKey=callbackHandler.getEphemeralKey();
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm(WSConstants.HMAC_SHA256);
  wsSign.setKeyIdentifierType(WSConstants.X509_KEY_IDENTIFIER);
  wsSign.setSecretKey(ephemeralKey);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML 1.1 Attr Assertion (key holder):");
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc,trustCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedAssertion != null);
  assertTrue(receivedAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  @SuppressWarnings("unchecked") final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 2 attribute assertion.
 */
@Test public void testSAML2AttrAssertion() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.ATTR);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  byte[] ephemeralKey=callbackHandler.getEphemeralKey();
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm(WSConstants.HMAC_SHA256);
  wsSign.setKeyIdentifierType(WSConstants.X509_KEY_IDENTIFIER);
  wsSign.setSecretKey(ephemeralKey);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML 2 Attr Assertion (key holder):");
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc,trustCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedAssertion != null);
  assertTrue(receivedAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  @SuppressWarnings("unchecked") final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 1.1 authentication assertion.
 */
@Test @SuppressWarnings("unchecked") public void testSAML1AuthnAssertion() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256");
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML 1.1 Authn Assertion (key holder):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains("http://www.w3.org/2001/04/xmlenc#sha256"));
  assertTrue(outputString.contains("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256"));
  WSHandlerResult results=verify(signedDoc,trustCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  assertTrue(receivedSamlAssertion.getSignatureValue() != null);
  List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Header/wsse:Security/saml1:Assertion",xpath);
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  wsDataRef=refs.get(0);
  xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 1.1 authentication assertion.
 * The difference is that we don't trust the user signature, but as we trust the
 * signature of the issuer, we have (indirect) trust.
 */
@Test @SuppressWarnings("unchecked") public void testSAML1AuthnAssertionTrust() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  Crypto crypto=CryptoFactory.getInstance("crypto.properties");
  CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
  cryptoType.setAlias("16c73ab6-b892-458f-abf5-2f875f74882e");
  X509Certificate[] certs=crypto.getX509Certificates(cryptoType);
  callbackHandler.setCerts(certs);
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256");
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,crypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML 1.1 Authn Assertion (key holder):");
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc,trustCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.saml.ext.AssertionSigningTest </h4><pre class="type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates an SamlAssertionWrapper object and signs using default
 * signature and canonicalization algorithms. The defaults should match
 * otherwise the test-case fails.
 */
@Test public void testSigningWithDefaultAlgorithms() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("client_certchain","password",issuerCrypto,false);
  Signature signature=samlAssertion.getSaml2().getSignature();
  Assert.assertTrue(signature.getSignatureAlgorithm().equalsIgnoreCase(defaultRSASignatureAlgorithm) || signature.getSignatureAlgorithm().equalsIgnoreCase(defaultDSASignatureAlgorithm));
  Assert.assertEquals(defaultCanonicalizationAlgorithm,signature.getCanonicalizationAlgorithm());
  SAMLKeyInfo keyInfo=new SAMLKeyInfo();
  CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
  cryptoType.setAlias("client_certchain");
  keyInfo.setCerts(issuerCrypto.getX509Certificates(cryptoType));
  Document doc=dbf.newDocumentBuilder().newDocument();
  Element assertionElement=samlAssertion.toDOM(doc);
  doc.appendChild(assertionElement);
  samlAssertion=new SamlAssertionWrapper(assertionElement);
  samlAssertion.verifySignature(keyInfo);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates an SamlAssertionWrapper object and signs using custom
 * signature and canonicalization algorithms.
 */
@Test public void testSigningWithCustomAlgorithms() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("client_certchain","password",issuerCrypto,false,customCanonicalizationAlgorithm,customSignatureAlgorithm,customSignatureDigestAlgorithm);
  Signature signature=samlAssertion.getSaml2().getSignature();
  Assert.assertEquals(customSignatureAlgorithm,signature.getSignatureAlgorithm());
  Assert.assertEquals(customCanonicalizationAlgorithm,signature.getCanonicalizationAlgorithm());
  Document doc=dbf.newDocumentBuilder().newDocument();
  Element assertionElement=samlAssertion.toDOM(doc);
  doc.appendChild(assertionElement);
  String assertionString=DOM2Writer.nodeToString(assertionElement);
  Assert.assertTrue(assertionString.contains(customSignatureDigestAlgorithm));
  SAMLKeyInfo keyInfo=new SAMLKeyInfo();
  CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
  cryptoType.setAlias("client_certchain");
  keyInfo.setCerts(issuerCrypto.getX509Certificates(cryptoType));
  samlAssertion=new SamlAssertionWrapper(assertionElement);
  samlAssertion.verifySignature(keyInfo);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.validate.ValidatorTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing an expired Timestamp.
 */
@Test public void testExpiredTimestamp() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecTimestamp timestamp=new WSSecTimestamp();
  timestamp.setTimeToLive(-1);
  Document createdDoc=timestamp.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(createdDoc);
    LOG.debug(outputString);
  }
  WSSConfig wssConfig=WSSConfig.getNewInstance();
  try {
    verify(createdDoc,wssConfig,null,null);
    fail("Expected failure on an expired timestamp");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.MESSAGE_EXPIRED);
  }
  wssConfig.setValidator(WSConstants.TIMESTAMP,NoOpValidator.class);
  verify(createdDoc,wssConfig,null,null);
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * In this test, a SOAP request is constructed where the SOAP body is signed via a
 * BinarySecurityToken. The receiving side does not trust the BST, and so the test fails.
 * The second time, a custom Validator (NoOpValidator for this case) is installed for the
 * BST, and so trust verification passes on the Signature.
 */
@Test public void testValidatedBSTSignature() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,CryptoFactory.getInstance(),secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  Crypto crypto=CryptoFactory.getInstance("wss40.properties");
  WSSConfig config=WSSConfig.getNewInstance();
  WSSecurityEngine secEngine=new WSSecurityEngine();
  secEngine.setWssConfig(config);
  try {
    secEngine.processSecurityHeader(doc,null,null,crypto);
    fail("Expected failure on untrusted signature");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
  config.setValidator(WSConstants.BINARY_TOKEN,new BSTValidator());
  WSHandlerResult results=secEngine.processSecurityHeader(doc,null,null,crypto);
  List<WSSecurityEngineResult> bstResults=results.getActionResults().get(WSConstants.BST);
  WSSecurityEngineResult actionResult=bstResults.get(0);
  BinarySecurity token=(BinarySecurity)actionResult.get(WSSecurityEngineResult.TAG_BINARY_SECURITY_TOKEN);
  assertTrue(token != null);
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for processing an untrusted signature
 */
@Test public void testUntrustedSignature() throws Exception {
  WSSecSignature sign=new WSSecSignature();
  sign.setUserInfo("wss40","security");
  sign.setKeyIdentifierType(WSConstants.X509_KEY_IDENTIFIER);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Crypto crypto=CryptoFactory.getInstance("wss40.properties");
  Document signedDoc=sign.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  Crypto cryptoCA=CryptoFactory.getInstance("crypto.properties");
  WSSecurityEngine newEngine=new WSSecurityEngine();
  RequestData data=new RequestData();
  data.setSigVerCrypto(cryptoCA);
  data.setIgnoredBSPRules(Collections.singletonList(BSPRule.R3063));
  try {
    newEngine.processSecurityHeader(signedDoc,data);
    fail("Failure expected on issuer serial");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
  WSSConfig config=WSSConfig.getNewInstance();
  config.setValidator(WSConstants.SIGNATURE,NoOpValidator.class);
  newEngine.setWssConfig(config);
  data.setWssConfig(config);
  newEngine.processSecurityHeader(signedDoc,data);
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that adds a UserNameToken with (bad) password text to a WS-Security envelope
 */
@Test public void testUsernameTokenBadText() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.setPasswordType(WSConstants.PASSWORD_TEXT);
  builder.setUserInfo("wernerd","verySecre");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSSConfig wssConfig=WSSConfig.getNewInstance();
  try {
    verify(signedDoc,wssConfig,new UsernamePasswordCallbackHandler(),null);
    fail("Failure expected on a bad password text");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
  }
  wssConfig.setValidator(WSConstants.USERNAME_TOKEN,NoOpValidator.class);
  verify(signedDoc,wssConfig,new UsernamePasswordCallbackHandler(),null);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.integration.test.kerberos.KerberosTest </h4><pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKerberosEncryptionOutbound() throws Exception {
  if (!runTests) {
    System.out.println("Skipping test because kerberos server could not be started");
    return;
  }
  Document document;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT_WITH_KERBEROS_TOKEN);
    securityProperties.setActions(actions);
    securityProperties.setEncryptionSymAlgorithm(WSSConstants.NS_XENC_AES128);
    securityProperties.setCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof KerberosContextAndServiceNameCallback) {
          KerberosContextAndServiceNameCallback kerberosContextAndServiceNameCallback=(KerberosContextAndServiceNameCallback)callbacks[0];
          kerberosContextAndServiceNameCallback.setContextName("alice");
          kerberosContextAndServiceNameCallback.setServiceName("bob@service.ws.apache.org");
        }
 else         if (callbacks[0] instanceof PasswordCallback) {
          PasswordCallback passwordCallback=(PasswordCallback)callbacks[0];
          if (passwordCallback.getPrompt().contains("alice")) {
            passwordCallback.setPassword("alice".toCharArray());
          }
        }
      }
    }
);
    ByteArrayOutputStream baos=new ByteArrayOutputStream();
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    document=dbf.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_ReferenceList.getNamespaceURI(),WSSConstants.TAG_xenc_ReferenceList.getLocalPart());
    Assert.assertEquals(1,nodeList.getLength());
  }
{
    WSSConfig wssConfig=WSSConfig.getNewInstance();
    KerberosTokenValidator validator=new KerberosTokenValidator();
    validator.setContextName("bob");
    validator.setServiceName("bob@service.ws.apache.org");
    wssConfig.setValidator(WSConstants.BINARY_TOKEN,validator);
    WSSecurityEngine secEngine=new WSSecurityEngine();
    secEngine.setWssConfig(wssConfig);
    CallbackHandler callbackHandler=new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof PasswordCallback) {
          PasswordCallback passwordCallback=(PasswordCallback)callbacks[0];
          if (passwordCallback.getPrompt().contains("bob")) {
            passwordCallback.setPassword("bob".toCharArray());
          }
        }
      }
    }
;
    WSHandlerResult results=secEngine.processSecurityHeader(document,null,callbackHandler,null);
    WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.BST).get(0);
    BinarySecurity token=(BinarySecurity)actionResult.get(WSSecurityEngineResult.TAG_BINARY_SECURITY_TOKEN);
    Assert.assertTrue(token != null);
    Principal principal=(Principal)actionResult.get(WSSecurityEngineResult.TAG_PRINCIPAL);
    Assert.assertTrue(principal instanceof KerberosPrincipal);
    Assert.assertTrue(principal.getName().contains("alice"));
  }
}

</code></pre>

<br>
<pre class="type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Get and validate a SPNEGO token.
 */
@Test public void testSpnego() throws Exception {
  if (!runTests) {
    System.out.println("Skipping test because kerberos server could not be started");
    return;
  }
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  SpnegoTokenContext spnegoToken=new SpnegoTokenContext();
  CallbackHandler callbackHandler=new CallbackHandler(){
    @Override public void handle(    Callback[] callbacks) throws IOException, UnsupportedCallbackException {
      PasswordCallback passwordCallback=(PasswordCallback)callbacks[0];
      if (passwordCallback.getPrompt().contains("alice")) {
        passwordCallback.setPassword("alice".toCharArray());
      }
 else       if (passwordCallback.getPrompt().contains("bob")) {
        passwordCallback.setPassword("bob".toCharArray());
      }
    }
  }
;
  spnegoToken.retrieveServiceTicket("alice",callbackHandler,"bob@service.ws.apache.org");
  byte[] token=spnegoToken.getToken();
  Assert.assertNotNull(token);
  spnegoToken=new SpnegoTokenContext();
  spnegoToken.validateServiceTicket("bob",callbackHandler,"bob@service.ws.apache.org",token);
  Assert.assertTrue(spnegoToken.isEstablished());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKerberosSignatureInbound() throws Exception {
  if (!runTests) {
    System.out.println("Skipping test because kerberos server could not be started");
    return;
  }
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    KerberosSecurity bst=new KerberosSecurity(doc);
    CallbackHandler callbackHandler=new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof PasswordCallback) {
          PasswordCallback passwordCallback=(PasswordCallback)callbacks[0];
          if (passwordCallback.getPrompt().contains("alice")) {
            passwordCallback.setPassword("alice".toCharArray());
          }
        }
      }
    }
;
    bst.retrieveServiceTicket("alice",callbackHandler,"bob@service.ws.apache.org");
    bst.setID("Id-" + bst.hashCode());
    WSSecSignature sign=new WSSecSignature();
    sign.setSignatureAlgorithm(SignatureMethod.HMAC_SHA1);
    sign.setKeyIdentifierType(WSConstants.CUSTOM_SYMM_SIGNING);
    sign.setCustomTokenId(bst.getID());
    sign.setCustomTokenValueType(WSConstants.WSS_GSS_KRB_V5_AP_REQ);
    SecretKey secretKey=bst.getSecretKey();
    sign.setSecretKey(secretKey.getEncoded());
    sign.build(doc,null,secHeader);
    WSSecurityUtil.prependChildElement(secHeader.getSecurityHeader(),bst.getElement());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof PasswordCallback) {
          PasswordCallback passwordCallback=(PasswordCallback)callbacks[0];
          if (passwordCallback.getPrompt().contains("bob")) {
            passwordCallback.setPassword("bob".toCharArray());
          }
        }
 else         if (callbacks[0] instanceof KerberosContextAndServiceNameCallback) {
          KerberosContextAndServiceNameCallback cb=(KerberosContextAndServiceNameCallback)callbacks[0];
          cb.setContextName("bob");
          cb.setServiceName("bob@service.ws.apache.org");
        }
      }
    }
);
    final List<KerberosTokenSecurityEvent> kerberosTokenSecurityEvents=new ArrayList<KerberosTokenSecurityEvent>();
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    SecurityEventListener securityEventListener=new SecurityEventListener(){
      @Override public void registerSecurityEvent(      SecurityEvent securityEvent) throws XMLSecurityException {
        if (securityEvent instanceof KerberosTokenSecurityEvent) {
          kerberosTokenSecurityEvents.add((KerberosTokenSecurityEvent)securityEvent);
        }
      }
    }
;
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    Document document=StAX2DOM.readDoc(dbf.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    Assert.assertEquals(kerberosTokenSecurityEvents.size(),1);
    final KerberosTokenSecurityEvent kerberosTokenSecurityEvent=kerberosTokenSecurityEvents.get(0);
    Assert.assertNotNull(kerberosTokenSecurityEvent.getSecurityToken().getSubject());
    Assert.assertTrue(kerberosTokenSecurityEvent.getSecurityToken().getPrincipal() instanceof KerberosPrincipal);
    Assert.assertEquals(kerberosTokenSecurityEvent.getSecurityToken().getPrincipal().getName(),"alice@service.ws.apache.org");
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKerberosSignatureOutbound() throws Exception {
  if (!runTests) {
    System.out.println("Skipping test because kerberos server could not be started");
    return;
  }
  Document document;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE_WITH_KERBEROS_TOKEN);
    securityProperties.setActions(actions);
    securityProperties.setCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof KerberosContextAndServiceNameCallback) {
          KerberosContextAndServiceNameCallback kerberosContextAndServiceNameCallback=(KerberosContextAndServiceNameCallback)callbacks[0];
          kerberosContextAndServiceNameCallback.setContextName("alice");
          kerberosContextAndServiceNameCallback.setServiceName("bob@service.ws.apache.org");
        }
 else         if (callbacks[0] instanceof PasswordCallback) {
          PasswordCallback passwordCallback=(PasswordCallback)callbacks[0];
          if (passwordCallback.getPrompt().contains("alice")) {
            passwordCallback.setPassword("alice".toCharArray());
          }
        }
      }
    }
);
    ByteArrayOutputStream baos=new ByteArrayOutputStream();
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    document=dbf.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
{
    WSSConfig wssConfig=WSSConfig.getNewInstance();
    KerberosTokenValidator validator=new KerberosTokenValidator();
    validator.setContextName("bob");
    validator.setServiceName("bob@service.ws.apache.org");
    wssConfig.setValidator(WSConstants.BINARY_TOKEN,validator);
    WSSecurityEngine secEngine=new WSSecurityEngine();
    secEngine.setWssConfig(wssConfig);
    CallbackHandler callbackHandler=new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof PasswordCallback) {
          PasswordCallback passwordCallback=(PasswordCallback)callbacks[0];
          if (passwordCallback.getPrompt().contains("bob")) {
            passwordCallback.setPassword("bob".toCharArray());
          }
        }
      }
    }
;
    WSHandlerResult results=secEngine.processSecurityHeader(document,null,callbackHandler,null);
    WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.BST).get(0);
    BinarySecurity token=(BinarySecurity)actionResult.get(WSSecurityEngineResult.TAG_BINARY_SECURITY_TOKEN);
    Assert.assertTrue(token != null);
    Principal principal=(Principal)actionResult.get(WSSecurityEngineResult.TAG_PRINCIPAL);
    Assert.assertTrue(principal instanceof KerberosPrincipal);
    Assert.assertTrue(principal.getName().contains("alice"));
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Various unit tests for a kerberos client
 */
@Test public void testKerberosClient() throws Exception {
  if (!runTests) {
    System.out.println("Skipping test because kerberos server could not be started");
    return;
  }
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  CallbackHandler callbackHandler=new CallbackHandler(){
    @Override public void handle(    Callback[] callbacks) throws IOException, UnsupportedCallbackException {
      PasswordCallback passwordCallback=(PasswordCallback)callbacks[0];
      if (passwordCallback.getPrompt().contains("alice")) {
        passwordCallback.setPassword("alice".toCharArray());
      }
 else       if (passwordCallback.getPrompt().contains("bob")) {
        passwordCallback.setPassword("bob".toCharArray());
      }
    }
  }
;
  try {
    KerberosSecurity bst=new KerberosSecurity(doc);
    bst.retrieveServiceTicket("alice2",callbackHandler,"bob@service");
    Assert.fail("Failure expected on an unknown user");
  }
 catch (  WSSecurityException ex) {
    Assert.assertTrue(ex.getMessage().startsWith("An error occurred in trying to obtain a TGT:"));
  }
  try {
    KerberosSecurity bst=new KerberosSecurity(doc);
    bst.retrieveServiceTicket("alice",callbackHandler,"bob2@service");
    Assert.fail("Failure expected on an unknown user");
  }
 catch (  WSSecurityException ex) {
    Assert.assertEquals(ex.getMessage(),"An error occurred in trying to obtain a service ticket");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.AlgorithmSuiteTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAlgorithmSuitePolicyNegative() throws Exception {
  String policyString="<sp:AlgorithmSuite xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:TripleDesRsa15/>\n"+ "</wsp:Policy>\n"+ "</sp:AlgorithmSuite>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  AlgorithmSuiteSecurityEvent algorithmSuiteSecurityEvent=new AlgorithmSuiteSecurityEvent();
  algorithmSuiteSecurityEvent.setAlgorithmURI("http://www.w3.org/2001/04/xmlenc#aes128-cbc");
  algorithmSuiteSecurityEvent.setKeyLength(128);
  algorithmSuiteSecurityEvent.setAlgorithmUsage(WSSConstants.Enc);
  try {
    policyEnforcer.registerSecurityEvent(algorithmSuiteSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Encryption algorithm http://www.w3.org/2001/04/xmlenc#aes128-cbc does not meet policy\n" + "Symmetric encryption algorithm key length 128 does not meet policy");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAlgorithmSuitePolicyMultipleAssertionEventsNegative() throws Exception {
  String policyString="<sp:AlgorithmSuite xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:TripleDesRsa15/>\n"+ "</wsp:Policy>\n"+ "</sp:AlgorithmSuite>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  AlgorithmSuiteSecurityEvent algorithmSuiteSecurityEvent=new AlgorithmSuiteSecurityEvent();
  algorithmSuiteSecurityEvent.setAlgorithmURI("http://www.w3.org/2001/04/xmlenc#tripledes-cbc");
  algorithmSuiteSecurityEvent.setKeyLength(192);
  algorithmSuiteSecurityEvent.setAlgorithmUsage(WSSConstants.Enc);
  policyEnforcer.registerSecurityEvent(algorithmSuiteSecurityEvent);
  algorithmSuiteSecurityEvent.setAlgorithmURI("http://www.w3.org/2001/04/xmlenc#sha256");
  algorithmSuiteSecurityEvent.setAlgorithmUsage(WSSConstants.SigDig);
  try {
    policyEnforcer.registerSecurityEvent(algorithmSuiteSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Digest algorithm http://www.w3.org/2001/04/xmlenc#sha256 does not meet policy");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAES256GCMAlgorithmSuitePolicy() throws Exception {
  String policyString="<sp:AlgorithmSuite xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<cxf:Basic256GCM xmlns:cxf=\"http://cxf.apache.org/custom/security-policy\"/>\n"+ "</wsp:Policy>\n"+ "</sp:AlgorithmSuite>";
class GCMAlgorithmSuite extends AlgorithmSuite {
    GCMAlgorithmSuite(    SPConstants.SPVersion version,    Policy nestedPolicy){
      super(version,nestedPolicy);
    }
    @Override protected AbstractSecurityAssertion cloneAssertion(    Policy nestedPolicy){
      return new GCMAlgorithmSuite(getVersion(),nestedPolicy);
    }
    @Override protected void parseCustomAssertion(    Assertion assertion){
      String assertionName=assertion.getName().getLocalPart();
      String assertionNamespace=assertion.getName().getNamespaceURI();
      if (!"http://cxf.apache.org/custom/security-policy".equals(assertionNamespace)) {
        return;
      }
      if ("Basic128GCM".equals(assertionName)) {
        setAlgorithmSuiteType(new AlgorithmSuiteType("Basic128GCM",SPConstants.SHA1,WSSConstants.NS_XENC11_AES128_GCM,SPConstants.KW_AES128,SPConstants.KW_RSA_OAEP,SPConstants.P_SHA1_L128,SPConstants.P_SHA1_L128,128,128,128,256,1024,4096));
      }
 else       if ("Basic192GCM".equals(assertionName)) {
        setAlgorithmSuiteType(new AlgorithmSuiteType("Basic192GCM",SPConstants.SHA1,WSSConstants.NS_XENC11_AES192_GCM,SPConstants.KW_AES192,SPConstants.KW_RSA_OAEP,SPConstants.P_SHA1_L192,SPConstants.P_SHA1_L192,192,192,192,256,1024,4096));
      }
 else       if ("Basic256GCM".equals(assertionName)) {
        setAlgorithmSuiteType(new AlgorithmSuiteType("Basic256GCM",SPConstants.SHA1,WSSConstants.NS_XENC11_AES256_GCM,SPConstants.KW_AES256,SPConstants.KW_RSA_OAEP,SPConstants.P_SHA1_L256,SPConstants.P_SHA1_L192,256,192,256,256,1024,4096));
      }
    }
  }
class GCMAlgorithmSuiteBuilder extends AlgorithmSuiteBuilder {
    @Override protected AlgorithmSuite createAlgorithmSuite(    SPConstants.SPVersion version,    Policy nestedPolicy){
      return new GCMAlgorithmSuite(version,nestedPolicy);
    }
  }
  List<AssertionBuilder<Element>> customAssertionBuilders=new ArrayList<>();
  customAssertionBuilders.add(new GCMAlgorithmSuiteBuilder());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString,false,customAssertionBuilders);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  AlgorithmSuiteSecurityEvent algorithmSuiteSecurityEvent=new AlgorithmSuiteSecurityEvent();
  algorithmSuiteSecurityEvent.setAlgorithmURI(WSSConstants.NS_XENC11_AES256_GCM);
  algorithmSuiteSecurityEvent.setKeyLength(256);
  algorithmSuiteSecurityEvent.setAlgorithmUsage(WSSConstants.Enc);
  policyEnforcer.registerSecurityEvent(algorithmSuiteSecurityEvent);
  algorithmSuiteSecurityEvent=new AlgorithmSuiteSecurityEvent();
  algorithmSuiteSecurityEvent.setAlgorithmURI(WSSConstants.NS_XENC_AES256);
  algorithmSuiteSecurityEvent.setKeyLength(256);
  algorithmSuiteSecurityEvent.setAlgorithmUsage(WSSConstants.Enc);
  try {
    policyEnforcer.registerSecurityEvent(algorithmSuiteSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  Exception e) {
    Assert.assertEquals(e.getCause().getMessage(),"Encryption algorithm http://www.w3.org/2001/04/xmlenc#aes256-cbc does not meet policy");
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAlgorithmSuitePolicyAlternativesNegative() throws Exception {
  String policyString="<sp:AlgorithmSuite xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<wsp:ExactlyOne>\n"+ "<sp:Basic256/>\n"+ "<sp:TripleDesRsa15/>\n"+ "</wsp:ExactlyOne>\n"+ "</wsp:Policy>\n"+ "</sp:AlgorithmSuite>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  AlgorithmSuiteSecurityEvent algorithmSuiteSecurityEvent=new AlgorithmSuiteSecurityEvent();
  algorithmSuiteSecurityEvent.setAlgorithmURI("http://www.w3.org/2001/04/xmlenc#aes128-cbc");
  algorithmSuiteSecurityEvent.setKeyLength(128);
  algorithmSuiteSecurityEvent.setAlgorithmUsage(WSSConstants.Enc);
  try {
    policyEnforcer.registerSecurityEvent(algorithmSuiteSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Encryption algorithm http://www.w3.org/2001/04/xmlenc#aes128-cbc does not meet policy\n" + "Symmetric encryption algorithm key length 128 does not meet policy");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.AsymmetricBindingIntegrationTest </h4><pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEntireHeaderAndBodySignatureNegative() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                        <sp:OnlySignEntireHeadersAndBody/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(new QName("http://schemas.xmlsoap.org/wsdl/","definitions"),SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"OnlySignEntireHeadersAndBody not fulfilled, offending element: " + "/{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Body/{http://schemas.xmlsoap.org/wsdl/}definitions");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRecipientTokenInclusionAlwaysToRecipientPolicy() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Token must be included");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptionAlgorithmSuiteNegative() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                        <sp:ProtectTokens/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setEncryptionSymAlgorithm("http://www.w3.org/2001/04/xmlenc#tripledes-cbc");
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Encryption algorithm http://www.w3.org/2001/04/xmlenc#tripledes-cbc does not meet policy\n" + "Symmetric encryption algorithm key length 192 does not meet policy");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testIncludeTimestampAndSignedUsernameSupportingTokenPolicyNegativeTest2() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "                <sp:SignedSupportingTokens>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:UsernameToken sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                            <wsp:Policy>\n"+ "                                <sp:NoPassword/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:UsernameToken>\n"+ "                    </wsp:Policy>\n"+ "                </sp:SignedSupportingTokens>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.setTokenUser("transmitter");
  outSecurityProperties.setUsernameTokenPasswordType(WSSConstants.UsernameTokenPasswordType.PASSWORD_NONE);
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.USERNAMETOKEN);
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Assertion {http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702}UsernameToken not satisfied");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptBeforeSigningNegativeTest() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:EncryptBeforeSigning/>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Policy enforces EncryptBeforeSigning but the /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Body was signed and then encrypted");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignBeforeEncryptNegativeTest() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:SignBeforeEncrypting/>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.ENCRYPT);
  actions.add(WSSConstants.SIGNATURE);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Policy enforces SignBeforeEncrypting but the /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Body was encrypted and then signed");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureProtectionPolicyNegative2() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_dsig_Signature,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Element /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security/{http://www.w3.org/2000/09/xmldsig#}Signature must not be encrypted");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureAlgorithmSuiteNegative() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                        <sp:ProtectTokens/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha512");
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.addIgnoreBSPRule(BSPRule.R5421);
  inSecurityProperties.addIgnoreBSPRule(BSPRule.R5420);
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Asymmetric algorithm http://www.w3.org/2001/04/xmldsig-more#rsa-sha512 does not meet policy");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInitiatorTokenInclusionAlwaysToRecipientPolicy() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Token must be included");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testIncludeTimestampPolicyNegativeTest() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Timestamp must not be present");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testC14NAlgorithmSuiteNegative() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                        <sp:ProtectTokens/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureCanonicalizationAlgorithm("http://www.w3.org/2006/12/xml-c14n11");
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.addIgnoreBSPRule(BSPRule.R5404);
  inSecurityProperties.addIgnoreBSPRule(BSPRule.R5423);
  inSecurityProperties.addIgnoreBSPRule(BSPRule.R5412);
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"C14N algorithm http://www.w3.org/2006/12/xml-c14n11 does not meet policy");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testIncludeTimestampAndSignedUsernameSupportingTokenPolicyNegativeTest() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "                <sp:SignedSupportingTokens>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:UsernameToken sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                            <wsp:Policy>\n"+ "                                <sp:NoPassword/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:UsernameToken>\n"+ "                    </wsp:Policy>\n"+ "                </sp:SignedSupportingTokens>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.setTokenUser("transmitter");
  outSecurityProperties.setUsernameTokenPasswordType(WSSConstants.UsernameTokenPasswordType.PASSWORD_NONE);
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.USERNAMETOKEN);
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Element /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp must be signed");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureDigestAlgorithmSuiteNegative() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                        <sp:ProtectTokens/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureDigestAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-md5");
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element,new String[]{WSSConstants.NS_C14N_EXCL},"http://www.w3.org/2001/04/xmldsig-more#md5"));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element,new String[]{WSSConstants.NS_C14N_EXCL},"http://www.w3.org/2001/04/xmldsig-more#md5"));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.addIgnoreBSPRule(BSPRule.R5420);
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Init.init(WSSec.class.getClassLoader().getResource("wss/wss-config.xml").toURI(),WSSec.class);
    switchAllowMD5Algorithm(true);
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
  }
 finally {
    switchAllowMD5Algorithm(false);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEntireHeaderAndBodySignatureNegative2() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                        <sp:OnlySignEntireHeadersAndBody/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(new QName("http://schemas.xmlsoap.org/wsdl/","service"),SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"OnlySignEntireHeadersAndBody not fulfilled, offending element: " + "/{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://schemas.xmlsoap.org/wsdl/}definitions/{http://schemas.xmlsoap.org/wsdl/}service");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureProtectionPolicyNegative1() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                        <sp:EncryptSignature/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.AsymmetricBindingTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNotWholeBodySigned() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:IncludeTimestamp/>\n"+ "<sp:EncryptSignature/>\n"+ "<sp:ProtectTokens/>\n"+ "<sp:OnlySignEntireHeadersAndBody/>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  TimestampSecurityEvent timestampSecurityEvent=new TimestampSecurityEvent();
  policyEnforcer.registerSecurityEvent(timestampSecurityEvent);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  x509TokenSecurityEvent=new X509TokenSecurityEvent();
  securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  EncryptedElementSecurityEvent encryptedElementSecurityEvent=new EncryptedElementSecurityEvent(null,true,protectionOrder);
  List<QName> headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  headerPath.add(WSSConstants.TAG_dsig_Signature);
  encryptedElementSecurityEvent.setElementPath(headerPath);
  policyEnforcer.registerSecurityEvent(encryptedElementSecurityEvent);
  encryptedElementSecurityEvent=new EncryptedElementSecurityEvent(null,true,protectionOrder);
  headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  headerPath.add(WSSConstants.TAG_WSSE11_SIG_CONF);
  encryptedElementSecurityEvent.setElementPath(headerPath);
  policyEnforcer.registerSecurityEvent(encryptedElementSecurityEvent);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent(null,true,protectionOrder);
  QName elementName=new QName("http://www.example.com","bodyChildElement");
  signedPartSecurityEvent.setXmlSecEvent(XMLSecEventFactory.createXmlSecStartElement(elementName,null,null));
  List<QName> elementPath=new ArrayList<>();
  elementPath.addAll(WSSConstants.SOAP_11_BODY_PATH);
  elementPath.add(elementName);
  signedPartSecurityEvent.setElementPath(elementPath);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"OnlySignEntireHeadersAndBody not fulfilled, offending element: " + "/{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Body/{http://www.example.com}bodyChildElement");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicySignatureNotEncrypted() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:IncludeTimestamp/>\n"+ "<sp:EncryptSignature/>\n"+ "<sp:ProtectTokens/>\n"+ "<sp:OnlySignEntireHeadersAndBody/>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  TimestampSecurityEvent timestampSecurityEvent=new TimestampSecurityEvent();
  policyEnforcer.registerSecurityEvent(timestampSecurityEvent);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  x509TokenSecurityEvent=new X509TokenSecurityEvent();
  securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  EncryptedElementSecurityEvent encryptedElementSecurityEvent=new EncryptedElementSecurityEvent(null,false,protectionOrder);
  List<QName> headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  headerPath.add(WSSConstants.TAG_dsig_Signature);
  encryptedElementSecurityEvent.setElementPath(headerPath);
  policyEnforcer.registerSecurityEvent(encryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNotIncludeTimestamp() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:EncryptSignature/>\n"+ "<sp:ProtectTokens/>\n"+ "<sp:OnlySignEntireHeadersAndBody/>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  x509TokenSecurityEvent=new X509TokenSecurityEvent();
  securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  TimestampSecurityEvent timestampSecurityEvent=new TimestampSecurityEvent();
  policyEnforcer.registerSecurityEvent(timestampSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Timestamp must not be present");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNotWholeSecurityHeaderChildSigned() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:IncludeTimestamp/>\n"+ "<sp:EncryptSignature/>\n"+ "<sp:ProtectTokens/>\n"+ "<sp:OnlySignEntireHeadersAndBody/>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  TimestampSecurityEvent timestampSecurityEvent=new TimestampSecurityEvent();
  policyEnforcer.registerSecurityEvent(timestampSecurityEvent);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  x509TokenSecurityEvent=new X509TokenSecurityEvent();
  securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  EncryptedElementSecurityEvent encryptedElementSecurityEvent=new EncryptedElementSecurityEvent(null,true,protectionOrder);
  List<QName> headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  headerPath.add(WSSConstants.TAG_dsig_Signature);
  encryptedElementSecurityEvent.setElementPath(headerPath);
  policyEnforcer.registerSecurityEvent(encryptedElementSecurityEvent);
  encryptedElementSecurityEvent=new EncryptedElementSecurityEvent(null,true,protectionOrder);
  headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  headerPath.add(WSSConstants.TAG_WSSE11_SIG_CONF);
  encryptedElementSecurityEvent.setElementPath(headerPath);
  policyEnforcer.registerSecurityEvent(encryptedElementSecurityEvent);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent(null,true,protectionOrder);
  QName elementName=WSSConstants.TAG_WSSE_USERNAME;
  signedPartSecurityEvent.setXmlSecEvent(XMLSecEventFactory.createXmlSecStartElement(elementName,null,null));
  List<QName> elementPath=new ArrayList<>();
  elementPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  elementPath.add(WSSConstants.TAG_WSSE_USERNAME_TOKEN);
  elementPath.add(elementName);
  signedPartSecurityEvent.setElementPath(elementPath);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"OnlySignEntireHeadersAndBody not fulfilled, offending element: " + "/{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}UsernameToken/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Username");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyWrongProtectionOrder() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:IncludeTimestamp/>\n"+ "<sp:EncryptBeforeSigning/>\n"+ "<sp:EncryptSignature/>\n"+ "<sp:ProtectTokens/>\n"+ "<sp:OnlySignEntireHeadersAndBody/>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent(null,true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Policy enforces EncryptBeforeSigning but the /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Body was signed and then encrypted");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.ContentEncryptedElementsTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyMultipleAssertionEventsNegative() throws Exception {
  String policyString="<sp:ContentEncryptedElements xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<sp:XPath xmlns:b=\"http://example.org\">/b:a</sp:XPath>\n" + "</sp:ContentEncryptedElements>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent(null,true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent(null,false,null);
  List<QName> headerPath=new ArrayList<>();
  headerPath.add(new QName("http://example.org","a"));
  contentEncryptedElementSecurityEvent.setElementPath(headerPath);
  try {
    policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Content of element /{http://example.org}a must be encrypted");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.DerivedKeyTests </h4><pre class="type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDerivedKeyInitiatorTokenPolicyNegative() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:InitiatorToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:X509Token>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireDerivedKeys/>\n"+ "           </wsp:Policy>\n"+ "       </sp:X509Token>\n"+ "   </wsp:Policy>\n"+ "</sp:InitiatorToken>\n"+ "<sp:RecipientToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:X509Token>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireDerivedKeys/>\n"+ "           </wsp:Policy>\n"+ "       </sp:X509Token>\n"+ "   </wsp:Policy>\n"+ "</sp:RecipientToken>\n"+ "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  X509TokenSecurityEvent initiatorX509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorX509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorX509TokenSecurityEvent);
  X509TokenSecurityEvent recipientX509TokenSecurityEvent=new X509TokenSecurityEvent();
  securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientX509TokenSecurityEvent.setSecurityToken(securityToken);
  DerivedKeyTokenSecurityEvent derivedKeyTokenSecurityEvent=new DerivedKeyTokenSecurityEvent();
  derivedKeyTokenSecurityEvent.setSecurityToken(getX509Token(WSSecurityTokenConstants.DerivedKeyToken));
  securityToken.addWrappedToken((InboundSecurityToken)derivedKeyTokenSecurityEvent.getSecurityToken());
  policyEnforcer.registerSecurityEvent(recipientX509TokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientX509TokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientX509TokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"Derived key must be used");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDerivedKeyRecipientTokenPolicyNegative() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:InitiatorToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:X509Token>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireDerivedKeys/>\n"+ "           </wsp:Policy>\n"+ "       </sp:X509Token>\n"+ "   </wsp:Policy>\n"+ "</sp:InitiatorToken>\n"+ "<sp:RecipientToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:X509Token>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireDerivedKeys/>\n"+ "           </wsp:Policy>\n"+ "       </sp:X509Token>\n"+ "   </wsp:Policy>\n"+ "</sp:RecipientToken>\n"+ "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  X509TokenSecurityEvent initiatorX509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorX509TokenSecurityEvent.setSecurityToken(securityToken);
  DerivedKeyTokenSecurityEvent derivedKeyTokenSecurityEvent=new DerivedKeyTokenSecurityEvent();
  derivedKeyTokenSecurityEvent.setSecurityToken(getX509Token(WSSecurityTokenConstants.DerivedKeyToken));
  securityToken.addWrappedToken((InboundSecurityToken)derivedKeyTokenSecurityEvent.getSecurityToken());
  policyEnforcer.registerSecurityEvent(initiatorX509TokenSecurityEvent);
  X509TokenSecurityEvent recipientX509TokenSecurityEvent=new X509TokenSecurityEvent();
  securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientX509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientX509TokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientX509TokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientX509TokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"Derived key must be used");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDerivedKeySupportingTokenPolicyAdditionalTokenNegative() throws Exception {
  String policyString="<sp:SupportingTokens xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "       <sp:X509Token>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireDerivedKeys/>\n"+ "           </wsp:Policy>\n"+ "       </sp:X509Token>\n"+ "   </wsp:Policy>\n"+ "</sp:SupportingTokens>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V1Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  x509TokenSecurityEvent=new X509TokenSecurityEvent();
  securityToken=getX509Token(WSSecurityTokenConstants.X509V1Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof WSSPolicyException);
  }
}

</code></pre>

<br>
<pre class="type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDerivedKeySupportingTokenPolicyNegative() throws Exception {
  String policyString="<sp:SupportingTokens xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "       <sp:X509Token>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireDerivedKeys/>\n"+ "           </wsp:Policy>\n"+ "       </sp:X509Token>\n"+ "   </wsp:Policy>\n"+ "</sp:SupportingTokens>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V1Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"Derived key must be used");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.EncryptedElementsTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyMultipleAssertionEventsNegative() throws Exception {
  String policyString="<sp:EncryptedElements xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<sp:XPath xmlns:b=\"http://example.org\">/b:a</sp:XPath>\n" + "</sp:EncryptedElements>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  EncryptedElementSecurityEvent encryptedElementSecurityEvent=new EncryptedElementSecurityEvent(null,true,protectionOrder);
  encryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(encryptedElementSecurityEvent);
  encryptedElementSecurityEvent=new EncryptedElementSecurityEvent(null,false,null);
  List<QName> headerPath=new ArrayList<>();
  headerPath.add(new QName("http://example.org","a"));
  encryptedElementSecurityEvent.setElementPath(headerPath);
  try {
    policyEnforcer.registerSecurityEvent(encryptedElementSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Element /{http://example.org}a must be encrypted");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.EncryptedPartsTest </h4><pre class="type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyWholeBodyNegative() throws Exception {
  String policyString="<sp:EncryptedParts xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "</sp:EncryptedParts>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  EncryptedPartSecurityEvent encryptedPartSecurityEvent=new EncryptedPartSecurityEvent(null,false,null);
  encryptedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  try {
    policyEnforcer.registerSecurityEvent(encryptedPartSecurityEvent);
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"SOAP-Body must be encrypted");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyWildcardHeaderNegative() throws Exception {
  String policyString="<sp:EncryptedParts xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<sp:Body/>\n" + "<sp:Header Namespace=\"http://example.org\"/>\n"+ "<sp:Attachments/>\n"+ "</sp:EncryptedParts>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  EncryptedPartSecurityEvent encryptedPartSecurityEvent=new EncryptedPartSecurityEvent(null,true,protectionOrder);
  encryptedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(encryptedPartSecurityEvent);
  encryptedPartSecurityEvent=new EncryptedPartSecurityEvent(null,false,null);
  List<QName> headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.SOAP_11_HEADER_PATH);
  headerPath.add(new QName("http://example.org","a"));
  encryptedPartSecurityEvent.setElementPath(headerPath);
  try {
    policyEnforcer.registerSecurityEvent(encryptedPartSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Element /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://example.org}a must be encrypted");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyMultipleAssertionEventsNegative() throws Exception {
  String policyString="<sp:EncryptedParts xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<sp:Body/>\n" + "<sp:Header Name=\"a\" Namespace=\"http://example.org\"/>\n"+ "<sp:Attachments/>\n"+ "</sp:EncryptedParts>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  EncryptedPartSecurityEvent encryptedPartSecurityEvent=new EncryptedPartSecurityEvent(null,true,protectionOrder);
  encryptedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(encryptedPartSecurityEvent);
  encryptedPartSecurityEvent=new EncryptedPartSecurityEvent(null,false,null);
  List<QName> headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.SOAP_11_HEADER_PATH);
  headerPath.add(new QName("http://example.org","a"));
  encryptedPartSecurityEvent.setElementPath(headerPath);
  try {
    policyEnforcer.registerSecurityEvent(encryptedPartSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Element /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://example.org}a must be encrypted");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.HttpsTokenTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNegative() throws Exception {
  String policyString="<sp:TransportBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:TransportToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:HttpsToken>\n"+ "       <sp:IssuerName>xs:anyURI</sp:IssuerName>\n"+ "       <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "           <sp:RequireClientCertificate/>\n"+ "       </wsp:Policy>\n"+ "       </sp:HttpsToken>"+ "   </wsp:Policy>\n"+ "</sp:TransportToken>\n"+ "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:TransportBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  HttpsTokenSecurityEvent httpsTokenSecurityEvent=new HttpsTokenSecurityEvent();
  HttpsSecurityTokenImpl securityToken=getHttpsSecurityToken(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  httpsTokenSecurityEvent.setSecurityToken(securityToken);
  httpsTokenSecurityEvent.setAuthenticationType(HttpsTokenSecurityEvent.AuthenticationType.HttpBasicAuthentication);
  httpsTokenSecurityEvent.setIssuerName("xs:anyURI");
  policyEnforcer.registerSecurityEvent(httpsTokenSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Policy enforces HttpClientCertificateAuthentication but we got HttpBasicAuthentication");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.IssuedTokenTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyWithSAMLTokenMissingClaimType() throws Exception {
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(samlPolicyString);
  SAMLCallback samlCallback=new SAMLCallback();
  samlCallback.setSamlVersion(Version.SAML_20);
  samlCallback.setIssuer("http://initiatorTokenIssuer.com");
  SubjectBean subjectBean=new SubjectBean();
  samlCallback.setSubject(subjectBean);
  List<AttributeStatementBean> attributeStatementBeans=new ArrayList<>();
  List<AttributeBean> attributeBeans=new ArrayList<>();
  List attributeValues=new ArrayList<>();
  attributeValues.add("test@example.com");
  attributeBeans.add(new AttributeBean("email","http://schemas.xmlsoap.org/ws/2005/05/identity/claims/email",attributeValues));
  attributeStatementBeans.add(new AttributeStatementBean(subjectBean,attributeBeans));
  samlCallback.setAttributeStatementData(attributeStatementBeans);
  SamlAssertionWrapper samlAssertionWrapper=createSamlAssertionWrapper(samlCallback);
  SamlTokenSecurityEvent initiatorTokenSecurityEvent=new SamlTokenSecurityEvent();
  SamlSecurityTokenImpl securityToken=new SamlSecurityTokenImpl(samlAssertionWrapper,getX509Token(WSSecurityTokenConstants.X509V3Token),null,null,WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE,null);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  samlCallback.setIssuer("http://recipientTokenIssuer.com");
  samlAssertionWrapper=createSamlAssertionWrapper(samlCallback);
  SamlTokenSecurityEvent recipientTokenSecurityEvent=new SamlTokenSecurityEvent();
  securityToken=new SamlSecurityTokenImpl(samlAssertionWrapper,getX509Token(WSSecurityTokenConstants.X509V3Token),null,null,WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE,null);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Attribute http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname not found in the SAMLAssertion");
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyWithSAMLTokenWrongKeyType() throws Exception {
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(samlPolicyString.replaceFirst("PublicKey","SymmetricKey"));
  SAMLCallback samlCallback=new SAMLCallback();
  samlCallback.setSamlVersion(Version.SAML_20);
  samlCallback.setIssuer("http://initiatorTokenIssuer.com");
  SubjectBean subjectBean=new SubjectBean();
  samlCallback.setSubject(subjectBean);
  List<AttributeStatementBean> attributeStatementBeans=new ArrayList<>();
  List<AttributeBean> attributeBeans=new ArrayList<>();
  List attributeValues=new ArrayList<>();
  attributeValues.add("test@example.com");
  attributeBeans.add(new AttributeBean("email","http://schemas.xmlsoap.org/ws/2005/05/identity/claims/email",attributeValues));
  attributeValues.clear();
  attributeValues.add("Proper");
  attributeBeans.add(new AttributeBean("surname","http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname",attributeValues));
  attributeStatementBeans.add(new AttributeStatementBean(subjectBean,attributeBeans));
  samlCallback.setAttributeStatementData(attributeStatementBeans);
  SamlAssertionWrapper samlAssertionWrapper=createSamlAssertionWrapper(samlCallback);
  SamlTokenSecurityEvent initiatorTokenSecurityEvent=new SamlTokenSecurityEvent();
  SamlSecurityTokenImpl securityToken=new SamlSecurityTokenImpl(samlAssertionWrapper,getX509Token(WSSecurityTokenConstants.X509V3Token),null,null,WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE,null);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  samlCallback.setIssuer("http://recipientTokenIssuer.com");
  samlAssertionWrapper=createSamlAssertionWrapper(samlCallback);
  SamlTokenSecurityEvent recipientTokenSecurityEvent=new SamlTokenSecurityEvent();
  securityToken=new SamlSecurityTokenImpl(samlAssertionWrapper,getX509Token(WSSecurityTokenConstants.X509V3Token),null,null,WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE,null);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Policy enforces SAML token with a symmetric key");
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyWithSAMLTokenWrongIssuer() throws Exception {
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(samlPolicyString);
  SAMLCallback samlCallback=new SAMLCallback();
  samlCallback.setSamlVersion(Version.SAML_20);
  samlCallback.setIssuer("http://initiatorTokenIssuer.com");
  SubjectBean subjectBean=new SubjectBean();
  samlCallback.setSubject(subjectBean);
  List<AttributeStatementBean> attributeStatementBeans=new ArrayList<>();
  List<AttributeBean> attributeBeans=new ArrayList<>();
  List attributeValues=new ArrayList<>();
  attributeValues.add("test@example.com");
  attributeBeans.add(new AttributeBean("email","http://schemas.xmlsoap.org/ws/2005/05/identity/claims/email",attributeValues));
  attributeValues.clear();
  attributeValues.add("Proper");
  attributeBeans.add(new AttributeBean("surname","http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname",attributeValues));
  attributeStatementBeans.add(new AttributeStatementBean(subjectBean,attributeBeans));
  samlCallback.setAttributeStatementData(attributeStatementBeans);
  SamlAssertionWrapper samlAssertionWrapper=createSamlAssertionWrapper(samlCallback);
  SamlTokenSecurityEvent initiatorTokenSecurityEvent=new SamlTokenSecurityEvent();
  SamlSecurityTokenImpl securityToken=new SamlSecurityTokenImpl(samlAssertionWrapper,getX509Token(WSSecurityTokenConstants.X509V3Token),null,null,WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE,null);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  SamlTokenSecurityEvent recipientTokenSecurityEvent=new SamlTokenSecurityEvent();
  securityToken=new SamlSecurityTokenImpl(samlAssertionWrapper,getX509Token(WSSecurityTokenConstants.X509V3Token),null,null,WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE,null);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"IssuerName in Policy (http://recipientTokenIssuer.com) didn't match with the one in the IssuedToken (http://initiatorTokenIssuer.com)");
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyWithSAMLTokenWrongTokenType() throws Exception {
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(samlPolicyString);
  SAMLCallback samlCallback=new SAMLCallback();
  samlCallback.setSamlVersion(Version.SAML_11);
  samlCallback.setIssuer("http://initiatorTokenIssuer.com");
  SubjectBean subjectBean=new SubjectBean();
  samlCallback.setSubject(subjectBean);
  List<AttributeStatementBean> attributeStatementBeans=new ArrayList<>();
  List<AttributeBean> attributeBeans=new ArrayList<>();
  List attributeValues=new ArrayList<>();
  attributeValues.add("test@example.com");
  attributeBeans.add(new AttributeBean("email","http://schemas.xmlsoap.org/ws/2005/05/identity/claims/email",attributeValues));
  attributeValues.clear();
  attributeValues.add("Proper");
  attributeBeans.add(new AttributeBean("surname","http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname",attributeValues));
  attributeStatementBeans.add(new AttributeStatementBean(subjectBean,attributeBeans));
  samlCallback.setAttributeStatementData(attributeStatementBeans);
  SamlAssertionWrapper samlAssertionWrapper=createSamlAssertionWrapper(samlCallback);
  SamlTokenSecurityEvent initiatorTokenSecurityEvent=new SamlTokenSecurityEvent();
  SamlSecurityTokenImpl securityToken=new SamlSecurityTokenImpl(samlAssertionWrapper,getX509Token(WSSecurityTokenConstants.X509V3Token),null,null,WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE,null);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  samlCallback.setIssuer("http://recipientTokenIssuer.com");
  samlAssertionWrapper=createSamlAssertionWrapper(samlCallback);
  SamlTokenSecurityEvent recipientTokenSecurityEvent=new SamlTokenSecurityEvent();
  securityToken=new SamlSecurityTokenImpl(samlAssertionWrapper,getX509Token(WSSecurityTokenConstants.X509V3Token),null,null,WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE,null);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Policy enforces SAML V2.0 token but got 1.1");
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyWithKerberosTokenWrongTokenType() throws Exception {
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(kerberosPolicyString);
  KerberosTokenSecurityEvent initiatorTokenSecurityEvent=new KerberosTokenSecurityEvent();
  initiatorTokenSecurityEvent.setIssuerName("http://initiatorTokenIssuer.com");
  KerberosServiceSecurityTokenImpl securityToken=new KerberosServiceSecurityTokenImpl(null,null,null,"http://docs.oasisopen.org/wss/oasiswss-kerberos-tokenprofile-1.1#GSS_Kerberosv5_AP_REQ","1",WSSecurityTokenConstants.KEYIDENTIFIER_EMBEDDED_KEY_IDENTIFIER_REF);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  KerberosTokenSecurityEvent recipientTokenSecurityEvent=new KerberosTokenSecurityEvent();
  recipientTokenSecurityEvent.setIssuerName("http://recipientTokenIssuer.com");
  securityToken=new KerberosServiceSecurityTokenImpl(null,null,null,"http://docs.oasisopen.org/wss/oasiswss-kerberos-tokenprofile-1.1#Kerberosv5APREQSHA1","1",WSSecurityTokenConstants.KEYIDENTIFIER_EMBEDDED_KEY_IDENTIFIER_REF);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Policy enforces Kerberos token of type http://docs.oasisopen.org/wss/oasiswss-kerberos-tokenprofile-1.1#Kerberosv5APREQSHA1 but got http://docs.oasisopen.org/wss/oasiswss-kerberos-tokenprofile-1.1#GSS_Kerberosv5_AP_REQ");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.KerberosTokenTest </h4><pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNegative() throws Exception {
  String policyString="<sp:SymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:EncryptionToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:KerberosToken>\n"+ "           <sp:IssuerName>xs:anyURI</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:WssKerberosV5ApReqToken11/>\n"+ "           </wsp:Policy>\n"+ "       </sp:KerberosToken>\n"+ "   </wsp:Policy>\n"+ "</sp:EncryptionToken>\n"+ "<sp:SignatureToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:KerberosToken>\n"+ "           <sp:IssuerName>xs:anyURI</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:WssKerberosV5ApReqToken11/>\n"+ "           </wsp:Policy>\n"+ "       </sp:KerberosToken>\n"+ "   </wsp:Policy>\n"+ "</sp:SignatureToken>\n"+ "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:SymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  KerberosTokenSecurityEvent initiatorTokenSecurityEvent=new KerberosTokenSecurityEvent();
  initiatorTokenSecurityEvent.setIssuerName("xs:anyURI");
  KerberosServiceSecurityTokenImpl kerberosServiceSecurityToken=new KerberosServiceSecurityTokenImpl(null,null,null,WSSConstants.NS_GSS_KERBEROS5_AP_REQ,IDGenerator.generateID(null),WSSecurityTokenConstants.KEYIDENTIFIER_THUMBPRINT_IDENTIFIER);
  kerberosServiceSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(kerberosServiceSecurityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  KerberosTokenSecurityEvent recipientTokenSecurityEvent=new KerberosTokenSecurityEvent();
  recipientTokenSecurityEvent.setIssuerName("xs:anyURI");
  kerberosServiceSecurityToken=new KerberosServiceSecurityTokenImpl(null,null,null,WSSConstants.NS_KERBEROS5_AP_REQ,IDGenerator.generateID(null),WSSecurityTokenConstants.KEYIDENTIFIER_THUMBPRINT_IDENTIFIER);
  kerberosServiceSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(kerberosServiceSecurityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"Policy enforces WssKerberosV5ApReqToken11");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.KeyValueTokenTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNegative() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:InitiatorToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:KeyValueToken>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RsaKeyValue/>\n"+ "           </wsp:Policy>\n"+ "       </sp:KeyValueToken>\n"+ "   </wsp:Policy>\n"+ "</sp:InitiatorToken>\n"+ "<sp:RecipientToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:KeyValueToken>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RsaKeyValue/>\n"+ "           </wsp:Policy>\n"+ "       </sp:KeyValueToken>\n"+ "   </wsp:Policy>\n"+ "</sp:RecipientToken>\n"+ "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  KeyValueTokenSecurityEvent initiatorTokenSecurityEvent=new KeyValueTokenSecurityEvent();
  ECKeyValueSecurityTokenImpl securityToken=getECKeyValueSecurityToken();
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  KeyValueTokenSecurityEvent recipientTokenSecurityEvent=new KeyValueTokenSecurityEvent();
  securityToken=getECKeyValueSecurityToken();
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Policy enforces that a RsaKeyValue must be present in the KeyValueToken but we got a ECKeyValueSecurityTokenImpl");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.ProtectionOrderTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyEncryptBeforeSignNegative() throws Exception {
  String policyString="<sp:AsymmetricBinding  xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "   <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "       <sp:EncryptBeforeSigning/>\n"+ "   </wsp:Policy>\n"+ "</sp:AsymmetricBinding>\n";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  EncryptedPartSecurityEvent encryptedPartSecurityEvent=new EncryptedPartSecurityEvent(null,true,protectionOrder);
  encryptedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  try {
    policyEnforcer.registerSecurityEvent(encryptedPartSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Policy enforces EncryptBeforeSigning but the /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Body was signed and then encrypted");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicySignBeforeEncryptNegative() throws Exception {
  String policyString="<sp:AsymmetricBinding  xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "   <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "   </wsp:Policy>\n"+ "</sp:AsymmetricBinding>\n";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent(null,true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  try {
    policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Policy enforces SignBeforeEncrypting but the /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Body was encrypted and then signed");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.RequiredElementsTest </h4><pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyMultipleAssertionEventsNegative() throws Exception {
  String policyString="<sp:RequiredElements xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<sp:XPath xmlns:b=\"http://example.org\">/b:a</sp:XPath>\n" + "</sp:RequiredElements>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  RequiredElementSecurityEvent requiredElementSecurityEvent=new RequiredElementSecurityEvent();
  requiredElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(requiredElementSecurityEvent);
  try {
    policyEnforcer.doFinal();
    Assert.fail("Exception expected");
  }
 catch (  WSSPolicyException e) {
    Assert.assertEquals(e.getMessage(),"Element /{http://example.org}a must be present");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.RequiredPartsTest </h4><pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyMultipleAssertionEventsNegative() throws Exception {
  String policyString="<sp:RequiredParts xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<sp:Header Name=\"a\" Namespace=\"http://example.org\"/>\n" + "</sp:RequiredParts>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  RequiredPartSecurityEvent requiredPartSecurityEvent=new RequiredPartSecurityEvent();
  List<QName> headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.SOAP_11_HEADER_PATH);
  headerPath.add(new QName("http://example.org","b"));
  requiredPartSecurityEvent.setElementPath(headerPath);
  policyEnforcer.registerSecurityEvent(requiredPartSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"Element {http://example.org}a must be present");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.SamlTokenTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNegative() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:InitiatorToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:SamlToken>\n"+ "           <sp:IssuerName>xs:anyURI</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:WssSamlV20Token11/>\n"+ "           </wsp:Policy>\n"+ "       </sp:SamlToken>\n"+ "   </wsp:Policy>\n"+ "</sp:InitiatorToken>\n"+ "<sp:RecipientToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:SamlToken>\n"+ "           <sp:IssuerName>xs:anyURI</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:WssSamlV20Token11/>\n"+ "           </wsp:Policy>\n"+ "       </sp:SamlToken>\n"+ "   </wsp:Policy>\n"+ "</sp:RecipientToken>\n"+ "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  SAMLCallback samlCallback=new SAMLCallback();
  samlCallback.setSamlVersion(Version.SAML_20);
  samlCallback.setIssuer("xs:anyURI");
  SubjectBean subjectBean=new SubjectBean();
  samlCallback.setSubject(subjectBean);
  SamlAssertionWrapper samlAssertionWrapper=createSamlAssertionWrapper(samlCallback);
  SamlTokenSecurityEvent initiatorTokenSecurityEvent=new SamlTokenSecurityEvent();
  SamlSecurityTokenImpl securityToken=new SamlSecurityTokenImpl(samlAssertionWrapper,getX509Token(WSSecurityTokenConstants.X509V3Token),null,null,WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE,null);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  samlCallback.setIssuer("xs:otherURI");
  samlAssertionWrapper=createSamlAssertionWrapper(samlCallback);
  SamlTokenSecurityEvent recipientTokenSecurityEvent=new SamlTokenSecurityEvent();
  securityToken=new SamlSecurityTokenImpl(samlAssertionWrapper,getX509Token(WSSecurityTokenConstants.X509V3Token),null,null,WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE,null);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"IssuerName in Policy (xs:anyURI) didn't match with the one in the SamlToken (xs:otherURI)");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.SecureConversationTokenTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNegative() throws Exception {
  String policyString="<sp:SymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:EncryptionToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:SecureConversationToken>\n"+ "           <sp:IssuerName>xs:anyURI</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireExternalUriReference/>\n"+ "           </wsp:Policy>\n"+ "       </sp:SecureConversationToken>\n"+ "   </wsp:Policy>\n"+ "</sp:EncryptionToken>\n"+ "<sp:SignatureToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:SecureConversationToken>\n"+ "           <sp:IssuerName>xs:anyURI</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireExternalUriReference/>\n"+ "           </wsp:Policy>\n"+ "       </sp:SecureConversationToken>\n"+ "   </wsp:Policy>\n"+ "</sp:SignatureToken>\n"+ "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:SymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  SecurityContextTokenSecurityEvent initiatorTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  initiatorTokenSecurityEvent.setIssuerName("sss");
  initiatorTokenSecurityEvent.setExternalUriRef(true);
  InboundSecurityToken securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  SecurityContextTokenSecurityEvent recipientTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  recipientTokenSecurityEvent.setIssuerName("sss");
  recipientTokenSecurityEvent.setExternalUriRef(true);
  securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"IssuerName in Policy (xs:anyURI) didn't match with the one in the SecurityContextToken (sss)");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.SecurityContextTokenTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNegative() throws Exception {
  String policyString="<sp:SymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:EncryptionToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:SecurityContextToken>\n"+ "           <sp:IssuerName>xs:anyURI</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireExternalUriReference/>\n"+ "           </wsp:Policy>\n"+ "       </sp:SecurityContextToken>\n"+ "   </wsp:Policy>\n"+ "</sp:EncryptionToken>\n"+ "<sp:SignatureToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:SecurityContextToken>\n"+ "           <sp:IssuerName>xs:anyURI</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireExternalUriReference/>\n"+ "           </wsp:Policy>\n"+ "       </sp:SecurityContextToken>\n"+ "   </wsp:Policy>\n"+ "</sp:SignatureToken>\n"+ "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:SymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  SecurityContextTokenSecurityEvent initiatorTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  initiatorTokenSecurityEvent.setIssuerName("sss");
  initiatorTokenSecurityEvent.setExternalUriRef(true);
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  SecurityContextTokenSecurityEvent recipientTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  recipientTokenSecurityEvent.setIssuerName("sss");
  recipientTokenSecurityEvent.setExternalUriRef(true);
  securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"IssuerName in Policy (xs:anyURI) didn't match with the one in the SecurityContextToken (sss)");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.SignedElementsTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyMultipleAssertionEventsNegative() throws Exception {
  String policyString="<sp:SignedElements xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<sp:XPath xmlns:b=\"http://example.org\">/b:a</sp:XPath>\n" + "</sp:SignedElements>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedElementSecurityEvent signedElementSecurityEvent=new SignedElementSecurityEvent(null,true,protectionOrder);
  signedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
  signedElementSecurityEvent=new SignedElementSecurityEvent(null,false,null);
  List<QName> headerPath=new ArrayList<>();
  headerPath.add(new QName("http://example.org","a"));
  signedElementSecurityEvent.setElementPath(headerPath);
  try {
    policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Element /{http://example.org}a must be signed");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.SignedPartsTest </h4><pre class="type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyBodyNegative() throws Exception {
  String policyString="<sp:SignedParts xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "</sp:SignedParts>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent(null,false,null);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  try {
    policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Element /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Body must be signed");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyMultipleAssertionEventsNegative() throws Exception {
  String policyString="<sp:SignedParts xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<sp:Body/>\n" + "<sp:Header Name=\"a\" Namespace=\"http://example.org\"/>\n"+ "<sp:Attachments>\n"+ "<sp3:ContentSignatureTransform/>\n"+ "<sp3:AttachmentCompleteSignatureTransform/>\n"+ "</sp:Attachments>\n"+ "</sp:SignedParts>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent(null,true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  signedPartSecurityEvent=new SignedPartSecurityEvent(null,false,null);
  List<QName> headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.SOAP_11_HEADER_PATH);
  headerPath.add(new QName("http://example.org","a"));
  signedPartSecurityEvent.setElementPath(headerPath);
  try {
    policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Element /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://example.org}a must be signed");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyWildcardHeaderNegative() throws Exception {
  String policyString="<sp:SignedParts xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<sp:Body/>\n" + "<sp:Header Namespace=\"http://example.org\"/>\n"+ "<sp:Attachments>\n"+ "<sp3:ContentSignatureTransform/>\n"+ "<sp3:AttachmentCompleteSignatureTransform/>\n"+ "</sp:Attachments>\n"+ "</sp:SignedParts>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent(null,true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  signedPartSecurityEvent=new SignedPartSecurityEvent(null,false,null);
  List<QName> headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.SOAP_11_HEADER_PATH);
  headerPath.add(new QName("http://example.org","a"));
  signedPartSecurityEvent.setElementPath(headerPath);
  try {
    policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Element /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://example.org}a must be signed");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.SupportingTokensTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSecurityContextTokenSupportingTokenPolicyAdditionalTokenNegative() throws Exception {
  String policyString="<sp:SupportingTokens xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "       <sp:SecurityContextToken>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <wsp:Policy/>\n"+ "       </sp:SecurityContextToken>\n"+ "   </wsp:Policy>\n"+ "</sp:SupportingTokens>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  SecurityContextTokenSecurityEvent tokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  tokenSecurityEvent.setIssuerName("test");
  X509SecurityTokenImpl x509SecurityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  x509SecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  tokenSecurityEvent.setSecurityToken(x509SecurityToken);
  policyEnforcer.registerSecurityEvent(tokenSecurityEvent);
  tokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  tokenSecurityEvent.setIssuerName("test");
  x509SecurityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  x509SecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  tokenSecurityEvent.setSecurityToken(x509SecurityToken);
  policyEnforcer.registerSecurityEvent(tokenSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof WSSPolicyException);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKeyValueTokenSupportingTokenPolicyAdditionalTokenNegative() throws Exception {
  String policyString="<sp:SupportingTokens xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "       <sp:KeyValueToken>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RsaKeyValue/>\n"+ "           </wsp:Policy>\n"+ "       </sp:KeyValueToken>\n"+ "   </wsp:Policy>\n"+ "</sp:SupportingTokens>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  KeyValueTokenSecurityEvent tokenSecurityEvent=new KeyValueTokenSecurityEvent();
  DsaKeyValueSecurityTokenImpl dsaKeyValueSecurityToken=getDsaKeyValueSecurityToken();
  dsaKeyValueSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  tokenSecurityEvent.setSecurityToken(dsaKeyValueSecurityToken);
  policyEnforcer.registerSecurityEvent(tokenSecurityEvent);
  tokenSecurityEvent=new KeyValueTokenSecurityEvent();
  dsaKeyValueSecurityToken=getDsaKeyValueSecurityToken();
  dsaKeyValueSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  tokenSecurityEvent.setSecurityToken(dsaKeyValueSecurityToken);
  policyEnforcer.registerSecurityEvent(tokenSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof WSSPolicyException);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSamlTokenSupportingTokenPolicyAdditionalTokenNegative() throws Exception {
  String policyString="<sp:SupportingTokens xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "       <sp:SamlToken>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <wsp:Policy/>\n"+ "       </sp:SamlToken>\n"+ "   </wsp:Policy>\n"+ "</sp:SupportingTokens>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  SAMLCallback samlCallback=new SAMLCallback();
  samlCallback.setSamlVersion(Version.SAML_20);
  samlCallback.setIssuer("xs:anyURI");
  SubjectBean subjectBean=new SubjectBean();
  samlCallback.setSubject(subjectBean);
  SamlAssertionWrapper samlAssertionWrapper=createSamlAssertionWrapper(samlCallback);
  SamlTokenSecurityEvent tokenSecurityEvent=new SamlTokenSecurityEvent();
  SamlSecurityTokenImpl samlSecurityToken=new SamlSecurityTokenImpl(samlAssertionWrapper,getX509Token(WSSecurityTokenConstants.X509V3Token),null,null,WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE,null);
  samlSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  tokenSecurityEvent.setSecurityToken(samlSecurityToken);
  policyEnforcer.registerSecurityEvent(tokenSecurityEvent);
  tokenSecurityEvent=new SamlTokenSecurityEvent();
  samlSecurityToken=new SamlSecurityTokenImpl(samlAssertionWrapper,getX509Token(WSSecurityTokenConstants.X509V3Token),null,null,WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE,null);
  samlSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  tokenSecurityEvent.setSecurityToken(samlSecurityToken);
  policyEnforcer.registerSecurityEvent(tokenSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof WSSPolicyException);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRelTokenSupportingTokenPolicyAdditionalTokenNegative() throws Exception {
  String policyString="<sp:SupportingTokens xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "       <sp:RelToken>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "       </sp:RelToken>\n"+ "   </wsp:Policy>\n"+ "</sp:SupportingTokens>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  RelTokenSecurityEvent tokenSecurityEvent=new RelTokenSecurityEvent();
  tokenSecurityEvent.setIssuerName("test");
  X509SecurityTokenImpl x509SecurityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  x509SecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  tokenSecurityEvent.setSecurityToken(x509SecurityToken);
  policyEnforcer.registerSecurityEvent(tokenSecurityEvent);
  tokenSecurityEvent=new RelTokenSecurityEvent();
  tokenSecurityEvent.setIssuerName("test");
  x509SecurityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  x509SecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  tokenSecurityEvent.setSecurityToken(x509SecurityToken);
  policyEnforcer.registerSecurityEvent(tokenSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof WSSPolicyException);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testX509SupportingTokenPolicyAdditionalTokenNegative() throws Exception {
  String policyString="<sp:SupportingTokens xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "       <sp:X509Token>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireThumbprintReference/>\n"+ "               <sp:WssX509V3Token11/>\n"+ "           </wsp:Policy>\n"+ "       </sp:X509Token>\n"+ "   </wsp:Policy>\n"+ "</sp:SupportingTokens>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl x509SecurityToken=getX509Token(WSSecurityTokenConstants.X509V1Token);
  x509SecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  x509TokenSecurityEvent.setSecurityToken(x509SecurityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  x509TokenSecurityEvent=new X509TokenSecurityEvent();
  x509SecurityToken=getX509Token(WSSecurityTokenConstants.X509V1Token);
  x509SecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  x509TokenSecurityEvent.setSecurityToken(x509SecurityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof WSSPolicyException);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSecureConversationTokenSupportingTokenPolicyAdditionalTokenNegative() throws Exception {
  String policyString="<sp:SupportingTokens xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "       <sp:SecureConversationToken>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <wsp:Policy/>\n"+ "       </sp:SecureConversationToken>\n"+ "   </wsp:Policy>\n"+ "</sp:SupportingTokens>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  SecurityContextTokenSecurityEvent tokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  tokenSecurityEvent.setIssuerName("test");
  X509SecurityTokenImpl x509SecurityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  x509SecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  tokenSecurityEvent.setSecurityToken(x509SecurityToken);
  policyEnforcer.registerSecurityEvent(tokenSecurityEvent);
  tokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  tokenSecurityEvent.setIssuerName("test");
  x509SecurityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  x509SecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  tokenSecurityEvent.setSecurityToken(x509SecurityToken);
  policyEnforcer.registerSecurityEvent(tokenSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof WSSPolicyException);
  }
}

</code></pre>

<br>
<pre class="type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSupportingTokenPolicyNegative() throws Exception {
  String policyString="<sp:SupportingTokens xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "       <sp:X509Token>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireThumbprintReference/>\n"+ "               <sp:WssX509V3Token11/>\n"+ "           </wsp:Policy>\n"+ "       </sp:X509Token>\n"+ "   </wsp:Policy>\n"+ "</sp:SupportingTokens>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl x509SecurityToken=getX509Token(WSSecurityTokenConstants.X509V1Token);
  x509SecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  x509TokenSecurityEvent.setSecurityToken(x509SecurityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"X509Certificate Version 3 mismatch; Policy enforces WssX509V3Token11");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKerberosSupportingTokenPolicyAdditionalTokenNegative() throws Exception {
  String policyString="<sp:SupportingTokens xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "       <sp:KerberosToken>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <wsp:Policy/>\n"+ "       </sp:KerberosToken>\n"+ "   </wsp:Policy>\n"+ "</sp:SupportingTokens>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  KerberosTokenSecurityEvent tokenSecurityEvent=new KerberosTokenSecurityEvent();
  tokenSecurityEvent.setIssuerName("test");
  KerberosServiceSecurityTokenImpl kerberosServiceSecurityToken=getKerberosServiceSecurityToken(WSSecurityTokenConstants.KERBEROS_TOKEN);
  kerberosServiceSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  tokenSecurityEvent.setSecurityToken(kerberosServiceSecurityToken);
  policyEnforcer.registerSecurityEvent(tokenSecurityEvent);
  tokenSecurityEvent=new KerberosTokenSecurityEvent();
  tokenSecurityEvent.setIssuerName("test");
  kerberosServiceSecurityToken=getKerberosServiceSecurityToken(WSSecurityTokenConstants.KERBEROS_TOKEN);
  kerberosServiceSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  tokenSecurityEvent.setSecurityToken(kerberosServiceSecurityToken);
  policyEnforcer.registerSecurityEvent(tokenSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof WSSPolicyException);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testIssuedSupportingTokenPolicyAdditionalTokenNegative() throws Exception {
  String policyString="<sp:SupportingTokens xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "       <sp:IssuedToken>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <sp:RequestSecurityTokenTemplate/>\n"+ "           <wsp:Policy/>\n"+ "       </sp:IssuedToken>\n"+ "   </wsp:Policy>\n"+ "</sp:SupportingTokens>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  SecurityContextTokenSecurityEvent securityContextTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  securityContextTokenSecurityEvent.setIssuerName("test");
  X509SecurityTokenImpl x509SecurityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  x509SecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  securityContextTokenSecurityEvent.setSecurityToken(x509SecurityToken);
  policyEnforcer.registerSecurityEvent(securityContextTokenSecurityEvent);
  securityContextTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  securityContextTokenSecurityEvent.setIssuerName("test");
  x509SecurityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  x509SecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  securityContextTokenSecurityEvent.setSecurityToken(x509SecurityToken);
  policyEnforcer.registerSecurityEvent(securityContextTokenSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof WSSPolicyException);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUsernameSupportingTokenPolicyAdditionalTokenNegative() throws Exception {
  String policyString="<sp:SupportingTokens xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "       <sp:UsernameToken>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:NoPassword/>\n"+ "           </wsp:Policy>\n"+ "       </sp:UsernameToken>\n"+ "   </wsp:Policy>\n"+ "</sp:SupportingTokens>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  UsernameTokenSecurityEvent usernameTokenSecurityEvent=new UsernameTokenSecurityEvent();
  usernameTokenSecurityEvent.setUsernameTokenProfile(WSSConstants.NS_USERNAMETOKEN_PROFILE11);
  UsernameSecurityTokenImpl securityToken=new UsernameSecurityTokenImpl(WSSConstants.UsernameTokenPasswordType.PASSWORD_DIGEST,"username",null,new Date().toString(),null,new byte[10],10L,null,IDGenerator.generateID(null),WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  usernameTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(usernameTokenSecurityEvent);
  usernameTokenSecurityEvent=new UsernameTokenSecurityEvent();
  usernameTokenSecurityEvent.setUsernameTokenProfile(WSSConstants.NS_USERNAMETOKEN_PROFILE11);
  securityToken=new UsernameSecurityTokenImpl(WSSConstants.UsernameTokenPasswordType.PASSWORD_DIGEST,"username",null,new Date().toString(),null,new byte[10],10L,null,IDGenerator.generateID(null),WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  usernameTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(usernameTokenSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof WSSPolicyException);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSpnegoSupportingTokenPolicyAdditionalTokenNegative() throws Exception {
  String policyString="<sp:SupportingTokens xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "       <sp:SpnegoContextToken>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <wsp:Policy/>\n"+ "       </sp:SpnegoContextToken>\n"+ "   </wsp:Policy>\n"+ "</sp:SupportingTokens>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  SecurityContextTokenSecurityEvent tokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  tokenSecurityEvent.setIssuerName("test");
  X509SecurityTokenImpl x509SecurityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  x509SecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  tokenSecurityEvent.setSecurityToken(x509SecurityToken);
  policyEnforcer.registerSecurityEvent(tokenSecurityEvent);
  tokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  tokenSecurityEvent.setIssuerName("test");
  x509SecurityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  x509SecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  tokenSecurityEvent.setSecurityToken(x509SecurityToken);
  policyEnforcer.registerSecurityEvent(tokenSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof WSSPolicyException);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.SymmetricBindingTest </h4><pre class="type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicySignatureNotEncrypted() throws Exception {
  String policyString="<sp:SymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:IncludeTimestamp/>\n"+ "<sp:EncryptSignature/>\n"+ "<sp:ProtectTokens/>\n"+ "<sp:OnlySignEntireHeadersAndBody/>\n"+ "</wsp:Policy>\n"+ "</sp:SymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  TimestampSecurityEvent timestampSecurityEvent=new TimestampSecurityEvent();
  policyEnforcer.registerSecurityEvent(timestampSecurityEvent);
  SecurityContextTokenSecurityEvent initiatorTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  SecureConversationSecurityTokenImpl securityToken=new SecureConversationSecurityTokenImpl(null,"1",WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  SecurityContextTokenSecurityEvent recipientTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  securityToken=new SecureConversationSecurityTokenImpl(null,"1",WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  EncryptedElementSecurityEvent encryptedElementSecurityEvent=new EncryptedElementSecurityEvent(null,false,protectionOrder);
  List<QName> headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  headerPath.add(WSSConstants.TAG_dsig_Signature);
  encryptedElementSecurityEvent.setElementPath(headerPath);
  policyEnforcer.registerSecurityEvent(encryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getCause().getMessage(),"Element /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security/{http://www.w3.org/2000/09/xmldsig#}Signature must be encrypted");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyWrongProtectionOrder() throws Exception {
  String policyString="<sp:SymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:IncludeTimestamp/>\n"+ "<sp:EncryptBeforeSigning/>\n"+ "<sp:EncryptSignature/>\n"+ "<sp:ProtectTokens/>\n"+ "<sp:OnlySignEntireHeadersAndBody/>\n"+ "</wsp:Policy>\n"+ "</sp:SymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  SecurityContextTokenSecurityEvent SecurityContextTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  SecureConversationSecurityTokenImpl securityToken=new SecureConversationSecurityTokenImpl(null,"1",WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  SecurityContextTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(SecurityContextTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent(null,true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Policy enforces EncryptBeforeSigning but the /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Body was signed and then encrypted");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNotWholeBodySigned() throws Exception {
  String policyString="<sp:SymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:IncludeTimestamp/>\n"+ "<sp:EncryptSignature/>\n"+ "<sp:OnlySignEntireHeadersAndBody/>\n"+ "</wsp:Policy>\n"+ "</sp:SymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  TimestampSecurityEvent timestampSecurityEvent=new TimestampSecurityEvent();
  policyEnforcer.registerSecurityEvent(timestampSecurityEvent);
  SecurityContextTokenSecurityEvent initiatorTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  SecureConversationSecurityTokenImpl securityToken=new SecureConversationSecurityTokenImpl(null,"1",WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  SecurityContextTokenSecurityEvent recipientTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  securityToken=new SecureConversationSecurityTokenImpl(null,"1",WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  EncryptedElementSecurityEvent encryptedElementSecurityEvent=new EncryptedElementSecurityEvent(null,true,protectionOrder);
  List<QName> headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  headerPath.add(WSSConstants.TAG_dsig_Signature);
  encryptedElementSecurityEvent.setElementPath(headerPath);
  policyEnforcer.registerSecurityEvent(encryptedElementSecurityEvent);
  encryptedElementSecurityEvent=new EncryptedElementSecurityEvent(null,true,protectionOrder);
  headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  headerPath.add(WSSConstants.TAG_WSSE11_SIG_CONF);
  encryptedElementSecurityEvent.setElementPath(headerPath);
  policyEnforcer.registerSecurityEvent(encryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent(null,true,protectionOrder);
  QName elementName=new QName("http://www.example.com","bodyChildElement");
  signedPartSecurityEvent.setXmlSecEvent(XMLSecEventFactory.createXmlSecStartElement(elementName,null,null));
  List<QName> elementPath=new ArrayList<>();
  elementPath.addAll(WSSConstants.SOAP_11_BODY_PATH);
  elementPath.add(elementName);
  signedPartSecurityEvent.setElementPath(elementPath);
  try {
    policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"OnlySignEntireHeadersAndBody not fulfilled, offending element: " + "/{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Body/{http://www.example.com}bodyChildElement");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNotIncludeTimestamp() throws Exception {
  String policyString="<sp:SymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:EncryptSignature/>\n"+ "<sp:ProtectTokens/>\n"+ "<sp:OnlySignEntireHeadersAndBody/>\n"+ "</wsp:Policy>\n"+ "</sp:SymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  SecurityContextTokenSecurityEvent initiatorTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  SecureConversationSecurityTokenImpl securityToken=new SecureConversationSecurityTokenImpl(null,"1",WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  SecurityContextTokenSecurityEvent recipientTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  securityToken=new SecureConversationSecurityTokenImpl(null,"1",WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  TimestampSecurityEvent timestampSecurityEvent=new TimestampSecurityEvent();
  policyEnforcer.registerSecurityEvent(timestampSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Timestamp must not be present");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.TokenProtectionTest </h4><pre class="type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNoTokenProtection() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  List<QName> bstPath=new ArrayList<>();
  bstPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  bstPath.add(WSSConstants.TAG_WSSE_BINARY_SECURITY_TOKEN);
  List<QName> sigPath=new ArrayList<>();
  sigPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  sigPath.add(WSSConstants.TAG_dsig_Signature);
  List<SecurityToken> securityTokens=new LinkedList<>();
  for (int i=0; i < tokenUsages.size(); i++) {
    WSSecurityTokenConstants.TokenUsage tokenUsage=tokenUsages.get(i);
    X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
    X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
    securityTokens.add(securityToken);
    securityToken.setElementPath(bstPath);
    securityToken.addTokenUsage(tokenUsage);
    x509TokenSecurityEvent.setSecurityToken(securityToken);
    policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
    if (tokenUsage.getName().contains("Endorsing")) {
      SignedElementSecurityEvent signedElementSecurityEvent=new SignedElementSecurityEvent(securityToken,true,protectionOrder);
      signedElementSecurityEvent.setElementPath(sigPath);
      policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
    }
  }
  SecurityToken mainSignatureToken=null;
  Iterator<SecurityToken> securityTokenIterator=securityTokens.iterator();
  while (securityTokenIterator.hasNext()) {
    SecurityToken securityToken=securityTokenIterator.next();
    if (securityToken.getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE)) {
      mainSignatureToken=securityToken;
      break;
    }
  }
  securityTokenIterator=securityTokens.iterator();
  while (securityTokenIterator.hasNext()) {
    SecurityToken securityToken=securityTokenIterator.next();
    if (securityToken.getTokenUsages().get(0).getName().contains("Signed")) {
      SignedElementSecurityEvent signedElementSecurityEvent=new SignedElementSecurityEvent((InboundSecurityToken)mainSignatureToken,true,protectionOrder);
      signedElementSecurityEvent.setElementPath(bstPath);
      policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
    }
  }
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Token /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}BinarySecurityToken must not be signed by its signature.");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyEndorsingTokenNotSigningMainSignatureToken() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:ProtectTokens/>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  List<QName> bstPath=new ArrayList<>();
  bstPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  bstPath.add(WSSConstants.TAG_WSSE_BINARY_SECURITY_TOKEN);
  List<SecurityToken> securityTokens=new LinkedList<>();
  for (int i=0; i < tokenUsages.size(); i++) {
    WSSecurityTokenConstants.TokenUsage tokenUsage=tokenUsages.get(i);
    X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
    X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
    securityTokens.add(securityToken);
    securityToken.setElementPath(bstPath);
    securityToken.addTokenUsage(tokenUsage);
    x509TokenSecurityEvent.setSecurityToken(securityToken);
    policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
    if (tokenUsage.getName().contains("Signature") || tokenUsage.getName().contains("Endorsing")) {
      SignedElementSecurityEvent signedElementSecurityEvent=new SignedElementSecurityEvent(securityToken,true,protectionOrder);
      signedElementSecurityEvent.setElementPath(bstPath);
      policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
    }
  }
  SecurityToken mainSignatureToken=null;
  Iterator<SecurityToken> securityTokenIterator=securityTokens.iterator();
  while (securityTokenIterator.hasNext()) {
    SecurityToken securityToken=securityTokenIterator.next();
    if (securityToken.getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE)) {
      mainSignatureToken=securityToken;
      break;
    }
  }
  securityTokenIterator=securityTokens.iterator();
  while (securityTokenIterator.hasNext()) {
    SecurityToken securityToken=securityTokenIterator.next();
    if (securityToken.getTokenUsages().get(0).getName().contains("Signed")) {
      SignedElementSecurityEvent signedElementSecurityEvent=new SignedElementSecurityEvent((InboundSecurityToken)mainSignatureToken,true,protectionOrder);
      signedElementSecurityEvent.setElementPath(bstPath);
      policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
    }
  }
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Token /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}BinarySecurityToken must sign the main signature.");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicySymmetricBindingProtectRootToken() throws Exception {
  String policyString="<sp:SymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:ProtectTokens/>\n"+ "</wsp:Policy>\n"+ "</sp:SymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  List<QName> bstPath=new ArrayList<>();
  bstPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  bstPath.add(WSSConstants.TAG_WSSE_BINARY_SECURITY_TOKEN);
  List<QName> ekPath=new ArrayList<>();
  ekPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  ekPath.add(WSSConstants.TAG_xenc_EncryptedKey);
  List<QName> sigPath=new ArrayList<>();
  sigPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  sigPath.add(WSSConstants.TAG_dsig_Signature);
  X509SecurityTokenImpl x509SecurityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  x509SecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  x509SecurityToken.setElementPath(bstPath);
  AbstractInboundSecurityToken ekSecurityToken=new AbstractInboundSecurityToken(null,IDGenerator.generateID(null),SecurityTokenConstants.KeyIdentifier_EncryptedKey,true){
    @Override public SecurityTokenConstants.TokenType getTokenType(){
      return SecurityTokenConstants.EncryptedKeyToken;
    }
  }
;
  ekSecurityToken.addTokenUsage(WSSecurityTokenConstants.TokenUsage_Signature);
  ekSecurityToken.setKeyWrappingToken(x509SecurityToken);
  ekSecurityToken.setElementPath(ekPath);
  x509SecurityToken.addWrappedToken(ekSecurityToken);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  x509TokenSecurityEvent.setSecurityToken(x509SecurityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  EncryptedKeyTokenSecurityEvent encryptedKeyTokenSecurityEvent=new EncryptedKeyTokenSecurityEvent();
  encryptedKeyTokenSecurityEvent.setSecurityToken(ekSecurityToken);
  policyEnforcer.registerSecurityEvent(encryptedKeyTokenSecurityEvent);
  SignedElementSecurityEvent signedElementSecurityEvent=new SignedElementSecurityEvent(x509SecurityToken,true,protectionOrder);
  signedElementSecurityEvent.setElementPath(bstPath);
  policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Token /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security/{http://www.w3.org/2001/04/xmlenc#}EncryptedKey must be signed by its signature.");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyMainSignatureNotSigningEndorsingSignatureTokens() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:ProtectTokens/>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  List<QName> bstPath=new ArrayList<>();
  bstPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  bstPath.add(WSSConstants.TAG_WSSE_BINARY_SECURITY_TOKEN);
  List<QName> sigPath=new ArrayList<>();
  sigPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  sigPath.add(WSSConstants.TAG_dsig_Signature);
  for (int i=0; i < tokenUsages.size(); i++) {
    WSSecurityTokenConstants.TokenUsage tokenUsage=tokenUsages.get(i);
    X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
    X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
    securityToken.setElementPath(bstPath);
    securityToken.addTokenUsage(tokenUsage);
    x509TokenSecurityEvent.setSecurityToken(securityToken);
    policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
    if (tokenUsage.getName().contains("Signature") || tokenUsage.getName().contains("Endorsing")) {
      SignedElementSecurityEvent signedElementSecurityEvent=new SignedElementSecurityEvent(securityToken,true,protectionOrder);
      signedElementSecurityEvent.setElementPath(bstPath);
      policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
    }
    if (tokenUsage.getName().contains("Endorsing")) {
      SignedElementSecurityEvent signedElementSecurityEvent=new SignedElementSecurityEvent(securityToken,true,protectionOrder);
      signedElementSecurityEvent.setElementPath(sigPath);
      policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
    }
  }
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Main signature must sign the Signed*Supporting-Tokens.");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyElementSignedByOtherSignature() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:ProtectTokens/>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  List<QName> path=new ArrayList<>();
  path.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  path.add(WSSConstants.TAG_WSSE_BINARY_SECURITY_TOKEN);
  securityToken.setElementPath(path);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  SignedElementSecurityEvent signedElementSecurityEvent=new SignedElementSecurityEvent(getX509Token(WSSecurityTokenConstants.X509V3Token),false,protectionOrder);
  signedElementSecurityEvent.setElementPath(path);
  policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Token /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}BinarySecurityToken must be signed by its signature.");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyElementNotSigned() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:ProtectTokens/>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  List<QName> path=new ArrayList<>();
  path.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  path.add(WSSConstants.TAG_WSSE_BINARY_SECURITY_TOKEN);
  securityToken.setElementPath(path);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  SignedElementSecurityEvent signedElementSecurityEvent=new SignedElementSecurityEvent(securityToken,false,protectionOrder);
  signedElementSecurityEvent.setElementPath(path);
  policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Token /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}BinarySecurityToken must be signed by its signature.");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyElementSignedByOtherSignatureReverseSecurityEventOrder() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:ProtectTokens/>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  List<QName> path=new ArrayList<>();
  path.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  path.add(WSSConstants.TAG_WSSE_BINARY_SECURITY_TOKEN);
  securityToken.setElementPath(path);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  SignedElementSecurityEvent signedElementSecurityEvent=new SignedElementSecurityEvent(getX509Token(WSSecurityTokenConstants.X509V3Token),false,protectionOrder);
  signedElementSecurityEvent.setElementPath(path);
  policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Token /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}BinarySecurityToken must be signed by its signature.");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.TransportBindingIntegrationTest </h4><pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testIncludeTimestampPolicyNegativeTest() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:TransportBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:TransportToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:HttpsToken>\n"+ "                                    <!--<sp:Issuer>wsa:EndpointReferenceType</sp:Issuer>-->\n"+ "                                    <sp:IssuerName>transmitter</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:HttpBasicAuthentication/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:HttpsToken>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:TransportToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:TransportBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,null));
  HttpsTokenSecurityEvent httpsTokenSecurityEvent=new HttpsTokenSecurityEvent();
  httpsTokenSecurityEvent.setIssuerName("transmitter");
  httpsTokenSecurityEvent.setAuthenticationType(HttpsTokenSecurityEvent.AuthenticationType.HttpBasicAuthentication);
  HttpsSecurityTokenImpl httpsSecurityToken=new HttpsSecurityTokenImpl(true,"transmitter");
  httpsSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  httpsTokenSecurityEvent.setSecurityToken(httpsSecurityToken);
  List<SecurityEvent> securityEventList=new ArrayList<>();
  securityEventList.add(httpsTokenSecurityEvent);
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),securityEventList,policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Element /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp must be present");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testC14NAlgorithmSuiteNegative() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:TransportBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:TransportToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:HttpsToken>\n"+ "                                    <!--<sp:Issuer>wsa:EndpointReferenceType</sp:Issuer>-->\n"+ "                                    <sp:IssuerName>transmitter</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:HttpBasicAuthentication/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:HttpsToken>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:TransportToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:TransportBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureCanonicalizationAlgorithm("http://www.w3.org/2006/12/xml-c14n11");
  outSecurityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart()),SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.TAG_WSU_CREATED.getNamespaceURI(),WSSConstants.TAG_WSU_CREATED.getLocalPart()),SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.TAG_WSU_EXPIRES.getNamespaceURI(),WSSConstants.TAG_WSU_EXPIRES.getLocalPart()),SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.addIgnoreBSPRule(BSPRule.R5404);
  inSecurityProperties.addIgnoreBSPRule(BSPRule.R5423);
  inSecurityProperties.addIgnoreBSPRule(BSPRule.R5412);
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,null));
  HttpsTokenSecurityEvent httpsTokenSecurityEvent=new HttpsTokenSecurityEvent();
  httpsTokenSecurityEvent.setIssuerName("transmitter");
  httpsTokenSecurityEvent.setAuthenticationType(HttpsTokenSecurityEvent.AuthenticationType.HttpBasicAuthentication);
  HttpsSecurityTokenImpl httpsSecurityToken=new HttpsSecurityTokenImpl(true,"transmitter");
  httpsSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  httpsTokenSecurityEvent.setSecurityToken(httpsSecurityToken);
  List<SecurityEvent> securityEventList=new ArrayList<>();
  securityEventList.add(httpsTokenSecurityEvent);
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),securityEventList,policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"C14N algorithm http://www.w3.org/2006/12/xml-c14n11 does not meet policy");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHttpsClientAuthenticationPolicyNegative() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:TransportBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:TransportToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:HttpsToken>\n"+ "                                    <!--<sp:Issuer>wsa:EndpointReferenceType</sp:Issuer>-->\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:RequireClientCertificate/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:HttpsToken>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:TransportToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:TransportBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "                <sp:SignedSupportingTokens>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:UsernameToken sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                            <wsp:Policy>\n"+ "                                <!--<sp:HashPassword/>-->\n"+ "                                <sp:NoPassword/>\n"+ "                                <!--<sp:Created/>\n"+ "                                <sp:Nonce/>-->\n"+ "                            </wsp:Policy>\n"+ "                        </sp:UsernameToken>\n"+ "                    </wsp:Policy>\n"+ "                </sp:SignedSupportingTokens>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.setTokenUser("transmitter");
  outSecurityProperties.setUsernameTokenPasswordType(WSSConstants.UsernameTokenPasswordType.PASSWORD_NONE);
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.USERNAMETOKEN);
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,null));
  HttpsTokenSecurityEvent httpsTokenSecurityEvent=new HttpsTokenSecurityEvent();
  httpsTokenSecurityEvent.setIssuerName("CN=example,OU=swssf,C=CH");
  httpsTokenSecurityEvent.setAuthenticationType(HttpsTokenSecurityEvent.AuthenticationType.HttpsClientCertificateAuthentication);
  HttpsSecurityTokenImpl httpsSecurityToken=new HttpsSecurityTokenImpl(true,"CN=example,OU=swssf,C=CH");
  httpsSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  httpsTokenSecurityEvent.setSecurityToken(httpsSecurityToken);
  List<SecurityEvent> securityEventList=new ArrayList<>();
  securityEventList.add(httpsTokenSecurityEvent);
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),securityEventList,policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"IssuerName in Policy (CN=transmitter,OU=swssf,C=CH) didn't match with the one in the HttpsToken (CN=example,OU=swssf,C=CH)");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testIncludeTimestampAndSignedUsernameSupportingTokenPolicyNegativeTest_2() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:TransportBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:TransportToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:HttpsToken>\n"+ "                                    <!--<sp:Issuer>wsa:EndpointReferenceType</sp:Issuer>-->\n"+ "                                    <sp:IssuerName>transmitter</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:HttpBasicAuthentication/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:HttpsToken>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:TransportToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                    </wsp:Policy>\n"+ "                </sp:TransportBinding>\n"+ "                <sp:SignedSupportingTokens>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:UsernameToken sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                            <wsp:Policy>\n"+ "                                <sp:NoPassword/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:UsernameToken>\n"+ "                    </wsp:Policy>\n"+ "                </sp:SignedSupportingTokens>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.setTokenUser("transmitter");
  outSecurityProperties.setUsernameTokenPasswordType(WSSConstants.UsernameTokenPasswordType.PASSWORD_NONE);
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  HttpsTokenSecurityEvent httpsTokenSecurityEvent=new HttpsTokenSecurityEvent();
  httpsTokenSecurityEvent.setIssuerName("transmitter");
  httpsTokenSecurityEvent.setAuthenticationType(HttpsTokenSecurityEvent.AuthenticationType.HttpBasicAuthentication);
  HttpsSecurityTokenImpl httpsSecurityToken=new HttpsSecurityTokenImpl(true,"transmitter");
  httpsSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  httpsTokenSecurityEvent.setSecurityToken(httpsSecurityToken);
  List<SecurityEvent> securityEventList=new ArrayList<>();
  securityEventList.add(httpsTokenSecurityEvent);
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),securityEventList,policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Assertion {http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702}UsernameToken not satisfied");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureDigestAlgorithmSuiteNegative() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:TransportBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:TransportToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:HttpsToken>\n"+ "                                    <!--<sp:Issuer>wsa:EndpointReferenceType</sp:Issuer>-->\n"+ "                                    <sp:IssuerName>transmitter</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:HttpBasicAuthentication/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:HttpsToken>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:TransportToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:TransportBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureDigestAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-md5");
  outSecurityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart()),SecurePart.Modifier.Element,new String[]{WSSConstants.NS_C14N_EXCL},"http://www.w3.org/2001/04/xmldsig-more#md5"));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element,new String[]{WSSConstants.NS_C14N_EXCL},"http://www.w3.org/2001/04/xmldsig-more#md5"));
  outSecurityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.TAG_WSU_CREATED.getNamespaceURI(),WSSConstants.TAG_WSU_CREATED.getLocalPart()),SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.TAG_WSU_EXPIRES.getNamespaceURI(),WSSConstants.TAG_WSU_EXPIRES.getLocalPart()),SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.addIgnoreBSPRule(BSPRule.R5420);
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,null));
  HttpsTokenSecurityEvent httpsTokenSecurityEvent=new HttpsTokenSecurityEvent();
  httpsTokenSecurityEvent.setIssuerName("transmitter");
  httpsTokenSecurityEvent.setAuthenticationType(HttpsTokenSecurityEvent.AuthenticationType.HttpBasicAuthentication);
  HttpsSecurityTokenImpl httpsSecurityToken=new HttpsSecurityTokenImpl(true,"transmitter");
  httpsSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  httpsTokenSecurityEvent.setSecurityToken(httpsSecurityToken);
  List<SecurityEvent> securityEventList=new ArrayList<>();
  securityEventList.add(httpsTokenSecurityEvent);
  try {
    Init.init(WSSec.class.getClassLoader().getResource("wss/wss-config.xml").toURI(),WSSec.class);
    switchAllowMD5Algorithm(true);
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),securityEventList,policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
  }
 finally {
    switchAllowMD5Algorithm(false);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureAlgorithmSuiteNegative() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:TransportBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:TransportToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:HttpsToken>\n"+ "                                    <!--<sp:Issuer>wsa:EndpointReferenceType</sp:Issuer>-->\n"+ "                                    <sp:IssuerName>transmitter</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:HttpBasicAuthentication/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:HttpsToken>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:TransportToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:TransportBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha512");
  outSecurityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart()),SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.TAG_WSU_CREATED.getNamespaceURI(),WSSConstants.TAG_WSU_CREATED.getLocalPart()),SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.TAG_WSU_EXPIRES.getNamespaceURI(),WSSConstants.TAG_WSU_EXPIRES.getLocalPart()),SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.addIgnoreBSPRule(BSPRule.R5421);
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,null));
  HttpsTokenSecurityEvent httpsTokenSecurityEvent=new HttpsTokenSecurityEvent();
  httpsTokenSecurityEvent.setIssuerName("transmitter");
  httpsTokenSecurityEvent.setAuthenticationType(HttpsTokenSecurityEvent.AuthenticationType.HttpBasicAuthentication);
  HttpsSecurityTokenImpl httpsSecurityToken=new HttpsSecurityTokenImpl(true,"transmitter");
  httpsSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  httpsTokenSecurityEvent.setSecurityToken(httpsSecurityToken);
  List<SecurityEvent> securityEventList=new ArrayList<>();
  securityEventList.add(httpsTokenSecurityEvent);
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),securityEventList,policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Asymmetric algorithm http://www.w3.org/2001/04/xmldsig-more#rsa-sha512 does not meet policy");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testIncludeTimestampAndSignedUsernameSupportingTokenPolicyNegativeTest() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:TransportBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:TransportToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:HttpsToken>\n"+ "                                    <!--<sp:Issuer>wsa:EndpointReferenceType</sp:Issuer>-->\n"+ "                                    <sp:IssuerName>transmitter</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:HttpBasicAuthentication/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:HttpsToken>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:TransportToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:TransportBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "                <sp:SignedSupportingTokens>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:UsernameToken sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                            <wsp:Policy>\n"+ "                                <sp:NoPassword/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:UsernameToken>\n"+ "                    </wsp:Policy>\n"+ "                </sp:SignedSupportingTokens>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.setTokenUser("transmitter");
  outSecurityProperties.setUsernameTokenPasswordType(WSSConstants.UsernameTokenPasswordType.PASSWORD_NONE);
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,null));
  HttpsTokenSecurityEvent httpsTokenSecurityEvent=new HttpsTokenSecurityEvent();
  httpsTokenSecurityEvent.setIssuerName("transmitter");
  httpsTokenSecurityEvent.setAuthenticationType(HttpsTokenSecurityEvent.AuthenticationType.HttpBasicAuthentication);
  HttpsSecurityTokenImpl httpsSecurityToken=new HttpsSecurityTokenImpl(true,"transmitter");
  httpsSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  httpsTokenSecurityEvent.setSecurityToken(httpsSecurityToken);
  List<SecurityEvent> securityEventList=new ArrayList<>();
  securityEventList.add(httpsTokenSecurityEvent);
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),securityEventList,policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Assertion {http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702}UsernameToken not satisfied");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptionAlgorithmSuiteNegative() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:TransportBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:TransportToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:HttpsToken>\n"+ "                                    <!--<sp:Issuer>wsa:EndpointReferenceType</sp:Issuer>-->\n"+ "                                    <sp:IssuerName>transmitter</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:HttpBasicAuthentication/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:HttpsToken>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:TransportToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:TransportBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setEncryptionSymAlgorithm("http://www.w3.org/2001/04/xmlenc#tripledes-cbc");
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart()),SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.TAG_WSU_CREATED.getNamespaceURI(),WSSConstants.TAG_WSU_CREATED.getLocalPart()),SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.TAG_WSU_EXPIRES.getNamespaceURI(),WSSConstants.TAG_WSU_EXPIRES.getLocalPart()),SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,null));
  HttpsTokenSecurityEvent httpsTokenSecurityEvent=new HttpsTokenSecurityEvent();
  httpsTokenSecurityEvent.setIssuerName("transmitter");
  httpsTokenSecurityEvent.setAuthenticationType(HttpsTokenSecurityEvent.AuthenticationType.HttpBasicAuthentication);
  HttpsSecurityTokenImpl httpsSecurityToken=new HttpsSecurityTokenImpl(true,"transmitter");
  httpsSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  httpsTokenSecurityEvent.setSecurityToken(httpsSecurityToken);
  List<SecurityEvent> securityEventList=new ArrayList<>();
  securityEventList.add(httpsTokenSecurityEvent);
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),securityEventList,policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Encryption algorithm http://www.w3.org/2001/04/xmlenc#tripledes-cbc does not meet policy\n" + "Symmetric encryption algorithm key length 192 does not meet policy");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.TransportBindingTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNotIncludeTimestamp() throws Exception {
  String policyString="<sp:TransportBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:TransportBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  HttpsTokenSecurityEvent httpsTokenSecurityEvent=new HttpsTokenSecurityEvent();
  HttpsSecurityTokenImpl httpsSecurityToken=new HttpsSecurityTokenImpl(true,"username");
  httpsSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  httpsTokenSecurityEvent.setSecurityToken(httpsSecurityToken);
  policyEnforcer.registerSecurityEvent(httpsTokenSecurityEvent);
  TimestampSecurityEvent timestampSecurityEvent=new TimestampSecurityEvent();
  policyEnforcer.registerSecurityEvent(timestampSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Timestamp must not be present");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.UsernameTokenTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNegative() throws Exception {
  String policyString="<sp:SymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:EncryptionToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:UsernameToken>\n"+ "           <sp:IssuerName>xs:anyURI</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:HashPassword/>\n"+ "               <sp:WssUsernameToken11/>\n"+ "           </wsp:Policy>\n"+ "       </sp:UsernameToken>\n"+ "   </wsp:Policy>\n"+ "</sp:EncryptionToken>\n"+ "<sp:SignatureToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:UsernameToken>\n"+ "           <sp:IssuerName>xs:anyURI</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:HashPassword/>\n"+ "               <sp:WssUsernameToken11/>\n"+ "           </wsp:Policy>\n"+ "       </sp:UsernameToken>\n"+ "   </wsp:Policy>\n"+ "</sp:SignatureToken>\n"+ "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:SymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  UsernameTokenSecurityEvent usernameTokenSecurityEvent=new UsernameTokenSecurityEvent();
  usernameTokenSecurityEvent.setUsernameTokenProfile(WSSConstants.NS_USERNAMETOKEN_PROFILE11);
  UsernameSecurityTokenImpl securityToken=new UsernameSecurityTokenImpl(WSSConstants.UsernameTokenPasswordType.PASSWORD_TEXT,"username","password",new Date().toString(),null,new byte[10],10L,null,IDGenerator.generateID(null),WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  usernameTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(usernameTokenSecurityEvent);
  UsernameTokenSecurityEvent recipientTokenSecurityEvent=new UsernameTokenSecurityEvent();
  recipientTokenSecurityEvent.setUsernameTokenProfile(WSSConstants.NS_USERNAMETOKEN_PROFILE11);
  securityToken=new UsernameSecurityTokenImpl(WSSConstants.UsernameTokenPasswordType.PASSWORD_TEXT,"username","password",new Date().toString(),null,new byte[10],10L,null,IDGenerator.generateID(null),WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"UsernameToken does not contain a hashed password");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.VulnerabliltyVectorsTest </h4><pre class="type-3 type-8 type-7 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignedBodyRelocationToHeader() throws Exception {
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  properties.setProperty(WSHandlerConstants.ENC_SYM_ALGO,"http://www.w3.org/2001/04/xmlenc#aes256-cbc");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Body");
  Element bodyElement=(Element)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
  Element soapEnvElement=(Element)bodyElement.getParentNode();
  soapEnvElement.removeChild(bodyElement);
  Element newBody=securedDocument.createElementNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
  Element operationElement=securedDocument.createElementNS("http://schemas.xmlsoap.org/wsdl/","definitions");
  newBody.appendChild(operationElement);
  soapEnvElement.appendChild(newBody);
  xPathExpression=getXPath("/soap:Envelope/soap:Header");
  Element headerElement=(Element)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
  headerElement.appendChild(bodyElement);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcerFactory policyEnforcerFactory=PolicyEnforcerFactory.newInstance(this.getClass().getClassLoader().getResource("testdata/wsdl/actionSpoofing.wsdl"));
  PolicyEnforcer policyEnforcer=policyEnforcerFactory.newPolicyEnforcer("goodPolicy",false,null,0);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    doInboundSecurity(inSecurityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),policyEnforcer);
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Throwable throwable=e.getCause();
    Assert.assertNotNull(throwable);
    Assert.assertTrue(throwable instanceof WSSecurityException);
    Assert.assertEquals(throwable.getMessage(),"Element /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Body must be signed");
    Assert.assertEquals(((WSSecurityException)throwable).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests what happens when an soapAction from an other operation is provided.
 * Can the policy framework be bypassed?
 * @Ignoring as SOAP Action spoofing detection should be left to the SOAP stack
 */
@Test @org.junit.Ignore public void testSOAPActionSpoofing() throws Exception {
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcerFactory policyEnforcerFactory=PolicyEnforcerFactory.newInstance(this.getClass().getClassLoader().getResource("testdata/wsdl/actionSpoofing.wsdl"));
  PolicyEnforcer policyEnforcer=policyEnforcerFactory.newPolicyEnforcer("emptyPolicy",false,null,0);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Throwable throwable=e.getCause();
    Assert.assertNotNull(throwable);
    Assert.assertTrue(throwable instanceof WSSecurityException);
    Assert.assertEquals(throwable.getMessage(),"SOAPAction (emptyPolicyOperation) does not match with the current Operation: " + "{http://schemas.xmlsoap.org/wsdl/}definitions");
    Assert.assertEquals(((WSSecurityException)throwable).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.X509TokenTest </h4><pre class="type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNegative() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:InitiatorToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:X509Token>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireThumbprintReference/>\n"+ "               <sp:WssX509V3Token11/>\n"+ "           </wsp:Policy>\n"+ "       </sp:X509Token>\n"+ "   </wsp:Policy>\n"+ "</sp:InitiatorToken>\n"+ "<sp:RecipientToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:X509Token>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireThumbprintReference/>\n"+ "               <sp:WssX509V3Token11/>\n"+ "           </wsp:Policy>\n"+ "       </sp:X509Token>\n"+ "   </wsp:Policy>\n"+ "</sp:RecipientToken>\n"+ "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  X509TokenSecurityEvent initiatorX509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V1Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorX509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorX509TokenSecurityEvent);
  X509TokenSecurityEvent recipientX509TokenSecurityEvent=new X509TokenSecurityEvent();
  securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientX509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientX509TokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientX509TokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientX509TokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"X509Certificate Version 3 mismatch; Policy enforces WssX509V3Token11");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.AlgorithmSuiteTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAlgorithmSuite() throws Exception {
  String fileName="AlgorithmSuite.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof AlgorithmSuite);
    AlgorithmSuite algorithmSuite=(AlgorithmSuite)alternative.get(0);
    assertFalse(algorithmSuite.isNormalized());
    assertTrue(algorithmSuite.isIgnorable());
    assertTrue(algorithmSuite.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,algorithmSuite.getType());
    assertEquals(SP12Constants.ALGORITHM_SUITE,algorithmSuite.getName());
    assertEquals(algorithmSuite.getAlgorithmSuiteType().getEncryption(),SPConstants.TRIPLE_DES);
    assertEquals(AlgorithmSuite.C14NType.InclusiveC14N,algorithmSuite.getC14n());
    assertEquals(AlgorithmSuite.SOAPNormType.SOAPNormalization10,algorithmSuite.getSoapNormType());
    assertEquals(AlgorithmSuite.STRType.STRTransform10,algorithmSuite.getStrType());
    assertEquals(AlgorithmSuite.XPathType.AbsXPath,algorithmSuite.getXPathType());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  AlgorithmSuite algorithmSuite=(AlgorithmSuite)policyComponentIterator.next();
  assertTrue(algorithmSuite.isNormalized());
  assertTrue(algorithmSuite.isIgnorable());
  assertFalse(algorithmSuite.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,algorithmSuite.getType());
  assertEquals(SP12Constants.ALGORITHM_SUITE,algorithmSuite.getName());
  assertEquals(algorithmSuite.getAlgorithmSuiteType().getEncryption(),SPConstants.TRIPLE_DES);
  assertEquals(AlgorithmSuite.C14NType.InclusiveC14N,algorithmSuite.getC14n());
  assertEquals(AlgorithmSuite.SOAPNormType.SOAPNormalization10,algorithmSuite.getSoapNormType());
  assertEquals(AlgorithmSuite.STRType.STRTransform10,algorithmSuite.getStrType());
  assertEquals(AlgorithmSuite.XPathType.AbsXPath,algorithmSuite.getXPathType());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.AsymmetricBindingTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAsymmetricBinding() throws Exception {
  String fileName="AsymmetricBinding.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof AsymmetricBinding);
    AsymmetricBinding asymmetricBinding=(AsymmetricBinding)alternative.get(0);
    assertFalse(asymmetricBinding.isNormalized());
    assertTrue(asymmetricBinding.isIgnorable());
    assertTrue(asymmetricBinding.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,asymmetricBinding.getType());
    assertEquals(SP12Constants.ASYMMETRIC_BINDING,asymmetricBinding.getName());
    assertNotNull(asymmetricBinding.getInitiatorEncryptionToken());
    assertNotNull(asymmetricBinding.getInitiatorSignatureToken());
    assertNull(asymmetricBinding.getInitiatorToken());
    assertNotNull(asymmetricBinding.getRecipientEncryptionToken());
    assertNotNull(asymmetricBinding.getRecipientSignatureToken());
    assertNull(asymmetricBinding.getRecipientToken());
    assertNotNull(asymmetricBinding.getAlgorithmSuite());
    assertNotNull(asymmetricBinding.getLayout());
    assertEquals(AbstractSymmetricAsymmetricBinding.ProtectionOrder.EncryptBeforeSigning,asymmetricBinding.getProtectionOrder());
    assertTrue(asymmetricBinding.isEncryptSignature());
    assertTrue(asymmetricBinding.isIncludeTimestamp());
    assertTrue(asymmetricBinding.isOnlySignEntireHeadersAndBody());
    assertTrue(asymmetricBinding.isProtectTokens());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  AsymmetricBinding asymmetricBinding=(AsymmetricBinding)policyComponentIterator.next();
  assertTrue(asymmetricBinding.isNormalized());
  assertTrue(asymmetricBinding.isIgnorable());
  assertFalse(asymmetricBinding.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,asymmetricBinding.getType());
  assertEquals(SP12Constants.ASYMMETRIC_BINDING,asymmetricBinding.getName());
  assertNotNull(asymmetricBinding.getInitiatorEncryptionToken());
  assertNotNull(asymmetricBinding.getInitiatorSignatureToken());
  assertNull(asymmetricBinding.getInitiatorToken());
  assertNotNull(asymmetricBinding.getRecipientEncryptionToken());
  assertNotNull(asymmetricBinding.getRecipientSignatureToken());
  assertNull(asymmetricBinding.getRecipientToken());
  assertNotNull(asymmetricBinding.getAlgorithmSuite());
  assertNotNull(asymmetricBinding.getLayout());
  assertEquals(AbstractSymmetricAsymmetricBinding.ProtectionOrder.EncryptBeforeSigning,asymmetricBinding.getProtectionOrder());
  assertTrue(asymmetricBinding.isEncryptSignature());
  assertTrue(asymmetricBinding.isIncludeTimestamp());
  assertTrue(asymmetricBinding.isOnlySignEntireHeadersAndBody());
  assertTrue(asymmetricBinding.isProtectTokens());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.ContentEncryptedElementsTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testContentEncryptedElements() throws Exception {
  String fileName="ContentEncryptedElements.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof ContentEncryptedElements);
    ContentEncryptedElements contentEncryptedElements=(ContentEncryptedElements)alternative.get(0);
    assertFalse(contentEncryptedElements.isNormalized());
    assertTrue(contentEncryptedElements.isIgnorable());
    assertTrue(contentEncryptedElements.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,contentEncryptedElements.getType());
    assertEquals(SP12Constants.CONTENT_ENCRYPTED_ELEMENTS,contentEncryptedElements.getName());
    assertEquals("1.1",contentEncryptedElements.getXPathVersion());
    assertEquals(2,contentEncryptedElements.getXPaths().size());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  ContentEncryptedElements contentEncryptedElements=(ContentEncryptedElements)policyComponentIterator.next();
  assertTrue(contentEncryptedElements.isNormalized());
  assertTrue(contentEncryptedElements.isIgnorable());
  assertFalse(contentEncryptedElements.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,contentEncryptedElements.getType());
  assertEquals(SP12Constants.CONTENT_ENCRYPTED_ELEMENTS,contentEncryptedElements.getName());
  assertEquals("1.1",contentEncryptedElements.getXPathVersion());
  assertEquals(2,contentEncryptedElements.getXPaths().size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.EncryptedElementsTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptedElements() throws Exception {
  String fileName="EncryptedElements.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof EncryptedElements);
    EncryptedElements encryptedElements=(EncryptedElements)alternative.get(0);
    assertFalse(encryptedElements.isNormalized());
    assertTrue(encryptedElements.isIgnorable());
    assertTrue(encryptedElements.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,encryptedElements.getType());
    assertEquals(SP12Constants.ENCRYPTED_ELEMENTS,encryptedElements.getName());
    assertEquals("1.1",encryptedElements.getXPathVersion());
    assertEquals(2,encryptedElements.getXPaths().size());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  EncryptedElements encryptedElements=(EncryptedElements)policyComponentIterator.next();
  assertTrue(encryptedElements.isNormalized());
  assertTrue(encryptedElements.isIgnorable());
  assertFalse(encryptedElements.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,encryptedElements.getType());
  assertEquals(SP12Constants.ENCRYPTED_ELEMENTS,encryptedElements.getName());
  assertEquals("1.1",encryptedElements.getXPathVersion());
  assertEquals(2,encryptedElements.getXPaths().size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.EncryptedPartsTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptedParts12() throws Exception {
  String fileName="EncryptedParts.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof EncryptedParts);
    EncryptedParts encryptedParts=(EncryptedParts)alternative.get(0);
    assertFalse(encryptedParts.isNormalized());
    assertTrue(encryptedParts.isIgnorable());
    assertTrue(encryptedParts.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,encryptedParts.getType());
    assertEquals(SP12Constants.ENCRYPTED_PARTS,encryptedParts.getName());
    assertTrue(encryptedParts.isBody());
    assertNotNull(encryptedParts.getAttachments());
    assertEquals(2,encryptedParts.getHeaders().size());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  EncryptedParts encryptedParts=(EncryptedParts)policyComponentIterator.next();
  assertTrue(encryptedParts.isNormalized());
  assertTrue(encryptedParts.isIgnorable());
  assertFalse(encryptedParts.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,encryptedParts.getType());
  assertEquals(SP12Constants.ENCRYPTED_PARTS,encryptedParts.getName());
  assertTrue(encryptedParts.isBody());
  assertNotNull(encryptedParts.getAttachments());
  assertEquals(2,encryptedParts.getHeaders().size());
}

</code></pre>

<br>
<pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptedParts13() throws Exception {
  String fileName="EncryptedParts.xml";
  String policyFile=loadPolicyFile("policy/model/sp13/" + fileName);
  String serializedPolicyRefereneFile=loadPolicyFile("policy/model/sp13/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp13/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyRefereneFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof EncryptedParts);
    EncryptedParts encryptedParts=(EncryptedParts)alternative.get(0);
    assertFalse(encryptedParts.isNormalized());
    assertTrue(encryptedParts.isIgnorable());
    assertTrue(encryptedParts.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,encryptedParts.getType());
    assertEquals(SP12Constants.ENCRYPTED_PARTS,encryptedParts.getName());
    assertTrue(encryptedParts.isBody());
    assertNotNull(encryptedParts.getAttachments());
    assertTrue(encryptedParts.getAttachments().isContentSignatureTransform());
    assertTrue(encryptedParts.getAttachments().isAttachmentCompleteSignatureTransform());
    assertEquals(2,encryptedParts.getHeaders().size());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  EncryptedParts encryptedParts=(EncryptedParts)policyComponentIterator.next();
  assertTrue(encryptedParts.isNormalized());
  assertTrue(encryptedParts.isIgnorable());
  assertFalse(encryptedParts.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,encryptedParts.getType());
  assertEquals(SP12Constants.ENCRYPTED_PARTS,encryptedParts.getName());
  assertTrue(encryptedParts.isBody());
  assertNotNull(encryptedParts.getAttachments());
  assertTrue(encryptedParts.getAttachments().isContentSignatureTransform());
  assertTrue(encryptedParts.getAttachments().isAttachmentCompleteSignatureTransform());
  assertEquals(2,encryptedParts.getHeaders().size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.HttpsTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHttpsToken() throws Exception {
  String fileName="HttpsToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof HttpsToken);
    HttpsToken httpsToken=(HttpsToken)alternative.get(0);
    assertFalse(httpsToken.isNormalized());
    assertTrue(httpsToken.isIgnorable());
    assertTrue(httpsToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,httpsToken.getType());
    assertEquals(SP12Constants.HTTPS_TOKEN,httpsToken.getName());
    assertEquals(HttpsToken.AuthenticationType.RequireClientCertificate,httpsToken.getAuthenticationType());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  HttpsToken httpsToken=(HttpsToken)policyComponentIterator.next();
  assertTrue(httpsToken.isNormalized());
  assertTrue(httpsToken.isIgnorable());
  assertFalse(httpsToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,httpsToken.getType());
  assertEquals(SP12Constants.HTTPS_TOKEN,httpsToken.getName());
  assertEquals(HttpsToken.AuthenticationType.RequireClientCertificate,httpsToken.getAuthenticationType());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.InitiatorTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInitiatorToken() throws Exception {
  String fileName="InitiatorToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof InitiatorToken);
    InitiatorToken initiatorToken=(InitiatorToken)alternative.get(0);
    assertFalse(initiatorToken.isNormalized());
    assertTrue(initiatorToken.isIgnorable());
    assertTrue(initiatorToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,initiatorToken.getType());
    assertEquals(SP12Constants.INITIATOR_TOKEN,initiatorToken.getName());
    assertNotNull(initiatorToken.getToken());
    assertEquals(SP12Constants.X509_TOKEN,initiatorToken.getToken().getName());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  InitiatorToken initiatorToken=(InitiatorToken)policyComponentIterator.next();
  assertTrue(initiatorToken.isNormalized());
  assertTrue(initiatorToken.isIgnorable());
  assertFalse(initiatorToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,initiatorToken.getType());
  assertEquals(SP12Constants.INITIATOR_TOKEN,initiatorToken.getName());
  assertNotNull(initiatorToken.getToken());
  assertEquals(SP12Constants.X509_TOKEN,initiatorToken.getToken().getName());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.IssuedTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testIssuedToken() throws Exception {
  String fileName="IssuedToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof IssuedToken);
    IssuedToken issuedToken=(IssuedToken)alternative.get(0);
    assertFalse(issuedToken.isNormalized());
    assertTrue(issuedToken.isIgnorable());
    assertTrue(issuedToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,issuedToken.getType());
    assertEquals(SP12Constants.ISSUED_TOKEN,issuedToken.getName());
    assertNotNull(issuedToken.getRequestSecurityTokenTemplate());
    assertTrue(issuedToken.isRequireExternalReference());
    assertTrue(issuedToken.isRequireInternalReference());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  IssuedToken issuedToken=(IssuedToken)policyComponentIterator.next();
  assertTrue(issuedToken.isNormalized());
  assertTrue(issuedToken.isIgnorable());
  assertFalse(issuedToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,issuedToken.getType());
  assertEquals(SP12Constants.ISSUED_TOKEN,issuedToken.getName());
  assertNotNull(issuedToken.getRequestSecurityTokenTemplate());
  assertTrue(issuedToken.isRequireExternalReference());
  assertTrue(issuedToken.isRequireInternalReference());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.KerberosTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKerberosToken() throws Exception {
  String fileName="KerberosToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof KerberosToken);
    KerberosToken kerberosToken=(KerberosToken)alternative.get(0);
    assertFalse(kerberosToken.isNormalized());
    assertTrue(kerberosToken.isIgnorable());
    assertTrue(kerberosToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,kerberosToken.getType());
    assertEquals(SP12Constants.KERBEROS_TOKEN,kerberosToken.getName());
    assertEquals(KerberosToken.ApReqTokenType.WssKerberosV5ApReqToken11,kerberosToken.getApReqTokenType());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  KerberosToken kerberosToken=(KerberosToken)policyComponentIterator.next();
  assertTrue(kerberosToken.isNormalized());
  assertTrue(kerberosToken.isIgnorable());
  assertFalse(kerberosToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,kerberosToken.getType());
  assertEquals(SP12Constants.KERBEROS_TOKEN,kerberosToken.getName());
  assertEquals(KerberosToken.ApReqTokenType.WssKerberosV5ApReqToken11,kerberosToken.getApReqTokenType());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.KeyValueTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKeyValueToken() throws Exception {
  String fileName="KeyValueToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof KeyValueToken);
    KeyValueToken keyValueToken=(KeyValueToken)alternative.get(0);
    assertFalse(keyValueToken.isNormalized());
    assertTrue(keyValueToken.isIgnorable());
    assertTrue(keyValueToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,keyValueToken.getType());
    assertEquals(SP12Constants.KEY_VALUE_TOKEN,keyValueToken.getName());
    assertTrue(keyValueToken.isRsaKeyValue());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  KeyValueToken keyValueToken=(KeyValueToken)policyComponentIterator.next();
  assertTrue(keyValueToken.isNormalized());
  assertTrue(keyValueToken.isIgnorable());
  assertFalse(keyValueToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,keyValueToken.getType());
  assertEquals(SP12Constants.KEY_VALUE_TOKEN,keyValueToken.getName());
  assertTrue(keyValueToken.isRsaKeyValue());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.LayoutTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLayout() throws Exception {
  String fileName="Layout.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof Layout);
    Layout layout=(Layout)alternative.get(0);
    assertFalse(layout.isNormalized());
    assertTrue(layout.isIgnorable());
    assertTrue(layout.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,layout.getType());
    assertEquals(SP12Constants.LAYOUT,layout.getName());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  Layout layout=(Layout)policyComponentIterator.next();
  assertTrue(layout.isNormalized());
  assertTrue(layout.isIgnorable());
  assertFalse(layout.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,layout.getType());
  assertEquals(SP12Constants.LAYOUT,layout.getName());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.RecipientTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRecipientToken() throws Exception {
  String fileName="RecipientToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof RecipientToken);
    RecipientToken recipientToken=(RecipientToken)alternative.get(0);
    assertFalse(recipientToken.isNormalized());
    assertTrue(recipientToken.isIgnorable());
    assertTrue(recipientToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,recipientToken.getType());
    assertEquals(SP12Constants.RECIPIENT_TOKEN,recipientToken.getName());
    assertNotNull(recipientToken.getToken());
    assertEquals(SP12Constants.X509_TOKEN,recipientToken.getToken().getName());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  RecipientToken recipientToken=(RecipientToken)policyComponentIterator.next();
  assertTrue(recipientToken.isNormalized());
  assertTrue(recipientToken.isIgnorable());
  assertFalse(recipientToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,recipientToken.getType());
  assertEquals(SP12Constants.RECIPIENT_TOKEN,recipientToken.getName());
  assertNotNull(recipientToken.getToken());
  assertEquals(SP12Constants.X509_TOKEN,recipientToken.getToken().getName());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.RelTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRelToken() throws Exception {
  String fileName="RelToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof RelToken);
    RelToken relToken=(RelToken)alternative.get(0);
    assertFalse(relToken.isNormalized());
    assertTrue(relToken.isIgnorable());
    assertTrue(relToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,relToken.getType());
    assertEquals(SP12Constants.REL_TOKEN,relToken.getName());
    assertEquals(RelToken.RelTokenType.WssRelV20Token10,relToken.getRelTokenType());
    assertTrue(relToken.isRequireKeyIdentifierReference());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  RelToken relToken=(RelToken)policyComponentIterator.next();
  assertTrue(relToken.isNormalized());
  assertTrue(relToken.isIgnorable());
  assertFalse(relToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,relToken.getType());
  assertEquals(SP12Constants.REL_TOKEN,relToken.getName());
  assertEquals(RelToken.RelTokenType.WssRelV20Token10,relToken.getRelTokenType());
  assertTrue(relToken.isRequireKeyIdentifierReference());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.RequiredElementsTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRequiredElements() throws Exception {
  String fileName="RequiredElements.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof RequiredElements);
    RequiredElements requiredElements=(RequiredElements)alternative.get(0);
    assertFalse(requiredElements.isNormalized());
    assertTrue(requiredElements.isIgnorable());
    assertTrue(requiredElements.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,requiredElements.getType());
    assertEquals(SP12Constants.REQUIRED_ELEMENTS,requiredElements.getName());
    assertEquals("1.1",requiredElements.getXPathVersion());
    assertEquals(2,requiredElements.getXPaths().size());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  RequiredElements requiredElements=(RequiredElements)policyComponentIterator.next();
  assertTrue(requiredElements.isNormalized());
  assertTrue(requiredElements.isIgnorable());
  assertFalse(requiredElements.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,requiredElements.getType());
  assertEquals(SP12Constants.REQUIRED_ELEMENTS,requiredElements.getName());
  assertEquals("1.1",requiredElements.getXPathVersion());
  assertEquals(2,requiredElements.getXPaths().size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.RequiredPartsTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRequiredParts() throws Exception {
  String fileName="RequiredParts.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof RequiredParts);
    RequiredParts requiredParts=(RequiredParts)alternative.get(0);
    assertFalse(requiredParts.isNormalized());
    assertTrue(requiredParts.isIgnorable());
    assertTrue(requiredParts.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,requiredParts.getType());
    assertEquals(SP12Constants.REQUIRED_PARTS,requiredParts.getName());
    assertEquals(2,requiredParts.getHeaders().size());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  RequiredParts requiredParts=(RequiredParts)policyComponentIterator.next();
  assertTrue(requiredParts.isNormalized());
  assertTrue(requiredParts.isIgnorable());
  assertFalse(requiredParts.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,requiredParts.getType());
  assertEquals(SP12Constants.REQUIRED_PARTS,requiredParts.getName());
  assertEquals(2,requiredParts.getHeaders().size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.SamlTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSamlToken() throws Exception {
  String fileName="SamlToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof SamlToken);
    SamlToken samlToken=(SamlToken)alternative.get(0);
    assertFalse(samlToken.isNormalized());
    assertTrue(samlToken.isIgnorable());
    assertTrue(samlToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,samlToken.getType());
    assertEquals(SP12Constants.SAML_TOKEN,samlToken.getName());
    assertEquals(SamlToken.SamlTokenType.WssSamlV20Token11,samlToken.getSamlTokenType());
    assertTrue(samlToken.isRequireKeyIdentifierReference());
    assertTrue(samlToken.getClaims() != null);
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  SamlToken samlToken=(SamlToken)policyComponentIterator.next();
  assertTrue(samlToken.isNormalized());
  assertTrue(samlToken.isIgnorable());
  assertFalse(samlToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,samlToken.getType());
  assertEquals(SP12Constants.SAML_TOKEN,samlToken.getName());
  assertEquals(SamlToken.SamlTokenType.WssSamlV20Token11,samlToken.getSamlTokenType());
  assertTrue(samlToken.isRequireKeyIdentifierReference());
  assertTrue(samlToken.getClaims() != null);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.SecureConversationTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSecureConversationToken() throws Exception {
  String fileName="SecureConversationToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof SecureConversationToken);
    SecureConversationToken secureConversationToken=(SecureConversationToken)alternative.get(0);
    assertFalse(secureConversationToken.isNormalized());
    assertTrue(secureConversationToken.isIgnorable());
    assertTrue(secureConversationToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,secureConversationToken.getType());
    assertEquals(SP12Constants.SECURE_CONVERSATION_TOKEN,secureConversationToken.getName());
    assertTrue(secureConversationToken.isMustNotSendAmend());
    assertTrue(secureConversationToken.isMustNotSendRenew());
    assertTrue(secureConversationToken.isMustNotSendCancel());
    assertNotNull(secureConversationToken.getBootstrapPolicy());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  SecureConversationToken secureConversationToken=(SecureConversationToken)policyComponentIterator.next();
  assertTrue(secureConversationToken.isNormalized());
  assertTrue(secureConversationToken.isIgnorable());
  assertFalse(secureConversationToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,secureConversationToken.getType());
  assertEquals(SP12Constants.SECURE_CONVERSATION_TOKEN,secureConversationToken.getName());
  assertTrue(secureConversationToken.isMustNotSendAmend());
  assertTrue(secureConversationToken.isMustNotSendRenew());
  assertTrue(secureConversationToken.isMustNotSendCancel());
  assertNotNull(secureConversationToken.getBootstrapPolicy());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.SecurityContextTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSecurityContextToken() throws Exception {
  String fileName="SecurityContextToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof SecurityContextToken);
    SecurityContextToken securityContextToken=(SecurityContextToken)alternative.get(0);
    assertFalse(securityContextToken.isNormalized());
    assertTrue(securityContextToken.isIgnorable());
    assertTrue(securityContextToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,securityContextToken.getType());
    assertEquals(SP12Constants.SECURITY_CONTEXT_TOKEN,securityContextToken.getName());
    assertTrue(securityContextToken.isRequireExternalUriReference());
    assertTrue(securityContextToken.isSc13SecurityContextToken());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  SecurityContextToken securityContextToken=(SecurityContextToken)policyComponentIterator.next();
  assertTrue(securityContextToken.isNormalized());
  assertTrue(securityContextToken.isIgnorable());
  assertFalse(securityContextToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,securityContextToken.getType());
  assertEquals(SP12Constants.SECURITY_CONTEXT_TOKEN,securityContextToken.getName());
  assertTrue(securityContextToken.isRequireExternalUriReference());
  assertTrue(securityContextToken.isSc13SecurityContextToken());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.SignedElementsTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignedElements12() throws Exception {
  String fileName="SignedElements.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof SignedElements);
    SignedElements signedElements=(SignedElements)alternative.get(0);
    assertFalse(signedElements.isNormalized());
    assertTrue(signedElements.isIgnorable());
    assertTrue(signedElements.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,signedElements.getType());
    assertEquals(SP12Constants.SIGNED_ELEMENTS,signedElements.getName());
    assertEquals("1.1",signedElements.getXPathVersion());
    assertEquals(2,signedElements.getXPaths().size());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  SignedElements signedElements=(SignedElements)policyComponentIterator.next();
  assertTrue(signedElements.isNormalized());
  assertTrue(signedElements.isIgnorable());
  assertFalse(signedElements.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,signedElements.getType());
  assertEquals(SP12Constants.SIGNED_ELEMENTS,signedElements.getName());
  assertEquals("1.1",signedElements.getXPathVersion());
  assertEquals(2,signedElements.getXPaths().size());
}

</code></pre>

<br>
<pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignedElements13() throws Exception {
  String fileName="SignedElements.xml";
  String policyFile=loadPolicyFile("policy/model/sp13/" + fileName);
  String serializedPolicyRefereneFile=loadPolicyFile("policy/model/sp13/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp13/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyRefereneFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof SignedElements);
    SignedElements signedElements=(SignedElements)alternative.get(0);
    assertFalse(signedElements.isNormalized());
    assertTrue(signedElements.isIgnorable());
    assertTrue(signedElements.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,signedElements.getType());
    assertEquals(SP12Constants.SIGNED_ELEMENTS,signedElements.getName());
    assertEquals("1.1",signedElements.getXPathVersion());
    assertEquals(3,signedElements.getXPaths().size());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  SignedElements signedElements=(SignedElements)policyComponentIterator.next();
  assertTrue(signedElements.isNormalized());
  assertTrue(signedElements.isIgnorable());
  assertFalse(signedElements.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,signedElements.getType());
  assertEquals(SP12Constants.SIGNED_ELEMENTS,signedElements.getName());
  assertEquals("1.1",signedElements.getXPathVersion());
  assertEquals(3,signedElements.getXPaths().size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.SignedPartsTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignedParts13() throws Exception {
  String fileName="SignedParts.xml";
  String policyFile=loadPolicyFile("policy/model/sp13/" + fileName);
  String serializedPolicyRefereneFile=loadPolicyFile("policy/model/sp13/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp13/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyRefereneFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof SignedParts);
    SignedParts signedParts=(SignedParts)alternative.get(0);
    assertFalse(signedParts.isNormalized());
    assertTrue(signedParts.isIgnorable());
    assertTrue(signedParts.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,signedParts.getType());
    assertEquals(SP12Constants.SIGNED_PARTS,signedParts.getName());
    assertTrue(signedParts.isBody());
    assertNotNull(signedParts.getAttachments());
    assertEquals(2,signedParts.getHeaders().size());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  SignedParts signedParts=(SignedParts)policyComponentIterator.next();
  assertTrue(signedParts.isNormalized());
  assertTrue(signedParts.isIgnorable());
  assertFalse(signedParts.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,signedParts.getType());
  assertEquals(SP12Constants.SIGNED_PARTS,signedParts.getName());
  assertTrue(signedParts.isBody());
  assertNotNull(signedParts.getAttachments());
  assertEquals(2,signedParts.getHeaders().size());
}

</code></pre>

<br>
<pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignedParts12() throws Exception {
  String fileName="SignedParts.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof SignedParts);
    SignedParts signedParts=(SignedParts)alternative.get(0);
    assertFalse(signedParts.isNormalized());
    assertTrue(signedParts.isIgnorable());
    assertTrue(signedParts.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,signedParts.getType());
    assertEquals(SP12Constants.SIGNED_PARTS,signedParts.getName());
    assertTrue(signedParts.isBody());
    assertNotNull(signedParts.getAttachments());
    assertEquals(2,signedParts.getHeaders().size());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  SignedParts signedParts=(SignedParts)policyComponentIterator.next();
  assertTrue(signedParts.isNormalized());
  assertTrue(signedParts.isIgnorable());
  assertFalse(signedParts.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,signedParts.getType());
  assertEquals(SP12Constants.SIGNED_PARTS,signedParts.getName());
  assertTrue(signedParts.isBody());
  assertNotNull(signedParts.getAttachments());
  assertEquals(2,signedParts.getHeaders().size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.SpnegoContextTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSpnegoContextToken() throws Exception {
  String fileName="SpnegoContextToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof SpnegoContextToken);
    SpnegoContextToken spnegoContextToken=(SpnegoContextToken)alternative.get(0);
    assertFalse(spnegoContextToken.isNormalized());
    assertTrue(spnegoContextToken.isIgnorable());
    assertTrue(spnegoContextToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,spnegoContextToken.getType());
    assertEquals(SP12Constants.SPNEGO_CONTEXT_TOKEN,spnegoContextToken.getName());
    assertTrue(spnegoContextToken.isMustNotSendAmend());
    assertTrue(spnegoContextToken.isMustNotSendCancel());
    assertTrue(spnegoContextToken.isMustNotSendRenew());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  SpnegoContextToken spnegoContextToken=(SpnegoContextToken)policyComponentIterator.next();
  assertTrue(spnegoContextToken.isNormalized());
  assertTrue(spnegoContextToken.isIgnorable());
  assertFalse(spnegoContextToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,spnegoContextToken.getType());
  assertEquals(SP12Constants.SPNEGO_CONTEXT_TOKEN,spnegoContextToken.getName());
  assertTrue(spnegoContextToken.isMustNotSendAmend());
  assertTrue(spnegoContextToken.isMustNotSendCancel());
  assertTrue(spnegoContextToken.isMustNotSendRenew());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.SupportingTokensTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSupportingTokens() throws Exception {
  String fileName="SupportingTokens.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof SupportingTokens);
    SupportingTokens supportingTokens=(SupportingTokens)alternative.get(0);
    assertFalse(supportingTokens.isNormalized());
    assertTrue(supportingTokens.isIgnorable());
    assertTrue(supportingTokens.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,supportingTokens.getType());
    assertEquals(SP12Constants.SUPPORTING_TOKENS,supportingTokens.getName());
    assertEquals(1,supportingTokens.getTokens().size());
    assertNotNull(supportingTokens.getSignedParts());
    assertNotNull(supportingTokens.getSignedElements());
    assertNotNull(supportingTokens.getEncryptedParts());
    assertNotNull(supportingTokens.getEncryptedElements());
    assertNotNull(supportingTokens.getAlgorithmSuite());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  SupportingTokens supportingTokens=(SupportingTokens)policyComponentIterator.next();
  assertTrue(supportingTokens.isNormalized());
  assertTrue(supportingTokens.isIgnorable());
  assertFalse(supportingTokens.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,supportingTokens.getType());
  assertEquals(SP12Constants.SUPPORTING_TOKENS,supportingTokens.getName());
  assertEquals(1,supportingTokens.getTokens().size());
  assertNotNull(supportingTokens.getSignedParts());
  assertNotNull(supportingTokens.getSignedElements());
  assertNotNull(supportingTokens.getEncryptedParts());
  assertNotNull(supportingTokens.getEncryptedElements());
  assertNotNull(supportingTokens.getAlgorithmSuite());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.SymmetricBindingTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSymmetricBinding() throws Exception {
  String fileName="SymmetricBinding.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof SymmetricBinding);
    SymmetricBinding symmetricBinding=(SymmetricBinding)alternative.get(0);
    assertFalse(symmetricBinding.isNormalized());
    assertTrue(symmetricBinding.isIgnorable());
    assertTrue(symmetricBinding.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,symmetricBinding.getType());
    assertEquals(SP12Constants.SYMMETRIC_BINDING,symmetricBinding.getName());
    assertNotNull(symmetricBinding.getEncryptionToken());
    assertNotNull(symmetricBinding.getSignatureToken());
    assertNotNull(symmetricBinding.getAlgorithmSuite());
    assertNotNull(symmetricBinding.getLayout());
    assertEquals(AbstractSymmetricAsymmetricBinding.ProtectionOrder.EncryptBeforeSigning,symmetricBinding.getProtectionOrder());
    assertTrue(symmetricBinding.isEncryptSignature());
    assertTrue(symmetricBinding.isIncludeTimestamp());
    assertTrue(symmetricBinding.isOnlySignEntireHeadersAndBody());
    assertTrue(symmetricBinding.isProtectTokens());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  SymmetricBinding symmetricBinding=(SymmetricBinding)policyComponentIterator.next();
  assertTrue(symmetricBinding.isNormalized());
  assertTrue(symmetricBinding.isIgnorable());
  assertFalse(symmetricBinding.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,symmetricBinding.getType());
  assertEquals(SP12Constants.SYMMETRIC_BINDING,symmetricBinding.getName());
  assertNotNull(symmetricBinding.getEncryptionToken());
  assertNotNull(symmetricBinding.getSignatureToken());
  assertNotNull(symmetricBinding.getAlgorithmSuite());
  assertNotNull(symmetricBinding.getLayout());
  assertEquals(AbstractSymmetricAsymmetricBinding.ProtectionOrder.EncryptBeforeSigning,symmetricBinding.getProtectionOrder());
  assertTrue(symmetricBinding.isEncryptSignature());
  assertTrue(symmetricBinding.isIncludeTimestamp());
  assertTrue(symmetricBinding.isOnlySignEntireHeadersAndBody());
  assertTrue(symmetricBinding.isProtectTokens());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.TransportBindingTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTransportBinding() throws Exception {
  String fileName="TransportBinding.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof TransportBinding);
    TransportBinding transportBinding=(TransportBinding)alternative.get(0);
    assertFalse(transportBinding.isNormalized());
    assertTrue(transportBinding.isIgnorable());
    assertTrue(transportBinding.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,transportBinding.getType());
    assertEquals(SP12Constants.TRANSPORT_BINDING,transportBinding.getName());
    assertNotNull(transportBinding.getTransportToken());
    assertNotNull(transportBinding.getAlgorithmSuite());
    assertNotNull(transportBinding.getLayout());
    assertTrue(transportBinding.isIncludeTimestamp());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  TransportBinding transportBinding=(TransportBinding)policyComponentIterator.next();
  assertTrue(transportBinding.isNormalized());
  assertTrue(transportBinding.isIgnorable());
  assertFalse(transportBinding.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,transportBinding.getType());
  assertEquals(SP12Constants.TRANSPORT_BINDING,transportBinding.getName());
  assertNotNull(transportBinding.getTransportToken());
  assertNotNull(transportBinding.getAlgorithmSuite());
  assertNotNull(transportBinding.getLayout());
  assertTrue(transportBinding.isIncludeTimestamp());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.Trust10Test </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTrust10_11() throws Exception {
  String fileName="Trust10.xml";
  String policyFile=loadPolicyFile("policy/model/sp11/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp11/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp11/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof Trust10);
    Trust10 trust10=(Trust10)alternative.get(0);
    assertFalse(trust10.isNormalized());
    assertTrue(trust10.isIgnorable());
    assertTrue(trust10.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,trust10.getType());
    assertEquals(SP11Constants.TRUST_10,trust10.getName());
    assertTrue(trust10.isMustSupportClientChallenge());
    assertTrue(trust10.isMustSupportServerChallenge());
    assertTrue(trust10.isRequireClientEntropy());
    assertTrue(trust10.isRequireServerEntropy());
    assertTrue(trust10.isMustSupportIssuedTokens());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  Trust10 trust13=(Trust10)policyComponentIterator.next();
  assertTrue(trust13.isNormalized());
  assertTrue(trust13.isIgnorable());
  assertFalse(trust13.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,trust13.getType());
  assertEquals(SP11Constants.TRUST_10,trust13.getName());
  assertTrue(trust13.isMustSupportClientChallenge());
  assertTrue(trust13.isMustSupportServerChallenge());
  assertTrue(trust13.isRequireClientEntropy());
  assertTrue(trust13.isRequireServerEntropy());
  assertTrue(trust13.isMustSupportIssuedTokens());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.Trust13Test </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTrust13_12() throws Exception {
  String fileName="Trust13.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof Trust13);
    Trust13 trust13=(Trust13)alternative.get(0);
    assertFalse(trust13.isNormalized());
    assertTrue(trust13.isIgnorable());
    assertTrue(trust13.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,trust13.getType());
    assertEquals(SP12Constants.TRUST_13,trust13.getName());
    assertTrue(trust13.isMustSupportClientChallenge());
    assertTrue(trust13.isMustSupportServerChallenge());
    assertTrue(trust13.isRequireClientEntropy());
    assertTrue(trust13.isRequireServerEntropy());
    assertTrue(trust13.isMustSupportIssuedTokens());
    assertTrue(trust13.isRequireRequestSecurityTokenCollection());
    assertTrue(trust13.isRequireAppliesTo());
    assertFalse(trust13.isScopePolicy15());
    assertFalse(trust13.isMustSupportInteractiveChallenge());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  Trust13 trust13=(Trust13)policyComponentIterator.next();
  assertTrue(trust13.isNormalized());
  assertTrue(trust13.isIgnorable());
  assertFalse(trust13.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,trust13.getType());
  assertEquals(SP12Constants.TRUST_13,trust13.getName());
  assertTrue(trust13.isMustSupportClientChallenge());
  assertTrue(trust13.isMustSupportServerChallenge());
  assertTrue(trust13.isRequireClientEntropy());
  assertTrue(trust13.isRequireServerEntropy());
  assertTrue(trust13.isMustSupportIssuedTokens());
  assertTrue(trust13.isRequireRequestSecurityTokenCollection());
  assertTrue(trust13.isRequireAppliesTo());
  assertFalse(trust13.isScopePolicy15());
  assertFalse(trust13.isMustSupportInteractiveChallenge());
}

</code></pre>

<br>
<pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTrust13_13() throws Exception {
  String fileName="Trust13.xml";
  String policyFile=loadPolicyFile("policy/model/sp13/" + fileName);
  String serializedPolicyRefereneFile=loadPolicyFile("policy/model/sp13/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp13/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyRefereneFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof Trust13);
    Trust13 trust13=(Trust13)alternative.get(0);
    assertFalse(trust13.isNormalized());
    assertTrue(trust13.isIgnorable());
    assertTrue(trust13.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,trust13.getType());
    assertEquals(SP13Constants.TRUST_13,trust13.getName());
    assertTrue(trust13.isMustSupportClientChallenge());
    assertTrue(trust13.isMustSupportServerChallenge());
    assertTrue(trust13.isRequireClientEntropy());
    assertTrue(trust13.isRequireServerEntropy());
    assertTrue(trust13.isMustSupportIssuedTokens());
    assertTrue(trust13.isRequireRequestSecurityTokenCollection());
    assertTrue(trust13.isRequireAppliesTo());
    assertTrue(trust13.isScopePolicy15());
    assertTrue(trust13.isMustSupportInteractiveChallenge());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  Trust13 trust13=(Trust13)policyComponentIterator.next();
  assertTrue(trust13.isNormalized());
  assertTrue(trust13.isIgnorable());
  assertFalse(trust13.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,trust13.getType());
  assertEquals(SP13Constants.TRUST_13,trust13.getName());
  assertTrue(trust13.isMustSupportClientChallenge());
  assertTrue(trust13.isMustSupportServerChallenge());
  assertTrue(trust13.isRequireClientEntropy());
  assertTrue(trust13.isRequireServerEntropy());
  assertTrue(trust13.isMustSupportIssuedTokens());
  assertTrue(trust13.isRequireRequestSecurityTokenCollection());
  assertTrue(trust13.isRequireAppliesTo());
  assertTrue(trust13.isScopePolicy15());
  assertTrue(trust13.isMustSupportInteractiveChallenge());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.UsernameTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUsernameToken12() throws Exception {
  String fileName="UsernameToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof UsernameToken);
    UsernameToken usernameToken=(UsernameToken)alternative.get(0);
    assertFalse(usernameToken.isNormalized());
    assertTrue(usernameToken.isIgnorable());
    assertTrue(usernameToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,usernameToken.getType());
    assertEquals(SP12Constants.USERNAME_TOKEN,usernameToken.getName());
    assertEquals(UsernameToken.PasswordType.HashPassword,usernameToken.getPasswordType());
    assertEquals(UsernameToken.UsernameTokenType.WssUsernameToken10,usernameToken.getUsernameTokenType());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  UsernameToken usernameToken=(UsernameToken)policyComponentIterator.next();
  assertTrue(usernameToken.isNormalized());
  assertTrue(usernameToken.isIgnorable());
  assertFalse(usernameToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,usernameToken.getType());
  assertEquals(SP12Constants.USERNAME_TOKEN,usernameToken.getName());
  assertEquals(UsernameToken.PasswordType.HashPassword,usernameToken.getPasswordType());
  assertEquals(UsernameToken.UsernameTokenType.WssUsernameToken10,usernameToken.getUsernameTokenType());
}

</code></pre>

<br>
<pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUsernameToken13() throws Exception {
  String fileName="UsernameToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp13/" + fileName);
  String serializedPolicyRefereneFile=loadPolicyFile("policy/model/sp13/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp13/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyRefereneFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof UsernameToken);
    UsernameToken usernameToken=(UsernameToken)alternative.get(0);
    assertFalse(usernameToken.isNormalized());
    assertTrue(usernameToken.isIgnorable());
    assertTrue(usernameToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,usernameToken.getType());
    assertEquals(SP12Constants.USERNAME_TOKEN,usernameToken.getName());
    assertTrue(usernameToken.isCreated());
    assertTrue(usernameToken.isNonce());
    assertNull(usernameToken.getPasswordType());
    assertEquals(UsernameToken.UsernameTokenType.WssUsernameToken10,usernameToken.getUsernameTokenType());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  UsernameToken usernameToken=(UsernameToken)policyComponentIterator.next();
  assertTrue(usernameToken.isNormalized());
  assertTrue(usernameToken.isIgnorable());
  assertFalse(usernameToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,usernameToken.getType());
  assertEquals(SP12Constants.USERNAME_TOKEN,usernameToken.getName());
  assertTrue(usernameToken.isCreated());
  assertTrue(usernameToken.isNonce());
  assertNull(usernameToken.getPasswordType());
  assertEquals(UsernameToken.UsernameTokenType.WssUsernameToken10,usernameToken.getUsernameTokenType());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.Wss10Test </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWss10() throws Exception {
  String fileName="Wss10.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof Wss10);
    Wss10 wss10=(Wss10)alternative.get(0);
    assertFalse(wss10.isNormalized());
    assertTrue(wss10.isIgnorable());
    assertTrue(wss10.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,wss10.getType());
    assertEquals(SP12Constants.WSS10,wss10.getName());
    assertTrue(wss10.isMustSupportRefEmbeddedToken());
    assertTrue(wss10.isMustSupportRefExternalURI());
    assertTrue(wss10.isMustSupportRefIssuerSerial());
    assertTrue(wss10.isMustSupportRefKeyIdentifier());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  Wss10 wss10=(Wss10)policyComponentIterator.next();
  assertTrue(wss10.isNormalized());
  assertTrue(wss10.isIgnorable());
  assertFalse(wss10.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,wss10.getType());
  assertEquals(SP12Constants.WSS10,wss10.getName());
  assertTrue(wss10.isMustSupportRefEmbeddedToken());
  assertTrue(wss10.isMustSupportRefExternalURI());
  assertTrue(wss10.isMustSupportRefIssuerSerial());
  assertTrue(wss10.isMustSupportRefKeyIdentifier());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.Wss11Test </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWss11() throws Exception {
  String fileName="Wss11.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof Wss11);
    Wss11 wss11=(Wss11)alternative.get(0);
    assertFalse(wss11.isNormalized());
    assertTrue(wss11.isIgnorable());
    assertTrue(wss11.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,wss11.getType());
    assertEquals(SP12Constants.WSS11,wss11.getName());
    assertTrue(wss11.isMustSupportRefEmbeddedToken());
    assertTrue(wss11.isMustSupportRefExternalURI());
    assertTrue(wss11.isMustSupportRefIssuerSerial());
    assertTrue(wss11.isMustSupportRefKeyIdentifier());
    assertTrue(wss11.isMustSupportRefEncryptedKey());
    assertTrue(wss11.isMustSupportRefThumbprint());
    assertTrue(wss11.isRequireSignatureConfirmation());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  Wss11 wss11=(Wss11)policyComponentIterator.next();
  assertTrue(wss11.isNormalized());
  assertTrue(wss11.isIgnorable());
  assertFalse(wss11.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,wss11.getType());
  assertEquals(SP12Constants.WSS11,wss11.getName());
  assertTrue(wss11.isMustSupportRefEmbeddedToken());
  assertTrue(wss11.isMustSupportRefExternalURI());
  assertTrue(wss11.isMustSupportRefIssuerSerial());
  assertTrue(wss11.isMustSupportRefKeyIdentifier());
  assertTrue(wss11.isMustSupportRefEncryptedKey());
  assertTrue(wss11.isMustSupportRefThumbprint());
  assertTrue(wss11.isRequireSignatureConfirmation());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.X509TokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testX509Token() throws Exception {
  String fileName="X509Token.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof X509Token);
    X509Token x509Token=(X509Token)alternative.get(0);
    assertFalse(x509Token.isNormalized());
    assertTrue(x509Token.isIgnorable());
    assertTrue(x509Token.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,x509Token.getType());
    assertEquals(SP12Constants.X509_TOKEN,x509Token.getName());
    assertTrue(x509Token.isRequireEmbeddedTokenReference());
    assertTrue(x509Token.isRequireIssuerSerialReference());
    assertTrue(x509Token.isRequireKeyIdentifierReference());
    assertTrue(x509Token.isRequireThumbprintReference());
    assertEquals(X509Token.TokenType.WssX509V1Token11,x509Token.getTokenType());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  X509Token x509Token=(X509Token)policyComponentIterator.next();
  assertTrue(x509Token.isNormalized());
  assertTrue(x509Token.isIgnorable());
  assertFalse(x509Token.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,x509Token.getType());
  assertEquals(SP12Constants.X509_TOKEN,x509Token.getName());
  assertTrue(x509Token.isRequireEmbeddedTokenReference());
  assertTrue(x509Token.isRequireIssuerSerialReference());
  assertTrue(x509Token.isRequireKeyIdentifierReference());
  assertTrue(x509Token.isRequireThumbprintReference());
  assertEquals(X509Token.TokenType.WssX509V1Token11,x509Token.getTokenType());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.AttachmentTest </h4><pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentContentEncryptionExternalReferenceList() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("receiver","default");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(new WSEncryptionPart("cid:Attachments","Content"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  encrypt.setAttachmentCallbackHandler(attachmentCallbackHandler);
  encrypt.prepare(doc,CryptoFactory.getInstance("transmitter-crypto.properties"));
  Element refs=encrypt.encrypt();
  encrypt.addAttachmentEncryptedDataElements(secHeader);
  encrypt.addExternalRefElement(refs,secHeader);
  encrypt.prependToHeader(secHeader);
  NodeList references=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"DataReference");
  Assert.assertEquals(2,references.getLength());
  NodeList cipherReferences=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"CipherReference");
  Assert.assertEquals(1,cipherReferences.getLength());
  NodeList encDatas=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"EncryptedData");
  Assert.assertEquals(2,encDatas.getLength());
  NodeList securityHeaderElement=doc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
  Assert.assertEquals(1,securityHeaderElement.getLength());
  NodeList childs=securityHeaderElement.item(0).getChildNodes();
  Assert.assertEquals(3,childs.getLength());
  Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
  Assert.assertEquals(childs.item(1).getLocalName(),"ReferenceList");
  Assert.assertEquals(childs.item(2).getLocalName(),"EncryptedData");
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(doc),new StreamResult(baos));
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> attHeaders=responseAttachment.getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentCmplEncCmplSign() throws Exception {
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment[] attachment=new Attachment[1];
  attachment[0]=new Attachment();
  attachment[0].setMimeType("text/xml");
  attachment[0].addHeaders(getHeaders(attachmentId));
  attachment[0].setId(attachmentId);
  attachment[0].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Content));
    securityProperties.addEncryptionPart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setAttachmentCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          List<Attachment> attachments=new ArrayList<Attachment>();
          attachments.add(attachment[0]);
          attachmentRequestCallback.setAttachments(attachments);
        }
 else {
          AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
          attachment[0]=attachmentResultCallback.getAttachment();
        }
      }
    }
);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document securedDoc=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList securityHeaderElement=securedDoc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(3,childs.getLength());
    Assert.assertEquals(childs.item(0).getLocalName(),"Signature");
    Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedKey");
    Assert.assertEquals(childs.item(2).getLocalName(),"EncryptedData");
    Assert.assertEquals(1,attachment[0].getHeaders().size());
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAttachmentCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          if (!attachment[0].getId().equals(attachmentRequestCallback.getAttachmentId())) {
            throw new RuntimeException("wrong attachment requested");
          }
          List<Attachment> attachments=new ArrayList<Attachment>();
          attachments.add(attachment[0]);
          attachmentRequestCallback.setAttachments(attachments);
        }
 else {
          AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
          attachment[0]=attachmentResultCallback.getAttachment();
        }
      }
    }
);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
  byte[] attachmentBytes=readInputStream(attachment[0].getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",attachment[0].getMimeType());
  Map<String,String> attHeaders=attachment[0].getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentCompleteSignature() throws Exception {
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
  }
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList sigReferences=document.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
    Assert.assertEquals(2,sigReferences.getLength());
  }
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidXMLAttachmentCompleteEncryption() throws Exception {
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Content));
    securityProperties.addEncryptionPart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document securedDoc=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList references=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"DataReference");
    Assert.assertEquals(2,references.getLength());
    NodeList cipherReferences=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"CipherReference");
    Assert.assertEquals(1,cipherReferences.getLength());
    NodeList encDatas=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"EncryptedData");
    Assert.assertEquals(2,encDatas.getLength());
    NodeList securityHeaderElement=securedDoc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(2,childs.getLength());
    Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
    Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedData");
    Assert.assertEquals(1,encryptedAttachments.get(0).getHeaders().size());
  }
  final PushbackInputStream pis=new PushbackInputStream(encryptedAttachments.get(0).getSourceStream(),1);
  pis.unread('K');
  encryptedAttachments.get(0).setSourceStream(pis);
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
      return;
    }
    Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
    Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
    byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
    Assert.assertFalse(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
    Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidXMLAttachmentContentSignature() throws Exception {
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart("cid:Attachments",SecurePart.Modifier.Content));
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setAttachmentCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          if (!attachment.getId().equals(attachmentRequestCallback.getAttachmentId())) {
            throw new RuntimeException("wrong attachment requested");
          }
          List<Attachment> attachments=new ArrayList<Attachment>();
          attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.replace("15","16").getBytes(StandardCharsets.UTF_8)));
          attachments.add(attachment);
          attachmentRequestCallback.setAttachments(attachments);
        }
      }
    }
);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Exception expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof XMLSecurityException);
      Assert.assertTrue(e.getCause().getMessage().startsWith("Invalid digest of reference cid:"));
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultipleAttachmentCompleteSignature() throws Exception {
  final String attachment1Id=UUID.randomUUID().toString();
  final Attachment[] attachment=new Attachment[2];
  attachment[0]=new Attachment();
  attachment[0].setMimeType("text/xml");
  attachment[0].addHeaders(getHeaders(attachment1Id));
  attachment[0].setId(attachment1Id);
  attachment[0].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  final String attachment2Id=UUID.randomUUID().toString();
  attachment[1]=new Attachment();
  attachment[1].setMimeType("text/plain");
  attachment[1].addHeaders(getHeaders(attachment2Id));
  attachment[1].setId(attachment2Id);
  attachment[1].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Arrays.asList(attachment));
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
  }
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Arrays.asList(attachment));
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList sigReferences=document.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
    Assert.assertEquals(3,sigReferences.getLength());
  }
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentContentEncryptionGCM() throws Exception {
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Content));
    securityProperties.addEncryptionPart(new SecurePart("cid:Attachments",SecurePart.Modifier.Content));
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    securityProperties.setEncryptionSymAlgorithm(WSSConstants.NS_XENC11_AES128_GCM);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document securedDoc=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList references=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"DataReference");
    Assert.assertEquals(2,references.getLength());
    NodeList cipherReferences=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"CipherReference");
    Assert.assertEquals(1,cipherReferences.getLength());
    NodeList encDatas=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"EncryptedData");
    Assert.assertEquals(2,encDatas.getLength());
    NodeList securityHeaderElement=securedDoc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(2,childs.getLength());
    Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
    Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedData");
  }
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> attHeaders=responseAttachment.getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidXMLAttachmentCmplSignCmplEnc() throws Exception {
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment[] attachment=new Attachment[1];
  attachment[0]=new Attachment();
  attachment[0].setMimeType("text/xml");
  attachment[0].addHeaders(getHeaders(attachmentId));
  attachment[0].setId(attachmentId);
  attachment[0].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Content));
    securityProperties.addEncryptionPart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setAttachmentCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          List<Attachment> attachments=new ArrayList<Attachment>();
          attachments.add(attachment[0]);
          attachmentRequestCallback.setAttachments(attachments);
        }
 else {
          AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
          attachment[0]=attachmentResultCallback.getAttachment();
        }
      }
    }
);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAttachmentCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          if (!attachment[0].getId().equals(attachmentRequestCallback.getAttachmentId())) {
            throw new RuntimeException("wrong attachment requested");
          }
          List<Attachment> attachments=new ArrayList<Attachment>();
          attachments.add(attachment[0]);
          if (attachment[0].getHeaders().size() == 6) {
            attachment[0].addHeader(AttachmentUtils.MIME_HEADER_CONTENT_DESCRIPTION,"Kaputt");
          }
          attachmentRequestCallback.setAttachments(attachments);
        }
 else {
          AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
          attachment[0]=attachmentResultCallback.getAttachment();
        }
      }
    }
);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Exception expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof XMLSecurityException);
      Assert.assertTrue(e.getCause().getMessage().startsWith("Invalid digest of reference cid:"));
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentContentSignature() throws Exception {
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart("cid:Attachments",SecurePart.Modifier.Content));
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
  }
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList sigReferences=document.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
    Assert.assertEquals(2,sigReferences.getLength());
  }
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
}

</code></pre>

<br>
<pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidXMLAttachmentCompleteSignature() throws Exception {
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
  }
{
    attachment.addHeader(AttachmentUtils.MIME_HEADER_CONTENT_DESCRIPTION,"Kaputt");
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setAttachmentCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          if (!attachment.getId().equals(attachmentRequestCallback.getAttachmentId())) {
            throw new RuntimeException("wrong attachment requested");
          }
          List<Attachment> attachments=new ArrayList<Attachment>();
          attachments.add(attachment);
          attachmentRequestCallback.setAttachments(attachments);
        }
      }
    }
);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Exception expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof XMLSecurityException);
      Assert.assertTrue(e.getCause().getMessage().startsWith("Invalid digest of reference cid:"));
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultipleAttachmentCompleteEncryption() throws Exception {
  final String attachment1Id=UUID.randomUUID().toString();
  final Attachment[] attachment=new Attachment[2];
  attachment[0]=new Attachment();
  attachment[0].setMimeType("text/xml");
  attachment[0].addHeaders(getHeaders(attachment1Id));
  attachment[0].setId(attachment1Id);
  attachment[0].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  final String attachment2Id=UUID.randomUUID().toString();
  attachment[1]=new Attachment();
  attachment[1].setMimeType("text/plain");
  attachment[1].addHeaders(getHeaders(attachment2Id));
  attachment[1].setId(attachment2Id);
  attachment[1].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Arrays.asList(attachment));
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Content));
    securityProperties.addEncryptionPart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
  }
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachment1Bytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachment1Bytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> att1Headers=responseAttachment.getHeaders();
  Assert.assertEquals(6,att1Headers.size());
  responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(1);
  byte[] attachment2Bytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachment2Bytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/plain",responseAttachment.getMimeType());
  Map<String,String> att2Headers=responseAttachment.getHeaders();
  Assert.assertEquals(6,att2Headers.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidXMLAttachmentContentEncryption() throws Exception {
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Content));
    securityProperties.addEncryptionPart(new SecurePart("cid:Attachments",SecurePart.Modifier.Content));
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document securedDoc=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList references=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"DataReference");
    Assert.assertEquals(2,references.getLength());
    NodeList cipherReferences=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"CipherReference");
    Assert.assertEquals(1,cipherReferences.getLength());
    NodeList encDatas=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"EncryptedData");
    Assert.assertEquals(2,encDatas.getLength());
    NodeList securityHeaderElement=securedDoc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(2,childs.getLength());
    Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
    Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedData");
  }
  final PushbackInputStream pis=new PushbackInputStream(encryptedAttachments.get(0).getSourceStream(),1);
  pis.unread('K');
  encryptedAttachments.get(0).setSourceStream(pis);
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  try {
    byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
    Assert.assertFalse(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
    Assert.assertEquals("text/xml",responseAttachment.getMimeType());
    Map<String,String> attHeaders=responseAttachment.getHeaders();
    Assert.assertEquals(6,attHeaders.size());
  }
 catch (  IOException ex) {
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentCmplSignCmplEnc() throws Exception {
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment[] attachment=new Attachment[1];
  attachment[0]=new Attachment();
  attachment[0].setMimeType("text/xml");
  attachment[0].addHeaders(getHeaders(attachmentId));
  attachment[0].setId(attachmentId);
  attachment[0].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Content));
    securityProperties.addEncryptionPart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setAttachmentCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          List<Attachment> attachments=new ArrayList<Attachment>();
          attachments.add(attachment[0]);
          attachmentRequestCallback.setAttachments(attachments);
        }
 else {
          AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
          attachment[0]=attachmentResultCallback.getAttachment();
        }
      }
    }
);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document securedDoc=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList securityHeaderElement=securedDoc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(3,childs.getLength());
    Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
    Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedData");
    Assert.assertEquals(childs.item(2).getLocalName(),"Signature");
    Assert.assertEquals(1,attachment[0].getHeaders().size());
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAttachmentCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          if (!attachment[0].getId().equals(attachmentRequestCallback.getAttachmentId())) {
            throw new RuntimeException("wrong attachment requested");
          }
          List<Attachment> attachments=new ArrayList<Attachment>();
          attachments.add(attachment[0]);
          attachmentRequestCallback.setAttachments(attachments);
        }
 else {
          AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
          attachment[0]=attachmentResultCallback.getAttachment();
        }
      }
    }
);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
  byte[] attachmentBytes=readInputStream(attachment[0].getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",attachment[0].getMimeType());
  Map<String,String> attHeaders=attachment[0].getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentCompleteEncryption() throws Exception {
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Content));
    securityProperties.addEncryptionPart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document securedDoc=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList references=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"DataReference");
    Assert.assertEquals(2,references.getLength());
    NodeList cipherReferences=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"CipherReference");
    Assert.assertEquals(1,cipherReferences.getLength());
    NodeList encDatas=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"EncryptedData");
    Assert.assertEquals(2,encDatas.getLength());
    NodeList securityHeaderElement=securedDoc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(2,childs.getLength());
    Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
    Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedData");
    Assert.assertEquals(1,encryptedAttachments.get(0).getHeaders().size());
  }
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> attHeaders=responseAttachment.getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentContentEncryption() throws Exception {
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Content));
    securityProperties.addEncryptionPart(new SecurePart("cid:Attachments",SecurePart.Modifier.Content));
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document securedDoc=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList references=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"DataReference");
    Assert.assertEquals(2,references.getLength());
    NodeList cipherReferences=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"CipherReference");
    Assert.assertEquals(1,cipherReferences.getLength());
    NodeList encDatas=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"EncryptedData");
    Assert.assertEquals(2,encDatas.getLength());
    NodeList securityHeaderElement=securedDoc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(2,childs.getLength());
    Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
    Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedData");
  }
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> attHeaders=responseAttachment.getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidXMLAttachmentCmplEncCmplSign() throws Exception {
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment[] attachment=new Attachment[1];
  attachment[0]=new Attachment();
  attachment[0].setMimeType("text/xml");
  attachment[0].addHeaders(getHeaders(attachmentId));
  attachment[0].setId(attachmentId);
  attachment[0].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Content));
    securityProperties.addEncryptionPart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setAttachmentCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          List<Attachment> attachments=new ArrayList<Attachment>();
          attachments.add(attachment[0]);
          attachmentRequestCallback.setAttachments(attachments);
        }
 else {
          AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
          attachment[0]=attachmentResultCallback.getAttachment();
        }
      }
    }
);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document securedDoc=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList securityHeaderElement=securedDoc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(3,childs.getLength());
    Assert.assertEquals(childs.item(0).getLocalName(),"Signature");
    Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedKey");
    Assert.assertEquals(childs.item(2).getLocalName(),"EncryptedData");
  }
{
    final PushbackInputStream pis=new PushbackInputStream(attachment[0].getSourceStream(),1);
    pis.unread('K');
    attachment[0].setSourceStream(pis);
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAttachmentCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          if (!attachment[0].getId().equals(attachmentRequestCallback.getAttachmentId())) {
            throw new RuntimeException("wrong attachment requested");
          }
          List<Attachment> attachments=new ArrayList<Attachment>();
          attachments.add(attachment[0]);
          attachmentRequestCallback.setAttachments(attachments);
        }
 else {
          AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
          attachment[0]=attachmentResultCallback.getAttachment();
        }
      }
    }
);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Exception expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getMessage());
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.ConfigurationConverterTest </h4><pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOutboundSignatureConfiguration() throws Exception {
  Map<String,Object> config=new HashMap<String,Object>();
  config.put(ConfigurationConstants.ACTION,ConfigurationConstants.SIGNATURE);
  config.put(ConfigurationConstants.USER,"transmitter");
  config.put(ConfigurationConstants.PW_CALLBACK_REF,new CallbackHandlerImpl());
  String sigAlgo="http://www.w3.org/2001/04/xmldsig-more#rsa-sha256";
  config.put(ConfigurationConstants.SIG_ALGO,sigAlgo);
  config.put(ConfigurationConstants.SIG_KEY_ID,"Thumbprint");
  config.put(ConfigurationConstants.ADD_INCLUSIVE_PREFIXES,"false");
  config.put(ConfigurationConstants.SIG_PROP_FILE,"transmitter-crypto.properties");
  config.put(ConfigurationConstants.SIGNATURE_PARTS,"{}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  WSSSecurityProperties properties=ConfigurationConverter.convert(config);
  Assert.assertEquals(properties.getSignatureUser(),"transmitter");
  Assert.assertEquals(properties.getActions().size(),1);
  Assert.assertEquals(properties.getActions().get(0),WSSConstants.SIGNATURE);
  Assert.assertTrue(properties.getCallbackHandler() instanceof CallbackHandlerImpl);
  Assert.assertEquals(properties.getSignatureAlgorithm(),sigAlgo);
  Assert.assertEquals(properties.getSignatureKeyIdentifier(),WSSecurityTokenConstants.KEYIDENTIFIER_THUMBPRINT_IDENTIFIER);
  Assert.assertFalse(properties.isAddExcC14NInclusivePrefixes());
  Assert.assertNotNull(properties.getSignatureCrypto());
  Assert.assertTrue(properties.getSignatureSecureParts() != null);
  Assert.assertEquals(properties.getSignatureSecureParts().size(),1);
  Assert.assertEquals(properties.getSignatureSecureParts().get(0).getName().getLocalPart(),"Body");
  Assert.assertEquals(properties.getSignatureSecureParts().get(0).getName().getNamespaceURI(),"http://schemas.xmlsoap.org/soap/envelope/");
  WSSec.validateAndApplyDefaultsToOutboundSecurityProperties(properties);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimestampConfiguration() throws Exception {
  Map<String,Object> config=new HashMap<String,Object>();
  config.put(ConfigurationConstants.ACTION,ConfigurationConstants.TIMESTAMP);
  config.put(ConfigurationConstants.TTL_TIMESTAMP,"180");
  WSSSecurityProperties properties=ConfigurationConverter.convert(config);
  Assert.assertEquals(properties.getActions().size(),1);
  Assert.assertEquals(properties.getActions().get(0),WSSConstants.TIMESTAMP);
  Assert.assertEquals(properties.getTimestampTTL(),Integer.valueOf(180));
  WSSec.validateAndApplyDefaultsToOutboundSecurityProperties(properties);
  config.put(ConfigurationConstants.TTL_FUTURE_TIMESTAMP,"120");
  config.put(ConfigurationConstants.TIMESTAMP_STRICT,"false");
  properties=ConfigurationConverter.convert(config);
  Assert.assertEquals(properties.getTimeStampFutureTTL(),Integer.valueOf(120));
  Assert.assertFalse(properties.isStrictTimestampCheck());
  WSSec.validateAndApplyDefaultsToInboundSecurityProperties(properties);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInboundEncryptionConfiguration() throws Exception {
  Map<String,Object> config=new HashMap<String,Object>();
  config.put(ConfigurationConstants.ACTION,ConfigurationConstants.ENCRYPT);
  config.put(ConfigurationConstants.PW_CALLBACK_REF,new CallbackHandlerImpl());
  config.put(ConfigurationConstants.DEC_PROP_FILE,"receiver-crypto.properties");
  config.put(ConfigurationConstants.ALLOW_RSA15_KEY_TRANSPORT_ALGORITHM,"true");
  WSSSecurityProperties properties=ConfigurationConverter.convert(config);
  Assert.assertEquals(properties.getActions().size(),1);
  Assert.assertEquals(properties.getActions().get(0),WSSConstants.ENCRYPT);
  Assert.assertTrue(properties.getCallbackHandler() instanceof CallbackHandlerImpl);
  Assert.assertNotNull(properties.getDecryptionCrypto());
  WSSec.validateAndApplyDefaultsToInboundSecurityProperties(properties);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOutboundEncryptionConfiguration() throws Exception {
  Map<String,Object> config=new HashMap<String,Object>();
  config.put(ConfigurationConstants.ACTION,ConfigurationConstants.ENCRYPT);
  config.put(ConfigurationConstants.USER,"transmitter");
  config.put(ConfigurationConstants.PW_CALLBACK_REF,new CallbackHandlerImpl());
  config.put(ConfigurationConstants.ENC_KEY_TRANSPORT,WSSConstants.NS_XENC_RSA15);
  config.put(ConfigurationConstants.ENC_KEY_ID,"EncryptedKeySHA1");
  config.put(ConfigurationConstants.ENC_PROP_FILE,"receiver-crypto.properties");
  config.put(ConfigurationConstants.ENCRYPTION_PARTS,"{}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  WSSSecurityProperties properties=ConfigurationConverter.convert(config);
  Assert.assertEquals(properties.getEncryptionUser(),"transmitter");
  Assert.assertEquals(properties.getActions().size(),1);
  Assert.assertEquals(properties.getActions().get(0),WSSConstants.ENCRYPT);
  Assert.assertTrue(properties.getCallbackHandler() instanceof CallbackHandlerImpl);
  Assert.assertEquals(properties.getEncryptionKeyTransportAlgorithm(),WSSConstants.NS_XENC_RSA15);
  Assert.assertEquals(properties.getEncryptionKeyIdentifier(),WSSecurityTokenConstants.KEYIDENTIFIER_ENCRYPTED_KEY_SHA1_IDENTIFIER);
  Assert.assertNotNull(properties.getEncryptionCrypto());
  Assert.assertTrue(properties.getEncryptionSecureParts() != null);
  Assert.assertEquals(properties.getEncryptionSecureParts().size(),1);
  Assert.assertEquals(properties.getEncryptionSecureParts().get(0).getName().getLocalPart(),"Body");
  Assert.assertEquals(properties.getEncryptionSecureParts().get(0).getName().getNamespaceURI(),"http://schemas.xmlsoap.org/soap/envelope/");
  WSSec.validateAndApplyDefaultsToOutboundSecurityProperties(properties);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInboundSignatureConfiguration() throws Exception {
  Map<String,Object> config=new HashMap<String,Object>();
  config.put(ConfigurationConstants.ACTION,ConfigurationConstants.SIGNATURE);
  config.put(ConfigurationConstants.PW_CALLBACK_REF,new CallbackHandlerImpl());
  config.put(ConfigurationConstants.ADD_INCLUSIVE_PREFIXES,"false");
  config.put(ConfigurationConstants.SIG_VER_PROP_FILE,"transmitter-crypto.properties");
  config.put(ConfigurationConstants.IS_BSP_COMPLIANT,"false");
  config.put(ConfigurationConstants.ENABLE_REVOCATION,"true");
  WSSSecurityProperties properties=ConfigurationConverter.convert(config);
  Assert.assertEquals(properties.getActions().size(),1);
  Assert.assertEquals(properties.getActions().get(0),WSSConstants.SIGNATURE);
  Assert.assertTrue(properties.getCallbackHandler() instanceof CallbackHandlerImpl);
  Assert.assertTrue(properties.isDisableBSPEnforcement());
  Assert.assertTrue(properties.isEnableRevocation());
  Assert.assertNotNull(properties.getSignatureVerificationCrypto());
  WSSec.validateAndApplyDefaultsToInboundSecurityProperties(properties);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAMLConfiguration() throws Exception {
  Map<String,Object> config=new HashMap<String,Object>();
  config.put(ConfigurationConstants.ACTION,ConfigurationConstants.SAML_TOKEN_UNSIGNED);
  config.put(ConfigurationConstants.SAML_CALLBACK_REF,new SAMLCallbackHandlerImpl());
  WSSSecurityProperties properties=ConfigurationConverter.convert(config);
  Assert.assertEquals(properties.getActions().size(),1);
  Assert.assertEquals(properties.getActions().get(0),WSSConstants.SAML_TOKEN_UNSIGNED);
  Assert.assertTrue(properties.getSamlCallbackHandler() instanceof SAMLCallbackHandlerImpl);
  WSSec.validateAndApplyDefaultsToOutboundSecurityProperties(properties);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUsernameTokenConfiguration() throws Exception {
  Map<String,Object> config=new HashMap<String,Object>();
  config.put(ConfigurationConstants.ACTION,ConfigurationConstants.USERNAME_TOKEN);
  config.put(ConfigurationConstants.USER,"testuser");
  config.put(ConfigurationConstants.PW_CALLBACK_CLASS,"org.apache.wss4j.stax.test.CallbackHandlerImpl");
  config.put(ConfigurationConstants.PASSWORD_TYPE,"PasswordText");
  config.put(ConfigurationConstants.ADD_USERNAMETOKEN_NONCE,"true");
  config.put(ConfigurationConstants.ADD_USERNAMETOKEN_CREATED,"false");
  WSSSecurityProperties properties=ConfigurationConverter.convert(config);
  Assert.assertEquals(properties.getTokenUser(),"testuser");
  Assert.assertEquals(properties.getActions().size(),1);
  Assert.assertEquals(properties.getActions().get(0),WSSConstants.USERNAMETOKEN);
  Assert.assertTrue(properties.getCallbackHandler() instanceof CallbackHandlerImpl);
  Assert.assertEquals(properties.getUsernameTokenPasswordType(),UsernameTokenPasswordType.PASSWORD_TEXT);
  Assert.assertTrue(properties.isAddUsernameTokenNonce());
  Assert.assertFalse(properties.isAddUsernameTokenCreated());
  WSSec.validateAndApplyDefaultsToOutboundSecurityProperties(properties);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.EncDecryptionTest </h4><pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testElementoEncryptNotFound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.setTokenUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.NS_WSSE10,"UsernameToken"),SecurePart.Modifier.Element));
    securityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.NS_SOAP11,"Body"),SecurePart.Modifier.Content));
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    try {
      XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
      xmlStreamWriter.close();
      Assert.fail("Exception expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof XMLSecurityException);
      Assert.assertEquals("Part to encrypt not found: {http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}UsernameToken",e.getCause().getMessage());
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * not possible with swssf atm
 * @Test public void testEncDecryptionKeyIdentifierBinarySecurityTokenDirectReferenceAtTheEndOfTheSecurityHeaderInbound() throws Exception {
 * <p/>
 * ByteArrayOutputStream baos = new ByteArrayOutputStream();
 * {
 * InputStream sourceDocument = this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
 * String action = WSHandlerConstants.ENCRYPT;
 * Properties properties = new Properties();
 * properties.setProperty(WSHandlerConstants.ENC_KEY_ID, "DirectReference");
 * Document securedDocument = doOutboundSecurityWithWSS4J(sourceDocument, action, properties);
 * <p/>
 * //some test that we can really sure we get what we want from WSS4J
 * XPathExpression xPathExpression = getXPath("/soap:Envelope/soap:Header/wsse:Security/wsse:BinarySecurityToken");
 * Node node = (Node) xPathExpression.evaluate(securedDocument, XPathConstants.NODE);
 * Assert.assertNotNull(node);
 * Element parentElement = (Element) node.getParentNode();
 * parentElement.removeChild(node);
 * parentElement.appendChild(node);
 * <p/>
 * Transformer transformer = TRANSFORMER_FACTORY.newTransformer();
 * transformer.transform(new DOMSource(securedDocument), new StreamResult(baos));
 * }
 * <p/>
 * //done encryption; now test decryption:
 * {
 * WSSSecurityProperties securityProperties = new WSSSecurityProperties();
 * securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"), "default".toCharArray());
 * securityProperties.setCallbackHandler(new org.apache.wss4j.test.CallbackHandlerImpl());
 * Document document = doInboundSecurity(securityProperties, xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
 * <p/>
 * //header element must still be there
 * NodeList nodeList = document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(), WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
 * Assert.assertEquals(nodeList.getLength(), 1);
 * Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(), WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
 * <p/>
 * //no encrypted content
 * nodeList = document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(), WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
 * Assert.assertEquals(nodeList.getLength(), 0);
 * }
 * }
 */
@Test public void testEncDecryptionKeyIdentifierX509KeyOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.setEncryptionKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_X509KeyIdentifier);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionPartsContentInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.ENCRYPTION_PARTS,"{Content}{http://www.w3.org/1999/XMLSchema}simpleType;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.X509Token,WSSecurityEventConstants.OPERATION,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),securityEventListener);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    securityEventListener.compare();
    List<SecurityEvent> receivedSecurityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < receivedSecurityEvents.size(); i++) {
      SecurityEvent securityEvent=receivedSecurityEvents.get(i);
      if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.OPERATION) {
        OperationSecurityEvent operationSecurityEvent=(OperationSecurityEvent)securityEvent;
        Assert.assertEquals(operationSecurityEvent.getOperation(),new QName("http://schemas.xmlsoap.org/wsdl/","definitions"));
      }
 else       if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.ContentEncrypted) {
        ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=(ContentEncryptedElementSecurityEvent)securityEvent;
        Assert.assertNotNull(contentEncryptedElementSecurityEvent.getXmlSecEvent());
        Assert.assertNotNull(contentEncryptedElementSecurityEvent.getSecurityToken());
        Assert.assertNotNull(contentEncryptedElementSecurityEvent.getElementPath());
        final QName expectedElementName=new QName("http://www.w3.org/1999/XMLSchema","simpleType");
        Assert.assertEquals(contentEncryptedElementSecurityEvent.getXmlSecEvent().asStartElement().getName(),expectedElementName);
        Assert.assertEquals(contentEncryptedElementSecurityEvent.getElementPath().size(),6);
        Assert.assertEquals(contentEncryptedElementSecurityEvent.getElementPath().get(contentEncryptedElementSecurityEvent.getElementPath().size() - 1),expectedElementName);
      }
    }
    List<ContentEncryptedElementSecurityEvent> contentEncryptedElementSecurityEventList=securityEventListener.getSecurityEvents(SecurityEventConstants.ContentEncrypted);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String encryptedPartCorrelationID1=contentEncryptedElementSecurityEventList.get(0).getCorrelationID();
    String encryptedPartCorrelationID2=contentEncryptedElementSecurityEventList.get(1).getCorrelationID();
    String encryptedPartCorrelationID3=contentEncryptedElementSecurityEventList.get(2).getCorrelationID();
    String encryptedPartCorrelationID4=contentEncryptedElementSecurityEventList.get(3).getCorrelationID();
    String encryptedPartCorrelationID5=contentEncryptedElementSecurityEventList.get(4).getCorrelationID();
    String encryptedPartCorrelationID6=contentEncryptedElementSecurityEventList.get(5).getCorrelationID();
    String encryptedPartCorrelationID7=contentEncryptedElementSecurityEventList.get(6).getCorrelationID();
    String encryptedPartCorrelationID8=contentEncryptedElementSecurityEventList.get(7).getCorrelationID();
    String encryptedPartCorrelationID9=contentEncryptedElementSecurityEventList.get(8).getCorrelationID();
    String encryptedPartCorrelationID10=contentEncryptedElementSecurityEventList.get(9).getCorrelationID();
    String encryptedPartCorrelationID11=contentEncryptedElementSecurityEventList.get(10).getCorrelationID();
    String encryptedPartCorrelationID12=contentEncryptedElementSecurityEventList.get(11).getCorrelationID();
    String encryptedPartCorrelationID13=contentEncryptedElementSecurityEventList.get(12).getCorrelationID();
    String encryptedPartCorrelationID14=contentEncryptedElementSecurityEventList.get(13).getCorrelationID();
    String encryptedPartCorrelationID15=contentEncryptedElementSecurityEventList.get(14).getCorrelationID();
    String encryptedPartCorrelationID16=contentEncryptedElementSecurityEventList.get(15).getCorrelationID();
    String encryptedPartCorrelationID17=contentEncryptedElementSecurityEventList.get(16).getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents1=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents2=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents3=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents4=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents5=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents6=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents7=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents8=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents9=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents10=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents11=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents12=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents13=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents14=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents15=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents16=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents17=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID1)) {
        encryptedPartSecurityEvents1.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID2)) {
        encryptedPartSecurityEvents2.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID3)) {
        encryptedPartSecurityEvents3.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID4)) {
        encryptedPartSecurityEvents4.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID5)) {
        encryptedPartSecurityEvents5.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID6)) {
        encryptedPartSecurityEvents6.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID7)) {
        encryptedPartSecurityEvents7.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID8)) {
        encryptedPartSecurityEvents8.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID9)) {
        encryptedPartSecurityEvents9.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID10)) {
        encryptedPartSecurityEvents10.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID11)) {
        encryptedPartSecurityEvents11.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID12)) {
        encryptedPartSecurityEvents12.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID13)) {
        encryptedPartSecurityEvents13.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID14)) {
        encryptedPartSecurityEvents14.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID15)) {
        encryptedPartSecurityEvents15.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID16)) {
        encryptedPartSecurityEvents16.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID17)) {
        encryptedPartSecurityEvents17.add(securityEvent);
      }
    }
    Assert.assertEquals(4,encryptedPartSecurityEvents1.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents2.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents3.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents4.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents5.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents6.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents7.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents8.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents9.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents10.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents11.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents12.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents13.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents14.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents15.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents16.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents17.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + encryptedPartSecurityEvents1.size() + encryptedPartSecurityEvents2.size()+ encryptedPartSecurityEvents3.size()+ encryptedPartSecurityEvents4.size()+ encryptedPartSecurityEvents5.size()+ encryptedPartSecurityEvents6.size()+ encryptedPartSecurityEvents7.size()+ encryptedPartSecurityEvents8.size()+ encryptedPartSecurityEvents9.size()+ encryptedPartSecurityEvents10.size()+ encryptedPartSecurityEvents11.size()+ encryptedPartSecurityEvents12.size()+ encryptedPartSecurityEvents13.size()+ encryptedPartSecurityEvents14.size()+ encryptedPartSecurityEvents15.size()+ encryptedPartSecurityEvents16.size()+ encryptedPartSecurityEvents17.size()+ 1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionUseThisCert() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    KeyStore keyStore=KeyStore.getInstance("jks");
    keyStore.load(this.getClass().getClassLoader().getResourceAsStream("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUseThisCertificate((X509Certificate)keyStore.getCertificate("receiver"));
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),"Body");
    NodeList childNodes=nodeList.item(0).getParentNode().getChildNodes();
    for (int i=0; i < childNodes.getLength(); i++) {
      Node child=childNodes.item(i);
      if (child.getNodeType() == Node.TEXT_NODE) {
        Assert.assertEquals(child.getTextContent().trim(),"");
      }
 else       if (child.getNodeType() == Node.ELEMENT_NODE) {
        Assert.assertEquals(child,nodeList.item(0));
      }
 else {
        Assert.fail("Unexpected Node encountered");
      }
    }
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    Document document=doInboundSecurity(securityProperties,new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKeyWrappingRSAOAEPMGF1AESGCM128Inbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.ENC_SYM_ALGO,"http://www.w3.org/2009/xmlenc11#aes128-gcm");
    properties.put(WSHandlerConstants.ENC_KEY_TRANSPORT,"http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#aes128-gcm']");
    node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionKeyIdentifierIssuerSerialOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.setEncryptionKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_IssuerSerial);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/dsig:KeyInfo/wsse:SecurityTokenReference/dsig:X509Data/dsig:X509IssuerSerial/dsig:X509SerialNumber");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * rsa-oaep, Digest:SHA384, MGF:SHA1, PSource: None
 */
@Test public void testKeyWrappingRSAOAEPAES192GCMSHA384MGF1sha384Outbound() throws Exception {
  try {
    Security.addProvider(new BouncyCastleProvider());
    ByteArrayOutputStream baos;
{
      WSSSecurityProperties securityProperties=new WSSSecurityProperties();
      List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
      actions.add(WSSConstants.ENCRYPT);
      securityProperties.setActions(actions);
      securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
      securityProperties.setEncryptionUser("receiver");
      securityProperties.setEncryptionSymAlgorithm("http://www.w3.org/2009/xmlenc11#aes192-gcm");
      securityProperties.setEncryptionKeyTransportAlgorithm("http://www.w3.org/2009/xmlenc11#rsa-oaep");
      securityProperties.setEncryptionKeyTransportDigestAlgorithm("http://www.w3.org/2001/04/xmldsig-more#sha384");
      securityProperties.setEncryptionKeyTransportMGFAlgorithm("http://www.w3.org/2009/xmlenc11#mgf1sha384");
      InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
      baos=doOutboundSecurity(securityProperties,sourceDocument);
      Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
      NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
      Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
      XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#rsa-oaep']");
      Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod/dsig:DigestMethod[@Algorithm='http://www.w3.org/2001/04/xmldsig-more#sha384']");
      node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod/xenc11:MGF[@Algorithm='http://www.w3.org/2009/xmlenc11#mgf1sha384']");
      node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
      Assert.assertEquals(nodeList.getLength(),1);
      nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
      Assert.assertEquals(nodeList.getLength(),1);
      xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#aes192-gcm']");
      node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      Assert.assertEquals(node.getParentNode().getParentNode().getLocalName(),"Body");
      NodeList childNodes=node.getParentNode().getParentNode().getChildNodes();
      for (int i=0; i < childNodes.getLength(); i++) {
        Node child=childNodes.item(i);
        if (child.getNodeType() == Node.TEXT_NODE) {
          Assert.assertEquals(child.getTextContent().trim(),"");
        }
 else         if (child.getNodeType() == Node.ELEMENT_NODE) {
          Assert.assertEquals(child,nodeList.item(0));
        }
 else {
          Assert.fail("Unexpected Node encountered");
        }
      }
    }
{
      String action=WSHandlerConstants.ENCRYPT;
      doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
    }
  }
  finally {
    Security.removeProvider(BouncyCastleProvider.PROVIDER_NAME);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKeyWrappingRSAOAEPAESGMC192SHA256Inbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.ENC_SYM_ALGO,"http://www.w3.org/2009/xmlenc11#aes192-gcm");
    properties.put(WSHandlerConstants.ENC_KEY_TRANSPORT,"http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p");
    properties.put(WSHandlerConstants.ENC_DIGEST_ALGO,"http://www.w3.org/2001/04/xmlenc#sha256");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod/dsig:DigestMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#sha256']");
    node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#aes192-gcm']");
    node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.addIgnoreBSPRule(BSPRule.R5620);
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionKeyIdentifierThumbprintOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.setEncryptionKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_THUMBPRINT_IDENTIFIER);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/oasis-wss-soap-message-security-1.1#ThumbprintSHA1']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionKeyIdentifierX509KeyInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.ENC_KEY_ID,"X509KeyIdentifier");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test @org.junit.Ignore public void testKeyWrappingRSAOAEPAESGCM192SHA384MGF1SHA384PSourceInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.ENC_SYM_ALGO,"http://www.w3.org/2009/xmlenc11#aes192-gcm");
    properties.put(WSHandlerConstants.ENC_KEY_TRANSPORT,"http://www.w3.org/2009/xmlenc11#rsa-oaep");
    properties.put(WSHandlerConstants.ENC_DIGEST_ALGO,"http://www.w3.org/2001/04/xmldsig-more#sha384");
    properties.put(WSHandlerConstants.ENC_MGF_ALGO,"http://www.w3.org/2009/xmlenc11#mgf1sha384");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#rsa-oaep']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod/xenc:OAEPparams");
    node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod/dsig:DigestMethod[@Algorithm='http://www.w3.org/2001/04/xmldsig-more#sha384']");
    node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod/dsig:MGF[@Algorithm='http://www.w3.org/2009/xmlenc11#mgf1sha384']");
    node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#aes192-gcm']");
    node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.addIgnoreBSPRule(BSPRule.R5620);
    securityProperties.addIgnoreBSPRule(BSPRule.R5621);
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionKeyIdentifierSHA1Inbound() throws Exception {
  KeyGenerator keyGen=KeyGenerator.getInstance("AES");
  keyGen.init(128);
  SecretKey key=keyGen.generateKey();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    Document doc=documentBuilderFactory.newDocumentBuilder().parse(sourceDocument);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    WSSecEncrypt builder=new WSSecEncrypt();
    builder.setKeyIdentifierType(WSConstants.ENCRYPTED_KEY_SHA1_IDENTIFIER);
    builder.setSymmetricKey(key);
    builder.setEncryptSymmKey(false);
    Document securedDocument=builder.build(doc,null,secHeader);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/oasis-wss-soap-message-security-1.1#EncryptedKeySHA1']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl(key.getEncoded()));
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionKeyIdentifierSubjectKeyOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.setEncryptionKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_SkiKeyIdentifier);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509SubjectKeyIdentifier']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionCryptoPropertiesInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    Properties properties=CryptoFactory.getProperties("receiver-crypto.properties",this.getClass().getClassLoader());
    securityProperties.setDecryptionCryptoProperties(properties);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),securityEventListener);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    securityEventListener.compare();
    List<SecurityEvent> receivedSecurityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < receivedSecurityEvents.size(); i++) {
      SecurityEvent securityEvent=receivedSecurityEvents.get(i);
      if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.OPERATION) {
        OperationSecurityEvent operationSecurityEvent=(OperationSecurityEvent)securityEvent;
        Assert.assertEquals(operationSecurityEvent.getOperation(),new QName("http://schemas.xmlsoap.org/wsdl/","definitions"));
      }
 else       if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.ENCRYPTED_PART) {
        EncryptedPartSecurityEvent encryptedPartSecurityEvent=(EncryptedPartSecurityEvent)securityEvent;
        Assert.assertNotNull(encryptedPartSecurityEvent.getXmlSecEvent());
        Assert.assertNotNull(encryptedPartSecurityEvent.getSecurityToken());
        Assert.assertNotNull(encryptedPartSecurityEvent.getElementPath());
        final QName expectedElementName=new QName("http://schemas.xmlsoap.org/soap/envelope/","Body");
        Assert.assertEquals(encryptedPartSecurityEvent.getXmlSecEvent().asStartElement().getName(),expectedElementName);
        Assert.assertEquals(encryptedPartSecurityEvent.getElementPath().size(),2);
        Assert.assertEquals(encryptedPartSecurityEvent.getElementPath().get(encryptedPartSecurityEvent.getElementPath().size() - 1),expectedElementName);
      }
    }
    EncryptedPartSecurityEvent encryptedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.ENCRYPTED_PART);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String encryptedPartCorrelationID=encryptedPartSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID)) {
        encryptedPartSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(4,encryptedPartSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + encryptedPartSecurityEvents.size());
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionCryptoPropertiesOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    Properties properties=CryptoFactory.getProperties("transmitter-crypto.properties",this.getClass().getClassLoader());
    securityProperties.setEncryptionCryptoProperties(properties);
    securityProperties.setEncryptionUser("receiver");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#aes256-cbc']");
    node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Assert.assertEquals(node.getParentNode().getParentNode().getLocalName(),"Body");
    NodeList childNodes=node.getParentNode().getParentNode().getChildNodes();
    for (int i=0; i < childNodes.getLength(); i++) {
      Node child=childNodes.item(i);
      if (child.getNodeType() == Node.TEXT_NODE) {
        Assert.assertEquals(child.getTextContent().trim(),"");
      }
 else       if (child.getNodeType() == Node.ELEMENT_NODE) {
        Assert.assertEquals(child,nodeList.item(0));
      }
 else {
        Assert.fail("Unexpected Node encountered");
      }
    }
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionPartsContentOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://www.w3.org/1999/XMLSchema","complexType"),SecurePart.Modifier.Content));
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),25);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),25);
    for (int i=0; i < nodeList.getLength(); i++) {
      Assert.assertEquals(nodeList.item(i).getParentNode().getLocalName(),"complexType");
      Assert.assertEquals(nodeList.item(i).getParentNode().getNamespaceURI(),"http://www.w3.org/1999/XMLSchema");
      NodeList childNodes=nodeList.item(i).getParentNode().getChildNodes();
      for (int j=0; j < childNodes.getLength(); j++) {
        Node child=childNodes.item(j);
        if (child.getNodeType() == Node.TEXT_NODE) {
          Assert.assertEquals(child.getTextContent().trim(),"");
        }
 else         if (child.getNodeType() == Node.ELEMENT_NODE) {
          Assert.assertEquals(child,nodeList.item(i));
        }
 else {
          Assert.fail("Unexpected Node encountered");
        }
      }
    }
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionKeyIdentifierThumbprintInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.ENC_KEY_ID,"Thumbprint");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/oasis-wss-soap-message-security-1.1#ThumbprintSHA1']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInboundRequiredAlgorithms() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setEncryptionKeyTransportAlgorithm(WSSConstants.NS_XENC_RSAOAEPMGF1P);
    securityProperties.setEncryptionSymAlgorithm(WSSConstants.NS_XENC_AES128);
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null);
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setEncryptionKeyTransportAlgorithm(WSSConstants.NS_XENC_RSA15);
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    try {
      doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null);
      Assert.fail("Failure expected on the wrong key transport algorithm");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    }
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setEncryptionSymAlgorithm(WSSConstants.NS_XENC_TRIPLE_DES);
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    try {
      doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null);
      Assert.fail("Failure expected on the wrong key transport algorithm");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * rsa-oaep-mgf1p, Digest:SHA256, MGF:SHA1, PSource: None
 */
@Test public void testKeyWrappingRSAOAEPMGF1AESGCM128Outbound() throws Exception {
  try {
    Security.addProvider(new BouncyCastleProvider());
    ByteArrayOutputStream baos;
{
      WSSSecurityProperties securityProperties=new WSSSecurityProperties();
      List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
      actions.add(WSSConstants.ENCRYPT);
      securityProperties.setActions(actions);
      securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
      securityProperties.setEncryptionUser("receiver");
      securityProperties.setEncryptionSymAlgorithm("http://www.w3.org/2009/xmlenc11#aes128-gcm");
      securityProperties.setEncryptionKeyTransportAlgorithm("http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p");
      InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
      baos=doOutboundSecurity(securityProperties,sourceDocument);
      Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
      NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
      Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
      XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
      Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
      Assert.assertEquals(nodeList.getLength(),1);
      nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
      Assert.assertEquals(nodeList.getLength(),1);
      xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#aes128-gcm']");
      node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      Assert.assertEquals(node.getParentNode().getParentNode().getLocalName(),"Body");
      NodeList childNodes=node.getParentNode().getParentNode().getChildNodes();
      for (int i=0; i < childNodes.getLength(); i++) {
        Node child=childNodes.item(i);
        if (child.getNodeType() == Node.TEXT_NODE) {
          Assert.assertEquals(child.getTextContent().trim(),"");
        }
 else         if (child.getNodeType() == Node.ELEMENT_NODE) {
          Assert.assertEquals(child,nodeList.item(0));
        }
 else {
          Assert.fail("Unexpected Node encountered");
        }
      }
    }
{
      String action=WSHandlerConstants.ENCRYPT;
      doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
    }
  }
  finally {
    Security.removeProvider(BouncyCastleProvider.PROVIDER_NAME);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionKeyIdentifierBinarySecurityTokenDirectReferenceOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.setEncryptionKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/wsse:BinarySecurityToken");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test @SuppressWarnings("unchecked") public void testCompressedEncDecryption() throws Exception {
  Init.init(WSSec.class.getClassLoader().getResource("wss/wss-config.xml").toURI(),WSSec.class);
  Field algorithmsClassMapField=TransformerAlgorithmMapper.class.getDeclaredField("algorithmsClassMapOut");
  algorithmsClassMapField.setAccessible(true);
  Map<String,Class<?>> map=(Map<String,Class<?>>)algorithmsClassMapField.get(null);
  map.put("http://www.apache.org/2012/04/xmlsec/gzip",GzipCompressorOutputStream.class);
  algorithmsClassMapField=TransformerAlgorithmMapper.class.getDeclaredField("algorithmsClassMapIn");
  algorithmsClassMapField.setAccessible(true);
  map=(Map<String,Class<?>>)algorithmsClassMapField.get(null);
  map.put("http://www.apache.org/2012/04/xmlsec/gzip",GzipCompressorInputStream.class);
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.setEncryptionCompressionAlgorithm("http://www.apache.org/2012/04/xmlsec/gzip");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#aes256-cbc']");
    node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Assert.assertEquals(node.getParentNode().getParentNode().getLocalName(),"Body");
    NodeList childNodes=node.getParentNode().getParentNode().getChildNodes();
    for (int i=0; i < childNodes.getLength(); i++) {
      Node child=childNodes.item(i);
      if (child.getNodeType() == Node.TEXT_NODE) {
        Assert.assertEquals(child.getTextContent().trim(),"");
      }
 else       if (child.getNodeType() == Node.ELEMENT_NODE) {
        Assert.assertEquals(child,nodeList.item(0));
      }
 else {
        Assert.fail("Unexpected Node encountered");
      }
    }
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),securityEventListener);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    securityEventListener.compare();
    List<SecurityEvent> receivedSecurityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < receivedSecurityEvents.size(); i++) {
      SecurityEvent securityEvent=receivedSecurityEvents.get(i);
      if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.OPERATION) {
        OperationSecurityEvent operationSecurityEvent=(OperationSecurityEvent)securityEvent;
        Assert.assertEquals(operationSecurityEvent.getOperation(),new QName("http://schemas.xmlsoap.org/wsdl/","definitions"));
      }
 else       if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.ENCRYPTED_PART) {
        EncryptedPartSecurityEvent encryptedPartSecurityEvent=(EncryptedPartSecurityEvent)securityEvent;
        Assert.assertNotNull(encryptedPartSecurityEvent.getXmlSecEvent());
        Assert.assertNotNull(encryptedPartSecurityEvent.getSecurityToken());
        Assert.assertNotNull(encryptedPartSecurityEvent.getElementPath());
        final QName expectedElementName=new QName("http://schemas.xmlsoap.org/soap/envelope/","Body");
        Assert.assertEquals(encryptedPartSecurityEvent.getXmlSecEvent().asStartElement().getName(),expectedElementName);
        Assert.assertEquals(encryptedPartSecurityEvent.getElementPath().size(),2);
        Assert.assertEquals(encryptedPartSecurityEvent.getElementPath().get(encryptedPartSecurityEvent.getElementPath().size() - 1),expectedElementName);
      }
    }
    EncryptedPartSecurityEvent encryptedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.ENCRYPTED_PART);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String encryptedPartCorrelationID=encryptedPartSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID)) {
        encryptedPartSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(4,encryptedPartSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + encryptedPartSecurityEvents.size());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionKeyIdentifierSubjectKeyInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.ENC_KEY_ID,"SKIKeyIdentifier");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509SubjectKeyIdentifier']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionPropertiesOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    Map<String,Object> config=new HashMap<String,Object>();
    config.put(ConfigurationConstants.ACTION,ConfigurationConstants.ENCRYPT);
    config.put(ConfigurationConstants.ENCRYPTION_USER,"receiver");
    config.put(ConfigurationConstants.ENC_PROP_FILE,"transmitter-crypto.properties");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(config,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#aes256-cbc']");
    node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Assert.assertEquals(node.getParentNode().getParentNode().getLocalName(),"Body");
    NodeList childNodes=node.getParentNode().getParentNode().getChildNodes();
    for (int i=0; i < childNodes.getLength(); i++) {
      Node child=childNodes.item(i);
      if (child.getNodeType() == Node.TEXT_NODE) {
        Assert.assertEquals(child.getTextContent().trim(),"");
      }
 else       if (child.getNodeType() == Node.ELEMENT_NODE) {
        Assert.assertEquals(child,nodeList.item(0));
      }
 else {
        Assert.fail("Unexpected Node encountered");
      }
    }
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionKeyIdentifierIssuerSerialInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.ENC_KEY_ID,"IssuerSerial");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/dsig:KeyInfo/wsse:SecurityTokenReference/dsig:X509Data/dsig:X509IssuerSerial/dsig:X509SerialNumber");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKeyWrappingRSAOAEPAES192GCMSHA384MGF1sha1Inbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.ENC_SYM_ALGO,"http://www.w3.org/2009/xmlenc11#aes192-gcm");
    properties.put(WSHandlerConstants.ENC_KEY_TRANSPORT,"http://www.w3.org/2009/xmlenc11#rsa-oaep");
    properties.put(WSHandlerConstants.ENC_DIGEST_ALGO,"http://www.w3.org/2001/04/xmldsig-more#sha384");
    properties.put(WSHandlerConstants.ENC_MGF_ALGO,"http://www.w3.org/2009/xmlenc11#mgf1sha1");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#rsa-oaep']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod/dsig:DigestMethod[@Algorithm='http://www.w3.org/2001/04/xmldsig-more#sha384']");
    node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#aes192-gcm']");
    node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.addIgnoreBSPRule(BSPRule.R5620);
    securityProperties.addIgnoreBSPRule(BSPRule.R5621);
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * rsa-oaep, Digest:SHA512, MGF:SHA1, PSource: Specified 8 bytes
 */
@Test public void testKeyWrappingRSAOAEPAESGCM192SHA384MGF1SHA384PSourceOutbound() throws Exception {
  try {
    Security.addProvider(new BouncyCastleProvider());
    ByteArrayOutputStream baos;
{
      WSSSecurityProperties securityProperties=new WSSSecurityProperties();
      List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
      actions.add(WSSConstants.ENCRYPT);
      securityProperties.setActions(actions);
      securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
      securityProperties.setEncryptionUser("receiver");
      securityProperties.setEncryptionSymAlgorithm("http://www.w3.org/2009/xmlenc11#aes192-gcm");
      securityProperties.setEncryptionKeyTransportAlgorithm("http://www.w3.org/2009/xmlenc11#rsa-oaep");
      securityProperties.setEncryptionKeyTransportDigestAlgorithm("http://www.w3.org/2001/04/xmldsig-more#sha384");
      securityProperties.setEncryptionKeyTransportMGFAlgorithm("http://www.w3.org/2009/xmlenc11#mgf1sha384");
      securityProperties.setEncryptionKeyTransportOAEPParams(Base64.decode("ZHVtbXkxMjM=".getBytes(StandardCharsets.UTF_8)));
      InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
      baos=doOutboundSecurity(securityProperties,sourceDocument);
      Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
      NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
      Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
      XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#rsa-oaep']");
      Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod/xenc:OAEPparams");
      node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod/dsig:DigestMethod[@Algorithm='http://www.w3.org/2001/04/xmldsig-more#sha384']");
      node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod/xenc11:MGF[@Algorithm='http://www.w3.org/2009/xmlenc11#mgf1sha384']");
      node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
      Assert.assertEquals(nodeList.getLength(),1);
      nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
      Assert.assertEquals(nodeList.getLength(),1);
      xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#aes192-gcm']");
      node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      Assert.assertEquals(node.getParentNode().getParentNode().getLocalName(),"Body");
      NodeList childNodes=node.getParentNode().getParentNode().getChildNodes();
      for (int i=0; i < childNodes.getLength(); i++) {
        Node child=childNodes.item(i);
        if (child.getNodeType() == Node.TEXT_NODE) {
          Assert.assertEquals(child.getTextContent().trim(),"");
        }
 else         if (child.getNodeType() == Node.ELEMENT_NODE) {
          Assert.assertEquals(child,nodeList.item(0));
        }
 else {
          Assert.fail("Unexpected Node encountered");
        }
      }
    }
{
      String action=WSHandlerConstants.ENCRYPT;
      doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
    }
  }
  finally {
    Security.removeProvider(BouncyCastleProvider.PROVIDER_NAME);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionPartsHeaderInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-encryptedHeader.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.ENCRYPTION_PARTS,"{Header}{http://www.example.com}testEncryptedHeader;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),securityEventListener);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_wsse11_EncryptedHeader.getNamespaceURI(),WSSConstants.TAG_wsse11_EncryptedHeader.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    securityEventListener.compare();
    List<SecurityEvent> receivedSecurityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < receivedSecurityEvents.size(); i++) {
      SecurityEvent securityEvent=receivedSecurityEvents.get(i);
      if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.OPERATION) {
        OperationSecurityEvent operationSecurityEvent=(OperationSecurityEvent)securityEvent;
        Assert.assertEquals(operationSecurityEvent.getOperation(),new QName("http://schemas.xmlsoap.org/wsdl/","definitions"));
      }
 else       if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.ENCRYPTED_PART) {
        EncryptedPartSecurityEvent encryptedPartSecurityEvent=(EncryptedPartSecurityEvent)securityEvent;
        Assert.assertNotNull(encryptedPartSecurityEvent.getXmlSecEvent());
        Assert.assertNotNull(encryptedPartSecurityEvent.getSecurityToken());
        Assert.assertNotNull(encryptedPartSecurityEvent.getElementPath());
        final QName expectedElementName=new QName("http://www.example.com","testEncryptedHeader");
        Assert.assertEquals(encryptedPartSecurityEvent.getXmlSecEvent().asStartElement().getName(),expectedElementName);
        Assert.assertEquals(encryptedPartSecurityEvent.getElementPath().size(),3);
        Assert.assertEquals(encryptedPartSecurityEvent.getElementPath().get(encryptedPartSecurityEvent.getElementPath().size() - 1),expectedElementName);
      }
    }
    EncryptedPartSecurityEvent encryptedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.ENCRYPTED_PART);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String encryptedPartCorrelationID=encryptedPartSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID)) {
        encryptedPartSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(4,encryptedPartSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + encryptedPartSecurityEvents.size());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionKeyIdentifierBinarySecurityTokenDirectReferenceInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.ENC_KEY_ID,"DirectReference");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/wsse:BinarySecurityToken");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionPartsElementInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.ENCRYPTION_PARTS,"{Element}{http://www.w3.org/1999/XMLSchema}simpleType;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.X509Token,WSSecurityEventConstants.OPERATION,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),securityEventListener);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    securityEventListener.compare();
    List<SecurityEvent> receivedSecurityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < receivedSecurityEvents.size(); i++) {
      SecurityEvent securityEvent=receivedSecurityEvents.get(i);
      if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.OPERATION) {
        OperationSecurityEvent operationSecurityEvent=(OperationSecurityEvent)securityEvent;
        Assert.assertEquals(operationSecurityEvent.getOperation(),new QName("http://schemas.xmlsoap.org/wsdl/","definitions"));
      }
 else       if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.EncryptedElement) {
        EncryptedElementSecurityEvent encryptedElementSecurityEvent=(EncryptedElementSecurityEvent)securityEvent;
        Assert.assertNotNull(encryptedElementSecurityEvent.getXmlSecEvent());
        Assert.assertNotNull(encryptedElementSecurityEvent.getSecurityToken());
        Assert.assertNotNull(encryptedElementSecurityEvent.getElementPath());
        final QName expectedElementName=new QName("http://www.w3.org/1999/XMLSchema","simpleType");
        Assert.assertEquals(encryptedElementSecurityEvent.getXmlSecEvent().asStartElement().getName(),expectedElementName);
        Assert.assertEquals(encryptedElementSecurityEvent.getElementPath().size(),6);
        Assert.assertEquals(encryptedElementSecurityEvent.getElementPath().get(encryptedElementSecurityEvent.getElementPath().size() - 1),expectedElementName);
      }
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * rsa-oaep-mgf1p, Digest:SHA256, MGF:SHA1, PSource: None
 */
@Test public void testKeyWrappingRSAOAEPAESGCM192SHA256Outbound() throws Exception {
  try {
    Security.addProvider(new BouncyCastleProvider());
    ByteArrayOutputStream baos;
{
      WSSSecurityProperties securityProperties=new WSSSecurityProperties();
      List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
      actions.add(WSSConstants.ENCRYPT);
      securityProperties.setActions(actions);
      securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
      securityProperties.setEncryptionUser("receiver");
      securityProperties.setEncryptionSymAlgorithm("http://www.w3.org/2009/xmlenc11#aes192-gcm");
      securityProperties.setEncryptionKeyTransportAlgorithm("http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p");
      securityProperties.setEncryptionKeyTransportDigestAlgorithm("http://www.w3.org/2001/04/xmlenc#sha256");
      InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
      baos=doOutboundSecurity(securityProperties,sourceDocument);
      Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
      NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
      Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
      XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
      Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod/dsig:DigestMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#sha256']");
      node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
      Assert.assertEquals(nodeList.getLength(),1);
      nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
      Assert.assertEquals(nodeList.getLength(),1);
      xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#aes192-gcm']");
      node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      Assert.assertEquals(node.getParentNode().getParentNode().getLocalName(),"Body");
      NodeList childNodes=node.getParentNode().getParentNode().getChildNodes();
      for (int i=0; i < childNodes.getLength(); i++) {
        Node child=childNodes.item(i);
        if (child.getNodeType() == Node.TEXT_NODE) {
          Assert.assertEquals(child.getTextContent().trim(),"");
        }
 else         if (child.getNodeType() == Node.ELEMENT_NODE) {
          Assert.assertEquals(child,nodeList.item(0));
        }
 else {
          Assert.fail("Unexpected Node encountered");
        }
      }
    }
{
      String action=WSHandlerConstants.ENCRYPT;
      doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
    }
  }
  finally {
    Security.removeProvider(BouncyCastleProvider.PROVIDER_NAME);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionDefaultConfigurationOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#aes256-cbc']");
    node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Assert.assertEquals(node.getParentNode().getParentNode().getLocalName(),"Body");
    NodeList childNodes=node.getParentNode().getParentNode().getChildNodes();
    for (int i=0; i < childNodes.getLength(); i++) {
      Node child=childNodes.item(i);
      if (child.getNodeType() == Node.TEXT_NODE) {
        Assert.assertEquals(child.getTextContent().trim(),"");
      }
 else       if (child.getNodeType() == Node.ELEMENT_NODE) {
        Assert.assertEquals(child,nodeList.item(0));
      }
 else {
        Assert.fail("Unexpected Node encountered");
      }
    }
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDecryptionReferenceListOutsideEncryptedKey() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.setEncryptionKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_IssuerSerial);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/dsig:KeyInfo/wsse:SecurityTokenReference/dsig:X509Data/dsig:X509IssuerSerial/dsig:X509SerialNumber");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    TransformerFactory transFact=TransformerFactory.newInstance();
    Transformer trans=transFact.newTransformer(new StreamSource(this.getClass().getClassLoader().getResourceAsStream("xsl/testDecryptionReferenceListOutsideEncryptedKey.xsl")));
    baos.reset();
    trans.transform(new DOMSource(document),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    Document document=doInboundSecurity(securityProperties,new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionDefaultConfigurationInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),securityEventListener);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    securityEventListener.compare();
    List<SecurityEvent> receivedSecurityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < receivedSecurityEvents.size(); i++) {
      SecurityEvent securityEvent=receivedSecurityEvents.get(i);
      if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.OPERATION) {
        OperationSecurityEvent operationSecurityEvent=(OperationSecurityEvent)securityEvent;
        Assert.assertEquals(operationSecurityEvent.getOperation(),new QName("http://schemas.xmlsoap.org/wsdl/","definitions"));
      }
 else       if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.ENCRYPTED_PART) {
        EncryptedPartSecurityEvent encryptedPartSecurityEvent=(EncryptedPartSecurityEvent)securityEvent;
        Assert.assertNotNull(encryptedPartSecurityEvent.getXmlSecEvent());
        Assert.assertNotNull(encryptedPartSecurityEvent.getSecurityToken());
        Assert.assertNotNull(encryptedPartSecurityEvent.getElementPath());
        final QName expectedElementName=new QName("http://schemas.xmlsoap.org/soap/envelope/","Body");
        Assert.assertEquals(encryptedPartSecurityEvent.getXmlSecEvent().asStartElement().getName(),expectedElementName);
        Assert.assertEquals(encryptedPartSecurityEvent.getElementPath().size(),2);
        Assert.assertEquals(encryptedPartSecurityEvent.getElementPath().get(encryptedPartSecurityEvent.getElementPath().size() - 1),expectedElementName);
      }
    }
    EncryptedPartSecurityEvent encryptedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.ENCRYPTED_PART);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String encryptedPartCorrelationID=encryptedPartSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID)) {
        encryptedPartSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(4,encryptedPartSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + encryptedPartSecurityEvents.size());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionKeyIdentifierSHA1Outbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.setEncryptionKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_ENCRYPTED_KEY_SHA1_IDENTIFIER);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/oasis-wss-soap-message-security-1.1#ThumbprintSHA1']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/oasis-wss-soap-message-security-1.1#EncryptedKeySHA1']");
    node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionPropertiesInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    Map<String,Object> config=new HashMap<String,Object>();
    config.put(ConfigurationConstants.ACTION,ConfigurationConstants.ENCRYPT);
    config.put(ConfigurationConstants.DEC_PROP_FILE,"receiver-crypto.properties");
    config.put(ConfigurationConstants.PW_CALLBACK_REF,new CallbackHandlerImpl());
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    WSSSecurityProperties securityProperties=ConfigurationConverter.convert(config);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader outXmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),new ArrayList<SecurityEvent>(),securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),outXmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    securityEventListener.compare();
    List<SecurityEvent> receivedSecurityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < receivedSecurityEvents.size(); i++) {
      SecurityEvent securityEvent=receivedSecurityEvents.get(i);
      if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.OPERATION) {
        OperationSecurityEvent operationSecurityEvent=(OperationSecurityEvent)securityEvent;
        Assert.assertEquals(operationSecurityEvent.getOperation(),new QName("http://schemas.xmlsoap.org/wsdl/","definitions"));
      }
 else       if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.ENCRYPTED_PART) {
        EncryptedPartSecurityEvent encryptedPartSecurityEvent=(EncryptedPartSecurityEvent)securityEvent;
        Assert.assertNotNull(encryptedPartSecurityEvent.getXmlSecEvent());
        Assert.assertNotNull(encryptedPartSecurityEvent.getSecurityToken());
        Assert.assertNotNull(encryptedPartSecurityEvent.getElementPath());
        final QName expectedElementName=new QName("http://schemas.xmlsoap.org/soap/envelope/","Body");
        Assert.assertEquals(encryptedPartSecurityEvent.getXmlSecEvent().asStartElement().getName(),expectedElementName);
        Assert.assertEquals(encryptedPartSecurityEvent.getElementPath().size(),2);
        Assert.assertEquals(encryptedPartSecurityEvent.getElementPath().get(encryptedPartSecurityEvent.getElementPath().size() - 1),expectedElementName);
      }
    }
    EncryptedPartSecurityEvent encryptedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.ENCRYPTED_PART);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String encryptedPartCorrelationID=encryptedPartSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID)) {
        encryptedPartSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(4,encryptedPartSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + encryptedPartSecurityEvents.size());
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExceptionOnElementToEncryptNotFound() throws Exception {
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://www.wrongnamespace.org","complexType"),SecurePart.Modifier.Content));
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    try {
      doOutboundSecurity(securityProperties,sourceDocument);
      Assert.fail("Exception expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof XMLSecurityException);
      Assert.assertEquals("Part to encrypt not found: {http://www.wrongnamespace.org}complexType",e.getCause().getMessage());
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.EncryptionCRLTest </h4><pre class="type-8 type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * TODO Re-enable once CRL issue fixed
 */
@Test @org.junit.Ignore public void testEncryptionWithRevocationCheck() throws Exception {
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setEnableRevocation(true);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("wss40rev.jks"),"security".toCharArray());
    securityProperties.setEncryptionUser("wss40rev");
    securityProperties.setEncryptionKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    securityProperties.loadCRLCertStore(this.getClass().getClassLoader().getResource("wss40CACRL.pem"));
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    try {
      doOutboundSecurity(securityProperties,sourceDocument);
      Assert.fail("Expected failure on a revocation check");
    }
 catch (    Exception ex) {
      Assert.assertNotNull(ex.getCause());
      Assert.assertTrue(ex.getCause() instanceof WSSecurityException);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptionWithOutRevocationCheck() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("wss40rev.jks"),"security".toCharArray());
    securityProperties.setEncryptionUser("wss40rev");
    securityProperties.setEncryptionKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#aes256-cbc']");
    node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Assert.assertEquals(node.getParentNode().getParentNode().getLocalName(),"Body");
    NodeList childNodes=node.getParentNode().getParentNode().getChildNodes();
    for (int i=0; i < childNodes.getLength(); i++) {
      Node child=childNodes.item(i);
      if (child.getNodeType() == Node.TEXT_NODE) {
        Assert.assertEquals(child.getTextContent().trim(),"");
      }
 else       if (child.getNodeType() == Node.ELEMENT_NODE) {
        Assert.assertEquals(child,nodeList.item(0));
      }
 else {
        Assert.fail("Unexpected Node encountered");
      }
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.InboundWSSecurityContextImplTest </h4><pre class="type-3 type-11 type-15 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTokenIdentificationTransportSecurity() throws Exception {
  final List<SecurityEvent> securityEventList=generateTransportBindingSecurityEvents();
  Assert.assertEquals(securityEventList.size(),11);
  for (int i=0; i < securityEventList.size(); i++) {
    SecurityEvent securityEvent=securityEventList.get(i);
    if (securityEvent instanceof HttpsTokenSecurityEvent) {
      HttpsTokenSecurityEvent tokenSecurityEvent=(HttpsTokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),2);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE));
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION));
    }
 else     if (securityEvent instanceof X509TokenSecurityEvent) {
      X509TokenSecurityEvent tokenSecurityEvent=(X509TokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),1);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_SIGNED_ENDORSING_ENCRYPTED_SUPPORTING_TOKENS));
    }
 else     if (securityEvent instanceof UsernameTokenSecurityEvent) {
      UsernameTokenSecurityEvent tokenSecurityEvent=(UsernameTokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),1);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_SIGNED_ENCRYPTED_SUPPORTING_TOKENS));
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTokenIdentificationAsymmetricSecurity() throws Exception {
  final List<SecurityEvent> securityEventList=generateAsymmetricBindingSecurityEvents();
  boolean mainSignatureTokenOccured=false;
  boolean signedEndorsingSupportingTokenOccured=false;
  boolean signedEndorsingEncryptedSupportingTokenOccured=false;
  boolean supportingTokensOccured=false;
  boolean encryptedSupportingTokensOccured=false;
  boolean mainEncryptionTokenOccured=false;
  boolean usernameTokenOccured=false;
  Assert.assertEquals(securityEventList.size(),34);
  int x509TokenIndex=0;
  for (int i=0; i < securityEventList.size(); i++) {
    SecurityEvent securityEvent=securityEventList.get(i);
    if (securityEvent instanceof X509TokenSecurityEvent && x509TokenIndex == 0) {
      x509TokenIndex++;
      X509TokenSecurityEvent tokenSecurityEvent=(X509TokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),1);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION));
      mainEncryptionTokenOccured=true;
    }
 else     if (securityEvent instanceof X509TokenSecurityEvent && x509TokenIndex == 1) {
      x509TokenIndex++;
      X509TokenSecurityEvent tokenSecurityEvent=(X509TokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),1);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_ENCRYPTED_SUPPORTING_TOKENS));
      signedEndorsingSupportingTokenOccured=true;
    }
 else     if (securityEvent instanceof X509TokenSecurityEvent && x509TokenIndex == 2) {
      x509TokenIndex++;
      X509TokenSecurityEvent tokenSecurityEvent=(X509TokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),1);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS));
      encryptedSupportingTokensOccured=true;
    }
 else     if (securityEvent instanceof X509TokenSecurityEvent && x509TokenIndex == 3) {
      x509TokenIndex++;
      X509TokenSecurityEvent tokenSecurityEvent=(X509TokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),1);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE));
      supportingTokensOccured=true;
    }
 else     if (securityEvent instanceof X509TokenSecurityEvent && x509TokenIndex == 4) {
      x509TokenIndex++;
      X509TokenSecurityEvent tokenSecurityEvent=(X509TokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),1);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_SIGNED_ENDORSING_SUPPORTING_TOKENS));
      signedEndorsingEncryptedSupportingTokenOccured=true;
    }
 else     if (securityEvent instanceof X509TokenSecurityEvent && x509TokenIndex == 5) {
      x509TokenIndex++;
      X509TokenSecurityEvent tokenSecurityEvent=(X509TokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),1);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_SIGNED_ENDORSING_ENCRYPTED_SUPPORTING_TOKENS));
      mainSignatureTokenOccured=true;
    }
 else     if (securityEvent instanceof UsernameTokenSecurityEvent) {
      UsernameTokenSecurityEvent tokenSecurityEvent=(UsernameTokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),1);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_SIGNED_ENCRYPTED_SUPPORTING_TOKENS));
      usernameTokenOccured=true;
    }
  }
  Assert.assertTrue(mainSignatureTokenOccured);
  Assert.assertTrue(mainEncryptionTokenOccured);
  Assert.assertTrue(signedEndorsingSupportingTokenOccured);
  Assert.assertTrue(signedEndorsingEncryptedSupportingTokenOccured);
  Assert.assertTrue(supportingTokensOccured);
  Assert.assertTrue(encryptedSupportingTokensOccured);
  Assert.assertTrue(usernameTokenOccured);
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTokenIdentificationSymmetricSecurity() throws Exception {
  final List<SecurityEvent> securityEventList=generateSymmetricBindingSecurityEvents();
  Assert.assertEquals(securityEventList.size(),24);
  for (int i=0; i < securityEventList.size(); i++) {
    SecurityEvent securityEvent=securityEventList.get(i);
    if (securityEvent instanceof X509TokenSecurityEvent) {
      X509TokenSecurityEvent tokenSecurityEvent=(X509TokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),1);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_SIGNED_ENDORSING_SUPPORTING_TOKENS));
    }
 else     if (securityEvent instanceof UsernameTokenSecurityEvent) {
      UsernameTokenSecurityEvent tokenSecurityEvent=(UsernameTokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),1);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_SIGNED_ENCRYPTED_SUPPORTING_TOKENS));
    }
 else     if (securityEvent instanceof SamlTokenSecurityEvent) {
      SamlTokenSecurityEvent tokenSecurityEvent=(SamlTokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),2);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE));
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION));
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.InteroperabilityTest </h4><pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionUseReqSigCert() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
    Map<String,Object> messageContext=doOutboundSecurityWithWSS4J_1(sourceDocument,action,properties);
    Document securedDocument=(Document)messageContext.get(SECURED_DOCUMENT);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
  final List<SecurityEvent> securityEventList=new ArrayList<SecurityEvent>();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    SecurityEventListener securityEventListener=new SecurityEventListener(){
      @Override public void registerSecurityEvent(      SecurityEvent securityEvent) throws WSSecurityException {
        securityEventList.add(securityEvent);
      }
    }
;
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),new ArrayList<SecurityEvent>(),securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
  baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.TIMESTAMP);
    actions.add(WSSConstants.SIGNATURE);
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("receiver");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setUseReqSigCertForEncryption(true);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),securityEventList);
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,true);
  }
}

</code></pre>

<br>
<pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInteroperabilityInvalidSOAPActionOutbound() throws Exception {
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  securityProperties.setActor("test");
  securityProperties.setEncryptionUser("receiver");
  securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  securityProperties.setSignatureUser("transmitter");
  securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  securityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(securityProperties,sourceDocument);
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.ACTOR,"anotherTest");
  try {
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
    Assert.fail("Expected WSSecurityException");
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"WSS4JHandler: Request does not contain required Security header");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.MultipleActionTest </h4><pre class="type-8 type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDuplicateActions() throws Exception {
  WSSSecurityProperties properties=new WSSSecurityProperties();
  List<XMLSecurityConstants.Action> actions=new ArrayList<XMLSecurityConstants.Action>();
  actions.add(XMLSecurityConstants.SIGNATURE);
  properties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  properties.setSignatureUser("transmitter");
  properties.setCallbackHandler(new CallbackHandlerImpl());
  properties.setActions(actions);
  WSSec.getOutboundWSSec(properties);
  actions.add(XMLSecurityConstants.SIGNATURE);
  properties.setActions(actions);
  try {
    WSSec.getOutboundWSSec(properties);
    Assert.fail();
  }
 catch (  WSSecurityException ex) {
    Assert.assertTrue(ex.getMessage().contains("Duplicate Actions are not allowed"));
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test @org.junit.Ignore public void testTwoSignatureActions() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_c14nExcl_InclusiveNamespaces.getNamespaceURI(),WSSConstants.TAG_c14nExcl_InclusiveNamespaces.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_PrefixList.getLocalPart()),"env");
    Assert.assertEquals(((Element)nodeList.item(1)).getAttributeNS(null,WSSConstants.ATT_NULL_PrefixList.getLocalPart()),"");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.OutputChainTest </h4><pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureAction() throws Exception {
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
  actions.add(WSSConstants.SIGNATURE);
  securityProperties.setActions(actions);
  securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  securityProperties.setSignatureUser("receiver");
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
  XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
  XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
  xmlStreamWriter.close();
  Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
  NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
  Assert.assertEquals(nodeList.getLength(),1);
  Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
  Assert.assertEquals(nodeList.getLength(),1);
  Node attr=nodeList.item(0).getAttributes().getNamedItemNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
  Assert.assertNotNull(attr);
  nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
  Assert.assertEquals(nodeList.getLength(),0);
  nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
  Assert.assertEquals(nodeList.getLength(),0);
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptionAction() throws Exception {
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
  actions.add(WSSConstants.ENCRYPT);
  securityProperties.setActions(actions);
  securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  securityProperties.setEncryptionUser("receiver");
  OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
  XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
  XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
  xmlStreamWriter.close();
  Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
  NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
  Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
  Assert.assertEquals(nodeList.getLength(),1);
  Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),"Body");
  NodeList childNodes=nodeList.item(0).getParentNode().getChildNodes();
  for (int i=0; i < childNodes.getLength(); i++) {
    Node child=childNodes.item(i);
    if (child.getNodeType() == Node.TEXT_NODE) {
      Assert.assertEquals(child.getTextContent().trim(),"");
    }
 else     if (child.getNodeType() == Node.ELEMENT_NODE) {
      Assert.assertEquals(child,nodeList.item(0));
    }
 else {
      Assert.fail("Unexpected Node encountered");
    }
  }
  nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
  Assert.assertEquals(nodeList.getLength(),0);
  nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
  Assert.assertEquals(nodeList.getLength(),0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.PasswordEncryptorTest </h4><pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionCryptoPropertiesOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    Properties properties=CryptoFactory.getProperties("transmitter-crypto-enc.properties",this.getClass().getClassLoader());
    PasswordEncryptor passwordEncryptor=new JasyptPasswordEncryptor(new CallbackHandlerImpl());
    securityProperties.setEncryptionCryptoProperties(properties,passwordEncryptor);
    securityProperties.setEncryptionUser("receiver");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#aes256-cbc']");
    node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Assert.assertEquals(node.getParentNode().getParentNode().getLocalName(),"Body");
    NodeList childNodes=node.getParentNode().getParentNode().getChildNodes();
    for (int i=0; i < childNodes.getLength(); i++) {
      Node child=childNodes.item(i);
      if (child.getNodeType() == Node.TEXT_NODE) {
        Assert.assertEquals(child.getTextContent().trim(),"");
      }
 else       if (child.getNodeType() == Node.ELEMENT_NODE) {
        Assert.assertEquals(child,nodeList.item(0));
      }
 else {
        Assert.fail("Unexpected Node encountered");
      }
    }
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureCryptoPropertiesOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    Properties properties=CryptoFactory.getProperties("transmitter-crypto-enc.properties",this.getClass().getClassLoader());
    PasswordEncryptor passwordEncryptor=new JasyptPasswordEncryptor(new CallbackHandlerImpl());
    securityProperties.setSignatureCryptoProperties(properties,passwordEncryptor);
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_c14nExcl_InclusiveNamespaces.getNamespaceURI(),WSSConstants.TAG_c14nExcl_InclusiveNamespaces.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_PrefixList.getLocalPart()),"env");
    Assert.assertEquals(((Element)nodeList.item(1)).getAttributeNS(null,WSSConstants.ATT_NULL_PrefixList.getLocalPart()),"");
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.PasswordTypeTest </h4><pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPasswordDigest() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.USERNAME_TOKEN;
    Properties properties=new Properties();
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_PASSWORD.getNamespaceURI(),WSSConstants.TAG_WSSE_PASSWORD.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_Type.getLocalPart()),WSSConstants.UsernameTokenPasswordType.PASSWORD_DIGEST.getNamespace());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setUsernameTokenPasswordType(WSSConstants.UsernameTokenPasswordType.PASSWORD_DIGEST);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setUsernameTokenPasswordType(null);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setUsernameTokenPasswordType(WSSConstants.UsernameTokenPasswordType.PASSWORD_TEXT);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null);
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
      Assert.assertEquals(e.getCause().getMessage(),"The security token could not be authenticated or authorized");
      Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.FAILED_AUTHENTICATION);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPasswordText() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.USERNAME_TOKEN;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.PASSWORD_TYPE,WSConstants.PW_TEXT);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_PASSWORD.getNamespaceURI(),WSSConstants.TAG_WSSE_PASSWORD.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_Type.getLocalPart()),WSSConstants.UsernameTokenPasswordType.PASSWORD_TEXT.getNamespace());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setUsernameTokenPasswordType(WSSConstants.UsernameTokenPasswordType.PASSWORD_TEXT);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setUsernameTokenPasswordType(null);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setUsernameTokenPasswordType(WSSConstants.UsernameTokenPasswordType.PASSWORD_DIGEST);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null);
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
      Assert.assertEquals(e.getCause().getMessage(),"The security token could not be authenticated or authorized");
      Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.FAILED_AUTHENTICATION);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.PrincipalTest </h4><pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDSAKeyValue() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SIG_KEY_ID,"KeyValue");
    properties.put(WSHandlerConstants.SIGNATURE_USER,"transmitter-dsa");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.addIgnoreBSPRule(BSPRule.R5417);
    securityProperties.addIgnoreBSPRule(BSPRule.R5421);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.KeyValueToken,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    KeyValueTokenSecurityEvent event=(KeyValueTokenSecurityEvent)securityEventListener.getSecurityEvent(WSSecurityEventConstants.KeyValueToken);
    Assert.assertNotNull(event);
    KeyValueSecurityToken token=event.getSecurityToken();
    Principal principal=token.getPrincipal();
    Assert.assertTrue(principal instanceof PublicKeyPrincipal);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUsernameToken() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.USERNAME_TOKEN;
    Properties properties=new Properties();
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_PASSWORD.getNamespaceURI(),WSSConstants.TAG_WSSE_PASSWORD.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_Type.getLocalPart()),WSSConstants.UsernameTokenPasswordType.PASSWORD_DIGEST.getNamespace());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.USERNAME_TOKEN,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    UsernameTokenSecurityEvent event=(UsernameTokenSecurityEvent)securityEventListener.getSecurityEvent(WSSecurityEventConstants.USERNAME_TOKEN);
    Assert.assertNotNull(event);
    UsernameSecurityToken usernameSecurityToken=event.getSecurityToken();
    Principal principal=usernameSecurityToken.getPrincipal();
    Assert.assertTrue(principal instanceof UsernameTokenPrincipal);
    UsernameTokenPrincipal usernameTokenPrincipal=(UsernameTokenPrincipal)principal;
    Assert.assertTrue("transmitter".equals(usernameTokenPrincipal.getName()));
    Assert.assertTrue(usernameTokenPrincipal.getCreatedTime() != null);
    Assert.assertTrue(usernameTokenPrincipal.getNonce() != null);
    Assert.assertTrue(usernameTokenPrincipal.getPassword() != null);
    Assert.assertTrue(usernameTokenPrincipal.isPasswordDigest());
    Assert.assertTrue(WSSConstants.NS_PASSWORD_DIGEST.equals(usernameTokenPrincipal.getPasswordType()));
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAMLToken() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED + " " + WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{urn:oasis:names:tc:SAML:1.0:assertion}Assertion;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.SAML_TOKEN,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    SamlTokenSecurityEvent event=(SamlTokenSecurityEvent)securityEventListener.getSecurityEvent(WSSecurityEventConstants.SAML_TOKEN);
    Assert.assertNotNull(event);
    SamlSecurityToken token=event.getSecurityToken();
    Principal principal=token.getPrincipal();
    Assert.assertTrue(principal instanceof SAMLTokenPrincipal);
    Assert.assertTrue(principal.getName().contains("uid=joe"));
    Assert.assertTrue(((SAMLTokenPrincipal)principal).getToken() != null);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testECKeyValue() throws Exception {
  if ("IBM Corporation".equals(System.getProperty("java.vendor")) || System.getProperty("java.version") != null && System.getProperty("java.version").startsWith("1.8")) {
    return;
  }
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SIG_KEY_ID,"KeyValue");
    properties.put(WSHandlerConstants.SIGNATURE_USER,"transmitter-ecdsa");
    properties.put(WSHandlerConstants.SIG_ALGO,"http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha512");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.addIgnoreBSPRule(BSPRule.R5417);
    securityProperties.addIgnoreBSPRule(BSPRule.R5421);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.KeyValueToken,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    KeyValueTokenSecurityEvent event=(KeyValueTokenSecurityEvent)securityEventListener.getSecurityEvent(WSSecurityEventConstants.KeyValueToken);
    Assert.assertNotNull(event);
    KeyValueSecurityToken token=event.getSecurityToken();
    Principal principal=token.getPrincipal();
    Assert.assertTrue(principal instanceof PublicKeyPrincipal);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testX509Certificate() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.X509Token,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    X509TokenSecurityEvent event=(X509TokenSecurityEvent)securityEventListener.getSecurityEvent(WSSecurityEventConstants.X509Token);
    Assert.assertNotNull(event);
    X509SecurityToken token=event.getSecurityToken();
    Principal principal=token.getPrincipal();
    Assert.assertTrue(principal instanceof X500Principal);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRSAKeyValue() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SIG_KEY_ID,"KeyValue");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.addIgnoreBSPRule(BSPRule.R5417);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.KeyValueToken,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    KeyValueTokenSecurityEvent event=(KeyValueTokenSecurityEvent)securityEventListener.getSecurityEvent(WSSecurityEventConstants.KeyValueToken);
    Assert.assertNotNull(event);
    KeyValueSecurityToken token=event.getSecurityToken();
    Principal principal=token.getPrincipal();
    Assert.assertTrue(principal instanceof PublicKeyPrincipal);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.ReplayTest </h4><pre class="type-3 type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReplayedTimestamp() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.TIMESTAMP;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{" + WSConstants.WSU_NS + "}Timestamp;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
  ReplayCache replayCache=null;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    replayCache=securityProperties.getTimestampReplayCache();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setTimestampReplayCache(replayCache);
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Exception expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof XMLSecurityException);
      Assert.assertEquals("The message has expired",e.getCause().getMessage());
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 2 authentication assertion
 * with a OneTimeUse Element
 */
@Test public void testEhCacheReplayedSAML2OneTimeUse() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_BEARER);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    ConditionsBean conditions=new ConditionsBean();
    conditions.setTokenPeriodMinutes(5);
    conditions.setOneTimeUse(true);
    callbackHandler.setConditions(conditions);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
  ReplayCache replayCache=null;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    SamlTokenValidatorImpl validator=new SamlTokenValidatorImpl();
    validator.setRequireBearerSignature(false);
    securityProperties.addValidator(WSSConstants.TAG_SAML2_ASSERTION,validator);
    securityProperties.addValidator(WSSConstants.TAG_SAML_ASSERTION,validator);
    replayCache=securityProperties.getSamlOneTimeUseReplayCache();
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    Assert.assertNotNull(document);
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    SamlTokenValidatorImpl validator=new SamlTokenValidatorImpl();
    validator.setRequireBearerSignature(false);
    securityProperties.addValidator(WSSConstants.TAG_SAML2_ASSERTION,validator);
    securityProperties.addValidator(WSSConstants.TAG_SAML_ASSERTION,validator);
    securityProperties.setSamlOneTimeUseReplayCache(replayCache);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Exception expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof XMLSecurityException);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUsernameToken() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.USERNAME_TOKEN;
    Properties properties=new Properties();
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
  ReplayCache replayCache=null;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    replayCache=securityProperties.getNonceReplayCache();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setNonceReplayCache(replayCache);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Exception expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof XMLSecurityException);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.SignatureCRLTest </h4><pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test signing a SOAP message using a BST. Revocation is not enabled and so the test
 * should pass.
 * TODO Re-enable once CRL issue fixed
 */
@Test @org.junit.Ignore public void testSignatureDirectReference() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("wss40rev.jks"),"security".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setEnableRevocation(true);
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("wss40rev.jks"),"security".toCharArray());
    securityProperties.loadCRLCertStore(this.getClass().getClassLoader().getResource("wss40CACRL.pem"));
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected failure on a revocation check");
    }
 catch (    Exception ex) {
      Assert.assertNotNull(ex.getCause());
      Assert.assertTrue(ex.getCause() instanceof WSSecurityException);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.SignatureCertConstaintsTest </h4><pre class="type-3 type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBSTSignature() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("wss40CA.jks"),"security".toCharArray());
    String certConstraint=".*CN=Colm.*O=Apache.*";
    Pattern subjectDNPattern=Pattern.compile(certConstraint.trim());
    securityProperties.setSubjectCertConstraints(Collections.singletonList(subjectDNPattern));
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("wss40CA.jks"),"security".toCharArray());
    String certConstraint=".*CN=Colm2.*O=Apache.*";
    Pattern subjectDNPattern=Pattern.compile(certConstraint.trim());
    securityProperties.setSubjectCertConstraints(Collections.singletonList(subjectDNPattern));
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected failure on a incorrect cert constraint check");
    }
 catch (    Exception ex) {
      String errorMessage="The security token could not be authenticated or authorized";
      Assert.assertTrue(ex.getMessage().contains(errorMessage));
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBSTSignaturePKIPath() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.USE_SINGLE_CERTIFICATE,"false");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("wss40CA.jks"),"security".toCharArray());
    String certConstraint=".*CN=Colm.*O=Apache.*";
    Pattern subjectDNPattern=Pattern.compile(certConstraint.trim());
    securityProperties.setSubjectCertConstraints(Collections.singletonList(subjectDNPattern));
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("wss40CA.jks"),"security".toCharArray());
    String certConstraint=".*CN=Colm2.*O=Apache.*";
    Pattern subjectDNPattern=Pattern.compile(certConstraint.trim());
    securityProperties.setSubjectCertConstraints(Collections.singletonList(subjectDNPattern));
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected failure on a incorrect cert constraint check");
    }
 catch (    Exception ex) {
      String errorMessage="The security token could not be authenticated or authorized";
      Assert.assertTrue(ex.getMessage().contains(errorMessage));
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.SignatureConfirmationTest </h4><pre class="type-3 type-7 type-5 type-9 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@SuppressWarnings("unchecked") @Test public void testDefaultConfigurationOutbound() throws Exception {
  final List<SecurityEvent> securityEventList=new ArrayList<SecurityEvent>();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    SecurityEventListener securityEventListener=new SecurityEventListener(){
      @Override public void registerSecurityEvent(      SecurityEvent securityEvent) throws WSSecurityException {
        securityEventList.add(securityEvent);
      }
    }
;
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>(),securityEventListener);
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
  List<WSHandlerResult> wsHandlerResult;
{
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.ENABLE_SIGNATURE_CONFIRMATION,"true");
    Map<String,Object> messageContext=doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
    wsHandlerResult=(List<WSHandlerResult>)messageContext.get(WSHandlerConstants.RECV_RESULTS);
  }
  baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENABLE_SIGNATURE_CONFIRMATION + " " + WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.RECV_RESULTS,wsHandlerResult);
    Map<String,Object> messageContext=doOutboundSecurityWithWSS4J_1(sourceDocument,action,properties);
    Document securedDocument=(Document)messageContext.get(SECURED_DOCUMENT);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE11_SIG_CONF.getNamespaceURI(),WSSConstants.TAG_WSSE11_SIG_CONF.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertNotSame(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_VALUE.getLocalPart()),"");
    Assert.assertNotNull(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_WSU_ID.getLocalPart()),"");
    nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setEnableSignatureConfirmationVerification(true);
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),securityEventList);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOutboundNoSignatureConfirmation() throws Exception {
  final List<SecurityEvent> securityEventList=new ArrayList<SecurityEvent>();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    SecurityEventListener securityEventListener=new SecurityEventListener(){
      @Override public void registerSecurityEvent(      SecurityEvent securityEvent) throws WSSecurityException {
        securityEventList.add(securityEvent);
      }
    }
;
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>(),securityEventListener);
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
  baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    Map<String,Object> messageContext=doOutboundSecurityWithWSS4J_1(sourceDocument,action,properties);
    Document securedDocument=(Document)messageContext.get(SECURED_DOCUMENT);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE11_SIG_CONF.getNamespaceURI(),WSSConstants.TAG_WSSE11_SIG_CONF.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setEnableSignatureConfirmationVerification(true);
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),securityEventList);
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
      Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-9 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@SuppressWarnings("unchecked") @Test public void testDefaultConfigurationInboundUnsignedConfirmation() throws Exception {
  Set<Integer> sigv;
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.ENABLE_SIGNATURE_CONFIRMATION,"true");
    Map<String,Object> messageContext=doOutboundSecurityWithWSS4J_1(sourceDocument,action,properties);
    sigv=(Set<Integer>)messageContext.get(WSHandlerConstants.SEND_SIGV);
    Document securedDocument=(Document)messageContext.get(SECURED_DOCUMENT);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
  final List<SecurityEvent> securityEventList=new ArrayList<SecurityEvent>();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    SecurityEventListener securityEventListener=new SecurityEventListener(){
      @Override public void registerSecurityEvent(      SecurityEvent securityEvent) throws WSSecurityException {
        securityEventList.add(securityEvent);
      }
    }
;
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),new ArrayList<SecurityEvent>(),securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
  baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE_CONFIRMATION);
    securityProperties.setActions(actions);
    securityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSSE11_SIG_CONF,SecurePart.Modifier.Element));
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("receiver");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),securityEventList);
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE11_SIG_CONF.getNamespaceURI(),WSSConstants.TAG_WSSE11_SIG_CONF.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertNotSame(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_VALUE.getLocalPart()),"");
    Assert.assertNotNull(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_WSU_ID.getLocalPart()),"");
    Assert.assertTrue(((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart()).length() > 0);
  }
{
    String action="";
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SEND_SIGV,sigv);
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,true);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-9 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@SuppressWarnings("unchecked") @Test public void testDefaultConfigurationInbound() throws Exception {
  Set<Integer> sigv;
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.ENABLE_SIGNATURE_CONFIRMATION,"true");
    Map<String,Object> messageContext=doOutboundSecurityWithWSS4J_1(sourceDocument,action,properties);
    sigv=(Set<Integer>)messageContext.get(WSHandlerConstants.SEND_SIGV);
    Document securedDocument=(Document)messageContext.get(SECURED_DOCUMENT);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
  final List<SecurityEvent> securityEventList=new ArrayList<SecurityEvent>();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    SecurityEventListener securityEventListener=new SecurityEventListener(){
      @Override public void registerSecurityEvent(      SecurityEvent securityEvent) throws WSSecurityException {
        securityEventList.add(securityEvent);
      }
    }
;
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),new ArrayList<SecurityEvent>(),securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
  baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE_CONFIRMATION);
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSSE11_SIG_CONF,SecurePart.Modifier.Element));
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("receiver");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),securityEventList);
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE11_SIG_CONF.getNamespaceURI(),WSSConstants.TAG_WSSE11_SIG_CONF.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertNotSame(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_VALUE.getLocalPart()),"");
    Assert.assertNotNull(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_WSU_ID.getLocalPart()),"");
    Assert.assertTrue(((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart()).length() > 0);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SEND_SIGV,sigv);
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,true);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.SignatureTest </h4><pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureHMACOutputLengthInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_SignatureMethod.getNamespaceURI(),WSSConstants.TAG_dsig_SignatureMethod.getLocalPart());
    Element hmacElement=securedDocument.createElementNS(WSSConstants.TAG_dsig_HMACOutputLength.getNamespaceURI(),WSSConstants.TAG_dsig_HMACOutputLength.getLocalPart());
    hmacElement.setTextContent("abc");
    nodeList.item(0).appendChild(hmacElement);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Should have thrown XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
      Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierThumbprintIncludeTokenOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_THUMBPRINT_IDENTIFIER);
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    securityProperties.setIncludeSignatureToken(true);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/oasis-wss-soap-message-security-1.1#ThumbprintSHA1']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureECKeyValue() throws Exception {
  if ("IBM Corporation".equals(System.getProperty("java.vendor")) || System.getProperty("java.version") != null && System.getProperty("java.version").startsWith("1.8")) {
    return;
  }
  if (Security.getProvider("BC") == null) {
    return;
  }
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter-ecdsa");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_KeyValue);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha512");
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig11_ECKeyValue.getNamespaceURI(),WSSConstants.TAG_dsig11_ECKeyValue.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.addIgnoreBSPRule(BSPRule.R5421);
    securityProperties.addIgnoreBSPRule(BSPRule.R5417);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    Assert.assertNotNull(document);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierIssuerSerialOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_IssuerSerial);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/wsse:SecurityTokenReference/dsig:X509Data/dsig:X509IssuerSerial/dsig:X509SerialNumber");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureUsePKIPathOutbound() throws Exception {
  if (Security.getProvider("BC") == null) {
    return;
  }
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setUseSingleCert(false);
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureDSAKeyValue() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter-dsa");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_KeyValue);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setSignatureAlgorithm("http://www.w3.org/2000/09/xmldsig#dsa-sha1");
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_DSAKeyValue.getNamespaceURI(),WSSConstants.TAG_dsig_DSAKeyValue.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.addIgnoreBSPRule(BSPRule.R5421);
    securityProperties.addIgnoreBSPRule(BSPRule.R5417);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    Assert.assertNotNull(document);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierBinarySecurityTokenDirectReferenceOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/wsse:BinarySecurityToken");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierSha1Inbound() throws Exception {
  KeyGenerator keyGen=KeyGenerator.getInstance("AES");
  keyGen.init(128);
  SecretKey key=keyGen.generateKey();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    Document doc=documentBuilderFactory.newDocumentBuilder().parse(sourceDocument);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    WSSecSignature sign=new WSSecSignature();
    sign.setKeyIdentifierType(WSConstants.ENCRYPTED_KEY_SHA1_IDENTIFIER);
    sign.setSecretKey(key.getEncoded());
    sign.setSignatureAlgorithm(SignatureMethod.HMAC_SHA1);
    Document securedDocument=sign.build(doc,null,secHeader);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/" + "wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType=" + "'http://docs.oasis-open.org/wss/oasis-wss-soap-message-security-1.1#EncryptedKeySHA1']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl(key.getEncoded()));
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierThumbprintInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.SIG_KEY_ID,"Thumbprint");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/oasis-wss-soap-message-security-1.1#ThumbprintSHA1']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierX509KeyInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.SIG_KEY_ID,"X509KeyIdentifier");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierIssuerSerialInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.SIG_KEY_ID,"IssuerSerial");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/wsse:SecurityTokenReference/dsig:X509Data/dsig:X509IssuerSerial/dsig:X509SerialNumber");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierIssuerSerialIncludeTokenOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_IssuerSerial);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setIncludeSignatureToken(true);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/wsse:SecurityTokenReference/dsig:X509Data/dsig:X509IssuerSerial/dsig:X509SerialNumber");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInboundRequiredAlgorithm() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setSignatureAlgorithm(WSSConstants.NS_XMLDSIG_RSASHA1);
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setSignatureAlgorithm(WSSConstants.NS_XMLDSIG_HMACSHA1);
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    try {
      XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Failure expected on the wrong signature algorithm");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierSubjectKeyInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.SIG_KEY_ID,"SKIKeyIdentifier");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509SubjectKeyIdentifier']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExceptionOnElementToSignNotFound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://www.wrongnamespace.org","complexType"),SecurePart.Modifier.Element));
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    try {
      XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
      xmlStreamWriter.close();
      Assert.fail("Exception expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof XMLSecurityException);
      Assert.assertEquals("Part to sign not found: {http://www.wrongnamespace.org}complexType",e.getCause().getMessage());
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierSha1Outbound() throws Exception {
  KeyGenerator keyGen=KeyGenerator.getInstance("AES");
  keyGen.init(128);
  final SecretKey key=keyGen.generateKey();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.setSignatureUser("transmitter");
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_ENCRYPTED_KEY_SHA1_IDENTIFIER);
    securityProperties.setSignatureAlgorithm("http://www.w3.org/2000/09/xmldsig#hmac-sha1");
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl(key.getEncoded()){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        WSPasswordCallback pc=(WSPasswordCallback)callbacks[0];
        pc.setKey(key.getEncoded());
      }
    }
);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/" + "wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType=" + "'http://docs.oasis-open.org/wss/oasis-wss-soap-message-security-1.1#EncryptedKeySHA1']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    WSS4JCallbackHandlerImpl callbackHandler=new WSS4JCallbackHandlerImpl(key.getEncoded());
    properties.put(WSHandlerConstants.PW_CALLBACK_REF,callbackHandler);
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,true);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-7 type-5 type-9 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureC14NInclusivePartsOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://www.w3.org/1999/XMLSchema","complexType"),SecurePart.Modifier.Element));
    securityProperties.setSignatureCanonicalizationAlgorithm("http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),25);
    nodeList=document.getElementsByTagNameNS("http://www.w3.org/1999/XMLSchema","complexType");
    Assert.assertEquals(nodeList.getLength(),26);
    for (int i=0; i < nodeList.getLength(); i++) {
      String idAttrValue=((Element)nodeList.item(i)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
      if (i == 10) {
        Assert.assertSame(idAttrValue,"");
      }
 else {
        Assert.assertNotSame(idAttrValue,"");
        Assert.assertTrue(idAttrValue.length() > 0);
      }
    }
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierSubjectKeyOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_SkiKeyIdentifier);
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509SubjectKeyIdentifier']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierX509KeyOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_X509KeyIdentifier);
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierThumbprintOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_THUMBPRINT_IDENTIFIER);
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/oasis-wss-soap-message-security-1.1#ThumbprintSHA1']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureDefaultConfigurationOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_c14nExcl_InclusiveNamespaces.getNamespaceURI(),WSSConstants.TAG_c14nExcl_InclusiveNamespaces.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_PrefixList.getLocalPart()),"env");
    Assert.assertEquals(((Element)nodeList.item(1)).getAttributeNS(null,WSSConstants.ATT_NULL_PrefixList.getLocalPart()),"");
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-7 type-5 type-9 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignaturePartsOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://www.w3.org/1999/XMLSchema","complexType"),SecurePart.Modifier.Element));
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),25);
    nodeList=document.getElementsByTagNameNS("http://www.w3.org/1999/XMLSchema","complexType");
    Assert.assertEquals(nodeList.getLength(),26);
    for (int i=0; i < nodeList.getLength(); i++) {
      String idAttrValue=((Element)nodeList.item(i)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
      if (i == 10) {
        Assert.assertSame(idAttrValue,"");
      }
 else {
        Assert.assertNotSame(idAttrValue,"");
        Assert.assertTrue(idAttrValue.length() > 0);
      }
    }
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureRSAKeyValue() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_KeyValue);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_RSAKeyValue.getNamespaceURI(),WSSConstants.TAG_dsig_RSAKeyValue.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.addIgnoreBSPRule(BSPRule.R5421);
    securityProperties.addIgnoreBSPRule(BSPRule.R5417);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.KeyValueToken,WSSecurityEventConstants.SignatureValue,WSSecurityEventConstants.SIGNED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    securityEventListener.compare();
    SignedPartSecurityEvent signedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SIGNED_PART);
    SignatureValueSecurityEvent signatureValueSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SignatureValue);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String signedElementCorrelationID=signedPartSecurityEvent.getCorrelationID();
    String signatureValueCorrelationID=signatureValueSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> signedElementSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> signatureValueSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(signedElementCorrelationID)) {
        signedElementSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(signatureValueCorrelationID)) {
        signatureValueSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(3,signedElementSecurityEvents.size());
    Assert.assertEquals(4,signatureValueSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + signedElementSecurityEvents.size() + signatureValueSecurityEvents.size());
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignaturePropertiesOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    Map<String,Object> config=new HashMap<String,Object>();
    config.put(ConfigurationConstants.ACTION,ConfigurationConstants.SIGNATURE);
    config.put(ConfigurationConstants.SIGNATURE_USER,"transmitter");
    config.put(ConfigurationConstants.PW_CALLBACK_REF,new CallbackHandlerImpl());
    config.put(ConfigurationConstants.SIG_PROP_FILE,"transmitter-crypto.properties");
    WSSSecurityProperties securityProperties=ConfigurationConverter.convert(config);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_c14nExcl_InclusiveNamespaces.getNamespaceURI(),WSSConstants.TAG_c14nExcl_InclusiveNamespaces.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_PrefixList.getLocalPart()),"env");
    Assert.assertEquals(((Element)nodeList.item(1)).getAttributeNS(null,WSSConstants.ATT_NULL_PrefixList.getLocalPart()),"");
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierBinarySecurityTokenDirectReferenceInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.SIG_KEY_ID,"DirectReference");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/wsse:BinarySecurityToken");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testElementToSignNotFound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setTokenUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_WSSE10,"UsernameToken"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_SOAP11,"Body"),SecurePart.Modifier.Element));
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    try {
      XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
      xmlStreamWriter.close();
      Assert.fail("Exception expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof XMLSecurityException);
      Assert.assertEquals("Part to sign not found: {http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}UsernameToken",e.getCause().getMessage());
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureCryptoPropertiesOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    Properties properties=CryptoFactory.getProperties("transmitter-crypto.properties",this.getClass().getClassLoader());
    securityProperties.setSignatureCryptoProperties(properties);
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_c14nExcl_InclusiveNamespaces.getNamespaceURI(),WSSConstants.TAG_c14nExcl_InclusiveNamespaces.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_PrefixList.getLocalPart()),"env");
    Assert.assertEquals(((Element)nodeList.item(1)).getAttributeNS(null,WSSConstants.ATT_NULL_PrefixList.getLocalPart()),"");
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.TimestampTest </h4><pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimestampInvalidNoExpiresDateInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    for (int i=0; i < nodeList.item(0).getChildNodes().getLength(); i++) {
      Node node=nodeList.item(0).getChildNodes().item(i);
      if (node.getNodeType() == Node.ELEMENT_NODE && node.getLocalName().equals("Expires")) {
        node.getParentNode().removeChild(node);
      }
    }
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setRequireTimestampExpires(true);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      fail("Failure expected on no Expires Element");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    }
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimestampTTLOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.TIMESTAMP);
    securityProperties.setActions(actions);
    securityProperties.setTimestampTTL(3600);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    Element created=(Element)((Element)nodeList.item(0)).getElementsByTagNameNS(WSSConstants.TAG_WSU_CREATED.getNamespaceURI(),WSSConstants.TAG_WSU_CREATED.getLocalPart()).item(0);
    Element expires=(Element)((Element)nodeList.item(0)).getElementsByTagNameNS(WSSConstants.TAG_WSU_EXPIRES.getNamespaceURI(),WSSConstants.TAG_WSU_EXPIRES.getLocalPart()).item(0);
    DatatypeFactory datatypeFactory=DatatypeFactory.newInstance();
    GregorianCalendar gregorianCalendarCreated=datatypeFactory.newXMLGregorianCalendar(created.getTextContent()).toGregorianCalendar();
    GregorianCalendar gregorianCalendarExpires=datatypeFactory.newXMLGregorianCalendar(expires.getTextContent()).toGregorianCalendar();
    Assert.assertTrue(gregorianCalendarCreated.before(gregorianCalendarExpires));
    GregorianCalendar now=new GregorianCalendar();
    Assert.assertFalse(now.before(gregorianCalendarCreated));
    Assert.assertTrue(now.before(gregorianCalendarExpires));
    gregorianCalendarCreated.add(Calendar.SECOND,3601);
    Assert.assertTrue(gregorianCalendarCreated.after(gregorianCalendarExpires));
  }
{
    String action=WSHandlerConstants.TIMESTAMP;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimestampNoChildsInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    List<Node> nodesToRemove=new ArrayList<Node>();
    for (int i=0; i < nodeList.item(0).getChildNodes().getLength(); i++) {
      Node node=nodeList.item(0).getChildNodes().item(i);
      if (node.getNodeType() == Node.ELEMENT_NODE && (node.getLocalName().equals("Created")) || node.getLocalName().equals("Expires")) {
        nodesToRemove.add(node);
      }
    }
    for (int i=0; i < nodesToRemove.size(); i++) {
      Node node=nodesToRemove.get(i);
      node.getParentNode().removeChild(node);
    }
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.addIgnoreBSPRule(BSPRule.R3203);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Throwable throwable=e.getCause();
      Assert.assertNotNull(throwable);
      Assert.assertTrue(throwable instanceof WSSecurityException);
      Assert.assertEquals(((WSSecurityException)throwable).getFaultCode(),WSSecurityException.INVALID_SECURITY);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimestampInFutureInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP;
    Properties outboundProperties=new Properties();
    outboundProperties.setProperty(WSHandlerConstants.TTL_TIMESTAMP,"1");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,outboundProperties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    Element created=(Element)((Element)nodeList.item(0)).getElementsByTagNameNS(WSSConstants.TAG_WSU_CREATED.getNamespaceURI(),WSSConstants.TAG_WSU_CREATED.getLocalPart()).item(0);
    Element expires=(Element)((Element)nodeList.item(0)).getElementsByTagNameNS(WSSConstants.TAG_WSU_EXPIRES.getNamespaceURI(),WSSConstants.TAG_WSU_EXPIRES.getLocalPart()).item(0);
    DatatypeFactory datatypeFactory=DatatypeFactory.newInstance();
    GregorianCalendar gregorianCalendarCreated=new GregorianCalendar();
    gregorianCalendarCreated.add(Calendar.HOUR,2);
    XMLGregorianCalendar xmlGregorianCalendarCreated=datatypeFactory.newXMLGregorianCalendar(gregorianCalendarCreated);
    created.setTextContent(xmlGregorianCalendarCreated.toXMLFormat());
    GregorianCalendar gregorianCalendarExpires=new GregorianCalendar();
    gregorianCalendarExpires.add(Calendar.HOUR,2);
    gregorianCalendarExpires.add(Calendar.SECOND,300);
    XMLGregorianCalendar xmlGregorianCalendarExpires=datatypeFactory.newXMLGregorianCalendar(gregorianCalendarExpires);
    expires.setTextContent(xmlGregorianCalendarExpires.toXMLFormat());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
      Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.MESSAGE_EXPIRED);
    }
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setTimeStampFutureTTL(2 * 60 * 60 + 100);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDoubleTimestamp() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    Node parentNode=nodeList.item(0).getParentNode();
    Node node=nodeList.item(0).cloneNode(true);
    securedDocument.adoptNode(node);
    parentNode.appendChild(node);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Throwable throwable=e.getCause();
      Assert.assertNotNull(throwable);
      Assert.assertTrue(throwable instanceof WSSecurityException);
      Assert.assertEquals(((WSSecurityException)throwable).getFaultCode(),WSSecurityException.INVALID_SECURITY);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimestampDefaultConfigurationOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.TIMESTAMP);
    securityProperties.setActions(actions);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    Element created=(Element)((Element)nodeList.item(0)).getElementsByTagNameNS(WSSConstants.TAG_WSU_CREATED.getNamespaceURI(),WSSConstants.TAG_WSU_CREATED.getLocalPart()).item(0);
    Element expires=(Element)((Element)nodeList.item(0)).getElementsByTagNameNS(WSSConstants.TAG_WSU_EXPIRES.getNamespaceURI(),WSSConstants.TAG_WSU_EXPIRES.getLocalPart()).item(0);
    DatatypeFactory datatypeFactory=DatatypeFactory.newInstance();
    GregorianCalendar gregorianCalendarCreated=datatypeFactory.newXMLGregorianCalendar(created.getTextContent()).toGregorianCalendar();
    GregorianCalendar gregorianCalendarExpires=datatypeFactory.newXMLGregorianCalendar(expires.getTextContent()).toGregorianCalendar();
    Assert.assertTrue(gregorianCalendarCreated.before(gregorianCalendarExpires));
    GregorianCalendar now=new GregorianCalendar();
    Assert.assertFalse(now.before(gregorianCalendarCreated));
    Assert.assertTrue(now.before(gregorianCalendarExpires));
    gregorianCalendarCreated.add(Calendar.SECOND,301);
    Assert.assertTrue(gregorianCalendarCreated.after(gregorianCalendarExpires));
  }
{
    String action=WSHandlerConstants.TIMESTAMP;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimestampNoCreatedDateInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    for (int i=0; i < nodeList.item(0).getChildNodes().getLength(); i++) {
      Node node=nodeList.item(0).getChildNodes().item(i);
      if (node.getNodeType() == Node.ELEMENT_NODE && node.getLocalName().equals("Created")) {
        node.getParentNode().removeChild(node);
      }
    }
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.addIgnoreBSPRule(BSPRule.R3203);
    securityProperties.addIgnoreBSPRule(BSPRule.R3221);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Throwable throwable=e.getCause();
      Assert.assertNotNull(throwable);
      Assert.assertTrue(throwable instanceof WSSecurityException);
      Assert.assertEquals(((WSSecurityException)throwable).getFaultCode(),WSSecurityException.INVALID_SECURITY);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimestampTTLInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP;
    Properties outboundProperties=new Properties();
    outboundProperties.setProperty(WSHandlerConstants.TTL_TIMESTAMP,"300");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,outboundProperties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
  Thread.sleep(1500);
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setTimestampTTL(1);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
      Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.MESSAGE_EXPIRED);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimestampPropertiesOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    Map<String,Object> config=new HashMap<String,Object>();
    config.put(ConfigurationConstants.ACTION,ConfigurationConstants.TIMESTAMP);
    WSSSecurityProperties securityProperties=ConfigurationConverter.convert(config);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    Element created=(Element)((Element)nodeList.item(0)).getElementsByTagNameNS(WSSConstants.TAG_WSU_CREATED.getNamespaceURI(),WSSConstants.TAG_WSU_CREATED.getLocalPart()).item(0);
    Element expires=(Element)((Element)nodeList.item(0)).getElementsByTagNameNS(WSSConstants.TAG_WSU_EXPIRES.getNamespaceURI(),WSSConstants.TAG_WSU_EXPIRES.getLocalPart()).item(0);
    DatatypeFactory datatypeFactory=DatatypeFactory.newInstance();
    GregorianCalendar gregorianCalendarCreated=datatypeFactory.newXMLGregorianCalendar(created.getTextContent()).toGregorianCalendar();
    GregorianCalendar gregorianCalendarExpires=datatypeFactory.newXMLGregorianCalendar(expires.getTextContent()).toGregorianCalendar();
    Assert.assertTrue(gregorianCalendarCreated.before(gregorianCalendarExpires));
    GregorianCalendar now=new GregorianCalendar();
    Assert.assertFalse(now.before(gregorianCalendarCreated));
    Assert.assertTrue(now.before(gregorianCalendarExpires));
    gregorianCalendarCreated.add(Calendar.SECOND,301);
    Assert.assertTrue(gregorianCalendarCreated.after(gregorianCalendarExpires));
  }
{
    String action=WSHandlerConstants.TIMESTAMP;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimestampExpiredEncryptedInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.ENCRYPT;
    Properties outboundProperties=new Properties();
    outboundProperties.setProperty(WSHandlerConstants.TTL_TIMESTAMP,"1");
    outboundProperties.setProperty(WSHandlerConstants.ENCRYPTION_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,outboundProperties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
  Thread.sleep(1500);
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
      Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.MESSAGE_EXPIRED);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimestampExpiredInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP;
    Properties outboundProperties=new Properties();
    outboundProperties.setProperty(WSHandlerConstants.TTL_TIMESTAMP,"1");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,outboundProperties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
  Thread.sleep(1500);
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
      Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.MESSAGE_EXPIRED);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.UsernameTokenTest </h4><pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOutboundSign() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.USERNAMETOKEN_SIGNED);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setTokenUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_PASSWORD.getNamespaceURI(),WSSConstants.TAG_WSSE_PASSWORD.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.USERNAME_TOKEN_SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing an "old" UsernameToken, i.e. one with a "Created" element that is
 * out of date
 */
@Test public void testOldUsernameToken() throws Exception {
  GregorianCalendar createdCalendar=new GregorianCalendar();
  createdCalendar.add(Calendar.SECOND,-301);
  XMLGregorianCalendar created=WSSConstants.datatypeFactory.newXMLGregorianCalendar(createdCalendar);
  String createdString=created.toXMLFormat();
  String digest=org.apache.wss4j.dom.message.token.UsernameToken.doPasswordDigest("Ex2YEKVvsa1qne1m6TM8XA==",createdString,"default");
  String req="<?xml version=\"1.0\" encoding=\"UTF_8\"?>" + "<env:Envelope xmlns:env=\"http://schemas.xmlsoap.org/soap/envelope/\">\n" + "    <env:Header>"+ "       <wsse:Security xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\" xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" env:mustUnderstand=\"1\">"+ "           <wsse:UsernameToken wsu:Id=\"UsernameToken-1\">"+ "               <wsse:Username>transmitter</wsse:Username>"+ "               <wsse:Password Type=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordDigest\">" + digest + "</wsse:Password>"+ "               <wsse:Nonce EncodingType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary\">Ex2YEKVvsa1qne1m6TM8XA==</wsse:Nonce>"+ "               <wsu:Created>"+ createdString+ "</wsu:Created>"+ "           </wsse:UsernameToken>"+ "       </wsse:Security>\n"+ "    </env:Header>\n"+ "    <env:Body>\n"+ "    </env:Body>\n"+ "</env:Envelope>";
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
  try {
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(req.getBytes())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.MESSAGE_EXPIRED);
  }
}

</code></pre>

<br>
<pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReusedNonce() throws Exception {
  XMLGregorianCalendar created=WSSConstants.datatypeFactory.newXMLGregorianCalendar(new GregorianCalendar());
  String createdString=created.toXMLFormat();
  String digest=org.apache.wss4j.dom.message.token.UsernameToken.doPasswordDigest("Ex2YESUvsa1qne1m6TM8XA==",createdString,"default");
  String req="<?xml version=\"1.0\" encoding=\"UTF_8\"?>" + "<env:Envelope xmlns:env=\"http://schemas.xmlsoap.org/soap/envelope/\">\n" + "    <env:Header>"+ "       <wsse:Security xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\" xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" env:mustUnderstand=\"1\">"+ "           <wsse:UsernameToken wsu:Id=\"UsernameToken-1\">"+ "               <wsse:Username>transmitter</wsse:Username>"+ "               <wsse:Password Type=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordDigest\">" + digest + "</wsse:Password>"+ "               <wsse:Nonce EncodingType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary\">Ex2YESUvsa1qne1m6TM8XA==</wsse:Nonce>"+ "               <wsu:Created>"+ createdString+ "</wsu:Created>"+ "           </wsse:UsernameToken>"+ "       </wsse:Security>\n"+ "    </env:Header>\n"+ "    <env:Body>\n"+ "    </env:Body>\n"+ "</env:Envelope>";
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
  XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(req.getBytes())));
  StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  try {
    xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(req.getBytes())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<br>
<pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing a UsernameToken where the "Created" element is in the future.
 * A UsernameToken that is 120 seconds in the future should be rejected by default.
 */
@Test public void testFutureCreated() throws Exception {
  GregorianCalendar createdCalendar=new GregorianCalendar();
  createdCalendar.add(Calendar.SECOND,120);
  XMLGregorianCalendar created=WSSConstants.datatypeFactory.newXMLGregorianCalendar(createdCalendar);
  String createdString=created.toXMLFormat();
  String digest=org.apache.wss4j.dom.message.token.UsernameToken.doPasswordDigest("Ex2YEKVvsa1Qne1m6TM8XA==",createdString,"default");
  String req="<?xml version=\"1.0\" encoding=\"UTF_8\"?>" + "<env:Envelope xmlns:env=\"http://schemas.xmlsoap.org/soap/envelope/\">\n" + "    <env:Header>"+ "       <wsse:Security xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\" xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" env:mustUnderstand=\"1\">"+ "           <wsse:UsernameToken wsu:Id=\"UsernameToken-1\">"+ "               <wsse:Username>transmitter</wsse:Username>"+ "               <wsse:Password Type=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordDigest\">" + digest + "</wsse:Password>"+ "               <wsse:Nonce EncodingType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary\">Ex2YEKVvsa1Qne1m6TM8XA==</wsse:Nonce>"+ "               <wsu:Created>"+ createdString+ "</wsu:Created>"+ "           </wsse:UsernameToken>"+ "       </wsse:Security>\n"+ "    </env:Header>\n"+ "    <env:Body>\n"+ "    </env:Body>\n"+ "</env:Envelope>";
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
  try {
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(req.getBytes())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.MESSAGE_EXPIRED);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWrongUsername() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.USERNAME_TOKEN;
    Properties properties=new Properties();
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl("wrongUsername"));
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
      Assert.assertEquals(e.getCause().getMessage(),"The security token could not be authenticated or authorized");
      Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.FAILED_AUTHENTICATION);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInboundOutboundPW_NONE() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.USERNAMETOKEN);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setTokenUser("transmitter");
    securityProperties.setUsernameTokenPasswordType(WSSConstants.UsernameTokenPasswordType.PASSWORD_NONE);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document securedDocument=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_PASSWORD.getNamespaceURI(),WSSConstants.TAG_WSSE_PASSWORD.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
  try {
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.FAILED_AUTHENTICATION);
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setAllowUsernameTokenNoPassword(true);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInboundPW_TEXT() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.USERNAME_TOKEN;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.PASSWORD_TYPE,WSConstants.PW_TEXT);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_PASSWORD.getNamespaceURI(),WSSConstants.TAG_WSSE_PASSWORD.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_Type.getLocalPart()),WSSConstants.UsernameTokenPasswordType.PASSWORD_TEXT.getNamespace());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl("username"));
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    SecurityEventListener securityEventListener=new SecurityEventListener(){
      @Override public void registerSecurityEvent(      SecurityEvent securityEvent) throws WSSecurityException {
        if (securityEvent instanceof UsernameTokenSecurityEvent) {
          UsernameTokenSecurityEvent usernameTokenSecurityEvent=(UsernameTokenSecurityEvent)securityEvent;
          if (!"username".equals(usernameTokenSecurityEvent.getSecurityToken().getPrincipal().getName())) {
            throw new WSSecurityException(WSSecurityException.ErrorCode.FAILURE,"empty",new Object[]{"Wrong username"});
          }
        }
      }
    }
;
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),new ArrayList<SecurityEvent>(),securityEventListener);
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.FAILED_AUTHENTICATION);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.VulnerabliltyVectorsTest </h4><pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test if the RSA 1.5 key transport algorithm will be rejected by default.
 * Standard key transport algorithm is RSA-OAEP
 */
@Test public void testDisallowRSA15Algorithm() throws Exception {
  WSSSecurityProperties outboundSecurityProperties=new WSSSecurityProperties();
  outboundSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outboundSecurityProperties.setEncryptionUser("receiver");
  outboundSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outboundSecurityProperties.setSignatureUser("transmitter");
  outboundSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outboundSecurityProperties.setEncryptionKeyTransportAlgorithm("http://www.w3.org/2001/04/xmlenc#rsa-1_5");
  List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outboundSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outboundSecurityProperties,sourceDocument);
  WSSSecurityProperties inboundsecurityProperties=new WSSSecurityProperties();
  inboundsecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inboundsecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inboundsecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inboundsecurityProperties.addIgnoreBSPRule(BSPRule.R5421);
  try {
    doInboundSecurity(inboundsecurityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.FAILED_CHECK);
  }
}

</code></pre>

<br>
<pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMaximumAllowedXMLStructureDepthInEncryptedContent() throws Exception {
  if (getJavaSpecificationVersion() >= 1.7) {
    System.out.println("testAllowMD5Algorithm skipped");
    return;
  }
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  int oldval=0;
  try {
    Init.init(WSSec.class.getClassLoader().getResource("wss/wss-config.xml").toURI(),WSSec.class);
    oldval=changeValueOfMaximumAllowedXMLStructureDepth(10);
    doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertEquals(e.getCause().getMessage(),"Maximum depth (10) of the XML structure reached. You can raise the maximum via the " + "\"MaximumAllowedXMLStructureDepth\" property in the configuration.");
  }
 finally {
    changeValueOfMaximumAllowedXMLStructureDepth(oldval);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMaximumAllowedReferencesPerManifest() throws Exception {
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://www.w3.org/1999/XMLSchema}complexType;{Element}{http://www.w3.org/1999/XMLSchema}simpleType;");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  try {
    doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests if the framework is vulnerable to recursive key references
 * @throws Exception
 */
@Test public void testRecursiveKeyReferencesDOS() throws Exception {
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey");
  Element encryptedKeyElement=(Element)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
  encryptedKeyElement.removeAttribute("Id");
  encryptedKeyElement.setAttributeNS(null,"Id","G2");
  xPathExpression=getXPath(".//dsig:X509Data");
  Element keyIdentifierElement=(Element)xPathExpression.evaluate(encryptedKeyElement,XPathConstants.NODE);
  Element securityTokenReferenceElement=(Element)keyIdentifierElement.getParentNode();
  securityTokenReferenceElement.removeChild(keyIdentifierElement);
  Element referenceElement=securedDocument.createElementNS(WSSConstants.TAG_WSSE_REFERENCE.getNamespaceURI(),WSSConstants.TAG_WSSE_REFERENCE.getLocalPart());
  referenceElement.setAttributeNS(null,"URI","#G1");
  securityTokenReferenceElement.appendChild(referenceElement);
  Element clonedEncryptedElement=(Element)encryptedKeyElement.cloneNode(true);
  clonedEncryptedElement.removeAttribute("Id");
  clonedEncryptedElement.setAttributeNS(null,"Id","G1");
  xPathExpression=getXPath(".//wsse:Reference");
  Element newReferenceElement=(Element)xPathExpression.evaluate(clonedEncryptedElement,XPathConstants.NODE);
  newReferenceElement.removeAttribute("URI");
  newReferenceElement.setAttributeNS(null,"URI","#G2");
  Element securityHeaderNode=(Element)encryptedKeyElement.getParentNode();
  securityHeaderNode.insertBefore(clonedEncryptedElement,encryptedKeyElement);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  try {
    doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Throwable throwable=e.getCause();
    Assert.assertNotNull(throwable);
    Assert.assertEquals(throwable.getMessage(),"Recursive key reference detected.");
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testModifiedEncryptedKeyCipherValue() throws Exception {
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  NodeList cipherValues=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_xenc_CipherValue.getNamespaceURI(),WSSConstants.TAG_xenc_CipherValue.getLocalPart());
  Element cipherValueElement=(Element)cipherValues.item(0);
  Assert.assertEquals(cipherValueElement.getParentNode().getParentNode().getLocalName(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
  String cipherValue=cipherValueElement.getTextContent();
  StringBuilder stringBuilder=new StringBuilder(cipherValue);
  int index=stringBuilder.length() / 2;
  char ch=stringBuilder.charAt(index);
  if (ch != 'A') {
    ch='A';
  }
 else {
    ch='B';
  }
  stringBuilder.setCharAt(index,ch);
  cipherValueElement.setTextContent(stringBuilder.toString());
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties inboundsecurityProperties=new WSSSecurityProperties();
  inboundsecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inboundsecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inboundsecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  try {
    doInboundSecurity(inboundsecurityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertFalse(e.getMessage().contains("data hash wrong"));
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Since we don't support (yet) external URI refs this shouldn't be a problem.
 * <p/>
 * @throws Exception
 */
@Test public void test_publicURIReferenceDOS() throws Exception {
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  properties.setProperty(WSHandlerConstants.ENC_SYM_ALGO,"http://www.w3.org/2001/04/xmlenc#aes256-cbc");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  XPathExpression xPathExpression=getXPath("//@URI");
  Attr uri=(Attr)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
  uri.setNodeValue("http://www.kernel.org/pub/linux/kernel/v2.6/linux-2.6.23.tar.gz");
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.addIgnoreBSPRule(BSPRule.R3006);
  try {
    doInboundSecurity(inSecurityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Throwable throwable=e.getCause();
    Assert.assertNotNull(throwable);
    Assert.assertTrue(throwable.getMessage().contains("Invalid digest of reference "));
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDisallowMD5Algorithm() throws Exception {
  WSSSecurityProperties outboundSecurityProperties=new WSSSecurityProperties();
  outboundSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outboundSecurityProperties.setEncryptionUser("receiver");
  outboundSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outboundSecurityProperties.setSignatureUser("transmitter");
  outboundSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outboundSecurityProperties.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-md5");
  List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outboundSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outboundSecurityProperties,sourceDocument);
  WSSSecurityProperties inboundsecurityProperties=new WSSSecurityProperties();
  inboundsecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inboundsecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inboundsecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inboundsecurityProperties.addIgnoreBSPRule(BSPRule.R5421);
  try {
    doInboundSecurity(inboundsecurityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.FAILED_CHECK);
  }
}

</code></pre>

<br>
<pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMaximumAllowedXMLStructureDepth() throws Exception {
  if (getJavaSpecificationVersion() >= 1.7) {
    System.out.println("testAllowMD5Algorithm skipped");
    return;
  }
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  int oldval=0;
  try {
    Init.init(WSSec.class.getClassLoader().getResource("wss/wss-config.xml").toURI(),WSSec.class);
    oldval=changeValueOfMaximumAllowedXMLStructureDepth(10);
    doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertEquals(e.getCause().getMessage(),"Maximum depth (10) of the XML structure reached. You can raise the maximum via the " + "\"MaximumAllowedXMLStructureDepth\" property in the configuration.");
  }
 finally {
    changeValueOfMaximumAllowedXMLStructureDepth(oldval);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMaximumAllowedTransformsPerReference() throws Exception {
  if (getJavaSpecificationVersion() > 1.7) {
    System.out.println("testMaximumAllowedTransformsPerReference skipped");
    return;
  }
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  int oldval=0;
  try {
    Init.init(WSSec.class.getClassLoader().getResource("wss/wss-config.xml").toURI(),WSSec.class);
    oldval=changeValueOfMaximumAllowedTransformsPerReference(0);
    doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
 finally {
    changeValueOfMaximumAllowedTransformsPerReference(oldval);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReplayAttackInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    try {
      xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.MESSAGE_EXPIRED);
    }
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test @SuppressWarnings("unchecked") public void testMaximumAllowedDecompressedBytes() throws Exception {
  long oldval=0;
  try {
    Init.init(WSSec.class.getClassLoader().getResource("wss/wss-config.xml").toURI(),WSSec.class);
    Field algorithmsClassMapField=TransformerAlgorithmMapper.class.getDeclaredField("algorithmsClassMapOut");
    algorithmsClassMapField.setAccessible(true);
    Map<String,Class<?>> map=(Map<String,Class<?>>)algorithmsClassMapField.get(null);
    map.put("http://www.apache.org/2012/04/xmlsec/xz",XZCompressorOutputStream.class);
    algorithmsClassMapField=TransformerAlgorithmMapper.class.getDeclaredField("algorithmsClassMapIn");
    algorithmsClassMapField.setAccessible(true);
    map=(Map<String,Class<?>>)algorithmsClassMapField.get(null);
    map.put("http://www.apache.org/2012/04/xmlsec/xz",XZCompressorInputStream.class);
    oldval=changeValueOfMaximumAllowedDecompressedBytes(101L);
    WSSSecurityProperties outboundSecurityProperties=new WSSSecurityProperties();
    outboundSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
    outboundSecurityProperties.setEncryptionUser("receiver");
    outboundSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    outboundSecurityProperties.setSignatureUser("transmitter");
    outboundSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.TIMESTAMP);
    actions.add(WSSConstants.SIGNATURE);
    actions.add(WSSConstants.ENCRYPT);
    outboundSecurityProperties.setActions(actions);
    outboundSecurityProperties.setEncryptionCompressionAlgorithm("http://www.apache.org/2012/04/xmlsec/xz");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    ByteArrayOutputStream baos=doOutboundSecurity(outboundSecurityProperties,sourceDocument);
    WSSSecurityProperties inboundSecurityProperties=new WSSSecurityProperties();
    inboundSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
    inboundSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    inboundSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    doInboundSecurity(inboundSecurityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof IOException);
    Assert.assertEquals(e.getCause().getMessage(),"Maximum byte count (101) reached.");
  }
 finally {
    changeValueOfMaximumAllowedDecompressedBytes(oldval);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.XOPAttachmentTest </h4><pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptedSOAPBody() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  List<Attachment> attachments=createEncryptedBodyInAttachment(doc);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(doc),new StreamResult(baos));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(attachments);
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList sigReferences=document.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
    Assert.assertEquals(2,sigReferences.getLength());
  }
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.saml.SAMLTokenNegativeTest </h4><pre class="type-3 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML2SignedKeyHolderKeyModifiedInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    NodeList list=securedDocument.getElementsByTagNameNS(WSConstants.SAML2_NS,"Assertion");
    Element assertionElement=(Element)list.item(0);
    assertionElement.setAttributeNS(null,"MinorVersion","5");
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("XMLStreamException expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertNotNull(e.getCause().getCause());
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML1SignedKeyHolderSigModifiedInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIG_KEY_ID,"DirectReference");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Element envelope=securedDocument.getDocumentElement();
    NodeList list=envelope.getElementsByTagNameNS(WSConstants.SAML_NS,"Assertion");
    Element assertionElement=(Element)list.item(0);
    list=assertionElement.getElementsByTagNameNS(WSConstants.SIG_NS,"Signature");
    Element sigElement=(Element)list.item(0);
    list=sigElement.getElementsByTagNameNS(WSConstants.SIG_NS,"Transform");
    Element transformElement=(Element)list.item(0);
    transformElement.setAttributeNS(null,"Algorithm",WSConstants.C14N_EXCL_OMIT_COMMENTS);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("saml/issuer.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("XMLStreamException expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertNotNull(e.getCause().getCause());
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML2TrustFailureInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIG_KEY_ID,"DirectReference");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("XMLStreamException expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML2AuthnAssertionModifiedInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
    callbackHandler.setIssuer("www.example.com");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIG_KEY_ID,"DirectReference");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    NodeList list=securedDocument.getElementsByTagNameNS(WSConstants.SAML2_NS,"Assertion");
    Element assertionElement=(Element)list.item(0);
    assertionElement.setAttributeNS(null,"MinorVersion","5");
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("saml/issuer.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("XMLStreamException expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertNotNull(e.getCause().getCause());
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHOKNotSignedInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("saml/issuer.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("XMLStreamException expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.saml.SAMLTokenSVTest </h4><pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML2AuthnAssertionOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_SIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setSamlVersion(Version.SAML_20);
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    securityProperties.setSamlCallbackHandler(callbackHandler);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML1AuthnAssertionOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_SIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_SENDER_VOUCHES);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    securityProperties.setSamlCallbackHandler(callbackHandler);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML1AttrAssertionOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_SIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.ATTR);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_SENDER_VOUCHES);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    securityProperties.setSamlCallbackHandler(callbackHandler);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML2AttrAssertionOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_SIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setSamlVersion(Version.SAML_20);
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.ATTR);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    securityProperties.setSamlCallbackHandler(callbackHandler);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML1AuthnAssertionSignedOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_SIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_SENDER_VOUCHES);
    callbackHandler.setIssuer("www.example.com");
    securityProperties.setSamlCallbackHandler(callbackHandler);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_X509KeyIdentifier);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),3);
    String referenceId=((Element)nodeList.item(1)).getAttributeNode(WSSConstants.ATT_NULL_URI.getLocalPart()).getValue();
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_SECURITY_TOKEN_REFERENCE.getNamespaceURI(),WSSConstants.TAG_WSSE_SECURITY_TOKEN_REFERENCE.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    String tokenId=((Element)nodeList.item(0)).getAttributeNodeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart()).getValue();
    Assert.assertEquals(tokenId,WSSUtils.dropReferenceMarker(referenceId));
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.saml.SAMLTokenTest </h4><pre class="type-3 type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUnsignedBearer() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_BEARER);
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED + " " + WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{urn:oasis:names:tc:SAML:2.0:assertion}Assertion;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSamlCallbackHandler(new SAMLCallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      fail("Failure expected on an unsigned bearer token");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof XMLSecurityException);
    }
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSamlCallbackHandler(new SAMLCallbackHandlerImpl());
    SamlTokenValidatorImpl validator=new SamlTokenValidatorImpl();
    validator.setRequireBearerSignature(false);
    securityProperties.addValidator(WSSConstants.TAG_SAML2_ASSERTION,validator);
    securityProperties.addValidator(WSSConstants.TAG_SAML_ASSERTION,validator);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testStandardSubjectConfirmationMethod() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setConfirmationMethod("urn:oasis:names:tc:SAML:2.0:cm:custom");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED + " " + WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{urn:oasis:names:tc:SAML:2.0:assertion}Assertion;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSamlCallbackHandler(new SAMLCallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      fail("Failure expected on an unknown subject confirmation method");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof XMLSecurityException);
    }
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSamlCallbackHandler(new SAMLCallbackHandlerImpl());
    SamlTokenValidatorImpl validator=new SamlTokenValidatorImpl();
    validator.setRequireStandardSubjectConfirmationMethod(false);
    securityProperties.addValidator(WSSConstants.TAG_SAML2_ASSERTION,validator);
    securityProperties.addValidator(WSSConstants.TAG_SAML_ASSERTION,validator);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRequiredSubjectConfirmationMethod() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED + " " + WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{urn:oasis:names:tc:SAML:2.0:assertion}Assertion;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSamlCallbackHandler(new SAMLCallbackHandlerImpl());
    SamlTokenValidatorImpl validator=new SamlTokenValidatorImpl();
    validator.setRequiredSubjectConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
    securityProperties.addValidator(WSSConstants.TAG_SAML2_ASSERTION,validator);
    securityProperties.addValidator(WSSConstants.TAG_SAML_ASSERTION,validator);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
  baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_BEARER);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED + " " + WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{urn:oasis:names:tc:SAML:2.0:assertion}Assertion;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSamlCallbackHandler(new SAMLCallbackHandlerImpl());
    SamlTokenValidatorImpl validator=new SamlTokenValidatorImpl();
    validator.setRequiredSubjectConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
    securityProperties.addValidator(WSSConstants.TAG_SAML2_ASSERTION,validator);
    securityProperties.addValidator(WSSConstants.TAG_SAML_ASSERTION,validator);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      fail("Failure expected on a Bearer assertion");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof XMLSecurityException);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 2 authentication assertion, which
 * is encrypted in a saml2:EncryptedAssertion Element in the security header
 */
@Test public void testSAML2EncryptedAssertion() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  Crypto crypto=CryptoFactory.getInstance("wss40.properties");
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    SAMLCallback samlCallback=new SAMLCallback();
    SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
    SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
    WSSecSAMLToken wsSign=new WSSecSAMLToken();
    Document doc=SOAPUtil.toSOAPPart(sourceDocument);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    wsSign.prepare(doc,samlAssertion);
    Element assertionElement=wsSign.getElement();
    Element encryptedAssertionElement=doc.createElementNS(WSConstants.SAML2_NS,WSConstants.ENCRYPED_ASSERTION_LN);
    encryptedAssertionElement.appendChild(assertionElement);
    secHeader.getSecurityHeader().appendChild(encryptedAssertionElement);
    KeyGenerator keygen=KeyGenerator.getInstance("AES");
    keygen.init(128);
    SecretKey secretKey=keygen.generateKey();
    CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
    cryptoType.setAlias("wss40");
    X509Certificate[] certs=crypto.getX509Certificates(cryptoType);
    assertTrue(certs != null && certs.length > 0 && certs[0] != null);
    encryptElement(doc,assertionElement,WSConstants.AES_128,secretKey,WSConstants.KEYTRANSPORT_RSAOEP,certs[0],false);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setDecryptionCrypto(crypto);
    securityProperties.setCallbackHandler(new KeystoreCallbackHandler());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_SAML2_ASSERTION.getNamespaceURI(),WSSConstants.TAG_SAML2_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.saml.SamlConditionsTest </h4><pre class="type-8 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 2 authentication assertion
 * with an (invalid) custom Conditions statement.
 */
@Test public void testSAML2InvalidBeforeConditionsInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    ConditionsBean conditions=new ConditionsBean();
    DateTime notBefore=new DateTime();
    conditions.setNotBefore(notBefore.plusMinutes(2));
    conditions.setNotAfter(notBefore.plusMinutes(5));
    callbackHandler.setConditions(conditions);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("XMLStreamException expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML1AudienceRestrictionSeparateRestrictionsValidation() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    ConditionsBean conditions=new ConditionsBean();
    conditions.setTokenPeriodMinutes(5);
    List<AudienceRestrictionBean> audiencesRestrictions=new ArrayList<AudienceRestrictionBean>();
    AudienceRestrictionBean audienceRestrictionBean=new AudienceRestrictionBean();
    audienceRestrictionBean.setAudienceURIs(Collections.singletonList("http://apache.org/one"));
    audiencesRestrictions.add(audienceRestrictionBean);
    audienceRestrictionBean=new AudienceRestrictionBean();
    audienceRestrictionBean.setAudienceURIs(Collections.singletonList("http://apache.org/two"));
    audiencesRestrictions.add(audienceRestrictionBean);
    conditions.setAudienceRestrictions(audiencesRestrictions);
    callbackHandler.setConditions(conditions);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
  List<String> audiences=new ArrayList<String>();
  audiences.add("http://apache.org/three");
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setAudienceRestrictions(audiences);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("XMLStreamException expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
    }
  }
  audiences.add("http://apache.org/one");
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setAudienceRestrictions(audiences);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    Assert.assertNotNull(document);
  }
}

</code></pre>

<br>
<pre class="type-8 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML2FutureNotBefore() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    ConditionsBean conditions=new ConditionsBean();
    DateTime notBefore=new DateTime();
    conditions.setNotAfter(new DateTime().plusMinutes(70));
    conditions.setNotBefore(notBefore.plusMinutes(60));
    callbackHandler.setConditions(conditions);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("XMLStreamException expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 1.1 authentication assertion
 * with a custom Conditions statement.
 */
@Test public void testSAML1ConditionsInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    ConditionsBean conditions=new ConditionsBean();
    DateTime notBefore=new DateTime();
    conditions.setNotBefore(notBefore);
    DateTime notAfter=notBefore.plusMinutes(20);
    conditions.setNotAfter(notAfter);
    callbackHandler.setConditions(conditions);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS("urn:oasis:names:tc:SAML:1.0:assertion","Conditions");
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,"NotBefore"),SAMLConfigurationSupport.getSAMLDateFormatter().print(notBefore));
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,"NotOnOrAfter"),SAMLConfigurationSupport.getSAMLDateFormatter().print(notAfter));
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    Assert.assertNotNull(document);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML1AudienceRestrictionValidation() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  List<String> audiences=new ArrayList<String>();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    ConditionsBean conditions=new ConditionsBean();
    conditions.setTokenPeriodMinutes(5);
    audiences.add("http://apache.org/one");
    audiences.add("http://apache.org/two");
    AudienceRestrictionBean audienceRestrictionBean=new AudienceRestrictionBean();
    audienceRestrictionBean.setAudienceURIs(audiences);
    conditions.setAudienceRestrictions(Collections.singletonList(audienceRestrictionBean));
    callbackHandler.setConditions(conditions);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
  audiences.clear();
  audiences.add("http://apache.org/three");
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setAudienceRestrictions(audiences);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("XMLStreamException expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
    }
  }
  audiences.add("http://apache.org/one");
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setAudienceRestrictions(audiences);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    Assert.assertNotNull(document);
  }
}

</code></pre>

<br>
<pre class="type-8 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML2StaleNotOnOrAfter() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    ConditionsBean conditions=new ConditionsBean();
    DateTime notBefore=new DateTime();
    conditions.setNotAfter(notBefore.minusMinutes(60));
    conditions.setNotBefore(notBefore.minusMinutes(70));
    callbackHandler.setConditions(conditions);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("XMLStreamException expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML2AudienceRestrictionValidation() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  List<String> audiences=new ArrayList<String>();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    ConditionsBean conditions=new ConditionsBean();
    conditions.setTokenPeriodMinutes(5);
    audiences.add("http://apache.org/one");
    audiences.add("http://apache.org/two");
    AudienceRestrictionBean audienceRestrictionBean=new AudienceRestrictionBean();
    audienceRestrictionBean.setAudienceURIs(audiences);
    conditions.setAudienceRestrictions(Collections.singletonList(audienceRestrictionBean));
    callbackHandler.setConditions(conditions);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
  audiences.clear();
  audiences.add("http://apache.org/three");
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setAudienceRestrictions(audiences);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("XMLStreamException expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
    }
  }
  audiences.add("http://apache.org/one");
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setAudienceRestrictions(audiences);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    Assert.assertNotNull(document);
  }
}

</code></pre>

<br>
<pre class="type-8 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 2 authentication assertion
 * with an (invalid) custom Conditions statement.
 */
@Test public void testSAML2InvalidAfterConditionsInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    ConditionsBean conditions=new ConditionsBean();
    DateTime notBefore=new DateTime();
    conditions.setNotBefore(notBefore.minusMinutes(5));
    conditions.setNotAfter(notBefore.minusMinutes(3));
    callbackHandler.setConditions(conditions);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("XMLStreamException expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
    }
  }
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
