<h3><span class=" glyphicon glyphicon-tag"/>&nbspEqualityVerifier</h3><kbd>Verifies whether objects/variable are equal to an expected value </kbd><br><br><br><h4 style="margin:0px">Class: org.apache.wss4j.common.attachment.AttachmentTest </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMimeHeaderDecodeRfc2184_2() throws Exception {
  Assert.assertEquals("message/external-body;access-type=\"URL\";" + "url=\"ftp://cs.utk.edu/pub/moore/bulk-mailer/bulk-mailer.tar\"",AttachmentUtils.decodeRfc2184("Message/External-Body; access-type=URL;" + "URL*0=\"ftp://\";" + "URL*1=\"cs.utk.edu/pub/moore/bulk-mailer/bulk-mailer.tar\""));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMimeHeaderUnfoldWS_2() throws Exception {
  Assert.assertEquals("",AttachmentUtils.unfoldWhitespace(""));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMimeHeaderUnquoteInnerText_1() throws Exception {
  Assert.assertEquals("\"\\\"\\\"\\\\A\"",AttachmentUtils.unquoteInnerText("\\\"\"\"\\\\\\A\\\""));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMimeHeaderUnfold_6() throws Exception {
  Assert.assertEquals("aaa",AttachmentUtils.unfold("a\r\n\taa"));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMimeHeaderUnfold_8() throws Exception {
  Assert.assertEquals("a",AttachmentUtils.unfold("\r\n\ta\r\n "));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMimeHeaderUnfold_4() throws Exception {
  Assert.assertEquals("",AttachmentUtils.unfold("\r\n\t"));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMimeHeaderUnfold_2() throws Exception {
  Assert.assertEquals("\r\na",AttachmentUtils.unfold("\r\na"));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMimeHeaderUnfoldWS_4() throws Exception {
  Assert.assertEquals("a\ta\t  a",AttachmentUtils.unfoldWhitespace(" \t a\ta\t  a"));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMimeHeaderUncomment_3() throws Exception {
  Assert.assertEquals("\"a\" \"(\"b\")\" test",AttachmentUtils.uncomment("\"a\" \"(\"b\")\" (c(\"d\"))test"));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMimeHeaderUncomment_1() throws Exception {
  Assert.assertEquals("\"a\" \"(b)\" c  test",AttachmentUtils.uncomment("\"a\" \"(b)\" c ((\"d\")) test"));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMimeHeaderDecodeRfc2184_3() throws Exception {
  Assert.assertEquals("application/x-stuff;" + "title=\"This is ***fun***\"",AttachmentUtils.decodeRfc2184("application/x-stuff;" + "title*=us-ascii'en-us'This%20is%20%2A%2A%2Afun%2A%2A%2A"));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMimeHeaderDecodeRfc2184_1() throws Exception {
  Assert.assertEquals("message/external-body;access-type=\"URL\";" + "test=\"true\";" + "url=\"ftp://cs.utk.edu/pub/moore/bulk-mailer/bulk-mailer.tar\"",AttachmentUtils.decodeRfc2184("Message/External-Body; access-type=URL;" + "URL*0=\"ftp://\";" + "URL*1=\"cs.utk.edu/pub/moore/bulk-mailer/bulk-mailer.tar\";"+ "test=true"));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMimeHeaderUnfoldWS_1() throws Exception {
  Assert.assertEquals("a ",AttachmentUtils.unfoldWhitespace(" a "));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMimeHeaderUnfold_9() throws Exception {
  Assert.assertEquals("\r\n\ra",AttachmentUtils.unfold("\r\n\ra\r\n "));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMimeHeaderUnfold_7() throws Exception {
  Assert.assertEquals("aaaa",AttachmentUtils.unfold("\r\n\taaaa"));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMimeHeaderUnquoteInnerText_2() throws Exception {
  Assert.assertEquals("\"a\"",AttachmentUtils.unquoteInnerText("\\\"a\\\""));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMimeHeaderUnfold_10() throws Exception {
  Assert.assertEquals("\r\n",AttachmentUtils.unfold("\r\n \r\n \r\n"));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMimeHeaderUnfold_5() throws Exception {
  Assert.assertEquals("aa",AttachmentUtils.unfold("a\r\n\ta"));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMimeHeaderUnfold_3() throws Exception {
  Assert.assertEquals("",AttachmentUtils.unfold("\r\n "));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMimeHeaderUnfoldWS_3() throws Exception {
  Assert.assertEquals("",AttachmentUtils.unfoldWhitespace(" \t \t\t  "));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMimeHeaderUnfold_1() throws Exception {
  Assert.assertEquals("\r\n",AttachmentUtils.unfold("\r\n"));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMimeHeaderDecodeRfc2184_4() throws Exception {
  Assert.assertEquals("application/x-stuff;" + "title=\"This is even more ***fun*** isn't it!\"",AttachmentUtils.decodeRfc2184("application/x-stuff;" + "title*1*=us-ascii'en'This%20is%20even%20more%20;" + "title*2*=%2A%2A%2Afun%2A%2A%2A%20;"+ "title*3=\"isn't it!\""));
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMimeHeaderUncomment_2() throws Exception {
  Assert.assertEquals("",AttachmentUtils.uncomment("(\"a\" \"(b)\" c ((\"d\")) test)"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.common.attachment.CRLFOutputStreamTest </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testBytePerByte() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  CRLFOutputStream crlfOutputStream=new CRLFOutputStream(baos);
  crlfOutputStream.write('\n');
  crlfOutputStream.write('\r');
  crlfOutputStream.write('\r');
  crlfOutputStream.write('\n');
  crlfOutputStream.write('\n');
  crlfOutputStream.write('\n');
  crlfOutputStream.write('\r');
  crlfOutputStream.write('\r');
  crlfOutputStream.write('\r');
  crlfOutputStream.write('a');
  crlfOutputStream.write('\n');
  crlfOutputStream.write('\r');
  crlfOutputStream.write('\n');
  crlfOutputStream.write('a');
  crlfOutputStream.write('a');
  crlfOutputStream.write('a');
  crlfOutputStream.close();
  Assert.assertArrayEquals("\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\na\r\n\r\naaa".getBytes(),baos.toByteArray());
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testBytes1() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  CRLFOutputStream crlfOutputStream=new CRLFOutputStream(baos);
  crlfOutputStream.write("aaaaaaaaaa".getBytes());
  crlfOutputStream.close();
  Assert.assertArrayEquals("aaaaaaaaaa".getBytes(),baos.toByteArray());
}

</code></pre>

<br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testBytes() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  CRLFOutputStream crlfOutputStream=new CRLFOutputStream(baos);
  crlfOutputStream.write("\n\r\r\n\n\n\r\r\ra\n\r\naaa".getBytes());
  crlfOutputStream.close();
  Assert.assertArrayEquals("\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\na\r\n\r\naaa".getBytes(),baos.toByteArray());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.common.cache.EHCacheManagerHolderTest </h4><pre class="type-3 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCacheNames(){
  CacheManager cacheManager=EHCacheManagerHolder.getCacheManager("testCache2",EHCacheManagerHolder.class.getResource("/test-ehcache2.xml"));
  String key="org.apache.wss4j.TokenStore";
  CacheConfiguration cacheConfig=EHCacheManagerHolder.getCacheConfiguration(key,cacheManager);
  assertEquals(3600,cacheConfig.getTimeToIdleSeconds());
  key="org.apache.wss4j.TokenStore-{http://ws.apache.org}wss4j";
  CacheConfiguration cacheConfig2=EHCacheManagerHolder.getCacheConfiguration(key,cacheManager);
  assertEquals(360000,cacheConfig2.getTimeToIdleSeconds());
  key="org.apache.wss4j.TokenStore-{http://ws.apache.org}wss4junknown";
  CacheConfiguration cacheConfig3=EHCacheManagerHolder.getCacheConfiguration(key,cacheManager);
  assertEquals(3600,cacheConfig3.getTimeToIdleSeconds());
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateCacheManager(){
  Configuration conf=ConfigurationFactory.parseConfiguration(EHCacheManagerHolder.class.getResource("/test-ehcache.xml"));
  assertNotNull(conf);
  conf.setName("testCache");
  CacheManager manager1=EHCacheManagerHolder.createCacheManager(conf);
  assertNotNull(manager1);
  CacheManager manager2=EHCacheManagerHolder.createCacheManager();
  assertNotNull(manager2);
  manager1.shutdown();
  assertEquals(Status.STATUS_SHUTDOWN,manager1.getStatus());
  assertEquals(Status.STATUS_ALIVE,manager2.getStatus());
  manager2.shutdown();
  assertEquals(Status.STATUS_SHUTDOWN,manager2.getStatus());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.common.crypto.PasswordEncryptorTest </h4><pre class="type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testStrongJasyptPasswordEncryptor() throws Exception {
  PasswordEncryptor passwordEncryptor=new JasyptPasswordEncryptor("master-password");
  String encryptedPassword=passwordEncryptor.encrypt("password");
  assertNotEquals(encryptedPassword,"password");
  String decryptedPassword=passwordEncryptor.decrypt(encryptedPassword);
  assertEquals(decryptedPassword,"password");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.handler.CustomActionProcessorTest </h4><pre class="type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test to see that a custom action object configured through a
 * WSSConfig instance is called
 */
@Test public void testCustomActionObject() throws Exception {
  final WSSConfig cfg=WSSConfig.getNewInstance();
  final int action=0xDEADF000;
  cfg.setAction(action,CustomAction.class);
  final RequestData reqData=new RequestData();
  reqData.setWssConfig(cfg);
  final Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  CustomHandler handler=new CustomHandler();
  reqData.setMsgContext("bread");
  assertEquals(reqData.getMsgContext(),"bread");
  handler.send(doc,reqData,Collections.singletonList(new HandlerAction(action)),true);
  assertEquals(reqData.getMsgContext(),"crumb");
}

</code></pre>

<br>
<pre class="type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test to see that a custom action configured through a
 * WSSConfig instance is called
 */
@Test public void testCustomAction() throws Exception {
  final WSSConfig cfg=WSSConfig.getNewInstance();
  final int action=0xDEADF000;
  cfg.setAction(action,CustomAction.class);
  final RequestData reqData=new RequestData();
  reqData.setWssConfig(cfg);
  final Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  CustomHandler handler=new CustomHandler();
  reqData.setMsgContext("bread");
  assertEquals(reqData.getMsgContext(),"bread");
  handler.send(doc,reqData,Collections.singletonList(new HandlerAction(action)),true);
  assertEquals(reqData.getMsgContext(),"crumb");
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test to see that a custom action can be configured via WSSecurityUtil.decodeAction.
 * A standard Timestamp action is also configured.
 */
@Test public void testDecodeCustomAction() throws Exception {
  final WSSConfig cfg=WSSConfig.getNewInstance();
  final int customAction=0xDEADF000;
  String actionString=WSHandlerConstants.TIMESTAMP + " " + Integer.valueOf(customAction).toString();
  try {
    WSSecurityUtil.decodeHandlerAction(actionString,cfg);
    fail("Failure expected on unknown action");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
  try {
    String badActionString=WSHandlerConstants.TIMESTAMP + " " + "NewCustomAction";
    WSSecurityUtil.decodeHandlerAction(badActionString,cfg);
    fail("Failure expected on unknown action");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILURE);
  }
  cfg.setAction(customAction,CustomAction.class);
  List<HandlerAction> actionList=WSSecurityUtil.decodeHandlerAction(actionString,cfg);
  final RequestData reqData=new RequestData();
  reqData.setWssConfig(cfg);
  final Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  CustomHandler handler=new CustomHandler();
  reqData.setMsgContext("bread");
  assertEquals(reqData.getMsgContext(),"bread");
  handler.send(doc,reqData,actionList,true);
  assertEquals(reqData.getMsgContext(),"crumb");
  if (LOG.isDebugEnabled()) {
    LOG.debug("Message:");
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.AttachmentTest </h4><pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidXMLAttachmentContentSignature() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  builder.getParts().add(new WSEncryptionPart("cid:Attachments","Content"));
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  builder.setAttachmentCallbackHandler(attachmentCallbackHandler);
  LOG.info("Before Signing....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("After Signing....");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  try {
    verify(signedDoc,new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          if (!attachment.getId().equals(attachmentRequestCallback.getAttachmentId())) {
            throw new RuntimeException("wrong attachment requested");
          }
          List<Attachment> attachments=new ArrayList<>();
          attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.replace("15","16").getBytes(StandardCharsets.UTF_8)));
          attachments.add(attachment);
          attachmentRequestCallback.setAttachments(attachments);
        }
      }
    }
);
    Assert.fail();
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"The signature or decryption was invalid");
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentCompleteSignature() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  builder.getParts().add(new WSEncryptionPart("cid:Attachments","Element"));
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  builder.setAttachmentCallbackHandler(attachmentCallbackHandler);
  LOG.info("Before Signing....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("After Signing....");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  NodeList sigReferences=signedDoc.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
  Assert.assertEquals(2,sigReferences.getLength());
  attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  verify(signedDoc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentContentEncryptionExternalReferenceList() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(new WSEncryptionPart("cid:Attachments","Content"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  encrypt.setAttachmentCallbackHandler(attachmentCallbackHandler);
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  encrypt.prepare(doc,crypto);
  Element refs=encrypt.encrypt();
  encrypt.addAttachmentEncryptedDataElements(secHeader);
  encrypt.addExternalRefElement(refs,secHeader);
  encrypt.prependToHeader(secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  NodeList references=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"DataReference");
  Assert.assertEquals(2,references.getLength());
  NodeList cipherReferences=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"CipherReference");
  Assert.assertEquals(1,cipherReferences.getLength());
  NodeList encDatas=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"EncryptedData");
  Assert.assertEquals(2,encDatas.getLength());
  NodeList securityHeaderElement=doc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
  Assert.assertEquals(1,securityHeaderElement.getLength());
  NodeList childs=securityHeaderElement.item(0).getChildNodes();
  Assert.assertEquals(3,childs.getLength());
  Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
  Assert.assertEquals(childs.item(1).getLocalName(),"ReferenceList");
  Assert.assertEquals(childs.item(2).getLocalName(),"EncryptedData");
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
  verify(doc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> attHeaders=responseAttachment.getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentCompleteEncryption() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(new WSEncryptionPart("cid:Attachments","Element"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  encrypt.setAttachmentCallbackHandler(attachmentCallbackHandler);
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  Assert.assertEquals(1,encryptedAttachments.get(0).getHeaders().size());
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
  verify(encryptedDoc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> attHeaders=responseAttachment.getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultipleAttachmentCompleteEncryption() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(new WSEncryptionPart("cid:Attachments","Element"));
  final String attachment1Id=UUID.randomUUID().toString();
  final Attachment[] attachment=new Attachment[2];
  attachment[0]=new Attachment();
  attachment[0].setMimeType("text/xml");
  attachment[0].addHeaders(getHeaders(attachment1Id));
  attachment[0].setId(attachment1Id);
  attachment[0].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  final String attachment2Id=UUID.randomUUID().toString();
  attachment[1]=new Attachment();
  attachment[1].setMimeType("text/plain");
  attachment[1].addHeaders(getHeaders(attachment2Id));
  attachment[1].setId(attachment2Id);
  attachment[1].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Arrays.asList(attachment));
  encrypt.setAttachmentCallbackHandler(attachmentCallbackHandler);
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
  verify(encryptedDoc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachment1Bytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachment1Bytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> att1Headers=responseAttachment.getHeaders();
  Assert.assertEquals(6,att1Headers.size());
  responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(1);
  byte[] attachment2Bytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachment2Bytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/plain",responseAttachment.getMimeType());
  Map<String,String> att2Headers=responseAttachment.getHeaders();
  Assert.assertEquals(6,att2Headers.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidXMLAttachmentCompleteEncryption() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(new WSEncryptionPart("cid:Attachments","Element"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  encrypt.setAttachmentCallbackHandler(attachmentCallbackHandler);
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  try {
    final PushbackInputStream pis=new PushbackInputStream(encryptedAttachments.get(0).getSourceStream(),1);
    pis.unread('K');
    encryptedAttachments.get(0).setSourceStream(pis);
    attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
    verify(encryptedDoc,attachmentCallbackHandler);
  }
 catch (  WSSecurityException e) {
    return;
  }
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertFalse(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentContentSignature() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  builder.getParts().add(new WSEncryptionPart("cid:Attachments","Content"));
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  builder.setAttachmentCallbackHandler(attachmentCallbackHandler);
  LOG.info("Before Signing....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("After Signing....");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  NodeList sigReferences=signedDoc.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
  Assert.assertEquals(2,sigReferences.getLength());
  attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  verify(signedDoc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
}

</code></pre>

<br>
<pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidXMLAttachmentCmplSignCmplEnc() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecSignature signature=new WSSecSignature();
  signature.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  signature.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  signature.getParts().add(new WSEncryptionPart("cid:Attachments","Element"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment[] attachment=new Attachment[1];
  attachment[0]=new Attachment();
  attachment[0].setMimeType("text/xml");
  attachment[0].addHeaders(getHeaders(attachmentId));
  attachment[0].setId(attachmentId);
  attachment[0].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  signature.setAttachmentCallbackHandler(new CallbackHandler(){
    @Override public void handle(    Callback[] callbacks) throws IOException, UnsupportedCallbackException {
      if (callbacks[0] instanceof AttachmentRequestCallback) {
        AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
        List<Attachment> attachments=new ArrayList<>();
        attachments.add(attachment[0]);
        attachmentRequestCallback.setAttachments(attachments);
      }
 else {
        AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
        attachment[0]=attachmentResultCallback.getAttachment();
      }
    }
  }
);
  doc=signature.build(doc,crypto,secHeader);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  encrypt.getParts().addAll(signature.getParts());
  encrypt.setAttachmentCallbackHandler(new CallbackHandler(){
    @Override public void handle(    Callback[] callbacks) throws IOException, UnsupportedCallbackException {
      if (callbacks[0] instanceof AttachmentRequestCallback) {
        AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
        List<Attachment> attachments=new ArrayList<>();
        attachments.add(attachment[0]);
        attachmentRequestCallback.setAttachments(attachments);
      }
 else {
        AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
        attachment[0]=attachmentResultCallback.getAttachment();
      }
    }
  }
);
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  try {
    verify(encryptedDoc,new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          if (!attachment[0].getId().equals(attachmentRequestCallback.getAttachmentId())) {
            throw new RuntimeException("wrong attachment requested");
          }
          List<Attachment> attachments=new ArrayList<>();
          attachments.add(attachment[0]);
          if (attachment[0].getHeaders().size() == 6) {
            attachment[0].addHeader(AttachmentUtils.MIME_HEADER_CONTENT_DESCRIPTION,"Kaputt");
          }
          attachmentRequestCallback.setAttachments(attachments);
        }
 else {
          AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
          attachment[0]=attachmentResultCallback.getAttachment();
        }
      }
    }
);
    Assert.fail();
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"The signature or decryption was invalid");
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentCmplSignCmplEnc() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecSignature signature=new WSSecSignature();
  signature.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  signature.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  signature.getParts().add(new WSEncryptionPart("cid:Attachments","Element"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  signature.setAttachmentCallbackHandler(attachmentCallbackHandler);
  doc=signature.build(doc,crypto,secHeader);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  encrypt.getParts().addAll(signature.getParts());
  attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  encrypt.setAttachmentCallbackHandler(attachmentCallbackHandler);
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  NodeList securityHeaderElement=doc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
  Assert.assertEquals(1,securityHeaderElement.getLength());
  NodeList childs=securityHeaderElement.item(0).getChildNodes();
  Assert.assertEquals(3,childs.getLength());
  Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
  Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedData");
  Assert.assertEquals(childs.item(2).getLocalName(),"Signature");
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
  verify(encryptedDoc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(1);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> attHeaders=responseAttachment.getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentContentEncryptionGCM() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  encrypt.setSymmetricEncAlgorithm(WSConstants.AES_128_GCM);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(new WSEncryptionPart("cid:Attachments","Content"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  encrypt.setAttachmentCallbackHandler(attachmentCallbackHandler);
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  NodeList references=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"DataReference");
  Assert.assertEquals(2,references.getLength());
  NodeList cipherReferences=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"CipherReference");
  Assert.assertEquals(1,cipherReferences.getLength());
  NodeList encDatas=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"EncryptedData");
  Assert.assertEquals(2,encDatas.getLength());
  NodeList securityHeaderElement=doc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
  Assert.assertEquals(1,securityHeaderElement.getLength());
  NodeList childs=securityHeaderElement.item(0).getChildNodes();
  Assert.assertEquals(2,childs.getLength());
  Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
  Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedData");
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
  verify(encryptedDoc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> attHeaders=responseAttachment.getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentContentEncryption() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(new WSEncryptionPart("cid:Attachments","Content"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  encrypt.setAttachmentCallbackHandler(attachmentCallbackHandler);
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  NodeList references=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"DataReference");
  Assert.assertEquals(2,references.getLength());
  NodeList cipherReferences=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"CipherReference");
  Assert.assertEquals(1,cipherReferences.getLength());
  NodeList encDatas=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"EncryptedData");
  Assert.assertEquals(2,encDatas.getLength());
  NodeList securityHeaderElement=doc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
  Assert.assertEquals(1,securityHeaderElement.getLength());
  NodeList childs=securityHeaderElement.item(0).getChildNodes();
  Assert.assertEquals(2,childs.getLength());
  Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
  Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedData");
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
  verify(encryptedDoc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> attHeaders=responseAttachment.getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultipleAttachmentCompleteSignature() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  builder.getParts().add(new WSEncryptionPart("cid:Attachments","Element"));
  final String attachment1Id=UUID.randomUUID().toString();
  final Attachment[] attachment=new Attachment[2];
  attachment[0]=new Attachment();
  attachment[0].setMimeType("text/xml");
  attachment[0].addHeaders(getHeaders(attachment1Id));
  attachment[0].setId(attachment1Id);
  attachment[0].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  final String attachment2Id=UUID.randomUUID().toString();
  attachment[1]=new Attachment();
  attachment[1].setMimeType("text/plain");
  attachment[1].addHeaders(getHeaders(attachment2Id));
  attachment[1].setId(attachment2Id);
  attachment[1].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Arrays.asList(attachment));
  builder.setAttachmentCallbackHandler(attachmentCallbackHandler);
  LOG.info("Before Signing....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("After Signing....");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  NodeList sigReferences=signedDoc.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
  Assert.assertEquals(3,sigReferences.getLength());
  attachmentCallbackHandler=new AttachmentCallbackHandler(Arrays.asList(attachment));
  verify(signedDoc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachment1Bytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachment1Bytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(1);
  byte[] attachment2Bytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachment2Bytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/plain",responseAttachment.getMimeType());
}

</code></pre>

<br>
<pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidXMLAttachmentCmplEncCmplSign() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(new WSEncryptionPart("cid:Attachments","Element"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment[] attachment=new Attachment[1];
  attachment[0]=new Attachment();
  attachment[0].setMimeType("text/xml");
  attachment[0].addHeaders(getHeaders(attachmentId));
  attachment[0].setId(attachmentId);
  attachment[0].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  encrypt.setAttachmentCallbackHandler(new CallbackHandler(){
    @Override public void handle(    Callback[] callbacks) throws IOException, UnsupportedCallbackException {
      if (callbacks[0] instanceof AttachmentRequestCallback) {
        AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
        List<Attachment> attachments=new ArrayList<>();
        attachments.add(attachment[0]);
        attachmentRequestCallback.setAttachments(attachments);
      }
 else {
        AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
        attachment[0]=attachmentResultCallback.getAttachment();
      }
    }
  }
);
  doc=encrypt.build(doc,crypto,secHeader);
  WSSecSignature signature=new WSSecSignature();
  signature.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  signature.getParts().addAll(encrypt.getParts());
  signature.setAttachmentCallbackHandler(new CallbackHandler(){
    @Override public void handle(    Callback[] callbacks) throws IOException, UnsupportedCallbackException {
      if (callbacks[0] instanceof AttachmentRequestCallback) {
        AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
        List<Attachment> attachments=new ArrayList<>();
        attachments.add(attachment[0]);
        attachmentRequestCallback.setAttachments(attachments);
      }
 else {
        AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
        attachment[0]=attachmentResultCallback.getAttachment();
      }
    }
  }
);
  doc=signature.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  final PushbackInputStream pis=new PushbackInputStream(attachment[0].getSourceStream(),1);
  pis.unread('K');
  attachment[0].setSourceStream(pis);
  try {
    verify(doc,new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          if (!attachment[0].getId().equals(attachmentRequestCallback.getAttachmentId())) {
            throw new RuntimeException("wrong attachment requested");
          }
          List<Attachment> attachmentList=new ArrayList<>();
          attachmentList.add(attachment[0]);
          attachmentRequestCallback.setAttachments(attachmentList);
        }
 else {
          AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
          attachment[0]=attachmentResultCallback.getAttachment();
        }
      }
    }
);
    Assert.fail();
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"The signature or decryption was invalid");
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentCmplEncCmplSign() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(new WSEncryptionPart("cid:Attachments","Element"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  encrypt.setAttachmentCallbackHandler(attachmentCallbackHandler);
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  doc=encrypt.build(doc,crypto,secHeader);
  WSSecSignature signature=new WSSecSignature();
  signature.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  signature.getParts().addAll(encrypt.getParts());
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
  signature.setAttachmentCallbackHandler(attachmentCallbackHandler);
  encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  doc=signature.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  NodeList securityHeaderElement=doc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
  Assert.assertEquals(1,securityHeaderElement.getLength());
  NodeList childs=securityHeaderElement.item(0).getChildNodes();
  Assert.assertEquals(3,childs.getLength());
  Assert.assertEquals(childs.item(0).getLocalName(),"Signature");
  Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedKey");
  Assert.assertEquals(childs.item(2).getLocalName(),"EncryptedData");
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
  verify(doc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(1);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> attHeaders=responseAttachment.getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentContentEncryptionNoReference() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(new WSEncryptionPart("cid:Attachments","Content"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  encrypt.setAttachmentCallbackHandler(attachmentCallbackHandler);
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  encrypt.prepare(doc,crypto);
  encrypt.encrypt();
  encrypt.addAttachmentEncryptedDataElements(secHeader);
  encrypt.prependToHeader(secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(doc);
    LOG.debug(outputString);
  }
  NodeList references=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"DataReference");
  Assert.assertEquals(0,references.getLength());
  NodeList cipherReferences=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"CipherReference");
  Assert.assertEquals(1,cipherReferences.getLength());
  NodeList encDatas=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"EncryptedData");
  Assert.assertEquals(2,encDatas.getLength());
  NodeList securityHeaderElement=doc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
  Assert.assertEquals(1,securityHeaderElement.getLength());
  NodeList childs=securityHeaderElement.item(0).getChildNodes();
  Assert.assertEquals(2,childs.getLength());
  Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
  Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedData");
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
  verify(doc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> attHeaders=responseAttachment.getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidXMLAttachmentContentEncryption() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(new WSEncryptionPart("cid:Attachments","Content"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  encrypt.setAttachmentCallbackHandler(attachmentCallbackHandler);
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  final PushbackInputStream pis=new PushbackInputStream(encryptedAttachments.get(0).getSourceStream(),1);
  pis.unread('K');
  encryptedAttachments.get(0).setSourceStream(pis);
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
  verify(encryptedDoc,attachmentCallbackHandler);
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  try {
    byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
    Assert.assertFalse(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
    Assert.assertEquals("text/xml",responseAttachment.getMimeType());
    Map<String,String> attHeaders=responseAttachment.getHeaders();
    Assert.assertEquals(6,attHeaders.size());
  }
 catch (  IOException ex) {
  }
}

</code></pre>

<br>
<pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidXMLAttachmentCompleteSignature() throws Exception {
  WSSecSignature builder=new WSSecSignature();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  builder.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  builder.getParts().add(new WSEncryptionPart("cid:Attachments","Element"));
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  builder.setAttachmentCallbackHandler(attachmentCallbackHandler);
  LOG.info("Before Signing....");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=builder.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("After Signing....");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  try {
    attachment.addHeader(AttachmentUtils.MIME_HEADER_CONTENT_DESCRIPTION,"Kaputt");
    verify(signedDoc,new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          if (!attachment.getId().equals(attachmentRequestCallback.getAttachmentId())) {
            throw new RuntimeException("wrong attachment requested");
          }
          List<Attachment> attachments=new ArrayList<>();
          attachments.add(attachment);
          attachmentRequestCallback.setAttachments(attachments);
        }
      }
    }
);
    Assert.fail();
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"The signature or decryption was invalid");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.EncryptionPartsTest </h4><pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test encrypting a custom SOAP header using wsse11:EncryptedHeader
 */
@SuppressWarnings("unchecked") @Test public void testSOAPEncryptedHeader() throws Exception {
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  Document doc=SOAPUtil.toSOAPPart(SOAPMSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart encP=new WSEncryptionPart("foobar","urn:foo.bar","Header");
  encrypt.getParts().add(encP);
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains("wsse11:EncryptedHeader"));
  assertFalse(outputString.contains("foo:foobar"));
  WSHandlerResult results=verify(encryptedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertEquals(WSConstants.KEYTRANSPORT_RSAOEP,actionResult.get(WSSecurityEngineResult.TAG_ENCRYPTED_KEY_TRANSPORT_METHOD));
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/soapenv:Envelope/soapenv:Header/foo:foobar",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test getting a DOM Element from WSEncryptionPart directly
 */
@Test public void testEncryptionPartDOMElement() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPMSG);
  SOAPConstants soapConstants=WSSecurityUtil.getSOAPConstants(doc.getDocumentElement());
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart encP=new WSEncryptionPart("Incorrect Localname","Incorrect N/S","");
  Element bodyElement=WSSecurityUtil.findBodyElement(doc);
  assertTrue(bodyElement != null && "Body".equals(bodyElement.getLocalName()));
  encP.setElement(bodyElement);
  encrypt.getParts().add(encP);
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  assertTrue(!outputString.contains("testMethod"));
  WSHandlerResult results=verify(encryptedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  @SuppressWarnings("unchecked") final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  WSDataRef wsDataRef=refs.get(0);
  QName bodyName=new QName(soapConstants.getEnvelopeURI(),"Body");
  assertEquals(bodyName,wsDataRef.getName());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test encrypting a custom SOAP header using wsse11:EncryptedHeader
 */
@SuppressWarnings("unchecked") @Test public void testSOAPEncryptedHeaderWithAttributes() throws Exception {
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  Document doc=SOAPUtil.toSOAPPart(SOAPMSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart encP=new WSEncryptionPart("with-attributes","urn:foo.bar","Header");
  encrypt.getParts().add(encP);
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains("wsse11:EncryptedHeader"));
  assertFalse(outputString.contains("foo:with-attributes"));
  WSHandlerResult results=verify(encryptedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertEquals(WSConstants.KEYTRANSPORT_RSAOEP,actionResult.get(WSSecurityEngineResult.TAG_ENCRYPTED_KEY_TRANSPORT_METHOD));
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/soapenv:Envelope/soapenv:Header/foo:with-attributes",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test encrypting a custom SOAP header
 */
@SuppressWarnings("unchecked") @Test public void testSOAPHeader() throws Exception {
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  Document doc=SOAPUtil.toSOAPPart(SOAPMSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart encP=new WSEncryptionPart("foobar","urn:foo.bar","");
  encrypt.getParts().add(encP);
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(encryptedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertEquals(WSConstants.KEYTRANSPORT_RSAOEP,actionResult.get(WSSecurityEngineResult.TAG_ENCRYPTED_KEY_TRANSPORT_METHOD));
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/soapenv:Envelope/soapenv:Header/foo:foobar",xpath);
  assertEquals(WSConstants.AES_128,wsDataRef.getAlgorithm());
  QName expectedQName=new QName("urn:foo.bar","foobar");
  assertEquals(expectedQName,wsDataRef.getName());
  Element encryptedElement=wsDataRef.getEncryptedElement();
  assertNotNull(encryptedElement);
  assertEquals(WSConstants.ENC_NS,encryptedElement.getNamespaceURI());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.SignatureEncryptionTest </h4><pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that encrypts and then signs a WS-Security envelope (including the
 * encrypted element), then performs verification and decryption <p/>
 * @throws ExceptionThrown when there is any problem in signing, encryption,
 * decryption, or verification
 */
@SuppressWarnings("unchecked") @Test public void testEncryptionElementSigning() throws Exception {
  WSSecEncrypt encrypt=new WSSecEncrypt();
  WSSecSignature sign=new WSSecSignature();
  encrypt.setUserInfo("wss40");
  sign.setUserInfo("wss40","security");
  LOG.info("Before Encryption....");
  Document doc=SOAPUtil.toSOAPPart(SOAPMSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart part=new WSEncryptionPart("add","http://ws.apache.org/counter/counter_port_type","Element");
  encrypt.getParts().add(part);
  Document encryptedDoc=encrypt.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("After Encryption....");
    String outputString=XMLUtils.prettyDocumentToString(encryptedDoc);
    LOG.debug(outputString);
  }
  WSEncryptionPart signPart=new WSEncryptionPart(WSConstants.ENC_DATA_LN,WSConstants.ENC_NS,"Element");
  sign.getParts().add(signPart);
  Document encryptedSignedDoc=sign.build(encryptedDoc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("After Signing....");
    String outputString=XMLUtils.prettyDocumentToString(encryptedSignedDoc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(encryptedSignedDoc);
  List<WSSecurityEngineResult> sigSecEngResults=results.getActionResults().get(WSConstants.SIGN);
  List<WSSecurityEngineResult> encSecEngResults=results.getActionResults().get(WSConstants.ENCR);
  assertEquals(1,sigSecEngResults.size());
  assertEquals(1,encSecEngResults.size());
  List<WSDataRef> sigDataRefs=(List<WSDataRef>)(sigSecEngResults.get(0)).get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  List<WSDataRef> encDataRefs=(List<WSDataRef>)(encSecEngResults.get(0)).get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertNotNull(sigDataRefs);
  assertNotNull(encDataRefs);
  assertEquals(1,sigDataRefs.size());
  assertEquals(1,encDataRefs.size());
  assertNull(sigDataRefs.get(0).getProtectedElement().getAttributeNodeNS(WSConstants.WSU_NS,"Id"));
  assertTrue(sigDataRefs.get(0).getWsuId().contains(encDataRefs.get(0).getWsuId()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.SignaturePartsTest </h4><pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test getting a DOM Element from WSEncryptionPart directly
 */
@Test public void testSignaturePartDOMElement() throws Exception {
  WSSecSignature sign=new WSSecSignature();
  sign.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  sign.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  Document doc=SOAPUtil.toSOAPPart(SOAPMSG);
  SOAPConstants soapConstants=WSSecurityUtil.getSOAPConstants(doc.getDocumentElement());
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart encP=new WSEncryptionPart("Incorrect Localname","Incorrect N/S","");
  Element bodyElement=WSSecurityUtil.findBodyElement(doc);
  assertTrue(bodyElement != null && "Body".equals(bodyElement.getLocalName()));
  encP.setElement(bodyElement);
  sign.getParts().add(encP);
  Document signedDoc=sign.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  @SuppressWarnings("unchecked") final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  WSDataRef wsDataRef=refs.get(0);
  QName bodyName=new QName(soapConstants.getEnvelopeURI(),"Body");
  assertEquals(bodyName,wsDataRef.getName());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test signing a custom SOAP header
 */
@SuppressWarnings("unchecked") @Test public void testSOAPHeader() throws Exception {
  WSSecSignature sign=new WSSecSignature();
  sign.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  sign.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  Document doc=SOAPUtil.toSOAPPart(SOAPMSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart encP=new WSEncryptionPart("foobar","urn:foo.bar","");
  sign.getParts().add(encP);
  Document signedDoc=sign.build(doc,crypto,secHeader);
  if (LOG.isDebugEnabled()) {
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/soapenv:Envelope/soapenv:Header/foo:foobar",xpath);
  assertEquals(WSConstants.RSA_SHA1,wsDataRef.getAlgorithm());
  assertNotNull(wsDataRef.getDigestValue());
  assertTrue(wsDataRef.getDigestValue().length > 0);
  QName expectedQName=new QName("urn:foo.bar","foobar");
  assertEquals(expectedQName,wsDataRef.getName());
  assertEquals(WSConstants.SHA1,wsDataRef.getDigestAlgorithm());
  String sigMethod=(String)actionResult.get(WSSecurityEngineResult.TAG_SIGNATURE_METHOD);
  assertEquals(WSConstants.RSA_SHA1,sigMethod);
  String c14nMethod=(String)actionResult.get(WSSecurityEngineResult.TAG_CANONICALIZATION_METHOD);
  assertEquals(WSConstants.C14N_EXCL_OMIT_COMMENTS,c14nMethod);
  List<String> transformAlgorithms=wsDataRef.getTransformAlgorithms();
  assertTrue(transformAlgorithms.size() == 1);
  assertTrue(WSConstants.C14N_EXCL_OMIT_COMMENTS.equals(transformAlgorithms.get(0)));
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test signing of a header through a STR Dereference Transform
 */
@SuppressWarnings("unchecked") @Test public void testSOAPHeaderSTRTransform() throws Exception {
  Crypto issuerCrypto=new Merlin();
  KeyStore keyStore=KeyStore.getInstance(KeyStore.getDefaultType());
  ClassLoader loader=Loader.getClassLoader(SignedSamlTokenHOKTest.class);
  InputStream input=Merlin.loadInputStream(loader,"keys/wss40_server.jks");
  keyStore.load(input,"security".toCharArray());
  ((Merlin)issuerCrypto).setKeyStore(keyStore);
  Crypto userCrypto=CryptoFactory.getInstance("wss40.properties");
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  samlCallback.setIssuer("www.example.com");
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  wsSign.setUserInfo("wss40","security");
  Document doc=SOAPUtil.toSOAPPart(SOAPMSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSEncryptionPart encP=new WSEncryptionPart("STRTransform","","Element");
  wsSign.getParts().add(encP);
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML message (key holder):");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  Crypto trustCrypto=new Merlin();
  KeyStore trustStore=KeyStore.getInstance(KeyStore.getDefaultType());
  input=Merlin.loadInputStream(loader,"keys/wss40CA.jks");
  trustStore.load(input,"security".toCharArray());
  ((Merlin)trustCrypto).setTrustStore(trustStore);
  WSHandlerResult results=secEngine.processSecurityHeader(doc,null,null,trustCrypto);
  WSSecurityEngineResult stUnsignedActionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)stUnsignedActionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  WSSecurityEngineResult signActionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(signActionResult != null);
  assertFalse(signActionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)signActionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/soapenv:Envelope/soapenv:Header/wsse:Security/saml1:Assertion",xpath);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.UsernameTokenTest </h4><pre class="type-3 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test for encoded passwords.
 */
@Test public void testUsernameTokenWithEncodedPasswordBaseline() throws Exception {
  String password="password";
  byte[] passwordHash=MessageDigest.getInstance("SHA-1").digest(password.getBytes(StandardCharsets.UTF_8));
  String nonce="0x7bXAPZVn40AdCD0Xbt0g==";
  String created="2010-06-28T15:16:37Z";
  String expectedPasswordDigest="C0rena/6gKpRZ9ATj+e6ss5sAbQ=";
  String actualPasswordDigest=UsernameToken.doPasswordDigest(nonce,created,passwordHash);
  assertEquals("the password digest is not as expected",expectedPasswordDigest,actualPasswordDigest);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.token.DerivedKeyTokenTest </h4><pre class="type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHashcode() throws Exception {
  assertEquals(token.hashCode(),tokenEqual.hashCode());
  assertFalse(token.hashCode() == tokenNotEqual.hashCode());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.message.token.ReferenceTest </h4><pre class="type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHashcode() throws Exception {
  assertEquals(ref.hashCode(),refEqual.hashCode());
  assertFalse(ref.hashCode() == refNotEqual.hashCode());
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAccessors() throws Exception {
  final Reference ref=new Reference(createReferenceDocument(TEST_REFERENCE_TEMPLATE,"foo","bar").getDocumentElement());
  assertEquals(ref.getValueType(),"foo");
  assertEquals(ref.getURI(),"bar");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.misc.FaultCodeTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for the wsse:FailedAuthentication faultcode. This will fail due to a bad password in
 * the callback handler.
 */
@Test public void testFailedAuthentication() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.addCreated();
  builder.addNonce();
  builder.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document timestampedDoc=builder.build(doc,secHeader);
  try {
    verify(timestampedDoc);
    fail("Failure expected on a bad password");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_AUTHENTICATION);
    assertEquals("The security token could not be authenticated or authorized",ex.getMessage());
    QName faultCode=new QName(WSConstants.WSSE_NS,"FailedAuthentication");
    assertTrue(ex.getFaultCode().equals(faultCode));
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for the wsse:InvalidSecurity faultcode.
 */
@Test public void testInvalidSecurity() throws Exception {
  try {
    new Reference((org.w3c.dom.Element)null);
    fail("Failure expected on processing the security header");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY);
    assertEquals("<Reference> token could not be retrieved",ex.getMessage());
    QName faultCode=new QName(WSConstants.WSSE_NS,"InvalidSecurity");
    assertTrue(ex.getFaultCode().equals(faultCode));
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for the wsse:MessageExpired faultcode. This will fail due to the argument
 * passed to setTimeToLive.
 */
@Test public void testMessageExpired() throws Exception {
  WSSecTimestamp builder=new WSSecTimestamp();
  builder.setTimeToLive(-1);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document timestampedDoc=builder.build(doc,secHeader);
  try {
    verify(timestampedDoc);
    fail("Failure expected on an expired message");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.MESSAGE_EXPIRED);
    assertEquals("Invalid timestamp: The message timestamp has expired",ex.getMessage());
    QName faultCode=new QName(WSConstants.WSSE_NS,"MessageExpired");
    assertTrue(ex.getFaultCode().equals(faultCode));
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for the wsse:FailedCheck faultcode. This will fail due to a bad password in
 * the callback handler.
 */
@Test public void testFailedCheck() throws Exception {
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("wss40","security");
  builder.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document encryptedDoc=builder.build(doc,crypto,secHeader);
  try {
    verify(encryptedDoc);
    fail("Failure expected with a bad password");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.FAILED_CHECK);
    assertEquals("The private key for the supplied alias does not exist in the keystore",ex.getMessage());
    QName faultCode=new QName(WSConstants.WSSE_NS,"FailedCheck");
    assertTrue(ex.getFaultCode().equals(faultCode));
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for the wsse:UnsupportedAlgorithm faultcode. This will fail due to the argument
 * passed to getCipherInstance.
 */
@Test public void testUnsupportedAlgorithm() throws Exception {
  try {
    secEngine.getWssConfig();
    KeyUtils.getCipherInstance("Bad Algorithm");
    fail("Failure expected on an unsupported algorithm");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.UNSUPPORTED_ALGORITHM);
    assertEquals("unsupported key transport encryption algorithm: No such algorithm: Bad Algorithm",ex.getMessage());
    QName faultCode=new QName(WSConstants.WSSE_NS,"UnsupportedAlgorithm");
    assertTrue(ex.getFaultCode().equals(faultCode));
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for the wsse:InvalidSecurityToken faultcode. This will fail due to the fact
 * that a null username is used.
 */
@Test public void testInvalidSecurityToken() throws Exception {
  WSSecUsernameToken builder=new WSSecUsernameToken();
  builder.addCreated();
  builder.addNonce();
  builder.setUserInfo(null,"security");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  builder.build(doc,secHeader);
  try {
    new UsernameToken(doc.getDocumentElement(),false,new BSPEnforcer());
    fail("Failure expected on an invalid security token");
  }
 catch (  WSSecurityException ex) {
    assertTrue(ex.getErrorCode() == WSSecurityException.ErrorCode.INVALID_SECURITY_TOKEN);
    assertEquals("Bad element, expected \"{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}UsernameToken\" while got \"{http://schemas.xmlsoap.org/soap/envelope/}Envelope\"",ex.getMessage());
    QName faultCode=new QName(WSConstants.WSSE_NS,"InvalidSecurityToken");
    assertTrue(ex.getFaultCode().equals(faultCode));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.saml.SamlReferenceTest </h4><pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an signed SAML 2 holder-of-key assertion,
 * where the SecurityTokenReference that points to the SAML Assertion uses a KeyIdentifier,
 * and not a direct reference. This tests that we can process a KeyIdentifier to a SAML
 * Assertion in the KeyInfo of a Signature.
 */
@Test @SuppressWarnings("unchecked") public void testSAML2HOKKeyIdentifier() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(doc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML2 message Key Identifier (holder-of-key):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains(WSConstants.WSS_SAML2_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML2_TOKEN_TYPE));
  WSHandlerResult results=verify(signedDoc,trustCrypto,null);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * The body of the SOAP request is encrypted using a secret key, which is in turn encrypted
 * using the certificate embedded in the SAML assertion and referenced using Direct
 * Reference. Unlike the SAML 1.1 case, this is spec-compliant. This tests that we can process
 * a Direct Reference to a SAML Assertion in the KeyInfo of an EncryptedKey.
 */
@Test @SuppressWarnings("unchecked") public void testSAML2HOKEKDirectReference() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  Node assertionNode=samlAssertion.toDOM(doc);
  secHeader.insertSecurityHeader();
  secHeader.getSecurityHeader().appendChild(assertionNode);
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("wss40");
  builder.setSymmetricEncAlgorithm(WSConstants.TRIPLE_DES);
  builder.setKeyIdentifierType(WSConstants.CUSTOM_SYMM_SIGNING);
  builder.setCustomEKTokenValueType(WSConstants.WSS_SAML2_KI_VALUE_TYPE);
  builder.setCustomEKTokenId(samlAssertion.getId());
  builder.prepare(doc,userCrypto);
  WSEncryptionPart encP=new WSEncryptionPart("add","http://ws.apache.org/counter/counter_port_type","Element");
  builder.getParts().add(encP);
  Element refElement=builder.encrypt();
  builder.addInternalRefElement(refElement);
  builder.appendToHeader(secHeader);
  String outputString=XMLUtils.prettyDocumentToString(doc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Encrypted SAML 2 message Direct Reference (holder-of-key):");
    LOG.debug(outputString);
  }
  assertFalse(outputString.contains(WSConstants.WSS_SAML2_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML2_TOKEN_TYPE));
  WSHandlerResult results=verify(doc,trustCrypto,userCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body/add",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an signed SAML 1.1 sender-vouches assertion,
 * where the SecurityTokenReference that points to the SAML Assertion uses a direct reference,
 * and not a KeyIdentifier. This method is not spec compliant and is included to make sure
 * we can process third-party Assertions referenced in this way.
 */
@Test @SuppressWarnings("unchecked") public void testSAML1SVDirectReference() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  wsSign.setUseDirectReferenceToAssertion(true);
  Document signedDoc=wsSign.build(doc,null,samlAssertion,crypto,"16c73ab6-b892-458f-abf5-2f875f74882e","security",secHeader);
  String outputString=XMLUtils.prettyDocumentToString(doc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML message Direct Reference (sender vouches):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains(WSConstants.WSS_SAML_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML_TOKEN_TYPE));
  WSHandlerResult results=verify(signedDoc,crypto,null);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 2);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
  wsDataRef=refs.get(1);
  xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Header/wsse:Security/saml1:Assertion",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an signed SAML 2 sender-vouches assertion,
 * where the SecurityTokenReference that points to the SAML Assertion uses a KeyIdentifier,
 * and not a direct reference.
 */
@Test @SuppressWarnings("unchecked") public void testSAML2SVKeyIdentifier() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document signedDoc=wsSign.build(doc,null,samlAssertion,crypto,"16c73ab6-b892-458f-abf5-2f875f74882e","security",secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML2 message Key Identifier (sender vouches):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains(WSConstants.WSS_SAML2_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML2_TOKEN_TYPE));
  WSHandlerResult results=verify(signedDoc,crypto,null);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 2);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
  wsDataRef=refs.get(1);
  xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Header/wsse:Security/saml2:Assertion",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * The body of the SOAP request is encrypted using a secret key, which is in turn encrypted
 * using the certificate embedded in the SAML assertion and referenced using Direct
 * Reference. This method is not spec compliant and is included to make sure we can process
 * third-party Assertions referenced in this way. This tests that we can process a Direct
 * Reference to a SAML Assertion in the KeyInfo of an EncryptedKey.
 */
@Test @SuppressWarnings("unchecked") public void testSAML1HOKEKDirectReference() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  Node assertionNode=samlAssertion.toDOM(doc);
  secHeader.insertSecurityHeader();
  secHeader.getSecurityHeader().appendChild(assertionNode);
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("wss40");
  builder.setSymmetricEncAlgorithm(WSConstants.TRIPLE_DES);
  builder.setKeyIdentifierType(WSConstants.CUSTOM_SYMM_SIGNING);
  builder.setCustomEKTokenValueType(WSConstants.WSS_SAML_KI_VALUE_TYPE);
  builder.setCustomEKTokenId(samlAssertion.getId());
  builder.prepare(doc,userCrypto);
  WSEncryptionPart encP=new WSEncryptionPart("add","http://ws.apache.org/counter/counter_port_type","Element");
  builder.getParts().add(encP);
  Element refElement=builder.encrypt();
  builder.addInternalRefElement(refElement);
  builder.appendToHeader(secHeader);
  String outputString=XMLUtils.prettyDocumentToString(doc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Encrypted SAML 1.1 message Direct Reference (holder-of-key):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains(WSConstants.WSS_SAML_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML_TOKEN_TYPE));
  WSHandlerResult results=verify(doc,trustCrypto,userCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body/add",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an signed SAML 1.1 sender-vouches assertion,
 * where the SecurityTokenReference that points to the SAML Assertion uses a KeyIdentifier,
 * and not a direct reference.
 */
@Test @SuppressWarnings("unchecked") public void testSAML1SVKeyIdentifier() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document signedDoc=wsSign.build(doc,null,samlAssertion,crypto,"16c73ab6-b892-458f-abf5-2f875f74882e","security",secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML message Key Identifier (sender vouches):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains(WSConstants.WSS_SAML_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML_TOKEN_TYPE));
  WSHandlerResult results=verify(signedDoc,crypto,null);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 2);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
  wsDataRef=refs.get(1);
  xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Header/wsse:Security/saml1:Assertion",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * The body of the SOAP request is encrypted using a secret key, which is in turn encrypted
 * using the certificate embedded in the SAML assertion and referenced using a Key Identifier.
 * This tests that we can process a KeyIdentifier to a SAML Assertion in the KeyInfo of an
 * EncryptedKey.
 */
@Test @SuppressWarnings("unchecked") public void testSAML2HOKEKKeyIdentifier() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  Node assertionNode=samlAssertion.toDOM(doc);
  secHeader.insertSecurityHeader();
  secHeader.getSecurityHeader().appendChild(assertionNode);
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("wss40");
  builder.setSymmetricEncAlgorithm(WSConstants.TRIPLE_DES);
  builder.setKeyIdentifierType(WSConstants.CUSTOM_KEY_IDENTIFIER);
  builder.setCustomEKTokenValueType(WSConstants.WSS_SAML2_KI_VALUE_TYPE);
  builder.setCustomEKTokenId(samlAssertion.getId());
  builder.prepare(doc,userCrypto);
  WSEncryptionPart encP=new WSEncryptionPart("add","http://ws.apache.org/counter/counter_port_type","Element");
  builder.getParts().add(encP);
  Element refElement=builder.encrypt();
  builder.addInternalRefElement(refElement);
  builder.appendToHeader(secHeader);
  String outputString=XMLUtils.prettyDocumentToString(doc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Encrypted SAML 2 message Key Identifier (holder-of-key):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains(WSConstants.WSS_SAML2_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML2_TOKEN_TYPE));
  WSHandlerResult results=verify(doc,trustCrypto,userCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body/add",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * The body of the SOAP request is encrypted using a secret key, which is in turn encrypted
 * using the certificate embedded in the SAML assertion and referenced using a Key Identifier.
 * This tests that we can process a KeyIdentifier to a SAML Assertion in the KeyInfo of an
 * EncryptedKey.
 */
@Test @SuppressWarnings("unchecked") public void testSAML1HOKEKKeyIdentifier() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  Node assertionNode=samlAssertion.toDOM(doc);
  secHeader.insertSecurityHeader();
  secHeader.getSecurityHeader().appendChild(assertionNode);
  WSSecEncrypt builder=new WSSecEncrypt();
  builder.setUserInfo("wss40");
  builder.setSymmetricEncAlgorithm(WSConstants.TRIPLE_DES);
  builder.setKeyIdentifierType(WSConstants.CUSTOM_KEY_IDENTIFIER);
  builder.setCustomEKTokenValueType(WSConstants.WSS_SAML_KI_VALUE_TYPE);
  builder.setCustomEKTokenId(samlAssertion.getId());
  builder.prepare(doc,userCrypto);
  WSEncryptionPart encP=new WSEncryptionPart("add","http://ws.apache.org/counter/counter_port_type","Element");
  builder.getParts().add(encP);
  Element refElement=builder.encrypt();
  builder.addInternalRefElement(refElement);
  builder.appendToHeader(secHeader);
  String outputString=XMLUtils.prettyDocumentToString(doc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Encrypted SAML 1.1 message Key Identifier (holder-of-key):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains(WSConstants.WSS_SAML_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML_TOKEN_TYPE));
  WSHandlerResult results=verify(doc,trustCrypto,userCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.ENCR).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body/add",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an signed SAML 2 sender-vouches assertion,
 * where the SecurityTokenReference that points to the SAML Assertion uses a direct reference,
 * and not a KeyIdentifier. Unlike the SAML 1.1 case, this is spec-compliant.
 */
@Test @SuppressWarnings("unchecked") public void testSAML2SVDirectReference() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  wsSign.setUseDirectReferenceToAssertion(true);
  Document signedDoc=wsSign.build(doc,null,samlAssertion,crypto,"16c73ab6-b892-458f-abf5-2f875f74882e","security",secHeader);
  String outputString=XMLUtils.prettyDocumentToString(doc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML2 message Direct Reference (sender vouches):");
    LOG.debug(outputString);
  }
  assertFalse(outputString.contains(WSConstants.WSS_SAML2_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML2_TOKEN_TYPE));
  WSHandlerResult results=verify(signedDoc,crypto,null);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 2);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
  wsDataRef=refs.get(1);
  xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Header/wsse:Security/saml2:Assertion",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an signed SAML 1.1 holder-of-key assertion,
 * where the SecurityTokenReference that points to the SAML Assertion uses a KeyIdentifier,
 * and not a direct reference. This tests that we can process a KeyIdentifier to a SAML
 * Assertion in the KeyInfo of a Signature.
 */
@Test @SuppressWarnings("unchecked") public void testSAML1HOKKeyIdentifier() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256");
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(doc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML message Key Identifier (holder-of-key):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains(WSConstants.WSS_SAML_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML_TOKEN_TYPE));
  WSHandlerResult results=verify(signedDoc,trustCrypto,null);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an signed SAML 2 holder-of-key assertion,
 * where the SecurityTokenReference that points to the SAML Assertion uses a direct reference,
 * and not a KeyIdentifier. Unlike the SAML 1.1 case, this is spec-compliant. This tests that
 * we can process a Direct Reference to a SAML Assertion in the KeyInfo of a Signature.
 */
@Test @SuppressWarnings("unchecked") public void testSAML2HOKDirectReference() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256");
  wsSign.setUseDirectReferenceToAssertion(true);
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(doc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML2 message Direct Reference (holder-of-key):");
    LOG.debug(outputString);
  }
  assertFalse(outputString.contains(WSConstants.WSS_SAML2_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML2_TOKEN_TYPE));
  WSHandlerResult results=verify(signedDoc,trustCrypto,null);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an signed SAML 1.1 holder-of-key assertion,
 * where the SecurityTokenReference that points to the SAML Assertion uses a direct reference,
 * and not a KeyIdentifier. This method is not spec compliant and is included to make sure
 * we can process third-party Assertions referenced in this way. This tests that we can
 * process a Direct Reference to a SAML Assertion in the KeyInfo of a Signature.
 */
@Test @SuppressWarnings("unchecked") public void testSAML1HOKDirectReference() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256");
  wsSign.setUseDirectReferenceToAssertion(true);
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(doc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML message Direct Reference (holder-of-key):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains(WSConstants.WSS_SAML_KI_VALUE_TYPE));
  assertTrue(outputString.contains(WSConstants.WSS_SAML_TOKEN_TYPE));
  WSHandlerResult results=verify(signedDoc,trustCrypto,null);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.saml.SamlTokenDerivedTest </h4><pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 1.1 authentication assertion
 * using a derived key.
 */
@Test @SuppressWarnings("unchecked") public void testSAML1AuthnAssertionDerived() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  SecurityTokenReference secRefSaml=createSamlSTR(doc,samlAssertion,WSSConfig.getNewInstance());
  secHeader.getSecurityHeader().appendChild(samlAssertion.toDOM(doc));
  secHeader.getSecurityHeader().appendChild(secRefSaml.getElement());
  WSSecDKSign sigBuilder=createDKSign(doc,secRefSaml);
  Document signedDoc=sigBuilder.build(doc,secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 1.1 Authn Assertion Derived (sender vouches):");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 2);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
  wsDataRef=refs.get(1);
  xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Header/wsse:Security/saml1:Assertion",xpath);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.saml.SamlTokenSVTest </h4><pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 2 attribute assertion.
 */
@Test @SuppressWarnings("unchecked") public void testSAML2AttrAssertion() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.ATTR);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,null,samlAssertion,crypto,"16c73ab6-b892-458f-abf5-2f875f74882e","security",secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 2 Attr Assertion (sender vouches):");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 2);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
  wsDataRef=refs.get(1);
  xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Header/wsse:Security/saml2:Assertion",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 1.1 attribute assertion.
 */
@Test @SuppressWarnings("unchecked") public void testSAML1AttrAssertion() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.ATTR);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,null,samlAssertion,crypto,"16c73ab6-b892-458f-abf5-2f875f74882e","security",secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 1.1 Attr Assertion (sender vouches):");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 2);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
  wsDataRef=refs.get(1);
  xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Header/wsse:Security/saml1:Assertion",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 1.1 authentication assertion.
 */
@Test @SuppressWarnings("unchecked") public void testSAML1AuthnAssertion() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,null,samlAssertion,crypto,"16c73ab6-b892-458f-abf5-2f875f74882e","security",secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 1.1 Authn Assertion (sender vouches):");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 2);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
  wsDataRef=refs.get(1);
  xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Header/wsse:Security/saml1:Assertion",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 2 authentication assertion.
 */
@Test @SuppressWarnings("unchecked") public void testSAML2AuthnAssertion() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,null,samlAssertion,crypto,"16c73ab6-b892-458f-abf5-2f875f74882e","security",secHeader);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 2 Authn Assertion (sender vouches):");
    String outputString=XMLUtils.prettyDocumentToString(signedDoc);
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_UNSIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 2);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
  wsDataRef=refs.get(1);
  xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Header/wsse:Security/saml2:Assertion",xpath);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.saml.SamlTokenTest </h4><pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAssertionWrapperNoDocument() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  String assertionString=DOM2Writer.nodeToString(samlAssertion.toDOM(null));
  InputStream in=new ByteArrayInputStream(assertionString.getBytes());
  DocumentBuilderFactory dbf=DocumentBuilderFactory.newInstance();
  dbf.setNamespaceAware(true);
  Document newDoc=dbf.newDocumentBuilder().parse(in);
  SamlAssertionWrapper newAssertion=new SamlAssertionWrapper(newDoc.getDocumentElement());
  String secondAssertionString=newAssertion.assertionToString();
  assertEquals(assertionString,secondAssertionString);
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAssertionWrapper() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  DocumentBuilderFactory dbf=DocumentBuilderFactory.newInstance();
  dbf.setNamespaceAware(true);
  Document doc=dbf.newDocumentBuilder().newDocument();
  String assertionString=DOM2Writer.nodeToString(samlAssertion.toDOM(doc));
  InputStream in=new ByteArrayInputStream(assertionString.getBytes());
  Document newDoc=dbf.newDocumentBuilder().parse(in);
  SamlAssertionWrapper newAssertion=new SamlAssertionWrapper(newDoc.getDocumentElement());
  String secondAssertionString=newAssertion.assertionToString();
  assertEquals(assertionString,secondAssertionString);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.saml.SignedSamlTokenHOKTest </h4><pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 1.1 authentication assertion,
 * where the subject cert is referenced using a Key Value
 */
@Test @SuppressWarnings("unchecked") public void testSAML1AuthnAssertionKeyValue() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  callbackHandler.setCertIdentifier(CERT_IDENTIFIER.KEY_VALUE);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256");
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 1.1 Authn Assertion Key Value (holder-of-key):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains("KeyValue"));
  WSHandlerResult results=verify(signedDoc,userCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assert receivedSamlAssertion.isSigned();
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 2 authentication assertion.
 */
@Test @SuppressWarnings("unchecked") public void testSAML2AuthnAssertion() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256");
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML 2 Authn Assertion (key holder):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains("http://www.w3.org/2001/04/xmlenc#sha256"));
  assertTrue(outputString.contains("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256"));
  WSHandlerResult results=verify(signedDoc,trustCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test @org.junit.Ignore public void testSAML2Advice() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.ATTR);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_BEARER);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  Element adviceElement=samlAssertion.toDOM(doc);
  callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.ATTR);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  callbackHandler.setAssertionAdviceElement(adviceElement);
  samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  byte[] ephemeralKey=callbackHandler.getEphemeralKey();
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm(WSConstants.HMAC_SHA256);
  wsSign.setKeyIdentifierType(WSConstants.X509_KEY_IDENTIFIER);
  wsSign.setSecretKey(ephemeralKey);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML 2 Attr Assertion (key holder):");
    LOG.debug(outputString);
  }
  System.out.println(outputString);
  WSHandlerResult results=verify(signedDoc,trustCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedAssertion != null);
  assertTrue(receivedAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  @SuppressWarnings("unchecked") final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 2 authentication assertion,
 * where the subject cert is referenced using a Key Value
 */
@Test @SuppressWarnings("unchecked") public void testSAML2AuthnAssertionKeyValue() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
  callbackHandler.setCertIdentifier(CERT_IDENTIFIER.KEY_VALUE);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256");
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 2 Authn Assertion Key Value (holder-of-key):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains("KeyValue"));
  WSHandlerResult results=verify(signedDoc,userCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 1.1 authentication assertion,
 * where the subject cert is referenced using IssuerSerial
 */
@Test @SuppressWarnings("unchecked") public void testSAML1AuthnAssertionIssuerSerial() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  callbackHandler.setCertIdentifier(CERT_IDENTIFIER.X509_ISSUER_SERIAL);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256");
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("SAML 1.1 Authn Assertion Issuer Serial (holder-of-key):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains("X509IssuerSerial"));
  WSHandlerResult results=verify(signedDoc,userCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 1.1 attribute assertion.
 */
@Test public void testSAML1AttrAssertion() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.ATTR);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  byte[] ephemeralKey=callbackHandler.getEphemeralKey();
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm(WSConstants.HMAC_SHA256);
  wsSign.setKeyIdentifierType(WSConstants.X509_KEY_IDENTIFIER);
  wsSign.setSecretKey(ephemeralKey);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML 1.1 Attr Assertion (key holder):");
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc,trustCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedAssertion != null);
  assertTrue(receivedAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  @SuppressWarnings("unchecked") final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 2 attribute assertion.
 */
@Test public void testSAML2AttrAssertion() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.ATTR);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  byte[] ephemeralKey=callbackHandler.getEphemeralKey();
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm(WSConstants.HMAC_SHA256);
  wsSign.setKeyIdentifierType(WSConstants.X509_KEY_IDENTIFIER);
  wsSign.setSecretKey(ephemeralKey);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML 2 Attr Assertion (key holder):");
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc,trustCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedAssertion != null);
  assertTrue(receivedAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  @SuppressWarnings("unchecked") final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 1.1 authentication assertion.
 */
@Test @SuppressWarnings("unchecked") public void testSAML1AuthnAssertion() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("wss40","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256");
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML 1.1 Authn Assertion (key holder):");
    LOG.debug(outputString);
  }
  assertTrue(outputString.contains("http://www.w3.org/2001/04/xmlenc#sha256"));
  assertTrue(outputString.contains("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256"));
  WSHandlerResult results=verify(signedDoc,trustCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  assertTrue(receivedSamlAssertion.getSignatureValue() != null);
  List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Header/wsse:Security/saml1:Assertion",xpath);
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  wsDataRef=refs.get(0);
  xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 1.1 authentication assertion.
 * The difference is that we don't trust the user signature, but as we trust the
 * signature of the issuer, we have (indirect) trust.
 */
@Test @SuppressWarnings("unchecked") public void testSAML1AuthnAssertionTrust() throws Exception {
  SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
  callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
  callbackHandler.setIssuer("www.example.com");
  Crypto crypto=CryptoFactory.getInstance("crypto.properties");
  CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
  cryptoType.setAlias("16c73ab6-b892-458f-abf5-2f875f74882e");
  X509Certificate[] certs=crypto.getX509Certificates(cryptoType);
  callbackHandler.setCerts(certs);
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("wss40_server","security",issuerCrypto,false);
  WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
  wsSign.setUserInfo("16c73ab6-b892-458f-abf5-2f875f74882e","security");
  wsSign.setDigestAlgo("http://www.w3.org/2001/04/xmlenc#sha256");
  wsSign.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256");
  wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  Document signedDoc=wsSign.build(doc,crypto,samlAssertion,null,null,null,secHeader);
  String outputString=XMLUtils.prettyDocumentToString(signedDoc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Signed SAML 1.1 Authn Assertion (key holder):");
    LOG.debug(outputString);
  }
  WSHandlerResult results=verify(signedDoc,trustCrypto);
  WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.ST_SIGNED).get(0);
  SamlAssertionWrapper receivedSamlAssertion=(SamlAssertionWrapper)actionResult.get(WSSecurityEngineResult.TAG_SAML_ASSERTION);
  assertTrue(receivedSamlAssertion != null);
  assertTrue(receivedSamlAssertion.isSigned());
  actionResult=results.getActionResults().get(WSConstants.SIGN).get(0);
  assertTrue(actionResult != null);
  assertFalse(actionResult.isEmpty());
  final List<WSDataRef> refs=(List<WSDataRef>)actionResult.get(WSSecurityEngineResult.TAG_DATA_REF_URIS);
  assertTrue(refs.size() == 1);
  WSDataRef wsDataRef=refs.get(0);
  String xpath=wsDataRef.getXpath();
  assertEquals("/SOAP-ENV:Envelope/SOAP-ENV:Body",xpath);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.dom.saml.ext.AssertionSigningTest </h4><pre class="type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates an SamlAssertionWrapper object and signs using default
 * signature and canonicalization algorithms. The defaults should match
 * otherwise the test-case fails.
 */
@Test public void testSigningWithDefaultAlgorithms() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("client_certchain","password",issuerCrypto,false);
  Signature signature=samlAssertion.getSaml2().getSignature();
  Assert.assertTrue(signature.getSignatureAlgorithm().equalsIgnoreCase(defaultRSASignatureAlgorithm) || signature.getSignatureAlgorithm().equalsIgnoreCase(defaultDSASignatureAlgorithm));
  Assert.assertEquals(defaultCanonicalizationAlgorithm,signature.getCanonicalizationAlgorithm());
  SAMLKeyInfo keyInfo=new SAMLKeyInfo();
  CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
  cryptoType.setAlias("client_certchain");
  keyInfo.setCerts(issuerCrypto.getX509Certificates(cryptoType));
  Document doc=dbf.newDocumentBuilder().newDocument();
  Element assertionElement=samlAssertion.toDOM(doc);
  doc.appendChild(assertionElement);
  samlAssertion=new SamlAssertionWrapper(assertionElement);
  samlAssertion.verifySignature(keyInfo);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates an SamlAssertionWrapper object and signs using custom
 * signature and canonicalization algorithms.
 */
@Test public void testSigningWithCustomAlgorithms() throws Exception {
  SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
  callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
  callbackHandler.setConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
  callbackHandler.setIssuer("www.example.com");
  SAMLCallback samlCallback=new SAMLCallback();
  SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
  SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
  samlAssertion.signAssertion("client_certchain","password",issuerCrypto,false,customCanonicalizationAlgorithm,customSignatureAlgorithm,customSignatureDigestAlgorithm);
  Signature signature=samlAssertion.getSaml2().getSignature();
  Assert.assertEquals(customSignatureAlgorithm,signature.getSignatureAlgorithm());
  Assert.assertEquals(customCanonicalizationAlgorithm,signature.getCanonicalizationAlgorithm());
  Document doc=dbf.newDocumentBuilder().newDocument();
  Element assertionElement=samlAssertion.toDOM(doc);
  doc.appendChild(assertionElement);
  String assertionString=DOM2Writer.nodeToString(assertionElement);
  Assert.assertTrue(assertionString.contains(customSignatureDigestAlgorithm));
  SAMLKeyInfo keyInfo=new SAMLKeyInfo();
  CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
  cryptoType.setAlias("client_certchain");
  keyInfo.setCerts(issuerCrypto.getX509Certificates(cryptoType));
  samlAssertion=new SamlAssertionWrapper(assertionElement);
  samlAssertion.verifySignature(keyInfo);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.integration.test.kerberos.KerberosTest </h4><pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testKerberosSignatureKIInbound() throws Exception {
  if (!runTests) {
    System.out.println("Skipping test because kerberos server could not be started");
    return;
  }
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    KerberosSecurity bst=new KerberosSecurity(doc);
    CallbackHandler callbackHandler=new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof PasswordCallback) {
          PasswordCallback passwordCallback=(PasswordCallback)callbacks[0];
          if (passwordCallback.getPrompt().contains("alice")) {
            passwordCallback.setPassword("alice".toCharArray());
          }
        }
      }
    }
;
    bst.retrieveServiceTicket("alice",callbackHandler,"bob@service.ws.apache.org");
    bst.setID("Id-" + bst.hashCode());
    WSSecSignature sign=new WSSecSignature();
    sign.setSignatureAlgorithm(SignatureMethod.HMAC_SHA1);
    sign.setKeyIdentifierType(WSConstants.CUSTOM_KEY_IDENTIFIER);
    sign.setCustomTokenValueType(WSConstants.WSS_KRB_KI_VALUE_TYPE);
    SecretKey secretKey=bst.getSecretKey();
    byte[] keyData=secretKey.getEncoded();
    sign.setSecretKey(keyData);
    byte[] digestBytes=KeyUtils.generateDigest(bst.getToken());
    sign.setCustomTokenId(Base64.encode(digestBytes));
    sign.build(doc,null,secHeader);
    WSSecurityUtil.prependChildElement(secHeader.getSecurityHeader(),bst.getElement());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof PasswordCallback) {
          PasswordCallback passwordCallback=(PasswordCallback)callbacks[0];
          if (passwordCallback.getPrompt().contains("bob")) {
            passwordCallback.setPassword("bob".toCharArray());
          }
        }
 else         if (callbacks[0] instanceof KerberosContextAndServiceNameCallback) {
          KerberosContextAndServiceNameCallback cb=(KerberosContextAndServiceNameCallback)callbacks[0];
          cb.setContextName("bob");
          cb.setServiceName("bob@service.ws.apache.org");
        }
      }
    }
);
    final List<KerberosTokenSecurityEvent> kerberosTokenSecurityEvents=new ArrayList<KerberosTokenSecurityEvent>();
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    SecurityEventListener securityEventListener=new SecurityEventListener(){
      @Override public void registerSecurityEvent(      SecurityEvent securityEvent) throws XMLSecurityException {
        if (securityEvent instanceof KerberosTokenSecurityEvent) {
          kerberosTokenSecurityEvents.add((KerberosTokenSecurityEvent)securityEvent);
        }
      }
    }
;
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    Document document=StAX2DOM.readDoc(dbf.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    Assert.assertEquals(kerberosTokenSecurityEvents.size(),1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testKerberosEncryptionKIInbound() throws Exception {
  if (!runTests) {
    System.out.println("Skipping test because kerberos server could not be started");
    return;
  }
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    KerberosSecurity bst=new KerberosSecurity(doc);
    CallbackHandler callbackHandler=new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof PasswordCallback) {
          PasswordCallback passwordCallback=(PasswordCallback)callbacks[0];
          if (passwordCallback.getPrompt().contains("alice")) {
            passwordCallback.setPassword("alice".toCharArray());
          }
        }
      }
    }
;
    bst.retrieveServiceTicket("alice",callbackHandler,"bob@service.ws.apache.org");
    bst.setID("Id-" + bst.hashCode());
    WSSecEncrypt builder=new WSSecEncrypt();
    builder.setSymmetricEncAlgorithm(WSConstants.AES_128);
    SecretKey secretKey=bst.getSecretKey();
    builder.setSymmetricKey(secretKey);
    builder.setEncryptSymmKey(false);
    builder.setCustomReferenceValue(WSConstants.WSS_KRB_KI_VALUE_TYPE);
    byte[] digestBytes=KeyUtils.generateDigest(bst.getToken());
    builder.setEncKeyId(Base64.encode(digestBytes));
    builder.build(doc,null,secHeader);
    WSSecurityUtil.prependChildElement(secHeader.getSecurityHeader(),bst.getElement());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof PasswordCallback) {
          PasswordCallback passwordCallback=(PasswordCallback)callbacks[0];
          if (passwordCallback.getPrompt().contains("bob")) {
            passwordCallback.setPassword("bob".toCharArray());
          }
        }
 else         if (callbacks[0] instanceof KerberosContextAndServiceNameCallback) {
          KerberosContextAndServiceNameCallback cb=(KerberosContextAndServiceNameCallback)callbacks[0];
          cb.setContextName("bob");
          cb.setServiceName("bob@service.ws.apache.org");
        }
      }
    }
);
    final List<KerberosTokenSecurityEvent> kerberosTokenSecurityEvents=new ArrayList<KerberosTokenSecurityEvent>();
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    SecurityEventListener securityEventListener=new SecurityEventListener(){
      @Override public void registerSecurityEvent(      SecurityEvent securityEvent) throws XMLSecurityException {
        if (securityEvent instanceof KerberosTokenSecurityEvent) {
          kerberosTokenSecurityEvents.add((KerberosTokenSecurityEvent)securityEvent);
        }
      }
    }
;
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    Document document=StAX2DOM.readDoc(dbf.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_BINARY_SECURITY_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_BINARY_SECURITY_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    Assert.assertEquals(kerberosTokenSecurityEvents.size(),1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKerberosEncryptionOutbound() throws Exception {
  if (!runTests) {
    System.out.println("Skipping test because kerberos server could not be started");
    return;
  }
  Document document;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT_WITH_KERBEROS_TOKEN);
    securityProperties.setActions(actions);
    securityProperties.setEncryptionSymAlgorithm(WSSConstants.NS_XENC_AES128);
    securityProperties.setCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof KerberosContextAndServiceNameCallback) {
          KerberosContextAndServiceNameCallback kerberosContextAndServiceNameCallback=(KerberosContextAndServiceNameCallback)callbacks[0];
          kerberosContextAndServiceNameCallback.setContextName("alice");
          kerberosContextAndServiceNameCallback.setServiceName("bob@service.ws.apache.org");
        }
 else         if (callbacks[0] instanceof PasswordCallback) {
          PasswordCallback passwordCallback=(PasswordCallback)callbacks[0];
          if (passwordCallback.getPrompt().contains("alice")) {
            passwordCallback.setPassword("alice".toCharArray());
          }
        }
      }
    }
);
    ByteArrayOutputStream baos=new ByteArrayOutputStream();
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    document=dbf.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_ReferenceList.getNamespaceURI(),WSSConstants.TAG_xenc_ReferenceList.getLocalPart());
    Assert.assertEquals(1,nodeList.getLength());
  }
{
    WSSConfig wssConfig=WSSConfig.getNewInstance();
    KerberosTokenValidator validator=new KerberosTokenValidator();
    validator.setContextName("bob");
    validator.setServiceName("bob@service.ws.apache.org");
    wssConfig.setValidator(WSConstants.BINARY_TOKEN,validator);
    WSSecurityEngine secEngine=new WSSecurityEngine();
    secEngine.setWssConfig(wssConfig);
    CallbackHandler callbackHandler=new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof PasswordCallback) {
          PasswordCallback passwordCallback=(PasswordCallback)callbacks[0];
          if (passwordCallback.getPrompt().contains("bob")) {
            passwordCallback.setPassword("bob".toCharArray());
          }
        }
      }
    }
;
    WSHandlerResult results=secEngine.processSecurityHeader(document,null,callbackHandler,null);
    WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.BST).get(0);
    BinarySecurity token=(BinarySecurity)actionResult.get(WSSecurityEngineResult.TAG_BINARY_SECURITY_TOKEN);
    Assert.assertTrue(token != null);
    Principal principal=(Principal)actionResult.get(WSSecurityEngineResult.TAG_PRINCIPAL);
    Assert.assertTrue(principal instanceof KerberosPrincipal);
    Assert.assertTrue(principal.getName().contains("alice"));
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testKerberosEncryptionInbound() throws Exception {
  if (!runTests) {
    System.out.println("Skipping test because kerberos server could not be started");
    return;
  }
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    KerberosSecurity bst=new KerberosSecurity(doc);
    CallbackHandler callbackHandler=new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof PasswordCallback) {
          PasswordCallback passwordCallback=(PasswordCallback)callbacks[0];
          if (passwordCallback.getPrompt().contains("alice")) {
            passwordCallback.setPassword("alice".toCharArray());
          }
        }
      }
    }
;
    bst.retrieveServiceTicket("alice",callbackHandler,"bob@service.ws.apache.org");
    bst.setID("Id-" + bst.hashCode());
    WSSecEncrypt builder=new WSSecEncrypt();
    builder.setSymmetricEncAlgorithm(WSConstants.AES_256);
    SecretKey secretKey=bst.getSecretKey();
    builder.setSymmetricKey(secretKey);
    builder.setEncryptSymmKey(false);
    builder.setCustomReferenceValue(WSConstants.WSS_GSS_KRB_V5_AP_REQ);
    builder.setEncKeyId(bst.getID());
    builder.build(doc,null,secHeader);
    WSSecurityUtil.prependChildElement(secHeader.getSecurityHeader(),bst.getElement());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof PasswordCallback) {
          PasswordCallback passwordCallback=(PasswordCallback)callbacks[0];
          if (passwordCallback.getPrompt().contains("bob")) {
            passwordCallback.setPassword("bob".toCharArray());
          }
        }
 else         if (callbacks[0] instanceof KerberosContextAndServiceNameCallback) {
          KerberosContextAndServiceNameCallback cb=(KerberosContextAndServiceNameCallback)callbacks[0];
          cb.setContextName("bob");
          cb.setServiceName("bob@service.ws.apache.org");
        }
      }
    }
);
    final List<KerberosTokenSecurityEvent> kerberosTokenSecurityEvents=new ArrayList<KerberosTokenSecurityEvent>();
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    SecurityEventListener securityEventListener=new SecurityEventListener(){
      @Override public void registerSecurityEvent(      SecurityEvent securityEvent) throws XMLSecurityException {
        if (securityEvent instanceof KerberosTokenSecurityEvent) {
          kerberosTokenSecurityEvents.add((KerberosTokenSecurityEvent)securityEvent);
        }
      }
    }
;
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    Document document=StAX2DOM.readDoc(dbf.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_BINARY_SECURITY_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_BINARY_SECURITY_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    Assert.assertEquals(kerberosTokenSecurityEvents.size(),1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKerberosSignatureInbound() throws Exception {
  if (!runTests) {
    System.out.println("Skipping test because kerberos server could not be started");
    return;
  }
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    KerberosSecurity bst=new KerberosSecurity(doc);
    CallbackHandler callbackHandler=new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof PasswordCallback) {
          PasswordCallback passwordCallback=(PasswordCallback)callbacks[0];
          if (passwordCallback.getPrompt().contains("alice")) {
            passwordCallback.setPassword("alice".toCharArray());
          }
        }
      }
    }
;
    bst.retrieveServiceTicket("alice",callbackHandler,"bob@service.ws.apache.org");
    bst.setID("Id-" + bst.hashCode());
    WSSecSignature sign=new WSSecSignature();
    sign.setSignatureAlgorithm(SignatureMethod.HMAC_SHA1);
    sign.setKeyIdentifierType(WSConstants.CUSTOM_SYMM_SIGNING);
    sign.setCustomTokenId(bst.getID());
    sign.setCustomTokenValueType(WSConstants.WSS_GSS_KRB_V5_AP_REQ);
    SecretKey secretKey=bst.getSecretKey();
    sign.setSecretKey(secretKey.getEncoded());
    sign.build(doc,null,secHeader);
    WSSecurityUtil.prependChildElement(secHeader.getSecurityHeader(),bst.getElement());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof PasswordCallback) {
          PasswordCallback passwordCallback=(PasswordCallback)callbacks[0];
          if (passwordCallback.getPrompt().contains("bob")) {
            passwordCallback.setPassword("bob".toCharArray());
          }
        }
 else         if (callbacks[0] instanceof KerberosContextAndServiceNameCallback) {
          KerberosContextAndServiceNameCallback cb=(KerberosContextAndServiceNameCallback)callbacks[0];
          cb.setContextName("bob");
          cb.setServiceName("bob@service.ws.apache.org");
        }
      }
    }
);
    final List<KerberosTokenSecurityEvent> kerberosTokenSecurityEvents=new ArrayList<KerberosTokenSecurityEvent>();
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    SecurityEventListener securityEventListener=new SecurityEventListener(){
      @Override public void registerSecurityEvent(      SecurityEvent securityEvent) throws XMLSecurityException {
        if (securityEvent instanceof KerberosTokenSecurityEvent) {
          kerberosTokenSecurityEvents.add((KerberosTokenSecurityEvent)securityEvent);
        }
      }
    }
;
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    Document document=StAX2DOM.readDoc(dbf.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    Assert.assertEquals(kerberosTokenSecurityEvents.size(),1);
    final KerberosTokenSecurityEvent kerberosTokenSecurityEvent=kerberosTokenSecurityEvents.get(0);
    Assert.assertNotNull(kerberosTokenSecurityEvent.getSecurityToken().getSubject());
    Assert.assertTrue(kerberosTokenSecurityEvent.getSecurityToken().getPrincipal() instanceof KerberosPrincipal);
    Assert.assertEquals(kerberosTokenSecurityEvent.getSecurityToken().getPrincipal().getName(),"alice@service.ws.apache.org");
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKerberosSignatureOutbound() throws Exception {
  if (!runTests) {
    System.out.println("Skipping test because kerberos server could not be started");
    return;
  }
  Document document;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE_WITH_KERBEROS_TOKEN);
    securityProperties.setActions(actions);
    securityProperties.setCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof KerberosContextAndServiceNameCallback) {
          KerberosContextAndServiceNameCallback kerberosContextAndServiceNameCallback=(KerberosContextAndServiceNameCallback)callbacks[0];
          kerberosContextAndServiceNameCallback.setContextName("alice");
          kerberosContextAndServiceNameCallback.setServiceName("bob@service.ws.apache.org");
        }
 else         if (callbacks[0] instanceof PasswordCallback) {
          PasswordCallback passwordCallback=(PasswordCallback)callbacks[0];
          if (passwordCallback.getPrompt().contains("alice")) {
            passwordCallback.setPassword("alice".toCharArray());
          }
        }
      }
    }
);
    ByteArrayOutputStream baos=new ByteArrayOutputStream();
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    document=dbf.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
{
    WSSConfig wssConfig=WSSConfig.getNewInstance();
    KerberosTokenValidator validator=new KerberosTokenValidator();
    validator.setContextName("bob");
    validator.setServiceName("bob@service.ws.apache.org");
    wssConfig.setValidator(WSConstants.BINARY_TOKEN,validator);
    WSSecurityEngine secEngine=new WSSecurityEngine();
    secEngine.setWssConfig(wssConfig);
    CallbackHandler callbackHandler=new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof PasswordCallback) {
          PasswordCallback passwordCallback=(PasswordCallback)callbacks[0];
          if (passwordCallback.getPrompt().contains("bob")) {
            passwordCallback.setPassword("bob".toCharArray());
          }
        }
      }
    }
;
    WSHandlerResult results=secEngine.processSecurityHeader(document,null,callbackHandler,null);
    WSSecurityEngineResult actionResult=results.getActionResults().get(WSConstants.BST).get(0);
    BinarySecurity token=(BinarySecurity)actionResult.get(WSSecurityEngineResult.TAG_BINARY_SECURITY_TOKEN);
    Assert.assertTrue(token != null);
    Principal principal=(Principal)actionResult.get(WSSecurityEngineResult.TAG_PRINCIPAL);
    Assert.assertTrue(principal instanceof KerberosPrincipal);
    Assert.assertTrue(principal.getName().contains("alice"));
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Various unit tests for a kerberos client
 */
@Test public void testKerberosClient() throws Exception {
  if (!runTests) {
    System.out.println("Skipping test because kerberos server could not be started");
    return;
  }
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  CallbackHandler callbackHandler=new CallbackHandler(){
    @Override public void handle(    Callback[] callbacks) throws IOException, UnsupportedCallbackException {
      PasswordCallback passwordCallback=(PasswordCallback)callbacks[0];
      if (passwordCallback.getPrompt().contains("alice")) {
        passwordCallback.setPassword("alice".toCharArray());
      }
 else       if (passwordCallback.getPrompt().contains("bob")) {
        passwordCallback.setPassword("bob".toCharArray());
      }
    }
  }
;
  try {
    KerberosSecurity bst=new KerberosSecurity(doc);
    bst.retrieveServiceTicket("alice2",callbackHandler,"bob@service");
    Assert.fail("Failure expected on an unknown user");
  }
 catch (  WSSecurityException ex) {
    Assert.assertTrue(ex.getMessage().startsWith("An error occurred in trying to obtain a TGT:"));
  }
  try {
    KerberosSecurity bst=new KerberosSecurity(doc);
    bst.retrieveServiceTicket("alice",callbackHandler,"bob2@service");
    Assert.fail("Failure expected on an unknown user");
  }
 catch (  WSSecurityException ex) {
    Assert.assertEquals(ex.getMessage(),"An error occurred in trying to obtain a service ticket");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.AlgorithmSuiteTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAlgorithmSuitePolicyNegative() throws Exception {
  String policyString="<sp:AlgorithmSuite xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:TripleDesRsa15/>\n"+ "</wsp:Policy>\n"+ "</sp:AlgorithmSuite>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  AlgorithmSuiteSecurityEvent algorithmSuiteSecurityEvent=new AlgorithmSuiteSecurityEvent();
  algorithmSuiteSecurityEvent.setAlgorithmURI("http://www.w3.org/2001/04/xmlenc#aes128-cbc");
  algorithmSuiteSecurityEvent.setKeyLength(128);
  algorithmSuiteSecurityEvent.setAlgorithmUsage(WSSConstants.Enc);
  try {
    policyEnforcer.registerSecurityEvent(algorithmSuiteSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Encryption algorithm http://www.w3.org/2001/04/xmlenc#aes128-cbc does not meet policy\n" + "Symmetric encryption algorithm key length 128 does not meet policy");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAlgorithmSuitePolicyMultipleAssertionEventsNegative() throws Exception {
  String policyString="<sp:AlgorithmSuite xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:TripleDesRsa15/>\n"+ "</wsp:Policy>\n"+ "</sp:AlgorithmSuite>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  AlgorithmSuiteSecurityEvent algorithmSuiteSecurityEvent=new AlgorithmSuiteSecurityEvent();
  algorithmSuiteSecurityEvent.setAlgorithmURI("http://www.w3.org/2001/04/xmlenc#tripledes-cbc");
  algorithmSuiteSecurityEvent.setKeyLength(192);
  algorithmSuiteSecurityEvent.setAlgorithmUsage(WSSConstants.Enc);
  policyEnforcer.registerSecurityEvent(algorithmSuiteSecurityEvent);
  algorithmSuiteSecurityEvent.setAlgorithmURI("http://www.w3.org/2001/04/xmlenc#sha256");
  algorithmSuiteSecurityEvent.setAlgorithmUsage(WSSConstants.SigDig);
  try {
    policyEnforcer.registerSecurityEvent(algorithmSuiteSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Digest algorithm http://www.w3.org/2001/04/xmlenc#sha256 does not meet policy");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAES256GCMAlgorithmSuitePolicy() throws Exception {
  String policyString="<sp:AlgorithmSuite xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<cxf:Basic256GCM xmlns:cxf=\"http://cxf.apache.org/custom/security-policy\"/>\n"+ "</wsp:Policy>\n"+ "</sp:AlgorithmSuite>";
class GCMAlgorithmSuite extends AlgorithmSuite {
    GCMAlgorithmSuite(    SPConstants.SPVersion version,    Policy nestedPolicy){
      super(version,nestedPolicy);
    }
    @Override protected AbstractSecurityAssertion cloneAssertion(    Policy nestedPolicy){
      return new GCMAlgorithmSuite(getVersion(),nestedPolicy);
    }
    @Override protected void parseCustomAssertion(    Assertion assertion){
      String assertionName=assertion.getName().getLocalPart();
      String assertionNamespace=assertion.getName().getNamespaceURI();
      if (!"http://cxf.apache.org/custom/security-policy".equals(assertionNamespace)) {
        return;
      }
      if ("Basic128GCM".equals(assertionName)) {
        setAlgorithmSuiteType(new AlgorithmSuiteType("Basic128GCM",SPConstants.SHA1,WSSConstants.NS_XENC11_AES128_GCM,SPConstants.KW_AES128,SPConstants.KW_RSA_OAEP,SPConstants.P_SHA1_L128,SPConstants.P_SHA1_L128,128,128,128,256,1024,4096));
      }
 else       if ("Basic192GCM".equals(assertionName)) {
        setAlgorithmSuiteType(new AlgorithmSuiteType("Basic192GCM",SPConstants.SHA1,WSSConstants.NS_XENC11_AES192_GCM,SPConstants.KW_AES192,SPConstants.KW_RSA_OAEP,SPConstants.P_SHA1_L192,SPConstants.P_SHA1_L192,192,192,192,256,1024,4096));
      }
 else       if ("Basic256GCM".equals(assertionName)) {
        setAlgorithmSuiteType(new AlgorithmSuiteType("Basic256GCM",SPConstants.SHA1,WSSConstants.NS_XENC11_AES256_GCM,SPConstants.KW_AES256,SPConstants.KW_RSA_OAEP,SPConstants.P_SHA1_L256,SPConstants.P_SHA1_L192,256,192,256,256,1024,4096));
      }
    }
  }
class GCMAlgorithmSuiteBuilder extends AlgorithmSuiteBuilder {
    @Override protected AlgorithmSuite createAlgorithmSuite(    SPConstants.SPVersion version,    Policy nestedPolicy){
      return new GCMAlgorithmSuite(version,nestedPolicy);
    }
  }
  List<AssertionBuilder<Element>> customAssertionBuilders=new ArrayList<>();
  customAssertionBuilders.add(new GCMAlgorithmSuiteBuilder());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString,false,customAssertionBuilders);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  AlgorithmSuiteSecurityEvent algorithmSuiteSecurityEvent=new AlgorithmSuiteSecurityEvent();
  algorithmSuiteSecurityEvent.setAlgorithmURI(WSSConstants.NS_XENC11_AES256_GCM);
  algorithmSuiteSecurityEvent.setKeyLength(256);
  algorithmSuiteSecurityEvent.setAlgorithmUsage(WSSConstants.Enc);
  policyEnforcer.registerSecurityEvent(algorithmSuiteSecurityEvent);
  algorithmSuiteSecurityEvent=new AlgorithmSuiteSecurityEvent();
  algorithmSuiteSecurityEvent.setAlgorithmURI(WSSConstants.NS_XENC_AES256);
  algorithmSuiteSecurityEvent.setKeyLength(256);
  algorithmSuiteSecurityEvent.setAlgorithmUsage(WSSConstants.Enc);
  try {
    policyEnforcer.registerSecurityEvent(algorithmSuiteSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  Exception e) {
    Assert.assertEquals(e.getCause().getMessage(),"Encryption algorithm http://www.w3.org/2001/04/xmlenc#aes256-cbc does not meet policy");
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAlgorithmSuitePolicyAlternativesNegative() throws Exception {
  String policyString="<sp:AlgorithmSuite xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<wsp:ExactlyOne>\n"+ "<sp:Basic256/>\n"+ "<sp:TripleDesRsa15/>\n"+ "</wsp:ExactlyOne>\n"+ "</wsp:Policy>\n"+ "</sp:AlgorithmSuite>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  AlgorithmSuiteSecurityEvent algorithmSuiteSecurityEvent=new AlgorithmSuiteSecurityEvent();
  algorithmSuiteSecurityEvent.setAlgorithmURI("http://www.w3.org/2001/04/xmlenc#aes128-cbc");
  algorithmSuiteSecurityEvent.setKeyLength(128);
  algorithmSuiteSecurityEvent.setAlgorithmUsage(WSSConstants.Enc);
  try {
    policyEnforcer.registerSecurityEvent(algorithmSuiteSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Encryption algorithm http://www.w3.org/2001/04/xmlenc#aes128-cbc does not meet policy\n" + "Symmetric encryption algorithm key length 128 does not meet policy");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.AsymmetricBindingIntegrationTest </h4><pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEntireHeaderAndBodySignatureNegative() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                        <sp:OnlySignEntireHeadersAndBody/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(new QName("http://schemas.xmlsoap.org/wsdl/","definitions"),SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"OnlySignEntireHeadersAndBody not fulfilled, offending element: " + "/{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Body/{http://schemas.xmlsoap.org/wsdl/}definitions");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRecipientTokenInclusionAlwaysToRecipientPolicy() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Token must be included");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptionAlgorithmSuiteNegative() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                        <sp:ProtectTokens/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setEncryptionSymAlgorithm("http://www.w3.org/2001/04/xmlenc#tripledes-cbc");
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Encryption algorithm http://www.w3.org/2001/04/xmlenc#tripledes-cbc does not meet policy\n" + "Symmetric encryption algorithm key length 192 does not meet policy");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testIncludeTimestampAndSignedUsernameSupportingTokenPolicyNegativeTest2() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "                <sp:SignedSupportingTokens>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:UsernameToken sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                            <wsp:Policy>\n"+ "                                <sp:NoPassword/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:UsernameToken>\n"+ "                    </wsp:Policy>\n"+ "                </sp:SignedSupportingTokens>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.setTokenUser("transmitter");
  outSecurityProperties.setUsernameTokenPasswordType(WSSConstants.UsernameTokenPasswordType.PASSWORD_NONE);
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.USERNAMETOKEN);
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Assertion {http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702}UsernameToken not satisfied");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptBeforeSigningNegativeTest() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:EncryptBeforeSigning/>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Policy enforces EncryptBeforeSigning but the /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Body was signed and then encrypted");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignBeforeEncryptNegativeTest() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:SignBeforeEncrypting/>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.ENCRYPT);
  actions.add(WSSConstants.SIGNATURE);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Policy enforces SignBeforeEncrypting but the /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Body was encrypted and then signed");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureProtectionPolicyNegative2() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_dsig_Signature,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Element /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security/{http://www.w3.org/2000/09/xmldsig#}Signature must not be encrypted");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureAlgorithmSuiteNegative() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                        <sp:ProtectTokens/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha512");
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.addIgnoreBSPRule(BSPRule.R5421);
  inSecurityProperties.addIgnoreBSPRule(BSPRule.R5420);
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Asymmetric algorithm http://www.w3.org/2001/04/xmldsig-more#rsa-sha512 does not meet policy");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInitiatorTokenInclusionAlwaysToRecipientPolicy() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Token must be included");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testIncludeTimestampPolicyNegativeTest() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Timestamp must not be present");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testC14NAlgorithmSuiteNegative() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                        <sp:ProtectTokens/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureCanonicalizationAlgorithm("http://www.w3.org/2006/12/xml-c14n11");
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.addIgnoreBSPRule(BSPRule.R5404);
  inSecurityProperties.addIgnoreBSPRule(BSPRule.R5423);
  inSecurityProperties.addIgnoreBSPRule(BSPRule.R5412);
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"C14N algorithm http://www.w3.org/2006/12/xml-c14n11 does not meet policy");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testIncludeTimestampAndSignedUsernameSupportingTokenPolicyNegativeTest() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "                <sp:SignedSupportingTokens>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:UsernameToken sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                            <wsp:Policy>\n"+ "                                <sp:NoPassword/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:UsernameToken>\n"+ "                    </wsp:Policy>\n"+ "                </sp:SignedSupportingTokens>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.setTokenUser("transmitter");
  outSecurityProperties.setUsernameTokenPasswordType(WSSConstants.UsernameTokenPasswordType.PASSWORD_NONE);
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.USERNAMETOKEN);
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Element /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp must be signed");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEntireHeaderAndBodySignatureNegative2() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                        <sp:OnlySignEntireHeadersAndBody/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(new QName("http://schemas.xmlsoap.org/wsdl/","service"),SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"OnlySignEntireHeadersAndBody not fulfilled, offending element: " + "/{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://schemas.xmlsoap.org/wsdl/}definitions/{http://schemas.xmlsoap.org/wsdl/}service");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureProtectionPolicyNegative1() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:AsymmetricBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:InitiatorToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:WssX509V3Token11/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:InitiatorToken>\n"+ "                        <sp:RecipientToken>\n"+ "                            <wsp:Policy>\n"+ "                              <sp:X509Token sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                                  <sp:IssuerName>CN=receiver,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                  <wsp:Policy>\n"+ "                                      <sp:WssX509V3Token11/>\n"+ "                                  </wsp:Policy>\n"+ "                              </sp:X509Token>\n"+ "                            </wsp:Policy>\n"+ "                         </sp:RecipientToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                        <sp:EncryptSignature/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:AsymmetricBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_CREATED,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_WSU_EXPIRES,SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.AsymmetricBindingTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNotWholeBodySigned() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:IncludeTimestamp/>\n"+ "<sp:EncryptSignature/>\n"+ "<sp:ProtectTokens/>\n"+ "<sp:OnlySignEntireHeadersAndBody/>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  TimestampSecurityEvent timestampSecurityEvent=new TimestampSecurityEvent();
  policyEnforcer.registerSecurityEvent(timestampSecurityEvent);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  x509TokenSecurityEvent=new X509TokenSecurityEvent();
  securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  EncryptedElementSecurityEvent encryptedElementSecurityEvent=new EncryptedElementSecurityEvent(null,true,protectionOrder);
  List<QName> headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  headerPath.add(WSSConstants.TAG_dsig_Signature);
  encryptedElementSecurityEvent.setElementPath(headerPath);
  policyEnforcer.registerSecurityEvent(encryptedElementSecurityEvent);
  encryptedElementSecurityEvent=new EncryptedElementSecurityEvent(null,true,protectionOrder);
  headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  headerPath.add(WSSConstants.TAG_WSSE11_SIG_CONF);
  encryptedElementSecurityEvent.setElementPath(headerPath);
  policyEnforcer.registerSecurityEvent(encryptedElementSecurityEvent);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent(null,true,protectionOrder);
  QName elementName=new QName("http://www.example.com","bodyChildElement");
  signedPartSecurityEvent.setXmlSecEvent(XMLSecEventFactory.createXmlSecStartElement(elementName,null,null));
  List<QName> elementPath=new ArrayList<>();
  elementPath.addAll(WSSConstants.SOAP_11_BODY_PATH);
  elementPath.add(elementName);
  signedPartSecurityEvent.setElementPath(elementPath);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"OnlySignEntireHeadersAndBody not fulfilled, offending element: " + "/{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Body/{http://www.example.com}bodyChildElement");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicySignatureNotEncrypted() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:IncludeTimestamp/>\n"+ "<sp:EncryptSignature/>\n"+ "<sp:ProtectTokens/>\n"+ "<sp:OnlySignEntireHeadersAndBody/>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  TimestampSecurityEvent timestampSecurityEvent=new TimestampSecurityEvent();
  policyEnforcer.registerSecurityEvent(timestampSecurityEvent);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  x509TokenSecurityEvent=new X509TokenSecurityEvent();
  securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  EncryptedElementSecurityEvent encryptedElementSecurityEvent=new EncryptedElementSecurityEvent(null,false,protectionOrder);
  List<QName> headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  headerPath.add(WSSConstants.TAG_dsig_Signature);
  encryptedElementSecurityEvent.setElementPath(headerPath);
  policyEnforcer.registerSecurityEvent(encryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNotIncludeTimestamp() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:EncryptSignature/>\n"+ "<sp:ProtectTokens/>\n"+ "<sp:OnlySignEntireHeadersAndBody/>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  x509TokenSecurityEvent=new X509TokenSecurityEvent();
  securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  TimestampSecurityEvent timestampSecurityEvent=new TimestampSecurityEvent();
  policyEnforcer.registerSecurityEvent(timestampSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Timestamp must not be present");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNotWholeSecurityHeaderChildSigned() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:IncludeTimestamp/>\n"+ "<sp:EncryptSignature/>\n"+ "<sp:ProtectTokens/>\n"+ "<sp:OnlySignEntireHeadersAndBody/>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  TimestampSecurityEvent timestampSecurityEvent=new TimestampSecurityEvent();
  policyEnforcer.registerSecurityEvent(timestampSecurityEvent);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  x509TokenSecurityEvent=new X509TokenSecurityEvent();
  securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  EncryptedElementSecurityEvent encryptedElementSecurityEvent=new EncryptedElementSecurityEvent(null,true,protectionOrder);
  List<QName> headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  headerPath.add(WSSConstants.TAG_dsig_Signature);
  encryptedElementSecurityEvent.setElementPath(headerPath);
  policyEnforcer.registerSecurityEvent(encryptedElementSecurityEvent);
  encryptedElementSecurityEvent=new EncryptedElementSecurityEvent(null,true,protectionOrder);
  headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  headerPath.add(WSSConstants.TAG_WSSE11_SIG_CONF);
  encryptedElementSecurityEvent.setElementPath(headerPath);
  policyEnforcer.registerSecurityEvent(encryptedElementSecurityEvent);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent(null,true,protectionOrder);
  QName elementName=WSSConstants.TAG_WSSE_USERNAME;
  signedPartSecurityEvent.setXmlSecEvent(XMLSecEventFactory.createXmlSecStartElement(elementName,null,null));
  List<QName> elementPath=new ArrayList<>();
  elementPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  elementPath.add(WSSConstants.TAG_WSSE_USERNAME_TOKEN);
  elementPath.add(elementName);
  signedPartSecurityEvent.setElementPath(elementPath);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"OnlySignEntireHeadersAndBody not fulfilled, offending element: " + "/{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}UsernameToken/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Username");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyWrongProtectionOrder() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:IncludeTimestamp/>\n"+ "<sp:EncryptBeforeSigning/>\n"+ "<sp:EncryptSignature/>\n"+ "<sp:ProtectTokens/>\n"+ "<sp:OnlySignEntireHeadersAndBody/>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent(null,true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Policy enforces EncryptBeforeSigning but the /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Body was signed and then encrypted");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.ContentEncryptedElementsTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyMultipleAssertionEventsNegative() throws Exception {
  String policyString="<sp:ContentEncryptedElements xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<sp:XPath xmlns:b=\"http://example.org\">/b:a</sp:XPath>\n" + "</sp:ContentEncryptedElements>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent(null,true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent(null,false,null);
  List<QName> headerPath=new ArrayList<>();
  headerPath.add(new QName("http://example.org","a"));
  contentEncryptedElementSecurityEvent.setElementPath(headerPath);
  try {
    policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Content of element /{http://example.org}a must be encrypted");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.DerivedKeyTests </h4><pre class="type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDerivedKeyInitiatorTokenPolicyNegative() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:InitiatorToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:X509Token>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireDerivedKeys/>\n"+ "           </wsp:Policy>\n"+ "       </sp:X509Token>\n"+ "   </wsp:Policy>\n"+ "</sp:InitiatorToken>\n"+ "<sp:RecipientToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:X509Token>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireDerivedKeys/>\n"+ "           </wsp:Policy>\n"+ "       </sp:X509Token>\n"+ "   </wsp:Policy>\n"+ "</sp:RecipientToken>\n"+ "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  X509TokenSecurityEvent initiatorX509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorX509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorX509TokenSecurityEvent);
  X509TokenSecurityEvent recipientX509TokenSecurityEvent=new X509TokenSecurityEvent();
  securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientX509TokenSecurityEvent.setSecurityToken(securityToken);
  DerivedKeyTokenSecurityEvent derivedKeyTokenSecurityEvent=new DerivedKeyTokenSecurityEvent();
  derivedKeyTokenSecurityEvent.setSecurityToken(getX509Token(WSSecurityTokenConstants.DerivedKeyToken));
  securityToken.addWrappedToken((InboundSecurityToken)derivedKeyTokenSecurityEvent.getSecurityToken());
  policyEnforcer.registerSecurityEvent(recipientX509TokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientX509TokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientX509TokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"Derived key must be used");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDerivedKeyRecipientTokenPolicyNegative() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:InitiatorToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:X509Token>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireDerivedKeys/>\n"+ "           </wsp:Policy>\n"+ "       </sp:X509Token>\n"+ "   </wsp:Policy>\n"+ "</sp:InitiatorToken>\n"+ "<sp:RecipientToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:X509Token>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireDerivedKeys/>\n"+ "           </wsp:Policy>\n"+ "       </sp:X509Token>\n"+ "   </wsp:Policy>\n"+ "</sp:RecipientToken>\n"+ "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  X509TokenSecurityEvent initiatorX509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorX509TokenSecurityEvent.setSecurityToken(securityToken);
  DerivedKeyTokenSecurityEvent derivedKeyTokenSecurityEvent=new DerivedKeyTokenSecurityEvent();
  derivedKeyTokenSecurityEvent.setSecurityToken(getX509Token(WSSecurityTokenConstants.DerivedKeyToken));
  securityToken.addWrappedToken((InboundSecurityToken)derivedKeyTokenSecurityEvent.getSecurityToken());
  policyEnforcer.registerSecurityEvent(initiatorX509TokenSecurityEvent);
  X509TokenSecurityEvent recipientX509TokenSecurityEvent=new X509TokenSecurityEvent();
  securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientX509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientX509TokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientX509TokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientX509TokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"Derived key must be used");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDerivedKeySupportingTokenPolicyNegative() throws Exception {
  String policyString="<sp:SupportingTokens xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "       <sp:X509Token>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireDerivedKeys/>\n"+ "           </wsp:Policy>\n"+ "       </sp:X509Token>\n"+ "   </wsp:Policy>\n"+ "</sp:SupportingTokens>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V1Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"Derived key must be used");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.EncryptedElementsTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyMultipleAssertionEventsNegative() throws Exception {
  String policyString="<sp:EncryptedElements xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<sp:XPath xmlns:b=\"http://example.org\">/b:a</sp:XPath>\n" + "</sp:EncryptedElements>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  EncryptedElementSecurityEvent encryptedElementSecurityEvent=new EncryptedElementSecurityEvent(null,true,protectionOrder);
  encryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(encryptedElementSecurityEvent);
  encryptedElementSecurityEvent=new EncryptedElementSecurityEvent(null,false,null);
  List<QName> headerPath=new ArrayList<>();
  headerPath.add(new QName("http://example.org","a"));
  encryptedElementSecurityEvent.setElementPath(headerPath);
  try {
    policyEnforcer.registerSecurityEvent(encryptedElementSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Element /{http://example.org}a must be encrypted");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.EncryptedPartsTest </h4><pre class="type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyWholeBodyNegative() throws Exception {
  String policyString="<sp:EncryptedParts xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "</sp:EncryptedParts>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  EncryptedPartSecurityEvent encryptedPartSecurityEvent=new EncryptedPartSecurityEvent(null,false,null);
  encryptedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  try {
    policyEnforcer.registerSecurityEvent(encryptedPartSecurityEvent);
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"SOAP-Body must be encrypted");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyWildcardHeaderNegative() throws Exception {
  String policyString="<sp:EncryptedParts xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<sp:Body/>\n" + "<sp:Header Namespace=\"http://example.org\"/>\n"+ "<sp:Attachments/>\n"+ "</sp:EncryptedParts>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  EncryptedPartSecurityEvent encryptedPartSecurityEvent=new EncryptedPartSecurityEvent(null,true,protectionOrder);
  encryptedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(encryptedPartSecurityEvent);
  encryptedPartSecurityEvent=new EncryptedPartSecurityEvent(null,false,null);
  List<QName> headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.SOAP_11_HEADER_PATH);
  headerPath.add(new QName("http://example.org","a"));
  encryptedPartSecurityEvent.setElementPath(headerPath);
  try {
    policyEnforcer.registerSecurityEvent(encryptedPartSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Element /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://example.org}a must be encrypted");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyMultipleAssertionEventsNegative() throws Exception {
  String policyString="<sp:EncryptedParts xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<sp:Body/>\n" + "<sp:Header Name=\"a\" Namespace=\"http://example.org\"/>\n"+ "<sp:Attachments/>\n"+ "</sp:EncryptedParts>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  EncryptedPartSecurityEvent encryptedPartSecurityEvent=new EncryptedPartSecurityEvent(null,true,protectionOrder);
  encryptedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(encryptedPartSecurityEvent);
  encryptedPartSecurityEvent=new EncryptedPartSecurityEvent(null,false,null);
  List<QName> headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.SOAP_11_HEADER_PATH);
  headerPath.add(new QName("http://example.org","a"));
  encryptedPartSecurityEvent.setElementPath(headerPath);
  try {
    policyEnforcer.registerSecurityEvent(encryptedPartSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Element /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://example.org}a must be encrypted");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.HttpsTokenTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNegative() throws Exception {
  String policyString="<sp:TransportBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:TransportToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:HttpsToken>\n"+ "       <sp:IssuerName>xs:anyURI</sp:IssuerName>\n"+ "       <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "           <sp:RequireClientCertificate/>\n"+ "       </wsp:Policy>\n"+ "       </sp:HttpsToken>"+ "   </wsp:Policy>\n"+ "</sp:TransportToken>\n"+ "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:TransportBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  HttpsTokenSecurityEvent httpsTokenSecurityEvent=new HttpsTokenSecurityEvent();
  HttpsSecurityTokenImpl securityToken=getHttpsSecurityToken(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  httpsTokenSecurityEvent.setSecurityToken(securityToken);
  httpsTokenSecurityEvent.setAuthenticationType(HttpsTokenSecurityEvent.AuthenticationType.HttpBasicAuthentication);
  httpsTokenSecurityEvent.setIssuerName("xs:anyURI");
  policyEnforcer.registerSecurityEvent(httpsTokenSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Policy enforces HttpClientCertificateAuthentication but we got HttpBasicAuthentication");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.IssuedTokenTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyWithSAMLTokenMissingClaimType() throws Exception {
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(samlPolicyString);
  SAMLCallback samlCallback=new SAMLCallback();
  samlCallback.setSamlVersion(Version.SAML_20);
  samlCallback.setIssuer("http://initiatorTokenIssuer.com");
  SubjectBean subjectBean=new SubjectBean();
  samlCallback.setSubject(subjectBean);
  List<AttributeStatementBean> attributeStatementBeans=new ArrayList<>();
  List<AttributeBean> attributeBeans=new ArrayList<>();
  List attributeValues=new ArrayList<>();
  attributeValues.add("test@example.com");
  attributeBeans.add(new AttributeBean("email","http://schemas.xmlsoap.org/ws/2005/05/identity/claims/email",attributeValues));
  attributeStatementBeans.add(new AttributeStatementBean(subjectBean,attributeBeans));
  samlCallback.setAttributeStatementData(attributeStatementBeans);
  SamlAssertionWrapper samlAssertionWrapper=createSamlAssertionWrapper(samlCallback);
  SamlTokenSecurityEvent initiatorTokenSecurityEvent=new SamlTokenSecurityEvent();
  SamlSecurityTokenImpl securityToken=new SamlSecurityTokenImpl(samlAssertionWrapper,getX509Token(WSSecurityTokenConstants.X509V3Token),null,null,WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE,null);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  samlCallback.setIssuer("http://recipientTokenIssuer.com");
  samlAssertionWrapper=createSamlAssertionWrapper(samlCallback);
  SamlTokenSecurityEvent recipientTokenSecurityEvent=new SamlTokenSecurityEvent();
  securityToken=new SamlSecurityTokenImpl(samlAssertionWrapper,getX509Token(WSSecurityTokenConstants.X509V3Token),null,null,WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE,null);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Attribute http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname not found in the SAMLAssertion");
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyWithSAMLTokenWrongKeyType() throws Exception {
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(samlPolicyString.replaceFirst("PublicKey","SymmetricKey"));
  SAMLCallback samlCallback=new SAMLCallback();
  samlCallback.setSamlVersion(Version.SAML_20);
  samlCallback.setIssuer("http://initiatorTokenIssuer.com");
  SubjectBean subjectBean=new SubjectBean();
  samlCallback.setSubject(subjectBean);
  List<AttributeStatementBean> attributeStatementBeans=new ArrayList<>();
  List<AttributeBean> attributeBeans=new ArrayList<>();
  List attributeValues=new ArrayList<>();
  attributeValues.add("test@example.com");
  attributeBeans.add(new AttributeBean("email","http://schemas.xmlsoap.org/ws/2005/05/identity/claims/email",attributeValues));
  attributeValues.clear();
  attributeValues.add("Proper");
  attributeBeans.add(new AttributeBean("surname","http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname",attributeValues));
  attributeStatementBeans.add(new AttributeStatementBean(subjectBean,attributeBeans));
  samlCallback.setAttributeStatementData(attributeStatementBeans);
  SamlAssertionWrapper samlAssertionWrapper=createSamlAssertionWrapper(samlCallback);
  SamlTokenSecurityEvent initiatorTokenSecurityEvent=new SamlTokenSecurityEvent();
  SamlSecurityTokenImpl securityToken=new SamlSecurityTokenImpl(samlAssertionWrapper,getX509Token(WSSecurityTokenConstants.X509V3Token),null,null,WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE,null);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  samlCallback.setIssuer("http://recipientTokenIssuer.com");
  samlAssertionWrapper=createSamlAssertionWrapper(samlCallback);
  SamlTokenSecurityEvent recipientTokenSecurityEvent=new SamlTokenSecurityEvent();
  securityToken=new SamlSecurityTokenImpl(samlAssertionWrapper,getX509Token(WSSecurityTokenConstants.X509V3Token),null,null,WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE,null);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Policy enforces SAML token with a symmetric key");
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyWithSAMLTokenWrongIssuer() throws Exception {
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(samlPolicyString);
  SAMLCallback samlCallback=new SAMLCallback();
  samlCallback.setSamlVersion(Version.SAML_20);
  samlCallback.setIssuer("http://initiatorTokenIssuer.com");
  SubjectBean subjectBean=new SubjectBean();
  samlCallback.setSubject(subjectBean);
  List<AttributeStatementBean> attributeStatementBeans=new ArrayList<>();
  List<AttributeBean> attributeBeans=new ArrayList<>();
  List attributeValues=new ArrayList<>();
  attributeValues.add("test@example.com");
  attributeBeans.add(new AttributeBean("email","http://schemas.xmlsoap.org/ws/2005/05/identity/claims/email",attributeValues));
  attributeValues.clear();
  attributeValues.add("Proper");
  attributeBeans.add(new AttributeBean("surname","http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname",attributeValues));
  attributeStatementBeans.add(new AttributeStatementBean(subjectBean,attributeBeans));
  samlCallback.setAttributeStatementData(attributeStatementBeans);
  SamlAssertionWrapper samlAssertionWrapper=createSamlAssertionWrapper(samlCallback);
  SamlTokenSecurityEvent initiatorTokenSecurityEvent=new SamlTokenSecurityEvent();
  SamlSecurityTokenImpl securityToken=new SamlSecurityTokenImpl(samlAssertionWrapper,getX509Token(WSSecurityTokenConstants.X509V3Token),null,null,WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE,null);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  SamlTokenSecurityEvent recipientTokenSecurityEvent=new SamlTokenSecurityEvent();
  securityToken=new SamlSecurityTokenImpl(samlAssertionWrapper,getX509Token(WSSecurityTokenConstants.X509V3Token),null,null,WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE,null);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"IssuerName in Policy (http://recipientTokenIssuer.com) didn't match with the one in the IssuedToken (http://initiatorTokenIssuer.com)");
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyWithSAMLTokenWrongTokenType() throws Exception {
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(samlPolicyString);
  SAMLCallback samlCallback=new SAMLCallback();
  samlCallback.setSamlVersion(Version.SAML_11);
  samlCallback.setIssuer("http://initiatorTokenIssuer.com");
  SubjectBean subjectBean=new SubjectBean();
  samlCallback.setSubject(subjectBean);
  List<AttributeStatementBean> attributeStatementBeans=new ArrayList<>();
  List<AttributeBean> attributeBeans=new ArrayList<>();
  List attributeValues=new ArrayList<>();
  attributeValues.add("test@example.com");
  attributeBeans.add(new AttributeBean("email","http://schemas.xmlsoap.org/ws/2005/05/identity/claims/email",attributeValues));
  attributeValues.clear();
  attributeValues.add("Proper");
  attributeBeans.add(new AttributeBean("surname","http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname",attributeValues));
  attributeStatementBeans.add(new AttributeStatementBean(subjectBean,attributeBeans));
  samlCallback.setAttributeStatementData(attributeStatementBeans);
  SamlAssertionWrapper samlAssertionWrapper=createSamlAssertionWrapper(samlCallback);
  SamlTokenSecurityEvent initiatorTokenSecurityEvent=new SamlTokenSecurityEvent();
  SamlSecurityTokenImpl securityToken=new SamlSecurityTokenImpl(samlAssertionWrapper,getX509Token(WSSecurityTokenConstants.X509V3Token),null,null,WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE,null);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  samlCallback.setIssuer("http://recipientTokenIssuer.com");
  samlAssertionWrapper=createSamlAssertionWrapper(samlCallback);
  SamlTokenSecurityEvent recipientTokenSecurityEvent=new SamlTokenSecurityEvent();
  securityToken=new SamlSecurityTokenImpl(samlAssertionWrapper,getX509Token(WSSecurityTokenConstants.X509V3Token),null,null,WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE,null);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Policy enforces SAML V2.0 token but got 1.1");
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyWithKerberosTokenWrongTokenType() throws Exception {
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(kerberosPolicyString);
  KerberosTokenSecurityEvent initiatorTokenSecurityEvent=new KerberosTokenSecurityEvent();
  initiatorTokenSecurityEvent.setIssuerName("http://initiatorTokenIssuer.com");
  KerberosServiceSecurityTokenImpl securityToken=new KerberosServiceSecurityTokenImpl(null,null,null,"http://docs.oasisopen.org/wss/oasiswss-kerberos-tokenprofile-1.1#GSS_Kerberosv5_AP_REQ","1",WSSecurityTokenConstants.KEYIDENTIFIER_EMBEDDED_KEY_IDENTIFIER_REF);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  KerberosTokenSecurityEvent recipientTokenSecurityEvent=new KerberosTokenSecurityEvent();
  recipientTokenSecurityEvent.setIssuerName("http://recipientTokenIssuer.com");
  securityToken=new KerberosServiceSecurityTokenImpl(null,null,null,"http://docs.oasisopen.org/wss/oasiswss-kerberos-tokenprofile-1.1#Kerberosv5APREQSHA1","1",WSSecurityTokenConstants.KEYIDENTIFIER_EMBEDDED_KEY_IDENTIFIER_REF);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Policy enforces Kerberos token of type http://docs.oasisopen.org/wss/oasiswss-kerberos-tokenprofile-1.1#Kerberosv5APREQSHA1 but got http://docs.oasisopen.org/wss/oasiswss-kerberos-tokenprofile-1.1#GSS_Kerberosv5_AP_REQ");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.KerberosTokenTest </h4><pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNegative() throws Exception {
  String policyString="<sp:SymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:EncryptionToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:KerberosToken>\n"+ "           <sp:IssuerName>xs:anyURI</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:WssKerberosV5ApReqToken11/>\n"+ "           </wsp:Policy>\n"+ "       </sp:KerberosToken>\n"+ "   </wsp:Policy>\n"+ "</sp:EncryptionToken>\n"+ "<sp:SignatureToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:KerberosToken>\n"+ "           <sp:IssuerName>xs:anyURI</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:WssKerberosV5ApReqToken11/>\n"+ "           </wsp:Policy>\n"+ "       </sp:KerberosToken>\n"+ "   </wsp:Policy>\n"+ "</sp:SignatureToken>\n"+ "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:SymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  KerberosTokenSecurityEvent initiatorTokenSecurityEvent=new KerberosTokenSecurityEvent();
  initiatorTokenSecurityEvent.setIssuerName("xs:anyURI");
  KerberosServiceSecurityTokenImpl kerberosServiceSecurityToken=new KerberosServiceSecurityTokenImpl(null,null,null,WSSConstants.NS_GSS_KERBEROS5_AP_REQ,IDGenerator.generateID(null),WSSecurityTokenConstants.KEYIDENTIFIER_THUMBPRINT_IDENTIFIER);
  kerberosServiceSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(kerberosServiceSecurityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  KerberosTokenSecurityEvent recipientTokenSecurityEvent=new KerberosTokenSecurityEvent();
  recipientTokenSecurityEvent.setIssuerName("xs:anyURI");
  kerberosServiceSecurityToken=new KerberosServiceSecurityTokenImpl(null,null,null,WSSConstants.NS_KERBEROS5_AP_REQ,IDGenerator.generateID(null),WSSecurityTokenConstants.KEYIDENTIFIER_THUMBPRINT_IDENTIFIER);
  kerberosServiceSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(kerberosServiceSecurityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"Policy enforces WssKerberosV5ApReqToken11");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.KeyValueTokenTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNegative() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:InitiatorToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:KeyValueToken>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RsaKeyValue/>\n"+ "           </wsp:Policy>\n"+ "       </sp:KeyValueToken>\n"+ "   </wsp:Policy>\n"+ "</sp:InitiatorToken>\n"+ "<sp:RecipientToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:KeyValueToken>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RsaKeyValue/>\n"+ "           </wsp:Policy>\n"+ "       </sp:KeyValueToken>\n"+ "   </wsp:Policy>\n"+ "</sp:RecipientToken>\n"+ "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  KeyValueTokenSecurityEvent initiatorTokenSecurityEvent=new KeyValueTokenSecurityEvent();
  ECKeyValueSecurityTokenImpl securityToken=getECKeyValueSecurityToken();
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  KeyValueTokenSecurityEvent recipientTokenSecurityEvent=new KeyValueTokenSecurityEvent();
  securityToken=getECKeyValueSecurityToken();
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Policy enforces that a RsaKeyValue must be present in the KeyValueToken but we got a ECKeyValueSecurityTokenImpl");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.ProtectionOrderTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyEncryptBeforeSignNegative() throws Exception {
  String policyString="<sp:AsymmetricBinding  xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "   <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "       <sp:EncryptBeforeSigning/>\n"+ "   </wsp:Policy>\n"+ "</sp:AsymmetricBinding>\n";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  EncryptedPartSecurityEvent encryptedPartSecurityEvent=new EncryptedPartSecurityEvent(null,true,protectionOrder);
  encryptedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  try {
    policyEnforcer.registerSecurityEvent(encryptedPartSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Policy enforces EncryptBeforeSigning but the /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Body was signed and then encrypted");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicySignBeforeEncryptNegative() throws Exception {
  String policyString="<sp:AsymmetricBinding  xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "   <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "   </wsp:Policy>\n"+ "</sp:AsymmetricBinding>\n";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent(null,true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  try {
    policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Policy enforces SignBeforeEncrypting but the /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Body was encrypted and then signed");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.RequiredElementsTest </h4><pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyMultipleAssertionEventsNegative() throws Exception {
  String policyString="<sp:RequiredElements xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<sp:XPath xmlns:b=\"http://example.org\">/b:a</sp:XPath>\n" + "</sp:RequiredElements>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  RequiredElementSecurityEvent requiredElementSecurityEvent=new RequiredElementSecurityEvent();
  requiredElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(requiredElementSecurityEvent);
  try {
    policyEnforcer.doFinal();
    Assert.fail("Exception expected");
  }
 catch (  WSSPolicyException e) {
    Assert.assertEquals(e.getMessage(),"Element /{http://example.org}a must be present");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.RequiredPartsTest </h4><pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyMultipleAssertionEventsNegative() throws Exception {
  String policyString="<sp:RequiredParts xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<sp:Header Name=\"a\" Namespace=\"http://example.org\"/>\n" + "</sp:RequiredParts>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  RequiredPartSecurityEvent requiredPartSecurityEvent=new RequiredPartSecurityEvent();
  List<QName> headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.SOAP_11_HEADER_PATH);
  headerPath.add(new QName("http://example.org","b"));
  requiredPartSecurityEvent.setElementPath(headerPath);
  policyEnforcer.registerSecurityEvent(requiredPartSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"Element {http://example.org}a must be present");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.SamlTokenTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNegative() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:InitiatorToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:SamlToken>\n"+ "           <sp:IssuerName>xs:anyURI</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:WssSamlV20Token11/>\n"+ "           </wsp:Policy>\n"+ "       </sp:SamlToken>\n"+ "   </wsp:Policy>\n"+ "</sp:InitiatorToken>\n"+ "<sp:RecipientToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:SamlToken>\n"+ "           <sp:IssuerName>xs:anyURI</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:WssSamlV20Token11/>\n"+ "           </wsp:Policy>\n"+ "       </sp:SamlToken>\n"+ "   </wsp:Policy>\n"+ "</sp:RecipientToken>\n"+ "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  SAMLCallback samlCallback=new SAMLCallback();
  samlCallback.setSamlVersion(Version.SAML_20);
  samlCallback.setIssuer("xs:anyURI");
  SubjectBean subjectBean=new SubjectBean();
  samlCallback.setSubject(subjectBean);
  SamlAssertionWrapper samlAssertionWrapper=createSamlAssertionWrapper(samlCallback);
  SamlTokenSecurityEvent initiatorTokenSecurityEvent=new SamlTokenSecurityEvent();
  SamlSecurityTokenImpl securityToken=new SamlSecurityTokenImpl(samlAssertionWrapper,getX509Token(WSSecurityTokenConstants.X509V3Token),null,null,WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE,null);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  samlCallback.setIssuer("xs:otherURI");
  samlAssertionWrapper=createSamlAssertionWrapper(samlCallback);
  SamlTokenSecurityEvent recipientTokenSecurityEvent=new SamlTokenSecurityEvent();
  securityToken=new SamlSecurityTokenImpl(samlAssertionWrapper,getX509Token(WSSecurityTokenConstants.X509V3Token),null,null,WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE,null);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"IssuerName in Policy (xs:anyURI) didn't match with the one in the SamlToken (xs:otherURI)");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.SecureConversationTokenTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNegative() throws Exception {
  String policyString="<sp:SymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:EncryptionToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:SecureConversationToken>\n"+ "           <sp:IssuerName>xs:anyURI</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireExternalUriReference/>\n"+ "           </wsp:Policy>\n"+ "       </sp:SecureConversationToken>\n"+ "   </wsp:Policy>\n"+ "</sp:EncryptionToken>\n"+ "<sp:SignatureToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:SecureConversationToken>\n"+ "           <sp:IssuerName>xs:anyURI</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireExternalUriReference/>\n"+ "           </wsp:Policy>\n"+ "       </sp:SecureConversationToken>\n"+ "   </wsp:Policy>\n"+ "</sp:SignatureToken>\n"+ "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:SymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  SecurityContextTokenSecurityEvent initiatorTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  initiatorTokenSecurityEvent.setIssuerName("sss");
  initiatorTokenSecurityEvent.setExternalUriRef(true);
  InboundSecurityToken securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  SecurityContextTokenSecurityEvent recipientTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  recipientTokenSecurityEvent.setIssuerName("sss");
  recipientTokenSecurityEvent.setExternalUriRef(true);
  securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"IssuerName in Policy (xs:anyURI) didn't match with the one in the SecurityContextToken (sss)");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.SecurityContextTokenTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNegative() throws Exception {
  String policyString="<sp:SymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:EncryptionToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:SecurityContextToken>\n"+ "           <sp:IssuerName>xs:anyURI</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireExternalUriReference/>\n"+ "           </wsp:Policy>\n"+ "       </sp:SecurityContextToken>\n"+ "   </wsp:Policy>\n"+ "</sp:EncryptionToken>\n"+ "<sp:SignatureToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:SecurityContextToken>\n"+ "           <sp:IssuerName>xs:anyURI</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireExternalUriReference/>\n"+ "           </wsp:Policy>\n"+ "       </sp:SecurityContextToken>\n"+ "   </wsp:Policy>\n"+ "</sp:SignatureToken>\n"+ "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:SymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  SecurityContextTokenSecurityEvent initiatorTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  initiatorTokenSecurityEvent.setIssuerName("sss");
  initiatorTokenSecurityEvent.setExternalUriRef(true);
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  SecurityContextTokenSecurityEvent recipientTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  recipientTokenSecurityEvent.setIssuerName("sss");
  recipientTokenSecurityEvent.setExternalUriRef(true);
  securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"IssuerName in Policy (xs:anyURI) didn't match with the one in the SecurityContextToken (sss)");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.SignedElementsTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyMultipleAssertionEventsNegative() throws Exception {
  String policyString="<sp:SignedElements xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<sp:XPath xmlns:b=\"http://example.org\">/b:a</sp:XPath>\n" + "</sp:SignedElements>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedElementSecurityEvent signedElementSecurityEvent=new SignedElementSecurityEvent(null,true,protectionOrder);
  signedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
  signedElementSecurityEvent=new SignedElementSecurityEvent(null,false,null);
  List<QName> headerPath=new ArrayList<>();
  headerPath.add(new QName("http://example.org","a"));
  signedElementSecurityEvent.setElementPath(headerPath);
  try {
    policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Element /{http://example.org}a must be signed");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.SignedPartsTest </h4><pre class="type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyBodyNegative() throws Exception {
  String policyString="<sp:SignedParts xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "</sp:SignedParts>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent(null,false,null);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  try {
    policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Element /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Body must be signed");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyMultipleAssertionEventsNegative() throws Exception {
  String policyString="<sp:SignedParts xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<sp:Body/>\n" + "<sp:Header Name=\"a\" Namespace=\"http://example.org\"/>\n"+ "<sp:Attachments>\n"+ "<sp3:ContentSignatureTransform/>\n"+ "<sp3:AttachmentCompleteSignatureTransform/>\n"+ "</sp:Attachments>\n"+ "</sp:SignedParts>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent(null,true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  signedPartSecurityEvent=new SignedPartSecurityEvent(null,false,null);
  List<QName> headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.SOAP_11_HEADER_PATH);
  headerPath.add(new QName("http://example.org","a"));
  signedPartSecurityEvent.setElementPath(headerPath);
  try {
    policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Element /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://example.org}a must be signed");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyWildcardHeaderNegative() throws Exception {
  String policyString="<sp:SignedParts xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<sp:Body/>\n" + "<sp:Header Namespace=\"http://example.org\"/>\n"+ "<sp:Attachments>\n"+ "<sp3:ContentSignatureTransform/>\n"+ "<sp3:AttachmentCompleteSignatureTransform/>\n"+ "</sp:Attachments>\n"+ "</sp:SignedParts>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent(null,true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  signedPartSecurityEvent=new SignedPartSecurityEvent(null,false,null);
  List<QName> headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.SOAP_11_HEADER_PATH);
  headerPath.add(new QName("http://example.org","a"));
  signedPartSecurityEvent.setElementPath(headerPath);
  try {
    policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Element /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://example.org}a must be signed");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.SupportingTokensTest </h4><pre class="type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSupportingTokenPolicyNegative() throws Exception {
  String policyString="<sp:SupportingTokens xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "       <sp:X509Token>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireThumbprintReference/>\n"+ "               <sp:WssX509V3Token11/>\n"+ "           </wsp:Policy>\n"+ "       </sp:X509Token>\n"+ "   </wsp:Policy>\n"+ "</sp:SupportingTokens>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl x509SecurityToken=getX509Token(WSSecurityTokenConstants.X509V1Token);
  x509SecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS);
  x509TokenSecurityEvent.setSecurityToken(x509SecurityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"X509Certificate Version 3 mismatch; Policy enforces WssX509V3Token11");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.SymmetricBindingTest </h4><pre class="type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicySignatureNotEncrypted() throws Exception {
  String policyString="<sp:SymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:IncludeTimestamp/>\n"+ "<sp:EncryptSignature/>\n"+ "<sp:ProtectTokens/>\n"+ "<sp:OnlySignEntireHeadersAndBody/>\n"+ "</wsp:Policy>\n"+ "</sp:SymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  TimestampSecurityEvent timestampSecurityEvent=new TimestampSecurityEvent();
  policyEnforcer.registerSecurityEvent(timestampSecurityEvent);
  SecurityContextTokenSecurityEvent initiatorTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  SecureConversationSecurityTokenImpl securityToken=new SecureConversationSecurityTokenImpl(null,"1",WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  SecurityContextTokenSecurityEvent recipientTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  securityToken=new SecureConversationSecurityTokenImpl(null,"1",WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  EncryptedElementSecurityEvent encryptedElementSecurityEvent=new EncryptedElementSecurityEvent(null,false,protectionOrder);
  List<QName> headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  headerPath.add(WSSConstants.TAG_dsig_Signature);
  encryptedElementSecurityEvent.setElementPath(headerPath);
  policyEnforcer.registerSecurityEvent(encryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getCause().getMessage(),"Element /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security/{http://www.w3.org/2000/09/xmldsig#}Signature must be encrypted");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyWrongProtectionOrder() throws Exception {
  String policyString="<sp:SymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:IncludeTimestamp/>\n"+ "<sp:EncryptBeforeSigning/>\n"+ "<sp:EncryptSignature/>\n"+ "<sp:ProtectTokens/>\n"+ "<sp:OnlySignEntireHeadersAndBody/>\n"+ "</wsp:Policy>\n"+ "</sp:SymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  SecurityContextTokenSecurityEvent SecurityContextTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  SecureConversationSecurityTokenImpl securityToken=new SecureConversationSecurityTokenImpl(null,"1",WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  SecurityContextTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(SecurityContextTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent(null,true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Policy enforces EncryptBeforeSigning but the /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Body was signed and then encrypted");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNotWholeBodySigned() throws Exception {
  String policyString="<sp:SymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:IncludeTimestamp/>\n"+ "<sp:EncryptSignature/>\n"+ "<sp:OnlySignEntireHeadersAndBody/>\n"+ "</wsp:Policy>\n"+ "</sp:SymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  TimestampSecurityEvent timestampSecurityEvent=new TimestampSecurityEvent();
  policyEnforcer.registerSecurityEvent(timestampSecurityEvent);
  SecurityContextTokenSecurityEvent initiatorTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  SecureConversationSecurityTokenImpl securityToken=new SecureConversationSecurityTokenImpl(null,"1",WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  SecurityContextTokenSecurityEvent recipientTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  securityToken=new SecureConversationSecurityTokenImpl(null,"1",WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  EncryptedElementSecurityEvent encryptedElementSecurityEvent=new EncryptedElementSecurityEvent(null,true,protectionOrder);
  List<QName> headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  headerPath.add(WSSConstants.TAG_dsig_Signature);
  encryptedElementSecurityEvent.setElementPath(headerPath);
  policyEnforcer.registerSecurityEvent(encryptedElementSecurityEvent);
  encryptedElementSecurityEvent=new EncryptedElementSecurityEvent(null,true,protectionOrder);
  headerPath=new ArrayList<>();
  headerPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  headerPath.add(WSSConstants.TAG_WSSE11_SIG_CONF);
  encryptedElementSecurityEvent.setElementPath(headerPath);
  policyEnforcer.registerSecurityEvent(encryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent(null,true,protectionOrder);
  QName elementName=new QName("http://www.example.com","bodyChildElement");
  signedPartSecurityEvent.setXmlSecEvent(XMLSecEventFactory.createXmlSecStartElement(elementName,null,null));
  List<QName> elementPath=new ArrayList<>();
  elementPath.addAll(WSSConstants.SOAP_11_BODY_PATH);
  elementPath.add(elementName);
  signedPartSecurityEvent.setElementPath(elementPath);
  try {
    policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"OnlySignEntireHeadersAndBody not fulfilled, offending element: " + "/{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Body/{http://www.example.com}bodyChildElement");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNotIncludeTimestamp() throws Exception {
  String policyString="<sp:SymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:EncryptSignature/>\n"+ "<sp:ProtectTokens/>\n"+ "<sp:OnlySignEntireHeadersAndBody/>\n"+ "</wsp:Policy>\n"+ "</sp:SymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  SecurityContextTokenSecurityEvent initiatorTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  SecureConversationSecurityTokenImpl securityToken=new SecureConversationSecurityTokenImpl(null,"1",WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorTokenSecurityEvent);
  SecurityContextTokenSecurityEvent recipientTokenSecurityEvent=new SecurityContextTokenSecurityEvent();
  securityToken=new SecureConversationSecurityTokenImpl(null,"1",WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  TimestampSecurityEvent timestampSecurityEvent=new TimestampSecurityEvent();
  policyEnforcer.registerSecurityEvent(timestampSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Timestamp must not be present");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.TokenProtectionTest </h4><pre class="type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNoTokenProtection() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  List<QName> bstPath=new ArrayList<>();
  bstPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  bstPath.add(WSSConstants.TAG_WSSE_BINARY_SECURITY_TOKEN);
  List<QName> sigPath=new ArrayList<>();
  sigPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  sigPath.add(WSSConstants.TAG_dsig_Signature);
  List<SecurityToken> securityTokens=new LinkedList<>();
  for (int i=0; i < tokenUsages.size(); i++) {
    WSSecurityTokenConstants.TokenUsage tokenUsage=tokenUsages.get(i);
    X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
    X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
    securityTokens.add(securityToken);
    securityToken.setElementPath(bstPath);
    securityToken.addTokenUsage(tokenUsage);
    x509TokenSecurityEvent.setSecurityToken(securityToken);
    policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
    if (tokenUsage.getName().contains("Endorsing")) {
      SignedElementSecurityEvent signedElementSecurityEvent=new SignedElementSecurityEvent(securityToken,true,protectionOrder);
      signedElementSecurityEvent.setElementPath(sigPath);
      policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
    }
  }
  SecurityToken mainSignatureToken=null;
  Iterator<SecurityToken> securityTokenIterator=securityTokens.iterator();
  while (securityTokenIterator.hasNext()) {
    SecurityToken securityToken=securityTokenIterator.next();
    if (securityToken.getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE)) {
      mainSignatureToken=securityToken;
      break;
    }
  }
  securityTokenIterator=securityTokens.iterator();
  while (securityTokenIterator.hasNext()) {
    SecurityToken securityToken=securityTokenIterator.next();
    if (securityToken.getTokenUsages().get(0).getName().contains("Signed")) {
      SignedElementSecurityEvent signedElementSecurityEvent=new SignedElementSecurityEvent((InboundSecurityToken)mainSignatureToken,true,protectionOrder);
      signedElementSecurityEvent.setElementPath(bstPath);
      policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
    }
  }
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Token /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}BinarySecurityToken must not be signed by its signature.");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyEndorsingTokenNotSigningMainSignatureToken() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:ProtectTokens/>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  List<QName> bstPath=new ArrayList<>();
  bstPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  bstPath.add(WSSConstants.TAG_WSSE_BINARY_SECURITY_TOKEN);
  List<SecurityToken> securityTokens=new LinkedList<>();
  for (int i=0; i < tokenUsages.size(); i++) {
    WSSecurityTokenConstants.TokenUsage tokenUsage=tokenUsages.get(i);
    X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
    X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
    securityTokens.add(securityToken);
    securityToken.setElementPath(bstPath);
    securityToken.addTokenUsage(tokenUsage);
    x509TokenSecurityEvent.setSecurityToken(securityToken);
    policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
    if (tokenUsage.getName().contains("Signature") || tokenUsage.getName().contains("Endorsing")) {
      SignedElementSecurityEvent signedElementSecurityEvent=new SignedElementSecurityEvent(securityToken,true,protectionOrder);
      signedElementSecurityEvent.setElementPath(bstPath);
      policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
    }
  }
  SecurityToken mainSignatureToken=null;
  Iterator<SecurityToken> securityTokenIterator=securityTokens.iterator();
  while (securityTokenIterator.hasNext()) {
    SecurityToken securityToken=securityTokenIterator.next();
    if (securityToken.getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE)) {
      mainSignatureToken=securityToken;
      break;
    }
  }
  securityTokenIterator=securityTokens.iterator();
  while (securityTokenIterator.hasNext()) {
    SecurityToken securityToken=securityTokenIterator.next();
    if (securityToken.getTokenUsages().get(0).getName().contains("Signed")) {
      SignedElementSecurityEvent signedElementSecurityEvent=new SignedElementSecurityEvent((InboundSecurityToken)mainSignatureToken,true,protectionOrder);
      signedElementSecurityEvent.setElementPath(bstPath);
      policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
    }
  }
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Token /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}BinarySecurityToken must sign the main signature.");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicySymmetricBindingProtectRootToken() throws Exception {
  String policyString="<sp:SymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:ProtectTokens/>\n"+ "</wsp:Policy>\n"+ "</sp:SymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  List<QName> bstPath=new ArrayList<>();
  bstPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  bstPath.add(WSSConstants.TAG_WSSE_BINARY_SECURITY_TOKEN);
  List<QName> ekPath=new ArrayList<>();
  ekPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  ekPath.add(WSSConstants.TAG_xenc_EncryptedKey);
  List<QName> sigPath=new ArrayList<>();
  sigPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  sigPath.add(WSSConstants.TAG_dsig_Signature);
  X509SecurityTokenImpl x509SecurityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  x509SecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  x509SecurityToken.setElementPath(bstPath);
  AbstractInboundSecurityToken ekSecurityToken=new AbstractInboundSecurityToken(null,IDGenerator.generateID(null),SecurityTokenConstants.KeyIdentifier_EncryptedKey,true){
    @Override public SecurityTokenConstants.TokenType getTokenType(){
      return SecurityTokenConstants.EncryptedKeyToken;
    }
  }
;
  ekSecurityToken.addTokenUsage(WSSecurityTokenConstants.TokenUsage_Signature);
  ekSecurityToken.setKeyWrappingToken(x509SecurityToken);
  ekSecurityToken.setElementPath(ekPath);
  x509SecurityToken.addWrappedToken(ekSecurityToken);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  x509TokenSecurityEvent.setSecurityToken(x509SecurityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  EncryptedKeyTokenSecurityEvent encryptedKeyTokenSecurityEvent=new EncryptedKeyTokenSecurityEvent();
  encryptedKeyTokenSecurityEvent.setSecurityToken(ekSecurityToken);
  policyEnforcer.registerSecurityEvent(encryptedKeyTokenSecurityEvent);
  SignedElementSecurityEvent signedElementSecurityEvent=new SignedElementSecurityEvent(x509SecurityToken,true,protectionOrder);
  signedElementSecurityEvent.setElementPath(bstPath);
  policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Token /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security/{http://www.w3.org/2001/04/xmlenc#}EncryptedKey must be signed by its signature.");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyMainSignatureNotSigningEndorsingSignatureTokens() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:ProtectTokens/>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  List<QName> bstPath=new ArrayList<>();
  bstPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  bstPath.add(WSSConstants.TAG_WSSE_BINARY_SECURITY_TOKEN);
  List<QName> sigPath=new ArrayList<>();
  sigPath.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  sigPath.add(WSSConstants.TAG_dsig_Signature);
  for (int i=0; i < tokenUsages.size(); i++) {
    WSSecurityTokenConstants.TokenUsage tokenUsage=tokenUsages.get(i);
    X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
    X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
    securityToken.setElementPath(bstPath);
    securityToken.addTokenUsage(tokenUsage);
    x509TokenSecurityEvent.setSecurityToken(securityToken);
    policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
    if (tokenUsage.getName().contains("Signature") || tokenUsage.getName().contains("Endorsing")) {
      SignedElementSecurityEvent signedElementSecurityEvent=new SignedElementSecurityEvent(securityToken,true,protectionOrder);
      signedElementSecurityEvent.setElementPath(bstPath);
      policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
    }
    if (tokenUsage.getName().contains("Endorsing")) {
      SignedElementSecurityEvent signedElementSecurityEvent=new SignedElementSecurityEvent(securityToken,true,protectionOrder);
      signedElementSecurityEvent.setElementPath(sigPath);
      policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
    }
  }
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Main signature must sign the Signed*Supporting-Tokens.");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyElementSignedByOtherSignature() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:ProtectTokens/>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  List<QName> path=new ArrayList<>();
  path.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  path.add(WSSConstants.TAG_WSSE_BINARY_SECURITY_TOKEN);
  securityToken.setElementPath(path);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  SignedElementSecurityEvent signedElementSecurityEvent=new SignedElementSecurityEvent(getX509Token(WSSecurityTokenConstants.X509V3Token),false,protectionOrder);
  signedElementSecurityEvent.setElementPath(path);
  policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Token /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}BinarySecurityToken must be signed by its signature.");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyElementNotSigned() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:ProtectTokens/>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  List<QName> path=new ArrayList<>();
  path.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  path.add(WSSConstants.TAG_WSSE_BINARY_SECURITY_TOKEN);
  securityToken.setElementPath(path);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  SignedElementSecurityEvent signedElementSecurityEvent=new SignedElementSecurityEvent(securityToken,false,protectionOrder);
  signedElementSecurityEvent.setElementPath(path);
  policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Token /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}BinarySecurityToken must be signed by its signature.");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyElementSignedByOtherSignatureReverseSecurityEventOrder() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "<sp:ProtectTokens/>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  X509TokenSecurityEvent x509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  List<QName> path=new ArrayList<>();
  path.addAll(WSSConstants.WSSE_SECURITY_HEADER_PATH);
  path.add(WSSConstants.TAG_WSSE_BINARY_SECURITY_TOKEN);
  securityToken.setElementPath(path);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  x509TokenSecurityEvent.setSecurityToken(securityToken);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  SignedElementSecurityEvent signedElementSecurityEvent=new SignedElementSecurityEvent(getX509Token(WSSecurityTokenConstants.X509V3Token),false,protectionOrder);
  signedElementSecurityEvent.setElementPath(path);
  policyEnforcer.registerSecurityEvent(signedElementSecurityEvent);
  policyEnforcer.registerSecurityEvent(x509TokenSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Token /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}BinarySecurityToken must be signed by its signature.");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.TransportBindingIntegrationTest </h4><pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testIncludeTimestampPolicyNegativeTest() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:TransportBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:TransportToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:HttpsToken>\n"+ "                                    <!--<sp:Issuer>wsa:EndpointReferenceType</sp:Issuer>-->\n"+ "                                    <sp:IssuerName>transmitter</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:HttpBasicAuthentication/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:HttpsToken>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:TransportToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:TransportBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,null));
  HttpsTokenSecurityEvent httpsTokenSecurityEvent=new HttpsTokenSecurityEvent();
  httpsTokenSecurityEvent.setIssuerName("transmitter");
  httpsTokenSecurityEvent.setAuthenticationType(HttpsTokenSecurityEvent.AuthenticationType.HttpBasicAuthentication);
  HttpsSecurityTokenImpl httpsSecurityToken=new HttpsSecurityTokenImpl(true,"transmitter");
  httpsSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  httpsTokenSecurityEvent.setSecurityToken(httpsSecurityToken);
  List<SecurityEvent> securityEventList=new ArrayList<>();
  securityEventList.add(httpsTokenSecurityEvent);
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),securityEventList,policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Element /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Header/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security/{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp must be present");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testC14NAlgorithmSuiteNegative() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:TransportBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:TransportToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:HttpsToken>\n"+ "                                    <!--<sp:Issuer>wsa:EndpointReferenceType</sp:Issuer>-->\n"+ "                                    <sp:IssuerName>transmitter</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:HttpBasicAuthentication/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:HttpsToken>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:TransportToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:TransportBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureCanonicalizationAlgorithm("http://www.w3.org/2006/12/xml-c14n11");
  outSecurityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart()),SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.TAG_WSU_CREATED.getNamespaceURI(),WSSConstants.TAG_WSU_CREATED.getLocalPart()),SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.TAG_WSU_EXPIRES.getNamespaceURI(),WSSConstants.TAG_WSU_EXPIRES.getLocalPart()),SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.addIgnoreBSPRule(BSPRule.R5404);
  inSecurityProperties.addIgnoreBSPRule(BSPRule.R5423);
  inSecurityProperties.addIgnoreBSPRule(BSPRule.R5412);
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,null));
  HttpsTokenSecurityEvent httpsTokenSecurityEvent=new HttpsTokenSecurityEvent();
  httpsTokenSecurityEvent.setIssuerName("transmitter");
  httpsTokenSecurityEvent.setAuthenticationType(HttpsTokenSecurityEvent.AuthenticationType.HttpBasicAuthentication);
  HttpsSecurityTokenImpl httpsSecurityToken=new HttpsSecurityTokenImpl(true,"transmitter");
  httpsSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  httpsTokenSecurityEvent.setSecurityToken(httpsSecurityToken);
  List<SecurityEvent> securityEventList=new ArrayList<>();
  securityEventList.add(httpsTokenSecurityEvent);
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),securityEventList,policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"C14N algorithm http://www.w3.org/2006/12/xml-c14n11 does not meet policy");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHttpsClientAuthenticationPolicyNegative() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:TransportBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:TransportToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:HttpsToken>\n"+ "                                    <!--<sp:Issuer>wsa:EndpointReferenceType</sp:Issuer>-->\n"+ "                                    <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:RequireClientCertificate/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:HttpsToken>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:TransportToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:TransportBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "                <sp:SignedSupportingTokens>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:UsernameToken sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                            <wsp:Policy>\n"+ "                                <!--<sp:HashPassword/>-->\n"+ "                                <sp:NoPassword/>\n"+ "                                <!--<sp:Created/>\n"+ "                                <sp:Nonce/>-->\n"+ "                            </wsp:Policy>\n"+ "                        </sp:UsernameToken>\n"+ "                    </wsp:Policy>\n"+ "                </sp:SignedSupportingTokens>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.setTokenUser("transmitter");
  outSecurityProperties.setUsernameTokenPasswordType(WSSConstants.UsernameTokenPasswordType.PASSWORD_NONE);
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.USERNAMETOKEN);
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,null));
  HttpsTokenSecurityEvent httpsTokenSecurityEvent=new HttpsTokenSecurityEvent();
  httpsTokenSecurityEvent.setIssuerName("CN=example,OU=swssf,C=CH");
  httpsTokenSecurityEvent.setAuthenticationType(HttpsTokenSecurityEvent.AuthenticationType.HttpsClientCertificateAuthentication);
  HttpsSecurityTokenImpl httpsSecurityToken=new HttpsSecurityTokenImpl(true,"CN=example,OU=swssf,C=CH");
  httpsSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  httpsTokenSecurityEvent.setSecurityToken(httpsSecurityToken);
  List<SecurityEvent> securityEventList=new ArrayList<>();
  securityEventList.add(httpsTokenSecurityEvent);
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),securityEventList,policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"IssuerName in Policy (CN=transmitter,OU=swssf,C=CH) didn't match with the one in the HttpsToken (CN=example,OU=swssf,C=CH)");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testIncludeTimestampAndSignedUsernameSupportingTokenPolicyNegativeTest_2() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:TransportBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:TransportToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:HttpsToken>\n"+ "                                    <!--<sp:Issuer>wsa:EndpointReferenceType</sp:Issuer>-->\n"+ "                                    <sp:IssuerName>transmitter</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:HttpBasicAuthentication/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:HttpsToken>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:TransportToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                    </wsp:Policy>\n"+ "                </sp:TransportBinding>\n"+ "                <sp:SignedSupportingTokens>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:UsernameToken sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                            <wsp:Policy>\n"+ "                                <sp:NoPassword/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:UsernameToken>\n"+ "                    </wsp:Policy>\n"+ "                </sp:SignedSupportingTokens>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.setTokenUser("transmitter");
  outSecurityProperties.setUsernameTokenPasswordType(WSSConstants.UsernameTokenPasswordType.PASSWORD_NONE);
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  HttpsTokenSecurityEvent httpsTokenSecurityEvent=new HttpsTokenSecurityEvent();
  httpsTokenSecurityEvent.setIssuerName("transmitter");
  httpsTokenSecurityEvent.setAuthenticationType(HttpsTokenSecurityEvent.AuthenticationType.HttpBasicAuthentication);
  HttpsSecurityTokenImpl httpsSecurityToken=new HttpsSecurityTokenImpl(true,"transmitter");
  httpsSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  httpsTokenSecurityEvent.setSecurityToken(httpsSecurityToken);
  List<SecurityEvent> securityEventList=new ArrayList<>();
  securityEventList.add(httpsTokenSecurityEvent);
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),securityEventList,policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Assertion {http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702}UsernameToken not satisfied");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureAlgorithmSuiteNegative() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:TransportBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:TransportToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:HttpsToken>\n"+ "                                    <!--<sp:Issuer>wsa:EndpointReferenceType</sp:Issuer>-->\n"+ "                                    <sp:IssuerName>transmitter</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:HttpBasicAuthentication/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:HttpsToken>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:TransportToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:TransportBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-sha512");
  outSecurityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart()),SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.TAG_WSU_CREATED.getNamespaceURI(),WSSConstants.TAG_WSU_CREATED.getLocalPart()),SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.TAG_WSU_EXPIRES.getNamespaceURI(),WSSConstants.TAG_WSU_EXPIRES.getLocalPart()),SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.addIgnoreBSPRule(BSPRule.R5421);
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,null));
  HttpsTokenSecurityEvent httpsTokenSecurityEvent=new HttpsTokenSecurityEvent();
  httpsTokenSecurityEvent.setIssuerName("transmitter");
  httpsTokenSecurityEvent.setAuthenticationType(HttpsTokenSecurityEvent.AuthenticationType.HttpBasicAuthentication);
  HttpsSecurityTokenImpl httpsSecurityToken=new HttpsSecurityTokenImpl(true,"transmitter");
  httpsSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  httpsTokenSecurityEvent.setSecurityToken(httpsSecurityToken);
  List<SecurityEvent> securityEventList=new ArrayList<>();
  securityEventList.add(httpsTokenSecurityEvent);
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),securityEventList,policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Asymmetric algorithm http://www.w3.org/2001/04/xmldsig-more#rsa-sha512 does not meet policy");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testIncludeTimestampAndSignedUsernameSupportingTokenPolicyNegativeTest() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:TransportBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:TransportToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:HttpsToken>\n"+ "                                    <!--<sp:Issuer>wsa:EndpointReferenceType</sp:Issuer>-->\n"+ "                                    <sp:IssuerName>transmitter</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:HttpBasicAuthentication/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:HttpsToken>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:TransportToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:TransportBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "                <sp:SignedSupportingTokens>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:UsernameToken sp:IncludeToken=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient\">\n"+ "                            <wsp:Policy>\n"+ "                                <sp:NoPassword/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:UsernameToken>\n"+ "                    </wsp:Policy>\n"+ "                </sp:SignedSupportingTokens>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.setTokenUser("transmitter");
  outSecurityProperties.setUsernameTokenPasswordType(WSSConstants.UsernameTokenPasswordType.PASSWORD_NONE);
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,null));
  HttpsTokenSecurityEvent httpsTokenSecurityEvent=new HttpsTokenSecurityEvent();
  httpsTokenSecurityEvent.setIssuerName("transmitter");
  httpsTokenSecurityEvent.setAuthenticationType(HttpsTokenSecurityEvent.AuthenticationType.HttpBasicAuthentication);
  HttpsSecurityTokenImpl httpsSecurityToken=new HttpsSecurityTokenImpl(true,"transmitter");
  httpsSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  httpsTokenSecurityEvent.setSecurityToken(httpsSecurityToken);
  List<SecurityEvent> securityEventList=new ArrayList<>();
  securityEventList.add(httpsTokenSecurityEvent);
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),securityEventList,policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Assertion {http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702}UsernameToken not satisfied");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptionAlgorithmSuiteNegative() throws Exception {
  String policyString="<wsp:ExactlyOne xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\" " + "xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\">\n" + "            <wsp:All>\n"+ "                <sp:TransportBinding>\n"+ "                    <wsp:Policy>\n"+ "                        <sp:TransportToken>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:HttpsToken>\n"+ "                                    <!--<sp:Issuer>wsa:EndpointReferenceType</sp:Issuer>-->\n"+ "                                    <sp:IssuerName>transmitter</sp:IssuerName>\n"+ "                                    <wsp:Policy>\n"+ "                                        <sp:HttpBasicAuthentication/>\n"+ "                                    </wsp:Policy>\n"+ "                                </sp:HttpsToken>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:TransportToken>\n"+ "                        <sp:AlgorithmSuite>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Basic256/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:AlgorithmSuite>\n"+ "                        <sp:Layout>\n"+ "                            <wsp:Policy>\n"+ "                                <sp:Lax/>\n"+ "                            </wsp:Policy>\n"+ "                        </sp:Layout>\n"+ "                        <sp:IncludeTimestamp/>\n"+ "                    </wsp:Policy>\n"+ "                </sp:TransportBinding>\n"+ "                <sp:SignedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header1\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:SignedParts>\n"+ "                <sp:SignedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:SignedElements>\n"+ "                <sp:EncryptedParts>\n"+ "                    <sp:Body/>\n"+ "                    <sp:Header Name=\"Header2\" Namespace=\"...\"/>\n"+ "                    <sp:Header Namespace=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"/>\n"+ "                </sp:EncryptedParts>\n"+ "                <sp:EncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Created</sp:XPath>\n"+ "                </sp:EncryptedElements>\n"+ "                <sp:ContentEncryptedElements>\n"+ "                    <sp:XPath xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\">wsu:Expires</sp:XPath>\n"+ "                </sp:ContentEncryptedElements>\n"+ "            </wsp:All>\n"+ "        </wsp:ExactlyOne>";
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setEncryptionSymAlgorithm("http://www.w3.org/2001/04/xmlenc#tripledes-cbc");
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart()),SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.TAG_WSU_CREATED.getNamespaceURI(),WSSConstants.TAG_WSU_CREATED.getLocalPart()),SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.TAG_WSU_EXPIRES.getNamespaceURI(),WSSConstants.TAG_WSU_EXPIRES.getLocalPart()),SecurePart.Modifier.Content));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,null));
  HttpsTokenSecurityEvent httpsTokenSecurityEvent=new HttpsTokenSecurityEvent();
  httpsTokenSecurityEvent.setIssuerName("transmitter");
  httpsTokenSecurityEvent.setAuthenticationType(HttpsTokenSecurityEvent.AuthenticationType.HttpBasicAuthentication);
  HttpsSecurityTokenImpl httpsSecurityToken=new HttpsSecurityTokenImpl(true,"transmitter");
  httpsSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  httpsTokenSecurityEvent.setSecurityToken(httpsSecurityToken);
  List<SecurityEvent> securityEventList=new ArrayList<>();
  securityEventList.add(httpsTokenSecurityEvent);
  try {
    Document document=doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),securityEventList,policyEnforcer);
    Transformer transformer=TransformerFactory.newInstance().newTransformer();
    transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
      @Override public void write(      int b) throws IOException {
      }
    }
));
    Assert.fail("Exception expected");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(e.getCause().getMessage(),"Encryption algorithm http://www.w3.org/2001/04/xmlenc#tripledes-cbc does not meet policy\n" + "Symmetric encryption algorithm key length 192 does not meet policy");
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.TransportBindingTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNotIncludeTimestamp() throws Exception {
  String policyString="<sp:TransportBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:TransportBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  HttpsTokenSecurityEvent httpsTokenSecurityEvent=new HttpsTokenSecurityEvent();
  HttpsSecurityTokenImpl httpsSecurityToken=new HttpsSecurityTokenImpl(true,"username");
  httpsSecurityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  httpsTokenSecurityEvent.setSecurityToken(httpsSecurityToken);
  policyEnforcer.registerSecurityEvent(httpsTokenSecurityEvent);
  TimestampSecurityEvent timestampSecurityEvent=new TimestampSecurityEvent();
  policyEnforcer.registerSecurityEvent(timestampSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"Timestamp must not be present");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.UsernameTokenTest </h4><pre class="type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNegative() throws Exception {
  String policyString="<sp:SymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:EncryptionToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:UsernameToken>\n"+ "           <sp:IssuerName>xs:anyURI</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:HashPassword/>\n"+ "               <sp:WssUsernameToken11/>\n"+ "           </wsp:Policy>\n"+ "       </sp:UsernameToken>\n"+ "   </wsp:Policy>\n"+ "</sp:EncryptionToken>\n"+ "<sp:SignatureToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:UsernameToken>\n"+ "           <sp:IssuerName>xs:anyURI</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:HashPassword/>\n"+ "               <sp:WssUsernameToken11/>\n"+ "           </wsp:Policy>\n"+ "       </sp:UsernameToken>\n"+ "   </wsp:Policy>\n"+ "</sp:SignatureToken>\n"+ "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:SymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  UsernameTokenSecurityEvent usernameTokenSecurityEvent=new UsernameTokenSecurityEvent();
  usernameTokenSecurityEvent.setUsernameTokenProfile(WSSConstants.NS_USERNAMETOKEN_PROFILE11);
  UsernameSecurityTokenImpl securityToken=new UsernameSecurityTokenImpl(WSSConstants.UsernameTokenPasswordType.PASSWORD_TEXT,"username","password",new Date().toString(),null,new byte[10],10L,null,IDGenerator.generateID(null),WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  usernameTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(usernameTokenSecurityEvent);
  UsernameTokenSecurityEvent recipientTokenSecurityEvent=new UsernameTokenSecurityEvent();
  recipientTokenSecurityEvent.setUsernameTokenProfile(WSSConstants.NS_USERNAMETOKEN_PROFILE11);
  securityToken=new UsernameSecurityTokenImpl(WSSConstants.UsernameTokenPasswordType.PASSWORD_TEXT,"username","password",new Date().toString(),null,new byte[10],10L,null,IDGenerator.generateID(null),WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientTokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientTokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientTokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertTrue(e.getCause() instanceof PolicyViolationException);
    Assert.assertEquals(e.getCause().getMessage(),"UsernameToken does not contain a hashed password");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.VulnerabliltyVectorsTest </h4><pre class="type-3 type-8 type-7 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignedBodyRelocationToHeader() throws Exception {
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  properties.setProperty(WSHandlerConstants.ENC_SYM_ALGO,"http://www.w3.org/2001/04/xmlenc#aes256-cbc");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Body");
  Element bodyElement=(Element)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
  Element soapEnvElement=(Element)bodyElement.getParentNode();
  soapEnvElement.removeChild(bodyElement);
  Element newBody=securedDocument.createElementNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
  Element operationElement=securedDocument.createElementNS("http://schemas.xmlsoap.org/wsdl/","definitions");
  newBody.appendChild(operationElement);
  soapEnvElement.appendChild(newBody);
  xPathExpression=getXPath("/soap:Envelope/soap:Header");
  Element headerElement=(Element)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
  headerElement.appendChild(bodyElement);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcerFactory policyEnforcerFactory=PolicyEnforcerFactory.newInstance(this.getClass().getClassLoader().getResource("testdata/wsdl/actionSpoofing.wsdl"));
  PolicyEnforcer policyEnforcer=policyEnforcerFactory.newPolicyEnforcer("goodPolicy",false,null,0);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    doInboundSecurity(inSecurityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),policyEnforcer);
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Throwable throwable=e.getCause();
    Assert.assertNotNull(throwable);
    Assert.assertTrue(throwable instanceof WSSecurityException);
    Assert.assertEquals(throwable.getMessage(),"Element /{http://schemas.xmlsoap.org/soap/envelope/}Envelope/{http://schemas.xmlsoap.org/soap/envelope/}Body must be signed");
    Assert.assertEquals(((WSSecurityException)throwable).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests what happens when an soapAction from an other operation is provided.
 * Can the policy framework be bypassed?
 * @Ignoring as SOAP Action spoofing detection should be left to the SOAP stack
 */
@Test @org.junit.Ignore public void testSOAPActionSpoofing() throws Exception {
  WSSSecurityProperties outSecurityProperties=new WSSSecurityProperties();
  outSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outSecurityProperties.setEncryptionUser("receiver");
  outSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.setSignatureUser("transmitter");
  outSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSU_TIMESTAMP,SecurePart.Modifier.Element));
  outSecurityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
  outSecurityProperties.addEncryptionPart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Content));
  List<WSSConstants.Action> actions=new ArrayList<>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outSecurityProperties,sourceDocument);
  WSSSecurityProperties inSecurityProperties=new WSSSecurityProperties();
  inSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  PolicyEnforcerFactory policyEnforcerFactory=PolicyEnforcerFactory.newInstance(this.getClass().getClassLoader().getResource("testdata/wsdl/actionSpoofing.wsdl"));
  PolicyEnforcer policyEnforcer=policyEnforcerFactory.newPolicyEnforcer("emptyPolicy",false,null,0);
  inSecurityProperties.addInputProcessor(new PolicyInputProcessor(policyEnforcer,inSecurityProperties));
  try {
    doInboundSecurity(inSecurityProperties,new ByteArrayInputStream(baos.toByteArray()),policyEnforcer);
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Throwable throwable=e.getCause();
    Assert.assertNotNull(throwable);
    Assert.assertTrue(throwable instanceof WSSecurityException);
    Assert.assertEquals(throwable.getMessage(),"SOAPAction (emptyPolicyOperation) does not match with the current Operation: " + "{http://schemas.xmlsoap.org/wsdl/}definitions");
    Assert.assertEquals(((WSSecurityException)throwable).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.stax.test.X509TokenTest </h4><pre class="type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPolicyNegative() throws Exception {
  String policyString="<sp:AsymmetricBinding xmlns:sp=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702\" xmlns:sp3=\"http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200802\">\n" + "<wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n" + "<sp:InitiatorToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:X509Token>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireThumbprintReference/>\n"+ "               <sp:WssX509V3Token11/>\n"+ "           </wsp:Policy>\n"+ "       </sp:X509Token>\n"+ "   </wsp:Policy>\n"+ "</sp:InitiatorToken>\n"+ "<sp:RecipientToken>\n"+ "   <wsp:Policy>\n"+ "       <sp:X509Token>\n"+ "           <sp:IssuerName>CN=transmitter,OU=swssf,C=CH</sp:IssuerName>\n"+ "           <wsp:Policy xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2004/09/policy\">\n"+ "               <sp:RequireThumbprintReference/>\n"+ "               <sp:WssX509V3Token11/>\n"+ "           </wsp:Policy>\n"+ "       </sp:X509Token>\n"+ "   </wsp:Policy>\n"+ "</sp:RecipientToken>\n"+ "   <sp:AlgorithmSuite>\n"+ "       <wsp:Policy>\n"+ "           <sp:Basic256/>\n"+ "       </wsp:Policy>\n"+ "   </sp:AlgorithmSuite>\n"+ "</wsp:Policy>\n"+ "</sp:AsymmetricBinding>";
  PolicyEnforcer policyEnforcer=buildAndStartPolicyEngine(policyString);
  X509TokenSecurityEvent initiatorX509TokenSecurityEvent=new X509TokenSecurityEvent();
  X509SecurityTokenImpl securityToken=getX509Token(WSSecurityTokenConstants.X509V1Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE);
  initiatorX509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(initiatorX509TokenSecurityEvent);
  X509TokenSecurityEvent recipientX509TokenSecurityEvent=new X509TokenSecurityEvent();
  securityToken=getX509Token(WSSecurityTokenConstants.X509V3Token);
  securityToken.addTokenUsage(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION);
  recipientX509TokenSecurityEvent.setSecurityToken(securityToken);
  policyEnforcer.registerSecurityEvent(recipientX509TokenSecurityEvent);
  List<XMLSecurityConstants.ContentType> protectionOrder=new LinkedList<>();
  protectionOrder.add(XMLSecurityConstants.ContentType.SIGNATURE);
  protectionOrder.add(XMLSecurityConstants.ContentType.ENCRYPTION);
  SignedPartSecurityEvent signedPartSecurityEvent=new SignedPartSecurityEvent((InboundSecurityToken)recipientX509TokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  signedPartSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(signedPartSecurityEvent);
  ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=new ContentEncryptedElementSecurityEvent((InboundSecurityToken)recipientX509TokenSecurityEvent.getSecurityToken(),true,protectionOrder);
  contentEncryptedElementSecurityEvent.setElementPath(WSSConstants.SOAP_11_BODY_PATH);
  policyEnforcer.registerSecurityEvent(contentEncryptedElementSecurityEvent);
  OperationSecurityEvent operationSecurityEvent=new OperationSecurityEvent();
  operationSecurityEvent.setOperation(new QName("definitions"));
  try {
    policyEnforcer.registerSecurityEvent(operationSecurityEvent);
    Assert.fail("Exception expected");
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"X509Certificate Version 3 mismatch; Policy enforces WssX509V3Token11");
    Assert.assertEquals(e.getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.AlgorithmSuiteTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAlgorithmSuite() throws Exception {
  String fileName="AlgorithmSuite.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof AlgorithmSuite);
    AlgorithmSuite algorithmSuite=(AlgorithmSuite)alternative.get(0);
    assertFalse(algorithmSuite.isNormalized());
    assertTrue(algorithmSuite.isIgnorable());
    assertTrue(algorithmSuite.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,algorithmSuite.getType());
    assertEquals(SP12Constants.ALGORITHM_SUITE,algorithmSuite.getName());
    assertEquals(algorithmSuite.getAlgorithmSuiteType().getEncryption(),SPConstants.TRIPLE_DES);
    assertEquals(AlgorithmSuite.C14NType.InclusiveC14N,algorithmSuite.getC14n());
    assertEquals(AlgorithmSuite.SOAPNormType.SOAPNormalization10,algorithmSuite.getSoapNormType());
    assertEquals(AlgorithmSuite.STRType.STRTransform10,algorithmSuite.getStrType());
    assertEquals(AlgorithmSuite.XPathType.AbsXPath,algorithmSuite.getXPathType());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  AlgorithmSuite algorithmSuite=(AlgorithmSuite)policyComponentIterator.next();
  assertTrue(algorithmSuite.isNormalized());
  assertTrue(algorithmSuite.isIgnorable());
  assertFalse(algorithmSuite.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,algorithmSuite.getType());
  assertEquals(SP12Constants.ALGORITHM_SUITE,algorithmSuite.getName());
  assertEquals(algorithmSuite.getAlgorithmSuiteType().getEncryption(),SPConstants.TRIPLE_DES);
  assertEquals(AlgorithmSuite.C14NType.InclusiveC14N,algorithmSuite.getC14n());
  assertEquals(AlgorithmSuite.SOAPNormType.SOAPNormalization10,algorithmSuite.getSoapNormType());
  assertEquals(AlgorithmSuite.STRType.STRTransform10,algorithmSuite.getStrType());
  assertEquals(AlgorithmSuite.XPathType.AbsXPath,algorithmSuite.getXPathType());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.AsymmetricBindingTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAsymmetricBinding() throws Exception {
  String fileName="AsymmetricBinding.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof AsymmetricBinding);
    AsymmetricBinding asymmetricBinding=(AsymmetricBinding)alternative.get(0);
    assertFalse(asymmetricBinding.isNormalized());
    assertTrue(asymmetricBinding.isIgnorable());
    assertTrue(asymmetricBinding.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,asymmetricBinding.getType());
    assertEquals(SP12Constants.ASYMMETRIC_BINDING,asymmetricBinding.getName());
    assertNotNull(asymmetricBinding.getInitiatorEncryptionToken());
    assertNotNull(asymmetricBinding.getInitiatorSignatureToken());
    assertNull(asymmetricBinding.getInitiatorToken());
    assertNotNull(asymmetricBinding.getRecipientEncryptionToken());
    assertNotNull(asymmetricBinding.getRecipientSignatureToken());
    assertNull(asymmetricBinding.getRecipientToken());
    assertNotNull(asymmetricBinding.getAlgorithmSuite());
    assertNotNull(asymmetricBinding.getLayout());
    assertEquals(AbstractSymmetricAsymmetricBinding.ProtectionOrder.EncryptBeforeSigning,asymmetricBinding.getProtectionOrder());
    assertTrue(asymmetricBinding.isEncryptSignature());
    assertTrue(asymmetricBinding.isIncludeTimestamp());
    assertTrue(asymmetricBinding.isOnlySignEntireHeadersAndBody());
    assertTrue(asymmetricBinding.isProtectTokens());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  AsymmetricBinding asymmetricBinding=(AsymmetricBinding)policyComponentIterator.next();
  assertTrue(asymmetricBinding.isNormalized());
  assertTrue(asymmetricBinding.isIgnorable());
  assertFalse(asymmetricBinding.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,asymmetricBinding.getType());
  assertEquals(SP12Constants.ASYMMETRIC_BINDING,asymmetricBinding.getName());
  assertNotNull(asymmetricBinding.getInitiatorEncryptionToken());
  assertNotNull(asymmetricBinding.getInitiatorSignatureToken());
  assertNull(asymmetricBinding.getInitiatorToken());
  assertNotNull(asymmetricBinding.getRecipientEncryptionToken());
  assertNotNull(asymmetricBinding.getRecipientSignatureToken());
  assertNull(asymmetricBinding.getRecipientToken());
  assertNotNull(asymmetricBinding.getAlgorithmSuite());
  assertNotNull(asymmetricBinding.getLayout());
  assertEquals(AbstractSymmetricAsymmetricBinding.ProtectionOrder.EncryptBeforeSigning,asymmetricBinding.getProtectionOrder());
  assertTrue(asymmetricBinding.isEncryptSignature());
  assertTrue(asymmetricBinding.isIncludeTimestamp());
  assertTrue(asymmetricBinding.isOnlySignEntireHeadersAndBody());
  assertTrue(asymmetricBinding.isProtectTokens());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.ContentEncryptedElementsTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testContentEncryptedElements() throws Exception {
  String fileName="ContentEncryptedElements.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof ContentEncryptedElements);
    ContentEncryptedElements contentEncryptedElements=(ContentEncryptedElements)alternative.get(0);
    assertFalse(contentEncryptedElements.isNormalized());
    assertTrue(contentEncryptedElements.isIgnorable());
    assertTrue(contentEncryptedElements.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,contentEncryptedElements.getType());
    assertEquals(SP12Constants.CONTENT_ENCRYPTED_ELEMENTS,contentEncryptedElements.getName());
    assertEquals("1.1",contentEncryptedElements.getXPathVersion());
    assertEquals(2,contentEncryptedElements.getXPaths().size());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  ContentEncryptedElements contentEncryptedElements=(ContentEncryptedElements)policyComponentIterator.next();
  assertTrue(contentEncryptedElements.isNormalized());
  assertTrue(contentEncryptedElements.isIgnorable());
  assertFalse(contentEncryptedElements.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,contentEncryptedElements.getType());
  assertEquals(SP12Constants.CONTENT_ENCRYPTED_ELEMENTS,contentEncryptedElements.getName());
  assertEquals("1.1",contentEncryptedElements.getXPathVersion());
  assertEquals(2,contentEncryptedElements.getXPaths().size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.EncryptedElementsTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptedElements() throws Exception {
  String fileName="EncryptedElements.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof EncryptedElements);
    EncryptedElements encryptedElements=(EncryptedElements)alternative.get(0);
    assertFalse(encryptedElements.isNormalized());
    assertTrue(encryptedElements.isIgnorable());
    assertTrue(encryptedElements.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,encryptedElements.getType());
    assertEquals(SP12Constants.ENCRYPTED_ELEMENTS,encryptedElements.getName());
    assertEquals("1.1",encryptedElements.getXPathVersion());
    assertEquals(2,encryptedElements.getXPaths().size());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  EncryptedElements encryptedElements=(EncryptedElements)policyComponentIterator.next();
  assertTrue(encryptedElements.isNormalized());
  assertTrue(encryptedElements.isIgnorable());
  assertFalse(encryptedElements.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,encryptedElements.getType());
  assertEquals(SP12Constants.ENCRYPTED_ELEMENTS,encryptedElements.getName());
  assertEquals("1.1",encryptedElements.getXPathVersion());
  assertEquals(2,encryptedElements.getXPaths().size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.EncryptedPartsTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptedParts12() throws Exception {
  String fileName="EncryptedParts.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof EncryptedParts);
    EncryptedParts encryptedParts=(EncryptedParts)alternative.get(0);
    assertFalse(encryptedParts.isNormalized());
    assertTrue(encryptedParts.isIgnorable());
    assertTrue(encryptedParts.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,encryptedParts.getType());
    assertEquals(SP12Constants.ENCRYPTED_PARTS,encryptedParts.getName());
    assertTrue(encryptedParts.isBody());
    assertNotNull(encryptedParts.getAttachments());
    assertEquals(2,encryptedParts.getHeaders().size());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  EncryptedParts encryptedParts=(EncryptedParts)policyComponentIterator.next();
  assertTrue(encryptedParts.isNormalized());
  assertTrue(encryptedParts.isIgnorable());
  assertFalse(encryptedParts.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,encryptedParts.getType());
  assertEquals(SP12Constants.ENCRYPTED_PARTS,encryptedParts.getName());
  assertTrue(encryptedParts.isBody());
  assertNotNull(encryptedParts.getAttachments());
  assertEquals(2,encryptedParts.getHeaders().size());
}

</code></pre>

<br>
<pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptedParts13() throws Exception {
  String fileName="EncryptedParts.xml";
  String policyFile=loadPolicyFile("policy/model/sp13/" + fileName);
  String serializedPolicyRefereneFile=loadPolicyFile("policy/model/sp13/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp13/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyRefereneFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof EncryptedParts);
    EncryptedParts encryptedParts=(EncryptedParts)alternative.get(0);
    assertFalse(encryptedParts.isNormalized());
    assertTrue(encryptedParts.isIgnorable());
    assertTrue(encryptedParts.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,encryptedParts.getType());
    assertEquals(SP12Constants.ENCRYPTED_PARTS,encryptedParts.getName());
    assertTrue(encryptedParts.isBody());
    assertNotNull(encryptedParts.getAttachments());
    assertTrue(encryptedParts.getAttachments().isContentSignatureTransform());
    assertTrue(encryptedParts.getAttachments().isAttachmentCompleteSignatureTransform());
    assertEquals(2,encryptedParts.getHeaders().size());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  EncryptedParts encryptedParts=(EncryptedParts)policyComponentIterator.next();
  assertTrue(encryptedParts.isNormalized());
  assertTrue(encryptedParts.isIgnorable());
  assertFalse(encryptedParts.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,encryptedParts.getType());
  assertEquals(SP12Constants.ENCRYPTED_PARTS,encryptedParts.getName());
  assertTrue(encryptedParts.isBody());
  assertNotNull(encryptedParts.getAttachments());
  assertTrue(encryptedParts.getAttachments().isContentSignatureTransform());
  assertTrue(encryptedParts.getAttachments().isAttachmentCompleteSignatureTransform());
  assertEquals(2,encryptedParts.getHeaders().size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.HttpsTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHttpsToken() throws Exception {
  String fileName="HttpsToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof HttpsToken);
    HttpsToken httpsToken=(HttpsToken)alternative.get(0);
    assertFalse(httpsToken.isNormalized());
    assertTrue(httpsToken.isIgnorable());
    assertTrue(httpsToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,httpsToken.getType());
    assertEquals(SP12Constants.HTTPS_TOKEN,httpsToken.getName());
    assertEquals(HttpsToken.AuthenticationType.RequireClientCertificate,httpsToken.getAuthenticationType());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  HttpsToken httpsToken=(HttpsToken)policyComponentIterator.next();
  assertTrue(httpsToken.isNormalized());
  assertTrue(httpsToken.isIgnorable());
  assertFalse(httpsToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,httpsToken.getType());
  assertEquals(SP12Constants.HTTPS_TOKEN,httpsToken.getName());
  assertEquals(HttpsToken.AuthenticationType.RequireClientCertificate,httpsToken.getAuthenticationType());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.InitiatorTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInitiatorToken() throws Exception {
  String fileName="InitiatorToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof InitiatorToken);
    InitiatorToken initiatorToken=(InitiatorToken)alternative.get(0);
    assertFalse(initiatorToken.isNormalized());
    assertTrue(initiatorToken.isIgnorable());
    assertTrue(initiatorToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,initiatorToken.getType());
    assertEquals(SP12Constants.INITIATOR_TOKEN,initiatorToken.getName());
    assertNotNull(initiatorToken.getToken());
    assertEquals(SP12Constants.X509_TOKEN,initiatorToken.getToken().getName());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  InitiatorToken initiatorToken=(InitiatorToken)policyComponentIterator.next();
  assertTrue(initiatorToken.isNormalized());
  assertTrue(initiatorToken.isIgnorable());
  assertFalse(initiatorToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,initiatorToken.getType());
  assertEquals(SP12Constants.INITIATOR_TOKEN,initiatorToken.getName());
  assertNotNull(initiatorToken.getToken());
  assertEquals(SP12Constants.X509_TOKEN,initiatorToken.getToken().getName());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.IssuedTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testIssuedToken() throws Exception {
  String fileName="IssuedToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof IssuedToken);
    IssuedToken issuedToken=(IssuedToken)alternative.get(0);
    assertFalse(issuedToken.isNormalized());
    assertTrue(issuedToken.isIgnorable());
    assertTrue(issuedToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,issuedToken.getType());
    assertEquals(SP12Constants.ISSUED_TOKEN,issuedToken.getName());
    assertNotNull(issuedToken.getRequestSecurityTokenTemplate());
    assertTrue(issuedToken.isRequireExternalReference());
    assertTrue(issuedToken.isRequireInternalReference());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  IssuedToken issuedToken=(IssuedToken)policyComponentIterator.next();
  assertTrue(issuedToken.isNormalized());
  assertTrue(issuedToken.isIgnorable());
  assertFalse(issuedToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,issuedToken.getType());
  assertEquals(SP12Constants.ISSUED_TOKEN,issuedToken.getName());
  assertNotNull(issuedToken.getRequestSecurityTokenTemplate());
  assertTrue(issuedToken.isRequireExternalReference());
  assertTrue(issuedToken.isRequireInternalReference());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.KerberosTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKerberosToken() throws Exception {
  String fileName="KerberosToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof KerberosToken);
    KerberosToken kerberosToken=(KerberosToken)alternative.get(0);
    assertFalse(kerberosToken.isNormalized());
    assertTrue(kerberosToken.isIgnorable());
    assertTrue(kerberosToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,kerberosToken.getType());
    assertEquals(SP12Constants.KERBEROS_TOKEN,kerberosToken.getName());
    assertEquals(KerberosToken.ApReqTokenType.WssKerberosV5ApReqToken11,kerberosToken.getApReqTokenType());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  KerberosToken kerberosToken=(KerberosToken)policyComponentIterator.next();
  assertTrue(kerberosToken.isNormalized());
  assertTrue(kerberosToken.isIgnorable());
  assertFalse(kerberosToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,kerberosToken.getType());
  assertEquals(SP12Constants.KERBEROS_TOKEN,kerberosToken.getName());
  assertEquals(KerberosToken.ApReqTokenType.WssKerberosV5ApReqToken11,kerberosToken.getApReqTokenType());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.KeyValueTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKeyValueToken() throws Exception {
  String fileName="KeyValueToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof KeyValueToken);
    KeyValueToken keyValueToken=(KeyValueToken)alternative.get(0);
    assertFalse(keyValueToken.isNormalized());
    assertTrue(keyValueToken.isIgnorable());
    assertTrue(keyValueToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,keyValueToken.getType());
    assertEquals(SP12Constants.KEY_VALUE_TOKEN,keyValueToken.getName());
    assertTrue(keyValueToken.isRsaKeyValue());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  KeyValueToken keyValueToken=(KeyValueToken)policyComponentIterator.next();
  assertTrue(keyValueToken.isNormalized());
  assertTrue(keyValueToken.isIgnorable());
  assertFalse(keyValueToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,keyValueToken.getType());
  assertEquals(SP12Constants.KEY_VALUE_TOKEN,keyValueToken.getName());
  assertTrue(keyValueToken.isRsaKeyValue());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.LayoutTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLayout() throws Exception {
  String fileName="Layout.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof Layout);
    Layout layout=(Layout)alternative.get(0);
    assertFalse(layout.isNormalized());
    assertTrue(layout.isIgnorable());
    assertTrue(layout.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,layout.getType());
    assertEquals(SP12Constants.LAYOUT,layout.getName());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  Layout layout=(Layout)policyComponentIterator.next();
  assertTrue(layout.isNormalized());
  assertTrue(layout.isIgnorable());
  assertFalse(layout.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,layout.getType());
  assertEquals(SP12Constants.LAYOUT,layout.getName());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.PolicyNormalizationTest </h4><pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testWSP15_432Normalization() throws Exception {
  String fileName="WSP15_432-compact.xml";
  String policyFile=loadPolicyFile("policy/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/WSP15_432-serialized.xml");
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/WSP15_432-normalized.xml");
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  policy=policy.normalize(true);
  Iterator<List<Assertion>> iterator=policy.getAlternatives();
  int count=0;
  while (iterator.hasNext()) {
    iterator.next();
    count++;
  }
  assertEquals(37,count);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.RecipientTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRecipientToken() throws Exception {
  String fileName="RecipientToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof RecipientToken);
    RecipientToken recipientToken=(RecipientToken)alternative.get(0);
    assertFalse(recipientToken.isNormalized());
    assertTrue(recipientToken.isIgnorable());
    assertTrue(recipientToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,recipientToken.getType());
    assertEquals(SP12Constants.RECIPIENT_TOKEN,recipientToken.getName());
    assertNotNull(recipientToken.getToken());
    assertEquals(SP12Constants.X509_TOKEN,recipientToken.getToken().getName());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  RecipientToken recipientToken=(RecipientToken)policyComponentIterator.next();
  assertTrue(recipientToken.isNormalized());
  assertTrue(recipientToken.isIgnorable());
  assertFalse(recipientToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,recipientToken.getType());
  assertEquals(SP12Constants.RECIPIENT_TOKEN,recipientToken.getName());
  assertNotNull(recipientToken.getToken());
  assertEquals(SP12Constants.X509_TOKEN,recipientToken.getToken().getName());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.RelTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRelToken() throws Exception {
  String fileName="RelToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof RelToken);
    RelToken relToken=(RelToken)alternative.get(0);
    assertFalse(relToken.isNormalized());
    assertTrue(relToken.isIgnorable());
    assertTrue(relToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,relToken.getType());
    assertEquals(SP12Constants.REL_TOKEN,relToken.getName());
    assertEquals(RelToken.RelTokenType.WssRelV20Token10,relToken.getRelTokenType());
    assertTrue(relToken.isRequireKeyIdentifierReference());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  RelToken relToken=(RelToken)policyComponentIterator.next();
  assertTrue(relToken.isNormalized());
  assertTrue(relToken.isIgnorable());
  assertFalse(relToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,relToken.getType());
  assertEquals(SP12Constants.REL_TOKEN,relToken.getName());
  assertEquals(RelToken.RelTokenType.WssRelV20Token10,relToken.getRelTokenType());
  assertTrue(relToken.isRequireKeyIdentifierReference());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.RequiredElementsTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRequiredElements() throws Exception {
  String fileName="RequiredElements.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof RequiredElements);
    RequiredElements requiredElements=(RequiredElements)alternative.get(0);
    assertFalse(requiredElements.isNormalized());
    assertTrue(requiredElements.isIgnorable());
    assertTrue(requiredElements.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,requiredElements.getType());
    assertEquals(SP12Constants.REQUIRED_ELEMENTS,requiredElements.getName());
    assertEquals("1.1",requiredElements.getXPathVersion());
    assertEquals(2,requiredElements.getXPaths().size());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  RequiredElements requiredElements=(RequiredElements)policyComponentIterator.next();
  assertTrue(requiredElements.isNormalized());
  assertTrue(requiredElements.isIgnorable());
  assertFalse(requiredElements.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,requiredElements.getType());
  assertEquals(SP12Constants.REQUIRED_ELEMENTS,requiredElements.getName());
  assertEquals("1.1",requiredElements.getXPathVersion());
  assertEquals(2,requiredElements.getXPaths().size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.RequiredPartsTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRequiredParts() throws Exception {
  String fileName="RequiredParts.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof RequiredParts);
    RequiredParts requiredParts=(RequiredParts)alternative.get(0);
    assertFalse(requiredParts.isNormalized());
    assertTrue(requiredParts.isIgnorable());
    assertTrue(requiredParts.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,requiredParts.getType());
    assertEquals(SP12Constants.REQUIRED_PARTS,requiredParts.getName());
    assertEquals(2,requiredParts.getHeaders().size());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  RequiredParts requiredParts=(RequiredParts)policyComponentIterator.next();
  assertTrue(requiredParts.isNormalized());
  assertTrue(requiredParts.isIgnorable());
  assertFalse(requiredParts.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,requiredParts.getType());
  assertEquals(SP12Constants.REQUIRED_PARTS,requiredParts.getName());
  assertEquals(2,requiredParts.getHeaders().size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.SamlTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSamlToken() throws Exception {
  String fileName="SamlToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof SamlToken);
    SamlToken samlToken=(SamlToken)alternative.get(0);
    assertFalse(samlToken.isNormalized());
    assertTrue(samlToken.isIgnorable());
    assertTrue(samlToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,samlToken.getType());
    assertEquals(SP12Constants.SAML_TOKEN,samlToken.getName());
    assertEquals(SamlToken.SamlTokenType.WssSamlV20Token11,samlToken.getSamlTokenType());
    assertTrue(samlToken.isRequireKeyIdentifierReference());
    assertTrue(samlToken.getClaims() != null);
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  SamlToken samlToken=(SamlToken)policyComponentIterator.next();
  assertTrue(samlToken.isNormalized());
  assertTrue(samlToken.isIgnorable());
  assertFalse(samlToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,samlToken.getType());
  assertEquals(SP12Constants.SAML_TOKEN,samlToken.getName());
  assertEquals(SamlToken.SamlTokenType.WssSamlV20Token11,samlToken.getSamlTokenType());
  assertTrue(samlToken.isRequireKeyIdentifierReference());
  assertTrue(samlToken.getClaims() != null);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.SecureConversationTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSecureConversationToken() throws Exception {
  String fileName="SecureConversationToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof SecureConversationToken);
    SecureConversationToken secureConversationToken=(SecureConversationToken)alternative.get(0);
    assertFalse(secureConversationToken.isNormalized());
    assertTrue(secureConversationToken.isIgnorable());
    assertTrue(secureConversationToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,secureConversationToken.getType());
    assertEquals(SP12Constants.SECURE_CONVERSATION_TOKEN,secureConversationToken.getName());
    assertTrue(secureConversationToken.isMustNotSendAmend());
    assertTrue(secureConversationToken.isMustNotSendRenew());
    assertTrue(secureConversationToken.isMustNotSendCancel());
    assertNotNull(secureConversationToken.getBootstrapPolicy());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  SecureConversationToken secureConversationToken=(SecureConversationToken)policyComponentIterator.next();
  assertTrue(secureConversationToken.isNormalized());
  assertTrue(secureConversationToken.isIgnorable());
  assertFalse(secureConversationToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,secureConversationToken.getType());
  assertEquals(SP12Constants.SECURE_CONVERSATION_TOKEN,secureConversationToken.getName());
  assertTrue(secureConversationToken.isMustNotSendAmend());
  assertTrue(secureConversationToken.isMustNotSendRenew());
  assertTrue(secureConversationToken.isMustNotSendCancel());
  assertNotNull(secureConversationToken.getBootstrapPolicy());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.SecurityContextTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSecurityContextToken() throws Exception {
  String fileName="SecurityContextToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof SecurityContextToken);
    SecurityContextToken securityContextToken=(SecurityContextToken)alternative.get(0);
    assertFalse(securityContextToken.isNormalized());
    assertTrue(securityContextToken.isIgnorable());
    assertTrue(securityContextToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,securityContextToken.getType());
    assertEquals(SP12Constants.SECURITY_CONTEXT_TOKEN,securityContextToken.getName());
    assertTrue(securityContextToken.isRequireExternalUriReference());
    assertTrue(securityContextToken.isSc13SecurityContextToken());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  SecurityContextToken securityContextToken=(SecurityContextToken)policyComponentIterator.next();
  assertTrue(securityContextToken.isNormalized());
  assertTrue(securityContextToken.isIgnorable());
  assertFalse(securityContextToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,securityContextToken.getType());
  assertEquals(SP12Constants.SECURITY_CONTEXT_TOKEN,securityContextToken.getName());
  assertTrue(securityContextToken.isRequireExternalUriReference());
  assertTrue(securityContextToken.isSc13SecurityContextToken());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.SignedElementsTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignedElements12() throws Exception {
  String fileName="SignedElements.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof SignedElements);
    SignedElements signedElements=(SignedElements)alternative.get(0);
    assertFalse(signedElements.isNormalized());
    assertTrue(signedElements.isIgnorable());
    assertTrue(signedElements.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,signedElements.getType());
    assertEquals(SP12Constants.SIGNED_ELEMENTS,signedElements.getName());
    assertEquals("1.1",signedElements.getXPathVersion());
    assertEquals(2,signedElements.getXPaths().size());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  SignedElements signedElements=(SignedElements)policyComponentIterator.next();
  assertTrue(signedElements.isNormalized());
  assertTrue(signedElements.isIgnorable());
  assertFalse(signedElements.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,signedElements.getType());
  assertEquals(SP12Constants.SIGNED_ELEMENTS,signedElements.getName());
  assertEquals("1.1",signedElements.getXPathVersion());
  assertEquals(2,signedElements.getXPaths().size());
}

</code></pre>

<br>
<pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignedElements13() throws Exception {
  String fileName="SignedElements.xml";
  String policyFile=loadPolicyFile("policy/model/sp13/" + fileName);
  String serializedPolicyRefereneFile=loadPolicyFile("policy/model/sp13/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp13/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyRefereneFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof SignedElements);
    SignedElements signedElements=(SignedElements)alternative.get(0);
    assertFalse(signedElements.isNormalized());
    assertTrue(signedElements.isIgnorable());
    assertTrue(signedElements.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,signedElements.getType());
    assertEquals(SP12Constants.SIGNED_ELEMENTS,signedElements.getName());
    assertEquals("1.1",signedElements.getXPathVersion());
    assertEquals(3,signedElements.getXPaths().size());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  SignedElements signedElements=(SignedElements)policyComponentIterator.next();
  assertTrue(signedElements.isNormalized());
  assertTrue(signedElements.isIgnorable());
  assertFalse(signedElements.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,signedElements.getType());
  assertEquals(SP12Constants.SIGNED_ELEMENTS,signedElements.getName());
  assertEquals("1.1",signedElements.getXPathVersion());
  assertEquals(3,signedElements.getXPaths().size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.SignedPartsTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignedParts13() throws Exception {
  String fileName="SignedParts.xml";
  String policyFile=loadPolicyFile("policy/model/sp13/" + fileName);
  String serializedPolicyRefereneFile=loadPolicyFile("policy/model/sp13/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp13/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyRefereneFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof SignedParts);
    SignedParts signedParts=(SignedParts)alternative.get(0);
    assertFalse(signedParts.isNormalized());
    assertTrue(signedParts.isIgnorable());
    assertTrue(signedParts.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,signedParts.getType());
    assertEquals(SP12Constants.SIGNED_PARTS,signedParts.getName());
    assertTrue(signedParts.isBody());
    assertNotNull(signedParts.getAttachments());
    assertEquals(2,signedParts.getHeaders().size());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  SignedParts signedParts=(SignedParts)policyComponentIterator.next();
  assertTrue(signedParts.isNormalized());
  assertTrue(signedParts.isIgnorable());
  assertFalse(signedParts.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,signedParts.getType());
  assertEquals(SP12Constants.SIGNED_PARTS,signedParts.getName());
  assertTrue(signedParts.isBody());
  assertNotNull(signedParts.getAttachments());
  assertEquals(2,signedParts.getHeaders().size());
}

</code></pre>

<br>
<pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignedParts12() throws Exception {
  String fileName="SignedParts.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof SignedParts);
    SignedParts signedParts=(SignedParts)alternative.get(0);
    assertFalse(signedParts.isNormalized());
    assertTrue(signedParts.isIgnorable());
    assertTrue(signedParts.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,signedParts.getType());
    assertEquals(SP12Constants.SIGNED_PARTS,signedParts.getName());
    assertTrue(signedParts.isBody());
    assertNotNull(signedParts.getAttachments());
    assertEquals(2,signedParts.getHeaders().size());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  SignedParts signedParts=(SignedParts)policyComponentIterator.next();
  assertTrue(signedParts.isNormalized());
  assertTrue(signedParts.isIgnorable());
  assertFalse(signedParts.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,signedParts.getType());
  assertEquals(SP12Constants.SIGNED_PARTS,signedParts.getName());
  assertTrue(signedParts.isBody());
  assertNotNull(signedParts.getAttachments());
  assertEquals(2,signedParts.getHeaders().size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.SpnegoContextTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSpnegoContextToken() throws Exception {
  String fileName="SpnegoContextToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof SpnegoContextToken);
    SpnegoContextToken spnegoContextToken=(SpnegoContextToken)alternative.get(0);
    assertFalse(spnegoContextToken.isNormalized());
    assertTrue(spnegoContextToken.isIgnorable());
    assertTrue(spnegoContextToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,spnegoContextToken.getType());
    assertEquals(SP12Constants.SPNEGO_CONTEXT_TOKEN,spnegoContextToken.getName());
    assertTrue(spnegoContextToken.isMustNotSendAmend());
    assertTrue(spnegoContextToken.isMustNotSendCancel());
    assertTrue(spnegoContextToken.isMustNotSendRenew());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  SpnegoContextToken spnegoContextToken=(SpnegoContextToken)policyComponentIterator.next();
  assertTrue(spnegoContextToken.isNormalized());
  assertTrue(spnegoContextToken.isIgnorable());
  assertFalse(spnegoContextToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,spnegoContextToken.getType());
  assertEquals(SP12Constants.SPNEGO_CONTEXT_TOKEN,spnegoContextToken.getName());
  assertTrue(spnegoContextToken.isMustNotSendAmend());
  assertTrue(spnegoContextToken.isMustNotSendCancel());
  assertTrue(spnegoContextToken.isMustNotSendRenew());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.SupportingTokensTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSupportingTokens() throws Exception {
  String fileName="SupportingTokens.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof SupportingTokens);
    SupportingTokens supportingTokens=(SupportingTokens)alternative.get(0);
    assertFalse(supportingTokens.isNormalized());
    assertTrue(supportingTokens.isIgnorable());
    assertTrue(supportingTokens.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,supportingTokens.getType());
    assertEquals(SP12Constants.SUPPORTING_TOKENS,supportingTokens.getName());
    assertEquals(1,supportingTokens.getTokens().size());
    assertNotNull(supportingTokens.getSignedParts());
    assertNotNull(supportingTokens.getSignedElements());
    assertNotNull(supportingTokens.getEncryptedParts());
    assertNotNull(supportingTokens.getEncryptedElements());
    assertNotNull(supportingTokens.getAlgorithmSuite());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  SupportingTokens supportingTokens=(SupportingTokens)policyComponentIterator.next();
  assertTrue(supportingTokens.isNormalized());
  assertTrue(supportingTokens.isIgnorable());
  assertFalse(supportingTokens.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,supportingTokens.getType());
  assertEquals(SP12Constants.SUPPORTING_TOKENS,supportingTokens.getName());
  assertEquals(1,supportingTokens.getTokens().size());
  assertNotNull(supportingTokens.getSignedParts());
  assertNotNull(supportingTokens.getSignedElements());
  assertNotNull(supportingTokens.getEncryptedParts());
  assertNotNull(supportingTokens.getEncryptedElements());
  assertNotNull(supportingTokens.getAlgorithmSuite());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.SymmetricBindingTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSymmetricBinding() throws Exception {
  String fileName="SymmetricBinding.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof SymmetricBinding);
    SymmetricBinding symmetricBinding=(SymmetricBinding)alternative.get(0);
    assertFalse(symmetricBinding.isNormalized());
    assertTrue(symmetricBinding.isIgnorable());
    assertTrue(symmetricBinding.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,symmetricBinding.getType());
    assertEquals(SP12Constants.SYMMETRIC_BINDING,symmetricBinding.getName());
    assertNotNull(symmetricBinding.getEncryptionToken());
    assertNotNull(symmetricBinding.getSignatureToken());
    assertNotNull(symmetricBinding.getAlgorithmSuite());
    assertNotNull(symmetricBinding.getLayout());
    assertEquals(AbstractSymmetricAsymmetricBinding.ProtectionOrder.EncryptBeforeSigning,symmetricBinding.getProtectionOrder());
    assertTrue(symmetricBinding.isEncryptSignature());
    assertTrue(symmetricBinding.isIncludeTimestamp());
    assertTrue(symmetricBinding.isOnlySignEntireHeadersAndBody());
    assertTrue(symmetricBinding.isProtectTokens());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  SymmetricBinding symmetricBinding=(SymmetricBinding)policyComponentIterator.next();
  assertTrue(symmetricBinding.isNormalized());
  assertTrue(symmetricBinding.isIgnorable());
  assertFalse(symmetricBinding.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,symmetricBinding.getType());
  assertEquals(SP12Constants.SYMMETRIC_BINDING,symmetricBinding.getName());
  assertNotNull(symmetricBinding.getEncryptionToken());
  assertNotNull(symmetricBinding.getSignatureToken());
  assertNotNull(symmetricBinding.getAlgorithmSuite());
  assertNotNull(symmetricBinding.getLayout());
  assertEquals(AbstractSymmetricAsymmetricBinding.ProtectionOrder.EncryptBeforeSigning,symmetricBinding.getProtectionOrder());
  assertTrue(symmetricBinding.isEncryptSignature());
  assertTrue(symmetricBinding.isIncludeTimestamp());
  assertTrue(symmetricBinding.isOnlySignEntireHeadersAndBody());
  assertTrue(symmetricBinding.isProtectTokens());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.TransportBindingTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTransportBinding() throws Exception {
  String fileName="TransportBinding.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof TransportBinding);
    TransportBinding transportBinding=(TransportBinding)alternative.get(0);
    assertFalse(transportBinding.isNormalized());
    assertTrue(transportBinding.isIgnorable());
    assertTrue(transportBinding.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,transportBinding.getType());
    assertEquals(SP12Constants.TRANSPORT_BINDING,transportBinding.getName());
    assertNotNull(transportBinding.getTransportToken());
    assertNotNull(transportBinding.getAlgorithmSuite());
    assertNotNull(transportBinding.getLayout());
    assertTrue(transportBinding.isIncludeTimestamp());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  TransportBinding transportBinding=(TransportBinding)policyComponentIterator.next();
  assertTrue(transportBinding.isNormalized());
  assertTrue(transportBinding.isIgnorable());
  assertFalse(transportBinding.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,transportBinding.getType());
  assertEquals(SP12Constants.TRANSPORT_BINDING,transportBinding.getName());
  assertNotNull(transportBinding.getTransportToken());
  assertNotNull(transportBinding.getAlgorithmSuite());
  assertNotNull(transportBinding.getLayout());
  assertTrue(transportBinding.isIncludeTimestamp());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.Trust10Test </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTrust10_11() throws Exception {
  String fileName="Trust10.xml";
  String policyFile=loadPolicyFile("policy/model/sp11/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp11/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp11/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof Trust10);
    Trust10 trust10=(Trust10)alternative.get(0);
    assertFalse(trust10.isNormalized());
    assertTrue(trust10.isIgnorable());
    assertTrue(trust10.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,trust10.getType());
    assertEquals(SP11Constants.TRUST_10,trust10.getName());
    assertTrue(trust10.isMustSupportClientChallenge());
    assertTrue(trust10.isMustSupportServerChallenge());
    assertTrue(trust10.isRequireClientEntropy());
    assertTrue(trust10.isRequireServerEntropy());
    assertTrue(trust10.isMustSupportIssuedTokens());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  Trust10 trust13=(Trust10)policyComponentIterator.next();
  assertTrue(trust13.isNormalized());
  assertTrue(trust13.isIgnorable());
  assertFalse(trust13.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,trust13.getType());
  assertEquals(SP11Constants.TRUST_10,trust13.getName());
  assertTrue(trust13.isMustSupportClientChallenge());
  assertTrue(trust13.isMustSupportServerChallenge());
  assertTrue(trust13.isRequireClientEntropy());
  assertTrue(trust13.isRequireServerEntropy());
  assertTrue(trust13.isMustSupportIssuedTokens());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.Trust13Test </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTrust13_12() throws Exception {
  String fileName="Trust13.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof Trust13);
    Trust13 trust13=(Trust13)alternative.get(0);
    assertFalse(trust13.isNormalized());
    assertTrue(trust13.isIgnorable());
    assertTrue(trust13.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,trust13.getType());
    assertEquals(SP12Constants.TRUST_13,trust13.getName());
    assertTrue(trust13.isMustSupportClientChallenge());
    assertTrue(trust13.isMustSupportServerChallenge());
    assertTrue(trust13.isRequireClientEntropy());
    assertTrue(trust13.isRequireServerEntropy());
    assertTrue(trust13.isMustSupportIssuedTokens());
    assertTrue(trust13.isRequireRequestSecurityTokenCollection());
    assertTrue(trust13.isRequireAppliesTo());
    assertFalse(trust13.isScopePolicy15());
    assertFalse(trust13.isMustSupportInteractiveChallenge());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  Trust13 trust13=(Trust13)policyComponentIterator.next();
  assertTrue(trust13.isNormalized());
  assertTrue(trust13.isIgnorable());
  assertFalse(trust13.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,trust13.getType());
  assertEquals(SP12Constants.TRUST_13,trust13.getName());
  assertTrue(trust13.isMustSupportClientChallenge());
  assertTrue(trust13.isMustSupportServerChallenge());
  assertTrue(trust13.isRequireClientEntropy());
  assertTrue(trust13.isRequireServerEntropy());
  assertTrue(trust13.isMustSupportIssuedTokens());
  assertTrue(trust13.isRequireRequestSecurityTokenCollection());
  assertTrue(trust13.isRequireAppliesTo());
  assertFalse(trust13.isScopePolicy15());
  assertFalse(trust13.isMustSupportInteractiveChallenge());
}

</code></pre>

<br>
<pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTrust13_13() throws Exception {
  String fileName="Trust13.xml";
  String policyFile=loadPolicyFile("policy/model/sp13/" + fileName);
  String serializedPolicyRefereneFile=loadPolicyFile("policy/model/sp13/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp13/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyRefereneFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof Trust13);
    Trust13 trust13=(Trust13)alternative.get(0);
    assertFalse(trust13.isNormalized());
    assertTrue(trust13.isIgnorable());
    assertTrue(trust13.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,trust13.getType());
    assertEquals(SP13Constants.TRUST_13,trust13.getName());
    assertTrue(trust13.isMustSupportClientChallenge());
    assertTrue(trust13.isMustSupportServerChallenge());
    assertTrue(trust13.isRequireClientEntropy());
    assertTrue(trust13.isRequireServerEntropy());
    assertTrue(trust13.isMustSupportIssuedTokens());
    assertTrue(trust13.isRequireRequestSecurityTokenCollection());
    assertTrue(trust13.isRequireAppliesTo());
    assertTrue(trust13.isScopePolicy15());
    assertTrue(trust13.isMustSupportInteractiveChallenge());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  Trust13 trust13=(Trust13)policyComponentIterator.next();
  assertTrue(trust13.isNormalized());
  assertTrue(trust13.isIgnorable());
  assertFalse(trust13.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,trust13.getType());
  assertEquals(SP13Constants.TRUST_13,trust13.getName());
  assertTrue(trust13.isMustSupportClientChallenge());
  assertTrue(trust13.isMustSupportServerChallenge());
  assertTrue(trust13.isRequireClientEntropy());
  assertTrue(trust13.isRequireServerEntropy());
  assertTrue(trust13.isMustSupportIssuedTokens());
  assertTrue(trust13.isRequireRequestSecurityTokenCollection());
  assertTrue(trust13.isRequireAppliesTo());
  assertTrue(trust13.isScopePolicy15());
  assertTrue(trust13.isMustSupportInteractiveChallenge());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.UsernameTokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUsernameToken12() throws Exception {
  String fileName="UsernameToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof UsernameToken);
    UsernameToken usernameToken=(UsernameToken)alternative.get(0);
    assertFalse(usernameToken.isNormalized());
    assertTrue(usernameToken.isIgnorable());
    assertTrue(usernameToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,usernameToken.getType());
    assertEquals(SP12Constants.USERNAME_TOKEN,usernameToken.getName());
    assertEquals(UsernameToken.PasswordType.HashPassword,usernameToken.getPasswordType());
    assertEquals(UsernameToken.UsernameTokenType.WssUsernameToken10,usernameToken.getUsernameTokenType());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  UsernameToken usernameToken=(UsernameToken)policyComponentIterator.next();
  assertTrue(usernameToken.isNormalized());
  assertTrue(usernameToken.isIgnorable());
  assertFalse(usernameToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,usernameToken.getType());
  assertEquals(SP12Constants.USERNAME_TOKEN,usernameToken.getName());
  assertEquals(UsernameToken.PasswordType.HashPassword,usernameToken.getPasswordType());
  assertEquals(UsernameToken.UsernameTokenType.WssUsernameToken10,usernameToken.getUsernameTokenType());
}

</code></pre>

<br>
<pre class="type-3 type-11 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUsernameToken13() throws Exception {
  String fileName="UsernameToken.xml";
  String policyFile=loadPolicyFile("policy/model/sp13/" + fileName);
  String serializedPolicyRefereneFile=loadPolicyFile("policy/model/sp13/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp13/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyRefereneFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof UsernameToken);
    UsernameToken usernameToken=(UsernameToken)alternative.get(0);
    assertFalse(usernameToken.isNormalized());
    assertTrue(usernameToken.isIgnorable());
    assertTrue(usernameToken.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,usernameToken.getType());
    assertEquals(SP12Constants.USERNAME_TOKEN,usernameToken.getName());
    assertTrue(usernameToken.isCreated());
    assertTrue(usernameToken.isNonce());
    assertNull(usernameToken.getPasswordType());
    assertEquals(UsernameToken.UsernameTokenType.WssUsernameToken10,usernameToken.getUsernameTokenType());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  UsernameToken usernameToken=(UsernameToken)policyComponentIterator.next();
  assertTrue(usernameToken.isNormalized());
  assertTrue(usernameToken.isIgnorable());
  assertFalse(usernameToken.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,usernameToken.getType());
  assertEquals(SP12Constants.USERNAME_TOKEN,usernameToken.getName());
  assertTrue(usernameToken.isCreated());
  assertTrue(usernameToken.isNonce());
  assertNull(usernameToken.getPasswordType());
  assertEquals(UsernameToken.UsernameTokenType.WssUsernameToken10,usernameToken.getUsernameTokenType());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.Wss10Test </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWss10() throws Exception {
  String fileName="Wss10.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof Wss10);
    Wss10 wss10=(Wss10)alternative.get(0);
    assertFalse(wss10.isNormalized());
    assertTrue(wss10.isIgnorable());
    assertTrue(wss10.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,wss10.getType());
    assertEquals(SP12Constants.WSS10,wss10.getName());
    assertTrue(wss10.isMustSupportRefEmbeddedToken());
    assertTrue(wss10.isMustSupportRefExternalURI());
    assertTrue(wss10.isMustSupportRefIssuerSerial());
    assertTrue(wss10.isMustSupportRefKeyIdentifier());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  Wss10 wss10=(Wss10)policyComponentIterator.next();
  assertTrue(wss10.isNormalized());
  assertTrue(wss10.isIgnorable());
  assertFalse(wss10.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,wss10.getType());
  assertEquals(SP12Constants.WSS10,wss10.getName());
  assertTrue(wss10.isMustSupportRefEmbeddedToken());
  assertTrue(wss10.isMustSupportRefExternalURI());
  assertTrue(wss10.isMustSupportRefIssuerSerial());
  assertTrue(wss10.isMustSupportRefKeyIdentifier());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.Wss11Test </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWss11() throws Exception {
  String fileName="Wss11.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof Wss11);
    Wss11 wss11=(Wss11)alternative.get(0);
    assertFalse(wss11.isNormalized());
    assertTrue(wss11.isIgnorable());
    assertTrue(wss11.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,wss11.getType());
    assertEquals(SP12Constants.WSS11,wss11.getName());
    assertTrue(wss11.isMustSupportRefEmbeddedToken());
    assertTrue(wss11.isMustSupportRefExternalURI());
    assertTrue(wss11.isMustSupportRefIssuerSerial());
    assertTrue(wss11.isMustSupportRefKeyIdentifier());
    assertTrue(wss11.isMustSupportRefEncryptedKey());
    assertTrue(wss11.isMustSupportRefThumbprint());
    assertTrue(wss11.isRequireSignatureConfirmation());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  Wss11 wss11=(Wss11)policyComponentIterator.next();
  assertTrue(wss11.isNormalized());
  assertTrue(wss11.isIgnorable());
  assertFalse(wss11.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,wss11.getType());
  assertEquals(SP12Constants.WSS11,wss11.getName());
  assertTrue(wss11.isMustSupportRefEmbeddedToken());
  assertTrue(wss11.isMustSupportRefExternalURI());
  assertTrue(wss11.isMustSupportRefIssuerSerial());
  assertTrue(wss11.isMustSupportRefKeyIdentifier());
  assertTrue(wss11.isMustSupportRefEncryptedKey());
  assertTrue(wss11.isMustSupportRefThumbprint());
  assertTrue(wss11.isRequireSignatureConfirmation());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.policy.tests.X509TokenTest </h4><pre class="type-3 type-11 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testX509Token() throws Exception {
  String fileName="X509Token.xml";
  String policyFile=loadPolicyFile("policy/model/sp12/" + fileName);
  String serializedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/serialized/" + fileName);
  String normalizedPolicyReferenceFile=loadPolicyFile("policy/model/sp12/normalized/" + fileName);
  Policy policy=loadPolicy(policyFile);
  String serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,serializedPolicyReferenceFile);
  Iterator<List<Assertion>> alternativeIterator=policy.getAlternatives();
  int count=0;
  while (alternativeIterator.hasNext()) {
    List<Assertion> alternative=alternativeIterator.next();
    assertEquals(1,alternative.size());
    assertTrue(alternative.get(0) instanceof X509Token);
    X509Token x509Token=(X509Token)alternative.get(0);
    assertFalse(x509Token.isNormalized());
    assertTrue(x509Token.isIgnorable());
    assertTrue(x509Token.isOptional());
    assertEquals(Constants.TYPE_ASSERTION,x509Token.getType());
    assertEquals(SP12Constants.X509_TOKEN,x509Token.getName());
    assertTrue(x509Token.isRequireEmbeddedTokenReference());
    assertTrue(x509Token.isRequireIssuerSerialReference());
    assertTrue(x509Token.isRequireKeyIdentifierReference());
    assertTrue(x509Token.isRequireThumbprintReference());
    assertEquals(X509Token.TokenType.WssX509V1Token11,x509Token.getTokenType());
    count++;
  }
  assertEquals(1,count);
  policy=policy.normalize(true);
  serializedPolicy=serializePolicy(policy);
  assertXMLisEqual(serializedPolicy,normalizedPolicyReferenceFile);
  alternativeIterator=policy.getAlternatives();
  List<Assertion> alternative=alternativeIterator.next();
  assertEquals(0,alternative.size());
  List<PolicyComponent> policyComponents=policy.getPolicyComponents();
  assertEquals(1,policyComponents.size());
  PolicyOperator policyOperator=(PolicyOperator)policyComponents.get(0);
  policyComponents=policyOperator.getPolicyComponents();
  assertEquals(2,policyComponents.size());
  All all=(All)policyComponents.get(0);
  List<PolicyComponent> policyComponentsAll=all.getAssertions();
  assertEquals(0,policyComponentsAll.size());
  all=(All)policyComponents.get(1);
  policyComponentsAll=all.getAssertions();
  assertEquals(1,policyComponentsAll.size());
  Iterator<PolicyComponent> policyComponentIterator=policyComponentsAll.iterator();
  X509Token x509Token=(X509Token)policyComponentIterator.next();
  assertTrue(x509Token.isNormalized());
  assertTrue(x509Token.isIgnorable());
  assertFalse(x509Token.isOptional());
  assertEquals(Constants.TYPE_ASSERTION,x509Token.getType());
  assertEquals(SP12Constants.X509_TOKEN,x509Token.getName());
  assertTrue(x509Token.isRequireEmbeddedTokenReference());
  assertTrue(x509Token.isRequireIssuerSerialReference());
  assertTrue(x509Token.isRequireKeyIdentifierReference());
  assertTrue(x509Token.isRequireThumbprintReference());
  assertEquals(X509Token.TokenType.WssX509V1Token11,x509Token.getTokenType());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.AttachmentTest </h4><pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentContentEncryptionExternalReferenceList() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  WSSecEncrypt encrypt=new WSSecEncrypt();
  encrypt.setUserInfo("receiver","default");
  encrypt.setKeyIdentifierType(WSConstants.ISSUER_SERIAL);
  WSSecHeader secHeader=new WSSecHeader(doc);
  secHeader.insertSecurityHeader();
  encrypt.getParts().add(new WSEncryptionPart("Body","http://schemas.xmlsoap.org/soap/envelope/","Content"));
  encrypt.getParts().add(new WSEncryptionPart("cid:Attachments","Content"));
  String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  encrypt.setAttachmentCallbackHandler(attachmentCallbackHandler);
  encrypt.prepare(doc,CryptoFactory.getInstance("transmitter-crypto.properties"));
  Element refs=encrypt.encrypt();
  encrypt.addAttachmentEncryptedDataElements(secHeader);
  encrypt.addExternalRefElement(refs,secHeader);
  encrypt.prependToHeader(secHeader);
  NodeList references=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"DataReference");
  Assert.assertEquals(2,references.getLength());
  NodeList cipherReferences=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"CipherReference");
  Assert.assertEquals(1,cipherReferences.getLength());
  NodeList encDatas=doc.getElementsByTagNameNS(WSConstants.ENC_NS,"EncryptedData");
  Assert.assertEquals(2,encDatas.getLength());
  NodeList securityHeaderElement=doc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
  Assert.assertEquals(1,securityHeaderElement.getLength());
  NodeList childs=securityHeaderElement.item(0).getChildNodes();
  Assert.assertEquals(3,childs.getLength());
  Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
  Assert.assertEquals(childs.item(1).getLocalName(),"ReferenceList");
  Assert.assertEquals(childs.item(2).getLocalName(),"EncryptedData");
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(doc),new StreamResult(baos));
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> attHeaders=responseAttachment.getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentCmplEncCmplSign() throws Exception {
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment[] attachment=new Attachment[1];
  attachment[0]=new Attachment();
  attachment[0].setMimeType("text/xml");
  attachment[0].addHeaders(getHeaders(attachmentId));
  attachment[0].setId(attachmentId);
  attachment[0].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Content));
    securityProperties.addEncryptionPart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setAttachmentCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          List<Attachment> attachments=new ArrayList<Attachment>();
          attachments.add(attachment[0]);
          attachmentRequestCallback.setAttachments(attachments);
        }
 else {
          AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
          attachment[0]=attachmentResultCallback.getAttachment();
        }
      }
    }
);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document securedDoc=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList securityHeaderElement=securedDoc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(3,childs.getLength());
    Assert.assertEquals(childs.item(0).getLocalName(),"Signature");
    Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedKey");
    Assert.assertEquals(childs.item(2).getLocalName(),"EncryptedData");
    Assert.assertEquals(1,attachment[0].getHeaders().size());
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAttachmentCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          if (!attachment[0].getId().equals(attachmentRequestCallback.getAttachmentId())) {
            throw new RuntimeException("wrong attachment requested");
          }
          List<Attachment> attachments=new ArrayList<Attachment>();
          attachments.add(attachment[0]);
          attachmentRequestCallback.setAttachments(attachments);
        }
 else {
          AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
          attachment[0]=attachmentResultCallback.getAttachment();
        }
      }
    }
);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
  byte[] attachmentBytes=readInputStream(attachment[0].getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",attachment[0].getMimeType());
  Map<String,String> attHeaders=attachment[0].getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentCompleteSignature() throws Exception {
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
  }
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList sigReferences=document.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
    Assert.assertEquals(2,sigReferences.getLength());
  }
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidXMLAttachmentCompleteEncryption() throws Exception {
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Content));
    securityProperties.addEncryptionPart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document securedDoc=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList references=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"DataReference");
    Assert.assertEquals(2,references.getLength());
    NodeList cipherReferences=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"CipherReference");
    Assert.assertEquals(1,cipherReferences.getLength());
    NodeList encDatas=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"EncryptedData");
    Assert.assertEquals(2,encDatas.getLength());
    NodeList securityHeaderElement=securedDoc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(2,childs.getLength());
    Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
    Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedData");
    Assert.assertEquals(1,encryptedAttachments.get(0).getHeaders().size());
  }
  final PushbackInputStream pis=new PushbackInputStream(encryptedAttachments.get(0).getSourceStream(),1);
  pis.unread('K');
  encryptedAttachments.get(0).setSourceStream(pis);
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
      return;
    }
    Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
    Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
    byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
    Assert.assertFalse(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
    Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultipleAttachmentCompleteSignature() throws Exception {
  final String attachment1Id=UUID.randomUUID().toString();
  final Attachment[] attachment=new Attachment[2];
  attachment[0]=new Attachment();
  attachment[0].setMimeType("text/xml");
  attachment[0].addHeaders(getHeaders(attachment1Id));
  attachment[0].setId(attachment1Id);
  attachment[0].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  final String attachment2Id=UUID.randomUUID().toString();
  attachment[1]=new Attachment();
  attachment[1].setMimeType("text/plain");
  attachment[1].addHeaders(getHeaders(attachment2Id));
  attachment[1].setId(attachment2Id);
  attachment[1].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Arrays.asList(attachment));
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
  }
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Arrays.asList(attachment));
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList sigReferences=document.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
    Assert.assertEquals(3,sigReferences.getLength());
  }
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentContentEncryptionGCM() throws Exception {
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Content));
    securityProperties.addEncryptionPart(new SecurePart("cid:Attachments",SecurePart.Modifier.Content));
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    securityProperties.setEncryptionSymAlgorithm(WSSConstants.NS_XENC11_AES128_GCM);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document securedDoc=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList references=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"DataReference");
    Assert.assertEquals(2,references.getLength());
    NodeList cipherReferences=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"CipherReference");
    Assert.assertEquals(1,cipherReferences.getLength());
    NodeList encDatas=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"EncryptedData");
    Assert.assertEquals(2,encDatas.getLength());
    NodeList securityHeaderElement=securedDoc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(2,childs.getLength());
    Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
    Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedData");
  }
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> attHeaders=responseAttachment.getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentContentSignature() throws Exception {
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart("cid:Attachments",SecurePart.Modifier.Content));
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
  }
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList sigReferences=document.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
    Assert.assertEquals(2,sigReferences.getLength());
  }
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMultipleAttachmentCompleteEncryption() throws Exception {
  final String attachment1Id=UUID.randomUUID().toString();
  final Attachment[] attachment=new Attachment[2];
  attachment[0]=new Attachment();
  attachment[0].setMimeType("text/xml");
  attachment[0].addHeaders(getHeaders(attachment1Id));
  attachment[0].setId(attachment1Id);
  attachment[0].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  final String attachment2Id=UUID.randomUUID().toString();
  attachment[1]=new Attachment();
  attachment[1].setMimeType("text/plain");
  attachment[1].addHeaders(getHeaders(attachment2Id));
  attachment[1].setId(attachment2Id);
  attachment[1].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Arrays.asList(attachment));
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Content));
    securityProperties.addEncryptionPart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
  }
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachment1Bytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachment1Bytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> att1Headers=responseAttachment.getHeaders();
  Assert.assertEquals(6,att1Headers.size());
  responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(1);
  byte[] attachment2Bytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachment2Bytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/plain",responseAttachment.getMimeType());
  Map<String,String> att2Headers=responseAttachment.getHeaders();
  Assert.assertEquals(6,att2Headers.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidXMLAttachmentContentEncryption() throws Exception {
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Content));
    securityProperties.addEncryptionPart(new SecurePart("cid:Attachments",SecurePart.Modifier.Content));
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document securedDoc=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList references=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"DataReference");
    Assert.assertEquals(2,references.getLength());
    NodeList cipherReferences=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"CipherReference");
    Assert.assertEquals(1,cipherReferences.getLength());
    NodeList encDatas=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"EncryptedData");
    Assert.assertEquals(2,encDatas.getLength());
    NodeList securityHeaderElement=securedDoc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(2,childs.getLength());
    Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
    Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedData");
  }
  final PushbackInputStream pis=new PushbackInputStream(encryptedAttachments.get(0).getSourceStream(),1);
  pis.unread('K');
  encryptedAttachments.get(0).setSourceStream(pis);
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  try {
    byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
    Assert.assertFalse(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
    Assert.assertEquals("text/xml",responseAttachment.getMimeType());
    Map<String,String> attHeaders=responseAttachment.getHeaders();
    Assert.assertEquals(6,attHeaders.size());
  }
 catch (  IOException ex) {
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentCmplSignCmplEnc() throws Exception {
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment[] attachment=new Attachment[1];
  attachment[0]=new Attachment();
  attachment[0].setMimeType("text/xml");
  attachment[0].addHeaders(getHeaders(attachmentId));
  attachment[0].setId(attachmentId);
  attachment[0].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Content));
    securityProperties.addEncryptionPart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setAttachmentCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          List<Attachment> attachments=new ArrayList<Attachment>();
          attachments.add(attachment[0]);
          attachmentRequestCallback.setAttachments(attachments);
        }
 else {
          AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
          attachment[0]=attachmentResultCallback.getAttachment();
        }
      }
    }
);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document securedDoc=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList securityHeaderElement=securedDoc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(3,childs.getLength());
    Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
    Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedData");
    Assert.assertEquals(childs.item(2).getLocalName(),"Signature");
    Assert.assertEquals(1,attachment[0].getHeaders().size());
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAttachmentCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          if (!attachment[0].getId().equals(attachmentRequestCallback.getAttachmentId())) {
            throw new RuntimeException("wrong attachment requested");
          }
          List<Attachment> attachments=new ArrayList<Attachment>();
          attachments.add(attachment[0]);
          attachmentRequestCallback.setAttachments(attachments);
        }
 else {
          AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
          attachment[0]=attachmentResultCallback.getAttachment();
        }
      }
    }
);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
  byte[] attachmentBytes=readInputStream(attachment[0].getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",attachment[0].getMimeType());
  Map<String,String> attHeaders=attachment[0].getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentCompleteEncryption() throws Exception {
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Content));
    securityProperties.addEncryptionPart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document securedDoc=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList references=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"DataReference");
    Assert.assertEquals(2,references.getLength());
    NodeList cipherReferences=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"CipherReference");
    Assert.assertEquals(1,cipherReferences.getLength());
    NodeList encDatas=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"EncryptedData");
    Assert.assertEquals(2,encDatas.getLength());
    NodeList securityHeaderElement=securedDoc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(2,childs.getLength());
    Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
    Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedData");
    Assert.assertEquals(1,encryptedAttachments.get(0).getHeaders().size());
  }
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> attHeaders=responseAttachment.getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testXMLAttachmentContentEncryption() throws Exception {
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment attachment=new Attachment();
  attachment.setMimeType("text/xml");
  attachment.addHeaders(getHeaders(attachmentId));
  attachment.setId(attachmentId);
  attachment.setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(Collections.singletonList(attachment));
  List<Attachment> encryptedAttachments=attachmentCallbackHandler.getResponseAttachments();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Content));
    securityProperties.addEncryptionPart(new SecurePart("cid:Attachments",SecurePart.Modifier.Content));
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document securedDoc=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList references=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"DataReference");
    Assert.assertEquals(2,references.getLength());
    NodeList cipherReferences=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"CipherReference");
    Assert.assertEquals(1,cipherReferences.getLength());
    NodeList encDatas=securedDoc.getElementsByTagNameNS(WSConstants.ENC_NS,"EncryptedData");
    Assert.assertEquals(2,encDatas.getLength());
    NodeList securityHeaderElement=securedDoc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(2,childs.getLength());
    Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
    Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedData");
  }
  attachmentCallbackHandler=new AttachmentCallbackHandler(encryptedAttachments);
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
  Map<String,String> attHeaders=responseAttachment.getHeaders();
  Assert.assertEquals(6,attHeaders.size());
}

</code></pre>

<br>
<pre class="type-3 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidXMLAttachmentCmplEncCmplSign() throws Exception {
  final String attachmentId=UUID.randomUUID().toString();
  final Attachment[] attachment=new Attachment[1];
  attachment[0]=new Attachment();
  attachment[0].setMimeType("text/xml");
  attachment[0].addHeaders(getHeaders(attachmentId));
  attachment[0].setId(attachmentId);
  attachment[0].setSourceStream(new ByteArrayInputStream(SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://schemas.xmlsoap.org/soap/envelope/","Body"),SecurePart.Modifier.Content));
    securityProperties.addEncryptionPart(new SecurePart("cid:Attachments",SecurePart.Modifier.Element));
    securityProperties.setAttachmentCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          List<Attachment> attachments=new ArrayList<Attachment>();
          attachments.add(attachment[0]);
          attachmentRequestCallback.setAttachments(attachments);
        }
 else {
          AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
          attachment[0]=attachmentResultCallback.getAttachment();
        }
      }
    }
);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document securedDoc=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList securityHeaderElement=securedDoc.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(3,childs.getLength());
    Assert.assertEquals(childs.item(0).getLocalName(),"Signature");
    Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedKey");
    Assert.assertEquals(childs.item(2).getLocalName(),"EncryptedData");
  }
{
    final PushbackInputStream pis=new PushbackInputStream(attachment[0].getSourceStream(),1);
    pis.unread('K');
    attachment[0].setSourceStream(pis);
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAttachmentCallbackHandler(new CallbackHandler(){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        if (callbacks[0] instanceof AttachmentRequestCallback) {
          AttachmentRequestCallback attachmentRequestCallback=(AttachmentRequestCallback)callbacks[0];
          if (!attachment[0].getId().equals(attachmentRequestCallback.getAttachmentId())) {
            throw new RuntimeException("wrong attachment requested");
          }
          List<Attachment> attachments=new ArrayList<Attachment>();
          attachments.add(attachment[0]);
          attachmentRequestCallback.setAttachments(attachments);
        }
 else {
          AttachmentResultCallback attachmentResultCallback=(AttachmentResultCallback)callbacks[0];
          attachment[0]=attachmentResultCallback.getAttachment();
        }
      }
    }
);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Exception expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getMessage());
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.ConfigurationConverterTest </h4><pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOutboundSignatureConfiguration() throws Exception {
  Map<String,Object> config=new HashMap<String,Object>();
  config.put(ConfigurationConstants.ACTION,ConfigurationConstants.SIGNATURE);
  config.put(ConfigurationConstants.USER,"transmitter");
  config.put(ConfigurationConstants.PW_CALLBACK_REF,new CallbackHandlerImpl());
  String sigAlgo="http://www.w3.org/2001/04/xmldsig-more#rsa-sha256";
  config.put(ConfigurationConstants.SIG_ALGO,sigAlgo);
  config.put(ConfigurationConstants.SIG_KEY_ID,"Thumbprint");
  config.put(ConfigurationConstants.ADD_INCLUSIVE_PREFIXES,"false");
  config.put(ConfigurationConstants.SIG_PROP_FILE,"transmitter-crypto.properties");
  config.put(ConfigurationConstants.SIGNATURE_PARTS,"{}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  WSSSecurityProperties properties=ConfigurationConverter.convert(config);
  Assert.assertEquals(properties.getSignatureUser(),"transmitter");
  Assert.assertEquals(properties.getActions().size(),1);
  Assert.assertEquals(properties.getActions().get(0),WSSConstants.SIGNATURE);
  Assert.assertTrue(properties.getCallbackHandler() instanceof CallbackHandlerImpl);
  Assert.assertEquals(properties.getSignatureAlgorithm(),sigAlgo);
  Assert.assertEquals(properties.getSignatureKeyIdentifier(),WSSecurityTokenConstants.KEYIDENTIFIER_THUMBPRINT_IDENTIFIER);
  Assert.assertFalse(properties.isAddExcC14NInclusivePrefixes());
  Assert.assertNotNull(properties.getSignatureCrypto());
  Assert.assertTrue(properties.getSignatureSecureParts() != null);
  Assert.assertEquals(properties.getSignatureSecureParts().size(),1);
  Assert.assertEquals(properties.getSignatureSecureParts().get(0).getName().getLocalPart(),"Body");
  Assert.assertEquals(properties.getSignatureSecureParts().get(0).getName().getNamespaceURI(),"http://schemas.xmlsoap.org/soap/envelope/");
  WSSec.validateAndApplyDefaultsToOutboundSecurityProperties(properties);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimestampConfiguration() throws Exception {
  Map<String,Object> config=new HashMap<String,Object>();
  config.put(ConfigurationConstants.ACTION,ConfigurationConstants.TIMESTAMP);
  config.put(ConfigurationConstants.TTL_TIMESTAMP,"180");
  WSSSecurityProperties properties=ConfigurationConverter.convert(config);
  Assert.assertEquals(properties.getActions().size(),1);
  Assert.assertEquals(properties.getActions().get(0),WSSConstants.TIMESTAMP);
  Assert.assertEquals(properties.getTimestampTTL(),Integer.valueOf(180));
  WSSec.validateAndApplyDefaultsToOutboundSecurityProperties(properties);
  config.put(ConfigurationConstants.TTL_FUTURE_TIMESTAMP,"120");
  config.put(ConfigurationConstants.TIMESTAMP_STRICT,"false");
  properties=ConfigurationConverter.convert(config);
  Assert.assertEquals(properties.getTimeStampFutureTTL(),Integer.valueOf(120));
  Assert.assertFalse(properties.isStrictTimestampCheck());
  WSSec.validateAndApplyDefaultsToInboundSecurityProperties(properties);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInboundEncryptionConfiguration() throws Exception {
  Map<String,Object> config=new HashMap<String,Object>();
  config.put(ConfigurationConstants.ACTION,ConfigurationConstants.ENCRYPT);
  config.put(ConfigurationConstants.PW_CALLBACK_REF,new CallbackHandlerImpl());
  config.put(ConfigurationConstants.DEC_PROP_FILE,"receiver-crypto.properties");
  config.put(ConfigurationConstants.ALLOW_RSA15_KEY_TRANSPORT_ALGORITHM,"true");
  WSSSecurityProperties properties=ConfigurationConverter.convert(config);
  Assert.assertEquals(properties.getActions().size(),1);
  Assert.assertEquals(properties.getActions().get(0),WSSConstants.ENCRYPT);
  Assert.assertTrue(properties.getCallbackHandler() instanceof CallbackHandlerImpl);
  Assert.assertNotNull(properties.getDecryptionCrypto());
  WSSec.validateAndApplyDefaultsToInboundSecurityProperties(properties);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOutboundEncryptionConfiguration() throws Exception {
  Map<String,Object> config=new HashMap<String,Object>();
  config.put(ConfigurationConstants.ACTION,ConfigurationConstants.ENCRYPT);
  config.put(ConfigurationConstants.USER,"transmitter");
  config.put(ConfigurationConstants.PW_CALLBACK_REF,new CallbackHandlerImpl());
  config.put(ConfigurationConstants.ENC_KEY_TRANSPORT,WSSConstants.NS_XENC_RSA15);
  config.put(ConfigurationConstants.ENC_KEY_ID,"EncryptedKeySHA1");
  config.put(ConfigurationConstants.ENC_PROP_FILE,"receiver-crypto.properties");
  config.put(ConfigurationConstants.ENCRYPTION_PARTS,"{}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  WSSSecurityProperties properties=ConfigurationConverter.convert(config);
  Assert.assertEquals(properties.getEncryptionUser(),"transmitter");
  Assert.assertEquals(properties.getActions().size(),1);
  Assert.assertEquals(properties.getActions().get(0),WSSConstants.ENCRYPT);
  Assert.assertTrue(properties.getCallbackHandler() instanceof CallbackHandlerImpl);
  Assert.assertEquals(properties.getEncryptionKeyTransportAlgorithm(),WSSConstants.NS_XENC_RSA15);
  Assert.assertEquals(properties.getEncryptionKeyIdentifier(),WSSecurityTokenConstants.KEYIDENTIFIER_ENCRYPTED_KEY_SHA1_IDENTIFIER);
  Assert.assertNotNull(properties.getEncryptionCrypto());
  Assert.assertTrue(properties.getEncryptionSecureParts() != null);
  Assert.assertEquals(properties.getEncryptionSecureParts().size(),1);
  Assert.assertEquals(properties.getEncryptionSecureParts().get(0).getName().getLocalPart(),"Body");
  Assert.assertEquals(properties.getEncryptionSecureParts().get(0).getName().getNamespaceURI(),"http://schemas.xmlsoap.org/soap/envelope/");
  WSSec.validateAndApplyDefaultsToOutboundSecurityProperties(properties);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInboundSignatureConfiguration() throws Exception {
  Map<String,Object> config=new HashMap<String,Object>();
  config.put(ConfigurationConstants.ACTION,ConfigurationConstants.SIGNATURE);
  config.put(ConfigurationConstants.PW_CALLBACK_REF,new CallbackHandlerImpl());
  config.put(ConfigurationConstants.ADD_INCLUSIVE_PREFIXES,"false");
  config.put(ConfigurationConstants.SIG_VER_PROP_FILE,"transmitter-crypto.properties");
  config.put(ConfigurationConstants.IS_BSP_COMPLIANT,"false");
  config.put(ConfigurationConstants.ENABLE_REVOCATION,"true");
  WSSSecurityProperties properties=ConfigurationConverter.convert(config);
  Assert.assertEquals(properties.getActions().size(),1);
  Assert.assertEquals(properties.getActions().get(0),WSSConstants.SIGNATURE);
  Assert.assertTrue(properties.getCallbackHandler() instanceof CallbackHandlerImpl);
  Assert.assertTrue(properties.isDisableBSPEnforcement());
  Assert.assertTrue(properties.isEnableRevocation());
  Assert.assertNotNull(properties.getSignatureVerificationCrypto());
  WSSec.validateAndApplyDefaultsToInboundSecurityProperties(properties);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAMLConfiguration() throws Exception {
  Map<String,Object> config=new HashMap<String,Object>();
  config.put(ConfigurationConstants.ACTION,ConfigurationConstants.SAML_TOKEN_UNSIGNED);
  config.put(ConfigurationConstants.SAML_CALLBACK_REF,new SAMLCallbackHandlerImpl());
  WSSSecurityProperties properties=ConfigurationConverter.convert(config);
  Assert.assertEquals(properties.getActions().size(),1);
  Assert.assertEquals(properties.getActions().get(0),WSSConstants.SAML_TOKEN_UNSIGNED);
  Assert.assertTrue(properties.getSamlCallbackHandler() instanceof SAMLCallbackHandlerImpl);
  WSSec.validateAndApplyDefaultsToOutboundSecurityProperties(properties);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUsernameTokenConfiguration() throws Exception {
  Map<String,Object> config=new HashMap<String,Object>();
  config.put(ConfigurationConstants.ACTION,ConfigurationConstants.USERNAME_TOKEN);
  config.put(ConfigurationConstants.USER,"testuser");
  config.put(ConfigurationConstants.PW_CALLBACK_CLASS,"org.apache.wss4j.stax.test.CallbackHandlerImpl");
  config.put(ConfigurationConstants.PASSWORD_TYPE,"PasswordText");
  config.put(ConfigurationConstants.ADD_USERNAMETOKEN_NONCE,"true");
  config.put(ConfigurationConstants.ADD_USERNAMETOKEN_CREATED,"false");
  WSSSecurityProperties properties=ConfigurationConverter.convert(config);
  Assert.assertEquals(properties.getTokenUser(),"testuser");
  Assert.assertEquals(properties.getActions().size(),1);
  Assert.assertEquals(properties.getActions().get(0),WSSConstants.USERNAMETOKEN);
  Assert.assertTrue(properties.getCallbackHandler() instanceof CallbackHandlerImpl);
  Assert.assertEquals(properties.getUsernameTokenPasswordType(),UsernameTokenPasswordType.PASSWORD_TEXT);
  Assert.assertTrue(properties.isAddUsernameTokenNonce());
  Assert.assertFalse(properties.isAddUsernameTokenCreated());
  WSSec.validateAndApplyDefaultsToOutboundSecurityProperties(properties);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.DerivedKeyTokenTest </h4><pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSignatureSKIInboundAction() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE_DERIVED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.DERIVED_TOKEN_REFERENCE,"DirectReference");
    properties.put(WSHandlerConstants.DERIVED_TOKEN_KEY_ID,"SKIKeyIdentifier");
    if (version == ConversationConstants.VERSION_05_02) {
      properties.put(WSHandlerConstants.USE_2005_12_NAMESPACE,"false");
    }
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEncryptSignatureInboundAction() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE_DERIVED + " " + WSHandlerConstants.ENCRYPT_DERIVED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.DERIVED_TOKEN_REFERENCE,"EncryptedKey");
    if (version == ConversationConstants.VERSION_05_02) {
      properties.put(WSHandlerConstants.USE_2005_12_NAMESPACE,"false");
    }
    properties.put(WSHandlerConstants.USER,"receiver");
    properties.put(WSHandlerConstants.SIG_ALGO,"http://www.w3.org/2000/09/xmldsig#hmac-sha1");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SOAP11_BODY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEncryptionDecryptionTRIPLEDESOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT_WITH_DERIVED_KEY);
    securityProperties.setActions(actions);
    byte[] secret=WSSConstants.generateBytes(192 / 8);
    CallbackHandlerImpl callbackHandler=new CallbackHandlerImpl(secret);
    securityProperties.setCallbackHandler(callbackHandler);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.setEncryptionSymAlgorithm("http://www.w3.org/2001/04/xmlenc#tripledes-cbc");
    securityProperties.setEncryptionKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_THUMBPRINT_IDENTIFIER);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SOAP11_BODY.getLocalPart());
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSignatureOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE_WITH_DERIVED_KEY);
    securityProperties.setActions(actions);
    CallbackHandlerImpl callbackHandler=new CallbackHandlerImpl();
    securityProperties.setCallbackHandler(callbackHandler);
    securityProperties.setEncryptionKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_THUMBPRINT_IDENTIFIER);
    securityProperties.setSignatureAlgorithm("http://www.w3.org/2000/09/xmldsig#hmac-sha1");
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.setDerivedKeyTokenReference(WSSConstants.DerivedKeyTokenReference.EncryptedKey);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("receiver");
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEncryptionDecryptionTRIPLEDESInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    WSSecSecurityContextToken sctBuilder=new WSSecSecurityContextToken();
    Crypto crypto=CryptoFactory.getInstance("transmitter-crypto.properties");
    sctBuilder.setWscVersion(version);
    sctBuilder.prepare(doc,crypto);
    WSSecEncryptedKey encrKeyBuilder=new WSSecEncryptedKey();
    encrKeyBuilder.setUserInfo("receiver");
    encrKeyBuilder.setKeyIdentifierType(WSConstants.THUMBPRINT_IDENTIFIER);
    encrKeyBuilder.prepare(doc,crypto);
    byte[] ek=encrKeyBuilder.getEphemeralKey();
    String tokenIdentifier=encrKeyBuilder.getId();
    WSSecDKEncrypt encrBuilder=new WSSecDKEncrypt();
    encrBuilder.setWscVersion(version);
    encrBuilder.setSymmetricEncAlgorithm(WSConstants.TRIPLE_DES);
    encrBuilder.setExternalKey(ek,tokenIdentifier);
    encrBuilder.build(doc,secHeader);
    encrKeyBuilder.prependToHeader(secHeader);
    encrKeyBuilder.prependBSTElementToHeader(secHeader);
    NodeList nodeList=doc.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    SecurityEventConstants.Event[] expectedSecurityEvents=new SecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    securityEventListener.compare();
    EncryptedPartSecurityEvent encryptedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.ENCRYPTED_PART);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String encryptedPartCorrelationID=encryptedPartSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID)) {
        encryptedPartSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(6,encryptedPartSecurityEvents.size());
    Assert.assertEquals(1,operationSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + encryptedPartSecurityEvents.size());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEncryptSignatureInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    Crypto crypto=CryptoFactory.getInstance("transmitter-crypto.properties");
    WSSecEncryptedKey encrKeyBuilder=new WSSecEncryptedKey();
    encrKeyBuilder.setUserInfo("receiver");
    encrKeyBuilder.setKeyIdentifierType(WSConstants.THUMBPRINT_IDENTIFIER);
    encrKeyBuilder.prepare(doc,crypto);
    byte[] ek=encrKeyBuilder.getEphemeralKey();
    String tokenIdentifier=encrKeyBuilder.getId();
    WSSecDKEncrypt encrBuilder=new WSSecDKEncrypt();
    encrBuilder.setWscVersion(version);
    encrBuilder.setSymmetricEncAlgorithm(WSConstants.AES_128);
    encrBuilder.setExternalKey(ek,tokenIdentifier);
    encrBuilder.build(doc,secHeader);
    WSSecDKSign sigBuilder=new WSSecDKSign();
    sigBuilder.setWscVersion(version);
    sigBuilder.setExternalKey(ek,tokenIdentifier);
    sigBuilder.setSignatureAlgorithm(WSConstants.HMAC_SHA1);
    sigBuilder.build(doc,secHeader);
    encrKeyBuilder.prependToHeader(secHeader);
    encrKeyBuilder.prependBSTElementToHeader(secHeader);
    NodeList nodeList=doc.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=doc.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEncryptionDecryptionAES128Inbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    WSSecSecurityContextToken sctBuilder=new WSSecSecurityContextToken();
    sctBuilder.setWscVersion(version);
    Crypto crypto=CryptoFactory.getInstance("transmitter-crypto.properties");
    sctBuilder.prepare(doc,crypto);
    WSSecEncryptedKey encrKeyBuilder=new WSSecEncryptedKey();
    encrKeyBuilder.setUserInfo("receiver");
    encrKeyBuilder.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
    encrKeyBuilder.prepare(doc,crypto);
    byte[] ek=encrKeyBuilder.getEphemeralKey();
    String tokenIdentifier=encrKeyBuilder.getId();
    WSSecDKEncrypt encrBuilder=new WSSecDKEncrypt();
    encrBuilder.setWscVersion(version);
    encrBuilder.setSymmetricEncAlgorithm(WSConstants.AES_128);
    encrBuilder.setExternalKey(ek,tokenIdentifier);
    encrBuilder.build(doc,secHeader);
    encrKeyBuilder.prependToHeader(secHeader);
    encrKeyBuilder.prependBSTElementToHeader(secHeader);
    NodeList nodeList=doc.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSignatureInboundAction() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE_DERIVED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.DERIVED_TOKEN_REFERENCE,"EncryptedKey");
    if (version == ConversationConstants.VERSION_05_02) {
      properties.put(WSHandlerConstants.USE_2005_12_NAMESPACE,"false");
    }
    properties.put(WSHandlerConstants.USER,"receiver");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSignatureSKIInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    SecurityTokenReference secToken=new SecurityTokenReference(doc);
    CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
    cryptoType.setAlias("transmitter");
    Crypto crypto=CryptoFactory.getInstance("transmitter-crypto.properties");
    X509Certificate[] certs=crypto.getX509Certificates(cryptoType);
    secToken.setKeyIdentifierSKI(certs[0],crypto);
    WSSecDKSign sigBuilder=new WSSecDKSign();
    sigBuilder.setWscVersion(version);
    java.security.Key key=crypto.getPrivateKey("transmitter","default");
    sigBuilder.setExternalKey(key.getEncoded(),secToken.getElement());
    sigBuilder.setSignatureAlgorithm(WSConstants.HMAC_SHA1);
    sigBuilder.build(doc,secHeader);
    sigBuilder.prependDKElementToHeader(secHeader);
    NodeList nodeList=doc.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSignatureThumbprintSHA1Outbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE_WITH_DERIVED_KEY);
    securityProperties.setActions(actions);
    CallbackHandlerImpl callbackHandler=new CallbackHandlerImpl();
    securityProperties.setCallbackHandler(callbackHandler);
    securityProperties.setSignatureAlgorithm("http://www.w3.org/2000/09/xmldsig#hmac-sha1");
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("receiver");
    securityProperties.setDerivedKeyTokenReference(WSSConstants.DerivedKeyTokenReference.DirectReference);
    securityProperties.setDerivedKeyKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_THUMBPRINT_IDENTIFIER);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSC0512_SCT.getNamespaceURI(),WSSConstants.TAG_WSC0512_SCT.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSC0512_DKT.getNamespaceURI(),WSSConstants.TAG_WSC0512_DKT.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_KEY_IDENTIFIER.getNamespaceURI(),WSSConstants.TAG_WSSE_KEY_IDENTIFIER.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Attr attr=(Attr)nodeList.item(0).getAttributes().getNamedItem(WSSConstants.ATT_NULL_VALUE_TYPE.getLocalPart());
    Assert.assertEquals(attr.getValue(),WSSConstants.NS_THUMBPRINT);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSignatureThumbprintSHA1Inbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    SecurityTokenReference secToken=new SecurityTokenReference(doc);
    CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
    cryptoType.setAlias("transmitter");
    Crypto crypto=CryptoFactory.getInstance("transmitter-crypto.properties");
    X509Certificate[] certs=crypto.getX509Certificates(cryptoType);
    secToken.setKeyIdentifierThumb(certs[0]);
    WSSecDKSign sigBuilder=new WSSecDKSign();
    sigBuilder.setWscVersion(version);
    java.security.Key key=crypto.getPrivateKey("transmitter","default");
    sigBuilder.setExternalKey(key.getEncoded(),secToken.getElement());
    sigBuilder.setSignatureAlgorithm(WSConstants.HMAC_SHA1);
    sigBuilder.build(doc,secHeader);
    sigBuilder.prependDKElementToHeader(secHeader);
    NodeList nodeList=doc.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSignatureSKIOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE_WITH_DERIVED_KEY);
    securityProperties.setActions(actions);
    CallbackHandlerImpl callbackHandler=new CallbackHandlerImpl();
    securityProperties.setCallbackHandler(callbackHandler);
    securityProperties.setSignatureAlgorithm("http://www.w3.org/2000/09/xmldsig#hmac-sha1");
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("receiver");
    securityProperties.setDerivedKeyTokenReference(WSSConstants.DerivedKeyTokenReference.DirectReference);
    securityProperties.setDerivedKeyKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_SkiKeyIdentifier);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSC0512_SCT.getNamespaceURI(),WSSConstants.TAG_WSC0512_SCT.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSC0512_DKT.getNamespaceURI(),WSSConstants.TAG_WSC0512_DKT.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_KEY_IDENTIFIER.getNamespaceURI(),WSSConstants.TAG_WSSE_KEY_IDENTIFIER.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Attr attr=(Attr)nodeList.item(0).getAttributes().getNamedItem(WSSConstants.ATT_NULL_VALUE_TYPE.getLocalPart());
    Assert.assertEquals(attr.getValue(),WSSConstants.NS_X509_SKI);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEncryptionDecryptionTRIPLEDESInboundAction() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT_DERIVED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.DERIVED_TOKEN_REFERENCE,"EncryptedKey");
    if (version == ConversationConstants.VERSION_05_02) {
      properties.put(WSHandlerConstants.USE_2005_12_NAMESPACE,"false");
    }
    properties.put(WSHandlerConstants.USER,"receiver");
    properties.put(WSHandlerConstants.ENC_SYM_ALGO,"http://www.w3.org/2001/04/xmlenc#tripledes-cbc");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SOAP11_BODY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    SecurityEventConstants.Event[] expectedSecurityEvents=new SecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    securityEventListener.compare();
    EncryptedPartSecurityEvent encryptedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.ENCRYPTED_PART);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String encryptedPartCorrelationID=encryptedPartSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID)) {
        encryptedPartSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(6,encryptedPartSecurityEvents.size());
    Assert.assertEquals(1,operationSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + encryptedPartSecurityEvents.size());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEncryptionDecryptionAES128InboundAction() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT_DERIVED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.DERIVED_TOKEN_REFERENCE,"EncryptedKey");
    if (version == ConversationConstants.VERSION_05_02) {
      properties.put(WSHandlerConstants.USE_2005_12_NAMESPACE,"false");
    }
    properties.put(WSHandlerConstants.USER,"receiver");
    properties.put(WSHandlerConstants.ENC_SYM_ALGO,"http://www.w3.org/2001/04/xmlenc#aes128-cbc");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SOAP11_BODY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSignatureEncryptInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    Crypto crypto=CryptoFactory.getInstance("transmitter-crypto.properties");
    WSSecEncryptedKey encrKeyBuilder=new WSSecEncryptedKey();
    encrKeyBuilder.setUserInfo("receiver");
    encrKeyBuilder.setKeyIdentifierType(WSConstants.THUMBPRINT_IDENTIFIER);
    encrKeyBuilder.prepare(doc,crypto);
    byte[] ek=encrKeyBuilder.getEphemeralKey();
    String tokenIdentifier=encrKeyBuilder.getId();
    WSSecDKSign sigBuilder=new WSSecDKSign();
    sigBuilder.setWscVersion(version);
    sigBuilder.setExternalKey(ek,tokenIdentifier);
    sigBuilder.setSignatureAlgorithm(WSConstants.HMAC_SHA1);
    Document signedDoc=sigBuilder.build(doc,secHeader);
    WSSecDKEncrypt encrBuilder=new WSSecDKEncrypt();
    encrBuilder.setWscVersion(version);
    encrBuilder.setSymmetricEncAlgorithm(WSConstants.AES_128);
    encrBuilder.setExternalKey(ek,tokenIdentifier);
    encrBuilder.build(signedDoc,secHeader);
    encrKeyBuilder.prependToHeader(secHeader);
    encrKeyBuilder.prependBSTElementToHeader(secHeader);
    NodeList nodeList=doc.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=doc.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.SignatureValue,WSSecurityEventConstants.SIGNED_PART,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    securityEventListener.compare();
    EncryptedPartSecurityEvent encryptedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.ENCRYPTED_PART);
    SignedPartSecurityEvent signedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SIGNED_PART);
    SignatureValueSecurityEvent signatureValueSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SignatureValue);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String encryptedPartCorrelationID=encryptedPartSecurityEvent.getCorrelationID();
    String signedElementCorrelationID=signedPartSecurityEvent.getCorrelationID();
    String signatureValueCorrelationID=signatureValueSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> signedElementSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> signatureValueSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID)) {
        encryptedPartSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(signedElementCorrelationID)) {
        signedElementSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(signatureValueCorrelationID)) {
        signatureValueSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(5,encryptedPartSecurityEvents.size());
    Assert.assertEquals(3,signedElementSecurityEvents.size());
    Assert.assertEquals(6,signatureValueSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + encryptedPartSecurityEvents.size() + signedElementSecurityEvents.size()+ signatureValueSecurityEvents.size());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSignatureThumbprintSHA1InboundAction() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE_DERIVED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.DERIVED_TOKEN_REFERENCE,"DirectReference");
    if (version == ConversationConstants.VERSION_05_02) {
      properties.put(WSHandlerConstants.USE_2005_12_NAMESPACE,"false");
    }
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSignatureEncryptOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE_WITH_DERIVED_KEY);
    actions.add(WSSConstants.ENCRYPT_WITH_DERIVED_KEY);
    securityProperties.setActions(actions);
    CallbackHandlerImpl callbackHandler=new CallbackHandlerImpl();
    securityProperties.setCallbackHandler(callbackHandler);
    securityProperties.setSignatureAlgorithm("http://www.w3.org/2000/09/xmldsig#hmac-sha1");
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("receiver");
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.setEncryptionKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_THUMBPRINT_IDENTIFIER);
    securityProperties.setDerivedKeyTokenReference(WSSConstants.DerivedKeyTokenReference.EncryptedKey);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSC0512_SCT.getNamespaceURI(),WSSConstants.TAG_WSC0512_SCT.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSC0512_DKT.getNamespaceURI(),WSSConstants.TAG_WSC0512_DKT.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEncryptionDecryptionAES128Outbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT_WITH_DERIVED_KEY);
    securityProperties.setActions(actions);
    byte[] secret=WSSConstants.generateBytes(128 / 8);
    CallbackHandlerImpl callbackHandler=new CallbackHandlerImpl(secret);
    securityProperties.setCallbackHandler(callbackHandler);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.setEncryptionSymAlgorithm("http://www.w3.org/2001/04/xmlenc#aes128-cbc");
    securityProperties.setEncryptionKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_THUMBPRINT_IDENTIFIER);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SOAP11_BODY.getLocalPart());
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSignatureInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    WSSecEncryptedKey encrKeyBuilder=new WSSecEncryptedKey();
    encrKeyBuilder.setUserInfo("receiver");
    encrKeyBuilder.setKeyIdentifierType(WSConstants.THUMBPRINT_IDENTIFIER);
    Crypto crypto=CryptoFactory.getInstance("transmitter-crypto.properties");
    encrKeyBuilder.prepare(doc,crypto);
    byte[] ek=encrKeyBuilder.getEphemeralKey();
    String tokenIdentifier=encrKeyBuilder.getId();
    WSSecDKSign sigBuilder=new WSSecDKSign();
    sigBuilder.setWscVersion(version);
    sigBuilder.setExternalKey(ek,tokenIdentifier);
    sigBuilder.setSignatureAlgorithm(WSConstants.HMAC_SHA1);
    sigBuilder.build(doc,secHeader);
    encrKeyBuilder.prependToHeader(secHeader);
    encrKeyBuilder.prependBSTElementToHeader(secHeader);
    NodeList nodeList=doc.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.EncDecryptionTest </h4><pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testElementoEncryptNotFound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.setTokenUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.NS_WSSE10,"UsernameToken"),SecurePart.Modifier.Element));
    securityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.NS_SOAP11,"Body"),SecurePart.Modifier.Content));
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    try {
      XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
      xmlStreamWriter.close();
      Assert.fail("Exception expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof XMLSecurityException);
      Assert.assertEquals("Part to encrypt not found: {http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}UsernameToken",e.getCause().getMessage());
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEncDecryptionPartsElementOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://www.w3.org/1999/XMLSchema","complexType"),SecurePart.Modifier.Element));
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),25);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),25);
    nodeList=document.getElementsByTagNameNS("http://www.w3.org/1999/XMLSchema","complexType");
    Assert.assertEquals(nodeList.getLength(),0);
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * not possible with swssf atm
 * @Test public void testEncDecryptionKeyIdentifierBinarySecurityTokenDirectReferenceAtTheEndOfTheSecurityHeaderInbound() throws Exception {
 * <p/>
 * ByteArrayOutputStream baos = new ByteArrayOutputStream();
 * {
 * InputStream sourceDocument = this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
 * String action = WSHandlerConstants.ENCRYPT;
 * Properties properties = new Properties();
 * properties.setProperty(WSHandlerConstants.ENC_KEY_ID, "DirectReference");
 * Document securedDocument = doOutboundSecurityWithWSS4J(sourceDocument, action, properties);
 * <p/>
 * //some test that we can really sure we get what we want from WSS4J
 * XPathExpression xPathExpression = getXPath("/soap:Envelope/soap:Header/wsse:Security/wsse:BinarySecurityToken");
 * Node node = (Node) xPathExpression.evaluate(securedDocument, XPathConstants.NODE);
 * Assert.assertNotNull(node);
 * Element parentElement = (Element) node.getParentNode();
 * parentElement.removeChild(node);
 * parentElement.appendChild(node);
 * <p/>
 * Transformer transformer = TRANSFORMER_FACTORY.newTransformer();
 * transformer.transform(new DOMSource(securedDocument), new StreamResult(baos));
 * }
 * <p/>
 * //done encryption; now test decryption:
 * {
 * WSSSecurityProperties securityProperties = new WSSSecurityProperties();
 * securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"), "default".toCharArray());
 * securityProperties.setCallbackHandler(new org.apache.wss4j.test.CallbackHandlerImpl());
 * Document document = doInboundSecurity(securityProperties, xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
 * <p/>
 * //header element must still be there
 * NodeList nodeList = document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(), WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
 * Assert.assertEquals(nodeList.getLength(), 1);
 * Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(), WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
 * <p/>
 * //no encrypted content
 * nodeList = document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(), WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
 * Assert.assertEquals(nodeList.getLength(), 0);
 * }
 * }
 */
@Test public void testEncDecryptionKeyIdentifierX509KeyOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.setEncryptionKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_X509KeyIdentifier);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionPartsContentInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.ENCRYPTION_PARTS,"{Content}{http://www.w3.org/1999/XMLSchema}simpleType;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.X509Token,WSSecurityEventConstants.OPERATION,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.ContentEncrypted};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),securityEventListener);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    securityEventListener.compare();
    List<SecurityEvent> receivedSecurityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < receivedSecurityEvents.size(); i++) {
      SecurityEvent securityEvent=receivedSecurityEvents.get(i);
      if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.OPERATION) {
        OperationSecurityEvent operationSecurityEvent=(OperationSecurityEvent)securityEvent;
        Assert.assertEquals(operationSecurityEvent.getOperation(),new QName("http://schemas.xmlsoap.org/wsdl/","definitions"));
      }
 else       if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.ContentEncrypted) {
        ContentEncryptedElementSecurityEvent contentEncryptedElementSecurityEvent=(ContentEncryptedElementSecurityEvent)securityEvent;
        Assert.assertNotNull(contentEncryptedElementSecurityEvent.getXmlSecEvent());
        Assert.assertNotNull(contentEncryptedElementSecurityEvent.getSecurityToken());
        Assert.assertNotNull(contentEncryptedElementSecurityEvent.getElementPath());
        final QName expectedElementName=new QName("http://www.w3.org/1999/XMLSchema","simpleType");
        Assert.assertEquals(contentEncryptedElementSecurityEvent.getXmlSecEvent().asStartElement().getName(),expectedElementName);
        Assert.assertEquals(contentEncryptedElementSecurityEvent.getElementPath().size(),6);
        Assert.assertEquals(contentEncryptedElementSecurityEvent.getElementPath().get(contentEncryptedElementSecurityEvent.getElementPath().size() - 1),expectedElementName);
      }
    }
    List<ContentEncryptedElementSecurityEvent> contentEncryptedElementSecurityEventList=securityEventListener.getSecurityEvents(SecurityEventConstants.ContentEncrypted);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String encryptedPartCorrelationID1=contentEncryptedElementSecurityEventList.get(0).getCorrelationID();
    String encryptedPartCorrelationID2=contentEncryptedElementSecurityEventList.get(1).getCorrelationID();
    String encryptedPartCorrelationID3=contentEncryptedElementSecurityEventList.get(2).getCorrelationID();
    String encryptedPartCorrelationID4=contentEncryptedElementSecurityEventList.get(3).getCorrelationID();
    String encryptedPartCorrelationID5=contentEncryptedElementSecurityEventList.get(4).getCorrelationID();
    String encryptedPartCorrelationID6=contentEncryptedElementSecurityEventList.get(5).getCorrelationID();
    String encryptedPartCorrelationID7=contentEncryptedElementSecurityEventList.get(6).getCorrelationID();
    String encryptedPartCorrelationID8=contentEncryptedElementSecurityEventList.get(7).getCorrelationID();
    String encryptedPartCorrelationID9=contentEncryptedElementSecurityEventList.get(8).getCorrelationID();
    String encryptedPartCorrelationID10=contentEncryptedElementSecurityEventList.get(9).getCorrelationID();
    String encryptedPartCorrelationID11=contentEncryptedElementSecurityEventList.get(10).getCorrelationID();
    String encryptedPartCorrelationID12=contentEncryptedElementSecurityEventList.get(11).getCorrelationID();
    String encryptedPartCorrelationID13=contentEncryptedElementSecurityEventList.get(12).getCorrelationID();
    String encryptedPartCorrelationID14=contentEncryptedElementSecurityEventList.get(13).getCorrelationID();
    String encryptedPartCorrelationID15=contentEncryptedElementSecurityEventList.get(14).getCorrelationID();
    String encryptedPartCorrelationID16=contentEncryptedElementSecurityEventList.get(15).getCorrelationID();
    String encryptedPartCorrelationID17=contentEncryptedElementSecurityEventList.get(16).getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents1=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents2=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents3=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents4=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents5=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents6=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents7=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents8=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents9=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents10=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents11=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents12=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents13=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents14=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents15=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents16=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents17=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID1)) {
        encryptedPartSecurityEvents1.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID2)) {
        encryptedPartSecurityEvents2.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID3)) {
        encryptedPartSecurityEvents3.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID4)) {
        encryptedPartSecurityEvents4.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID5)) {
        encryptedPartSecurityEvents5.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID6)) {
        encryptedPartSecurityEvents6.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID7)) {
        encryptedPartSecurityEvents7.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID8)) {
        encryptedPartSecurityEvents8.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID9)) {
        encryptedPartSecurityEvents9.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID10)) {
        encryptedPartSecurityEvents10.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID11)) {
        encryptedPartSecurityEvents11.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID12)) {
        encryptedPartSecurityEvents12.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID13)) {
        encryptedPartSecurityEvents13.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID14)) {
        encryptedPartSecurityEvents14.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID15)) {
        encryptedPartSecurityEvents15.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID16)) {
        encryptedPartSecurityEvents16.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID17)) {
        encryptedPartSecurityEvents17.add(securityEvent);
      }
    }
    Assert.assertEquals(4,encryptedPartSecurityEvents1.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents2.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents3.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents4.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents5.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents6.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents7.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents8.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents9.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents10.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents11.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents12.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents13.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents14.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents15.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents16.size());
    Assert.assertEquals(3,encryptedPartSecurityEvents17.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + encryptedPartSecurityEvents1.size() + encryptedPartSecurityEvents2.size()+ encryptedPartSecurityEvents3.size()+ encryptedPartSecurityEvents4.size()+ encryptedPartSecurityEvents5.size()+ encryptedPartSecurityEvents6.size()+ encryptedPartSecurityEvents7.size()+ encryptedPartSecurityEvents8.size()+ encryptedPartSecurityEvents9.size()+ encryptedPartSecurityEvents10.size()+ encryptedPartSecurityEvents11.size()+ encryptedPartSecurityEvents12.size()+ encryptedPartSecurityEvents13.size()+ encryptedPartSecurityEvents14.size()+ encryptedPartSecurityEvents15.size()+ encryptedPartSecurityEvents16.size()+ encryptedPartSecurityEvents17.size()+ 1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionUseThisCert() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    KeyStore keyStore=KeyStore.getInstance("jks");
    keyStore.load(this.getClass().getClassLoader().getResourceAsStream("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUseThisCertificate((X509Certificate)keyStore.getCertificate("receiver"));
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),"Body");
    NodeList childNodes=nodeList.item(0).getParentNode().getChildNodes();
    for (int i=0; i < childNodes.getLength(); i++) {
      Node child=childNodes.item(i);
      if (child.getNodeType() == Node.TEXT_NODE) {
        Assert.assertEquals(child.getTextContent().trim(),"");
      }
 else       if (child.getNodeType() == Node.ELEMENT_NODE) {
        Assert.assertEquals(child,nodeList.item(0));
      }
 else {
        Assert.fail("Unexpected Node encountered");
      }
    }
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    Document document=doInboundSecurity(securityProperties,new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKeyWrappingRSAOAEPMGF1AESGCM128Inbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.ENC_SYM_ALGO,"http://www.w3.org/2009/xmlenc11#aes128-gcm");
    properties.put(WSHandlerConstants.ENC_KEY_TRANSPORT,"http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#aes128-gcm']");
    node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionKeyIdentifierIssuerSerialOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.setEncryptionKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_IssuerSerial);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/dsig:KeyInfo/wsse:SecurityTokenReference/dsig:X509Data/dsig:X509IssuerSerial/dsig:X509SerialNumber");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEncDecryptionPartsHeaderOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://www.w3.org/1999/XMLSchema","complexType"),SecurePart.Modifier.Element));
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://www.example.com","testEncryptedHeader"),SecurePart.Modifier.Element));
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-encryptedHeader.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),27);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),26);
    nodeList=document.getElementsByTagNameNS("http://www.w3.org/1999/XMLSchema","complexType");
    Assert.assertEquals(nodeList.getLength(),0);
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * rsa-oaep, Digest:SHA384, MGF:SHA1, PSource: None
 */
@Test public void testKeyWrappingRSAOAEPAES192GCMSHA384MGF1sha384Outbound() throws Exception {
  try {
    Security.addProvider(new BouncyCastleProvider());
    ByteArrayOutputStream baos;
{
      WSSSecurityProperties securityProperties=new WSSSecurityProperties();
      List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
      actions.add(WSSConstants.ENCRYPT);
      securityProperties.setActions(actions);
      securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
      securityProperties.setEncryptionUser("receiver");
      securityProperties.setEncryptionSymAlgorithm("http://www.w3.org/2009/xmlenc11#aes192-gcm");
      securityProperties.setEncryptionKeyTransportAlgorithm("http://www.w3.org/2009/xmlenc11#rsa-oaep");
      securityProperties.setEncryptionKeyTransportDigestAlgorithm("http://www.w3.org/2001/04/xmldsig-more#sha384");
      securityProperties.setEncryptionKeyTransportMGFAlgorithm("http://www.w3.org/2009/xmlenc11#mgf1sha384");
      InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
      baos=doOutboundSecurity(securityProperties,sourceDocument);
      Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
      NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
      Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
      XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#rsa-oaep']");
      Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod/dsig:DigestMethod[@Algorithm='http://www.w3.org/2001/04/xmldsig-more#sha384']");
      node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod/xenc11:MGF[@Algorithm='http://www.w3.org/2009/xmlenc11#mgf1sha384']");
      node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
      Assert.assertEquals(nodeList.getLength(),1);
      nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
      Assert.assertEquals(nodeList.getLength(),1);
      xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#aes192-gcm']");
      node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      Assert.assertEquals(node.getParentNode().getParentNode().getLocalName(),"Body");
      NodeList childNodes=node.getParentNode().getParentNode().getChildNodes();
      for (int i=0; i < childNodes.getLength(); i++) {
        Node child=childNodes.item(i);
        if (child.getNodeType() == Node.TEXT_NODE) {
          Assert.assertEquals(child.getTextContent().trim(),"");
        }
 else         if (child.getNodeType() == Node.ELEMENT_NODE) {
          Assert.assertEquals(child,nodeList.item(0));
        }
 else {
          Assert.fail("Unexpected Node encountered");
        }
      }
    }
{
      String action=WSHandlerConstants.ENCRYPT;
      doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
    }
  }
  finally {
    Security.removeProvider(BouncyCastleProvider.PROVIDER_NAME);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKeyWrappingRSAOAEPAESGMC192SHA256Inbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.ENC_SYM_ALGO,"http://www.w3.org/2009/xmlenc11#aes192-gcm");
    properties.put(WSHandlerConstants.ENC_KEY_TRANSPORT,"http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p");
    properties.put(WSHandlerConstants.ENC_DIGEST_ALGO,"http://www.w3.org/2001/04/xmlenc#sha256");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod/dsig:DigestMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#sha256']");
    node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#aes192-gcm']");
    node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.addIgnoreBSPRule(BSPRule.R5620);
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEncDecryptionSuperEncryptionInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
    securedDocument=doOutboundSecurityWithWSS4J(new ByteArrayInputStream(baos.toByteArray()),action,new Properties());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    NodeList nodeList=(NodeList)xPathExpression.evaluate(securedDocument,XPathConstants.NODESET);
    Assert.assertEquals(nodeList.getLength(),2);
    transformer=TRANSFORMER_FACTORY.newTransformer();
    baos.reset();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionKeyIdentifierThumbprintOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.setEncryptionKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_THUMBPRINT_IDENTIFIER);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/oasis-wss-soap-message-security-1.1#ThumbprintSHA1']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionKeyIdentifierX509KeyInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.ENC_KEY_ID,"X509KeyIdentifier");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test @org.junit.Ignore public void testKeyWrappingRSAOAEPAESGCM192SHA384MGF1SHA384PSourceInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.ENC_SYM_ALGO,"http://www.w3.org/2009/xmlenc11#aes192-gcm");
    properties.put(WSHandlerConstants.ENC_KEY_TRANSPORT,"http://www.w3.org/2009/xmlenc11#rsa-oaep");
    properties.put(WSHandlerConstants.ENC_DIGEST_ALGO,"http://www.w3.org/2001/04/xmldsig-more#sha384");
    properties.put(WSHandlerConstants.ENC_MGF_ALGO,"http://www.w3.org/2009/xmlenc11#mgf1sha384");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#rsa-oaep']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod/xenc:OAEPparams");
    node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod/dsig:DigestMethod[@Algorithm='http://www.w3.org/2001/04/xmldsig-more#sha384']");
    node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod/dsig:MGF[@Algorithm='http://www.w3.org/2009/xmlenc11#mgf1sha384']");
    node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#aes192-gcm']");
    node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.addIgnoreBSPRule(BSPRule.R5620);
    securityProperties.addIgnoreBSPRule(BSPRule.R5621);
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEncryptedDataSecurityHeaderWithoutReferenceInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    Document doc=documentBuilderFactory.newDocumentBuilder().parse(sourceDocument);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    Element securityHeaderElement=secHeader.getSecurityHeader();
    securityHeaderElement.appendChild(doc.getElementsByTagNameNS("http://schemas.xmlsoap.org/wsdl/","definitions").item(0));
    WSSecEncrypt builder=new WSSecEncrypt();
    builder.setKeyIdentifierType(WSConstants.THUMBPRINT_IDENTIFIER);
    builder.setUserInfo("receiver");
    Crypto crypto=CryptoFactory.getInstance("transmitter-crypto.properties");
    builder.prepare(doc,crypto);
    WSEncryptionPart encP=new WSEncryptionPart("definitions","http://schemas.xmlsoap.org/wsdl/","Element");
    List<WSEncryptionPart> encryptionParts=new ArrayList<WSEncryptionPart>();
    encryptionParts.add(encP);
    Element ref=builder.encryptForRef(null,encryptionParts);
    ref.removeChild(ref.getElementsByTagNameNS("http://www.w3.org/2001/04/xmlenc#","DataReference").item(0));
    builder.addExternalRefElement(ref,secHeader);
    builder.prependToHeader(secHeader);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionKeyIdentifierSHA1Inbound() throws Exception {
  KeyGenerator keyGen=KeyGenerator.getInstance("AES");
  keyGen.init(128);
  SecretKey key=keyGen.generateKey();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    Document doc=documentBuilderFactory.newDocumentBuilder().parse(sourceDocument);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    WSSecEncrypt builder=new WSSecEncrypt();
    builder.setKeyIdentifierType(WSConstants.ENCRYPTED_KEY_SHA1_IDENTIFIER);
    builder.setSymmetricKey(key);
    builder.setEncryptSymmKey(false);
    Document securedDocument=builder.build(doc,null,secHeader);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/oasis-wss-soap-message-security-1.1#EncryptedKeySHA1']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl(key.getEncoded()));
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionKeyIdentifierSubjectKeyOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.setEncryptionKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_SkiKeyIdentifier);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509SubjectKeyIdentifier']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionCryptoPropertiesInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    Properties properties=CryptoFactory.getProperties("receiver-crypto.properties",this.getClass().getClassLoader());
    securityProperties.setDecryptionCryptoProperties(properties);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),securityEventListener);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    securityEventListener.compare();
    List<SecurityEvent> receivedSecurityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < receivedSecurityEvents.size(); i++) {
      SecurityEvent securityEvent=receivedSecurityEvents.get(i);
      if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.OPERATION) {
        OperationSecurityEvent operationSecurityEvent=(OperationSecurityEvent)securityEvent;
        Assert.assertEquals(operationSecurityEvent.getOperation(),new QName("http://schemas.xmlsoap.org/wsdl/","definitions"));
      }
 else       if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.ENCRYPTED_PART) {
        EncryptedPartSecurityEvent encryptedPartSecurityEvent=(EncryptedPartSecurityEvent)securityEvent;
        Assert.assertNotNull(encryptedPartSecurityEvent.getXmlSecEvent());
        Assert.assertNotNull(encryptedPartSecurityEvent.getSecurityToken());
        Assert.assertNotNull(encryptedPartSecurityEvent.getElementPath());
        final QName expectedElementName=new QName("http://schemas.xmlsoap.org/soap/envelope/","Body");
        Assert.assertEquals(encryptedPartSecurityEvent.getXmlSecEvent().asStartElement().getName(),expectedElementName);
        Assert.assertEquals(encryptedPartSecurityEvent.getElementPath().size(),2);
        Assert.assertEquals(encryptedPartSecurityEvent.getElementPath().get(encryptedPartSecurityEvent.getElementPath().size() - 1),expectedElementName);
      }
    }
    EncryptedPartSecurityEvent encryptedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.ENCRYPTED_PART);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String encryptedPartCorrelationID=encryptedPartSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID)) {
        encryptedPartSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(4,encryptedPartSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + encryptedPartSecurityEvents.size());
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionCryptoPropertiesOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    Properties properties=CryptoFactory.getProperties("transmitter-crypto.properties",this.getClass().getClassLoader());
    securityProperties.setEncryptionCryptoProperties(properties);
    securityProperties.setEncryptionUser("receiver");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#aes256-cbc']");
    node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Assert.assertEquals(node.getParentNode().getParentNode().getLocalName(),"Body");
    NodeList childNodes=node.getParentNode().getParentNode().getChildNodes();
    for (int i=0; i < childNodes.getLength(); i++) {
      Node child=childNodes.item(i);
      if (child.getNodeType() == Node.TEXT_NODE) {
        Assert.assertEquals(child.getTextContent().trim(),"");
      }
 else       if (child.getNodeType() == Node.ELEMENT_NODE) {
        Assert.assertEquals(child,nodeList.item(0));
      }
 else {
        Assert.fail("Unexpected Node encountered");
      }
    }
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionPartsContentOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://www.w3.org/1999/XMLSchema","complexType"),SecurePart.Modifier.Content));
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),25);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),25);
    for (int i=0; i < nodeList.getLength(); i++) {
      Assert.assertEquals(nodeList.item(i).getParentNode().getLocalName(),"complexType");
      Assert.assertEquals(nodeList.item(i).getParentNode().getNamespaceURI(),"http://www.w3.org/1999/XMLSchema");
      NodeList childNodes=nodeList.item(i).getParentNode().getChildNodes();
      for (int j=0; j < childNodes.getLength(); j++) {
        Node child=childNodes.item(j);
        if (child.getNodeType() == Node.TEXT_NODE) {
          Assert.assertEquals(child.getTextContent().trim(),"");
        }
 else         if (child.getNodeType() == Node.ELEMENT_NODE) {
          Assert.assertEquals(child,nodeList.item(i));
        }
 else {
          Assert.fail("Unexpected Node encountered");
        }
      }
    }
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionKeyIdentifierThumbprintInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.ENC_KEY_ID,"Thumbprint");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/oasis-wss-soap-message-security-1.1#ThumbprintSHA1']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * rsa-oaep-mgf1p, Digest:SHA256, MGF:SHA1, PSource: None
 */
@Test public void testKeyWrappingRSAOAEPMGF1AESGCM128Outbound() throws Exception {
  try {
    Security.addProvider(new BouncyCastleProvider());
    ByteArrayOutputStream baos;
{
      WSSSecurityProperties securityProperties=new WSSSecurityProperties();
      List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
      actions.add(WSSConstants.ENCRYPT);
      securityProperties.setActions(actions);
      securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
      securityProperties.setEncryptionUser("receiver");
      securityProperties.setEncryptionSymAlgorithm("http://www.w3.org/2009/xmlenc11#aes128-gcm");
      securityProperties.setEncryptionKeyTransportAlgorithm("http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p");
      InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
      baos=doOutboundSecurity(securityProperties,sourceDocument);
      Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
      NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
      Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
      XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
      Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
      Assert.assertEquals(nodeList.getLength(),1);
      nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
      Assert.assertEquals(nodeList.getLength(),1);
      xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#aes128-gcm']");
      node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      Assert.assertEquals(node.getParentNode().getParentNode().getLocalName(),"Body");
      NodeList childNodes=node.getParentNode().getParentNode().getChildNodes();
      for (int i=0; i < childNodes.getLength(); i++) {
        Node child=childNodes.item(i);
        if (child.getNodeType() == Node.TEXT_NODE) {
          Assert.assertEquals(child.getTextContent().trim(),"");
        }
 else         if (child.getNodeType() == Node.ELEMENT_NODE) {
          Assert.assertEquals(child,nodeList.item(0));
        }
 else {
          Assert.fail("Unexpected Node encountered");
        }
      }
    }
{
      String action=WSHandlerConstants.ENCRYPT;
      doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
    }
  }
  finally {
    Security.removeProvider(BouncyCastleProvider.PROVIDER_NAME);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionKeyIdentifierBinarySecurityTokenDirectReferenceOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.setEncryptionKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/wsse:BinarySecurityToken");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test @SuppressWarnings("unchecked") public void testCompressedEncDecryption() throws Exception {
  Init.init(WSSec.class.getClassLoader().getResource("wss/wss-config.xml").toURI(),WSSec.class);
  Field algorithmsClassMapField=TransformerAlgorithmMapper.class.getDeclaredField("algorithmsClassMapOut");
  algorithmsClassMapField.setAccessible(true);
  Map<String,Class<?>> map=(Map<String,Class<?>>)algorithmsClassMapField.get(null);
  map.put("http://www.apache.org/2012/04/xmlsec/gzip",GzipCompressorOutputStream.class);
  algorithmsClassMapField=TransformerAlgorithmMapper.class.getDeclaredField("algorithmsClassMapIn");
  algorithmsClassMapField.setAccessible(true);
  map=(Map<String,Class<?>>)algorithmsClassMapField.get(null);
  map.put("http://www.apache.org/2012/04/xmlsec/gzip",GzipCompressorInputStream.class);
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.setEncryptionCompressionAlgorithm("http://www.apache.org/2012/04/xmlsec/gzip");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#aes256-cbc']");
    node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Assert.assertEquals(node.getParentNode().getParentNode().getLocalName(),"Body");
    NodeList childNodes=node.getParentNode().getParentNode().getChildNodes();
    for (int i=0; i < childNodes.getLength(); i++) {
      Node child=childNodes.item(i);
      if (child.getNodeType() == Node.TEXT_NODE) {
        Assert.assertEquals(child.getTextContent().trim(),"");
      }
 else       if (child.getNodeType() == Node.ELEMENT_NODE) {
        Assert.assertEquals(child,nodeList.item(0));
      }
 else {
        Assert.fail("Unexpected Node encountered");
      }
    }
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),securityEventListener);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    securityEventListener.compare();
    List<SecurityEvent> receivedSecurityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < receivedSecurityEvents.size(); i++) {
      SecurityEvent securityEvent=receivedSecurityEvents.get(i);
      if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.OPERATION) {
        OperationSecurityEvent operationSecurityEvent=(OperationSecurityEvent)securityEvent;
        Assert.assertEquals(operationSecurityEvent.getOperation(),new QName("http://schemas.xmlsoap.org/wsdl/","definitions"));
      }
 else       if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.ENCRYPTED_PART) {
        EncryptedPartSecurityEvent encryptedPartSecurityEvent=(EncryptedPartSecurityEvent)securityEvent;
        Assert.assertNotNull(encryptedPartSecurityEvent.getXmlSecEvent());
        Assert.assertNotNull(encryptedPartSecurityEvent.getSecurityToken());
        Assert.assertNotNull(encryptedPartSecurityEvent.getElementPath());
        final QName expectedElementName=new QName("http://schemas.xmlsoap.org/soap/envelope/","Body");
        Assert.assertEquals(encryptedPartSecurityEvent.getXmlSecEvent().asStartElement().getName(),expectedElementName);
        Assert.assertEquals(encryptedPartSecurityEvent.getElementPath().size(),2);
        Assert.assertEquals(encryptedPartSecurityEvent.getElementPath().get(encryptedPartSecurityEvent.getElementPath().size() - 1),expectedElementName);
      }
    }
    EncryptedPartSecurityEvent encryptedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.ENCRYPTED_PART);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String encryptedPartCorrelationID=encryptedPartSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID)) {
        encryptedPartSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(4,encryptedPartSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + encryptedPartSecurityEvents.size());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionKeyIdentifierSubjectKeyInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.ENC_KEY_ID,"SKIKeyIdentifier");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509SubjectKeyIdentifier']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionPropertiesOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    Map<String,Object> config=new HashMap<String,Object>();
    config.put(ConfigurationConstants.ACTION,ConfigurationConstants.ENCRYPT);
    config.put(ConfigurationConstants.ENCRYPTION_USER,"receiver");
    config.put(ConfigurationConstants.ENC_PROP_FILE,"transmitter-crypto.properties");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(config,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#aes256-cbc']");
    node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Assert.assertEquals(node.getParentNode().getParentNode().getLocalName(),"Body");
    NodeList childNodes=node.getParentNode().getParentNode().getChildNodes();
    for (int i=0; i < childNodes.getLength(); i++) {
      Node child=childNodes.item(i);
      if (child.getNodeType() == Node.TEXT_NODE) {
        Assert.assertEquals(child.getTextContent().trim(),"");
      }
 else       if (child.getNodeType() == Node.ELEMENT_NODE) {
        Assert.assertEquals(child,nodeList.item(0));
      }
 else {
        Assert.fail("Unexpected Node encountered");
      }
    }
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionKeyIdentifierIssuerSerialInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.ENC_KEY_ID,"IssuerSerial");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/dsig:KeyInfo/wsse:SecurityTokenReference/dsig:X509Data/dsig:X509IssuerSerial/dsig:X509SerialNumber");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKeyWrappingRSAOAEPAES192GCMSHA384MGF1sha1Inbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.ENC_SYM_ALGO,"http://www.w3.org/2009/xmlenc11#aes192-gcm");
    properties.put(WSHandlerConstants.ENC_KEY_TRANSPORT,"http://www.w3.org/2009/xmlenc11#rsa-oaep");
    properties.put(WSHandlerConstants.ENC_DIGEST_ALGO,"http://www.w3.org/2001/04/xmldsig-more#sha384");
    properties.put(WSHandlerConstants.ENC_MGF_ALGO,"http://www.w3.org/2009/xmlenc11#mgf1sha1");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#rsa-oaep']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod/dsig:DigestMethod[@Algorithm='http://www.w3.org/2001/04/xmldsig-more#sha384']");
    node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#aes192-gcm']");
    node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.addIgnoreBSPRule(BSPRule.R5620);
    securityProperties.addIgnoreBSPRule(BSPRule.R5621);
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * rsa-oaep, Digest:SHA512, MGF:SHA1, PSource: Specified 8 bytes
 */
@Test public void testKeyWrappingRSAOAEPAESGCM192SHA384MGF1SHA384PSourceOutbound() throws Exception {
  try {
    Security.addProvider(new BouncyCastleProvider());
    ByteArrayOutputStream baos;
{
      WSSSecurityProperties securityProperties=new WSSSecurityProperties();
      List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
      actions.add(WSSConstants.ENCRYPT);
      securityProperties.setActions(actions);
      securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
      securityProperties.setEncryptionUser("receiver");
      securityProperties.setEncryptionSymAlgorithm("http://www.w3.org/2009/xmlenc11#aes192-gcm");
      securityProperties.setEncryptionKeyTransportAlgorithm("http://www.w3.org/2009/xmlenc11#rsa-oaep");
      securityProperties.setEncryptionKeyTransportDigestAlgorithm("http://www.w3.org/2001/04/xmldsig-more#sha384");
      securityProperties.setEncryptionKeyTransportMGFAlgorithm("http://www.w3.org/2009/xmlenc11#mgf1sha384");
      securityProperties.setEncryptionKeyTransportOAEPParams(Base64.decode("ZHVtbXkxMjM=".getBytes(StandardCharsets.UTF_8)));
      InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
      baos=doOutboundSecurity(securityProperties,sourceDocument);
      Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
      NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
      Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
      XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#rsa-oaep']");
      Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod/xenc:OAEPparams");
      node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod/dsig:DigestMethod[@Algorithm='http://www.w3.org/2001/04/xmldsig-more#sha384']");
      node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod/xenc11:MGF[@Algorithm='http://www.w3.org/2009/xmlenc11#mgf1sha384']");
      node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
      Assert.assertEquals(nodeList.getLength(),1);
      nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
      Assert.assertEquals(nodeList.getLength(),1);
      xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#aes192-gcm']");
      node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      Assert.assertEquals(node.getParentNode().getParentNode().getLocalName(),"Body");
      NodeList childNodes=node.getParentNode().getParentNode().getChildNodes();
      for (int i=0; i < childNodes.getLength(); i++) {
        Node child=childNodes.item(i);
        if (child.getNodeType() == Node.TEXT_NODE) {
          Assert.assertEquals(child.getTextContent().trim(),"");
        }
 else         if (child.getNodeType() == Node.ELEMENT_NODE) {
          Assert.assertEquals(child,nodeList.item(0));
        }
 else {
          Assert.fail("Unexpected Node encountered");
        }
      }
    }
{
      String action=WSHandlerConstants.ENCRYPT;
      doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
    }
  }
  finally {
    Security.removeProvider(BouncyCastleProvider.PROVIDER_NAME);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionPartsHeaderInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-encryptedHeader.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.ENCRYPTION_PARTS,"{Header}{http://www.example.com}testEncryptedHeader;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),securityEventListener);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_wsse11_EncryptedHeader.getNamespaceURI(),WSSConstants.TAG_wsse11_EncryptedHeader.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    securityEventListener.compare();
    List<SecurityEvent> receivedSecurityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < receivedSecurityEvents.size(); i++) {
      SecurityEvent securityEvent=receivedSecurityEvents.get(i);
      if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.OPERATION) {
        OperationSecurityEvent operationSecurityEvent=(OperationSecurityEvent)securityEvent;
        Assert.assertEquals(operationSecurityEvent.getOperation(),new QName("http://schemas.xmlsoap.org/wsdl/","definitions"));
      }
 else       if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.ENCRYPTED_PART) {
        EncryptedPartSecurityEvent encryptedPartSecurityEvent=(EncryptedPartSecurityEvent)securityEvent;
        Assert.assertNotNull(encryptedPartSecurityEvent.getXmlSecEvent());
        Assert.assertNotNull(encryptedPartSecurityEvent.getSecurityToken());
        Assert.assertNotNull(encryptedPartSecurityEvent.getElementPath());
        final QName expectedElementName=new QName("http://www.example.com","testEncryptedHeader");
        Assert.assertEquals(encryptedPartSecurityEvent.getXmlSecEvent().asStartElement().getName(),expectedElementName);
        Assert.assertEquals(encryptedPartSecurityEvent.getElementPath().size(),3);
        Assert.assertEquals(encryptedPartSecurityEvent.getElementPath().get(encryptedPartSecurityEvent.getElementPath().size() - 1),expectedElementName);
      }
    }
    EncryptedPartSecurityEvent encryptedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.ENCRYPTED_PART);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String encryptedPartCorrelationID=encryptedPartSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID)) {
        encryptedPartSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(4,encryptedPartSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + encryptedPartSecurityEvents.size());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionKeyIdentifierBinarySecurityTokenDirectReferenceInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.ENC_KEY_ID,"DirectReference");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/wsse:BinarySecurityToken");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionPartsElementInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.ENCRYPTION_PARTS,"{Element}{http://www.w3.org/1999/XMLSchema}simpleType;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.X509Token,WSSecurityEventConstants.OPERATION,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.EncryptedKeyToken,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.EncryptedElement};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),securityEventListener);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    securityEventListener.compare();
    List<SecurityEvent> receivedSecurityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < receivedSecurityEvents.size(); i++) {
      SecurityEvent securityEvent=receivedSecurityEvents.get(i);
      if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.OPERATION) {
        OperationSecurityEvent operationSecurityEvent=(OperationSecurityEvent)securityEvent;
        Assert.assertEquals(operationSecurityEvent.getOperation(),new QName("http://schemas.xmlsoap.org/wsdl/","definitions"));
      }
 else       if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.EncryptedElement) {
        EncryptedElementSecurityEvent encryptedElementSecurityEvent=(EncryptedElementSecurityEvent)securityEvent;
        Assert.assertNotNull(encryptedElementSecurityEvent.getXmlSecEvent());
        Assert.assertNotNull(encryptedElementSecurityEvent.getSecurityToken());
        Assert.assertNotNull(encryptedElementSecurityEvent.getElementPath());
        final QName expectedElementName=new QName("http://www.w3.org/1999/XMLSchema","simpleType");
        Assert.assertEquals(encryptedElementSecurityEvent.getXmlSecEvent().asStartElement().getName(),expectedElementName);
        Assert.assertEquals(encryptedElementSecurityEvent.getElementPath().size(),6);
        Assert.assertEquals(encryptedElementSecurityEvent.getElementPath().get(encryptedElementSecurityEvent.getElementPath().size() - 1),expectedElementName);
      }
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * rsa-oaep-mgf1p, Digest:SHA256, MGF:SHA1, PSource: None
 */
@Test public void testKeyWrappingRSAOAEPAESGCM192SHA256Outbound() throws Exception {
  try {
    Security.addProvider(new BouncyCastleProvider());
    ByteArrayOutputStream baos;
{
      WSSSecurityProperties securityProperties=new WSSSecurityProperties();
      List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
      actions.add(WSSConstants.ENCRYPT);
      securityProperties.setActions(actions);
      securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
      securityProperties.setEncryptionUser("receiver");
      securityProperties.setEncryptionSymAlgorithm("http://www.w3.org/2009/xmlenc11#aes192-gcm");
      securityProperties.setEncryptionKeyTransportAlgorithm("http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p");
      securityProperties.setEncryptionKeyTransportDigestAlgorithm("http://www.w3.org/2001/04/xmlenc#sha256");
      InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
      baos=doOutboundSecurity(securityProperties,sourceDocument);
      Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
      NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
      Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
      XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
      Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod/dsig:DigestMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#sha256']");
      node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
      Assert.assertEquals(nodeList.getLength(),1);
      nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
      Assert.assertEquals(nodeList.getLength(),1);
      xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2009/xmlenc11#aes192-gcm']");
      node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
      Assert.assertNotNull(node);
      Assert.assertEquals(node.getParentNode().getParentNode().getLocalName(),"Body");
      NodeList childNodes=node.getParentNode().getParentNode().getChildNodes();
      for (int i=0; i < childNodes.getLength(); i++) {
        Node child=childNodes.item(i);
        if (child.getNodeType() == Node.TEXT_NODE) {
          Assert.assertEquals(child.getTextContent().trim(),"");
        }
 else         if (child.getNodeType() == Node.ELEMENT_NODE) {
          Assert.assertEquals(child,nodeList.item(0));
        }
 else {
          Assert.fail("Unexpected Node encountered");
        }
      }
    }
{
      String action=WSHandlerConstants.ENCRYPT;
      doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
    }
  }
  finally {
    Security.removeProvider(BouncyCastleProvider.PROVIDER_NAME);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionDefaultConfigurationOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#aes256-cbc']");
    node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Assert.assertEquals(node.getParentNode().getParentNode().getLocalName(),"Body");
    NodeList childNodes=node.getParentNode().getParentNode().getChildNodes();
    for (int i=0; i < childNodes.getLength(); i++) {
      Node child=childNodes.item(i);
      if (child.getNodeType() == Node.TEXT_NODE) {
        Assert.assertEquals(child.getTextContent().trim(),"");
      }
 else       if (child.getNodeType() == Node.ELEMENT_NODE) {
        Assert.assertEquals(child,nodeList.item(0));
      }
 else {
        Assert.fail("Unexpected Node encountered");
      }
    }
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDecryptionReferenceListOutsideEncryptedKey() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.setEncryptionKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_IssuerSerial);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/dsig:KeyInfo/wsse:SecurityTokenReference/dsig:X509Data/dsig:X509IssuerSerial/dsig:X509SerialNumber");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    TransformerFactory transFact=TransformerFactory.newInstance();
    Transformer trans=transFact.newTransformer(new StreamSource(this.getClass().getClassLoader().getResourceAsStream("xsl/testDecryptionReferenceListOutsideEncryptedKey.xsl")));
    baos.reset();
    trans.transform(new DOMSource(document),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    Document document=doInboundSecurity(securityProperties,new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionDefaultConfigurationInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),securityEventListener);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    securityEventListener.compare();
    List<SecurityEvent> receivedSecurityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < receivedSecurityEvents.size(); i++) {
      SecurityEvent securityEvent=receivedSecurityEvents.get(i);
      if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.OPERATION) {
        OperationSecurityEvent operationSecurityEvent=(OperationSecurityEvent)securityEvent;
        Assert.assertEquals(operationSecurityEvent.getOperation(),new QName("http://schemas.xmlsoap.org/wsdl/","definitions"));
      }
 else       if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.ENCRYPTED_PART) {
        EncryptedPartSecurityEvent encryptedPartSecurityEvent=(EncryptedPartSecurityEvent)securityEvent;
        Assert.assertNotNull(encryptedPartSecurityEvent.getXmlSecEvent());
        Assert.assertNotNull(encryptedPartSecurityEvent.getSecurityToken());
        Assert.assertNotNull(encryptedPartSecurityEvent.getElementPath());
        final QName expectedElementName=new QName("http://schemas.xmlsoap.org/soap/envelope/","Body");
        Assert.assertEquals(encryptedPartSecurityEvent.getXmlSecEvent().asStartElement().getName(),expectedElementName);
        Assert.assertEquals(encryptedPartSecurityEvent.getElementPath().size(),2);
        Assert.assertEquals(encryptedPartSecurityEvent.getElementPath().get(encryptedPartSecurityEvent.getElementPath().size() - 1),expectedElementName);
      }
    }
    EncryptedPartSecurityEvent encryptedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.ENCRYPTED_PART);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String encryptedPartCorrelationID=encryptedPartSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID)) {
        encryptedPartSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(4,encryptedPartSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + encryptedPartSecurityEvents.size());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionKeyIdentifierSHA1Outbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.setEncryptionKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_ENCRYPTED_KEY_SHA1_IDENTIFIER);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/oasis-wss-soap-message-security-1.1#ThumbprintSHA1']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/oasis-wss-soap-message-security-1.1#EncryptedKeySHA1']");
    node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEncryptedDataSecurityHeaderPrependedReferenceInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    Document doc=documentBuilderFactory.newDocumentBuilder().parse(sourceDocument);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    Element securityHeaderElement=secHeader.getSecurityHeader();
    securityHeaderElement.appendChild(doc.getElementsByTagNameNS("http://schemas.xmlsoap.org/wsdl/","definitions").item(0));
    WSSecEncrypt builder=new WSSecEncrypt();
    builder.setKeyIdentifierType(WSConstants.THUMBPRINT_IDENTIFIER);
    builder.setUserInfo("receiver");
    Crypto crypto=CryptoFactory.getInstance("transmitter-crypto.properties");
    builder.prepare(doc,crypto);
    WSEncryptionPart encP=new WSEncryptionPart("definitions","http://schemas.xmlsoap.org/wsdl/","Element");
    List<WSEncryptionPart> encryptionParts=new ArrayList<WSEncryptionPart>();
    encryptionParts.add(encP);
    Element ref=builder.encryptForRef(null,encryptionParts);
    builder.addExternalRefElement(ref,secHeader);
    builder.prependToHeader(secHeader);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionPropertiesInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    Map<String,Object> config=new HashMap<String,Object>();
    config.put(ConfigurationConstants.ACTION,ConfigurationConstants.ENCRYPT);
    config.put(ConfigurationConstants.DEC_PROP_FILE,"receiver-crypto.properties");
    config.put(ConfigurationConstants.PW_CALLBACK_REF,new CallbackHandlerImpl());
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    WSSSecurityProperties securityProperties=ConfigurationConverter.convert(config);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader outXmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),new ArrayList<SecurityEvent>(),securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),outXmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    securityEventListener.compare();
    List<SecurityEvent> receivedSecurityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < receivedSecurityEvents.size(); i++) {
      SecurityEvent securityEvent=receivedSecurityEvents.get(i);
      if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.OPERATION) {
        OperationSecurityEvent operationSecurityEvent=(OperationSecurityEvent)securityEvent;
        Assert.assertEquals(operationSecurityEvent.getOperation(),new QName("http://schemas.xmlsoap.org/wsdl/","definitions"));
      }
 else       if (securityEvent.getSecurityEventType() == WSSecurityEventConstants.ENCRYPTED_PART) {
        EncryptedPartSecurityEvent encryptedPartSecurityEvent=(EncryptedPartSecurityEvent)securityEvent;
        Assert.assertNotNull(encryptedPartSecurityEvent.getXmlSecEvent());
        Assert.assertNotNull(encryptedPartSecurityEvent.getSecurityToken());
        Assert.assertNotNull(encryptedPartSecurityEvent.getElementPath());
        final QName expectedElementName=new QName("http://schemas.xmlsoap.org/soap/envelope/","Body");
        Assert.assertEquals(encryptedPartSecurityEvent.getXmlSecEvent().asStartElement().getName(),expectedElementName);
        Assert.assertEquals(encryptedPartSecurityEvent.getElementPath().size(),2);
        Assert.assertEquals(encryptedPartSecurityEvent.getElementPath().get(encryptedPartSecurityEvent.getElementPath().size() - 1),expectedElementName);
      }
    }
    EncryptedPartSecurityEvent encryptedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.ENCRYPTED_PART);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String encryptedPartCorrelationID=encryptedPartSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID)) {
        encryptedPartSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(4,encryptedPartSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + encryptedPartSecurityEvents.size());
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExceptionOnElementToEncryptNotFound() throws Exception {
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addEncryptionPart(new SecurePart(new QName("http://www.wrongnamespace.org","complexType"),SecurePart.Modifier.Content));
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    try {
      doOutboundSecurity(securityProperties,sourceDocument);
      Assert.fail("Exception expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof XMLSecurityException);
      Assert.assertEquals("Part to encrypt not found: {http://www.wrongnamespace.org}complexType",e.getCause().getMessage());
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEncryptedDataSecurityHeaderAppendedReferenceInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    Document doc=documentBuilderFactory.newDocumentBuilder().parse(sourceDocument);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    Element securityHeaderElement=secHeader.getSecurityHeader();
    securityHeaderElement.appendChild(doc.getElementsByTagNameNS("http://schemas.xmlsoap.org/wsdl/","definitions").item(0));
    WSSecEncrypt builder=new WSSecEncrypt();
    builder.setKeyIdentifierType(WSConstants.THUMBPRINT_IDENTIFIER);
    builder.setUserInfo("receiver");
    Crypto crypto=CryptoFactory.getInstance("transmitter-crypto.properties");
    builder.prepare(doc,crypto);
    WSEncryptionPart encP=new WSEncryptionPart("definitions","http://schemas.xmlsoap.org/wsdl/","Element");
    List<WSEncryptionPart> encryptionParts=new ArrayList<WSEncryptionPart>();
    encryptionParts.add(encP);
    Element ref=builder.encryptForRef(null,encryptionParts);
    builder.prependToHeader(secHeader);
    securityHeaderElement.appendChild(ref);
    Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.EncryptionCRLTest </h4><pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptionWithOutRevocationCheck() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("wss40rev.jks"),"security".toCharArray());
    securityProperties.setEncryptionUser("wss40rev");
    securityProperties.setEncryptionKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#aes256-cbc']");
    node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Assert.assertEquals(node.getParentNode().getParentNode().getLocalName(),"Body");
    NodeList childNodes=node.getParentNode().getParentNode().getChildNodes();
    for (int i=0; i < childNodes.getLength(); i++) {
      Node child=childNodes.item(i);
      if (child.getNodeType() == Node.TEXT_NODE) {
        Assert.assertEquals(child.getTextContent().trim(),"");
      }
 else       if (child.getNodeType() == Node.ELEMENT_NODE) {
        Assert.assertEquals(child,nodeList.item(0));
      }
 else {
        Assert.fail("Unexpected Node encountered");
      }
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.FaultTest </h4><pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSignedFaultInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/soap-fault.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.HeaderOrderingTest </h4><pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testTimestampPlusUsernameTokenSignedStrictHeaderOrdering() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    actions.add(WSSConstants.TIMESTAMP);
    actions.add(WSSConstants.USERNAMETOKEN);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setTokenUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_WSSE10,"UsernameToken"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_WSU10,"Timestamp"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_SOAP11,"Body"),SecurePart.Modifier.Element));
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList securityHeaderElement=document.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(childs.getLength(),3);
    Assert.assertEquals(childs.item(0).getLocalName(),"UsernameToken");
    Assert.assertEquals(childs.item(1).getLocalName(),"Timestamp");
    Assert.assertEquals(childs.item(2).getLocalName(),"Signature");
    NodeList sigReferences=document.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
    Assert.assertEquals(3,sigReferences.getLength());
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.TIMESTAMP+ " "+ WSHandlerConstants.USERNAME_TOKEN;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUsernameTokenPlusTimestampPlusSignatureWithBSTSignedAndEncryptedStrictHeaderOrdering() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    actions.add(WSSConstants.ENCRYPT);
    actions.add(WSSConstants.USERNAMETOKEN);
    actions.add(WSSConstants.TIMESTAMP);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setTokenUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_WSSE10,"UsernameToken"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_WSU10,"Timestamp"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_SOAP11,"Body"),SecurePart.Modifier.Element));
    securityProperties.setEncryptionUser("receiver");
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    securityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.NS_DSIG,"Signature"),SecurePart.Modifier.Element));
    securityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.NS_WSSE10,"UsernameToken"),SecurePart.Modifier.Element));
    securityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.NS_WSU10,"Timestamp"),SecurePart.Modifier.Element));
    securityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.NS_SOAP11,"Body"),SecurePart.Modifier.Content));
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList securityHeaderElement=document.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(childs.getLength(),6);
    Assert.assertEquals(childs.item(0).getLocalName(),"BinarySecurityToken");
    Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedKey");
    Assert.assertEquals(childs.item(2).getLocalName(),"EncryptedData");
    Assert.assertEquals(childs.item(3).getLocalName(),"EncryptedData");
    Assert.assertEquals(childs.item(4).getLocalName(),"BinarySecurityToken");
    Assert.assertEquals(childs.item(5).getLocalName(),"EncryptedData");
    NodeList sigReferences=document.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
    Assert.assertEquals(0,sigReferences.getLength());
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.USERNAME_TOKEN+ " "+ WSHandlerConstants.TIMESTAMP+ " "+ WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUsernameTokenSignedWithBSTStrictHeaderOrdering() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    actions.add(WSSConstants.USERNAMETOKEN);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setTokenUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_WSSE10,"UsernameToken"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_SOAP11,"Body"),SecurePart.Modifier.Element));
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList securityHeaderElement=document.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(childs.getLength(),3);
    Assert.assertEquals(childs.item(0).getLocalName(),"UsernameToken");
    Assert.assertEquals(childs.item(1).getLocalName(),"BinarySecurityToken");
    Assert.assertEquals(childs.item(2).getLocalName(),"Signature");
    NodeList sigReferences=document.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
    Assert.assertEquals(2,sigReferences.getLength());
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.USERNAME_TOKEN;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testTimestampSignedLaxHeaderOrdering() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.TIMESTAMP);
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setTokenUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_WSU10,"Timestamp"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_SOAP11,"Body"),SecurePart.Modifier.Element));
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList securityHeaderElement=document.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(childs.getLength(),2);
    Assert.assertEquals(childs.item(0).getLocalName(),"Signature");
    Assert.assertEquals(childs.item(1).getLocalName(),"Timestamp");
    NodeList sigReferences=document.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
    Assert.assertEquals(2,sigReferences.getLength());
  }
{
    String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUsernameTokenPlusTimestampWithBSTSignedAndEncryptedStrictHeaderOrdering() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    actions.add(WSSConstants.ENCRYPT);
    actions.add(WSSConstants.USERNAMETOKEN);
    actions.add(WSSConstants.TIMESTAMP);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setTokenUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_WSSE10,"UsernameToken"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_WSU10,"Timestamp"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_SOAP11,"Body"),SecurePart.Modifier.Element));
    securityProperties.setEncryptionUser("receiver");
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    securityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.NS_WSSE10,"UsernameToken"),SecurePart.Modifier.Element));
    securityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.NS_WSU10,"Timestamp"),SecurePart.Modifier.Element));
    securityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.NS_SOAP11,"Body"),SecurePart.Modifier.Content));
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList securityHeaderElement=document.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(childs.getLength(),6);
    Assert.assertEquals(childs.item(0).getLocalName(),"BinarySecurityToken");
    Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedKey");
    Assert.assertEquals(childs.item(2).getLocalName(),"EncryptedData");
    Assert.assertEquals(childs.item(3).getLocalName(),"EncryptedData");
    Assert.assertEquals(childs.item(4).getLocalName(),"BinarySecurityToken");
    Assert.assertEquals(childs.item(5).getLocalName(),"Signature");
    NodeList sigReferences=document.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
    Assert.assertEquals(3,sigReferences.getLength());
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.USERNAME_TOKEN+ " "+ WSHandlerConstants.TIMESTAMP+ " "+ WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUsernameTokenSignedStrictHeaderOrdering() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    actions.add(WSSConstants.USERNAMETOKEN);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setTokenUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_WSSE10,"UsernameToken"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_SOAP11,"Body"),SecurePart.Modifier.Element));
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList securityHeaderElement=document.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(childs.getLength(),2);
    Assert.assertEquals(childs.item(0).getLocalName(),"UsernameToken");
    Assert.assertEquals(childs.item(1).getLocalName(),"Signature");
    NodeList sigReferences=document.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
    Assert.assertEquals(2,sigReferences.getLength());
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.USERNAME_TOKEN;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUsernameTokenSignedLaxHeaderOrdering() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.USERNAMETOKEN);
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setTokenUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_WSSE10,"UsernameToken"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_SOAP11,"Body"),SecurePart.Modifier.Element));
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList securityHeaderElement=document.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(childs.getLength(),2);
    Assert.assertEquals(childs.item(0).getLocalName(),"Signature");
    Assert.assertEquals(childs.item(1).getLocalName(),"UsernameToken");
    NodeList sigReferences=document.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
    Assert.assertEquals(2,sigReferences.getLength());
  }
{
    String action=WSHandlerConstants.USERNAME_TOKEN + " " + WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUsernameTokenPlusTimestampSignedAndEncryptedStrictHeaderOrdering() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    actions.add(WSSConstants.ENCRYPT);
    actions.add(WSSConstants.USERNAMETOKEN);
    actions.add(WSSConstants.TIMESTAMP);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setTokenUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_WSSE10,"UsernameToken"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_WSU10,"Timestamp"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_SOAP11,"Body"),SecurePart.Modifier.Element));
    securityProperties.setEncryptionUser("receiver");
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.NS_WSSE10,"UsernameToken"),SecurePart.Modifier.Element));
    securityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.NS_WSU10,"Timestamp"),SecurePart.Modifier.Element));
    securityProperties.addEncryptionPart(new SecurePart(new QName(WSSConstants.NS_SOAP11,"Body"),SecurePart.Modifier.Content));
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList securityHeaderElement=document.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(childs.getLength(),4);
    Assert.assertEquals(childs.item(0).getLocalName(),"EncryptedKey");
    Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedData");
    Assert.assertEquals(childs.item(2).getLocalName(),"EncryptedData");
    Assert.assertEquals(childs.item(3).getLocalName(),"Signature");
    NodeList sigReferences=document.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
    Assert.assertEquals(3,sigReferences.getLength());
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.USERNAME_TOKEN+ " "+ WSHandlerConstants.TIMESTAMP+ " "+ WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testTimestampSignedStrictHeaderOrdering() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    actions.add(WSSConstants.TIMESTAMP);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setTokenUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_WSU10,"Timestamp"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_SOAP11,"Body"),SecurePart.Modifier.Element));
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList securityHeaderElement=document.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(childs.getLength(),2);
    Assert.assertEquals(childs.item(0).getLocalName(),"Timestamp");
    Assert.assertEquals(childs.item(1).getLocalName(),"Signature");
    NodeList sigReferences=document.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
    Assert.assertEquals(2,sigReferences.getLength());
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.TIMESTAMP;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUsernameTokenPlusTimestampWithBSTSignedStrictHeaderOrdering() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    actions.add(WSSConstants.USERNAMETOKEN);
    actions.add(WSSConstants.TIMESTAMP);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setTokenUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_WSSE10,"UsernameToken"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_WSU10,"Timestamp"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_SOAP11,"Body"),SecurePart.Modifier.Element));
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList securityHeaderElement=document.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(childs.getLength(),4);
    Assert.assertEquals(childs.item(0).getLocalName(),"Timestamp");
    Assert.assertEquals(childs.item(1).getLocalName(),"UsernameToken");
    Assert.assertEquals(childs.item(2).getLocalName(),"BinarySecurityToken");
    Assert.assertEquals(childs.item(3).getLocalName(),"Signature");
    NodeList sigReferences=document.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
    Assert.assertEquals(3,sigReferences.getLength());
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.USERNAME_TOKEN+ " "+ WSHandlerConstants.TIMESTAMP;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUsernameTokenPlusTimestampSignedStrictHeaderOrdering() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    actions.add(WSSConstants.USERNAMETOKEN);
    actions.add(WSSConstants.TIMESTAMP);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setTokenUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_WSSE10,"UsernameToken"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_WSU10,"Timestamp"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_SOAP11,"Body"),SecurePart.Modifier.Element));
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList securityHeaderElement=document.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(childs.getLength(),3);
    Assert.assertEquals(childs.item(0).getLocalName(),"Timestamp");
    Assert.assertEquals(childs.item(1).getLocalName(),"UsernameToken");
    Assert.assertEquals(childs.item(2).getLocalName(),"Signature");
    NodeList sigReferences=document.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
    Assert.assertEquals(3,sigReferences.getLength());
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.USERNAME_TOKEN+ " "+ WSHandlerConstants.TIMESTAMP;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@SuppressWarnings("unchecked") @Test public void testSignatureConfirmationUsernameTokenTimestampStrictHeaderOrdering() throws Exception {
  Set<Integer> sigv;
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.ENABLE_SIGNATURE_CONFIRMATION,"true");
    Map<String,Object> messageContext=doOutboundSecurityWithWSS4J_1(sourceDocument,action,properties);
    sigv=(Set<Integer>)messageContext.get(WSHandlerConstants.SEND_SIGV);
    Document securedDocument=(Document)messageContext.get(SECURED_DOCUMENT);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
  final List<SecurityEvent> securityEventList=new ArrayList<SecurityEvent>();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    SecurityEventListener securityEventListener=new SecurityEventListener(){
      @Override public void registerSecurityEvent(      SecurityEvent securityEvent) throws WSSecurityException {
        securityEventList.add(securityEvent);
      }
    }
;
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),new ArrayList<SecurityEvent>(),securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
  baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    actions.add(WSSConstants.SIGNATURE_CONFIRMATION);
    actions.add(WSSConstants.USERNAMETOKEN);
    actions.add(WSSConstants.TIMESTAMP);
    securityProperties.setActions(actions);
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_WSSE10,"UsernameToken"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_WSU10,"Timestamp"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSSE11_SIG_CONF,SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_SOAP11,"Body"),SecurePart.Modifier.Element));
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("receiver");
    securityProperties.setTokenUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),securityEventList);
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList securityHeaderElement=document.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(childs.getLength(),5);
    Assert.assertEquals(childs.item(0).getLocalName(),"Timestamp");
    Assert.assertEquals(childs.item(1).getLocalName(),"UsernameToken");
    Assert.assertEquals(childs.item(2).getLocalName(),"SignatureConfirmation");
    Assert.assertEquals(childs.item(3).getLocalName(),"BinarySecurityToken");
    Assert.assertEquals(childs.item(4).getLocalName(),"Signature");
    NodeList sigReferences=document.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
    Assert.assertEquals(4,sigReferences.getLength());
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.USERNAME_TOKEN+ " "+ WSHandlerConstants.TIMESTAMP;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SEND_SIGV,sigv);
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,true);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.InboundWSSecurityContextImplTest </h4><pre class="type-3 type-11 type-15 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTokenIdentificationTransportSecurity() throws Exception {
  final List<SecurityEvent> securityEventList=generateTransportBindingSecurityEvents();
  Assert.assertEquals(securityEventList.size(),11);
  for (int i=0; i < securityEventList.size(); i++) {
    SecurityEvent securityEvent=securityEventList.get(i);
    if (securityEvent instanceof HttpsTokenSecurityEvent) {
      HttpsTokenSecurityEvent tokenSecurityEvent=(HttpsTokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),2);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE));
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION));
    }
 else     if (securityEvent instanceof X509TokenSecurityEvent) {
      X509TokenSecurityEvent tokenSecurityEvent=(X509TokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),1);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_SIGNED_ENDORSING_ENCRYPTED_SUPPORTING_TOKENS));
    }
 else     if (securityEvent instanceof UsernameTokenSecurityEvent) {
      UsernameTokenSecurityEvent tokenSecurityEvent=(UsernameTokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),1);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_SIGNED_ENCRYPTED_SUPPORTING_TOKENS));
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTokenIdentificationAsymmetricSecurity() throws Exception {
  final List<SecurityEvent> securityEventList=generateAsymmetricBindingSecurityEvents();
  boolean mainSignatureTokenOccured=false;
  boolean signedEndorsingSupportingTokenOccured=false;
  boolean signedEndorsingEncryptedSupportingTokenOccured=false;
  boolean supportingTokensOccured=false;
  boolean encryptedSupportingTokensOccured=false;
  boolean mainEncryptionTokenOccured=false;
  boolean usernameTokenOccured=false;
  Assert.assertEquals(securityEventList.size(),34);
  int x509TokenIndex=0;
  for (int i=0; i < securityEventList.size(); i++) {
    SecurityEvent securityEvent=securityEventList.get(i);
    if (securityEvent instanceof X509TokenSecurityEvent && x509TokenIndex == 0) {
      x509TokenIndex++;
      X509TokenSecurityEvent tokenSecurityEvent=(X509TokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),1);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION));
      mainEncryptionTokenOccured=true;
    }
 else     if (securityEvent instanceof X509TokenSecurityEvent && x509TokenIndex == 1) {
      x509TokenIndex++;
      X509TokenSecurityEvent tokenSecurityEvent=(X509TokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),1);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_ENCRYPTED_SUPPORTING_TOKENS));
      signedEndorsingSupportingTokenOccured=true;
    }
 else     if (securityEvent instanceof X509TokenSecurityEvent && x509TokenIndex == 2) {
      x509TokenIndex++;
      X509TokenSecurityEvent tokenSecurityEvent=(X509TokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),1);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_SUPPORTING_TOKENS));
      encryptedSupportingTokensOccured=true;
    }
 else     if (securityEvent instanceof X509TokenSecurityEvent && x509TokenIndex == 3) {
      x509TokenIndex++;
      X509TokenSecurityEvent tokenSecurityEvent=(X509TokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),1);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE));
      supportingTokensOccured=true;
    }
 else     if (securityEvent instanceof X509TokenSecurityEvent && x509TokenIndex == 4) {
      x509TokenIndex++;
      X509TokenSecurityEvent tokenSecurityEvent=(X509TokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),1);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_SIGNED_ENDORSING_SUPPORTING_TOKENS));
      signedEndorsingEncryptedSupportingTokenOccured=true;
    }
 else     if (securityEvent instanceof X509TokenSecurityEvent && x509TokenIndex == 5) {
      x509TokenIndex++;
      X509TokenSecurityEvent tokenSecurityEvent=(X509TokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),1);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_SIGNED_ENDORSING_ENCRYPTED_SUPPORTING_TOKENS));
      mainSignatureTokenOccured=true;
    }
 else     if (securityEvent instanceof UsernameTokenSecurityEvent) {
      UsernameTokenSecurityEvent tokenSecurityEvent=(UsernameTokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),1);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_SIGNED_ENCRYPTED_SUPPORTING_TOKENS));
      usernameTokenOccured=true;
    }
  }
  Assert.assertTrue(mainSignatureTokenOccured);
  Assert.assertTrue(mainEncryptionTokenOccured);
  Assert.assertTrue(signedEndorsingSupportingTokenOccured);
  Assert.assertTrue(signedEndorsingEncryptedSupportingTokenOccured);
  Assert.assertTrue(supportingTokensOccured);
  Assert.assertTrue(encryptedSupportingTokensOccured);
  Assert.assertTrue(usernameTokenOccured);
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTokenIdentificationSymmetricSecurity() throws Exception {
  final List<SecurityEvent> securityEventList=generateSymmetricBindingSecurityEvents();
  Assert.assertEquals(securityEventList.size(),24);
  for (int i=0; i < securityEventList.size(); i++) {
    SecurityEvent securityEvent=securityEventList.get(i);
    if (securityEvent instanceof X509TokenSecurityEvent) {
      X509TokenSecurityEvent tokenSecurityEvent=(X509TokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),1);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_SIGNED_ENDORSING_SUPPORTING_TOKENS));
    }
 else     if (securityEvent instanceof UsernameTokenSecurityEvent) {
      UsernameTokenSecurityEvent tokenSecurityEvent=(UsernameTokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),1);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_SIGNED_ENCRYPTED_SUPPORTING_TOKENS));
    }
 else     if (securityEvent instanceof SamlTokenSecurityEvent) {
      SamlTokenSecurityEvent tokenSecurityEvent=(SamlTokenSecurityEvent)securityEvent;
      Assert.assertEquals(tokenSecurityEvent.getSecurityToken().getTokenUsages().size(),2);
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_MAIN_SIGNATURE));
      Assert.assertTrue(tokenSecurityEvent.getSecurityToken().getTokenUsages().contains(WSSecurityTokenConstants.TOKENUSAGE_MAIN_ENCRYPTION));
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.InteroperabilityTest </h4><pre class="type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testInteroperabilityInboundReverseOrder() throws Exception {
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.ENCRYPT + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.TIMESTAMP;
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.TIMESTAMP,WSSecurityEventConstants.SignatureValue,WSSecurityEventConstants.SIGNED_PART,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION};
  final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
  Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),securityEventListener);
  transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
    @Override public void write(    int b) throws IOException {
    }
  }
));
  securityEventListener.compare();
  EncryptedPartSecurityEvent encryptedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.ENCRYPTED_PART);
  List<SignedPartSecurityEvent> signedPartSecurityEvents=securityEventListener.getSecurityEvents(WSSecurityEventConstants.SIGNED_PART);
  SignatureValueSecurityEvent signatureValueSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SignatureValue);
  OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
  String encryptedPartCorrelationID=encryptedPartSecurityEvent.getCorrelationID();
  String signedElementCorrelationID1=signedPartSecurityEvents.get(0).getCorrelationID();
  String signatureValueCorrelationID=signatureValueSecurityEvent.getCorrelationID();
  String operationCorrelationID=operationSecurityEvent.getCorrelationID();
  List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
  List<SecurityEvent> encryptedPartSecurityEvents=new ArrayList<SecurityEvent>();
  List<SecurityEvent> signedElementSecurityEvents1=new ArrayList<SecurityEvent>();
  List<SecurityEvent> signatureValueSecurityEvents=new ArrayList<SecurityEvent>();
  List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
  for (int i=0; i < securityEvents.size(); i++) {
    SecurityEvent securityEvent=securityEvents.get(i);
    if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID)) {
      encryptedPartSecurityEvents.add(securityEvent);
    }
 else     if (securityEvent.getCorrelationID().equals(signedElementCorrelationID1)) {
      signedElementSecurityEvents1.add(securityEvent);
    }
 else     if (securityEvent.getCorrelationID().equals(signatureValueCorrelationID)) {
      signatureValueSecurityEvents.add(securityEvent);
    }
 else     if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
      operationSecurityEvents.add(securityEvent);
    }
  }
  Assert.assertEquals(4,encryptedPartSecurityEvents.size());
  Assert.assertEquals(3,signedElementSecurityEvents1.size());
  Assert.assertEquals(4,signatureValueSecurityEvents.size());
  Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + encryptedPartSecurityEvents.size() + signedElementSecurityEvents1.size()+ signatureValueSecurityEvents.size()+ 1);
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionUseReqSigCert() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
    Map<String,Object> messageContext=doOutboundSecurityWithWSS4J_1(sourceDocument,action,properties);
    Document securedDocument=(Document)messageContext.get(SECURED_DOCUMENT);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
  final List<SecurityEvent> securityEventList=new ArrayList<SecurityEvent>();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    SecurityEventListener securityEventListener=new SecurityEventListener(){
      @Override public void registerSecurityEvent(      SecurityEvent securityEvent) throws WSSecurityException {
        securityEventList.add(securityEvent);
      }
    }
;
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),new ArrayList<SecurityEvent>(),securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
  baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.TIMESTAMP);
    actions.add(WSSConstants.SIGNATURE);
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("receiver");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setUseReqSigCertForEncryption(true);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),securityEventList);
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,true);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEncryptedSignatureC14NInclusivePartsOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setEncryptionUser("receiver");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://www.w3.org/1999/XMLSchema","complexType"),SecurePart.Modifier.Element));
    securityProperties.setSignatureCanonicalizationAlgorithm("http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),25);
    nodeList=document.getElementsByTagNameNS("http://www.w3.org/1999/XMLSchema","complexType");
    Assert.assertEquals(nodeList.getLength(),0);
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInteroperabilityInvalidSOAPActionOutbound() throws Exception {
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  securityProperties.setActor("test");
  securityProperties.setEncryptionUser("receiver");
  securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  securityProperties.setSignatureUser("transmitter");
  securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  securityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(securityProperties,sourceDocument);
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.ACTOR,"anotherTest");
  try {
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
    Assert.fail("Expected WSSecurityException");
  }
 catch (  WSSecurityException e) {
    Assert.assertEquals(e.getMessage(),"WSS4JHandler: Request does not contain required Security header");
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Inclusive Canonicalization with Encryption is problematic because xenc namespace "leaks"
 * WSS4J sets the xenc ns on the soap envelope which is not included in the signature on the sending
 * side. swsssf sets the ns where it belongs and so we don't have this problem. But if we
 * get an xenc ns on the envelope we will get a signature error. This case can't be handled correctly.
 * This is also one of the reasons why a exclusive canonicalisation is preferred for SOAP
 * @throws Exception
 */
@Test public void testSignatureC14NInclusivePartsInbound() throws Exception {
  for (int i=0; i < 100; i++) {
    Document securedDocument;
    ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
      WSSSecurityProperties securityProperties=new WSSSecurityProperties();
      List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
      actions.add(WSSConstants.SIGNATURE);
      actions.add(WSSConstants.ENCRYPT);
      securityProperties.setActions(actions);
      securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
      securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
      securityProperties.setSignatureUser("transmitter");
      securityProperties.setEncryptionUser("receiver");
      securityProperties.addSignaturePart(new SecurePart(new QName("http://www.w3.org/1999/XMLSchema","complexType"),SecurePart.Modifier.Element));
      securityProperties.setSignatureCanonicalizationAlgorithm("http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments");
      securityProperties.setCallbackHandler(new CallbackHandlerImpl());
      OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
      XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
      XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
      XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
      xmlStreamWriter.close();
      securedDocument=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
      NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
      Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    }
{
      String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.ENCRYPT;
      Properties properties=new Properties();
      doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
    }
{
      WSSSecurityProperties securityProperties=new WSSSecurityProperties();
      securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
      securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
      securityProperties.setCallbackHandler(new CallbackHandlerImpl());
      securityProperties.addIgnoreBSPRule(BSPRule.R5404);
      securityProperties.addIgnoreBSPRule(BSPRule.R5423);
      securityProperties.addIgnoreBSPRule(BSPRule.R5412);
      InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
      WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.SignatureValue,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SignedElement};
      final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
      XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
      Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
      Assert.assertEquals(nodeList.getLength(),1);
      Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
      securityEventListener.compare();
    }
  }
}

</code></pre>

<br>
<pre class="type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testInteroperabilityInboundSecurityHeaderTimestampOrder() throws Exception {
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  properties.setProperty(WSHandlerConstants.ENCRYPTION_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Content}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedData");
  Element timeStamp=(Element)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
  Element securityHeaderNode=(Element)timeStamp.getParentNode();
  securityHeaderNode.removeChild(timeStamp);
  xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature");
  Element signature=(Element)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
  securityHeaderNode.insertBefore(timeStamp,signature);
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.SignatureValue,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.TIMESTAMP,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.SIGNED_PART,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION};
  final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
  Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),securityEventListener);
  transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
    @Override public void write(    int b) throws IOException {
    }
  }
));
  securityEventListener.compare();
  EncryptedElementSecurityEvent encryptedElementSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.EncryptedElement);
  EncryptedPartSecurityEvent encryptedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.ENCRYPTED_PART);
  List<SignedElementSecurityEvent> signedElementSecurityEvents=securityEventListener.getSecurityEvents(WSSecurityEventConstants.SignedElement);
  List<SignedPartSecurityEvent> signedPartSecurityEvents=securityEventListener.getSecurityEvents(WSSecurityEventConstants.SIGNED_PART);
  SignatureValueSecurityEvent signatureValueSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SignatureValue);
  OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
  String encryptedElementCorrelationID=encryptedElementSecurityEvent.getCorrelationID();
  String encryptedPartCorrelationID=encryptedPartSecurityEvent.getCorrelationID();
  String signedElementCorrelationID1=signedElementSecurityEvents.get(0).getCorrelationID();
  String signedElementCorrelationID2=signedPartSecurityEvents.get(0).getCorrelationID();
  String signatureValueCorrelationID=signatureValueSecurityEvent.getCorrelationID();
  String operationCorrelationID=operationSecurityEvent.getCorrelationID();
  List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
  List<SecurityEvent> encryptedPartSecurityEvents=new ArrayList<SecurityEvent>();
  List<SecurityEvent> encryptedElementSecurityEvents=new ArrayList<SecurityEvent>();
  List<SecurityEvent> signedElementSecurityEvents1=new ArrayList<SecurityEvent>();
  List<SecurityEvent> signedElementSecurityEvents2=new ArrayList<SecurityEvent>();
  List<SecurityEvent> signatureValueSecurityEvents=new ArrayList<SecurityEvent>();
  List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
  for (int i=0; i < securityEvents.size(); i++) {
    SecurityEvent securityEvent=securityEvents.get(i);
    if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID)) {
      encryptedPartSecurityEvents.add(securityEvent);
    }
 else     if (securityEvent.getCorrelationID().equals(encryptedElementCorrelationID)) {
      encryptedElementSecurityEvents.add(securityEvent);
    }
 else     if (securityEvent.getCorrelationID().equals(signedElementCorrelationID1)) {
      signedElementSecurityEvents1.add(securityEvent);
    }
 else     if (securityEvent.getCorrelationID().equals(signedElementCorrelationID2)) {
      signedElementSecurityEvents2.add(securityEvent);
    }
 else     if (securityEvent.getCorrelationID().equals(signatureValueCorrelationID)) {
      signatureValueSecurityEvents.add(securityEvent);
    }
 else     if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
      operationSecurityEvents.add(securityEvent);
    }
  }
  Assert.assertEquals(3,encryptedPartSecurityEvents.size());
  Assert.assertEquals(3,encryptedElementSecurityEvents.size());
  Assert.assertEquals(3,signedElementSecurityEvents1.size());
  Assert.assertEquals(3,signedElementSecurityEvents2.size());
  Assert.assertEquals(4,signatureValueSecurityEvents.size());
  Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + encryptedPartSecurityEvents.size() + encryptedElementSecurityEvents.size()+ signedElementSecurityEvents1.size()+ signedElementSecurityEvents2.size()+ signatureValueSecurityEvents.size()+ 1);
}

</code></pre>

<br>
<pre class="type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testInteroperabilityInbound() throws Exception {
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.SignatureValue,WSSecurityEventConstants.TIMESTAMP,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.SIGNED_PART,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION};
  final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
  Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),securityEventListener);
  transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
    @Override public void write(    int b) throws IOException {
    }
  }
));
  securityEventListener.compare();
  EncryptedPartSecurityEvent encryptedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.ENCRYPTED_PART);
  List<SignedElementSecurityEvent> signedElementSecurityEventList=securityEventListener.getSecurityEvents(WSSecurityEventConstants.SignedElement);
  List<SignedPartSecurityEvent> signedPartSecurityEventList=securityEventListener.getSecurityEvents(WSSecurityEventConstants.SIGNED_PART);
  SignatureValueSecurityEvent signatureValueSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SignatureValue);
  OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
  String encryptedPartCorrelationID=encryptedPartSecurityEvent.getCorrelationID();
  String signedElementCorrelationID1=signedElementSecurityEventList.get(0).getCorrelationID();
  String signedElementCorrelationID2=signedPartSecurityEventList.get(0).getCorrelationID();
  String signatureValueCorrelationID=signatureValueSecurityEvent.getCorrelationID();
  String operationCorrelationID=operationSecurityEvent.getCorrelationID();
  List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
  List<SecurityEvent> encryptedPartSecurityEvents=new ArrayList<SecurityEvent>();
  List<SecurityEvent> signedElementSecurityEvents1=new ArrayList<SecurityEvent>();
  List<SecurityEvent> signedElementSecurityEvents2=new ArrayList<SecurityEvent>();
  List<SecurityEvent> signatureValueSecurityEvents=new ArrayList<SecurityEvent>();
  List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
  for (int i=0; i < securityEvents.size(); i++) {
    SecurityEvent securityEvent=securityEvents.get(i);
    if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID)) {
      encryptedPartSecurityEvents.add(securityEvent);
    }
 else     if (securityEvent.getCorrelationID().equals(signedElementCorrelationID1)) {
      signedElementSecurityEvents1.add(securityEvent);
    }
 else     if (securityEvent.getCorrelationID().equals(signedElementCorrelationID2)) {
      signedElementSecurityEvents2.add(securityEvent);
    }
 else     if (securityEvent.getCorrelationID().equals(signatureValueCorrelationID)) {
      signatureValueSecurityEvents.add(securityEvent);
    }
 else     if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
      operationSecurityEvents.add(securityEvent);
    }
  }
  Assert.assertEquals(4,encryptedPartSecurityEvents.size());
  Assert.assertEquals(3,signedElementSecurityEvents1.size());
  Assert.assertEquals(3,signedElementSecurityEvents2.size());
  Assert.assertEquals(4,signatureValueSecurityEvents.size());
  Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + encryptedPartSecurityEvents.size() + signedElementSecurityEvents1.size()+ signedElementSecurityEvents2.size()+ signatureValueSecurityEvents.size()+ 1);
}

</code></pre>

<br>
<pre class="type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testInteroperabilityEncryptedSignatureInbound() throws Exception {
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  properties.setProperty(WSHandlerConstants.ENCRYPTION_PARTS,"{Element}{http://www.w3.org/2000/09/xmldsig#}Signature;{Content}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.SignatureValue,WSSecurityEventConstants.TIMESTAMP,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.SIGNED_PART,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION};
  final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
  Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),securityEventListener);
  transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(document),new StreamResult(new OutputStream(){
    @Override public void write(    int b) throws IOException {
    }
  }
));
  securityEventListener.compare();
  EncryptedElementSecurityEvent encryptedElementSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.EncryptedElement);
  EncryptedPartSecurityEvent encryptedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.ENCRYPTED_PART);
  List<SignedElementSecurityEvent> signedElementSecurityEventList=securityEventListener.getSecurityEvents(WSSecurityEventConstants.SignedElement);
  List<SignedPartSecurityEvent> signedPartSecurityEventList=securityEventListener.getSecurityEvents(WSSecurityEventConstants.SIGNED_PART);
  SignatureValueSecurityEvent signatureValueSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SignatureValue);
  OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
  String encryptedElementCorrelationID=encryptedElementSecurityEvent.getCorrelationID();
  String encryptedPartCorrelationID=encryptedPartSecurityEvent.getCorrelationID();
  String signedElementCorrelationID1=signedElementSecurityEventList.get(0).getCorrelationID();
  String signedElementCorrelationID2=signedPartSecurityEventList.get(0).getCorrelationID();
  String signatureValueCorrelationID=signatureValueSecurityEvent.getCorrelationID();
  String operationCorrelationID=operationSecurityEvent.getCorrelationID();
  List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
  List<SecurityEvent> encryptedPartSecurityEvents=new ArrayList<SecurityEvent>();
  List<SecurityEvent> encryptedElementSecurityEvents=new ArrayList<SecurityEvent>();
  List<SecurityEvent> signedElementSecurityEvents1=new ArrayList<SecurityEvent>();
  List<SecurityEvent> signedElementSecurityEvents2=new ArrayList<SecurityEvent>();
  List<SecurityEvent> signatureValueSecurityEvents=new ArrayList<SecurityEvent>();
  List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
  for (int i=0; i < securityEvents.size(); i++) {
    SecurityEvent securityEvent=securityEvents.get(i);
    if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID)) {
      encryptedPartSecurityEvents.add(securityEvent);
    }
 else     if (securityEvent.getCorrelationID().equals(encryptedElementCorrelationID)) {
      encryptedElementSecurityEvents.add(securityEvent);
    }
 else     if (securityEvent.getCorrelationID().equals(signedElementCorrelationID1)) {
      signedElementSecurityEvents1.add(securityEvent);
    }
 else     if (securityEvent.getCorrelationID().equals(signedElementCorrelationID2)) {
      signedElementSecurityEvents2.add(securityEvent);
    }
 else     if (securityEvent.getCorrelationID().equals(signatureValueCorrelationID)) {
      signatureValueSecurityEvents.add(securityEvent);
    }
 else     if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
      operationSecurityEvents.add(securityEvent);
    }
  }
  Assert.assertEquals(3,encryptedPartSecurityEvents.size());
  Assert.assertEquals(3,encryptedElementSecurityEvents.size());
  Assert.assertEquals(3,signedElementSecurityEvents1.size());
  Assert.assertEquals(3,signedElementSecurityEvents2.size());
  Assert.assertEquals(4,signatureValueSecurityEvents.size());
  Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + encryptedPartSecurityEvents.size() + encryptedElementSecurityEvents.size()+ signedElementSecurityEvents1.size()+ signedElementSecurityEvents2.size()+ signatureValueSecurityEvents.size()+ 1);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.MultipleActionTest </h4><pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test @org.junit.Ignore public void testTwoSignatureActions() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_c14nExcl_InclusiveNamespaces.getNamespaceURI(),WSSConstants.TAG_c14nExcl_InclusiveNamespaces.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_PrefixList.getLocalPart()),"env");
    Assert.assertEquals(((Element)nodeList.item(1)).getAttributeNS(null,WSSConstants.ATT_NULL_PrefixList.getLocalPart()),"");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.OutputChainTest </h4><pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureAction() throws Exception {
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
  actions.add(WSSConstants.SIGNATURE);
  securityProperties.setActions(actions);
  securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  securityProperties.setSignatureUser("receiver");
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
  XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
  XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
  xmlStreamWriter.close();
  Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
  NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
  Assert.assertEquals(nodeList.getLength(),1);
  Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
  Assert.assertEquals(nodeList.getLength(),1);
  Node attr=nodeList.item(0).getAttributes().getNamedItemNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
  Assert.assertNotNull(attr);
  nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
  Assert.assertEquals(nodeList.getLength(),0);
  nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
  Assert.assertEquals(nodeList.getLength(),0);
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testTimeStampAction() throws Exception {
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
  actions.add(WSSConstants.TIMESTAMP);
  securityProperties.setActions(actions);
  OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
  XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
  XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
  xmlStreamWriter.close();
  Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
  NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
  Assert.assertEquals(nodeList.getLength(),1);
  Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
  Assert.assertEquals(nodeList.getLength(),0);
  nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
  Assert.assertEquals(nodeList.getLength(),0);
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptionAction() throws Exception {
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
  actions.add(WSSConstants.ENCRYPT);
  securityProperties.setActions(actions);
  securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  securityProperties.setEncryptionUser("receiver");
  OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
  XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
  XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
  xmlStreamWriter.close();
  Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
  NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
  Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
  Assert.assertEquals(nodeList.getLength(),1);
  Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),"Body");
  NodeList childNodes=nodeList.item(0).getParentNode().getChildNodes();
  for (int i=0; i < childNodes.getLength(); i++) {
    Node child=childNodes.item(i);
    if (child.getNodeType() == Node.TEXT_NODE) {
      Assert.assertEquals(child.getTextContent().trim(),"");
    }
 else     if (child.getNodeType() == Node.ELEMENT_NODE) {
      Assert.assertEquals(child,nodeList.item(0));
    }
 else {
      Assert.fail("Unexpected Node encountered");
    }
  }
  nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
  Assert.assertEquals(nodeList.getLength(),0);
  nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
  Assert.assertEquals(nodeList.getLength(),0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.PasswordEncryptorTest </h4><pre class="type-3 type-11 type-15 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncDecryptionCryptoPropertiesOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    securityProperties.setActions(actions);
    Properties properties=CryptoFactory.getProperties("transmitter-crypto-enc.properties",this.getClass().getClassLoader());
    PasswordEncryptor passwordEncryptor=new JasyptPasswordEncryptor(new CallbackHandlerImpl());
    securityProperties.setEncryptionCryptoProperties(properties,passwordEncryptor);
    securityProperties.setEncryptionUser("receiver");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=doOutboundSecurity(securityProperties,sourceDocument);
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_DataReference.getNamespaceURI(),WSSConstants.TAG_xenc_DataReference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    xPathExpression=getXPath("/soap:Envelope/soap:Body/xenc:EncryptedData/xenc:EncryptionMethod[@Algorithm='http://www.w3.org/2001/04/xmlenc#aes256-cbc']");
    node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    Assert.assertEquals(node.getParentNode().getParentNode().getLocalName(),"Body");
    NodeList childNodes=node.getParentNode().getParentNode().getChildNodes();
    for (int i=0; i < childNodes.getLength(); i++) {
      Node child=childNodes.item(i);
      if (child.getNodeType() == Node.TEXT_NODE) {
        Assert.assertEquals(child.getTextContent().trim(),"");
      }
 else       if (child.getNodeType() == Node.ELEMENT_NODE) {
        Assert.assertEquals(child,nodeList.item(0));
      }
 else {
        Assert.fail("Unexpected Node encountered");
      }
    }
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureCryptoPropertiesOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    Properties properties=CryptoFactory.getProperties("transmitter-crypto-enc.properties",this.getClass().getClassLoader());
    PasswordEncryptor passwordEncryptor=new JasyptPasswordEncryptor(new CallbackHandlerImpl());
    securityProperties.setSignatureCryptoProperties(properties,passwordEncryptor);
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_c14nExcl_InclusiveNamespaces.getNamespaceURI(),WSSConstants.TAG_c14nExcl_InclusiveNamespaces.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_PrefixList.getLocalPart()),"env");
    Assert.assertEquals(((Element)nodeList.item(1)).getAttributeNS(null,WSSConstants.ATT_NULL_PrefixList.getLocalPart()),"");
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.PasswordTypeTest </h4><pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPasswordDigest() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.USERNAME_TOKEN;
    Properties properties=new Properties();
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_PASSWORD.getNamespaceURI(),WSSConstants.TAG_WSSE_PASSWORD.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_Type.getLocalPart()),WSSConstants.UsernameTokenPasswordType.PASSWORD_DIGEST.getNamespace());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setUsernameTokenPasswordType(WSSConstants.UsernameTokenPasswordType.PASSWORD_DIGEST);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setUsernameTokenPasswordType(null);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setUsernameTokenPasswordType(WSSConstants.UsernameTokenPasswordType.PASSWORD_TEXT);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null);
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
      Assert.assertEquals(e.getCause().getMessage(),"The security token could not be authenticated or authorized");
      Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.FAILED_AUTHENTICATION);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPasswordText() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.USERNAME_TOKEN;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.PASSWORD_TYPE,WSConstants.PW_TEXT);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_PASSWORD.getNamespaceURI(),WSSConstants.TAG_WSSE_PASSWORD.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_Type.getLocalPart()),WSSConstants.UsernameTokenPasswordType.PASSWORD_TEXT.getNamespace());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setUsernameTokenPasswordType(WSSConstants.UsernameTokenPasswordType.PASSWORD_TEXT);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setUsernameTokenPasswordType(null);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setUsernameTokenPasswordType(WSSConstants.UsernameTokenPasswordType.PASSWORD_DIGEST);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null);
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
      Assert.assertEquals(e.getCause().getMessage(),"The security token could not be authenticated or authorized");
      Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.FAILED_AUTHENTICATION);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.PrincipalTest </h4><pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDSAKeyValue() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SIG_KEY_ID,"KeyValue");
    properties.put(WSHandlerConstants.SIGNATURE_USER,"transmitter-dsa");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.addIgnoreBSPRule(BSPRule.R5417);
    securityProperties.addIgnoreBSPRule(BSPRule.R5421);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.KeyValueToken,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    KeyValueTokenSecurityEvent event=(KeyValueTokenSecurityEvent)securityEventListener.getSecurityEvent(WSSecurityEventConstants.KeyValueToken);
    Assert.assertNotNull(event);
    KeyValueSecurityToken token=event.getSecurityToken();
    Principal principal=token.getPrincipal();
    Assert.assertTrue(principal instanceof PublicKeyPrincipal);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUsernameToken() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.USERNAME_TOKEN;
    Properties properties=new Properties();
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_PASSWORD.getNamespaceURI(),WSSConstants.TAG_WSSE_PASSWORD.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_Type.getLocalPart()),WSSConstants.UsernameTokenPasswordType.PASSWORD_DIGEST.getNamespace());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.USERNAME_TOKEN,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    UsernameTokenSecurityEvent event=(UsernameTokenSecurityEvent)securityEventListener.getSecurityEvent(WSSecurityEventConstants.USERNAME_TOKEN);
    Assert.assertNotNull(event);
    UsernameSecurityToken usernameSecurityToken=event.getSecurityToken();
    Principal principal=usernameSecurityToken.getPrincipal();
    Assert.assertTrue(principal instanceof UsernameTokenPrincipal);
    UsernameTokenPrincipal usernameTokenPrincipal=(UsernameTokenPrincipal)principal;
    Assert.assertTrue("transmitter".equals(usernameTokenPrincipal.getName()));
    Assert.assertTrue(usernameTokenPrincipal.getCreatedTime() != null);
    Assert.assertTrue(usernameTokenPrincipal.getNonce() != null);
    Assert.assertTrue(usernameTokenPrincipal.getPassword() != null);
    Assert.assertTrue(usernameTokenPrincipal.isPasswordDigest());
    Assert.assertTrue(WSSConstants.NS_PASSWORD_DIGEST.equals(usernameTokenPrincipal.getPasswordType()));
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAMLToken() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED + " " + WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{urn:oasis:names:tc:SAML:1.0:assertion}Assertion;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.SAML_TOKEN,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    SamlTokenSecurityEvent event=(SamlTokenSecurityEvent)securityEventListener.getSecurityEvent(WSSecurityEventConstants.SAML_TOKEN);
    Assert.assertNotNull(event);
    SamlSecurityToken token=event.getSecurityToken();
    Principal principal=token.getPrincipal();
    Assert.assertTrue(principal instanceof SAMLTokenPrincipal);
    Assert.assertTrue(principal.getName().contains("uid=joe"));
    Assert.assertTrue(((SAMLTokenPrincipal)principal).getToken() != null);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testECKeyValue() throws Exception {
  if ("IBM Corporation".equals(System.getProperty("java.vendor")) || System.getProperty("java.version") != null && System.getProperty("java.version").startsWith("1.8")) {
    return;
  }
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SIG_KEY_ID,"KeyValue");
    properties.put(WSHandlerConstants.SIGNATURE_USER,"transmitter-ecdsa");
    properties.put(WSHandlerConstants.SIG_ALGO,"http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha512");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.addIgnoreBSPRule(BSPRule.R5417);
    securityProperties.addIgnoreBSPRule(BSPRule.R5421);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.KeyValueToken,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    KeyValueTokenSecurityEvent event=(KeyValueTokenSecurityEvent)securityEventListener.getSecurityEvent(WSSecurityEventConstants.KeyValueToken);
    Assert.assertNotNull(event);
    KeyValueSecurityToken token=event.getSecurityToken();
    Principal principal=token.getPrincipal();
    Assert.assertTrue(principal instanceof PublicKeyPrincipal);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testX509Certificate() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.X509Token,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    X509TokenSecurityEvent event=(X509TokenSecurityEvent)securityEventListener.getSecurityEvent(WSSecurityEventConstants.X509Token);
    Assert.assertNotNull(event);
    X509SecurityToken token=event.getSecurityToken();
    Principal principal=token.getPrincipal();
    Assert.assertTrue(principal instanceof X500Principal);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRSAKeyValue() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SIG_KEY_ID,"KeyValue");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.addIgnoreBSPRule(BSPRule.R5417);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.KeyValueToken,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    KeyValueTokenSecurityEvent event=(KeyValueTokenSecurityEvent)securityEventListener.getSecurityEvent(WSSecurityEventConstants.KeyValueToken);
    Assert.assertNotNull(event);
    KeyValueSecurityToken token=event.getSecurityToken();
    Principal principal=token.getPrincipal();
    Assert.assertTrue(principal instanceof PublicKeyPrincipal);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.ReplayTest </h4><pre class="type-3 type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReplayedTimestamp() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.TIMESTAMP;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{" + WSConstants.WSU_NS + "}Timestamp;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
  ReplayCache replayCache=null;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    replayCache=securityProperties.getTimestampReplayCache();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setTimestampReplayCache(replayCache);
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Exception expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof XMLSecurityException);
      Assert.assertEquals("The message has expired",e.getCause().getMessage());
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUsernameToken() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.USERNAME_TOKEN;
    Properties properties=new Properties();
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
  ReplayCache replayCache=null;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    replayCache=securityProperties.getNonceReplayCache();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setNonceReplayCache(replayCache);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Exception expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof XMLSecurityException);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.SecurityContextTokenTest </h4><pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSCTKDKTEncryptSign() throws Exception {
  byte[] tempSecret=WSSecurityUtil.generateNonce(16);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    WSSecSecurityContextToken sctBuilder=new WSSecSecurityContextToken();
    sctBuilder.setWscVersion(version);
    Crypto crypto=CryptoFactory.getInstance("transmitter-crypto.properties");
    sctBuilder.prepare(doc,crypto);
    SecretKeyCallbackHandler callbackHandler=new SecretKeyCallbackHandler();
    callbackHandler.addSecretKey(sctBuilder.getIdentifier(),tempSecret);
    String tokenId=sctBuilder.getSctId();
    WSSecDKEncrypt encrBuilder=new WSSecDKEncrypt();
    encrBuilder.setWscVersion(version);
    if (version == ConversationConstants.VERSION_05_12) {
      encrBuilder.setCustomValueType(WSConstants.WSC_SCT_05_12);
    }
 else {
      encrBuilder.setCustomValueType(WSConstants.WSC_SCT);
    }
    encrBuilder.setSymmetricEncAlgorithm(WSConstants.AES_128);
    encrBuilder.setExternalKey(tempSecret,tokenId);
    encrBuilder.build(doc,secHeader);
    WSSecDKSign sigBuilder=new WSSecDKSign();
    sigBuilder.setWscVersion(version);
    if (version == ConversationConstants.VERSION_05_12) {
      sigBuilder.setCustomValueType(WSConstants.WSC_SCT_05_12);
    }
 else {
      sigBuilder.setCustomValueType(WSConstants.WSC_SCT);
    }
    sigBuilder.setExternalKey(tempSecret,tokenId);
    sigBuilder.setSignatureAlgorithm(WSConstants.HMAC_SHA1);
    sigBuilder.build(doc,secHeader);
    sctBuilder.prependSCTElementToHeader(doc,secHeader);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    CallbackHandlerImpl callbackHandler=new CallbackHandlerImpl(tempSecret);
    securityProperties.setCallbackHandler(callbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SECURITY_CONTEXT_TOKEN,WSSecurityEventConstants.SignatureValue,WSSecurityEventConstants.SIGNED_PART,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    securityEventListener.compare();
    SignedPartSecurityEvent signedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SIGNED_PART);
    SignatureValueSecurityEvent signatureValueSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SignatureValue);
    EncryptedPartSecurityEvent encryptedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.ENCRYPTED_PART);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String signedElementCorrelationID=signedPartSecurityEvent.getCorrelationID();
    String signatureValueCorrelationID=signatureValueSecurityEvent.getCorrelationID();
    String encryptedPartCorrelationID=encryptedPartSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> signedElementSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> signatureValueSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(signedElementCorrelationID)) {
        signedElementSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(signatureValueCorrelationID)) {
        signatureValueSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID)) {
        encryptedPartSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(3,signedElementSecurityEvents.size());
    Assert.assertEquals(5,signatureValueSecurityEvents.size());
    Assert.assertEquals(5,encryptedPartSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + signedElementSecurityEvents.size() + signatureValueSecurityEvents.size()+ encryptedPartSecurityEvents.size());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSCTKDKTEncryptSignAction() throws Exception {
  byte[] tempSecret=WSSecurityUtil.generateNonce(16);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT_DERIVED + " " + WSHandlerConstants.SIGNATURE_DERIVED;
    Properties properties=new Properties();
    CallbackHandlerImpl callbackHandler=new CallbackHandlerImpl(tempSecret);
    properties.put(WSHandlerConstants.PW_CALLBACK_REF,callbackHandler);
    properties.put(WSHandlerConstants.DERIVED_TOKEN_REFERENCE,"SecurityContextToken");
    if (version == ConversationConstants.VERSION_05_02) {
      properties.put(WSHandlerConstants.USE_2005_12_NAMESPACE,"false");
    }
    properties.put(WSHandlerConstants.USER,"transmitter");
    properties.put(WSHandlerConstants.ENC_SYM_ALGO,"http://www.w3.org/2001/04/xmlenc#aes128-cbc");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    CallbackHandlerImpl callbackHandler=new CallbackHandlerImpl(tempSecret);
    securityProperties.setCallbackHandler(callbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SECURITY_CONTEXT_TOKEN,WSSecurityEventConstants.SignatureValue,WSSecurityEventConstants.SIGNED_PART,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    securityEventListener.compare();
    SignedPartSecurityEvent signedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SIGNED_PART);
    SignatureValueSecurityEvent signatureValueSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SignatureValue);
    EncryptedPartSecurityEvent encryptedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.ENCRYPTED_PART);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String signedElementCorrelationID=signedPartSecurityEvent.getCorrelationID();
    String signatureValueCorrelationID=signatureValueSecurityEvent.getCorrelationID();
    String encryptedPartCorrelationID=encryptedPartSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> signedElementSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> signatureValueSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(signedElementCorrelationID)) {
        signedElementSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(signatureValueCorrelationID)) {
        signatureValueSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID)) {
        encryptedPartSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(3,signedElementSecurityEvents.size());
    Assert.assertEquals(5,signatureValueSecurityEvents.size());
    Assert.assertEquals(5,encryptedPartSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + signedElementSecurityEvents.size() + signatureValueSecurityEvents.size()+ encryptedPartSecurityEvents.size());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test() public void testSCTKDKTSignEncryptAction() throws Exception {
  byte[] tempSecret=WSSecurityUtil.generateNonce(16);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE_DERIVED + " " + WSHandlerConstants.ENCRYPT_DERIVED;
    Properties properties=new Properties();
    CallbackHandlerImpl callbackHandler=new CallbackHandlerImpl(tempSecret);
    properties.put(WSHandlerConstants.PW_CALLBACK_REF,callbackHandler);
    properties.put(WSHandlerConstants.DERIVED_TOKEN_REFERENCE,"SecurityContextToken");
    if (version == ConversationConstants.VERSION_05_02) {
      properties.put(WSHandlerConstants.USE_2005_12_NAMESPACE,"false");
    }
    properties.put(WSHandlerConstants.USER,"transmitter");
    properties.put(WSHandlerConstants.ENC_SYM_ALGO,"http://www.w3.org/2001/04/xmlenc#aes128-cbc");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    CallbackHandlerImpl callbackHandler=new CallbackHandlerImpl(tempSecret);
    securityProperties.setCallbackHandler(callbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SECURITY_CONTEXT_TOKEN,WSSecurityEventConstants.SignatureValue,WSSecurityEventConstants.SIGNED_PART,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    securityEventListener.compare();
    SignedPartSecurityEvent signedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SIGNED_PART);
    SignatureValueSecurityEvent signatureValueSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SignatureValue);
    EncryptedPartSecurityEvent encryptedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.ENCRYPTED_PART);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String signedElementCorrelationID=signedPartSecurityEvent.getCorrelationID();
    String signatureValueCorrelationID=signatureValueSecurityEvent.getCorrelationID();
    String encryptedPartCorrelationID=encryptedPartSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> signedElementSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> signatureValueSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(signedElementCorrelationID)) {
        signedElementSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(signatureValueCorrelationID)) {
        signatureValueSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID)) {
        encryptedPartSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(3,signedElementSecurityEvents.size());
    Assert.assertEquals(5,signatureValueSecurityEvents.size());
    Assert.assertEquals(5,encryptedPartSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + signedElementSecurityEvents.size() + signatureValueSecurityEvents.size()+ encryptedPartSecurityEvents.size());
  }
}

</code></pre>

<br>
<pre class="type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSCTSign() throws Exception {
  byte[] tempSecret=WSSecurityUtil.generateNonce(16);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    WSSecSecurityContextToken sctBuilder=new WSSecSecurityContextToken();
    sctBuilder.setWscVersion(version);
    Crypto crypto=CryptoFactory.getInstance("transmitter-crypto.properties");
    sctBuilder.prepare(doc,crypto);
    SecretKeyCallbackHandler callbackHandler=new SecretKeyCallbackHandler();
    callbackHandler.addSecretKey(sctBuilder.getIdentifier(),tempSecret);
    String tokenId=sctBuilder.getSctId();
    WSSecSignature builder=new WSSecSignature();
    builder.setSecretKey(tempSecret);
    builder.setKeyIdentifierType(WSConstants.CUSTOM_SYMM_SIGNING);
    builder.setCustomTokenValueType(WSConstants.WSC_SCT);
    builder.setCustomTokenId(tokenId);
    builder.setSignatureAlgorithm(SignatureMethod.HMAC_SHA1);
    builder.build(doc,crypto,secHeader);
    sctBuilder.prependSCTElementToHeader(doc,secHeader);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    CallbackHandlerImpl callbackHandler=new CallbackHandlerImpl(tempSecret);
    securityProperties.setCallbackHandler(callbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SECURITY_CONTEXT_TOKEN,WSSecurityEventConstants.SignatureValue,WSSecurityEventConstants.SIGNED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    securityEventListener.compare();
    SignedPartSecurityEvent signedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SIGNED_PART);
    SignatureValueSecurityEvent signatureValueSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SignatureValue);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String signedElementCorrelationID=signedPartSecurityEvent.getCorrelationID();
    String signatureValueCorrelationID=signatureValueSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> signedElementSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> signatureValueSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(signedElementCorrelationID)) {
        signedElementSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(signatureValueCorrelationID)) {
        signatureValueSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(3,signedElementSecurityEvents.size());
    Assert.assertEquals(4,signatureValueSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + signedElementSecurityEvents.size() + signatureValueSecurityEvents.size());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test() public void testSCTKDKTSignEncrypt() throws Exception {
  byte[] tempSecret=WSSecurityUtil.generateNonce(16);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    WSSecSecurityContextToken sctBuilder=new WSSecSecurityContextToken();
    sctBuilder.setWscVersion(version);
    Crypto crypto=CryptoFactory.getInstance("transmitter-crypto.properties");
    sctBuilder.prepare(doc,crypto);
    SecretKeyCallbackHandler callbackHandler=new SecretKeyCallbackHandler();
    callbackHandler.addSecretKey(sctBuilder.getIdentifier(),tempSecret);
    String tokenId=sctBuilder.getSctId();
    WSSecDKSign sigBuilder=new WSSecDKSign();
    sigBuilder.setWscVersion(version);
    if (version == ConversationConstants.VERSION_05_12) {
      sigBuilder.setCustomValueType(WSConstants.WSC_SCT_05_12);
    }
 else {
      sigBuilder.setCustomValueType(WSConstants.WSC_SCT);
    }
    sigBuilder.setExternalKey(tempSecret,tokenId);
    sigBuilder.setSignatureAlgorithm(WSConstants.HMAC_SHA1);
    sigBuilder.build(doc,secHeader);
    WSSecDKEncrypt encrBuilder=new WSSecDKEncrypt();
    encrBuilder.setWscVersion(version);
    if (version == ConversationConstants.VERSION_05_12) {
      encrBuilder.setCustomValueType(WSConstants.WSC_SCT_05_12);
    }
 else {
      encrBuilder.setCustomValueType(WSConstants.WSC_SCT);
    }
    encrBuilder.setSymmetricEncAlgorithm(WSConstants.AES_128);
    encrBuilder.setExternalKey(tempSecret,tokenId);
    encrBuilder.build(doc,secHeader);
    sctBuilder.prependSCTElementToHeader(doc,secHeader);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    CallbackHandlerImpl callbackHandler=new CallbackHandlerImpl(tempSecret);
    securityProperties.setCallbackHandler(callbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SECURITY_CONTEXT_TOKEN,WSSecurityEventConstants.SignatureValue,WSSecurityEventConstants.SIGNED_PART,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    securityEventListener.compare();
    SignedPartSecurityEvent signedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SIGNED_PART);
    SignatureValueSecurityEvent signatureValueSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SignatureValue);
    EncryptedPartSecurityEvent encryptedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.ENCRYPTED_PART);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String signedElementCorrelationID=signedPartSecurityEvent.getCorrelationID();
    String signatureValueCorrelationID=signatureValueSecurityEvent.getCorrelationID();
    String encryptedPartCorrelationID=encryptedPartSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> signedElementSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> signatureValueSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(signedElementCorrelationID)) {
        signedElementSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(signatureValueCorrelationID)) {
        signatureValueSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID)) {
        encryptedPartSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(3,signedElementSecurityEvents.size());
    Assert.assertEquals(5,signatureValueSecurityEvents.size());
    Assert.assertEquals(5,encryptedPartSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + signedElementSecurityEvents.size() + signatureValueSecurityEvents.size()+ encryptedPartSecurityEvents.size());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSCTDKTEncryptInboundAction() throws Exception {
  byte[] tempSecret=WSSecurityUtil.generateNonce(16);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENCRYPT_DERIVED;
    Properties properties=new Properties();
    CallbackHandlerImpl callbackHandler=new CallbackHandlerImpl(tempSecret);
    properties.put(WSHandlerConstants.PW_CALLBACK_REF,callbackHandler);
    properties.put(WSHandlerConstants.DERIVED_TOKEN_REFERENCE,"SecurityContextToken");
    if (version == ConversationConstants.VERSION_05_02) {
      properties.put(WSHandlerConstants.USE_2005_12_NAMESPACE,"false");
    }
    properties.put(WSHandlerConstants.USER,"receiver");
    properties.put(WSHandlerConstants.ENC_SYM_ALGO,"http://www.w3.org/2001/04/xmlenc#aes128-cbc");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SOAP11_BODY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    CallbackHandlerImpl callbackHandler=new CallbackHandlerImpl(tempSecret);
    securityProperties.setCallbackHandler(callbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SECURITY_CONTEXT_TOKEN,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    securityEventListener.compare();
    EncryptedPartSecurityEvent encryptedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.ENCRYPTED_PART);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String encryptedPartCorrelationID=encryptedPartSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID)) {
        encryptedPartSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(5,encryptedPartSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + encryptedPartSecurityEvents.size());
  }
}

</code></pre>

<br>
<pre class="type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSCTKDKTSignInbound() throws Exception {
  byte[] tempSecret=WSSecurityUtil.generateNonce(16);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    WSSecSecurityContextToken sctBuilder=new WSSecSecurityContextToken();
    sctBuilder.setWscVersion(version);
    Crypto crypto=CryptoFactory.getInstance("transmitter-crypto.properties");
    sctBuilder.prepare(doc,crypto);
    SecretKeyCallbackHandler callbackHandler=new SecretKeyCallbackHandler();
    callbackHandler.addSecretKey(sctBuilder.getIdentifier(),tempSecret);
    String tokenId=sctBuilder.getSctId();
    WSSecDKSign sigBuilder=new WSSecDKSign();
    sigBuilder.setWscVersion(version);
    sigBuilder.setExternalKey(tempSecret,tokenId);
    sigBuilder.setSignatureAlgorithm(WSConstants.HMAC_SHA1);
    sigBuilder.build(doc,secHeader);
    sctBuilder.prependSCTElementToHeader(doc,secHeader);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    CallbackHandlerImpl callbackHandler=new CallbackHandlerImpl(tempSecret);
    securityProperties.setCallbackHandler(callbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SECURITY_CONTEXT_TOKEN,WSSecurityEventConstants.SignatureValue,WSSecurityEventConstants.SIGNED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    securityEventListener.compare();
    SignedPartSecurityEvent signedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SIGNED_PART);
    SignatureValueSecurityEvent signatureValueSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SignatureValue);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String signedElementCorrelationID=signedPartSecurityEvent.getCorrelationID();
    String signatureValueCorrelationID=signatureValueSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> signedElementSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> signatureValueSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(signedElementCorrelationID)) {
        signedElementSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(signatureValueCorrelationID)) {
        signatureValueSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(3,signedElementSecurityEvents.size());
    Assert.assertEquals(6,signatureValueSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + signedElementSecurityEvents.size() + signatureValueSecurityEvents.size());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSCTDKTEncryptOutbound() throws Exception {
  byte[] secret=WSSConstants.generateBytes(128 / 8);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT_WITH_DERIVED_KEY);
    securityProperties.setActions(actions);
    CallbackHandlerImpl callbackHandler=new CallbackHandlerImpl(secret);
    securityProperties.setCallbackHandler(callbackHandler);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.setEncryptionSymAlgorithm("http://www.w3.org/2001/04/xmlenc#aes128-cbc");
    securityProperties.setDerivedKeyTokenReference(WSSConstants.DerivedKeyTokenReference.SecurityContextToken);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SOAP11_BODY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSC0512_SCT.getNamespaceURI(),WSSConstants.TAG_WSC0512_SCT.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSC0512_DKT.getNamespaceURI(),WSSConstants.TAG_WSC0512_DKT.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_ReferenceList.getNamespaceURI(),WSSConstants.TAG_xenc_ReferenceList.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
{
    String action=WSHandlerConstants.ENCRYPT;
    Properties properties=new Properties();
    WSS4JCallbackHandlerImpl callbackHandler=new WSS4JCallbackHandlerImpl(secret);
    properties.put(WSHandlerConstants.PW_CALLBACK_REF,callbackHandler);
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSCTKDKTSignInboundAction() throws Exception {
  byte[] tempSecret=WSSecurityUtil.generateNonce(16);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE_DERIVED;
    Properties properties=new Properties();
    CallbackHandlerImpl callbackHandler=new CallbackHandlerImpl(tempSecret);
    properties.put(WSHandlerConstants.PW_CALLBACK_REF,callbackHandler);
    properties.put(WSHandlerConstants.DERIVED_TOKEN_REFERENCE,"SecurityContextToken");
    if (version == ConversationConstants.VERSION_05_02) {
      properties.put(WSHandlerConstants.USE_2005_12_NAMESPACE,"false");
    }
    properties.put(WSHandlerConstants.USER,"transmitter");
    properties.put(WSHandlerConstants.ENC_SYM_ALGO,"http://www.w3.org/2001/04/xmlenc#aes128-cbc");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    CallbackHandlerImpl callbackHandler=new CallbackHandlerImpl(tempSecret);
    securityProperties.setCallbackHandler(callbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SECURITY_CONTEXT_TOKEN,WSSecurityEventConstants.SignatureValue,WSSecurityEventConstants.SIGNED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    securityEventListener.compare();
    SignedPartSecurityEvent signedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SIGNED_PART);
    SignatureValueSecurityEvent signatureValueSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SignatureValue);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String signedElementCorrelationID=signedPartSecurityEvent.getCorrelationID();
    String signatureValueCorrelationID=signatureValueSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> signedElementSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> signatureValueSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(signedElementCorrelationID)) {
        signedElementSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(signatureValueCorrelationID)) {
        signatureValueSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(3,signedElementSecurityEvents.size());
    Assert.assertEquals(6,signatureValueSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + signedElementSecurityEvents.size() + signatureValueSecurityEvents.size());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSCTKDKTSignOutbound() throws Exception {
  byte[] secret=WSSConstants.generateBytes(128 / 8);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE_WITH_DERIVED_KEY);
    securityProperties.setActions(actions);
    CallbackHandlerImpl callbackHandler=new CallbackHandlerImpl(secret);
    securityProperties.setCallbackHandler(callbackHandler);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setDerivedKeyTokenReference(WSSConstants.DerivedKeyTokenReference.SecurityContextToken);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSC0512_SCT.getNamespaceURI(),WSSConstants.TAG_WSC0512_SCT.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSC0512_DKT.getNamespaceURI(),WSSConstants.TAG_WSC0512_DKT.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_ReferenceList.getNamespaceURI(),WSSConstants.TAG_xenc_ReferenceList.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    WSS4JCallbackHandlerImpl callbackHandler=new WSS4JCallbackHandlerImpl(secret);
    properties.put(WSHandlerConstants.PW_CALLBACK_REF,callbackHandler);
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSCTDKTEncryptInbound() throws Exception {
  byte[] tempSecret=WSSecurityUtil.generateNonce(16);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    WSSecSecurityContextToken sctBuilder=new WSSecSecurityContextToken();
    sctBuilder.setWscVersion(version);
    Crypto crypto=CryptoFactory.getInstance("transmitter-crypto.properties");
    sctBuilder.prepare(doc,crypto);
    SecretKeyCallbackHandler callbackHandler=new SecretKeyCallbackHandler();
    callbackHandler.addSecretKey(sctBuilder.getIdentifier(),tempSecret);
    String tokenId=sctBuilder.getSctId();
    WSSecDKEncrypt encrBuilder=new WSSecDKEncrypt();
    encrBuilder.setWscVersion(version);
    encrBuilder.setSymmetricEncAlgorithm(WSConstants.AES_128);
    encrBuilder.setExternalKey(tempSecret,tokenId);
    encrBuilder.build(doc,secHeader);
    sctBuilder.prependSCTElementToHeader(doc,secHeader);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    CallbackHandlerImpl callbackHandler=new CallbackHandlerImpl(tempSecret);
    securityProperties.setCallbackHandler(callbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SECURITY_CONTEXT_TOKEN,WSSecurityEventConstants.ENCRYPTED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    securityEventListener.compare();
    EncryptedPartSecurityEvent encryptedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.ENCRYPTED_PART);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String encryptedPartCorrelationID=encryptedPartSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> encryptedPartSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(encryptedPartCorrelationID)) {
        encryptedPartSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(5,encryptedPartSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + encryptedPartSecurityEvents.size());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.SignatureCRLTest </h4><pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test signing a SOAP message using a BST. Revocation is not enabled and so the test
 * should pass.
 * TODO Re-enable once CRL issue fixed
 */
@Test @org.junit.Ignore public void testSignatureDirectReference() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("wss40rev.jks"),"security".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setEnableRevocation(true);
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("wss40rev.jks"),"security".toCharArray());
    securityProperties.loadCRLCertStore(this.getClass().getClassLoader().getResource("wss40CACRL.pem"));
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected failure on a revocation check");
    }
 catch (    Exception ex) {
      Assert.assertNotNull(ex.getCause());
      Assert.assertTrue(ex.getCause() instanceof WSSecurityException);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.SignatureCertConstaintsTest </h4><pre class="type-3 type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBSTSignature() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("wss40CA.jks"),"security".toCharArray());
    String certConstraint=".*CN=Colm.*O=Apache.*";
    Pattern subjectDNPattern=Pattern.compile(certConstraint.trim());
    securityProperties.setSubjectCertConstraints(Collections.singletonList(subjectDNPattern));
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("wss40CA.jks"),"security".toCharArray());
    String certConstraint=".*CN=Colm2.*O=Apache.*";
    Pattern subjectDNPattern=Pattern.compile(certConstraint.trim());
    securityProperties.setSubjectCertConstraints(Collections.singletonList(subjectDNPattern));
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected failure on a incorrect cert constraint check");
    }
 catch (    Exception ex) {
      String errorMessage="The security token could not be authenticated or authorized";
      Assert.assertTrue(ex.getMessage().contains(errorMessage));
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBSTSignaturePKIPath() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.USE_SINGLE_CERTIFICATE,"false");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("wss40CA.jks"),"security".toCharArray());
    String certConstraint=".*CN=Colm.*O=Apache.*";
    Pattern subjectDNPattern=Pattern.compile(certConstraint.trim());
    securityProperties.setSubjectCertConstraints(Collections.singletonList(subjectDNPattern));
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("wss40CA.jks"),"security".toCharArray());
    String certConstraint=".*CN=Colm2.*O=Apache.*";
    Pattern subjectDNPattern=Pattern.compile(certConstraint.trim());
    securityProperties.setSubjectCertConstraints(Collections.singletonList(subjectDNPattern));
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected failure on a incorrect cert constraint check");
    }
 catch (    Exception ex) {
      String errorMessage="The security token could not be authenticated or authorized";
      Assert.assertTrue(ex.getMessage().contains(errorMessage));
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.SignatureConfirmationTest </h4><pre class="type-3 type-7 type-5 type-9 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@SuppressWarnings("unchecked") @Test public void testDefaultConfigurationOutbound() throws Exception {
  final List<SecurityEvent> securityEventList=new ArrayList<SecurityEvent>();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    SecurityEventListener securityEventListener=new SecurityEventListener(){
      @Override public void registerSecurityEvent(      SecurityEvent securityEvent) throws WSSecurityException {
        securityEventList.add(securityEvent);
      }
    }
;
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>(),securityEventListener);
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
  List<WSHandlerResult> wsHandlerResult;
{
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.ENABLE_SIGNATURE_CONFIRMATION,"true");
    Map<String,Object> messageContext=doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
    wsHandlerResult=(List<WSHandlerResult>)messageContext.get(WSHandlerConstants.RECV_RESULTS);
  }
  baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.ENABLE_SIGNATURE_CONFIRMATION + " " + WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.RECV_RESULTS,wsHandlerResult);
    Map<String,Object> messageContext=doOutboundSecurityWithWSS4J_1(sourceDocument,action,properties);
    Document securedDocument=(Document)messageContext.get(SECURED_DOCUMENT);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE11_SIG_CONF.getNamespaceURI(),WSSConstants.TAG_WSSE11_SIG_CONF.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertNotSame(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_VALUE.getLocalPart()),"");
    Assert.assertNotNull(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_WSU_ID.getLocalPart()),"");
    nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setEnableSignatureConfirmationVerification(true);
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),securityEventList);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOutboundNoSignatureConfirmation() throws Exception {
  final List<SecurityEvent> securityEventList=new ArrayList<SecurityEvent>();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    SecurityEventListener securityEventListener=new SecurityEventListener(){
      @Override public void registerSecurityEvent(      SecurityEvent securityEvent) throws WSSecurityException {
        securityEventList.add(securityEvent);
      }
    }
;
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>(),securityEventListener);
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
  baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    Map<String,Object> messageContext=doOutboundSecurityWithWSS4J_1(sourceDocument,action,properties);
    Document securedDocument=(Document)messageContext.get(SECURED_DOCUMENT);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE11_SIG_CONF.getNamespaceURI(),WSSConstants.TAG_WSSE11_SIG_CONF.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setEnableSignatureConfirmationVerification(true);
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),securityEventList);
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
      Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-9 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@SuppressWarnings("unchecked") @Test public void testDefaultConfigurationInboundUnsignedConfirmation() throws Exception {
  Set<Integer> sigv;
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.ENABLE_SIGNATURE_CONFIRMATION,"true");
    Map<String,Object> messageContext=doOutboundSecurityWithWSS4J_1(sourceDocument,action,properties);
    sigv=(Set<Integer>)messageContext.get(WSHandlerConstants.SEND_SIGV);
    Document securedDocument=(Document)messageContext.get(SECURED_DOCUMENT);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
  final List<SecurityEvent> securityEventList=new ArrayList<SecurityEvent>();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    SecurityEventListener securityEventListener=new SecurityEventListener(){
      @Override public void registerSecurityEvent(      SecurityEvent securityEvent) throws WSSecurityException {
        securityEventList.add(securityEvent);
      }
    }
;
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),new ArrayList<SecurityEvent>(),securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
  baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE_CONFIRMATION);
    securityProperties.setActions(actions);
    securityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSSE11_SIG_CONF,SecurePart.Modifier.Element));
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("receiver");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),securityEventList);
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE11_SIG_CONF.getNamespaceURI(),WSSConstants.TAG_WSSE11_SIG_CONF.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertNotSame(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_VALUE.getLocalPart()),"");
    Assert.assertNotNull(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_WSU_ID.getLocalPart()),"");
    Assert.assertTrue(((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart()).length() > 0);
  }
{
    String action="";
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SEND_SIGV,sigv);
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,true);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-9 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@SuppressWarnings("unchecked") @Test public void testDefaultConfigurationInbound() throws Exception {
  Set<Integer> sigv;
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.ENABLE_SIGNATURE_CONFIRMATION,"true");
    Map<String,Object> messageContext=doOutboundSecurityWithWSS4J_1(sourceDocument,action,properties);
    sigv=(Set<Integer>)messageContext.get(WSHandlerConstants.SEND_SIGV);
    Document securedDocument=(Document)messageContext.get(SECURED_DOCUMENT);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
  final List<SecurityEvent> securityEventList=new ArrayList<SecurityEvent>();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    SecurityEventListener securityEventListener=new SecurityEventListener(){
      @Override public void registerSecurityEvent(      SecurityEvent securityEvent) throws WSSecurityException {
        securityEventList.add(securityEvent);
      }
    }
;
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),new ArrayList<SecurityEvent>(),securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
  baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE_CONFIRMATION);
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_SOAP11_BODY,SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(WSSConstants.TAG_WSSE11_SIG_CONF,SecurePart.Modifier.Element));
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("receiver");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),securityEventList);
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE11_SIG_CONF.getNamespaceURI(),WSSConstants.TAG_WSSE11_SIG_CONF.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertNotSame(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_VALUE.getLocalPart()),"");
    Assert.assertNotNull(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_WSU_ID.getLocalPart()),"");
    Assert.assertTrue(((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart()).length() > 0);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SEND_SIGV,sigv);
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,true);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.SignatureEncryptionTest </h4><pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEncryptedDataTokenSecurityHeaderWithoutReferenceInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    Document doc=documentBuilderFactory.newDocumentBuilder().parse(sourceDocument);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    WSSecSignature sign=new WSSecSignature();
    sign.setUserInfo("transmitter","default");
    sign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
    Crypto crypto=CryptoFactory.getInstance("transmitter-crypto.properties");
    sign.build(doc,crypto,secHeader);
    WSSecEncrypt builder=new WSSecEncrypt();
    builder.setKeyIdentifierType(WSConstants.THUMBPRINT_IDENTIFIER);
    builder.setUserInfo("receiver");
    builder.prepare(doc,crypto);
    WSEncryptionPart bst=new WSEncryptionPart("BinarySecurityToken","http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd","Element");
    WSEncryptionPart def=new WSEncryptionPart("definitions","http://schemas.xmlsoap.org/wsdl/","Element");
    List<WSEncryptionPart> encryptionParts=new ArrayList<WSEncryptionPart>();
    encryptionParts.add(bst);
    encryptionParts.add(def);
    Element ref=builder.encryptForRef(null,encryptionParts);
    ref.removeChild(ref.getElementsByTagNameNS("http://www.w3.org/2001/04/xmlenc#","DataReference").item(0));
    builder.addExternalRefElement(ref,secHeader);
    builder.prependToHeader(secHeader);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    Document document=doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedData.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedData.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSignatureEncryptionSymmetricOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    actions.add(WSSConstants.ENCRYPT);
    actions.add(WSSConstants.TIMESTAMP);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setSignatureAlgorithm(WSSConstants.NS_XMLDSIG_HMACSHA1);
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_EncryptedKey);
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_WSU10,"Timestamp"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_SOAP11,"Body"),SecurePart.Modifier.Element));
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    String keyAlgorithm=JCEAlgorithmMapper.getJCEKeyAlgorithmFromURI(WSSConstants.NS_XENC_AES128);
    KeyGenerator keyGen;
    try {
      keyGen=KeyGenerator.getInstance(keyAlgorithm);
    }
 catch (    NoSuchAlgorithmException e) {
      throw new WSSecurityException(WSSecurityException.ErrorCode.FAILURE,e);
    }
    int keyLength=JCEAlgorithmMapper.getKeyLengthFromURI(WSSConstants.NS_XENC_AES128);
    keyGen.init(keyLength);
    final Key symmetricKey=keyGen.generateKey();
    final String ekId=IDGenerator.generateID(null);
    final GenericOutboundSecurityToken encryptedKeySecurityToken=new GenericOutboundSecurityToken(ekId,WSSecurityTokenConstants.EncryptedKeyToken,symmetricKey);
    final SecurityTokenProvider<OutboundSecurityToken> encryptedKeySecurityTokenProvider=new SecurityTokenProvider<OutboundSecurityToken>(){
      @Override public OutboundSecurityToken getSecurityToken() throws XMLSecurityException {
        return encryptedKeySecurityToken;
      }
      @Override public String getId(){
        return ekId;
      }
    }
;
    final OutboundSecurityContextImpl outboundSecurityContext=new OutboundSecurityContextImpl();
    outboundSecurityContext.putList(SecurityEvent.class,new ArrayList<SecurityEvent>());
    outboundSecurityContext.registerSecurityTokenProvider(encryptedKeySecurityTokenProvider.getId(),encryptedKeySecurityTokenProvider);
    outboundSecurityContext.put(WSSConstants.PROP_USE_THIS_TOKEN_ID_FOR_ENCRYPTION,encryptedKeySecurityTokenProvider.getId());
    outboundSecurityContext.put(WSSConstants.PROP_USE_THIS_TOKEN_ID_FOR_SIGNATURE,encryptedKeySecurityTokenProvider.getId());
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=new ByteArrayOutputStream();
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),outboundSecurityContext);
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(sourceDocument);
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList securityHeaderElement=document.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(childs.getLength(),4);
    Assert.assertEquals(childs.item(0).getLocalName(),"Timestamp");
    Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedKey");
    Assert.assertEquals(childs.item(2).getLocalName(),"ReferenceList");
    Assert.assertEquals(childs.item(3).getLocalName(),"Signature");
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.ENCRYPT+ " "+ WSHandlerConstants.TIMESTAMP;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEncryptionSignatureSymmetricOutbound() throws Exception {
  ByteArrayOutputStream baos;
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.ENCRYPT);
    actions.add(WSSConstants.SIGNATURE);
    actions.add(WSSConstants.TIMESTAMP);
    securityProperties.setActions(actions);
    securityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setEncryptionUser("receiver");
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setSignatureAlgorithm(WSSConstants.NS_XMLDSIG_HMACSHA1);
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_EncryptedKey);
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_WSU10,"Timestamp"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_SOAP11,"Body"),SecurePart.Modifier.Element));
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    String keyAlgorithm=JCEAlgorithmMapper.getJCEKeyAlgorithmFromURI(WSSConstants.NS_XENC_AES128);
    KeyGenerator keyGen;
    try {
      keyGen=KeyGenerator.getInstance(keyAlgorithm);
    }
 catch (    NoSuchAlgorithmException e) {
      throw new WSSecurityException(WSSecurityException.ErrorCode.FAILURE,e);
    }
    int keyLength=JCEAlgorithmMapper.getKeyLengthFromURI(WSSConstants.NS_XENC_AES128);
    keyGen.init(keyLength);
    final Key symmetricKey=keyGen.generateKey();
    final String ekId=IDGenerator.generateID(null);
    final GenericOutboundSecurityToken encryptedKeySecurityToken=new GenericOutboundSecurityToken(ekId,WSSecurityTokenConstants.EncryptedKeyToken,symmetricKey);
    final SecurityTokenProvider<OutboundSecurityToken> encryptedKeySecurityTokenProvider=new SecurityTokenProvider<OutboundSecurityToken>(){
      @Override public OutboundSecurityToken getSecurityToken() throws XMLSecurityException {
        return encryptedKeySecurityToken;
      }
      @Override public String getId(){
        return ekId;
      }
    }
;
    final OutboundSecurityContextImpl outboundSecurityContext=new OutboundSecurityContextImpl();
    outboundSecurityContext.putList(SecurityEvent.class,new ArrayList<SecurityEvent>());
    outboundSecurityContext.registerSecurityTokenProvider(encryptedKeySecurityTokenProvider.getId(),encryptedKeySecurityTokenProvider);
    outboundSecurityContext.put(WSSConstants.PROP_USE_THIS_TOKEN_ID_FOR_ENCRYPTION,encryptedKeySecurityTokenProvider.getId());
    outboundSecurityContext.put(WSSConstants.PROP_USE_THIS_TOKEN_ID_FOR_SIGNATURE,encryptedKeySecurityTokenProvider.getId());
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    baos=new ByteArrayOutputStream();
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),outboundSecurityContext);
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(sourceDocument);
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList securityHeaderElement=document.getElementsByTagNameNS(WSConstants.WSSE_NS,"Security");
    Assert.assertEquals(1,securityHeaderElement.getLength());
    NodeList childs=securityHeaderElement.item(0).getChildNodes();
    Assert.assertEquals(childs.getLength(),4);
    Assert.assertEquals(childs.item(0).getLocalName(),"Timestamp");
    Assert.assertEquals(childs.item(1).getLocalName(),"EncryptedKey");
    Assert.assertEquals(childs.item(2).getLocalName(),"Signature");
    Assert.assertEquals(childs.item(3).getLocalName(),"ReferenceList");
  }
{
    String action=WSHandlerConstants.ENCRYPT + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.TIMESTAMP;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.SignatureTest </h4><pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureHMACOutputLengthInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_SignatureMethod.getNamespaceURI(),WSSConstants.TAG_dsig_SignatureMethod.getLocalPart());
    Element hmacElement=securedDocument.createElementNS(WSSConstants.TAG_dsig_HMACOutputLength.getNamespaceURI(),WSSConstants.TAG_dsig_HMACOutputLength.getLocalPart());
    hmacElement.setTextContent("abc");
    nodeList.item(0).appendChild(hmacElement);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Should have thrown XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
      Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSignatureC14NInclusivePartsInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://www.w3.org/1999/XMLSchema}complexType;");
    properties.setProperty("CanonicalizationAlgo","http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierThumbprintIncludeTokenOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_THUMBPRINT_IDENTIFIER);
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    securityProperties.setIncludeSignatureToken(true);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/oasis-wss-soap-message-security-1.1#ThumbprintSHA1']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSignatureCryptoPropertiesInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    Properties properties=CryptoFactory.getProperties("receiver-crypto.properties",this.getClass().getClassLoader());
    securityProperties.setSignatureVerificationCryptoProperties(properties);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureECKeyValue() throws Exception {
  if ("IBM Corporation".equals(System.getProperty("java.vendor")) || System.getProperty("java.version") != null && System.getProperty("java.version").startsWith("1.8")) {
    return;
  }
  if (Security.getProvider("BC") == null) {
    return;
  }
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter-ecdsa");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_KeyValue);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha512");
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig11_ECKeyValue.getNamespaceURI(),WSSConstants.TAG_dsig11_ECKeyValue.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.addIgnoreBSPRule(BSPRule.R5421);
    securityProperties.addIgnoreBSPRule(BSPRule.R5417);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    Assert.assertNotNull(document);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Since WSS4J hardcoded the C14N algo for References, we test against our framework
 * @throws Exception
 */
@Test public void testSignatureC14NInclusivePartsInbound_DisableAllBSPRules() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://www.w3.org/1999/XMLSchema","complexType"),SecurePart.Modifier.Element));
    securityProperties.setSignatureCanonicalizationAlgorithm("http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document securedDocument=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setDisableBSPEnforcement(true);
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSignatureDefaultConfigurationInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSignaturePartsInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://www.w3.org/1999/XMLSchema}complexType;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierIssuerSerialOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_IssuerSerial);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/wsse:SecurityTokenReference/dsig:X509Data/dsig:X509IssuerSerial/dsig:X509SerialNumber");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureUsePKIPathOutbound() throws Exception {
  if (Security.getProvider("BC") == null) {
    return;
  }
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setUseSingleCert(false);
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureDSAKeyValue() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter-dsa");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_KeyValue);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setSignatureAlgorithm("http://www.w3.org/2000/09/xmldsig#dsa-sha1");
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_DSAKeyValue.getNamespaceURI(),WSSConstants.TAG_dsig_DSAKeyValue.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.addIgnoreBSPRule(BSPRule.R5421);
    securityProperties.addIgnoreBSPRule(BSPRule.R5417);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    Assert.assertNotNull(document);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierBinarySecurityTokenDirectReferenceOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/wsse:BinarySecurityToken");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSignaturePropertiesInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    Map<String,Object> config=new HashMap<String,Object>();
    config.put(ConfigurationConstants.ACTION,ConfigurationConstants.SIGNATURE);
    config.put(ConfigurationConstants.SIG_VER_PROP_FILE,"transmitter-crypto.properties");
    WSSSecurityProperties securityProperties=ConfigurationConverter.convert(config);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierSha1Inbound() throws Exception {
  KeyGenerator keyGen=KeyGenerator.getInstance("AES");
  keyGen.init(128);
  SecretKey key=keyGen.generateKey();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    Document doc=documentBuilderFactory.newDocumentBuilder().parse(sourceDocument);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    WSSecSignature sign=new WSSecSignature();
    sign.setKeyIdentifierType(WSConstants.ENCRYPTED_KEY_SHA1_IDENTIFIER);
    sign.setSecretKey(key.getEncoded());
    sign.setSignatureAlgorithm(SignatureMethod.HMAC_SHA1);
    Document securedDocument=sign.build(doc,null,secHeader);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/" + "wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType=" + "'http://docs.oasis-open.org/wss/oasis-wss-soap-message-security-1.1#EncryptedKeySHA1']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl(key.getEncoded()));
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierThumbprintInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.SIG_KEY_ID,"Thumbprint");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/oasis-wss-soap-message-security-1.1#ThumbprintSHA1']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierX509KeyInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.SIG_KEY_ID,"X509KeyIdentifier");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierIssuerSerialInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.SIG_KEY_ID,"IssuerSerial");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/wsse:SecurityTokenReference/dsig:X509Data/dsig:X509IssuerSerial/dsig:X509SerialNumber");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Since WSS4J hardcoded the C14N algo for References, we test against our framework
 * @throws Exception
 */
@Test public void testSignatureC14NInclusivePartsInbound_1() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://www.w3.org/1999/XMLSchema","complexType"),SecurePart.Modifier.Element));
    securityProperties.setSignatureCanonicalizationAlgorithm("http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document securedDocument=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.addIgnoreBSPRule(BSPRule.R5404);
    securityProperties.addIgnoreBSPRule(BSPRule.R5423);
    securityProperties.addIgnoreBSPRule(BSPRule.R5412);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierIssuerSerialIncludeTokenOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_IssuerSerial);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setIncludeSignatureToken(true);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/wsse:SecurityTokenReference/dsig:X509Data/dsig:X509IssuerSerial/dsig:X509SerialNumber");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInboundRequiredAlgorithm() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setSignatureAlgorithm(WSSConstants.NS_XMLDSIG_RSASHA1);
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setSignatureAlgorithm(WSSConstants.NS_XMLDSIG_HMACSHA1);
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    try {
      XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Failure expected on the wrong signature algorithm");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierSubjectKeyInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.SIG_KEY_ID,"SKIKeyIdentifier");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509SubjectKeyIdentifier']");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExceptionOnElementToSignNotFound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://www.wrongnamespace.org","complexType"),SecurePart.Modifier.Element));
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    try {
      XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
      xmlStreamWriter.close();
      Assert.fail("Exception expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof XMLSecurityException);
      Assert.assertEquals("Part to sign not found: {http://www.wrongnamespace.org}complexType",e.getCause().getMessage());
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierSha1Outbound() throws Exception {
  KeyGenerator keyGen=KeyGenerator.getInstance("AES");
  keyGen.init(128);
  final SecretKey key=keyGen.generateKey();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.setSignatureUser("transmitter");
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_ENCRYPTED_KEY_SHA1_IDENTIFIER);
    securityProperties.setSignatureAlgorithm("http://www.w3.org/2000/09/xmldsig#hmac-sha1");
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl(key.getEncoded()){
      @Override public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        WSPasswordCallback pc=(WSPasswordCallback)callbacks[0];
        pc.setKey(key.getEncoded());
      }
    }
);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/" + "wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType=" + "'http://docs.oasis-open.org/wss/oasis-wss-soap-message-security-1.1#EncryptedKeySHA1']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    WSS4JCallbackHandlerImpl callbackHandler=new WSS4JCallbackHandlerImpl(key.getEncoded());
    properties.put(WSHandlerConstants.PW_CALLBACK_REF,callbackHandler);
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,true);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-7 type-5 type-9 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureC14NInclusivePartsOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://www.w3.org/1999/XMLSchema","complexType"),SecurePart.Modifier.Element));
    securityProperties.setSignatureCanonicalizationAlgorithm("http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),25);
    nodeList=document.getElementsByTagNameNS("http://www.w3.org/1999/XMLSchema","complexType");
    Assert.assertEquals(nodeList.getLength(),26);
    for (int i=0; i < nodeList.getLength(); i++) {
      String idAttrValue=((Element)nodeList.item(i)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
      if (i == 10) {
        Assert.assertSame(idAttrValue,"");
      }
 else {
        Assert.assertNotSame(idAttrValue,"");
        Assert.assertTrue(idAttrValue.length() > 0);
      }
    }
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierSubjectKeyOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_SkiKeyIdentifier);
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509SubjectKeyIdentifier']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierX509KeyOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_X509KeyIdentifier);
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierThumbprintOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_THUMBPRINT_IDENTIFIER);
    securityProperties.setCallbackHandler(new org.apache.wss4j.stax.test.CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/dsig:Signature/dsig:KeyInfo/wsse:SecurityTokenReference/wsse:KeyIdentifier[@ValueType='http://docs.oasis-open.org/wss/oasis-wss-soap-message-security-1.1#ThumbprintSHA1']");
    Node node=(Node)xPathExpression.evaluate(document,XPathConstants.NODE);
    Assert.assertNotNull(node);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureDefaultConfigurationOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_c14nExcl_InclusiveNamespaces.getNamespaceURI(),WSSConstants.TAG_c14nExcl_InclusiveNamespaces.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_PrefixList.getLocalPart()),"env");
    Assert.assertEquals(((Element)nodeList.item(1)).getAttributeNS(null,WSSConstants.ATT_NULL_PrefixList.getLocalPart()),"");
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-11 type-15 type-7 type-5 type-9 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignaturePartsOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.addSignaturePart(new SecurePart(new QName("http://www.w3.org/1999/XMLSchema","complexType"),SecurePart.Modifier.Element));
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),25);
    nodeList=document.getElementsByTagNameNS("http://www.w3.org/1999/XMLSchema","complexType");
    Assert.assertEquals(nodeList.getLength(),26);
    for (int i=0; i < nodeList.getLength(); i++) {
      String idAttrValue=((Element)nodeList.item(i)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
      if (i == 10) {
        Assert.assertSame(idAttrValue,"");
      }
 else {
        Assert.assertNotSame(idAttrValue,"");
        Assert.assertTrue(idAttrValue.length() > 0);
      }
    }
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSignatureUsePKIPathInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.USE_SINGLE_CERTIFICATE,"false");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureRSAKeyValue() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_KeyValue);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_RSAKeyValue.getNamespaceURI(),WSSConstants.TAG_dsig_RSAKeyValue.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.addIgnoreBSPRule(BSPRule.R5421);
    securityProperties.addIgnoreBSPRule(BSPRule.R5417);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.KeyValueToken,WSSecurityEventConstants.SignatureValue,WSSecurityEventConstants.SIGNED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    securityEventListener.compare();
    SignedPartSecurityEvent signedPartSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SIGNED_PART);
    SignatureValueSecurityEvent signatureValueSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.SignatureValue);
    OperationSecurityEvent operationSecurityEvent=securityEventListener.getSecurityEvent(WSSecurityEventConstants.OPERATION);
    String signedElementCorrelationID=signedPartSecurityEvent.getCorrelationID();
    String signatureValueCorrelationID=signatureValueSecurityEvent.getCorrelationID();
    String operationCorrelationID=operationSecurityEvent.getCorrelationID();
    List<SecurityEvent> operationSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> signedElementSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> signatureValueSecurityEvents=new ArrayList<SecurityEvent>();
    List<SecurityEvent> securityEvents=securityEventListener.getReceivedSecurityEvents();
    for (int i=0; i < securityEvents.size(); i++) {
      SecurityEvent securityEvent=securityEvents.get(i);
      if (securityEvent.getCorrelationID().equals(signedElementCorrelationID)) {
        signedElementSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(signatureValueCorrelationID)) {
        signatureValueSecurityEvents.add(securityEvent);
      }
 else       if (securityEvent.getCorrelationID().equals(operationCorrelationID)) {
        operationSecurityEvents.add(securityEvent);
      }
    }
    Assert.assertEquals(3,signedElementSecurityEvents.size());
    Assert.assertEquals(4,signatureValueSecurityEvents.size());
    Assert.assertEquals(securityEventListener.getReceivedSecurityEvents().size(),operationSecurityEvents.size() + signedElementSecurityEvents.size() + signatureValueSecurityEvents.size());
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignaturePropertiesOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    Map<String,Object> config=new HashMap<String,Object>();
    config.put(ConfigurationConstants.ACTION,ConfigurationConstants.SIGNATURE);
    config.put(ConfigurationConstants.SIGNATURE_USER,"transmitter");
    config.put(ConfigurationConstants.PW_CALLBACK_REF,new CallbackHandlerImpl());
    config.put(ConfigurationConstants.SIG_PROP_FILE,"transmitter-crypto.properties");
    WSSSecurityProperties securityProperties=ConfigurationConverter.convert(config);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_c14nExcl_InclusiveNamespaces.getNamespaceURI(),WSSConstants.TAG_c14nExcl_InclusiveNamespaces.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_PrefixList.getLocalPart()),"env");
    Assert.assertEquals(((Element)nodeList.item(1)).getAttributeNS(null,WSSConstants.ATT_NULL_PrefixList.getLocalPart()),"");
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureKeyIdentifierBinarySecurityTokenDirectReferenceInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.SIG_KEY_ID,"DirectReference");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/wsse:BinarySecurityToken");
    Node node=(Node)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
    Assert.assertNotNull(node);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testElementToSignNotFound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setTokenUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_WSSE10,"UsernameToken"),SecurePart.Modifier.Element));
    securityProperties.addSignaturePart(new SecurePart(new QName(WSSConstants.NS_SOAP11,"Body"),SecurePart.Modifier.Element));
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    try {
      XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
      xmlStreamWriter.close();
      Assert.fail("Exception expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof XMLSecurityException);
      Assert.assertEquals("Part to sign not found: {http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}UsernameToken",e.getCause().getMessage());
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignatureCryptoPropertiesOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SIGNATURE);
    securityProperties.setActions(actions);
    Properties properties=CryptoFactory.getProperties("transmitter-crypto.properties",this.getClass().getClassLoader());
    securityProperties.setSignatureCryptoProperties(properties);
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_c14nExcl_InclusiveNamespaces.getNamespaceURI(),WSSConstants.TAG_c14nExcl_InclusiveNamespaces.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_PrefixList.getLocalPart()),"env");
    Assert.assertEquals(((Element)nodeList.item(1)).getAttributeNS(null,WSSConstants.ATT_NULL_PrefixList.getLocalPart()),"");
  }
{
    String action=WSHandlerConstants.SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.TimestampTest </h4><pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testTimestampNoExpiresDateInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    for (int i=0; i < nodeList.item(0).getChildNodes().getLength(); i++) {
      Node node=nodeList.item(0).getChildNodes().item(i);
      if (node.getNodeType() == Node.ELEMENT_NODE && node.getLocalName().equals("Expires")) {
        node.getParentNode().removeChild(node);
      }
    }
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimestampInvalidNoExpiresDateInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    for (int i=0; i < nodeList.item(0).getChildNodes().getLength(); i++) {
      Node node=nodeList.item(0).getChildNodes().item(i);
      if (node.getNodeType() == Node.ELEMENT_NODE && node.getLocalName().equals("Expires")) {
        node.getParentNode().removeChild(node);
      }
    }
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setRequireTimestampExpires(true);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      fail("Failure expected on no Expires Element");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    }
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimestampTTLOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.TIMESTAMP);
    securityProperties.setActions(actions);
    securityProperties.setTimestampTTL(3600);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    Element created=(Element)((Element)nodeList.item(0)).getElementsByTagNameNS(WSSConstants.TAG_WSU_CREATED.getNamespaceURI(),WSSConstants.TAG_WSU_CREATED.getLocalPart()).item(0);
    Element expires=(Element)((Element)nodeList.item(0)).getElementsByTagNameNS(WSSConstants.TAG_WSU_EXPIRES.getNamespaceURI(),WSSConstants.TAG_WSU_EXPIRES.getLocalPart()).item(0);
    DatatypeFactory datatypeFactory=DatatypeFactory.newInstance();
    GregorianCalendar gregorianCalendarCreated=datatypeFactory.newXMLGregorianCalendar(created.getTextContent()).toGregorianCalendar();
    GregorianCalendar gregorianCalendarExpires=datatypeFactory.newXMLGregorianCalendar(expires.getTextContent()).toGregorianCalendar();
    Assert.assertTrue(gregorianCalendarCreated.before(gregorianCalendarExpires));
    GregorianCalendar now=new GregorianCalendar();
    Assert.assertFalse(now.before(gregorianCalendarCreated));
    Assert.assertTrue(now.before(gregorianCalendarExpires));
    gregorianCalendarCreated.add(Calendar.SECOND,3601);
    Assert.assertTrue(gregorianCalendarCreated.after(gregorianCalendarExpires));
  }
{
    String action=WSHandlerConstants.TIMESTAMP;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimestampNoChildsInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    List<Node> nodesToRemove=new ArrayList<Node>();
    for (int i=0; i < nodeList.item(0).getChildNodes().getLength(); i++) {
      Node node=nodeList.item(0).getChildNodes().item(i);
      if (node.getNodeType() == Node.ELEMENT_NODE && (node.getLocalName().equals("Created")) || node.getLocalName().equals("Expires")) {
        nodesToRemove.add(node);
      }
    }
    for (int i=0; i < nodesToRemove.size(); i++) {
      Node node=nodesToRemove.get(i);
      node.getParentNode().removeChild(node);
    }
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.addIgnoreBSPRule(BSPRule.R3203);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Throwable throwable=e.getCause();
      Assert.assertNotNull(throwable);
      Assert.assertTrue(throwable instanceof WSSecurityException);
      Assert.assertEquals(((WSSecurityException)throwable).getFaultCode(),WSSecurityException.INVALID_SECURITY);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimestampInFutureInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP;
    Properties outboundProperties=new Properties();
    outboundProperties.setProperty(WSHandlerConstants.TTL_TIMESTAMP,"1");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,outboundProperties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    Element created=(Element)((Element)nodeList.item(0)).getElementsByTagNameNS(WSSConstants.TAG_WSU_CREATED.getNamespaceURI(),WSSConstants.TAG_WSU_CREATED.getLocalPart()).item(0);
    Element expires=(Element)((Element)nodeList.item(0)).getElementsByTagNameNS(WSSConstants.TAG_WSU_EXPIRES.getNamespaceURI(),WSSConstants.TAG_WSU_EXPIRES.getLocalPart()).item(0);
    DatatypeFactory datatypeFactory=DatatypeFactory.newInstance();
    GregorianCalendar gregorianCalendarCreated=new GregorianCalendar();
    gregorianCalendarCreated.add(Calendar.HOUR,2);
    XMLGregorianCalendar xmlGregorianCalendarCreated=datatypeFactory.newXMLGregorianCalendar(gregorianCalendarCreated);
    created.setTextContent(xmlGregorianCalendarCreated.toXMLFormat());
    GregorianCalendar gregorianCalendarExpires=new GregorianCalendar();
    gregorianCalendarExpires.add(Calendar.HOUR,2);
    gregorianCalendarExpires.add(Calendar.SECOND,300);
    XMLGregorianCalendar xmlGregorianCalendarExpires=datatypeFactory.newXMLGregorianCalendar(gregorianCalendarExpires);
    expires.setTextContent(xmlGregorianCalendarExpires.toXMLFormat());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
      Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.MESSAGE_EXPIRED);
    }
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setTimeStampFutureTTL(2 * 60 * 60 + 100);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDoubleTimestamp() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    Node parentNode=nodeList.item(0).getParentNode();
    Node node=nodeList.item(0).cloneNode(true);
    securedDocument.adoptNode(node);
    parentNode.appendChild(node);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Throwable throwable=e.getCause();
      Assert.assertNotNull(throwable);
      Assert.assertTrue(throwable instanceof WSSecurityException);
      Assert.assertEquals(((WSSecurityException)throwable).getFaultCode(),WSSecurityException.INVALID_SECURITY);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimestampDefaultConfigurationOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.TIMESTAMP);
    securityProperties.setActions(actions);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    Element created=(Element)((Element)nodeList.item(0)).getElementsByTagNameNS(WSSConstants.TAG_WSU_CREATED.getNamespaceURI(),WSSConstants.TAG_WSU_CREATED.getLocalPart()).item(0);
    Element expires=(Element)((Element)nodeList.item(0)).getElementsByTagNameNS(WSSConstants.TAG_WSU_EXPIRES.getNamespaceURI(),WSSConstants.TAG_WSU_EXPIRES.getLocalPart()).item(0);
    DatatypeFactory datatypeFactory=DatatypeFactory.newInstance();
    GregorianCalendar gregorianCalendarCreated=datatypeFactory.newXMLGregorianCalendar(created.getTextContent()).toGregorianCalendar();
    GregorianCalendar gregorianCalendarExpires=datatypeFactory.newXMLGregorianCalendar(expires.getTextContent()).toGregorianCalendar();
    Assert.assertTrue(gregorianCalendarCreated.before(gregorianCalendarExpires));
    GregorianCalendar now=new GregorianCalendar();
    Assert.assertFalse(now.before(gregorianCalendarCreated));
    Assert.assertTrue(now.before(gregorianCalendarExpires));
    gregorianCalendarCreated.add(Calendar.SECOND,301);
    Assert.assertTrue(gregorianCalendarCreated.after(gregorianCalendarExpires));
  }
{
    String action=WSHandlerConstants.TIMESTAMP;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimestampNoCreatedDateInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    for (int i=0; i < nodeList.item(0).getChildNodes().getLength(); i++) {
      Node node=nodeList.item(0).getChildNodes().item(i);
      if (node.getNodeType() == Node.ELEMENT_NODE && node.getLocalName().equals("Created")) {
        node.getParentNode().removeChild(node);
      }
    }
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.addIgnoreBSPRule(BSPRule.R3203);
    securityProperties.addIgnoreBSPRule(BSPRule.R3221);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Throwable throwable=e.getCause();
      Assert.assertNotNull(throwable);
      Assert.assertTrue(throwable instanceof WSSecurityException);
      Assert.assertEquals(((WSSecurityException)throwable).getFaultCode(),WSSecurityException.INVALID_SECURITY);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testTimestampInNearFutureInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP;
    Properties outboundProperties=new Properties();
    outboundProperties.setProperty(WSHandlerConstants.TTL_TIMESTAMP,"1");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,outboundProperties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    Element created=(Element)((Element)nodeList.item(0)).getElementsByTagNameNS(WSSConstants.TAG_WSU_CREATED.getNamespaceURI(),WSSConstants.TAG_WSU_CREATED.getLocalPart()).item(0);
    Element expires=(Element)((Element)nodeList.item(0)).getElementsByTagNameNS(WSSConstants.TAG_WSU_EXPIRES.getNamespaceURI(),WSSConstants.TAG_WSU_EXPIRES.getLocalPart()).item(0);
    DatatypeFactory datatypeFactory=DatatypeFactory.newInstance();
    GregorianCalendar gregorianCalendarCreated=new GregorianCalendar();
    gregorianCalendarCreated.add(Calendar.SECOND,40);
    XMLGregorianCalendar xmlGregorianCalendarCreated=datatypeFactory.newXMLGregorianCalendar(gregorianCalendarCreated);
    created.setTextContent(xmlGregorianCalendarCreated.toXMLFormat());
    GregorianCalendar gregorianCalendarExpires=new GregorianCalendar();
    gregorianCalendarExpires.add(Calendar.SECOND,300);
    XMLGregorianCalendar xmlGregorianCalendarExpires=datatypeFactory.newXMLGregorianCalendar(gregorianCalendarExpires);
    expires.setTextContent(xmlGregorianCalendarExpires.toXMLFormat());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testTimestampDefaultConfigurationInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testTimestampStrictOffInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP;
    Properties outboundProperties=new Properties();
    outboundProperties.setProperty(WSHandlerConstants.TTL_TIMESTAMP,"1");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,outboundProperties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
  Thread.sleep(1000);
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setStrictTimestampCheck(false);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimestampTTLInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP;
    Properties outboundProperties=new Properties();
    outboundProperties.setProperty(WSHandlerConstants.TTL_TIMESTAMP,"300");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,outboundProperties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
  Thread.sleep(1500);
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setTimestampTTL(1);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
      Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.MESSAGE_EXPIRED);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testTimestampPropertiesInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP;
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,new Properties());
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    Map<String,Object> config=new HashMap<String,Object>();
    config.put(ConfigurationConstants.ACTION,ConfigurationConstants.TIMESTAMP);
    WSSSecurityProperties securityProperties=ConfigurationConverter.convert(config);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimestampPropertiesOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    Map<String,Object> config=new HashMap<String,Object>();
    config.put(ConfigurationConstants.ACTION,ConfigurationConstants.TIMESTAMP);
    WSSSecurityProperties securityProperties=ConfigurationConverter.convert(config);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    Element created=(Element)((Element)nodeList.item(0)).getElementsByTagNameNS(WSSConstants.TAG_WSU_CREATED.getNamespaceURI(),WSSConstants.TAG_WSU_CREATED.getLocalPart()).item(0);
    Element expires=(Element)((Element)nodeList.item(0)).getElementsByTagNameNS(WSSConstants.TAG_WSU_EXPIRES.getNamespaceURI(),WSSConstants.TAG_WSU_EXPIRES.getLocalPart()).item(0);
    DatatypeFactory datatypeFactory=DatatypeFactory.newInstance();
    GregorianCalendar gregorianCalendarCreated=datatypeFactory.newXMLGregorianCalendar(created.getTextContent()).toGregorianCalendar();
    GregorianCalendar gregorianCalendarExpires=datatypeFactory.newXMLGregorianCalendar(expires.getTextContent()).toGregorianCalendar();
    Assert.assertTrue(gregorianCalendarCreated.before(gregorianCalendarExpires));
    GregorianCalendar now=new GregorianCalendar();
    Assert.assertFalse(now.before(gregorianCalendarCreated));
    Assert.assertTrue(now.before(gregorianCalendarExpires));
    gregorianCalendarCreated.add(Calendar.SECOND,301);
    Assert.assertTrue(gregorianCalendarCreated.after(gregorianCalendarExpires));
  }
{
    String action=WSHandlerConstants.TIMESTAMP;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimestampExpiredEncryptedInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.ENCRYPT;
    Properties outboundProperties=new Properties();
    outboundProperties.setProperty(WSHandlerConstants.TTL_TIMESTAMP,"1");
    outboundProperties.setProperty(WSHandlerConstants.ENCRYPTION_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,outboundProperties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_xenc_EncryptedKey.getNamespaceURI(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
  Thread.sleep(1500);
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
      Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.MESSAGE_EXPIRED);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTimestampExpiredInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP;
    Properties outboundProperties=new Properties();
    outboundProperties.setProperty(WSHandlerConstants.TTL_TIMESTAMP,"1");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,outboundProperties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSU_TIMESTAMP.getNamespaceURI(),WSSConstants.TAG_WSU_TIMESTAMP.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
  Thread.sleep(1500);
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
      Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.MESSAGE_EXPIRED);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.UsernameTokenTest </h4><pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testOutboundPW_NONE() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.USERNAMETOKEN);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setTokenUser("transmitter");
    securityProperties.setUsernameTokenPasswordType(WSSConstants.UsernameTokenPasswordType.PASSWORD_NONE);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_PASSWORD.getNamespaceURI(),WSSConstants.TAG_WSSE_PASSWORD.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
{
    String action=WSHandlerConstants.USERNAME_TOKEN;
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.ALLOW_USERNAMETOKEN_NOPASSWORD,"true");
    doInboundSecurityWithWSS4J_1(document,action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOutboundSign() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.USERNAMETOKEN_SIGNED);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setTokenUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_PASSWORD.getNamespaceURI(),WSSConstants.TAG_WSSE_PASSWORD.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.USERNAME_TOKEN_SIGNATURE;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing an "old" UsernameToken, i.e. one with a "Created" element that is
 * out of date
 */
@Test public void testOldUsernameToken() throws Exception {
  GregorianCalendar createdCalendar=new GregorianCalendar();
  createdCalendar.add(Calendar.SECOND,-301);
  XMLGregorianCalendar created=WSSConstants.datatypeFactory.newXMLGregorianCalendar(createdCalendar);
  String createdString=created.toXMLFormat();
  String digest=org.apache.wss4j.dom.message.token.UsernameToken.doPasswordDigest("Ex2YEKVvsa1qne1m6TM8XA==",createdString,"default");
  String req="<?xml version=\"1.0\" encoding=\"UTF_8\"?>" + "<env:Envelope xmlns:env=\"http://schemas.xmlsoap.org/soap/envelope/\">\n" + "    <env:Header>"+ "       <wsse:Security xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\" xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" env:mustUnderstand=\"1\">"+ "           <wsse:UsernameToken wsu:Id=\"UsernameToken-1\">"+ "               <wsse:Username>transmitter</wsse:Username>"+ "               <wsse:Password Type=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordDigest\">" + digest + "</wsse:Password>"+ "               <wsse:Nonce EncodingType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary\">Ex2YEKVvsa1qne1m6TM8XA==</wsse:Nonce>"+ "               <wsu:Created>"+ createdString+ "</wsu:Created>"+ "           </wsse:UsernameToken>"+ "       </wsse:Security>\n"+ "    </env:Header>\n"+ "    <env:Body>\n"+ "    </env:Body>\n"+ "</env:Envelope>";
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
  try {
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(req.getBytes())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.MESSAGE_EXPIRED);
  }
}

</code></pre>

<br>
<pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReusedNonce() throws Exception {
  XMLGregorianCalendar created=WSSConstants.datatypeFactory.newXMLGregorianCalendar(new GregorianCalendar());
  String createdString=created.toXMLFormat();
  String digest=org.apache.wss4j.dom.message.token.UsernameToken.doPasswordDigest("Ex2YESUvsa1qne1m6TM8XA==",createdString,"default");
  String req="<?xml version=\"1.0\" encoding=\"UTF_8\"?>" + "<env:Envelope xmlns:env=\"http://schemas.xmlsoap.org/soap/envelope/\">\n" + "    <env:Header>"+ "       <wsse:Security xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\" xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" env:mustUnderstand=\"1\">"+ "           <wsse:UsernameToken wsu:Id=\"UsernameToken-1\">"+ "               <wsse:Username>transmitter</wsse:Username>"+ "               <wsse:Password Type=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordDigest\">" + digest + "</wsse:Password>"+ "               <wsse:Nonce EncodingType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary\">Ex2YESUvsa1qne1m6TM8XA==</wsse:Nonce>"+ "               <wsu:Created>"+ createdString+ "</wsu:Created>"+ "           </wsse:UsernameToken>"+ "       </wsse:Security>\n"+ "    </env:Header>\n"+ "    <env:Body>\n"+ "    </env:Body>\n"+ "</env:Envelope>";
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
  XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(req.getBytes())));
  StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  try {
    xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(req.getBytes())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.FAILED_AUTHENTICATION);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testPropertiesInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.USERNAME_TOKEN;
    Properties properties=new Properties();
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_PASSWORD.getNamespaceURI(),WSSConstants.TAG_WSSE_PASSWORD.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_Type.getLocalPart()),WSSConstants.UsernameTokenPasswordType.PASSWORD_DIGEST.getNamespace());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    Map<String,Object> config=new HashMap<String,Object>();
    config.put(ConfigurationConstants.ACTION,ConfigurationConstants.USERNAME_TOKEN);
    config.put(ConfigurationConstants.PW_CALLBACK_REF,new CallbackHandlerImpl());
    WSSSecurityProperties securityProperties=ConfigurationConverter.convert(config);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.USERNAME_TOKEN,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    securityEventListener.compare();
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testInboundTextNonceCreated() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.USERNAME_TOKEN;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.PASSWORD_TYPE,WSConstants.PW_TEXT);
    properties.setProperty(WSHandlerConstants.ADD_USERNAMETOKEN_NONCE,"true");
    properties.setProperty(WSHandlerConstants.ADD_USERNAMETOKEN_CREATED,"true");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_PASSWORD.getNamespaceURI(),WSSConstants.TAG_WSSE_PASSWORD.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_Type.getLocalPart()),WSSConstants.UsernameTokenPasswordType.PASSWORD_TEXT.getNamespace());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This is a test for processing a UsernameToken where the "Created" element is in the future.
 * A UsernameToken that is 120 seconds in the future should be rejected by default.
 */
@Test public void testFutureCreated() throws Exception {
  GregorianCalendar createdCalendar=new GregorianCalendar();
  createdCalendar.add(Calendar.SECOND,120);
  XMLGregorianCalendar created=WSSConstants.datatypeFactory.newXMLGregorianCalendar(createdCalendar);
  String createdString=created.toXMLFormat();
  String digest=org.apache.wss4j.dom.message.token.UsernameToken.doPasswordDigest("Ex2YEKVvsa1Qne1m6TM8XA==",createdString,"default");
  String req="<?xml version=\"1.0\" encoding=\"UTF_8\"?>" + "<env:Envelope xmlns:env=\"http://schemas.xmlsoap.org/soap/envelope/\">\n" + "    <env:Header>"+ "       <wsse:Security xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\" xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\" env:mustUnderstand=\"1\">"+ "           <wsse:UsernameToken wsu:Id=\"UsernameToken-1\">"+ "               <wsse:Username>transmitter</wsse:Username>"+ "               <wsse:Password Type=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordDigest\">" + digest + "</wsse:Password>"+ "               <wsse:Nonce EncodingType=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary\">Ex2YEKVvsa1Qne1m6TM8XA==</wsse:Nonce>"+ "               <wsu:Created>"+ createdString+ "</wsu:Created>"+ "           </wsse:UsernameToken>"+ "       </wsse:Security>\n"+ "    </env:Header>\n"+ "    <env:Body>\n"+ "    </env:Body>\n"+ "</env:Envelope>";
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
  try {
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(req.getBytes())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.MESSAGE_EXPIRED);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testOutboundTextNonceCreated() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.USERNAMETOKEN);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setTokenUser("transmitter");
    securityProperties.setUsernameTokenPasswordType(WSSConstants.UsernameTokenPasswordType.PASSWORD_TEXT);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAddUsernameTokenNonce(true);
    securityProperties.setAddUsernameTokenCreated(true);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_PASSWORD.getNamespaceURI(),WSSConstants.TAG_WSSE_PASSWORD.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_Type.getLocalPart()),WSSConstants.UsernameTokenPasswordType.PASSWORD_TEXT.getNamespace());
  }
{
    String action=WSHandlerConstants.USERNAME_TOKEN;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDefaultConfigurationInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.USERNAME_TOKEN;
    Properties properties=new Properties();
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_PASSWORD.getNamespaceURI(),WSSConstants.TAG_WSSE_PASSWORD.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_Type.getLocalPart()),WSSConstants.UsernameTokenPasswordType.PASSWORD_DIGEST.getNamespace());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.USERNAME_TOKEN,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    securityEventListener.compare();
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDefaultConfigurationOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.USERNAMETOKEN);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setTokenUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_PASSWORD.getNamespaceURI(),WSSConstants.TAG_WSSE_PASSWORD.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_Type.getLocalPart()),WSSConstants.UsernameTokenPasswordType.PASSWORD_DIGEST.getNamespace());
  }
{
    String action=WSHandlerConstants.USERNAME_TOKEN;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWrongUsername() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.USERNAME_TOKEN;
    Properties properties=new Properties();
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl("wrongUsername"));
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertTrue(e.getCause() instanceof WSSecurityException);
      Assert.assertEquals(e.getCause().getMessage(),"The security token could not be authenticated or authorized");
      Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.FAILED_AUTHENTICATION);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testOutboundPW_TEXT() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.USERNAMETOKEN);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setTokenUser("transmitter");
    securityProperties.setUsernameTokenPasswordType(WSSConstants.UsernameTokenPasswordType.PASSWORD_TEXT);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_PASSWORD.getNamespaceURI(),WSSConstants.TAG_WSSE_PASSWORD.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_Type.getLocalPart()),WSSConstants.UsernameTokenPasswordType.PASSWORD_TEXT.getNamespace());
  }
{
    String action=WSHandlerConstants.USERNAME_TOKEN;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testPropertiesOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    Map<String,Object> config=new HashMap<String,Object>();
    config.put(ConfigurationConstants.ACTION,ConfigurationConstants.USERNAME_TOKEN);
    config.put(ConfigurationConstants.USER,"transmitter");
    config.put(ConfigurationConstants.PW_CALLBACK_REF,new CallbackHandlerImpl());
    WSSSecurityProperties securityProperties=ConfigurationConverter.convert(config);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_PASSWORD.getNamespaceURI(),WSSConstants.TAG_WSSE_PASSWORD.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_Type.getLocalPart()),WSSConstants.UsernameTokenPasswordType.PASSWORD_DIGEST.getNamespace());
  }
{
    String action=WSHandlerConstants.USERNAME_TOKEN;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testInboundSign() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.USERNAME_TOKEN_SIGNATURE;
    Properties properties=new Properties();
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_PASSWORD.getNamespaceURI(),WSSConstants.TAG_WSSE_PASSWORD.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setAllowUsernameTokenNoPassword(true);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInboundOutboundPW_NONE() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.USERNAMETOKEN);
    securityProperties.setActions(actions);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setTokenUser("transmitter");
    securityProperties.setUsernameTokenPasswordType(WSSConstants.UsernameTokenPasswordType.PASSWORD_NONE);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document securedDocument=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_PASSWORD.getNamespaceURI(),WSSConstants.TAG_WSSE_PASSWORD.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
  try {
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.FAILED_AUTHENTICATION);
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setAllowUsernameTokenNoPassword(true);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInboundPW_TEXT() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.USERNAME_TOKEN;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.PASSWORD_TYPE,WSConstants.PW_TEXT);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_USERNAME_TOKEN.getNamespaceURI(),WSSConstants.TAG_WSSE_USERNAME_TOKEN.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_WSSE_PASSWORD.getNamespaceURI(),WSSConstants.TAG_WSSE_PASSWORD.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,WSSConstants.ATT_NULL_Type.getLocalPart()),WSSConstants.UsernameTokenPasswordType.PASSWORD_TEXT.getNamespace());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setCallbackHandler(new CallbackHandlerImpl("username"));
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    SecurityEventListener securityEventListener=new SecurityEventListener(){
      @Override public void registerSecurityEvent(      SecurityEvent securityEvent) throws WSSecurityException {
        if (securityEvent instanceof UsernameTokenSecurityEvent) {
          UsernameTokenSecurityEvent usernameTokenSecurityEvent=(UsernameTokenSecurityEvent)securityEvent;
          if (!"username".equals(usernameTokenSecurityEvent.getSecurityToken().getPrincipal().getName())) {
            throw new WSSecurityException(WSSecurityException.ErrorCode.FAILURE,"empty",new Object[]{"Wrong username"});
          }
        }
      }
    }
;
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),new ArrayList<SecurityEvent>(),securityEventListener);
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.FAILED_AUTHENTICATION);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.VulnerabliltyVectorsTest </h4><pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test if the RSA 1.5 key transport algorithm will be rejected by default.
 * Standard key transport algorithm is RSA-OAEP
 */
@Test public void testDisallowRSA15Algorithm() throws Exception {
  WSSSecurityProperties outboundSecurityProperties=new WSSSecurityProperties();
  outboundSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outboundSecurityProperties.setEncryptionUser("receiver");
  outboundSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outboundSecurityProperties.setSignatureUser("transmitter");
  outboundSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outboundSecurityProperties.setEncryptionKeyTransportAlgorithm("http://www.w3.org/2001/04/xmlenc#rsa-1_5");
  List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outboundSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outboundSecurityProperties,sourceDocument);
  WSSSecurityProperties inboundsecurityProperties=new WSSSecurityProperties();
  inboundsecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inboundsecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inboundsecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inboundsecurityProperties.addIgnoreBSPRule(BSPRule.R5421);
  try {
    doInboundSecurity(inboundsecurityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.FAILED_CHECK);
  }
}

</code></pre>

<br>
<pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMaximumAllowedXMLStructureDepthInEncryptedContent() throws Exception {
  if (getJavaSpecificationVersion() >= 1.7) {
    System.out.println("testAllowMD5Algorithm skipped");
    return;
  }
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  int oldval=0;
  try {
    Init.init(WSSec.class.getClassLoader().getResource("wss/wss-config.xml").toURI(),WSSec.class);
    oldval=changeValueOfMaximumAllowedXMLStructureDepth(10);
    doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertEquals(e.getCause().getMessage(),"Maximum depth (10) of the XML structure reached. You can raise the maximum via the " + "\"MaximumAllowedXMLStructureDepth\" property in the configuration.");
  }
 finally {
    changeValueOfMaximumAllowedXMLStructureDepth(oldval);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMaximumAllowedReferencesPerManifest() throws Exception {
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://www.w3.org/1999/XMLSchema}complexType;{Element}{http://www.w3.org/1999/XMLSchema}simpleType;");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  try {
    doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests if the framework is vulnerable to recursive key references
 * @throws Exception
 */
@Test public void testRecursiveKeyReferencesDOS() throws Exception {
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  XPathExpression xPathExpression=getXPath("/soap:Envelope/soap:Header/wsse:Security/xenc:EncryptedKey");
  Element encryptedKeyElement=(Element)xPathExpression.evaluate(securedDocument,XPathConstants.NODE);
  encryptedKeyElement.removeAttribute("Id");
  encryptedKeyElement.setAttributeNS(null,"Id","G2");
  xPathExpression=getXPath(".//dsig:X509Data");
  Element keyIdentifierElement=(Element)xPathExpression.evaluate(encryptedKeyElement,XPathConstants.NODE);
  Element securityTokenReferenceElement=(Element)keyIdentifierElement.getParentNode();
  securityTokenReferenceElement.removeChild(keyIdentifierElement);
  Element referenceElement=securedDocument.createElementNS(WSSConstants.TAG_WSSE_REFERENCE.getNamespaceURI(),WSSConstants.TAG_WSSE_REFERENCE.getLocalPart());
  referenceElement.setAttributeNS(null,"URI","#G1");
  securityTokenReferenceElement.appendChild(referenceElement);
  Element clonedEncryptedElement=(Element)encryptedKeyElement.cloneNode(true);
  clonedEncryptedElement.removeAttribute("Id");
  clonedEncryptedElement.setAttributeNS(null,"Id","G1");
  xPathExpression=getXPath(".//wsse:Reference");
  Element newReferenceElement=(Element)xPathExpression.evaluate(clonedEncryptedElement,XPathConstants.NODE);
  newReferenceElement.removeAttribute("URI");
  newReferenceElement.setAttributeNS(null,"URI","#G2");
  Element securityHeaderNode=(Element)encryptedKeyElement.getParentNode();
  securityHeaderNode.insertBefore(clonedEncryptedElement,encryptedKeyElement);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  try {
    doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Throwable throwable=e.getCause();
    Assert.assertNotNull(throwable);
    Assert.assertEquals(throwable.getMessage(),"Recursive key reference detected.");
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testModifiedEncryptedKeyCipherValue() throws Exception {
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  NodeList cipherValues=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_xenc_CipherValue.getNamespaceURI(),WSSConstants.TAG_xenc_CipherValue.getLocalPart());
  Element cipherValueElement=(Element)cipherValues.item(0);
  Assert.assertEquals(cipherValueElement.getParentNode().getParentNode().getLocalName(),WSSConstants.TAG_xenc_EncryptedKey.getLocalPart());
  String cipherValue=cipherValueElement.getTextContent();
  StringBuilder stringBuilder=new StringBuilder(cipherValue);
  int index=stringBuilder.length() / 2;
  char ch=stringBuilder.charAt(index);
  if (ch != 'A') {
    ch='A';
  }
 else {
    ch='B';
  }
  stringBuilder.setCharAt(index,ch);
  cipherValueElement.setTextContent(stringBuilder.toString());
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties inboundsecurityProperties=new WSSSecurityProperties();
  inboundsecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inboundsecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inboundsecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  try {
    doInboundSecurity(inboundsecurityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertFalse(e.getMessage().contains("data hash wrong"));
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDisallowMD5Algorithm() throws Exception {
  WSSSecurityProperties outboundSecurityProperties=new WSSSecurityProperties();
  outboundSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  outboundSecurityProperties.setEncryptionUser("receiver");
  outboundSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outboundSecurityProperties.setSignatureUser("transmitter");
  outboundSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
  outboundSecurityProperties.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#rsa-md5");
  List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
  actions.add(WSSConstants.TIMESTAMP);
  actions.add(WSSConstants.SIGNATURE);
  actions.add(WSSConstants.ENCRYPT);
  outboundSecurityProperties.setActions(actions);
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  ByteArrayOutputStream baos=doOutboundSecurity(outboundSecurityProperties,sourceDocument);
  WSSSecurityProperties inboundsecurityProperties=new WSSSecurityProperties();
  inboundsecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
  inboundsecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inboundsecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  inboundsecurityProperties.addIgnoreBSPRule(BSPRule.R5421);
  try {
    doInboundSecurity(inboundsecurityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.FAILED_CHECK);
  }
}

</code></pre>

<br>
<pre class="type-8 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMaximumAllowedXMLStructureDepth() throws Exception {
  if (getJavaSpecificationVersion() >= 1.7) {
    System.out.println("testAllowMD5Algorithm skipped");
    return;
  }
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  int oldval=0;
  try {
    Init.init(WSSec.class.getClassLoader().getResource("wss/wss-config.xml").toURI(),WSSec.class);
    oldval=changeValueOfMaximumAllowedXMLStructureDepth(10);
    doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertEquals(e.getCause().getMessage(),"Maximum depth (10) of the XML structure reached. You can raise the maximum via the " + "\"MaximumAllowedXMLStructureDepth\" property in the configuration.");
  }
 finally {
    changeValueOfMaximumAllowedXMLStructureDepth(oldval);
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMaximumAllowedTransformsPerReference() throws Exception {
  if (getJavaSpecificationVersion() > 1.7) {
    System.out.println("testMaximumAllowedTransformsPerReference skipped");
    return;
  }
  InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
  String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE+ " "+ WSHandlerConstants.ENCRYPT;
  Properties properties=new Properties();
  properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
  Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  WSSSecurityProperties securityProperties=new WSSSecurityProperties();
  securityProperties.setCallbackHandler(new CallbackHandlerImpl());
  securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
  int oldval=0;
  try {
    Init.init(WSSec.class.getClassLoader().getResource("wss/wss-config.xml").toURI(),WSSec.class);
    oldval=changeValueOfMaximumAllowedTransformsPerReference(0);
    doInboundSecurity(securityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof WSSecurityException);
    Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.INVALID_SECURITY);
  }
 finally {
    changeValueOfMaximumAllowedTransformsPerReference(oldval);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReplayAttackInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.TIMESTAMP + " " + WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    try {
      xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("Expected XMLStreamException");
    }
 catch (    XMLStreamException e) {
      Assert.assertEquals(((WSSecurityException)e.getCause()).getFaultCode(),WSSecurityException.MESSAGE_EXPIRED);
    }
  }
}

</code></pre>

<br>
<pre class="type-8 type-7 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test @SuppressWarnings("unchecked") public void testMaximumAllowedDecompressedBytes() throws Exception {
  long oldval=0;
  try {
    Init.init(WSSec.class.getClassLoader().getResource("wss/wss-config.xml").toURI(),WSSec.class);
    Field algorithmsClassMapField=TransformerAlgorithmMapper.class.getDeclaredField("algorithmsClassMapOut");
    algorithmsClassMapField.setAccessible(true);
    Map<String,Class<?>> map=(Map<String,Class<?>>)algorithmsClassMapField.get(null);
    map.put("http://www.apache.org/2012/04/xmlsec/xz",XZCompressorOutputStream.class);
    algorithmsClassMapField=TransformerAlgorithmMapper.class.getDeclaredField("algorithmsClassMapIn");
    algorithmsClassMapField.setAccessible(true);
    map=(Map<String,Class<?>>)algorithmsClassMapField.get(null);
    map.put("http://www.apache.org/2012/04/xmlsec/xz",XZCompressorInputStream.class);
    oldval=changeValueOfMaximumAllowedDecompressedBytes(101L);
    WSSSecurityProperties outboundSecurityProperties=new WSSSecurityProperties();
    outboundSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
    outboundSecurityProperties.setEncryptionUser("receiver");
    outboundSecurityProperties.loadEncryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    outboundSecurityProperties.setSignatureUser("transmitter");
    outboundSecurityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.TIMESTAMP);
    actions.add(WSSConstants.SIGNATURE);
    actions.add(WSSConstants.ENCRYPT);
    outboundSecurityProperties.setActions(actions);
    outboundSecurityProperties.setEncryptionCompressionAlgorithm("http://www.apache.org/2012/04/xmlsec/xz");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    ByteArrayOutputStream baos=doOutboundSecurity(outboundSecurityProperties,sourceDocument);
    WSSSecurityProperties inboundSecurityProperties=new WSSSecurityProperties();
    inboundSecurityProperties.setCallbackHandler(new CallbackHandlerImpl());
    inboundSecurityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    inboundSecurityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    doInboundSecurity(inboundSecurityProperties,xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Assert.fail("Expected XMLStreamException");
  }
 catch (  XMLStreamException e) {
    Assert.assertTrue(e.getCause() instanceof IOException);
    Assert.assertEquals(e.getCause().getMessage(),"Maximum byte count (101) reached.");
  }
 finally {
    changeValueOfMaximumAllowedDecompressedBytes(oldval);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.XOPAttachmentTest </h4><pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEncryptedSOAPBody() throws Exception {
  Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
  List<Attachment> attachments=createEncryptedBodyInAttachment(doc);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
  transformer.transform(new DOMSource(doc),new StreamResult(baos));
  AttachmentCallbackHandler attachmentCallbackHandler=new AttachmentCallbackHandler(attachments);
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    securityProperties.setAttachmentCallbackHandler(attachmentCallbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList sigReferences=document.getElementsByTagNameNS(WSConstants.SIG_NS,"Reference");
    Assert.assertEquals(2,sigReferences.getLength());
  }
  Assert.assertFalse(attachmentCallbackHandler.getResponseAttachments().isEmpty());
  Attachment responseAttachment=attachmentCallbackHandler.getResponseAttachments().get(0);
  byte[] attachmentBytes=readInputStream(responseAttachment.getSourceStream());
  Assert.assertTrue(Arrays.equals(attachmentBytes,SOAPUtil.SAMPLE_SOAP_MSG.getBytes(StandardCharsets.UTF_8)));
  Assert.assertEquals("text/xml",responseAttachment.getMimeType());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.saml.SAMLTokenHOKTest </h4><pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1AuthnAssertionOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_SIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    securityProperties.setSamlCallbackHandler(callbackHandler);
    KeyStore keyStore=KeyStore.getInstance("jks");
    keyStore.load(this.getClass().getClassLoader().getResourceAsStream("transmitter.jks"),"default".toCharArray());
    Merlin crypto=new Merlin();
    crypto.setKeyStore(keyStore);
    CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
    cryptoType.setAlias("transmitter");
    callbackHandler.setCerts(crypto.getX509Certificates(cryptoType));
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS("urn:oasis:names:tc:SAML:1.0:assertion","AuthenticationStatement");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS("urn:oasis:names:tc:SAML:1.0:assertion","ConfirmationMethod");
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getTextContent().trim(),"urn:oasis:names:tc:SAML:1.0:cm:holder-of-key");
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAMLAssertionHOKTransportSecurityInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Element messageSig=(Element)nodeList.item(1);
    messageSig.getParentNode().removeChild(messageSig);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSamlCallbackHandler(new SAMLCallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    HttpsTokenSecurityEvent httpsTokenSecurityEvent=new HttpsTokenSecurityEvent();
    httpsTokenSecurityEvent.setAuthenticationType(HttpsTokenSecurityEvent.AuthenticationType.HttpsClientCertificateAuthentication);
    CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
    cryptoType.setAlias("transmitter");
    HttpsSecurityToken httpsSecurityToken=new HttpsSecurityTokenImpl(securityProperties.getSignatureVerificationCrypto().getX509Certificates(cryptoType)[0]);
    httpsTokenSecurityEvent.setSecurityToken(httpsSecurityToken);
    List<SecurityEvent> requestSecurityEvents=new ArrayList<SecurityEvent>();
    requestSecurityEvents.add(httpsTokenSecurityEvent);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),requestSecurityEvents);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1AuthnAssertionKeyValueOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_SIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
    callbackHandler.setCertIdentifier(KeyInfoBean.CERT_IDENTIFIER.KEY_VALUE);
    callbackHandler.setIssuer("www.example.com");
    securityProperties.setSamlCallbackHandler(callbackHandler);
    KeyStore keyStore=KeyStore.getInstance("jks");
    keyStore.load(this.getClass().getClassLoader().getResourceAsStream("transmitter.jks"),"default".toCharArray());
    Merlin crypto=new Merlin();
    crypto.setKeyStore(keyStore);
    CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
    cryptoType.setAlias("transmitter");
    callbackHandler.setCerts(crypto.getX509Certificates(cryptoType));
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_EMBEDDED_KEY_IDENTIFIER_REF);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS("http://www.w3.org/2000/09/xmldsig#","KeyValue");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS("http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd","KeyIdentifier");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS("urn:oasis:names:tc:SAML:1.0:assertion","AuthenticationStatement");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS("urn:oasis:names:tc:SAML:1.0:assertion","ConfirmationMethod");
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getTextContent().trim(),"urn:oasis:names:tc:SAML:1.0:cm:holder-of-key");
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML2AttrAssertionOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_SIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setSamlVersion(Version.SAML_20);
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.ATTR);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    securityProperties.setSamlCallbackHandler(callbackHandler);
    KeyStore keyStore=KeyStore.getInstance("jks");
    keyStore.load(this.getClass().getClassLoader().getResourceAsStream("transmitter.jks"),"default".toCharArray());
    Merlin crypto=new Merlin();
    crypto.setKeyStore(keyStore);
    CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
    cryptoType.setAlias("receiver");
    callbackHandler.setCerts(crypto.getX509Certificates(cryptoType));
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("receiver");
    securityProperties.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#hmac-sha256");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS("urn:oasis:names:tc:SAML:2.0:assertion","AttributeStatement");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS("urn:oasis:names:tc:SAML:2.0:assertion","SubjectConfirmation");
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,"Method"),"urn:oasis:names:tc:SAML:2.0:cm:holder-of-key");
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test @org.junit.Ignore public void testSAML1AttrAssertionInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.ATTR);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    SAMLCallback samlCallback=new SAMLCallback();
    SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
    SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
    Crypto crypto=CryptoFactory.getInstance("saml/saml-signed.properties");
    samlAssertion.signAssertion("transmitter","default",crypto,false);
    WSSecSAMLToken wsSign=new WSSecSAMLToken();
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    Document securedDocument=wsSign.build(doc,samlAssertion,secHeader);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS("urn:oasis:names:tc:SAML:1.0:assertion","AttributeStatement");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=securedDocument.getElementsByTagNameNS("urn:oasis:names:tc:SAML:1.0:assertion","ConfirmationMethod");
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getTextContent().trim(),"urn:oasis:names:tc:SAML:1.0:cm:holder-of-key");
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setValidateSamlSubjectConfirmation(false);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1AuthnAssertionInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS("urn:oasis:names:tc:SAML:1.0:assertion","AuthenticationStatement");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=securedDocument.getElementsByTagNameNS("urn:oasis:names:tc:SAML:1.0:assertion","ConfirmationMethod");
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getTextContent().trim(),"urn:oasis:names:tc:SAML:1.0:cm:holder-of-key");
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1AuthnAssertionIssuerSerialInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
    callbackHandler.setCertIdentifier(KeyInfoBean.CERT_IDENTIFIER.X509_ISSUER_SERIAL);
    callbackHandler.setIssuer("www.example.com");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.put(WSHandlerConstants.SIG_KEY_ID,"DirectReference");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS("http://www.w3.org/2000/09/xmldsig#","X509IssuerSerial");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=securedDocument.getElementsByTagNameNS("http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd","KeyIdentifier");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=securedDocument.getElementsByTagNameNS("urn:oasis:names:tc:SAML:1.0:assertion","AuthenticationStatement");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=securedDocument.getElementsByTagNameNS("urn:oasis:names:tc:SAML:1.0:assertion","ConfirmationMethod");
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getTextContent().trim(),"urn:oasis:names:tc:SAML:1.0:cm:holder-of-key");
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1AttrAssertionOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_SIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.ATTR);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    securityProperties.setSamlCallbackHandler(callbackHandler);
    KeyStore keyStore=KeyStore.getInstance("jks");
    keyStore.load(this.getClass().getClassLoader().getResourceAsStream("receiver.jks"),"default".toCharArray());
    Merlin crypto=new Merlin();
    crypto.setKeyStore(keyStore);
    CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
    cryptoType.setAlias("receiver");
    callbackHandler.setCerts(crypto.getX509Certificates(cryptoType));
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureAlgorithm("http://www.w3.org/2001/04/xmldsig-more#hmac-sha256");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS("urn:oasis:names:tc:SAML:1.0:assertion","AttributeStatement");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS("urn:oasis:names:tc:SAML:1.0:assertion","ConfirmationMethod");
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getTextContent().trim(),"urn:oasis:names:tc:SAML:1.0:cm:holder-of-key");
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML2AuthnOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_SIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setSamlVersion(Version.SAML_20);
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    securityProperties.setSamlCallbackHandler(callbackHandler);
    KeyStore keyStore=KeyStore.getInstance("jks");
    keyStore.load(this.getClass().getClassLoader().getResourceAsStream("transmitter.jks"),"default".toCharArray());
    Merlin crypto=new Merlin();
    crypto.setKeyStore(keyStore);
    CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
    cryptoType.setAlias("transmitter");
    callbackHandler.setCerts(crypto.getX509Certificates(cryptoType));
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML2AuthnAssertionInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML2_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML2_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test @org.junit.Ignore public void testSAML2AttrAssertionInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.ATTR);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    SAMLCallback samlCallback=new SAMLCallback();
    SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
    SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
    Crypto crypto=CryptoFactory.getInstance("saml/saml-signed.properties");
    samlAssertion.signAssertion("transmitter","default",crypto,false);
    WSSecSAMLToken wsSign=new WSSecSAMLToken();
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    Document securedDocument=wsSign.build(doc,samlAssertion,secHeader);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS("urn:oasis:names:tc:SAML:2.0:assertion","AttributeStatement");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=securedDocument.getElementsByTagNameNS("urn:oasis:names:tc:SAML:2.0:assertion","SubjectConfirmation");
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,"Method"),"urn:oasis:names:tc:SAML:2.0:cm:holder-of-key");
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setValidateSamlSubjectConfirmation(false);
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML2AuthnAssertionIssuerSerialOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_SIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setSamlVersion(Version.SAML_20);
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
    callbackHandler.setCertIdentifier(KeyInfoBean.CERT_IDENTIFIER.X509_ISSUER_SERIAL);
    callbackHandler.setIssuer("www.example.com");
    securityProperties.setSamlCallbackHandler(callbackHandler);
    KeyStore keyStore=KeyStore.getInstance("jks");
    keyStore.load(this.getClass().getClassLoader().getResourceAsStream("transmitter.jks"),"default".toCharArray());
    Merlin crypto=new Merlin();
    crypto.setKeyStore(keyStore);
    CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
    cryptoType.setAlias("transmitter");
    callbackHandler.setCerts(crypto.getX509Certificates(cryptoType));
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_EMBEDDED_KEY_IDENTIFIER_REF);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS("http://www.w3.org/2000/09/xmldsig#","X509IssuerSerial");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS("http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd","KeyIdentifier");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS("urn:oasis:names:tc:SAML:2.0:assertion","AuthnStatement");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS("urn:oasis:names:tc:SAML:2.0:assertion","SubjectConfirmation");
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,"Method"),"urn:oasis:names:tc:SAML:2.0:cm:holder-of-key");
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1AuthnAssertionKeyValueInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
    callbackHandler.setCertIdentifier(KeyInfoBean.CERT_IDENTIFIER.KEY_VALUE);
    callbackHandler.setIssuer("www.example.com");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.put(WSHandlerConstants.SIG_KEY_ID,"DirectReference");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS("http://www.w3.org/2000/09/xmldsig#","KeyValue");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=securedDocument.getElementsByTagNameNS("http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd","KeyIdentifier");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=securedDocument.getElementsByTagNameNS("urn:oasis:names:tc:SAML:1.0:assertion","AuthenticationStatement");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=securedDocument.getElementsByTagNameNS("urn:oasis:names:tc:SAML:1.0:assertion","ConfirmationMethod");
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getTextContent().trim(),"urn:oasis:names:tc:SAML:1.0:cm:holder-of-key");
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1AuthnAssertionIssuerSerialOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_SIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
    callbackHandler.setCertIdentifier(KeyInfoBean.CERT_IDENTIFIER.X509_ISSUER_SERIAL);
    callbackHandler.setIssuer("www.example.com");
    securityProperties.setSamlCallbackHandler(callbackHandler);
    KeyStore keyStore=KeyStore.getInstance("jks");
    keyStore.load(this.getClass().getClassLoader().getResourceAsStream("transmitter.jks"),"default".toCharArray());
    Merlin crypto=new Merlin();
    crypto.setKeyStore(keyStore);
    CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
    cryptoType.setAlias("transmitter");
    callbackHandler.setCerts(crypto.getX509Certificates(cryptoType));
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_EMBEDDED_KEY_IDENTIFIER_REF);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS("http://www.w3.org/2000/09/xmldsig#","X509IssuerSerial");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS("http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd","KeyIdentifier");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS("urn:oasis:names:tc:SAML:1.0:assertion","AuthenticationStatement");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS("urn:oasis:names:tc:SAML:1.0:assertion","ConfirmationMethod");
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getTextContent().trim(),"urn:oasis:names:tc:SAML:1.0:cm:holder-of-key");
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML2AuthnAssertionIssuerSerialInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
    callbackHandler.setCertIdentifier(KeyInfoBean.CERT_IDENTIFIER.X509_ISSUER_SERIAL);
    callbackHandler.setIssuer("www.example.com");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.put(WSHandlerConstants.SIG_KEY_ID,"DirectReference");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS("http://www.w3.org/2000/09/xmldsig#","X509IssuerSerial");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=securedDocument.getElementsByTagNameNS("http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd","KeyIdentifier");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=securedDocument.getElementsByTagNameNS("urn:oasis:names:tc:SAML:2.0:assertion","AuthnStatement");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=securedDocument.getElementsByTagNameNS("urn:oasis:names:tc:SAML:2.0:assertion","SubjectConfirmation");
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,"Method"),"urn:oasis:names:tc:SAML:2.0:cm:holder-of-key");
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML2AuthnAssertionKeyValueOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_SIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setSamlVersion(Version.SAML_20);
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
    callbackHandler.setCertIdentifier(KeyInfoBean.CERT_IDENTIFIER.KEY_VALUE);
    callbackHandler.setIssuer("www.example.com");
    securityProperties.setSamlCallbackHandler(callbackHandler);
    KeyStore keyStore=KeyStore.getInstance("jks");
    keyStore.load(this.getClass().getClassLoader().getResourceAsStream("transmitter.jks"),"default".toCharArray());
    Merlin crypto=new Merlin();
    crypto.setKeyStore(keyStore);
    CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
    cryptoType.setAlias("transmitter");
    callbackHandler.setCerts(crypto.getX509Certificates(cryptoType));
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_EMBEDDED_KEY_IDENTIFIER_REF);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS("http://www.w3.org/2000/09/xmldsig#","KeyValue");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS("http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd","KeyIdentifier");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS("urn:oasis:names:tc:SAML:2.0:assertion","AuthnStatement");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=document.getElementsByTagNameNS("urn:oasis:names:tc:SAML:2.0:assertion","SubjectConfirmation");
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,"Method"),"urn:oasis:names:tc:SAML:2.0:cm:holder-of-key");
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML2AuthnAssertionKeyValueInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
    callbackHandler.setCertIdentifier(KeyInfoBean.CERT_IDENTIFIER.KEY_VALUE);
    callbackHandler.setIssuer("www.example.com");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.put(WSHandlerConstants.SIG_KEY_ID,"DirectReference");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS("http://www.w3.org/2000/09/xmldsig#","KeyValue");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=securedDocument.getElementsByTagNameNS("http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd","KeyIdentifier");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=securedDocument.getElementsByTagNameNS("urn:oasis:names:tc:SAML:2.0:assertion","AuthnStatement");
    Assert.assertEquals(nodeList.getLength(),1);
    nodeList=securedDocument.getElementsByTagNameNS("urn:oasis:names:tc:SAML:2.0:assertion","SubjectConfirmation");
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,"Method"),"urn:oasis:names:tc:SAML:2.0:cm:holder-of-key");
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.saml.SAMLTokenNegativeTest </h4><pre class="type-3 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML2SignedKeyHolderKeyModifiedInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    NodeList list=securedDocument.getElementsByTagNameNS(WSConstants.SAML2_NS,"Assertion");
    Element assertionElement=(Element)list.item(0);
    assertionElement.setAttributeNS(null,"MinorVersion","5");
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("XMLStreamException expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertNotNull(e.getCause().getCause());
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML1SignedKeyHolderSigModifiedInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIG_KEY_ID,"DirectReference");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Element envelope=securedDocument.getDocumentElement();
    NodeList list=envelope.getElementsByTagNameNS(WSConstants.SAML_NS,"Assertion");
    Element assertionElement=(Element)list.item(0);
    list=assertionElement.getElementsByTagNameNS(WSConstants.SIG_NS,"Signature");
    Element sigElement=(Element)list.item(0);
    list=sigElement.getElementsByTagNameNS(WSConstants.SIG_NS,"Transform");
    Element transformElement=(Element)list.item(0);
    transformElement.setAttributeNS(null,"Algorithm",WSConstants.C14N_EXCL_OMIT_COMMENTS);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("saml/issuer.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("XMLStreamException expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertNotNull(e.getCause().getCause());
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML2TrustFailureInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIG_KEY_ID,"DirectReference");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("XMLStreamException expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML2AuthnAssertionModifiedInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
    callbackHandler.setIssuer("www.example.com");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIG_KEY_ID,"DirectReference");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    NodeList list=securedDocument.getElementsByTagNameNS(WSConstants.SAML2_NS,"Assertion");
    Element assertionElement=(Element)list.item(0);
    assertionElement.setAttributeNS(null,"MinorVersion","5");
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("saml/issuer.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("XMLStreamException expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
      Assert.assertNotNull(e.getCause().getCause());
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHOKNotSignedInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("saml/issuer.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties,false,true);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      Assert.fail("XMLStreamException expected");
    }
 catch (    XMLStreamException e) {
      Assert.assertNotNull(e.getCause());
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.saml.SAMLTokenReferenceTest </h4><pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1SVKeyIdentifierOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_SIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_SENDER_VOUCHES);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    securityProperties.setSamlCallbackHandler(callbackHandler);
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_SkiKeyIdentifier);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS("http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd","KeyIdentifier");
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,"ValueType"),"http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.0#SAMLAssertionID");
    Assert.assertEquals(((Element)nodeList.item(1)).getAttributeNS(null,"ValueType"),"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509SubjectKeyIdentifier");
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1SVKeyIdentifierInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_SENDER_VOUCHES);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIG_KEY_ID,"X509KeyIdentifier");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS("http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd","KeyIdentifier");
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,"ValueType"),"http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.0#SAMLAssertionID");
    Assert.assertEquals(((Element)nodeList.item(1)).getAttributeNS(null,"ValueType"),"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3");
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SAML_TOKEN,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.SignatureValue,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.SIGNED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    securityEventListener.compare();
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML2HOKDirectReferenceInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    SAMLCallback samlCallback=new SAMLCallback();
    SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
    SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
    Crypto issuerCrypto=CryptoFactory.getInstance("saml/samlissuer.properties");
    samlAssertion.signAssertion("samlissuer","default",issuerCrypto,false);
    WSSecSignatureSAML wsSign=new WSSecSignatureSAML();
    wsSign.setUserInfo("transmitter","default");
    wsSign.setUseDirectReferenceToAssertion(true);
    wsSign.setKeyIdentifierType(WSConstants.BST_DIRECT_REFERENCE);
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    Crypto userCrypto=CryptoFactory.getInstance("transmitter-crypto.properties");
    Document securedDocument=wsSign.build(doc,userCrypto,samlAssertion,null,null,null,secHeader);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS("http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd","SecurityTokenReference");
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS("http://docs.oasis-open.org/wss/oasis-wss-wssecurity-secext-1.1.xsd","TokenType"),"http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV2.0");
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SAML_TOKEN,WSSecurityEventConstants.SignatureValue,WSSecurityEventConstants.SIGNED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    securityEventListener.compare();
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1HOKEKDirectReferenceInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
    cryptoType.setAlias("receiver");
    callbackHandler.setCerts(CryptoFactory.getInstance("transmitter-crypto.properties").getX509Certificates(cryptoType));
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    SAMLCallback samlCallback=new SAMLCallback();
    SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
    SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
    Crypto issuerCrypto=CryptoFactory.getInstance("saml/samlissuer.properties");
    samlAssertion.signAssertion("samlissuer","default",issuerCrypto,false);
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    Node assertionNode=samlAssertion.toDOM(doc);
    secHeader.insertSecurityHeader();
    secHeader.getSecurityHeader().appendChild(assertionNode);
    WSSecEncrypt builder=new WSSecEncrypt();
    builder.setUserInfo("receiver");
    builder.setSymmetricEncAlgorithm(WSConstants.TRIPLE_DES);
    builder.setKeyIdentifierType(WSConstants.CUSTOM_SYMM_SIGNING);
    builder.setCustomEKTokenValueType(WSConstants.WSS_SAML_KI_VALUE_TYPE);
    builder.setCustomEKTokenId(samlAssertion.getId());
    Crypto userCrypto=CryptoFactory.getInstance("receiver-crypto.properties");
    builder.prepare(doc,userCrypto);
    List<WSEncryptionPart> parts=new ArrayList<WSEncryptionPart>();
    WSEncryptionPart encP=new WSEncryptionPart("add","http://ws.apache.org/counter/counter_port_type","Element");
    parts.add(encP);
    Element refElement=builder.encryptForRef(null,parts);
    builder.addInternalRefElement(refElement);
    builder.appendToHeader(secHeader);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setValidateSamlSubjectConfirmation(false);
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    CallbackHandlerImpl callbackHandler=new CallbackHandlerImpl();
    securityProperties.setCallbackHandler(callbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SAML_TOKEN,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    securityEventListener.compare();
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1HOKKeyIdentifierInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS("http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd","KeyIdentifier");
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,"ValueType"),"http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.0#SAMLAssertionID");
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SAML_TOKEN,WSSecurityEventConstants.SignatureValue,WSSecurityEventConstants.SIGNED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    securityEventListener.compare();
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1HOKEKKeyIdentifierInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
    cryptoType.setAlias("receiver");
    callbackHandler.setCerts(CryptoFactory.getInstance("transmitter-crypto.properties").getX509Certificates(cryptoType));
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    SAMLCallback samlCallback=new SAMLCallback();
    SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
    SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
    Crypto issuerCrypto=CryptoFactory.getInstance("saml/samlissuer.properties");
    samlAssertion.signAssertion("samlissuer","default",issuerCrypto,false);
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    Node assertionNode=samlAssertion.toDOM(doc);
    secHeader.insertSecurityHeader();
    secHeader.getSecurityHeader().appendChild(assertionNode);
    WSSecEncrypt builder=new WSSecEncrypt();
    builder.setUserInfo("receiver");
    builder.setSymmetricEncAlgorithm(WSConstants.TRIPLE_DES);
    builder.setKeyIdentifierType(WSConstants.CUSTOM_KEY_IDENTIFIER);
    builder.setCustomEKTokenValueType(WSConstants.WSS_SAML_KI_VALUE_TYPE);
    builder.setCustomEKTokenId(samlAssertion.getId());
    Crypto userCrypto=CryptoFactory.getInstance("receiver-crypto.properties");
    builder.prepare(doc,userCrypto);
    List<WSEncryptionPart> parts=new ArrayList<WSEncryptionPart>();
    WSEncryptionPart encP=new WSEncryptionPart("add","http://ws.apache.org/counter/counter_port_type","Element");
    parts.add(encP);
    Element refElement=builder.encryptForRef(null,parts);
    builder.addInternalRefElement(refElement);
    builder.appendToHeader(secHeader);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setValidateSamlSubjectConfirmation(false);
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    CallbackHandlerImpl callbackHandler=new CallbackHandlerImpl();
    securityProperties.setCallbackHandler(callbackHandler);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SAML_TOKEN,WSSecurityEventConstants.EncryptedElement,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    securityEventListener.compare();
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML2HOKKeyIdentifierOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_SIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setSamlVersion(Version.SAML_20);
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    KeyStore keyStore=KeyStore.getInstance("jks");
    keyStore.load(this.getClass().getClassLoader().getResourceAsStream("transmitter.jks"),"default".toCharArray());
    Merlin crypto=new Merlin();
    crypto.setKeyStore(keyStore);
    CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
    cryptoType.setAlias("transmitter");
    callbackHandler.setCerts(crypto.getX509Certificates(cryptoType));
    securityProperties.setSamlCallbackHandler(callbackHandler);
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_EMBEDDED_KEY_IDENTIFIER_REF);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS("http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd","KeyIdentifier");
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,"ValueType"),"http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLID");
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML2HOKKeyIdentifierInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS("http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd","KeyIdentifier");
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,"ValueType"),"http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLID");
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SAML_TOKEN,WSSecurityEventConstants.SignatureValue,WSSecurityEventConstants.SIGNED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    securityEventListener.compare();
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1HOKKeyIdentifierOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_SIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    KeyStore keyStore=KeyStore.getInstance("jks");
    keyStore.load(this.getClass().getClassLoader().getResourceAsStream("transmitter.jks"),"default".toCharArray());
    Merlin crypto=new Merlin();
    crypto.setKeyStore(keyStore);
    CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
    cryptoType.setAlias("transmitter");
    callbackHandler.setCerts(crypto.getX509Certificates(cryptoType));
    securityProperties.setSamlCallbackHandler(callbackHandler);
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_EMBEDDED_KEY_IDENTIFIER_REF);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS("http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd","KeyIdentifier");
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,"ValueType"),"http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.0#SAMLAssertionID");
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML2SVKeyIdentifierOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_SIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setSamlVersion(Version.SAML_20);
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    KeyStore keyStore=KeyStore.getInstance("jks");
    keyStore.load(this.getClass().getClassLoader().getResourceAsStream("transmitter.jks"),"default".toCharArray());
    Merlin crypto=new Merlin();
    crypto.setKeyStore(keyStore);
    CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
    cryptoType.setAlias("transmitter");
    callbackHandler.setCerts(crypto.getX509Certificates(cryptoType));
    securityProperties.setSamlCallbackHandler(callbackHandler);
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_X509KeyIdentifier);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS("http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd","KeyIdentifier");
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,"ValueType"),"http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLID");
    Assert.assertEquals(((Element)nodeList.item(1)).getAttributeNS(null,"ValueType"),"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3");
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML2SVKeyIdentifierInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIG_KEY_ID,"X509KeyIdentifier");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS("http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd","KeyIdentifier");
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,"ValueType"),"http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLID");
    Assert.assertEquals(((Element)nodeList.item(1)).getAttributeNS(null,"ValueType"),"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3");
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] expectedSecurityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.SAML_TOKEN,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.SignatureValue,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.SIGNED_PART,WSSecurityEventConstants.OPERATION};
    final TestSecurityEventListener securityEventListener=new TestSecurityEventListener(expectedSecurityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,securityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    securityEventListener.compare();
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.saml.SAMLTokenSVTest </h4><pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1AuthnAssertionSignedInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_SENDER_VOUCHES);
    callbackHandler.setIssuer("www.example.com");
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIG_KEY_ID,"X509KeyIdentifier");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML2AuthnAssertionOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_SIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setSamlVersion(Version.SAML_20);
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    securityProperties.setSamlCallbackHandler(callbackHandler);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAMLAssertionSVTransportSecurityInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHZ);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setResource("http://resource.org");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new SAMLCallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    HttpsTokenSecurityEvent httpsTokenSecurityEvent=new HttpsTokenSecurityEvent();
    httpsTokenSecurityEvent.setAuthenticationType(HttpsTokenSecurityEvent.AuthenticationType.HttpsClientCertificateAuthentication);
    CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
    cryptoType.setAlias("transmitter");
    HttpsSecurityToken httpsSecurityToken=new HttpsSecurityTokenImpl(securityProperties.getSignatureVerificationCrypto().getX509Certificates(cryptoType)[0]);
    httpsTokenSecurityEvent.setSecurityToken(httpsSecurityToken);
    List<SecurityEvent> requestSecurityEvents=new ArrayList<SecurityEvent>();
    requestSecurityEvents.add(httpsTokenSecurityEvent);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),requestSecurityEvents);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML1AuthnAssertionOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_SIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_SENDER_VOUCHES);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    securityProperties.setSamlCallbackHandler(callbackHandler);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1AuthnAssertionInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_SENDER_VOUCHES);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIG_KEY_ID,"DirectReference");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML1AttrAssertionOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_SIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.ATTR);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_SENDER_VOUCHES);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    securityProperties.setSamlCallbackHandler(callbackHandler);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1AttrAssertionInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.ATTR);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_SENDER_VOUCHES);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIG_KEY_ID,"DirectReference");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML2AuthnAssertionInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIG_KEY_ID,"DirectReference");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML2AttrAssertionOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_SIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setSamlVersion(Version.SAML_20);
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.ATTR);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    securityProperties.setSamlCallbackHandler(callbackHandler);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KEYIDENTIFIER_SECURITY_TOKEN_DIRECT_REFERENCE);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSAML1AuthnAssertionSignedOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_SIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_SENDER_VOUCHES);
    callbackHandler.setIssuer("www.example.com");
    securityProperties.setSamlCallbackHandler(callbackHandler);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setSignatureKeyIdentifier(WSSecurityTokenConstants.KeyIdentifier_X509KeyIdentifier);
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Reference.getNamespaceURI(),WSSConstants.TAG_dsig_Reference.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),3);
    String referenceId=((Element)nodeList.item(1)).getAttributeNode(WSSConstants.ATT_NULL_URI.getLocalPart()).getValue();
    nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_WSSE_SECURITY_TOKEN_REFERENCE.getNamespaceURI(),WSSConstants.TAG_WSSE_SECURITY_TOKEN_REFERENCE.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    String tokenId=((Element)nodeList.item(0)).getAttributeNodeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart()).getValue();
    Assert.assertEquals(tokenId,WSSUtils.dropReferenceMarker(referenceId));
    nodeList=document.getElementsByTagNameNS(WSSConstants.NS_SOAP11,WSSConstants.TAG_SOAP_BODY_LN);
    Assert.assertEquals(nodeList.getLength(),1);
    String idAttrValue=((Element)nodeList.item(0)).getAttributeNS(WSSConstants.ATT_WSU_ID.getNamespaceURI(),WSSConstants.ATT_WSU_ID.getLocalPart());
    Assert.assertNotNull(idAttrValue);
    Assert.assertTrue(idAttrValue.length() > 0);
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML2AttrAssertionInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.ATTR);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIG_KEY_ID,"DirectReference");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.saml.SAMLTokenTest </h4><pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML2IssuerFormatOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_UNSIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    callbackHandler.setIssuerFormat("urn:oasis:names:tc:SAML:2.0:nameid-format:persistent");
    securityProperties.setSamlCallbackHandler(callbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
{
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 2 authentication assertion with
 * a user-specified SubjectLocality statement.
 */
@Test public void testSAML2SubjectLocalityOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_UNSIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    callbackHandler.setSamlVersion(Version.SAML_20);
    callbackHandler.setSubjectLocality(IP_ADDRESS,"test-dns");
    securityProperties.setSamlCallbackHandler(callbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
{
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1AuthnAssertionOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_UNSIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    securityProperties.setSamlCallbackHandler(callbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
{
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1AuthnAssertionPropertiesInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED + " " + WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{urn:oasis:names:tc:SAML:1.0:assertion}Assertion;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    Map<String,Object> config=new HashMap<String,Object>();
    config.put(ConfigurationConstants.ACTION,ConfigurationConstants.SAML_TOKEN_UNSIGNED);
    config.put(ConfigurationConstants.SIG_VER_PROP_FILE,"receiver-crypto.properties");
    WSSSecurityProperties securityProperties=ConfigurationConverter.convert(config);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML2AuthzAssertionInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHZ);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setResource("http://resource.org");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED + " " + WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{urn:oasis:names:tc:SAML:2.0:assertion}Assertion;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSamlCallbackHandler(new SAMLCallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML2AttrAssertionOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_UNSIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setSamlVersion(Version.SAML_20);
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.ATTR);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    securityProperties.setSamlCallbackHandler(callbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
{
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUnsignedBearer() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_BEARER);
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED + " " + WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{urn:oasis:names:tc:SAML:2.0:assertion}Assertion;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSamlCallbackHandler(new SAMLCallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      fail("Failure expected on an unsigned bearer token");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof XMLSecurityException);
    }
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSamlCallbackHandler(new SAMLCallbackHandlerImpl());
    SamlTokenValidatorImpl validator=new SamlTokenValidatorImpl();
    validator.setRequireBearerSignature(false);
    securityProperties.addValidator(WSSConstants.TAG_SAML2_ASSERTION,validator);
    securityProperties.addValidator(WSSConstants.TAG_SAML_ASSERTION,validator);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML2AuthnAssertionOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_UNSIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setSamlVersion(Version.SAML_20);
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    securityProperties.setSamlCallbackHandler(callbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
{
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 1.1 authentication assertion with
 * a user-specified SubjectLocality statement.
 */
@Test public void testSAML1SubjectLocalityOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_UNSIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    callbackHandler.setSubjectLocality(IP_ADDRESS,"test-dns");
    securityProperties.setSamlCallbackHandler(callbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
{
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1AttrAssertionInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.ATTR);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED + " " + WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{urn:oasis:names:tc:SAML:1.0:assertion}Assertion;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSamlCallbackHandler(new SAMLCallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1AttrAssertionOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_UNSIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.ATTR);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    securityProperties.setSamlCallbackHandler(callbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
{
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 2 attribute assertion. The attributeValue
 * has a custom XMLObject (not a String) value.
 */
@Test @SuppressWarnings("unchecked") public void testSAML2AttrAssertionCustomAttributeOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_UNSIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.ATTR);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    callbackHandler.setSamlVersion(Version.SAML_20);
    XMLObjectBuilderFactory builderFactory=XMLObjectProviderRegistrySupport.getBuilderFactory();
    SAMLObjectBuilder<Conditions> conditionsV2Builder=(SAMLObjectBuilder<Conditions>)builderFactory.getBuilder(Conditions.DEFAULT_ELEMENT_NAME);
    Conditions conditions=conditionsV2Builder.buildObject();
    DateTime newNotBefore=new DateTime();
    conditions.setNotBefore(newNotBefore);
    conditions.setNotOnOrAfter(newNotBefore.plusMinutes(5));
    XMLObjectBuilder<XSAny> xsAnyBuilder=(XMLObjectBuilder<XSAny>)builderFactory.getBuilder(XSAny.TYPE_NAME);
    XSAny attributeValue=xsAnyBuilder.buildObject(AttributeValue.DEFAULT_ELEMENT_NAME);
    attributeValue.getUnknownXMLObjects().add(conditions);
    List attributeValues=new ArrayList();
    attributeValues.add(attributeValue);
    callbackHandler.setCustomAttributeValues(attributeValues);
    securityProperties.setSamlCallbackHandler(callbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
{
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML2AuthnAssertionInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED + " " + WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{urn:oasis:names:tc:SAML:2.0:assertion}Assertion;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSamlCallbackHandler(new SAMLCallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testStandardSubjectConfirmationMethod() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setConfirmationMethod("urn:oasis:names:tc:SAML:2.0:cm:custom");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED + " " + WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{urn:oasis:names:tc:SAML:2.0:assertion}Assertion;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSamlCallbackHandler(new SAMLCallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      fail("Failure expected on an unknown subject confirmation method");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof XMLSecurityException);
    }
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSamlCallbackHandler(new SAMLCallbackHandlerImpl());
    SamlTokenValidatorImpl validator=new SamlTokenValidatorImpl();
    validator.setRequireStandardSubjectConfirmationMethod(false);
    securityProperties.addValidator(WSSConstants.TAG_SAML2_ASSERTION,validator);
    securityProperties.addValidator(WSSConstants.TAG_SAML_ASSERTION,validator);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1AuthnAssertionInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED + " " + WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{urn:oasis:names:tc:SAML:1.0:assertion}Assertion;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSamlCallbackHandler(new SAMLCallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1AuthnAssertionPropertiesOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    Map<String,Object> config=new HashMap<String,Object>();
    config.put(ConfigurationConstants.ACTION,ConfigurationConstants.SAML_TOKEN_UNSIGNED);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    config.put(ConfigurationConstants.SAML_CALLBACK_REF,callbackHandler);
    WSSSecurityProperties securityProperties=ConfigurationConverter.convert(config);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
{
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-8 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRequiredSubjectConfirmationMethod() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED + " " + WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{urn:oasis:names:tc:SAML:2.0:assertion}Assertion;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSamlCallbackHandler(new SAMLCallbackHandlerImpl());
    SamlTokenValidatorImpl validator=new SamlTokenValidatorImpl();
    validator.setRequiredSubjectConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
    securityProperties.addValidator(WSSConstants.TAG_SAML2_ASSERTION,validator);
    securityProperties.addValidator(WSSConstants.TAG_SAML_ASSERTION,validator);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
  baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML2Constants.CONF_BEARER);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED + " " + WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{urn:oasis:names:tc:SAML:2.0:assertion}Assertion;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSamlCallbackHandler(new SAMLCallbackHandlerImpl());
    SamlTokenValidatorImpl validator=new SamlTokenValidatorImpl();
    validator.setRequiredSubjectConfirmationMethod(SAML2Constants.CONF_SENDER_VOUCHES);
    securityProperties.addValidator(WSSConstants.TAG_SAML2_ASSERTION,validator);
    securityProperties.addValidator(WSSConstants.TAG_SAML_ASSERTION,validator);
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    try {
      StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
      fail("Failure expected on a Bearer assertion");
    }
 catch (    XMLStreamException e) {
      Assert.assertTrue(e.getCause() instanceof XMLSecurityException);
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1AuthzAssertionInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHZ);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setResource("http://resource.org");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED + " " + WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{urn:oasis:names:tc:SAML:1.0:assertion}Assertion;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSamlCallbackHandler(new SAMLCallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML2AttrAssertionInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.ATTR);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED + " " + WSHandlerConstants.SIGNATURE;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    properties.setProperty(WSHandlerConstants.SIGNATURE_PARTS,"{Element}{urn:oasis:names:tc:SAML:2.0:assertion}Assertion;{Element}{http://schemas.xmlsoap.org/soap/envelope/}Body;");
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.setSamlCallbackHandler(new SAMLCallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 2 authentication assertion with
 * a user-specified SubjectNameIDFormat.
 */
@Test public void testSAML2SubjectNameIDFormatOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_UNSIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setSamlVersion(Version.SAML_20);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    callbackHandler.setSubjectNameIDFormat(SAML1Constants.NAMEID_FORMAT_EMAIL_ADDRESS);
    securityProperties.setSamlCallbackHandler(callbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
{
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML2AuthzAssertionOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_UNSIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setSamlVersion(Version.SAML_20);
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHZ);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    callbackHandler.setResource("http://resource.org");
    securityProperties.setSamlCallbackHandler(callbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
{
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 1.1 authentication assertion with
 * a user-specified SubjectNameIDFormat.
 */
@Test public void testSAML1SubjectNameIDFormatOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_UNSIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    callbackHandler.setSubjectNameIDFormat(SAML1Constants.NAMEID_FORMAT_EMAIL_ADDRESS);
    securityProperties.setSamlCallbackHandler(callbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
{
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSAML1AuthzAssertionOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_UNSIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHZ);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setSignAssertion(false);
    callbackHandler.setResource("http://resource.org");
    securityProperties.setSamlCallbackHandler(callbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
{
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<pre class="type-3 type-7 type-5 type-1 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 2 authentication assertion, which
 * is encrypted in a saml2:EncryptedAssertion Element in the security header
 */
@Test public void testSAML2EncryptedAssertion() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  Crypto crypto=CryptoFactory.getInstance("wss40.properties");
{
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    SAML2CallbackHandler callbackHandler=new SAML2CallbackHandler();
    callbackHandler.setStatement(SAML2CallbackHandler.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    SAMLCallback samlCallback=new SAMLCallback();
    SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
    SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
    WSSecSAMLToken wsSign=new WSSecSAMLToken();
    Document doc=SOAPUtil.toSOAPPart(sourceDocument);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    wsSign.prepare(doc,samlAssertion);
    Element assertionElement=wsSign.getElement();
    Element encryptedAssertionElement=doc.createElementNS(WSConstants.SAML2_NS,WSConstants.ENCRYPED_ASSERTION_LN);
    encryptedAssertionElement.appendChild(assertionElement);
    secHeader.getSecurityHeader().appendChild(encryptedAssertionElement);
    KeyGenerator keygen=KeyGenerator.getInstance("AES");
    keygen.init(128);
    SecretKey secretKey=keygen.generateKey();
    CryptoType cryptoType=new CryptoType(CryptoType.TYPE.ALIAS);
    cryptoType.setAlias("wss40");
    X509Certificate[] certs=crypto.getX509Certificates(cryptoType);
    assertTrue(certs != null && certs.length > 0 && certs[0] != null);
    encryptElement(doc,assertionElement,WSConstants.AES_128,secretKey,WSConstants.KEYTRANSPORT_RSAOEP,certs[0],false);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(doc),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.setDecryptionCrypto(crypto);
    securityProperties.setCallbackHandler(new KeystoreCallbackHandler());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_SAML2_ASSERTION.getNamespaceURI(),WSSConstants.TAG_SAML2_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 1.1 authz assertion with
 * a Resource URI
 */
@Test public void testSAML1ResourceOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_UNSIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHZ);
    callbackHandler.setIssuer("www.example.com");
    callbackHandler.setResource("http://resource.org");
    callbackHandler.setSignAssertion(false);
    securityProperties.setSamlCallbackHandler(callbackHandler);
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),0);
  }
{
    String action=WSHandlerConstants.SAML_TOKEN_UNSIGNED;
    doInboundSecurityWithWSS4J(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.saml.SamlConditionsTest </h4><pre class="type-3 type-5 type-1 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 1.1 authentication assertion
 * with a custom Conditions statement.
 */
@Test public void testSAML1ConditionsInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_HOLDER_KEY);
    callbackHandler.setIssuer("www.example.com");
    ConditionsBean conditions=new ConditionsBean();
    DateTime notBefore=new DateTime();
    conditions.setNotBefore(notBefore);
    DateTime notAfter=notBefore.plusMinutes(20);
    conditions.setNotAfter(notAfter);
    callbackHandler.setConditions(conditions);
    InputStream sourceDocument=this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml");
    String action=WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    properties.put(WSHandlerConstants.SAML_CALLBACK_REF,callbackHandler);
    Document securedDocument=doOutboundSecurityWithWSS4J(sourceDocument,action,properties);
    NodeList nodeList=securedDocument.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=securedDocument.getElementsByTagNameNS("urn:oasis:names:tc:SAML:1.0:assertion","Conditions");
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,"NotBefore"),SAMLConfigurationSupport.getSAMLDateFormatter().print(notBefore));
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,"NotOnOrAfter"),SAMLConfigurationSupport.getSAMLDateFormatter().print(notAfter));
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())));
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    Assert.assertNotNull(document);
  }
}

</code></pre>

<br>
<pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test that creates, sends and processes an unsigned SAML 1.1 authentication assertion
 * with a custom Conditions statement.
 */
@Test public void testSAML1ConditionsOutbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    List<WSSConstants.Action> actions=new ArrayList<WSSConstants.Action>();
    actions.add(WSSConstants.SAML_TOKEN_SIGNED);
    securityProperties.setActions(actions);
    SAMLCallbackHandlerImpl callbackHandler=new SAMLCallbackHandlerImpl();
    callbackHandler.setStatement(SAMLCallbackHandlerImpl.Statement.AUTHN);
    callbackHandler.setIssuer("www.example.com");
    ConditionsBean conditions=new ConditionsBean();
    DateTime notBefore=new DateTime();
    conditions.setNotBefore(notBefore);
    DateTime notAfter=notBefore.plusMinutes(20);
    conditions.setNotAfter(notAfter);
    callbackHandler.setConditions(conditions);
    securityProperties.setSamlCallbackHandler(callbackHandler);
    securityProperties.loadSignatureKeyStore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setSignatureUser("transmitter");
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    OutboundWSSec wsSecOut=WSSec.getOutboundWSSec(securityProperties);
    XMLStreamWriter xmlStreamWriter=wsSecOut.processOutMessage(baos,StandardCharsets.UTF_8.name(),new ArrayList<SecurityEvent>());
    XMLStreamReader xmlStreamReader=xmlInputFactory.createXMLStreamReader(this.getClass().getClassLoader().getResourceAsStream("testdata/plain-soap-1.1.xml"));
    XmlReaderToWriter.writeAll(xmlStreamReader,xmlStreamWriter);
    xmlStreamWriter.close();
    Document document=documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray()));
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),2);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_SAML_ASSERTION.getLocalPart());
    Assert.assertEquals(nodeList.item(1).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    nodeList=document.getElementsByTagNameNS("urn:oasis:names:tc:SAML:1.0:assertion","Conditions");
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,"NotBefore"),SAMLConfigurationSupport.getSAMLDateFormatter().print(notBefore));
    Assert.assertEquals(((Element)nodeList.item(0)).getAttributeNS(null,"NotOnOrAfter"),SAMLConfigurationSupport.getSAMLDateFormatter().print(notAfter));
  }
{
    String action=WSHandlerConstants.SIGNATURE + " " + WSHandlerConstants.SAML_TOKEN_SIGNED;
    Properties properties=new Properties();
    doInboundSecurityWithWSS4J_1(documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(baos.toByteArray())),action,properties,false);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.wss4j.stax.test.saml.SamlTokenDerivedTest </h4><pre class="type-3 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test that creates, sends and processes a signed SAML 1.1 authentication assertion
 * using a derived key.
 */
@Test public void testSAML1AuthnAssertionDerivedInbound() throws Exception {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
{
    SAML1CallbackHandler callbackHandler=new SAML1CallbackHandler();
    callbackHandler.setStatement(SAML1CallbackHandler.Statement.AUTHN);
    callbackHandler.setConfirmationMethod(SAML1Constants.CONF_SENDER_VOUCHES);
    callbackHandler.setIssuer("www.example.com");
    SAMLCallback samlCallback=new SAMLCallback();
    SAMLUtil.doSAMLCallback(callbackHandler,samlCallback);
    SamlAssertionWrapper samlAssertion=new SamlAssertionWrapper(samlCallback);
    Document doc=SOAPUtil.toSOAPPart(SOAPUtil.SAMPLE_SOAP_MSG);
    WSSecHeader secHeader=new WSSecHeader(doc);
    secHeader.insertSecurityHeader();
    SecurityTokenReference secRefSaml=createSamlSTR(doc,samlAssertion,WSSConfig.getNewInstance());
    Element samlTokenElement=samlAssertion.toDOM(doc);
    Element secRefElement=secRefSaml.getElement();
    secHeader.getSecurityHeader().appendChild(samlTokenElement);
    secHeader.getSecurityHeader().appendChild(secRefElement);
    WSSecDKSign sigBuilder=createDKSign(doc,secRefSaml);
    Document securedDocument=sigBuilder.build(doc,secHeader);
    javax.xml.transform.Transformer transformer=TRANSFORMER_FACTORY.newTransformer();
    transformer.transform(new DOMSource(securedDocument),new StreamResult(baos));
  }
{
    WSSSecurityProperties securityProperties=new WSSSecurityProperties();
    securityProperties.loadSignatureVerificationKeystore(this.getClass().getClassLoader().getResource("receiver.jks"),"default".toCharArray());
    securityProperties.loadDecryptionKeystore(this.getClass().getClassLoader().getResource("transmitter.jks"),"default".toCharArray());
    securityProperties.setCallbackHandler(new CallbackHandlerImpl());
    InboundWSSec wsSecIn=WSSec.getInboundWSSec(securityProperties);
    WSSecurityEventConstants.Event[] securityEvents=new WSSecurityEventConstants.Event[]{WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.AlgorithmSuite,WSSecurityEventConstants.X509Token,WSSecurityEventConstants.SAML_TOKEN,WSSecurityEventConstants.SignatureValue,WSSecurityEventConstants.SignedElement,WSSecurityEventConstants.SIGNED_PART,WSSecurityEventConstants.OPERATION};
    TestSecurityEventListener testSecurityEventListener=new TestSecurityEventListener(securityEvents);
    XMLStreamReader xmlStreamReader=wsSecIn.processInMessage(xmlInputFactory.createXMLStreamReader(new ByteArrayInputStream(baos.toByteArray())),null,testSecurityEventListener);
    Document document=StAX2DOM.readDoc(documentBuilderFactory.newDocumentBuilder(),xmlStreamReader);
    NodeList nodeList=document.getElementsByTagNameNS(WSSConstants.TAG_dsig_Signature.getNamespaceURI(),WSSConstants.TAG_dsig_Signature.getLocalPart());
    Assert.assertEquals(nodeList.getLength(),1);
    Assert.assertEquals(nodeList.item(0).getParentNode().getLocalName(),WSSConstants.TAG_WSSE_SECURITY.getLocalPart());
    testSecurityEventListener.compare();
  }
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
