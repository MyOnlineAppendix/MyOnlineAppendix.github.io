<h3><span class=" glyphicon glyphicon-tag"/>&nbspAPIUtilityVerifier</h3><kbd>Verifies values of objects/variables related to API calls (Java or TPL) </kbd><br><br><br><h4 style="margin:0px">Class: org.apache.zookeeper.MultiResponseTest </h4><pre class="type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEmptyRoundTrip() throws IOException {
  MultiResponse result=new MultiResponse();
  MultiResponse decodedResult=codeDecode(result);
  Assert.assertEquals(result,decodedResult);
  Assert.assertEquals(result.hashCode(),decodedResult.hashCode());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.MultiTransactionRecordTest </h4><pre class="type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRoundTrip() throws IOException {
  MultiTransactionRecord request=new MultiTransactionRecord();
  request.add(Op.check("check",1));
  request.add(Op.create("create","create data".getBytes(),ZooDefs.Ids.CREATOR_ALL_ACL,ZooDefs.Perms.ALL));
  request.add(Op.delete("delete",17));
  request.add(Op.setData("setData","set data".getBytes(),19));
  MultiTransactionRecord decodedRequest=codeDecode(request);
  Assert.assertEquals(request,decodedRequest);
  Assert.assertEquals(request.hashCode(),decodedRequest.hashCode());
}

</code></pre>

<br>
<pre class="type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testEmptyRoundTrip() throws IOException {
  MultiTransactionRecord request=new MultiTransactionRecord();
  MultiTransactionRecord decodedRequest=codeDecode(request);
  Assert.assertEquals(request,decodedRequest);
  Assert.assertEquals(request.hashCode(),decodedRequest.hashCode());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.PortAssignmentTest </h4><pre class="type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSetupPortRange(){
  PortAssignment.PortRange portRange=PortAssignment.setupPortRange(strProcessCount,cmdLine);
  assertEquals(buildAssertionMessage("minimum"),expectedMinimumPort,portRange.getMinimum());
  assertEquals(buildAssertionMessage("maximum"),expectedMaximumPort,portRange.getMaximum());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.RemoveWatchesTest </h4><pre class="type-5 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies removal of multiple data watchers when there is server
 * connection
 */
@Test(timeout=90000) public void testMultipleDataWatchers() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  MyWatcher w1=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
  removeWatches(zk2,"/node1",w2,WatcherType.Data,false,Code.OK);
  Assert.assertEquals("Didn't find data watcher",1,zk2.getDataWatches().size());
  Assert.assertEquals("Didn't find data watcher","/node1",zk2.getDataWatches().get(0));
  removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove data watcher",w2.matches());
  if (zk1 != null) {
    zk1.close();
    zk1=null;
  }
  List<EventType> events=w2.getEventsAfterWatchRemoval();
  Assert.assertEquals("Shouldn't get NodeDeletedEvent after watch removal",0,events.size());
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Data - removes only the configured data watcher
 * function
 */
@Test(timeout=90000) public void testRemoveAllDataWatchesOnAPath() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  final CountDownLatch dWatchCount=new CountDownLatch(2);
  final CountDownLatch rmWatchCount=new CountDownLatch(2);
  Watcher w1=new Watcher(){
    @Override public void process(    WatchedEvent event){
switch (event.getType()) {
case DataWatchRemoved:
        rmWatchCount.countDown();
      break;
case NodeDataChanged:
    dWatchCount.countDown();
  break;
default :
break;
}
}
}
;
Watcher w2=new Watcher(){
@Override public void process(WatchedEvent event){
switch (event.getType()) {
case DataWatchRemoved:
rmWatchCount.countDown();
break;
case NodeDataChanged:
dWatchCount.countDown();
break;
default :
break;
}
}
}
;
LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
Assert.assertTrue("Server session is not a watcher",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Data));
removeAllWatches(zk2,"/node1",WatcherType.Data,false,Code.OK);
Assert.assertTrue("Didn't remove data watcher",rmWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
Assert.assertFalse("Server session is still a watcher after removal",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Data));
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies null watcher with WatcherType.Data - remove all data
 * watchers. Child watchers shouldn't be removed
 */
@Test(timeout=90000) public void testRemoveAllDataWatchers() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",1);
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w2);
  removeWatches(zk2,"/node1",w1,WatcherType.Data,false,Code.OK);
  removeWatches(zk2,"/node1",w2,WatcherType.Data,false,Code.OK);
  zk1.create("/node1/child",null,Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  Assert.assertTrue("Didn't remove data watcher",w1.matches());
  Assert.assertTrue("Didn't remove data watcher",w2.matches());
  int count=10;
  while (count > 0) {
    if (w1.getEventsAfterWatchRemoval().size() > 0 && w2.getEventsAfterWatchRemoval().size() > 0) {
      break;
    }
    count--;
    Thread.sleep(1000);
  }
  List<EventType> events=w1.getEventsAfterWatchRemoval();
  Assert.assertEquals("Didn't get NodeChildrenChanged event",1,events.size());
  Assert.assertTrue("Didn't get NodeChildrenChanged event",events.contains(EventType.NodeChildrenChanged));
  events=w2.getEventsAfterWatchRemoval();
  Assert.assertEquals("Didn't get NodeChildrenChanged event",1,events.size());
  Assert.assertTrue("Didn't get NodeChildrenChanged event",events.contains(EventType.NodeChildrenChanged));
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies removal of many watchers locally when no connection and
 * WatcherType#Any. Also, verifies internal watchManager datastructures
 */
@Test(timeout=90000) public void testManyWatchersWhenNoConnection() throws Exception {
  int count=3;
  List<MyWatcher> wList=new ArrayList<MyWatcher>(count);
  MyWatcher w;
  String path="/node";
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    zk1.create(nodePath,null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    nodePath+="/";
  }
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    w=new MyWatcher(path + i,2);
    wList.add(w);
    LOG.info("Adding child watcher {} on path {}",new Object[]{w,nodePath});
    zk1.getChildren(nodePath,w);
    nodePath+="/";
  }
  Assert.assertEquals("Failed to add watchers!",count,zk1.getChildWatches().size());
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    w=wList.get(i);
    LOG.info("Adding data watcher {} on path {}",new Object[]{w,nodePath});
    zk1.getData(nodePath,w,null);
    nodePath+="/";
  }
  Assert.assertEquals("Failed to add watchers!",count,zk1.getDataWatches().size());
  stopServer();
  for (int i=0; i < count; i++) {
    final MyWatcher watcher=wList.get(i);
    removeWatches(zk1,path + i,watcher,WatcherType.Any,true,Code.OK);
    Assert.assertTrue("Didn't remove watcher",watcher.matches());
  }
  Assert.assertEquals("Didn't remove watch references!",0,zk1.getChildWatches().size());
  Assert.assertEquals("Didn't remove watch references!",0,zk1.getDataWatches().size());
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies removal of single watcher when there is server connection
 */
@Test(timeout=90000) public void testRemoveSingleWatcher() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  zk1.create("/node2",null,Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  MyWatcher w1=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  MyWatcher w2=new MyWatcher("/node2",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node2",w2));
  removeWatches(zk2,"/node1",w1,WatcherType.Data,false,Code.OK);
  Assert.assertEquals("Didn't find data watcher",1,zk2.getDataWatches().size());
  Assert.assertEquals("Didn't find data watcher","/node2",zk2.getDataWatches().get(0));
  removeWatches(zk2,"/node2",w2,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove data watcher",w2.matches());
  if (zk1 != null) {
    zk1.close();
    zk1=null;
  }
  List<EventType> events=w1.getEventsAfterWatchRemoval();
  Assert.assertFalse("Shouldn't get NodeDeletedEvent after watch removal",events.contains(EventType.NodeDeleted));
  Assert.assertEquals("Shouldn't get NodeDeletedEvent after watch removal",0,events.size());
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Children - removes only the configured child
 * watcher function
 */
@Test(timeout=90000) public void testRemoveAllChildWatchesOnAPath() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  final CountDownLatch cWatchCount=new CountDownLatch(2);
  final CountDownLatch rmWatchCount=new CountDownLatch(2);
  Watcher w1=new Watcher(){
    @Override public void process(    WatchedEvent event){
switch (event.getType()) {
case ChildWatchRemoved:
        rmWatchCount.countDown();
      break;
case NodeChildrenChanged:
    cWatchCount.countDown();
  break;
default :
break;
}
}
}
;
Watcher w2=new Watcher(){
@Override public void process(WatchedEvent event){
switch (event.getType()) {
case ChildWatchRemoved:
rmWatchCount.countDown();
break;
case NodeChildrenChanged:
cWatchCount.countDown();
break;
default :
break;
}
}
}
;
LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w1).size());
LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w2).size());
Assert.assertTrue("Server session is not a watcher",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Children));
removeAllWatches(zk2,"/node1",WatcherType.Children,false,Code.OK);
Assert.assertTrue("Didn't remove child watcher",rmWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
Assert.assertFalse("Server session is still a watcher after removal",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Children));
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies null watcher with WatcherType.Children - remove all child
 * watchers. Data watchers shouldn't be removed
 */
@Test(timeout=90000) public void testRemoveAllChildWatchers() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",1);
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w2);
  removeWatches(zk2,"/node1",w1,WatcherType.Children,false,Code.OK);
  removeWatches(zk2,"/node1",w2,WatcherType.Children,false,Code.OK);
  zk1.setData("/node1","test".getBytes(),-1);
  Assert.assertTrue("Didn't remove child watcher",w1.matches());
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
  int count=10;
  while (count > 0) {
    if (w1.getEventsAfterWatchRemoval().size() > 0 && w2.getEventsAfterWatchRemoval().size() > 0) {
      break;
    }
    count--;
    Thread.sleep(1000);
  }
  List<EventType> events=w1.getEventsAfterWatchRemoval();
  Assert.assertEquals("Didn't get NodeDataChanged event",1,events.size());
  Assert.assertTrue("Didn't get NodeDataChanged event",events.contains(EventType.NodeDataChanged));
  events=w2.getEventsAfterWatchRemoval();
  Assert.assertEquals("Didn't get NodeDataChanged event",1,events.size());
  Assert.assertTrue("Didn't get NodeDataChanged event",events.contains(EventType.NodeDataChanged));
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies many child watchers. Also, verifies internal datastructure
 * 'watchManager.childWatches'
 */
@Test(timeout=90000) public void testManyChildWatchers() throws Exception {
  int count=50;
  List<MyWatcher> wList=new ArrayList<MyWatcher>(count);
  MyWatcher w;
  String path="/node";
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    zk1.create(nodePath,null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    nodePath+="/";
  }
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    w=new MyWatcher(path + i,1);
    wList.add(w);
    LOG.info("Adding child watcher {} on path {}",new Object[]{w,nodePath});
    zk1.getChildren(nodePath,w);
    nodePath+="/";
  }
  Assert.assertEquals("Failed to add watchers!",count,zk1.getChildWatches().size());
  for (int i=0; i < count; i++) {
    final MyWatcher watcher=wList.get(i);
    removeWatches(zk1,path + i,watcher,WatcherType.Children,false,Code.OK);
    Assert.assertTrue("Didn't remove child watcher",watcher.matches());
  }
  Assert.assertEquals("Didn't remove watch references!",0,zk1.getChildWatches().size());
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Data - removes only the configured data watcher
 * function
 */
@Test(timeout=90000) public void testRemoveWhenMultipleDataWatchesOnAPath() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  final CountDownLatch dataWatchCount=new CountDownLatch(1);
  final CountDownLatch rmWatchCount=new CountDownLatch(1);
  Watcher w1=new Watcher(){
    @Override public void process(    WatchedEvent event){
      if (event.getType() == EventType.DataWatchRemoved) {
        rmWatchCount.countDown();
      }
    }
  }
;
  Watcher w2=new Watcher(){
    @Override public void process(    WatchedEvent event){
      if (event.getType() == EventType.NodeDataChanged) {
        dataWatchCount.countDown();
      }
    }
  }
;
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
  removeWatches(zk2,"/node1",w1,WatcherType.Data,false,Code.OK);
  Assert.assertTrue("Didn't remove data watcher",rmWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
  zk1.setData("/node1","test".getBytes(),-1);
  LOG.info("Waiting for data watchers to be notified");
  Assert.assertTrue("Didn't get data watch notification!",dataWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Any - removes all the configured child,data
 * watcher functions
 */
@Test(timeout=90000) public void testRemoveAllWatchesOnAPath() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  final CountDownLatch watchCount=new CountDownLatch(2);
  final CountDownLatch rmWatchCount=new CountDownLatch(4);
  Watcher w1=new Watcher(){
    @Override public void process(    WatchedEvent event){
switch (event.getType()) {
case ChildWatchRemoved:
case DataWatchRemoved:
        rmWatchCount.countDown();
      break;
case NodeChildrenChanged:
case NodeDataChanged:
    watchCount.countDown();
  break;
default :
break;
}
}
}
;
Watcher w2=new Watcher(){
@Override public void process(WatchedEvent event){
switch (event.getType()) {
case ChildWatchRemoved:
case DataWatchRemoved:
rmWatchCount.countDown();
break;
case NodeChildrenChanged:
case NodeDataChanged:
watchCount.countDown();
break;
default :
break;
}
}
}
;
LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w1).size());
LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w2).size());
LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
Assert.assertTrue("Server session is not a watcher",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Data));
removeAllWatches(zk2,"/node1",WatcherType.Any,false,Code.OK);
Assert.assertTrue("Didn't remove data watcher",rmWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
Assert.assertFalse("Server session is still a watcher after removal",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Data));
Assert.assertEquals("Received watch notification after removal!",2,watchCount.getCount());
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Children - removes only the configured child
 * watcher function
 */
@Test(timeout=90000) public void testRemoveWhenMultipleChildWatchesOnAPath() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  final CountDownLatch childWatchCount=new CountDownLatch(1);
  final CountDownLatch rmWatchCount=new CountDownLatch(1);
  Watcher w1=new Watcher(){
    @Override public void process(    WatchedEvent event){
      if (event.getType() == EventType.ChildWatchRemoved) {
        rmWatchCount.countDown();
      }
    }
  }
;
  Watcher w2=new Watcher(){
    @Override public void process(    WatchedEvent event){
      if (event.getType() == EventType.NodeChildrenChanged) {
        childWatchCount.countDown();
      }
    }
  }
;
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w1).size());
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w2).size());
  removeWatches(zk2,"/node1",w1,WatcherType.Children,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",rmWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
  zk1.create("/node1/node2",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  LOG.info("Waiting for child watchers to be notified");
  Assert.assertTrue("Didn't get child watch notification!",childWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies removal of multiple child watchers when there is server
 * connection
 */
@Test(timeout=90000) public void testMultipleChildWatchers() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w1);
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w2);
  removeWatches(zk2,"/node1",w2,WatcherType.Children,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
  Assert.assertEquals("Didn't find child watcher",1,zk2.getChildWatches().size());
  removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w1.matches());
  zk1.create("/node1/node2",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  int count=30;
  while (count > 0) {
    if (w1.getEventsAfterWatchRemoval().size() > 0) {
      break;
    }
    count--;
    Thread.sleep(100);
  }
  List<EventType> events=w2.getEventsAfterWatchRemoval();
  Assert.assertEquals("Shouldn't get NodeChildrenChanged event",0,events.size());
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies many pre-node watchers. Also, verifies internal
 * datastructure 'watchManager.existWatches'
 */
@Test(timeout=90000) public void testManyPreNodeWatchers() throws Exception {
  int count=50;
  List<MyWatcher> wList=new ArrayList<MyWatcher>(count);
  MyWatcher w;
  String path="/node";
  for (int i=0; i < count; i++) {
    final String nodePath=path + i;
    w=new MyWatcher(nodePath,1);
    wList.add(w);
    LOG.info("Adding pre node watcher {} on path {}",new Object[]{w,nodePath});
    zk1.exists(nodePath,w);
  }
  Assert.assertEquals("Failed to add watchers!",count,zk1.getExistWatches().size());
  for (int i=0; i < count; i++) {
    final MyWatcher watcher=wList.get(i);
    removeWatches(zk1,path + i,watcher,WatcherType.Data,false,Code.OK);
    Assert.assertTrue("Didn't remove data watcher",watcher.matches());
  }
  Assert.assertEquals("Didn't remove watch references!",0,zk1.getExistWatches().size());
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies many data watchers. Also, verifies internal datastructure
 * 'watchManager.dataWatches'
 */
@Test(timeout=90000) public void testManyDataWatchers() throws Exception {
  int count=50;
  List<MyWatcher> wList=new ArrayList<MyWatcher>(count);
  MyWatcher w;
  String path="/node";
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    w=new MyWatcher(path + i,1);
    wList.add(w);
    zk1.create(nodePath,null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    LOG.info("Adding data watcher {} on path {}",new Object[]{w,nodePath});
    zk1.getData(nodePath,w,null);
    nodePath+="/";
  }
  Assert.assertEquals("Failed to add watchers!",count,zk1.getDataWatches().size());
  for (int i=0; i < count; i++) {
    final MyWatcher watcher=wList.get(i);
    removeWatches(zk1,path + i,watcher,WatcherType.Data,false,Code.OK);
    Assert.assertTrue("Didn't remove data watcher",watcher.matches());
  }
  Assert.assertEquals("Didn't remove watch references!",0,zk1.getDataWatches().size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.VerGenTest </h4><pre class="type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testParser(){
  VerGen.Version v=VerGen.parseVersionString(input);
  Assert.assertEquals(expected[0],v.maj);
  Assert.assertEquals(expected[1],v.min);
  Assert.assertEquals(expected[2],v.micro);
  Assert.assertEquals(expected[3],v.qualifier);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.ZooKeeperTest </h4><pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testSortedLs() throws Exception {
  final ZooKeeper zk=createClient();
  ZooKeeperMain zkMain=new ZooKeeperMain(zk);
  zkMain.executeLine("create /aa1");
  zkMain.executeLine("create /aa2");
  zkMain.executeLine("create /aa3");
  zkMain.executeLine("create /test1");
  zkMain.executeLine("create /zk1");
  ByteArrayOutputStream byteStream=new ByteArrayOutputStream();
  PrintStream out=new PrintStream(byteStream);
  String lsCmd="ls /";
  LsCommand entity=new LsCommand();
  entity.setZk(zk);
  entity.setOut(out);
  entity.parse(lsCmd.split(" ")).exec();
  String result=byteStream.toString();
  assertTrue(result,result.contains("[aa1, aa2, aa3, test1, zk1, zookeeper]"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.common.TimeTest </h4><pre class="type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testElapsedTimeToDate() throws Exception {
  long walltime=Time.currentWallTime();
  long elapsedTime=Time.currentElapsedTime();
  Thread.sleep(200);
  Calendar cal=Calendar.getInstance();
  cal.setTime(Time.elapsedTimeToDate(elapsedTime));
  int calculatedDate=cal.get(Calendar.HOUR_OF_DAY);
  cal.setTime(new Date(walltime));
  int realDate=cal.get(Calendar.HOUR_OF_DAY);
  Assert.assertEquals(calculatedDate,realDate);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.ByteBufferInputStreamTest </h4><pre class="type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testReadArray() throws Exception {
  byte[] expected=Arrays.copyOf(DATA_BYTES,4);
  assertEquals(4,in.read(bs));
  assertArrayEquals(expected,bs);
}

</code></pre>

<br>
<pre class="type-5 type-6 type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testReadArrayOffsetLength_AtEndOfStream() throws Exception {
  for (int i=0; i < DATA_BYTES.length; i++) {
    in.read();
  }
  byte[] expected=Arrays.copyOf(bs,bs.length);
  assertEquals(-1,in.read(bs,2,2));
  assertArrayEquals(expected,bs);
}

</code></pre>

<br>
<pre class="type-5 type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testReadArrayOffsetLength_0Length() throws Exception {
  byte[] expected=Arrays.copyOf(bs,bs.length);
  assertEquals(0,in.read(bs,2,0));
  assertArrayEquals(expected,bs);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.CRCTest </h4><pre class="type-5 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * test checksums for the logs and snapshots.
 * the reader should fail on reading
 * a corrupt snapshot and a corrupt log
 * file
 * @throws Exception
 */
@Test public void testChecksums() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(150);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  LOG.info("starting up the zookeeper server .. waiting");
  Assert.assertTrue("waiting for server being up",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
  try {
    for (int i=0; i < 2000; i++) {
      zk.create("/crctest- " + i,("/crctest- " + i).getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    }
  }
  finally {
    zk.close();
  }
  f.shutdown();
  zks.shutdown();
  Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown(HOSTPORT,ClientBase.CONNECTION_TIMEOUT));
  File versionDir=new File(tmpDir,"version-2");
  File[] list=versionDir.listFiles();
  File snapFile=null;
  File logFile=null;
  for (  File file : list) {
    LOG.info("file is " + file);
    if (file.getName().startsWith("log")) {
      logFile=file;
      corruptFile(logFile);
    }
  }
  FileTxnLog flog=new FileTxnLog(versionDir);
  TxnIterator itr=flog.read(1);
  try {
    while (itr.next()) {
    }
    Assert.assertTrue(false);
  }
 catch (  IOException ie) {
    LOG.info("crc corruption",ie);
  }
  itr.close();
  FileSnap snap=new FileSnap(versionDir);
  List<File> snapFiles=snap.findNRecentSnapshots(2);
  snapFile=snapFiles.get(0);
  corruptFile(snapFile);
  boolean cfile=false;
  try {
    cfile=getCheckSum(snap,snapFile);
  }
 catch (  IOException ie) {
    snapFile=snapFiles.get(1);
    corruptFile(snapFile);
    cfile=getCheckSum(snap,snapFile);
  }
  Assert.assertTrue(cfile);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.DataTreeTest </h4><pre class="type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testPathTrieClearOnDeserialize() throws Exception {
  DataTree dserTree=new DataTree();
  dserTree.createNode("/bug",new byte[20],null,-1,1,1,1);
  dserTree.createNode(Quotas.quotaZookeeper + "/bug",null,null,-1,1,1,1);
  dserTree.createNode(Quotas.quotaPath("/bug"),new byte[20],null,-1,1,1,1);
  dserTree.createNode(Quotas.statPath("/bug"),new byte[20],null,-1,1,1,1);
  DataTree tree=new DataTree();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  BinaryOutputArchive oa=BinaryOutputArchive.getArchive(baos);
  tree.serialize(oa,"test");
  baos.flush();
  ByteArrayInputStream bais=new ByteArrayInputStream(baos.toByteArray());
  BinaryInputArchive ia=BinaryInputArchive.getArchive(bais);
  dserTree.deserialize(ia,"test");
  Field pfield=DataTree.class.getDeclaredField("pTrie");
  pfield.setAccessible(true);
  PathTrie pTrie=(PathTrie)pfield.get(dserTree);
  Assert.assertEquals("/bug is still in pTrie","",pTrie.findMaxPrefix("/bug"));
}

</code></pre>

<br>
<pre class="type-5 type-10 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
"></span><br>
@Test(timeout=60000) public void testSerializeDoesntLockDataNodeWhileWriting() throws Exception {
  DataTree tree=new DataTree();
  tree.createNode("/marker",new byte[]{42},null,-1,1,1,1);
  final DataNode markerNode=tree.getNode("/marker");
  final AtomicBoolean ranTestCase=new AtomicBoolean();
  DataOutputStream out=new DataOutputStream(new ByteArrayOutputStream());
  BinaryOutputArchive oa=new BinaryOutputArchive(out){
    @Override public void writeRecord(    Record r,    String tag) throws IOException {
      DataNode node=(DataNode)r;
      if (node.data.length == 1 && node.data[0] == 42) {
        final Semaphore semaphore=new Semaphore(0);
        new Thread(new Runnable(){
          @Override public void run(){
synchronized (markerNode) {
              semaphore.release();
            }
          }
        }
).start();
        try {
          boolean acquired=semaphore.tryAcquire(30,TimeUnit.SECONDS);
          Assert.assertTrue("Couldn't acquire a lock on the DataNode while we were calling tree.serialize",acquired);
        }
 catch (        InterruptedException e1) {
          throw new RuntimeException(e1);
        }
        ranTestCase.set(true);
      }
      super.writeRecord(r,tag);
    }
  }
;
  tree.serialize(oa,"test");
  Assert.assertTrue("Didn't find the expected node",ranTestCase.get());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.PurgeTxnTest </h4><pre class="type-9 type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests finding n recent snapshots from set of snapshots and data logs
 */
@Test public void testFindNRecentSnapshots() throws Exception {
  int nRecentSnap=4;
  int nRecentCount=30;
  int offset=0;
  tmpDir=ClientBase.createTmpDir();
  File version2=new File(tmpDir.toString(),"version-2");
  Assert.assertTrue("Failed to create version_2 dir:" + version2.toString(),version2.mkdir());
  List<File> expectedNRecentSnapFiles=new ArrayList<File>();
  int counter=offset + (2 * nRecentCount);
  for (int i=0; i < nRecentCount; i++) {
    File logFile=new File(version2 + "/log." + Long.toHexString(--counter));
    Assert.assertTrue("Failed to create log File:" + logFile.toString(),logFile.createNewFile());
    File snapFile=new File(version2 + "/snapshot." + Long.toHexString(--counter));
    Assert.assertTrue("Failed to create snap File:" + snapFile.toString(),snapFile.createNewFile());
    if (i < nRecentSnap) {
      expectedNRecentSnapFiles.add(snapFile);
    }
  }
  FileTxnSnapLog txnLog=new FileTxnSnapLog(tmpDir,tmpDir);
  List<File> nRecentSnapFiles=txnLog.findNRecentSnapshots(nRecentSnap);
  txnLog.close();
  Assert.assertEquals("exactly 4 snapshots ",4,nRecentSnapFiles.size());
  expectedNRecentSnapFiles.removeAll(nRecentSnapFiles);
  Assert.assertEquals("Didn't get the recent snap files",0,expectedNRecentSnapFiles.size());
}

</code></pre>

<br>
<pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Tests purge where the data directory contains snap files equals to the
 * number of files to be retained
 */
@Test public void testSnapFilesEqualsToRetain() throws Exception {
  int nRecentCount=3;
  AtomicInteger offset=new AtomicInteger(0);
  tmpDir=ClientBase.createTmpDir();
  File version2=new File(tmpDir.toString(),"version-2");
  Assert.assertTrue("Failed to create version_2 dir:" + version2.toString(),version2.mkdir());
  List<File> snaps=new ArrayList<File>();
  List<File> logs=new ArrayList<File>();
  createDataDirFiles(offset,nRecentCount,version2,snaps,logs);
  FileTxnSnapLog txnLog=new FileTxnSnapLog(tmpDir,tmpDir);
  PurgeTxnLog.retainNRecentSnapshots(txnLog,snaps);
  txnLog.close();
  verifyFilesAfterPurge(snaps,true);
  verifyFilesAfterPurge(logs,true);
}

</code></pre>

<br>
<pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Tests purge where the data directory contains old snapshots and data
 * logs, newest snapshots and data logs, (newest + n) snapshots and data
 * logs
 */
@Test public void testSnapFilesGreaterThanToRetain() throws Exception {
  int nRecentCount=4;
  int fileAboveRecentCount=4;
  int fileToPurgeCount=2;
  AtomicInteger offset=new AtomicInteger(0);
  tmpDir=ClientBase.createTmpDir();
  File version2=new File(tmpDir.toString(),"version-2");
  Assert.assertTrue("Failed to create version_2 dir:" + version2.toString(),version2.mkdir());
  List<File> snapsToPurge=new ArrayList<File>();
  List<File> logsToPurge=new ArrayList<File>();
  List<File> snaps=new ArrayList<File>();
  List<File> logs=new ArrayList<File>();
  List<File> snapsAboveRecentFiles=new ArrayList<File>();
  List<File> logsAboveRecentFiles=new ArrayList<File>();
  createDataDirFiles(offset,fileToPurgeCount,version2,snapsToPurge,logsToPurge);
  createDataDirFiles(offset,nRecentCount,version2,snaps,logs);
  createDataDirFiles(offset,fileAboveRecentCount,version2,snapsAboveRecentFiles,logsAboveRecentFiles);
  FileTxnSnapLog txnLog=new FileTxnSnapLog(tmpDir,tmpDir);
  PurgeTxnLog.retainNRecentSnapshots(txnLog,snaps);
  txnLog.close();
  verifyFilesAfterPurge(snapsToPurge,false);
  verifyFilesAfterPurge(logsToPurge,false);
  verifyFilesAfterPurge(snaps,true);
  verifyFilesAfterPurge(logs,true);
  verifyFilesAfterPurge(snapsAboveRecentFiles,true);
  verifyFilesAfterPurge(logsAboveRecentFiles,true);
}

</code></pre>

<br>
<pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Tests purge where the data directory contains old snapshots and data
 * logs, newest snapshots and data logs
 */
@Test public void testSnapFilesLessThanToRetain() throws Exception {
  int nRecentCount=4;
  int fileToPurgeCount=2;
  AtomicInteger offset=new AtomicInteger(0);
  tmpDir=ClientBase.createTmpDir();
  File version2=new File(tmpDir.toString(),"version-2");
  Assert.assertTrue("Failed to create version_2 dir:" + version2.toString(),version2.mkdir());
  List<File> snapsToPurge=new ArrayList<File>();
  List<File> logsToPurge=new ArrayList<File>();
  List<File> snaps=new ArrayList<File>();
  List<File> logs=new ArrayList<File>();
  createDataDirFiles(offset,fileToPurgeCount,version2,snapsToPurge,logsToPurge);
  createDataDirFiles(offset,nRecentCount,version2,snaps,logs);
  FileTxnSnapLog txnLog=new FileTxnSnapLog(tmpDir,tmpDir);
  PurgeTxnLog.retainNRecentSnapshots(txnLog,snaps);
  txnLog.close();
  verifyFilesAfterPurge(snapsToPurge,false);
  verifyFilesAfterPurge(logsToPurge,false);
  verifyFilesAfterPurge(snaps,true);
  verifyFilesAfterPurge(logs,true);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.SessionTrackerTest </h4><pre class="type-5 type-6 type-8 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies values related to public fields.
"></span><br>
/** 
 * Verify the session closure request has reached PrepRequestProcessor soon
 * after session expiration by the session tracker
 */
@Test(timeout=20000) public void testCloseSessionRequestAfterSessionExpiry() throws Exception {
  ZooKeeperServer zks=setupSessionTracker();
  latch=new CountDownLatch(1);
  zks.sessionTracker.addSession(sessionId,sessionTimeout);
  SessionTrackerImpl sessionTrackerImpl=(SessionTrackerImpl)zks.sessionTracker;
  SessionImpl sessionImpl=sessionTrackerImpl.sessionsById.get(sessionId);
  Assert.assertNotNull("Sessionid:" + sessionId + " doesn't exists in sessiontracker",sessionImpl);
  Object sessionOwner=new Object();
  sessionTrackerImpl.checkSession(sessionId,sessionOwner);
  latch.await(sessionTimeout * 2,TimeUnit.MILLISECONDS);
  sessionTrackerImpl.removeSession(sessionId);
  SessionImpl actualSession=sessionTrackerImpl.sessionsById.get(sessionId);
  Assert.assertNull("Session:" + sessionId + " still exists after removal",actualSession);
}

</code></pre>

<br>
<pre class="type-5 type-3 type-2 type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify the create session call in the Leader.FinalRequestProcessor after
 * the session expiration.
 */
@Test(timeout=20000) public void testAddSessionAfterSessionExpiry() throws Exception {
  ZooKeeperServer zks=setupSessionTracker();
  latch=new CountDownLatch(1);
  zks.sessionTracker.addSession(sessionId,sessionTimeout);
  SessionTrackerImpl sessionTrackerImpl=(SessionTrackerImpl)zks.sessionTracker;
  SessionImpl sessionImpl=sessionTrackerImpl.sessionsById.get(sessionId);
  Assert.assertNotNull("Sessionid:" + sessionId + " doesn't exists in sessiontracker",sessionImpl);
  Object sessionOwner=new Object();
  sessionTrackerImpl.checkSession(sessionId,sessionOwner);
  latch.await(sessionTimeout * 2,TimeUnit.MILLISECONDS);
  sessionTrackerImpl.addSession(sessionId,sessionTimeout);
  try {
    sessionTrackerImpl.checkSession(sessionId,sessionOwner);
    Assert.fail("Should throw session expiry exception " + "as the session has expired and closed");
  }
 catch (  KeeperException.SessionExpiredException e) {
  }
  Assert.assertTrue("Session didn't expired",sessionImpl.isClosing());
  Assert.assertFalse("Session didn't expired",sessionTrackerImpl.touchSession(sessionId,sessionTimeout));
  Assert.assertEquals("Duplicate session expiry request has been generated",1,firstProcessor.getCountOfCloseSessionReq());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.ZooKeeperServerTest </h4><pre class="type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetLogFiles(){
  File[] files=new File[5];
  files[0]=new File("log.10027c6de");
  files[1]=new File("log.10027c6df");
  files[2]=new File("snapshot.10027c6dd");
  files[3]=new File("log.10027c6dc");
  files[4]=new File("log.20027c6dc");
  File[] orig=files.clone();
  File[] filelist=FileTxnLog.getLogFiles(files,Long.parseLong("10027c6de",16));
  Assert.assertEquals(3,filelist.length);
  Assert.assertEquals(orig[0],filelist[0]);
  Assert.assertEquals(orig[1],filelist[1]);
  Assert.assertEquals(orig[4],filelist[2]);
}

</code></pre>

<br>
<pre class="type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSortDataDirAscending(){
  File[] files=new File[5];
  files[0]=new File("foo.10027c6de");
  files[1]=new File("foo.10027c6df");
  files[2]=new File("bar.10027c6dd");
  files[3]=new File("foo.10027c6dc");
  files[4]=new File("foo.20027c6dc");
  File[] orig=files.clone();
  List<File> filelist=Util.sortDataDir(files,"foo",true);
  Assert.assertEquals(orig[2],filelist.get(0));
  Assert.assertEquals(orig[3],filelist.get(1));
  Assert.assertEquals(orig[0],filelist.get(2));
  Assert.assertEquals(orig[1],filelist.get(3));
  Assert.assertEquals(orig[4],filelist.get(4));
}

</code></pre>

<br>
<pre class="type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSortDataDirDescending(){
  File[] files=new File[5];
  files[0]=new File("foo.10027c6de");
  files[1]=new File("foo.10027c6df");
  files[2]=new File("bar.10027c6dd");
  files[3]=new File("foo.10027c6dc");
  files[4]=new File("foo.20027c6dc");
  File[] orig=files.clone();
  List<File> filelist=Util.sortDataDir(files,"foo",false);
  Assert.assertEquals(orig[4],filelist.get(0));
  Assert.assertEquals(orig[1],filelist.get(1));
  Assert.assertEquals(orig[0],filelist.get(2));
  Assert.assertEquals(orig[3],filelist.get(3));
  Assert.assertEquals(orig[2],filelist.get(4));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.ZxidRolloverTest </h4><pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Similar to testRolloverThenRestart, but ensure we can survive multiple
 * epoch rollovers between restarts.
 */
@Test public void testMultipleRollover() throws Exception {
  ZooKeeper zk=getClient(idxFollower);
  int countCreated=createNodes(zk,0,10);
  adjustEpochNearEnd();
  countCreated+=createNodes(zk,countCreated,10);
  adjustEpochNearEnd();
  countCreated+=createNodes(zk,countCreated,10);
  adjustEpochNearEnd();
  countCreated+=createNodes(zk,countCreated,10);
  adjustEpochNearEnd();
  countCreated+=createNodes(zk,countCreated,10);
  shutdownAll();
  startAll();
  zk=getClient(idxFollower);
  adjustEpochNearEnd();
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  shutdown(idxLeader);
  start(idxLeader);
  zk=getClient(idxFollower);
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  Assert.assertTrue(countCreated > 0);
  Assert.assertTrue(countCreated < 70);
}

</code></pre>

<br>
<pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Similar to testSimpleRollover, but ensure the cluster comes back,
 * has the right data, and is able to serve new requests.
 */
@Test public void testRolloverThenRestart() throws Exception {
  ZooKeeper zk=getClient(idxFollower);
  int countCreated=createNodes(zk,0,10);
  adjustEpochNearEnd();
  countCreated+=createNodes(zk,countCreated,10);
  shutdownAll();
  startAll();
  zk=getClient(idxLeader);
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  adjustEpochNearEnd();
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  shutdownAll();
  startAll();
  zk=getClient(idxFollower);
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  shutdownAll();
  startAll();
  zk=getClient(idxLeader);
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  Assert.assertTrue(countCreated > 0);
  Assert.assertTrue(countCreated < 60);
}

</code></pre>

<br>
<pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Similar to testRolloverThenRestart, but ensure a follower comes back,
 * has the right data, and is able to serve new requests.
 */
@Test public void testRolloverThenFollowerRestart() throws Exception {
  ZooKeeper zk=getClient(idxFollower);
  int countCreated=createNodes(zk,0,10);
  adjustEpochNearEnd();
  countCreated+=createNodes(zk,countCreated,10);
  shutdown(idxFollower);
  start(idxFollower);
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  adjustEpochNearEnd();
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  shutdown(idxFollower);
  start(idxFollower);
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  shutdown(idxFollower);
  start(idxFollower);
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  Assert.assertTrue(countCreated > 0);
  Assert.assertTrue(countCreated < 60);
}

</code></pre>

<br>
<pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Similar to testRolloverThenRestart, but ensure leadership can change,
 * comes back, has the right data, and is able to serve new requests.
 */
@Test public void testRolloverThenLeaderRestart() throws Exception {
  ZooKeeper zk=getClient(idxLeader);
  int countCreated=createNodes(zk,0,10);
  adjustEpochNearEnd();
  checkNodes(zk,0,countCreated);
  shutdown(idxLeader);
  start(idxLeader);
  zk=getClient(idxLeader);
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  adjustEpochNearEnd();
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  shutdown(idxLeader);
  start(idxLeader);
  zk=getClient(idxLeader);
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  shutdown(idxLeader);
  start(idxLeader);
  zk=getClient(idxFollower);
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  Assert.assertTrue(countCreated > 0);
  Assert.assertTrue(countCreated < 50);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.jersey.CreateTest </h4><pre class="type-5 type-10 type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreate() throws Exception {
  WebResource wr=znodesr.path(path).queryParam("dataformat",encoding).queryParam("name",name);
  if (data == null) {
    wr=wr.queryParam("null","true");
  }
  if (sequence) {
    wr=wr.queryParam("sequence","true");
  }
  Builder builder=wr.accept(accept);
  ClientResponse cr;
  if (data == null) {
    cr=builder.post(ClientResponse.class);
  }
 else {
    cr=builder.post(ClientResponse.class,data);
  }
  Assert.assertEquals(expectedStatus,cr.getClientResponseStatus());
  if (expectedPath == null) {
    return;
  }
  ZPath zpath=cr.getEntity(ZPath.class);
  if (sequence) {
    Assert.assertTrue(zpath.path.startsWith(expectedPath.path));
    Assert.assertTrue(zpath.uri.startsWith(znodesr.path(path).toString()));
  }
 else {
    Assert.assertEquals(expectedPath,zpath);
    Assert.assertEquals(znodesr.path(path).toString(),zpath.uri);
  }
  byte[] data=zk.getData(zpath.path,false,new Stat());
  if (data == null && this.data == null) {
    return;
  }
 else   if (data == null || this.data == null) {
    Assert.assertEquals(data,this.data);
  }
 else {
    Assert.assertTrue(new String(data) + " == " + new String(this.data),Arrays.equals(data,this.data));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.jersey.GetChildrenTest </h4><pre class="type-5 type-10 type-3 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetChildren() throws Exception {
  if (expectedChildren != null) {
    for (    String child : expectedChildren) {
      zk.create(expectedPath + "/" + child,null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    }
  }
  ClientResponse cr=znodesr.path(path).queryParam("view","children").accept(accept).get(ClientResponse.class);
  Assert.assertEquals(expectedStatus,cr.getClientResponseStatus());
  if (expectedChildren == null) {
    return;
  }
  if (accept.equals(MediaType.APPLICATION_JSON)) {
    ZChildrenJSON zchildren=cr.getEntity(ZChildrenJSON.class);
    Collections.sort(expectedChildren);
    Collections.sort(zchildren.children);
    Assert.assertEquals(expectedChildren,zchildren.children);
    Assert.assertEquals(znodesr.path(path).toString(),zchildren.uri);
    Assert.assertEquals(znodesr.path(path).toString() + "/{child}",zchildren.child_uri_template);
  }
 else   if (accept.equals(MediaType.APPLICATION_XML)) {
    ZChildren zchildren=cr.getEntity(ZChildren.class);
    Collections.sort(expectedChildren);
    Collections.sort(zchildren.children);
    Assert.assertEquals(expectedChildren,zchildren.children);
    Assert.assertEquals(znodesr.path(path).toString(),zchildren.uri);
    Assert.assertEquals(znodesr.path(path).toString() + "/{child}",zchildren.child_uri_template);
  }
 else {
    Assert.fail("unknown accept type");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.jersey.GetTest </h4><pre class="type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGet() throws Exception {
  if (expectedStat != null) {
    if (expectedStat.data64 != null || expectedStat.dataUtf8 == null) {
      zk.setData(expectedStat.path,expectedStat.data64,-1);
    }
 else {
      zk.setData(expectedStat.path,expectedStat.dataUtf8.getBytes(),-1);
    }
  }
  ClientResponse cr=znodesr.path(path).queryParam("dataformat",encoding).accept(accept).get(ClientResponse.class);
  Assert.assertEquals(expectedStatus,cr.getClientResponseStatus());
  if (expectedStat == null) {
    return;
  }
  ZStat zstat=cr.getEntity(ZStat.class);
  Assert.assertEquals(expectedStat,zstat);
  Assert.assertEquals(znodesr.path(path).toString(),zstat.uri);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.jersey.RootTest </h4><pre class="type-5 type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreate() throws Exception {
  String path="/";
  String name="roottest-create";
  byte[] data="foo".getBytes();
  WebResource wr=znodesr.path(path).queryParam("dataformat","utf8").queryParam("name",name);
  Builder builder=wr.accept(MediaType.APPLICATION_JSON);
  ClientResponse cr;
  cr=builder.post(ClientResponse.class,data);
  Assert.assertEquals(ClientResponse.Status.CREATED,cr.getClientResponseStatus());
  ZPath zpath=cr.getEntity(ZPath.class);
  Assert.assertEquals(new ZPath(path + name),zpath);
  Assert.assertEquals(znodesr.path(path).toString(),zpath.uri);
  byte[] rdata=zk.getData(zpath.path,false,new Stat());
  Assert.assertTrue(new String(rdata) + " == " + new String(data),Arrays.equals(rdata,data));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.jersey.SetTest </h4><pre class="type-5 type-10 type-3 type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSet() throws Exception {
  if (expectedStat != null) {
    zk.create(expectedStat.path,"initial".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  }
  WebResource wr=znodesr.path(path).queryParam("dataformat",encoding);
  if (data == null) {
    wr=wr.queryParam("null","true");
  }
  Builder builder=wr.accept(accept).type(MediaType.APPLICATION_OCTET_STREAM);
  ClientResponse cr;
  if (data == null) {
    cr=builder.put(ClientResponse.class);
  }
 else {
    cr=builder.put(ClientResponse.class,new String(data));
  }
  Assert.assertEquals(expectedStatus,cr.getClientResponseStatus());
  if (expectedStat == null) {
    return;
  }
  ZStat zstat=cr.getEntity(ZStat.class);
  Assert.assertEquals(expectedStat,zstat);
  byte[] data=zk.getData(zstat.path,false,new Stat());
  if (data == null && this.data == null) {
    return;
  }
 else   if (data == null || this.data == null) {
    Assert.fail((data == null ? null : new String(data)) + " == " + (this.data == null ? null : new String(this.data)));
  }
 else {
    Assert.assertTrue(new String(data) + " == " + new String(this.data),Arrays.equals(data,this.data));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.LearnerTest </h4><pre class="type-5 type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void syncTest() throws Exception {
  File tmpFile=File.createTempFile("test",".dir",testData);
  tmpFile.delete();
  try {
    FileTxnSnapLog ftsl=new FileTxnSnapLog(tmpFile,tmpFile);
    SimpleLearner sl=new SimpleLearner(ftsl);
    long startZxid=sl.zk.getLastProcessedZxid();
    ByteArrayOutputStream baos=new ByteArrayOutputStream();
    BinaryOutputArchive oa=BinaryOutputArchive.getArchive(baos);
    sl.leaderOs=BinaryOutputArchive.getArchive(new ByteArrayOutputStream());
    sl.bufferedOutput=new BufferedOutputStream(System.out);
    sl.sock=new Socket();
    QuorumPacket qp=new QuorumPacket(Leader.SNAP,0,null,null);
    oa.writeRecord(qp,null);
    sl.zk.getZKDatabase().serializeSnapshot(oa);
    oa.writeString("BenWasHere","signature");
    TxnHeader hdr=new TxnHeader(0,0,0,0,ZooDefs.OpCode.create);
    CreateTxn txn=new CreateTxn("/foo",new byte[0],new ArrayList<ACL>(),false,sl.zk.getZKDatabase().getNode("/").stat.getCversion());
    ByteArrayOutputStream tbaos=new ByteArrayOutputStream();
    BinaryOutputArchive boa=BinaryOutputArchive.getArchive(tbaos);
    hdr.serialize(boa,"hdr");
    txn.serialize(boa,"txn");
    tbaos.close();
    qp=new QuorumPacket(Leader.PROPOSAL,1,tbaos.toByteArray(),null);
    oa.writeRecord(qp,null);
    sl.leaderIs=BinaryInputArchive.getArchive(new ByteArrayInputStream(baos.toByteArray()));
    try {
      sl.syncWithLeader(3);
    }
 catch (    EOFException e) {
    }
    sl.zk.shutdown();
    sl=new SimpleLearner(ftsl);
    Assert.assertEquals(startZxid,sl.zk.getLastProcessedZxid());
  }
  finally {
    TestUtils.deleteFileRecursively(tmpFile);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.QuorumPeerMainTest </h4><pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Verify handling of quorum defaults
 * * default electionAlg is fast leader election
 */
@Test public void testQuorumDefaults() throws Exception {
  ClientBase.setupTestEnv();
  Layout layout=Logger.getRootLogger().getAppender("CONSOLE").getLayout();
  ByteArrayOutputStream os=new ByteArrayOutputStream();
  WriterAppender appender=new WriterAppender(layout,os);
  appender.setImmediateFlush(true);
  appender.setThreshold(Level.INFO);
  Logger zlogger=Logger.getLogger("org.apache.zookeeper");
  zlogger.addAppender(appender);
  try {
    final int CLIENT_PORT_QP1=PortAssignment.unique();
    final int CLIENT_PORT_QP2=PortAssignment.unique();
    String quorumCfgSection="server.1=127.0.0.1:" + PortAssignment.unique() + ":"+ PortAssignment.unique()+ ";"+ CLIENT_PORT_QP1+ "\nserver.2=127.0.0.1:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ";"+ CLIENT_PORT_QP2;
    MainThread q1=new MainThread(1,CLIENT_PORT_QP1,quorumCfgSection);
    MainThread q2=new MainThread(2,CLIENT_PORT_QP2,quorumCfgSection);
    q1.start();
    q2.start();
    Assert.assertTrue("waiting for server 1 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP1,CONNECTION_TIMEOUT));
    Assert.assertTrue("waiting for server 2 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP2,CONNECTION_TIMEOUT));
    q1.shutdown();
    q2.shutdown();
    Assert.assertTrue("waiting for server 1 down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_QP1,ClientBase.CONNECTION_TIMEOUT));
    Assert.assertTrue("waiting for server 2 down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_QP2,ClientBase.CONNECTION_TIMEOUT));
  }
  finally {
    zlogger.removeAppender(appender);
  }
  os.close();
  LineNumberReader r=new LineNumberReader(new StringReader(os.toString()));
  String line;
  boolean found=false;
  Pattern p=Pattern.compile(".*FastLeaderElection.*");
  while ((line=r.readLine()) != null) {
    found=p.matcher(line).matches();
    if (found) {
      break;
    }
  }
  Assert.assertTrue("fastleaderelection used",found);
}

</code></pre>

<br>
<pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Verify handling of bad quorum address
 */
@Test public void testBadPeerAddressInQuorum() throws Exception {
  ClientBase.setupTestEnv();
  Layout layout=Logger.getRootLogger().getAppender("CONSOLE").getLayout();
  ByteArrayOutputStream os=new ByteArrayOutputStream();
  WriterAppender appender=new WriterAppender(layout,os);
  appender.setThreshold(Level.WARN);
  Logger qlogger=Logger.getLogger("org.apache.zookeeper.server.quorum");
  qlogger.addAppender(appender);
  try {
    final int CLIENT_PORT_QP1=PortAssignment.unique();
    final int CLIENT_PORT_QP2=PortAssignment.unique();
    String quorumCfgSection="server.1=127.0.0.1:" + PortAssignment.unique() + ":"+ PortAssignment.unique()+ ";"+ CLIENT_PORT_QP1+ "\nserver.2=fee.fii.foo.fum:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ";"+ CLIENT_PORT_QP2;
    MainThread q1=new MainThread(1,CLIENT_PORT_QP1,quorumCfgSection);
    q1.start();
    boolean isup=ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP1,30000);
    Assert.assertFalse("Server never came up",isup);
    q1.shutdown();
    Assert.assertTrue("waiting for server 1 down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_QP1,ClientBase.CONNECTION_TIMEOUT));
  }
  finally {
    qlogger.removeAppender(appender);
  }
  LineNumberReader r=new LineNumberReader(new StringReader(os.toString()));
  String line;
  boolean found=false;
  Pattern p=Pattern.compile(".*Cannot open channel to .* at election address .*");
  while ((line=r.readLine()) != null) {
    found=p.matcher(line).matches();
    if (found) {
      break;
    }
  }
  Assert.assertTrue("complains about host",found);
}

</code></pre>

<br>
<pre class="type-5 type-2 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test the case of server with highest zxid not present at leader election and joining later.
 * This test case is for reproducing the issue and fixing the bug mentioned in ZOOKEEPER-1154
 * and ZOOKEEPER-1156.
 */
@Test public void testHighestZxidJoinLate() throws Exception {
  numServers=3;
  servers=LaunchServers(numServers);
  String path="/hzxidtest";
  int leader=-1;
  for (int i=0; i < numServers; i++) {
    if (servers.mt[i].main.quorumPeer.leader != null) {
      leader=i;
    }
  }
  Assert.assertTrue("There should be a leader",leader >= 0);
  int nonleader=(leader + 1) % numServers;
  byte[] input=new byte[1];
  input[0]=1;
  byte[] output;
  servers.zk[leader].create(path + leader,input,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  servers.zk[leader].create(path + nonleader,input,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  output=servers.zk[leader].getData(path + nonleader,false,null);
  for (int i=0; i < numServers; i++) {
    if (i != leader) {
      servers.mt[i].shutdown();
    }
  }
  input[0]=2;
  servers.zk[leader].setData(path + leader,input,-1,null,null);
  Thread.sleep(500);
  servers.mt[leader].shutdown();
  System.gc();
  waitForAll(servers.zk,States.CONNECTING);
  for (int i=0; i < numServers; i++) {
    if (i != leader) {
      servers.mt[i].start();
    }
  }
  waitForOne(servers.zk[nonleader],States.CONNECTED);
  output=servers.zk[nonleader].getData(path + leader,false,null);
  Assert.assertEquals("Expecting old value 1 since 2 isn't committed yet",output[0],1);
  servers.zk[nonleader].setData(path + nonleader,input,-1);
  servers.mt[leader].start();
  waitForOne(servers.zk[leader],States.CONNECTED);
  output=servers.zk[leader].getData(path + leader,false,null);
  Assert.assertEquals("Validating that the deposed leader has rolled back that change it had written",output[0],1);
  output=servers.zk[leader].getData(path + nonleader,false,null);
  Assert.assertEquals("Validating that the deposed leader caught up on changes it missed",output[0],2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.QuorumRequestPipelineTest </h4><pre class="type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testExists() throws Exception {
  Stat stat=create2EmptyNode(zkClient,PARENT_PATH);
  Assert.assertEquals(String.format("%s Exists returns correct node stat",serverState),stat,zkClient.exists(PARENT_PATH,false));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.ReconfigBackupTest </h4><pre class="type-9 type-5 type-10 type-2 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test checks that if a version is appended to dynamic file,
 * then peer should use that version as quorum config version.
 * <p/>
 * The scenario: one server has an older version of 3 servers, and
 * four others have newer version of 5 servers. Finally, the lag-off one
 * should have server config of 5 servers.
 */
@Test public void testVersionOfDynamicFilename() throws Exception {
  final int SERVER_COUNT=5;
  final int oldServerCount=3;
  final int lagOffServerId=0;
  final int clientPorts[]=new int[SERVER_COUNT];
  StringBuilder sb=new StringBuilder();
  String server;
  StringBuilder oldSb=new StringBuilder();
  ArrayList<String> allServers=new ArrayList<String>();
  for (int i=0; i < SERVER_COUNT; i++) {
    clientPorts[i]=PortAssignment.unique();
    server="server." + i + "=localhost:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ":participant;localhost:"+ clientPorts[i];
    sb.append(server + "\n");
    allServers.add(server);
    if (i < oldServerCount) {
      oldSb.append(server + "\n");
    }
  }
  String currentQuorumCfgSection=sb.toString();
  String oldQuorumCfg=oldSb.toString();
  MainThread mt[]=new MainThread[SERVER_COUNT];
  for (int i=0; i < SERVER_COUNT; i++) {
    if (i == lagOffServerId) {
      mt[i]=new MainThread(i,clientPorts[i],oldQuorumCfg,true,"100000000");
    }
 else {
      mt[i]=new MainThread(i,clientPorts[i],currentQuorumCfgSection,true,"200000000");
    }
    if (i == lagOffServerId) {
      Assert.assertNotNull(mt[i].getFileByName("zoo.cfg.dynamic.100000000"));
      Assert.assertNull(mt[i].getFileByName("zoo.cfg.dynamic.200000000"));
      Assert.assertTrue(mt[i].getPropFromStaticFile("dynamicConfigFile").endsWith(".100000000"));
    }
 else {
      Assert.assertNotNull(mt[i].getFileByName("zoo.cfg.dynamic.200000000"));
      Assert.assertTrue(mt[i].getPropFromStaticFile("dynamicConfigFile").endsWith(".200000000"));
    }
    mt[i].start();
  }
  String dynamicFileContent=null;
  for (int i=0; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[i],CONNECTION_TIMEOUT));
    ZooKeeper zk=new ZooKeeper("127.0.0.1:" + clientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
    String configStr=ReconfigTest.testServerHasConfig(zk,allServers,null);
    Assert.assertEquals("200000000",getVersionFromConfigStr(configStr));
    List<String> configLines=Arrays.asList(configStr.split("\n"));
    Collections.sort(configLines);
    String sortedConfigStr=StringUtils.joinStrings(configLines,"\n");
    File dynamicConfigFile=mt[i].getFileByName("zoo.cfg.dynamic.200000000");
    Assert.assertNotNull(dynamicConfigFile);
    if (i == 0) {
      dynamicFileContent=getFileContent(dynamicConfigFile);
      Assert.assertEquals(sortedConfigStr,dynamicFileContent + "version=200000000");
    }
 else {
      String otherDynamicFileContent=getFileContent(dynamicConfigFile);
      Assert.assertEquals(dynamicFileContent,otherDynamicFileContent);
    }
    zk.close();
  }
  Assert.assertTrue(mt[lagOffServerId].getPropFromStaticFile("dynamicConfigFile").endsWith(".200000000"));
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i].shutdown();
  }
}

</code></pre>

<br>
<pre class="type-9 type-5 type-10 type-2 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test checks that on reconfig, a new dynamic file will be created with
 * current version appended to file name. Meanwhile, the dynamic file pointer
 * in static config file should also be changed.
 */
@Test public void testReconfigCreateNewVersionFile() throws Exception {
  final int SERVER_COUNT=3;
  final int NEW_SERVER_COUNT=5;
  final int clientPorts[]=new int[NEW_SERVER_COUNT];
  final int quorumPorts[]=new int[NEW_SERVER_COUNT];
  final int electionPorts[]=new int[NEW_SERVER_COUNT];
  final String servers[]=new String[NEW_SERVER_COUNT];
  StringBuilder sb=new StringBuilder();
  ArrayList<String> oldServers=new ArrayList<String>();
  ArrayList<String> newServers=new ArrayList<String>();
  for (int i=0; i < NEW_SERVER_COUNT; i++) {
    clientPorts[i]=PortAssignment.unique();
    quorumPorts[i]=PortAssignment.unique();
    electionPorts[i]=PortAssignment.unique();
    servers[i]="server." + i + "=localhost:"+ quorumPorts[i]+ ":"+ electionPorts[i]+ ":participant;localhost:"+ clientPorts[i];
    newServers.add(servers[i]);
    if (i >= SERVER_COUNT) {
      continue;
    }
    oldServers.add(servers[i]);
    sb.append(servers[i] + "\n");
  }
  String quorumCfgSection=sb.toString();
  MainThread mt[]=new MainThread[NEW_SERVER_COUNT];
  ZooKeeper zk[]=new ZooKeeper[NEW_SERVER_COUNT];
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i]=new MainThread(i,clientPorts[i],quorumCfgSection);
    mt[i].start();
  }
  String firstVersion=null, secondVersion=null;
  for (int i=0; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[i],CONNECTION_TIMEOUT));
    zk[i]=new ZooKeeper("127.0.0.1:" + clientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
    Properties cfg=ReconfigLegacyTest.readPropertiesFromFile(mt[i].confFile);
    String filename=cfg.getProperty("dynamicConfigFile","");
    String version=QuorumPeerConfig.getVersionFromFilename(filename);
    Assert.assertNotNull(version);
    String configStr=ReconfigTest.testServerHasConfig(zk[i],oldServers,null);
    String configVersion=getVersionFromConfigStr(configStr);
    Assert.assertEquals(version,configVersion);
    if (i == 0) {
      firstVersion=version;
    }
 else {
      Assert.assertEquals(firstVersion,version);
    }
  }
  ReconfigTest.reconfig(zk[1],null,null,newServers,-1);
  for (int i=SERVER_COUNT; i < NEW_SERVER_COUNT; i++) {
    mt[i]=new MainThread(i,clientPorts[i],quorumCfgSection + servers[i]);
    mt[i].start();
  }
  for (int i=SERVER_COUNT; i < NEW_SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[i],CONNECTION_TIMEOUT));
    zk[i]=new ZooKeeper("127.0.0.1:" + clientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
  }
  for (int i=0; i < NEW_SERVER_COUNT; i++) {
    Properties cfg=ReconfigLegacyTest.readPropertiesFromFile(mt[i].confFile);
    String filename=cfg.getProperty("dynamicConfigFile","");
    String version=QuorumPeerConfig.getVersionFromFilename(filename);
    Assert.assertNotNull(version);
    String configStr=ReconfigTest.testServerHasConfig(zk[i],newServers,null);
    String quorumVersion=getVersionFromConfigStr(configStr);
    Assert.assertEquals(version,quorumVersion);
    if (i == 0) {
      secondVersion=version;
      Assert.assertTrue(Long.parseLong(secondVersion,16) > Long.parseLong(firstVersion,16));
    }
 else {
      Assert.assertEquals(secondVersion,version);
    }
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i].shutdown();
    zk[i].close();
  }
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test checks that it will backup static file on bootup.
 */
@Test public void testBackupStatic() throws Exception {
  final int SERVER_COUNT=3;
  final int clientPorts[]=new int[SERVER_COUNT];
  StringBuilder sb=new StringBuilder();
  String server;
  for (int i=0; i < SERVER_COUNT; i++) {
    clientPorts[i]=PortAssignment.unique();
    server="server." + i + "=localhost:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ":participant;localhost:"+ clientPorts[i];
    sb.append(server + "\n");
  }
  String currentQuorumCfgSection=sb.toString();
  MainThread mt[]=new MainThread[SERVER_COUNT];
  String[] staticFileContent=new String[SERVER_COUNT];
  String[] staticBackupContent=new String[SERVER_COUNT];
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i]=new MainThread(i,clientPorts[i],currentQuorumCfgSection,false);
    Assert.assertNull("static file backup shouldn't exist before bootup",mt[i].getFileByName("zoo.cfg.bak"));
    staticFileContent[i]=getFileContent(mt[i].confFile);
    mt[i].start();
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[i],CONNECTION_TIMEOUT));
    File backupFile=mt[i].getFileByName("zoo.cfg.bak");
    Assert.assertNotNull("static file backup should exist",backupFile);
    staticBackupContent[i]=getFileContent(backupFile);
    Assert.assertEquals(staticFileContent[i],staticBackupContent[i]);
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i].shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.ReconfigFailureCasesTest </h4><pre class="type-9 type-5 type-3 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testObserverToParticipantConversionFails() throws Exception {
  ClientBase.setupTestEnv();
  final int SERVER_COUNT=4;
  int[][] ports=ReconfigRecoveryTest.generatePorts(SERVER_COUNT);
  HashSet<Integer> observers=new HashSet<Integer>();
  observers.add(3);
  StringBuilder sb=ReconfigRecoveryTest.generateConfig(SERVER_COUNT,ports,observers);
  String currentQuorumCfgSection=sb.toString();
  String nextQuorumCfgSection=currentQuorumCfgSection.replace("observer","participant");
  MainThread mt[]=new MainThread[SERVER_COUNT];
  ZooKeeper zk[]=new ZooKeeper[SERVER_COUNT];
  for (int i=1; i < SERVER_COUNT; i++) {
    mt[i]=new MainThread(i,ports[i][2],currentQuorumCfgSection,true,"100000000");
    mt[i].start();
    zk[i]=new ZooKeeper("127.0.0.1:" + ports[i][2],ClientBase.CONNECTION_TIMEOUT,this);
  }
  for (int i=1; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + ports[i][2],CONNECTION_TIMEOUT * 2));
  }
  try {
    zk[1].reconfig("","",nextQuorumCfgSection,-1,new Stat());
    Assert.fail("Reconfig should have failed with NewConfigNoQuorum");
  }
 catch (  NewConfigNoQuorum e) {
  }
catch (  Exception e) {
    Assert.fail("Reconfig should have failed with NewConfigNoQuorum");
  }
  ArrayList<String> leavingServers=new ArrayList<String>();
  leavingServers.add("3");
  ReconfigTest.reconfig(zk[1],null,leavingServers,null,-1);
  ReconfigTest.testNormalOperation(zk[2],zk[3]);
  ReconfigTest.testServerHasConfig(zk[3],null,leavingServers);
  List<String> newMembers=Arrays.asList(nextQuorumCfgSection.split("\n"));
  ReconfigTest.reconfig(zk[1],null,null,newMembers,-1);
  ReconfigTest.testNormalOperation(zk[2],zk[3]);
  for (int i=1; i < SERVER_COUNT; i++) {
    ReconfigTest.testServerHasConfig(zk[i],newMembers,null);
  }
  for (int i=1; i < SERVER_COUNT; i++) {
    zk[i].close();
    mt[i].shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.ReconfigLegacyTest </h4><pre class="type-9 type-5 type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test checks that when started with a single static config file the
 * servers will create a valid dynamic config file. Also checks that when
 * the static config includes a clientPort but the dynamic definition also
 * includes it, the static definition is erased.
 */
@Test public void testConfigFileBackwardCompatibility() throws Exception {
  final int clientPorts[]=new int[SERVER_COUNT];
  StringBuilder sb=new StringBuilder();
  String server;
  ArrayList<String> allServers=new ArrayList<String>();
  for (int i=0; i < SERVER_COUNT; i++) {
    clientPorts[i]=PortAssignment.unique();
    server="server." + i + "=localhost:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ":participant;localhost:"+ clientPorts[i];
    allServers.add(server);
    sb.append(server + "\n");
  }
  String currentQuorumCfgSection=sb.toString();
  MainThread mt[]=new MainThread[SERVER_COUNT];
  ZooKeeper zk[]=new ZooKeeper[SERVER_COUNT];
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i]=new MainThread(i,clientPorts[i],currentQuorumCfgSection,false);
    Assert.assertEquals(mt[i].getDynamicFiles().length,0);
    mt[i].start();
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[i],CONNECTION_TIMEOUT));
    zk[i]=new ZooKeeper("127.0.0.1:" + clientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
    File[] dynamicFiles=mt[i].getDynamicFiles();
    Assert.assertTrue(dynamicFiles.length == 1);
    ReconfigTest.testServerHasConfig(zk[i],allServers,null);
    Properties cfg=readPropertiesFromFile(mt[i].confFile);
    for (int j=0; j < SERVER_COUNT; j++) {
      Assert.assertFalse(cfg.containsKey("server." + j));
    }
    Assert.assertTrue(cfg.containsKey("dynamicConfigFile"));
    Assert.assertFalse(cfg.containsKey("clientPort"));
    cfg=readPropertiesFromFile(dynamicFiles[0]);
    for (int j=0; j < SERVER_COUNT; j++) {
      String serverLine=cfg.getProperty("server." + j,"");
      Assert.assertEquals(allServers.get(j),"server." + j + "="+ serverLine);
    }
    Assert.assertFalse(cfg.containsKey("dynamicConfigFile"));
  }
  ReconfigTest.testNormalOperation(zk[0],zk[1]);
  for (int i=0; i < SERVER_COUNT; i++) {
    zk[i].close();
    mt[i].shutdown();
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i].start();
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[i],CONNECTION_TIMEOUT));
    zk[i]=new ZooKeeper("127.0.0.1:" + clientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
    ReconfigTest.testServerHasConfig(zk[i],allServers,null);
  }
  ReconfigTest.testNormalOperation(zk[0],zk[1]);
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i].shutdown();
    zk[i].close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.ReconfigRecoveryTest </h4><pre class="type-9 type-5 type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests conversion of observer to participant AFTER new config was already
 * committed. Old config: servers 0 (participant), 1 (participant), 2
 * (observer) New config: servers 2 (participant), 3 (participant) We start
 * server 2 with old config and start server 3 with new config. All other
 * servers are down. In order to terminate FLE, server 3 must 'convince'
 * server 2 to adopt the new config and turn into a participant.
 */
@Test public void testObserverConvertedToParticipantDuringFLE() throws Exception {
  ClientBase.setupTestEnv();
  final int SERVER_COUNT=4;
  int[][] ports=generatePorts(SERVER_COUNT);
  String currentQuorumCfgSection, nextQuorumCfgSection;
  HashSet<Integer> observers=new HashSet<Integer>();
  observers.add(2);
  StringBuilder sb=generateConfig(3,ports,observers);
  currentQuorumCfgSection=sb.toString();
  ArrayList<String> allServersNext=new ArrayList<String>();
  sb=new StringBuilder();
  for (int i=2; i < SERVER_COUNT; i++) {
    String server="server." + i + "=localhost:"+ ports[i][0]+ ":"+ ports[i][1]+ ":participant;localhost:"+ ports[i][2];
    allServersNext.add(server);
    sb.append(server + "\n");
  }
  nextQuorumCfgSection=sb.toString();
  MainThread mt[]=new MainThread[SERVER_COUNT];
  ZooKeeper zk[]=new ZooKeeper[SERVER_COUNT];
  mt[2]=new MainThread(2,ports[2][2],currentQuorumCfgSection,true,"100000000");
  mt[2].start();
  zk[2]=new ZooKeeper("127.0.0.1:" + ports[2][2],ClientBase.CONNECTION_TIMEOUT,this);
  mt[3]=new MainThread(3,ports[3][2],nextQuorumCfgSection,true,"200000000");
  mt[3].start();
  zk[3]=new ZooKeeper("127.0.0.1:" + ports[3][2],ClientBase.CONNECTION_TIMEOUT,this);
  for (int i=2; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + ports[i][2],CONNECTION_TIMEOUT * 2));
    ReconfigTest.testServerHasConfig(zk[i],allServersNext,null);
  }
  Assert.assertEquals(nextQuorumCfgSection + "version=200000000",ReconfigTest.testServerHasConfig(zk[2],null,null));
  Assert.assertEquals(nextQuorumCfgSection + "version=200000000",ReconfigTest.testServerHasConfig(zk[3],null,null));
  ReconfigTest.testNormalOperation(zk[2],zk[2]);
  ReconfigTest.testNormalOperation(zk[3],zk[2]);
  for (int i=2; i < SERVER_COUNT; i++) {
    zk[i].close();
    mt[i].shutdown();
  }
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests conversion of observer to participant during reconfig recovery, new
 * config was not committed yet. Old config: servers 0 (participant), 1
 * (participant), 2 (observer) New config: servers 2 (participant), 3
 * (participant) We start server servers 0, 1, 2 with old config and a .next
 * file indicating a reconfig in progress. We start server 3 with old config
 * + itself in config file. In this scenario server 2 can't be converted to
 * participant during reconfig since we don't gossip about proposed
 * configurations, only about committed ones. This tests that new config can
 * be completed, which requires server 2's ack for the newleader message,
 * even though its an observer.
 */
@Test public void testCurrentObserverIsParticipantInNewConfig() throws Exception {
  ClientBase.setupTestEnv();
  final int SERVER_COUNT=4;
  int[][] ports=generatePorts(SERVER_COUNT);
  String currentQuorumCfg, nextQuorumCfgSection;
  HashSet<Integer> observers=new HashSet<Integer>();
  observers.add(2);
  StringBuilder sb=generateConfig(3,ports,observers);
  currentQuorumCfg=sb.toString();
  MainThread mt[]=new MainThread[SERVER_COUNT];
  ZooKeeper zk[]=new ZooKeeper[SERVER_COUNT];
  for (int i=0; i <= 2; i++) {
    mt[i]=new MainThread(i,ports[i][2],currentQuorumCfg,true,"100000000");
    mt[i].start();
    zk[i]=new ZooKeeper("127.0.0.1:" + ports[i][2],ClientBase.CONNECTION_TIMEOUT,this);
  }
  ReconfigTest.testNormalOperation(zk[0],zk[2]);
  for (int i=0; i <= 2; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + ports[i][2],CONNECTION_TIMEOUT * 2));
  }
  for (int i=0; i <= 2; i++) {
    mt[i].shutdown();
    zk[i].close();
  }
  ArrayList<String> allServersNext=new ArrayList<String>();
  sb=new StringBuilder();
  for (int i=2; i < SERVER_COUNT; i++) {
    String server="server." + i + "=localhost:"+ ports[i][0]+ ":"+ ports[i][1]+ ":participant;localhost:"+ ports[i][2];
    allServersNext.add(server);
    sb.append(server + "\n");
  }
  nextQuorumCfgSection=sb.toString();
  for (int i=0; i <= 2; i++) {
    mt[i].writeTempDynamicConfigFile(nextQuorumCfgSection,"200000000");
    mt[i].start();
    zk[i]=new ZooKeeper("127.0.0.1:" + ports[i][2],ClientBase.CONNECTION_TIMEOUT,this);
  }
  mt[3]=new MainThread(3,ports[3][2],currentQuorumCfg + allServersNext.get(1));
  mt[3].start();
  zk[3]=new ZooKeeper("127.0.0.1:" + ports[3][2],ClientBase.CONNECTION_TIMEOUT,this);
  for (int i=2; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + ports[i][2],CONNECTION_TIMEOUT * 3));
    ReconfigTest.testServerHasConfig(zk[i],allServersNext,null);
  }
  ReconfigTest.testNormalOperation(zk[0],zk[2]);
  ReconfigTest.testNormalOperation(zk[3],zk[1]);
  Assert.assertEquals(nextQuorumCfgSection + "version=200000000",ReconfigTest.testServerHasConfig(zk[2],null,null));
  Assert.assertEquals(nextQuorumCfgSection + "version=200000000",ReconfigTest.testServerHasConfig(zk[3],null,null));
  for (int i=0; i < SERVER_COUNT; i++) {
    zk[i].close();
    mt[i].shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.Zab1_0Test </h4><pre class="type-5 type-3 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * In this test, the leader sets the last accepted epoch to 5. The call
 * to getEpochToPropose should set epoch to 6 and wait until another 
 * follower executes it. If in getEpochToPropose we don't check if
 * lastAcceptedEpoch == epoch, then the call from the subsequent
 * follower with lastAcceptedEpoch = 6 doesn't change the value
 * of epoch, and the test fails. It passes with the fix to predicate.{@link https://issues.apache.org/jira/browse/ZOOKEEPER-1343}
 * @throws Exception
 */
@Test public void testLastAcceptedEpoch() throws Exception {
  File tmpDir=File.createTempFile("test","dir",testData);
  tmpDir.delete();
  tmpDir.mkdir();
  Leader leader=null;
  LeadThread leadThread=null;
  try {
    QuorumPeer peer=createQuorumPeer(tmpDir);
    leader=createMockLeader(tmpDir,peer);
    peer.leader=leader;
    peer.setAcceptedEpoch(5);
    leadThread=new LeadThread(leader);
    leadThread.start();
    while (((MockLeader)leader).getCurrentEpochToPropose() != 6) {
      Thread.sleep(20);
    }
    try {
      long epoch=leader.getEpochToPropose(1,6);
      Assert.assertEquals("New proposed epoch is wrong",7,epoch);
    }
 catch (    Exception e) {
      Assert.fail("Timed out in getEpochToPropose");
    }
  }
  finally {
    if (leader != null) {
      leader.shutdown("end of test");
    }
    if (leadThread != null) {
      leadThread.interrupt();
      leadThread.join();
    }
    TestUtils.deleteFileRecursively(tmpDir);
  }
}

</code></pre>

<br>
<pre class="type-5 type-6 type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testNormalFollowerRun() throws Exception {
  testFollowerConversation(new FollowerConversation(){
    @Override public void converseWithFollower(    InputArchive ia,    OutputArchive oa,    Follower f) throws Exception {
      File tmpDir=File.createTempFile("test","dir",testData);
      tmpDir.delete();
      tmpDir.mkdir();
      File logDir=f.fzk.getTxnLogFactory().getDataDir().getParentFile();
      File snapDir=f.fzk.getTxnLogFactory().getSnapDir().getParentFile();
      try {
        Assert.assertEquals(0,f.self.getAcceptedEpoch());
        Assert.assertEquals(0,f.self.getCurrentEpoch());
        ZKDatabase zkDb=new ZKDatabase(new FileTxnSnapLog(tmpDir,tmpDir));
        final long firstZxid=ZxidUtils.makeZxid(1,1);
        zkDb.processTxn(new TxnHeader(13,1313,firstZxid,33,ZooDefs.OpCode.create),new CreateTxn("/foo","data1".getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,false,1));
        Stat stat=new Stat();
        Assert.assertEquals("data1",new String(zkDb.getData("/foo",stat,null)));
        QuorumPacket qp=new QuorumPacket();
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.FOLLOWERINFO,qp.getType());
        Assert.assertEquals(qp.getZxid(),0);
        LearnerInfo learnInfo=new LearnerInfo();
        ByteBufferInputStream.byteBuffer2Record(ByteBuffer.wrap(qp.getData()),learnInfo);
        Assert.assertEquals(learnInfo.getProtocolVersion(),0x10000);
        Assert.assertEquals(learnInfo.getServerid(),0);
        qp.setType(Leader.LEADERINFO);
        qp.setZxid(ZxidUtils.makeZxid(1,0));
        byte protoBytes[]=new byte[4];
        ByteBuffer.wrap(protoBytes).putInt(0x10000);
        qp.setData(protoBytes);
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACKEPOCH,qp.getType());
        Assert.assertEquals(0,qp.getZxid());
        Assert.assertEquals(ZxidUtils.makeZxid(0,0),ByteBuffer.wrap(qp.getData()).getInt());
        Assert.assertEquals(1,f.self.getAcceptedEpoch());
        Assert.assertEquals(0,f.self.getCurrentEpoch());
        qp.setType(Leader.SNAP);
        qp.setData(new byte[0]);
        qp.setZxid(zkDb.getDataTreeLastProcessedZxid());
        oa.writeRecord(qp,null);
        zkDb.serializeSnapshot(oa);
        oa.writeString("BenWasHere",null);
        qp.setType(Leader.NEWLEADER);
        qp.setZxid(ZxidUtils.makeZxid(1,0));
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACK,qp.getType());
        Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
        Assert.assertEquals(1,f.self.getAcceptedEpoch());
        Assert.assertEquals(1,f.self.getCurrentEpoch());
        Assert.assertEquals(firstZxid,f.fzk.getLastProcessedZxid());
        ZKDatabase zkDb2=new ZKDatabase(new FileTxnSnapLog(logDir,snapDir));
        long lastZxid=zkDb2.loadDataBase();
        Assert.assertEquals("data1",new String(zkDb2.getData("/foo",stat,null)));
        Assert.assertEquals(firstZxid,lastZxid);
        long proposalZxid=ZxidUtils.makeZxid(1,1000);
        proposeSetData(qp,proposalZxid,"data2",2);
        oa.writeRecord(qp,null);
        TrackerWatcher watcher=new TrackerWatcher();
        Assert.assertEquals("data1",new String(f.fzk.getZKDatabase().getData("/foo",stat,watcher)));
        qp.setType(Leader.COMMIT);
        qp.setZxid(proposalZxid);
        oa.writeRecord(qp,null);
        qp.setType(Leader.UPTODATE);
        qp.setZxid(0);
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACK,qp.getType());
        Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACK,qp.getType());
        Assert.assertEquals(proposalZxid,qp.getZxid());
        watcher.waitForChange();
        Assert.assertEquals("data2",new String(f.fzk.getZKDatabase().getData("/foo",stat,null)));
        zkDb2=new ZKDatabase(new FileTxnSnapLog(logDir,snapDir));
        lastZxid=zkDb2.loadDataBase();
        Assert.assertEquals("data2",new String(zkDb2.getData("/foo",stat,null)));
        Assert.assertEquals(proposalZxid,lastZxid);
      }
  finally {
        TestUtils.deleteFileRecursively(tmpDir);
      }
    }
    private void proposeSetData(    QuorumPacket qp,    long zxid,    String data,    int version) throws IOException {
      qp.setType(Leader.PROPOSAL);
      qp.setZxid(zxid);
      TxnHeader hdr=new TxnHeader(4,1414,qp.getZxid(),55,ZooDefs.OpCode.setData);
      SetDataTxn sdt=new SetDataTxn("/foo",data.getBytes(),version);
      ByteArrayOutputStream baos=new ByteArrayOutputStream();
      OutputArchive boa=BinaryOutputArchive.getArchive(baos);
      boa.writeRecord(hdr,null);
      boa.writeRecord(sdt,null);
      qp.setData(baos.toByteArray());
    }
  }
);
}

</code></pre>

<br>
<pre class="type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testInitialAcceptedCurrent() throws Exception {
  File tmpDir=File.createTempFile("test",".dir",testData);
  tmpDir.delete();
  tmpDir.mkdir();
  try {
    FileTxnSnapLog logFactory=new FileTxnSnapLog(tmpDir,tmpDir);
    File version2=new File(tmpDir,"version-2");
    version2.mkdir();
    long zxid=ZxidUtils.makeZxid(3,3);
    logFactory.append(new Request(1,1,ZooDefs.OpCode.error,new TxnHeader(1,1,zxid,1,ZooDefs.OpCode.error),new ErrorTxn(1),zxid));
    logFactory.commit();
    ZKDatabase zkDb=new ZKDatabase(logFactory);
    QuorumPeer peer=new QuorumPeer();
    peer.setZKDatabase(zkDb);
    peer.setTxnFactory(logFactory);
    peer.getLastLoggedZxid();
    Assert.assertEquals(3,peer.getAcceptedEpoch());
    Assert.assertEquals(3,peer.getCurrentEpoch());
    Assert.assertEquals(3,Integer.parseInt(readContentsOfFile(new File(version2,QuorumPeer.CURRENT_EPOCH_FILENAME))));
    Assert.assertEquals(3,Integer.parseInt(readContentsOfFile(new File(version2,QuorumPeer.ACCEPTED_EPOCH_FILENAME))));
  }
  finally {
    TestUtils.deleteFileRecursively(tmpDir);
  }
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testLeaderInElectingFollowers() throws Exception {
  File tmpDir=File.createTempFile("test","dir",testData);
  tmpDir.delete();
  tmpDir.mkdir();
  Leader leader=null;
  try {
    QuorumPeer peer=createQuorumPeer(tmpDir);
    leader=createLeader(tmpDir,peer);
    peer.leader=leader;
    FollowerMockThread f1=new FollowerMockThread(1,leader,false);
    FollowerMockThread f2=new FollowerMockThread(2,leader,false);
    leader.leaderStateSummary=new StateSummary(leader.self.getCurrentEpoch(),leader.zk.getLastProcessedZxid());
    f1.start();
    f2.start();
    f1.join(leader.self.getInitLimit() * leader.self.getTickTime() + 5000);
    f2.join(leader.self.getInitLimit() * leader.self.getTickTime() + 5000);
    Assert.assertTrue(f1.msg + " without waiting for leader",f1.msg == null);
    Assert.assertTrue(f2.msg + " without waiting for leader",f2.msg == null);
  }
  finally {
    if (leader != null) {
      leader.shutdown("end of test");
    }
    TestUtils.deleteFileRecursively(tmpDir);
  }
}

</code></pre>

<br>
<pre class="type-5 type-3 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLeaderInConnectingFollowers() throws Exception {
  File tmpDir=File.createTempFile("test","dir",testData);
  tmpDir.delete();
  tmpDir.mkdir();
  Leader leader=null;
  try {
    QuorumPeer peer=createQuorumPeer(tmpDir);
    leader=createLeader(tmpDir,peer);
    peer.leader=leader;
    peer.setAcceptedEpoch(5);
    FollowerMockThread f1=new FollowerMockThread(1,leader,true);
    FollowerMockThread f2=new FollowerMockThread(2,leader,true);
    f1.start();
    f2.start();
    f1.join(leader.self.getInitLimit() * leader.self.getTickTime() + 5000);
    f2.join(leader.self.getInitLimit() * leader.self.getTickTime() + 5000);
    try {
      long epoch=leader.getEpochToPropose(leader.self.getId(),leader.self.getAcceptedEpoch());
      Assert.assertEquals("leader got wrong epoch from getEpochToPropose",6,epoch);
    }
 catch (    Exception e) {
      Assert.fail("leader timed out in getEpochToPropose");
    }
  }
  finally {
    if (leader != null) {
      leader.shutdown("end of test");
    }
    TestUtils.deleteFileRecursively(tmpDir);
  }
}

</code></pre>

<br>
<pre class="type-5 type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNormalFollowerRunWithDiff() throws Exception {
  testFollowerConversation(new FollowerConversation(){
    @Override public void converseWithFollower(    InputArchive ia,    OutputArchive oa,    Follower f) throws Exception {
      File tmpDir=File.createTempFile("test","dir",testData);
      tmpDir.delete();
      tmpDir.mkdir();
      File logDir=f.fzk.getTxnLogFactory().getDataDir().getParentFile();
      File snapDir=f.fzk.getTxnLogFactory().getSnapDir().getParentFile();
      try {
        Assert.assertEquals(0,f.self.getAcceptedEpoch());
        Assert.assertEquals(0,f.self.getCurrentEpoch());
        ZKDatabase zkDb=new ZKDatabase(new FileTxnSnapLog(tmpDir,tmpDir));
        final long firstZxid=ZxidUtils.makeZxid(1,1);
        zkDb.processTxn(new TxnHeader(13,1313,firstZxid,33,ZooDefs.OpCode.create),new CreateTxn("/foo","data1".getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,false,1));
        Stat stat=new Stat();
        Assert.assertEquals("data1",new String(zkDb.getData("/foo",stat,null)));
        QuorumPacket qp=new QuorumPacket();
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.FOLLOWERINFO,qp.getType());
        Assert.assertEquals(qp.getZxid(),0);
        LearnerInfo learnInfo=new LearnerInfo();
        ByteBufferInputStream.byteBuffer2Record(ByteBuffer.wrap(qp.getData()),learnInfo);
        Assert.assertEquals(learnInfo.getProtocolVersion(),0x10000);
        Assert.assertEquals(learnInfo.getServerid(),0);
        qp.setType(Leader.LEADERINFO);
        qp.setZxid(ZxidUtils.makeZxid(1,0));
        byte protoBytes[]=new byte[4];
        ByteBuffer.wrap(protoBytes).putInt(0x10000);
        qp.setData(protoBytes);
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACKEPOCH,qp.getType());
        Assert.assertEquals(0,qp.getZxid());
        Assert.assertEquals(ZxidUtils.makeZxid(0,0),ByteBuffer.wrap(qp.getData()).getInt());
        Assert.assertEquals(1,f.self.getAcceptedEpoch());
        Assert.assertEquals(0,f.self.getCurrentEpoch());
        qp.setType(Leader.DIFF);
        qp.setData(new byte[0]);
        qp.setZxid(zkDb.getDataTreeLastProcessedZxid());
        oa.writeRecord(qp,null);
        final long createSessionZxid=ZxidUtils.makeZxid(1,2);
        proposeNewSession(qp,createSessionZxid,0x333);
        oa.writeRecord(qp,null);
        qp.setType(Leader.COMMIT);
        qp.setZxid(createSessionZxid);
        oa.writeRecord(qp,null);
        qp.setType(Leader.NEWLEADER);
        qp.setZxid(ZxidUtils.makeZxid(1,0));
        qp.setData(null);
        oa.writeRecord(qp,null);
        qp.setType(Leader.UPTODATE);
        qp.setZxid(0);
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACK,qp.getType());
        Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACK,qp.getType());
        Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
        Assert.assertEquals(1,f.self.getAcceptedEpoch());
        Assert.assertEquals(1,f.self.getCurrentEpoch());
        Assert.assertEquals(createSessionZxid,f.fzk.getLastProcessedZxid());
        ZKDatabase zkDb2=new ZKDatabase(new FileTxnSnapLog(logDir,snapDir));
        zkDb2.loadDataBase();
        LOG.info("zkdb2 sessions:" + zkDb2.getSessions());
        Assert.assertNotNull(zkDb2.getSessionWithTimeOuts().get(4L));
      }
  finally {
        TestUtils.deleteFileRecursively(tmpDir);
      }
    }
    private void proposeNewSession(    QuorumPacket qp,    long zxid,    long sessionId) throws IOException {
      qp.setType(Leader.PROPOSAL);
      qp.setZxid(zxid);
      TxnHeader hdr=new TxnHeader(4,1414,qp.getZxid(),55,ZooDefs.OpCode.createSession);
      CreateSessionTxn cst=new CreateSessionTxn(30000);
      ByteArrayOutputStream baos=new ByteArrayOutputStream();
      OutputArchive boa=BinaryOutputArchive.getArchive(baos);
      boa.writeRecord(hdr,null);
      boa.writeRecord(cst,null);
      qp.setData(baos.toByteArray());
    }
  }
);
}

</code></pre>

<br>
<pre class="type-5 type-6 type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testNormalObserverRun() throws Exception {
  testObserverConversation(new ObserverConversation(){
    @Override public void converseWithObserver(    InputArchive ia,    OutputArchive oa,    Observer o) throws Exception {
      File tmpDir=File.createTempFile("test","dir",testData);
      tmpDir.delete();
      tmpDir.mkdir();
      File logDir=o.zk.getTxnLogFactory().getDataDir().getParentFile();
      File snapDir=o.zk.getTxnLogFactory().getSnapDir().getParentFile();
      try {
        Assert.assertEquals(0,o.self.getAcceptedEpoch());
        Assert.assertEquals(0,o.self.getCurrentEpoch());
        ZKDatabase zkDb=new ZKDatabase(new FileTxnSnapLog(tmpDir,tmpDir));
        final long foo1Zxid=ZxidUtils.makeZxid(1,1);
        final long foo2Zxid=ZxidUtils.makeZxid(1,2);
        zkDb.processTxn(new TxnHeader(13,1313,foo1Zxid,33,ZooDefs.OpCode.create),new CreateTxn("/foo1","data1".getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,false,1));
        zkDb.processTxn(new TxnHeader(13,1313,foo2Zxid,33,ZooDefs.OpCode.create),new CreateTxn("/foo2","data1".getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,false,1));
        Stat stat=new Stat();
        Assert.assertEquals("data1",new String(zkDb.getData("/foo1",stat,null)));
        Assert.assertEquals("data1",new String(zkDb.getData("/foo2",stat,null)));
        QuorumPacket qp=new QuorumPacket();
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.OBSERVERINFO,qp.getType());
        Assert.assertEquals(qp.getZxid(),0);
        LearnerInfo learnInfo=new LearnerInfo();
        ByteBufferInputStream.byteBuffer2Record(ByteBuffer.wrap(qp.getData()),learnInfo);
        Assert.assertEquals(learnInfo.getProtocolVersion(),0x10000);
        Assert.assertEquals(learnInfo.getServerid(),0);
        qp.setType(Leader.LEADERINFO);
        qp.setZxid(ZxidUtils.makeZxid(1,0));
        byte protoBytes[]=new byte[4];
        ByteBuffer.wrap(protoBytes).putInt(0x10000);
        qp.setData(protoBytes);
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACKEPOCH,qp.getType());
        Assert.assertEquals(0,qp.getZxid());
        Assert.assertEquals(ZxidUtils.makeZxid(0,0),ByteBuffer.wrap(qp.getData()).getInt());
        Assert.assertEquals(1,o.self.getAcceptedEpoch());
        Assert.assertEquals(0,o.self.getCurrentEpoch());
        qp.setType(Leader.SNAP);
        qp.setData(new byte[0]);
        qp.setZxid(zkDb.getDataTreeLastProcessedZxid());
        oa.writeRecord(qp,null);
        zkDb.serializeSnapshot(oa);
        oa.writeString("BenWasHere",null);
        qp.setType(Leader.NEWLEADER);
        qp.setZxid(ZxidUtils.makeZxid(1,0));
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACK,qp.getType());
        Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
        Assert.assertEquals(1,o.self.getAcceptedEpoch());
        Assert.assertEquals(1,o.self.getCurrentEpoch());
        Assert.assertEquals(foo2Zxid,o.zk.getLastProcessedZxid());
        ZKDatabase zkDb2=new ZKDatabase(new FileTxnSnapLog(logDir,snapDir));
        long lastZxid=zkDb2.loadDataBase();
        Assert.assertEquals("data1",new String(zkDb2.getData("/foo1",stat,null)));
        Assert.assertEquals(foo2Zxid,lastZxid);
        TrackerWatcher watcher=new TrackerWatcher();
        Assert.assertEquals("data1",new String(o.zk.getZKDatabase().getData("/foo2",stat,watcher)));
        long proposalZxid=ZxidUtils.makeZxid(1,1000);
        proposeSetData(qp,"/foo1",proposalZxid,"data2",2);
        oa.writeRecord(qp,null);
        qp.setType(Leader.COMMIT);
        qp.setZxid(proposalZxid);
        oa.writeRecord(qp,null);
        long informZxid=ZxidUtils.makeZxid(1,1001);
        proposeSetData(qp,"/foo2",informZxid,"data2",2);
        qp.setType(Leader.INFORM);
        oa.writeRecord(qp,null);
        qp.setType(Leader.UPTODATE);
        qp.setZxid(0);
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACK,qp.getType());
        Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
        watcher.waitForChange();
        Assert.assertEquals("data2",new String(o.zk.getZKDatabase().getData("/foo1",stat,null)));
        Assert.assertEquals("data2",new String(o.zk.getZKDatabase().getData("/foo2",stat,null)));
        o.zk.shutdown();
        zkDb2=new ZKDatabase(new FileTxnSnapLog(logDir,snapDir));
        lastZxid=zkDb2.loadDataBase();
        Assert.assertEquals("data2",new String(zkDb2.getData("/foo1",stat,null)));
        Assert.assertEquals("data2",new String(zkDb2.getData("/foo2",stat,null)));
        Assert.assertEquals(informZxid,lastZxid);
      }
  finally {
        TestUtils.deleteFileRecursively(tmpDir);
      }
    }
    private void proposeSetData(    QuorumPacket qp,    String path,    long zxid,    String data,    int version) throws IOException {
      qp.setType(Leader.PROPOSAL);
      qp.setZxid(zxid);
      TxnHeader hdr=new TxnHeader(4,1414,qp.getZxid(),55,ZooDefs.OpCode.setData);
      SetDataTxn sdt=new SetDataTxn(path,data.getBytes(),version);
      ByteArrayOutputStream baos=new ByteArrayOutputStream();
      OutputArchive boa=BinaryOutputArchive.getArchive(baos);
      boa.writeRecord(hdr,null);
      boa.writeRecord(sdt,null);
      qp.setData(baos.toByteArray());
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.AtomicFileOutputStreamTest </h4><pre class="type-5 type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test case where there is no existing file
 */
@Test public void testWriteNewFile() throws IOException {
  OutputStream fos=new AtomicFileOutputStream(dstFile);
  assertFalse(dstFile.exists());
  fos.write(TEST_STRING.getBytes());
  fos.flush();
  assertFalse(dstFile.exists());
  fos.close();
  assertTrue(dstFile.exists());
  String readBackData=ClientBase.readFile(dstFile);
  assertEquals(TEST_STRING,readBackData);
}

</code></pre>

<br>
<pre class="type-5 type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test case where there is no existing file
 */
@Test public void testOverwriteFile() throws IOException {
  assertTrue("Creating empty dst file",dstFile.createNewFile());
  OutputStream fos=new AtomicFileOutputStream(dstFile);
  assertTrue("Empty file still exists",dstFile.exists());
  fos.write(TEST_STRING.getBytes());
  fos.flush();
  assertEquals("",ClientBase.readFile(dstFile));
  fos.close();
  String readBackData=ClientBase.readFile(dstFile);
  assertEquals(TEST_STRING,readBackData);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ClientPortBindTest </h4><pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Verify that the server binds to the specified address
 */
@Test public void testBindByAddress() throws Exception {
  String bindAddress=null;
  Enumeration<NetworkInterface> intfs=NetworkInterface.getNetworkInterfaces();
  while (intfs.hasMoreElements()) {
    NetworkInterface i=intfs.nextElement();
    if (i.isLoopback()) {
      Enumeration<InetAddress> addrs=i.getInetAddresses();
      if (addrs.hasMoreElements()) {
        bindAddress=addrs.nextElement().getHostAddress();
      }
    }
  }
  if (bindAddress == null) {
    LOG.warn("Unable to determine loop back address, skipping test");
    return;
  }
  final int PORT=PortAssignment.unique();
  LOG.info("Using " + bindAddress + " as the bind address");
  final String HOSTPORT=bindAddress + ":" + PORT;
  LOG.info("Using " + HOSTPORT + " as the host/port");
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(new InetSocketAddress(bindAddress,PORT),-1);
  f.startup(zks);
  LOG.info("starting up the the server, waiting");
  Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  startSignal=new CountDownLatch(1);
  ZooKeeper zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
  try {
    startSignal.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS);
    Assert.assertTrue("count == 0",startSignal.getCount() == 0);
    zk.close();
  }
  finally {
    f.shutdown();
    zks.shutdown();
    Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ClientTest </h4><pre class="type-5 type-6 type-15 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSequentialNodeData() throws Exception {
  ZooKeeper zk=null;
  String queue_handle="/queue";
  try {
    zk=createClient();
    zk.create(queue_handle,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    zk.create(queue_handle + "/element","0".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    zk.create(queue_handle + "/element","1".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    List<String> children=zk.getChildren(queue_handle,true);
    Assert.assertEquals(children.size(),2);
    String child1=children.get(0);
    String child2=children.get(1);
    int compareResult=child1.compareTo(child2);
    Assert.assertNotSame(compareResult,0);
    if (compareResult < 0) {
    }
 else {
      String temp=child1;
      child1=child2;
      child2=temp;
    }
    String child1data=new String(zk.getData(queue_handle + "/" + child1,false,null));
    String child2data=new String(zk.getData(queue_handle + "/" + child2,false,null));
    Assert.assertEquals(child1data,"0");
    Assert.assertEquals(child2data,"1");
  }
  finally {
    if (zk != null) {
      zk.close();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.CnxManagerTest </h4><pre class="type-9 type-5 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
"></span><br>
@Test public void testWorkerThreads() throws Exception {
  ArrayList<QuorumPeer> peerList=new ArrayList<QuorumPeer>();
  try {
    for (int sid=0; sid < 3; sid++) {
      QuorumPeer peer=new QuorumPeer(peers,peerTmpdir[sid],peerTmpdir[sid],peerClientPort[sid],3,sid,1000,2,2);
      LOG.info("Starting peer {}",peer.getId());
      peer.start();
      peerList.add(sid,peer);
    }
    String failure=verifyThreadCount(peerList,4);
    Assert.assertNull(failure,failure);
    for (int myid=0; myid < 3; myid++) {
      for (int i=0; i < 5; i++) {
        QuorumPeer peer=peerList.get(myid);
        LOG.info("Round {}, halting peer ",new Object[]{i,peer.getId()});
        peer.shutdown();
        peerList.remove(myid);
        failure=verifyThreadCount(peerList,2);
        Assert.assertNull(failure,failure);
        peer=new QuorumPeer(peers,peerTmpdir[myid],peerTmpdir[myid],peerClientPort[myid],3,myid,1000,2,2);
        LOG.info("Round {}, restarting peer ",new Object[]{i,peer.getId()});
        peer.start();
        peerList.add(myid,peer);
        failure=verifyThreadCount(peerList,4);
        Assert.assertNull(failure,failure);
      }
    }
  }
  finally {
    for (    QuorumPeer quorumPeer : peerList) {
      quorumPeer.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.DisconnectedWatcherTest </h4><pre class="type-5 type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testChildWatcherAutoResetWithChroot() throws Exception {
  ZooKeeper zk1=createClient();
  zk1.create("/ch1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher watcher=new MyWatcher();
  ZooKeeper zk2=createClient(watcher,hostPort + "/ch1");
  zk2.getChildren("/",true);
  zk1.create("/youdontmatter1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk1.create("/ch1/youshouldmatter1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  WatchedEvent e=watcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
  Assert.assertNotNull(e);
  Assert.assertEquals(EventType.NodeChildrenChanged,e.getType());
  Assert.assertEquals("/",e.getPath());
  MyWatcher childWatcher=new MyWatcher();
  zk2.getChildren("/",childWatcher);
  stopServer();
  watcher.waitForDisconnected(3000);
  startServer();
  watcher.waitForConnected(3000);
  zk1.create("/ch1/youshouldmatter2",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  e=childWatcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
  Assert.assertNotNull(e);
  Assert.assertEquals(EventType.NodeChildrenChanged,e.getType());
  Assert.assertEquals("/",e.getPath());
}

</code></pre>

<br>
<pre class="type-5 type-10 type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testManyChildWatchersAutoReset() throws Exception {
  ZooKeeper zk1=createClient();
  MyWatcher watcher=new MyWatcher();
  ZooKeeper zk2=createClient(watcher);
  String pathBase="/long-path-000000000-111111111-222222222-333333333-444444444-" + "555555555-666666666-777777777-888888888-999999999";
  zk1.create(pathBase,null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  List<String> paths=new ArrayList<String>();
  for (int i=0; i < 10000; i++) {
    String path=zk1.create(pathBase + "/ch-",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    paths.add(path);
  }
  MyWatcher childWatcher=new MyWatcher();
  int i=0;
  for (  String path : paths) {
    if (i % 3 == 0) {
      zk2.getChildren(path,childWatcher);
    }
 else     if (i % 3 == 1) {
      zk2.exists(path + "/foo",childWatcher);
    }
 else     if (i % 3 == 2) {
      zk2.getData(path,childWatcher,null);
    }
    i++;
  }
  stopServer();
  watcher.waitForDisconnected(30000);
  startServer();
  watcher.waitForConnected(30000);
  i=0;
  for (  String path : paths) {
    if (i % 3 == 0) {
      zk1.create(path + "/ch",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
      WatchedEvent e=childWatcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
      Assert.assertNotNull(e);
      Assert.assertEquals(EventType.NodeChildrenChanged,e.getType());
      Assert.assertEquals(path,e.getPath());
    }
 else     if (i % 3 == 1) {
      zk1.create(path + "/foo",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
      WatchedEvent e=childWatcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
      Assert.assertNotNull(e);
      Assert.assertEquals(EventType.NodeCreated,e.getType());
      Assert.assertEquals(path + "/foo",e.getPath());
    }
 else     if (i % 3 == 2) {
      zk1.setData(path,new byte[]{1,2,3},-1);
      WatchedEvent e=childWatcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
      Assert.assertNotNull(e);
      Assert.assertEquals(EventType.NodeDataChanged,e.getType());
      Assert.assertEquals(path,e.getPath());
    }
    i++;
  }
}

</code></pre>

<br>
<pre class="type-5 type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDefaultWatcherAutoResetWithChroot() throws Exception {
  ZooKeeper zk1=createClient();
  zk1.create("/ch1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher watcher=new MyWatcher();
  ZooKeeper zk2=createClient(watcher,hostPort + "/ch1");
  zk2.getChildren("/",true);
  zk1.create("/youdontmatter1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk1.create("/ch1/youshouldmatter1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  WatchedEvent e=watcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
  Assert.assertNotNull(e);
  Assert.assertEquals(EventType.NodeChildrenChanged,e.getType());
  Assert.assertEquals("/",e.getPath());
  zk2.getChildren("/",true);
  stopServer();
  watcher.waitForDisconnected(3000);
  startServer();
  watcher.waitForConnected(3000);
  zk1.create("/ch1/youshouldmatter2",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  e=watcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
  Assert.assertNotNull(e);
  Assert.assertEquals(EventType.NodeChildrenChanged,e.getType());
  Assert.assertEquals("/",e.getPath());
}

</code></pre>

<br>
<pre class="type-5 type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeepChildWatcherAutoResetWithChroot() throws Exception {
  ZooKeeper zk1=createClient();
  zk1.create("/ch1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk1.create("/ch1/here",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk1.create("/ch1/here/we",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk1.create("/ch1/here/we/are",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher watcher=new MyWatcher();
  ZooKeeper zk2=createClient(watcher,hostPort + "/ch1/here/we");
  zk2.getChildren("/are",true);
  zk1.create("/ch1/here/we/are/now",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  WatchedEvent e=watcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
  Assert.assertNotNull(e);
  Assert.assertEquals(EventType.NodeChildrenChanged,e.getType());
  Assert.assertEquals("/are",e.getPath());
  MyWatcher childWatcher=new MyWatcher();
  zk2.getChildren("/are",childWatcher);
  stopServer();
  watcher.waitForDisconnected(3000);
  startServer();
  watcher.waitForConnected(3000);
  zk1.create("/ch1/here/we/are/again",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  e=childWatcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
  Assert.assertNotNull(e);
  Assert.assertEquals(EventType.NodeChildrenChanged,e.getType());
  Assert.assertEquals("/are",e.getPath());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.FLETest </h4><pre class="type-5 type-10 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testJoinInconsistentEnsemble() throws Exception {
  int sid;
  QuorumPeer peer;
  int waitTime=10 * 1000;
  ArrayList<QuorumPeer> peerList=new ArrayList<QuorumPeer>();
  for (sid=0; sid < 3; sid++) {
    peers.put(Long.valueOf(sid),new QuorumServer(sid,new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",PortAssignment.unique())));
    tmpdir[sid]=ClientBase.createTmpDir();
    port[sid]=PortAssignment.unique();
  }
  for (sid=0; sid < 2; sid++) {
    peer=new QuorumPeer(peers,tmpdir[sid],tmpdir[sid],port[sid],3,sid,2000,2,2);
    LOG.info("Starting peer " + peer.getId());
    peer.start();
    peerList.add(sid,peer);
  }
  peer=peerList.get(0);
  VerifyState v1=new VerifyState(peerList.get(0));
  v1.start();
  v1.join(waitTime);
  Assert.assertFalse("Unable to form cluster in " + waitTime + " ms",!v1.isSuccess());
  long leaderSid=peer.getCurrentVote().getId();
  long zxid=peer.getCurrentVote().getZxid();
  long electionEpoch=peer.getCurrentVote().getElectionEpoch();
  ServerState state=peer.getCurrentVote().getState();
  long peerEpoch=peer.getCurrentVote().getPeerEpoch();
  Vote newVote=new Vote(leaderSid,zxid + 100,electionEpoch + 100,peerEpoch,state);
  peer.setCurrentVote(newVote);
  peer=new QuorumPeer(peers,tmpdir[2],tmpdir[2],port[2],3,2,2000,2,2);
  LOG.info("Starting peer " + peer.getId());
  peer.start();
  peerList.add(sid,peer);
  v1=new VerifyState(peer);
  v1.start();
  v1.join(waitTime);
  if (v1.isAlive()) {
    Assert.fail("Peer " + peer.getId() + " failed to join the cluster "+ "within "+ waitTime+ " ms");
  }
  for (int id=0; id < 3; id++) {
    peer=peerList.get(id);
    if (peer != null) {
      peer.shutdown();
    }
  }
}

</code></pre>

<br>
<pre class="type-5 type-10 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testJoin() throws Exception {
  int sid;
  QuorumPeer peer;
  int waitTime=10 * 1000;
  ArrayList<QuorumPeer> peerList=new ArrayList<QuorumPeer>();
  for (sid=0; sid < 3; sid++) {
    port[sid]=PortAssignment.unique();
    peers.put(Long.valueOf(sid),new QuorumServer(sid,new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",port[sid])));
    tmpdir[sid]=ClientBase.createTmpDir();
  }
  for (sid=0; sid < 2; sid++) {
    peer=new QuorumPeer(peers,tmpdir[sid],tmpdir[sid],port[sid],3,sid,2000,2,2);
    LOG.info("Starting peer " + peer.getId());
    peer.start();
    peerList.add(sid,peer);
  }
  peer=peerList.get(0);
  VerifyState v1=new VerifyState(peerList.get(0));
  v1.start();
  v1.join(waitTime);
  Assert.assertFalse("Unable to form cluster in " + waitTime + " ms",!v1.isSuccess());
  peer=new QuorumPeer(peers,tmpdir[sid],tmpdir[sid],port[sid],3,sid,2000,2,2);
  LOG.info("Starting peer " + peer.getId());
  peer.start();
  peerList.add(sid,peer);
  v1=new VerifyState(peer);
  v1.start();
  v1.join(waitTime);
  if (v1.isAlive()) {
    Assert.fail("Peer " + peer.getId() + " failed to join the cluster "+ "within "+ waitTime+ " ms");
  }
 else   if (!v1.isSuccess()) {
    Assert.fail("Incorrect LEADING state for peer " + peer.getId());
  }
  for (int id=0; id < 3; id++) {
    peer=peerList.get(id);
    if (peer != null) {
      peer.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.FollowerResyncConcurrencyTest </h4><pre class="type-5 type-10 type-3 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify that the server is sending the proper zxid, and as a result
 * the watch doesn't fire. See ZOOKEEPER-1412.
 */
@Test public void testFollowerWatcherResync() throws Exception {
  QuorumUtil qu=new QuorumUtil(1);
  qu.startAll();
  int index=1;
  while (qu.getPeer(index).peer.follower == null) {
    index++;
  }
  LOG.info("Connecting to follower: {}",index);
  TestableZooKeeper zk1=createTestableClient("localhost:" + qu.getPeer(index).peer.getClientPort());
  zk1.create("/foo","foo".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher watcher=new MyWatcher();
  TestableZooKeeper zk2=createTestableClient(watcher,"localhost:" + qu.getPeer(index).peer.getClientPort());
  zk2.exists("/foo",true);
  watcher.reset();
  zk2.testableConnloss();
  if (!watcher.clientConnected.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS)) {
    fail("Unable to connect to server");
  }
  assertArrayEquals("foo".getBytes(),zk2.getData("/foo",false,null));
  assertNull(watcher.events.poll(5,TimeUnit.SECONDS));
  zk1.close();
  zk2.close();
  qu.shutdownAll();
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * See ZOOKEEPER-1319 - verify that a lagging follwer resyncs correctly
 * 1) start with down quorum
 * 2) start leader/follower1, add some data
 * 3) restart leader/follower1
 * 4) start follower2
 * 5) verify data consistency across the ensemble
 * @throws Exception
 */
@Test public void testLaggingFollowerResyncsUnderNewEpoch() throws Exception {
  CountdownWatcher watcher1=new CountdownWatcher();
  CountdownWatcher watcher2=new CountdownWatcher();
  CountdownWatcher watcher3=new CountdownWatcher();
  QuorumUtil qu=new QuorumUtil(1);
  qu.shutdownAll();
  qu.start(1);
  qu.start(2);
  Assert.assertTrue("Waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + qu.getPeer(1).clientPort,ClientBase.CONNECTION_TIMEOUT));
  Assert.assertTrue("Waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + qu.getPeer(2).clientPort,ClientBase.CONNECTION_TIMEOUT));
  ZooKeeper zk1=createClient(qu.getPeer(1).peer.getClientPort(),watcher1);
  LOG.info("zk1 has session id 0x{}",Long.toHexString(zk1.getSessionId()));
  final String resyncPath="/resyncundernewepoch";
  zk1.create(resyncPath,null,ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk1.close();
  qu.shutdown(1);
  qu.shutdown(2);
  Assert.assertTrue("Waiting for server down",ClientBase.waitForServerDown("127.0.0.1:" + qu.getPeer(1).clientPort,ClientBase.CONNECTION_TIMEOUT));
  Assert.assertTrue("Waiting for server down",ClientBase.waitForServerDown("127.0.0.1:" + qu.getPeer(2).clientPort,ClientBase.CONNECTION_TIMEOUT));
  qu.start(1);
  qu.start(2);
  Assert.assertTrue("Waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + qu.getPeer(1).clientPort,ClientBase.CONNECTION_TIMEOUT));
  Assert.assertTrue("Waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + qu.getPeer(2).clientPort,ClientBase.CONNECTION_TIMEOUT));
  qu.start(3);
  Assert.assertTrue("Waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + qu.getPeer(3).clientPort,ClientBase.CONNECTION_TIMEOUT));
  zk1=createClient(qu.getPeer(1).peer.getClientPort(),watcher1);
  LOG.info("zk1 has session id 0x{}",Long.toHexString(zk1.getSessionId()));
  assertNotNull("zk1 has data",zk1.exists(resyncPath,false));
  final ZooKeeper zk2=createClient(qu.getPeer(2).peer.getClientPort(),watcher2);
  LOG.info("zk2 has session id 0x{}",Long.toHexString(zk2.getSessionId()));
  assertNotNull("zk2 has data",zk2.exists(resyncPath,false));
  final ZooKeeper zk3=createClient(qu.getPeer(3).peer.getClientPort(),watcher3);
  LOG.info("zk3 has session id 0x{}",Long.toHexString(zk3.getSessionId()));
  assertNotNull("zk3 has data",zk3.exists(resyncPath,false));
  zk1.close();
  zk2.close();
  zk3.close();
  qu.shutdownAll();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.FourLetterWordsTest </h4><pre class="type-5 type-2 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSetTraceMask() throws Exception {
  String gtmkResp=sendRequest("gtmk");
  Assert.assertNotNull(gtmkResp);
  gtmkResp=gtmkResp.trim();
  Assert.assertFalse(gtmkResp.isEmpty());
  long formerMask=Long.valueOf(gtmkResp);
  try {
    verify(buildSetTraceMaskRequest(0),"0");
    verify("gtmk","0");
  }
  finally {
    sendRequest(buildSetTraceMaskRequest(formerMask));
  }
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testValidateConsOutput() throws Exception {
  ZooKeeper zk1=createClient();
  ZooKeeper zk2=createClient();
  String resp=sendRequest("cons");
  BufferedReader in=new BufferedReader(new StringReader(resp));
  String line;
  int count=0;
  while ((line=in.readLine()) != null && line.length() > 0) {
    count++;
    Assert.assertTrue(line,Pattern.matches("^ /.*:\\d+\\[\\d+\\]\\(queued=\\d+,recved=\\d+,sent=\\d+.*\\)$",line));
  }
  Assert.assertTrue(count >= 2);
  zk1.close();
  zk2.close();
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testValidateStatOutput() throws Exception {
  ZooKeeper zk1=createClient();
  ZooKeeper zk2=createClient();
  String resp=sendRequest("stat");
  BufferedReader in=new BufferedReader(new StringReader(resp));
  String line;
  line=in.readLine();
  Assert.assertTrue(Pattern.matches("^.*\\s\\d+\\.\\d+\\.\\d+-.*$",line));
  Assert.assertTrue(Pattern.matches("^Clients:$",in.readLine()));
  int count=0;
  while ((line=in.readLine()).length() > 0) {
    count++;
    Assert.assertTrue(Pattern.matches("^ /.*:\\d+\\[\\d+\\]\\(queued=\\d+,recved=\\d+,sent=\\d+\\)$",line));
  }
  Assert.assertTrue(count >= 2);
  line=in.readLine();
  Assert.assertTrue(Pattern.matches("^Latency min/avg/max: \\d+/\\d+/\\d+$",line));
  line=in.readLine();
  Assert.assertTrue(Pattern.matches("^Received: \\d+$",line));
  line=in.readLine();
  Assert.assertTrue(Pattern.matches("^Sent: \\d+$",line));
  line=in.readLine();
  Assert.assertTrue(Pattern.matches("^Connections: \\d+$",line));
  line=in.readLine();
  Assert.assertTrue(Pattern.matches("^Outstanding: \\d+$",line));
  line=in.readLine();
  Assert.assertTrue(Pattern.matches("^Zxid: 0x[\\da-fA-F]+$",line));
  line=in.readLine();
  Assert.assertTrue(Pattern.matches("^Mode: .*$",line));
  line=in.readLine();
  Assert.assertTrue(Pattern.matches("^Node count: \\d+$",line));
  zk1.close();
  zk2.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.LoadFromLogTest </h4><pre class="type-5 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test we can restore the snapshot that has data ahead of the zxid
 * of the snapshot file.
 */
@Test public void testRestore() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(10000);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=getConnectedZkClient();
  String lastPath=null;
  try {
    zk.create("/invalidsnap",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    for (int i=0; i < NUM_MESSAGES; i++) {
      lastPath=zk.create("/invalidsnap/test-",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    }
  }
  finally {
    zk.close();
  }
  String[] tokens=lastPath.split("-");
  String expectedPath="/invalidsnap/test-" + String.format("%010d",(new Integer(tokens[1])).intValue() + 1);
  long eZxid=zks.getZKDatabase().getDataTreeLastProcessedZxid();
  zks.getZKDatabase().setlastProcessedZxid(zks.getZKDatabase().getDataTreeLastProcessedZxid() - 10);
  LOG.info("Set lastProcessedZxid to " + zks.getZKDatabase().getDataTreeLastProcessedZxid());
  zks.takeSnapshot();
  zks.shutdown();
  f.shutdown();
  zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(10000);
  f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  connected=false;
  long fZxid=zks.getZKDatabase().getDataTreeLastProcessedZxid();
  Assert.assertTrue("Restore failed expected zxid=" + eZxid + " found="+ fZxid,fZxid == eZxid);
  zk=getConnectedZkClient();
  String[] children;
  String path;
  try {
    children=zk.getChildren("/invalidsnap",false).toArray(new String[0]);
    path=zk.create("/invalidsnap/test-",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
  }
  finally {
    zk.close();
  }
  LOG.info("Expected " + expectedPath + " found "+ path);
  Assert.assertTrue("Error in sequential znode creation expected " + expectedPath + " found "+ path,path.equals(expectedPath));
  Assert.assertTrue("Unexpected number of children " + children.length + " expected "+ NUM_MESSAGES,(children.length == NUM_MESSAGES));
  f.shutdown();
  zks.shutdown();
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * test that we fail to load txnlog of a request zxid that is older
 * than what exist on disk
 * @throws Exception an exception might be thrown here
 */
@Test public void testLoadFailure() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(50);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
  try {
    for (int i=0; i < NUM_MESSAGES; i++) {
      zk.create("/data-",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    }
  }
  finally {
    zk.close();
  }
  f.shutdown();
  Assert.assertTrue("waiting for server to shutdown",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
  File logDir=new File(tmpDir,FileTxnSnapLog.version + FileTxnSnapLog.VERSION);
  File[] logFiles=FileTxnLog.getLogFiles(logDir.listFiles(),0);
  Assert.assertTrue(logFiles.length > 4);
  Assert.assertTrue("delete the first log file",logFiles[0].delete());
  long secondStartZxid=Util.getZxidFromName(logFiles[1].getName(),"log");
  FileTxnLog txnLog=new FileTxnLog(logDir);
  TxnIterator itr=txnLog.read(1,false);
  Assert.assertEquals(secondStartZxid,itr.getHeader().getZxid());
  itr=txnLog.read(secondStartZxid,false);
  Assert.assertEquals(secondStartZxid,itr.getHeader().getZxid());
  Assert.assertTrue(itr.next());
  long nextZxid=itr.getHeader().getZxid();
  itr=txnLog.read(nextZxid,false);
  Assert.assertEquals(secondStartZxid,itr.getHeader().getZxid());
  long thirdStartZxid=Util.getZxidFromName(logFiles[2].getName(),"log");
  itr=txnLog.read(thirdStartZxid,false);
  Assert.assertEquals(secondStartZxid,itr.getHeader().getZxid());
  Assert.assertTrue(itr.next());
  nextZxid=itr.getHeader().getZxid();
  itr=txnLog.read(nextZxid,false);
  Assert.assertEquals(secondStartZxid,itr.getHeader().getZxid());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ReconfigTest </h4><pre class="type-9 type-5 type-10 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testRoleChange() throws Exception {
  qu=new QuorumUtil(1);
  qu.disableJMXTest=true;
  qu.startAll();
  ZooKeeper[] zkArr=createHandles(qu);
  List<String> joiningServers=new ArrayList<String>();
  int leaderIndex=getLeaderId(qu);
  int changingIndex=(leaderIndex == 1) ? 2 : 1;
  String newRole="observer";
  for (int i=0; i < 4; i++) {
    ZooKeeper zk1=(changingIndex == leaderIndex) ? zkArr[leaderIndex] : zkArr[(leaderIndex % qu.ALL) + 1];
    joiningServers.add("server." + changingIndex + "=localhost:"+ qu.getPeer(changingIndex).peer.getQuorumAddress().getPort()+ ":"+ qu.getPeer(changingIndex).peer.getElectionAddress().getPort()+ ":"+ newRole+ ";localhost:"+ qu.getPeer(changingIndex).peer.getClientPort());
    reconfig(zk1,joiningServers,null,null,-1);
    testNormalOperation(zkArr[changingIndex],zk1);
    if (newRole.equals("observer")) {
      Assert.assertTrue(qu.getPeer(changingIndex).peer.observer != null && qu.getPeer(changingIndex).peer.follower == null && qu.getPeer(changingIndex).peer.leader == null);
      Assert.assertTrue(qu.getPeer(changingIndex).peer.getPeerState() == ServerState.OBSERVING);
    }
 else {
      Assert.assertTrue(qu.getPeer(changingIndex).peer.observer == null && (qu.getPeer(changingIndex).peer.follower != null || qu.getPeer(changingIndex).peer.leader != null));
      Assert.assertTrue(qu.getPeer(changingIndex).peer.getPeerState() == ServerState.FOLLOWING || qu.getPeer(changingIndex).peer.getPeerState() == ServerState.LEADING);
    }
    joiningServers.clear();
    if (newRole.equals("observer")) {
      newRole="participant";
    }
 else {
      newRole="observer";
      leaderIndex=getLeaderId(qu);
      changingIndex=leaderIndex;
    }
  }
  closeAllHandles(zkArr);
}

</code></pre>

<br>
<pre class="type-5 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * 1. removes and adds back two servers (incl leader). One of the servers is added back as observer
 * 2. tests that reconfig fails if quorum of new config is not up
 * 3. tests that a server that's not up during reconfig learns the new config when it comes up
 * @throws Exception
 */
@Test public void testRemoveAddTwo() throws Exception {
  qu=new QuorumUtil(2);
  qu.disableJMXTest=true;
  qu.startAll();
  ZooKeeper[] zkArr=createHandles(qu);
  List<String> leavingServers=new ArrayList<String>();
  List<String> joiningServers=new ArrayList<String>();
  int leaderIndex=getLeaderId(qu);
  int leavingIndex1=leaderIndex;
  int leavingIndex2=(leaderIndex == 1) ? 2 : 1;
  int stayingIndex1=1, stayingIndex2=1, stayingIndex3=1;
  while (stayingIndex1 == leavingIndex1 || stayingIndex1 == leavingIndex2)   stayingIndex1++;
  while (stayingIndex2 == leavingIndex1 || stayingIndex2 == leavingIndex2 || stayingIndex2 == stayingIndex1)   stayingIndex2++;
  while (stayingIndex3 == leavingIndex1 || stayingIndex3 == leavingIndex2 || stayingIndex3 == stayingIndex1 || stayingIndex3 == stayingIndex2)   stayingIndex3++;
  leavingServers.add(Integer.toString(leavingIndex1));
  leavingServers.add(Integer.toString(leavingIndex2));
  joiningServers.add("server." + leavingIndex1 + "=localhost:"+ qu.getPeer(leavingIndex1).peer.getQuorumAddress().getPort()+ ":"+ qu.getPeer(leavingIndex1).peer.getElectionAddress().getPort()+ ":participant;localhost:"+ qu.getPeer(leavingIndex1).peer.getClientPort());
  joiningServers.add("server." + leavingIndex2 + "=localhost:"+ qu.getPeer(leavingIndex2).peer.getQuorumAddress().getPort()+ ":"+ qu.getPeer(leavingIndex2).peer.getElectionAddress().getPort()+ ":observer;localhost:"+ qu.getPeer(leavingIndex2).peer.getClientPort());
  qu.shutdown(leavingIndex1);
  qu.shutdown(leavingIndex2);
  reconfig(zkArr[stayingIndex2],null,leavingServers,null,-1);
  qu.shutdown(stayingIndex2);
  testServerHasConfig(zkArr[stayingIndex1],null,leavingServers);
  testServerHasConfig(zkArr[stayingIndex3],null,leavingServers);
  testNormalOperation(zkArr[stayingIndex1],zkArr[stayingIndex3]);
  Thread.sleep(10000);
  try {
    reconfig(zkArr[stayingIndex1],joiningServers,null,null,-1);
    Assert.fail("reconfig completed successfully even though there is no quorum up in new config!");
  }
 catch (  KeeperException.NewConfigNoQuorum e) {
  }
  qu.restart(stayingIndex2);
  reconfig(zkArr[stayingIndex1],joiningServers,null,null,-1);
  testNormalOperation(zkArr[stayingIndex2],zkArr[stayingIndex3]);
  testServerHasConfig(zkArr[stayingIndex2],joiningServers,null);
  qu.restart(leavingIndex2);
  Assert.assertTrue(qu.getPeer(leavingIndex2).peer.getPeerState() == ServerState.OBSERVING);
  testNormalOperation(zkArr[stayingIndex2],zkArr[leavingIndex2]);
  testServerHasConfig(zkArr[leavingIndex2],joiningServers,null);
  closeAllHandles(zkArr);
}

</code></pre>

<br>
<pre class="type-9 type-5 type-3 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPortChange() throws Exception {
  qu=new QuorumUtil(1);
  qu.disableJMXTest=true;
  qu.startAll();
  ZooKeeper[] zkArr=createHandles(qu);
  List<String> joiningServers=new ArrayList<String>();
  int leaderIndex=getLeaderId(qu);
  int followerIndex=leaderIndex == 1 ? 2 : 1;
  int quorumPort=qu.getPeer(followerIndex).peer.getQuorumAddress().getPort();
  int electionPort=qu.getPeer(followerIndex).peer.getElectionAddress().getPort();
  int oldClientPort=qu.getPeer(followerIndex).peer.getClientPort();
  int newClientPort=PortAssignment.unique();
  joiningServers.add("server." + followerIndex + "=localhost:"+ quorumPort+ ":"+ electionPort+ ":participant;localhost:"+ newClientPort);
  testNormalOperation(zkArr[followerIndex],zkArr[leaderIndex]);
  reconfig(zkArr[followerIndex],joiningServers,null,null,-1);
  try {
    for (int i=0; i < 20; i++) {
      Thread.sleep(1000);
      zkArr[followerIndex].setData("/test","teststr".getBytes(),-1);
    }
  }
 catch (  KeeperException.ConnectionLossException e) {
    Assert.fail("Existing client disconnected when client port changed!");
  }
  zkArr[followerIndex].close();
  zkArr[followerIndex]=new ZooKeeper("127.0.0.1:" + oldClientPort,ClientBase.CONNECTION_TIMEOUT,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  for (int i=0; i < 10; i++) {
    try {
      Thread.sleep(1000);
      zkArr[followerIndex].setData("/test","teststr".getBytes(),-1);
      Assert.fail("New client connected to old client port!");
    }
 catch (    KeeperException.ConnectionLossException e) {
    }
  }
  zkArr[followerIndex].close();
  zkArr[followerIndex]=new ZooKeeper("127.0.0.1:" + newClientPort,ClientBase.CONNECTION_TIMEOUT,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  testNormalOperation(zkArr[followerIndex],zkArr[leaderIndex]);
  testServerHasConfig(zkArr[followerIndex],joiningServers,null);
  Assert.assertEquals(newClientPort,qu.getPeer(followerIndex).peer.getClientPort());
  joiningServers.clear();
  int newQuorumPort=PortAssignment.unique();
  joiningServers.add("server." + leaderIndex + "=localhost:"+ newQuorumPort+ ":"+ qu.getPeer(leaderIndex).peer.getElectionAddress().getPort()+ ":participant;localhost:"+ qu.getPeer(leaderIndex).peer.getClientPort());
  reconfig(zkArr[leaderIndex],joiningServers,null,null,-1);
  testNormalOperation(zkArr[followerIndex],zkArr[leaderIndex]);
  Assert.assertTrue(qu.getPeer(leaderIndex).peer.getQuorumAddress().getPort() == newQuorumPort);
  Assert.assertTrue(getLeaderId(qu) != leaderIndex);
  joiningServers.clear();
  for (int i=1; i <= 3; i++) {
    joiningServers.add("server." + i + "=localhost:"+ qu.getPeer(i).peer.getQuorumAddress().getPort()+ ":"+ PortAssignment.unique()+ ":participant;localhost:"+ qu.getPeer(i).peer.getClientPort());
  }
  reconfig(zkArr[1],joiningServers,null,null,-1);
  leaderIndex=getLeaderId(qu);
  int follower1=leaderIndex == 1 ? 2 : 1;
  int follower2=1;
  while (follower2 == leaderIndex || follower2 == follower1)   follower2++;
  qu.shutdown(getLeaderId(qu));
  testNormalOperation(zkArr[follower2],zkArr[follower1]);
  testServerHasConfig(zkArr[follower1],joiningServers,null);
  testServerHasConfig(zkArr[follower2],joiningServers,null);
  closeAllHandles(zkArr);
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testInitialConfigHasPositiveVersion() throws Exception {
  qu=new QuorumUtil(1);
  qu.disableJMXTest=true;
  qu.startAll();
  ZooKeeper[] zkArr=createHandles(qu);
  testNormalOperation(zkArr[1],zkArr[2]);
  for (int i=1; i < 4; i++) {
    String configStr=testServerHasConfig(zkArr[i],null,null);
    QuorumVerifier qv=qu.getPeer(i).peer.configFromString(configStr);
    long version=qv.getVersion();
    Assert.assertTrue(version == 0x100000000L);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.RepeatStartupTest </h4><pre class="type-5 type-2 type-6 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies values related to public fields.
"></span><br>
/** 
 * bring up 5 quorum peers and then shut them down
 * and then bring one of the nodes as server
 * @throws Exception might be thrown here
 */
@Test public void testFail() throws Exception {
  QuorumBase qb=new QuorumBase();
  qb.setUp();
  System.out.println("Comment: the servers are at " + qb.hostPort);
  ZooKeeper zk=qb.createClient();
  zk.create("/test",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.close();
  QuorumBase.shutdown(qb.s1);
  QuorumBase.shutdown(qb.s2);
  QuorumBase.shutdown(qb.s3);
  QuorumBase.shutdown(qb.s4);
  QuorumBase.shutdown(qb.s5);
  String hp=qb.hostPort.split(",")[0];
  ZooKeeperServer zks=new ZooKeeperServer(qb.s1.getTxnFactory().getSnapDir(),qb.s1.getTxnFactory().getDataDir(),3000);
  final int PORT=Integer.parseInt(hp.split(":")[1]);
  ServerCnxnFactory factory=ServerCnxnFactory.createFactory(PORT,-1);
  factory.startup(zks);
  System.out.println("Comment: starting factory");
  Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + PORT,QuorumTest.CONNECTION_TIMEOUT));
  factory.shutdown();
  zks.shutdown();
  Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown("127.0.0.1:" + PORT,QuorumTest.CONNECTION_TIMEOUT));
  System.out.println("Comment: shutting down standalone");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.RestoreCommittedLogTest </h4><pre class="type-5 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * test the purge
 * @throws Exception an exception might be thrown here
 */
@Test public void testRestoreCommittedLog() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(100);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
  try {
    for (int i=0; i < 2000; i++) {
      zk.create("/invalidsnap-" + i,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    }
  }
  finally {
    zk.close();
  }
  f.shutdown();
  zks.shutdown();
  Assert.assertTrue("waiting for server to shutdown",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
  zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  zks.startdata();
  List<Proposal> committedLog=zks.getZKDatabase().getCommittedLog();
  int logsize=committedLog.size();
  LOG.info("committedLog size = {}",logsize);
  Assert.assertTrue("log size != 0",(logsize != 0));
  zks.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.SessionTest </h4><pre class="type-5 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Make sure ephemerals get cleaned up when a session times out.
 */
@SuppressWarnings("deprecation") @Test public void testSessionTimeout() throws Exception {
  final int TIMEOUT=5000;
  List<Thread> etBefore=findThreads("EventThread");
  List<Thread> stBefore=findThreads("SendThread");
  DisconnectableZooKeeper zk=createClient(TIMEOUT);
  zk.create("/stest",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  List<Thread> etAfter=findThreads("EventThread");
  List<Thread> stAfter=findThreads("SendThread");
  Thread eventThread=null;
  Thread sendThread=null;
  for (  Thread t : etAfter) {
    if (!etBefore.contains(t)) {
      eventThread=t;
      break;
    }
  }
  for (  Thread t : stAfter) {
    if (!stBefore.contains(t)) {
      sendThread=t;
      break;
    }
  }
  sendThread.suspend();
  Thread.sleep(TIMEOUT * 2);
  sendThread.resume();
  eventThread.join(TIMEOUT);
  Assert.assertFalse("EventThread is still running",eventThread.isAlive());
  zk=createClient(TIMEOUT);
  zk.create("/stest",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  tearDown();
  zk.close();
  zk.disconnect();
  setUp();
  zk=createClient(TIMEOUT);
  Assert.assertTrue(zk.exists("/stest",false) != null);
  Thread.sleep(TIMEOUT * 2);
  Assert.assertTrue(zk.exists("/stest",false) == null);
  zk.close();
}

</code></pre>

<br>
<pre class="type-5 type-3 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test verifies that when the session id is reused, and the original
 * client is disconnected, but not session closed, that the server
 * will remove ephemeral nodes created by the original session.
 */
@Test public void testSession() throws IOException, InterruptedException, KeeperException {
  DisconnectableZooKeeper zk=createClient();
  zk.create("/e",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  LOG.info("zk with session id 0x" + Long.toHexString(zk.getSessionId()) + " was destroyed!");
  zk.disconnect();
  Stat stat=new Stat();
  startSignal=new CountDownLatch(1);
  zk=new DisconnectableZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,new MyWatcher("testSession"),zk.getSessionId(),zk.getSessionPasswd());
  startSignal.await();
  LOG.info("zk with session id 0x" + Long.toHexString(zk.getSessionId()) + " was created!");
  zk.getData("/e",false,stat);
  LOG.info("After get data /e");
  zk.close();
  zk=createClient();
  Assert.assertEquals(null,zk.exists("/e",false));
  LOG.info("before close zk with session id 0x" + Long.toHexString(zk.getSessionId()) + "!");
  zk.close();
  try {
    zk.getData("/e",false,stat);
    Assert.fail("Should have received a SessionExpiredException");
  }
 catch (  KeeperException.SessionExpiredException e) {
  }
  AsyncCallback.DataCallback cb=new AsyncCallback.DataCallback(){
    String status="not done";
    public void processResult(    int rc,    String p,    Object c,    byte[] b,    Stat s){
synchronized (this) {
        status=KeeperException.Code.get(rc).toString();
        this.notify();
      }
    }
    public String toString(){
      return status;
    }
  }
;
  zk.getData("/e",false,cb,null);
synchronized (cb) {
    if (cb.toString().equals("not done")) {
      cb.wait(1000);
    }
  }
  Assert.assertEquals(KeeperException.Code.SESSIONEXPIRED.toString(),cb.toString());
}

</code></pre>

<br>
<pre class="type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMinMaxSessionTimeout() throws Exception {
  final int MINSESS=20000;
  final int MAXSESS=240000;
{
    ZooKeeperServer zs=ClientBase.getServer(serverFactory);
    zs.setMinSessionTimeout(MINSESS);
    zs.setMaxSessionTimeout(MAXSESS);
  }
  int timeout=120000;
  DisconnectableZooKeeper zk=createClient(timeout);
  Assert.assertEquals(timeout,zk.getSessionTimeout());
  LOG.info(zk.toString());
  zk.close();
  LOG.info(zk.toString());
  zk=createClient(MINSESS / 2);
  Assert.assertEquals(MINSESS,zk.getSessionTimeout());
  LOG.info(zk.toString());
  zk.close();
  LOG.info(zk.toString());
  zk=createClient(MAXSESS * 2);
  Assert.assertEquals(MAXSESS,zk.getSessionTimeout());
  LOG.info(zk.toString());
  zk.close();
  LOG.info(zk.toString());
}

</code></pre>

<br>
<pre class="type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Verify access to the negotiated session timeout.
 */
@Test public void testSessionTimeoutAccess() throws Exception {
  DisconnectableZooKeeper zk=createClient(TICK_TIME * 4);
  Assert.assertEquals(TICK_TIME * 4,zk.getSessionTimeout());
  LOG.info(zk.toString());
  zk.close();
  LOG.info(zk.toString());
  zk=createClient(TICK_TIME);
  Assert.assertEquals(TICK_TIME * 2,zk.getSessionTimeout());
  LOG.info(zk.toString());
  zk.close();
  LOG.info(zk.toString());
  zk=createClient(TICK_TIME * 30);
  Assert.assertEquals(TICK_TIME * 20,zk.getSessionTimeout());
  LOG.info(zk.toString());
  zk.close();
  LOG.info(zk.toString());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.StaticHostProviderTest </h4><pre class="type-9 type-5 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testLiteralIPNoReverseNS() throws Exception {
  byte size=30;
  HostProvider hostProvider=getHostProviderUnresolved(size);
  for (int i=0; i < size; i++) {
    InetSocketAddress next=hostProvider.next(0);
    assertTrue(next instanceof InetSocketAddress);
    assertTrue(!next.isUnresolved());
    assertTrue(!next.toString().startsWith("/"));
    String hostname=next.getHostString();
    hostname.equals(next.getAddress().getHostAddress());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.WatcherTest </h4><pre class="type-9 type-5 type-10 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test checks that watches for pending requests do not get triggered,
 * but watches set by previous requests do.
 * @throws Exception
 */
@Test public void testWatchAutoResetWithPending() throws Exception {
  MyWatcher watches[]=new MyWatcher[COUNT];
  MyStatCallback cbs[]=new MyStatCallback[COUNT];
  MyWatcher watcher=new MyWatcher();
  int count[]=new int[1];
  TestableZooKeeper zk=createClient(watcher,hostPort,6000);
  ZooKeeper zk2=createClient(watcher,hostPort,5000);
  zk2.create("/test",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  for (int i=0; i < COUNT / 2; i++) {
    watches[i]=new MyWatcher();
    cbs[i]=new MyStatCallback();
    zk.exists("/test",watches[i],cbs[i],count);
  }
  zk.exists("/test",false);
  Assert.assertTrue("Failed to pause the connection!",zk.pauseCnxn(3000));
  zk2.close();
  stopServer();
  watches[0].waitForDisconnected(60000);
  for (int i=COUNT / 2; i < COUNT; i++) {
    watches[i]=new MyWatcher();
    cbs[i]=new MyStatCallback();
    zk.exists("/test",watches[i],cbs[i],count);
  }
  startServer();
  watches[COUNT / 2 - 1].waitForConnected(60000);
  Assert.assertEquals(null,zk.exists("/test",false));
  Thread.sleep(10);
  for (int i=0; i < COUNT / 2; i++) {
    Assert.assertEquals("For " + i,1,watches[i].events.size());
  }
  for (int i=COUNT / 2; i < COUNT; i++) {
    if (cbs[i].rc == 0) {
      Assert.assertEquals("For " + i,1,watches[i].events.size());
    }
 else {
      Assert.assertEquals("For " + i,0,watches[i].events.size());
    }
  }
  Assert.assertEquals(COUNT,count[0]);
  zk.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.X509AuthTest </h4><pre class="type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testTrustedAuth(){
  X509AuthenticationProvider provider=createProvider(clientCert);
  MockServerCnxn cnxn=new MockServerCnxn();
  cnxn.clientChain=new X509Certificate[]{clientCert};
  Assert.assertEquals(KeeperException.Code.OK,provider.handleAuthentication(cnxn,null));
}

</code></pre>

<br>
<pre class="type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSuperAuth(){
  X509AuthenticationProvider provider=createProvider(superCert);
  MockServerCnxn cnxn=new MockServerCnxn();
  cnxn.clientChain=new X509Certificate[]{superCert};
  Assert.assertEquals(KeeperException.Code.OK,provider.handleAuthentication(cnxn,null));
  Assert.assertEquals("super",cnxn.getAuthInfo().get(0).getScheme());
}

</code></pre>

<br>
<pre class="type-5 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUntrustedAuth(){
  X509AuthenticationProvider provider=createProvider(clientCert);
  MockServerCnxn cnxn=new MockServerCnxn();
  cnxn.clientChain=new X509Certificate[]{unknownCert};
  Assert.assertEquals(KeeperException.Code.AUTHFAILED,provider.handleAuthentication(cnxn,null));
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
