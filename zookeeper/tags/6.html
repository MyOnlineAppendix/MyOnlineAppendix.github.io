<h3><span class=" glyphicon glyphicon-tag"/>&nbspInternalCallVerifier</h3><kbd>Verifies values of objects/variables related to AUT calls</kbd><br><br><br><h4 style="margin:0px">Class: org.apache.zookeeper.MultiTransactionRecordTest </h4><pre class="type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRoundTrip() throws IOException {
  MultiTransactionRecord request=new MultiTransactionRecord();
  request.add(Op.check("check",1));
  request.add(Op.create("create","create data".getBytes(),ZooDefs.Ids.CREATOR_ALL_ACL,ZooDefs.Perms.ALL));
  request.add(Op.delete("delete",17));
  request.add(Op.setData("setData","set data".getBytes(),19));
  MultiTransactionRecord decodedRequest=codeDecode(request);
  Assert.assertEquals(request,decodedRequest);
  Assert.assertEquals(request.hashCode(),decodedRequest.hashCode());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.PortAssignmentTest </h4><pre class="type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSetupPortRange(){
  PortAssignment.PortRange portRange=PortAssignment.setupPortRange(strProcessCount,cmdLine);
  assertEquals(buildAssertionMessage("minimum"),expectedMinimumPort,portRange.getMinimum());
  assertEquals(buildAssertionMessage("maximum"),expectedMaximumPort,portRange.getMaximum());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.RemoveWatchesCmdTest </h4><pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies deletion of NodeDataChanged watches
 */
@Test(timeout=30000) public void testRemoveNodeDataChangedWatches() throws Exception {
  LOG.info("Adding data watcher using getData()");
  List<EventType> expectedEvents=new ArrayList<Watcher.Event.EventType>();
  expectedEvents.add(EventType.DataWatchRemoved);
  MyWatcher myWatcher=new MyWatcher("/testnode1",expectedEvents,1);
  zk.create("/testnode1","data".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.getData("/testnode1",myWatcher,null);
  String cmdstring="removewatches /testnode1 -d";
  LOG.info("Remove watchers using shell command : {}",cmdstring);
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertTrue("Removewatches cmd fails to remove data watches",zkMain.processZKCmd(zkMain.cl));
  LOG.info("Waiting for the DataWatchRemoved event");
  myWatcher.matches();
  Assert.assertEquals("Data watches are not removed : " + zk.getDataWatches(),0,zk.getDataWatches().size());
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies deletion of NodeCreated data watches
 */
@Test(timeout=30000) public void testRemoveNodeCreatedWatches() throws Exception {
  List<EventType> expectedEvents=new ArrayList<Watcher.Event.EventType>();
  expectedEvents.add(EventType.DataWatchRemoved);
  MyWatcher myWatcher1=new MyWatcher("/testnode1",expectedEvents,1);
  MyWatcher myWatcher2=new MyWatcher("/testnode1/testnode2",expectedEvents,1);
  LOG.info("Adding NodeCreated watcher");
  zk.exists("/testnode1",myWatcher1);
  zk.exists("/testnode1/testnode2",myWatcher2);
  String cmdstring1="removewatches /testnode1 -d";
  LOG.info("Remove watchers using shell command : {}",cmdstring1);
  zkMain.cl.parseCommand(cmdstring1);
  Assert.assertTrue("Removewatches cmd fails to remove pre-create watches",zkMain.processZKCmd(zkMain.cl));
  myWatcher1.matches();
  Assert.assertEquals("Failed to remove pre-create watches :" + zk.getExistWatches(),1,zk.getExistWatches().size());
  Assert.assertTrue("Failed to remove pre-create watches :" + zk.getExistWatches(),zk.getExistWatches().contains("/testnode1/testnode2"));
  String cmdstring2="removewatches /testnode1/testnode2 -d";
  LOG.info("Remove watchers using shell command : {}",cmdstring2);
  zkMain.cl.parseCommand(cmdstring2);
  Assert.assertTrue("Removewatches cmd fails to remove data watches",zkMain.processZKCmd(zkMain.cl));
  myWatcher2.matches();
  Assert.assertEquals("Failed to remove pre-create watches : " + zk.getExistWatches(),0,zk.getExistWatches().size());
}

</code></pre>

<br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test verifies default options. When there is no passed options,
 * removewatches command will use default options - WatcherType.ANY and
 * local=false
 */
@Test(timeout=30000) public void testRemoveWatchesWithNoPassedOptions() throws Exception {
  List<EventType> expectedEvents=new ArrayList<Watcher.Event.EventType>();
  expectedEvents.add(EventType.ChildWatchRemoved);
  expectedEvents.add(EventType.DataWatchRemoved);
  MyWatcher myWatcher=new MyWatcher("/testnode1",expectedEvents,2);
  zk.create("/testnode1","data".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/testnode2","data".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  LOG.info("Adding childwatcher to /testnode1 and /testnode2");
  zk.getChildren("/testnode1",myWatcher);
  zk.getChildren("/testnode2",myWatcher);
  LOG.info("Adding datawatcher to /testnode1 and /testnode2");
  zk.getData("/testnode1",myWatcher,null);
  zk.getData("/testnode2",myWatcher,null);
  String cmdstring="removewatches /testnode1";
  LOG.info("Remove watchers using shell command : {}",cmdstring);
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertTrue("Removewatches cmd fails to remove child watches",zkMain.processZKCmd(zkMain.cl));
  LOG.info("Waiting for the DataWatchRemoved event");
  myWatcher.matches();
  Assert.assertTrue("Failed to find child watches for the path testnode2",zk.getChildWatches().contains("/testnode2"));
  Assert.assertTrue("Failed to find data watches for the path testnode2",zk.getDataWatches().contains("/testnode2"));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies deletion of NodeChildrenChanged watches
 */
@Test(timeout=30000) public void testRemoveNodeChildrenChangedWatches() throws Exception {
  List<EventType> expectedEvents=new ArrayList<Watcher.Event.EventType>();
  expectedEvents.add(EventType.ChildWatchRemoved);
  MyWatcher myWatcher=new MyWatcher("/testnode1",expectedEvents,1);
  zk.create("/testnode1","data".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  LOG.info("Adding child changed watcher");
  zk.getChildren("/testnode1",myWatcher);
  String cmdstring="removewatches /testnode1 -c";
  LOG.info("Remove watchers using shell command : {}",cmdstring);
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertTrue("Removewatches cmd fails to remove child watches",zkMain.processZKCmd(zkMain.cl));
  myWatcher.matches();
  Assert.assertEquals("Failed to remove child watches : " + zk.getChildWatches(),0,zk.getChildWatches().size());
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies deletion of NodeDeleted watches
 */
@Test(timeout=30000) public void testRemoveNodeDeletedWatches() throws Exception {
  LOG.info("Adding NodeDeleted watcher");
  List<EventType> expectedEvents=new ArrayList<Watcher.Event.EventType>();
  expectedEvents.add(EventType.ChildWatchRemoved);
  expectedEvents.add(EventType.NodeDeleted);
  MyWatcher myWatcher=new MyWatcher("/testnode1",expectedEvents,1);
  zk.create("/testnode1","data".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/testnode1/testnode2","data".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.getChildren("/testnode1/testnode2",myWatcher);
  zk.getChildren("/testnode1",myWatcher);
  String cmdstring="removewatches /testnode1 -c";
  LOG.info("Remove watchers using shell command : {}",cmdstring);
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertTrue("Removewatches cmd fails to remove child watches",zkMain.processZKCmd(zkMain.cl));
  LOG.info("Waiting for the ChildWatchRemoved event");
  myWatcher.matches();
  Assert.assertEquals("Failed to remove child watches : " + zk.getChildWatches(),1,zk.getChildWatches().size());
  Assert.assertTrue("Failed to remove child watches :" + zk.getChildWatches(),zk.getChildWatches().contains("/testnode1/testnode2"));
  zk.delete("/testnode1/testnode2",-1);
  myWatcher.matches();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.RemoveWatchesTest </h4><pre class="type-5 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies removal of multiple data watchers when there is server
 * connection
 */
@Test(timeout=90000) public void testMultipleDataWatchers() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  MyWatcher w1=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
  removeWatches(zk2,"/node1",w2,WatcherType.Data,false,Code.OK);
  Assert.assertEquals("Didn't find data watcher",1,zk2.getDataWatches().size());
  Assert.assertEquals("Didn't find data watcher","/node1",zk2.getDataWatches().get(0));
  removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove data watcher",w2.matches());
  if (zk1 != null) {
    zk1.close();
    zk1=null;
  }
  List<EventType> events=w2.getEventsAfterWatchRemoval();
  Assert.assertEquals("Shouldn't get NodeDeletedEvent after watch removal",0,events.size());
}

</code></pre>

<br>
<pre class="type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Any - removes only the configured child watcher
 * function
 */
@Test(timeout=90000) public void testRemoveAnyChildWatcher() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",2);
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w2);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w1);
  removeWatches(zk2,"/node1",w2,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
  Assert.assertEquals("Didn't find child watcher",1,zk2.getChildWatches().size());
  Assert.assertEquals("Didn't find data watcher",1,zk2.getDataWatches().size());
  removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove watchers",w1.matches());
}

</code></pre>

<br>
<pre class="type-3 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies given watcher doesn't exists!
 */
@Test(timeout=90000) public void testNoWatcherException() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",2);
  MyWatcher w2=new MyWatcher("/node1",2);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNull("Didn't set data watches",zk2.exists("/node2",w2));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w2);
  MyWatcher w3=new MyWatcher("/node1",2);
  try {
    removeWatches(zk2,"/node1",w3,WatcherType.Any,false,Code.NOWATCHER);
    Assert.fail("Should throw exception as given watcher doesn't exists");
  }
 catch (  KeeperException.NoWatcherException nwe) {
  }
  try {
    removeWatches(zk2,"/node1",w3,WatcherType.Children,false,Code.NOWATCHER);
    Assert.fail("Should throw exception as given watcher doesn't exists");
  }
 catch (  KeeperException.NoWatcherException nwe) {
  }
  try {
    removeWatches(zk2,"/node1",w3,WatcherType.Data,false,Code.NOWATCHER);
    Assert.fail("Should throw exception as given watcher doesn't exists");
  }
 catch (  KeeperException.NoWatcherException nwe) {
  }
  try {
    removeWatches(zk2,"/nonexists",w3,WatcherType.Data,false,Code.NOWATCHER);
    Assert.fail("Should throw exception as given watcher doesn't exists");
  }
 catch (  KeeperException.NoWatcherException nwe) {
  }
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Data - removes only the configured data watcher
 * function
 */
@Test(timeout=90000) public void testRemoveAllDataWatchesOnAPath() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  final CountDownLatch dWatchCount=new CountDownLatch(2);
  final CountDownLatch rmWatchCount=new CountDownLatch(2);
  Watcher w1=new Watcher(){
    @Override public void process(    WatchedEvent event){
switch (event.getType()) {
case DataWatchRemoved:
        rmWatchCount.countDown();
      break;
case NodeDataChanged:
    dWatchCount.countDown();
  break;
default :
break;
}
}
}
;
Watcher w2=new Watcher(){
@Override public void process(WatchedEvent event){
switch (event.getType()) {
case DataWatchRemoved:
rmWatchCount.countDown();
break;
case NodeDataChanged:
dWatchCount.countDown();
break;
default :
break;
}
}
}
;
LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
Assert.assertTrue("Server session is not a watcher",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Data));
removeAllWatches(zk2,"/node1",WatcherType.Data,false,Code.OK);
Assert.assertTrue("Didn't remove data watcher",rmWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
Assert.assertFalse("Server session is still a watcher after removal",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Data));
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies null watcher with WatcherType.Data - remove all data
 * watchers. Child watchers shouldn't be removed
 */
@Test(timeout=90000) public void testRemoveAllDataWatchers() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",1);
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w2);
  removeWatches(zk2,"/node1",w1,WatcherType.Data,false,Code.OK);
  removeWatches(zk2,"/node1",w2,WatcherType.Data,false,Code.OK);
  zk1.create("/node1/child",null,Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  Assert.assertTrue("Didn't remove data watcher",w1.matches());
  Assert.assertTrue("Didn't remove data watcher",w2.matches());
  int count=10;
  while (count > 0) {
    if (w1.getEventsAfterWatchRemoval().size() > 0 && w2.getEventsAfterWatchRemoval().size() > 0) {
      break;
    }
    count--;
    Thread.sleep(1000);
  }
  List<EventType> events=w1.getEventsAfterWatchRemoval();
  Assert.assertEquals("Didn't get NodeChildrenChanged event",1,events.size());
  Assert.assertTrue("Didn't get NodeChildrenChanged event",events.contains(EventType.NodeChildrenChanged));
  events=w2.getEventsAfterWatchRemoval();
  Assert.assertEquals("Didn't get NodeChildrenChanged event",1,events.size());
  Assert.assertTrue("Didn't get NodeChildrenChanged event",events.contains(EventType.NodeChildrenChanged));
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies removal of many watchers locally when no connection and
 * WatcherType#Any. Also, verifies internal watchManager datastructures
 */
@Test(timeout=90000) public void testManyWatchersWhenNoConnection() throws Exception {
  int count=3;
  List<MyWatcher> wList=new ArrayList<MyWatcher>(count);
  MyWatcher w;
  String path="/node";
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    zk1.create(nodePath,null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    nodePath+="/";
  }
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    w=new MyWatcher(path + i,2);
    wList.add(w);
    LOG.info("Adding child watcher {} on path {}",new Object[]{w,nodePath});
    zk1.getChildren(nodePath,w);
    nodePath+="/";
  }
  Assert.assertEquals("Failed to add watchers!",count,zk1.getChildWatches().size());
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    w=wList.get(i);
    LOG.info("Adding data watcher {} on path {}",new Object[]{w,nodePath});
    zk1.getData(nodePath,w,null);
    nodePath+="/";
  }
  Assert.assertEquals("Failed to add watchers!",count,zk1.getDataWatches().size());
  stopServer();
  for (int i=0; i < count; i++) {
    final MyWatcher watcher=wList.get(i);
    removeWatches(zk1,path + i,watcher,WatcherType.Any,true,Code.OK);
    Assert.assertTrue("Didn't remove watcher",watcher.matches());
  }
  Assert.assertEquals("Didn't remove watch references!",0,zk1.getChildWatches().size());
  Assert.assertEquals("Didn't remove watch references!",0,zk1.getDataWatches().size());
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies removal of single watcher when there is server connection
 */
@Test(timeout=90000) public void testRemoveSingleWatcher() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  zk1.create("/node2",null,Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  MyWatcher w1=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  MyWatcher w2=new MyWatcher("/node2",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node2",w2));
  removeWatches(zk2,"/node1",w1,WatcherType.Data,false,Code.OK);
  Assert.assertEquals("Didn't find data watcher",1,zk2.getDataWatches().size());
  Assert.assertEquals("Didn't find data watcher","/node2",zk2.getDataWatches().get(0));
  removeWatches(zk2,"/node2",w2,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove data watcher",w2.matches());
  if (zk1 != null) {
    zk1.close();
    zk1=null;
  }
  List<EventType> events=w1.getEventsAfterWatchRemoval();
  Assert.assertFalse("Shouldn't get NodeDeletedEvent after watch removal",events.contains(EventType.NodeDeleted));
  Assert.assertEquals("Shouldn't get NodeDeletedEvent after watch removal",0,events.size());
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Children - removes only the configured child
 * watcher function
 */
@Test(timeout=90000) public void testRemoveAllChildWatchesOnAPath() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  final CountDownLatch cWatchCount=new CountDownLatch(2);
  final CountDownLatch rmWatchCount=new CountDownLatch(2);
  Watcher w1=new Watcher(){
    @Override public void process(    WatchedEvent event){
switch (event.getType()) {
case ChildWatchRemoved:
        rmWatchCount.countDown();
      break;
case NodeChildrenChanged:
    cWatchCount.countDown();
  break;
default :
break;
}
}
}
;
Watcher w2=new Watcher(){
@Override public void process(WatchedEvent event){
switch (event.getType()) {
case ChildWatchRemoved:
rmWatchCount.countDown();
break;
case NodeChildrenChanged:
cWatchCount.countDown();
break;
default :
break;
}
}
}
;
LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w1).size());
LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w2).size());
Assert.assertTrue("Server session is not a watcher",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Children));
removeAllWatches(zk2,"/node1",WatcherType.Children,false,Code.OK);
Assert.assertTrue("Didn't remove child watcher",rmWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
Assert.assertFalse("Server session is still a watcher after removal",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Children));
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies null watcher with WatcherType.Children - remove all child
 * watchers. Data watchers shouldn't be removed
 */
@Test(timeout=90000) public void testRemoveAllChildWatchers() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",1);
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w2);
  removeWatches(zk2,"/node1",w1,WatcherType.Children,false,Code.OK);
  removeWatches(zk2,"/node1",w2,WatcherType.Children,false,Code.OK);
  zk1.setData("/node1","test".getBytes(),-1);
  Assert.assertTrue("Didn't remove child watcher",w1.matches());
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
  int count=10;
  while (count > 0) {
    if (w1.getEventsAfterWatchRemoval().size() > 0 && w2.getEventsAfterWatchRemoval().size() > 0) {
      break;
    }
    count--;
    Thread.sleep(1000);
  }
  List<EventType> events=w1.getEventsAfterWatchRemoval();
  Assert.assertEquals("Didn't get NodeDataChanged event",1,events.size());
  Assert.assertTrue("Didn't get NodeDataChanged event",events.contains(EventType.NodeDataChanged));
  events=w2.getEventsAfterWatchRemoval();
  Assert.assertEquals("Didn't get NodeDataChanged event",1,events.size());
  Assert.assertTrue("Didn't get NodeDataChanged event",events.contains(EventType.NodeDataChanged));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies removing watcher having namespace
 */
@Test(timeout=90000) public void testChRootRemoveWatcher() throws Exception {
  String chRoot="/appsX";
  zk1.create("/appsX",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  if (zk1 != null) {
    zk1.close();
  }
  if (zk2 != null) {
    zk2.close();
  }
  zk1=createClient(this.hostPort + chRoot);
  zk2=createClient(this.hostPort + chRoot);
  LOG.info("Creating child znode /node1 using chRoot client");
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",2);
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w2);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w1);
  removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w1.matches());
  Assert.assertEquals("Didn't find child watcher",1,zk2.getChildWatches().size());
  removeWatches(zk2,"/node1",w2,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
}

</code></pre>

<br>
<pre class="type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Any - removes only the configured data watcher
 * function
 */
@Test(timeout=90000) public void testRemoveAnyDataWatcher() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",1);
  MyWatcher w2=new MyWatcher("/node1",2);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w2);
  removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove data watcher",w1.matches());
  Assert.assertEquals("Didn't find child watcher",1,zk2.getChildWatches().size());
  Assert.assertEquals("Didn't find data watcher",1,zk2.getDataWatches().size());
  removeWatches(zk2,"/node1",w2,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies many child watchers. Also, verifies internal datastructure
 * 'watchManager.childWatches'
 */
@Test(timeout=90000) public void testManyChildWatchers() throws Exception {
  int count=50;
  List<MyWatcher> wList=new ArrayList<MyWatcher>(count);
  MyWatcher w;
  String path="/node";
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    zk1.create(nodePath,null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    nodePath+="/";
  }
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    w=new MyWatcher(path + i,1);
    wList.add(w);
    LOG.info("Adding child watcher {} on path {}",new Object[]{w,nodePath});
    zk1.getChildren(nodePath,w);
    nodePath+="/";
  }
  Assert.assertEquals("Failed to add watchers!",count,zk1.getChildWatches().size());
  for (int i=0; i < count; i++) {
    final MyWatcher watcher=wList.get(i);
    removeWatches(zk1,path + i,watcher,WatcherType.Children,false,Code.OK);
    Assert.assertTrue("Didn't remove child watcher",watcher.matches());
  }
  Assert.assertEquals("Didn't remove watch references!",0,zk1.getChildWatches().size());
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Data - removes only the configured data watcher
 * function
 */
@Test(timeout=90000) public void testRemoveWhenMultipleDataWatchesOnAPath() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  final CountDownLatch dataWatchCount=new CountDownLatch(1);
  final CountDownLatch rmWatchCount=new CountDownLatch(1);
  Watcher w1=new Watcher(){
    @Override public void process(    WatchedEvent event){
      if (event.getType() == EventType.DataWatchRemoved) {
        rmWatchCount.countDown();
      }
    }
  }
;
  Watcher w2=new Watcher(){
    @Override public void process(    WatchedEvent event){
      if (event.getType() == EventType.NodeDataChanged) {
        dataWatchCount.countDown();
      }
    }
  }
;
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
  removeWatches(zk2,"/node1",w1,WatcherType.Data,false,Code.OK);
  Assert.assertTrue("Didn't remove data watcher",rmWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
  zk1.setData("/node1","test".getBytes(),-1);
  LOG.info("Waiting for data watchers to be notified");
  Assert.assertTrue("Didn't get data watch notification!",dataWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies when there is no server connection. Remove watches when
 * local=true, otw should retain it
 */
@Test(timeout=90000) public void testRemoveWatcherWhenNoConnection() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",2);
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w2);
  stopServer();
  removeWatches(zk2,"/node1",w2,WatcherType.Any,true,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
  Assert.assertFalse("Shouldn't remove data watcher",w1.matches());
  try {
    removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.CONNECTIONLOSS);
    Assert.fail("Should throw exception as last watch removal requires server connection");
  }
 catch (  KeeperException.ConnectionLossException nwe) {
  }
  Assert.assertFalse("Shouldn't remove data watcher",w1.matches());
  removeWatches(zk2,"/node1",w1,WatcherType.Any,true,Code.OK);
  Assert.assertTrue("Didn't remove data watcher",w1.matches());
}

</code></pre>

<br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Verify that if a given watcher doesn't exist, the server properly
 * returns an error code for it.
 * In our Java client implementation, we check that a given watch exists at
 * two points:
 * 1) before submitting the RemoveWatches request
 * 2) after a successful server response, when the watcher needs to be
 * removed
 * Since this can be racy (i.e. a watch can fire while a RemoveWatches
 * request is in-flight), we need to verify that the watch was actually
 * removed (i.e. from ZKDatabase and DataTree) and return NOWATCHER if
 * needed.
 * Also, other implementations might not do a client side check before
 * submitting a RemoveWatches request. If we don't do a server side check,
 * we would just return ZOK even if no watch was removed.
 */
@Test(timeout=90000) public void testNoWatcherServerException() throws InterruptedException, IOException, TimeoutException {
  CountdownWatcher watcher=new CountdownWatcher();
  MyZooKeeper zk=new MyZooKeeper(hostPort,CONNECTION_TIMEOUT,watcher);
  boolean nw=false;
  watcher.waitForConnected(CONNECTION_TIMEOUT);
  try {
    zk.removeWatches("/nowatchhere",watcher,WatcherType.Data,false);
  }
 catch (  KeeperException nwe) {
    if (nwe.code().intValue() == Code.NOWATCHER.intValue()) {
      nw=true;
    }
  }
  Assert.assertTrue("Server didn't return NOWATCHER",zk.getRemoveWatchesRC() == Code.NOWATCHER.intValue());
  Assert.assertTrue("NoWatcherException didn't happen",nw);
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Any - removes all the configured child,data
 * watcher functions
 */
@Test(timeout=90000) public void testRemoveAllWatchesOnAPath() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  final CountDownLatch watchCount=new CountDownLatch(2);
  final CountDownLatch rmWatchCount=new CountDownLatch(4);
  Watcher w1=new Watcher(){
    @Override public void process(    WatchedEvent event){
switch (event.getType()) {
case ChildWatchRemoved:
case DataWatchRemoved:
        rmWatchCount.countDown();
      break;
case NodeChildrenChanged:
case NodeDataChanged:
    watchCount.countDown();
  break;
default :
break;
}
}
}
;
Watcher w2=new Watcher(){
@Override public void process(WatchedEvent event){
switch (event.getType()) {
case ChildWatchRemoved:
case DataWatchRemoved:
rmWatchCount.countDown();
break;
case NodeChildrenChanged:
case NodeDataChanged:
watchCount.countDown();
break;
default :
break;
}
}
}
;
LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w1).size());
LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w2).size());
LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
Assert.assertTrue("Server session is not a watcher",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Data));
removeAllWatches(zk2,"/node1",WatcherType.Any,false,Code.OK);
Assert.assertTrue("Didn't remove data watcher",rmWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
Assert.assertFalse("Server session is still a watcher after removal",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Data));
Assert.assertEquals("Received watch notification after removal!",2,watchCount.getCount());
}

</code></pre>

<br>
<pre class="type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies null watcher with WatcherType.Any - remove all the watchers
 * data, child, exists
 */
@Test(timeout=90000) public void testRemoveAllWatchers() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",2);
  MyWatcher w2=new MyWatcher("/node1",2);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w2);
  removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.OK);
  removeWatches(zk2,"/node1",w2,WatcherType.Any,false,Code.OK);
  zk1.create("/node1/child",null,Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  Assert.assertTrue("Didn't remove data watcher",w1.matches());
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Children - removes only the configured child
 * watcher function
 */
@Test(timeout=90000) public void testRemoveWhenMultipleChildWatchesOnAPath() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  final CountDownLatch childWatchCount=new CountDownLatch(1);
  final CountDownLatch rmWatchCount=new CountDownLatch(1);
  Watcher w1=new Watcher(){
    @Override public void process(    WatchedEvent event){
      if (event.getType() == EventType.ChildWatchRemoved) {
        rmWatchCount.countDown();
      }
    }
  }
;
  Watcher w2=new Watcher(){
    @Override public void process(    WatchedEvent event){
      if (event.getType() == EventType.NodeChildrenChanged) {
        childWatchCount.countDown();
      }
    }
  }
;
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w1).size());
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w2).size());
  removeWatches(zk2,"/node1",w1,WatcherType.Children,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",rmWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
  zk1.create("/node1/node2",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  LOG.info("Waiting for child watchers to be notified");
  Assert.assertTrue("Didn't get child watch notification!",childWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies removal of multiple child watchers when there is server
 * connection
 */
@Test(timeout=90000) public void testMultipleChildWatchers() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w1);
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w2);
  removeWatches(zk2,"/node1",w2,WatcherType.Children,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
  Assert.assertEquals("Didn't find child watcher",1,zk2.getChildWatches().size());
  removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w1.matches());
  zk1.create("/node1/node2",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  int count=30;
  while (count > 0) {
    if (w1.getEventsAfterWatchRemoval().size() > 0) {
      break;
    }
    count--;
    Thread.sleep(100);
  }
  List<EventType> events=w2.getEventsAfterWatchRemoval();
  Assert.assertEquals("Shouldn't get NodeChildrenChanged event",0,events.size());
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies many pre-node watchers. Also, verifies internal
 * datastructure 'watchManager.existWatches'
 */
@Test(timeout=90000) public void testManyPreNodeWatchers() throws Exception {
  int count=50;
  List<MyWatcher> wList=new ArrayList<MyWatcher>(count);
  MyWatcher w;
  String path="/node";
  for (int i=0; i < count; i++) {
    final String nodePath=path + i;
    w=new MyWatcher(nodePath,1);
    wList.add(w);
    LOG.info("Adding pre node watcher {} on path {}",new Object[]{w,nodePath});
    zk1.exists(nodePath,w);
  }
  Assert.assertEquals("Failed to add watchers!",count,zk1.getExistWatches().size());
  for (int i=0; i < count; i++) {
    final MyWatcher watcher=wList.get(i);
    removeWatches(zk1,path + i,watcher,WatcherType.Data,false,Code.OK);
    Assert.assertTrue("Didn't remove data watcher",watcher.matches());
  }
  Assert.assertEquals("Didn't remove watch references!",0,zk1.getExistWatches().size());
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies many data watchers. Also, verifies internal datastructure
 * 'watchManager.dataWatches'
 */
@Test(timeout=90000) public void testManyDataWatchers() throws Exception {
  int count=50;
  List<MyWatcher> wList=new ArrayList<MyWatcher>(count);
  MyWatcher w;
  String path="/node";
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    w=new MyWatcher(path + i,1);
    wList.add(w);
    zk1.create(nodePath,null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    LOG.info("Adding data watcher {} on path {}",new Object[]{w,nodePath});
    zk1.getData(nodePath,w,null);
    nodePath+="/";
  }
  Assert.assertEquals("Failed to add watchers!",count,zk1.getDataWatches().size());
  for (int i=0; i < count; i++) {
    final MyWatcher watcher=wList.get(i);
    removeWatches(zk1,path + i,watcher,WatcherType.Data,false,Code.OK);
    Assert.assertTrue("Didn't remove data watcher",watcher.matches());
  }
  Assert.assertEquals("Didn't remove watch references!",0,zk1.getDataWatches().size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.ZooKeeperTest </h4><pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testDelete() throws Exception {
  final ZooKeeper zk=createClient();
  ZooKeeperMain zkMain=new ZooKeeperMain(zk);
  String cmdstring1="create -e /node2 data";
  String cmdstring2="delete /node2";
  String cmdstring3="ls /node2";
  zkMain.cl.parseCommand(cmdstring1);
  Assert.assertTrue(zkMain.processZKCmd(zkMain.cl));
  zkMain.cl.parseCommand(cmdstring2);
  Assert.assertFalse(zkMain.processZKCmd(zkMain.cl));
  zkMain.cl.parseCommand(cmdstring3);
  Assert.assertFalse("",zkMain.processCmd(zkMain.cl));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeleteRecursiveAsync() throws IOException, InterruptedException, KeeperException {
  final ZooKeeper zk=createClient();
  zk.setData("/","some".getBytes(),-1);
  zk.create("/a","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/b","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/b/v","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/b/v/1","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/c","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/c/v","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  for (int i=0; i < 50; ++i) {
    zk.create("/a/c/" + i,"some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  }
  List<String> children=zk.getChildren("/a",false);
  Assert.assertEquals("2 children - b & c should be present ",children.size(),2);
  Assert.assertTrue(children.contains("b"));
  Assert.assertTrue(children.contains("c"));
  VoidCallback cb=new VoidCallback(){
    @Override public void processResult(    int rc,    String path,    Object ctx){
synchronized (ctx) {
        ((AtomicInteger)ctx).set(4);
        ctx.notify();
      }
    }
  }
;
  final AtomicInteger ctx=new AtomicInteger(3);
  ZKUtil.deleteRecursive(zk,"/a",cb,ctx);
synchronized (ctx) {
    ctx.wait();
  }
  Assert.assertEquals(4,((AtomicInteger)ctx).get());
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateNodeWithoutData() throws Exception {
  final ZooKeeper zk=createClient();
  ZooKeeperMain zkMain=new ZooKeeperMain(zk);
  String cmdstring="create -s /node ";
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertTrue("Doesn't create node without data",zkMain.processZKCmd(zkMain.cl));
  cmdstring="create  -e /node ";
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertTrue("Doesn't create node without data",zkMain.processZKCmd(zkMain.cl));
  cmdstring="create -s -e /node ";
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertTrue("Doesn't create node without data",zkMain.processZKCmd(zkMain.cl));
  cmdstring="create -s y /node";
  zkMain.cl.parseCommand(cmdstring);
  try {
    Assert.assertTrue("Created node with wrong option",zkMain.processZKCmd(zkMain.cl));
    Assert.fail("Created the node with wrong option should " + "throw Exception.");
  }
 catch (  IllegalArgumentException e) {
    Assert.assertEquals("Path must start with / character",e.getMessage());
  }
}

</code></pre>

<br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testStatCommand() throws Exception {
  final ZooKeeper zk=createClient();
  ZooKeeperMain zkMain=new ZooKeeperMain(zk);
  String cmdstring1="create -e /node3 data";
  String cmdstring2="stat /node3";
  String cmdstring3="delete /node3";
  zkMain.cl.parseCommand(cmdstring1);
  Assert.assertTrue(zkMain.processZKCmd(zkMain.cl));
  zkMain.cl.parseCommand(cmdstring2);
  Assert.assertFalse(zkMain.processZKCmd(zkMain.cl));
  zkMain.cl.parseCommand(cmdstring3);
  Assert.assertFalse(zkMain.processZKCmd(zkMain.cl));
}

</code></pre>

<br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testCreateCommandWithoutPath() throws Exception {
  final ZooKeeper zk=createClient();
  ZooKeeperMain zkMain=new ZooKeeperMain(zk);
  String cmdstring="create ";
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertFalse("Path is not validated.",zkMain.processZKCmd(zkMain.cl));
  cmdstring="create -e ";
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertFalse("Path is not validated.",zkMain.processZKCmd(zkMain.cl));
  cmdstring="create -s ";
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertFalse("Path is not validated.",zkMain.processZKCmd(zkMain.cl));
  cmdstring="create -s -e ";
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertFalse("Path is not validated.",zkMain.processZKCmd(zkMain.cl));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSetData() throws Exception {
  final ZooKeeper zk=createClient();
  ZooKeeperMain zkMain=new ZooKeeperMain(zk);
  String cmdstring1="create -e /node4 data";
  String cmdstring2="set /node4 " + "data";
  String cmdstring3="delete /node4";
  Stat stat=new Stat();
  int version=0;
  zkMain.cl.parseCommand(cmdstring1);
  Assert.assertTrue(zkMain.processZKCmd(zkMain.cl));
  stat=zk.exists("/node4",true);
  version=stat.getVersion();
  zkMain.cl.parseCommand(cmdstring2);
  Assert.assertFalse(zkMain.processZKCmd(zkMain.cl));
  stat=zk.exists("/node4",true);
  Assert.assertEquals(version + 1,stat.getVersion());
  zkMain.cl.parseCommand(cmdstring3);
  Assert.assertFalse(zkMain.processZKCmd(zkMain.cl));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeleteRecursive() throws IOException, InterruptedException, KeeperException {
  final ZooKeeper zk=createClient();
  zk.setData("/","some".getBytes(),-1);
  zk.create("/a","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/b","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/b/v","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/b/v/1","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/c","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/c/v","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  List<String> children=zk.getChildren("/a",false);
  Assert.assertEquals("2 children - b & c should be present ",children.size(),2);
  Assert.assertTrue(children.contains("b"));
  Assert.assertTrue(children.contains("c"));
  ZooKeeperMain zkMain=new ZooKeeperMain(zk);
  String cmdstring0="rmr /a/b/v";
  String cmdstring1="deleteall /a";
  zkMain.cl.parseCommand(cmdstring0);
  Assert.assertFalse(zkMain.processZKCmd(zkMain.cl));
  Assert.assertEquals(null,zk.exists("/a/b/v",null));
  zkMain.cl.parseCommand(cmdstring1);
  Assert.assertFalse(zkMain.processZKCmd(zkMain.cl));
  Assert.assertNull(zk.exists("/a",null));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.recipes.leader.LeaderElectionSupportTest </h4><pre class="type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetLeaderHostName() throws KeeperException, InterruptedException {
  LeaderElectionSupport electionSupport=createLeaderElectionSupport();
  electionSupport.start();
  Thread.sleep(3000);
  String leaderHostName=electionSupport.getLeaderHostName();
  Assert.assertNotNull(leaderHostName);
  Assert.assertEquals("foohost",leaderHostName);
  electionSupport.stop();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.ByteBufferInputStreamTest </h4><pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testNegativeSkip() throws Exception {
  in.read();
  assertEquals(0L,in.skip(-2L));
  assertEquals(DATA_BYTES[1],in.read());
  assertEquals(DATA_BYTES[2],in.read());
}

</code></pre>

<br>
<pre class="type-5 type-6 type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testReadArrayOffsetLength_AtEndOfStream() throws Exception {
  for (int i=0; i < DATA_BYTES.length; i++) {
    in.read();
  }
  byte[] expected=Arrays.copyOf(bs,bs.length);
  assertEquals(-1,in.read(bs,2,2));
  assertArrayEquals(expected,bs);
}

</code></pre>

<br>
<pre class="type-6 type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testReadArrayOffsetLength_HitEndOfStream() throws Exception {
  for (int i=0; i < DATA_BYTES.length - 1; i++) {
    in.read();
  }
  assertEquals(1,in.read(bs,2,2));
  byte[] expected=new byte[]{(byte)1,(byte)2,DATA_BYTES[DATA_BYTES.length - 1],(byte)4};
  assertArrayEquals(expected,bs);
}

</code></pre>

<br>
<pre class="type-6 type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testSkip2() throws Exception {
  for (int i=0; i < DATA_BYTES.length / 2; i++) {
    in.read();
  }
  long skipAmount=DATA_BYTES.length / 4;
  assertEquals(skipAmount,in.skip(skipAmount));
  int idx=DATA_BYTES.length / 2 + (int)skipAmount;
  assertEquals(DATA_BYTES[idx++],in.read());
  assertEquals(DATA_BYTES[idx++],in.read());
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSkip_HitEnd() throws Exception {
  for (int i=0; i < DATA_BYTES.length - 1; i++) {
    in.read();
  }
  assertEquals(1L,in.skip(2L));
  assertEquals(-1,in.read());
}

</code></pre>

<br>
<pre class="type-9 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRead() throws Exception {
  for (int i=0; i < DATA_BYTES.length; i++) {
    int b=in.read();
    assertEquals(DATA_BYTES[i],(byte)b);
  }
  assertEquals(-1,in.read());
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSkip() throws Exception {
  in.read();
  assertEquals(2L,in.skip(2L));
  assertEquals(DATA_BYTES[3],in.read());
  assertEquals(DATA_BYTES[4],in.read());
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSkip_AtEnd() throws Exception {
  for (int i=0; i < DATA_BYTES.length; i++) {
    in.read();
  }
  assertEquals(0L,in.skip(2L));
  assertEquals(-1,in.read());
}

</code></pre>

<br>
<pre class="type-9 type-6 type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testAvailable() throws Exception {
  for (int i=DATA_BYTES.length; i > 0; i--) {
    assertEquals(i,in.available());
    in.read();
  }
  assertEquals(0,in.available());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.CRCTest </h4><pre class="type-5 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * test checksums for the logs and snapshots.
 * the reader should fail on reading
 * a corrupt snapshot and a corrupt log
 * file
 * @throws Exception
 */
@Test public void testChecksums() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(150);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  LOG.info("starting up the zookeeper server .. waiting");
  Assert.assertTrue("waiting for server being up",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
  try {
    for (int i=0; i < 2000; i++) {
      zk.create("/crctest- " + i,("/crctest- " + i).getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    }
  }
  finally {
    zk.close();
  }
  f.shutdown();
  zks.shutdown();
  Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown(HOSTPORT,ClientBase.CONNECTION_TIMEOUT));
  File versionDir=new File(tmpDir,"version-2");
  File[] list=versionDir.listFiles();
  File snapFile=null;
  File logFile=null;
  for (  File file : list) {
    LOG.info("file is " + file);
    if (file.getName().startsWith("log")) {
      logFile=file;
      corruptFile(logFile);
    }
  }
  FileTxnLog flog=new FileTxnLog(versionDir);
  TxnIterator itr=flog.read(1);
  try {
    while (itr.next()) {
    }
    Assert.assertTrue(false);
  }
 catch (  IOException ie) {
    LOG.info("crc corruption",ie);
  }
  itr.close();
  FileSnap snap=new FileSnap(versionDir);
  List<File> snapFiles=snap.findNRecentSnapshots(2);
  snapFile=snapFiles.get(0);
  corruptFile(snapFile);
  boolean cfile=false;
  try {
    cfile=getCheckSum(snap,snapFile);
  }
 catch (  IOException ie) {
    snapFile=snapFiles.get(1);
    corruptFile(snapFile);
    cfile=getCheckSum(snap,snapFile);
  }
  Assert.assertTrue(cfile);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.CreateContainerTest </h4><pre class="type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testMultiWithContainer() throws IOException, KeeperException, InterruptedException {
  Op createContainer=Op.create("/foo",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.CONTAINER);
  Op createChild=Op.create("/foo/bar",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.multi(Arrays.asList(createContainer,createChild));
  DataTree dataTree=serverFactory.getZooKeeperServer().getZKDatabase().getDataTree();
  Assert.assertEquals(dataTree.getContainers().size(),1);
  zk.delete("/foo/bar",-1);
  ContainerManager containerManager=new ContainerManager(serverFactory.getZooKeeperServer().getZKDatabase(),serverFactory.getZooKeeperServer().firstProcessor,1,100);
  containerManager.checkContainers();
  Thread.sleep(1000);
  Assert.assertNull("Container should have been deleted",zk.exists("/foo",false));
  createContainer=Op.create("/foo",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.CONTAINER);
  createChild=Op.create("/foo/bar",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Op deleteChild=Op.delete("/foo/bar",-1);
  zk.multi(Arrays.asList(createContainer,createChild,deleteChild));
  containerManager.checkContainers();
  Thread.sleep(1000);
  Assert.assertNull("Container should have been deleted",zk.exists("/foo",false));
}

</code></pre>

<br>
<pre class="type-6 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@SuppressWarnings("ConstantConditions") @Test(timeout=30000) public void testCreateWithNullStat() throws IOException, KeeperException, InterruptedException {
  final String name="/foo";
  Assert.assertNull(zk.exists(name,false));
  Stat stat=null;
  zk.create(name,name.getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.CONTAINER,stat);
  Assert.assertNull(stat);
  Assert.assertNotNull(zk.exists(name,false));
}

</code></pre>

<br>
<pre class="type-6 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test(timeout=30000) public void testFalseEmpty() throws IOException, KeeperException, InterruptedException {
  zk.create("/foo",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.CONTAINER);
  zk.create("/foo/bar",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  ContainerManager containerManager=new ContainerManager(serverFactory.getZooKeeperServer().getZKDatabase(),serverFactory.getZooKeeperServer().firstProcessor,1,100){
    @Override protected Collection<String> getCandidates(){
      return Collections.singletonList("/foo");
    }
  }
;
  containerManager.checkContainers();
  Thread.sleep(1000);
  Assert.assertNotNull("Container should have not been deleted",zk.exists("/foo",false));
}

</code></pre>

<br>
<pre class="type-6 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test(timeout=30000) public void testCascadingDeletion() throws IOException, KeeperException, InterruptedException {
  zk.create("/foo",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.CONTAINER);
  zk.create("/foo/bar",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.CONTAINER);
  zk.create("/foo/bar/one",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.delete("/foo/bar/one",-1);
  ContainerManager containerManager=new ContainerManager(serverFactory.getZooKeeperServer().getZKDatabase(),serverFactory.getZooKeeperServer().firstProcessor,1,100);
  containerManager.checkContainers();
  Thread.sleep(1000);
  containerManager.checkContainers();
  Thread.sleep(1000);
  Assert.assertNull("Container should have been deleted",zk.exists("/foo/bar",false));
  Assert.assertNull("Container should have been deleted",zk.exists("/foo",false));
}

</code></pre>

<br>
<pre class="type-6 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test(timeout=30000) public void testSimpleDeletion() throws IOException, KeeperException, InterruptedException {
  zk.create("/foo",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.CONTAINER);
  zk.create("/foo/bar",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.delete("/foo/bar",-1);
  ContainerManager containerManager=new ContainerManager(serverFactory.getZooKeeperServer().getZKDatabase(),serverFactory.getZooKeeperServer().firstProcessor,1,100);
  containerManager.checkContainers();
  Thread.sleep(1000);
  Assert.assertNull("Container should have been deleted",zk.exists("/foo",false));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testSimpleDeletionAsync() throws IOException, KeeperException, InterruptedException {
  final CountDownLatch latch=new CountDownLatch(1);
  AsyncCallback.Create2Callback cb=new AsyncCallback.Create2Callback(){
    @Override public void processResult(    int rc,    String path,    Object ctx,    String name,    Stat stat){
      Assert.assertEquals(ctx,"context");
      latch.countDown();
    }
  }
;
  zk.create("/foo",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.CONTAINER,cb,"context");
  Assert.assertTrue(latch.await(5,TimeUnit.SECONDS));
  zk.create("/foo/bar",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.delete("/foo/bar",-1);
  ContainerManager containerManager=new ContainerManager(serverFactory.getZooKeeperServer().getZKDatabase(),serverFactory.getZooKeeperServer().firstProcessor,1,100);
  containerManager.checkContainers();
  Thread.sleep(1000);
  Assert.assertNull("Container should have been deleted",zk.exists("/foo",false));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.DataTreeTest </h4><pre class="type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test(timeout=60000) public void testPathTrieClearOnDeserialize() throws Exception {
  DataTree dserTree=new DataTree();
  dserTree.createNode("/bug",new byte[20],null,-1,1,1,1);
  dserTree.createNode(Quotas.quotaZookeeper + "/bug",null,null,-1,1,1,1);
  dserTree.createNode(Quotas.quotaPath("/bug"),new byte[20],null,-1,1,1,1);
  dserTree.createNode(Quotas.statPath("/bug"),new byte[20],null,-1,1,1,1);
  DataTree tree=new DataTree();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  BinaryOutputArchive oa=BinaryOutputArchive.getArchive(baos);
  tree.serialize(oa,"test");
  baos.flush();
  ByteArrayInputStream bais=new ByteArrayInputStream(baos.toByteArray());
  BinaryInputArchive ia=BinaryInputArchive.getArchive(bais);
  dserTree.deserialize(ia,"test");
  Field pfield=DataTree.class.getDeclaredField("pTrie");
  pfield.setAccessible(true);
  PathTrie pTrie=(PathTrie)pfield.get(dserTree);
  Assert.assertEquals("/bug is still in pTrie","",pTrie.findMaxPrefix("/bug"));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies values related to public fields.
"></span><br>
/** 
 * For ZOOKEEPER-1046 test if cversion is getting incremented correctly.
 */
@Test(timeout=60000) public void testIncrementCversion() throws Exception {
  dt.createNode("/test",new byte[0],null,0,dt.getNode("/").stat.getCversion() + 1,1,1);
  DataNode zk=dt.getNode("/test");
  int prevCversion=zk.stat.getCversion();
  long prevPzxid=zk.stat.getPzxid();
  dt.setCversionPzxid("/test/",prevCversion + 1,prevPzxid + 1);
  int newCversion=zk.stat.getCversion();
  long newPzxid=zk.stat.getPzxid();
  Assert.assertTrue("<cversion, pzxid> verification failed. Expected: <" + (prevCversion + 1) + ", "+ (prevPzxid + 1)+ ">, found: <"+ newCversion+ ", "+ newPzxid+ ">",(newCversion == prevCversion + 1 && newPzxid == prevPzxid + 1));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.DatadirCleanupManagerTest </h4><pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testPurgeTask() throws Exception {
  purgeMgr=new DatadirCleanupManager(snapDir,dataLogDir,3,1);
  purgeMgr.start();
  Assert.assertEquals("Data log directory is not set as configured",dataLogDir,purgeMgr.getDataLogDir());
  Assert.assertEquals("Snapshot directory is not set as configured",snapDir,purgeMgr.getSnapDir());
  Assert.assertEquals("Snapshot retain count is not set as configured",3,purgeMgr.getSnapRetainCount());
  Assert.assertEquals("Purge task is not started",STARTED,purgeMgr.getPurgeTaskStatus());
  purgeMgr.shutdown();
  Assert.assertEquals("Purge task is still running after shutdown",COMPLETED,purgeMgr.getPurgeTaskStatus());
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testWithZeroPurgeInterval() throws Exception {
  purgeMgr=new DatadirCleanupManager(snapDir,dataLogDir,3,0);
  purgeMgr.start();
  Assert.assertEquals("Purge task is scheduled with zero purge interval",NOT_STARTED,purgeMgr.getPurgeTaskStatus());
  purgeMgr.shutdown();
  Assert.assertEquals("Purge task is scheduled with zero purge interval",NOT_STARTED,purgeMgr.getPurgeTaskStatus());
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testWithNegativePurgeInterval() throws Exception {
  purgeMgr=new DatadirCleanupManager(snapDir,dataLogDir,3,-1);
  purgeMgr.start();
  Assert.assertEquals("Purge task is scheduled with negative purge interval",NOT_STARTED,purgeMgr.getPurgeTaskStatus());
  purgeMgr.shutdown();
  Assert.assertEquals("Purge task is scheduled with negative purge interval",NOT_STARTED,purgeMgr.getPurgeTaskStatus());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.NIOServerCnxnTest </h4><pre class="type-3 type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test operations on ServerCnxn after socket closure.
 */
@Test(timeout=60000) public void testOperationsAfterCnxnClose() throws IOException, InterruptedException, KeeperException {
  final ZooKeeper zk=createClient();
  final String path="/a";
  try {
    zk.create(path,"test".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    Assert.assertNotNull("Didn't create znode:" + path,zk.exists(path,false));
    Assert.assertTrue("Didn't instantiate ServerCnxnFactory with NIOServerCnxnFactory!",serverFactory instanceof NIOServerCnxnFactory);
    Iterable<ServerCnxn> connections=serverFactory.getConnections();
    for (    ServerCnxn serverCnxn : connections) {
      serverCnxn.close();
      try {
        serverCnxn.toString();
      }
 catch (      Exception e) {
        LOG.error("Exception while getting connection details!",e);
        Assert.fail("Shouldn't throw exception while " + "getting connection details!");
      }
    }
  }
  finally {
    zk.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.NettyServerCnxnTest </h4><pre class="type-9 type-10 type-3 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies the channel closure - while closing the channel
 * servercnxnfactory should remove all channel references to avoid
 * duplicate channel closure. Duplicate closure may result in indefinite
 * hanging due to netty open issue.
 * @see <a href="https://issues.jboss.org/browse/NETTY-412">NETTY-412</a>
 */
@Test(timeout=40000) public void testSendCloseSession() throws Exception {
  Assert.assertTrue("Didn't instantiate ServerCnxnFactory with NettyServerCnxnFactory!",serverFactory instanceof NettyServerCnxnFactory);
  final ZooKeeper zk=createClient();
  final String path="/a";
  try {
    zk.create(path,"test".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    Assert.assertNotNull("Didn't create znode:" + path,zk.exists(path,false));
    Iterable<ServerCnxn> connections=serverFactory.getConnections();
    Assert.assertEquals("Mismatch in number of live connections!",1,serverFactory.getNumAliveConnections());
    for (    ServerCnxn serverCnxn : connections) {
      serverCnxn.sendCloseSession();
    }
    LOG.info("Waiting for the channel disconnected event");
    int timeout=0;
    while (serverFactory.getNumAliveConnections() != 0) {
      Thread.sleep(1000);
      timeout+=1000;
      if (timeout > CONNECTION_TIMEOUT) {
        Assert.fail("The number of live connections should be 0");
      }
    }
  }
  finally {
    zk.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.PrepRequestProcessorTest </h4><pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * It tests that PrepRequestProcessor will return BadArgument KeeperException
 * if the request path (if it exists) is not valid, e.g. empty string.
 */
@Test public void testInvalidPath() throws Exception {
  pLatch=new CountDownLatch(1);
  processor=new PrepRequestProcessor(zks,new MyRequestProcessor());
  SetDataRequest record=new SetDataRequest("",new byte[0],-1);
  Request req=createRequest(record,OpCode.setData);
  processor.pRequest(req);
  pLatch.await();
  Assert.assertEquals(outcome.getHdr().getType(),OpCode.error);
  Assert.assertEquals(outcome.getException().code(),KeeperException.Code.BADARGUMENTS);
}

</code></pre>

<br>
<pre class="type-6 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
/** 
 * ZOOKEEPER-2052:
 * This test checks that if a multi operation aborted, and during the multi there is side effect
 * that changed outstandingChangesForPath, after aborted the side effect should be removed and
 * everything should be restored correctly.
 */
@Test public void testMultiRollbackNoLastChange() throws Exception {
  zks.getZKDatabase().dataTree.createNode("/foo",new byte[0],Ids.OPEN_ACL_UNSAFE,0,0,0,0);
  zks.getZKDatabase().dataTree.createNode("/foo/bar",new byte[0],Ids.OPEN_ACL_UNSAFE,0,0,0,0);
  Assert.assertNull(zks.outstandingChangesForPath.get("/foo"));
  process(Arrays.asList(Op.setData("/foo",new byte[0],-1),Op.delete("/foo",-1)));
  Assert.assertNull(zks.outstandingChangesForPath.get("/foo"));
}

</code></pre>

<br>
<pre class="type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test checks that a successful multi will change outstanding record
 * and failed multi shouldn't change outstanding record.
 */
@Test public void testMultiOutstandingChange() throws Exception {
  zks.getZKDatabase().dataTree.createNode("/foo",new byte[0],Ids.OPEN_ACL_UNSAFE,0,0,0,0);
  Assert.assertNull(zks.outstandingChangesForPath.get("/foo"));
  process(Arrays.asList(Op.setData("/foo",new byte[0],-1)));
  ChangeRecord cr=zks.outstandingChangesForPath.get("/foo");
  Assert.assertNotNull("Change record wasn't set",cr);
  Assert.assertEquals("Record zxid wasn't set correctly",1,cr.zxid);
  process(Arrays.asList(Op.delete("/foo",-1)));
  cr=zks.outstandingChangesForPath.get("/foo");
  Assert.assertEquals("Record zxid wasn't set correctly",2,cr.zxid);
  process(Arrays.asList(Op.delete("/foo",-1)));
  cr=zks.outstandingChangesForPath.get("/foo");
  Assert.assertEquals("Record zxid wasn't set correctly",2,cr.zxid);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.PurgeTxnTest </h4><pre class="type-9 type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests finding n recent snapshots from set of snapshots and data logs
 */
@Test public void testFindNRecentSnapshots() throws Exception {
  int nRecentSnap=4;
  int nRecentCount=30;
  int offset=0;
  tmpDir=ClientBase.createTmpDir();
  File version2=new File(tmpDir.toString(),"version-2");
  Assert.assertTrue("Failed to create version_2 dir:" + version2.toString(),version2.mkdir());
  List<File> expectedNRecentSnapFiles=new ArrayList<File>();
  int counter=offset + (2 * nRecentCount);
  for (int i=0; i < nRecentCount; i++) {
    File logFile=new File(version2 + "/log." + Long.toHexString(--counter));
    Assert.assertTrue("Failed to create log File:" + logFile.toString(),logFile.createNewFile());
    File snapFile=new File(version2 + "/snapshot." + Long.toHexString(--counter));
    Assert.assertTrue("Failed to create snap File:" + snapFile.toString(),snapFile.createNewFile());
    if (i < nRecentSnap) {
      expectedNRecentSnapFiles.add(snapFile);
    }
  }
  FileTxnSnapLog txnLog=new FileTxnSnapLog(tmpDir,tmpDir);
  List<File> nRecentSnapFiles=txnLog.findNRecentSnapshots(nRecentSnap);
  txnLog.close();
  Assert.assertEquals("exactly 4 snapshots ",4,nRecentSnapFiles.size());
  expectedNRecentSnapFiles.removeAll(nRecentSnapFiles);
  Assert.assertEquals("Didn't get the recent snap files",0,expectedNRecentSnapFiles.size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.SessionTrackerTest </h4><pre class="type-5 type-6 type-8 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies values related to public fields.
"></span><br>
/** 
 * Verify the session closure request has reached PrepRequestProcessor soon
 * after session expiration by the session tracker
 */
@Test(timeout=20000) public void testCloseSessionRequestAfterSessionExpiry() throws Exception {
  ZooKeeperServer zks=setupSessionTracker();
  latch=new CountDownLatch(1);
  zks.sessionTracker.addSession(sessionId,sessionTimeout);
  SessionTrackerImpl sessionTrackerImpl=(SessionTrackerImpl)zks.sessionTracker;
  SessionImpl sessionImpl=sessionTrackerImpl.sessionsById.get(sessionId);
  Assert.assertNotNull("Sessionid:" + sessionId + " doesn't exists in sessiontracker",sessionImpl);
  Object sessionOwner=new Object();
  sessionTrackerImpl.checkSession(sessionId,sessionOwner);
  latch.await(sessionTimeout * 2,TimeUnit.MILLISECONDS);
  sessionTrackerImpl.removeSession(sessionId);
  SessionImpl actualSession=sessionTrackerImpl.sessionsById.get(sessionId);
  Assert.assertNull("Session:" + sessionId + " still exists after removal",actualSession);
}

</code></pre>

<br>
<pre class="type-5 type-3 type-2 type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify the create session call in the Leader.FinalRequestProcessor after
 * the session expiration.
 */
@Test(timeout=20000) public void testAddSessionAfterSessionExpiry() throws Exception {
  ZooKeeperServer zks=setupSessionTracker();
  latch=new CountDownLatch(1);
  zks.sessionTracker.addSession(sessionId,sessionTimeout);
  SessionTrackerImpl sessionTrackerImpl=(SessionTrackerImpl)zks.sessionTracker;
  SessionImpl sessionImpl=sessionTrackerImpl.sessionsById.get(sessionId);
  Assert.assertNotNull("Sessionid:" + sessionId + " doesn't exists in sessiontracker",sessionImpl);
  Object sessionOwner=new Object();
  sessionTrackerImpl.checkSession(sessionId,sessionOwner);
  latch.await(sessionTimeout * 2,TimeUnit.MILLISECONDS);
  sessionTrackerImpl.addSession(sessionId,sessionTimeout);
  try {
    sessionTrackerImpl.checkSession(sessionId,sessionOwner);
    Assert.fail("Should throw session expiry exception " + "as the session has expired and closed");
  }
 catch (  KeeperException.SessionExpiredException e) {
  }
  Assert.assertTrue("Session didn't expired",sessionImpl.isClosing());
  Assert.assertFalse("Session didn't expired",sessionTrackerImpl.touchSession(sessionId,sessionTimeout));
  Assert.assertEquals("Duplicate session expiry request has been generated",1,firstProcessor.getCountOfCloseSessionReq());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.WatchesPathReportTest </h4><pre class="type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetSessions(){
  Set<Long> s=r.getSessions("path1");
  assertEquals(2,s.size());
  assertTrue(s.contains(101L));
  assertTrue(s.contains(102L));
  s=r.getSessions("path2");
  assertEquals(1,s.size());
  assertTrue(s.contains(201L));
  assertNull(r.getSessions("path3"));
}

</code></pre>

<br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testHasSessions(){
  assertTrue(r.hasSessions("path1"));
  assertTrue(r.hasSessions("path2"));
  assertFalse(r.hasSessions("path3"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.WatchesReportTest </h4><pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testHasPaths(){
  assertTrue(r.hasPaths(1L));
  assertTrue(r.hasPaths(2L));
  assertFalse(r.hasPaths(3L));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetPaths(){
  Set<String> s=r.getPaths(1L);
  assertEquals(2,s.size());
  assertTrue(s.contains("path1a"));
  assertTrue(s.contains("path1b"));
  s=r.getPaths(2L);
  assertEquals(1,s.size());
  assertTrue(s.contains("path2a"));
  assertNull(r.getPaths(3L));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.WatchesSummaryTest </h4><pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetters(){
  assertEquals(1,s.getNumConnections());
  assertEquals(2,s.getNumPaths());
  assertEquals(3,s.getTotalWatches());
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testToMap(){
  Map<String,Object> m=s.toMap();
  assertEquals(3,m.size());
  assertEquals(Integer.valueOf(1),m.get(WatchesSummary.KEY_NUM_CONNECTIONS));
  assertEquals(Integer.valueOf(2),m.get(WatchesSummary.KEY_NUM_PATHS));
  assertEquals(Integer.valueOf(3),m.get(WatchesSummary.KEY_NUM_TOTAL_WATCHES));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.ZooKeeperServerBeanTest </h4><pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetSecureClientPort() throws IOException {
  ZooKeeperServer zks=new ZooKeeperServer();
  ZooKeeperServerBean serverBean=new ZooKeeperServerBean(zks);
  String result=serverBean.getSecureClientPort();
  assertEquals("",result);
  ServerCnxnFactory cnxnFactory=ServerCnxnFactory.createFactory();
  int secureClientPort=8443;
  InetSocketAddress address=new InetSocketAddress(secureClientPort);
  cnxnFactory.configure(address,5,true);
  zks.setSecureServerCnxnFactory(cnxnFactory);
  result=serverBean.getSecureClientPort();
  assertEquals(Integer.toString(secureClientPort),result);
  cnxnFactory.shutdown();
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetSecureClientAddress() throws IOException {
  ZooKeeperServer zks=new ZooKeeperServer();
  ZooKeeperServerBean serverBean=new ZooKeeperServerBean(zks);
  String result=serverBean.getSecureClientPort();
  assertEquals("",result);
  ServerCnxnFactory cnxnFactory=ServerCnxnFactory.createFactory();
  int secureClientPort=8443;
  InetSocketAddress address=new InetSocketAddress(secureClientPort);
  cnxnFactory.configure(address,5,true);
  zks.setSecureServerCnxnFactory(cnxnFactory);
  result=serverBean.getSecureClientAddress();
  String ipv4="0.0.0.0:" + secureClientPort;
  String ipv6="0:0:0:0:0:0:0:0:" + secureClientPort;
  assertTrue(result.equals(ipv4) || result.equals(ipv6));
  cnxnFactory.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.ZooKeeperServerConfTest </h4><pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetters(){
  assertEquals(1,c.getClientPort());
  assertEquals("a",c.getDataDir());
  assertEquals("b",c.getDataLogDir());
  assertEquals(2,c.getTickTime());
  assertEquals(3,c.getMaxClientCnxnsPerHost());
  assertEquals(4,c.getMinSessionTimeout());
  assertEquals(5,c.getMaxSessionTimeout());
  assertEquals(6L,c.getServerId());
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testToMap(){
  Map<String,Object> m=c.toMap();
  assertEquals(8,m.size());
  assertEquals(Integer.valueOf(1),m.get(ZooKeeperServerConf.KEY_CLIENT_PORT));
  assertEquals("a",m.get(ZooKeeperServerConf.KEY_DATA_DIR));
  assertEquals("b",m.get(ZooKeeperServerConf.KEY_DATA_LOG_DIR));
  assertEquals(Integer.valueOf(2),m.get(ZooKeeperServerConf.KEY_TICK_TIME));
  assertEquals(Integer.valueOf(3),m.get(ZooKeeperServerConf.KEY_MAX_CLIENT_CNXNS));
  assertEquals(Integer.valueOf(4),m.get(ZooKeeperServerConf.KEY_MIN_SESSION_TIMEOUT));
  assertEquals(Integer.valueOf(5),m.get(ZooKeeperServerConf.KEY_MAX_SESSION_TIMEOUT));
  assertEquals(Long.valueOf(6L),m.get(ZooKeeperServerConf.KEY_SERVER_ID));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.ZooKeeperServerMainTest </h4><pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify the ability to start a standalone server instance.
 */
@Test public void testStandalone() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT=PortAssignment.unique();
  MainThread main=new MainThread(CLIENT_PORT,true,null);
  main.start();
  Assert.assertTrue("waiting for server being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=new ZooKeeper("127.0.0.1:" + CLIENT_PORT,ClientBase.CONNECTION_TIMEOUT,this);
  zk.create("/foo","foobar".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertEquals(new String(zk.getData("/foo",null,null)),"foobar");
  zk.close();
  main.shutdown();
  main.join();
  main.deleteDirs();
  Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT,ClientBase.CONNECTION_TIMEOUT));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies the auto creation of data dir and data log dir.
 * Sets "zookeeper.datadir.autocreate" to true.
 */
@Test(timeout=30000) public void testWithAutoCreateDataLogDir() throws Exception {
  ClientBase.setupTestEnv();
  System.setProperty(FileTxnSnapLog.ZOOKEEPER_DATADIR_AUTOCREATE,"true");
  final int CLIENT_PORT=PortAssignment.unique();
  MainThread main=new MainThread(CLIENT_PORT,false,null);
  String args[]=new String[1];
  args[0]=main.confFile.toString();
  main.start();
  Assert.assertTrue("waiting for server being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=new ZooKeeper("127.0.0.1:" + CLIENT_PORT,ClientBase.CONNECTION_TIMEOUT,this);
  zk.create("/foo","foobar".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertEquals(new String(zk.getData("/foo",null,null)),"foobar");
  zk.close();
  main.shutdown();
  main.join();
  main.deleteDirs();
  Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT,ClientBase.CONNECTION_TIMEOUT));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.admin.CommandResponseTest </h4><pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMap(){
  r.put("missing","sudo");
  Map<String,Object> m=new HashMap<String,Object>();
  m.put("origin","xkcd");
  m.put("url","http://xkcd.com/149/");
  r.putAll(m);
  Map<String,Object> rmap=r.toMap();
  assertEquals(5,rmap.size());
  assertEquals("makemeasandwich",rmap.get(CommandResponse.KEY_COMMAND));
  assertEquals("makeityourself",rmap.get(CommandResponse.KEY_ERROR));
  assertEquals("sudo",rmap.get("missing"));
  assertEquals("xkcd",rmap.get("origin"));
  assertEquals("http://xkcd.com/149/",rmap.get("url"));
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetters(){
  assertEquals("makemeasandwich",r.getCommand());
  assertEquals("makeityourself",r.getError());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.jersey.CreateTest </h4><pre class="type-5 type-10 type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreate() throws Exception {
  WebResource wr=znodesr.path(path).queryParam("dataformat",encoding).queryParam("name",name);
  if (data == null) {
    wr=wr.queryParam("null","true");
  }
  if (sequence) {
    wr=wr.queryParam("sequence","true");
  }
  Builder builder=wr.accept(accept);
  ClientResponse cr;
  if (data == null) {
    cr=builder.post(ClientResponse.class);
  }
 else {
    cr=builder.post(ClientResponse.class,data);
  }
  Assert.assertEquals(expectedStatus,cr.getClientResponseStatus());
  if (expectedPath == null) {
    return;
  }
  ZPath zpath=cr.getEntity(ZPath.class);
  if (sequence) {
    Assert.assertTrue(zpath.path.startsWith(expectedPath.path));
    Assert.assertTrue(zpath.uri.startsWith(znodesr.path(path).toString()));
  }
 else {
    Assert.assertEquals(expectedPath,zpath);
    Assert.assertEquals(znodesr.path(path).toString(),zpath.uri);
  }
  byte[] data=zk.getData(zpath.path,false,new Stat());
  if (data == null && this.data == null) {
    return;
  }
 else   if (data == null || this.data == null) {
    Assert.assertEquals(data,this.data);
  }
 else {
    Assert.assertTrue(new String(data) + " == " + new String(this.data),Arrays.equals(data,this.data));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.jersey.GetChildrenTest </h4><pre class="type-5 type-10 type-3 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetChildren() throws Exception {
  if (expectedChildren != null) {
    for (    String child : expectedChildren) {
      zk.create(expectedPath + "/" + child,null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    }
  }
  ClientResponse cr=znodesr.path(path).queryParam("view","children").accept(accept).get(ClientResponse.class);
  Assert.assertEquals(expectedStatus,cr.getClientResponseStatus());
  if (expectedChildren == null) {
    return;
  }
  if (accept.equals(MediaType.APPLICATION_JSON)) {
    ZChildrenJSON zchildren=cr.getEntity(ZChildrenJSON.class);
    Collections.sort(expectedChildren);
    Collections.sort(zchildren.children);
    Assert.assertEquals(expectedChildren,zchildren.children);
    Assert.assertEquals(znodesr.path(path).toString(),zchildren.uri);
    Assert.assertEquals(znodesr.path(path).toString() + "/{child}",zchildren.child_uri_template);
  }
 else   if (accept.equals(MediaType.APPLICATION_XML)) {
    ZChildren zchildren=cr.getEntity(ZChildren.class);
    Collections.sort(expectedChildren);
    Collections.sort(zchildren.children);
    Assert.assertEquals(expectedChildren,zchildren.children);
    Assert.assertEquals(znodesr.path(path).toString(),zchildren.uri);
    Assert.assertEquals(znodesr.path(path).toString() + "/{child}",zchildren.child_uri_template);
  }
 else {
    Assert.fail("unknown accept type");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.jersey.GetTest </h4><pre class="type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGet() throws Exception {
  if (expectedStat != null) {
    if (expectedStat.data64 != null || expectedStat.dataUtf8 == null) {
      zk.setData(expectedStat.path,expectedStat.data64,-1);
    }
 else {
      zk.setData(expectedStat.path,expectedStat.dataUtf8.getBytes(),-1);
    }
  }
  ClientResponse cr=znodesr.path(path).queryParam("dataformat",encoding).accept(accept).get(ClientResponse.class);
  Assert.assertEquals(expectedStatus,cr.getClientResponseStatus());
  if (expectedStat == null) {
    return;
  }
  ZStat zstat=cr.getEntity(ZStat.class);
  Assert.assertEquals(expectedStat,zstat);
  Assert.assertEquals(znodesr.path(path).toString(),zstat.uri);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.jersey.RootTest </h4><pre class="type-5 type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreate() throws Exception {
  String path="/";
  String name="roottest-create";
  byte[] data="foo".getBytes();
  WebResource wr=znodesr.path(path).queryParam("dataformat","utf8").queryParam("name",name);
  Builder builder=wr.accept(MediaType.APPLICATION_JSON);
  ClientResponse cr;
  cr=builder.post(ClientResponse.class,data);
  Assert.assertEquals(ClientResponse.Status.CREATED,cr.getClientResponseStatus());
  ZPath zpath=cr.getEntity(ZPath.class);
  Assert.assertEquals(new ZPath(path + name),zpath);
  Assert.assertEquals(znodesr.path(path).toString(),zpath.uri);
  byte[] rdata=zk.getData(zpath.path,false,new Stat());
  Assert.assertTrue(new String(rdata) + " == " + new String(data),Arrays.equals(rdata,data));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.jersey.SessionTest </h4><pre class="type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeleteSession(){
  ZSession session=createSession("30");
  WebResource wr=sessionsr.path(session.id);
  Builder b=wr.accept(MediaType.APPLICATION_JSON);
  Assert.assertTrue(ZooKeeperService.isConnected(CONTEXT_PATH,session.id));
  ClientResponse cr=b.delete(ClientResponse.class,null);
  Assert.assertEquals(ClientResponse.Status.NO_CONTENT,cr.getClientResponseStatus());
  Assert.assertFalse(ZooKeeperService.isConnected(CONTEXT_PATH,session.id));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSendHeartbeat() throws InterruptedException {
  ZSession session=createSession("2");
  Thread.sleep(1000);
  WebResource wr=sessionsr.path(session.id);
  Builder b=wr.accept(MediaType.APPLICATION_JSON);
  ClientResponse cr=b.put(ClientResponse.class,null);
  Assert.assertEquals(ClientResponse.Status.OK,cr.getClientResponseStatus());
  Thread.sleep(1500);
  Assert.assertTrue(ZooKeeperService.isConnected(CONTEXT_PATH,session.id));
  Thread.sleep(1000);
  Assert.assertFalse(ZooKeeperService.isConnected(CONTEXT_PATH,session.id));
}

</code></pre>

<br>
<pre class="type-6 type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testCreateEphemeralZNode() throws KeeperException, InterruptedException, IOException {
  ZSession session=createSession("30");
  WebResource wr=znodesr.path("/").queryParam("op","create").queryParam("name","ephemeral-test").queryParam("ephemeral","true").queryParam("session",session.id).queryParam("null","true");
  Builder b=wr.accept(MediaType.APPLICATION_JSON);
  ClientResponse cr=b.post(ClientResponse.class);
  Assert.assertEquals(ClientResponse.Status.CREATED,cr.getClientResponseStatus());
  Stat stat=new Stat();
  zk.getData("/ephemeral-test",false,stat);
  ZooKeeper sessionZK=ZooKeeperService.getClient(CONTEXT_PATH,session.id);
  Assert.assertEquals(stat.getEphemeralOwner(),sessionZK.getSessionId());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.jersey.SetTest </h4><pre class="type-5 type-10 type-3 type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSet() throws Exception {
  if (expectedStat != null) {
    zk.create(expectedStat.path,"initial".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  }
  WebResource wr=znodesr.path(path).queryParam("dataformat",encoding);
  if (data == null) {
    wr=wr.queryParam("null","true");
  }
  Builder builder=wr.accept(accept).type(MediaType.APPLICATION_OCTET_STREAM);
  ClientResponse cr;
  if (data == null) {
    cr=builder.put(ClientResponse.class);
  }
 else {
    cr=builder.put(ClientResponse.class,new String(data));
  }
  Assert.assertEquals(expectedStatus,cr.getClientResponseStatus());
  if (expectedStat == null) {
    return;
  }
  ZStat zstat=cr.getEntity(ZStat.class);
  Assert.assertEquals(expectedStat,zstat);
  byte[] data=zk.getData(zstat.path,false,new Stat());
  if (data == null && this.data == null) {
    return;
  }
 else   if (data == null || this.data == null) {
    Assert.fail((data == null ? null : new String(data)) + " == " + (this.data == null ? null : new String(this.data)));
  }
 else {
    Assert.assertTrue(new String(data) + " == " + new String(this.data),Arrays.equals(data,this.data));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.jersey.WadlTest </h4><pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testApplicationWadl(){
  WebResource r=client.resource(BASEURI);
  String serviceWadl=r.path("application.wadl").accept(MediaTypes.WADL).get(String.class);
  Assert.assertTrue("Something wrong. Returned wadl length not > 0.",serviceWadl.length() > 0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.LearnerHandlerTest </h4><pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test cases when learner has new-epcoh zxid
 * (zxid & 0xffffffffL) == 0;
 */
@Test public void testNewEpochZxidWithTxnlogOnly() throws Exception {
  long peerZxid;
  db.txnLog.add(createProposal(getZxid(1,1)));
  db.txnLog.add(createProposal(getZxid(2,1)));
  db.txnLog.add(createProposal(getZxid(2,2)));
  db.txnLog.add(createProposal(getZxid(4,1)));
  db.lastProcessedZxid=getZxid(6,0);
  peerZxid=getZxid(3,0);
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,getZxid(6,0),getZxid(4,1));
  assertEquals(3,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{getZxid(4,1)});
  reset();
  peerZxid=getZxid(4,0);
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,getZxid(6,0),getZxid(4,1));
  assertEquals(3,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{getZxid(4,1)});
  reset();
  peerZxid=getZxid(5,0);
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,getZxid(6,0),getZxid(5,0));
  assertEquals(1,learnerHandler.getQueuedPackets().size());
  reset();
  peerZxid=getZxid(6,0);
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,getZxid(6,0),getZxid(6,0));
  assertEquals(1,learnerHandler.getQueuedPackets().size());
  reset();
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test cases when leader has empty commitedLog
 */
@Test public void testEmptyCommittedLog() throws Exception {
  long peerZxid;
  peerZxid=3;
  db.lastProcessedZxid=1;
  db.committedLog.clear();
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.TRUNC,db.lastProcessedZxid,db.lastProcessedZxid);
  reset();
  peerZxid=1;
  db.lastProcessedZxid=1;
  db.committedLog.clear();
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,db.lastProcessedZxid,db.lastProcessedZxid);
  assertEquals(1,learnerHandler.getQueuedPackets().size());
  reset();
  peerZxid=0;
  db.setSnapshotSizeFactor(-1);
  db.lastProcessedZxid=1;
  db.committedLog.clear();
  assertTrue(learnerHandler.syncFollower(peerZxid,db,leader));
  assertEquals(0,learnerHandler.getQueuedPackets().size());
  reset();
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test cases when txnlog is enabled
 */
@Test public void testTxnLog() throws Exception {
  long peerZxid;
  db.txnLog.add(createProposal(2));
  db.txnLog.add(createProposal(3));
  db.txnLog.add(createProposal(5));
  db.txnLog.add(createProposal(6));
  db.txnLog.add(createProposal(7));
  db.txnLog.add(createProposal(8));
  db.txnLog.add(createProposal(9));
  db.lastProcessedZxid=9;
  db.committedLog.add(createProposal(6));
  db.committedLog.add(createProposal(7));
  db.committedLog.add(createProposal(8));
  peerZxid=4;
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.TRUNC,3,db.getmaxCommittedLog());
  assertEquals(9,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{5,6,7,8});
  reset();
  peerZxid=3;
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,db.getmaxCommittedLog(),db.getmaxCommittedLog());
  assertEquals(9,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{5,6,7,8});
  reset();
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test cases when peer has new-epoch zxid
 */
@Test public void testNewEpochZxid() throws Exception {
  long peerZxid;
  db.txnLog.add(createProposal(getZxid(0,1)));
  db.txnLog.add(createProposal(getZxid(1,1)));
  db.txnLog.add(createProposal(getZxid(1,2)));
  db.lastProcessedZxid=getZxid(2,0);
  db.committedLog.add(createProposal(getZxid(1,1)));
  db.committedLog.add(createProposal(getZxid(1,2)));
  peerZxid=getZxid(0,0);
  assertTrue(learnerHandler.syncFollower(peerZxid,db,leader));
  assertEquals(0,learnerHandler.getQueuedPackets().size());
  reset();
  peerZxid=getZxid(1,0);
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,getZxid(1,2),getZxid(1,2));
  assertEquals(5,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{getZxid(1,1),getZxid(1,2)});
  reset();
  peerZxid=getZxid(2,0);
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,getZxid(2,0),getZxid(2,0));
  assertEquals(1,learnerHandler.getQueuedPackets().size());
  reset();
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test cases when txnlog is enabled and commitedLog is empty
 */
@Test public void testTxnLogOnly() throws Exception {
  long peerZxid;
  db.lastProcessedZxid=7;
  db.txnLog.add(createProposal(2));
  db.txnLog.add(createProposal(3));
  db.txnLog.add(createProposal(5));
  db.txnLog.add(createProposal(6));
  db.txnLog.add(createProposal(7));
  db.txnLog.add(createProposal(8));
  peerZxid=4;
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.TRUNC,3,db.lastProcessedZxid);
  assertEquals(7,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{5,6,7});
  reset();
  peerZxid=2;
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,db.lastProcessedZxid,db.lastProcessedZxid);
  assertEquals(9,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{3,5,6,7});
  reset();
  peerZxid=1;
  assertTrue(learnerHandler.syncFollower(peerZxid,db,leader));
  assertEquals(0,learnerHandler.getQueuedPackets().size());
  reset();
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test cases when leader has committedLog
 */
@Test public void testCommittedLog() throws Exception {
  long peerZxid;
  db.lastProcessedZxid=6;
  db.committedLog.add(createProposal(2));
  db.committedLog.add(createProposal(3));
  db.committedLog.add(createProposal(5));
  peerZxid=4;
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.TRUNC,3,5);
  assertEquals(3,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{5});
  reset();
  peerZxid=2;
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,db.getmaxCommittedLog(),db.getmaxCommittedLog());
  assertEquals(5,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{3,5});
  reset();
  peerZxid=1;
  db.setSnapshotSizeFactor(-1);
  assertTrue(learnerHandler.syncFollower(peerZxid,db,leader));
  assertEquals(0,learnerHandler.getQueuedPackets().size());
  reset();
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test cases with zxids that are negative long
 */
@Test public void testTxnLogWithNegativeZxid() throws Exception {
  long peerZxid;
  db.txnLog.add(createProposal(getZxid(0xf,2)));
  db.txnLog.add(createProposal(getZxid(0xf,3)));
  db.txnLog.add(createProposal(getZxid(0xf,5)));
  db.txnLog.add(createProposal(getZxid(0xf,6)));
  db.txnLog.add(createProposal(getZxid(0xf,7)));
  db.txnLog.add(createProposal(getZxid(0xf,8)));
  db.txnLog.add(createProposal(getZxid(0xf,9)));
  db.lastProcessedZxid=getZxid(0xf,9);
  db.committedLog.add(createProposal(getZxid(0xf,6)));
  db.committedLog.add(createProposal(getZxid(0xf,7)));
  db.committedLog.add(createProposal(getZxid(0xf,8)));
  peerZxid=getZxid(0xf,4);
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.TRUNC,getZxid(0xf,3),db.getmaxCommittedLog());
  assertEquals(9,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{getZxid(0xf,5),getZxid(0xf,6),getZxid(0xf,7),getZxid(0xf,8)});
  reset();
  peerZxid=getZxid(0xf,3);
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,db.getmaxCommittedLog(),db.getmaxCommittedLog());
  assertEquals(9,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{getZxid(0xf,5),getZxid(0xf,6),getZxid(0xf,7),getZxid(0xf,8)});
  reset();
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test cases when we have to TRUNC learner, but it may cross epoch boundary
 * so we need to send snap instead
 */
@Test public void testCrossEpochTrunc() throws Exception {
  long peerZxid;
  db.txnLog.add(createProposal(getZxid(1,1)));
  db.txnLog.add(createProposal(getZxid(2,1)));
  db.txnLog.add(createProposal(getZxid(2,2)));
  db.txnLog.add(createProposal(getZxid(4,1)));
  db.lastProcessedZxid=getZxid(6,0);
  peerZxid=getZxid(3,1);
  assertTrue(learnerHandler.syncFollower(peerZxid,db,leader));
  assertEquals(0,learnerHandler.getQueuedPackets().size());
  reset();
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test cases when there is a duplicate txn in the committedLog. This
 * should never happen unless there is a bug in initialization code
 * but the learner should never see duplicate packets
 */
@Test public void testDuplicatedTxn() throws Exception {
  long peerZxid;
  db.txnLog.add(createProposal(getZxid(0,1)));
  db.txnLog.add(createProposal(getZxid(1,1)));
  db.txnLog.add(createProposal(getZxid(1,2)));
  db.txnLog.add(createProposal(getZxid(1,1)));
  db.txnLog.add(createProposal(getZxid(1,2)));
  db.lastProcessedZxid=getZxid(2,0);
  db.committedLog.add(createProposal(getZxid(1,1)));
  db.committedLog.add(createProposal(getZxid(1,2)));
  db.committedLog.add(createProposal(getZxid(1,1)));
  db.committedLog.add(createProposal(getZxid(1,2)));
  peerZxid=getZxid(1,0);
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,getZxid(1,2),getZxid(1,2));
  assertEquals(5,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{getZxid(1,1),getZxid(1,2)});
  reset();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.LearnerSnapshotThrottlerTest </h4><pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testPositiveTimeout() throws Exception {
  final LearnerSnapshotThrottler throttler=new LearnerSnapshotThrottler(1,200);
  ExecutorService threadPool=Executors.newFixedThreadPool(1);
  LearnerSnapshot first=throttler.beginSnapshot(false);
  final CountDownLatch snapshotProgressLatch=new CountDownLatch(1);
  Future<Boolean> result=threadPool.submit(new Callable<Boolean>(){
    @Override public Boolean call(){
      try {
        snapshotProgressLatch.countDown();
        LearnerSnapshot second=throttler.beginSnapshot(false);
        second.close();
      }
 catch (      Exception e) {
        return false;
      }
      return true;
    }
  }
);
  snapshotProgressLatch.await();
  first.close();
  Assert.assertTrue(result.get());
}

</code></pre>

<br>
<pre class="type-9 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTryWithResourceNoThrottle() throws Exception {
  LearnerSnapshotThrottler throttler=new LearnerSnapshotThrottler(1);
  for (int i=0; i < 3; i++) {
    LearnerSnapshot snapshot=throttler.beginSnapshot(false);
    try {
      Assert.assertFalse(snapshot.isEssential());
      Assert.assertEquals(1,snapshot.getConcurrentSnapshotNumber());
    }
  finally {
      snapshot.close();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.LearnerTest </h4><pre class="type-3 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void connectionInitLimitTimeoutTest() throws Exception {
  TimeoutLearner learner=new TimeoutLearner();
  learner.self=new QuorumPeer();
  learner.self.setTickTime(2000);
  learner.self.setInitLimit(5);
  learner.self.setSyncLimit(2);
  InetSocketAddress addr=new InetSocketAddress(1111);
  learner.setTimeMultiplier((long)4000 * 1000000);
  learner.setPassConnectAttempt(5);
  try {
    learner.connectToLeader(addr);
    Assert.fail("should have thrown IOException!");
  }
 catch (  IOException e) {
    Assert.assertTrue(learner.nanoTime() > 2000 * 5 * 1000000);
    Assert.assertEquals(3,learner.getSockConnectAttempt());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.LocalPeerBeanTest </h4><pre class="type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test case for https://issues.apache.org/jira/browse/ZOOKEEPER-2299
 */
@Test public void testClientAddress() throws Exception {
  QuorumPeer quorumPeer=new QuorumPeer();
  LocalPeerBean remotePeerBean=new LocalPeerBean(quorumPeer);
  String result=remotePeerBean.getClientAddress();
  assertNotNull(result);
  assertEquals(0,result.length());
  ServerCnxnFactory cnxnFactory=ServerCnxnFactory.createFactory();
  int clientPort=2181;
  InetSocketAddress address=new InetSocketAddress(clientPort);
  cnxnFactory.configure(address,5,false);
  quorumPeer.setCnxnFactory(cnxnFactory);
  result=remotePeerBean.getClientAddress();
  String ipv4="0.0.0.0:" + clientPort;
  String ipv6="0:0:0:0:0:0:0:0:" + clientPort;
  assertTrue(result.equals(ipv4) || result.equals(ipv6));
  cnxnFactory.shutdown();
  InetAddress clientIP=InetAddress.getByAddress(new byte[]{127,0,0,2});
  address=new InetSocketAddress(clientIP,clientPort);
  cnxnFactory=ServerCnxnFactory.createFactory();
  cnxnFactory.configure(address,5,false);
  quorumPeer.setCnxnFactory(cnxnFactory);
  result=remotePeerBean.getClientAddress();
  String expectedResult="127.0.0.2:" + clientPort;
  assertEquals(expectedResult,result);
  cnxnFactory.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.QuorumPeerMainTest </h4><pre class="type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies that the server is able to redefine if user configured only
 * minSessionTimeout limit
 */
@Test public void testWithOnlyMinSessionTimeout() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT_QP1=PortAssignment.unique();
  final int CLIENT_PORT_QP2=PortAssignment.unique();
  String quorumCfgSection="server.1=127.0.0.1:" + PortAssignment.unique() + ":"+ PortAssignment.unique()+ "\nserver.2=127.0.0.1:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique();
  final int minSessionTimeOut=15000;
  final String configs="minSessionTimeout=" + minSessionTimeOut + "\n";
  MainThread q1=new MainThread(1,CLIENT_PORT_QP1,quorumCfgSection,configs);
  MainThread q2=new MainThread(2,CLIENT_PORT_QP2,quorumCfgSection,configs);
  q1.start();
  q2.start();
  Assert.assertTrue("waiting for server 1 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP1,CONNECTION_TIMEOUT));
  Assert.assertTrue("waiting for server 2 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP2,CONNECTION_TIMEOUT));
  QuorumPeer quorumPeer=q1.main.quorumPeer;
  final int maxSessionTimeOut=quorumPeer.tickTime * 20;
  Assert.assertEquals("minimumSessionTimeOut is not considered",minSessionTimeOut,quorumPeer.getMinSessionTimeout());
  Assert.assertEquals("maximumSessionTimeOut is wrong",maxSessionTimeOut,quorumPeer.getMaxSessionTimeout());
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies that the server is able to redefine the min/max session
 * timeouts
 */
@Test public void testMinMaxSessionTimeOut() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT_QP1=PortAssignment.unique();
  final int CLIENT_PORT_QP2=PortAssignment.unique();
  String quorumCfgSection="server.1=127.0.0.1:" + PortAssignment.unique() + ":"+ PortAssignment.unique()+ "\nserver.2=127.0.0.1:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique();
  final int minSessionTimeOut=10000;
  final int maxSessionTimeOut=15000;
  final String configs="maxSessionTimeout=" + maxSessionTimeOut + "\n"+ "minSessionTimeout="+ minSessionTimeOut+ "\n";
  MainThread q1=new MainThread(1,CLIENT_PORT_QP1,quorumCfgSection,configs);
  MainThread q2=new MainThread(2,CLIENT_PORT_QP2,quorumCfgSection,configs);
  q1.start();
  q2.start();
  Assert.assertTrue("waiting for server 1 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP1,CONNECTION_TIMEOUT));
  Assert.assertTrue("waiting for server 2 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP2,CONNECTION_TIMEOUT));
  QuorumPeer quorumPeer=q1.main.quorumPeer;
  Assert.assertEquals("minimumSessionTimeOut is not considered",minSessionTimeOut,quorumPeer.getMinSessionTimeout());
  Assert.assertEquals("maximumSessionTimeOut is not considered",maxSessionTimeOut,quorumPeer.getMaxSessionTimeout());
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify the ability to start a cluster.
 */
@Test public void testQuorum() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT_QP1=PortAssignment.unique();
  final int CLIENT_PORT_QP2=PortAssignment.unique();
  String quorumCfgSection="server.1=127.0.0.1:" + PortAssignment.unique() + ":"+ PortAssignment.unique()+ ";"+ CLIENT_PORT_QP1+ "\nserver.2=127.0.0.1:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ";"+ CLIENT_PORT_QP2;
  MainThread q1=new MainThread(1,CLIENT_PORT_QP1,quorumCfgSection);
  MainThread q2=new MainThread(2,CLIENT_PORT_QP2,quorumCfgSection);
  q1.start();
  q2.start();
  Assert.assertTrue("waiting for server 1 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP1,CONNECTION_TIMEOUT));
  Assert.assertTrue("waiting for server 2 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP2,CONNECTION_TIMEOUT));
  QuorumPeer quorumPeer=q1.main.quorumPeer;
  int tickTime=quorumPeer.getTickTime();
  Assert.assertEquals("Default value of minimumSessionTimeOut is not considered",tickTime * 2,quorumPeer.getMinSessionTimeout());
  Assert.assertEquals("Default value of maximumSessionTimeOut is not considered",tickTime * 20,quorumPeer.getMaxSessionTimeout());
  ZooKeeper zk=new ZooKeeper("127.0.0.1:" + CLIENT_PORT_QP1,ClientBase.CONNECTION_TIMEOUT,this);
  waitForOne(zk,States.CONNECTED);
  zk.create("/foo_q1","foobar1".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertEquals(new String(zk.getData("/foo_q1",null,null)),"foobar1");
  zk.close();
  zk=new ZooKeeper("127.0.0.1:" + CLIENT_PORT_QP2,ClientBase.CONNECTION_TIMEOUT,this);
  waitForOne(zk,States.CONNECTED);
  zk.create("/foo_q2","foobar2".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertEquals(new String(zk.getData("/foo_q2",null,null)),"foobar2");
  zk.close();
  q1.shutdown();
  q2.shutdown();
  Assert.assertTrue("waiting for server 1 down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_QP1,ClientBase.CONNECTION_TIMEOUT));
  Assert.assertTrue("waiting for server 2 down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_QP2,ClientBase.CONNECTION_TIMEOUT));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * verify if bad packets are being handled properly
 * at the quorum port
 * @throws Exception
 */
@Test public void testBadPackets() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT_QP1=PortAssignment.unique();
  final int CLIENT_PORT_QP2=PortAssignment.unique();
  int electionPort1=PortAssignment.unique();
  int electionPort2=PortAssignment.unique();
  String quorumCfgSection="server.1=127.0.0.1:" + PortAssignment.unique() + ":"+ electionPort1+ ";"+ CLIENT_PORT_QP1+ "\nserver.2=127.0.0.1:"+ PortAssignment.unique()+ ":"+ electionPort2+ ";"+ CLIENT_PORT_QP2;
  MainThread q1=new MainThread(1,CLIENT_PORT_QP1,quorumCfgSection);
  MainThread q2=new MainThread(2,CLIENT_PORT_QP2,quorumCfgSection);
  q1.start();
  q2.start();
  Assert.assertTrue("waiting for server 1 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP1,CONNECTION_TIMEOUT));
  Assert.assertTrue("waiting for server 2 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP2,CONNECTION_TIMEOUT));
  byte[] b=new byte[4];
  int length=1024 * 1024 * 1024;
  ByteBuffer buff=ByteBuffer.wrap(b);
  buff.putInt(length);
  buff.position(0);
  SocketChannel s=SocketChannel.open(new InetSocketAddress("127.0.0.1",electionPort1));
  s.write(buff);
  s.close();
  buff.position(0);
  s=SocketChannel.open(new InetSocketAddress("127.0.0.1",electionPort2));
  s.write(buff);
  s.close();
  ZooKeeper zk=new ZooKeeper("127.0.0.1:" + CLIENT_PORT_QP1,ClientBase.CONNECTION_TIMEOUT,this);
  waitForOne(zk,States.CONNECTED);
  zk.create("/foo_q1","foobar1".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertEquals(new String(zk.getData("/foo_q1",null,null)),"foobar1");
  zk.close();
  q1.shutdown();
  q2.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.QuorumRequestPipelineTest </h4><pre class="type-6 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testDelete() throws Exception {
  create2EmptyNode(zkClient,PARENT_PATH);
  zkClient.delete(PARENT_PATH,-1);
  Assert.assertNull(String.format("%s Node no longer exists",serverState),zkClient.exists(PARENT_PATH,false));
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCreate() throws Exception {
  zkClient.create(PARENT_PATH,DATA,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertArrayEquals(String.format("%s Node created (create) with expected value",serverState),DATA,zkClient.getData(PARENT_PATH,false,null));
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSetAndGetACL() throws Exception {
  create2EmptyNode(zkClient,PARENT_PATH);
  Assert.assertEquals(String.format("%s Node has open ACL",serverState),Ids.OPEN_ACL_UNSAFE,zkClient.getACL(PARENT_PATH,new Stat()));
  zkClient.setACL(PARENT_PATH,Ids.READ_ACL_UNSAFE,-1);
  Assert.assertEquals(String.format("%s Node has world read-only ACL",serverState),Ids.READ_ACL_UNSAFE,zkClient.getACL(PARENT_PATH,new Stat()));
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSetAndGetData() throws Exception {
  create2EmptyNode(zkClient,PARENT_PATH);
  zkClient.setData(PARENT_PATH,DATA,-1);
  Assert.assertArrayEquals(String.format("%s Node updated with expected value",serverState),DATA,zkClient.getData(PARENT_PATH,false,null));
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCreate2() throws Exception {
  zkClient.create(PARENT_PATH,DATA,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT,null);
  Assert.assertArrayEquals(String.format("%s Node created (create2) with expected value",serverState),DATA,zkClient.getData(PARENT_PATH,false,null));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.ReconfigFailureCasesTest </h4><pre class="type-3 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLeaderTimesoutOnNewQuorum() throws Exception {
  qu=new QuorumUtil(1);
  qu.disableJMXTest=true;
  qu.startAll();
  ZooKeeper[] zkArr=ReconfigTest.createHandles(qu);
  List<String> leavingServers=new ArrayList<String>();
  leavingServers.add("3");
  qu.shutdown(2);
  try {
    zkArr[1].reconfig(null,leavingServers,null,-1,null);
    Assert.fail("Reconfig should have failed since we don't have quorum of new config");
  }
 catch (  KeeperException.ConnectionLossException e) {
  }
catch (  Exception e) {
    Assert.fail("Should have been ConnectionLossException!");
  }
  Assert.assertEquals(QuorumStats.Provider.LOOKING_STATE,qu.getPeer(1).peer.getServerState());
  Assert.assertEquals(QuorumStats.Provider.LOOKING_STATE,qu.getPeer(3).peer.getServerState());
  ReconfigTest.closeAllHandles(zkArr);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.ReconfigLegacyTest </h4><pre class="type-9 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test case for https://issues.apache.org/jira/browse/ZOOKEEPER-2244
 * @throws Exception
 */
@Test(timeout=120000) public void testRestartZooKeeperServer() throws Exception {
  final int clientPorts[]=new int[SERVER_COUNT];
  StringBuilder sb=new StringBuilder();
  String server;
  for (int i=0; i < SERVER_COUNT; i++) {
    clientPorts[i]=PortAssignment.unique();
    server="server." + i + "=127.0.0.1:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ":participant;127.0.0.1:"+ clientPorts[i];
    sb.append(server + "\n");
  }
  String currentQuorumCfgSection=sb.toString();
  MainThread mt[]=new MainThread[SERVER_COUNT];
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i]=new MainThread(i,clientPorts[i],currentQuorumCfgSection,false);
    mt[i].start();
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[i],CONNECTION_TIMEOUT));
  }
  CountdownWatcher watch1=new CountdownWatcher();
  ZooKeeper zk=new ZooKeeper("127.0.0.1:" + clientPorts[0],ClientBase.CONNECTION_TIMEOUT,watch1);
  watch1.waitForConnected(ClientBase.CONNECTION_TIMEOUT);
  String zNodePath="/serverRestartTest";
  String data="originalData";
  zk.create(zNodePath,data.getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.close();
  mt[0].shutdown();
  mt[1].shutdown();
  mt[0].start();
  mt[1].start();
  for (int i=0; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[i],CONNECTION_TIMEOUT));
  }
  CountdownWatcher watch2=new CountdownWatcher();
  zk=new ZooKeeper("127.0.0.1:" + clientPorts[0],ClientBase.CONNECTION_TIMEOUT,watch2);
  watch2.waitForConnected(ClientBase.CONNECTION_TIMEOUT);
  byte[] dataBytes=zk.getData(zNodePath,null,null);
  String receivedData=new String(dataBytes);
  assertEquals(data,receivedData);
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i].shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.RemotePeerBeanTest </h4><pre class="type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test case for https://issues.apache.org/jira/browse/ZOOKEEPER-2269
 */
@Test public void testGetClientAddressShouldReturnEmptyStringWhenClientAddressIsNull(){
  InetSocketAddress peerCommunicationAddress=null;
  QuorumServer peer=new QuorumServer(1,peerCommunicationAddress);
  RemotePeerBean remotePeerBean=new RemotePeerBean(peer);
  String clientAddress=remotePeerBean.getClientAddress();
  assertNotNull(clientAddress);
  assertEquals(0,clientAddress.length());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.WatchLeakTest </h4><pre class="type-10 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Check that if session has expired then no watch can be set
 */
@Test public void testWatchesLeak() throws Exception {
  NIOServerCnxnFactory serverCnxnFactory=mock(NIOServerCnxnFactory.class);
  final SelectionKey sk=new FakeSK();
  MockSelectorThread selectorThread=mock(MockSelectorThread.class);
  when(selectorThread.addInterestOpsUpdateRequest(any(SelectionKey.class))).thenAnswer(new Answer<Boolean>(){
    @Override public Boolean answer(    InvocationOnMock invocation) throws Throwable {
      SelectionKey sk=(SelectionKey)invocation.getArguments()[0];
      NIOServerCnxn nioSrvCnx=(NIOServerCnxn)sk.attachment();
      sk.interestOps(nioSrvCnx.getInterestOps());
      return true;
    }
  }
);
  ZKDatabase database=new ZKDatabase(null);
  database.setlastProcessedZxid(2L);
  QuorumPeer quorumPeer=mock(QuorumPeer.class);
  FileTxnSnapLog logfactory=mock(FileTxnSnapLog.class);
  when(logfactory.getDataDir()).thenReturn(new File(""));
  when(logfactory.getSnapDir()).thenReturn(new File(""));
  FollowerZooKeeperServer fzks=null;
  try {
    fzks=new FollowerZooKeeperServer(logfactory,quorumPeer,database);
    fzks.startup();
    fzks.setServerCnxnFactory(serverCnxnFactory);
    quorumPeer.follower=new MyFollower(quorumPeer,fzks);
    LOG.info("Follower created");
    final SocketChannel socketChannel=createClientSocketChannel();
    final MockNIOServerCnxn nioCnxn=new MockNIOServerCnxn(fzks,socketChannel,sk,serverCnxnFactory,selectorThread);
    sk.attach(nioCnxn);
    nioCnxn.doIO(sk);
    LOG.info("Client connection sent");
    QuorumPacket qp=createValidateSessionPacketResponse(!sessionTimedout);
    quorumPeer.follower.processPacket(qp);
    LOG.info("Session validation sent");
    nioCnxn.doIO(sk);
    Thread.sleep(1000L);
    LOG.info("Watches processed");
    int watchCount=database.getDataTree().getWatchCount();
    if (sessionTimedout) {
      LOG.info("session is not valid, watches = {}",watchCount);
      assertEquals("Session is not valid so there should be no watches",0,watchCount);
    }
 else {
      LOG.info("session is valid, watches = {}",watchCount);
      assertEquals("Session is valid so the watch should be there",1,watchCount);
    }
  }
  finally {
    if (fzks != null) {
      fzks.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.Zab1_0Test </h4><pre class="type-5 type-3 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * In this test, the leader sets the last accepted epoch to 5. The call
 * to getEpochToPropose should set epoch to 6 and wait until another 
 * follower executes it. If in getEpochToPropose we don't check if
 * lastAcceptedEpoch == epoch, then the call from the subsequent
 * follower with lastAcceptedEpoch = 6 doesn't change the value
 * of epoch, and the test fails. It passes with the fix to predicate.{@link https://issues.apache.org/jira/browse/ZOOKEEPER-1343}
 * @throws Exception
 */
@Test public void testLastAcceptedEpoch() throws Exception {
  File tmpDir=File.createTempFile("test","dir",testData);
  tmpDir.delete();
  tmpDir.mkdir();
  Leader leader=null;
  LeadThread leadThread=null;
  try {
    QuorumPeer peer=createQuorumPeer(tmpDir);
    leader=createMockLeader(tmpDir,peer);
    peer.leader=leader;
    peer.setAcceptedEpoch(5);
    leadThread=new LeadThread(leader);
    leadThread.start();
    while (((MockLeader)leader).getCurrentEpochToPropose() != 6) {
      Thread.sleep(20);
    }
    try {
      long epoch=leader.getEpochToPropose(1,6);
      Assert.assertEquals("New proposed epoch is wrong",7,epoch);
    }
 catch (    Exception e) {
      Assert.fail("Timed out in getEpochToPropose");
    }
  }
  finally {
    if (leader != null) {
      leader.shutdown("end of test");
    }
    if (leadThread != null) {
      leadThread.interrupt();
      leadThread.join();
    }
    TestUtils.deleteFileRecursively(tmpDir);
  }
}

</code></pre>

<br>
<pre class="type-3 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTxnTimeout() throws Exception {
  testLeaderConversation(new LeaderConversation(){
    public void converseWithLeader(    InputArchive ia,    OutputArchive oa,    Leader l) throws IOException, InterruptedException, org.apache.zookeeper.server.quorum.Leader.XidRolloverException {
      Assert.assertEquals(0,l.self.getAcceptedEpoch());
      Assert.assertEquals(0,l.self.getCurrentEpoch());
      LearnerInfo li=new LearnerInfo(1,0x10000,0);
      byte liBytes[]=new byte[20];
      ByteBufferOutputStream.record2ByteBuffer(li,ByteBuffer.wrap(liBytes));
      QuorumPacket qp=new QuorumPacket(Leader.FOLLOWERINFO,0,liBytes,null);
      oa.writeRecord(qp,null);
      readPacketSkippingPing(ia,qp);
      Assert.assertEquals(Leader.LEADERINFO,qp.getType());
      Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
      Assert.assertEquals(ByteBuffer.wrap(qp.getData()).getInt(),0x10000);
      Assert.assertEquals(1,l.self.getAcceptedEpoch());
      Assert.assertEquals(0,l.self.getCurrentEpoch());
      qp=new QuorumPacket(Leader.ACKEPOCH,0,new byte[4],null);
      oa.writeRecord(qp,null);
      readPacketSkippingPing(ia,qp);
      Assert.assertEquals(Leader.DIFF,qp.getType());
      readPacketSkippingPing(ia,qp);
      Assert.assertEquals(Leader.NEWLEADER,qp.getType());
      Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
      Assert.assertEquals(1,l.self.getAcceptedEpoch());
      Assert.assertEquals(1,l.self.getCurrentEpoch());
      qp=new QuorumPacket(Leader.ACK,qp.getZxid(),null,null);
      oa.writeRecord(qp,null);
      readPacketSkippingPing(ia,qp);
      Assert.assertEquals(Leader.UPTODATE,qp.getType());
      long zxid=l.zk.getZxid();
      l.propose(new Request(1,1,ZooDefs.OpCode.create,new TxnHeader(1,1,zxid,1,ZooDefs.OpCode.create),new CreateTxn("/test","hola".getBytes(),null,true,0),zxid));
      readPacketSkippingPing(ia,qp);
      Assert.assertEquals(Leader.PROPOSAL,qp.getType());
      LOG.info("Proposal sent.");
      for (int i=0; i < (2 * SYNC_LIMIT) + 2; i++) {
        try {
          ia.readRecord(qp,null);
          LOG.info("Ping received: " + i);
          qp=new QuorumPacket(Leader.PING,qp.getZxid(),"".getBytes(),null);
          oa.writeRecord(qp,null);
        }
 catch (        EOFException e) {
          return;
        }
      }
      Assert.fail("Connection hasn't been closed by leader after transaction times out.");
    }
  }
);
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testLeaderBehind() throws Exception {
  testLeaderConversation(new LeaderConversation(){
    public void converseWithLeader(    InputArchive ia,    OutputArchive oa,    Leader l) throws IOException {
      LearnerInfo li=new LearnerInfo(1,0x10000,0);
      byte liBytes[]=new byte[20];
      ByteBufferOutputStream.record2ByteBuffer(li,ByteBuffer.wrap(liBytes));
      QuorumPacket qp=new QuorumPacket(Leader.FOLLOWERINFO,ZxidUtils.makeZxid(20,0),liBytes,null);
      oa.writeRecord(qp,null);
      readPacketSkippingPing(ia,qp);
      Assert.assertEquals(Leader.LEADERINFO,qp.getType());
      Assert.assertEquals(ZxidUtils.makeZxid(21,0),qp.getZxid());
      Assert.assertEquals(ByteBuffer.wrap(qp.getData()).getInt(),0x10000);
      qp=new QuorumPacket(Leader.ACKEPOCH,0,new byte[4],null);
      oa.writeRecord(qp,null);
      readPacketSkippingPing(ia,qp);
      Assert.assertEquals(Leader.DIFF,qp.getType());
      readPacketSkippingPing(ia,qp);
      Assert.assertEquals(Leader.NEWLEADER,qp.getType());
      Assert.assertEquals(ZxidUtils.makeZxid(21,0),qp.getZxid());
      qp=new QuorumPacket(Leader.ACK,qp.getZxid(),null,null);
      oa.writeRecord(qp,null);
      readPacketSkippingPing(ia,qp);
      Assert.assertEquals(Leader.UPTODATE,qp.getType());
    }
  }
);
}

</code></pre>

<br>
<pre class="type-5 type-6 type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testNormalFollowerRun() throws Exception {
  testFollowerConversation(new FollowerConversation(){
    @Override public void converseWithFollower(    InputArchive ia,    OutputArchive oa,    Follower f) throws Exception {
      File tmpDir=File.createTempFile("test","dir",testData);
      tmpDir.delete();
      tmpDir.mkdir();
      File logDir=f.fzk.getTxnLogFactory().getDataDir().getParentFile();
      File snapDir=f.fzk.getTxnLogFactory().getSnapDir().getParentFile();
      try {
        Assert.assertEquals(0,f.self.getAcceptedEpoch());
        Assert.assertEquals(0,f.self.getCurrentEpoch());
        ZKDatabase zkDb=new ZKDatabase(new FileTxnSnapLog(tmpDir,tmpDir));
        final long firstZxid=ZxidUtils.makeZxid(1,1);
        zkDb.processTxn(new TxnHeader(13,1313,firstZxid,33,ZooDefs.OpCode.create),new CreateTxn("/foo","data1".getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,false,1));
        Stat stat=new Stat();
        Assert.assertEquals("data1",new String(zkDb.getData("/foo",stat,null)));
        QuorumPacket qp=new QuorumPacket();
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.FOLLOWERINFO,qp.getType());
        Assert.assertEquals(qp.getZxid(),0);
        LearnerInfo learnInfo=new LearnerInfo();
        ByteBufferInputStream.byteBuffer2Record(ByteBuffer.wrap(qp.getData()),learnInfo);
        Assert.assertEquals(learnInfo.getProtocolVersion(),0x10000);
        Assert.assertEquals(learnInfo.getServerid(),0);
        qp.setType(Leader.LEADERINFO);
        qp.setZxid(ZxidUtils.makeZxid(1,0));
        byte protoBytes[]=new byte[4];
        ByteBuffer.wrap(protoBytes).putInt(0x10000);
        qp.setData(protoBytes);
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACKEPOCH,qp.getType());
        Assert.assertEquals(0,qp.getZxid());
        Assert.assertEquals(ZxidUtils.makeZxid(0,0),ByteBuffer.wrap(qp.getData()).getInt());
        Assert.assertEquals(1,f.self.getAcceptedEpoch());
        Assert.assertEquals(0,f.self.getCurrentEpoch());
        qp.setType(Leader.SNAP);
        qp.setData(new byte[0]);
        qp.setZxid(zkDb.getDataTreeLastProcessedZxid());
        oa.writeRecord(qp,null);
        zkDb.serializeSnapshot(oa);
        oa.writeString("BenWasHere",null);
        qp.setType(Leader.NEWLEADER);
        qp.setZxid(ZxidUtils.makeZxid(1,0));
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACK,qp.getType());
        Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
        Assert.assertEquals(1,f.self.getAcceptedEpoch());
        Assert.assertEquals(1,f.self.getCurrentEpoch());
        Assert.assertEquals(firstZxid,f.fzk.getLastProcessedZxid());
        ZKDatabase zkDb2=new ZKDatabase(new FileTxnSnapLog(logDir,snapDir));
        long lastZxid=zkDb2.loadDataBase();
        Assert.assertEquals("data1",new String(zkDb2.getData("/foo",stat,null)));
        Assert.assertEquals(firstZxid,lastZxid);
        long proposalZxid=ZxidUtils.makeZxid(1,1000);
        proposeSetData(qp,proposalZxid,"data2",2);
        oa.writeRecord(qp,null);
        TrackerWatcher watcher=new TrackerWatcher();
        Assert.assertEquals("data1",new String(f.fzk.getZKDatabase().getData("/foo",stat,watcher)));
        qp.setType(Leader.COMMIT);
        qp.setZxid(proposalZxid);
        oa.writeRecord(qp,null);
        qp.setType(Leader.UPTODATE);
        qp.setZxid(0);
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACK,qp.getType());
        Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACK,qp.getType());
        Assert.assertEquals(proposalZxid,qp.getZxid());
        watcher.waitForChange();
        Assert.assertEquals("data2",new String(f.fzk.getZKDatabase().getData("/foo",stat,null)));
        zkDb2=new ZKDatabase(new FileTxnSnapLog(logDir,snapDir));
        lastZxid=zkDb2.loadDataBase();
        Assert.assertEquals("data2",new String(zkDb2.getData("/foo",stat,null)));
        Assert.assertEquals(proposalZxid,lastZxid);
      }
  finally {
        TestUtils.deleteFileRecursively(tmpDir);
      }
    }
    private void proposeSetData(    QuorumPacket qp,    long zxid,    String data,    int version) throws IOException {
      qp.setType(Leader.PROPOSAL);
      qp.setZxid(zxid);
      TxnHeader hdr=new TxnHeader(4,1414,qp.getZxid(),55,ZooDefs.OpCode.setData);
      SetDataTxn sdt=new SetDataTxn("/foo",data.getBytes(),version);
      ByteArrayOutputStream baos=new ByteArrayOutputStream();
      OutputArchive boa=BinaryOutputArchive.getArchive(baos);
      boa.writeRecord(hdr,null);
      boa.writeRecord(sdt,null);
      qp.setData(baos.toByteArray());
    }
  }
);
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testNormalRun() throws Exception {
  testLeaderConversation(new LeaderConversation(){
    public void converseWithLeader(    InputArchive ia,    OutputArchive oa,    Leader l) throws IOException {
      Assert.assertEquals(0,l.self.getAcceptedEpoch());
      Assert.assertEquals(0,l.self.getCurrentEpoch());
      LearnerInfo li=new LearnerInfo(1,0x10000,0);
      byte liBytes[]=new byte[20];
      ByteBufferOutputStream.record2ByteBuffer(li,ByteBuffer.wrap(liBytes));
      QuorumPacket qp=new QuorumPacket(Leader.FOLLOWERINFO,0,liBytes,null);
      oa.writeRecord(qp,null);
      readPacketSkippingPing(ia,qp);
      Assert.assertEquals(Leader.LEADERINFO,qp.getType());
      Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
      Assert.assertEquals(ByteBuffer.wrap(qp.getData()).getInt(),0x10000);
      Assert.assertEquals(1,l.self.getAcceptedEpoch());
      Assert.assertEquals(0,l.self.getCurrentEpoch());
      qp=new QuorumPacket(Leader.ACKEPOCH,0,new byte[4],null);
      oa.writeRecord(qp,null);
      readPacketSkippingPing(ia,qp);
      Assert.assertEquals(Leader.DIFF,qp.getType());
      readPacketSkippingPing(ia,qp);
      Assert.assertEquals(Leader.NEWLEADER,qp.getType());
      Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
      Assert.assertEquals(1,l.self.getAcceptedEpoch());
      Assert.assertEquals(1,l.self.getCurrentEpoch());
      qp=new QuorumPacket(Leader.ACK,qp.getZxid(),null,null);
      oa.writeRecord(qp,null);
      readPacketSkippingPing(ia,qp);
      Assert.assertEquals(Leader.UPTODATE,qp.getType());
    }
  }
);
}

</code></pre>

<br>
<pre class="type-5 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testInitialAcceptedCurrent() throws Exception {
  File tmpDir=File.createTempFile("test",".dir",testData);
  tmpDir.delete();
  tmpDir.mkdir();
  try {
    FileTxnSnapLog logFactory=new FileTxnSnapLog(tmpDir,tmpDir);
    File version2=new File(tmpDir,"version-2");
    version2.mkdir();
    long zxid=ZxidUtils.makeZxid(3,3);
    logFactory.append(new Request(1,1,ZooDefs.OpCode.error,new TxnHeader(1,1,zxid,1,ZooDefs.OpCode.error),new ErrorTxn(1),zxid));
    logFactory.commit();
    ZKDatabase zkDb=new ZKDatabase(logFactory);
    QuorumPeer peer=new QuorumPeer();
    peer.setZKDatabase(zkDb);
    peer.setTxnFactory(logFactory);
    peer.getLastLoggedZxid();
    Assert.assertEquals(3,peer.getAcceptedEpoch());
    Assert.assertEquals(3,peer.getCurrentEpoch());
    Assert.assertEquals(3,Integer.parseInt(readContentsOfFile(new File(version2,QuorumPeer.CURRENT_EPOCH_FILENAME))));
    Assert.assertEquals(3,Integer.parseInt(readContentsOfFile(new File(version2,QuorumPeer.ACCEPTED_EPOCH_FILENAME))));
  }
  finally {
    TestUtils.deleteFileRecursively(tmpDir);
  }
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Tests that when a quorum of followers send LearnerInfo but do not ack the epoch (which is sent
 * by the leader upon receipt of LearnerInfo from a quorum), the leader does not start using this epoch
 * as it would in the normal case (when a quorum do ack the epoch). This tests ZK-1192
 * @throws Exception
 */
@Test public void testAbandonBeforeACKEpoch() throws Exception {
  testLeaderConversation(new LeaderConversation(){
    public void converseWithLeader(    InputArchive ia,    OutputArchive oa,    Leader l) throws IOException, InterruptedException {
      LearnerInfo li=new LearnerInfo(1,0x10000,0);
      byte liBytes[]=new byte[20];
      ByteBufferOutputStream.record2ByteBuffer(li,ByteBuffer.wrap(liBytes));
      QuorumPacket qp=new QuorumPacket(Leader.FOLLOWERINFO,0,liBytes,null);
      oa.writeRecord(qp,null);
      readPacketSkippingPing(ia,qp);
      Assert.assertEquals(Leader.LEADERINFO,qp.getType());
      Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
      Assert.assertEquals(ByteBuffer.wrap(qp.getData()).getInt(),0x10000);
      Thread.sleep(l.self.getInitLimit() * l.self.getTickTime() + 5000);
      Assert.assertEquals(0,l.self.getCurrentEpoch());
    }
  }
);
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testLeaderInElectingFollowers() throws Exception {
  File tmpDir=File.createTempFile("test","dir",testData);
  tmpDir.delete();
  tmpDir.mkdir();
  Leader leader=null;
  try {
    QuorumPeer peer=createQuorumPeer(tmpDir);
    leader=createLeader(tmpDir,peer);
    peer.leader=leader;
    FollowerMockThread f1=new FollowerMockThread(1,leader,false);
    FollowerMockThread f2=new FollowerMockThread(2,leader,false);
    leader.leaderStateSummary=new StateSummary(leader.self.getCurrentEpoch(),leader.zk.getLastProcessedZxid());
    f1.start();
    f2.start();
    f1.join(leader.self.getInitLimit() * leader.self.getTickTime() + 5000);
    f2.join(leader.self.getInitLimit() * leader.self.getTickTime() + 5000);
    Assert.assertTrue(f1.msg + " without waiting for leader",f1.msg == null);
    Assert.assertTrue(f2.msg + " without waiting for leader",f2.msg == null);
  }
  finally {
    if (leader != null) {
      leader.shutdown("end of test");
    }
    TestUtils.deleteFileRecursively(tmpDir);
  }
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUnnecessarySnap() throws Exception {
  testPopulatedLeaderConversation(new PopulatedLeaderConversation(){
    @Override public void converseWithLeader(    InputArchive ia,    OutputArchive oa,    Leader l,    long zxid) throws Exception {
      Assert.assertEquals(1,l.self.getAcceptedEpoch());
      Assert.assertEquals(1,l.self.getCurrentEpoch());
      LearnerInfo li=new LearnerInfo(1,0x10000,0);
      byte liBytes[]=new byte[20];
      ByteBufferOutputStream.record2ByteBuffer(li,ByteBuffer.wrap(liBytes));
      QuorumPacket qp=new QuorumPacket(Leader.FOLLOWERINFO,1,liBytes,null);
      oa.writeRecord(qp,null);
      readPacketSkippingPing(ia,qp);
      Assert.assertEquals(Leader.LEADERINFO,qp.getType());
      Assert.assertEquals(ZxidUtils.makeZxid(2,0),qp.getZxid());
      Assert.assertEquals(ByteBuffer.wrap(qp.getData()).getInt(),0x10000);
      Assert.assertEquals(2,l.self.getAcceptedEpoch());
      Assert.assertEquals(1,l.self.getCurrentEpoch());
      byte epochBytes[]=new byte[4];
      final ByteBuffer wrappedEpochBytes=ByteBuffer.wrap(epochBytes);
      wrappedEpochBytes.putInt(1);
      qp=new QuorumPacket(Leader.ACKEPOCH,zxid,epochBytes,null);
      oa.writeRecord(qp,null);
      readPacketSkippingPing(ia,qp);
      Assert.assertEquals(Leader.DIFF,qp.getType());
    }
  }
,2);
}

</code></pre>

<br>
<pre class="type-5 type-3 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLeaderInConnectingFollowers() throws Exception {
  File tmpDir=File.createTempFile("test","dir",testData);
  tmpDir.delete();
  tmpDir.mkdir();
  Leader leader=null;
  try {
    QuorumPeer peer=createQuorumPeer(tmpDir);
    leader=createLeader(tmpDir,peer);
    peer.leader=leader;
    peer.setAcceptedEpoch(5);
    FollowerMockThread f1=new FollowerMockThread(1,leader,true);
    FollowerMockThread f2=new FollowerMockThread(2,leader,true);
    f1.start();
    f2.start();
    f1.join(leader.self.getInitLimit() * leader.self.getTickTime() + 5000);
    f2.join(leader.self.getInitLimit() * leader.self.getTickTime() + 5000);
    try {
      long epoch=leader.getEpochToPropose(leader.self.getId(),leader.self.getAcceptedEpoch());
      Assert.assertEquals("leader got wrong epoch from getEpochToPropose",6,epoch);
    }
 catch (    Exception e) {
      Assert.fail("leader timed out in getEpochToPropose");
    }
  }
  finally {
    if (leader != null) {
      leader.shutdown("end of test");
    }
    TestUtils.deleteFileRecursively(tmpDir);
  }
}

</code></pre>

<br>
<pre class="type-5 type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNormalFollowerRunWithDiff() throws Exception {
  testFollowerConversation(new FollowerConversation(){
    @Override public void converseWithFollower(    InputArchive ia,    OutputArchive oa,    Follower f) throws Exception {
      File tmpDir=File.createTempFile("test","dir",testData);
      tmpDir.delete();
      tmpDir.mkdir();
      File logDir=f.fzk.getTxnLogFactory().getDataDir().getParentFile();
      File snapDir=f.fzk.getTxnLogFactory().getSnapDir().getParentFile();
      try {
        Assert.assertEquals(0,f.self.getAcceptedEpoch());
        Assert.assertEquals(0,f.self.getCurrentEpoch());
        ZKDatabase zkDb=new ZKDatabase(new FileTxnSnapLog(tmpDir,tmpDir));
        final long firstZxid=ZxidUtils.makeZxid(1,1);
        zkDb.processTxn(new TxnHeader(13,1313,firstZxid,33,ZooDefs.OpCode.create),new CreateTxn("/foo","data1".getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,false,1));
        Stat stat=new Stat();
        Assert.assertEquals("data1",new String(zkDb.getData("/foo",stat,null)));
        QuorumPacket qp=new QuorumPacket();
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.FOLLOWERINFO,qp.getType());
        Assert.assertEquals(qp.getZxid(),0);
        LearnerInfo learnInfo=new LearnerInfo();
        ByteBufferInputStream.byteBuffer2Record(ByteBuffer.wrap(qp.getData()),learnInfo);
        Assert.assertEquals(learnInfo.getProtocolVersion(),0x10000);
        Assert.assertEquals(learnInfo.getServerid(),0);
        qp.setType(Leader.LEADERINFO);
        qp.setZxid(ZxidUtils.makeZxid(1,0));
        byte protoBytes[]=new byte[4];
        ByteBuffer.wrap(protoBytes).putInt(0x10000);
        qp.setData(protoBytes);
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACKEPOCH,qp.getType());
        Assert.assertEquals(0,qp.getZxid());
        Assert.assertEquals(ZxidUtils.makeZxid(0,0),ByteBuffer.wrap(qp.getData()).getInt());
        Assert.assertEquals(1,f.self.getAcceptedEpoch());
        Assert.assertEquals(0,f.self.getCurrentEpoch());
        qp.setType(Leader.DIFF);
        qp.setData(new byte[0]);
        qp.setZxid(zkDb.getDataTreeLastProcessedZxid());
        oa.writeRecord(qp,null);
        final long createSessionZxid=ZxidUtils.makeZxid(1,2);
        proposeNewSession(qp,createSessionZxid,0x333);
        oa.writeRecord(qp,null);
        qp.setType(Leader.COMMIT);
        qp.setZxid(createSessionZxid);
        oa.writeRecord(qp,null);
        qp.setType(Leader.NEWLEADER);
        qp.setZxid(ZxidUtils.makeZxid(1,0));
        qp.setData(null);
        oa.writeRecord(qp,null);
        qp.setType(Leader.UPTODATE);
        qp.setZxid(0);
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACK,qp.getType());
        Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACK,qp.getType());
        Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
        Assert.assertEquals(1,f.self.getAcceptedEpoch());
        Assert.assertEquals(1,f.self.getCurrentEpoch());
        Assert.assertEquals(createSessionZxid,f.fzk.getLastProcessedZxid());
        ZKDatabase zkDb2=new ZKDatabase(new FileTxnSnapLog(logDir,snapDir));
        zkDb2.loadDataBase();
        LOG.info("zkdb2 sessions:" + zkDb2.getSessions());
        Assert.assertNotNull(zkDb2.getSessionWithTimeOuts().get(4L));
      }
  finally {
        TestUtils.deleteFileRecursively(tmpDir);
      }
    }
    private void proposeNewSession(    QuorumPacket qp,    long zxid,    long sessionId) throws IOException {
      qp.setType(Leader.PROPOSAL);
      qp.setZxid(zxid);
      TxnHeader hdr=new TxnHeader(4,1414,qp.getZxid(),55,ZooDefs.OpCode.createSession);
      CreateSessionTxn cst=new CreateSessionTxn(30000);
      ByteArrayOutputStream baos=new ByteArrayOutputStream();
      OutputArchive boa=BinaryOutputArchive.getArchive(baos);
      boa.writeRecord(hdr,null);
      boa.writeRecord(cst,null);
      qp.setData(baos.toByteArray());
    }
  }
);
}

</code></pre>

<br>
<pre class="type-5 type-6 type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testNormalObserverRun() throws Exception {
  testObserverConversation(new ObserverConversation(){
    @Override public void converseWithObserver(    InputArchive ia,    OutputArchive oa,    Observer o) throws Exception {
      File tmpDir=File.createTempFile("test","dir",testData);
      tmpDir.delete();
      tmpDir.mkdir();
      File logDir=o.zk.getTxnLogFactory().getDataDir().getParentFile();
      File snapDir=o.zk.getTxnLogFactory().getSnapDir().getParentFile();
      try {
        Assert.assertEquals(0,o.self.getAcceptedEpoch());
        Assert.assertEquals(0,o.self.getCurrentEpoch());
        ZKDatabase zkDb=new ZKDatabase(new FileTxnSnapLog(tmpDir,tmpDir));
        final long foo1Zxid=ZxidUtils.makeZxid(1,1);
        final long foo2Zxid=ZxidUtils.makeZxid(1,2);
        zkDb.processTxn(new TxnHeader(13,1313,foo1Zxid,33,ZooDefs.OpCode.create),new CreateTxn("/foo1","data1".getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,false,1));
        zkDb.processTxn(new TxnHeader(13,1313,foo2Zxid,33,ZooDefs.OpCode.create),new CreateTxn("/foo2","data1".getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,false,1));
        Stat stat=new Stat();
        Assert.assertEquals("data1",new String(zkDb.getData("/foo1",stat,null)));
        Assert.assertEquals("data1",new String(zkDb.getData("/foo2",stat,null)));
        QuorumPacket qp=new QuorumPacket();
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.OBSERVERINFO,qp.getType());
        Assert.assertEquals(qp.getZxid(),0);
        LearnerInfo learnInfo=new LearnerInfo();
        ByteBufferInputStream.byteBuffer2Record(ByteBuffer.wrap(qp.getData()),learnInfo);
        Assert.assertEquals(learnInfo.getProtocolVersion(),0x10000);
        Assert.assertEquals(learnInfo.getServerid(),0);
        qp.setType(Leader.LEADERINFO);
        qp.setZxid(ZxidUtils.makeZxid(1,0));
        byte protoBytes[]=new byte[4];
        ByteBuffer.wrap(protoBytes).putInt(0x10000);
        qp.setData(protoBytes);
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACKEPOCH,qp.getType());
        Assert.assertEquals(0,qp.getZxid());
        Assert.assertEquals(ZxidUtils.makeZxid(0,0),ByteBuffer.wrap(qp.getData()).getInt());
        Assert.assertEquals(1,o.self.getAcceptedEpoch());
        Assert.assertEquals(0,o.self.getCurrentEpoch());
        qp.setType(Leader.SNAP);
        qp.setData(new byte[0]);
        qp.setZxid(zkDb.getDataTreeLastProcessedZxid());
        oa.writeRecord(qp,null);
        zkDb.serializeSnapshot(oa);
        oa.writeString("BenWasHere",null);
        qp.setType(Leader.NEWLEADER);
        qp.setZxid(ZxidUtils.makeZxid(1,0));
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACK,qp.getType());
        Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
        Assert.assertEquals(1,o.self.getAcceptedEpoch());
        Assert.assertEquals(1,o.self.getCurrentEpoch());
        Assert.assertEquals(foo2Zxid,o.zk.getLastProcessedZxid());
        ZKDatabase zkDb2=new ZKDatabase(new FileTxnSnapLog(logDir,snapDir));
        long lastZxid=zkDb2.loadDataBase();
        Assert.assertEquals("data1",new String(zkDb2.getData("/foo1",stat,null)));
        Assert.assertEquals(foo2Zxid,lastZxid);
        TrackerWatcher watcher=new TrackerWatcher();
        Assert.assertEquals("data1",new String(o.zk.getZKDatabase().getData("/foo2",stat,watcher)));
        long proposalZxid=ZxidUtils.makeZxid(1,1000);
        proposeSetData(qp,"/foo1",proposalZxid,"data2",2);
        oa.writeRecord(qp,null);
        qp.setType(Leader.COMMIT);
        qp.setZxid(proposalZxid);
        oa.writeRecord(qp,null);
        long informZxid=ZxidUtils.makeZxid(1,1001);
        proposeSetData(qp,"/foo2",informZxid,"data2",2);
        qp.setType(Leader.INFORM);
        oa.writeRecord(qp,null);
        qp.setType(Leader.UPTODATE);
        qp.setZxid(0);
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACK,qp.getType());
        Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
        watcher.waitForChange();
        Assert.assertEquals("data2",new String(o.zk.getZKDatabase().getData("/foo1",stat,null)));
        Assert.assertEquals("data2",new String(o.zk.getZKDatabase().getData("/foo2",stat,null)));
        o.zk.shutdown();
        zkDb2=new ZKDatabase(new FileTxnSnapLog(logDir,snapDir));
        lastZxid=zkDb2.loadDataBase();
        Assert.assertEquals("data2",new String(zkDb2.getData("/foo1",stat,null)));
        Assert.assertEquals("data2",new String(zkDb2.getData("/foo2",stat,null)));
        Assert.assertEquals(informZxid,lastZxid);
      }
  finally {
        TestUtils.deleteFileRecursively(tmpDir);
      }
    }
    private void proposeSetData(    QuorumPacket qp,    String path,    long zxid,    String data,    int version) throws IOException {
      qp.setType(Leader.PROPOSAL);
      qp.setZxid(zxid);
      TxnHeader hdr=new TxnHeader(4,1414,qp.getZxid(),55,ZooDefs.OpCode.setData);
      SetDataTxn sdt=new SetDataTxn(path,data.getBytes(),version);
      ByteArrayOutputStream baos=new ByteArrayOutputStream();
      OutputArchive boa=BinaryOutputArchive.getArchive(baos);
      boa.writeRecord(hdr,null);
      boa.writeRecord(sdt,null);
      qp.setData(baos.toByteArray());
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ACLCountTest </h4><pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Create a node and add 4 ACL values to it, but there are only 2 unique ACL values,
 * and each is repeated once:
 * ACL(ZooDefs.Perms.READ,ZooDefs.Ids.ANYONE_ID_UNSAFE);
 * ACL(ZooDefs.Perms.ALL,ZooDefs.Ids.AUTH_IDS);
 * ACL(ZooDefs.Perms.READ,ZooDefs.Ids.ANYONE_ID_UNSAFE);
 * ACL(ZooDefs.Perms.ALL,ZooDefs.Ids.AUTH_IDS);
 * Even though we've added 4 ACL values, there should only be 2 ACLs for that node,
 * since there are only 2 *unique* ACL values.
 */
@Test public void testAclCount() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(1000);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  ZooKeeper zk;
  final ArrayList<ACL> CREATOR_ALL_AND_WORLD_READABLE=new ArrayList<ACL>(){
{
      add(new ACL(ZooDefs.Perms.READ,ZooDefs.Ids.ANYONE_ID_UNSAFE));
      add(new ACL(ZooDefs.Perms.ALL,ZooDefs.Ids.AUTH_IDS));
      add(new ACL(ZooDefs.Perms.READ,ZooDefs.Ids.ANYONE_ID_UNSAFE));
      add(new ACL(ZooDefs.Perms.ALL,ZooDefs.Ids.AUTH_IDS));
    }
  }
;
  try {
    LOG.info("starting up the zookeeper server .. waiting");
    Assert.assertTrue("waiting for server being up",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
    zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
    zk.addAuthInfo("digest","pat:test".getBytes());
    zk.setACL("/",Ids.CREATOR_ALL_ACL,-1);
    String path="/path";
    try {
      Assert.assertEquals(4,CREATOR_ALL_AND_WORLD_READABLE.size());
    }
 catch (    Exception e) {
      LOG.error("Something is fundamentally wrong with ArrayList's add() method. add()ing four times to an empty ArrayList should result in an ArrayList with 4 members.");
      throw e;
    }
    zk.create(path,path.getBytes(),CREATOR_ALL_AND_WORLD_READABLE,CreateMode.PERSISTENT);
    List<ACL> acls=zk.getACL("/path",new Stat());
    Assert.assertEquals(2,acls.size());
  }
 catch (  Exception e) {
    Assert.assertTrue(false);
  }
  f.shutdown();
  zks.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ACLTest </h4><pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Verify that acl optimization of storing just
 * a few acls and there references in the data
 * node is actually working.
 */
@Test public void testAcls() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(1000);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  ZooKeeper zk;
  String path;
  try {
    LOG.info("starting up the zookeeper server .. waiting");
    Assert.assertTrue("waiting for server being up",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
    zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
    LOG.info("starting creating acls");
    for (int i=0; i < 100; i++) {
      path="/" + i;
      zk.create(path,path.getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    }
    Assert.assertTrue("size of the acl map ",(1 == zks.getZKDatabase().getAclSize()));
    for (int j=100; j < 200; j++) {
      path="/" + j;
      ACL acl=new ACL();
      acl.setPerms(0);
      Id id=new Id();
      id.setId("1.1.1." + j);
      id.setScheme("ip");
      acl.setId(id);
      ArrayList<ACL> list=new ArrayList<ACL>();
      list.add(acl);
      zk.create(path,path.getBytes(),list,CreateMode.PERSISTENT);
    }
    Assert.assertTrue("size of the acl map ",(101 == zks.getZKDatabase().getAclSize()));
  }
  finally {
    f.shutdown();
    zks.shutdown();
    Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
  }
  startSignal=new CountDownLatch(1);
  zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  try {
    Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
    startSignal.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS);
    Assert.assertTrue("count == 0",startSignal.getCount() == 0);
    Assert.assertTrue("acl map ",(101 == zks.getZKDatabase().getAclSize()));
    for (int j=200; j < 205; j++) {
      path="/" + j;
      ACL acl=new ACL();
      acl.setPerms(0);
      Id id=new Id();
      id.setId("1.1.1." + j);
      id.setScheme("ip");
      acl.setId(id);
      ArrayList<ACL> list=new ArrayList<ACL>();
      list.add(acl);
      zk.create(path,path.getBytes(),list,CreateMode.PERSISTENT);
    }
    Assert.assertTrue("acl map ",(106 == zks.getZKDatabase().getAclSize()));
    zk.close();
  }
  finally {
    f.shutdown();
    zks.shutdown();
    Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown(HOSTPORT,ClientBase.CONNECTION_TIMEOUT));
  }
}

</code></pre>

<br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testIPAuthenticationIsValidCIDR() throws Exception {
  IPAuthenticationProvider prov=new IPAuthenticationProvider();
  Assert.assertTrue("testing no netmask",prov.isValid("127.0.0.1"));
  Assert.assertTrue("testing single ip netmask",prov.isValid("127.0.0.1/32"));
  Assert.assertTrue("testing lowest netmask possible",prov.isValid("127.0.0.1/0"));
  Assert.assertFalse("testing netmask too high",prov.isValid("127.0.0.1/33"));
  Assert.assertFalse("testing netmask too low",prov.isValid("10.0.0.1/-1"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ChrootTest </h4><pre class="type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testChrootSynchronous() throws IOException, InterruptedException, KeeperException {
  ZooKeeper zk1=createClient();
  try {
    zk1.create("/ch1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  }
  finally {
    if (zk1 != null)     zk1.close();
  }
  ZooKeeper zk2=createClient(hostPort + "/ch1");
  try {
    Assert.assertEquals("/ch2",zk2.create("/ch2",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT));
  }
  finally {
    if (zk2 != null)     zk2.close();
  }
  zk1=createClient();
  zk2=createClient(hostPort + "/ch1");
  try {
    MyWatcher w1=new MyWatcher("/ch1");
    Assert.assertNotNull(zk1.exists("/ch1",w1));
    MyWatcher w2=new MyWatcher("/ch1/ch2");
    Assert.assertNotNull(zk1.exists("/ch1/ch2",w2));
    MyWatcher w3=new MyWatcher("/ch2");
    Assert.assertNotNull(zk2.exists("/ch2",w3));
    MyWatcher w4=new MyWatcher("/ch1");
    zk1.getChildren("/ch1",w4);
    MyWatcher w5=new MyWatcher("/");
    zk2.getChildren("/",w5);
    zk1.setData("/ch1","1".getBytes(),-1);
    zk2.setData("/ch2","2".getBytes(),-1);
    Assert.assertTrue(w1.matches());
    Assert.assertTrue(w2.matches());
    Assert.assertTrue(w3.matches());
    try {
      zk2.setData("/ch3","3".getBytes(),-1);
    }
 catch (    KeeperException.NoNodeException e) {
      Assert.assertEquals("/ch3",e.getPath());
    }
    Assert.assertTrue(Arrays.equals("1".getBytes(),zk1.getData("/ch1",false,null)));
    Assert.assertTrue(Arrays.equals("2".getBytes(),zk1.getData("/ch1/ch2",false,null)));
    Assert.assertTrue(Arrays.equals("2".getBytes(),zk2.getData("/ch2",false,null)));
    zk2.delete("/ch2",-1);
    Assert.assertTrue(w4.matches());
    Assert.assertTrue(w5.matches());
    zk1.delete("/ch1",-1);
    Assert.assertNull(zk1.exists("/ch1",false));
    Assert.assertNull(zk1.exists("/ch1/ch2",false));
    Assert.assertNull(zk2.exists("/ch2",false));
  }
  finally {
    if (zk1 != null)     zk1.close();
    if (zk2 != null)     zk2.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ClientRetryTest </h4><pre class="type-6 type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
"></span><br>
@Test public void testClientRetry() throws IOException, InterruptedException, TimeoutException {
  CountdownWatcher cdw1=new CountdownWatcher();
  CountdownWatcher cdw2=new CountdownWatcher();
  ZooKeeper zk=new ZooKeeper(hostPort,10000,cdw1);
  try {
    cdw1.waitForConnected(CONNECTION_TIMEOUT);
    ZooKeeper zk2=new ZooKeeper(hostPort,10000,cdw2);
    try {
      States s1=zk.getState();
      States s2=zk2.getState();
      Assert.assertSame(s1,States.CONNECTED);
      Assert.assertSame(s2,States.CONNECTING);
      cdw1.reset();
      zk.close();
      cdw1.waitForDisconnected(CONNECTION_TIMEOUT);
      cdw2.waitForConnected(CONNECTION_TIMEOUT);
      Assert.assertSame(zk2.getState(),States.CONNECTED);
    }
  finally {
      zk2.close();
    }
  }
  finally {
    zk.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ClientTest </h4><pre class="type-10 type-3 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testACLs() throws Exception {
  ZooKeeper zk=null;
  try {
    zk=createClient();
    try {
      zk.create("/acltest",new byte[0],Ids.CREATOR_ALL_ACL,CreateMode.PERSISTENT);
      Assert.fail("Should have received an invalid acl error");
    }
 catch (    InvalidACLException e) {
      LOG.info("Test successful, invalid acl received : " + e.getMessage());
    }
    try {
      ArrayList<ACL> testACL=new ArrayList<ACL>();
      testACL.add(new ACL(Perms.ALL | Perms.ADMIN,Ids.AUTH_IDS));
      testACL.add(new ACL(Perms.ALL | Perms.ADMIN,new Id("ip","127.0.0.1/8")));
      zk.create("/acltest",new byte[0],testACL,CreateMode.PERSISTENT);
      Assert.fail("Should have received an invalid acl error");
    }
 catch (    InvalidACLException e) {
      LOG.info("Test successful, invalid acl received : " + e.getMessage());
    }
    try {
      ArrayList<ACL> testACL=new ArrayList<ACL>();
      testACL.add(new ACL(Perms.ALL | Perms.ADMIN,new Id()));
      zk.create("/nullidtest",new byte[0],testACL,CreateMode.PERSISTENT);
      Assert.fail("Should have received an invalid acl error");
    }
 catch (    InvalidACLException e) {
      LOG.info("Test successful, invalid acl received : " + e.getMessage());
    }
    zk.addAuthInfo("digest","ben:passwd".getBytes());
    ArrayList<ACL> testACL=new ArrayList<ACL>();
    testACL.add(new ACL(Perms.ALL,new Id("auth","")));
    testACL.add(new ACL(Perms.WRITE,new Id("ip","127.0.0.1")));
    zk.create("/acltest",new byte[0],testACL,CreateMode.PERSISTENT);
    zk.close();
    zk=createClient();
    zk.addAuthInfo("digest","ben:passwd2".getBytes());
    if (skipACL) {
      try {
        zk.getData("/acltest",false,null);
      }
 catch (      KeeperException e) {
        Assert.fail("Badauth reads should succeed with skipACL.");
      }
    }
 else {
      try {
        zk.getData("/acltest",false,null);
        Assert.fail("Should have received a permission error");
      }
 catch (      KeeperException e) {
        Assert.assertEquals(Code.NOAUTH,e.code());
      }
    }
    zk.addAuthInfo("digest","ben:passwd".getBytes());
    zk.getData("/acltest",false,null);
    zk.setACL("/acltest",Ids.OPEN_ACL_UNSAFE,-1);
    zk.close();
    zk=createClient();
    zk.getData("/acltest",false,null);
    List<ACL> acls=zk.getACL("/acltest",new Stat());
    Assert.assertEquals(1,acls.size());
    Assert.assertEquals(Ids.OPEN_ACL_UNSAFE,acls);
    acls=zk.getACL("/acltest",null);
    Assert.assertEquals(1,acls.size());
    Assert.assertEquals(Ids.OPEN_ACL_UNSAFE,acls);
    zk.close();
  }
  finally {
    if (zk != null) {
      zk.close();
    }
  }
}

</code></pre>

<br>
<pre class="type-9 type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Register multiple watchers and verify that they all get notified and
 * in the right order.
 */
@Test public void testMutipleWatcherObjs() throws IOException, InterruptedException, KeeperException {
  ZooKeeper zk=createClient(new CountdownWatcher(),hostPort);
  try {
    MyWatcher watchers[]=new MyWatcher[100];
    MyWatcher watchers2[]=new MyWatcher[watchers.length];
    for (int i=0; i < watchers.length; i++) {
      watchers[i]=new MyWatcher();
      watchers2[i]=new MyWatcher();
      zk.create("/foo-" + i,("foodata" + i).getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    }
    Stat stat=new Stat();
    for (int i=0; i < watchers.length; i++) {
      Assert.assertNotNull(zk.getData("/foo-" + i,watchers[i],stat));
    }
    for (int i=0; i < watchers.length; i++) {
      Assert.assertNotNull(zk.exists("/foo-" + i,watchers[i]));
    }
    for (int i=0; i < watchers.length; i++) {
      zk.setData("/foo-" + i,("foodata2-" + i).getBytes(),-1);
      zk.setData("/foo-" + i,("foodata3-" + i).getBytes(),-1);
    }
    for (int i=0; i < watchers.length; i++) {
      WatchedEvent event=watchers[i].events.poll(10,TimeUnit.SECONDS);
      Assert.assertEquals("/foo-" + i,event.getPath());
      Assert.assertEquals(EventType.NodeDataChanged,event.getType());
      Assert.assertEquals(KeeperState.SyncConnected,event.getState());
      Assert.assertEquals(0,watchers[i].events.size());
    }
    for (int i=0; i < watchers.length; i++) {
      Assert.assertNotNull(zk.getData("/foo-" + i,watchers[i],stat));
      Assert.assertNotNull(zk.exists("/foo-" + i,watchers[i]));
    }
    for (int i=0; i < watchers.length; i++) {
      zk.setData("/foo-" + i,("foodata4-" + i).getBytes(),-1);
      zk.setData("/foo-" + i,("foodata5-" + i).getBytes(),-1);
    }
    for (int i=0; i < watchers.length; i++) {
      WatchedEvent event=watchers[i].events.poll(10,TimeUnit.SECONDS);
      Assert.assertEquals("/foo-" + i,event.getPath());
      Assert.assertEquals(EventType.NodeDataChanged,event.getType());
      Assert.assertEquals(KeeperState.SyncConnected,event.getState());
      Assert.assertEquals(0,watchers[i].events.size());
    }
    for (int i=0; i < watchers.length; i++) {
      Assert.assertNotNull(zk.getData("/foo-" + i,watchers[i],stat));
      Assert.assertNotNull(zk.exists("/foo-" + i,watchers2[i]));
    }
    for (int i=0; i < watchers.length; i++) {
      zk.setData("/foo-" + i,("foodata6-" + i).getBytes(),-1);
      zk.setData("/foo-" + i,("foodata7-" + i).getBytes(),-1);
    }
    for (int i=0; i < watchers.length; i++) {
      WatchedEvent event=watchers[i].events.poll(10,TimeUnit.SECONDS);
      Assert.assertEquals("/foo-" + i,event.getPath());
      Assert.assertEquals(EventType.NodeDataChanged,event.getType());
      Assert.assertEquals(KeeperState.SyncConnected,event.getState());
      Assert.assertEquals(0,watchers[i].events.size());
      WatchedEvent event2=watchers2[i].events.poll(10,TimeUnit.SECONDS);
      Assert.assertEquals("/foo-" + i,event2.getPath());
      Assert.assertEquals(EventType.NodeDataChanged,event2.getType());
      Assert.assertEquals(KeeperState.SyncConnected,event2.getState());
      Assert.assertEquals(0,watchers2[i].events.size());
    }
  }
  finally {
    if (zk != null) {
      zk.close();
    }
  }
}

</code></pre>

<br>
<pre class="type-5 type-6 type-15 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSequentialNodeData() throws Exception {
  ZooKeeper zk=null;
  String queue_handle="/queue";
  try {
    zk=createClient();
    zk.create(queue_handle,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    zk.create(queue_handle + "/element","0".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    zk.create(queue_handle + "/element","1".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    List<String> children=zk.getChildren(queue_handle,true);
    Assert.assertEquals(children.size(),2);
    String child1=children.get(0);
    String child2=children.get(1);
    int compareResult=child1.compareTo(child2);
    Assert.assertNotSame(compareResult,0);
    if (compareResult < 0) {
    }
 else {
      String temp=child1;
      child1=child2;
      child2=temp;
    }
    String child1data=new String(zk.getData(queue_handle + "/" + child1,false,null));
    String child2data=new String(zk.getData(queue_handle + "/" + child2,false,null));
    Assert.assertEquals(child1data,"0");
    Assert.assertEquals(child2data,"1");
  }
  finally {
    if (zk != null) {
      zk.close();
    }
  }
}

</code></pre>

<br>
<pre class="type-10 type-3 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNullAuthId() throws Exception {
  ZooKeeper zk=null;
  try {
    zk=createClient();
    zk.addAuthInfo("digest","ben:passwd".getBytes());
    ArrayList<ACL> testACL=new ArrayList<ACL>();
    testACL.add(new ACL(Perms.ALL,new Id("auth",null)));
    zk.create("/acltest",new byte[0],testACL,CreateMode.PERSISTENT);
    zk.close();
    zk=createClient();
    zk.addAuthInfo("digest","ben:passwd2".getBytes());
    if (skipACL) {
      try {
        zk.getData("/acltest",false,null);
      }
 catch (      KeeperException e) {
        Assert.fail("Badauth reads should succeed with skipACL.");
      }
    }
 else {
      try {
        zk.getData("/acltest",false,null);
        Assert.fail("Should have received a permission error");
      }
 catch (      KeeperException e) {
        Assert.assertEquals(Code.NOAUTH,e.code());
      }
    }
    zk.addAuthInfo("digest","ben:passwd".getBytes());
    zk.getData("/acltest",false,null);
    zk.setACL("/acltest",Ids.OPEN_ACL_UNSAFE,-1);
    zk.close();
    zk=createClient();
    zk.getData("/acltest",false,null);
    List<ACL> acls=zk.getACL("/acltest",new Stat());
    Assert.assertEquals(1,acls.size());
    Assert.assertEquals(Ids.OPEN_ACL_UNSAFE,acls);
  }
  finally {
    if (zk != null) {
      zk.close();
    }
  }
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSequentialNodeNames() throws IOException, InterruptedException, KeeperException {
  String path="/SEQUENCE";
  String file="TEST";
  String filepath=path + "/" + file;
  ZooKeeper zk=null;
  try {
    zk=createClient();
    zk.create(path,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    zk.create(filepath,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    List<String> children=zk.getChildren(path,false);
    Assert.assertEquals(1,children.size());
    Assert.assertEquals(file + "0000000000",children.get(0));
    zk.create(filepath,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    children=zk.getChildren(path,false);
    Assert.assertEquals(2,children.size());
    Assert.assertTrue("contains child 1",children.contains(file + "0000000001"));
    zk.create(filepath,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    children=zk.getChildren(path,false);
    Assert.assertEquals(3,children.size());
    Assert.assertTrue("contains child 2",children.contains(file + "0000000002"));
    for (int i=children.size(); i < 105; i++)     zk.create(filepath,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    children=zk.getChildren(path,false);
    Assert.assertTrue("contains child 104",children.contains(file + "0000000104"));
  }
  finally {
    if (zk != null)     zk.close();
  }
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * We create a perfectly valid 'exists' request, except that the opcode is wrong.
 * @return
 * @throws Exception
 */
@Test public void testNonExistingOpCode() throws Exception {
  TestableZooKeeper zk=createClient();
  final String path="/m1";
  RequestHeader h=new RequestHeader();
  h.setType(888);
  ExistsRequest request=new ExistsRequest();
  request.setPath(path);
  request.setWatch(false);
  ExistsResponse response=new ExistsResponse();
  ReplyHeader r=zk.submitRequest(h,request,response,null);
  Assert.assertEquals(r.getErr(),Code.UNIMPLEMENTED.intValue());
  zk.testableWaitForShutdown(CONNECTION_TIMEOUT);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.CnxManagerTest </h4><pre class="type-10 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSocketTimeout() throws Exception {
  QuorumPeer peer=new QuorumPeer(peers,peerTmpdir[1],peerTmpdir[1],peerClientPort[1],3,1,2000,2,2);
  QuorumCnxManager cnxManager=new QuorumCnxManager(peer);
  QuorumCnxManager.Listener listener=cnxManager.listener;
  if (listener != null) {
    listener.start();
  }
 else {
    LOG.error("Null listener when initializing cnx manager");
  }
  int port=peers.get(peer.getId()).electionAddr.getPort();
  LOG.info("Election port: " + port);
  Thread.sleep(1000);
  Socket sock=new Socket();
  sock.connect(peers.get(1L).electionAddr,5000);
  long begin=Time.currentElapsedTime();
  cnxManager.receiveConnection(sock);
  long end=Time.currentElapsedTime();
  if ((end - begin) > ((peer.getSyncLimit() * peer.getTickTime()) + 500))   Assert.fail("Waited more than necessary");
  cnxManager.halt();
  Assert.assertFalse(cnxManager.listener.isAlive());
}

</code></pre>

<br>
<pre class="type-10 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCnxManager() throws Exception {
  CnxManagerThread thread=new CnxManagerThread();
  thread.start();
  QuorumPeer peer=new QuorumPeer(peers,peerTmpdir[1],peerTmpdir[1],peerClientPort[1],3,1,1000,2,2);
  QuorumCnxManager cnxManager=new QuorumCnxManager(peer);
  QuorumCnxManager.Listener listener=cnxManager.listener;
  if (listener != null) {
    listener.start();
  }
 else {
    LOG.error("Null listener when initializing cnx manager");
  }
  cnxManager.toSend(0L,createMsg(ServerState.LOOKING.ordinal(),1,-1,1));
  Message m=null;
  int numRetries=1;
  while ((m == null) && (numRetries++ <= THRESHOLD)) {
    m=cnxManager.pollRecvQueue(3000,TimeUnit.MILLISECONDS);
    if (m == null)     cnxManager.connectAll();
  }
  Assert.assertTrue("Exceeded number of retries",numRetries <= THRESHOLD);
  thread.join(5000);
  if (thread.isAlive()) {
    Assert.fail("Thread didn't join");
  }
 else {
    if (thread.failed)     Assert.fail("Did not receive expected message");
  }
  cnxManager.halt();
  Assert.assertFalse(cnxManager.listener.isAlive());
}

</code></pre>

<br>
<pre class="type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests a bug in QuorumCnxManager that causes a NPE when a 3.4.6
 * observer connects to a 3.5.0 server. {@link https://issues.apache.org/jira/browse/ZOOKEEPER-1789}
 * @throws Exception
 */
@Test public void testCnxManagerNPE() throws Exception {
  peers.get(2L).type=LearnerType.OBSERVER;
  QuorumPeer peer=new QuorumPeer(peers,peerTmpdir[1],peerTmpdir[1],peerClientPort[1],3,1,1000,2,2);
  QuorumCnxManager cnxManager=new QuorumCnxManager(peer);
  QuorumCnxManager.Listener listener=cnxManager.listener;
  if (listener != null) {
    listener.start();
  }
 else {
    LOG.error("Null listener when initializing cnx manager");
  }
  int port=peers.get(peer.getId()).electionAddr.getPort();
  LOG.info("Election port: " + port);
  Thread.sleep(1000);
  SocketChannel sc=SocketChannel.open();
  sc.socket().connect(peers.get(1L).electionAddr,5000);
  byte[] msgBytes=new byte[8];
  ByteBuffer msgBuffer=ByteBuffer.wrap(msgBytes);
  msgBuffer.putLong(2L);
  msgBuffer.position(0);
  sc.write(msgBuffer);
  msgBuffer=ByteBuffer.wrap(new byte[8]);
  msgBuffer.putInt(4);
  msgBuffer.putInt(5);
  msgBuffer.position(0);
  sc.write(msgBuffer);
  Message m=cnxManager.pollRecvQueue(1000,TimeUnit.MILLISECONDS);
  Assert.assertNotNull(m);
  peer.shutdown();
  cnxManager.halt();
  Assert.assertFalse(cnxManager.listener.isAlive());
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests a bug in QuorumCnxManager that causes a spin lock
 * when a negative value is sent. This test checks if the
 * connection is being closed upon a message with negative
 * length.
 * @throws Exception
 */
@Test public void testCnxManagerSpinLock() throws Exception {
  QuorumPeer peer=new QuorumPeer(peers,peerTmpdir[1],peerTmpdir[1],peerClientPort[1],3,1,1000,2,2);
  QuorumCnxManager cnxManager=new QuorumCnxManager(peer);
  QuorumCnxManager.Listener listener=cnxManager.listener;
  if (listener != null) {
    listener.start();
  }
 else {
    LOG.error("Null listener when initializing cnx manager");
  }
  int port=peers.get(peer.getId()).electionAddr.getPort();
  LOG.info("Election port: " + port);
  Thread.sleep(1000);
  SocketChannel sc=SocketChannel.open();
  sc.socket().connect(peers.get(1L).electionAddr,5000);
  InetSocketAddress otherAddr=peers.get(new Long(2)).electionAddr;
  DataOutputStream dout=new DataOutputStream(sc.socket().getOutputStream());
  dout.writeLong(QuorumCnxManager.PROTOCOL_VERSION);
  dout.writeLong(new Long(2));
  String addr=otherAddr.getHostString() + ":" + otherAddr.getPort();
  byte[] addr_bytes=addr.getBytes();
  dout.writeInt(addr_bytes.length);
  dout.write(addr_bytes);
  dout.flush();
  ByteBuffer msgBuffer=ByteBuffer.wrap(new byte[4]);
  msgBuffer.putInt(-20);
  msgBuffer.position(0);
  sc.write(msgBuffer);
  Thread.sleep(1000);
  try {
    for (int i=0; i < 100; i++) {
      msgBuffer.position(0);
      sc.write(msgBuffer);
    }
    Assert.fail("Socket has not been closed");
  }
 catch (  Exception e) {
    LOG.info("Socket has been closed as expected");
  }
  peer.shutdown();
  cnxManager.halt();
  Assert.assertFalse(cnxManager.listener.isAlive());
}

</code></pre>

<br>
<pre class="type-10 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCnxManagerTimeout() throws Exception {
  Random rand=new Random();
  byte b=(byte)rand.nextInt();
  int deadPort=PortAssignment.unique();
  String deadAddress="10.1.1." + b;
  LOG.info("This is the dead address I'm trying: " + deadAddress);
  peers.put(Long.valueOf(2),new QuorumServer(2,new InetSocketAddress(deadAddress,deadPort),new InetSocketAddress(deadAddress,PortAssignment.unique()),new InetSocketAddress(deadAddress,PortAssignment.unique())));
  peerTmpdir[2]=ClientBase.createTmpDir();
  QuorumPeer peer=new QuorumPeer(peers,peerTmpdir[1],peerTmpdir[1],peerClientPort[1],3,1,1000,2,2);
  QuorumCnxManager cnxManager=new QuorumCnxManager(peer);
  QuorumCnxManager.Listener listener=cnxManager.listener;
  if (listener != null) {
    listener.start();
  }
 else {
    LOG.error("Null listener when initializing cnx manager");
  }
  long begin=Time.currentElapsedTime();
  cnxManager.toSend(2L,createMsg(ServerState.LOOKING.ordinal(),1,-1,1));
  long end=Time.currentElapsedTime();
  if ((end - begin) > 6000)   Assert.fail("Waited more than necessary");
  cnxManager.halt();
  Assert.assertFalse(cnxManager.listener.isAlive());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ConnectStringParserTest </h4><pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testParseServersWithPort(){
  String servers="10.10.10.1:112,10.10.10.2:110";
  ConnectStringParser parser=new ConnectStringParser(servers);
  Assert.assertEquals("10.10.10.1",parser.getServerAddresses().get(0).getHostString());
  Assert.assertEquals("10.10.10.2",parser.getServerAddresses().get(1).getHostString());
  Assert.assertEquals(112,parser.getServerAddresses().get(0).getPort());
  Assert.assertEquals(110,parser.getServerAddresses().get(1).getPort());
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testParseServersWithoutPort(){
  String servers="10.10.10.1,10.10.10.2";
  ConnectStringParser parser=new ConnectStringParser(servers);
  Assert.assertEquals("10.10.10.1",parser.getServerAddresses().get(0).getHostString());
  Assert.assertEquals("10.10.10.2",parser.getServerAddresses().get(1).getHostString());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.CreateModeTest </h4><pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBasicCreateMode(){
  CreateMode cm=CreateMode.PERSISTENT;
  Assert.assertEquals(cm.toFlag(),0);
  Assert.assertFalse(cm.isEphemeral());
  Assert.assertFalse(cm.isSequential());
  Assert.assertFalse(cm.isContainer());
  cm=CreateMode.EPHEMERAL;
  Assert.assertEquals(cm.toFlag(),1);
  Assert.assertTrue(cm.isEphemeral());
  Assert.assertFalse(cm.isSequential());
  Assert.assertFalse(cm.isContainer());
  cm=CreateMode.PERSISTENT_SEQUENTIAL;
  Assert.assertEquals(cm.toFlag(),2);
  Assert.assertFalse(cm.isEphemeral());
  Assert.assertTrue(cm.isSequential());
  Assert.assertFalse(cm.isContainer());
  cm=CreateMode.EPHEMERAL_SEQUENTIAL;
  Assert.assertEquals(cm.toFlag(),3);
  Assert.assertTrue(cm.isEphemeral());
  Assert.assertTrue(cm.isSequential());
  Assert.assertFalse(cm.isContainer());
  cm=CreateMode.CONTAINER;
  Assert.assertEquals(cm.toFlag(),4);
  Assert.assertFalse(cm.isEphemeral());
  Assert.assertFalse(cm.isSequential());
  Assert.assertTrue(cm.isContainer());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.CreateTest </h4><pre class="type-6 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testCreateWithNullStat() throws IOException, KeeperException, InterruptedException {
  String name="/foo";
  Assert.assertNull(zk.exists(name,false));
  Stat stat=null;
  String path=zk.create(name,name.getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT,stat);
  Assert.assertNull(stat);
  Assert.assertNotNull(zk.exists(name,false));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.DisconnectedWatcherTest </h4><pre class="type-5 type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testChildWatcherAutoResetWithChroot() throws Exception {
  ZooKeeper zk1=createClient();
  zk1.create("/ch1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher watcher=new MyWatcher();
  ZooKeeper zk2=createClient(watcher,hostPort + "/ch1");
  zk2.getChildren("/",true);
  zk1.create("/youdontmatter1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk1.create("/ch1/youshouldmatter1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  WatchedEvent e=watcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
  Assert.assertNotNull(e);
  Assert.assertEquals(EventType.NodeChildrenChanged,e.getType());
  Assert.assertEquals("/",e.getPath());
  MyWatcher childWatcher=new MyWatcher();
  zk2.getChildren("/",childWatcher);
  stopServer();
  watcher.waitForDisconnected(3000);
  startServer();
  watcher.waitForConnected(3000);
  zk1.create("/ch1/youshouldmatter2",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  e=childWatcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
  Assert.assertNotNull(e);
  Assert.assertEquals(EventType.NodeChildrenChanged,e.getType());
  Assert.assertEquals("/",e.getPath());
}

</code></pre>

<br>
<pre class="type-5 type-10 type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testManyChildWatchersAutoReset() throws Exception {
  ZooKeeper zk1=createClient();
  MyWatcher watcher=new MyWatcher();
  ZooKeeper zk2=createClient(watcher);
  String pathBase="/long-path-000000000-111111111-222222222-333333333-444444444-" + "555555555-666666666-777777777-888888888-999999999";
  zk1.create(pathBase,null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  List<String> paths=new ArrayList<String>();
  for (int i=0; i < 10000; i++) {
    String path=zk1.create(pathBase + "/ch-",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    paths.add(path);
  }
  MyWatcher childWatcher=new MyWatcher();
  int i=0;
  for (  String path : paths) {
    if (i % 3 == 0) {
      zk2.getChildren(path,childWatcher);
    }
 else     if (i % 3 == 1) {
      zk2.exists(path + "/foo",childWatcher);
    }
 else     if (i % 3 == 2) {
      zk2.getData(path,childWatcher,null);
    }
    i++;
  }
  stopServer();
  watcher.waitForDisconnected(30000);
  startServer();
  watcher.waitForConnected(30000);
  i=0;
  for (  String path : paths) {
    if (i % 3 == 0) {
      zk1.create(path + "/ch",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
      WatchedEvent e=childWatcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
      Assert.assertNotNull(e);
      Assert.assertEquals(EventType.NodeChildrenChanged,e.getType());
      Assert.assertEquals(path,e.getPath());
    }
 else     if (i % 3 == 1) {
      zk1.create(path + "/foo",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
      WatchedEvent e=childWatcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
      Assert.assertNotNull(e);
      Assert.assertEquals(EventType.NodeCreated,e.getType());
      Assert.assertEquals(path + "/foo",e.getPath());
    }
 else     if (i % 3 == 2) {
      zk1.setData(path,new byte[]{1,2,3},-1);
      WatchedEvent e=childWatcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
      Assert.assertNotNull(e);
      Assert.assertEquals(EventType.NodeDataChanged,e.getType());
      Assert.assertEquals(path,e.getPath());
    }
    i++;
  }
}

</code></pre>

<br>
<pre class="type-5 type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDefaultWatcherAutoResetWithChroot() throws Exception {
  ZooKeeper zk1=createClient();
  zk1.create("/ch1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher watcher=new MyWatcher();
  ZooKeeper zk2=createClient(watcher,hostPort + "/ch1");
  zk2.getChildren("/",true);
  zk1.create("/youdontmatter1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk1.create("/ch1/youshouldmatter1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  WatchedEvent e=watcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
  Assert.assertNotNull(e);
  Assert.assertEquals(EventType.NodeChildrenChanged,e.getType());
  Assert.assertEquals("/",e.getPath());
  zk2.getChildren("/",true);
  stopServer();
  watcher.waitForDisconnected(3000);
  startServer();
  watcher.waitForConnected(3000);
  zk1.create("/ch1/youshouldmatter2",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  e=watcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
  Assert.assertNotNull(e);
  Assert.assertEquals(EventType.NodeChildrenChanged,e.getType());
  Assert.assertEquals("/",e.getPath());
}

</code></pre>

<br>
<pre class="type-5 type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeepChildWatcherAutoResetWithChroot() throws Exception {
  ZooKeeper zk1=createClient();
  zk1.create("/ch1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk1.create("/ch1/here",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk1.create("/ch1/here/we",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk1.create("/ch1/here/we/are",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher watcher=new MyWatcher();
  ZooKeeper zk2=createClient(watcher,hostPort + "/ch1/here/we");
  zk2.getChildren("/are",true);
  zk1.create("/ch1/here/we/are/now",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  WatchedEvent e=watcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
  Assert.assertNotNull(e);
  Assert.assertEquals(EventType.NodeChildrenChanged,e.getType());
  Assert.assertEquals("/are",e.getPath());
  MyWatcher childWatcher=new MyWatcher();
  zk2.getChildren("/are",childWatcher);
  stopServer();
  watcher.waitForDisconnected(3000);
  startServer();
  watcher.waitForConnected(3000);
  zk1.create("/ch1/here/we/are/again",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  e=childWatcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
  Assert.assertNotNull(e);
  Assert.assertEquals(EventType.NodeChildrenChanged,e.getType());
  Assert.assertEquals("/are",e.getPath());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.FLEPredicateTest </h4><pre class="type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPredicate() throws IOException {
  peers=new HashMap<Long,QuorumServer>(3);
  for (int i=0; i < 3; i++) {
    peers.put(Long.valueOf(i),new QuorumServer(i,new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",PortAssignment.unique())));
  }
  try {
    File tmpDir=ClientBase.createTmpDir();
    QuorumPeer peer=new QuorumPeer(peers,tmpDir,tmpDir,PortAssignment.unique(),3,0,1000,2,2);
    MockFLE mock=new MockFLE(peer);
    mock.start();
    Assert.assertFalse(mock.predicate(4L,0L,0L,3L,0L,2L));
    Assert.assertTrue(mock.predicate(0L,0L,1L,1L,0L,0L));
    Assert.assertTrue(mock.predicate(0L,1L,0L,1L,0L,0L));
    Assert.assertTrue(mock.predicate(1L,1L,0L,0L,1L,0L));
  }
 catch (  IOException e) {
    LOG.error("Exception while creating quorum peer",e);
    Assert.fail("Exception while creating quorum peer");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.FLETest </h4><pre class="type-5 type-10 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testJoinInconsistentEnsemble() throws Exception {
  int sid;
  QuorumPeer peer;
  int waitTime=10 * 1000;
  ArrayList<QuorumPeer> peerList=new ArrayList<QuorumPeer>();
  for (sid=0; sid < 3; sid++) {
    peers.put(Long.valueOf(sid),new QuorumServer(sid,new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",PortAssignment.unique())));
    tmpdir[sid]=ClientBase.createTmpDir();
    port[sid]=PortAssignment.unique();
  }
  for (sid=0; sid < 2; sid++) {
    peer=new QuorumPeer(peers,tmpdir[sid],tmpdir[sid],port[sid],3,sid,2000,2,2);
    LOG.info("Starting peer " + peer.getId());
    peer.start();
    peerList.add(sid,peer);
  }
  peer=peerList.get(0);
  VerifyState v1=new VerifyState(peerList.get(0));
  v1.start();
  v1.join(waitTime);
  Assert.assertFalse("Unable to form cluster in " + waitTime + " ms",!v1.isSuccess());
  long leaderSid=peer.getCurrentVote().getId();
  long zxid=peer.getCurrentVote().getZxid();
  long electionEpoch=peer.getCurrentVote().getElectionEpoch();
  ServerState state=peer.getCurrentVote().getState();
  long peerEpoch=peer.getCurrentVote().getPeerEpoch();
  Vote newVote=new Vote(leaderSid,zxid + 100,electionEpoch + 100,peerEpoch,state);
  peer.setCurrentVote(newVote);
  peer=new QuorumPeer(peers,tmpdir[2],tmpdir[2],port[2],3,2,2000,2,2);
  LOG.info("Starting peer " + peer.getId());
  peer.start();
  peerList.add(sid,peer);
  v1=new VerifyState(peer);
  v1.start();
  v1.join(waitTime);
  if (v1.isAlive()) {
    Assert.fail("Peer " + peer.getId() + " failed to join the cluster "+ "within "+ waitTime+ " ms");
  }
  for (int id=0; id < 3; id++) {
    peer=peerList.get(id);
    if (peer != null) {
      peer.shutdown();
    }
  }
}

</code></pre>

<br>
<pre class="type-5 type-10 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testJoin() throws Exception {
  int sid;
  QuorumPeer peer;
  int waitTime=10 * 1000;
  ArrayList<QuorumPeer> peerList=new ArrayList<QuorumPeer>();
  for (sid=0; sid < 3; sid++) {
    port[sid]=PortAssignment.unique();
    peers.put(Long.valueOf(sid),new QuorumServer(sid,new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",port[sid])));
    tmpdir[sid]=ClientBase.createTmpDir();
  }
  for (sid=0; sid < 2; sid++) {
    peer=new QuorumPeer(peers,tmpdir[sid],tmpdir[sid],port[sid],3,sid,2000,2,2);
    LOG.info("Starting peer " + peer.getId());
    peer.start();
    peerList.add(sid,peer);
  }
  peer=peerList.get(0);
  VerifyState v1=new VerifyState(peerList.get(0));
  v1.start();
  v1.join(waitTime);
  Assert.assertFalse("Unable to form cluster in " + waitTime + " ms",!v1.isSuccess());
  peer=new QuorumPeer(peers,tmpdir[sid],tmpdir[sid],port[sid],3,sid,2000,2,2);
  LOG.info("Starting peer " + peer.getId());
  peer.start();
  peerList.add(sid,peer);
  v1=new VerifyState(peer);
  v1.start();
  v1.join(waitTime);
  if (v1.isAlive()) {
    Assert.fail("Peer " + peer.getId() + " failed to join the cluster "+ "within "+ waitTime+ " ms");
  }
 else   if (!v1.isSuccess()) {
    Assert.fail("Incorrect LEADING state for peer " + peer.getId());
  }
  for (int id=0; id < 3; id++) {
    peer=peerList.get(id);
    if (peer != null) {
      peer.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.FollowerResyncConcurrencyTest </h4><pre class="type-5 type-10 type-3 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify that the server is sending the proper zxid, and as a result
 * the watch doesn't fire. See ZOOKEEPER-1412.
 */
@Test public void testFollowerWatcherResync() throws Exception {
  QuorumUtil qu=new QuorumUtil(1);
  qu.startAll();
  int index=1;
  while (qu.getPeer(index).peer.follower == null) {
    index++;
  }
  LOG.info("Connecting to follower: {}",index);
  TestableZooKeeper zk1=createTestableClient("localhost:" + qu.getPeer(index).peer.getClientPort());
  zk1.create("/foo","foo".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher watcher=new MyWatcher();
  TestableZooKeeper zk2=createTestableClient(watcher,"localhost:" + qu.getPeer(index).peer.getClientPort());
  zk2.exists("/foo",true);
  watcher.reset();
  zk2.testableConnloss();
  if (!watcher.clientConnected.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS)) {
    fail("Unable to connect to server");
  }
  assertArrayEquals("foo".getBytes(),zk2.getData("/foo",false,null));
  assertNull(watcher.events.poll(5,TimeUnit.SECONDS));
  zk1.close();
  zk2.close();
  qu.shutdownAll();
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify that the server is sending the proper zxid. See ZOOKEEPER-1412.
 */
@Test public void testFollowerSendsLastZxid() throws Exception {
  QuorumUtil qu=new QuorumUtil(1);
  qu.startAll();
  int index=1;
  while (qu.getPeer(index).peer.follower == null) {
    index++;
  }
  LOG.info("Connecting to follower: {}",index);
  TestableZooKeeper zk=createTestableClient("localhost:" + qu.getPeer(index).peer.getClientPort());
  assertEquals(0L,zk.testableLastZxid());
  zk.exists("/",false);
  long lzxid=zk.testableLastZxid();
  assertTrue("lzxid:" + lzxid + " > 0",lzxid > 0);
  zk.close();
  qu.shutdownAll();
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * See ZOOKEEPER-1319 - verify that a lagging follwer resyncs correctly
 * 1) start with down quorum
 * 2) start leader/follower1, add some data
 * 3) restart leader/follower1
 * 4) start follower2
 * 5) verify data consistency across the ensemble
 * @throws Exception
 */
@Test public void testLaggingFollowerResyncsUnderNewEpoch() throws Exception {
  CountdownWatcher watcher1=new CountdownWatcher();
  CountdownWatcher watcher2=new CountdownWatcher();
  CountdownWatcher watcher3=new CountdownWatcher();
  QuorumUtil qu=new QuorumUtil(1);
  qu.shutdownAll();
  qu.start(1);
  qu.start(2);
  Assert.assertTrue("Waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + qu.getPeer(1).clientPort,ClientBase.CONNECTION_TIMEOUT));
  Assert.assertTrue("Waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + qu.getPeer(2).clientPort,ClientBase.CONNECTION_TIMEOUT));
  ZooKeeper zk1=createClient(qu.getPeer(1).peer.getClientPort(),watcher1);
  LOG.info("zk1 has session id 0x{}",Long.toHexString(zk1.getSessionId()));
  final String resyncPath="/resyncundernewepoch";
  zk1.create(resyncPath,null,ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk1.close();
  qu.shutdown(1);
  qu.shutdown(2);
  Assert.assertTrue("Waiting for server down",ClientBase.waitForServerDown("127.0.0.1:" + qu.getPeer(1).clientPort,ClientBase.CONNECTION_TIMEOUT));
  Assert.assertTrue("Waiting for server down",ClientBase.waitForServerDown("127.0.0.1:" + qu.getPeer(2).clientPort,ClientBase.CONNECTION_TIMEOUT));
  qu.start(1);
  qu.start(2);
  Assert.assertTrue("Waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + qu.getPeer(1).clientPort,ClientBase.CONNECTION_TIMEOUT));
  Assert.assertTrue("Waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + qu.getPeer(2).clientPort,ClientBase.CONNECTION_TIMEOUT));
  qu.start(3);
  Assert.assertTrue("Waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + qu.getPeer(3).clientPort,ClientBase.CONNECTION_TIMEOUT));
  zk1=createClient(qu.getPeer(1).peer.getClientPort(),watcher1);
  LOG.info("zk1 has session id 0x{}",Long.toHexString(zk1.getSessionId()));
  assertNotNull("zk1 has data",zk1.exists(resyncPath,false));
  final ZooKeeper zk2=createClient(qu.getPeer(2).peer.getClientPort(),watcher2);
  LOG.info("zk2 has session id 0x{}",Long.toHexString(zk2.getSessionId()));
  assertNotNull("zk2 has data",zk2.exists(resyncPath,false));
  final ZooKeeper zk3=createClient(qu.getPeer(3).peer.getClientPort(),watcher3);
  LOG.info("zk3 has session id 0x{}",Long.toHexString(zk3.getSessionId()));
  assertNotNull("zk3 has data",zk3.exists(resyncPath,false));
  zk1.close();
  zk2.close();
  zk3.close();
  qu.shutdownAll();
}

</code></pre>

<br>
<pre class="type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test:
 * Starts up 3 ZKs. The non-leader ZKs are writing to cluster
 * Shut down one of the non-leader ZKs.
 * Restart after sessions have expired but <500 txns have taken place (get a diff)
 * Shut down immediately after restarting, start running separate thread with other transactions
 * Restart to a diff while transactions are running in leader
 * Before fixes for ZOOKEEPER-962, restarting off of diff could get an inconsistent view of data missing transactions that
 * completed during diff syncing. Follower would also be considered "restarted" before all forwarded transactions
 * were completely processed, so restarting would cause a snap file with a too-high zxid to be written, and transactions
 * would be missed
 * This test should pretty reliably catch the failure of restarting the server before all diff messages have been processed,
 * however, due to the transient nature of the system it may not catch failures due to concurrent processing of transactions
 * during the leader's diff forwarding.
 * @throws IOException
 * @throws InterruptedException
 * @throws KeeperException
 * @throws Throwable
 */
@Test public void testResyncByDiffAfterFollowerCrashes() throws IOException, InterruptedException, KeeperException, Throwable {
  final Semaphore sem=new Semaphore(0);
  QuorumUtil qu=new QuorumUtil(1);
  qu.startAll();
  CountdownWatcher watcher1=new CountdownWatcher();
  CountdownWatcher watcher2=new CountdownWatcher();
  CountdownWatcher watcher3=new CountdownWatcher();
  int index=1;
  while (qu.getPeer(index).peer.leader == null) {
    index++;
  }
  Leader leader=qu.getPeer(index).peer.leader;
  assertNotNull(leader);
  index=(index == 1) ? 2 : 1;
  LOG.info("Connecting to follower: {}",index);
  final ZooKeeper zk1=createClient(qu.getPeer(index).peer.getClientPort(),watcher1);
  LOG.info("zk1 has session id 0x{}",Long.toHexString(zk1.getSessionId()));
  final ZooKeeper zk2=createClient(qu.getPeer(index).peer.getClientPort(),watcher2);
  LOG.info("zk2 has session id 0x{}",Long.toHexString(zk2.getSessionId()));
  final ZooKeeper zk3=createClient(qu.getPeer(3).peer.getClientPort(),watcher3);
  LOG.info("zk3 has session id 0x{}",Long.toHexString(zk3.getSessionId()));
  zk1.create("/first",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk2.create("/mybar",null,ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL_SEQUENTIAL);
  final AtomicBoolean runNow=new AtomicBoolean(false);
  Thread mytestfooThread=new Thread(new Runnable(){
    @Override public void run(){
      int inSyncCounter=0;
      while (inSyncCounter < 400) {
        if (runNow.get()) {
          zk3.create("/mytestfoo",null,ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL_SEQUENTIAL,new AsyncCallback.StringCallback(){
            @Override public void processResult(            int rc,            String path,            Object ctx,            String name){
              pending.decrementAndGet();
              counter.incrementAndGet();
              if (rc != 0) {
                errors.incrementAndGet();
                ;
              }
              if (counter.get() > 7300) {
                sem.release();
              }
            }
          }
,null);
          pending.incrementAndGet();
          try {
            Thread.sleep(10);
          }
 catch (          Exception e) {
          }
          inSyncCounter++;
        }
 else {
          Thread.yield();
        }
      }
    }
  }
);
  mytestfooThread.start();
  for (int i=0; i < 5000; i++) {
    zk2.create("/mybar",null,ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL_SEQUENTIAL,new AsyncCallback.StringCallback(){
      @Override public void processResult(      int rc,      String path,      Object ctx,      String name){
        pending.decrementAndGet();
        counter.incrementAndGet();
        if (rc != 0) {
          errors.incrementAndGet();
          ;
        }
        if (counter.get() > 7300) {
          sem.release();
        }
      }
    }
,null);
    pending.incrementAndGet();
    if (i == 1000) {
      qu.shutdown(index);
      Thread.sleep(1100);
      LOG.info("Shutting down s1");
    }
    if (i == 1100 || i == 1150 || i == 1200) {
      Thread.sleep(1000);
    }
    if (i == 1200) {
      qu.startThenShutdown(index);
      runNow.set(true);
      qu.restart(index);
      LOG.info("Setting up server: {}",index);
    }
    if (i >= 1000 && i % 2 == 0) {
      zk3.create("/newbaz",null,ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL_SEQUENTIAL,new AsyncCallback.StringCallback(){
        @Override public void processResult(        int rc,        String path,        Object ctx,        String name){
          pending.decrementAndGet();
          counter.incrementAndGet();
          if (rc != 0) {
            errors.incrementAndGet();
          }
          if (counter.get() > 7300) {
            sem.release();
          }
        }
      }
,null);
      pending.incrementAndGet();
    }
    if (i == 1050 || i == 1100 || i == 1150) {
      Thread.sleep(1000);
    }
  }
  if (!sem.tryAcquire(ClientBase.CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS)) {
    LOG.warn("Did not aquire semaphore fast enough");
  }
  mytestfooThread.join(ClientBase.CONNECTION_TIMEOUT);
  if (mytestfooThread.isAlive()) {
    LOG.error("mytestfooThread is still alive");
  }
  assertTrue(waitForPendingRequests(60));
  assertTrue(waitForSync(qu,index,10));
  verifyState(qu,index,leader);
  zk1.close();
  zk2.close();
  zk3.close();
  qu.shutdownAll();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.GetChildren2Test </h4><pre class="type-9 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testChildren() throws IOException, KeeperException, InterruptedException {
  String name="/foo";
  zk.create(name,name.getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  List<String> children=new ArrayList<String>();
  List<String> children_s=new ArrayList<String>();
  for (int i=0; i < 10; i++) {
    String childname=name + "/bar" + i;
    String childname_s="bar" + i;
    children.add(childname);
    children_s.add(childname_s);
  }
  for (int i=0; i < children.size(); i++) {
    String childname=children.get(i);
    zk.create(childname,childname.getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
    Stat stat=new Stat();
    List<String> s=zk.getChildren(name,false,stat);
    Assert.assertEquals(stat.getCzxid(),stat.getMzxid());
    Assert.assertEquals(stat.getCzxid() + i + 1,stat.getPzxid());
    Assert.assertEquals(stat.getCtime(),stat.getMtime());
    Assert.assertEquals(i + 1,stat.getCversion());
    Assert.assertEquals(0,stat.getVersion());
    Assert.assertEquals(0,stat.getAversion());
    Assert.assertEquals(0,stat.getEphemeralOwner());
    Assert.assertEquals(name.length(),stat.getDataLength());
    Assert.assertEquals(i + 1,stat.getNumChildren());
    Assert.assertEquals(s.size(),stat.getNumChildren());
  }
  List<String> p=zk.getChildren(name,false,null);
  List<String> c_a=children_s;
  List<String> c_b=p;
  Collections.sort(c_a);
  Collections.sort(c_b);
  Assert.assertEquals(c_a.size(),10);
  Assert.assertEquals(c_a,c_b);
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testChild() throws IOException, KeeperException, InterruptedException {
  String name="/foo";
  zk.create(name,name.getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  String childname=name + "/bar";
  zk.create(childname,childname.getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  Stat stat=new Stat();
  List<String> s=zk.getChildren(name,false,stat);
  Assert.assertEquals(stat.getCzxid(),stat.getMzxid());
  Assert.assertEquals(stat.getCzxid() + 1,stat.getPzxid());
  Assert.assertEquals(stat.getCtime(),stat.getMtime());
  Assert.assertEquals(1,stat.getCversion());
  Assert.assertEquals(0,stat.getVersion());
  Assert.assertEquals(0,stat.getAversion());
  Assert.assertEquals(0,stat.getEphemeralOwner());
  Assert.assertEquals(name.length(),stat.getDataLength());
  Assert.assertEquals(1,stat.getNumChildren());
  Assert.assertEquals(s.size(),stat.getNumChildren());
  s=zk.getChildren(childname,false,stat);
  Assert.assertEquals(stat.getCzxid(),stat.getMzxid());
  Assert.assertEquals(stat.getCzxid(),stat.getPzxid());
  Assert.assertEquals(stat.getCtime(),stat.getMtime());
  Assert.assertEquals(0,stat.getCversion());
  Assert.assertEquals(0,stat.getVersion());
  Assert.assertEquals(0,stat.getAversion());
  Assert.assertEquals(zk.getSessionId(),stat.getEphemeralOwner());
  Assert.assertEquals(childname.length(),stat.getDataLength());
  Assert.assertEquals(0,stat.getNumChildren());
  Assert.assertEquals(s.size(),stat.getNumChildren());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.GetProposalFromTxnTest </h4><pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test loading proposal from txnlog
 * @throws Exceptionan exception might be thrown here
 */
@Test public void testGetProposalFromTxn() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(100);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
  Long[] zxids=new Long[MSG_COUNT];
  try {
    String data="data";
    byte[] bytes=data.getBytes();
    for (int i=0; i < MSG_COUNT; i++) {
      Stat stat=new Stat();
      zk.create("/invalidsnap-" + i,bytes,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
      zk.getData("/invalidsnap-" + i,null,stat);
      zxids[i]=stat.getCzxid();
    }
  }
  finally {
    zk.close();
  }
  f.shutdown();
  zks.shutdown();
  Assert.assertTrue("waiting for server to shutdown",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
  zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  zks.startdata();
  ZKDatabase db=zks.getZKDatabase();
  Iterator<Proposal> itr=db.getProposalsFromTxnLog(zxids[0],10000000);
  int createCount=0;
  ArrayList<Long> retrievedZxids=new ArrayList<Long>(MSG_COUNT);
  while (itr.hasNext()) {
    Proposal proposal=itr.next();
    TxnHeader hdr=new TxnHeader();
    Record rec=SerializeUtils.deserializeTxn(proposal.packet.getData(),hdr);
    if (hdr.getType() == OpCode.create) {
      retrievedZxids.add(hdr.getZxid());
      createCount++;
    }
  }
  Assert.assertTrue("Zxids missmatches",Arrays.equals(zxids,retrievedZxids.toArray(new Long[0])));
  Assert.assertTrue("create proposal count == " + MSG_COUNT,(createCount == MSG_COUNT));
  db.setSnapshotSizeFactor(0.33);
  long sizeLimit=db.calculateTxnLogSizeLimit();
  itr=db.getProposalsFromTxnLog(zxids[MSG_COUNT / 2],sizeLimit);
  Assert.assertFalse("Expect empty proposal",(itr.hasNext()));
  f.shutdown();
  zks.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.LeaderSessionTrackerTest </h4><pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * When local session is enabled, leader will allow persistent node
 * to be create for unknown session
 */
@Test public void testCreatePersistent() throws Exception {
  qu.enableLocalSession(true);
  qu.startAll();
  QuorumPeer leader=qu.getLeaderQuorumPeer();
  ZooKeeper zk=new ZooKeeper(qu.getConnectString(leader),CONNECTION_TIMEOUT,this);
  CreateRequest createRequest=new CreateRequest("/success",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT.toFlag());
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  BinaryOutputArchive boa=BinaryOutputArchive.getArchive(baos);
  createRequest.serialize(boa,"request");
  ByteBuffer bb=ByteBuffer.wrap(baos.toByteArray());
  long sid=qu.getFollowerQuorumPeers().get(0).getActiveServer().getServerId();
  long locallSession=(sid << 56) + 1;
  LOG.info("Local session Id: " + Long.toHexString(locallSession));
  Request request=new Request(null,locallSession,0,OpCode.create,bb,new ArrayList<Id>());
  leader.getActiveServer().submitRequest(request);
  zk.create("/ok",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Stat stat=zk.exists("/success",null);
  Assert.assertTrue("Request from local sesson failed",stat != null);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.LoadFromLogTest </h4><pre class="type-5 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test we can restore the snapshot that has data ahead of the zxid
 * of the snapshot file.
 */
@Test public void testRestore() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(10000);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=getConnectedZkClient();
  String lastPath=null;
  try {
    zk.create("/invalidsnap",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    for (int i=0; i < NUM_MESSAGES; i++) {
      lastPath=zk.create("/invalidsnap/test-",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    }
  }
  finally {
    zk.close();
  }
  String[] tokens=lastPath.split("-");
  String expectedPath="/invalidsnap/test-" + String.format("%010d",(new Integer(tokens[1])).intValue() + 1);
  long eZxid=zks.getZKDatabase().getDataTreeLastProcessedZxid();
  zks.getZKDatabase().setlastProcessedZxid(zks.getZKDatabase().getDataTreeLastProcessedZxid() - 10);
  LOG.info("Set lastProcessedZxid to " + zks.getZKDatabase().getDataTreeLastProcessedZxid());
  zks.takeSnapshot();
  zks.shutdown();
  f.shutdown();
  zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(10000);
  f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  connected=false;
  long fZxid=zks.getZKDatabase().getDataTreeLastProcessedZxid();
  Assert.assertTrue("Restore failed expected zxid=" + eZxid + " found="+ fZxid,fZxid == eZxid);
  zk=getConnectedZkClient();
  String[] children;
  String path;
  try {
    children=zk.getChildren("/invalidsnap",false).toArray(new String[0]);
    path=zk.create("/invalidsnap/test-",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
  }
  finally {
    zk.close();
  }
  LOG.info("Expected " + expectedPath + " found "+ path);
  Assert.assertTrue("Error in sequential znode creation expected " + expectedPath + " found "+ path,path.equals(expectedPath));
  Assert.assertTrue("Unexpected number of children " + children.length + " expected "+ NUM_MESSAGES,(children.length == NUM_MESSAGES));
  f.shutdown();
  zks.shutdown();
}

</code></pre>

<br>
<pre class="type-9 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * test that all transactions from the Log are loaded, and only once
 * @throws Exception an exception might be thrown here
 */
@Test public void testLoad() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(100);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
  try {
    for (int i=0; i < NUM_MESSAGES; i++) {
      zk.create("/invalidsnap-" + i,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    }
  }
  finally {
    zk.close();
  }
  f.shutdown();
  Assert.assertTrue("waiting for server to shutdown",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
  File logDir=new File(tmpDir,FileTxnSnapLog.version + FileTxnSnapLog.VERSION);
  FileTxnLog txnLog=new FileTxnLog(logDir);
  TxnIterator itr=txnLog.read(0);
  FileTxnIterator fileItr=(FileTxnIterator)itr;
  long storageSize=fileItr.getStorageSize();
  LOG.info("Txnlog size: " + storageSize + " bytes");
  Assert.assertTrue("Storage size is greater than zero ",(storageSize > 0));
  long expectedZxid=0;
  long lastZxid=0;
  TxnHeader hdr;
  do {
    hdr=itr.getHeader();
    expectedZxid++;
    Assert.assertTrue("not the same transaction. lastZxid=" + lastZxid + ", zxid="+ hdr.getZxid(),lastZxid != hdr.getZxid());
    Assert.assertTrue("excepting next transaction. expected=" + expectedZxid + ", retreived="+ hdr.getZxid(),(hdr.getZxid() == expectedZxid));
    lastZxid=hdr.getZxid();
  }
 while (itr.next());
  Assert.assertTrue("processed all transactions. " + expectedZxid + " == "+ TOTAL_TRANSACTIONS,(expectedZxid == TOTAL_TRANSACTIONS));
  zks.shutdown();
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * test that we fail to load txnlog of a request zxid that is older
 * than what exist on disk
 * @throws Exception an exception might be thrown here
 */
@Test public void testLoadFailure() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(50);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
  try {
    for (int i=0; i < NUM_MESSAGES; i++) {
      zk.create("/data-",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    }
  }
  finally {
    zk.close();
  }
  f.shutdown();
  Assert.assertTrue("waiting for server to shutdown",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
  File logDir=new File(tmpDir,FileTxnSnapLog.version + FileTxnSnapLog.VERSION);
  File[] logFiles=FileTxnLog.getLogFiles(logDir.listFiles(),0);
  Assert.assertTrue(logFiles.length > 4);
  Assert.assertTrue("delete the first log file",logFiles[0].delete());
  long secondStartZxid=Util.getZxidFromName(logFiles[1].getName(),"log");
  FileTxnLog txnLog=new FileTxnLog(logDir);
  TxnIterator itr=txnLog.read(1,false);
  Assert.assertEquals(secondStartZxid,itr.getHeader().getZxid());
  itr=txnLog.read(secondStartZxid,false);
  Assert.assertEquals(secondStartZxid,itr.getHeader().getZxid());
  Assert.assertTrue(itr.next());
  long nextZxid=itr.getHeader().getZxid();
  itr=txnLog.read(nextZxid,false);
  Assert.assertEquals(secondStartZxid,itr.getHeader().getZxid());
  long thirdStartZxid=Util.getZxidFromName(logFiles[2].getName(),"log");
  itr=txnLog.read(thirdStartZxid,false);
  Assert.assertEquals(secondStartZxid,itr.getHeader().getZxid());
  Assert.assertTrue(itr.next());
  nextZxid=itr.getHeader().getZxid();
  itr=txnLog.read(nextZxid,false);
  Assert.assertEquals(secondStartZxid,itr.getHeader().getZxid());
}

</code></pre>

<br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Simulates ZOOKEEPER-1069 and verifies that flush() before padLogFile
 * fixes it.
 */
@Test public void testPad() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  FileTxnLog txnLog=new FileTxnLog(tmpDir);
  TxnHeader txnHeader=new TxnHeader(0xabcd,0x123,0x123,Time.currentElapsedTime(),OpCode.create);
  Record txn=new CreateTxn("/Test",new byte[0],null,false,1);
  txnLog.append(txnHeader,txn);
  FileInputStream in=new FileInputStream(tmpDir.getPath() + "/log." + Long.toHexString(txnHeader.getZxid()));
  BinaryInputArchive ia=BinaryInputArchive.getArchive(in);
  FileHeader header=new FileHeader();
  header.deserialize(ia,"fileheader");
  LOG.info("Received magic : " + header.getMagic() + " Expected : "+ FileTxnLog.TXNLOG_MAGIC);
  Assert.assertTrue("Missing magic number ",header.getMagic() == FileTxnLog.TXNLOG_MAGIC);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.MultiTransactionTest </h4><pre class="type-3 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpdateConflict() throws Exception {
  Assert.assertNull(zk.exists("/multi",null));
  try {
    multi(zk,Arrays.asList(Op.create("/multi",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT),Op.setData("/multi","X".getBytes(),0),Op.setData("/multi","Y".getBytes(),0)));
    Assert.fail("Should have thrown a KeeperException for invalid version");
  }
 catch (  KeeperException e) {
    LOG.error("STACKTRACE: ",e);
  }
  Assert.assertNull(zk.exists("/multi",null));
  multi(zk,Arrays.asList(Op.create("/multi",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT),Op.setData("/multi","X".getBytes(),0),Op.setData("/multi","Y".getBytes(),1)));
  Assert.assertArrayEquals(zk.getData("/multi",false,null),"Y".getBytes());
}

</code></pre>

<br>
<pre class="type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testChRootTransaction() throws Exception {
  String chRoot=createNameSpace();
  zk_chroot=createClient(this.hostPort + chRoot);
  String childPath="/myid";
  Transaction transaction=zk_chroot.transaction();
  transaction.create(childPath,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  transaction.check(childPath,0);
  transaction.setData(childPath,childPath.getBytes(),0);
  commit(transaction);
  Assert.assertNotNull("zNode is not created under chroot:" + chRoot,zk.exists(chRoot + childPath,false));
  Assert.assertNotNull("zNode is not created under chroot:" + chRoot,zk_chroot.exists(childPath,false));
  Assert.assertNull("zNode is created directly under '/', ignored configured chroot",zk.exists(childPath,false));
  Assert.assertArrayEquals("zNode data not matching",childPath.getBytes(),zk_chroot.getData(childPath,false,null));
  transaction=zk_chroot.transaction();
  transaction.delete(childPath,1);
  commit(transaction);
  Assert.assertNull("chroot:" + chRoot + " exists after delete",zk.exists(chRoot + "/myid",false));
  Assert.assertNull("chroot:" + chRoot + " exists after delete",zk_chroot.exists("/myid",false));
}

</code></pre>

<br>
<pre class="type-10 type-3 type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetResults() throws Exception {
  Iterable<Op> ops=Arrays.asList(Op.create("/multi",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT),Op.delete("/multi",0),Op.setData("/multi","Y".getBytes(),0),Op.create("/foo",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT));
  List<OpResult> results=null;
  if (useAsync) {
    final MultiResult res=new MultiResult();
    zk.multi(ops,new MultiCallback(){
      @Override public void processResult(      int rc,      String path,      Object ctx,      List<OpResult> opResults){
synchronized (res) {
          res.rc=rc;
          res.results=opResults;
          res.finished=true;
          res.notifyAll();
        }
      }
    }
,null);
synchronized (res) {
      while (!res.finished) {
        res.wait();
      }
    }
    Assert.assertFalse("/multi should have been deleted so setData should have failed",KeeperException.Code.OK.intValue() == res.rc);
    Assert.assertNull(zk.exists("/multi",null));
    results=res.results;
  }
 else {
    try {
      zk.multi(ops);
      Assert.fail("/multi should have been deleted so setData should have failed");
    }
 catch (    KeeperException e) {
      Assert.assertNull(zk.exists("/multi",null));
      results=e.getResults();
    }
  }
  Assert.assertNotNull(results);
  for (  OpResult r : results) {
    LOG.info("RESULT==> {}",r);
    if (r instanceof ErrorResult) {
      ErrorResult er=(ErrorResult)r;
      LOG.info("ERROR RESULT: {} ERR=>{}",er,KeeperException.Code.get(er.getErr()));
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTransactionBuilder() throws Exception {
  List<OpResult> results=commit(zk.transaction().create("/t1",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT).create("/t1/child",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT).create("/t2",null,Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL));
  assertEquals(3,results.size());
  for (  OpResult r : results) {
    CreateResult c=(CreateResult)r;
    assertTrue(c.getPath().startsWith("/t"));
    assertNotNull(c.toString());
  }
  assertNotNull(zk.exists("/t1",false));
  assertNotNull(zk.exists("/t1/child",false));
  assertNotNull(zk.exists("/t2",false));
  results=commit(zk.transaction().check("/t1",0).check("/t1/child",0).check("/t2",0));
  assertEquals(3,results.size());
  for (  OpResult r : results) {
    CheckResult c=(CheckResult)r;
    assertNotNull(c.toString());
  }
  try {
    results=commit(zk.transaction().check("/t1",0).check("/t1/child",0).check("/t2",1));
    fail();
  }
 catch (  KeeperException.BadVersionException e) {
  }
  results=commit(zk.transaction().check("/t1",0).setData("/t1",new byte[0],0));
  assertEquals(2,results.size());
  for (  OpResult r : results) {
    assertNotNull(r.toString());
  }
  try {
    results=commit(zk.transaction().check("/t1",1).setData("/t1",new byte[0],2));
    fail();
  }
 catch (  KeeperException.BadVersionException e) {
  }
  results=commit(zk.transaction().check("/t1",1).check("/t1/child",0).check("/t2",0));
  assertEquals(3,results.size());
  results=commit(zk.transaction().delete("/t2",-1).delete("/t1/child",-1));
  assertEquals(2,results.size());
  for (  OpResult r : results) {
    DeleteResult d=(DeleteResult)r;
    assertNotNull(d.toString());
  }
  assertNotNull(zk.exists("/t1",false));
  assertNull(zk.exists("/t1/child",false));
  assertNull(zk.exists("/t2",false));
}

</code></pre>

<br>
<pre class="type-6 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testNestedCreate() throws Exception {
  multi(zk,Arrays.asList(Op.create("/multi",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT),Op.create("/multi/a",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT),Op.create("/multi/a/1",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT),Op.delete("/multi/a/1",0),Op.delete("/multi/a",0),Op.delete("/multi",0)));
  Assert.assertNull(zk.exists("/multi/a/1",null));
  Assert.assertNull(zk.exists("/multi/a",null));
  Assert.assertNull(zk.exists("/multi",null));
}

</code></pre>

<br>
<pre class="type-6 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testChRootCreateDelete() throws Exception {
  String chRoot=createNameSpace();
  zk_chroot=createClient(this.hostPort + chRoot);
  Op createChild=Op.create("/myid",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  multi(zk_chroot,Arrays.asList(createChild));
  Assert.assertNotNull("zNode is not created under chroot:" + chRoot,zk.exists(chRoot + "/myid",false));
  Assert.assertNotNull("zNode is not created under chroot:" + chRoot,zk_chroot.exists("/myid",false));
  Assert.assertNull("zNode is created directly under '/', ignored configured chroot",zk.exists("/myid",false));
  Op deleteChild=Op.delete("/myid",0);
  multi(zk_chroot,Arrays.asList(deleteChild));
  Assert.assertNull("zNode exists under chroot:" + chRoot,zk.exists(chRoot + "/myid",false));
  Assert.assertNull("zNode exists under chroot:" + chRoot,zk_chroot.exists("/myid",false));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.NIOConnectionFactoryFdLeakTest </h4><pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testFileDescriptorLeak() throws Exception {
  OSMXBean osMbean=new OSMXBean();
  if (osMbean.getUnix() != true) {
    LOG.info("Unable to run test on non-unix system");
    return;
  }
  long startFdCount=osMbean.getOpenFileDescriptorCount();
  LOG.info("Start fdcount is: " + startFdCount);
  for (int i=0; i < 50; ++i) {
    NIOServerCnxnFactory factory=new NIOServerCnxnFactory();
    factory.configure(new InetSocketAddress("127.0.0.1",PortAssignment.unique()),10);
    factory.start();
    Thread.sleep(100);
    factory.shutdown();
  }
  long endFdCount=osMbean.getOpenFileDescriptorCount();
  LOG.info("End fdcount is: " + endFdCount);
  Assert.assertTrue("Possible fd leakage",((endFdCount - startFdCount) < 50));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.OSMXBeanTest </h4><pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public final void testGetOpenFileDescriptorCount(){
  if (osMbean != null && osMbean.getUnix() == true) {
    ofdc=osMbean.getOpenFileDescriptorCount();
    LOG.info("open fdcount is: " + ofdc);
  }
  Assert.assertFalse("The number of open file descriptor is negative",(ofdc < 0));
}

</code></pre>

<br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public final void testGetMaxFileDescriptorCount(){
  if (osMbean != null && osMbean.getUnix() == true) {
    mfdc=osMbean.getMaxFileDescriptorCount();
    LOG.info("max fdcount is: " + mfdc);
  }
  Assert.assertFalse("The max file descriptor number is negative",(mfdc < 0));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ObserverLETest </h4><pre class="type-10 type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * See ZOOKEEPER-1294. Confirms that an observer will not support the quorum
 * of a leader by forming a 5-node, 2-observer ensemble (so quorum size is 2).
 * When all but the leader and one observer are shut down, the leader should
 * enter the 'looking' state, not stay in the 'leading' state.
 */
@Test public void testLEWithObserver() throws Exception {
  QuorumPeer leader=null;
  for (  QuorumPeer server : Arrays.asList(qb.s1,qb.s2,qb.s3)) {
    if (server.getServerState().equals(QuorumStats.Provider.FOLLOWING_STATE)) {
      server.shutdown();
      assertTrue("Waiting for server down",ClientBase.waitForServerDown("127.0.0.1:" + server.getClientPort(),ClientBase.CONNECTION_TIMEOUT));
    }
 else {
      assertNull("More than one leader found",leader);
      leader=server;
    }
  }
  assertTrue("Leader is not in Looking state",ClientBase.waitForServerState(leader,ClientBase.CONNECTION_TIMEOUT,QuorumStats.Provider.LOOKING_STATE));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ObserverTest </h4><pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * This test ensures that an Observer does not elect itself as a leader, or
 * indeed come up properly, if it is the lone member of an ensemble.
 * @throws Exception
 */
@Test public void testObserverOnly() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT_QP1=PortAssignment.unique();
  String quorumCfgSection="server.1=127.0.0.1:" + (PortAssignment.unique()) + ":"+ (PortAssignment.unique())+ ":observer;"+ CLIENT_PORT_QP1+ "\n";
  MainThread q1=new MainThread(1,CLIENT_PORT_QP1,quorumCfgSection);
  q1.start();
  q1.join(ClientBase.CONNECTION_TIMEOUT);
  Assert.assertFalse(q1.isAlive());
}

</code></pre>

<br>
<pre class="type-2 type-6 type-15 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test ensures two things:
 * 1. That Observers can successfully proxy requests to the ensemble.
 * 2. That Observers don't participate in leader elections.
 * The second is tested by constructing an ensemble where a leader would
 * be elected if and only if an Observer voted. 
 * @throws Exception
 */
@Test public void testObserver() throws Exception {
  ClientBase.setupTestEnv();
  latch=new CountDownLatch(2);
  final int PORT_QP1=PortAssignment.unique();
  final int PORT_QP2=PortAssignment.unique();
  final int PORT_OBS=PortAssignment.unique();
  final int PORT_QP_LE1=PortAssignment.unique();
  final int PORT_QP_LE2=PortAssignment.unique();
  final int PORT_OBS_LE=PortAssignment.unique();
  final int CLIENT_PORT_QP1=PortAssignment.unique();
  final int CLIENT_PORT_QP2=PortAssignment.unique();
  final int CLIENT_PORT_OBS=PortAssignment.unique();
  String quorumCfgSection="server.1=127.0.0.1:" + (PORT_QP1) + ":"+ (PORT_QP_LE1)+ ";"+ CLIENT_PORT_QP1+ "\nserver.2=127.0.0.1:"+ (PORT_QP2)+ ":"+ (PORT_QP_LE2)+ ";"+ CLIENT_PORT_QP2+ "\nserver.3=127.0.0.1:"+ (PORT_OBS)+ ":"+ (PORT_OBS_LE)+ ":observer"+ ";"+ CLIENT_PORT_OBS;
  MainThread q1=new MainThread(1,CLIENT_PORT_QP1,quorumCfgSection);
  MainThread q2=new MainThread(2,CLIENT_PORT_QP2,quorumCfgSection);
  MainThread q3=new MainThread(3,CLIENT_PORT_OBS,quorumCfgSection);
  q1.start();
  q2.start();
  q3.start();
  Assert.assertTrue("waiting for server 1 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP1,CONNECTION_TIMEOUT));
  Assert.assertTrue("waiting for server 2 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP2,CONNECTION_TIMEOUT));
  Assert.assertTrue("waiting for server 3 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_OBS,CONNECTION_TIMEOUT));
  zk=new ZooKeeper("127.0.0.1:" + CLIENT_PORT_OBS,ClientBase.CONNECTION_TIMEOUT,this);
  zk.create("/obstest","test".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertEquals(new String(zk.getData("/obstest",null,null)),"test");
  zk.sync("/",null,null);
  zk.setData("/obstest","test2".getBytes(),-1);
  zk.getChildren("/",false);
  Assert.assertEquals(zk.getState(),States.CONNECTED);
  LOG.info("Shutting down server 2");
  q2.shutdown();
  Assert.assertTrue("Waiting for server 2 to shut down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_QP2,ClientBase.CONNECTION_TIMEOUT));
  LOG.info("Server 2 down");
  latch.await();
  Assert.assertNotSame("Client is still connected to non-quorate cluster",KeeperState.SyncConnected,lastEvent.getState());
  LOG.info("Latch returned");
  try {
    Assert.assertFalse("Shouldn't get a response when cluster not quorate!",new String(zk.getData("/obstest",null,null)).equals("test"));
  }
 catch (  ConnectionLossException c) {
    LOG.info("Connection loss exception caught - ensemble not quorate (this is expected)");
  }
  latch=new CountDownLatch(1);
  LOG.info("Restarting server 2");
  q2=new MainThread(2,CLIENT_PORT_QP2,quorumCfgSection);
  q2.start();
  LOG.info("Waiting for server 2 to come up");
  Assert.assertTrue("waiting for server 2 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP2,CONNECTION_TIMEOUT));
  LOG.info("Server 2 started, waiting for latch");
  latch.await();
  Assert.assertTrue("Client didn't reconnect to quorate ensemble (state was" + lastEvent.getState() + ")",(KeeperState.SyncConnected == lastEvent.getState() || KeeperState.Expired == lastEvent.getState()));
  LOG.info("Shutting down all servers");
  q1.shutdown();
  q2.shutdown();
  q3.shutdown();
  LOG.info("Closing zk client");
  zk.close();
  Assert.assertTrue("Waiting for server 1 to shut down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_QP1,ClientBase.CONNECTION_TIMEOUT));
  Assert.assertTrue("Waiting for server 2 to shut down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_QP2,ClientBase.CONNECTION_TIMEOUT));
  Assert.assertTrue("Waiting for server 3 to shut down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_OBS,ClientBase.CONNECTION_TIMEOUT));
}

</code></pre>

<br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Ensure that observer only comes up when a proper ensemble is configured.
 * (and will not come up with standalone server).
 */
@Test public void testObserverWithStandlone() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT_QP1=PortAssignment.unique();
  String quorumCfgSection="server.1=127.0.0.1:" + (PortAssignment.unique()) + ":"+ (PortAssignment.unique())+ ":observer\n"+ "server.2=127.0.0.1:"+ (PortAssignment.unique())+ ":"+ (PortAssignment.unique())+ "\npeerType=observer\n";
  MainThread q1=new MainThread(1,CLIENT_PORT_QP1,quorumCfgSection);
  q1.start();
  q1.join(ClientBase.CONNECTION_TIMEOUT);
  Assert.assertFalse(q1.isAlive());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.QuorumMajorityTest </h4><pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 */
@Test public void testMajQuorums() throws Throwable {
  setUp(false);
  Proposal p=new Proposal();
  p.addQuorumVerifier(s1.getQuorumVerifier());
  p.addAck(Long.valueOf(1));
  p.addAck(Long.valueOf(2));
  Assert.assertEquals(false,p.hasAllQuorums());
  p.addAck(Long.valueOf(6));
  Assert.assertEquals(false,p.hasAllQuorums());
  p.addAck(Long.valueOf(3));
  Assert.assertEquals(true,p.hasAllQuorums());
  setUp(true);
  p=new Proposal();
  p.addQuorumVerifier(s1.getQuorumVerifier());
  p.addAck(Long.valueOf(1));
  Assert.assertEquals(false,p.hasAllQuorums());
  p.addAck(Long.valueOf(4));
  p.addAck(Long.valueOf(5));
  Assert.assertEquals(false,p.hasAllQuorums());
  p.addAck(Long.valueOf(6));
  Assert.assertEquals(false,p.hasAllQuorums());
  p.addAck(Long.valueOf(2));
  Assert.assertEquals(true,p.hasAllQuorums());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.QuorumQuotaTest </h4><pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testQuotaWithQuorum() throws Exception {
  ZooKeeper zk=createClient();
  zk.setData("/","some".getBytes(),-1);
  zk.create("/a","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  int i=0;
  for (i=0; i < 300; i++) {
    zk.create("/a/" + i,"some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  }
  ZooKeeperMain.createQuota(zk,"/a",1000L,5000);
  String statPath=Quotas.quotaZookeeper + "/a" + "/"+ Quotas.statNode;
  byte[] data=zk.getData(statPath,false,new Stat());
  StatsTrack st=new StatsTrack(new String(data));
  Assert.assertTrue("bytes are set",st.getBytes() == 1204L);
  Assert.assertTrue("num count is set",st.getCount() == 301);
  for (i=300; i < 600; i++) {
    zk.create("/a/" + i,"some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  }
  data=zk.getData(statPath,false,new Stat());
  st=new StatsTrack(new String(data));
  Assert.assertTrue("bytes are set",st.getBytes() == 2404L);
  Assert.assertTrue("num count is set",st.getCount() == 601);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.QuorumTest </h4><pre class="type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests if closeSession can be logged before a leader gets established, which
 * could lead to a locked-out follower (see ZOOKEEPER-790). 
 * The test works as follows. It has a client connecting to a follower f and
 * sending batches of 1,000 updates. The goal is that f has a zxid higher than
 * all other servers in the initial leader election. This way we can crash and
 * recover the follower so that the follower believes it is the leader once it
 * recovers (LE optimization: once a server receives a message from all other 
 * servers, it picks a leader.
 * It also makes the session timeout very short so that we force the false 
 * leader to close the session and write it to the log in the buggy code (before 
 * ZOOKEEPER-790). Once f drops leadership and finds the current leader, its epoch
 * is higher, and it rejects the leader. Now, if we prevent the leader from closing
 * the session by only starting up (see Leader.lead()) once it obtains a quorum of 
 * supporters, then f will find the current leader and support it because it won't
 * have a highe epoch.
 */
@Test public void testNoLogBeforeLeaderEstablishment() throws Exception {
  final Semaphore sem=new Semaphore(0);
  qu=new QuorumUtil(2,10);
  qu.startQuorum();
  int index=1;
  while (qu.getPeer(index).peer.leader == null)   index++;
  Leader leader=qu.getPeer(index).peer.leader;
  Assert.assertNotNull(leader);
  index=(index == 1) ? 2 : 1;
  ZooKeeper zk=new DisconnectableZooKeeper("127.0.0.1:" + qu.getPeer(index).peer.getClientPort(),ClientBase.CONNECTION_TIMEOUT,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  zk.create("/blah",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  for (int i=0; i < 50000; i++) {
    zk.setData("/blah",new byte[0],-1,new AsyncCallback.StatCallback(){
      public void processResult(      int rc,      String path,      Object ctx,      Stat stat){
        counter++;
        if (rc != 0) {
          errors++;
        }
        if (counter == 20000) {
          sem.release();
        }
      }
    }
,null);
    if (i == 5000) {
      qu.shutdown(index);
      LOG.info("Shutting down s1");
    }
    if (i == 12000) {
      qu.start(index);
      LOG.info("Setting up server: " + index);
    }
    if ((i % 1000) == 0) {
      Thread.sleep(500);
    }
  }
  sem.tryAcquire(15,TimeUnit.SECONDS);
  Assert.assertTrue("Not following",qu.getPeer(index).peer.follower != null);
  long epochF=(qu.getPeer(index).peer.getActiveServer().getZxid() >> 32L);
  long epochL=(leader.getEpoch() >> 32L);
  Assert.assertTrue("Zxid: " + qu.getPeer(index).peer.getActiveServer().getZxid() + "Current epoch: "+ epochF,epochF == epochL);
  zk.close();
}

</code></pre>

<br>
<pre class="type-9 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Make sure that we can change sessions
 * from follower to leader.
 * @throws IOException
 * @throws InterruptedException
 * @throws KeeperException
 */
@Test public void testSessionMoved() throws Exception {
  String hostPorts[]=qb.hostPort.split(",");
  DisconnectableZooKeeper zk=new DisconnectableZooKeeper(hostPorts[0],ClientBase.CONNECTION_TIMEOUT,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  zk.create("/sessionMoveTest",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  for (int i=0; i < hostPorts.length * 2; i++) {
    zk.dontReconnect();
    DisconnectableZooKeeper zknew=new DisconnectableZooKeeper(hostPorts[(i + 1) % hostPorts.length],ClientBase.CONNECTION_TIMEOUT,new Watcher(){
      public void process(      WatchedEvent event){
      }
    }
,zk.getSessionId(),zk.getSessionPasswd());
    zknew.setData("/",new byte[1],-1);
    final int result[]=new int[1];
    result[0]=Integer.MAX_VALUE;
    zknew.sync("/",new AsyncCallback.VoidCallback(){
      public void processResult(      int rc,      String path,      Object ctx){
synchronized (result) {
          result[0]=rc;
          result.notify();
        }
      }
    }
,null);
synchronized (result) {
      if (result[0] == Integer.MAX_VALUE) {
        result.wait(5000);
      }
    }
    LOG.info(hostPorts[(i + 1) % hostPorts.length] + " Sync returned " + result[0]);
    Assert.assertTrue(result[0] == KeeperException.Code.OK.intValue());
    try {
      zk.setData("/",new byte[1],-1);
      Assert.fail("Should have lost the connection");
    }
 catch (    KeeperException.ConnectionLossException e) {
    }
    zk=zknew;
  }
  zk.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.QuorumUtilTest </h4><pre class="type-10 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * <p>
 * This test ensures that all JXM beans associated to a {@link QuorumPeer}are unregistered when shuted down ({@link QuorumUtil#shutdown(int)}). It
 * allows a successfull restarting of several zookeeper servers ({@link QuorumPeer}) running on the same JVM.
 * <p>
 * See ZOOKEEPER-1214 for details.
 */
@Test public void validateAllMXBeanAreUnregistered() throws IOException {
  QuorumUtil qU=new QuorumUtil(1);
  LOG.info(">-->> Starting up all servers...");
  qU.startAll();
  LOG.info(">-->> Servers up and running...");
  int leaderIndex=qU.getLeaderServer();
  int firstFollowerIndex=0;
  int secondFollowerIndex=0;
switch (leaderIndex) {
case 1:
    firstFollowerIndex=2;
  secondFollowerIndex=3;
break;
case 2:
firstFollowerIndex=1;
secondFollowerIndex=3;
break;
case 3:
firstFollowerIndex=1;
secondFollowerIndex=2;
break;
default :
Assert.fail("Unexpected leaderIndex value: " + leaderIndex);
break;
}
LOG.info(">-->> Shuting down server [{}]",firstFollowerIndex);
qU.shutdown(firstFollowerIndex);
LOG.info(">-->> Shuting down server [{}]",secondFollowerIndex);
qU.shutdown(secondFollowerIndex);
LOG.info(">-->> Restarting server [{}]",firstFollowerIndex);
qU.restart(firstFollowerIndex);
LOG.info(">-->> Restarting server [{}]",secondFollowerIndex);
qU.restart(secondFollowerIndex);
qU.shutdownAll();
Set<ZKMBeanInfo> pending=MBeanRegistry.getInstance().getRegisteredBeans();
Assert.assertTrue("The following beans should have been unregistered: " + pending,pending.isEmpty());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.QuorumZxidSyncTest </h4><pre class="type-2 type-6 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies values related to public fields.
"></span><br>
/** 
 * find out what happens when a follower connects to leader that is behind
 */
@Test public void testBehindLeader() throws Exception {
  ClientBase.waitForServerUp(qb.hostPort,10000);
  ClientBase.waitForServerUp(qb.hostPort,10000);
  ZooKeeper zk=new ZooKeeper(qb.hostPort,10000,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  zk.create("/0",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.close();
  qb.shutdownServers();
  qb.startServers();
  ClientBase.waitForServerUp(qb.hostPort,10000);
  qb.shutdownServers();
  qb.startServers();
  ClientBase.waitForServerUp(qb.hostPort,10000);
  zk=new ZooKeeper(qb.hostPort,10000,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  zk.create("/1",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.close();
  qb.shutdownServers();
  qb.startServers();
  ClientBase.waitForServerUp(qb.hostPort,10000);
  qb.shutdownServers();
  qb.startServers();
  ClientBase.waitForServerUp(qb.hostPort,10000);
  zk=new ZooKeeper(qb.hostPort,10000,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  zk.create("/2",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.close();
  qb.shutdownServers();
  deleteFiles(qb.s1dir);
  deleteFiles(qb.s2dir);
  deleteFiles(qb.s3dir);
  deleteFiles(qb.s4dir);
  qb.setupServers();
  qb.s1.start();
  qb.s2.start();
  qb.s3.start();
  qb.s4.start();
  Assert.assertTrue("Servers didn't come up",ClientBase.waitForServerUp(qb.hostPort,10000));
  qb.s5.start();
  String hostPort="127.0.0.1:" + qb.s5.getClientPort();
  Assert.assertFalse("Servers came up, but shouldn't have since it's ahead of leader",ClientBase.waitForServerUp(hostPort,10000));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ReadOnlyModeTest </h4><pre class="type-2 type-6 type-15 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests a situation when client firstly connects to a read-only server and
 * then connects to a majority server. Transition should be transparent for
 * the user.
 */
@Test(timeout=90000) public void testSessionEstablishment() throws Exception {
  qu.shutdown(2);
  CountdownWatcher watcher=new CountdownWatcher();
  ZooKeeper zk=new ZooKeeper(qu.getConnString(),CONNECTION_TIMEOUT,watcher,true);
  watcher.waitForConnected(CONNECTION_TIMEOUT);
  Assert.assertSame("should be in r/o mode",States.CONNECTEDREADONLY,zk.getState());
  long fakeId=zk.getSessionId();
  watcher.reset();
  qu.start(2);
  Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + qu.getPeer(2).clientPort,CONNECTION_TIMEOUT));
  watcher.waitForConnected(CONNECTION_TIMEOUT);
  zk.create("/test","test".getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertFalse("fake session and real session have same id",zk.getSessionId() == fakeId);
  zk.close();
}

</code></pre>

<br>
<pre class="type-3 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test write operations using multi request.
 */
@Test(timeout=90000) public void testMultiTransaction() throws Exception {
  CountdownWatcher watcher=new CountdownWatcher();
  ZooKeeper zk=new ZooKeeper(qu.getConnString(),CONNECTION_TIMEOUT,watcher,true);
  watcher.waitForConnected(CONNECTION_TIMEOUT);
  final String data="Data to be read in RO mode";
  final String node1="/tnode1";
  final String node2="/tnode2";
  zk.create(node1,data.getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  watcher.reset();
  qu.shutdown(2);
  watcher.waitForConnected(CONNECTION_TIMEOUT);
  Assert.assertEquals("Should be in r-o mode",States.CONNECTEDREADONLY,zk.getState());
  String remoteData=new String(zk.getData(node1,false,null));
  Assert.assertEquals("Failed to read data in r-o mode",data,remoteData);
  try {
    Transaction transaction=zk.transaction();
    transaction.setData(node1,"no way".getBytes(),-1);
    transaction.create(node2,data.getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    transaction.commit();
    Assert.fail("Write operation using multi-transaction" + " api has succeeded during RO mode");
  }
 catch (  NotReadOnlyException e) {
  }
  Assert.assertNull("Should have created the znode:" + node2,zk.exists(node2,false));
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Basic test of read-only client functionality. Tries to read and write
 * during read-only mode, then regains a quorum and tries to write again.
 */
@Test(timeout=90000) public void testReadOnlyClient() throws Exception {
  CountdownWatcher watcher=new CountdownWatcher();
  ZooKeeper zk=new ZooKeeper(qu.getConnString(),CONNECTION_TIMEOUT,watcher,true);
  watcher.waitForConnected(CONNECTION_TIMEOUT);
  final String data="Data to be read in RO mode";
  final String node="/tnode";
  zk.create(node,data.getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  watcher.reset();
  qu.shutdown(2);
  zk.close();
  zk=new ZooKeeper(qu.getConnString(),CONNECTION_TIMEOUT,watcher,true);
  watcher.waitForConnected(CONNECTION_TIMEOUT);
  String remoteData=new String(zk.getData(node,false,null));
  Assert.assertEquals(data,remoteData);
  try {
    zk.setData(node,"no way".getBytes(),-1);
    Assert.fail("Write operation has succeeded during RO mode");
  }
 catch (  NotReadOnlyException e) {
  }
  watcher.reset();
  qu.start(2);
  Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + qu.getPeer(2).clientPort,CONNECTION_TIMEOUT));
  zk.close();
  watcher.reset();
  zk=new ZooKeeper(qu.getConnString(),CONNECTION_TIMEOUT,watcher,true);
  watcher.waitForConnected(CONNECTION_TIMEOUT);
  zk.setData(node,"We're in the quorum now".getBytes(),-1);
  zk.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ReconfigTest </h4><pre class="type-9 type-5 type-10 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testRoleChange() throws Exception {
  qu=new QuorumUtil(1);
  qu.disableJMXTest=true;
  qu.startAll();
  ZooKeeper[] zkArr=createHandles(qu);
  List<String> joiningServers=new ArrayList<String>();
  int leaderIndex=getLeaderId(qu);
  int changingIndex=(leaderIndex == 1) ? 2 : 1;
  String newRole="observer";
  for (int i=0; i < 4; i++) {
    ZooKeeper zk1=(changingIndex == leaderIndex) ? zkArr[leaderIndex] : zkArr[(leaderIndex % qu.ALL) + 1];
    joiningServers.add("server." + changingIndex + "=localhost:"+ qu.getPeer(changingIndex).peer.getQuorumAddress().getPort()+ ":"+ qu.getPeer(changingIndex).peer.getElectionAddress().getPort()+ ":"+ newRole+ ";localhost:"+ qu.getPeer(changingIndex).peer.getClientPort());
    reconfig(zk1,joiningServers,null,null,-1);
    testNormalOperation(zkArr[changingIndex],zk1);
    if (newRole.equals("observer")) {
      Assert.assertTrue(qu.getPeer(changingIndex).peer.observer != null && qu.getPeer(changingIndex).peer.follower == null && qu.getPeer(changingIndex).peer.leader == null);
      Assert.assertTrue(qu.getPeer(changingIndex).peer.getPeerState() == ServerState.OBSERVING);
    }
 else {
      Assert.assertTrue(qu.getPeer(changingIndex).peer.observer == null && (qu.getPeer(changingIndex).peer.follower != null || qu.getPeer(changingIndex).peer.leader != null));
      Assert.assertTrue(qu.getPeer(changingIndex).peer.getPeerState() == ServerState.FOLLOWING || qu.getPeer(changingIndex).peer.getPeerState() == ServerState.LEADING);
    }
    joiningServers.clear();
    if (newRole.equals("observer")) {
      newRole="participant";
    }
 else {
      newRole="observer";
      leaderIndex=getLeaderId(qu);
      changingIndex=leaderIndex;
    }
  }
  closeAllHandles(zkArr);
}

</code></pre>

<br>
<pre class="type-5 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * 1. removes and adds back two servers (incl leader). One of the servers is added back as observer
 * 2. tests that reconfig fails if quorum of new config is not up
 * 3. tests that a server that's not up during reconfig learns the new config when it comes up
 * @throws Exception
 */
@Test public void testRemoveAddTwo() throws Exception {
  qu=new QuorumUtil(2);
  qu.disableJMXTest=true;
  qu.startAll();
  ZooKeeper[] zkArr=createHandles(qu);
  List<String> leavingServers=new ArrayList<String>();
  List<String> joiningServers=new ArrayList<String>();
  int leaderIndex=getLeaderId(qu);
  int leavingIndex1=leaderIndex;
  int leavingIndex2=(leaderIndex == 1) ? 2 : 1;
  int stayingIndex1=1, stayingIndex2=1, stayingIndex3=1;
  while (stayingIndex1 == leavingIndex1 || stayingIndex1 == leavingIndex2)   stayingIndex1++;
  while (stayingIndex2 == leavingIndex1 || stayingIndex2 == leavingIndex2 || stayingIndex2 == stayingIndex1)   stayingIndex2++;
  while (stayingIndex3 == leavingIndex1 || stayingIndex3 == leavingIndex2 || stayingIndex3 == stayingIndex1 || stayingIndex3 == stayingIndex2)   stayingIndex3++;
  leavingServers.add(Integer.toString(leavingIndex1));
  leavingServers.add(Integer.toString(leavingIndex2));
  joiningServers.add("server." + leavingIndex1 + "=localhost:"+ qu.getPeer(leavingIndex1).peer.getQuorumAddress().getPort()+ ":"+ qu.getPeer(leavingIndex1).peer.getElectionAddress().getPort()+ ":participant;localhost:"+ qu.getPeer(leavingIndex1).peer.getClientPort());
  joiningServers.add("server." + leavingIndex2 + "=localhost:"+ qu.getPeer(leavingIndex2).peer.getQuorumAddress().getPort()+ ":"+ qu.getPeer(leavingIndex2).peer.getElectionAddress().getPort()+ ":observer;localhost:"+ qu.getPeer(leavingIndex2).peer.getClientPort());
  qu.shutdown(leavingIndex1);
  qu.shutdown(leavingIndex2);
  reconfig(zkArr[stayingIndex2],null,leavingServers,null,-1);
  qu.shutdown(stayingIndex2);
  testServerHasConfig(zkArr[stayingIndex1],null,leavingServers);
  testServerHasConfig(zkArr[stayingIndex3],null,leavingServers);
  testNormalOperation(zkArr[stayingIndex1],zkArr[stayingIndex3]);
  Thread.sleep(10000);
  try {
    reconfig(zkArr[stayingIndex1],joiningServers,null,null,-1);
    Assert.fail("reconfig completed successfully even though there is no quorum up in new config!");
  }
 catch (  KeeperException.NewConfigNoQuorum e) {
  }
  qu.restart(stayingIndex2);
  reconfig(zkArr[stayingIndex1],joiningServers,null,null,-1);
  testNormalOperation(zkArr[stayingIndex2],zkArr[stayingIndex3]);
  testServerHasConfig(zkArr[stayingIndex2],joiningServers,null);
  qu.restart(leavingIndex2);
  Assert.assertTrue(qu.getPeer(leavingIndex2).peer.getPeerState() == ServerState.OBSERVING);
  testNormalOperation(zkArr[stayingIndex2],zkArr[leavingIndex2]);
  testServerHasConfig(zkArr[leavingIndex2],joiningServers,null);
  closeAllHandles(zkArr);
}

</code></pre>

<br>
<pre class="type-9 type-5 type-3 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPortChange() throws Exception {
  qu=new QuorumUtil(1);
  qu.disableJMXTest=true;
  qu.startAll();
  ZooKeeper[] zkArr=createHandles(qu);
  List<String> joiningServers=new ArrayList<String>();
  int leaderIndex=getLeaderId(qu);
  int followerIndex=leaderIndex == 1 ? 2 : 1;
  int quorumPort=qu.getPeer(followerIndex).peer.getQuorumAddress().getPort();
  int electionPort=qu.getPeer(followerIndex).peer.getElectionAddress().getPort();
  int oldClientPort=qu.getPeer(followerIndex).peer.getClientPort();
  int newClientPort=PortAssignment.unique();
  joiningServers.add("server." + followerIndex + "=localhost:"+ quorumPort+ ":"+ electionPort+ ":participant;localhost:"+ newClientPort);
  testNormalOperation(zkArr[followerIndex],zkArr[leaderIndex]);
  reconfig(zkArr[followerIndex],joiningServers,null,null,-1);
  try {
    for (int i=0; i < 20; i++) {
      Thread.sleep(1000);
      zkArr[followerIndex].setData("/test","teststr".getBytes(),-1);
    }
  }
 catch (  KeeperException.ConnectionLossException e) {
    Assert.fail("Existing client disconnected when client port changed!");
  }
  zkArr[followerIndex].close();
  zkArr[followerIndex]=new ZooKeeper("127.0.0.1:" + oldClientPort,ClientBase.CONNECTION_TIMEOUT,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  for (int i=0; i < 10; i++) {
    try {
      Thread.sleep(1000);
      zkArr[followerIndex].setData("/test","teststr".getBytes(),-1);
      Assert.fail("New client connected to old client port!");
    }
 catch (    KeeperException.ConnectionLossException e) {
    }
  }
  zkArr[followerIndex].close();
  zkArr[followerIndex]=new ZooKeeper("127.0.0.1:" + newClientPort,ClientBase.CONNECTION_TIMEOUT,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  testNormalOperation(zkArr[followerIndex],zkArr[leaderIndex]);
  testServerHasConfig(zkArr[followerIndex],joiningServers,null);
  Assert.assertEquals(newClientPort,qu.getPeer(followerIndex).peer.getClientPort());
  joiningServers.clear();
  int newQuorumPort=PortAssignment.unique();
  joiningServers.add("server." + leaderIndex + "=localhost:"+ newQuorumPort+ ":"+ qu.getPeer(leaderIndex).peer.getElectionAddress().getPort()+ ":participant;localhost:"+ qu.getPeer(leaderIndex).peer.getClientPort());
  reconfig(zkArr[leaderIndex],joiningServers,null,null,-1);
  testNormalOperation(zkArr[followerIndex],zkArr[leaderIndex]);
  Assert.assertTrue(qu.getPeer(leaderIndex).peer.getQuorumAddress().getPort() == newQuorumPort);
  Assert.assertTrue(getLeaderId(qu) != leaderIndex);
  joiningServers.clear();
  for (int i=1; i <= 3; i++) {
    joiningServers.add("server." + i + "=localhost:"+ qu.getPeer(i).peer.getQuorumAddress().getPort()+ ":"+ PortAssignment.unique()+ ":participant;localhost:"+ qu.getPeer(i).peer.getClientPort());
  }
  reconfig(zkArr[1],joiningServers,null,null,-1);
  leaderIndex=getLeaderId(qu);
  int follower1=leaderIndex == 1 ? 2 : 1;
  int follower2=1;
  while (follower2 == leaderIndex || follower2 == follower1)   follower2++;
  qu.shutdown(getLeaderId(qu));
  testNormalOperation(zkArr[follower2],zkArr[follower1]);
  testServerHasConfig(zkArr[follower1],joiningServers,null);
  testServerHasConfig(zkArr[follower2],joiningServers,null);
  closeAllHandles(zkArr);
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testInitialConfigHasPositiveVersion() throws Exception {
  qu=new QuorumUtil(1);
  qu.disableJMXTest=true;
  qu.startAll();
  ZooKeeper[] zkArr=createHandles(qu);
  testNormalOperation(zkArr[1],zkArr[2]);
  for (int i=1; i < 4; i++) {
    String configStr=testServerHasConfig(zkArr[i],null,null);
    QuorumVerifier qv=qu.getPeer(i).peer.configFromString(configStr);
    long version=qv.getVersion();
    Assert.assertTrue(version == 0x100000000L);
  }
}

</code></pre>

<br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Tests verifies the jmx attributes of local and remote peer bean - change
 * participant to observer role
 */
@Test public void testJMXBeanAfterRoleChange() throws Exception {
  qu=new QuorumUtil(1);
  qu.disableJMXTest=true;
  qu.startAll();
  ZooKeeper[] zkArr=createHandles(qu);
  List<String> joiningServers=new ArrayList<String>();
  int changingIndex=1;
  int replica2=2;
  QuorumPeer peer2=qu.getPeer(replica2).peer;
  QuorumServer changingQS2=peer2.getView().get(new Long(changingIndex));
  String remotePeerBean2=CommonNames.DOMAIN + ":name0=ReplicatedServer_id" + replica2+ ",name1=replica."+ changingIndex;
  assertRemotePeerMXBeanAttributes(changingQS2,remotePeerBean2);
  int replica3=3;
  QuorumPeer peer3=qu.getPeer(replica3).peer;
  QuorumServer changingQS3=peer3.getView().get(new Long(changingIndex));
  String remotePeerBean3=CommonNames.DOMAIN + ":name0=ReplicatedServer_id" + replica3+ ",name1=replica."+ changingIndex;
  assertRemotePeerMXBeanAttributes(changingQS3,remotePeerBean3);
  String newRole="observer";
  ZooKeeper zk=zkArr[changingIndex];
  joiningServers.add("server." + changingIndex + "=127.0.0.1:"+ qu.getPeer(changingIndex).peer.getQuorumAddress().getPort()+ ":"+ qu.getPeer(changingIndex).peer.getElectionAddress().getPort()+ ":"+ newRole+ ";127.0.0.1:"+ qu.getPeer(changingIndex).peer.getClientPort());
  reconfig(zk,joiningServers,null,null,-1);
  testNormalOperation(zkArr[changingIndex],zk);
  Assert.assertTrue(qu.getPeer(changingIndex).peer.observer != null && qu.getPeer(changingIndex).peer.follower == null && qu.getPeer(changingIndex).peer.leader == null);
  Assert.assertTrue(qu.getPeer(changingIndex).peer.getPeerState() == ServerState.OBSERVING);
  QuorumPeer qp=qu.getPeer(changingIndex).peer;
  String localPeerBeanName=CommonNames.DOMAIN + ":name0=ReplicatedServer_id" + changingIndex+ ",name1=replica."+ changingIndex;
  assertLocalPeerMXBeanAttributes(qp,localPeerBeanName,true);
  changingQS2=peer2.getView().get(new Long(changingIndex));
  assertRemotePeerMXBeanAttributes(changingQS2,remotePeerBean2);
  changingQS3=peer3.getView().get(new Long(changingIndex));
  assertRemotePeerMXBeanAttributes(changingQS3,remotePeerBean3);
  closeAllHandles(zkArr);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.RecoveryTest </h4><pre class="type-9 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify that if a server goes down that clients will reconnect
 * automatically after the server is restarted. Note that this requires the
 * server to restart within the connection timeout period.
 * Also note that the client latches are used to eliminate any chance
 * of spurrious connectionloss exceptions on the read ops. Specifically
 * a sync operation will throw this exception if the server goes down
 * (as recognized by the client) during the operation. If the operation
 * occurs after the server is down, but before the client recognizes
 * that the server is down (ping) then the op will throw connectionloss.
 */
@Test public void testRecovery() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  int oldSnapCount=SyncRequestProcessor.getSnapCount();
  SyncRequestProcessor.setSnapCount(1000);
  try {
    final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
    ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
    f.startup(zks);
    LOG.info("starting up the the server, waiting");
    Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
    startSignal=new CountDownLatch(1);
    ZooKeeper zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
    startSignal.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS);
    Assert.assertTrue("count == 0",startSignal.getCount() == 0);
    String path;
    LOG.info("starting creating nodes");
    for (int i=0; i < 10; i++) {
      path="/" + i;
      zk.create(path,(path + "!").getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
      for (int j=0; j < 10; j++) {
        String subpath=path + "/" + j;
        zk.create(subpath,(subpath + "!").getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
        for (int k=0; k < 20; k++) {
          String subsubpath=subpath + "/" + k;
          zk.create(subsubpath,(subsubpath + "!").getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
        }
      }
    }
    f.shutdown();
    zks.shutdown();
    Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
    zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
    f=ServerCnxnFactory.createFactory(PORT,-1);
    startSignal=new CountDownLatch(1);
    f.startup(zks);
    Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
    startSignal.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS);
    Assert.assertTrue("count == 0",startSignal.getCount() == 0);
    Stat stat=new Stat();
    for (int i=0; i < 10; i++) {
      path="/" + i;
      LOG.info("Checking " + path);
      Assert.assertEquals(new String(zk.getData(path,false,stat)),path + "!");
      for (int j=0; j < 10; j++) {
        String subpath=path + "/" + j;
        Assert.assertEquals(new String(zk.getData(subpath,false,stat)),subpath + "!");
        for (int k=0; k < 20; k++) {
          String subsubpath=subpath + "/" + k;
          Assert.assertEquals(new String(zk.getData(subsubpath,false,stat)),subsubpath + "!");
        }
      }
    }
    f.shutdown();
    zks.shutdown();
    Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown(HOSTPORT,ClientBase.CONNECTION_TIMEOUT));
    zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
    f=ServerCnxnFactory.createFactory(PORT,-1);
    startSignal=new CountDownLatch(1);
    f.startup(zks);
    Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
    startSignal.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS);
    Assert.assertTrue("count == 0",startSignal.getCount() == 0);
    stat=new Stat();
    LOG.info("Check 2");
    for (int i=0; i < 10; i++) {
      path="/" + i;
      Assert.assertEquals(new String(zk.getData(path,false,stat)),path + "!");
      for (int j=0; j < 10; j++) {
        String subpath=path + "/" + j;
        Assert.assertEquals(new String(zk.getData(subpath,false,stat)),subpath + "!");
        for (int k=0; k < 20; k++) {
          String subsubpath=subpath + "/" + k;
          Assert.assertEquals(new String(zk.getData(subsubpath,false,stat)),subsubpath + "!");
        }
      }
    }
    zk.close();
    f.shutdown();
    zks.shutdown();
    Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
  }
  finally {
    SyncRequestProcessor.setSnapCount(oldSnapCount);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.RepeatStartupTest </h4><pre class="type-5 type-2 type-6 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies values related to public fields.
"></span><br>
/** 
 * bring up 5 quorum peers and then shut them down
 * and then bring one of the nodes as server
 * @throws Exception might be thrown here
 */
@Test public void testFail() throws Exception {
  QuorumBase qb=new QuorumBase();
  qb.setUp();
  System.out.println("Comment: the servers are at " + qb.hostPort);
  ZooKeeper zk=qb.createClient();
  zk.create("/test",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.close();
  QuorumBase.shutdown(qb.s1);
  QuorumBase.shutdown(qb.s2);
  QuorumBase.shutdown(qb.s3);
  QuorumBase.shutdown(qb.s4);
  QuorumBase.shutdown(qb.s5);
  String hp=qb.hostPort.split(",")[0];
  ZooKeeperServer zks=new ZooKeeperServer(qb.s1.getTxnFactory().getSnapDir(),qb.s1.getTxnFactory().getDataDir(),3000);
  final int PORT=Integer.parseInt(hp.split(":")[1]);
  ServerCnxnFactory factory=ServerCnxnFactory.createFactory(PORT,-1);
  factory.startup(zks);
  System.out.println("Comment: starting factory");
  Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + PORT,QuorumTest.CONNECTION_TIMEOUT));
  factory.shutdown();
  zks.shutdown();
  Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown("127.0.0.1:" + PORT,QuorumTest.CONNECTION_TIMEOUT));
  System.out.println("Comment: shutting down standalone");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.RestoreCommittedLogTest </h4><pre class="type-5 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * test the purge
 * @throws Exception an exception might be thrown here
 */
@Test public void testRestoreCommittedLog() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(100);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
  try {
    for (int i=0; i < 2000; i++) {
      zk.create("/invalidsnap-" + i,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    }
  }
  finally {
    zk.close();
  }
  f.shutdown();
  zks.shutdown();
  Assert.assertTrue("waiting for server to shutdown",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
  zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  zks.startdata();
  List<Proposal> committedLog=zks.getZKDatabase().getCommittedLog();
  int logsize=committedLog.size();
  LOG.info("committedLog size = {}",logsize);
  Assert.assertTrue("log size != 0",(logsize != 0));
  zks.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.SaslAuthDesignatedClientTest </h4><pre class="type-3 type-2 type-6 type-15 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSaslConfig() throws Exception {
  ZooKeeper zk=createClient();
  try {
    zk.getChildren("/",false);
    Assert.assertFalse(zk.getSaslClient().clientTunneledAuthenticationInProgress());
    Assert.assertEquals(zk.getSaslClient().getSaslState(),ZooKeeperSaslClient.SaslState.COMPLETE);
    Assert.assertNotNull(javax.security.auth.login.Configuration.getConfiguration().getAppConfigurationEntry("MyZookeeperClient"));
    Assert.assertSame(zk.getSaslClient().getLoginContext(),"MyZookeeperClient");
  }
 catch (  KeeperException e) {
    Assert.fail("test failed :" + e);
  }
 finally {
    zk.close();
  }
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReadAccessUser() throws Exception {
  System.setProperty("zookeeper.letAnySaslUserDoX","anyone");
  ZooKeeper zk=createClient();
  List<ACL> aclList=new ArrayList<ACL>();
  ACL acl=new ACL(Perms.ADMIN | Perms.CREATE | Perms.WRITE| Perms.DELETE,new Id("sasl","fakeuser"));
  ACL acl1=new ACL(Perms.READ,new Id("sasl","anyone"));
  aclList.add(acl);
  aclList.add(acl1);
  try {
    zk.create("/abc","testData".getBytes(),aclList,CreateMode.PERSISTENT);
  }
 catch (  KeeperException e) {
    Assert.fail("Unable to create znode");
  }
  zk.close();
  Thread.sleep(100);
  zk=createClient();
  try {
    zk.setData("/abc","testData1".getBytes(),-1);
    Assert.fail("Should not be able to set data");
  }
 catch (  KeeperException.NoAuthException e) {
  }
  try {
    byte[] bytedata=zk.getData("/abc",null,null);
    String data=new String(bytedata);
    Assert.assertTrue("testData".equals(data));
  }
 catch (  KeeperException e) {
    Assert.fail("failed to get data");
  }
  zk.close();
  Thread.sleep(100);
  System.setProperty(ZooKeeperSaslClient.ENABLE_CLIENT_SASL_KEY,"false");
  try {
    zk=createClient();
    try {
      zk.getData("/abc",null,null);
      Assert.fail("Should not be able to read data when not authenticated");
    }
 catch (    KeeperException.NoAuthException e) {
    }
    zk.close();
  }
  finally {
    System.setProperty(ZooKeeperSaslClient.ENABLE_CLIENT_SASL_KEY,"true");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.SessionTest </h4><pre class="type-5 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Make sure ephemerals get cleaned up when a session times out.
 */
@SuppressWarnings("deprecation") @Test public void testSessionTimeout() throws Exception {
  final int TIMEOUT=5000;
  List<Thread> etBefore=findThreads("EventThread");
  List<Thread> stBefore=findThreads("SendThread");
  DisconnectableZooKeeper zk=createClient(TIMEOUT);
  zk.create("/stest",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  List<Thread> etAfter=findThreads("EventThread");
  List<Thread> stAfter=findThreads("SendThread");
  Thread eventThread=null;
  Thread sendThread=null;
  for (  Thread t : etAfter) {
    if (!etBefore.contains(t)) {
      eventThread=t;
      break;
    }
  }
  for (  Thread t : stAfter) {
    if (!stBefore.contains(t)) {
      sendThread=t;
      break;
    }
  }
  sendThread.suspend();
  Thread.sleep(TIMEOUT * 2);
  sendThread.resume();
  eventThread.join(TIMEOUT);
  Assert.assertFalse("EventThread is still running",eventThread.isAlive());
  zk=createClient(TIMEOUT);
  zk.create("/stest",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  tearDown();
  zk.close();
  zk.disconnect();
  setUp();
  zk=createClient(TIMEOUT);
  Assert.assertTrue(zk.exists("/stest",false) != null);
  Thread.sleep(TIMEOUT * 2);
  Assert.assertTrue(zk.exists("/stest",false) == null);
  zk.close();
}

</code></pre>

<br>
<pre class="type-9 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Make sure that we cannot have two connections with the same
 * session id.
 * @throws IOException
 * @throws InterruptedException
 * @throws KeeperException
 */
@Test public void testSessionMove() throws Exception {
  String hostPorts[]=HOSTPORT.split(",");
  DisconnectableZooKeeper zk=new DisconnectableZooKeeper(hostPorts[0],CONNECTION_TIMEOUT,new MyWatcher("0"));
  zk.create("/sessionMoveTest",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  for (int i=0; i < hostPorts.length * 2; i++) {
    zk.dontReconnect();
    DisconnectableZooKeeper zknew=new DisconnectableZooKeeper(hostPorts[(i + 1) % hostPorts.length],CONNECTION_TIMEOUT,new MyWatcher(Integer.toString(i + 1)),zk.getSessionId(),zk.getSessionPasswd());
    final int result[]=new int[1];
    result[0]=Integer.MAX_VALUE;
    zknew.sync("/",new AsyncCallback.VoidCallback(){
      public void processResult(      int rc,      String path,      Object ctx){
synchronized (result) {
          result[0]=rc;
          result.notify();
        }
      }
    }
,null);
synchronized (result) {
      if (result[0] == Integer.MAX_VALUE) {
        result.wait(5000);
      }
    }
    LOG.info(hostPorts[(i + 1) % hostPorts.length] + " Sync returned " + result[0]);
    Assert.assertTrue(result[0] == KeeperException.Code.OK.intValue());
    zknew.setData("/",new byte[1],-1);
    try {
      zk.setData("/",new byte[1],-1);
      Assert.fail("Should have lost the connection");
    }
 catch (    KeeperException.ConnectionLossException e) {
      LOG.info("Got connection loss exception as expected");
    }
    zk=zknew;
  }
  zk.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.StatTest </h4><pre class="type-6 type-15 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDataSizeChange() throws IOException, KeeperException, InterruptedException {
  String name="/foo";
  zk.create(name,name.getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Stat stat;
  stat=newStat();
  zk.getData(name,false,stat);
  Assert.assertEquals(stat.getCzxid(),stat.getMzxid());
  Assert.assertEquals(stat.getCzxid(),stat.getPzxid());
  Assert.assertEquals(stat.getCtime(),stat.getMtime());
  Assert.assertEquals(0,stat.getCversion());
  Assert.assertEquals(0,stat.getVersion());
  Assert.assertEquals(0,stat.getAversion());
  Assert.assertEquals(0,stat.getEphemeralOwner());
  Assert.assertEquals(name.length(),stat.getDataLength());
  Assert.assertEquals(0,stat.getNumChildren());
  zk.setData(name,(name + name).getBytes(),-1);
  stat=newStat();
  zk.getData(name,false,stat);
  Assert.assertNotSame(stat.getCzxid(),stat.getMzxid());
  Assert.assertEquals(stat.getCzxid(),stat.getPzxid());
  Assert.assertNotSame(stat.getCtime(),stat.getMtime());
  Assert.assertEquals(0,stat.getCversion());
  Assert.assertEquals(1,stat.getVersion());
  Assert.assertEquals(0,stat.getAversion());
  Assert.assertEquals(0,stat.getEphemeralOwner());
  Assert.assertEquals(name.length() * 2,stat.getDataLength());
  Assert.assertEquals(0,stat.getNumChildren());
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testChild() throws IOException, KeeperException, InterruptedException {
  String name="/foo";
  zk.create(name,name.getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  String childname=name + "/bar";
  zk.create(childname,childname.getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  Stat stat;
  stat=newStat();
  zk.getData(name,false,stat);
  Assert.assertEquals(stat.getCzxid(),stat.getMzxid());
  Assert.assertEquals(stat.getCzxid() + 1,stat.getPzxid());
  Assert.assertEquals(stat.getCtime(),stat.getMtime());
  Assert.assertEquals(1,stat.getCversion());
  Assert.assertEquals(0,stat.getVersion());
  Assert.assertEquals(0,stat.getAversion());
  Assert.assertEquals(0,stat.getEphemeralOwner());
  Assert.assertEquals(name.length(),stat.getDataLength());
  Assert.assertEquals(1,stat.getNumChildren());
  stat=newStat();
  zk.getData(childname,false,stat);
  Assert.assertEquals(stat.getCzxid(),stat.getMzxid());
  Assert.assertEquals(stat.getCzxid(),stat.getPzxid());
  Assert.assertEquals(stat.getCtime(),stat.getMtime());
  Assert.assertEquals(0,stat.getCversion());
  Assert.assertEquals(0,stat.getVersion());
  Assert.assertEquals(0,stat.getAversion());
  Assert.assertEquals(zk.getSessionId(),stat.getEphemeralOwner());
  Assert.assertEquals(childname.length(),stat.getDataLength());
  Assert.assertEquals(0,stat.getNumChildren());
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testBasic() throws IOException, KeeperException, InterruptedException {
  String name="/foo";
  zk.create(name,name.getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Stat stat;
  stat=newStat();
  zk.getData(name,false,stat);
  Assert.assertEquals(stat.getCzxid(),stat.getMzxid());
  Assert.assertEquals(stat.getCzxid(),stat.getPzxid());
  Assert.assertEquals(stat.getCtime(),stat.getMtime());
  Assert.assertEquals(0,stat.getCversion());
  Assert.assertEquals(0,stat.getVersion());
  Assert.assertEquals(0,stat.getAversion());
  Assert.assertEquals(0,stat.getEphemeralOwner());
  Assert.assertEquals(name.length(),stat.getDataLength());
  Assert.assertEquals(0,stat.getNumChildren());
}

</code></pre>

<br>
<pre class="type-9 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testChildren() throws IOException, KeeperException, InterruptedException {
  String name="/foo";
  zk.create(name,name.getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  for (int i=0; i < 10; i++) {
    String childname=name + "/bar" + i;
    zk.create(childname,childname.getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
    Stat stat;
    stat=newStat();
    zk.getData(name,false,stat);
    Assert.assertEquals(stat.getCzxid(),stat.getMzxid());
    Assert.assertEquals(stat.getCzxid() + i + 1,stat.getPzxid());
    Assert.assertEquals(stat.getCtime(),stat.getMtime());
    Assert.assertEquals(i + 1,stat.getCversion());
    Assert.assertEquals(0,stat.getVersion());
    Assert.assertEquals(0,stat.getAversion());
    Assert.assertEquals(0,stat.getEphemeralOwner());
    Assert.assertEquals(name.length(),stat.getDataLength());
    Assert.assertEquals(i + 1,stat.getNumChildren());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.StaticHostProviderTest </h4><pre class="type-6 type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
"></span><br>
@Test public void testOnConnectDoesNotReset(){
  HostProvider hostProvider=getHostProvider((byte)2);
  InetSocketAddress first=hostProvider.next(0);
  hostProvider.onConnected();
  InetSocketAddress second=hostProvider.next(0);
  assertNotSame(first,second);
}

</code></pre>

<br>
<pre class="type-9 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpdateMigrationGoesRound() throws UnknownHostException {
  HostProvider hostProvider=getHostProvider((byte)4);
  Collection<InetSocketAddress> newList=new ArrayList<InetSocketAddress>(10);
  for (byte i=12; i > 2; i--) {
    newList.add(new InetSocketAddress(InetAddress.getByAddress(new byte[]{10,10,10,i}),1234 + i));
  }
  Collection<InetSocketAddress> oldStaying=new ArrayList<InetSocketAddress>(2);
  for (byte i=4; i > 2; i--) {
    oldStaying.add(new InetSocketAddress(InetAddress.getByAddress(new byte[]{10,10,10,i}),1234 + i));
  }
  Collection<InetSocketAddress> newComing=new ArrayList<InetSocketAddress>(10);
  for (byte i=12; i > 4; i--) {
    newComing.add(new InetSocketAddress(InetAddress.getByAddress(new byte[]{10,10,10,i}),1234 + i));
  }
  boolean disconnectRequired=hostProvider.updateServerList(newList,new InetSocketAddress(InetAddress.getByAddress(new byte[]{10,10,10,1}),1235));
  assertTrue(disconnectRequired);
  ArrayList<InetSocketAddress> seen=new ArrayList<InetSocketAddress>();
  for (int i=0; i < newComing.size(); i++) {
    InetSocketAddress addr=hostProvider.next(0);
    assertTrue(newComing.contains(addr));
    assertTrue(!seen.contains(addr));
    seen.add(addr);
  }
  seen.clear();
  for (int i=0; i < oldStaying.size(); i++) {
    InetSocketAddress addr=hostProvider.next(0);
    assertTrue(oldStaying.contains(addr));
    assertTrue(!seen.contains(addr));
    seen.add(addr);
  }
  InetSocketAddress first=hostProvider.next(0);
  assertTrue(first != null);
  for (int i=0; i < newList.size() - 1; i++) {
    hostProvider.next(0);
  }
  assertEquals(first,hostProvider.next(0));
  hostProvider.onConnected();
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testOneInvalidHostAddresses(){
  Collection<InetSocketAddress> addr=getServerAddresses((byte)1);
  addr.add(new InetSocketAddress("a...",2181));
  StaticHostProvider sp=new StaticHostProvider(addr);
  InetSocketAddress n1=sp.next(0);
  InetSocketAddress n2=sp.next(0);
  assertEquals(n2,n1);
}

</code></pre>

<br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testUpdateClientMigrateOrNot() throws UnknownHostException {
  HostProvider hostProvider=getHostProvider((byte)4);
  Collection<InetSocketAddress> newList=getServerAddresses((byte)3);
  InetSocketAddress myServer=new InetSocketAddress(InetAddress.getByAddress(new byte[]{10,10,10,3}),1237);
  boolean disconnectRequired=hostProvider.updateServerList(newList,myServer);
  assertTrue(!disconnectRequired);
  hostProvider.onConnected();
  disconnectRequired=hostProvider.updateServerList(newList,myServer);
  assertTrue(!disconnectRequired);
  hostProvider.onConnected();
  newList=getServerAddresses((byte)2);
  disconnectRequired=hostProvider.updateServerList(newList,myServer);
  assertTrue(disconnectRequired);
  hostProvider.onConnected();
  disconnectRequired=hostProvider.updateServerList(newList,myServer);
  assertTrue(disconnectRequired);
  hostProvider.onConnected();
  newList=new ArrayList<InetSocketAddress>(3);
  for (byte i=4; i > 1; i--) {
    newList.add(new InetSocketAddress(InetAddress.getByAddress(new byte[]{10,10,10,i}),1234 + i));
  }
  myServer=new InetSocketAddress(InetAddress.getByAddress(new byte[]{10,10,10,1}),1235);
  disconnectRequired=hostProvider.updateServerList(newList,myServer);
  assertTrue(disconnectRequired);
  hostProvider.onConnected();
  HostProvider[] hostProviderArray=new HostProvider[numClients];
  newList=getServerAddresses((byte)10);
  int numDisconnects=0;
  for (int i=0; i < numClients; i++) {
    hostProviderArray[i]=getHostProvider((byte)9);
    disconnectRequired=hostProviderArray[i].updateServerList(newList,myServer);
    if (disconnectRequired)     numDisconnects++;
  }
  hostProvider.onConnected();
  assertTrue(numDisconnects < upperboundCPS(numClients,10));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNextGoesRound(){
  HostProvider hostProvider=getHostProvider((byte)2);
  InetSocketAddress first=hostProvider.next(0);
  assertTrue(first != null);
  hostProvider.next(0);
  assertEquals(first,hostProvider.next(0));
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testLiteralIPNoReverseNS() throws Exception {
  byte size=30;
  HostProvider hostProvider=getHostProviderUnresolved(size);
  for (int i=0; i < size; i++) {
    InetSocketAddress next=hostProvider.next(0);
    assertTrue(next instanceof InetSocketAddress);
    assertTrue(!next.isUnresolved());
    assertTrue(!next.toString().startsWith("/"));
    String hostname=next.getHostString();
    hostname.equals(next.getAddress().getHostAddress());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.TruncateTest </h4><pre class="type-9 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTruncationNullLog() throws Exception {
  File tmpdir=ClientBase.createTmpDir();
  FileTxnSnapLog snaplog=new FileTxnSnapLog(tmpdir,tmpdir);
  ZKDatabase zkdb=new ZKDatabase(snaplog);
  for (int i=1; i <= 100; i++) {
    append(zkdb,i);
  }
  zkdb.close();
  File[] logs=snaplog.getDataDir().listFiles();
  for (int i=0; i < logs.length; i++) {
    LOG.debug("Deleting: {}",logs[i].getName());
    Assert.assertTrue("Failed to delete log file: " + logs[i].getName(),logs[i].delete());
  }
  try {
    zkdb.truncateLog(1);
    Assert.assertTrue("Should not get here",false);
  }
 catch (  IOException e) {
    Assert.assertTrue("Should have received an IOException",true);
  }
catch (  NullPointerException npe) {
    Assert.fail("This should not throw NPE!");
  }
  ClientBase.recursiveDelete(tmpdir);
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTruncationStreamReset() throws Exception {
  File tmpdir=ClientBase.createTmpDir();
  FileTxnSnapLog snaplog=new FileTxnSnapLog(tmpdir,tmpdir);
  ZKDatabase zkdb=new ZKDatabase(snaplog);
  for (int i=1; i <= 100; i++) {
    append(zkdb,i);
  }
  zkdb.truncateLog(1);
  append(zkdb,200);
  zkdb.close();
  FileTxnLog txnlog=new FileTxnLog(new File(tmpdir,"version-2"));
  TxnIterator iter=txnlog.read(1);
  TxnHeader hdr=iter.getHeader();
  Record txn=iter.getTxn();
  Assert.assertEquals(1,hdr.getZxid());
  Assert.assertTrue(txn instanceof SetDataTxn);
  iter.next();
  hdr=iter.getHeader();
  txn=iter.getTxn();
  Assert.assertEquals(200,hdr.getZxid());
  Assert.assertTrue(txn instanceof SetDataTxn);
  iter.close();
  ClientBase.recursiveDelete(tmpdir);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.WatchedEventTest </h4><pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testConvertingToEventWrapper(){
  WatchedEvent we=new WatchedEvent(EventType.NodeCreated,KeeperState.Expired,"blah");
  WatcherEvent wew=we.getWrapper();
  Assert.assertEquals(EventType.NodeCreated.getIntValue(),wew.getType());
  Assert.assertEquals(KeeperState.Expired.getIntValue(),wew.getState());
  Assert.assertEquals("blah",wew.getPath());
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCreatingWatchedEventFromWrapper(){
  EnumSet<EventType> allTypes=EnumSet.allOf(EventType.class);
  EnumSet<KeeperState> allStates=EnumSet.allOf(KeeperState.class);
  WatchedEvent we;
  WatcherEvent wep;
  for (  EventType et : allTypes) {
    for (    KeeperState ks : allStates) {
      wep=new WatcherEvent(et.getIntValue(),ks.getIntValue(),"blah");
      we=new WatchedEvent(wep);
      Assert.assertEquals(et,we.getType());
      Assert.assertEquals(ks,we.getState());
      Assert.assertEquals("blah",we.getPath());
    }
  }
}

</code></pre>

<br>
<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCreatingWatchedEvent(){
  EnumSet<EventType> allTypes=EnumSet.allOf(EventType.class);
  EnumSet<KeeperState> allStates=EnumSet.allOf(KeeperState.class);
  WatchedEvent we;
  for (  EventType et : allTypes) {
    for (    KeeperState ks : allStates) {
      we=new WatchedEvent(et,ks,"blah");
      Assert.assertEquals(et,we.getType());
      Assert.assertEquals(ks,we.getState());
      Assert.assertEquals("blah",we.getPath());
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.WatcherFuncTest </h4><pre class="type-3 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetDataSync() throws IOException, InterruptedException, KeeperException {
  try {
    lsnr.getData("/foo",true,null);
    Assert.fail();
  }
 catch (  KeeperException e) {
    Assert.assertEquals(KeeperException.Code.NONODE,e.code());
    Assert.assertEquals("/foo",e.getPath());
  }
  try {
    lsnr.getData("/foo/bar",true,null);
    Assert.fail();
  }
 catch (  KeeperException e) {
    Assert.assertEquals(KeeperException.Code.NONODE,e.code());
    Assert.assertEquals("/foo/bar",e.getPath());
  }
  client.create("/foo","parent".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertNotNull(lsnr.getData("/foo",true,null));
  client.create("/foo/bar","child".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertNotNull(lsnr.getData("/foo/bar",true,null));
  client.setData("/foo","parent".getBytes(),-1);
  expected.add(EventType.NodeDataChanged);
  client.setData("/foo/bar","child".getBytes(),-1);
  expected.add(EventType.NodeDataChanged);
  verify();
  Assert.assertNotNull(lsnr.getData("/foo",true,null));
  Assert.assertNotNull(lsnr.getData("/foo/bar",true,null));
  client.delete("/foo/bar",-1);
  expected.add(EventType.NodeDeleted);
  client.delete("/foo",-1);
  expected.add(EventType.NodeDeleted);
  verify();
}

</code></pre>

<br>
<pre class="type-3 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetChildrenSync() throws IOException, InterruptedException, KeeperException {
  try {
    lsnr.getChildren("/foo",true);
    Assert.fail();
  }
 catch (  KeeperException e) {
    Assert.assertEquals(KeeperException.Code.NONODE,e.code());
    Assert.assertEquals("/foo",e.getPath());
  }
  try {
    lsnr.getChildren("/foo/bar",true);
    Assert.fail();
  }
 catch (  KeeperException e) {
    Assert.assertEquals(KeeperException.Code.NONODE,e.code());
    Assert.assertEquals("/foo/bar",e.getPath());
  }
  client.create("/foo","parent".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertNotNull(lsnr.getChildren("/foo",true));
  client.create("/foo/bar","child".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  expected.add(EventType.NodeChildrenChanged);
  Assert.assertNotNull(lsnr.getChildren("/foo/bar",true));
  client.setData("/foo","parent".getBytes(),-1);
  client.setData("/foo/bar","child".getBytes(),-1);
  Assert.assertNotNull(lsnr.exists("/foo",true));
  Assert.assertNotNull(lsnr.getChildren("/foo",true));
  Assert.assertNotNull(lsnr.getChildren("/foo/bar",true));
  client.delete("/foo/bar",-1);
  expected.add(EventType.NodeDeleted);
  expected.add(EventType.NodeChildrenChanged);
  client.delete("/foo",-1);
  expected.add(EventType.NodeDeleted);
  verify();
}

</code></pre>

<br>
<pre class="type-3 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetDataSyncWObj() throws IOException, InterruptedException, KeeperException {
  SimpleWatcher w1=new SimpleWatcher(null);
  SimpleWatcher w2=new SimpleWatcher(null);
  SimpleWatcher w3=new SimpleWatcher(null);
  SimpleWatcher w4=new SimpleWatcher(null);
  List<EventType> e2=new ArrayList<EventType>();
  try {
    lsnr.getData("/foo",w1,null);
    Assert.fail();
  }
 catch (  KeeperException e) {
    Assert.assertEquals(KeeperException.Code.NONODE,e.code());
    Assert.assertEquals("/foo",e.getPath());
  }
  try {
    lsnr.getData("/foo/bar",w2,null);
    Assert.fail();
  }
 catch (  KeeperException e) {
    Assert.assertEquals(KeeperException.Code.NONODE,e.code());
    Assert.assertEquals("/foo/bar",e.getPath());
  }
  client.create("/foo","parent".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertNotNull(lsnr.getData("/foo",true,null));
  Assert.assertNotNull(lsnr.getData("/foo",w1,null));
  client.create("/foo/bar","child".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertNotNull(lsnr.getData("/foo/bar",w2,null));
  Assert.assertNotNull(lsnr.getData("/foo/bar",w3,null));
  Assert.assertNotNull(lsnr.getData("/foo/bar",w4,null));
  Assert.assertNotNull(lsnr.getData("/foo/bar",w4,null));
  client.setData("/foo","parent".getBytes(),-1);
  expected.add(EventType.NodeDataChanged);
  client.setData("/foo/bar","child".getBytes(),-1);
  e2.add(EventType.NodeDataChanged);
  lsnr_dwatch.verify(expected);
  w1.verify(expected);
  w2.verify(e2);
  w3.verify(e2);
  w4.verify(e2);
  expected.clear();
  e2.clear();
  Assert.assertNotNull(lsnr.getData("/foo",true,null));
  Assert.assertNotNull(lsnr.getData("/foo",w1,null));
  Assert.assertNotNull(lsnr.getData("/foo/bar",w2,null));
  Assert.assertNotNull(lsnr.getData("/foo/bar",w3,null));
  Assert.assertNotNull(lsnr.getData("/foo/bar",w3,null));
  Assert.assertNotNull(lsnr.getData("/foo/bar",w4,null));
  client.delete("/foo/bar",-1);
  expected.add(EventType.NodeDeleted);
  client.delete("/foo",-1);
  e2.add(EventType.NodeDeleted);
  lsnr_dwatch.verify(expected);
  w1.verify(expected);
  w2.verify(e2);
  w3.verify(e2);
  w4.verify(e2);
  expected.clear();
  e2.clear();
}

</code></pre>

<br>
<pre class="type-3 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExistsSync() throws IOException, InterruptedException, KeeperException {
  Assert.assertNull(lsnr.exists("/foo",true));
  Assert.assertNull(lsnr.exists("/foo/bar",true));
  client.create("/foo","parent".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  expected.add(EventType.NodeCreated);
  client.create("/foo/bar","child".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  expected.add(EventType.NodeCreated);
  verify();
  Assert.assertNotNull(lsnr.exists("/foo",true));
  Assert.assertNotNull(lsnr.exists("/foo/bar",true));
  try {
    Assert.assertNull(lsnr.exists("/car",true));
    client.setData("/car","missing".getBytes(),-1);
    Assert.fail();
  }
 catch (  KeeperException e) {
    Assert.assertEquals(KeeperException.Code.NONODE,e.code());
    Assert.assertEquals("/car",e.getPath());
  }
  try {
    Assert.assertNull(lsnr.exists("/foo/car",true));
    client.setData("/foo/car","missing".getBytes(),-1);
    Assert.fail();
  }
 catch (  KeeperException e) {
    Assert.assertEquals(KeeperException.Code.NONODE,e.code());
    Assert.assertEquals("/foo/car",e.getPath());
  }
  client.setData("/foo","parent".getBytes(),-1);
  expected.add(EventType.NodeDataChanged);
  client.setData("/foo/bar","child".getBytes(),-1);
  expected.add(EventType.NodeDataChanged);
  verify();
  Assert.assertNotNull(lsnr.exists("/foo",true));
  Assert.assertNotNull(lsnr.exists("/foo/bar",true));
  client.delete("/foo/bar",-1);
  expected.add(EventType.NodeDeleted);
  client.delete("/foo",-1);
  expected.add(EventType.NodeDeleted);
  verify();
}

</code></pre>

<br>
<pre class="type-3 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetChildrenSyncWObj() throws IOException, InterruptedException, KeeperException {
  SimpleWatcher w1=new SimpleWatcher(null);
  SimpleWatcher w2=new SimpleWatcher(null);
  SimpleWatcher w3=new SimpleWatcher(null);
  SimpleWatcher w4=new SimpleWatcher(null);
  List<EventType> e2=new ArrayList<EventType>();
  try {
    lsnr.getChildren("/foo",true);
    Assert.fail();
  }
 catch (  KeeperException e) {
    Assert.assertEquals(KeeperException.Code.NONODE,e.code());
    Assert.assertEquals("/foo",e.getPath());
  }
  try {
    lsnr.getChildren("/foo/bar",true);
    Assert.fail();
  }
 catch (  KeeperException e) {
    Assert.assertEquals(KeeperException.Code.NONODE,e.code());
    Assert.assertEquals("/foo/bar",e.getPath());
  }
  client.create("/foo","parent".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertNotNull(lsnr.getChildren("/foo",true));
  Assert.assertNotNull(lsnr.getChildren("/foo",w1));
  client.create("/foo/bar","child".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  expected.add(EventType.NodeChildrenChanged);
  Assert.assertNotNull(lsnr.getChildren("/foo/bar",w2));
  Assert.assertNotNull(lsnr.getChildren("/foo/bar",w2));
  Assert.assertNotNull(lsnr.getChildren("/foo/bar",w3));
  Assert.assertNotNull(lsnr.getChildren("/foo/bar",w4));
  client.setData("/foo","parent".getBytes(),-1);
  client.setData("/foo/bar","child".getBytes(),-1);
  Assert.assertNotNull(lsnr.exists("/foo",true));
  Assert.assertNotNull(lsnr.exists("/foo",w1));
  Assert.assertNotNull(lsnr.exists("/foo",true));
  Assert.assertNotNull(lsnr.exists("/foo",w1));
  Assert.assertNotNull(lsnr.getChildren("/foo",true));
  Assert.assertNotNull(lsnr.getChildren("/foo",w1));
  Assert.assertNotNull(lsnr.getChildren("/foo/bar",w2));
  Assert.assertNotNull(lsnr.getChildren("/foo/bar",w3));
  Assert.assertNotNull(lsnr.getChildren("/foo/bar",w4));
  Assert.assertNotNull(lsnr.getChildren("/foo/bar",w4));
  client.delete("/foo/bar",-1);
  e2.add(EventType.NodeDeleted);
  expected.add(EventType.NodeChildrenChanged);
  client.delete("/foo",-1);
  expected.add(EventType.NodeDeleted);
  lsnr_dwatch.verify(expected);
  w1.verify(expected);
  w2.verify(e2);
  w3.verify(e2);
  w4.verify(e2);
  expected.clear();
  e2.clear();
}

</code></pre>

<br>
<pre class="type-6 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testExistsSyncWObj() throws IOException, InterruptedException, KeeperException {
  SimpleWatcher w1=new SimpleWatcher(null);
  SimpleWatcher w2=new SimpleWatcher(null);
  SimpleWatcher w3=new SimpleWatcher(null);
  SimpleWatcher w4=new SimpleWatcher(null);
  List<EventType> e2=new ArrayList<EventType>();
  Assert.assertNull(lsnr.exists("/foo",true));
  Assert.assertNull(lsnr.exists("/foo",w1));
  Assert.assertNull(lsnr.exists("/foo/bar",w2));
  Assert.assertNull(lsnr.exists("/foo/bar",w3));
  Assert.assertNull(lsnr.exists("/foo/bar",w3));
  Assert.assertNull(lsnr.exists("/foo/bar",w4));
  client.create("/foo","parent".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  expected.add(EventType.NodeCreated);
  client.create("/foo/bar","child".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  e2.add(EventType.NodeCreated);
  lsnr_dwatch.verify(expected);
  w1.verify(expected);
  w2.verify(e2);
  w3.verify(e2);
  w4.verify(e2);
  expected.clear();
  e2.clear();
  Assert.assertNotNull(lsnr.exists("/foo",w1));
  Assert.assertNotNull(lsnr.exists("/foo/bar",w2));
  Assert.assertNotNull(lsnr.exists("/foo/bar",w3));
  Assert.assertNotNull(lsnr.exists("/foo/bar",w4));
  Assert.assertNotNull(lsnr.exists("/foo/bar",w4));
  client.setData("/foo","parent".getBytes(),-1);
  expected.add(EventType.NodeDataChanged);
  client.setData("/foo/bar","child".getBytes(),-1);
  e2.add(EventType.NodeDataChanged);
  lsnr_dwatch.verify(new ArrayList<EventType>());
  w1.verify(expected);
  w2.verify(e2);
  w3.verify(e2);
  w4.verify(e2);
  expected.clear();
  e2.clear();
  Assert.assertNotNull(lsnr.exists("/foo",true));
  Assert.assertNotNull(lsnr.exists("/foo",w1));
  Assert.assertNotNull(lsnr.exists("/foo",w1));
  Assert.assertNotNull(lsnr.exists("/foo/bar",w2));
  Assert.assertNotNull(lsnr.exists("/foo/bar",w2));
  Assert.assertNotNull(lsnr.exists("/foo/bar",w3));
  Assert.assertNotNull(lsnr.exists("/foo/bar",w4));
  client.delete("/foo/bar",-1);
  expected.add(EventType.NodeDeleted);
  client.delete("/foo",-1);
  e2.add(EventType.NodeDeleted);
  lsnr_dwatch.verify(expected);
  w1.verify(expected);
  w2.verify(e2);
  w3.verify(e2);
  w4.verify(e2);
  expected.clear();
  e2.clear();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.WatcherTest </h4><pre class="type-9 type-6 type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
/** 
 * Verify that we get all of the events we expect to get. This particular
 * case verifies that we see all of the data events on a particular node.
 * There was a bug (ZOOKEEPER-137) that resulted in events being dropped
 * in some cases (timing).
 * @throws IOException
 * @throws InterruptedException
 * @throws KeeperException
 */
@Test public void testWatcherCorrectness() throws IOException, InterruptedException, KeeperException {
  ZooKeeper zk=null;
  try {
    MyWatcher watcher=new MyWatcher();
    zk=createClient(watcher,hostPort);
    StatCallback scb=new StatCallback(){
      public void processResult(      int rc,      String path,      Object ctx,      Stat stat){
      }
    }
;
    VoidCallback vcb=new VoidCallback(){
      public void processResult(      int rc,      String path,      Object ctx){
      }
    }
;
    String names[]=new String[10];
    for (int i=0; i < names.length; i++) {
      String name=zk.create("/tc-","initialvalue".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
      names[i]=name;
      Stat stat=new Stat();
      zk.getData(name,watcher,stat);
      zk.setData(name,"new".getBytes(),stat.getVersion(),scb,null);
      stat=zk.exists(name,watcher);
      zk.delete(name,stat.getVersion(),vcb,null);
    }
    for (int i=0; i < names.length; i++) {
      String name=names[i];
      WatchedEvent event=watcher.events.poll(10,TimeUnit.SECONDS);
      Assert.assertEquals(name,event.getPath());
      Assert.assertEquals(Event.EventType.NodeDataChanged,event.getType());
      Assert.assertEquals(Event.KeeperState.SyncConnected,event.getState());
      event=watcher.events.poll(10,TimeUnit.SECONDS);
      Assert.assertEquals(name,event.getPath());
      Assert.assertEquals(Event.EventType.NodeDeleted,event.getType());
      Assert.assertEquals(Event.KeeperState.SyncConnected,event.getState());
    }
  }
  finally {
    if (zk != null) {
      zk.close();
    }
  }
}

</code></pre>

<br>
<pre class="type-9 type-5 type-10 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test checks that watches for pending requests do not get triggered,
 * but watches set by previous requests do.
 * @throws Exception
 */
@Test public void testWatchAutoResetWithPending() throws Exception {
  MyWatcher watches[]=new MyWatcher[COUNT];
  MyStatCallback cbs[]=new MyStatCallback[COUNT];
  MyWatcher watcher=new MyWatcher();
  int count[]=new int[1];
  TestableZooKeeper zk=createClient(watcher,hostPort,6000);
  ZooKeeper zk2=createClient(watcher,hostPort,5000);
  zk2.create("/test",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  for (int i=0; i < COUNT / 2; i++) {
    watches[i]=new MyWatcher();
    cbs[i]=new MyStatCallback();
    zk.exists("/test",watches[i],cbs[i],count);
  }
  zk.exists("/test",false);
  Assert.assertTrue("Failed to pause the connection!",zk.pauseCnxn(3000));
  zk2.close();
  stopServer();
  watches[0].waitForDisconnected(60000);
  for (int i=COUNT / 2; i < COUNT; i++) {
    watches[i]=new MyWatcher();
    cbs[i]=new MyStatCallback();
    zk.exists("/test",watches[i],cbs[i],count);
  }
  startServer();
  watches[COUNT / 2 - 1].waitForConnected(60000);
  Assert.assertEquals(null,zk.exists("/test",false));
  Thread.sleep(10);
  for (int i=0; i < COUNT / 2; i++) {
    Assert.assertEquals("For " + i,1,watches[i].events.size());
  }
  for (int i=COUNT / 2; i < COUNT; i++) {
    if (cbs[i].rc == 0) {
      Assert.assertEquals("For " + i,1,watches[i].events.size());
    }
 else {
      Assert.assertEquals("For " + i,0,watches[i].events.size());
    }
  }
  Assert.assertEquals(COUNT,count[0]);
  zk.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ZkDatabaseCorruptionTest </h4><pre class="type-9 type-10 type-2 type-6 type-8 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCorruption() throws Exception {
  ClientBase.waitForServerUp(qb.hostPort,10000);
  ClientBase.waitForServerUp(qb.hostPort,10000);
  ZooKeeper zk=new ZooKeeper(qb.hostPort,10000,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  SyncRequestProcessor.setSnapCount(100);
  for (int i=0; i < 2000; i++) {
    zk.create("/0-" + i,new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT,new NoopStringCallback(),null);
  }
  zk.close();
  long leaderSid=1;
  QuorumPeer leader=null;
  for (  QuorumPeer quorumPeer : Arrays.asList(qb.s1,qb.s2,qb.s3,qb.s4,qb.s5)) {
    if (quorumPeer.getPeerState() == ServerState.LEADING) {
      leader=quorumPeer;
      break;
    }
    ++leaderSid;
  }
  Assert.assertNotNull("Cannot find the leader.",leader);
  leader.shutdown();
  FileTxnSnapLog snapLog=leader.getTxnFactory();
  File snapDir=snapLog.getSnapDir();
  corruptAllSnapshots(snapDir);
  qb.shutdownServers();
  qb.setupServers();
  if (leaderSid != 1)   qb.s1.start();
 else   leader=qb.s1;
  if (leaderSid != 2)   qb.s2.start();
 else   leader=qb.s2;
  if (leaderSid != 3)   qb.s3.start();
 else   leader=qb.s3;
  if (leaderSid != 4)   qb.s4.start();
 else   leader=qb.s4;
  if (leaderSid != 5)   qb.s5.start();
 else   leader=qb.s5;
  try {
    leader.start();
    Assert.assertTrue(false);
  }
 catch (  RuntimeException re) {
    LOG.info("Got an error: expected",re);
  }
  String[] list=qb.hostPort.split(",");
  for (int i=0; i < 5; i++) {
    if (leaderSid != (i + 1)) {
      String hp=list[i];
      Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp(hp,CONNECTION_TIMEOUT));
      LOG.info("{} is accepting client connections",hp);
    }
 else {
      LOG.info("Skipping the leader");
    }
  }
  zk=qb.createClient();
  SyncRequestProcessor.setSnapCount(100);
  for (int i=2000; i < 4000; i++) {
    zk.create("/0-" + i,new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT,new NoopStringCallback(),null);
  }
  zk.close();
  if (leaderSid != 1)   QuorumBase.shutdown(qb.s1);
  if (leaderSid != 2)   QuorumBase.shutdown(qb.s2);
  if (leaderSid != 3)   QuorumBase.shutdown(qb.s3);
  if (leaderSid != 4)   QuorumBase.shutdown(qb.s4);
  if (leaderSid != 5)   QuorumBase.shutdown(qb.s5);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ZooKeeperQuotaTest </h4><pre class="type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testQuota() throws IOException, InterruptedException, KeeperException, Exception {
  final ZooKeeper zk=createClient();
  final String path="/a/b/v";
  zk.setData("/","some".getBytes(),-1);
  zk.create("/a","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/b","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/b/v","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/b/v/d","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  ZooKeeperMain.createQuota(zk,path,5L,10);
  String absolutePath=Quotas.quotaZookeeper + path + "/"+ Quotas.limitNode;
  byte[] data=zk.getData(absolutePath,false,new Stat());
  StatsTrack st=new StatsTrack(new String(data));
  Assert.assertTrue("bytes are set",st.getBytes() == 5L);
  Assert.assertTrue("num count is set",st.getCount() == 10);
  String statPath=Quotas.quotaZookeeper + path + "/"+ Quotas.statNode;
  byte[] qdata=zk.getData(statPath,false,new Stat());
  StatsTrack qst=new StatsTrack(new String(qdata));
  Assert.assertTrue("bytes are set",qst.getBytes() == 8L);
  Assert.assertTrue("count is set",qst.getCount() == 2);
  stopServer();
  startServer();
  stopServer();
  startServer();
  ZooKeeperServer server=getServer(serverFactory);
  Assert.assertNotNull("Quota is still set",server.getZKDatabase().getDataTree().getMaxPrefixWithQuota(path) != null);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.system.SimpleSysTest </h4><pre class="type-9 type-10 type-3 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test checks the following:
 * 1) All clients connect successfully
 * 2) Half of the servers die (assuming odd number) and a write succeeds
 * 3) All servers are restarted and cluster stays alive
 * 4) Clients see a change by the server
 * 5) Clients' ephemeral nodes are cleaned up
 * @throws Exception
 */
@Test public void testSimpleCase() throws Exception {
  configureServers(serverCount);
  configureClients(clientCount,SimpleClient.class,getHostPort());
  Stat stat=new Stat();
  startServers();
  LOG.debug("Connecting to " + getHostPort());
  ZooKeeper zk=new ZooKeeper(getHostPort(),15000,this);
  waitForConnect(zk,10000);
  zk.create("/simpleCase","orig".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  startClients();
  for (int i=0; i < getClientCount(); i++) {
    for (int j=0; j < maxTries; j++) {
      try {
        byte b[]=zk.getData("/simpleCase/" + i,false,stat);
        Assert.assertEquals("orig",new String(b));
      }
 catch (      NoNodeException e) {
        if (j + 1 == maxTries) {
          Assert.fail("Max tries exceeded on client " + i);
        }
        Thread.sleep(1000);
      }
    }
  }
  for (int i=0; i < getServerCount(); i++) {
    stopServer(i);
    if (i + 1 > getServerCount() / 2) {
      startServer(i);
    }
 else     if (i + 1 == getServerCount() / 2) {
      Assert.assertTrue("Connection didn't recover",waitForConnect(zk,10000));
      try {
        zk.setData("/simpleCase","new".getBytes(),-1);
      }
 catch (      ConnectionLossException e) {
        Assert.assertTrue("Connection didn't recover",waitForConnect(zk,10000));
        zk.setData("/simpleCase","new".getBytes(),-1);
      }
      for (int j=0; j < i; j++) {
        LOG.info("Starting server " + j);
        startServer(i);
      }
    }
  }
  Thread.sleep(100);
  Assert.assertTrue("Servers didn't bounce",waitForConnect(zk,15000));
  try {
    zk.getData("/simpleCase",false,stat);
  }
 catch (  ConnectionLossException e) {
    Assert.assertTrue("Servers didn't bounce",waitForConnect(zk,15000));
  }
  for (int i=0; i < getClientCount(); i++) {
    for (int j=0; j < maxTries; j++) {
      byte data[]=zk.getData("/simpleCase/" + i,false,stat);
      if (new String(data).equals("new")) {
        break;
      }
      if (j + 1 == maxTries) {
        Assert.fail("max tries exceeded for " + i);
      }
      Thread.sleep(1000);
    }
  }
  zk.setData("/simpleCase","die".getBytes(),-1);
  for (int i=0; i < getClientCount(); i++) {
    try {
      for (int j=0; j < maxTries; j++) {
        zk.getData("/simpleCase/" + i,false,stat);
        if (j + 1 == maxTries) {
          Assert.fail("max tries exceeded waiting for child " + i + " to die");
        }
        Thread.sleep(200);
      }
    }
 catch (    NoNodeException e) {
    }
  }
  stopClients();
  stopServers();
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
