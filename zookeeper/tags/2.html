<h3><span class=" glyphicon glyphicon-tag"/>&nbspBooleanVerifier</h3><kbd>Verifies boolean conditions</kbd><br><br><br><h4 style="margin:0px">Class: org.apache.jute.BinaryInputArchiveTest </h4><pre class="type-3 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReadStringCheckLength(){
  byte[] buf=new byte[]{Byte.MAX_VALUE,Byte.MAX_VALUE,Byte.MAX_VALUE,Byte.MAX_VALUE};
  ByteArrayInputStream is=new ByteArrayInputStream(buf);
  BinaryInputArchive ia=BinaryInputArchive.getArchive(is);
  try {
    ia.readString("");
    Assert.fail("Should have thrown an IOException");
  }
 catch (  IOException e) {
    Assert.assertTrue("Not 'Unreasonable length' exception: " + e,e.getMessage().startsWith(BinaryInputArchive.UNREASONBLE_LENGTH));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.ClientReconnectTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testClientReconnect() throws IOException, InterruptedException {
  HostProvider hostProvider=mock(HostProvider.class);
  when(hostProvider.size()).thenReturn(1);
  InetSocketAddress inaddr=new InetSocketAddress("127.0.0.1",1111);
  when(hostProvider.next(anyLong())).thenReturn(inaddr);
  ZooKeeper zk=mock(ZooKeeper.class);
  sc=SocketChannel.open();
  ClientCnxnSocketNIO nioCnxn=new MockCnxn();
  ClientWatchManager watcher=mock(ClientWatchManager.class);
  ClientCnxn clientCnxn=new ClientCnxn("tmp",hostProvider,5000,zk,watcher,nioCnxn,false);
  clientCnxn.start();
  countDownLatch.await(5000,TimeUnit.MILLISECONDS);
  Assert.assertTrue(countDownLatch.getCount() == 0);
  clientCnxn.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.CustomHostProviderTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testZooKeeperWithCustomHostProvider() throws IOException, InterruptedException {
  final int CLIENT_PORT=PortAssignment.unique();
  final HostProvider specialHostProvider=new SpecialHostProvider();
  int expectedCounter=3;
  counter.set(expectedCounter);
  ZooKeeper zkDefaults=new ZooKeeper("127.0.0.1:" + CLIENT_PORT,ClientBase.CONNECTION_TIMEOUT,this,false);
  ZooKeeper zkSpecial=new ZooKeeper("127.0.0.1:" + CLIENT_PORT,ClientBase.CONNECTION_TIMEOUT,this,false,specialHostProvider);
  Assert.assertTrue(counter.get() == expectedCounter);
  zkDefaults.updateServerList("127.0.0.1:" + PortAssignment.unique());
  Assert.assertTrue(counter.get() == expectedCounter);
  zkSpecial.updateServerList("127.0.0.1:" + PortAssignment.unique());
  expectedCounter--;
  Assert.assertTrue(counter.get() == expectedCounter);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.RemoveWatchesCmdTest </h4><pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies deletion of NodeDataChanged watches
 */
@Test(timeout=30000) public void testRemoveNodeDataChangedWatches() throws Exception {
  LOG.info("Adding data watcher using getData()");
  List<EventType> expectedEvents=new ArrayList<Watcher.Event.EventType>();
  expectedEvents.add(EventType.DataWatchRemoved);
  MyWatcher myWatcher=new MyWatcher("/testnode1",expectedEvents,1);
  zk.create("/testnode1","data".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.getData("/testnode1",myWatcher,null);
  String cmdstring="removewatches /testnode1 -d";
  LOG.info("Remove watchers using shell command : {}",cmdstring);
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertTrue("Removewatches cmd fails to remove data watches",zkMain.processZKCmd(zkMain.cl));
  LOG.info("Waiting for the DataWatchRemoved event");
  myWatcher.matches();
  Assert.assertEquals("Data watches are not removed : " + zk.getDataWatches(),0,zk.getDataWatches().size());
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies deletion of NodeCreated data watches
 */
@Test(timeout=30000) public void testRemoveNodeCreatedWatches() throws Exception {
  List<EventType> expectedEvents=new ArrayList<Watcher.Event.EventType>();
  expectedEvents.add(EventType.DataWatchRemoved);
  MyWatcher myWatcher1=new MyWatcher("/testnode1",expectedEvents,1);
  MyWatcher myWatcher2=new MyWatcher("/testnode1/testnode2",expectedEvents,1);
  LOG.info("Adding NodeCreated watcher");
  zk.exists("/testnode1",myWatcher1);
  zk.exists("/testnode1/testnode2",myWatcher2);
  String cmdstring1="removewatches /testnode1 -d";
  LOG.info("Remove watchers using shell command : {}",cmdstring1);
  zkMain.cl.parseCommand(cmdstring1);
  Assert.assertTrue("Removewatches cmd fails to remove pre-create watches",zkMain.processZKCmd(zkMain.cl));
  myWatcher1.matches();
  Assert.assertEquals("Failed to remove pre-create watches :" + zk.getExistWatches(),1,zk.getExistWatches().size());
  Assert.assertTrue("Failed to remove pre-create watches :" + zk.getExistWatches(),zk.getExistWatches().contains("/testnode1/testnode2"));
  String cmdstring2="removewatches /testnode1/testnode2 -d";
  LOG.info("Remove watchers using shell command : {}",cmdstring2);
  zkMain.cl.parseCommand(cmdstring2);
  Assert.assertTrue("Removewatches cmd fails to remove data watches",zkMain.processZKCmd(zkMain.cl));
  myWatcher2.matches();
  Assert.assertEquals("Failed to remove pre-create watches : " + zk.getExistWatches(),0,zk.getExistWatches().size());
}

</code></pre>

<br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test verifies default options. When there is no passed options,
 * removewatches command will use default options - WatcherType.ANY and
 * local=false
 */
@Test(timeout=30000) public void testRemoveWatchesWithNoPassedOptions() throws Exception {
  List<EventType> expectedEvents=new ArrayList<Watcher.Event.EventType>();
  expectedEvents.add(EventType.ChildWatchRemoved);
  expectedEvents.add(EventType.DataWatchRemoved);
  MyWatcher myWatcher=new MyWatcher("/testnode1",expectedEvents,2);
  zk.create("/testnode1","data".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/testnode2","data".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  LOG.info("Adding childwatcher to /testnode1 and /testnode2");
  zk.getChildren("/testnode1",myWatcher);
  zk.getChildren("/testnode2",myWatcher);
  LOG.info("Adding datawatcher to /testnode1 and /testnode2");
  zk.getData("/testnode1",myWatcher,null);
  zk.getData("/testnode2",myWatcher,null);
  String cmdstring="removewatches /testnode1";
  LOG.info("Remove watchers using shell command : {}",cmdstring);
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertTrue("Removewatches cmd fails to remove child watches",zkMain.processZKCmd(zkMain.cl));
  LOG.info("Waiting for the DataWatchRemoved event");
  myWatcher.matches();
  Assert.assertTrue("Failed to find child watches for the path testnode2",zk.getChildWatches().contains("/testnode2"));
  Assert.assertTrue("Failed to find data watches for the path testnode2",zk.getDataWatches().contains("/testnode2"));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies deletion of NodeChildrenChanged watches
 */
@Test(timeout=30000) public void testRemoveNodeChildrenChangedWatches() throws Exception {
  List<EventType> expectedEvents=new ArrayList<Watcher.Event.EventType>();
  expectedEvents.add(EventType.ChildWatchRemoved);
  MyWatcher myWatcher=new MyWatcher("/testnode1",expectedEvents,1);
  zk.create("/testnode1","data".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  LOG.info("Adding child changed watcher");
  zk.getChildren("/testnode1",myWatcher);
  String cmdstring="removewatches /testnode1 -c";
  LOG.info("Remove watchers using shell command : {}",cmdstring);
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertTrue("Removewatches cmd fails to remove child watches",zkMain.processZKCmd(zkMain.cl));
  myWatcher.matches();
  Assert.assertEquals("Failed to remove child watches : " + zk.getChildWatches(),0,zk.getChildWatches().size());
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies deletion of NodeDeleted watches
 */
@Test(timeout=30000) public void testRemoveNodeDeletedWatches() throws Exception {
  LOG.info("Adding NodeDeleted watcher");
  List<EventType> expectedEvents=new ArrayList<Watcher.Event.EventType>();
  expectedEvents.add(EventType.ChildWatchRemoved);
  expectedEvents.add(EventType.NodeDeleted);
  MyWatcher myWatcher=new MyWatcher("/testnode1",expectedEvents,1);
  zk.create("/testnode1","data".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/testnode1/testnode2","data".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.getChildren("/testnode1/testnode2",myWatcher);
  zk.getChildren("/testnode1",myWatcher);
  String cmdstring="removewatches /testnode1 -c";
  LOG.info("Remove watchers using shell command : {}",cmdstring);
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertTrue("Removewatches cmd fails to remove child watches",zkMain.processZKCmd(zkMain.cl));
  LOG.info("Waiting for the ChildWatchRemoved event");
  myWatcher.matches();
  Assert.assertEquals("Failed to remove child watches : " + zk.getChildWatches(),1,zk.getChildWatches().size());
  Assert.assertTrue("Failed to remove child watches :" + zk.getChildWatches(),zk.getChildWatches().contains("/testnode1/testnode2"));
  zk.delete("/testnode1/testnode2",-1);
  myWatcher.matches();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.RemoveWatchesTest </h4><pre class="type-5 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies removal of multiple data watchers when there is server
 * connection
 */
@Test(timeout=90000) public void testMultipleDataWatchers() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  MyWatcher w1=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
  removeWatches(zk2,"/node1",w2,WatcherType.Data,false,Code.OK);
  Assert.assertEquals("Didn't find data watcher",1,zk2.getDataWatches().size());
  Assert.assertEquals("Didn't find data watcher","/node1",zk2.getDataWatches().get(0));
  removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove data watcher",w2.matches());
  if (zk1 != null) {
    zk1.close();
    zk1=null;
  }
  List<EventType> events=w2.getEventsAfterWatchRemoval();
  Assert.assertEquals("Shouldn't get NodeDeletedEvent after watch removal",0,events.size());
}

</code></pre>

<br>
<pre class="type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Any - removes only the configured child watcher
 * function
 */
@Test(timeout=90000) public void testRemoveAnyChildWatcher() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",2);
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w2);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w1);
  removeWatches(zk2,"/node1",w2,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
  Assert.assertEquals("Didn't find child watcher",1,zk2.getChildWatches().size());
  Assert.assertEquals("Didn't find data watcher",1,zk2.getDataWatches().size());
  removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove watchers",w1.matches());
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Data - removes only the configured data watcher
 * function
 */
@Test(timeout=90000) public void testRemoveAllDataWatchesOnAPath() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  final CountDownLatch dWatchCount=new CountDownLatch(2);
  final CountDownLatch rmWatchCount=new CountDownLatch(2);
  Watcher w1=new Watcher(){
    @Override public void process(    WatchedEvent event){
switch (event.getType()) {
case DataWatchRemoved:
        rmWatchCount.countDown();
      break;
case NodeDataChanged:
    dWatchCount.countDown();
  break;
default :
break;
}
}
}
;
Watcher w2=new Watcher(){
@Override public void process(WatchedEvent event){
switch (event.getType()) {
case DataWatchRemoved:
rmWatchCount.countDown();
break;
case NodeDataChanged:
dWatchCount.countDown();
break;
default :
break;
}
}
}
;
LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
Assert.assertTrue("Server session is not a watcher",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Data));
removeAllWatches(zk2,"/node1",WatcherType.Data,false,Code.OK);
Assert.assertTrue("Didn't remove data watcher",rmWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
Assert.assertFalse("Server session is still a watcher after removal",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Data));
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies null watcher with WatcherType.Data - remove all data
 * watchers. Child watchers shouldn't be removed
 */
@Test(timeout=90000) public void testRemoveAllDataWatchers() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",1);
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w2);
  removeWatches(zk2,"/node1",w1,WatcherType.Data,false,Code.OK);
  removeWatches(zk2,"/node1",w2,WatcherType.Data,false,Code.OK);
  zk1.create("/node1/child",null,Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  Assert.assertTrue("Didn't remove data watcher",w1.matches());
  Assert.assertTrue("Didn't remove data watcher",w2.matches());
  int count=10;
  while (count > 0) {
    if (w1.getEventsAfterWatchRemoval().size() > 0 && w2.getEventsAfterWatchRemoval().size() > 0) {
      break;
    }
    count--;
    Thread.sleep(1000);
  }
  List<EventType> events=w1.getEventsAfterWatchRemoval();
  Assert.assertEquals("Didn't get NodeChildrenChanged event",1,events.size());
  Assert.assertTrue("Didn't get NodeChildrenChanged event",events.contains(EventType.NodeChildrenChanged));
  events=w2.getEventsAfterWatchRemoval();
  Assert.assertEquals("Didn't get NodeChildrenChanged event",1,events.size());
  Assert.assertTrue("Didn't get NodeChildrenChanged event",events.contains(EventType.NodeChildrenChanged));
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies removal of many watchers locally when no connection and
 * WatcherType#Any. Also, verifies internal watchManager datastructures
 */
@Test(timeout=90000) public void testManyWatchersWhenNoConnection() throws Exception {
  int count=3;
  List<MyWatcher> wList=new ArrayList<MyWatcher>(count);
  MyWatcher w;
  String path="/node";
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    zk1.create(nodePath,null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    nodePath+="/";
  }
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    w=new MyWatcher(path + i,2);
    wList.add(w);
    LOG.info("Adding child watcher {} on path {}",new Object[]{w,nodePath});
    zk1.getChildren(nodePath,w);
    nodePath+="/";
  }
  Assert.assertEquals("Failed to add watchers!",count,zk1.getChildWatches().size());
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    w=wList.get(i);
    LOG.info("Adding data watcher {} on path {}",new Object[]{w,nodePath});
    zk1.getData(nodePath,w,null);
    nodePath+="/";
  }
  Assert.assertEquals("Failed to add watchers!",count,zk1.getDataWatches().size());
  stopServer();
  for (int i=0; i < count; i++) {
    final MyWatcher watcher=wList.get(i);
    removeWatches(zk1,path + i,watcher,WatcherType.Any,true,Code.OK);
    Assert.assertTrue("Didn't remove watcher",watcher.matches());
  }
  Assert.assertEquals("Didn't remove watch references!",0,zk1.getChildWatches().size());
  Assert.assertEquals("Didn't remove watch references!",0,zk1.getDataWatches().size());
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies removal of single watcher when there is server connection
 */
@Test(timeout=90000) public void testRemoveSingleWatcher() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  zk1.create("/node2",null,Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  MyWatcher w1=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  MyWatcher w2=new MyWatcher("/node2",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node2",w2));
  removeWatches(zk2,"/node1",w1,WatcherType.Data,false,Code.OK);
  Assert.assertEquals("Didn't find data watcher",1,zk2.getDataWatches().size());
  Assert.assertEquals("Didn't find data watcher","/node2",zk2.getDataWatches().get(0));
  removeWatches(zk2,"/node2",w2,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove data watcher",w2.matches());
  if (zk1 != null) {
    zk1.close();
    zk1=null;
  }
  List<EventType> events=w1.getEventsAfterWatchRemoval();
  Assert.assertFalse("Shouldn't get NodeDeletedEvent after watch removal",events.contains(EventType.NodeDeleted));
  Assert.assertEquals("Shouldn't get NodeDeletedEvent after watch removal",0,events.size());
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Children - removes only the configured child
 * watcher function
 */
@Test(timeout=90000) public void testRemoveAllChildWatchesOnAPath() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  final CountDownLatch cWatchCount=new CountDownLatch(2);
  final CountDownLatch rmWatchCount=new CountDownLatch(2);
  Watcher w1=new Watcher(){
    @Override public void process(    WatchedEvent event){
switch (event.getType()) {
case ChildWatchRemoved:
        rmWatchCount.countDown();
      break;
case NodeChildrenChanged:
    cWatchCount.countDown();
  break;
default :
break;
}
}
}
;
Watcher w2=new Watcher(){
@Override public void process(WatchedEvent event){
switch (event.getType()) {
case ChildWatchRemoved:
rmWatchCount.countDown();
break;
case NodeChildrenChanged:
cWatchCount.countDown();
break;
default :
break;
}
}
}
;
LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w1).size());
LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w2).size());
Assert.assertTrue("Server session is not a watcher",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Children));
removeAllWatches(zk2,"/node1",WatcherType.Children,false,Code.OK);
Assert.assertTrue("Didn't remove child watcher",rmWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
Assert.assertFalse("Server session is still a watcher after removal",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Children));
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies null watcher with WatcherType.Children - remove all child
 * watchers. Data watchers shouldn't be removed
 */
@Test(timeout=90000) public void testRemoveAllChildWatchers() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",1);
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w2);
  removeWatches(zk2,"/node1",w1,WatcherType.Children,false,Code.OK);
  removeWatches(zk2,"/node1",w2,WatcherType.Children,false,Code.OK);
  zk1.setData("/node1","test".getBytes(),-1);
  Assert.assertTrue("Didn't remove child watcher",w1.matches());
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
  int count=10;
  while (count > 0) {
    if (w1.getEventsAfterWatchRemoval().size() > 0 && w2.getEventsAfterWatchRemoval().size() > 0) {
      break;
    }
    count--;
    Thread.sleep(1000);
  }
  List<EventType> events=w1.getEventsAfterWatchRemoval();
  Assert.assertEquals("Didn't get NodeDataChanged event",1,events.size());
  Assert.assertTrue("Didn't get NodeDataChanged event",events.contains(EventType.NodeDataChanged));
  events=w2.getEventsAfterWatchRemoval();
  Assert.assertEquals("Didn't get NodeDataChanged event",1,events.size());
  Assert.assertTrue("Didn't get NodeDataChanged event",events.contains(EventType.NodeDataChanged));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies removing watcher having namespace
 */
@Test(timeout=90000) public void testChRootRemoveWatcher() throws Exception {
  String chRoot="/appsX";
  zk1.create("/appsX",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  if (zk1 != null) {
    zk1.close();
  }
  if (zk2 != null) {
    zk2.close();
  }
  zk1=createClient(this.hostPort + chRoot);
  zk2=createClient(this.hostPort + chRoot);
  LOG.info("Creating child znode /node1 using chRoot client");
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",2);
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w2);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w1);
  removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w1.matches());
  Assert.assertEquals("Didn't find child watcher",1,zk2.getChildWatches().size());
  removeWatches(zk2,"/node1",w2,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
}

</code></pre>

<br>
<pre class="type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Any - removes only the configured data watcher
 * function
 */
@Test(timeout=90000) public void testRemoveAnyDataWatcher() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",1);
  MyWatcher w2=new MyWatcher("/node1",2);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w2);
  removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove data watcher",w1.matches());
  Assert.assertEquals("Didn't find child watcher",1,zk2.getChildWatches().size());
  Assert.assertEquals("Didn't find data watcher",1,zk2.getDataWatches().size());
  removeWatches(zk2,"/node1",w2,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies many child watchers. Also, verifies internal datastructure
 * 'watchManager.childWatches'
 */
@Test(timeout=90000) public void testManyChildWatchers() throws Exception {
  int count=50;
  List<MyWatcher> wList=new ArrayList<MyWatcher>(count);
  MyWatcher w;
  String path="/node";
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    zk1.create(nodePath,null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    nodePath+="/";
  }
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    w=new MyWatcher(path + i,1);
    wList.add(w);
    LOG.info("Adding child watcher {} on path {}",new Object[]{w,nodePath});
    zk1.getChildren(nodePath,w);
    nodePath+="/";
  }
  Assert.assertEquals("Failed to add watchers!",count,zk1.getChildWatches().size());
  for (int i=0; i < count; i++) {
    final MyWatcher watcher=wList.get(i);
    removeWatches(zk1,path + i,watcher,WatcherType.Children,false,Code.OK);
    Assert.assertTrue("Didn't remove child watcher",watcher.matches());
  }
  Assert.assertEquals("Didn't remove watch references!",0,zk1.getChildWatches().size());
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Data - removes only the configured data watcher
 * function
 */
@Test(timeout=90000) public void testRemoveWhenMultipleDataWatchesOnAPath() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  final CountDownLatch dataWatchCount=new CountDownLatch(1);
  final CountDownLatch rmWatchCount=new CountDownLatch(1);
  Watcher w1=new Watcher(){
    @Override public void process(    WatchedEvent event){
      if (event.getType() == EventType.DataWatchRemoved) {
        rmWatchCount.countDown();
      }
    }
  }
;
  Watcher w2=new Watcher(){
    @Override public void process(    WatchedEvent event){
      if (event.getType() == EventType.NodeDataChanged) {
        dataWatchCount.countDown();
      }
    }
  }
;
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
  removeWatches(zk2,"/node1",w1,WatcherType.Data,false,Code.OK);
  Assert.assertTrue("Didn't remove data watcher",rmWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
  zk1.setData("/node1","test".getBytes(),-1);
  LOG.info("Waiting for data watchers to be notified");
  Assert.assertTrue("Didn't get data watch notification!",dataWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies when there is no server connection. Remove watches when
 * local=true, otw should retain it
 */
@Test(timeout=90000) public void testRemoveWatcherWhenNoConnection() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",2);
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w2);
  stopServer();
  removeWatches(zk2,"/node1",w2,WatcherType.Any,true,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
  Assert.assertFalse("Shouldn't remove data watcher",w1.matches());
  try {
    removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.CONNECTIONLOSS);
    Assert.fail("Should throw exception as last watch removal requires server connection");
  }
 catch (  KeeperException.ConnectionLossException nwe) {
  }
  Assert.assertFalse("Shouldn't remove data watcher",w1.matches());
  removeWatches(zk2,"/node1",w1,WatcherType.Any,true,Code.OK);
  Assert.assertTrue("Didn't remove data watcher",w1.matches());
}

</code></pre>

<br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Verify that if a given watcher doesn't exist, the server properly
 * returns an error code for it.
 * In our Java client implementation, we check that a given watch exists at
 * two points:
 * 1) before submitting the RemoveWatches request
 * 2) after a successful server response, when the watcher needs to be
 * removed
 * Since this can be racy (i.e. a watch can fire while a RemoveWatches
 * request is in-flight), we need to verify that the watch was actually
 * removed (i.e. from ZKDatabase and DataTree) and return NOWATCHER if
 * needed.
 * Also, other implementations might not do a client side check before
 * submitting a RemoveWatches request. If we don't do a server side check,
 * we would just return ZOK even if no watch was removed.
 */
@Test(timeout=90000) public void testNoWatcherServerException() throws InterruptedException, IOException, TimeoutException {
  CountdownWatcher watcher=new CountdownWatcher();
  MyZooKeeper zk=new MyZooKeeper(hostPort,CONNECTION_TIMEOUT,watcher);
  boolean nw=false;
  watcher.waitForConnected(CONNECTION_TIMEOUT);
  try {
    zk.removeWatches("/nowatchhere",watcher,WatcherType.Data,false);
  }
 catch (  KeeperException nwe) {
    if (nwe.code().intValue() == Code.NOWATCHER.intValue()) {
      nw=true;
    }
  }
  Assert.assertTrue("Server didn't return NOWATCHER",zk.getRemoveWatchesRC() == Code.NOWATCHER.intValue());
  Assert.assertTrue("NoWatcherException didn't happen",nw);
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Any - removes all the configured child,data
 * watcher functions
 */
@Test(timeout=90000) public void testRemoveAllWatchesOnAPath() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  final CountDownLatch watchCount=new CountDownLatch(2);
  final CountDownLatch rmWatchCount=new CountDownLatch(4);
  Watcher w1=new Watcher(){
    @Override public void process(    WatchedEvent event){
switch (event.getType()) {
case ChildWatchRemoved:
case DataWatchRemoved:
        rmWatchCount.countDown();
      break;
case NodeChildrenChanged:
case NodeDataChanged:
    watchCount.countDown();
  break;
default :
break;
}
}
}
;
Watcher w2=new Watcher(){
@Override public void process(WatchedEvent event){
switch (event.getType()) {
case ChildWatchRemoved:
case DataWatchRemoved:
rmWatchCount.countDown();
break;
case NodeChildrenChanged:
case NodeDataChanged:
watchCount.countDown();
break;
default :
break;
}
}
}
;
LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w1).size());
LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w2).size());
LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
Assert.assertTrue("Server session is not a watcher",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Data));
removeAllWatches(zk2,"/node1",WatcherType.Any,false,Code.OK);
Assert.assertTrue("Didn't remove data watcher",rmWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
Assert.assertFalse("Server session is still a watcher after removal",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Data));
Assert.assertEquals("Received watch notification after removal!",2,watchCount.getCount());
}

</code></pre>

<br>
<pre class="type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies null watcher with WatcherType.Any - remove all the watchers
 * data, child, exists
 */
@Test(timeout=90000) public void testRemoveAllWatchers() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",2);
  MyWatcher w2=new MyWatcher("/node1",2);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w2);
  removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.OK);
  removeWatches(zk2,"/node1",w2,WatcherType.Any,false,Code.OK);
  zk1.create("/node1/child",null,Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  Assert.assertTrue("Didn't remove data watcher",w1.matches());
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Children - removes only the configured child
 * watcher function
 */
@Test(timeout=90000) public void testRemoveWhenMultipleChildWatchesOnAPath() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  final CountDownLatch childWatchCount=new CountDownLatch(1);
  final CountDownLatch rmWatchCount=new CountDownLatch(1);
  Watcher w1=new Watcher(){
    @Override public void process(    WatchedEvent event){
      if (event.getType() == EventType.ChildWatchRemoved) {
        rmWatchCount.countDown();
      }
    }
  }
;
  Watcher w2=new Watcher(){
    @Override public void process(    WatchedEvent event){
      if (event.getType() == EventType.NodeChildrenChanged) {
        childWatchCount.countDown();
      }
    }
  }
;
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w1).size());
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w2).size());
  removeWatches(zk2,"/node1",w1,WatcherType.Children,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",rmWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
  zk1.create("/node1/node2",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  LOG.info("Waiting for child watchers to be notified");
  Assert.assertTrue("Didn't get child watch notification!",childWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies removal of multiple child watchers when there is server
 * connection
 */
@Test(timeout=90000) public void testMultipleChildWatchers() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w1);
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w2);
  removeWatches(zk2,"/node1",w2,WatcherType.Children,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
  Assert.assertEquals("Didn't find child watcher",1,zk2.getChildWatches().size());
  removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w1.matches());
  zk1.create("/node1/node2",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  int count=30;
  while (count > 0) {
    if (w1.getEventsAfterWatchRemoval().size() > 0) {
      break;
    }
    count--;
    Thread.sleep(100);
  }
  List<EventType> events=w2.getEventsAfterWatchRemoval();
  Assert.assertEquals("Shouldn't get NodeChildrenChanged event",0,events.size());
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies many pre-node watchers. Also, verifies internal
 * datastructure 'watchManager.existWatches'
 */
@Test(timeout=90000) public void testManyPreNodeWatchers() throws Exception {
  int count=50;
  List<MyWatcher> wList=new ArrayList<MyWatcher>(count);
  MyWatcher w;
  String path="/node";
  for (int i=0; i < count; i++) {
    final String nodePath=path + i;
    w=new MyWatcher(nodePath,1);
    wList.add(w);
    LOG.info("Adding pre node watcher {} on path {}",new Object[]{w,nodePath});
    zk1.exists(nodePath,w);
  }
  Assert.assertEquals("Failed to add watchers!",count,zk1.getExistWatches().size());
  for (int i=0; i < count; i++) {
    final MyWatcher watcher=wList.get(i);
    removeWatches(zk1,path + i,watcher,WatcherType.Data,false,Code.OK);
    Assert.assertTrue("Didn't remove data watcher",watcher.matches());
  }
  Assert.assertEquals("Didn't remove watch references!",0,zk1.getExistWatches().size());
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies many data watchers. Also, verifies internal datastructure
 * 'watchManager.dataWatches'
 */
@Test(timeout=90000) public void testManyDataWatchers() throws Exception {
  int count=50;
  List<MyWatcher> wList=new ArrayList<MyWatcher>(count);
  MyWatcher w;
  String path="/node";
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    w=new MyWatcher(path + i,1);
    wList.add(w);
    zk1.create(nodePath,null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    LOG.info("Adding data watcher {} on path {}",new Object[]{w,nodePath});
    zk1.getData(nodePath,w,null);
    nodePath+="/";
  }
  Assert.assertEquals("Failed to add watchers!",count,zk1.getDataWatches().size());
  for (int i=0; i < count; i++) {
    final MyWatcher watcher=wList.get(i);
    removeWatches(zk1,path + i,watcher,WatcherType.Data,false,Code.OK);
    Assert.assertTrue("Didn't remove data watcher",watcher.matches());
  }
  Assert.assertEquals("Didn't remove watch references!",0,zk1.getDataWatches().size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.ZooKeeperTest </h4><pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testDelete() throws Exception {
  final ZooKeeper zk=createClient();
  ZooKeeperMain zkMain=new ZooKeeperMain(zk);
  String cmdstring1="create -e /node2 data";
  String cmdstring2="delete /node2";
  String cmdstring3="ls /node2";
  zkMain.cl.parseCommand(cmdstring1);
  Assert.assertTrue(zkMain.processZKCmd(zkMain.cl));
  zkMain.cl.parseCommand(cmdstring2);
  Assert.assertFalse(zkMain.processZKCmd(zkMain.cl));
  zkMain.cl.parseCommand(cmdstring3);
  Assert.assertFalse("",zkMain.processCmd(zkMain.cl));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeleteRecursiveAsync() throws IOException, InterruptedException, KeeperException {
  final ZooKeeper zk=createClient();
  zk.setData("/","some".getBytes(),-1);
  zk.create("/a","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/b","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/b/v","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/b/v/1","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/c","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/c/v","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  for (int i=0; i < 50; ++i) {
    zk.create("/a/c/" + i,"some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  }
  List<String> children=zk.getChildren("/a",false);
  Assert.assertEquals("2 children - b & c should be present ",children.size(),2);
  Assert.assertTrue(children.contains("b"));
  Assert.assertTrue(children.contains("c"));
  VoidCallback cb=new VoidCallback(){
    @Override public void processResult(    int rc,    String path,    Object ctx){
synchronized (ctx) {
        ((AtomicInteger)ctx).set(4);
        ctx.notify();
      }
    }
  }
;
  final AtomicInteger ctx=new AtomicInteger(3);
  ZKUtil.deleteRecursive(zk,"/a",cb,ctx);
synchronized (ctx) {
    ctx.wait();
  }
  Assert.assertEquals(4,((AtomicInteger)ctx).get());
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateNodeWithoutData() throws Exception {
  final ZooKeeper zk=createClient();
  ZooKeeperMain zkMain=new ZooKeeperMain(zk);
  String cmdstring="create -s /node ";
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertTrue("Doesn't create node without data",zkMain.processZKCmd(zkMain.cl));
  cmdstring="create  -e /node ";
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertTrue("Doesn't create node without data",zkMain.processZKCmd(zkMain.cl));
  cmdstring="create -s -e /node ";
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertTrue("Doesn't create node without data",zkMain.processZKCmd(zkMain.cl));
  cmdstring="create -s y /node";
  zkMain.cl.parseCommand(cmdstring);
  try {
    Assert.assertTrue("Created node with wrong option",zkMain.processZKCmd(zkMain.cl));
    Assert.fail("Created the node with wrong option should " + "throw Exception.");
  }
 catch (  IllegalArgumentException e) {
    Assert.assertEquals("Path must start with / character",e.getMessage());
  }
}

</code></pre>

<br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testStatCommand() throws Exception {
  final ZooKeeper zk=createClient();
  ZooKeeperMain zkMain=new ZooKeeperMain(zk);
  String cmdstring1="create -e /node3 data";
  String cmdstring2="stat /node3";
  String cmdstring3="delete /node3";
  zkMain.cl.parseCommand(cmdstring1);
  Assert.assertTrue(zkMain.processZKCmd(zkMain.cl));
  zkMain.cl.parseCommand(cmdstring2);
  Assert.assertFalse(zkMain.processZKCmd(zkMain.cl));
  zkMain.cl.parseCommand(cmdstring3);
  Assert.assertFalse(zkMain.processZKCmd(zkMain.cl));
}

</code></pre>

<br>
<pre class="type-3 type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidStatCommand() throws Exception {
  final ZooKeeper zk=createClient();
  ZooKeeperMain zkMain=new ZooKeeperMain(zk);
  String cmdstring1="stat /node123";
  zkMain.cl.parseCommand(cmdstring1);
  try {
    Assert.assertFalse(zkMain.processZKCmd(zkMain.cl));
    Assert.fail("Path doesn't exists so, command should fail.");
  }
 catch (  KeeperException e) {
    Assert.assertEquals(KeeperException.Code.NONODE,e.code());
  }
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testInvalidCommand() throws Exception {
  final ZooKeeper zk=createClient();
  ZooKeeperMain zkMain=new ZooKeeperMain(zk);
  String cmdstring="cret -s /node1";
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertFalse("Doesn't validate the command",zkMain.processZKCmd(zkMain.cl));
}

</code></pre>

<br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testCreateCommandWithoutPath() throws Exception {
  final ZooKeeper zk=createClient();
  ZooKeeperMain zkMain=new ZooKeeperMain(zk);
  String cmdstring="create ";
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertFalse("Path is not validated.",zkMain.processZKCmd(zkMain.cl));
  cmdstring="create -e ";
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertFalse("Path is not validated.",zkMain.processZKCmd(zkMain.cl));
  cmdstring="create -s ";
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertFalse("Path is not validated.",zkMain.processZKCmd(zkMain.cl));
  cmdstring="create -s -e ";
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertFalse("Path is not validated.",zkMain.processZKCmd(zkMain.cl));
}

</code></pre>

<br>
<pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testSortedLs() throws Exception {
  final ZooKeeper zk=createClient();
  ZooKeeperMain zkMain=new ZooKeeperMain(zk);
  zkMain.executeLine("create /aa1");
  zkMain.executeLine("create /aa2");
  zkMain.executeLine("create /aa3");
  zkMain.executeLine("create /test1");
  zkMain.executeLine("create /zk1");
  ByteArrayOutputStream byteStream=new ByteArrayOutputStream();
  PrintStream out=new PrintStream(byteStream);
  String lsCmd="ls /";
  LsCommand entity=new LsCommand();
  entity.setZk(zk);
  entity.setOut(out);
  entity.parse(lsCmd.split(" ")).exec();
  String result=byteStream.toString();
  assertTrue(result,result.contains("[aa1, aa2, aa3, test1, zk1, zookeeper]"));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSetData() throws Exception {
  final ZooKeeper zk=createClient();
  ZooKeeperMain zkMain=new ZooKeeperMain(zk);
  String cmdstring1="create -e /node4 data";
  String cmdstring2="set /node4 " + "data";
  String cmdstring3="delete /node4";
  Stat stat=new Stat();
  int version=0;
  zkMain.cl.parseCommand(cmdstring1);
  Assert.assertTrue(zkMain.processZKCmd(zkMain.cl));
  stat=zk.exists("/node4",true);
  version=stat.getVersion();
  zkMain.cl.parseCommand(cmdstring2);
  Assert.assertFalse(zkMain.processZKCmd(zkMain.cl));
  stat=zk.exists("/node4",true);
  Assert.assertEquals(version + 1,stat.getVersion());
  zkMain.cl.parseCommand(cmdstring3);
  Assert.assertFalse(zkMain.processZKCmd(zkMain.cl));
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testACLWithExtraAgruments() throws Exception {
  final ZooKeeper zk=createClient();
  ZooKeeperMain zkMain=new ZooKeeperMain(zk);
  String cmdstring="create -s /l data ip:10.18.52.144:cdrwa f g h";
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertTrue("Not considering the extra arguments after the acls.",zkMain.processZKCmd(zkMain.cl));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeleteRecursive() throws IOException, InterruptedException, KeeperException {
  final ZooKeeper zk=createClient();
  zk.setData("/","some".getBytes(),-1);
  zk.create("/a","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/b","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/b/v","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/b/v/1","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/c","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/c/v","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  List<String> children=zk.getChildren("/a",false);
  Assert.assertEquals("2 children - b & c should be present ",children.size(),2);
  Assert.assertTrue(children.contains("b"));
  Assert.assertTrue(children.contains("c"));
  ZooKeeperMain zkMain=new ZooKeeperMain(zk);
  String cmdstring0="rmr /a/b/v";
  String cmdstring1="deleteall /a";
  zkMain.cl.parseCommand(cmdstring0);
  Assert.assertFalse(zkMain.processZKCmd(zkMain.cl));
  Assert.assertEquals(null,zk.exists("/a/b/v",null));
  zkMain.cl.parseCommand(cmdstring1);
  Assert.assertFalse(zkMain.processZKCmd(zkMain.cl));
  Assert.assertNull(zk.exists("/a",null));
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testCreatePersistentNode() throws Exception {
  final ZooKeeper zk=createClient();
  ZooKeeperMain zkMain=new ZooKeeperMain(zk);
  String cmdstring="create /node2";
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertTrue("Not creating Persistent node.",zkMain.processZKCmd(zkMain.cl));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.ZooKeeperTestableTest </h4><pre class="type-3 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSessionExpiration() throws IOException, InterruptedException, KeeperException {
  ZooKeeper zk=createClient();
  final CountDownLatch expirationLatch=new CountDownLatch(1);
  Watcher watcher=new Watcher(){
    @Override public void process(    WatchedEvent event){
      if (event.getState() == Event.KeeperState.Expired) {
        expirationLatch.countDown();
      }
    }
  }
;
  zk.exists("/foo",watcher);
  zk.getTestable().injectSessionExpiration();
  Assert.assertTrue(expirationLatch.await(5,TimeUnit.SECONDS));
  boolean gotException=false;
  try {
    zk.exists("/foo",false);
    Assert.fail("Should have thrown a SessionExpiredException");
  }
 catch (  KeeperException.SessionExpiredException e) {
    gotException=true;
  }
  Assert.assertTrue(gotException);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.common.AtomicFileWritingIdiomTest </h4><pre class="type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOutputStreamSuccess() throws IOException {
  File target=new File(tmpdir,"target.txt");
  final File tmp=new File(tmpdir,"target.txt.tmp");
  createFile(target,"before");
  assertEquals("before",getContent(target));
  new AtomicFileWritingIdiom(target,new OutputStreamStatement(){
    @Override public void write(    OutputStream os) throws IOException {
      os.write("after".getBytes("ASCII"));
      assertTrue("implementation of AtomicFileOutputStream has changed, update the test",tmp.exists());
    }
  }
);
  assertFalse("tmp file should have been deleted",tmp.exists());
  assertEquals("after",getContent(target));
  target.delete();
}

</code></pre>

<br>
<pre class="type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOutputStreamFailureError() throws IOException {
  File target=new File(tmpdir,"target.txt");
  final File tmp=new File(tmpdir,"target.txt.tmp");
  createFile(target,"before");
  assertEquals("before",getContent(target));
  boolean exception=false;
  try {
    new AtomicFileWritingIdiom(target,new OutputStreamStatement(){
      @Override public void write(      OutputStream os) throws IOException {
        os.write("after".getBytes("ASCII"));
        os.flush();
        assertTrue("implementation of AtomicFileOutputStream has changed, update the test",tmp.exists());
        throw new Error();
      }
    }
);
  }
 catch (  Error ex) {
    exception=true;
  }
  assertFalse("tmp file should have been deleted",tmp.exists());
  assertTrue("should have raised an exception",exception);
  assertEquals("before",getContent(target));
  target.delete();
}

</code></pre>

<br>
<pre class="type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWriterFailureIOException() throws IOException {
  File target=new File(tmpdir,"target.txt");
  final File tmp=new File(tmpdir,"target.txt.tmp");
  createFile(target,"before");
  assertEquals("before",getContent(target));
  boolean exception=false;
  try {
    new AtomicFileWritingIdiom(target,new WriterStatement(){
      @Override public void write(      Writer os) throws IOException {
        os.write("after");
        os.flush();
        assertTrue("implementation of AtomicFileOutputStream has changed, update the test",tmp.exists());
        throw new IOException();
      }
    }
);
  }
 catch (  IOException ex) {
    exception=true;
  }
  assertFalse("tmp file should have been deleted",tmp.exists());
  assertTrue("should have raised an exception",exception);
  assertEquals("before",getContent(target));
  target.delete();
}

</code></pre>

<br>
<pre class="type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOutputStreamSuccessNE() throws IOException {
  File target=new File(tmpdir,"target.txt");
  final File tmp=new File(tmpdir,"target.txt.tmp");
  target.delete();
  assertFalse("file should not exist",target.exists());
  new AtomicFileWritingIdiom(target,new OutputStreamStatement(){
    @Override public void write(    OutputStream os) throws IOException {
      os.write("after".getBytes("ASCII"));
      assertTrue("implementation of AtomicFileOutputStream has changed, update the test",tmp.exists());
    }
  }
);
  assertEquals("after",getContent(target));
  target.delete();
}

</code></pre>

<br>
<pre class="type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOutputStreamFailure() throws IOException {
  File target=new File(tmpdir,"target.txt");
  final File tmp=new File(tmpdir,"target.txt.tmp");
  createFile(target,"before");
  assertEquals("before",getContent(target));
  boolean exception=false;
  try {
    new AtomicFileWritingIdiom(target,new OutputStreamStatement(){
      @Override public void write(      OutputStream os) throws IOException {
        os.write("after".getBytes("ASCII"));
        os.flush();
        assertTrue("implementation of AtomicFileOutputStream has changed, update the test",tmp.exists());
        throw new RuntimeException();
      }
    }
);
  }
 catch (  RuntimeException ex) {
    exception=true;
  }
  assertFalse("tmp file should have been deleted",tmp.exists());
  assertTrue("should have raised an exception",exception);
  assertEquals("before",getContent(target));
  target.delete();
}

</code></pre>

<br>
<pre class="type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWriterSuccess() throws IOException {
  File target=new File(tmpdir,"target.txt");
  final File tmp=new File(tmpdir,"target.txt.tmp");
  createFile(target,"before");
  assertEquals("before",getContent(target));
  new AtomicFileWritingIdiom(target,new WriterStatement(){
    @Override public void write(    Writer os) throws IOException {
      os.write("after");
      assertTrue("implementation of AtomicFileOutputStream has changed, update the test",tmp.exists());
    }
  }
);
  assertFalse("tmp file should have been deleted",tmp.exists());
  assertEquals("after",getContent(target));
  target.delete();
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testWriterFailureNE() throws IOException {
  File target=new File(tmpdir,"target.txt");
  final File tmp=new File(tmpdir,"target.txt.tmp");
  target.delete();
  assertFalse("file should not exist",target.exists());
  boolean exception=false;
  try {
    new AtomicFileWritingIdiom(target,new WriterStatement(){
      @Override public void write(      Writer os) throws IOException {
        os.write("after");
        os.flush();
        assertTrue("implementation of AtomicFileOutputStream has changed, update the test",tmp.exists());
        throw new RuntimeException();
      }
    }
);
  }
 catch (  RuntimeException ex) {
    exception=true;
  }
  assertFalse("tmp file should have been deleted",tmp.exists());
  assertTrue("should have raised an exception",exception);
  assertFalse("file should not exist",target.exists());
}

</code></pre>

<br>
<pre class="type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWriterSuccessNE() throws IOException {
  File target=new File(tmpdir,"target.txt");
  final File tmp=new File(tmpdir,"target.txt.tmp");
  target.delete();
  assertFalse("file should not exist",target.exists());
  new AtomicFileWritingIdiom(target,new WriterStatement(){
    @Override public void write(    Writer os) throws IOException {
      os.write("after");
      assertTrue("implementation of AtomicFileOutputStream has changed, update the test",tmp.exists());
    }
  }
);
  assertFalse("tmp file should have been deleted",tmp.exists());
  assertEquals("after",getContent(target));
  target.delete();
}

</code></pre>

<br>
<pre class="type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWriterFailure() throws IOException {
  File target=new File(tmpdir,"target.txt");
  final File tmp=new File(tmpdir,"target.txt.tmp");
  createFile(target,"before");
  assertEquals("before",getContent(target));
  boolean exception=false;
  try {
    new AtomicFileWritingIdiom(target,new WriterStatement(){
      @Override public void write(      Writer os) throws IOException {
        os.write("after");
        os.flush();
        assertTrue("implementation of AtomicFileOutputStream has changed, update the test",tmp.exists());
        throw new RuntimeException();
      }
    }
);
  }
 catch (  RuntimeException ex) {
    exception=true;
  }
  assertFalse("tmp file should have been deleted",tmp.exists());
  assertTrue("should have raised an exception",exception);
  assertEquals("before",getContent(target));
  target.delete();
}

</code></pre>

<br>
<pre class="type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOutputStreamFailureIOException() throws IOException {
  File target=new File(tmpdir,"target.txt");
  final File tmp=new File(tmpdir,"target.txt.tmp");
  createFile(target,"before");
  assertEquals("before",getContent(target));
  boolean exception=false;
  try {
    new AtomicFileWritingIdiom(target,new OutputStreamStatement(){
      @Override public void write(      OutputStream os) throws IOException {
        os.write("after".getBytes("ASCII"));
        os.flush();
        assertTrue("implementation of AtomicFileOutputStream has changed, update the test",tmp.exists());
        throw new IOException();
      }
    }
);
  }
 catch (  IOException ex) {
    exception=true;
  }
  assertFalse("tmp file should have been deleted",tmp.exists());
  assertTrue("should have raised an exception",exception);
  assertEquals("before",getContent(target));
  target.delete();
}

</code></pre>

<br>
<pre class="type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWriterFailureError() throws IOException {
  File target=new File(tmpdir,"target.txt");
  final File tmp=new File(tmpdir,"target.txt.tmp");
  createFile(target,"before");
  assertEquals("before",getContent(target));
  boolean exception=false;
  try {
    new AtomicFileWritingIdiom(target,new WriterStatement(){
      @Override public void write(      Writer os) throws IOException {
        os.write("after");
        os.flush();
        assertTrue("implementation of AtomicFileOutputStream has changed, update the test",tmp.exists());
        throw new Error();
      }
    }
);
  }
 catch (  Error ex) {
    exception=true;
  }
  assertFalse("tmp file should have been deleted",tmp.exists());
  assertTrue("should have raised an exception",exception);
  assertEquals("before",getContent(target));
  target.delete();
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testOutputStreamFailureNE() throws IOException {
  File target=new File(tmpdir,"target.txt");
  final File tmp=new File(tmpdir,"target.txt.tmp");
  target.delete();
  assertFalse("file should not exist",target.exists());
  boolean exception=false;
  try {
    new AtomicFileWritingIdiom(target,new OutputStreamStatement(){
      @Override public void write(      OutputStream os) throws IOException {
        os.write("after".getBytes("ASCII"));
        os.flush();
        assertTrue("implementation of AtomicFileOutputStream has changed, update the test",tmp.exists());
        throw new RuntimeException();
      }
    }
);
  }
 catch (  RuntimeException ex) {
    exception=true;
  }
  assertFalse("tmp file should have been deleted",tmp.exists());
  assertTrue("should have raised an exception",exception);
  assertFalse("file should not exist",target.exists());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.recipes.queue.DistributedQueueTest </h4><pre class="type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTakeWait1() throws Exception {
  String dir="/testTakeWait1";
  final String testString="Hello World";
  final int num_clients=1;
  final ZooKeeper clients[]=new ZooKeeper[num_clients];
  final DistributedQueue queueHandles[]=new DistributedQueue[num_clients];
  for (int i=0; i < clients.length; i++) {
    clients[i]=createClient();
    queueHandles[i]=new DistributedQueue(clients[i],dir,null);
  }
  final byte[] takeResult[]=new byte[1][];
  Thread takeThread=new Thread(){
    public void run(){
      try {
        takeResult[0]=queueHandles[0].take();
      }
 catch (      KeeperException e) {
      }
catch (      InterruptedException e) {
      }
    }
  }
;
  takeThread.start();
  Thread.sleep(1000);
  Thread offerThread=new Thread(){
    public void run(){
      try {
        queueHandles[0].offer(testString.getBytes());
      }
 catch (      KeeperException e) {
      }
catch (      InterruptedException e) {
      }
    }
  }
;
  offerThread.start();
  offerThread.join();
  takeThread.join();
  Assert.assertTrue(takeResult[0] != null);
  Assert.assertEquals(new String(takeResult[0]),testString);
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testRemove1() throws Exception {
  String dir="/testRemove1";
  String testString="Hello World";
  final int num_clients=1;
  ZooKeeper clients[]=new ZooKeeper[num_clients];
  DistributedQueue queueHandles[]=new DistributedQueue[num_clients];
  for (int i=0; i < clients.length; i++) {
    clients[i]=createClient();
    queueHandles[i]=new DistributedQueue(clients[i],dir,null);
  }
  try {
    queueHandles[0].remove();
  }
 catch (  NoSuchElementException e) {
    return;
  }
  Assert.assertTrue(false);
}

</code></pre>

<br>
<pre class="type-9 type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTakeWait2() throws Exception {
  String dir="/testTakeWait2";
  final String testString="Hello World";
  final int num_clients=1;
  final ZooKeeper clients[]=new ZooKeeper[num_clients];
  final DistributedQueue queueHandles[]=new DistributedQueue[num_clients];
  for (int i=0; i < clients.length; i++) {
    clients[i]=createClient();
    queueHandles[i]=new DistributedQueue(clients[i],dir,null);
  }
  int num_attempts=2;
  for (int i=0; i < num_attempts; i++) {
    final byte[] takeResult[]=new byte[1][];
    final String threadTestString=testString + i;
    Thread takeThread=new Thread(){
      public void run(){
        try {
          takeResult[0]=queueHandles[0].take();
        }
 catch (        KeeperException e) {
        }
catch (        InterruptedException e) {
        }
      }
    }
;
    takeThread.start();
    Thread.sleep(1000);
    Thread offerThread=new Thread(){
      public void run(){
        try {
          queueHandles[0].offer(threadTestString.getBytes());
        }
 catch (        KeeperException e) {
        }
catch (        InterruptedException e) {
        }
      }
    }
;
    offerThread.start();
    offerThread.join();
    takeThread.join();
    Assert.assertTrue(takeResult[0] != null);
    Assert.assertEquals(new String(takeResult[0]),threadTestString);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.CRCTest </h4><pre class="type-5 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * test checksums for the logs and snapshots.
 * the reader should fail on reading
 * a corrupt snapshot and a corrupt log
 * file
 * @throws Exception
 */
@Test public void testChecksums() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(150);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  LOG.info("starting up the zookeeper server .. waiting");
  Assert.assertTrue("waiting for server being up",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
  try {
    for (int i=0; i < 2000; i++) {
      zk.create("/crctest- " + i,("/crctest- " + i).getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    }
  }
  finally {
    zk.close();
  }
  f.shutdown();
  zks.shutdown();
  Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown(HOSTPORT,ClientBase.CONNECTION_TIMEOUT));
  File versionDir=new File(tmpDir,"version-2");
  File[] list=versionDir.listFiles();
  File snapFile=null;
  File logFile=null;
  for (  File file : list) {
    LOG.info("file is " + file);
    if (file.getName().startsWith("log")) {
      logFile=file;
      corruptFile(logFile);
    }
  }
  FileTxnLog flog=new FileTxnLog(versionDir);
  TxnIterator itr=flog.read(1);
  try {
    while (itr.next()) {
    }
    Assert.assertTrue(false);
  }
 catch (  IOException ie) {
    LOG.info("crc corruption",ie);
  }
  itr.close();
  FileSnap snap=new FileSnap(versionDir);
  List<File> snapFiles=snap.findNRecentSnapshots(2);
  snapFile=snapFiles.get(0);
  corruptFile(snapFile);
  boolean cfile=false;
  try {
    cfile=getCheckSum(snap,snapFile);
  }
 catch (  IOException ie) {
    snapFile=snapFiles.get(1);
    corruptFile(snapFile);
    cfile=getCheckSum(snap,snapFile);
  }
  Assert.assertTrue(cfile);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.CreateContainerTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test(timeout=30000) public void testCreateWithStat() throws IOException, KeeperException, InterruptedException {
  Stat stat=createWithStatVerifyResult("/foo");
  Stat childStat=createWithStatVerifyResult("/foo/child");
  Assert.assertFalse(stat.equals(childStat));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testSimpleDeletionAsync() throws IOException, KeeperException, InterruptedException {
  final CountDownLatch latch=new CountDownLatch(1);
  AsyncCallback.Create2Callback cb=new AsyncCallback.Create2Callback(){
    @Override public void processResult(    int rc,    String path,    Object ctx,    String name,    Stat stat){
      Assert.assertEquals(ctx,"context");
      latch.countDown();
    }
  }
;
  zk.create("/foo",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.CONTAINER,cb,"context");
  Assert.assertTrue(latch.await(5,TimeUnit.SECONDS));
  zk.create("/foo/bar",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.delete("/foo/bar",-1);
  ContainerManager containerManager=new ContainerManager(serverFactory.getZooKeeperServer().getZKDatabase(),serverFactory.getZooKeeperServer().firstProcessor,1,100);
  containerManager.checkContainers();
  Thread.sleep(1000);
  Assert.assertNull("Container should have been deleted",zk.exists("/foo",false));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.DataTreeTest </h4><pre class="type-2 type-6 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies values related to public fields.
"></span><br>
/** 
 * For ZOOKEEPER-1046 test if cversion is getting incremented correctly.
 */
@Test(timeout=60000) public void testIncrementCversion() throws Exception {
  dt.createNode("/test",new byte[0],null,0,dt.getNode("/").stat.getCversion() + 1,1,1);
  DataNode zk=dt.getNode("/test");
  int prevCversion=zk.stat.getCversion();
  long prevPzxid=zk.stat.getPzxid();
  dt.setCversionPzxid("/test/",prevCversion + 1,prevPzxid + 1);
  int newCversion=zk.stat.getCversion();
  long newPzxid=zk.stat.getPzxid();
  Assert.assertTrue("<cversion, pzxid> verification failed. Expected: <" + (prevCversion + 1) + ", "+ (prevPzxid + 1)+ ">, found: <"+ newCversion+ ", "+ newPzxid+ ">",(newCversion == prevCversion + 1 && newPzxid == prevPzxid + 1));
}

</code></pre>

<br>
<pre class="type-5 type-10 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
"></span><br>
@Test(timeout=60000) public void testSerializeDoesntLockDataNodeWhileWriting() throws Exception {
  DataTree tree=new DataTree();
  tree.createNode("/marker",new byte[]{42},null,-1,1,1,1);
  final DataNode markerNode=tree.getNode("/marker");
  final AtomicBoolean ranTestCase=new AtomicBoolean();
  DataOutputStream out=new DataOutputStream(new ByteArrayOutputStream());
  BinaryOutputArchive oa=new BinaryOutputArchive(out){
    @Override public void writeRecord(    Record r,    String tag) throws IOException {
      DataNode node=(DataNode)r;
      if (node.data.length == 1 && node.data[0] == 42) {
        final Semaphore semaphore=new Semaphore(0);
        new Thread(new Runnable(){
          @Override public void run(){
synchronized (markerNode) {
              semaphore.release();
            }
          }
        }
).start();
        try {
          boolean acquired=semaphore.tryAcquire(30,TimeUnit.SECONDS);
          Assert.assertTrue("Couldn't acquire a lock on the DataNode while we were calling tree.serialize",acquired);
        }
 catch (        InterruptedException e1) {
          throw new RuntimeException(e1);
        }
        ranTestCase.set(true);
      }
      super.writeRecord(r,tag);
    }
  }
;
  tree.serialize(oa,"test");
  Assert.assertTrue("Didn't find the expected node",ranTestCase.get());
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * For ZOOKEEPER-1755 - Test race condition when taking dumpEphemerals and
 * removing the session related ephemerals from DataTree structure
 */
@Test(timeout=60000) public void testDumpEphemerals() throws Exception {
  int count=1000;
  long session=1000;
  long zxid=2000;
  final DataTree dataTree=new DataTree();
  LOG.info("Create {} zkclient sessions and its ephemeral nodes",count);
  createEphemeralNode(session,dataTree,count);
  final AtomicBoolean exceptionDuringDumpEphemerals=new AtomicBoolean(false);
  final AtomicBoolean running=new AtomicBoolean(true);
  Thread thread=new Thread(){
    public void run(){
      PrintWriter pwriter=new PrintWriter(new StringWriter());
      try {
        while (running.get()) {
          dataTree.dumpEphemerals(pwriter);
        }
      }
 catch (      Exception e) {
        LOG.error("Received exception while dumpEphemerals!",e);
        exceptionDuringDumpEphemerals.set(true);
      }
    }
  }
;
  thread.start();
  LOG.debug("Killing {} zkclient sessions and its ephemeral nodes",count);
  killZkClientSession(session,zxid,dataTree,count);
  running.set(false);
  thread.join();
  Assert.assertFalse("Should have got exception while dumpEphemerals!",exceptionDuringDumpEphemerals.get());
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test(timeout=60000) public void testRootWatchTriggered() throws Exception {
class MyWatcher implements Watcher {
    boolean fired=false;
    public void process(    WatchedEvent event){
      if (event.getPath().equals("/"))       fired=true;
    }
  }
  MyWatcher watcher=new MyWatcher();
  dt.getChildren("/",new Stat(),watcher);
  dt.createNode("/xyz",new byte[0],null,0,dt.getNode("/").stat.getCversion() + 1,1,1);
  Assert.assertFalse("Root node watch not triggered",!watcher.fired);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.InvalidSnapCountTest </h4><pre class="type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify the ability to start a standalone server instance.
 */
@Test public void testInvalidSnapCount() throws Exception {
  final int CLIENT_PORT=3181;
  MainThread main=new MainThread(CLIENT_PORT);
  main.start();
  Assert.assertTrue("waiting for server being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT,CONNECTION_TIMEOUT));
  Assert.assertEquals(SyncRequestProcessor.getSnapCount(),2);
  main.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.InvalidSnapshotTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Validate that the server can come up on an invalid snapshot - by
 * reverting to a prior snapshot + associated logs.
 */
@Test public void testInvalidSnapshot() throws Exception {
  ZooKeeper zk=createClient();
  try {
    for (int i=0; i < 2000; i++) {
      zk.create("/invalidsnap-" + i,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    }
  }
  finally {
    zk.close();
  }
  NIOServerCnxnFactory factory=(NIOServerCnxnFactory)serverFactory;
  stopServer();
  File snapFile=factory.zkServer.getTxnLogFactory().findMostRecentSnapshot();
  LOG.info("Corrupting " + snapFile);
  RandomAccessFile raf=new RandomAccessFile(snapFile,"rws");
  raf.setLength(3);
  raf.close();
  startServer();
  zk=createClient();
  try {
    assertTrue("the node should exist",(zk.exists("/invalidsnap-1999",false) != null));
  }
  finally {
    zk.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.NIOServerCnxnTest </h4><pre class="type-3 type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test operations on ServerCnxn after socket closure.
 */
@Test(timeout=60000) public void testOperationsAfterCnxnClose() throws IOException, InterruptedException, KeeperException {
  final ZooKeeper zk=createClient();
  final String path="/a";
  try {
    zk.create(path,"test".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    Assert.assertNotNull("Didn't create znode:" + path,zk.exists(path,false));
    Assert.assertTrue("Didn't instantiate ServerCnxnFactory with NIOServerCnxnFactory!",serverFactory instanceof NIOServerCnxnFactory);
    Iterable<ServerCnxn> connections=serverFactory.getConnections();
    for (    ServerCnxn serverCnxn : connections) {
      serverCnxn.close();
      try {
        serverCnxn.toString();
      }
 catch (      Exception e) {
        LOG.error("Exception while getting connection details!",e);
        Assert.fail("Shouldn't throw exception while " + "getting connection details!");
      }
    }
  }
  finally {
    zk.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.NettyServerCnxnTest </h4><pre class="type-9 type-10 type-3 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies the channel closure - while closing the channel
 * servercnxnfactory should remove all channel references to avoid
 * duplicate channel closure. Duplicate closure may result in indefinite
 * hanging due to netty open issue.
 * @see <a href="https://issues.jboss.org/browse/NETTY-412">NETTY-412</a>
 */
@Test(timeout=40000) public void testSendCloseSession() throws Exception {
  Assert.assertTrue("Didn't instantiate ServerCnxnFactory with NettyServerCnxnFactory!",serverFactory instanceof NettyServerCnxnFactory);
  final ZooKeeper zk=createClient();
  final String path="/a";
  try {
    zk.create(path,"test".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    Assert.assertNotNull("Didn't create znode:" + path,zk.exists(path,false));
    Iterable<ServerCnxn> connections=serverFactory.getConnections();
    Assert.assertEquals("Mismatch in number of live connections!",1,serverFactory.getNumAliveConnections());
    for (    ServerCnxn serverCnxn : connections) {
      serverCnxn.sendCloseSession();
    }
    LOG.info("Waiting for the channel disconnected event");
    int timeout=0;
    while (serverFactory.getNumAliveConnections() != 0) {
      Thread.sleep(1000);
      timeout+=1000;
      if (timeout > CONNECTION_TIMEOUT) {
        Assert.fail("The number of live connections should be 0");
      }
    }
  }
  finally {
    zk.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.PrepRequestProcessorTest </h4><pre class="type-13 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Before public void setup() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(100);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  servcnxnf=ServerCnxnFactory.createFactory(PORT,-1);
  servcnxnf.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  zks.sessionTracker=new MySessionTracker();
}

</code></pre>

<br>
<pre class="type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPRequest() throws Exception {
  pLatch=new CountDownLatch(1);
  processor=new PrepRequestProcessor(zks,new MyRequestProcessor());
  Request foo=new Request(null,1l,1,OpCode.create,ByteBuffer.allocate(3),null);
  processor.pRequest(foo);
  Assert.assertEquals("Request should have marshalling error",new ErrorTxn(KeeperException.Code.MARSHALLINGERROR.intValue()),outcome.getTxn());
  Assert.assertTrue("request hasn't been processed in chain",pLatch.await(5,TimeUnit.SECONDS));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.PurgeTxnTest </h4><pre class="type-3 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests purge when logs are rolling or a new snapshot is created, then
 * these newer files should alse be excluded in the current cycle.
 * For frequent snapshotting, configured SnapCount to 30. There are three
 * threads which will create 1000 znodes each and simultaneously do purge
 * call
 */
@Test public void testPurgeWhenLogRollingInProgress() throws Exception {
  tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(30);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  final ZooKeeper zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
  final CountDownLatch doPurge=new CountDownLatch(1);
  final CountDownLatch purgeFinished=new CountDownLatch(1);
  final AtomicBoolean opFailed=new AtomicBoolean(false);
  new Thread(){
    public void run(){
      try {
        doPurge.await(OP_TIMEOUT_IN_MILLIS / 2,TimeUnit.MILLISECONDS);
        PurgeTxnLog.purge(tmpDir,tmpDir,3);
      }
 catch (      IOException ioe) {
        LOG.error("Exception when purge",ioe);
        opFailed.set(true);
      }
catch (      InterruptedException ie) {
        LOG.error("Exception when purge",ie);
        opFailed.set(true);
      }
 finally {
        purgeFinished.countDown();
      }
    }
  }
.start();
  final int thCount=3;
  List<String> znodes=manyClientOps(zk,doPurge,thCount,"/invalidsnap");
  Assert.assertTrue("Purging is not finished!",purgeFinished.await(OP_TIMEOUT_IN_MILLIS,TimeUnit.MILLISECONDS));
  Assert.assertFalse("Purging failed!",opFailed.get());
  for (  String znode : znodes) {
    try {
      zk.getData(znode,false,null);
    }
 catch (    Exception ke) {
      LOG.error("Unexpected exception when visiting znode!",ke);
      Assert.fail("Unexpected exception when visiting znode!");
    }
  }
  zk.close();
  f.shutdown();
  zks.shutdown();
  zks.getTxnLogFactory().close();
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests finding n recent snapshots from set of snapshots and data logs
 */
@Test public void testFindNRecentSnapshots() throws Exception {
  int nRecentSnap=4;
  int nRecentCount=30;
  int offset=0;
  tmpDir=ClientBase.createTmpDir();
  File version2=new File(tmpDir.toString(),"version-2");
  Assert.assertTrue("Failed to create version_2 dir:" + version2.toString(),version2.mkdir());
  List<File> expectedNRecentSnapFiles=new ArrayList<File>();
  int counter=offset + (2 * nRecentCount);
  for (int i=0; i < nRecentCount; i++) {
    File logFile=new File(version2 + "/log." + Long.toHexString(--counter));
    Assert.assertTrue("Failed to create log File:" + logFile.toString(),logFile.createNewFile());
    File snapFile=new File(version2 + "/snapshot." + Long.toHexString(--counter));
    Assert.assertTrue("Failed to create snap File:" + snapFile.toString(),snapFile.createNewFile());
    if (i < nRecentSnap) {
      expectedNRecentSnapFiles.add(snapFile);
    }
  }
  FileTxnSnapLog txnLog=new FileTxnSnapLog(tmpDir,tmpDir);
  List<File> nRecentSnapFiles=txnLog.findNRecentSnapshots(nRecentSnap);
  txnLog.close();
  Assert.assertEquals("exactly 4 snapshots ",4,nRecentSnapFiles.size());
  expectedNRecentSnapFiles.removeAll(nRecentSnapFiles);
  Assert.assertEquals("Didn't get the recent snap files",0,expectedNRecentSnapFiles.size());
}

</code></pre>

<br>
<pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Tests purge where the data directory contains snap files equals to the
 * number of files to be retained
 */
@Test public void testSnapFilesEqualsToRetain() throws Exception {
  int nRecentCount=3;
  AtomicInteger offset=new AtomicInteger(0);
  tmpDir=ClientBase.createTmpDir();
  File version2=new File(tmpDir.toString(),"version-2");
  Assert.assertTrue("Failed to create version_2 dir:" + version2.toString(),version2.mkdir());
  List<File> snaps=new ArrayList<File>();
  List<File> logs=new ArrayList<File>();
  createDataDirFiles(offset,nRecentCount,version2,snaps,logs);
  FileTxnSnapLog txnLog=new FileTxnSnapLog(tmpDir,tmpDir);
  PurgeTxnLog.retainNRecentSnapshots(txnLog,snaps);
  txnLog.close();
  verifyFilesAfterPurge(snaps,true);
  verifyFilesAfterPurge(logs,true);
}

</code></pre>

<br>
<pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Tests purge where the data directory contains old snapshots and data
 * logs, newest snapshots and data logs, (newest + n) snapshots and data
 * logs
 */
@Test public void testSnapFilesGreaterThanToRetain() throws Exception {
  int nRecentCount=4;
  int fileAboveRecentCount=4;
  int fileToPurgeCount=2;
  AtomicInteger offset=new AtomicInteger(0);
  tmpDir=ClientBase.createTmpDir();
  File version2=new File(tmpDir.toString(),"version-2");
  Assert.assertTrue("Failed to create version_2 dir:" + version2.toString(),version2.mkdir());
  List<File> snapsToPurge=new ArrayList<File>();
  List<File> logsToPurge=new ArrayList<File>();
  List<File> snaps=new ArrayList<File>();
  List<File> logs=new ArrayList<File>();
  List<File> snapsAboveRecentFiles=new ArrayList<File>();
  List<File> logsAboveRecentFiles=new ArrayList<File>();
  createDataDirFiles(offset,fileToPurgeCount,version2,snapsToPurge,logsToPurge);
  createDataDirFiles(offset,nRecentCount,version2,snaps,logs);
  createDataDirFiles(offset,fileAboveRecentCount,version2,snapsAboveRecentFiles,logsAboveRecentFiles);
  FileTxnSnapLog txnLog=new FileTxnSnapLog(tmpDir,tmpDir);
  PurgeTxnLog.retainNRecentSnapshots(txnLog,snaps);
  txnLog.close();
  verifyFilesAfterPurge(snapsToPurge,false);
  verifyFilesAfterPurge(logsToPurge,false);
  verifyFilesAfterPurge(snaps,true);
  verifyFilesAfterPurge(logs,true);
  verifyFilesAfterPurge(snapsAboveRecentFiles,true);
  verifyFilesAfterPurge(logsAboveRecentFiles,true);
}

</code></pre>

<br>
<pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Tests purge where the data directory contains old snapshots and data
 * logs, newest snapshots and data logs
 */
@Test public void testSnapFilesLessThanToRetain() throws Exception {
  int nRecentCount=4;
  int fileToPurgeCount=2;
  AtomicInteger offset=new AtomicInteger(0);
  tmpDir=ClientBase.createTmpDir();
  File version2=new File(tmpDir.toString(),"version-2");
  Assert.assertTrue("Failed to create version_2 dir:" + version2.toString(),version2.mkdir());
  List<File> snapsToPurge=new ArrayList<File>();
  List<File> logsToPurge=new ArrayList<File>();
  List<File> snaps=new ArrayList<File>();
  List<File> logs=new ArrayList<File>();
  createDataDirFiles(offset,fileToPurgeCount,version2,snapsToPurge,logsToPurge);
  createDataDirFiles(offset,nRecentCount,version2,snaps,logs);
  FileTxnSnapLog txnLog=new FileTxnSnapLog(tmpDir,tmpDir);
  PurgeTxnLog.retainNRecentSnapshots(txnLog,snaps);
  txnLog.close();
  verifyFilesAfterPurge(snapsToPurge,false);
  verifyFilesAfterPurge(logsToPurge,false);
  verifyFilesAfterPurge(snaps,true);
  verifyFilesAfterPurge(logs,true);
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * test the purge
 * @throws Exception an exception might be thrown here
 */
@Test public void testPurge() throws Exception {
  tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(100);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
  try {
    for (int i=0; i < 2000; i++) {
      zk.create("/invalidsnap-" + i,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    }
  }
  finally {
    zk.close();
  }
  f.shutdown();
  zks.getTxnLogFactory().close();
  Assert.assertTrue("waiting for server to shutdown",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
  PurgeTxnLog.purge(tmpDir,tmpDir,3);
  FileTxnSnapLog snaplog=new FileTxnSnapLog(tmpDir,tmpDir);
  List<File> listLogs=snaplog.findNRecentSnapshots(4);
  int numSnaps=0;
  for (  File ff : listLogs) {
    if (ff.getName().startsWith("snapshot")) {
      numSnaps++;
    }
  }
  Assert.assertTrue("exactly 3 snapshots ",(numSnaps == 3));
  snaplog.close();
  zks.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.SessionTrackerTest </h4><pre class="type-5 type-3 type-2 type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify the create session call in the Leader.FinalRequestProcessor after
 * the session expiration.
 */
@Test(timeout=20000) public void testAddSessionAfterSessionExpiry() throws Exception {
  ZooKeeperServer zks=setupSessionTracker();
  latch=new CountDownLatch(1);
  zks.sessionTracker.addSession(sessionId,sessionTimeout);
  SessionTrackerImpl sessionTrackerImpl=(SessionTrackerImpl)zks.sessionTracker;
  SessionImpl sessionImpl=sessionTrackerImpl.sessionsById.get(sessionId);
  Assert.assertNotNull("Sessionid:" + sessionId + " doesn't exists in sessiontracker",sessionImpl);
  Object sessionOwner=new Object();
  sessionTrackerImpl.checkSession(sessionId,sessionOwner);
  latch.await(sessionTimeout * 2,TimeUnit.MILLISECONDS);
  sessionTrackerImpl.addSession(sessionId,sessionTimeout);
  try {
    sessionTrackerImpl.checkSession(sessionId,sessionOwner);
    Assert.fail("Should throw session expiry exception " + "as the session has expired and closed");
  }
 catch (  KeeperException.SessionExpiredException e) {
  }
  Assert.assertTrue("Session didn't expired",sessionImpl.isClosing());
  Assert.assertFalse("Session didn't expired",sessionTrackerImpl.touchSession(sessionId,sessionTimeout));
  Assert.assertEquals("Duplicate session expiry request has been generated",1,firstProcessor.getCountOfCloseSessionReq());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.WatchesPathReportTest </h4><pre class="type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetSessions(){
  Set<Long> s=r.getSessions("path1");
  assertEquals(2,s.size());
  assertTrue(s.contains(101L));
  assertTrue(s.contains(102L));
  s=r.getSessions("path2");
  assertEquals(1,s.size());
  assertTrue(s.contains(201L));
  assertNull(r.getSessions("path3"));
}

</code></pre>

<br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testHasSessions(){
  assertTrue(r.hasSessions("path1"));
  assertTrue(r.hasSessions("path2"));
  assertFalse(r.hasSessions("path3"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.WatchesReportTest </h4><pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testHasPaths(){
  assertTrue(r.hasPaths(1L));
  assertTrue(r.hasPaths(2L));
  assertFalse(r.hasPaths(3L));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetPaths(){
  Set<String> s=r.getPaths(1L);
  assertEquals(2,s.size());
  assertTrue(s.contains("path1a"));
  assertTrue(s.contains("path1b"));
  s=r.getPaths(2L);
  assertEquals(1,s.size());
  assertTrue(s.contains("path2a"));
  assertNull(r.getPaths(3L));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.ZooKeeperServerBeanTest </h4><pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetSecureClientAddress() throws IOException {
  ZooKeeperServer zks=new ZooKeeperServer();
  ZooKeeperServerBean serverBean=new ZooKeeperServerBean(zks);
  String result=serverBean.getSecureClientPort();
  assertEquals("",result);
  ServerCnxnFactory cnxnFactory=ServerCnxnFactory.createFactory();
  int secureClientPort=8443;
  InetSocketAddress address=new InetSocketAddress(secureClientPort);
  cnxnFactory.configure(address,5,true);
  zks.setSecureServerCnxnFactory(cnxnFactory);
  result=serverBean.getSecureClientAddress();
  String ipv4="0.0.0.0:" + secureClientPort;
  String ipv6="0:0:0:0:0:0:0:0:" + secureClientPort;
  assertTrue(result.equals(ipv4) || result.equals(ipv6));
  cnxnFactory.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.ZooKeeperServerMainTest </h4><pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify the ability to start a standalone server instance.
 */
@Test public void testStandalone() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT=PortAssignment.unique();
  MainThread main=new MainThread(CLIENT_PORT,true,null);
  main.start();
  Assert.assertTrue("waiting for server being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=new ZooKeeper("127.0.0.1:" + CLIENT_PORT,ClientBase.CONNECTION_TIMEOUT,this);
  zk.create("/foo","foobar".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertEquals(new String(zk.getData("/foo",null,null)),"foobar");
  zk.close();
  main.shutdown();
  main.join();
  main.deleteDirs();
  Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT,ClientBase.CONNECTION_TIMEOUT));
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Test verifies server should fail when data dir or data log dir doesn't
 * exists. Sets "zookeeper.datadir.autocreate" to false.
 */
@Test(timeout=30000) public void testWithoutAutoCreateDataLogDir() throws Exception {
  ClientBase.setupTestEnv();
  System.setProperty(FileTxnSnapLog.ZOOKEEPER_DATADIR_AUTOCREATE,"false");
  try {
    final int CLIENT_PORT=PortAssignment.unique();
    MainThread main=new MainThread(CLIENT_PORT,false,null);
    String args[]=new String[1];
    args[0]=main.confFile.toString();
    main.start();
    Assert.assertFalse("waiting for server being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT,CONNECTION_TIMEOUT / 2));
  }
  finally {
    System.setProperty(FileTxnSnapLog.ZOOKEEPER_DATADIR_AUTOCREATE,FileTxnSnapLog.ZOOKEEPER_DATADIR_AUTOCREATE_DEFAULT);
  }
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Test verifies that the server is able to redefine if user configured only
 * minSessionTimeout limit
 */
@Test public void testWithOnlyMinSessionTimeout() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT=PortAssignment.unique();
  final int tickTime=2000;
  final int minSessionTimeout=tickTime * 2 - 100;
  int maxSessionTimeout=20 * tickTime;
  final String configs="minSessionTimeout=" + minSessionTimeout + "\n";
  MainThread main=new MainThread(CLIENT_PORT,false,configs);
  main.start();
  String HOSTPORT="127.0.0.1:" + CLIENT_PORT;
  Assert.assertTrue("waiting for server being up",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  verifySessionTimeOut(minSessionTimeout,minSessionTimeout,HOSTPORT);
  verifySessionTimeOut(minSessionTimeout - 2000,minSessionTimeout,HOSTPORT);
  verifySessionTimeOut(maxSessionTimeout,maxSessionTimeout,HOSTPORT);
  verifySessionTimeOut(maxSessionTimeout + 2000,maxSessionTimeout,HOSTPORT);
  main.shutdown();
  Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown(HOSTPORT,ClientBase.CONNECTION_TIMEOUT));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies the auto creation of data dir and data log dir.
 * Sets "zookeeper.datadir.autocreate" to true.
 */
@Test(timeout=30000) public void testWithAutoCreateDataLogDir() throws Exception {
  ClientBase.setupTestEnv();
  System.setProperty(FileTxnSnapLog.ZOOKEEPER_DATADIR_AUTOCREATE,"true");
  final int CLIENT_PORT=PortAssignment.unique();
  MainThread main=new MainThread(CLIENT_PORT,false,null);
  String args[]=new String[1];
  args[0]=main.confFile.toString();
  main.start();
  Assert.assertTrue("waiting for server being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=new ZooKeeper("127.0.0.1:" + CLIENT_PORT,ClientBase.CONNECTION_TIMEOUT,this);
  zk.create("/foo","foobar".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertEquals(new String(zk.getData("/foo",null,null)),"foobar");
  zk.close();
  main.shutdown();
  main.join();
  main.deleteDirs();
  Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT,ClientBase.CONNECTION_TIMEOUT));
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Test verifies that the server is able to redefine the min/max session
 * timeouts
 */
@Test public void testMinMaxSessionTimeOut() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT=PortAssignment.unique();
  final int tickTime=2000;
  final int minSessionTimeout=tickTime * 2 - 100;
  final int maxSessionTimeout=20 * tickTime + 1000;
  final String configs="maxSessionTimeout=" + maxSessionTimeout + "\n"+ "minSessionTimeout="+ minSessionTimeout+ "\n";
  MainThread main=new MainThread(CLIENT_PORT,false,configs);
  main.start();
  String HOSTPORT="127.0.0.1:" + CLIENT_PORT;
  Assert.assertTrue("waiting for server being up",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  verifySessionTimeOut(minSessionTimeout,minSessionTimeout,HOSTPORT);
  verifySessionTimeOut(minSessionTimeout - 2000,minSessionTimeout,HOSTPORT);
  verifySessionTimeOut(maxSessionTimeout,maxSessionTimeout,HOSTPORT);
  verifySessionTimeOut(maxSessionTimeout + 2000,maxSessionTimeout,HOSTPORT);
  main.shutdown();
  Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown(HOSTPORT,ClientBase.CONNECTION_TIMEOUT));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.ZooKeeperServerTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testForceSyncDefaultDisabled(){
  try {
    File file=new File("foo.10027c6de");
    System.setProperty("zookeeper.forceSync","no");
    FileTxnLog log=new FileTxnLog(file);
    Assert.assertFalse(log.isForceSync());
  }
  finally {
    System.setProperty("zookeeper.forceSync","yes");
  }
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testForceSyncDefaultEnabled(){
  File file=new File("foo.10027c6de");
  FileTxnLog log=new FileTxnLog(file);
  Assert.assertTrue(log.isForceSync());
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testInvalidSnapshot(){
  File f=null;
  File tmpFileDir=null;
  try {
    tmpFileDir=ClientBase.createTmpDir();
    f=new File(tmpFileDir,"snapshot.0");
    if (!f.exists()) {
      f.createNewFile();
    }
    Assert.assertFalse("Snapshot file size is greater than 9 bytes",Util.isValidSnapshot(f));
    Assert.assertTrue("Can't delete file",f.delete());
  }
 catch (  IOException e) {
  }
 finally {
    if (null != tmpFileDir) {
      ClientBase.recursiveDelete(tmpFileDir);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.ZooKeeperThreadTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Test verifies uncaught exception handling of ZooKeeperThread
 */
@Test(timeout=30000) public void testUncaughtException() throws Exception {
  MyThread t1=new MyThread("Test-Thread");
  t1.start();
  Assert.assertTrue("Uncaught exception is not properly handled.",runningLatch.await(10000,TimeUnit.MILLISECONDS));
  runningLatch=new CountDownLatch(1);
  MyCriticalThread t2=new MyCriticalThread("Test-Critical-Thread");
  t2.start();
  Assert.assertTrue("Uncaught exception is not properly handled.",runningLatch.await(10000,TimeUnit.MILLISECONDS));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.ZxidRolloverTest </h4><pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Similar to testRolloverThenRestart, but ensure we can survive multiple
 * epoch rollovers between restarts.
 */
@Test public void testMultipleRollover() throws Exception {
  ZooKeeper zk=getClient(idxFollower);
  int countCreated=createNodes(zk,0,10);
  adjustEpochNearEnd();
  countCreated+=createNodes(zk,countCreated,10);
  adjustEpochNearEnd();
  countCreated+=createNodes(zk,countCreated,10);
  adjustEpochNearEnd();
  countCreated+=createNodes(zk,countCreated,10);
  adjustEpochNearEnd();
  countCreated+=createNodes(zk,countCreated,10);
  shutdownAll();
  startAll();
  zk=getClient(idxFollower);
  adjustEpochNearEnd();
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  shutdown(idxLeader);
  start(idxLeader);
  zk=getClient(idxFollower);
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  Assert.assertTrue(countCreated > 0);
  Assert.assertTrue(countCreated < 70);
}

</code></pre>

<br>
<pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Similar to testSimpleRollover, but ensure the cluster comes back,
 * has the right data, and is able to serve new requests.
 */
@Test public void testRolloverThenRestart() throws Exception {
  ZooKeeper zk=getClient(idxFollower);
  int countCreated=createNodes(zk,0,10);
  adjustEpochNearEnd();
  countCreated+=createNodes(zk,countCreated,10);
  shutdownAll();
  startAll();
  zk=getClient(idxLeader);
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  adjustEpochNearEnd();
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  shutdownAll();
  startAll();
  zk=getClient(idxFollower);
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  shutdownAll();
  startAll();
  zk=getClient(idxLeader);
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  Assert.assertTrue(countCreated > 0);
  Assert.assertTrue(countCreated < 60);
}

</code></pre>

<br>
<pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Similar to testRolloverThenRestart, but ensure a follower comes back,
 * has the right data, and is able to serve new requests.
 */
@Test public void testRolloverThenFollowerRestart() throws Exception {
  ZooKeeper zk=getClient(idxFollower);
  int countCreated=createNodes(zk,0,10);
  adjustEpochNearEnd();
  countCreated+=createNodes(zk,countCreated,10);
  shutdown(idxFollower);
  start(idxFollower);
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  adjustEpochNearEnd();
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  shutdown(idxFollower);
  start(idxFollower);
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  shutdown(idxFollower);
  start(idxFollower);
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  Assert.assertTrue(countCreated > 0);
  Assert.assertTrue(countCreated < 60);
}

</code></pre>

<br>
<pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Similar to testRolloverThenRestart, but ensure leadership can change,
 * comes back, has the right data, and is able to serve new requests.
 */
@Test public void testRolloverThenLeaderRestart() throws Exception {
  ZooKeeper zk=getClient(idxLeader);
  int countCreated=createNodes(zk,0,10);
  adjustEpochNearEnd();
  checkNodes(zk,0,countCreated);
  shutdown(idxLeader);
  start(idxLeader);
  zk=getClient(idxLeader);
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  adjustEpochNearEnd();
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  shutdown(idxLeader);
  start(idxLeader);
  zk=getClient(idxLeader);
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  shutdown(idxLeader);
  start(idxLeader);
  zk=getClient(idxFollower);
  checkNodes(zk,0,countCreated);
  countCreated+=createNodes(zk,countCreated,10);
  Assert.assertTrue(countCreated > 0);
  Assert.assertTrue(countCreated < 50);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.admin.JettyAdminServerTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Starts a standalone server and tests that we can query its AdminServer.
 */
@Test public void testStandalone() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT=PortAssignment.unique();
  ZooKeeperServerMainTest.MainThread main=new ZooKeeperServerMainTest.MainThread(CLIENT_PORT,false,null);
  main.start();
  Assert.assertTrue("waiting for server being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT,ClientBase.CONNECTION_TIMEOUT));
  queryAdminServer(jettyAdminPort);
  main.shutdown();
  Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT,ClientBase.CONNECTION_TIMEOUT));
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Starts a quorum of two servers and tests that we can query both AdminServers.
 */
@Test public void testQuorum() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT_QP1=PortAssignment.unique();
  final int CLIENT_PORT_QP2=PortAssignment.unique();
  final int ADMIN_SERVER_PORT1=PortAssignment.unique();
  final int ADMIN_SERVER_PORT2=PortAssignment.unique();
  String quorumCfgSection=String.format("server.1=127.0.0.1:%d:%d;%d\nserver.2=127.0.0.1:%d:%d;%d",PortAssignment.unique(),PortAssignment.unique(),CLIENT_PORT_QP1,PortAssignment.unique(),PortAssignment.unique(),CLIENT_PORT_QP2);
  QuorumPeerTestBase.MainThread q1=new QuorumPeerTestBase.MainThread(1,CLIENT_PORT_QP1,ADMIN_SERVER_PORT1,quorumCfgSection,null);
  q1.start();
  Thread.sleep(500);
  QuorumPeerTestBase.MainThread q2=new QuorumPeerTestBase.MainThread(2,CLIENT_PORT_QP2,ADMIN_SERVER_PORT2,quorumCfgSection,null);
  q2.start();
  Thread.sleep(500);
  Assert.assertTrue("waiting for server 1 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP1,ClientBase.CONNECTION_TIMEOUT));
  Assert.assertTrue("waiting for server 2 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP2,ClientBase.CONNECTION_TIMEOUT));
  queryAdminServer(ADMIN_SERVER_PORT1);
  queryAdminServer(ADMIN_SERVER_PORT2);
  q1.shutdown();
  q2.shutdown();
  Assert.assertTrue("waiting for server 1 down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_QP1,ClientBase.CONNECTION_TIMEOUT));
  Assert.assertTrue("waiting for server 2 down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_QP2,ClientBase.CONNECTION_TIMEOUT));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.jersey.CreateTest </h4><pre class="type-5 type-10 type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreate() throws Exception {
  WebResource wr=znodesr.path(path).queryParam("dataformat",encoding).queryParam("name",name);
  if (data == null) {
    wr=wr.queryParam("null","true");
  }
  if (sequence) {
    wr=wr.queryParam("sequence","true");
  }
  Builder builder=wr.accept(accept);
  ClientResponse cr;
  if (data == null) {
    cr=builder.post(ClientResponse.class);
  }
 else {
    cr=builder.post(ClientResponse.class,data);
  }
  Assert.assertEquals(expectedStatus,cr.getClientResponseStatus());
  if (expectedPath == null) {
    return;
  }
  ZPath zpath=cr.getEntity(ZPath.class);
  if (sequence) {
    Assert.assertTrue(zpath.path.startsWith(expectedPath.path));
    Assert.assertTrue(zpath.uri.startsWith(znodesr.path(path).toString()));
  }
 else {
    Assert.assertEquals(expectedPath,zpath);
    Assert.assertEquals(znodesr.path(path).toString(),zpath.uri);
  }
  byte[] data=zk.getData(zpath.path,false,new Stat());
  if (data == null && this.data == null) {
    return;
  }
 else   if (data == null || this.data == null) {
    Assert.assertEquals(data,this.data);
  }
 else {
    Assert.assertTrue(new String(data) + " == " + new String(this.data),Arrays.equals(data,this.data));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.jersey.RootTest </h4><pre class="type-5 type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreate() throws Exception {
  String path="/";
  String name="roottest-create";
  byte[] data="foo".getBytes();
  WebResource wr=znodesr.path(path).queryParam("dataformat","utf8").queryParam("name",name);
  Builder builder=wr.accept(MediaType.APPLICATION_JSON);
  ClientResponse cr;
  cr=builder.post(ClientResponse.class,data);
  Assert.assertEquals(ClientResponse.Status.CREATED,cr.getClientResponseStatus());
  ZPath zpath=cr.getEntity(ZPath.class);
  Assert.assertEquals(new ZPath(path + name),zpath);
  Assert.assertEquals(znodesr.path(path).toString(),zpath.uri);
  byte[] rdata=zk.getData(zpath.path,false,new Stat());
  Assert.assertTrue(new String(rdata) + " == " + new String(data),Arrays.equals(rdata,data));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.jersey.SessionTest </h4><pre class="type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeleteSession(){
  ZSession session=createSession("30");
  WebResource wr=sessionsr.path(session.id);
  Builder b=wr.accept(MediaType.APPLICATION_JSON);
  Assert.assertTrue(ZooKeeperService.isConnected(CONTEXT_PATH,session.id));
  ClientResponse cr=b.delete(ClientResponse.class,null);
  Assert.assertEquals(ClientResponse.Status.NO_CONTENT,cr.getClientResponseStatus());
  Assert.assertFalse(ZooKeeperService.isConnected(CONTEXT_PATH,session.id));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSendHeartbeat() throws InterruptedException {
  ZSession session=createSession("2");
  Thread.sleep(1000);
  WebResource wr=sessionsr.path(session.id);
  Builder b=wr.accept(MediaType.APPLICATION_JSON);
  ClientResponse cr=b.put(ClientResponse.class,null);
  Assert.assertEquals(ClientResponse.Status.OK,cr.getClientResponseStatus());
  Thread.sleep(1500);
  Assert.assertTrue(ZooKeeperService.isConnected(CONTEXT_PATH,session.id));
  Thread.sleep(1000);
  Assert.assertFalse(ZooKeeperService.isConnected(CONTEXT_PATH,session.id));
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testSessionExpires() throws InterruptedException {
  ZSession session=createSession("1");
  Assert.assertTrue(ZooKeeperService.isConnected(CONTEXT_PATH,session.id));
  Thread.sleep(1500);
  Assert.assertFalse(ZooKeeperService.isConnected(CONTEXT_PATH,session.id));
}

</code></pre>

<br>
<pre class="type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateNewSession() throws JSONException {
  ZSession session=createSession();
  Assert.assertEquals(session.id.length(),36);
  Assert.assertTrue(ZooKeeperService.isConnected(CONTEXT_PATH,session.id));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.jersey.SetTest </h4><pre class="type-5 type-10 type-3 type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSet() throws Exception {
  if (expectedStat != null) {
    zk.create(expectedStat.path,"initial".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  }
  WebResource wr=znodesr.path(path).queryParam("dataformat",encoding);
  if (data == null) {
    wr=wr.queryParam("null","true");
  }
  Builder builder=wr.accept(accept).type(MediaType.APPLICATION_OCTET_STREAM);
  ClientResponse cr;
  if (data == null) {
    cr=builder.put(ClientResponse.class);
  }
 else {
    cr=builder.put(ClientResponse.class,new String(data));
  }
  Assert.assertEquals(expectedStatus,cr.getClientResponseStatus());
  if (expectedStat == null) {
    return;
  }
  ZStat zstat=cr.getEntity(ZStat.class);
  Assert.assertEquals(expectedStat,zstat);
  byte[] data=zk.getData(zstat.path,false,new Stat());
  if (data == null && this.data == null) {
    return;
  }
 else   if (data == null || this.data == null) {
    Assert.fail((data == null ? null : new String(data)) + " == " + (this.data == null ? null : new String(this.data)));
  }
 else {
    Assert.assertTrue(new String(data) + " == " + new String(this.data),Arrays.equals(data,this.data));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.jersey.WadlTest </h4><pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testApplicationWadl(){
  WebResource r=client.resource(BASEURI);
  String serviceWadl=r.path("application.wadl").accept(MediaTypes.WADL).get(String.class);
  Assert.assertTrue("Something wrong. Returned wadl length not > 0.",serviceWadl.length() > 0);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.CommitProcessorConcurrencyTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void raceTest() throws Exception {
  ByteArrayOutputStream boas=new ByteArrayOutputStream();
  BinaryOutputArchive boa=BinaryOutputArchive.getArchive(boas);
  GetDataRequest getReq=new GetDataRequest("/testrace",false);
  getReq.serialize(boa,"request");
  ByteBuffer bb=ByteBuffer.wrap(boas.toByteArray());
  Request readReq=new Request(null,0x0,0,OpCode.getData,bb,new ArrayList<Id>());
  boas.reset();
  SyncRequest syncReq=new SyncRequest("/testrace");
  syncReq.serialize(boa,"request");
  bb=ByteBuffer.wrap(boas.toByteArray());
  Request writeReq=new Request(null,0x0,0,OpCode.sync,bb,new ArrayList<Id>());
  processor.addToCommittedRequests(writeReq);
  processor.addToQueuedRequests(readReq);
  processor.addToQueuedRequests(writeReq);
  processor.testStart();
  processor.testProcessCommitted();
  Assert.assertFalse("Next request processor executed",executedFlag);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.CommitProcessorTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testManyCommitWorkers() throws Exception {
  setUp(10,10);
synchronized (this) {
    wait(5000);
  }
  checkProcessedRequest();
  Assert.assertFalse(fail);
}

</code></pre>

<br>
<pre class="type-12 type-10 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@After public void tearDown() throws Exception {
  LOG.info("tearDown starting");
  for (  TestClientThread client : testClients) {
    client.interrupt();
    client.join();
  }
  zks.shutdown();
  if (tmpDir != null) {
    Assert.assertTrue("delete " + tmpDir.toString(),ClientBase.recursiveDelete(tmpDir));
  }
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testOneCommitWorker() throws Exception {
  setUp(1,10);
synchronized (this) {
    wait(5000);
  }
  checkProcessedRequest();
  Assert.assertFalse(fail);
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testNoCommitWorkers() throws Exception {
  setUp(0,10);
synchronized (this) {
    wait(5000);
  }
  checkProcessedRequest();
  Assert.assertFalse(fail);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.LearnerHandlerTest </h4><pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test cases when learner has new-epcoh zxid
 * (zxid & 0xffffffffL) == 0;
 */
@Test public void testNewEpochZxidWithTxnlogOnly() throws Exception {
  long peerZxid;
  db.txnLog.add(createProposal(getZxid(1,1)));
  db.txnLog.add(createProposal(getZxid(2,1)));
  db.txnLog.add(createProposal(getZxid(2,2)));
  db.txnLog.add(createProposal(getZxid(4,1)));
  db.lastProcessedZxid=getZxid(6,0);
  peerZxid=getZxid(3,0);
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,getZxid(6,0),getZxid(4,1));
  assertEquals(3,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{getZxid(4,1)});
  reset();
  peerZxid=getZxid(4,0);
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,getZxid(6,0),getZxid(4,1));
  assertEquals(3,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{getZxid(4,1)});
  reset();
  peerZxid=getZxid(5,0);
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,getZxid(6,0),getZxid(5,0));
  assertEquals(1,learnerHandler.getQueuedPackets().size());
  reset();
  peerZxid=getZxid(6,0);
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,getZxid(6,0),getZxid(6,0));
  assertEquals(1,learnerHandler.getQueuedPackets().size());
  reset();
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Test case verifying TxnLogProposalIterator closure.
 */
@Test public void testTxnLogProposalIteratorClosure() throws Exception {
  long peerZxid;
  db=new MockZKDatabase(null){
    @Override public Iterator<Proposal> getProposalsFromTxnLog(    long peerZxid,    long limit){
      return TxnLogProposalIterator.EMPTY_ITERATOR;
    }
  }
;
  db.lastProcessedZxid=7;
  db.txnLog.add(createProposal(2));
  db.txnLog.add(createProposal(3));
  peerZxid=4;
  assertTrue("Couldn't identify snapshot transfer!",learnerHandler.syncFollower(peerZxid,db,leader));
  reset();
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test cases when leader has empty commitedLog
 */
@Test public void testEmptyCommittedLog() throws Exception {
  long peerZxid;
  peerZxid=3;
  db.lastProcessedZxid=1;
  db.committedLog.clear();
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.TRUNC,db.lastProcessedZxid,db.lastProcessedZxid);
  reset();
  peerZxid=1;
  db.lastProcessedZxid=1;
  db.committedLog.clear();
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,db.lastProcessedZxid,db.lastProcessedZxid);
  assertEquals(1,learnerHandler.getQueuedPackets().size());
  reset();
  peerZxid=0;
  db.setSnapshotSizeFactor(-1);
  db.lastProcessedZxid=1;
  db.committedLog.clear();
  assertTrue(learnerHandler.syncFollower(peerZxid,db,leader));
  assertEquals(0,learnerHandler.getQueuedPackets().size());
  reset();
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test cases when txnlog is enabled
 */
@Test public void testTxnLog() throws Exception {
  long peerZxid;
  db.txnLog.add(createProposal(2));
  db.txnLog.add(createProposal(3));
  db.txnLog.add(createProposal(5));
  db.txnLog.add(createProposal(6));
  db.txnLog.add(createProposal(7));
  db.txnLog.add(createProposal(8));
  db.txnLog.add(createProposal(9));
  db.lastProcessedZxid=9;
  db.committedLog.add(createProposal(6));
  db.committedLog.add(createProposal(7));
  db.committedLog.add(createProposal(8));
  peerZxid=4;
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.TRUNC,3,db.getmaxCommittedLog());
  assertEquals(9,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{5,6,7,8});
  reset();
  peerZxid=3;
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,db.getmaxCommittedLog(),db.getmaxCommittedLog());
  assertEquals(9,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{5,6,7,8});
  reset();
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test cases when peer has new-epoch zxid
 */
@Test public void testNewEpochZxid() throws Exception {
  long peerZxid;
  db.txnLog.add(createProposal(getZxid(0,1)));
  db.txnLog.add(createProposal(getZxid(1,1)));
  db.txnLog.add(createProposal(getZxid(1,2)));
  db.lastProcessedZxid=getZxid(2,0);
  db.committedLog.add(createProposal(getZxid(1,1)));
  db.committedLog.add(createProposal(getZxid(1,2)));
  peerZxid=getZxid(0,0);
  assertTrue(learnerHandler.syncFollower(peerZxid,db,leader));
  assertEquals(0,learnerHandler.getQueuedPackets().size());
  reset();
  peerZxid=getZxid(1,0);
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,getZxid(1,2),getZxid(1,2));
  assertEquals(5,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{getZxid(1,1),getZxid(1,2)});
  reset();
  peerZxid=getZxid(2,0);
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,getZxid(2,0),getZxid(2,0));
  assertEquals(1,learnerHandler.getQueuedPackets().size());
  reset();
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test cases when txnlog is enabled and commitedLog is empty
 */
@Test public void testTxnLogOnly() throws Exception {
  long peerZxid;
  db.lastProcessedZxid=7;
  db.txnLog.add(createProposal(2));
  db.txnLog.add(createProposal(3));
  db.txnLog.add(createProposal(5));
  db.txnLog.add(createProposal(6));
  db.txnLog.add(createProposal(7));
  db.txnLog.add(createProposal(8));
  peerZxid=4;
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.TRUNC,3,db.lastProcessedZxid);
  assertEquals(7,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{5,6,7});
  reset();
  peerZxid=2;
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,db.lastProcessedZxid,db.lastProcessedZxid);
  assertEquals(9,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{3,5,6,7});
  reset();
  peerZxid=1;
  assertTrue(learnerHandler.syncFollower(peerZxid,db,leader));
  assertEquals(0,learnerHandler.getQueuedPackets().size());
  reset();
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test cases when leader has committedLog
 */
@Test public void testCommittedLog() throws Exception {
  long peerZxid;
  db.lastProcessedZxid=6;
  db.committedLog.add(createProposal(2));
  db.committedLog.add(createProposal(3));
  db.committedLog.add(createProposal(5));
  peerZxid=4;
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.TRUNC,3,5);
  assertEquals(3,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{5});
  reset();
  peerZxid=2;
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,db.getmaxCommittedLog(),db.getmaxCommittedLog());
  assertEquals(5,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{3,5});
  reset();
  peerZxid=1;
  db.setSnapshotSizeFactor(-1);
  assertTrue(learnerHandler.syncFollower(peerZxid,db,leader));
  assertEquals(0,learnerHandler.getQueuedPackets().size());
  reset();
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test cases with zxids that are negative long
 */
@Test public void testTxnLogWithNegativeZxid() throws Exception {
  long peerZxid;
  db.txnLog.add(createProposal(getZxid(0xf,2)));
  db.txnLog.add(createProposal(getZxid(0xf,3)));
  db.txnLog.add(createProposal(getZxid(0xf,5)));
  db.txnLog.add(createProposal(getZxid(0xf,6)));
  db.txnLog.add(createProposal(getZxid(0xf,7)));
  db.txnLog.add(createProposal(getZxid(0xf,8)));
  db.txnLog.add(createProposal(getZxid(0xf,9)));
  db.lastProcessedZxid=getZxid(0xf,9);
  db.committedLog.add(createProposal(getZxid(0xf,6)));
  db.committedLog.add(createProposal(getZxid(0xf,7)));
  db.committedLog.add(createProposal(getZxid(0xf,8)));
  peerZxid=getZxid(0xf,4);
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.TRUNC,getZxid(0xf,3),db.getmaxCommittedLog());
  assertEquals(9,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{getZxid(0xf,5),getZxid(0xf,6),getZxid(0xf,7),getZxid(0xf,8)});
  reset();
  peerZxid=getZxid(0xf,3);
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,db.getmaxCommittedLog(),db.getmaxCommittedLog());
  assertEquals(9,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{getZxid(0xf,5),getZxid(0xf,6),getZxid(0xf,7),getZxid(0xf,8)});
  reset();
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test cases when we have to TRUNC learner, but it may cross epoch boundary
 * so we need to send snap instead
 */
@Test public void testCrossEpochTrunc() throws Exception {
  long peerZxid;
  db.txnLog.add(createProposal(getZxid(1,1)));
  db.txnLog.add(createProposal(getZxid(2,1)));
  db.txnLog.add(createProposal(getZxid(2,2)));
  db.txnLog.add(createProposal(getZxid(4,1)));
  db.lastProcessedZxid=getZxid(6,0);
  peerZxid=getZxid(3,1);
  assertTrue(learnerHandler.syncFollower(peerZxid,db,leader));
  assertEquals(0,learnerHandler.getQueuedPackets().size());
  reset();
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test cases when there is a duplicate txn in the committedLog. This
 * should never happen unless there is a bug in initialization code
 * but the learner should never see duplicate packets
 */
@Test public void testDuplicatedTxn() throws Exception {
  long peerZxid;
  db.txnLog.add(createProposal(getZxid(0,1)));
  db.txnLog.add(createProposal(getZxid(1,1)));
  db.txnLog.add(createProposal(getZxid(1,2)));
  db.txnLog.add(createProposal(getZxid(1,1)));
  db.txnLog.add(createProposal(getZxid(1,2)));
  db.lastProcessedZxid=getZxid(2,0);
  db.committedLog.add(createProposal(getZxid(1,1)));
  db.committedLog.add(createProposal(getZxid(1,2)));
  db.committedLog.add(createProposal(getZxid(1,1)));
  db.committedLog.add(createProposal(getZxid(1,2)));
  peerZxid=getZxid(1,0);
  assertFalse(learnerHandler.syncFollower(peerZxid,db,leader));
  assertOpType(Leader.DIFF,getZxid(1,2),getZxid(1,2));
  assertEquals(5,learnerHandler.getQueuedPackets().size());
  queuedPacketMatches(new long[]{getZxid(1,1),getZxid(1,2)});
  reset();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.LearnerSnapshotThrottlerTest </h4><pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testPositiveTimeout() throws Exception {
  final LearnerSnapshotThrottler throttler=new LearnerSnapshotThrottler(1,200);
  ExecutorService threadPool=Executors.newFixedThreadPool(1);
  LearnerSnapshot first=throttler.beginSnapshot(false);
  final CountDownLatch snapshotProgressLatch=new CountDownLatch(1);
  Future<Boolean> result=threadPool.submit(new Callable<Boolean>(){
    @Override public Boolean call(){
      try {
        snapshotProgressLatch.countDown();
        LearnerSnapshot second=throttler.beginSnapshot(false);
        second.close();
      }
 catch (      Exception e) {
        return false;
      }
      return true;
    }
  }
);
  snapshotProgressLatch.await();
  first.close();
  Assert.assertTrue(result.get());
}

</code></pre>

<br>
<pre class="type-9 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTryWithResourceNoThrottle() throws Exception {
  LearnerSnapshotThrottler throttler=new LearnerSnapshotThrottler(1);
  for (int i=0; i < 3; i++) {
    LearnerSnapshot snapshot=throttler.beginSnapshot(false);
    try {
      Assert.assertFalse(snapshot.isEssential());
      Assert.assertEquals(1,snapshot.getConcurrentSnapshotNumber());
    }
  finally {
      snapshot.close();
    }
  }
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testParallelNoThrottle() throws Exception {
  final int numThreads=50;
  final LearnerSnapshotThrottler throttler=new LearnerSnapshotThrottler(numThreads);
  ExecutorService threadPool=Executors.newFixedThreadPool(numThreads);
  final CountDownLatch threadStartLatch=new CountDownLatch(numThreads);
  final CountDownLatch snapshotProgressLatch=new CountDownLatch(numThreads);
  List<Future<Boolean>> results=new ArrayList<Future<Boolean>>(numThreads);
  for (int i=0; i < numThreads; i++) {
    results.add(threadPool.submit(new Callable<Boolean>(){
      @Override public Boolean call(){
        threadStartLatch.countDown();
        try {
          threadStartLatch.await();
          throttler.beginSnapshot(false);
          snapshotProgressLatch.countDown();
          snapshotProgressLatch.await();
          throttler.endSnapshot();
        }
 catch (        Exception e) {
          return false;
        }
        return true;
      }
    }
));
  }
  for (  Future<Boolean> result : results) {
    Assert.assertTrue(result.get());
  }
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testHighContentionWithTimeout() throws Exception {
  int numThreads=20;
  final LearnerSnapshotThrottler throttler=new LearnerSnapshotThrottler(2,5000);
  ExecutorService threadPool=Executors.newFixedThreadPool(numThreads);
  final CountDownLatch threadStartLatch=new CountDownLatch(numThreads);
  List<Future<Boolean>> results=new ArrayList<Future<Boolean>>(numThreads);
  for (int i=0; i < numThreads; i++) {
    results.add(threadPool.submit(new Callable<Boolean>(){
      @Override public Boolean call(){
        threadStartLatch.countDown();
        try {
          threadStartLatch.await();
          LearnerSnapshot snap=throttler.beginSnapshot(false);
          int snapshotNumber=snap.getConcurrentSnapshotNumber();
          throttler.endSnapshot();
          return snapshotNumber <= 2;
        }
 catch (        Exception e) {
          LOG.error("Exception trying to begin snapshot",e);
          return false;
        }
      }
    }
));
  }
  for (  Future<Boolean> result : results) {
    Assert.assertTrue(result.get());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.LearnerTest </h4><pre class="type-3 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void connectionInitLimitTimeoutTest() throws Exception {
  TimeoutLearner learner=new TimeoutLearner();
  learner.self=new QuorumPeer();
  learner.self.setTickTime(2000);
  learner.self.setInitLimit(5);
  learner.self.setSyncLimit(2);
  InetSocketAddress addr=new InetSocketAddress(1111);
  learner.setTimeMultiplier((long)4000 * 1000000);
  learner.setPassConnectAttempt(5);
  try {
    learner.connectToLeader(addr);
    Assert.fail("should have thrown IOException!");
  }
 catch (  IOException e) {
    Assert.assertTrue(learner.nanoTime() > 2000 * 5 * 1000000);
    Assert.assertEquals(3,learner.getSockConnectAttempt());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.LocalPeerBeanTest </h4><pre class="type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test case for https://issues.apache.org/jira/browse/ZOOKEEPER-2299
 */
@Test public void testClientAddress() throws Exception {
  QuorumPeer quorumPeer=new QuorumPeer();
  LocalPeerBean remotePeerBean=new LocalPeerBean(quorumPeer);
  String result=remotePeerBean.getClientAddress();
  assertNotNull(result);
  assertEquals(0,result.length());
  ServerCnxnFactory cnxnFactory=ServerCnxnFactory.createFactory();
  int clientPort=2181;
  InetSocketAddress address=new InetSocketAddress(clientPort);
  cnxnFactory.configure(address,5,false);
  quorumPeer.setCnxnFactory(cnxnFactory);
  result=remotePeerBean.getClientAddress();
  String ipv4="0.0.0.0:" + clientPort;
  String ipv6="0:0:0:0:0:0:0:0:" + clientPort;
  assertTrue(result.equals(ipv4) || result.equals(ipv6));
  cnxnFactory.shutdown();
  InetAddress clientIP=InetAddress.getByAddress(new byte[]{127,0,0,2});
  address=new InetSocketAddress(clientIP,clientPort);
  cnxnFactory=ServerCnxnFactory.createFactory();
  cnxnFactory.configure(address,5,false);
  quorumPeer.setCnxnFactory(cnxnFactory);
  result=remotePeerBean.getClientAddress();
  String expectedResult="127.0.0.2:" + clientPort;
  assertEquals(expectedResult,result);
  cnxnFactory.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.QuorumPeerMainTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Verify handling of inconsistent peer type
 */
@Test public void testInconsistentPeerType() throws Exception {
  ClientBase.setupTestEnv();
  Layout layout=Logger.getRootLogger().getAppender("CONSOLE").getLayout();
  ByteArrayOutputStream os=new ByteArrayOutputStream();
  WriterAppender appender=new WriterAppender(layout,os);
  appender.setThreshold(Level.INFO);
  Logger qlogger=Logger.getLogger("org.apache.zookeeper.server.quorum");
  qlogger.addAppender(appender);
  try {
    final int CLIENT_PORT_QP1=PortAssignment.unique();
    final int CLIENT_PORT_QP2=PortAssignment.unique();
    final int CLIENT_PORT_QP3=PortAssignment.unique();
    String quorumCfgSection="server.1=127.0.0.1:" + PortAssignment.unique() + ":"+ PortAssignment.unique()+ ";"+ CLIENT_PORT_QP1+ "\nserver.2=127.0.0.1:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ";"+ CLIENT_PORT_QP2+ "\nserver.3=127.0.0.1:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ":observer"+ ";"+ CLIENT_PORT_QP3;
    MainThread q1=new MainThread(1,CLIENT_PORT_QP1,quorumCfgSection);
    MainThread q2=new MainThread(2,CLIENT_PORT_QP2,quorumCfgSection);
    MainThread q3=new MainThread(3,CLIENT_PORT_QP3,quorumCfgSection);
    q1.start();
    q2.start();
    q3.start();
    Assert.assertTrue("waiting for server 1 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP1,CONNECTION_TIMEOUT));
    Assert.assertTrue("waiting for server 2 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP2,CONNECTION_TIMEOUT));
    Assert.assertTrue("waiting for server 3 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP3,CONNECTION_TIMEOUT));
    q1.shutdown();
    q2.shutdown();
    q3.shutdown();
    Assert.assertTrue("waiting for server 1 down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_QP1,ClientBase.CONNECTION_TIMEOUT));
    Assert.assertTrue("waiting for server 2 down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_QP2,ClientBase.CONNECTION_TIMEOUT));
    Assert.assertTrue("waiting for server 3 down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_QP3,ClientBase.CONNECTION_TIMEOUT));
  }
  finally {
    qlogger.removeAppender(appender);
  }
  LineNumberReader r=new LineNumberReader(new StringReader(os.toString()));
  String line;
  boolean warningPresent=false;
  boolean defaultedToObserver=false;
  Pattern pWarn=Pattern.compile(".*Peer type from servers list.* doesn't match peerType.*");
  Pattern pObserve=Pattern.compile(".*OBSERVING.*");
  while ((line=r.readLine()) != null) {
    if (pWarn.matcher(line).matches()) {
      warningPresent=true;
    }
    if (pObserve.matcher(line).matches()) {
      defaultedToObserver=true;
    }
    if (warningPresent && defaultedToObserver) {
      break;
    }
  }
  Assert.assertTrue("Should warn about inconsistent peer type",warningPresent && defaultedToObserver);
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies that the server is able to redefine if user configured only
 * minSessionTimeout limit
 */
@Test public void testWithOnlyMinSessionTimeout() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT_QP1=PortAssignment.unique();
  final int CLIENT_PORT_QP2=PortAssignment.unique();
  String quorumCfgSection="server.1=127.0.0.1:" + PortAssignment.unique() + ":"+ PortAssignment.unique()+ "\nserver.2=127.0.0.1:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique();
  final int minSessionTimeOut=15000;
  final String configs="minSessionTimeout=" + minSessionTimeOut + "\n";
  MainThread q1=new MainThread(1,CLIENT_PORT_QP1,quorumCfgSection,configs);
  MainThread q2=new MainThread(2,CLIENT_PORT_QP2,quorumCfgSection,configs);
  q1.start();
  q2.start();
  Assert.assertTrue("waiting for server 1 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP1,CONNECTION_TIMEOUT));
  Assert.assertTrue("waiting for server 2 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP2,CONNECTION_TIMEOUT));
  QuorumPeer quorumPeer=q1.main.quorumPeer;
  final int maxSessionTimeOut=quorumPeer.tickTime * 20;
  Assert.assertEquals("minimumSessionTimeOut is not considered",minSessionTimeOut,quorumPeer.getMinSessionTimeout());
  Assert.assertEquals("maximumSessionTimeOut is wrong",maxSessionTimeOut,quorumPeer.getMaxSessionTimeout());
}

</code></pre>

<br>
<pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Verify handling of quorum defaults
 * * default electionAlg is fast leader election
 */
@Test public void testQuorumDefaults() throws Exception {
  ClientBase.setupTestEnv();
  Layout layout=Logger.getRootLogger().getAppender("CONSOLE").getLayout();
  ByteArrayOutputStream os=new ByteArrayOutputStream();
  WriterAppender appender=new WriterAppender(layout,os);
  appender.setImmediateFlush(true);
  appender.setThreshold(Level.INFO);
  Logger zlogger=Logger.getLogger("org.apache.zookeeper");
  zlogger.addAppender(appender);
  try {
    final int CLIENT_PORT_QP1=PortAssignment.unique();
    final int CLIENT_PORT_QP2=PortAssignment.unique();
    String quorumCfgSection="server.1=127.0.0.1:" + PortAssignment.unique() + ":"+ PortAssignment.unique()+ ";"+ CLIENT_PORT_QP1+ "\nserver.2=127.0.0.1:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ";"+ CLIENT_PORT_QP2;
    MainThread q1=new MainThread(1,CLIENT_PORT_QP1,quorumCfgSection);
    MainThread q2=new MainThread(2,CLIENT_PORT_QP2,quorumCfgSection);
    q1.start();
    q2.start();
    Assert.assertTrue("waiting for server 1 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP1,CONNECTION_TIMEOUT));
    Assert.assertTrue("waiting for server 2 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP2,CONNECTION_TIMEOUT));
    q1.shutdown();
    q2.shutdown();
    Assert.assertTrue("waiting for server 1 down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_QP1,ClientBase.CONNECTION_TIMEOUT));
    Assert.assertTrue("waiting for server 2 down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_QP2,ClientBase.CONNECTION_TIMEOUT));
  }
  finally {
    zlogger.removeAppender(appender);
  }
  os.close();
  LineNumberReader r=new LineNumberReader(new StringReader(os.toString()));
  String line;
  boolean found=false;
  Pattern p=Pattern.compile(".*FastLeaderElection.*");
  while ((line=r.readLine()) != null) {
    found=p.matcher(line).matches();
    if (found) {
      break;
    }
  }
  Assert.assertTrue("fastleaderelection used",found);
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies that the server is able to redefine the min/max session
 * timeouts
 */
@Test public void testMinMaxSessionTimeOut() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT_QP1=PortAssignment.unique();
  final int CLIENT_PORT_QP2=PortAssignment.unique();
  String quorumCfgSection="server.1=127.0.0.1:" + PortAssignment.unique() + ":"+ PortAssignment.unique()+ "\nserver.2=127.0.0.1:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique();
  final int minSessionTimeOut=10000;
  final int maxSessionTimeOut=15000;
  final String configs="maxSessionTimeout=" + maxSessionTimeOut + "\n"+ "minSessionTimeout="+ minSessionTimeOut+ "\n";
  MainThread q1=new MainThread(1,CLIENT_PORT_QP1,quorumCfgSection,configs);
  MainThread q2=new MainThread(2,CLIENT_PORT_QP2,quorumCfgSection,configs);
  q1.start();
  q2.start();
  Assert.assertTrue("waiting for server 1 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP1,CONNECTION_TIMEOUT));
  Assert.assertTrue("waiting for server 2 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP2,CONNECTION_TIMEOUT));
  QuorumPeer quorumPeer=q1.main.quorumPeer;
  Assert.assertEquals("minimumSessionTimeOut is not considered",minSessionTimeOut,quorumPeer.getMinSessionTimeout());
  Assert.assertEquals("maximumSessionTimeOut is not considered",maxSessionTimeOut,quorumPeer.getMaxSessionTimeout());
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify the ability to start a cluster.
 */
@Test public void testQuorum() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT_QP1=PortAssignment.unique();
  final int CLIENT_PORT_QP2=PortAssignment.unique();
  String quorumCfgSection="server.1=127.0.0.1:" + PortAssignment.unique() + ":"+ PortAssignment.unique()+ ";"+ CLIENT_PORT_QP1+ "\nserver.2=127.0.0.1:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ";"+ CLIENT_PORT_QP2;
  MainThread q1=new MainThread(1,CLIENT_PORT_QP1,quorumCfgSection);
  MainThread q2=new MainThread(2,CLIENT_PORT_QP2,quorumCfgSection);
  q1.start();
  q2.start();
  Assert.assertTrue("waiting for server 1 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP1,CONNECTION_TIMEOUT));
  Assert.assertTrue("waiting for server 2 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP2,CONNECTION_TIMEOUT));
  QuorumPeer quorumPeer=q1.main.quorumPeer;
  int tickTime=quorumPeer.getTickTime();
  Assert.assertEquals("Default value of minimumSessionTimeOut is not considered",tickTime * 2,quorumPeer.getMinSessionTimeout());
  Assert.assertEquals("Default value of maximumSessionTimeOut is not considered",tickTime * 20,quorumPeer.getMaxSessionTimeout());
  ZooKeeper zk=new ZooKeeper("127.0.0.1:" + CLIENT_PORT_QP1,ClientBase.CONNECTION_TIMEOUT,this);
  waitForOne(zk,States.CONNECTED);
  zk.create("/foo_q1","foobar1".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertEquals(new String(zk.getData("/foo_q1",null,null)),"foobar1");
  zk.close();
  zk=new ZooKeeper("127.0.0.1:" + CLIENT_PORT_QP2,ClientBase.CONNECTION_TIMEOUT,this);
  waitForOne(zk,States.CONNECTED);
  zk.create("/foo_q2","foobar2".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertEquals(new String(zk.getData("/foo_q2",null,null)),"foobar2");
  zk.close();
  q1.shutdown();
  q2.shutdown();
  Assert.assertTrue("waiting for server 1 down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_QP1,ClientBase.CONNECTION_TIMEOUT));
  Assert.assertTrue("waiting for server 2 down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_QP2,ClientBase.CONNECTION_TIMEOUT));
}

</code></pre>

<br>
<pre class="type-9 type-10 type-3 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test early leader abandonment.
 */
@Test public void testEarlyLeaderAbandonment() throws Exception {
  ClientBase.setupTestEnv();
  final int SERVER_COUNT=3;
  final int clientPorts[]=new int[SERVER_COUNT];
  StringBuilder sb=new StringBuilder();
  for (int i=0; i < SERVER_COUNT; i++) {
    clientPorts[i]=PortAssignment.unique();
    sb.append("server." + i + "=127.0.0.1:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ";"+ clientPorts[i]+ "\n");
  }
  String quorumCfgSection=sb.toString();
  MainThread mt[]=new MainThread[SERVER_COUNT];
  ZooKeeper zk[]=new ZooKeeper[SERVER_COUNT];
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i]=new MainThread(i,clientPorts[i],quorumCfgSection);
    mt[i].start();
    zk[i]=new ZooKeeper("127.0.0.1:" + clientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
  }
  waitForAll(zk,States.CONNECTED);
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i].shutdown();
  }
  waitForAll(zk,States.CONNECTING);
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i].start();
    zk[i]=new ZooKeeper("127.0.0.1:" + clientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
  }
  waitForAll(zk,States.CONNECTED);
  int leader=-1;
  Map<Long,Proposal> outstanding=null;
  for (int i=0; i < SERVER_COUNT; i++) {
    if (mt[i].main.quorumPeer.leader == null) {
      mt[i].shutdown();
    }
 else {
      leader=i;
      outstanding=mt[leader].main.quorumPeer.leader.outstandingProposals;
    }
  }
  try {
    zk[leader].create("/zk" + leader,"zk".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    Assert.fail("create /zk" + leader + " should have failed");
  }
 catch (  KeeperException e) {
  }
  Assert.assertTrue(outstanding.size() == 1);
  Assert.assertTrue(((Proposal)outstanding.values().iterator().next()).request.getHdr().getType() == OpCode.create);
  Thread.sleep(1000);
  mt[leader].shutdown();
  waitForAll(zk,States.CONNECTING);
  for (int i=0; i < SERVER_COUNT; i++) {
    if (i != leader) {
      mt[i].start();
    }
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    if (i != leader) {
      zk[i]=new ZooKeeper("127.0.0.1:" + clientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
      waitForOne(zk[i],States.CONNECTED);
      zk[i].create("/zk" + i,"zk".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    }
  }
  mt[leader].start();
  waitForAll(zk,States.CONNECTED);
  for (int i=0; i < SERVER_COUNT; i++) {
    for (int j=0; j < SERVER_COUNT; j++) {
      if (i == leader) {
        Assert.assertTrue((j == leader ? ("Leader (" + leader + ")") : ("Follower " + j)) + " should not have /zk" + i,zk[j].exists("/zk" + i,false) == null);
      }
 else {
        Assert.assertTrue((j == leader ? ("Leader (" + leader + ")") : ("Follower " + j)) + " does not have /zk" + i,zk[j].exists("/zk" + i,false) != null);
      }
    }
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    zk[i].close();
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i].shutdown();
  }
}

</code></pre>

<br>
<pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Verify handling of bad quorum address
 */
@Test public void testBadPeerAddressInQuorum() throws Exception {
  ClientBase.setupTestEnv();
  Layout layout=Logger.getRootLogger().getAppender("CONSOLE").getLayout();
  ByteArrayOutputStream os=new ByteArrayOutputStream();
  WriterAppender appender=new WriterAppender(layout,os);
  appender.setThreshold(Level.WARN);
  Logger qlogger=Logger.getLogger("org.apache.zookeeper.server.quorum");
  qlogger.addAppender(appender);
  try {
    final int CLIENT_PORT_QP1=PortAssignment.unique();
    final int CLIENT_PORT_QP2=PortAssignment.unique();
    String quorumCfgSection="server.1=127.0.0.1:" + PortAssignment.unique() + ":"+ PortAssignment.unique()+ ";"+ CLIENT_PORT_QP1+ "\nserver.2=fee.fii.foo.fum:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ";"+ CLIENT_PORT_QP2;
    MainThread q1=new MainThread(1,CLIENT_PORT_QP1,quorumCfgSection);
    q1.start();
    boolean isup=ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP1,30000);
    Assert.assertFalse("Server never came up",isup);
    q1.shutdown();
    Assert.assertTrue("waiting for server 1 down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_QP1,ClientBase.CONNECTION_TIMEOUT));
  }
  finally {
    qlogger.removeAppender(appender);
  }
  LineNumberReader r=new LineNumberReader(new StringReader(os.toString()));
  String line;
  boolean found=false;
  Pattern p=Pattern.compile(".*Cannot open channel to .* at election address .*");
  while ((line=r.readLine()) != null) {
    found=p.matcher(line).matches();
    if (found) {
      break;
    }
  }
  Assert.assertTrue("complains about host",found);
}

</code></pre>

<br>
<pre class="type-5 type-2 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test the case of server with highest zxid not present at leader election and joining later.
 * This test case is for reproducing the issue and fixing the bug mentioned in ZOOKEEPER-1154
 * and ZOOKEEPER-1156.
 */
@Test public void testHighestZxidJoinLate() throws Exception {
  numServers=3;
  servers=LaunchServers(numServers);
  String path="/hzxidtest";
  int leader=-1;
  for (int i=0; i < numServers; i++) {
    if (servers.mt[i].main.quorumPeer.leader != null) {
      leader=i;
    }
  }
  Assert.assertTrue("There should be a leader",leader >= 0);
  int nonleader=(leader + 1) % numServers;
  byte[] input=new byte[1];
  input[0]=1;
  byte[] output;
  servers.zk[leader].create(path + leader,input,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  servers.zk[leader].create(path + nonleader,input,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  output=servers.zk[leader].getData(path + nonleader,false,null);
  for (int i=0; i < numServers; i++) {
    if (i != leader) {
      servers.mt[i].shutdown();
    }
  }
  input[0]=2;
  servers.zk[leader].setData(path + leader,input,-1,null,null);
  Thread.sleep(500);
  servers.mt[leader].shutdown();
  System.gc();
  waitForAll(servers.zk,States.CONNECTING);
  for (int i=0; i < numServers; i++) {
    if (i != leader) {
      servers.mt[i].start();
    }
  }
  waitForOne(servers.zk[nonleader],States.CONNECTED);
  output=servers.zk[nonleader].getData(path + leader,false,null);
  Assert.assertEquals("Expecting old value 1 since 2 isn't committed yet",output[0],1);
  servers.zk[nonleader].setData(path + nonleader,input,-1);
  servers.mt[leader].start();
  waitForOne(servers.zk[leader],States.CONNECTED);
  output=servers.zk[leader].getData(path + leader,false,null);
  Assert.assertEquals("Validating that the deposed leader has rolled back that change it had written",output[0],1);
  output=servers.zk[leader].getData(path + nonleader,false,null);
  Assert.assertEquals("Validating that the deposed leader caught up on changes it missed",output[0],2);
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * verify if bad packets are being handled properly
 * at the quorum port
 * @throws Exception
 */
@Test public void testBadPackets() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT_QP1=PortAssignment.unique();
  final int CLIENT_PORT_QP2=PortAssignment.unique();
  int electionPort1=PortAssignment.unique();
  int electionPort2=PortAssignment.unique();
  String quorumCfgSection="server.1=127.0.0.1:" + PortAssignment.unique() + ":"+ electionPort1+ ";"+ CLIENT_PORT_QP1+ "\nserver.2=127.0.0.1:"+ PortAssignment.unique()+ ":"+ electionPort2+ ";"+ CLIENT_PORT_QP2;
  MainThread q1=new MainThread(1,CLIENT_PORT_QP1,quorumCfgSection);
  MainThread q2=new MainThread(2,CLIENT_PORT_QP2,quorumCfgSection);
  q1.start();
  q2.start();
  Assert.assertTrue("waiting for server 1 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP1,CONNECTION_TIMEOUT));
  Assert.assertTrue("waiting for server 2 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP2,CONNECTION_TIMEOUT));
  byte[] b=new byte[4];
  int length=1024 * 1024 * 1024;
  ByteBuffer buff=ByteBuffer.wrap(b);
  buff.putInt(length);
  buff.position(0);
  SocketChannel s=SocketChannel.open(new InetSocketAddress("127.0.0.1",electionPort1));
  s.write(buff);
  s.close();
  buff.position(0);
  s=SocketChannel.open(new InetSocketAddress("127.0.0.1",electionPort2));
  s.write(buff);
  s.close();
  ZooKeeper zk=new ZooKeeper("127.0.0.1:" + CLIENT_PORT_QP1,ClientBase.CONNECTION_TIMEOUT,this);
  waitForOne(zk,States.CONNECTED);
  zk.create("/foo_q1","foobar1".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertEquals(new String(zk.getData("/foo_q1",null,null)),"foobar1");
  zk.close();
  q1.shutdown();
  q2.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.QuorumRequestPipelineTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testSync() throws Exception {
  complete=false;
  create2EmptyNode(zkClient,PARENT_PATH);
  VoidCallback onSync=new VoidCallback(){
    @Override public void processResult(    int rc,    String path,    Object ctx){
      complete=true;
      callComplete.countDown();
    }
  }
;
  zkClient.sync(PARENT_PATH,onSync,null);
  callComplete.await(30,TimeUnit.SECONDS);
  Assert.assertTrue(String.format("%s Sync completed",serverState),complete);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.ReconfigBackupTest </h4><pre class="type-9 type-5 type-10 type-2 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test checks that if a version is appended to dynamic file,
 * then peer should use that version as quorum config version.
 * <p/>
 * The scenario: one server has an older version of 3 servers, and
 * four others have newer version of 5 servers. Finally, the lag-off one
 * should have server config of 5 servers.
 */
@Test public void testVersionOfDynamicFilename() throws Exception {
  final int SERVER_COUNT=5;
  final int oldServerCount=3;
  final int lagOffServerId=0;
  final int clientPorts[]=new int[SERVER_COUNT];
  StringBuilder sb=new StringBuilder();
  String server;
  StringBuilder oldSb=new StringBuilder();
  ArrayList<String> allServers=new ArrayList<String>();
  for (int i=0; i < SERVER_COUNT; i++) {
    clientPorts[i]=PortAssignment.unique();
    server="server." + i + "=localhost:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ":participant;localhost:"+ clientPorts[i];
    sb.append(server + "\n");
    allServers.add(server);
    if (i < oldServerCount) {
      oldSb.append(server + "\n");
    }
  }
  String currentQuorumCfgSection=sb.toString();
  String oldQuorumCfg=oldSb.toString();
  MainThread mt[]=new MainThread[SERVER_COUNT];
  for (int i=0; i < SERVER_COUNT; i++) {
    if (i == lagOffServerId) {
      mt[i]=new MainThread(i,clientPorts[i],oldQuorumCfg,true,"100000000");
    }
 else {
      mt[i]=new MainThread(i,clientPorts[i],currentQuorumCfgSection,true,"200000000");
    }
    if (i == lagOffServerId) {
      Assert.assertNotNull(mt[i].getFileByName("zoo.cfg.dynamic.100000000"));
      Assert.assertNull(mt[i].getFileByName("zoo.cfg.dynamic.200000000"));
      Assert.assertTrue(mt[i].getPropFromStaticFile("dynamicConfigFile").endsWith(".100000000"));
    }
 else {
      Assert.assertNotNull(mt[i].getFileByName("zoo.cfg.dynamic.200000000"));
      Assert.assertTrue(mt[i].getPropFromStaticFile("dynamicConfigFile").endsWith(".200000000"));
    }
    mt[i].start();
  }
  String dynamicFileContent=null;
  for (int i=0; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[i],CONNECTION_TIMEOUT));
    ZooKeeper zk=new ZooKeeper("127.0.0.1:" + clientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
    String configStr=ReconfigTest.testServerHasConfig(zk,allServers,null);
    Assert.assertEquals("200000000",getVersionFromConfigStr(configStr));
    List<String> configLines=Arrays.asList(configStr.split("\n"));
    Collections.sort(configLines);
    String sortedConfigStr=StringUtils.joinStrings(configLines,"\n");
    File dynamicConfigFile=mt[i].getFileByName("zoo.cfg.dynamic.200000000");
    Assert.assertNotNull(dynamicConfigFile);
    if (i == 0) {
      dynamicFileContent=getFileContent(dynamicConfigFile);
      Assert.assertEquals(sortedConfigStr,dynamicFileContent + "version=200000000");
    }
 else {
      String otherDynamicFileContent=getFileContent(dynamicConfigFile);
      Assert.assertEquals(dynamicFileContent,otherDynamicFileContent);
    }
    zk.close();
  }
  Assert.assertTrue(mt[lagOffServerId].getPropFromStaticFile("dynamicConfigFile").endsWith(".200000000"));
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i].shutdown();
  }
}

</code></pre>

<br>
<pre class="type-9 type-5 type-10 type-2 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test checks that on reconfig, a new dynamic file will be created with
 * current version appended to file name. Meanwhile, the dynamic file pointer
 * in static config file should also be changed.
 */
@Test public void testReconfigCreateNewVersionFile() throws Exception {
  final int SERVER_COUNT=3;
  final int NEW_SERVER_COUNT=5;
  final int clientPorts[]=new int[NEW_SERVER_COUNT];
  final int quorumPorts[]=new int[NEW_SERVER_COUNT];
  final int electionPorts[]=new int[NEW_SERVER_COUNT];
  final String servers[]=new String[NEW_SERVER_COUNT];
  StringBuilder sb=new StringBuilder();
  ArrayList<String> oldServers=new ArrayList<String>();
  ArrayList<String> newServers=new ArrayList<String>();
  for (int i=0; i < NEW_SERVER_COUNT; i++) {
    clientPorts[i]=PortAssignment.unique();
    quorumPorts[i]=PortAssignment.unique();
    electionPorts[i]=PortAssignment.unique();
    servers[i]="server." + i + "=localhost:"+ quorumPorts[i]+ ":"+ electionPorts[i]+ ":participant;localhost:"+ clientPorts[i];
    newServers.add(servers[i]);
    if (i >= SERVER_COUNT) {
      continue;
    }
    oldServers.add(servers[i]);
    sb.append(servers[i] + "\n");
  }
  String quorumCfgSection=sb.toString();
  MainThread mt[]=new MainThread[NEW_SERVER_COUNT];
  ZooKeeper zk[]=new ZooKeeper[NEW_SERVER_COUNT];
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i]=new MainThread(i,clientPorts[i],quorumCfgSection);
    mt[i].start();
  }
  String firstVersion=null, secondVersion=null;
  for (int i=0; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[i],CONNECTION_TIMEOUT));
    zk[i]=new ZooKeeper("127.0.0.1:" + clientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
    Properties cfg=ReconfigLegacyTest.readPropertiesFromFile(mt[i].confFile);
    String filename=cfg.getProperty("dynamicConfigFile","");
    String version=QuorumPeerConfig.getVersionFromFilename(filename);
    Assert.assertNotNull(version);
    String configStr=ReconfigTest.testServerHasConfig(zk[i],oldServers,null);
    String configVersion=getVersionFromConfigStr(configStr);
    Assert.assertEquals(version,configVersion);
    if (i == 0) {
      firstVersion=version;
    }
 else {
      Assert.assertEquals(firstVersion,version);
    }
  }
  ReconfigTest.reconfig(zk[1],null,null,newServers,-1);
  for (int i=SERVER_COUNT; i < NEW_SERVER_COUNT; i++) {
    mt[i]=new MainThread(i,clientPorts[i],quorumCfgSection + servers[i]);
    mt[i].start();
  }
  for (int i=SERVER_COUNT; i < NEW_SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[i],CONNECTION_TIMEOUT));
    zk[i]=new ZooKeeper("127.0.0.1:" + clientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
  }
  for (int i=0; i < NEW_SERVER_COUNT; i++) {
    Properties cfg=ReconfigLegacyTest.readPropertiesFromFile(mt[i].confFile);
    String filename=cfg.getProperty("dynamicConfigFile","");
    String version=QuorumPeerConfig.getVersionFromFilename(filename);
    Assert.assertNotNull(version);
    String configStr=ReconfigTest.testServerHasConfig(zk[i],newServers,null);
    String quorumVersion=getVersionFromConfigStr(configStr);
    Assert.assertEquals(version,quorumVersion);
    if (i == 0) {
      secondVersion=version;
      Assert.assertTrue(Long.parseLong(secondVersion,16) > Long.parseLong(firstVersion,16));
    }
 else {
      Assert.assertEquals(secondVersion,version);
    }
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i].shutdown();
    zk[i].close();
  }
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test checks that it will backup static file on bootup.
 */
@Test public void testBackupStatic() throws Exception {
  final int SERVER_COUNT=3;
  final int clientPorts[]=new int[SERVER_COUNT];
  StringBuilder sb=new StringBuilder();
  String server;
  for (int i=0; i < SERVER_COUNT; i++) {
    clientPorts[i]=PortAssignment.unique();
    server="server." + i + "=localhost:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ":participant;localhost:"+ clientPorts[i];
    sb.append(server + "\n");
  }
  String currentQuorumCfgSection=sb.toString();
  MainThread mt[]=new MainThread[SERVER_COUNT];
  String[] staticFileContent=new String[SERVER_COUNT];
  String[] staticBackupContent=new String[SERVER_COUNT];
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i]=new MainThread(i,clientPorts[i],currentQuorumCfgSection,false);
    Assert.assertNull("static file backup shouldn't exist before bootup",mt[i].getFileByName("zoo.cfg.bak"));
    staticFileContent[i]=getFileContent(mt[i].confFile);
    mt[i].start();
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[i],CONNECTION_TIMEOUT));
    File backupFile=mt[i].getFileByName("zoo.cfg.bak");
    Assert.assertNotNull("static file backup should exist",backupFile);
    staticBackupContent[i]=getFileContent(backupFile);
    Assert.assertEquals(staticFileContent[i],staticBackupContent[i]);
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i].shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.ReconfigFailureCasesTest </h4><pre class="type-9 type-5 type-3 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testObserverToParticipantConversionFails() throws Exception {
  ClientBase.setupTestEnv();
  final int SERVER_COUNT=4;
  int[][] ports=ReconfigRecoveryTest.generatePorts(SERVER_COUNT);
  HashSet<Integer> observers=new HashSet<Integer>();
  observers.add(3);
  StringBuilder sb=ReconfigRecoveryTest.generateConfig(SERVER_COUNT,ports,observers);
  String currentQuorumCfgSection=sb.toString();
  String nextQuorumCfgSection=currentQuorumCfgSection.replace("observer","participant");
  MainThread mt[]=new MainThread[SERVER_COUNT];
  ZooKeeper zk[]=new ZooKeeper[SERVER_COUNT];
  for (int i=1; i < SERVER_COUNT; i++) {
    mt[i]=new MainThread(i,ports[i][2],currentQuorumCfgSection,true,"100000000");
    mt[i].start();
    zk[i]=new ZooKeeper("127.0.0.1:" + ports[i][2],ClientBase.CONNECTION_TIMEOUT,this);
  }
  for (int i=1; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + ports[i][2],CONNECTION_TIMEOUT * 2));
  }
  try {
    zk[1].reconfig("","",nextQuorumCfgSection,-1,new Stat());
    Assert.fail("Reconfig should have failed with NewConfigNoQuorum");
  }
 catch (  NewConfigNoQuorum e) {
  }
catch (  Exception e) {
    Assert.fail("Reconfig should have failed with NewConfigNoQuorum");
  }
  ArrayList<String> leavingServers=new ArrayList<String>();
  leavingServers.add("3");
  ReconfigTest.reconfig(zk[1],null,leavingServers,null,-1);
  ReconfigTest.testNormalOperation(zk[2],zk[3]);
  ReconfigTest.testServerHasConfig(zk[3],null,leavingServers);
  List<String> newMembers=Arrays.asList(nextQuorumCfgSection.split("\n"));
  ReconfigTest.reconfig(zk[1],null,null,newMembers,-1);
  ReconfigTest.testNormalOperation(zk[2],zk[3]);
  for (int i=1; i < SERVER_COUNT; i++) {
    ReconfigTest.testServerHasConfig(zk[i],newMembers,null);
  }
  for (int i=1; i < SERVER_COUNT; i++) {
    zk[i].close();
    mt[i].shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.ReconfigLegacyTest </h4><pre class="type-9 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test case for https://issues.apache.org/jira/browse/ZOOKEEPER-2244
 * @throws Exception
 */
@Test(timeout=120000) public void testRestartZooKeeperServer() throws Exception {
  final int clientPorts[]=new int[SERVER_COUNT];
  StringBuilder sb=new StringBuilder();
  String server;
  for (int i=0; i < SERVER_COUNT; i++) {
    clientPorts[i]=PortAssignment.unique();
    server="server." + i + "=127.0.0.1:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ":participant;127.0.0.1:"+ clientPorts[i];
    sb.append(server + "\n");
  }
  String currentQuorumCfgSection=sb.toString();
  MainThread mt[]=new MainThread[SERVER_COUNT];
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i]=new MainThread(i,clientPorts[i],currentQuorumCfgSection,false);
    mt[i].start();
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[i],CONNECTION_TIMEOUT));
  }
  CountdownWatcher watch1=new CountdownWatcher();
  ZooKeeper zk=new ZooKeeper("127.0.0.1:" + clientPorts[0],ClientBase.CONNECTION_TIMEOUT,watch1);
  watch1.waitForConnected(ClientBase.CONNECTION_TIMEOUT);
  String zNodePath="/serverRestartTest";
  String data="originalData";
  zk.create(zNodePath,data.getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.close();
  mt[0].shutdown();
  mt[1].shutdown();
  mt[0].start();
  mt[1].start();
  for (int i=0; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[i],CONNECTION_TIMEOUT));
  }
  CountdownWatcher watch2=new CountdownWatcher();
  zk=new ZooKeeper("127.0.0.1:" + clientPorts[0],ClientBase.CONNECTION_TIMEOUT,watch2);
  watch2.waitForConnected(ClientBase.CONNECTION_TIMEOUT);
  byte[] dataBytes=zk.getData(zNodePath,null,null);
  String receivedData=new String(dataBytes);
  assertEquals(data,receivedData);
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i].shutdown();
  }
}

</code></pre>

<br>
<pre class="type-9 type-10 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies boolean conditions
"></span><br>
/** 
 * {@link https://issues.apache.org/jira/browse/ZOOKEEPER-1992}1. When a server starts from old style static config, without a client port in the server
 * specification, it should keep the client port in static config file.
 * 2. After port reconfig, the old port should be removed from static file
 * and new port added to dynamic file.
 * @throws Exception
 */
@Test public void testReconfigRemoveClientFromStatic() throws Exception {
  final int clientPorts[]=new int[SERVER_COUNT];
  final int quorumPorts[]=new int[SERVER_COUNT];
  final int electionPorts[]=new int[SERVER_COUNT];
  final int changedServerId=0;
  final int newClientPort=PortAssignment.unique();
  StringBuilder sb=new StringBuilder();
  ArrayList<String> allServers=new ArrayList<String>();
  ArrayList<String> newServers=new ArrayList<String>();
  for (int i=0; i < SERVER_COUNT; i++) {
    clientPorts[i]=PortAssignment.unique();
    quorumPorts[i]=PortAssignment.unique();
    electionPorts[i]=PortAssignment.unique();
    String server="server." + i + "=localhost:"+ quorumPorts[i]+ ":"+ electionPorts[i]+ ":participant";
    allServers.add(server);
    sb.append(server + "\n");
    if (i == changedServerId) {
      newServers.add(server + ";0.0.0.0:" + newClientPort);
    }
 else {
      newServers.add(server);
    }
  }
  String quorumCfgSection=sb.toString();
  MainThread mt[]=new MainThread[SERVER_COUNT];
  ZooKeeper zk[]=new ZooKeeper[SERVER_COUNT];
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i]=new MainThread(i,clientPorts[i],quorumCfgSection,false);
    mt[i].start();
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[i],CONNECTION_TIMEOUT));
    zk[i]=new ZooKeeper("127.0.0.1:" + clientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
    ReconfigTest.testServerHasConfig(zk[i],allServers,null);
    Properties cfg=readPropertiesFromFile(mt[i].confFile);
    Assert.assertTrue(cfg.containsKey("dynamicConfigFile"));
    Assert.assertTrue(cfg.containsKey("clientPort"));
  }
  ReconfigTest.testNormalOperation(zk[0],zk[1]);
  ReconfigTest.reconfig(zk[1],null,null,newServers,-1);
  ReconfigTest.testNormalOperation(zk[0],zk[1]);
  Thread.sleep(1000);
  for (int i=0; i < SERVER_COUNT; i++) {
    ReconfigTest.testServerHasConfig(zk[i],newServers,null);
    Properties staticCfg=readPropertiesFromFile(mt[i].confFile);
    if (i == changedServerId) {
      Assert.assertFalse(staticCfg.containsKey("clientPort"));
    }
 else {
      Assert.assertTrue(staticCfg.containsKey("clientPort"));
    }
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i].shutdown();
    zk[i].close();
  }
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test checks that when started with a single static config file the
 * servers will create a valid dynamic config file. Also checks that when
 * the static config includes a clientPort but the dynamic definition also
 * includes it, the static definition is erased.
 */
@Test public void testConfigFileBackwardCompatibility() throws Exception {
  final int clientPorts[]=new int[SERVER_COUNT];
  StringBuilder sb=new StringBuilder();
  String server;
  ArrayList<String> allServers=new ArrayList<String>();
  for (int i=0; i < SERVER_COUNT; i++) {
    clientPorts[i]=PortAssignment.unique();
    server="server." + i + "=localhost:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ":participant;localhost:"+ clientPorts[i];
    allServers.add(server);
    sb.append(server + "\n");
  }
  String currentQuorumCfgSection=sb.toString();
  MainThread mt[]=new MainThread[SERVER_COUNT];
  ZooKeeper zk[]=new ZooKeeper[SERVER_COUNT];
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i]=new MainThread(i,clientPorts[i],currentQuorumCfgSection,false);
    Assert.assertEquals(mt[i].getDynamicFiles().length,0);
    mt[i].start();
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[i],CONNECTION_TIMEOUT));
    zk[i]=new ZooKeeper("127.0.0.1:" + clientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
    File[] dynamicFiles=mt[i].getDynamicFiles();
    Assert.assertTrue(dynamicFiles.length == 1);
    ReconfigTest.testServerHasConfig(zk[i],allServers,null);
    Properties cfg=readPropertiesFromFile(mt[i].confFile);
    for (int j=0; j < SERVER_COUNT; j++) {
      Assert.assertFalse(cfg.containsKey("server." + j));
    }
    Assert.assertTrue(cfg.containsKey("dynamicConfigFile"));
    Assert.assertFalse(cfg.containsKey("clientPort"));
    cfg=readPropertiesFromFile(dynamicFiles[0]);
    for (int j=0; j < SERVER_COUNT; j++) {
      String serverLine=cfg.getProperty("server." + j,"");
      Assert.assertEquals(allServers.get(j),"server." + j + "="+ serverLine);
    }
    Assert.assertFalse(cfg.containsKey("dynamicConfigFile"));
  }
  ReconfigTest.testNormalOperation(zk[0],zk[1]);
  for (int i=0; i < SERVER_COUNT; i++) {
    zk[i].close();
    mt[i].shutdown();
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i].start();
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[i],CONNECTION_TIMEOUT));
    zk[i]=new ZooKeeper("127.0.0.1:" + clientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
    ReconfigTest.testServerHasConfig(zk[i],allServers,null);
  }
  ReconfigTest.testNormalOperation(zk[0],zk[1]);
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i].shutdown();
    zk[i].close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.ReconfigRecoveryTest </h4><pre class="type-9 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
"></span><br>
/** 
 * Reconfiguration recovery - current config servers discover .next file,
 * but they're both observers and their ports change in next config. Suppose
 * that next config wasn't activated yet. Should complete reconfiguration.
 */
@Test public void testCurrentServersAreObserversInNextConfig() throws Exception {
  ClientBase.setupTestEnv();
  final int SERVER_COUNT=5;
  final int clientPorts[]=new int[SERVER_COUNT];
  final int oldClientPorts[]=new int[2];
  StringBuilder sb=new StringBuilder();
  String server;
  String currentQuorumCfg, nextQuorumCfgSection;
  ArrayList<String> allServersNext=new ArrayList<String>();
  for (int i=0; i < 2; i++) {
    oldClientPorts[i]=PortAssignment.unique();
    server="server." + i + "=localhost:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ":participant;localhost:"+ oldClientPorts[i];
    sb.append(server + "\n");
  }
  currentQuorumCfg=sb.toString();
  sb=new StringBuilder();
  String role;
  for (int i=0; i < SERVER_COUNT; i++) {
    clientPorts[i]=PortAssignment.unique();
    if (i < 2) {
      role="observer";
    }
 else {
      role="participant";
    }
    server="server." + i + "=localhost:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ":"+ role+ ";localhost:"+ clientPorts[i];
    allServersNext.add(server);
    sb.append(server + "\n");
  }
  nextQuorumCfgSection=sb.toString();
  MainThread mt[]=new MainThread[SERVER_COUNT];
  ZooKeeper zk[]=new ZooKeeper[SERVER_COUNT];
  for (int i=0; i < 2; i++) {
    mt[i]=new MainThread(i,oldClientPorts[i],currentQuorumCfg,true,"100000000");
    mt[i].start();
    zk[i]=new ZooKeeper("127.0.0.1:" + oldClientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
  }
  for (int i=0; i < 2; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + oldClientPorts[i],CONNECTION_TIMEOUT * 2));
  }
  ReconfigTest.testNormalOperation(zk[0],zk[1]);
  for (int i=0; i < 2; i++) {
    mt[i].shutdown();
    zk[i].close();
  }
  for (int i=0; i < 2; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerDown("127.0.0.1:" + oldClientPorts[i],CONNECTION_TIMEOUT * 2));
  }
  for (int i=0; i < 2; i++) {
    mt[i].writeTempDynamicConfigFile(nextQuorumCfgSection,"200000000");
    mt[i].start();
    zk[i]=new ZooKeeper("127.0.0.1:" + clientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
  }
  for (int i=2; i < SERVER_COUNT; i++) {
    mt[i]=new MainThread(i,clientPorts[i],currentQuorumCfg + allServersNext.get(i));
    mt[i].start();
    zk[i]=new ZooKeeper("127.0.0.1:" + clientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[i],CONNECTION_TIMEOUT * 2));
    ReconfigTest.testServerHasConfig(zk[i],allServersNext,null);
  }
  ReconfigTest.testNormalOperation(zk[0],zk[2]);
  ReconfigTest.testNormalOperation(zk[4],zk[1]);
  for (int i=0; i < SERVER_COUNT; i++) {
    zk[i].close();
    mt[i].shutdown();
  }
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests conversion of observer to participant AFTER new config was already
 * committed. Old config: servers 0 (participant), 1 (participant), 2
 * (observer) New config: servers 2 (participant), 3 (participant) We start
 * server 2 with old config and start server 3 with new config. All other
 * servers are down. In order to terminate FLE, server 3 must 'convince'
 * server 2 to adopt the new config and turn into a participant.
 */
@Test public void testObserverConvertedToParticipantDuringFLE() throws Exception {
  ClientBase.setupTestEnv();
  final int SERVER_COUNT=4;
  int[][] ports=generatePorts(SERVER_COUNT);
  String currentQuorumCfgSection, nextQuorumCfgSection;
  HashSet<Integer> observers=new HashSet<Integer>();
  observers.add(2);
  StringBuilder sb=generateConfig(3,ports,observers);
  currentQuorumCfgSection=sb.toString();
  ArrayList<String> allServersNext=new ArrayList<String>();
  sb=new StringBuilder();
  for (int i=2; i < SERVER_COUNT; i++) {
    String server="server." + i + "=localhost:"+ ports[i][0]+ ":"+ ports[i][1]+ ":participant;localhost:"+ ports[i][2];
    allServersNext.add(server);
    sb.append(server + "\n");
  }
  nextQuorumCfgSection=sb.toString();
  MainThread mt[]=new MainThread[SERVER_COUNT];
  ZooKeeper zk[]=new ZooKeeper[SERVER_COUNT];
  mt[2]=new MainThread(2,ports[2][2],currentQuorumCfgSection,true,"100000000");
  mt[2].start();
  zk[2]=new ZooKeeper("127.0.0.1:" + ports[2][2],ClientBase.CONNECTION_TIMEOUT,this);
  mt[3]=new MainThread(3,ports[3][2],nextQuorumCfgSection,true,"200000000");
  mt[3].start();
  zk[3]=new ZooKeeper("127.0.0.1:" + ports[3][2],ClientBase.CONNECTION_TIMEOUT,this);
  for (int i=2; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + ports[i][2],CONNECTION_TIMEOUT * 2));
    ReconfigTest.testServerHasConfig(zk[i],allServersNext,null);
  }
  Assert.assertEquals(nextQuorumCfgSection + "version=200000000",ReconfigTest.testServerHasConfig(zk[2],null,null));
  Assert.assertEquals(nextQuorumCfgSection + "version=200000000",ReconfigTest.testServerHasConfig(zk[3],null,null));
  ReconfigTest.testNormalOperation(zk[2],zk[2]);
  ReconfigTest.testNormalOperation(zk[3],zk[2]);
  for (int i=2; i < SERVER_COUNT; i++) {
    zk[i].close();
    mt[i].shutdown();
  }
}

</code></pre>

<br>
<pre class="type-9 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
"></span><br>
/** 
 * Reconfiguration recovery - test that if servers in old config have a
 * .next file but no quorum of new config is up then no progress should be
 * possible (no progress will happen to ensure safety as the new config
 * might be actually up but partitioned from old config)
 */
@Test public void testNextConfigUnreachable() throws Exception {
  ClientBase.setupTestEnv();
  final int SERVER_COUNT=5;
  final int clientPorts[]=new int[SERVER_COUNT];
  StringBuilder sb=new StringBuilder();
  String server;
  String currentQuorumCfgSection=null, nextQuorumCfgSection;
  for (int i=0; i < SERVER_COUNT; i++) {
    clientPorts[i]=PortAssignment.unique();
    server="server." + i + "=localhost:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ":participant;localhost:"+ clientPorts[i];
    sb.append(server + "\n");
    if (i == 1)     currentQuorumCfgSection=sb.toString();
  }
  nextQuorumCfgSection=sb.toString();
  MainThread mt[]=new MainThread[SERVER_COUNT];
  ZooKeeper zk[]=new ZooKeeper[SERVER_COUNT];
  for (int i=0; i < 2; i++) {
    mt[i]=new MainThread(i,clientPorts[i],currentQuorumCfgSection,true,"100000000");
    mt[i].writeTempDynamicConfigFile(nextQuorumCfgSection,"200000000");
    mt[i].start();
    zk[i]=new ZooKeeper("127.0.0.1:" + clientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
  }
  Thread.sleep(CONNECTION_TIMEOUT * 2);
  for (int i=0; i < 2; i++) {
    Assert.assertFalse("server " + i + " is up but shouldn't be",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[i],CONNECTION_TIMEOUT / 10));
  }
  for (int i=0; i < 2; i++) {
    zk[i].close();
    mt[i].shutdown();
  }
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Reconfiguration recovery - test that a reconfiguration is completed if
 * leader has .next file during startup and new config is not running yet
 */
@Test public void testNextConfigCompletion() throws Exception {
  ClientBase.setupTestEnv();
  final int SERVER_COUNT=3;
  final int clientPorts[]=new int[SERVER_COUNT];
  StringBuilder sb=new StringBuilder();
  String server;
  ArrayList<String> allServers=new ArrayList<String>();
  String currentQuorumCfgSection=null, nextQuorumCfgSection;
  for (int i=0; i < SERVER_COUNT; i++) {
    clientPorts[i]=PortAssignment.unique();
    server="server." + i + "=localhost:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ":participant;localhost:"+ clientPorts[i];
    allServers.add(server);
    sb.append(server + "\n");
    if (i == 1)     currentQuorumCfgSection=sb.toString();
  }
  nextQuorumCfgSection=sb.toString();
  MainThread mt[]=new MainThread[SERVER_COUNT];
  ZooKeeper zk[]=new ZooKeeper[SERVER_COUNT];
  for (int i=0; i < SERVER_COUNT - 1; i++) {
    mt[i]=new MainThread(i,clientPorts[i],currentQuorumCfgSection,true,"100000000");
    mt[i].writeTempDynamicConfigFile(nextQuorumCfgSection,"200000000");
    mt[i].start();
    zk[i]=new ZooKeeper("127.0.0.1:" + clientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
  }
  Assert.assertTrue("waiting for server 0 being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[0],CONNECTION_TIMEOUT));
  Assert.assertTrue("waiting for server 1 being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[1],CONNECTION_TIMEOUT));
  int leader=mt[0].main.quorumPeer.leader == null ? 1 : 0;
  sb=new StringBuilder();
  sb.append(allServers.get(leader) + "\n");
  sb.append(allServers.get(2) + "\n");
  String newServerInitialConfig=sb.toString();
  mt[2]=new MainThread(2,clientPorts[2],newServerInitialConfig);
  mt[2].start();
  zk[2]=new ZooKeeper("127.0.0.1:" + clientPorts[2],ClientBase.CONNECTION_TIMEOUT,this);
  Assert.assertTrue("waiting for server 2 being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[2],CONNECTION_TIMEOUT));
  ReconfigTest.testServerHasConfig(zk[0],allServers,null);
  ReconfigTest.testServerHasConfig(zk[1],allServers,null);
  ReconfigTest.testServerHasConfig(zk[2],allServers,null);
  ReconfigTest.testNormalOperation(zk[0],zk[2]);
  ReconfigTest.testNormalOperation(zk[2],zk[1]);
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i].shutdown();
    zk[i].close();
  }
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests conversion of observer to participant during reconfig recovery, new
 * config was not committed yet. Old config: servers 0 (participant), 1
 * (participant), 2 (observer) New config: servers 2 (participant), 3
 * (participant) We start server servers 0, 1, 2 with old config and a .next
 * file indicating a reconfig in progress. We start server 3 with old config
 * + itself in config file. In this scenario server 2 can't be converted to
 * participant during reconfig since we don't gossip about proposed
 * configurations, only about committed ones. This tests that new config can
 * be completed, which requires server 2's ack for the newleader message,
 * even though its an observer.
 */
@Test public void testCurrentObserverIsParticipantInNewConfig() throws Exception {
  ClientBase.setupTestEnv();
  final int SERVER_COUNT=4;
  int[][] ports=generatePorts(SERVER_COUNT);
  String currentQuorumCfg, nextQuorumCfgSection;
  HashSet<Integer> observers=new HashSet<Integer>();
  observers.add(2);
  StringBuilder sb=generateConfig(3,ports,observers);
  currentQuorumCfg=sb.toString();
  MainThread mt[]=new MainThread[SERVER_COUNT];
  ZooKeeper zk[]=new ZooKeeper[SERVER_COUNT];
  for (int i=0; i <= 2; i++) {
    mt[i]=new MainThread(i,ports[i][2],currentQuorumCfg,true,"100000000");
    mt[i].start();
    zk[i]=new ZooKeeper("127.0.0.1:" + ports[i][2],ClientBase.CONNECTION_TIMEOUT,this);
  }
  ReconfigTest.testNormalOperation(zk[0],zk[2]);
  for (int i=0; i <= 2; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + ports[i][2],CONNECTION_TIMEOUT * 2));
  }
  for (int i=0; i <= 2; i++) {
    mt[i].shutdown();
    zk[i].close();
  }
  ArrayList<String> allServersNext=new ArrayList<String>();
  sb=new StringBuilder();
  for (int i=2; i < SERVER_COUNT; i++) {
    String server="server." + i + "=localhost:"+ ports[i][0]+ ":"+ ports[i][1]+ ":participant;localhost:"+ ports[i][2];
    allServersNext.add(server);
    sb.append(server + "\n");
  }
  nextQuorumCfgSection=sb.toString();
  for (int i=0; i <= 2; i++) {
    mt[i].writeTempDynamicConfigFile(nextQuorumCfgSection,"200000000");
    mt[i].start();
    zk[i]=new ZooKeeper("127.0.0.1:" + ports[i][2],ClientBase.CONNECTION_TIMEOUT,this);
  }
  mt[3]=new MainThread(3,ports[3][2],currentQuorumCfg + allServersNext.get(1));
  mt[3].start();
  zk[3]=new ZooKeeper("127.0.0.1:" + ports[3][2],ClientBase.CONNECTION_TIMEOUT,this);
  for (int i=2; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + ports[i][2],CONNECTION_TIMEOUT * 3));
    ReconfigTest.testServerHasConfig(zk[i],allServersNext,null);
  }
  ReconfigTest.testNormalOperation(zk[0],zk[2]);
  ReconfigTest.testNormalOperation(zk[3],zk[1]);
  Assert.assertEquals(nextQuorumCfgSection + "version=200000000",ReconfigTest.testServerHasConfig(zk[2],null,null));
  Assert.assertEquals(nextQuorumCfgSection + "version=200000000",ReconfigTest.testServerHasConfig(zk[3],null,null));
  for (int i=0; i < SERVER_COUNT; i++) {
    zk[i].close();
    mt[i].shutdown();
  }
}

</code></pre>

<br>
<pre class="type-9 type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Reconfiguration recovery - test that old config members will join the new
 * config if its already active, and not try to complete the reconfiguration
 */
@Test public void testNextConfigAlreadyActive() throws Exception {
  ClientBase.setupTestEnv();
  final int SERVER_COUNT=5;
  final int clientPorts[]=new int[SERVER_COUNT];
  StringBuilder sb=new StringBuilder();
  String server;
  String currentQuorumCfgSection=null, nextQuorumCfgSection;
  ArrayList<String> allServers=new ArrayList<String>();
  for (int i=0; i < SERVER_COUNT; i++) {
    clientPorts[i]=PortAssignment.unique();
    server="server." + i + "=localhost:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ":participant;localhost:"+ clientPorts[i];
    allServers.add(server);
    sb.append(server + "\n");
    if (i == 1)     currentQuorumCfgSection=sb.toString();
  }
  nextQuorumCfgSection=sb.toString();
  MainThread mt[]=new MainThread[SERVER_COUNT];
  ZooKeeper zk[]=new ZooKeeper[SERVER_COUNT];
  for (int i=2; i < SERVER_COUNT; i++) {
    mt[i]=new MainThread(i,clientPorts[i],nextQuorumCfgSection,true,"200000000");
    mt[i].start();
    zk[i]=new ZooKeeper("127.0.0.1:" + clientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
  }
  for (int i=2; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[i],CONNECTION_TIMEOUT));
  }
  ReconfigTest.testNormalOperation(zk[2],zk[3]);
  long epoch=mt[2].main.quorumPeer.getAcceptedEpoch();
  for (int i=0; i < 2; i++) {
    mt[i]=new MainThread(i,clientPorts[i],currentQuorumCfgSection,true,"100000000");
    mt[i].writeTempDynamicConfigFile(nextQuorumCfgSection,"200000000");
    mt[i].start();
    zk[i]=new ZooKeeper("127.0.0.1:" + clientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
  }
  for (int i=0; i < 2; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[i],CONNECTION_TIMEOUT * 2));
  }
  Assert.assertEquals(epoch,mt[0].main.quorumPeer.getAcceptedEpoch());
  Assert.assertEquals(epoch,mt[1].main.quorumPeer.getAcceptedEpoch());
  Assert.assertEquals(epoch,mt[2].main.quorumPeer.getAcceptedEpoch());
  ReconfigTest.testServerHasConfig(zk[0],allServers,null);
  ReconfigTest.testServerHasConfig(zk[1],allServers,null);
  ReconfigTest.testNormalOperation(zk[0],zk[2]);
  ReconfigTest.testNormalOperation(zk[4],zk[1]);
  for (int i=0; i < SERVER_COUNT; i++) {
    zk[i].close();
    mt[i].shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.StandaloneDisabledTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Ensure observer cannot start by itself
 */
@Test public void startObserver() throws Exception {
  int clientPort=PortAssignment.unique();
  String config="server." + observer1 + "=localhost:"+ PortAssignment.unique()+ ":"+ clientPort+ ":observer;"+ "localhost:"+ PortAssignment.unique();
  MainThread observer=new MainThread(observer1,clientPort,config);
  observer.start();
  Assert.assertFalse("Observer was able to start by itself!",ClientBase.waitForServerUp("127.0.0.1:" + clientPort,CONNECTION_TIMEOUT));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.Zab1_0Test </h4><pre class="type-5 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testLeaderInElectingFollowers() throws Exception {
  File tmpDir=File.createTempFile("test","dir",testData);
  tmpDir.delete();
  tmpDir.mkdir();
  Leader leader=null;
  try {
    QuorumPeer peer=createQuorumPeer(tmpDir);
    leader=createLeader(tmpDir,peer);
    peer.leader=leader;
    FollowerMockThread f1=new FollowerMockThread(1,leader,false);
    FollowerMockThread f2=new FollowerMockThread(2,leader,false);
    leader.leaderStateSummary=new StateSummary(leader.self.getCurrentEpoch(),leader.zk.getLastProcessedZxid());
    f1.start();
    f2.start();
    f1.join(leader.self.getInitLimit() * leader.self.getTickTime() + 5000);
    f2.join(leader.self.getInitLimit() * leader.self.getTickTime() + 5000);
    Assert.assertTrue(f1.msg + " without waiting for leader",f1.msg == null);
    Assert.assertTrue(f2.msg + " without waiting for leader",f2.msg == null);
  }
  finally {
    if (leader != null) {
      leader.shutdown("end of test");
    }
    TestUtils.deleteFileRecursively(tmpDir);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ACLCountTest </h4><pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Create a node and add 4 ACL values to it, but there are only 2 unique ACL values,
 * and each is repeated once:
 * ACL(ZooDefs.Perms.READ,ZooDefs.Ids.ANYONE_ID_UNSAFE);
 * ACL(ZooDefs.Perms.ALL,ZooDefs.Ids.AUTH_IDS);
 * ACL(ZooDefs.Perms.READ,ZooDefs.Ids.ANYONE_ID_UNSAFE);
 * ACL(ZooDefs.Perms.ALL,ZooDefs.Ids.AUTH_IDS);
 * Even though we've added 4 ACL values, there should only be 2 ACLs for that node,
 * since there are only 2 *unique* ACL values.
 */
@Test public void testAclCount() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(1000);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  ZooKeeper zk;
  final ArrayList<ACL> CREATOR_ALL_AND_WORLD_READABLE=new ArrayList<ACL>(){
{
      add(new ACL(ZooDefs.Perms.READ,ZooDefs.Ids.ANYONE_ID_UNSAFE));
      add(new ACL(ZooDefs.Perms.ALL,ZooDefs.Ids.AUTH_IDS));
      add(new ACL(ZooDefs.Perms.READ,ZooDefs.Ids.ANYONE_ID_UNSAFE));
      add(new ACL(ZooDefs.Perms.ALL,ZooDefs.Ids.AUTH_IDS));
    }
  }
;
  try {
    LOG.info("starting up the zookeeper server .. waiting");
    Assert.assertTrue("waiting for server being up",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
    zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
    zk.addAuthInfo("digest","pat:test".getBytes());
    zk.setACL("/",Ids.CREATOR_ALL_ACL,-1);
    String path="/path";
    try {
      Assert.assertEquals(4,CREATOR_ALL_AND_WORLD_READABLE.size());
    }
 catch (    Exception e) {
      LOG.error("Something is fundamentally wrong with ArrayList's add() method. add()ing four times to an empty ArrayList should result in an ArrayList with 4 members.");
      throw e;
    }
    zk.create(path,path.getBytes(),CREATOR_ALL_AND_WORLD_READABLE,CreateMode.PERSISTENT);
    List<ACL> acls=zk.getACL("/path",new Stat());
    Assert.assertEquals(2,acls.size());
  }
 catch (  Exception e) {
    Assert.assertTrue(false);
  }
  f.shutdown();
  zks.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ACLTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testDisconnectedAddAuth() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(1000);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  try {
    LOG.info("starting up the zookeeper server .. waiting");
    Assert.assertTrue("waiting for server being up",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
    ZooKeeper zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
    try {
      zk.addAuthInfo("digest","pat:test".getBytes());
      zk.setACL("/",Ids.CREATOR_ALL_ACL,-1);
    }
  finally {
      zk.close();
    }
  }
  finally {
    f.shutdown();
    zks.shutdown();
    Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown(HOSTPORT,ClientBase.CONNECTION_TIMEOUT));
  }
}

</code></pre>

<br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Verify that acl optimization of storing just
 * a few acls and there references in the data
 * node is actually working.
 */
@Test public void testAcls() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(1000);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  ZooKeeper zk;
  String path;
  try {
    LOG.info("starting up the zookeeper server .. waiting");
    Assert.assertTrue("waiting for server being up",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
    zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
    LOG.info("starting creating acls");
    for (int i=0; i < 100; i++) {
      path="/" + i;
      zk.create(path,path.getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    }
    Assert.assertTrue("size of the acl map ",(1 == zks.getZKDatabase().getAclSize()));
    for (int j=100; j < 200; j++) {
      path="/" + j;
      ACL acl=new ACL();
      acl.setPerms(0);
      Id id=new Id();
      id.setId("1.1.1." + j);
      id.setScheme("ip");
      acl.setId(id);
      ArrayList<ACL> list=new ArrayList<ACL>();
      list.add(acl);
      zk.create(path,path.getBytes(),list,CreateMode.PERSISTENT);
    }
    Assert.assertTrue("size of the acl map ",(101 == zks.getZKDatabase().getAclSize()));
  }
  finally {
    f.shutdown();
    zks.shutdown();
    Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
  }
  startSignal=new CountDownLatch(1);
  zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  try {
    Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
    startSignal.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS);
    Assert.assertTrue("count == 0",startSignal.getCount() == 0);
    Assert.assertTrue("acl map ",(101 == zks.getZKDatabase().getAclSize()));
    for (int j=200; j < 205; j++) {
      path="/" + j;
      ACL acl=new ACL();
      acl.setPerms(0);
      Id id=new Id();
      id.setId("1.1.1." + j);
      id.setScheme("ip");
      acl.setId(id);
      ArrayList<ACL> list=new ArrayList<ACL>();
      list.add(acl);
      zk.create(path,path.getBytes(),list,CreateMode.PERSISTENT);
    }
    Assert.assertTrue("acl map ",(106 == zks.getZKDatabase().getAclSize()));
    zk.close();
  }
  finally {
    f.shutdown();
    zks.shutdown();
    Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown(HOSTPORT,ClientBase.CONNECTION_TIMEOUT));
  }
}

</code></pre>

<br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testIPAuthenticationIsValidCIDR() throws Exception {
  IPAuthenticationProvider prov=new IPAuthenticationProvider();
  Assert.assertTrue("testing no netmask",prov.isValid("127.0.0.1"));
  Assert.assertTrue("testing single ip netmask",prov.isValid("127.0.0.1/32"));
  Assert.assertTrue("testing lowest netmask possible",prov.isValid("127.0.0.1/0"));
  Assert.assertFalse("testing netmask too high",prov.isValid("127.0.0.1/33"));
  Assert.assertFalse("testing netmask too low",prov.isValid("10.0.0.1/-1"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.AsyncHammerTest </h4><pre class="type-9 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
"></span><br>
@Test public void testHammer() throws Exception {
  setUp(false);
  bang=true;
  LOG.info("Starting hammers");
  HammerThread[] hammers=new HammerThread[100];
  for (int i=0; i < hammers.length; i++) {
    hammers[i]=new HammerThread("HammerThread-" + i);
    hammers[i].start();
  }
  LOG.info("Started hammers");
  Thread.sleep(5000);
  bang=false;
  LOG.info("Stopping hammers");
  for (int i=0; i < hammers.length; i++) {
    hammers[i].interrupt();
    verifyThreadTerminated(hammers[i],60000);
    Assert.assertFalse(hammers[i].failed);
  }
  LOG.info("Hammers stopped, verifying consistency");
  qb.verifyRootOfAllServersMatch(qb.hostPort);
  restart();
  LOG.info("Verifying hammers 2");
  qb.verifyRootOfAllServersMatch(qb.hostPort);
  tearDown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.AtomicFileOutputStreamTest </h4><pre class="type-5 type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test case where there is no existing file
 */
@Test public void testWriteNewFile() throws IOException {
  OutputStream fos=new AtomicFileOutputStream(dstFile);
  assertFalse(dstFile.exists());
  fos.write(TEST_STRING.getBytes());
  fos.flush();
  assertFalse(dstFile.exists());
  fos.close();
  assertTrue(dstFile.exists());
  String readBackData=ClientBase.readFile(dstFile);
  assertEquals(TEST_STRING,readBackData);
}

</code></pre>

<br>
<pre class="type-5 type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test case where there is no existing file
 */
@Test public void testOverwriteFile() throws IOException {
  assertTrue("Creating empty dst file",dstFile.createNewFile());
  OutputStream fos=new AtomicFileOutputStream(dstFile);
  assertTrue("Empty file still exists",dstFile.exists());
  fos.write(TEST_STRING.getBytes());
  fos.flush();
  assertEquals("",ClientBase.readFile(dstFile));
  fos.close();
  String readBackData=ClientBase.readFile(dstFile);
  assertEquals(TEST_STRING,readBackData);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ChrootTest </h4><pre class="type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testChrootSynchronous() throws IOException, InterruptedException, KeeperException {
  ZooKeeper zk1=createClient();
  try {
    zk1.create("/ch1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  }
  finally {
    if (zk1 != null)     zk1.close();
  }
  ZooKeeper zk2=createClient(hostPort + "/ch1");
  try {
    Assert.assertEquals("/ch2",zk2.create("/ch2",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT));
  }
  finally {
    if (zk2 != null)     zk2.close();
  }
  zk1=createClient();
  zk2=createClient(hostPort + "/ch1");
  try {
    MyWatcher w1=new MyWatcher("/ch1");
    Assert.assertNotNull(zk1.exists("/ch1",w1));
    MyWatcher w2=new MyWatcher("/ch1/ch2");
    Assert.assertNotNull(zk1.exists("/ch1/ch2",w2));
    MyWatcher w3=new MyWatcher("/ch2");
    Assert.assertNotNull(zk2.exists("/ch2",w3));
    MyWatcher w4=new MyWatcher("/ch1");
    zk1.getChildren("/ch1",w4);
    MyWatcher w5=new MyWatcher("/");
    zk2.getChildren("/",w5);
    zk1.setData("/ch1","1".getBytes(),-1);
    zk2.setData("/ch2","2".getBytes(),-1);
    Assert.assertTrue(w1.matches());
    Assert.assertTrue(w2.matches());
    Assert.assertTrue(w3.matches());
    try {
      zk2.setData("/ch3","3".getBytes(),-1);
    }
 catch (    KeeperException.NoNodeException e) {
      Assert.assertEquals("/ch3",e.getPath());
    }
    Assert.assertTrue(Arrays.equals("1".getBytes(),zk1.getData("/ch1",false,null)));
    Assert.assertTrue(Arrays.equals("2".getBytes(),zk1.getData("/ch1/ch2",false,null)));
    Assert.assertTrue(Arrays.equals("2".getBytes(),zk2.getData("/ch2",false,null)));
    zk2.delete("/ch2",-1);
    Assert.assertTrue(w4.matches());
    Assert.assertTrue(w5.matches());
    zk1.delete("/ch1",-1);
    Assert.assertNull(zk1.exists("/ch1",false));
    Assert.assertNull(zk1.exists("/ch1/ch2",false));
    Assert.assertNull(zk2.exists("/ch2",false));
  }
  finally {
    if (zk1 != null)     zk1.close();
    if (zk2 != null)     zk2.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ClientBase </h4><pre class="type-12 type-10 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@After public void tearDown() throws Exception {
  LOG.info("tearDown starting");
  tearDownAll();
  stopServer();
  if (tmpDir != null) {
    Assert.assertTrue("delete " + tmpDir.toString(),recursiveDelete(tmpDir));
  }
  serverFactory=null;
  JMXEnv.tearDown();
  OSMXBean osMbean=new OSMXBean();
  if (osMbean.getUnix() == true) {
    long fdCount=osMbean.getOpenFileDescriptorCount();
    String message="fdcount after test is: " + fdCount + " at start it was "+ initialFdCount;
    LOG.info(message);
    if (fdCount > initialFdCount) {
      LOG.info("sleeping for 20 secs");
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ClientPortBindTest </h4><pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
/** 
 * Verify that the server binds to the specified address
 */
@Test public void testBindByAddress() throws Exception {
  String bindAddress=null;
  Enumeration<NetworkInterface> intfs=NetworkInterface.getNetworkInterfaces();
  while (intfs.hasMoreElements()) {
    NetworkInterface i=intfs.nextElement();
    if (i.isLoopback()) {
      Enumeration<InetAddress> addrs=i.getInetAddresses();
      if (addrs.hasMoreElements()) {
        bindAddress=addrs.nextElement().getHostAddress();
      }
    }
  }
  if (bindAddress == null) {
    LOG.warn("Unable to determine loop back address, skipping test");
    return;
  }
  final int PORT=PortAssignment.unique();
  LOG.info("Using " + bindAddress + " as the bind address");
  final String HOSTPORT=bindAddress + ":" + PORT;
  LOG.info("Using " + HOSTPORT + " as the host/port");
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(new InetSocketAddress(bindAddress,PORT),-1);
  f.startup(zks);
  LOG.info("starting up the the server, waiting");
  Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  startSignal=new CountDownLatch(1);
  ZooKeeper zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
  try {
    startSignal.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS);
    Assert.assertTrue("count == 0",startSignal.getCount() == 0);
    zk.close();
  }
  finally {
    f.shutdown();
    zks.shutdown();
    Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ClientTest </h4><pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSequentialNodeNames() throws IOException, InterruptedException, KeeperException {
  String path="/SEQUENCE";
  String file="TEST";
  String filepath=path + "/" + file;
  ZooKeeper zk=null;
  try {
    zk=createClient();
    zk.create(path,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    zk.create(filepath,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    List<String> children=zk.getChildren(path,false);
    Assert.assertEquals(1,children.size());
    Assert.assertEquals(file + "0000000000",children.get(0));
    zk.create(filepath,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    children=zk.getChildren(path,false);
    Assert.assertEquals(2,children.size());
    Assert.assertTrue("contains child 1",children.contains(file + "0000000001"));
    zk.create(filepath,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    children=zk.getChildren(path,false);
    Assert.assertEquals(3,children.size());
    Assert.assertTrue("contains child 2",children.contains(file + "0000000002"));
    for (int i=children.size(); i < 105; i++)     zk.create(filepath,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    children=zk.getChildren(path,false);
    Assert.assertTrue("contains child 104",children.contains(file + "0000000104"));
  }
  finally {
    if (zk != null)     zk.close();
  }
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testPathValidation() throws Exception {
  ZooKeeper zk=createClient();
  verifyCreateFails(null,zk);
  verifyCreateFails("",zk);
  verifyCreateFails("//",zk);
  verifyCreateFails("///",zk);
  verifyCreateFails("////",zk);
  verifyCreateFails("/.",zk);
  verifyCreateFails("/..",zk);
  verifyCreateFails("/./",zk);
  verifyCreateFails("/../",zk);
  verifyCreateFails("/foo/./",zk);
  verifyCreateFails("/foo/../",zk);
  verifyCreateFails("/foo/.",zk);
  verifyCreateFails("/foo/..",zk);
  verifyCreateFails("/./.",zk);
  verifyCreateFails("/../..",zk);
  verifyCreateFails("/\u0001foo",zk);
  verifyCreateFails("/foo/bar/",zk);
  verifyCreateFails("/foo//bar",zk);
  verifyCreateFails("/foo/bar//",zk);
  verifyCreateFails("foo",zk);
  verifyCreateFails("a",zk);
  zk.create("/createseqpar",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  try {
    zk.create("/createseqpar/",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    Assert.assertTrue(false);
  }
 catch (  IllegalArgumentException be) {
  }
  zk.create("/createseqpar/",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
  zk.create("/createseqpar/.",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
  zk.create("/createseqpar/..",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
  try {
    zk.create("/createseqpar//",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    Assert.assertTrue(false);
  }
 catch (  IllegalArgumentException be) {
  }
  try {
    zk.create("/createseqpar/./",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    Assert.assertTrue(false);
  }
 catch (  IllegalArgumentException be) {
  }
  try {
    zk.create("/createseqpar/../",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    Assert.assertTrue(false);
  }
 catch (  IllegalArgumentException be) {
  }
  PrepRequestProcessor.setFailCreate(true);
  try {
    zk.create("/m",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    Assert.assertTrue(false);
  }
 catch (  KeeperException.BadArgumentsException be) {
  }
  PrepRequestProcessor.setFailCreate(false);
  zk.create("/.foo",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/.f.",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/..f",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/..f..",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/f.c",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/f\u0040f",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/f",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/f/.f",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/f/f.",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/f/..f",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/f/f..",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/f/.f/f",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/f/f./f",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
}

</code></pre>

<br>
<pre class="type-9 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
"></span><br>
/** 
 * Verify that the client is cleaning up properly. Open/close a large
 * number of sessions. Essentially looking to see if sockets/selectors
 * are being cleaned up properly during close.
 * @throws Throwable
 */
@Test public void testClientCleanup() throws Throwable {
  OSMXBean osMbean=new OSMXBean();
  if (osMbean.getUnix() == false) {
    LOG.warn("skipping testClientCleanup, only available on Unix");
    return;
  }
  final int threadCount=3;
  final int clientCount=10;
  long initialFdCount=osMbean.getOpenFileDescriptorCount();
  VerifyClientCleanup threads[]=new VerifyClientCleanup[threadCount];
  for (int i=0; i < threads.length; i++) {
    threads[i]=new VerifyClientCleanup("VCC" + i,clientCount);
    threads[i].start();
  }
  for (int i=0; i < threads.length; i++) {
    threads[i].join(CONNECTION_TIMEOUT);
    Assert.assertTrue(threads[i].current == threads[i].count);
  }
  long currentCount=osMbean.getOpenFileDescriptorCount();
  final String logmsg="open fds after test ({}) are not significantly higher than before ({})";
  if (currentCount > initialFdCount + 10) {
    LOG.error(logmsg,Long.valueOf(currentCount),Long.valueOf(initialFdCount));
  }
 else {
    LOG.info(logmsg,Long.valueOf(currentCount),Long.valueOf(initialFdCount));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.CnxManagerTest </h4><pre class="type-10 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSocketTimeout() throws Exception {
  QuorumPeer peer=new QuorumPeer(peers,peerTmpdir[1],peerTmpdir[1],peerClientPort[1],3,1,2000,2,2);
  QuorumCnxManager cnxManager=new QuorumCnxManager(peer);
  QuorumCnxManager.Listener listener=cnxManager.listener;
  if (listener != null) {
    listener.start();
  }
 else {
    LOG.error("Null listener when initializing cnx manager");
  }
  int port=peers.get(peer.getId()).electionAddr.getPort();
  LOG.info("Election port: " + port);
  Thread.sleep(1000);
  Socket sock=new Socket();
  sock.connect(peers.get(1L).electionAddr,5000);
  long begin=Time.currentElapsedTime();
  cnxManager.receiveConnection(sock);
  long end=Time.currentElapsedTime();
  if ((end - begin) > ((peer.getSyncLimit() * peer.getTickTime()) + 500))   Assert.fail("Waited more than necessary");
  cnxManager.halt();
  Assert.assertFalse(cnxManager.listener.isAlive());
}

</code></pre>

<br>
<pre class="type-10 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCnxManager() throws Exception {
  CnxManagerThread thread=new CnxManagerThread();
  thread.start();
  QuorumPeer peer=new QuorumPeer(peers,peerTmpdir[1],peerTmpdir[1],peerClientPort[1],3,1,1000,2,2);
  QuorumCnxManager cnxManager=new QuorumCnxManager(peer);
  QuorumCnxManager.Listener listener=cnxManager.listener;
  if (listener != null) {
    listener.start();
  }
 else {
    LOG.error("Null listener when initializing cnx manager");
  }
  cnxManager.toSend(0L,createMsg(ServerState.LOOKING.ordinal(),1,-1,1));
  Message m=null;
  int numRetries=1;
  while ((m == null) && (numRetries++ <= THRESHOLD)) {
    m=cnxManager.pollRecvQueue(3000,TimeUnit.MILLISECONDS);
    if (m == null)     cnxManager.connectAll();
  }
  Assert.assertTrue("Exceeded number of retries",numRetries <= THRESHOLD);
  thread.join(5000);
  if (thread.isAlive()) {
    Assert.fail("Thread didn't join");
  }
 else {
    if (thread.failed)     Assert.fail("Did not receive expected message");
  }
  cnxManager.halt();
  Assert.assertFalse(cnxManager.listener.isAlive());
}

</code></pre>

<br>
<pre class="type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests a bug in QuorumCnxManager that causes a NPE when a 3.4.6
 * observer connects to a 3.5.0 server. {@link https://issues.apache.org/jira/browse/ZOOKEEPER-1789}
 * @throws Exception
 */
@Test public void testCnxManagerNPE() throws Exception {
  peers.get(2L).type=LearnerType.OBSERVER;
  QuorumPeer peer=new QuorumPeer(peers,peerTmpdir[1],peerTmpdir[1],peerClientPort[1],3,1,1000,2,2);
  QuorumCnxManager cnxManager=new QuorumCnxManager(peer);
  QuorumCnxManager.Listener listener=cnxManager.listener;
  if (listener != null) {
    listener.start();
  }
 else {
    LOG.error("Null listener when initializing cnx manager");
  }
  int port=peers.get(peer.getId()).electionAddr.getPort();
  LOG.info("Election port: " + port);
  Thread.sleep(1000);
  SocketChannel sc=SocketChannel.open();
  sc.socket().connect(peers.get(1L).electionAddr,5000);
  byte[] msgBytes=new byte[8];
  ByteBuffer msgBuffer=ByteBuffer.wrap(msgBytes);
  msgBuffer.putLong(2L);
  msgBuffer.position(0);
  sc.write(msgBuffer);
  msgBuffer=ByteBuffer.wrap(new byte[8]);
  msgBuffer.putInt(4);
  msgBuffer.putInt(5);
  msgBuffer.position(0);
  sc.write(msgBuffer);
  Message m=cnxManager.pollRecvQueue(1000,TimeUnit.MILLISECONDS);
  Assert.assertNotNull(m);
  peer.shutdown();
  cnxManager.halt();
  Assert.assertFalse(cnxManager.listener.isAlive());
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests a bug in QuorumCnxManager that causes a spin lock
 * when a negative value is sent. This test checks if the
 * connection is being closed upon a message with negative
 * length.
 * @throws Exception
 */
@Test public void testCnxManagerSpinLock() throws Exception {
  QuorumPeer peer=new QuorumPeer(peers,peerTmpdir[1],peerTmpdir[1],peerClientPort[1],3,1,1000,2,2);
  QuorumCnxManager cnxManager=new QuorumCnxManager(peer);
  QuorumCnxManager.Listener listener=cnxManager.listener;
  if (listener != null) {
    listener.start();
  }
 else {
    LOG.error("Null listener when initializing cnx manager");
  }
  int port=peers.get(peer.getId()).electionAddr.getPort();
  LOG.info("Election port: " + port);
  Thread.sleep(1000);
  SocketChannel sc=SocketChannel.open();
  sc.socket().connect(peers.get(1L).electionAddr,5000);
  InetSocketAddress otherAddr=peers.get(new Long(2)).electionAddr;
  DataOutputStream dout=new DataOutputStream(sc.socket().getOutputStream());
  dout.writeLong(QuorumCnxManager.PROTOCOL_VERSION);
  dout.writeLong(new Long(2));
  String addr=otherAddr.getHostString() + ":" + otherAddr.getPort();
  byte[] addr_bytes=addr.getBytes();
  dout.writeInt(addr_bytes.length);
  dout.write(addr_bytes);
  dout.flush();
  ByteBuffer msgBuffer=ByteBuffer.wrap(new byte[4]);
  msgBuffer.putInt(-20);
  msgBuffer.position(0);
  sc.write(msgBuffer);
  Thread.sleep(1000);
  try {
    for (int i=0; i < 100; i++) {
      msgBuffer.position(0);
      sc.write(msgBuffer);
    }
    Assert.fail("Socket has not been closed");
  }
 catch (  Exception e) {
    LOG.info("Socket has been closed as expected");
  }
  peer.shutdown();
  cnxManager.halt();
  Assert.assertFalse(cnxManager.listener.isAlive());
}

</code></pre>

<br>
<pre class="type-10 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCnxManagerTimeout() throws Exception {
  Random rand=new Random();
  byte b=(byte)rand.nextInt();
  int deadPort=PortAssignment.unique();
  String deadAddress="10.1.1." + b;
  LOG.info("This is the dead address I'm trying: " + deadAddress);
  peers.put(Long.valueOf(2),new QuorumServer(2,new InetSocketAddress(deadAddress,deadPort),new InetSocketAddress(deadAddress,PortAssignment.unique()),new InetSocketAddress(deadAddress,PortAssignment.unique())));
  peerTmpdir[2]=ClientBase.createTmpDir();
  QuorumPeer peer=new QuorumPeer(peers,peerTmpdir[1],peerTmpdir[1],peerClientPort[1],3,1,1000,2,2);
  QuorumCnxManager cnxManager=new QuorumCnxManager(peer);
  QuorumCnxManager.Listener listener=cnxManager.listener;
  if (listener != null) {
    listener.start();
  }
 else {
    LOG.error("Null listener when initializing cnx manager");
  }
  long begin=Time.currentElapsedTime();
  cnxManager.toSend(2L,createMsg(ServerState.LOOKING.ordinal(),1,-1,1));
  long end=Time.currentElapsedTime();
  if ((end - begin) > 6000)   Assert.fail("Waited more than necessary");
  cnxManager.halt();
  Assert.assertFalse(cnxManager.listener.isAlive());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.CreateModeTest </h4><pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBasicCreateMode(){
  CreateMode cm=CreateMode.PERSISTENT;
  Assert.assertEquals(cm.toFlag(),0);
  Assert.assertFalse(cm.isEphemeral());
  Assert.assertFalse(cm.isSequential());
  Assert.assertFalse(cm.isContainer());
  cm=CreateMode.EPHEMERAL;
  Assert.assertEquals(cm.toFlag(),1);
  Assert.assertTrue(cm.isEphemeral());
  Assert.assertFalse(cm.isSequential());
  Assert.assertFalse(cm.isContainer());
  cm=CreateMode.PERSISTENT_SEQUENTIAL;
  Assert.assertEquals(cm.toFlag(),2);
  Assert.assertFalse(cm.isEphemeral());
  Assert.assertTrue(cm.isSequential());
  Assert.assertFalse(cm.isContainer());
  cm=CreateMode.EPHEMERAL_SEQUENTIAL;
  Assert.assertEquals(cm.toFlag(),3);
  Assert.assertTrue(cm.isEphemeral());
  Assert.assertTrue(cm.isSequential());
  Assert.assertFalse(cm.isContainer());
  cm=CreateMode.CONTAINER;
  Assert.assertEquals(cm.toFlag(),4);
  Assert.assertFalse(cm.isEphemeral());
  Assert.assertFalse(cm.isSequential());
  Assert.assertTrue(cm.isContainer());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.CreateTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testCreateWithStat() throws IOException, KeeperException, InterruptedException {
  String name="/foo";
  Stat stat=createWithStatVerifyResult("/foo");
  Stat childStat=createWithStatVerifyResult("/foo/child");
  Assert.assertFalse(stat.equals(childStat));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.FLEPredicateTest </h4><pre class="type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPredicate() throws IOException {
  peers=new HashMap<Long,QuorumServer>(3);
  for (int i=0; i < 3; i++) {
    peers.put(Long.valueOf(i),new QuorumServer(i,new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",PortAssignment.unique())));
  }
  try {
    File tmpDir=ClientBase.createTmpDir();
    QuorumPeer peer=new QuorumPeer(peers,tmpDir,tmpDir,PortAssignment.unique(),3,0,1000,2,2);
    MockFLE mock=new MockFLE(peer);
    mock.start();
    Assert.assertFalse(mock.predicate(4L,0L,0L,3L,0L,2L));
    Assert.assertTrue(mock.predicate(0L,0L,1L,1L,0L,0L));
    Assert.assertTrue(mock.predicate(0L,1L,0L,1L,0L,0L));
    Assert.assertTrue(mock.predicate(1L,1L,0L,0L,1L,0L));
  }
 catch (  IOException e) {
    LOG.error("Exception while creating quorum peer",e);
    Assert.fail("Exception while creating quorum peer");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.FLETest </h4><pre class="type-5 type-10 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testJoinInconsistentEnsemble() throws Exception {
  int sid;
  QuorumPeer peer;
  int waitTime=10 * 1000;
  ArrayList<QuorumPeer> peerList=new ArrayList<QuorumPeer>();
  for (sid=0; sid < 3; sid++) {
    peers.put(Long.valueOf(sid),new QuorumServer(sid,new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",PortAssignment.unique())));
    tmpdir[sid]=ClientBase.createTmpDir();
    port[sid]=PortAssignment.unique();
  }
  for (sid=0; sid < 2; sid++) {
    peer=new QuorumPeer(peers,tmpdir[sid],tmpdir[sid],port[sid],3,sid,2000,2,2);
    LOG.info("Starting peer " + peer.getId());
    peer.start();
    peerList.add(sid,peer);
  }
  peer=peerList.get(0);
  VerifyState v1=new VerifyState(peerList.get(0));
  v1.start();
  v1.join(waitTime);
  Assert.assertFalse("Unable to form cluster in " + waitTime + " ms",!v1.isSuccess());
  long leaderSid=peer.getCurrentVote().getId();
  long zxid=peer.getCurrentVote().getZxid();
  long electionEpoch=peer.getCurrentVote().getElectionEpoch();
  ServerState state=peer.getCurrentVote().getState();
  long peerEpoch=peer.getCurrentVote().getPeerEpoch();
  Vote newVote=new Vote(leaderSid,zxid + 100,electionEpoch + 100,peerEpoch,state);
  peer.setCurrentVote(newVote);
  peer=new QuorumPeer(peers,tmpdir[2],tmpdir[2],port[2],3,2,2000,2,2);
  LOG.info("Starting peer " + peer.getId());
  peer.start();
  peerList.add(sid,peer);
  v1=new VerifyState(peer);
  v1.start();
  v1.join(waitTime);
  if (v1.isAlive()) {
    Assert.fail("Peer " + peer.getId() + " failed to join the cluster "+ "within "+ waitTime+ " ms");
  }
  for (int id=0; id < 3; id++) {
    peer=peerList.get(id);
    if (peer != null) {
      peer.shutdown();
    }
  }
}

</code></pre>

<br>
<pre class="type-5 type-10 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testJoin() throws Exception {
  int sid;
  QuorumPeer peer;
  int waitTime=10 * 1000;
  ArrayList<QuorumPeer> peerList=new ArrayList<QuorumPeer>();
  for (sid=0; sid < 3; sid++) {
    port[sid]=PortAssignment.unique();
    peers.put(Long.valueOf(sid),new QuorumServer(sid,new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",port[sid])));
    tmpdir[sid]=ClientBase.createTmpDir();
  }
  for (sid=0; sid < 2; sid++) {
    peer=new QuorumPeer(peers,tmpdir[sid],tmpdir[sid],port[sid],3,sid,2000,2,2);
    LOG.info("Starting peer " + peer.getId());
    peer.start();
    peerList.add(sid,peer);
  }
  peer=peerList.get(0);
  VerifyState v1=new VerifyState(peerList.get(0));
  v1.start();
  v1.join(waitTime);
  Assert.assertFalse("Unable to form cluster in " + waitTime + " ms",!v1.isSuccess());
  peer=new QuorumPeer(peers,tmpdir[sid],tmpdir[sid],port[sid],3,sid,2000,2,2);
  LOG.info("Starting peer " + peer.getId());
  peer.start();
  peerList.add(sid,peer);
  v1=new VerifyState(peer);
  v1.start();
  v1.join(waitTime);
  if (v1.isAlive()) {
    Assert.fail("Peer " + peer.getId() + " failed to join the cluster "+ "within "+ waitTime+ " ms");
  }
 else   if (!v1.isSuccess()) {
    Assert.fail("Incorrect LEADING state for peer " + peer.getId());
  }
  for (int id=0; id < 3; id++) {
    peer=peerList.get(id);
    if (peer != null) {
      peer.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.FollowerResyncConcurrencyTest </h4><pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify that the server is sending the proper zxid. See ZOOKEEPER-1412.
 */
@Test public void testFollowerSendsLastZxid() throws Exception {
  QuorumUtil qu=new QuorumUtil(1);
  qu.startAll();
  int index=1;
  while (qu.getPeer(index).peer.follower == null) {
    index++;
  }
  LOG.info("Connecting to follower: {}",index);
  TestableZooKeeper zk=createTestableClient("localhost:" + qu.getPeer(index).peer.getClientPort());
  assertEquals(0L,zk.testableLastZxid());
  zk.exists("/",false);
  long lzxid=zk.testableLastZxid();
  assertTrue("lzxid:" + lzxid + " > 0",lzxid > 0);
  zk.close();
  qu.shutdownAll();
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * See ZOOKEEPER-1319 - verify that a lagging follwer resyncs correctly
 * 1) start with down quorum
 * 2) start leader/follower1, add some data
 * 3) restart leader/follower1
 * 4) start follower2
 * 5) verify data consistency across the ensemble
 * @throws Exception
 */
@Test public void testLaggingFollowerResyncsUnderNewEpoch() throws Exception {
  CountdownWatcher watcher1=new CountdownWatcher();
  CountdownWatcher watcher2=new CountdownWatcher();
  CountdownWatcher watcher3=new CountdownWatcher();
  QuorumUtil qu=new QuorumUtil(1);
  qu.shutdownAll();
  qu.start(1);
  qu.start(2);
  Assert.assertTrue("Waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + qu.getPeer(1).clientPort,ClientBase.CONNECTION_TIMEOUT));
  Assert.assertTrue("Waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + qu.getPeer(2).clientPort,ClientBase.CONNECTION_TIMEOUT));
  ZooKeeper zk1=createClient(qu.getPeer(1).peer.getClientPort(),watcher1);
  LOG.info("zk1 has session id 0x{}",Long.toHexString(zk1.getSessionId()));
  final String resyncPath="/resyncundernewepoch";
  zk1.create(resyncPath,null,ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk1.close();
  qu.shutdown(1);
  qu.shutdown(2);
  Assert.assertTrue("Waiting for server down",ClientBase.waitForServerDown("127.0.0.1:" + qu.getPeer(1).clientPort,ClientBase.CONNECTION_TIMEOUT));
  Assert.assertTrue("Waiting for server down",ClientBase.waitForServerDown("127.0.0.1:" + qu.getPeer(2).clientPort,ClientBase.CONNECTION_TIMEOUT));
  qu.start(1);
  qu.start(2);
  Assert.assertTrue("Waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + qu.getPeer(1).clientPort,ClientBase.CONNECTION_TIMEOUT));
  Assert.assertTrue("Waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + qu.getPeer(2).clientPort,ClientBase.CONNECTION_TIMEOUT));
  qu.start(3);
  Assert.assertTrue("Waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + qu.getPeer(3).clientPort,ClientBase.CONNECTION_TIMEOUT));
  zk1=createClient(qu.getPeer(1).peer.getClientPort(),watcher1);
  LOG.info("zk1 has session id 0x{}",Long.toHexString(zk1.getSessionId()));
  assertNotNull("zk1 has data",zk1.exists(resyncPath,false));
  final ZooKeeper zk2=createClient(qu.getPeer(2).peer.getClientPort(),watcher2);
  LOG.info("zk2 has session id 0x{}",Long.toHexString(zk2.getSessionId()));
  assertNotNull("zk2 has data",zk2.exists(resyncPath,false));
  final ZooKeeper zk3=createClient(qu.getPeer(3).peer.getClientPort(),watcher3);
  LOG.info("zk3 has session id 0x{}",Long.toHexString(zk3.getSessionId()));
  assertNotNull("zk3 has data",zk3.exists(resyncPath,false));
  zk1.close();
  zk2.close();
  zk3.close();
  qu.shutdownAll();
}

</code></pre>

<br>
<pre class="type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test:
 * Starts up 3 ZKs. The non-leader ZKs are writing to cluster
 * Shut down one of the non-leader ZKs.
 * Restart after sessions have expired but <500 txns have taken place (get a diff)
 * Shut down immediately after restarting, start running separate thread with other transactions
 * Restart to a diff while transactions are running in leader
 * Before fixes for ZOOKEEPER-962, restarting off of diff could get an inconsistent view of data missing transactions that
 * completed during diff syncing. Follower would also be considered "restarted" before all forwarded transactions
 * were completely processed, so restarting would cause a snap file with a too-high zxid to be written, and transactions
 * would be missed
 * This test should pretty reliably catch the failure of restarting the server before all diff messages have been processed,
 * however, due to the transient nature of the system it may not catch failures due to concurrent processing of transactions
 * during the leader's diff forwarding.
 * @throws IOException
 * @throws InterruptedException
 * @throws KeeperException
 * @throws Throwable
 */
@Test public void testResyncByDiffAfterFollowerCrashes() throws IOException, InterruptedException, KeeperException, Throwable {
  final Semaphore sem=new Semaphore(0);
  QuorumUtil qu=new QuorumUtil(1);
  qu.startAll();
  CountdownWatcher watcher1=new CountdownWatcher();
  CountdownWatcher watcher2=new CountdownWatcher();
  CountdownWatcher watcher3=new CountdownWatcher();
  int index=1;
  while (qu.getPeer(index).peer.leader == null) {
    index++;
  }
  Leader leader=qu.getPeer(index).peer.leader;
  assertNotNull(leader);
  index=(index == 1) ? 2 : 1;
  LOG.info("Connecting to follower: {}",index);
  final ZooKeeper zk1=createClient(qu.getPeer(index).peer.getClientPort(),watcher1);
  LOG.info("zk1 has session id 0x{}",Long.toHexString(zk1.getSessionId()));
  final ZooKeeper zk2=createClient(qu.getPeer(index).peer.getClientPort(),watcher2);
  LOG.info("zk2 has session id 0x{}",Long.toHexString(zk2.getSessionId()));
  final ZooKeeper zk3=createClient(qu.getPeer(3).peer.getClientPort(),watcher3);
  LOG.info("zk3 has session id 0x{}",Long.toHexString(zk3.getSessionId()));
  zk1.create("/first",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk2.create("/mybar",null,ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL_SEQUENTIAL);
  final AtomicBoolean runNow=new AtomicBoolean(false);
  Thread mytestfooThread=new Thread(new Runnable(){
    @Override public void run(){
      int inSyncCounter=0;
      while (inSyncCounter < 400) {
        if (runNow.get()) {
          zk3.create("/mytestfoo",null,ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL_SEQUENTIAL,new AsyncCallback.StringCallback(){
            @Override public void processResult(            int rc,            String path,            Object ctx,            String name){
              pending.decrementAndGet();
              counter.incrementAndGet();
              if (rc != 0) {
                errors.incrementAndGet();
                ;
              }
              if (counter.get() > 7300) {
                sem.release();
              }
            }
          }
,null);
          pending.incrementAndGet();
          try {
            Thread.sleep(10);
          }
 catch (          Exception e) {
          }
          inSyncCounter++;
        }
 else {
          Thread.yield();
        }
      }
    }
  }
);
  mytestfooThread.start();
  for (int i=0; i < 5000; i++) {
    zk2.create("/mybar",null,ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL_SEQUENTIAL,new AsyncCallback.StringCallback(){
      @Override public void processResult(      int rc,      String path,      Object ctx,      String name){
        pending.decrementAndGet();
        counter.incrementAndGet();
        if (rc != 0) {
          errors.incrementAndGet();
          ;
        }
        if (counter.get() > 7300) {
          sem.release();
        }
      }
    }
,null);
    pending.incrementAndGet();
    if (i == 1000) {
      qu.shutdown(index);
      Thread.sleep(1100);
      LOG.info("Shutting down s1");
    }
    if (i == 1100 || i == 1150 || i == 1200) {
      Thread.sleep(1000);
    }
    if (i == 1200) {
      qu.startThenShutdown(index);
      runNow.set(true);
      qu.restart(index);
      LOG.info("Setting up server: {}",index);
    }
    if (i >= 1000 && i % 2 == 0) {
      zk3.create("/newbaz",null,ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL_SEQUENTIAL,new AsyncCallback.StringCallback(){
        @Override public void processResult(        int rc,        String path,        Object ctx,        String name){
          pending.decrementAndGet();
          counter.incrementAndGet();
          if (rc != 0) {
            errors.incrementAndGet();
          }
          if (counter.get() > 7300) {
            sem.release();
          }
        }
      }
,null);
      pending.incrementAndGet();
    }
    if (i == 1050 || i == 1100 || i == 1150) {
      Thread.sleep(1000);
    }
  }
  if (!sem.tryAcquire(ClientBase.CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS)) {
    LOG.warn("Did not aquire semaphore fast enough");
  }
  mytestfooThread.join(ClientBase.CONNECTION_TIMEOUT);
  if (mytestfooThread.isAlive()) {
    LOG.error("mytestfooThread is still alive");
  }
  assertTrue(waitForPendingRequests(60));
  assertTrue(waitForSync(qu,index,10));
  verifyState(qu,index,leader);
  zk1.close();
  zk2.close();
  zk3.close();
  qu.shutdownAll();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.FourLetterWordsTest </h4><pre class="type-5 type-2 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSetTraceMask() throws Exception {
  String gtmkResp=sendRequest("gtmk");
  Assert.assertNotNull(gtmkResp);
  gtmkResp=gtmkResp.trim();
  Assert.assertFalse(gtmkResp.isEmpty());
  long formerMask=Long.valueOf(gtmkResp);
  try {
    verify(buildSetTraceMaskRequest(0),"0");
    verify("gtmk","0");
  }
  finally {
    sendRequest(buildSetTraceMaskRequest(formerMask));
  }
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testValidateConsOutput() throws Exception {
  ZooKeeper zk1=createClient();
  ZooKeeper zk2=createClient();
  String resp=sendRequest("cons");
  BufferedReader in=new BufferedReader(new StringReader(resp));
  String line;
  int count=0;
  while ((line=in.readLine()) != null && line.length() > 0) {
    count++;
    Assert.assertTrue(line,Pattern.matches("^ /.*:\\d+\\[\\d+\\]\\(queued=\\d+,recved=\\d+,sent=\\d+.*\\)$",line));
  }
  Assert.assertTrue(count >= 2);
  zk1.close();
  zk2.close();
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test(timeout=60000) public void testValidateSocketTimeout() throws Exception {
  String resp=sendRequest("isro",2000);
  Assert.assertTrue(resp.contains("rw"));
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testValidateStatOutput() throws Exception {
  ZooKeeper zk1=createClient();
  ZooKeeper zk2=createClient();
  String resp=sendRequest("stat");
  BufferedReader in=new BufferedReader(new StringReader(resp));
  String line;
  line=in.readLine();
  Assert.assertTrue(Pattern.matches("^.*\\s\\d+\\.\\d+\\.\\d+-.*$",line));
  Assert.assertTrue(Pattern.matches("^Clients:$",in.readLine()));
  int count=0;
  while ((line=in.readLine()).length() > 0) {
    count++;
    Assert.assertTrue(Pattern.matches("^ /.*:\\d+\\[\\d+\\]\\(queued=\\d+,recved=\\d+,sent=\\d+\\)$",line));
  }
  Assert.assertTrue(count >= 2);
  line=in.readLine();
  Assert.assertTrue(Pattern.matches("^Latency min/avg/max: \\d+/\\d+/\\d+$",line));
  line=in.readLine();
  Assert.assertTrue(Pattern.matches("^Received: \\d+$",line));
  line=in.readLine();
  Assert.assertTrue(Pattern.matches("^Sent: \\d+$",line));
  line=in.readLine();
  Assert.assertTrue(Pattern.matches("^Connections: \\d+$",line));
  line=in.readLine();
  Assert.assertTrue(Pattern.matches("^Outstanding: \\d+$",line));
  line=in.readLine();
  Assert.assertTrue(Pattern.matches("^Zxid: 0x[\\da-fA-F]+$",line));
  line=in.readLine();
  Assert.assertTrue(Pattern.matches("^Mode: .*$",line));
  line=in.readLine();
  Assert.assertTrue(Pattern.matches("^Node count: \\d+$",line));
  zk1.close();
  zk2.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.GetProposalFromTxnTest </h4><pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test loading proposal from txnlog
 * @throws Exceptionan exception might be thrown here
 */
@Test public void testGetProposalFromTxn() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(100);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
  Long[] zxids=new Long[MSG_COUNT];
  try {
    String data="data";
    byte[] bytes=data.getBytes();
    for (int i=0; i < MSG_COUNT; i++) {
      Stat stat=new Stat();
      zk.create("/invalidsnap-" + i,bytes,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
      zk.getData("/invalidsnap-" + i,null,stat);
      zxids[i]=stat.getCzxid();
    }
  }
  finally {
    zk.close();
  }
  f.shutdown();
  zks.shutdown();
  Assert.assertTrue("waiting for server to shutdown",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
  zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  zks.startdata();
  ZKDatabase db=zks.getZKDatabase();
  Iterator<Proposal> itr=db.getProposalsFromTxnLog(zxids[0],10000000);
  int createCount=0;
  ArrayList<Long> retrievedZxids=new ArrayList<Long>(MSG_COUNT);
  while (itr.hasNext()) {
    Proposal proposal=itr.next();
    TxnHeader hdr=new TxnHeader();
    Record rec=SerializeUtils.deserializeTxn(proposal.packet.getData(),hdr);
    if (hdr.getType() == OpCode.create) {
      retrievedZxids.add(hdr.getZxid());
      createCount++;
    }
  }
  Assert.assertTrue("Zxids missmatches",Arrays.equals(zxids,retrievedZxids.toArray(new Long[0])));
  Assert.assertTrue("create proposal count == " + MSG_COUNT,(createCount == MSG_COUNT));
  db.setSnapshotSizeFactor(0.33);
  long sizeLimit=db.calculateTxnLogSizeLimit();
  itr=db.getProposalsFromTxnLog(zxids[MSG_COUNT / 2],sizeLimit);
  Assert.assertFalse("Expect empty proposal",(itr.hasNext()));
  f.shutdown();
  zks.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.InvalidSnapshotTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * test the snapshot
 * @throws Exception an exception could be expected
 */
@Test public void testSnapshot() throws Exception {
  File snapDir=new File(testData,"invalidsnap");
  ZooKeeperServer zks=new ZooKeeperServer(snapDir,snapDir,3000);
  SyncRequestProcessor.setSnapCount(1000);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  LOG.info("starting up the zookeeper server .. waiting");
  Assert.assertTrue("waiting for server being up",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=new ZooKeeper(HOSTPORT,20000,this);
  try {
    Assert.assertTrue(zk.exists("/9/9/8",false) != null);
  }
  finally {
    zk.close();
  }
  f.shutdown();
  zks.shutdown();
  Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown(HOSTPORT,ClientBase.CONNECTION_TIMEOUT));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.KeeperStateTest </h4><pre class="type-10 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
"></span><br>
/** 
 * Validate that the deprecated constant still works. There were issues
 * found with switch statements - which need compile time constants.
 */
@Test @SuppressWarnings("deprecation") public void testDeprecatedCodeOkInSwitch(){
  int test=1;
switch (test) {
case Code.Ok:
    Assert.assertTrue(true);
  break;
}
}

</code></pre>

<br>
<pre class="type-10 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
"></span><br>
/** 
 * Verify the enum works (paranoid) 
 */
@Test public void testCodeOKInSwitch(){
  Code test=Code.OK;
switch (test) {
case OK:
    Assert.assertTrue(true);
  break;
}
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.LENonTerminateTest </h4><pre class="type-10 type-3 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This tests ZK-569.
 * With three peers A, B and C, the following could happen:
 * 1. Round 1, A,B and C all vote for themselves
 * 2. Round 2, C dies, A and B vote for C
 * 3. Because C has died, votes for it are ignored, but A and B never
 * reset their votes. Hence LE never terminates. ZK-569 fixes this by
 * resetting votes to themselves if the set of votes for live peers is null.
 */
@Test public void testNonTermination() throws Exception {
  LOG.info("TestNonTermination: " + getTestName() + ", "+ count);
  for (int i=0; i < count; i++) {
    int clientport=PortAssignment.unique();
    peers.put(Long.valueOf(i),new QuorumServer(i,new InetSocketAddress("127.0.0.1",clientport),new InetSocketAddress("127.0.0.1",PortAssignment.unique())));
    tmpdir[i]=ClientBase.createTmpDir();
    port[i]=clientport;
  }
  QuorumPeer peer1=new MockQuorumPeer(peers,tmpdir[0],tmpdir[0],port[0],0,0,2,2,2);
  peer1.startLeaderElection();
  LEThread thread1=new LEThread(peer1,0);
  QuorumPeer peer2=new MockQuorumPeer(peers,tmpdir[1],tmpdir[1],port[1],0,1,2,2,2);
  peer2.startLeaderElection();
  LEThread thread2=new LEThread(peer2,1);
  Thread thread3=new Thread(){
    public void run(){
      try {
        mockServer();
      }
 catch (      Exception e) {
        LOG.error("exception",e);
        Assert.fail("Exception when running mocked server " + e);
      }
    }
  }
;
  thread3.start();
  Assert.assertTrue("mockServer did not start in 5s",mockLatch.await(5000,TimeUnit.MILLISECONDS));
  thread1.start();
  thread2.start();
  thread1.join(15000);
  thread2.join(15000);
  thread3.join(15000);
  if (thread1.isAlive() || thread2.isAlive() || thread3.isAlive()) {
    Assert.fail("Threads didn't join");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.LeaderSessionTrackerTest </h4><pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * When local session is enabled, leader will allow persistent node
 * to be create for unknown session
 */
@Test public void testCreatePersistent() throws Exception {
  qu.enableLocalSession(true);
  qu.startAll();
  QuorumPeer leader=qu.getLeaderQuorumPeer();
  ZooKeeper zk=new ZooKeeper(qu.getConnectString(leader),CONNECTION_TIMEOUT,this);
  CreateRequest createRequest=new CreateRequest("/success",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT.toFlag());
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  BinaryOutputArchive boa=BinaryOutputArchive.getArchive(baos);
  createRequest.serialize(boa,"request");
  ByteBuffer bb=ByteBuffer.wrap(baos.toByteArray());
  long sid=qu.getFollowerQuorumPeers().get(0).getActiveServer().getServerId();
  long locallSession=(sid << 56) + 1;
  LOG.info("Local session Id: " + Long.toHexString(locallSession));
  Request request=new Request(null,locallSession,0,OpCode.create,bb,new ArrayList<Id>());
  leader.getActiveServer().submitRequest(request);
  zk.create("/ok",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Stat stat=zk.exists("/success",null);
  Assert.assertTrue("Request from local sesson failed",stat != null);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.LoadFromLogTest </h4><pre class="type-5 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test we can restore the snapshot that has data ahead of the zxid
 * of the snapshot file.
 */
@Test public void testRestore() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(10000);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=getConnectedZkClient();
  String lastPath=null;
  try {
    zk.create("/invalidsnap",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    for (int i=0; i < NUM_MESSAGES; i++) {
      lastPath=zk.create("/invalidsnap/test-",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    }
  }
  finally {
    zk.close();
  }
  String[] tokens=lastPath.split("-");
  String expectedPath="/invalidsnap/test-" + String.format("%010d",(new Integer(tokens[1])).intValue() + 1);
  long eZxid=zks.getZKDatabase().getDataTreeLastProcessedZxid();
  zks.getZKDatabase().setlastProcessedZxid(zks.getZKDatabase().getDataTreeLastProcessedZxid() - 10);
  LOG.info("Set lastProcessedZxid to " + zks.getZKDatabase().getDataTreeLastProcessedZxid());
  zks.takeSnapshot();
  zks.shutdown();
  f.shutdown();
  zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(10000);
  f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  connected=false;
  long fZxid=zks.getZKDatabase().getDataTreeLastProcessedZxid();
  Assert.assertTrue("Restore failed expected zxid=" + eZxid + " found="+ fZxid,fZxid == eZxid);
  zk=getConnectedZkClient();
  String[] children;
  String path;
  try {
    children=zk.getChildren("/invalidsnap",false).toArray(new String[0]);
    path=zk.create("/invalidsnap/test-",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
  }
  finally {
    zk.close();
  }
  LOG.info("Expected " + expectedPath + " found "+ path);
  Assert.assertTrue("Error in sequential znode creation expected " + expectedPath + " found "+ path,path.equals(expectedPath));
  Assert.assertTrue("Unexpected number of children " + children.length + " expected "+ NUM_MESSAGES,(children.length == NUM_MESSAGES));
  f.shutdown();
  zks.shutdown();
}

</code></pre>

<br>
<pre class="type-3 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify snap/log dir create with/without autocreate enabled.
 */
@Test public void testDatadirAutocreate() throws Exception {
  ClientBase.setupTestEnv();
  File tmpDir=ClientBase.createTmpDir();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  zks.shutdown();
  f.shutdown();
  Assert.assertTrue("waiting for server being down ",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
  try {
    System.setProperty(FileTxnSnapLog.ZOOKEEPER_DATADIR_AUTOCREATE,"false");
    tmpDir=ClientBase.createTmpDir();
    zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
    f=ServerCnxnFactory.createFactory(PORT,-1);
    f.startup(zks);
    Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
    Assert.fail("Server should not have started without datadir");
  }
 catch (  IOException e) {
    LOG.info("Server failed to start - correct behavior " + e);
  }
 finally {
    System.setProperty(FileTxnSnapLog.ZOOKEEPER_DATADIR_AUTOCREATE,FileTxnSnapLog.ZOOKEEPER_DATADIR_AUTOCREATE_DEFAULT);
  }
}

</code></pre>

<br>
<pre class="type-9 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * test that all transactions from the Log are loaded, and only once
 * @throws Exception an exception might be thrown here
 */
@Test public void testLoad() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(100);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
  try {
    for (int i=0; i < NUM_MESSAGES; i++) {
      zk.create("/invalidsnap-" + i,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    }
  }
  finally {
    zk.close();
  }
  f.shutdown();
  Assert.assertTrue("waiting for server to shutdown",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
  File logDir=new File(tmpDir,FileTxnSnapLog.version + FileTxnSnapLog.VERSION);
  FileTxnLog txnLog=new FileTxnLog(logDir);
  TxnIterator itr=txnLog.read(0);
  FileTxnIterator fileItr=(FileTxnIterator)itr;
  long storageSize=fileItr.getStorageSize();
  LOG.info("Txnlog size: " + storageSize + " bytes");
  Assert.assertTrue("Storage size is greater than zero ",(storageSize > 0));
  long expectedZxid=0;
  long lastZxid=0;
  TxnHeader hdr;
  do {
    hdr=itr.getHeader();
    expectedZxid++;
    Assert.assertTrue("not the same transaction. lastZxid=" + lastZxid + ", zxid="+ hdr.getZxid(),lastZxid != hdr.getZxid());
    Assert.assertTrue("excepting next transaction. expected=" + expectedZxid + ", retreived="+ hdr.getZxid(),(hdr.getZxid() == expectedZxid));
    lastZxid=hdr.getZxid();
  }
 while (itr.next());
  Assert.assertTrue("processed all transactions. " + expectedZxid + " == "+ TOTAL_TRANSACTIONS,(expectedZxid == TOTAL_TRANSACTIONS));
  zks.shutdown();
}

</code></pre>

<br>
<pre class="type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * test that we fail to load txnlog of a request zxid that is older
 * than what exist on disk
 * @throws Exception an exception might be thrown here
 */
@Test public void testLoadFailure() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(50);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
  try {
    for (int i=0; i < NUM_MESSAGES; i++) {
      zk.create("/data-",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    }
  }
  finally {
    zk.close();
  }
  f.shutdown();
  Assert.assertTrue("waiting for server to shutdown",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
  File logDir=new File(tmpDir,FileTxnSnapLog.version + FileTxnSnapLog.VERSION);
  File[] logFiles=FileTxnLog.getLogFiles(logDir.listFiles(),0);
  Assert.assertTrue(logFiles.length > 4);
  Assert.assertTrue("delete the first log file",logFiles[0].delete());
  long secondStartZxid=Util.getZxidFromName(logFiles[1].getName(),"log");
  FileTxnLog txnLog=new FileTxnLog(logDir);
  TxnIterator itr=txnLog.read(1,false);
  Assert.assertEquals(secondStartZxid,itr.getHeader().getZxid());
  itr=txnLog.read(secondStartZxid,false);
  Assert.assertEquals(secondStartZxid,itr.getHeader().getZxid());
  Assert.assertTrue(itr.next());
  long nextZxid=itr.getHeader().getZxid();
  itr=txnLog.read(nextZxid,false);
  Assert.assertEquals(secondStartZxid,itr.getHeader().getZxid());
  long thirdStartZxid=Util.getZxidFromName(logFiles[2].getName(),"log");
  itr=txnLog.read(thirdStartZxid,false);
  Assert.assertEquals(secondStartZxid,itr.getHeader().getZxid());
  Assert.assertTrue(itr.next());
  nextZxid=itr.getHeader().getZxid();
  itr=txnLog.read(nextZxid,false);
  Assert.assertEquals(secondStartZxid,itr.getHeader().getZxid());
}

</code></pre>

<br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Simulates ZOOKEEPER-1069 and verifies that flush() before padLogFile
 * fixes it.
 */
@Test public void testPad() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  FileTxnLog txnLog=new FileTxnLog(tmpDir);
  TxnHeader txnHeader=new TxnHeader(0xabcd,0x123,0x123,Time.currentElapsedTime(),OpCode.create);
  Record txn=new CreateTxn("/Test",new byte[0],null,false,1);
  txnLog.append(txnHeader,txn);
  FileInputStream in=new FileInputStream(tmpDir.getPath() + "/log." + Long.toHexString(txnHeader.getZxid()));
  BinaryInputArchive ia=BinaryInputArchive.getArchive(in);
  FileHeader header=new FileHeader();
  header.deserialize(ia,"fileheader");
  LOG.info("Received magic : " + header.getMagic() + " Expected : "+ FileTxnLog.TXNLOG_MAGIC);
  Assert.assertTrue("Missing magic number ",header.getMagic() == FileTxnLog.TXNLOG_MAGIC);
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Test we can restore a snapshot that has errors and data ahead of the zxid
 * of the snapshot file.
 */
@Test public void testRestoreWithTransactionErrors() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(10000);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=getConnectedZkClient();
  try {
    for (int i=0; i < NUM_MESSAGES; i++) {
      try {
        zk.create("/invaliddir/test-",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
      }
 catch (      NoNodeException e) {
      }
    }
  }
  finally {
    zk.close();
  }
  zks.getZKDatabase().setlastProcessedZxid(zks.getZKDatabase().getDataTreeLastProcessedZxid() - 10);
  LOG.info("Set lastProcessedZxid to " + zks.getZKDatabase().getDataTreeLastProcessedZxid());
  zks.takeSnapshot();
  zks.shutdown();
  f.shutdown();
  zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(10000);
  f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  f.shutdown();
  zks.shutdown();
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * ZOOKEEPER-1573: test restoring a snapshot with deleted txns ahead of the
 * snapshot file's zxid.
 */
@Test public void testReloadSnapshotWithMissingParent() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(10000);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=getConnectedZkClient();
  zk.create("/a","".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Stat stat=zk.exists("/a",false);
  long createZxId=stat.getMzxid();
  zk.create("/a/b","".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.delete("/a/b",-1);
  zk.delete("/a",-1);
  zks.getZKDatabase().setlastProcessedZxid(createZxId);
  LOG.info("Set lastProcessedZxid to {}",zks.getZKDatabase().getDataTreeLastProcessedZxid());
  zks.takeSnapshot();
  zks.shutdown();
  f.shutdown();
  zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(10000);
  f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  f.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.MultiAsyncTransactionTest </h4><pre class="type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * ZOOKEEPER-1624: PendingChanges of create sequential node request didn't
 * get rollbacked correctly when multi-op failed. This cause
 * create sequential node request in subsequent multi-op to failed because
 * sequential node name generation is incorrect.
 * The check is to make sure that each request in multi-op failed with
 * the correct reason.
 */
@Test public void testSequentialNodeCreateInAsyncMulti() throws Exception {
  final int iteration=4;
  final List<MultiResult> results=new ArrayList<MultiResult>();
  pendingOps.set(iteration);
  List<Op> ops=Arrays.asList(Op.create("/node-",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL),Op.create("/dup",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT));
  for (int i=0; i < iteration; ++i) {
    zk.multi(ops,new MultiCallback(){
      @Override public void processResult(      int rc,      String path,      Object ctx,      List<OpResult> opResults){
        MultiResult result=new MultiResult();
        result.results=opResults;
        result.rc=rc;
        results.add(result);
        finishPendingOps();
      }
    }
,null);
  }
  waitForPendingOps(CONNECTION_TIMEOUT);
  assertEquals(KeeperException.Code.OK.intValue(),results.get(0).rc);
  assertEquals(KeeperException.Code.NODEEXISTS.intValue(),results.get(1).rc);
  assertEquals(KeeperException.Code.NODEEXISTS.intValue(),results.get(2).rc);
  assertEquals(KeeperException.Code.NODEEXISTS.intValue(),results.get(3).rc);
  assertTrue(results.get(0).results.get(0) instanceof CreateResult);
  assertEquals(KeeperException.Code.OK.intValue(),((ErrorResult)results.get(1).results.get(0)).getErr());
  assertEquals(KeeperException.Code.OK.intValue(),((ErrorResult)results.get(2).results.get(0)).getErr());
  assertEquals(KeeperException.Code.OK.intValue(),((ErrorResult)results.get(3).results.get(0)).getErr());
  assertEquals(KeeperException.Code.NODEEXISTS.intValue(),((ErrorResult)results.get(1).results.get(1)).getErr());
  assertEquals(KeeperException.Code.NODEEXISTS.intValue(),((ErrorResult)results.get(2).results.get(1)).getErr());
  assertEquals(KeeperException.Code.NODEEXISTS.intValue(),((ErrorResult)results.get(3).results.get(1)).getErr());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.MultiTransactionTest </h4><pre class="type-10 type-3 type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetResults() throws Exception {
  Iterable<Op> ops=Arrays.asList(Op.create("/multi",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT),Op.delete("/multi",0),Op.setData("/multi","Y".getBytes(),0),Op.create("/foo",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT));
  List<OpResult> results=null;
  if (useAsync) {
    final MultiResult res=new MultiResult();
    zk.multi(ops,new MultiCallback(){
      @Override public void processResult(      int rc,      String path,      Object ctx,      List<OpResult> opResults){
synchronized (res) {
          res.rc=rc;
          res.results=opResults;
          res.finished=true;
          res.notifyAll();
        }
      }
    }
,null);
synchronized (res) {
      while (!res.finished) {
        res.wait();
      }
    }
    Assert.assertFalse("/multi should have been deleted so setData should have failed",KeeperException.Code.OK.intValue() == res.rc);
    Assert.assertNull(zk.exists("/multi",null));
    results=res.results;
  }
 else {
    try {
      zk.multi(ops);
      Assert.fail("/multi should have been deleted so setData should have failed");
    }
 catch (    KeeperException e) {
      Assert.assertNull(zk.exists("/multi",null));
      results=e.getResults();
    }
  }
  Assert.assertNotNull(results);
  for (  OpResult r : results) {
    LOG.info("RESULT==> {}",r);
    if (r instanceof ErrorResult) {
      ErrorResult er=(ErrorResult)r;
      LOG.info("ERROR RESULT: {} ERR=>{}",er,KeeperException.Code.get(er.getErr()));
    }
  }
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testWatchesTriggered() throws KeeperException, InterruptedException {
  HasTriggeredWatcher watcher=new HasTriggeredWatcher();
  zk.getChildren("/",watcher);
  multi(zk,Arrays.asList(Op.create("/t",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT),Op.delete("/t",-1)));
  assertTrue(watcher.triggered.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTransactionBuilder() throws Exception {
  List<OpResult> results=commit(zk.transaction().create("/t1",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT).create("/t1/child",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT).create("/t2",null,Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL));
  assertEquals(3,results.size());
  for (  OpResult r : results) {
    CreateResult c=(CreateResult)r;
    assertTrue(c.getPath().startsWith("/t"));
    assertNotNull(c.toString());
  }
  assertNotNull(zk.exists("/t1",false));
  assertNotNull(zk.exists("/t1/child",false));
  assertNotNull(zk.exists("/t2",false));
  results=commit(zk.transaction().check("/t1",0).check("/t1/child",0).check("/t2",0));
  assertEquals(3,results.size());
  for (  OpResult r : results) {
    CheckResult c=(CheckResult)r;
    assertNotNull(c.toString());
  }
  try {
    results=commit(zk.transaction().check("/t1",0).check("/t1/child",0).check("/t2",1));
    fail();
  }
 catch (  KeeperException.BadVersionException e) {
  }
  results=commit(zk.transaction().check("/t1",0).setData("/t1",new byte[0],0));
  assertEquals(2,results.size());
  for (  OpResult r : results) {
    assertNotNull(r.toString());
  }
  try {
    results=commit(zk.transaction().check("/t1",1).setData("/t1",new byte[0],2));
    fail();
  }
 catch (  KeeperException.BadVersionException e) {
  }
  results=commit(zk.transaction().check("/t1",1).check("/t1/child",0).check("/t2",0));
  assertEquals(3,results.size());
  results=commit(zk.transaction().delete("/t2",-1).delete("/t1/child",-1));
  assertEquals(2,results.size());
  for (  OpResult r : results) {
    DeleteResult d=(DeleteResult)r;
    assertNotNull(d.toString());
  }
  assertNotNull(zk.exists("/t1",false));
  assertNull(zk.exists("/t1/child",false));
  assertNull(zk.exists("/t2",false));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.NIOConnectionFactoryFdLeakTest </h4><pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testFileDescriptorLeak() throws Exception {
  OSMXBean osMbean=new OSMXBean();
  if (osMbean.getUnix() != true) {
    LOG.info("Unable to run test on non-unix system");
    return;
  }
  long startFdCount=osMbean.getOpenFileDescriptorCount();
  LOG.info("Start fdcount is: " + startFdCount);
  for (int i=0; i < 50; ++i) {
    NIOServerCnxnFactory factory=new NIOServerCnxnFactory();
    factory.configure(new InetSocketAddress("127.0.0.1",PortAssignment.unique()),10);
    factory.start();
    Thread.sleep(100);
    factory.shutdown();
  }
  long endFdCount=osMbean.getOpenFileDescriptorCount();
  LOG.info("End fdcount is: " + endFdCount);
  Assert.assertTrue("Possible fd leakage",((endFdCount - startFdCount) < 50));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.OOMTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testOOM() throws IOException, InterruptedException, KeeperException {
  if (true)   return;
  File tmpDir=ClientBase.createTmpDir();
  ArrayList<byte[]> hog=new ArrayList<byte[]>();
  while (true) {
    try {
      hog.add(new byte[1024 * 1024 * 2]);
    }
 catch (    OutOfMemoryError e) {
      hog.remove(0);
      break;
    }
  }
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  final int PORT=PortAssignment.unique();
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + PORT,CONNECTION_TIMEOUT));
  System.err.println("OOM Stage 0");
  utestPrep(PORT);
  System.out.println("Free = " + Runtime.getRuntime().freeMemory() + " total = "+ Runtime.getRuntime().totalMemory()+ " max = "+ Runtime.getRuntime().maxMemory());
  System.err.println("OOM Stage 1");
  for (int i=0; i < 1000; i++) {
    System.out.println(i);
    utestExists(PORT);
  }
  System.out.println("Free = " + Runtime.getRuntime().freeMemory() + " total = "+ Runtime.getRuntime().totalMemory()+ " max = "+ Runtime.getRuntime().maxMemory());
  System.err.println("OOM Stage 2");
  for (int i=0; i < 1000; i++) {
    System.out.println(i);
    utestGet(PORT);
  }
  System.out.println("Free = " + Runtime.getRuntime().freeMemory() + " total = "+ Runtime.getRuntime().totalMemory()+ " max = "+ Runtime.getRuntime().maxMemory());
  System.err.println("OOM Stage 3");
  for (int i=0; i < 1000; i++) {
    System.out.println(i);
    utestChildren(PORT);
  }
  System.out.println("Free = " + Runtime.getRuntime().freeMemory() + " total = "+ Runtime.getRuntime().totalMemory()+ " max = "+ Runtime.getRuntime().maxMemory());
  hog.get(0)[0]=(byte)1;
  f.shutdown();
  zks.shutdown();
  Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown("127.0.0.1:" + PORT,CONNECTION_TIMEOUT));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.OSMXBeanTest </h4><pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public final void testGetOpenFileDescriptorCount(){
  if (osMbean != null && osMbean.getUnix() == true) {
    ofdc=osMbean.getOpenFileDescriptorCount();
    LOG.info("open fdcount is: " + ofdc);
  }
  Assert.assertFalse("The number of open file descriptor is negative",(ofdc < 0));
}

</code></pre>

<br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public final void testGetMaxFileDescriptorCount(){
  if (osMbean != null && osMbean.getUnix() == true) {
    mfdc=osMbean.getMaxFileDescriptorCount();
    LOG.info("max fdcount is: " + mfdc);
  }
  Assert.assertFalse("The max file descriptor number is negative",(mfdc < 0));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ObserverLETest </h4><pre class="type-10 type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * See ZOOKEEPER-1294. Confirms that an observer will not support the quorum
 * of a leader by forming a 5-node, 2-observer ensemble (so quorum size is 2).
 * When all but the leader and one observer are shut down, the leader should
 * enter the 'looking' state, not stay in the 'leading' state.
 */
@Test public void testLEWithObserver() throws Exception {
  QuorumPeer leader=null;
  for (  QuorumPeer server : Arrays.asList(qb.s1,qb.s2,qb.s3)) {
    if (server.getServerState().equals(QuorumStats.Provider.FOLLOWING_STATE)) {
      server.shutdown();
      assertTrue("Waiting for server down",ClientBase.waitForServerDown("127.0.0.1:" + server.getClientPort(),ClientBase.CONNECTION_TIMEOUT));
    }
 else {
      assertNull("More than one leader found",leader);
      leader=server;
    }
  }
  assertTrue("Leader is not in Looking state",ClientBase.waitForServerState(leader,ClientBase.CONNECTION_TIMEOUT,QuorumStats.Provider.LOOKING_STATE));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ObserverTest </h4><pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * This test ensures that an Observer does not elect itself as a leader, or
 * indeed come up properly, if it is the lone member of an ensemble.
 * @throws Exception
 */
@Test public void testObserverOnly() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT_QP1=PortAssignment.unique();
  String quorumCfgSection="server.1=127.0.0.1:" + (PortAssignment.unique()) + ":"+ (PortAssignment.unique())+ ":observer;"+ CLIENT_PORT_QP1+ "\n";
  MainThread q1=new MainThread(1,CLIENT_PORT_QP1,quorumCfgSection);
  q1.start();
  q1.join(ClientBase.CONNECTION_TIMEOUT);
  Assert.assertFalse(q1.isAlive());
}

</code></pre>

<br>
<pre class="type-2 type-6 type-15 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test ensures two things:
 * 1. That Observers can successfully proxy requests to the ensemble.
 * 2. That Observers don't participate in leader elections.
 * The second is tested by constructing an ensemble where a leader would
 * be elected if and only if an Observer voted. 
 * @throws Exception
 */
@Test public void testObserver() throws Exception {
  ClientBase.setupTestEnv();
  latch=new CountDownLatch(2);
  final int PORT_QP1=PortAssignment.unique();
  final int PORT_QP2=PortAssignment.unique();
  final int PORT_OBS=PortAssignment.unique();
  final int PORT_QP_LE1=PortAssignment.unique();
  final int PORT_QP_LE2=PortAssignment.unique();
  final int PORT_OBS_LE=PortAssignment.unique();
  final int CLIENT_PORT_QP1=PortAssignment.unique();
  final int CLIENT_PORT_QP2=PortAssignment.unique();
  final int CLIENT_PORT_OBS=PortAssignment.unique();
  String quorumCfgSection="server.1=127.0.0.1:" + (PORT_QP1) + ":"+ (PORT_QP_LE1)+ ";"+ CLIENT_PORT_QP1+ "\nserver.2=127.0.0.1:"+ (PORT_QP2)+ ":"+ (PORT_QP_LE2)+ ";"+ CLIENT_PORT_QP2+ "\nserver.3=127.0.0.1:"+ (PORT_OBS)+ ":"+ (PORT_OBS_LE)+ ":observer"+ ";"+ CLIENT_PORT_OBS;
  MainThread q1=new MainThread(1,CLIENT_PORT_QP1,quorumCfgSection);
  MainThread q2=new MainThread(2,CLIENT_PORT_QP2,quorumCfgSection);
  MainThread q3=new MainThread(3,CLIENT_PORT_OBS,quorumCfgSection);
  q1.start();
  q2.start();
  q3.start();
  Assert.assertTrue("waiting for server 1 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP1,CONNECTION_TIMEOUT));
  Assert.assertTrue("waiting for server 2 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP2,CONNECTION_TIMEOUT));
  Assert.assertTrue("waiting for server 3 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_OBS,CONNECTION_TIMEOUT));
  zk=new ZooKeeper("127.0.0.1:" + CLIENT_PORT_OBS,ClientBase.CONNECTION_TIMEOUT,this);
  zk.create("/obstest","test".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertEquals(new String(zk.getData("/obstest",null,null)),"test");
  zk.sync("/",null,null);
  zk.setData("/obstest","test2".getBytes(),-1);
  zk.getChildren("/",false);
  Assert.assertEquals(zk.getState(),States.CONNECTED);
  LOG.info("Shutting down server 2");
  q2.shutdown();
  Assert.assertTrue("Waiting for server 2 to shut down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_QP2,ClientBase.CONNECTION_TIMEOUT));
  LOG.info("Server 2 down");
  latch.await();
  Assert.assertNotSame("Client is still connected to non-quorate cluster",KeeperState.SyncConnected,lastEvent.getState());
  LOG.info("Latch returned");
  try {
    Assert.assertFalse("Shouldn't get a response when cluster not quorate!",new String(zk.getData("/obstest",null,null)).equals("test"));
  }
 catch (  ConnectionLossException c) {
    LOG.info("Connection loss exception caught - ensemble not quorate (this is expected)");
  }
  latch=new CountDownLatch(1);
  LOG.info("Restarting server 2");
  q2=new MainThread(2,CLIENT_PORT_QP2,quorumCfgSection);
  q2.start();
  LOG.info("Waiting for server 2 to come up");
  Assert.assertTrue("waiting for server 2 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP2,CONNECTION_TIMEOUT));
  LOG.info("Server 2 started, waiting for latch");
  latch.await();
  Assert.assertTrue("Client didn't reconnect to quorate ensemble (state was" + lastEvent.getState() + ")",(KeeperState.SyncConnected == lastEvent.getState() || KeeperState.Expired == lastEvent.getState()));
  LOG.info("Shutting down all servers");
  q1.shutdown();
  q2.shutdown();
  q3.shutdown();
  LOG.info("Closing zk client");
  zk.close();
  Assert.assertTrue("Waiting for server 1 to shut down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_QP1,ClientBase.CONNECTION_TIMEOUT));
  Assert.assertTrue("Waiting for server 2 to shut down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_QP2,ClientBase.CONNECTION_TIMEOUT));
  Assert.assertTrue("Waiting for server 3 to shut down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_OBS,ClientBase.CONNECTION_TIMEOUT));
}

</code></pre>

<br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Ensure that observer only comes up when a proper ensemble is configured.
 * (and will not come up with standalone server).
 */
@Test public void testObserverWithStandlone() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT_QP1=PortAssignment.unique();
  String quorumCfgSection="server.1=127.0.0.1:" + (PortAssignment.unique()) + ":"+ (PortAssignment.unique())+ ":observer\n"+ "server.2=127.0.0.1:"+ (PortAssignment.unique())+ ":"+ (PortAssignment.unique())+ "\npeerType=observer\n";
  MainThread q1=new MainThread(1,CLIENT_PORT_QP1,quorumCfgSection);
  q1.start();
  q1.join(ClientBase.CONNECTION_TIMEOUT);
  Assert.assertFalse(q1.isAlive());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.QuorumQuotaTest </h4><pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testQuotaWithQuorum() throws Exception {
  ZooKeeper zk=createClient();
  zk.setData("/","some".getBytes(),-1);
  zk.create("/a","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  int i=0;
  for (i=0; i < 300; i++) {
    zk.create("/a/" + i,"some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  }
  ZooKeeperMain.createQuota(zk,"/a",1000L,5000);
  String statPath=Quotas.quotaZookeeper + "/a" + "/"+ Quotas.statNode;
  byte[] data=zk.getData(statPath,false,new Stat());
  StatsTrack st=new StatsTrack(new String(data));
  Assert.assertTrue("bytes are set",st.getBytes() == 1204L);
  Assert.assertTrue("num count is set",st.getCount() == 301);
  for (i=300; i < 600; i++) {
    zk.create("/a/" + i,"some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  }
  data=zk.getData(statPath,false,new Stat());
  st=new StatsTrack(new String(data));
  Assert.assertTrue("bytes are set",st.getBytes() == 2404L);
  Assert.assertTrue("num count is set",st.getCount() == 601);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.QuorumTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testViewContains(){
  Assert.assertTrue(qb.s1.viewContains(qb.s1.getId()));
  Assert.assertTrue(qb.s1.viewContains(qb.s2.getId()));
  Assert.assertFalse(qb.s1.viewContains(-1L));
}

</code></pre>

<br>
<pre class="type-3 type-2 type-1 type-17 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
- Is not executed with the test suite
"></span><br>
/** 
 * Connect to two different servers with two different handles using the same session and
 * make sure we cannot do any changes.
 */
@Test @Ignore public void testSessionMove() throws Exception {
  String hps[]=qb.hostPort.split(",");
  DiscoWatcher oldWatcher=new DiscoWatcher();
  DisconnectableZooKeeper zk=new DisconnectableZooKeeper(hps[0],ClientBase.CONNECTION_TIMEOUT,oldWatcher);
  zk.create("/t1",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  zk.dontReconnect();
  DiscoWatcher watcher=new DiscoWatcher();
  DisconnectableZooKeeper zknew=new DisconnectableZooKeeper(hps[1],ClientBase.CONNECTION_TIMEOUT,watcher,zk.getSessionId(),zk.getSessionPasswd());
  zknew.create("/t2",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  try {
    zk.create("/t3",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
    Assert.fail("Should have lost the connection");
  }
 catch (  KeeperException.ConnectionLossException e) {
    for (int i=0; i < 30; i++) {
      if (oldWatcher.zkDisco) {
        break;
      }
      Thread.sleep(1000);
    }
    Assert.assertTrue(oldWatcher.zkDisco);
  }
  ArrayList<ZooKeeper> toClose=new ArrayList<ZooKeeper>();
  toClose.add(zknew);
  for (int i=0; i < 10; i++) {
    zknew.dontReconnect();
    zknew=new DisconnectableZooKeeper(hps[1],ClientBase.CONNECTION_TIMEOUT,new DiscoWatcher(),zk.getSessionId(),zk.getSessionPasswd());
    toClose.add(zknew);
    zknew.create("/t-" + i,new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  }
  for (  ZooKeeper z : toClose) {
    z.close();
  }
  zk.close();
}

</code></pre>

<br>
<pre class="type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests if closeSession can be logged before a leader gets established, which
 * could lead to a locked-out follower (see ZOOKEEPER-790). 
 * The test works as follows. It has a client connecting to a follower f and
 * sending batches of 1,000 updates. The goal is that f has a zxid higher than
 * all other servers in the initial leader election. This way we can crash and
 * recover the follower so that the follower believes it is the leader once it
 * recovers (LE optimization: once a server receives a message from all other 
 * servers, it picks a leader.
 * It also makes the session timeout very short so that we force the false 
 * leader to close the session and write it to the log in the buggy code (before 
 * ZOOKEEPER-790). Once f drops leadership and finds the current leader, its epoch
 * is higher, and it rejects the leader. Now, if we prevent the leader from closing
 * the session by only starting up (see Leader.lead()) once it obtains a quorum of 
 * supporters, then f will find the current leader and support it because it won't
 * have a highe epoch.
 */
@Test public void testNoLogBeforeLeaderEstablishment() throws Exception {
  final Semaphore sem=new Semaphore(0);
  qu=new QuorumUtil(2,10);
  qu.startQuorum();
  int index=1;
  while (qu.getPeer(index).peer.leader == null)   index++;
  Leader leader=qu.getPeer(index).peer.leader;
  Assert.assertNotNull(leader);
  index=(index == 1) ? 2 : 1;
  ZooKeeper zk=new DisconnectableZooKeeper("127.0.0.1:" + qu.getPeer(index).peer.getClientPort(),ClientBase.CONNECTION_TIMEOUT,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  zk.create("/blah",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  for (int i=0; i < 50000; i++) {
    zk.setData("/blah",new byte[0],-1,new AsyncCallback.StatCallback(){
      public void processResult(      int rc,      String path,      Object ctx,      Stat stat){
        counter++;
        if (rc != 0) {
          errors++;
        }
        if (counter == 20000) {
          sem.release();
        }
      }
    }
,null);
    if (i == 5000) {
      qu.shutdown(index);
      LOG.info("Shutting down s1");
    }
    if (i == 12000) {
      qu.start(index);
      LOG.info("Setting up server: " + index);
    }
    if ((i % 1000) == 0) {
      Thread.sleep(500);
    }
  }
  sem.tryAcquire(15,TimeUnit.SECONDS);
  Assert.assertTrue("Not following",qu.getPeer(index).peer.follower != null);
  long epochF=(qu.getPeer(index).peer.getActiveServer().getZxid() >> 32L);
  long epochL=(leader.getEpoch() >> 32L);
  Assert.assertTrue("Zxid: " + qu.getPeer(index).peer.getActiveServer().getZxid() + "Current epoch: "+ epochF,epochF == epochL);
  zk.close();
}

</code></pre>

<br>
<pre class="type-2 type-8 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLeaderShutdown() throws IOException, InterruptedException, KeeperException {
  ZooKeeper zk=new DisconnectableZooKeeper(qb.hostPort,ClientBase.CONNECTION_TIMEOUT,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  zk.create("/blah",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/blah/blah",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Leader leader=qb.s1.leader;
  if (leader == null)   leader=qb.s2.leader;
  if (leader == null)   leader=qb.s3.leader;
  if (leader == null)   leader=qb.s4.leader;
  if (leader == null)   leader=qb.s5.leader;
  Assert.assertNotNull(leader);
  for (int i=0; i < 5000; i++) {
    zk.setData("/blah/blah",new byte[0],-1,new AsyncCallback.StatCallback(){
      public void processResult(      int rc,      String path,      Object ctx,      Stat stat){
        counter++;
        if (rc != 0) {
          errors++;
        }
      }
    }
,null);
  }
  for (  LearnerHandler f : leader.getForwardingFollowers()) {
    f.getSocket().shutdownInput();
  }
  for (int i=0; i < 5000; i++) {
    zk.setData("/blah/blah",new byte[0],-1,new AsyncCallback.StatCallback(){
      public void processResult(      int rc,      String path,      Object ctx,      Stat stat){
        counter++;
        if (rc != 0) {
          errors++;
        }
      }
    }
,null);
  }
  Assert.assertTrue(qb.s1.isAlive());
  Assert.assertTrue(qb.s2.isAlive());
  Assert.assertTrue(qb.s3.isAlive());
  Assert.assertTrue(qb.s4.isAlive());
  Assert.assertTrue(qb.s5.isAlive());
  zk.close();
}

</code></pre>

<br>
<pre class="type-9 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Make sure that we can change sessions
 * from follower to leader.
 * @throws IOException
 * @throws InterruptedException
 * @throws KeeperException
 */
@Test public void testSessionMoved() throws Exception {
  String hostPorts[]=qb.hostPort.split(",");
  DisconnectableZooKeeper zk=new DisconnectableZooKeeper(hostPorts[0],ClientBase.CONNECTION_TIMEOUT,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  zk.create("/sessionMoveTest",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  for (int i=0; i < hostPorts.length * 2; i++) {
    zk.dontReconnect();
    DisconnectableZooKeeper zknew=new DisconnectableZooKeeper(hostPorts[(i + 1) % hostPorts.length],ClientBase.CONNECTION_TIMEOUT,new Watcher(){
      public void process(      WatchedEvent event){
      }
    }
,zk.getSessionId(),zk.getSessionPasswd());
    zknew.setData("/",new byte[1],-1);
    final int result[]=new int[1];
    result[0]=Integer.MAX_VALUE;
    zknew.sync("/",new AsyncCallback.VoidCallback(){
      public void processResult(      int rc,      String path,      Object ctx){
synchronized (result) {
          result[0]=rc;
          result.notify();
        }
      }
    }
,null);
synchronized (result) {
      if (result[0] == Integer.MAX_VALUE) {
        result.wait(5000);
      }
    }
    LOG.info(hostPorts[(i + 1) % hostPorts.length] + " Sync returned " + result[0]);
    Assert.assertTrue(result[0] == KeeperException.Code.OK.intValue());
    try {
      zk.setData("/",new byte[1],-1);
      Assert.fail("Should have lost the connection");
    }
 catch (    KeeperException.ConnectionLossException e) {
    }
    zk=zknew;
  }
  zk.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.QuorumUtilTest </h4><pre class="type-10 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * <p>
 * This test ensures that all JXM beans associated to a {@link QuorumPeer}are unregistered when shuted down ({@link QuorumUtil#shutdown(int)}). It
 * allows a successfull restarting of several zookeeper servers ({@link QuorumPeer}) running on the same JVM.
 * <p>
 * See ZOOKEEPER-1214 for details.
 */
@Test public void validateAllMXBeanAreUnregistered() throws IOException {
  QuorumUtil qU=new QuorumUtil(1);
  LOG.info(">-->> Starting up all servers...");
  qU.startAll();
  LOG.info(">-->> Servers up and running...");
  int leaderIndex=qU.getLeaderServer();
  int firstFollowerIndex=0;
  int secondFollowerIndex=0;
switch (leaderIndex) {
case 1:
    firstFollowerIndex=2;
  secondFollowerIndex=3;
break;
case 2:
firstFollowerIndex=1;
secondFollowerIndex=3;
break;
case 3:
firstFollowerIndex=1;
secondFollowerIndex=2;
break;
default :
Assert.fail("Unexpected leaderIndex value: " + leaderIndex);
break;
}
LOG.info(">-->> Shuting down server [{}]",firstFollowerIndex);
qU.shutdown(firstFollowerIndex);
LOG.info(">-->> Shuting down server [{}]",secondFollowerIndex);
qU.shutdown(secondFollowerIndex);
LOG.info(">-->> Restarting server [{}]",firstFollowerIndex);
qU.restart(firstFollowerIndex);
LOG.info(">-->> Restarting server [{}]",secondFollowerIndex);
qU.restart(secondFollowerIndex);
qU.shutdownAll();
Set<ZKMBeanInfo> pending=MBeanRegistry.getInstance().getRegisteredBeans();
Assert.assertTrue("The following beans should have been unregistered: " + pending,pending.isEmpty());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.QuorumZxidSyncTest </h4><pre class="type-2 type-6 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies values related to public fields.
"></span><br>
/** 
 * find out what happens when a follower connects to leader that is behind
 */
@Test public void testBehindLeader() throws Exception {
  ClientBase.waitForServerUp(qb.hostPort,10000);
  ClientBase.waitForServerUp(qb.hostPort,10000);
  ZooKeeper zk=new ZooKeeper(qb.hostPort,10000,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  zk.create("/0",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.close();
  qb.shutdownServers();
  qb.startServers();
  ClientBase.waitForServerUp(qb.hostPort,10000);
  qb.shutdownServers();
  qb.startServers();
  ClientBase.waitForServerUp(qb.hostPort,10000);
  zk=new ZooKeeper(qb.hostPort,10000,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  zk.create("/1",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.close();
  qb.shutdownServers();
  qb.startServers();
  ClientBase.waitForServerUp(qb.hostPort,10000);
  qb.shutdownServers();
  qb.startServers();
  ClientBase.waitForServerUp(qb.hostPort,10000);
  zk=new ZooKeeper(qb.hostPort,10000,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  zk.create("/2",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.close();
  qb.shutdownServers();
  deleteFiles(qb.s1dir);
  deleteFiles(qb.s2dir);
  deleteFiles(qb.s3dir);
  deleteFiles(qb.s4dir);
  qb.setupServers();
  qb.s1.start();
  qb.s2.start();
  qb.s3.start();
  qb.s4.start();
  Assert.assertTrue("Servers didn't come up",ClientBase.waitForServerUp(qb.hostPort,10000));
  qb.s5.start();
  String hostPort="127.0.0.1:" + qb.s5.getClientPort();
  Assert.assertFalse("Servers came up, but shouldn't have since it's ahead of leader",ClientBase.waitForServerUp(hostPort,10000));
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * find out what happens when the latest state is in the snapshots not
 * the logs.
 */
@Test public void testLateLogs() throws Exception {
  ClientBase.waitForServerUp(qb.hostPort,10000);
  ClientBase.waitForServerUp(qb.hostPort,10000);
  ZooKeeper zk=new ZooKeeper(qb.hostPort,10000,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  zk.create("/0",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.close();
  qb.shutdownServers();
  qb.startServers();
  ClientBase.waitForServerUp(qb.hostPort,10000);
  qb.shutdownServers();
  qb.startServers();
  ClientBase.waitForServerUp(qb.hostPort,10000);
  zk=new ZooKeeper(qb.hostPort,10000,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  zk.create("/1",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.close();
  qb.shutdownServers();
  qb.startServers();
  ClientBase.waitForServerUp(qb.hostPort,10000);
  qb.shutdownServers();
  deleteLogs(qb.s1dir);
  deleteLogs(qb.s2dir);
  deleteLogs(qb.s3dir);
  deleteLogs(qb.s4dir);
  deleteLogs(qb.s5dir);
  qb.startServers();
  ClientBase.waitForServerUp(qb.hostPort,10000);
  zk=new ZooKeeper(qb.hostPort,10000,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  zk.create("/2",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.close();
  qb.shutdownServers();
  qb.startServers();
  ClientBase.waitForServerUp(qb.hostPort,10000);
  zk=new ZooKeeper(qb.hostPort,10000,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  boolean saw2=false;
  for (  String child : zk.getChildren("/",false)) {
    if (child.equals("2")) {
      saw2=true;
    }
  }
  zk.close();
  Assert.assertTrue("Didn't see /2 (went back in time)",saw2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ReadOnlyModeTest </h4><pre class="type-2 type-6 type-15 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests a situation when client firstly connects to a read-only server and
 * then connects to a majority server. Transition should be transparent for
 * the user.
 */
@Test(timeout=90000) public void testSessionEstablishment() throws Exception {
  qu.shutdown(2);
  CountdownWatcher watcher=new CountdownWatcher();
  ZooKeeper zk=new ZooKeeper(qu.getConnString(),CONNECTION_TIMEOUT,watcher,true);
  watcher.waitForConnected(CONNECTION_TIMEOUT);
  Assert.assertSame("should be in r/o mode",States.CONNECTEDREADONLY,zk.getState());
  long fakeId=zk.getSessionId();
  watcher.reset();
  qu.start(2);
  Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + qu.getPeer(2).clientPort,CONNECTION_TIMEOUT));
  watcher.waitForConnected(CONNECTION_TIMEOUT);
  zk.create("/test","test".getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertFalse("fake session and real session have same id",zk.getSessionId() == fakeId);
  zk.close();
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Ensures that client seeks for r/w servers while it's connected to r/o
 * server.
 */
@SuppressWarnings("deprecation") @Test(timeout=90000) public void testSeekForRwServer() throws Exception {
  Layout layout=Logger.getRootLogger().getAppender("CONSOLE").getLayout();
  ByteArrayOutputStream os=new ByteArrayOutputStream();
  WriterAppender appender=new WriterAppender(layout,os);
  appender.setImmediateFlush(true);
  appender.setThreshold(Level.INFO);
  Logger zlogger=Logger.getLogger("org.apache.zookeeper");
  zlogger.addAppender(appender);
  try {
    qu.shutdown(2);
    CountdownWatcher watcher=new CountdownWatcher();
    ZooKeeper zk=new ZooKeeper(qu.getConnString(),CONNECTION_TIMEOUT,watcher,true);
    watcher.waitForConnected(CONNECTION_TIMEOUT);
    qu.getPeer(1).peer.suspend();
    watcher.reset();
    qu.start(2);
    qu.start(3);
    ClientBase.waitForServerUp(qu.getConnString(),2000);
    watcher.waitForConnected(CONNECTION_TIMEOUT);
    zk.create("/test","test".getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    qu.getPeer(1).peer.resume();
  }
  finally {
    zlogger.removeAppender(appender);
  }
  os.close();
  LineNumberReader r=new LineNumberReader(new StringReader(os.toString()));
  String line;
  Pattern p=Pattern.compile(".*Majority server found.*");
  boolean found=false;
  while ((line=r.readLine()) != null) {
    if (p.matcher(line).matches()) {
      found=true;
      break;
    }
  }
  Assert.assertTrue("Majority server wasn't found while connected to r/o server",found);
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Basic test of read-only client functionality. Tries to read and write
 * during read-only mode, then regains a quorum and tries to write again.
 */
@Test(timeout=90000) public void testReadOnlyClient() throws Exception {
  CountdownWatcher watcher=new CountdownWatcher();
  ZooKeeper zk=new ZooKeeper(qu.getConnString(),CONNECTION_TIMEOUT,watcher,true);
  watcher.waitForConnected(CONNECTION_TIMEOUT);
  final String data="Data to be read in RO mode";
  final String node="/tnode";
  zk.create(node,data.getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  watcher.reset();
  qu.shutdown(2);
  zk.close();
  zk=new ZooKeeper(qu.getConnString(),CONNECTION_TIMEOUT,watcher,true);
  watcher.waitForConnected(CONNECTION_TIMEOUT);
  String remoteData=new String(zk.getData(node,false,null));
  Assert.assertEquals(data,remoteData);
  try {
    zk.setData(node,"no way".getBytes(),-1);
    Assert.fail("Write operation has succeeded during RO mode");
  }
 catch (  NotReadOnlyException e) {
  }
  watcher.reset();
  qu.start(2);
  Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + qu.getPeer(2).clientPort,CONNECTION_TIMEOUT));
  zk.close();
  watcher.reset();
  zk=new ZooKeeper(qu.getConnString(),CONNECTION_TIMEOUT,watcher,true);
  watcher.waitForConnected(CONNECTION_TIMEOUT);
  zk.setData(node,"We're in the quorum now".getBytes(),-1);
  zk.close();
}

</code></pre>

<br>
<pre class="type-9 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
"></span><br>
/** 
 * Ensures that upon connection to a read-only server client receives
 * ConnectedReadOnly state notification.
 */
@Test(timeout=90000) public void testConnectionEvents() throws Exception {
  final List<KeeperState> states=new ArrayList<KeeperState>();
  ZooKeeper zk=new ZooKeeper(qu.getConnString(),CONNECTION_TIMEOUT,new Watcher(){
    public void process(    WatchedEvent event){
      states.add(event.getState());
    }
  }
,true);
  boolean success=false;
  for (int i=0; i < 30; i++) {
    try {
      zk.create("/test","test".getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
      success=true;
      break;
    }
 catch (    KeeperException.ConnectionLossException e) {
      Thread.sleep(1000);
    }
  }
  Assert.assertTrue("Did not succeed in connecting in 30s",success);
  qu.shutdown(2);
  zk=new ZooKeeper(qu.getConnString(),CONNECTION_TIMEOUT,new Watcher(){
    public void process(    WatchedEvent event){
      states.add(event.getState());
    }
  }
,true);
  long start=Time.currentElapsedTime();
  while (!(zk.getState() == States.CONNECTEDREADONLY)) {
    Thread.sleep(200);
    Assert.assertTrue("Can't connect to the server",Time.currentElapsedTime() - start < 30000);
  }
  Assert.assertTrue("ConnectedReadOnly event wasn't received",states.get(2) == KeeperState.ConnectedReadOnly);
  zk.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ReconfigTest </h4><pre class="type-9 type-5 type-10 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testRoleChange() throws Exception {
  qu=new QuorumUtil(1);
  qu.disableJMXTest=true;
  qu.startAll();
  ZooKeeper[] zkArr=createHandles(qu);
  List<String> joiningServers=new ArrayList<String>();
  int leaderIndex=getLeaderId(qu);
  int changingIndex=(leaderIndex == 1) ? 2 : 1;
  String newRole="observer";
  for (int i=0; i < 4; i++) {
    ZooKeeper zk1=(changingIndex == leaderIndex) ? zkArr[leaderIndex] : zkArr[(leaderIndex % qu.ALL) + 1];
    joiningServers.add("server." + changingIndex + "=localhost:"+ qu.getPeer(changingIndex).peer.getQuorumAddress().getPort()+ ":"+ qu.getPeer(changingIndex).peer.getElectionAddress().getPort()+ ":"+ newRole+ ";localhost:"+ qu.getPeer(changingIndex).peer.getClientPort());
    reconfig(zk1,joiningServers,null,null,-1);
    testNormalOperation(zkArr[changingIndex],zk1);
    if (newRole.equals("observer")) {
      Assert.assertTrue(qu.getPeer(changingIndex).peer.observer != null && qu.getPeer(changingIndex).peer.follower == null && qu.getPeer(changingIndex).peer.leader == null);
      Assert.assertTrue(qu.getPeer(changingIndex).peer.getPeerState() == ServerState.OBSERVING);
    }
 else {
      Assert.assertTrue(qu.getPeer(changingIndex).peer.observer == null && (qu.getPeer(changingIndex).peer.follower != null || qu.getPeer(changingIndex).peer.leader != null));
      Assert.assertTrue(qu.getPeer(changingIndex).peer.getPeerState() == ServerState.FOLLOWING || qu.getPeer(changingIndex).peer.getPeerState() == ServerState.LEADING);
    }
    joiningServers.clear();
    if (newRole.equals("observer")) {
      newRole="participant";
    }
 else {
      newRole="observer";
      leaderIndex=getLeaderId(qu);
      changingIndex=leaderIndex;
    }
  }
  closeAllHandles(zkArr);
}

</code></pre>

<br>
<pre class="type-5 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * 1. removes and adds back two servers (incl leader). One of the servers is added back as observer
 * 2. tests that reconfig fails if quorum of new config is not up
 * 3. tests that a server that's not up during reconfig learns the new config when it comes up
 * @throws Exception
 */
@Test public void testRemoveAddTwo() throws Exception {
  qu=new QuorumUtil(2);
  qu.disableJMXTest=true;
  qu.startAll();
  ZooKeeper[] zkArr=createHandles(qu);
  List<String> leavingServers=new ArrayList<String>();
  List<String> joiningServers=new ArrayList<String>();
  int leaderIndex=getLeaderId(qu);
  int leavingIndex1=leaderIndex;
  int leavingIndex2=(leaderIndex == 1) ? 2 : 1;
  int stayingIndex1=1, stayingIndex2=1, stayingIndex3=1;
  while (stayingIndex1 == leavingIndex1 || stayingIndex1 == leavingIndex2)   stayingIndex1++;
  while (stayingIndex2 == leavingIndex1 || stayingIndex2 == leavingIndex2 || stayingIndex2 == stayingIndex1)   stayingIndex2++;
  while (stayingIndex3 == leavingIndex1 || stayingIndex3 == leavingIndex2 || stayingIndex3 == stayingIndex1 || stayingIndex3 == stayingIndex2)   stayingIndex3++;
  leavingServers.add(Integer.toString(leavingIndex1));
  leavingServers.add(Integer.toString(leavingIndex2));
  joiningServers.add("server." + leavingIndex1 + "=localhost:"+ qu.getPeer(leavingIndex1).peer.getQuorumAddress().getPort()+ ":"+ qu.getPeer(leavingIndex1).peer.getElectionAddress().getPort()+ ":participant;localhost:"+ qu.getPeer(leavingIndex1).peer.getClientPort());
  joiningServers.add("server." + leavingIndex2 + "=localhost:"+ qu.getPeer(leavingIndex2).peer.getQuorumAddress().getPort()+ ":"+ qu.getPeer(leavingIndex2).peer.getElectionAddress().getPort()+ ":observer;localhost:"+ qu.getPeer(leavingIndex2).peer.getClientPort());
  qu.shutdown(leavingIndex1);
  qu.shutdown(leavingIndex2);
  reconfig(zkArr[stayingIndex2],null,leavingServers,null,-1);
  qu.shutdown(stayingIndex2);
  testServerHasConfig(zkArr[stayingIndex1],null,leavingServers);
  testServerHasConfig(zkArr[stayingIndex3],null,leavingServers);
  testNormalOperation(zkArr[stayingIndex1],zkArr[stayingIndex3]);
  Thread.sleep(10000);
  try {
    reconfig(zkArr[stayingIndex1],joiningServers,null,null,-1);
    Assert.fail("reconfig completed successfully even though there is no quorum up in new config!");
  }
 catch (  KeeperException.NewConfigNoQuorum e) {
  }
  qu.restart(stayingIndex2);
  reconfig(zkArr[stayingIndex1],joiningServers,null,null,-1);
  testNormalOperation(zkArr[stayingIndex2],zkArr[stayingIndex3]);
  testServerHasConfig(zkArr[stayingIndex2],joiningServers,null);
  qu.restart(leavingIndex2);
  Assert.assertTrue(qu.getPeer(leavingIndex2).peer.getPeerState() == ServerState.OBSERVING);
  testNormalOperation(zkArr[stayingIndex2],zkArr[leavingIndex2]);
  testServerHasConfig(zkArr[leavingIndex2],joiningServers,null);
  closeAllHandles(zkArr);
}

</code></pre>

<br>
<pre class="type-9 type-5 type-3 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPortChange() throws Exception {
  qu=new QuorumUtil(1);
  qu.disableJMXTest=true;
  qu.startAll();
  ZooKeeper[] zkArr=createHandles(qu);
  List<String> joiningServers=new ArrayList<String>();
  int leaderIndex=getLeaderId(qu);
  int followerIndex=leaderIndex == 1 ? 2 : 1;
  int quorumPort=qu.getPeer(followerIndex).peer.getQuorumAddress().getPort();
  int electionPort=qu.getPeer(followerIndex).peer.getElectionAddress().getPort();
  int oldClientPort=qu.getPeer(followerIndex).peer.getClientPort();
  int newClientPort=PortAssignment.unique();
  joiningServers.add("server." + followerIndex + "=localhost:"+ quorumPort+ ":"+ electionPort+ ":participant;localhost:"+ newClientPort);
  testNormalOperation(zkArr[followerIndex],zkArr[leaderIndex]);
  reconfig(zkArr[followerIndex],joiningServers,null,null,-1);
  try {
    for (int i=0; i < 20; i++) {
      Thread.sleep(1000);
      zkArr[followerIndex].setData("/test","teststr".getBytes(),-1);
    }
  }
 catch (  KeeperException.ConnectionLossException e) {
    Assert.fail("Existing client disconnected when client port changed!");
  }
  zkArr[followerIndex].close();
  zkArr[followerIndex]=new ZooKeeper("127.0.0.1:" + oldClientPort,ClientBase.CONNECTION_TIMEOUT,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  for (int i=0; i < 10; i++) {
    try {
      Thread.sleep(1000);
      zkArr[followerIndex].setData("/test","teststr".getBytes(),-1);
      Assert.fail("New client connected to old client port!");
    }
 catch (    KeeperException.ConnectionLossException e) {
    }
  }
  zkArr[followerIndex].close();
  zkArr[followerIndex]=new ZooKeeper("127.0.0.1:" + newClientPort,ClientBase.CONNECTION_TIMEOUT,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  testNormalOperation(zkArr[followerIndex],zkArr[leaderIndex]);
  testServerHasConfig(zkArr[followerIndex],joiningServers,null);
  Assert.assertEquals(newClientPort,qu.getPeer(followerIndex).peer.getClientPort());
  joiningServers.clear();
  int newQuorumPort=PortAssignment.unique();
  joiningServers.add("server." + leaderIndex + "=localhost:"+ newQuorumPort+ ":"+ qu.getPeer(leaderIndex).peer.getElectionAddress().getPort()+ ":participant;localhost:"+ qu.getPeer(leaderIndex).peer.getClientPort());
  reconfig(zkArr[leaderIndex],joiningServers,null,null,-1);
  testNormalOperation(zkArr[followerIndex],zkArr[leaderIndex]);
  Assert.assertTrue(qu.getPeer(leaderIndex).peer.getQuorumAddress().getPort() == newQuorumPort);
  Assert.assertTrue(getLeaderId(qu) != leaderIndex);
  joiningServers.clear();
  for (int i=1; i <= 3; i++) {
    joiningServers.add("server." + i + "=localhost:"+ qu.getPeer(i).peer.getQuorumAddress().getPort()+ ":"+ PortAssignment.unique()+ ":participant;localhost:"+ qu.getPeer(i).peer.getClientPort());
  }
  reconfig(zkArr[1],joiningServers,null,null,-1);
  leaderIndex=getLeaderId(qu);
  int follower1=leaderIndex == 1 ? 2 : 1;
  int follower2=1;
  while (follower2 == leaderIndex || follower2 == follower1)   follower2++;
  qu.shutdown(getLeaderId(qu));
  testNormalOperation(zkArr[follower2],zkArr[follower1]);
  testServerHasConfig(zkArr[follower1],joiningServers,null);
  testServerHasConfig(zkArr[follower2],joiningServers,null);
  closeAllHandles(zkArr);
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testInitialConfigHasPositiveVersion() throws Exception {
  qu=new QuorumUtil(1);
  qu.disableJMXTest=true;
  qu.startAll();
  ZooKeeper[] zkArr=createHandles(qu);
  testNormalOperation(zkArr[1],zkArr[2]);
  for (int i=1; i < 4; i++) {
    String configStr=testServerHasConfig(zkArr[i],null,null);
    QuorumVerifier qv=qu.getPeer(i).peer.configFromString(configStr);
    long version=qv.getVersion();
    Assert.assertTrue(version == 0x100000000L);
  }
}

</code></pre>

<br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Tests verifies the jmx attributes of local and remote peer bean - change
 * participant to observer role
 */
@Test public void testJMXBeanAfterRoleChange() throws Exception {
  qu=new QuorumUtil(1);
  qu.disableJMXTest=true;
  qu.startAll();
  ZooKeeper[] zkArr=createHandles(qu);
  List<String> joiningServers=new ArrayList<String>();
  int changingIndex=1;
  int replica2=2;
  QuorumPeer peer2=qu.getPeer(replica2).peer;
  QuorumServer changingQS2=peer2.getView().get(new Long(changingIndex));
  String remotePeerBean2=CommonNames.DOMAIN + ":name0=ReplicatedServer_id" + replica2+ ",name1=replica."+ changingIndex;
  assertRemotePeerMXBeanAttributes(changingQS2,remotePeerBean2);
  int replica3=3;
  QuorumPeer peer3=qu.getPeer(replica3).peer;
  QuorumServer changingQS3=peer3.getView().get(new Long(changingIndex));
  String remotePeerBean3=CommonNames.DOMAIN + ":name0=ReplicatedServer_id" + replica3+ ",name1=replica."+ changingIndex;
  assertRemotePeerMXBeanAttributes(changingQS3,remotePeerBean3);
  String newRole="observer";
  ZooKeeper zk=zkArr[changingIndex];
  joiningServers.add("server." + changingIndex + "=127.0.0.1:"+ qu.getPeer(changingIndex).peer.getQuorumAddress().getPort()+ ":"+ qu.getPeer(changingIndex).peer.getElectionAddress().getPort()+ ":"+ newRole+ ";127.0.0.1:"+ qu.getPeer(changingIndex).peer.getClientPort());
  reconfig(zk,joiningServers,null,null,-1);
  testNormalOperation(zkArr[changingIndex],zk);
  Assert.assertTrue(qu.getPeer(changingIndex).peer.observer != null && qu.getPeer(changingIndex).peer.follower == null && qu.getPeer(changingIndex).peer.leader == null);
  Assert.assertTrue(qu.getPeer(changingIndex).peer.getPeerState() == ServerState.OBSERVING);
  QuorumPeer qp=qu.getPeer(changingIndex).peer;
  String localPeerBeanName=CommonNames.DOMAIN + ":name0=ReplicatedServer_id" + changingIndex+ ",name1=replica."+ changingIndex;
  assertLocalPeerMXBeanAttributes(qp,localPeerBeanName,true);
  changingQS2=peer2.getView().get(new Long(changingIndex));
  assertRemotePeerMXBeanAttributes(changingQS2,remotePeerBean2);
  changingQS3=peer3.getView().get(new Long(changingIndex));
  assertRemotePeerMXBeanAttributes(changingQS3,remotePeerBean3);
  closeAllHandles(zkArr);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.RecoveryTest </h4><pre class="type-9 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify that if a server goes down that clients will reconnect
 * automatically after the server is restarted. Note that this requires the
 * server to restart within the connection timeout period.
 * Also note that the client latches are used to eliminate any chance
 * of spurrious connectionloss exceptions on the read ops. Specifically
 * a sync operation will throw this exception if the server goes down
 * (as recognized by the client) during the operation. If the operation
 * occurs after the server is down, but before the client recognizes
 * that the server is down (ping) then the op will throw connectionloss.
 */
@Test public void testRecovery() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  int oldSnapCount=SyncRequestProcessor.getSnapCount();
  SyncRequestProcessor.setSnapCount(1000);
  try {
    final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
    ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
    f.startup(zks);
    LOG.info("starting up the the server, waiting");
    Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
    startSignal=new CountDownLatch(1);
    ZooKeeper zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
    startSignal.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS);
    Assert.assertTrue("count == 0",startSignal.getCount() == 0);
    String path;
    LOG.info("starting creating nodes");
    for (int i=0; i < 10; i++) {
      path="/" + i;
      zk.create(path,(path + "!").getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
      for (int j=0; j < 10; j++) {
        String subpath=path + "/" + j;
        zk.create(subpath,(subpath + "!").getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
        for (int k=0; k < 20; k++) {
          String subsubpath=subpath + "/" + k;
          zk.create(subsubpath,(subsubpath + "!").getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
        }
      }
    }
    f.shutdown();
    zks.shutdown();
    Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
    zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
    f=ServerCnxnFactory.createFactory(PORT,-1);
    startSignal=new CountDownLatch(1);
    f.startup(zks);
    Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
    startSignal.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS);
    Assert.assertTrue("count == 0",startSignal.getCount() == 0);
    Stat stat=new Stat();
    for (int i=0; i < 10; i++) {
      path="/" + i;
      LOG.info("Checking " + path);
      Assert.assertEquals(new String(zk.getData(path,false,stat)),path + "!");
      for (int j=0; j < 10; j++) {
        String subpath=path + "/" + j;
        Assert.assertEquals(new String(zk.getData(subpath,false,stat)),subpath + "!");
        for (int k=0; k < 20; k++) {
          String subsubpath=subpath + "/" + k;
          Assert.assertEquals(new String(zk.getData(subsubpath,false,stat)),subsubpath + "!");
        }
      }
    }
    f.shutdown();
    zks.shutdown();
    Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown(HOSTPORT,ClientBase.CONNECTION_TIMEOUT));
    zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
    f=ServerCnxnFactory.createFactory(PORT,-1);
    startSignal=new CountDownLatch(1);
    f.startup(zks);
    Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
    startSignal.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS);
    Assert.assertTrue("count == 0",startSignal.getCount() == 0);
    stat=new Stat();
    LOG.info("Check 2");
    for (int i=0; i < 10; i++) {
      path="/" + i;
      Assert.assertEquals(new String(zk.getData(path,false,stat)),path + "!");
      for (int j=0; j < 10; j++) {
        String subpath=path + "/" + j;
        Assert.assertEquals(new String(zk.getData(subpath,false,stat)),subpath + "!");
        for (int k=0; k < 20; k++) {
          String subsubpath=subpath + "/" + k;
          Assert.assertEquals(new String(zk.getData(subsubpath,false,stat)),subsubpath + "!");
        }
      }
    }
    zk.close();
    f.shutdown();
    zks.shutdown();
    Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
  }
  finally {
    SyncRequestProcessor.setSnapCount(oldSnapCount);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.RepeatStartupTest </h4><pre class="type-5 type-2 type-6 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies values related to public fields.
"></span><br>
/** 
 * bring up 5 quorum peers and then shut them down
 * and then bring one of the nodes as server
 * @throws Exception might be thrown here
 */
@Test public void testFail() throws Exception {
  QuorumBase qb=new QuorumBase();
  qb.setUp();
  System.out.println("Comment: the servers are at " + qb.hostPort);
  ZooKeeper zk=qb.createClient();
  zk.create("/test",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.close();
  QuorumBase.shutdown(qb.s1);
  QuorumBase.shutdown(qb.s2);
  QuorumBase.shutdown(qb.s3);
  QuorumBase.shutdown(qb.s4);
  QuorumBase.shutdown(qb.s5);
  String hp=qb.hostPort.split(",")[0];
  ZooKeeperServer zks=new ZooKeeperServer(qb.s1.getTxnFactory().getSnapDir(),qb.s1.getTxnFactory().getDataDir(),3000);
  final int PORT=Integer.parseInt(hp.split(":")[1]);
  ServerCnxnFactory factory=ServerCnxnFactory.createFactory(PORT,-1);
  factory.startup(zks);
  System.out.println("Comment: starting factory");
  Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + PORT,QuorumTest.CONNECTION_TIMEOUT));
  factory.shutdown();
  zks.shutdown();
  Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown("127.0.0.1:" + PORT,QuorumTest.CONNECTION_TIMEOUT));
  System.out.println("Comment: shutting down standalone");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.RestoreCommittedLogTest </h4><pre class="type-5 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * test the purge
 * @throws Exception an exception might be thrown here
 */
@Test public void testRestoreCommittedLog() throws Exception {
  File tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(100);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  ZooKeeper zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
  try {
    for (int i=0; i < 2000; i++) {
      zk.create("/invalidsnap-" + i,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    }
  }
  finally {
    zk.close();
  }
  f.shutdown();
  zks.shutdown();
  Assert.assertTrue("waiting for server to shutdown",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
  zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  zks.startdata();
  List<Proposal> committedLog=zks.getZKDatabase().getCommittedLog();
  int logsize=committedLog.size();
  LOG.info("committedLog size = {}",logsize);
  Assert.assertTrue("log size != 0",(logsize != 0));
  zks.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.SSLAuthTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testRejection() throws Exception {
  String testDataPath=System.getProperty("test.data.dir","build/test/data");
  System.setProperty(X509Util.SSL_KEYSTORE_LOCATION,testDataPath + "/ssl/testUntrustedKeyStore.jks");
  System.setProperty(X509Util.SSL_KEYSTORE_PASSWD,"testpass");
  CountdownWatcher watcher=new CountdownWatcher();
  new TestableZooKeeper(hostPort,CONNECTION_TIMEOUT,watcher);
  Assert.assertFalse("Untrusted certificate should not result in successful connection",watcher.clientConnected.await(1000,TimeUnit.MILLISECONDS));
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testMisconfiguration() throws Exception {
  System.clearProperty(X509Util.SSL_AUTHPROVIDER);
  System.clearProperty(X509Util.SSL_KEYSTORE_LOCATION);
  System.clearProperty(X509Util.SSL_KEYSTORE_PASSWD);
  System.clearProperty(X509Util.SSL_TRUSTSTORE_LOCATION);
  System.clearProperty(X509Util.SSL_TRUSTSTORE_PASSWD);
  CountdownWatcher watcher=new CountdownWatcher();
  new TestableZooKeeper(hostPort,CONNECTION_TIMEOUT,watcher);
  Assert.assertFalse("Missing SSL configuration should not result in successful connection",watcher.clientConnected.await(1000,TimeUnit.MILLISECONDS));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.SSLTest </h4><pre class="type-9 type-10 type-3 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test checks that SSL works in cluster setup of ZK servers, which includes:
 * 1. setting "secureClientPort" in "zoo.cfg" file.
 * 2. setting jvm flags for serverCnxn, keystore, truststore.
 * Finally, a zookeeper client should be able to connect to the secure port and
 * communicate with server via secure connection.
 * <p/>
 * Note that in this test a ZK server has two ports -- clientPort and secureClientPort.
 */
@Test public void testSecureQuorumServer() throws Exception {
  final int SERVER_COUNT=3;
  final int clientPorts[]=new int[SERVER_COUNT];
  final Integer secureClientPorts[]=new Integer[SERVER_COUNT];
  StringBuilder sb=new StringBuilder();
  for (int i=0; i < SERVER_COUNT; i++) {
    clientPorts[i]=PortAssignment.unique();
    secureClientPorts[i]=PortAssignment.unique();
    String server=String.format("server.%d=localhost:%d:%d:participant;localhost:%d",i,PortAssignment.unique(),PortAssignment.unique(),clientPorts[i]);
    sb.append(server + "\n");
  }
  String quorumCfg=sb.toString();
  MainThread[] mt=new MainThread[SERVER_COUNT];
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i]=new MainThread(i,quorumCfg,secureClientPorts[i],true);
    mt[i].start();
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[i],TIMEOUT));
    final CountDownLatch latch=new CountDownLatch(1);
    ZooKeeper zk=new ZooKeeper("127.0.0.1:" + secureClientPorts[i],TIMEOUT,new Watcher(){
      @Override public void process(      WatchedEvent event){
        if (event.getState() != Event.KeeperState.SyncConnected) {
          Assert.fail("failed to connect to ZK server secure client port");
        }
        latch.countDown();
      }
    }
);
    if (!latch.await(TIMEOUT,TimeUnit.MILLISECONDS)) {
      Assert.fail("Timeout connecting to ZK server secure port");
    }
    zk.create("/test","".getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    zk.delete("/test",-1);
    zk.close();
  }
  for (int i=0; i < mt.length; i++) {
    mt[i].shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.SaslAuthDesignatedClientTest </h4><pre class="type-3 type-2 type-6 type-15 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSaslConfig() throws Exception {
  ZooKeeper zk=createClient();
  try {
    zk.getChildren("/",false);
    Assert.assertFalse(zk.getSaslClient().clientTunneledAuthenticationInProgress());
    Assert.assertEquals(zk.getSaslClient().getSaslState(),ZooKeeperSaslClient.SaslState.COMPLETE);
    Assert.assertNotNull(javax.security.auth.login.Configuration.getConfiguration().getAppConfigurationEntry("MyZookeeperClient"));
    Assert.assertSame(zk.getSaslClient().getLoginContext(),"MyZookeeperClient");
  }
 catch (  KeeperException e) {
    Assert.fail("test failed :" + e);
  }
 finally {
    zk.close();
  }
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReadAccessUser() throws Exception {
  System.setProperty("zookeeper.letAnySaslUserDoX","anyone");
  ZooKeeper zk=createClient();
  List<ACL> aclList=new ArrayList<ACL>();
  ACL acl=new ACL(Perms.ADMIN | Perms.CREATE | Perms.WRITE| Perms.DELETE,new Id("sasl","fakeuser"));
  ACL acl1=new ACL(Perms.READ,new Id("sasl","anyone"));
  aclList.add(acl);
  aclList.add(acl1);
  try {
    zk.create("/abc","testData".getBytes(),aclList,CreateMode.PERSISTENT);
  }
 catch (  KeeperException e) {
    Assert.fail("Unable to create znode");
  }
  zk.close();
  Thread.sleep(100);
  zk=createClient();
  try {
    zk.setData("/abc","testData1".getBytes(),-1);
    Assert.fail("Should not be able to set data");
  }
 catch (  KeeperException.NoAuthException e) {
  }
  try {
    byte[] bytedata=zk.getData("/abc",null,null);
    String data=new String(bytedata);
    Assert.assertTrue("testData".equals(data));
  }
 catch (  KeeperException e) {
    Assert.fail("failed to get data");
  }
  zk.close();
  Thread.sleep(100);
  System.setProperty(ZooKeeperSaslClient.ENABLE_CLIENT_SASL_KEY,"false");
  try {
    zk=createClient();
    try {
      zk.getData("/abc",null,null);
      Assert.fail("Should not be able to read data when not authenticated");
    }
 catch (    KeeperException.NoAuthException e) {
    }
    zk.close();
  }
  finally {
    System.setProperty(ZooKeeperSaslClient.ENABLE_CLIENT_SASL_KEY,"true");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.SaslClientTest </h4><pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testSaslClientDisabled(){
  System.clearProperty(ZooKeeperSaslClient.ENABLE_CLIENT_SASL_KEY);
  Assert.assertTrue("SASL client disabled",ZooKeeperSaslClient.isEnabled());
  for (  String value : Arrays.asList("true","TRUE")) {
    System.setProperty(ZooKeeperSaslClient.ENABLE_CLIENT_SASL_KEY,value);
    Assert.assertTrue("SASL client disabled",ZooKeeperSaslClient.isEnabled());
  }
  for (  String value : Arrays.asList("false","FALSE")) {
    System.setProperty(ZooKeeperSaslClient.ENABLE_CLIENT_SASL_KEY,value);
    Assert.assertFalse("SASL client disabled",ZooKeeperSaslClient.isEnabled());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.SessionTest </h4><pre class="type-5 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Make sure ephemerals get cleaned up when a session times out.
 */
@SuppressWarnings("deprecation") @Test public void testSessionTimeout() throws Exception {
  final int TIMEOUT=5000;
  List<Thread> etBefore=findThreads("EventThread");
  List<Thread> stBefore=findThreads("SendThread");
  DisconnectableZooKeeper zk=createClient(TIMEOUT);
  zk.create("/stest",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  List<Thread> etAfter=findThreads("EventThread");
  List<Thread> stAfter=findThreads("SendThread");
  Thread eventThread=null;
  Thread sendThread=null;
  for (  Thread t : etAfter) {
    if (!etBefore.contains(t)) {
      eventThread=t;
      break;
    }
  }
  for (  Thread t : stAfter) {
    if (!stBefore.contains(t)) {
      sendThread=t;
      break;
    }
  }
  sendThread.suspend();
  Thread.sleep(TIMEOUT * 2);
  sendThread.resume();
  eventThread.join(TIMEOUT);
  Assert.assertFalse("EventThread is still running",eventThread.isAlive());
  zk=createClient(TIMEOUT);
  zk.create("/stest",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  tearDown();
  zk.close();
  zk.disconnect();
  setUp();
  zk=createClient(TIMEOUT);
  Assert.assertTrue(zk.exists("/stest",false) != null);
  Thread.sleep(TIMEOUT * 2);
  Assert.assertTrue(zk.exists("/stest",false) == null);
  zk.close();
}

</code></pre>

<br>
<pre class="type-9 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Make sure that we cannot have two connections with the same
 * session id.
 * @throws IOException
 * @throws InterruptedException
 * @throws KeeperException
 */
@Test public void testSessionMove() throws Exception {
  String hostPorts[]=HOSTPORT.split(",");
  DisconnectableZooKeeper zk=new DisconnectableZooKeeper(hostPorts[0],CONNECTION_TIMEOUT,new MyWatcher("0"));
  zk.create("/sessionMoveTest",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  for (int i=0; i < hostPorts.length * 2; i++) {
    zk.dontReconnect();
    DisconnectableZooKeeper zknew=new DisconnectableZooKeeper(hostPorts[(i + 1) % hostPorts.length],CONNECTION_TIMEOUT,new MyWatcher(Integer.toString(i + 1)),zk.getSessionId(),zk.getSessionPasswd());
    final int result[]=new int[1];
    result[0]=Integer.MAX_VALUE;
    zknew.sync("/",new AsyncCallback.VoidCallback(){
      public void processResult(      int rc,      String path,      Object ctx){
synchronized (result) {
          result[0]=rc;
          result.notify();
        }
      }
    }
,null);
synchronized (result) {
      if (result[0] == Integer.MAX_VALUE) {
        result.wait(5000);
      }
    }
    LOG.info(hostPorts[(i + 1) % hostPorts.length] + " Sync returned " + result[0]);
    Assert.assertTrue(result[0] == KeeperException.Code.OK.intValue());
    zknew.setData("/",new byte[1],-1);
    try {
      zk.setData("/",new byte[1],-1);
      Assert.fail("Should have lost the connection");
    }
 catch (    KeeperException.ConnectionLossException e) {
      LOG.info("Got connection loss exception as expected");
    }
    zk=zknew;
  }
  zk.close();
}

</code></pre>

<br>
<pre class="type-13 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Before public void setUp() throws Exception {
  if (tmpDir == null) {
    tmpDir=ClientBase.createTmpDir();
  }
  ClientBase.setupTestEnv();
  zs=new ZooKeeperServer(tmpDir,tmpDir,TICK_TIME);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  serverFactory=ServerCnxnFactory.createFactory(PORT,-1);
  serverFactory.startup(zs);
  Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
}

</code></pre>

<br>
<pre class="type-12 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@After public void tearDown() throws Exception {
  serverFactory.shutdown();
  zs.shutdown();
  Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.StandaloneTest </h4><pre class="type-3 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify that reconfiguration in standalone mode fails with
 * KeeperException.UnimplementedException.
 */
@Test public void testStandaloneReconfigFails() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT=PortAssignment.unique();
  final String HOSTPORT="127.0.0.1:" + CLIENT_PORT;
  File tmpDir=ClientBase.createTmpDir();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(CLIENT_PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  CountdownWatcher watcher=new CountdownWatcher();
  ZooKeeper zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,watcher);
  watcher.waitForConnected(CONNECTION_TIMEOUT);
  List<String> joiners=new ArrayList<String>();
  joiners.add("server.2=localhost:1234:1235;1236");
  try {
    zk.reconfig(joiners,null,null,-1,new Stat());
    Assert.fail("Reconfiguration in standalone should trigger " + "UnimplementedException");
  }
 catch (  KeeperException.UnimplementedException ex) {
  }
  zk.close();
  zks.shutdown();
  f.shutdown();
  Assert.assertTrue("waiting for server being down ",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.StaticHostProviderTest </h4><pre class="type-9 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpdateMigrationGoesRound() throws UnknownHostException {
  HostProvider hostProvider=getHostProvider((byte)4);
  Collection<InetSocketAddress> newList=new ArrayList<InetSocketAddress>(10);
  for (byte i=12; i > 2; i--) {
    newList.add(new InetSocketAddress(InetAddress.getByAddress(new byte[]{10,10,10,i}),1234 + i));
  }
  Collection<InetSocketAddress> oldStaying=new ArrayList<InetSocketAddress>(2);
  for (byte i=4; i > 2; i--) {
    oldStaying.add(new InetSocketAddress(InetAddress.getByAddress(new byte[]{10,10,10,i}),1234 + i));
  }
  Collection<InetSocketAddress> newComing=new ArrayList<InetSocketAddress>(10);
  for (byte i=12; i > 4; i--) {
    newComing.add(new InetSocketAddress(InetAddress.getByAddress(new byte[]{10,10,10,i}),1234 + i));
  }
  boolean disconnectRequired=hostProvider.updateServerList(newList,new InetSocketAddress(InetAddress.getByAddress(new byte[]{10,10,10,1}),1235));
  assertTrue(disconnectRequired);
  ArrayList<InetSocketAddress> seen=new ArrayList<InetSocketAddress>();
  for (int i=0; i < newComing.size(); i++) {
    InetSocketAddress addr=hostProvider.next(0);
    assertTrue(newComing.contains(addr));
    assertTrue(!seen.contains(addr));
    seen.add(addr);
  }
  seen.clear();
  for (int i=0; i < oldStaying.size(); i++) {
    InetSocketAddress addr=hostProvider.next(0);
    assertTrue(oldStaying.contains(addr));
    assertTrue(!seen.contains(addr));
    seen.add(addr);
  }
  InetSocketAddress first=hostProvider.next(0);
  assertTrue(first != null);
  for (int i=0; i < newList.size() - 1; i++) {
    hostProvider.next(0);
  }
  assertEquals(first,hostProvider.next(0));
  hostProvider.onConnected();
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testNextGoesRoundAndSleeps(){
  byte size=2;
  HostProvider hostProvider=getHostProvider(size);
  while (size > 0) {
    hostProvider.next(0);
    --size;
  }
  long start=Time.currentElapsedTime();
  hostProvider.next(1000);
  long stop=Time.currentElapsedTime();
  assertTrue(900 <= stop - start);
}

</code></pre>

<br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testNextDoesNotSleepForZero(){
  byte size=2;
  HostProvider hostProvider=getHostProvider(size);
  while (size > 0) {
    hostProvider.next(0);
    --size;
  }
  long start=Time.currentElapsedTime();
  hostProvider.next(0);
  long stop=Time.currentElapsedTime();
  assertTrue(5 > stop - start);
}

</code></pre>

<br>
<pre class="type-9 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
"></span><br>
@Test public void testReconfigDuringReconfigMode() throws UnknownHostException {
  boolean disconnectRequired;
  StaticHostProvider[] hostProviderArray=new StaticHostProvider[numClients];
  InetSocketAddress[] curHostForEachClient=new InetSocketAddress[numClients];
  int[] numClientsPerHost=new int[9];
  for (int i=0; i < numClients; i++) {
    hostProviderArray[i]=getHostProvider((byte)9);
    curHostForEachClient[i]=hostProviderArray[i].next(0);
  }
  Collection<InetSocketAddress> newList=getServerAddresses((byte)7);
  for (int i=0; i < numClients; i++) {
    hostProviderArray[i].updateServerList(newList,curHostForEachClient[i]);
  }
  newList=getServerAddresses((byte)9);
  for (int i=0; i < numClients; i++) {
    InetSocketAddress myServer=(i < (numClients / 2)) ? null : curHostForEachClient[i];
    disconnectRequired=hostProviderArray[i].updateServerList(newList,myServer);
    if (disconnectRequired)     curHostForEachClient[i]=hostProviderArray[i].next(0);
 else {
      curHostForEachClient[i]=hostProviderArray[i].getServerAtCurrentIndex();
    }
    numClientsPerHost[curHostForEachClient[i].getPort() - 1235]++;
    hostProviderArray[i].onConnected();
  }
  for (int i=0; i < 9; i++) {
    assertTrue(numClientsPerHost[i] <= upperboundCPS(numClients,9));
    assertTrue(numClientsPerHost[i] >= lowerboundCPS(numClients,9));
  }
}

</code></pre>

<br>
<pre class="type-9 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
"></span><br>
@Test public void testUpdateLoadBalancing() throws UnknownHostException {
  boolean disconnectRequired;
  HostProvider[] hostProviderArray=new HostProvider[numClients];
  InetSocketAddress[] curHostForEachClient=new InetSocketAddress[numClients];
  int[] numClientsPerHost=new int[9];
  for (int i=0; i < numClients; i++) {
    hostProviderArray[i]=getHostProvider((byte)9);
    curHostForEachClient[i]=hostProviderArray[i].next(0);
    numClientsPerHost[curHostForEachClient[i].getPort() - 1235]++;
    hostProviderArray[i].onConnected();
  }
  for (int i=0; i < 9; i++) {
    assertTrue(numClientsPerHost[i] <= upperboundCPS(numClients,9));
    assertTrue(numClientsPerHost[i] >= lowerboundCPS(numClients,9));
    numClientsPerHost[i]=0;
  }
  Collection<InetSocketAddress> newList=getServerAddresses((byte)8);
  for (int i=0; i < numClients; i++) {
    disconnectRequired=hostProviderArray[i].updateServerList(newList,curHostForEachClient[i]);
    if (disconnectRequired)     curHostForEachClient[i]=hostProviderArray[i].next(0);
    numClientsPerHost[curHostForEachClient[i].getPort() - 1235]++;
    hostProviderArray[i].onConnected();
  }
  for (int i=0; i < 8; i++) {
    assertTrue(numClientsPerHost[i] <= upperboundCPS(numClients,8));
    assertTrue(numClientsPerHost[i] >= lowerboundCPS(numClients,8));
    numClientsPerHost[i]=0;
  }
  assertTrue(numClientsPerHost[8] == 0);
  newList=getServerAddresses((byte)6);
  for (int i=0; i < numClients; i++) {
    disconnectRequired=hostProviderArray[i].updateServerList(newList,curHostForEachClient[i]);
    if (disconnectRequired)     curHostForEachClient[i]=hostProviderArray[i].next(0);
    numClientsPerHost[curHostForEachClient[i].getPort() - 1235]++;
    hostProviderArray[i].onConnected();
  }
  for (int i=0; i < 6; i++) {
    assertTrue(numClientsPerHost[i] <= upperboundCPS(numClients,6));
    assertTrue(numClientsPerHost[i] >= lowerboundCPS(numClients,6));
    numClientsPerHost[i]=0;
  }
  assertTrue(numClientsPerHost[6] == 0);
  assertTrue(numClientsPerHost[7] == 0);
  assertTrue(numClientsPerHost[8] == 0);
  newList=new ArrayList<InetSocketAddress>(8);
  for (byte i=9; i > 1; i--) {
    newList.add(new InetSocketAddress(InetAddress.getByAddress(new byte[]{10,10,10,i}),1234 + i));
  }
  for (int i=0; i < numClients; i++) {
    disconnectRequired=hostProviderArray[i].updateServerList(newList,curHostForEachClient[i]);
    if (disconnectRequired)     curHostForEachClient[i]=hostProviderArray[i].next(0);
    numClientsPerHost[curHostForEachClient[i].getPort() - 1235]++;
    hostProviderArray[i].onConnected();
  }
  assertTrue(numClientsPerHost[0] == 0);
  for (int i=1; i < 9; i++) {
    assertTrue(numClientsPerHost[i] <= upperboundCPS(numClients,8));
    assertTrue(numClientsPerHost[i] >= lowerboundCPS(numClients,8));
    numClientsPerHost[i]=0;
  }
  newList=getServerAddresses((byte)9);
  for (int i=0; i < numClients; i++) {
    disconnectRequired=hostProviderArray[i].updateServerList(newList,curHostForEachClient[i]);
    if (disconnectRequired)     curHostForEachClient[i]=hostProviderArray[i].next(0);
    numClientsPerHost[curHostForEachClient[i].getPort() - 1235]++;
    hostProviderArray[i].onConnected();
  }
  for (int i=0; i < 9; i++) {
    assertTrue(numClientsPerHost[i] <= upperboundCPS(numClients,9));
    assertTrue(numClientsPerHost[i] >= lowerboundCPS(numClients,9));
  }
}

</code></pre>

<br>
<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testUpdateClientMigrateOrNot() throws UnknownHostException {
  HostProvider hostProvider=getHostProvider((byte)4);
  Collection<InetSocketAddress> newList=getServerAddresses((byte)3);
  InetSocketAddress myServer=new InetSocketAddress(InetAddress.getByAddress(new byte[]{10,10,10,3}),1237);
  boolean disconnectRequired=hostProvider.updateServerList(newList,myServer);
  assertTrue(!disconnectRequired);
  hostProvider.onConnected();
  disconnectRequired=hostProvider.updateServerList(newList,myServer);
  assertTrue(!disconnectRequired);
  hostProvider.onConnected();
  newList=getServerAddresses((byte)2);
  disconnectRequired=hostProvider.updateServerList(newList,myServer);
  assertTrue(disconnectRequired);
  hostProvider.onConnected();
  disconnectRequired=hostProvider.updateServerList(newList,myServer);
  assertTrue(disconnectRequired);
  hostProvider.onConnected();
  newList=new ArrayList<InetSocketAddress>(3);
  for (byte i=4; i > 1; i--) {
    newList.add(new InetSocketAddress(InetAddress.getByAddress(new byte[]{10,10,10,i}),1234 + i));
  }
  myServer=new InetSocketAddress(InetAddress.getByAddress(new byte[]{10,10,10,1}),1235);
  disconnectRequired=hostProvider.updateServerList(newList,myServer);
  assertTrue(disconnectRequired);
  hostProvider.onConnected();
  HostProvider[] hostProviderArray=new HostProvider[numClients];
  newList=getServerAddresses((byte)10);
  int numDisconnects=0;
  for (int i=0; i < numClients; i++) {
    hostProviderArray[i]=getHostProvider((byte)9);
    disconnectRequired=hostProviderArray[i].updateServerList(newList,myServer);
    if (disconnectRequired)     numDisconnects++;
  }
  hostProvider.onConnected();
  assertTrue(numDisconnects < upperboundCPS(numClients,10));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNextGoesRound(){
  HostProvider hostProvider=getHostProvider((byte)2);
  InetSocketAddress first=hostProvider.next(0);
  assertTrue(first != null);
  hostProvider.next(0);
  assertEquals(first,hostProvider.next(0));
}

</code></pre>

<br>
<pre class="type-9 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
"></span><br>
@Test public void testNoCurrentHostDuringNormalMode() throws UnknownHostException {
  boolean disconnectRequired;
  StaticHostProvider[] hostProviderArray=new StaticHostProvider[numClients];
  InetSocketAddress[] curHostForEachClient=new InetSocketAddress[numClients];
  int[] numClientsPerHost=new int[9];
  for (int i=0; i < numClients; i++) {
    hostProviderArray[i]=getHostProvider((byte)9);
    if (i >= (numClients / 2)) {
      curHostForEachClient[i]=hostProviderArray[i].next(0);
    }
 else {
      curHostForEachClient[i]=null;
    }
  }
  Collection<InetSocketAddress> newList=getServerAddresses((byte)7);
  for (int i=0; i < numClients; i++) {
    disconnectRequired=hostProviderArray[i].updateServerList(newList,curHostForEachClient[i]);
    if (disconnectRequired)     curHostForEachClient[i]=hostProviderArray[i].next(0);
 else     if (curHostForEachClient[i] == null) {
      curHostForEachClient[i]=hostProviderArray[i].getServerAtIndex(0);
    }
    numClientsPerHost[curHostForEachClient[i].getPort() - 1235]++;
    hostProviderArray[i].onConnected();
  }
  for (int i=0; i < 7; i++) {
    assertTrue(numClientsPerHost[i] <= upperboundCPS(numClients,7));
    assertTrue(numClientsPerHost[i] >= lowerboundCPS(numClients,7));
    numClientsPerHost[i]=0;
  }
  assertTrue(numClientsPerHost[7] == 0);
  assertTrue(numClientsPerHost[8] == 0);
  newList=getServerAddresses((byte)8);
  for (int i=0; i < numClients; i++) {
    InetSocketAddress myServer=(i < (numClients / 2)) ? null : curHostForEachClient[i];
    disconnectRequired=hostProviderArray[i].updateServerList(newList,myServer);
    if (disconnectRequired)     curHostForEachClient[i]=hostProviderArray[i].next(0);
    numClientsPerHost[curHostForEachClient[i].getPort() - 1235]++;
    hostProviderArray[i].onConnected();
  }
  for (int i=0; i < 8; i++) {
    assertTrue(numClientsPerHost[i] <= upperboundCPS(numClients,8));
    assertTrue(numClientsPerHost[i] >= lowerboundCPS(numClients,8));
  }
}

</code></pre>

<br>
<pre class="type-9 type-5 type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testLiteralIPNoReverseNS() throws Exception {
  byte size=30;
  HostProvider hostProvider=getHostProviderUnresolved(size);
  for (int i=0; i < size; i++) {
    InetSocketAddress next=hostProvider.next(0);
    assertTrue(next instanceof InetSocketAddress);
    assertTrue(!next.isUnresolved());
    assertTrue(!next.toString().startsWith("/"));
    String hostname=next.getHostString();
    hostname.equals(next.getAddress().getHostAddress());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.TruncateTest </h4><pre class="type-9 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTruncationNullLog() throws Exception {
  File tmpdir=ClientBase.createTmpDir();
  FileTxnSnapLog snaplog=new FileTxnSnapLog(tmpdir,tmpdir);
  ZKDatabase zkdb=new ZKDatabase(snaplog);
  for (int i=1; i <= 100; i++) {
    append(zkdb,i);
  }
  zkdb.close();
  File[] logs=snaplog.getDataDir().listFiles();
  for (int i=0; i < logs.length; i++) {
    LOG.debug("Deleting: {}",logs[i].getName());
    Assert.assertTrue("Failed to delete log file: " + logs[i].getName(),logs[i].delete());
  }
  try {
    zkdb.truncateLog(1);
    Assert.assertTrue("Should not get here",false);
  }
 catch (  IOException e) {
    Assert.assertTrue("Should have received an IOException",true);
  }
catch (  NullPointerException npe) {
    Assert.fail("This should not throw NPE!");
  }
  ClientBase.recursiveDelete(tmpdir);
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTruncationStreamReset() throws Exception {
  File tmpdir=ClientBase.createTmpDir();
  FileTxnSnapLog snaplog=new FileTxnSnapLog(tmpdir,tmpdir);
  ZKDatabase zkdb=new ZKDatabase(snaplog);
  for (int i=1; i <= 100; i++) {
    append(zkdb,i);
  }
  zkdb.truncateLog(1);
  append(zkdb,200);
  zkdb.close();
  FileTxnLog txnlog=new FileTxnLog(new File(tmpdir,"version-2"));
  TxnIterator iter=txnlog.read(1);
  TxnHeader hdr=iter.getHeader();
  Record txn=iter.getTxn();
  Assert.assertEquals(1,hdr.getZxid());
  Assert.assertTrue(txn instanceof SetDataTxn);
  iter.next();
  hdr=iter.getHeader();
  txn=iter.getTxn();
  Assert.assertEquals(200,hdr.getZxid());
  Assert.assertTrue(txn instanceof SetDataTxn);
  iter.close();
  ClientBase.recursiveDelete(tmpdir);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.WatcherTest </h4><pre class="type-9 type-5 type-10 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test checks that watches for pending requests do not get triggered,
 * but watches set by previous requests do.
 * @throws Exception
 */
@Test public void testWatchAutoResetWithPending() throws Exception {
  MyWatcher watches[]=new MyWatcher[COUNT];
  MyStatCallback cbs[]=new MyStatCallback[COUNT];
  MyWatcher watcher=new MyWatcher();
  int count[]=new int[1];
  TestableZooKeeper zk=createClient(watcher,hostPort,6000);
  ZooKeeper zk2=createClient(watcher,hostPort,5000);
  zk2.create("/test",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  for (int i=0; i < COUNT / 2; i++) {
    watches[i]=new MyWatcher();
    cbs[i]=new MyStatCallback();
    zk.exists("/test",watches[i],cbs[i],count);
  }
  zk.exists("/test",false);
  Assert.assertTrue("Failed to pause the connection!",zk.pauseCnxn(3000));
  zk2.close();
  stopServer();
  watches[0].waitForDisconnected(60000);
  for (int i=COUNT / 2; i < COUNT; i++) {
    watches[i]=new MyWatcher();
    cbs[i]=new MyStatCallback();
    zk.exists("/test",watches[i],cbs[i],count);
  }
  startServer();
  watches[COUNT / 2 - 1].waitForConnected(60000);
  Assert.assertEquals(null,zk.exists("/test",false));
  Thread.sleep(10);
  for (int i=0; i < COUNT / 2; i++) {
    Assert.assertEquals("For " + i,1,watches[i].events.size());
  }
  for (int i=COUNT / 2; i < COUNT; i++) {
    if (cbs[i].rc == 0) {
      Assert.assertEquals("For " + i,1,watches[i].events.size());
    }
 else {
      Assert.assertEquals("For " + i,0,watches[i].events.size());
    }
  }
  Assert.assertEquals(COUNT,count[0]);
  zk.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ZkDatabaseCorruptionTest </h4><pre class="type-9 type-10 type-2 type-6 type-8 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCorruption() throws Exception {
  ClientBase.waitForServerUp(qb.hostPort,10000);
  ClientBase.waitForServerUp(qb.hostPort,10000);
  ZooKeeper zk=new ZooKeeper(qb.hostPort,10000,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  SyncRequestProcessor.setSnapCount(100);
  for (int i=0; i < 2000; i++) {
    zk.create("/0-" + i,new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT,new NoopStringCallback(),null);
  }
  zk.close();
  long leaderSid=1;
  QuorumPeer leader=null;
  for (  QuorumPeer quorumPeer : Arrays.asList(qb.s1,qb.s2,qb.s3,qb.s4,qb.s5)) {
    if (quorumPeer.getPeerState() == ServerState.LEADING) {
      leader=quorumPeer;
      break;
    }
    ++leaderSid;
  }
  Assert.assertNotNull("Cannot find the leader.",leader);
  leader.shutdown();
  FileTxnSnapLog snapLog=leader.getTxnFactory();
  File snapDir=snapLog.getSnapDir();
  corruptAllSnapshots(snapDir);
  qb.shutdownServers();
  qb.setupServers();
  if (leaderSid != 1)   qb.s1.start();
 else   leader=qb.s1;
  if (leaderSid != 2)   qb.s2.start();
 else   leader=qb.s2;
  if (leaderSid != 3)   qb.s3.start();
 else   leader=qb.s3;
  if (leaderSid != 4)   qb.s4.start();
 else   leader=qb.s4;
  if (leaderSid != 5)   qb.s5.start();
 else   leader=qb.s5;
  try {
    leader.start();
    Assert.assertTrue(false);
  }
 catch (  RuntimeException re) {
    LOG.info("Got an error: expected",re);
  }
  String[] list=qb.hostPort.split(",");
  for (int i=0; i < 5; i++) {
    if (leaderSid != (i + 1)) {
      String hp=list[i];
      Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp(hp,CONNECTION_TIMEOUT));
      LOG.info("{} is accepting client connections",hp);
    }
 else {
      LOG.info("Skipping the leader");
    }
  }
  zk=qb.createClient();
  SyncRequestProcessor.setSnapCount(100);
  for (int i=2000; i < 4000; i++) {
    zk.create("/0-" + i,new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT,new NoopStringCallback(),null);
  }
  zk.close();
  if (leaderSid != 1)   QuorumBase.shutdown(qb.s1);
  if (leaderSid != 2)   QuorumBase.shutdown(qb.s2);
  if (leaderSid != 3)   QuorumBase.shutdown(qb.s3);
  if (leaderSid != 4)   QuorumBase.shutdown(qb.s4);
  if (leaderSid != 5)   QuorumBase.shutdown(qb.s5);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ZooKeeperQuotaTest </h4><pre class="type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testQuota() throws IOException, InterruptedException, KeeperException, Exception {
  final ZooKeeper zk=createClient();
  final String path="/a/b/v";
  zk.setData("/","some".getBytes(),-1);
  zk.create("/a","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/b","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/b/v","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/a/b/v/d","some".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  ZooKeeperMain.createQuota(zk,path,5L,10);
  String absolutePath=Quotas.quotaZookeeper + path + "/"+ Quotas.limitNode;
  byte[] data=zk.getData(absolutePath,false,new Stat());
  StatsTrack st=new StatsTrack(new String(data));
  Assert.assertTrue("bytes are set",st.getBytes() == 5L);
  Assert.assertTrue("num count is set",st.getCount() == 10);
  String statPath=Quotas.quotaZookeeper + path + "/"+ Quotas.statNode;
  byte[] qdata=zk.getData(statPath,false,new Stat());
  StatsTrack qst=new StatsTrack(new String(qdata));
  Assert.assertTrue("bytes are set",qst.getBytes() == 8L);
  Assert.assertTrue("count is set",qst.getCount() == 2);
  stopServer();
  startServer();
  stopServer();
  startServer();
  ZooKeeperServer server=getServer(serverFactory);
  Assert.assertNotNull("Quota is still set",server.getZKDatabase().getDataTree().getMaxPrefixWithQuota(path) != null);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.system.SimpleSysTest </h4><pre class="type-9 type-10 type-3 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test checks the following:
 * 1) All clients connect successfully
 * 2) Half of the servers die (assuming odd number) and a write succeeds
 * 3) All servers are restarted and cluster stays alive
 * 4) Clients see a change by the server
 * 5) Clients' ephemeral nodes are cleaned up
 * @throws Exception
 */
@Test public void testSimpleCase() throws Exception {
  configureServers(serverCount);
  configureClients(clientCount,SimpleClient.class,getHostPort());
  Stat stat=new Stat();
  startServers();
  LOG.debug("Connecting to " + getHostPort());
  ZooKeeper zk=new ZooKeeper(getHostPort(),15000,this);
  waitForConnect(zk,10000);
  zk.create("/simpleCase","orig".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  startClients();
  for (int i=0; i < getClientCount(); i++) {
    for (int j=0; j < maxTries; j++) {
      try {
        byte b[]=zk.getData("/simpleCase/" + i,false,stat);
        Assert.assertEquals("orig",new String(b));
      }
 catch (      NoNodeException e) {
        if (j + 1 == maxTries) {
          Assert.fail("Max tries exceeded on client " + i);
        }
        Thread.sleep(1000);
      }
    }
  }
  for (int i=0; i < getServerCount(); i++) {
    stopServer(i);
    if (i + 1 > getServerCount() / 2) {
      startServer(i);
    }
 else     if (i + 1 == getServerCount() / 2) {
      Assert.assertTrue("Connection didn't recover",waitForConnect(zk,10000));
      try {
        zk.setData("/simpleCase","new".getBytes(),-1);
      }
 catch (      ConnectionLossException e) {
        Assert.assertTrue("Connection didn't recover",waitForConnect(zk,10000));
        zk.setData("/simpleCase","new".getBytes(),-1);
      }
      for (int j=0; j < i; j++) {
        LOG.info("Starting server " + j);
        startServer(i);
      }
    }
  }
  Thread.sleep(100);
  Assert.assertTrue("Servers didn't bounce",waitForConnect(zk,15000));
  try {
    zk.getData("/simpleCase",false,stat);
  }
 catch (  ConnectionLossException e) {
    Assert.assertTrue("Servers didn't bounce",waitForConnect(zk,15000));
  }
  for (int i=0; i < getClientCount(); i++) {
    for (int j=0; j < maxTries; j++) {
      byte data[]=zk.getData("/simpleCase/" + i,false,stat);
      if (new String(data).equals("new")) {
        break;
      }
      if (j + 1 == maxTries) {
        Assert.fail("max tries exceeded for " + i);
      }
      Thread.sleep(1000);
    }
  }
  zk.setData("/simpleCase","die".getBytes(),-1);
  for (int i=0; i < getClientCount(); i++) {
    try {
      for (int j=0; j < maxTries; j++) {
        zk.getData("/simpleCase/" + i,false,stat);
        if (j + 1 == maxTries) {
          Assert.fail("max tries exceeded waiting for child " + i + " to die");
        }
        Thread.sleep(200);
      }
    }
 catch (    NoNodeException e) {
    }
  }
  stopClients();
  stopServers();
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
