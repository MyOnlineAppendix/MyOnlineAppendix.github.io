<h3><span class=" glyphicon glyphicon-tag"/>&nbspUtilityVerifier</h3><kbd>Verifies (un)successful execution of the test case by reporting explicitly a failure</kbd><br><br><br><h4 style="margin:0px">Class: org.apache.jute.BinaryInputArchiveTest </h4><pre class="type-3 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReadStringCheckLength(){
  byte[] buf=new byte[]{Byte.MAX_VALUE,Byte.MAX_VALUE,Byte.MAX_VALUE,Byte.MAX_VALUE};
  ByteArrayInputStream is=new ByteArrayInputStream(buf);
  BinaryInputArchive ia=BinaryInputArchive.getArchive(is);
  try {
    ia.readString("");
    Assert.fail("Should have thrown an IOException");
  }
 catch (  IOException e) {
    Assert.assertTrue("Not 'Unreasonable length' exception: " + e,e.getMessage().startsWith(BinaryInputArchive.UNREASONBLE_LENGTH));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.RemoveWatchesTest </h4><pre class="type-3 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies given watcher doesn't exists!
 */
@Test(timeout=90000) public void testNoWatcherException() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",2);
  MyWatcher w2=new MyWatcher("/node1",2);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNull("Didn't set data watches",zk2.exists("/node2",w2));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w2);
  MyWatcher w3=new MyWatcher("/node1",2);
  try {
    removeWatches(zk2,"/node1",w3,WatcherType.Any,false,Code.NOWATCHER);
    Assert.fail("Should throw exception as given watcher doesn't exists");
  }
 catch (  KeeperException.NoWatcherException nwe) {
  }
  try {
    removeWatches(zk2,"/node1",w3,WatcherType.Children,false,Code.NOWATCHER);
    Assert.fail("Should throw exception as given watcher doesn't exists");
  }
 catch (  KeeperException.NoWatcherException nwe) {
  }
  try {
    removeWatches(zk2,"/node1",w3,WatcherType.Data,false,Code.NOWATCHER);
    Assert.fail("Should throw exception as given watcher doesn't exists");
  }
 catch (  KeeperException.NoWatcherException nwe) {
  }
  try {
    removeWatches(zk2,"/nonexists",w3,WatcherType.Data,false,Code.NOWATCHER);
    Assert.fail("Should throw exception as given watcher doesn't exists");
  }
 catch (  KeeperException.NoWatcherException nwe) {
  }
}

</code></pre>

<br>
<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Test verifies given watcher doesn't exists!
 */
@Test(timeout=90000) public void testRemoveAllNoWatcherException() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  try {
    removeAllWatches(zk2,"/node1",WatcherType.Any,false,Code.NOWATCHER);
    Assert.fail("Should throw exception as given watcher doesn't exists");
  }
 catch (  KeeperException.NoWatcherException nwe) {
  }
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies when there is no server connection. Remove watches when
 * local=true, otw should retain it
 */
@Test(timeout=90000) public void testRemoveWatcherWhenNoConnection() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",2);
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w2);
  stopServer();
  removeWatches(zk2,"/node1",w2,WatcherType.Any,true,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
  Assert.assertFalse("Shouldn't remove data watcher",w1.matches());
  try {
    removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.CONNECTIONLOSS);
    Assert.fail("Should throw exception as last watch removal requires server connection");
  }
 catch (  KeeperException.ConnectionLossException nwe) {
  }
  Assert.assertFalse("Shouldn't remove data watcher",w1.matches());
  removeWatches(zk2,"/node1",w1,WatcherType.Any,true,Code.OK);
  Assert.assertTrue("Didn't remove data watcher",w1.matches());
}

</code></pre>

<br>
<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Test verifies null watcher
 */
@Test(timeout=30000) public void testNullWatcherReference() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  try {
    if (useAsync) {
      zk1.removeWatches("/node1",null,WatcherType.Data,false,null,null);
    }
 else {
      zk1.removeWatches("/node1",null,WatcherType.Data,false);
    }
    Assert.fail("Must throw IllegalArgumentException as watcher is null!");
  }
 catch (  IllegalArgumentException iae) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.ZooKeeperTest </h4><pre class="type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testCliCommandsNotEchoingUsage() throws Exception {
  final PrintStream systemErr=System.err;
  final ByteArrayOutputStream errContent=new ByteArrayOutputStream();
  System.setErr(new PrintStream(errContent));
  final ZooKeeper zk=createClient();
  ZooKeeperMain zkMain=new ZooKeeperMain(zk);
  String cmd1="printwatches";
  zkMain.executeLine(cmd1);
  String cmd2="history";
  zkMain.executeLine(cmd2);
  String cmd3="redo";
  zkMain.executeLine(cmd3);
  System.setErr(systemErr);
  if (errContent.toString().contains("ZooKeeper -server host:port cmd args")) {
    fail("CLI commands (history, redo, connect, printwatches) display usage info!");
  }
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateNodeWithoutData() throws Exception {
  final ZooKeeper zk=createClient();
  ZooKeeperMain zkMain=new ZooKeeperMain(zk);
  String cmdstring="create -s /node ";
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertTrue("Doesn't create node without data",zkMain.processZKCmd(zkMain.cl));
  cmdstring="create  -e /node ";
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertTrue("Doesn't create node without data",zkMain.processZKCmd(zkMain.cl));
  cmdstring="create -s -e /node ";
  zkMain.cl.parseCommand(cmdstring);
  Assert.assertTrue("Doesn't create node without data",zkMain.processZKCmd(zkMain.cl));
  cmdstring="create -s y /node";
  zkMain.cl.parseCommand(cmdstring);
  try {
    Assert.assertTrue("Created node with wrong option",zkMain.processZKCmd(zkMain.cl));
    Assert.fail("Created the node with wrong option should " + "throw Exception.");
  }
 catch (  IllegalArgumentException e) {
    Assert.assertEquals("Path must start with / character",e.getMessage());
  }
}

</code></pre>

<br>
<pre class="type-3 type-2 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidStatCommand() throws Exception {
  final ZooKeeper zk=createClient();
  ZooKeeperMain zkMain=new ZooKeeperMain(zk);
  String cmdstring1="stat /node123";
  zkMain.cl.parseCommand(cmdstring1);
  try {
    Assert.assertFalse(zkMain.processZKCmd(zkMain.cl));
    Assert.fail("Path doesn't exists so, command should fail.");
  }
 catch (  KeeperException e) {
    Assert.assertEquals(KeeperException.Code.NONODE,e.code());
  }
}

</code></pre>

<br>
<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testDeleteWithInvalidVersionNo() throws Exception {
  final ZooKeeper zk=createClient();
  ZooKeeperMain zkMain=new ZooKeeperMain(zk);
  String cmdstring="create -s -e /node1 data ";
  String cmdstring1="delete /node1 2";
  zkMain.executeLine(cmdstring);
  try {
    zkMain.executeLine(cmdstring1);
  }
 catch (  KeeperException.BadVersionException e) {
    fail("For Invalid dataversion number should not throw exception");
  }
}

</code></pre>

<br>
<pre class="type-3 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testStatWhenPathDoesNotExist() throws IOException, InterruptedException {
  final ZooKeeper zk=createClient();
  ZooKeeperMain main=new ZooKeeperMain(zk);
  String cmdstring="stat /invalidPath";
  main.cl.parseCommand(cmdstring);
  try {
    main.processZKCmd(main.cl);
    Assert.fail("As Node does not exist, command should fail by throwing No Node Exception.");
  }
 catch (  KeeperException e) {
    Assert.assertEquals("KeeperErrorCode = NoNode for /invalidPath",e.getMessage());
  }
}

</code></pre>

<br>
<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testCheckInvalidAcls() throws Exception {
  final ZooKeeper zk=createClient();
  ZooKeeperMain zkMain=new ZooKeeperMain(zk);
  String cmdstring="create -s -e /node data ip:scheme:gggsd";
  try {
    zkMain.executeLine(cmdstring);
  }
 catch (  KeeperException.InvalidACLException e) {
    fail("For Invalid ACls should not throw exception");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.ZooKeeperTestableTest </h4><pre class="type-3 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSessionExpiration() throws IOException, InterruptedException, KeeperException {
  ZooKeeper zk=createClient();
  final CountDownLatch expirationLatch=new CountDownLatch(1);
  Watcher watcher=new Watcher(){
    @Override public void process(    WatchedEvent event){
      if (event.getState() == Event.KeeperState.Expired) {
        expirationLatch.countDown();
      }
    }
  }
;
  zk.exists("/foo",watcher);
  zk.getTestable().injectSessionExpiration();
  Assert.assertTrue(expirationLatch.await(5,TimeUnit.SECONDS));
  boolean gotException=false;
  try {
    zk.exists("/foo",false);
    Assert.fail("Should have thrown a SessionExpiredException");
  }
 catch (  KeeperException.SessionExpiredException e) {
    gotException=true;
  }
  Assert.assertTrue(gotException);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.NIOServerCnxnTest </h4><pre class="type-3 type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test operations on ServerCnxn after socket closure.
 */
@Test(timeout=60000) public void testOperationsAfterCnxnClose() throws IOException, InterruptedException, KeeperException {
  final ZooKeeper zk=createClient();
  final String path="/a";
  try {
    zk.create(path,"test".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    Assert.assertNotNull("Didn't create znode:" + path,zk.exists(path,false));
    Assert.assertTrue("Didn't instantiate ServerCnxnFactory with NIOServerCnxnFactory!",serverFactory instanceof NIOServerCnxnFactory);
    Iterable<ServerCnxn> connections=serverFactory.getConnections();
    for (    ServerCnxn serverCnxn : connections) {
      serverCnxn.close();
      try {
        serverCnxn.toString();
      }
 catch (      Exception e) {
        LOG.error("Exception while getting connection details!",e);
        Assert.fail("Shouldn't throw exception while " + "getting connection details!");
      }
    }
  }
  finally {
    zk.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.NettyServerCnxnTest </h4><pre class="type-9 type-10 type-3 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies the channel closure - while closing the channel
 * servercnxnfactory should remove all channel references to avoid
 * duplicate channel closure. Duplicate closure may result in indefinite
 * hanging due to netty open issue.
 * @see <a href="https://issues.jboss.org/browse/NETTY-412">NETTY-412</a>
 */
@Test(timeout=40000) public void testSendCloseSession() throws Exception {
  Assert.assertTrue("Didn't instantiate ServerCnxnFactory with NettyServerCnxnFactory!",serverFactory instanceof NettyServerCnxnFactory);
  final ZooKeeper zk=createClient();
  final String path="/a";
  try {
    zk.create(path,"test".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    Assert.assertNotNull("Didn't create znode:" + path,zk.exists(path,false));
    Iterable<ServerCnxn> connections=serverFactory.getConnections();
    Assert.assertEquals("Mismatch in number of live connections!",1,serverFactory.getNumAliveConnections());
    for (    ServerCnxn serverCnxn : connections) {
      serverCnxn.sendCloseSession();
    }
    LOG.info("Waiting for the channel disconnected event");
    int timeout=0;
    while (serverFactory.getNumAliveConnections() != 0) {
      Thread.sleep(1000);
      timeout+=1000;
      if (timeout > CONNECTION_TIMEOUT) {
        Assert.fail("The number of live connections should be 0");
      }
    }
  }
  finally {
    zk.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.PurgeTxnTest </h4><pre class="type-3 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests purge when logs are rolling or a new snapshot is created, then
 * these newer files should alse be excluded in the current cycle.
 * For frequent snapshotting, configured SnapCount to 30. There are three
 * threads which will create 1000 znodes each and simultaneously do purge
 * call
 */
@Test public void testPurgeWhenLogRollingInProgress() throws Exception {
  tmpDir=ClientBase.createTmpDir();
  ClientBase.setupTestEnv();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  SyncRequestProcessor.setSnapCount(30);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  final ZooKeeper zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,this);
  final CountDownLatch doPurge=new CountDownLatch(1);
  final CountDownLatch purgeFinished=new CountDownLatch(1);
  final AtomicBoolean opFailed=new AtomicBoolean(false);
  new Thread(){
    public void run(){
      try {
        doPurge.await(OP_TIMEOUT_IN_MILLIS / 2,TimeUnit.MILLISECONDS);
        PurgeTxnLog.purge(tmpDir,tmpDir,3);
      }
 catch (      IOException ioe) {
        LOG.error("Exception when purge",ioe);
        opFailed.set(true);
      }
catch (      InterruptedException ie) {
        LOG.error("Exception when purge",ie);
        opFailed.set(true);
      }
 finally {
        purgeFinished.countDown();
      }
    }
  }
.start();
  final int thCount=3;
  List<String> znodes=manyClientOps(zk,doPurge,thCount,"/invalidsnap");
  Assert.assertTrue("Purging is not finished!",purgeFinished.await(OP_TIMEOUT_IN_MILLIS,TimeUnit.MILLISECONDS));
  Assert.assertFalse("Purging failed!",opFailed.get());
  for (  String znode : znodes) {
    try {
      zk.getData(znode,false,null);
    }
 catch (    Exception ke) {
      LOG.error("Unexpected exception when visiting znode!",ke);
      Assert.fail("Unexpected exception when visiting znode!");
    }
  }
  zk.close();
  f.shutdown();
  zks.shutdown();
  zks.getTxnLogFactory().close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.SessionTrackerTest </h4><pre class="type-5 type-3 type-2 type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify the create session call in the Leader.FinalRequestProcessor after
 * the session expiration.
 */
@Test(timeout=20000) public void testAddSessionAfterSessionExpiry() throws Exception {
  ZooKeeperServer zks=setupSessionTracker();
  latch=new CountDownLatch(1);
  zks.sessionTracker.addSession(sessionId,sessionTimeout);
  SessionTrackerImpl sessionTrackerImpl=(SessionTrackerImpl)zks.sessionTracker;
  SessionImpl sessionImpl=sessionTrackerImpl.sessionsById.get(sessionId);
  Assert.assertNotNull("Sessionid:" + sessionId + " doesn't exists in sessiontracker",sessionImpl);
  Object sessionOwner=new Object();
  sessionTrackerImpl.checkSession(sessionId,sessionOwner);
  latch.await(sessionTimeout * 2,TimeUnit.MILLISECONDS);
  sessionTrackerImpl.addSession(sessionId,sessionTimeout);
  try {
    sessionTrackerImpl.checkSession(sessionId,sessionOwner);
    Assert.fail("Should throw session expiry exception " + "as the session has expired and closed");
  }
 catch (  KeeperException.SessionExpiredException e) {
  }
  Assert.assertTrue("Session didn't expired",sessionImpl.isClosing());
  Assert.assertFalse("Session didn't expired",sessionTrackerImpl.touchSession(sessionId,sessionTimeout));
  Assert.assertEquals("Duplicate session expiry request has been generated",1,firstProcessor.getCountOfCloseSessionReq());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.ZooKeeperServerMainTest </h4><pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Test verifies that the server shouldn't allow minsessiontimeout >
 * maxsessiontimeout
 */
@Test public void testWithMinSessionTimeoutGreaterThanMaxSessionTimeout() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT=PortAssignment.unique();
  final int tickTime=2000;
  final int minSessionTimeout=20 * tickTime + 1000;
  final int maxSessionTimeout=tickTime * 2 - 100;
  final String configs="maxSessionTimeout=" + maxSessionTimeout + "\n"+ "minSessionTimeout="+ minSessionTimeout+ "\n";
  MainThread main=new MainThread(CLIENT_PORT,false,configs);
  String args[]=new String[1];
  args[0]=main.confFile.toString();
  try {
    main.main.initializeAndRun(args);
    Assert.fail("Must throw exception as " + "minsessiontimeout > maxsessiontimeout");
  }
 catch (  ConfigException iae) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.jersey.GetChildrenTest </h4><pre class="type-5 type-10 type-3 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetChildren() throws Exception {
  if (expectedChildren != null) {
    for (    String child : expectedChildren) {
      zk.create(expectedPath + "/" + child,null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    }
  }
  ClientResponse cr=znodesr.path(path).queryParam("view","children").accept(accept).get(ClientResponse.class);
  Assert.assertEquals(expectedStatus,cr.getClientResponseStatus());
  if (expectedChildren == null) {
    return;
  }
  if (accept.equals(MediaType.APPLICATION_JSON)) {
    ZChildrenJSON zchildren=cr.getEntity(ZChildrenJSON.class);
    Collections.sort(expectedChildren);
    Collections.sort(zchildren.children);
    Assert.assertEquals(expectedChildren,zchildren.children);
    Assert.assertEquals(znodesr.path(path).toString(),zchildren.uri);
    Assert.assertEquals(znodesr.path(path).toString() + "/{child}",zchildren.child_uri_template);
  }
 else   if (accept.equals(MediaType.APPLICATION_XML)) {
    ZChildren zchildren=cr.getEntity(ZChildren.class);
    Collections.sort(expectedChildren);
    Collections.sort(zchildren.children);
    Assert.assertEquals(expectedChildren,zchildren.children);
    Assert.assertEquals(znodesr.path(path).toString(),zchildren.uri);
    Assert.assertEquals(znodesr.path(path).toString() + "/{child}",zchildren.child_uri_template);
  }
 else {
    Assert.fail("unknown accept type");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.jersey.SetTest </h4><pre class="type-5 type-10 type-3 type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSet() throws Exception {
  if (expectedStat != null) {
    zk.create(expectedStat.path,"initial".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  }
  WebResource wr=znodesr.path(path).queryParam("dataformat",encoding);
  if (data == null) {
    wr=wr.queryParam("null","true");
  }
  Builder builder=wr.accept(accept).type(MediaType.APPLICATION_OCTET_STREAM);
  ClientResponse cr;
  if (data == null) {
    cr=builder.put(ClientResponse.class);
  }
 else {
    cr=builder.put(ClientResponse.class,new String(data));
  }
  Assert.assertEquals(expectedStatus,cr.getClientResponseStatus());
  if (expectedStat == null) {
    return;
  }
  ZStat zstat=cr.getEntity(ZStat.class);
  Assert.assertEquals(expectedStat,zstat);
  byte[] data=zk.getData(zstat.path,false,new Stat());
  if (data == null && this.data == null) {
    return;
  }
 else   if (data == null || this.data == null) {
    Assert.fail((data == null ? null : new String(data)) + " == " + (this.data == null ? null : new String(this.data)));
  }
 else {
    Assert.assertTrue(new String(data) + " == " + new String(this.data),Arrays.equals(data,this.data));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.FLEBackwardElectionRoundTest </h4><pre class="type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * This test is checking the following case. A server S is
 * currently LOOKING and it receives notifications from
 * a quorum indicating they are following S. The election
 * round E of S is higher than the election round E' in the
 * notification messages, so S becomes the leader and sets
 * its epoch back to E'. In the meanwhile, one or more
 * followers turn to LOOKING and elect S in election round E.
 * Having leader and followers with different election rounds
 * might prevent other servers from electing a leader because
 * they can't get a consistent set of notifications from a
 * quorum.{@link https://issues.apache.org/jira/browse/ZOOKEEPER-1514}
 * @throws Exception
 */
@Test public void testBackwardElectionRound() throws Exception {
  LOG.info("TestLE: {}, {}",getTestName(),count);
  for (int i=0; i < count; i++) {
    int clientport=PortAssignment.unique();
    peers.put(Long.valueOf(i),new QuorumServer(i,new InetSocketAddress(clientport),new InetSocketAddress(PortAssignment.unique())));
    tmpdir[i]=ClientBase.createTmpDir();
    port[i]=clientport;
  }
  ByteBuffer initialMsg=FLETestUtils.createMsg(ServerState.FOLLOWING.ordinal(),0,0,1);
  QuorumPeer peer=new QuorumPeer(peers,tmpdir[0],tmpdir[0],port[0],3,0,1000,2,2);
  peer.startLeaderElection();
  FLETestUtils.LEThread thread=new FLETestUtils.LEThread(peer,0);
  thread.start();
  QuorumPeer mockPeer=new QuorumPeer(peers,tmpdir[1],tmpdir[1],port[1],3,1,1000,2,2);
  cnxManagers[0]=new QuorumCnxManager(mockPeer);
  cnxManagers[0].listener.start();
  cnxManagers[0].toSend(0l,initialMsg);
  mockPeer=new QuorumPeer(peers,tmpdir[2],tmpdir[2],port[2],3,2,1000,2,2);
  cnxManagers[1]=new QuorumCnxManager(mockPeer);
  cnxManagers[1].listener.start();
  cnxManagers[1].toSend(0l,initialMsg);
  thread.join(5000);
  thread=new FLETestUtils.LEThread(peer,0);
  thread.start();
  cnxManagers[0].toSend(0l,initialMsg);
  cnxManagers[1].toSend(0l,initialMsg);
  thread.join(5000);
  if (!thread.isAlive()) {
    Assert.fail("Should not have joined");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.FLELostMessageTest </h4><pre class="type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testLostMessage() throws Exception {
  LOG.info("TestLE: {}, {}",getTestName(),count);
  for (int i=0; i < count; i++) {
    int clientport=PortAssignment.unique();
    peers.put(Long.valueOf(i),new QuorumServer(i,new InetSocketAddress(clientport),new InetSocketAddress(PortAssignment.unique())));
    tmpdir[i]=ClientBase.createTmpDir();
    port[i]=clientport;
  }
  QuorumPeer peer=new QuorumPeer(peers,tmpdir[1],tmpdir[1],port[1],3,1,1000,2,2);
  peer.startLeaderElection();
  FLETestUtils.LEThread thread=new FLETestUtils.LEThread(peer,1);
  thread.start();
  mockServer();
  thread.join(5000);
  if (thread.isAlive()) {
    Assert.fail("Threads didn't join");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.LearnerSnapshotThrottlerTest </h4><pre class="type-3 type-11 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(expected=SnapshotThrottleException.class) public void testTooManySnapshotsEssential() throws Exception {
  LearnerSnapshotThrottler throttler=new LearnerSnapshotThrottler(5);
  try {
    for (int i=0; i < 6; i++) {
      throttler.beginSnapshot(true);
    }
  }
 catch (  SnapshotThrottleException ex) {
    Assert.fail("essential snapshots should not be throttled");
  }
  throttler.endSnapshot();
  throttler.beginSnapshot(false);
}

</code></pre>

<br>
<pre class="type-3 type-11 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(expected=SnapshotThrottleException.class) public void testTryWithResourceThrottle() throws Exception {
  LearnerSnapshotThrottler throttler=new LearnerSnapshotThrottler(1);
  LearnerSnapshot outer=throttler.beginSnapshot(true);
  try {
    LearnerSnapshot inner=throttler.beginSnapshot(false);
    try {
      Assert.fail("shouldn't be able to have both snapshots open");
    }
  finally {
      inner.close();
    }
  }
  finally {
    outer.close();
  }
}

</code></pre>

<br>
<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testNoThrottle() throws Exception {
  LearnerSnapshotThrottler throttler=new LearnerSnapshotThrottler(5);
  try {
    for (int i=0; i < 6; i++) {
      throttler.beginSnapshot(true);
    }
  }
 catch (  SnapshotThrottleException ex) {
    Assert.fail("essential snapshots should not be throttled");
  }
  throttler.endSnapshot();
  for (int i=0; i < 5; i++) {
    throttler.endSnapshot();
    throttler.beginSnapshot(false);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.LearnerTest </h4><pre class="type-3 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void connectionInitLimitTimeoutTest() throws Exception {
  TimeoutLearner learner=new TimeoutLearner();
  learner.self=new QuorumPeer();
  learner.self.setTickTime(2000);
  learner.self.setInitLimit(5);
  learner.self.setSyncLimit(2);
  InetSocketAddress addr=new InetSocketAddress(1111);
  learner.setTimeMultiplier((long)4000 * 1000000);
  learner.setPassConnectAttempt(5);
  try {
    learner.connectToLeader(addr);
    Assert.fail("should have thrown IOException!");
  }
 catch (  IOException e) {
    Assert.assertTrue(learner.nanoTime() > 2000 * 5 * 1000000);
    Assert.assertEquals(3,learner.getSockConnectAttempt());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.QuorumPeerConfigTest </h4><pre class="type-3 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test case for https://issues.apache.org/jira/browse/ZOOKEEPER-2264
 */
@Test public void testErrorMessageWhenclientPortNotSetButclientPortAddressSet() throws IOException, ConfigException {
  QuorumPeerConfig quorumPeerConfig=new QuorumPeerConfig();
  try {
    Properties zkProp=getDefaultZKProperties();
    zkProp.setProperty("clientPortAddress","localhost");
    quorumPeerConfig.parseProperties(zkProp);
    fail("IllegalArgumentException is expected");
  }
 catch (  IllegalArgumentException e) {
    String expectedMessage="clientPortAddress is set but clientPort is not set";
    assertEquals(expectedMessage,e.getMessage());
  }
}

</code></pre>

<br>
<pre class="type-3 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * test case for https://issues.apache.org/jira/browse/ZOOKEEPER-2264
 */
@Test public void testErrorMessageWhensecureClientPortNotSetButsecureClientPortAddressSet() throws IOException, ConfigException {
  QuorumPeerConfig quorumPeerConfig=new QuorumPeerConfig();
  try {
    Properties zkProp=getDefaultZKProperties();
    zkProp.setProperty("secureClientPortAddress","localhost");
    quorumPeerConfig.parseProperties(zkProp);
    fail("IllegalArgumentException is expected");
  }
 catch (  IllegalArgumentException e) {
    String expectedMessage="secureClientPortAddress is set but secureClientPort is not set";
    assertEquals(expectedMessage,e.getMessage());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.QuorumPeerMainTest </h4><pre class="type-9 type-10 type-3 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test early leader abandonment.
 */
@Test public void testEarlyLeaderAbandonment() throws Exception {
  ClientBase.setupTestEnv();
  final int SERVER_COUNT=3;
  final int clientPorts[]=new int[SERVER_COUNT];
  StringBuilder sb=new StringBuilder();
  for (int i=0; i < SERVER_COUNT; i++) {
    clientPorts[i]=PortAssignment.unique();
    sb.append("server." + i + "=127.0.0.1:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ";"+ clientPorts[i]+ "\n");
  }
  String quorumCfgSection=sb.toString();
  MainThread mt[]=new MainThread[SERVER_COUNT];
  ZooKeeper zk[]=new ZooKeeper[SERVER_COUNT];
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i]=new MainThread(i,clientPorts[i],quorumCfgSection);
    mt[i].start();
    zk[i]=new ZooKeeper("127.0.0.1:" + clientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
  }
  waitForAll(zk,States.CONNECTED);
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i].shutdown();
  }
  waitForAll(zk,States.CONNECTING);
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i].start();
    zk[i]=new ZooKeeper("127.0.0.1:" + clientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
  }
  waitForAll(zk,States.CONNECTED);
  int leader=-1;
  Map<Long,Proposal> outstanding=null;
  for (int i=0; i < SERVER_COUNT; i++) {
    if (mt[i].main.quorumPeer.leader == null) {
      mt[i].shutdown();
    }
 else {
      leader=i;
      outstanding=mt[leader].main.quorumPeer.leader.outstandingProposals;
    }
  }
  try {
    zk[leader].create("/zk" + leader,"zk".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    Assert.fail("create /zk" + leader + " should have failed");
  }
 catch (  KeeperException e) {
  }
  Assert.assertTrue(outstanding.size() == 1);
  Assert.assertTrue(((Proposal)outstanding.values().iterator().next()).request.getHdr().getType() == OpCode.create);
  Thread.sleep(1000);
  mt[leader].shutdown();
  waitForAll(zk,States.CONNECTING);
  for (int i=0; i < SERVER_COUNT; i++) {
    if (i != leader) {
      mt[i].start();
    }
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    if (i != leader) {
      zk[i]=new ZooKeeper("127.0.0.1:" + clientPorts[i],ClientBase.CONNECTION_TIMEOUT,this);
      waitForOne(zk[i],States.CONNECTED);
      zk[i].create("/zk" + i,"zk".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    }
  }
  mt[leader].start();
  waitForAll(zk,States.CONNECTED);
  for (int i=0; i < SERVER_COUNT; i++) {
    for (int j=0; j < SERVER_COUNT; j++) {
      if (i == leader) {
        Assert.assertTrue((j == leader ? ("Leader (" + leader + ")") : ("Follower " + j)) + " should not have /zk" + i,zk[j].exists("/zk" + i,false) == null);
      }
 else {
        Assert.assertTrue((j == leader ? ("Leader (" + leader + ")") : ("Follower " + j)) + " does not have /zk" + i,zk[j].exists("/zk" + i,false) != null);
      }
    }
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    zk[i].close();
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i].shutdown();
  }
}

</code></pre>

<br>
<pre class="type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Verifies that QuorumPeer exits immediately
 */
@Test public void testQuorumPeerExitTime() throws Exception {
  long maxwait=3000;
  final int CLIENT_PORT_QP1=PortAssignment.unique();
  String quorumCfgSection="server.1=127.0.0.1:" + PortAssignment.unique() + ":"+ PortAssignment.unique()+ ";"+ CLIENT_PORT_QP1+ "\nserver.2=127.0.0.1:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ";"+ PortAssignment.unique();
  MainThread q1=new MainThread(1,CLIENT_PORT_QP1,quorumCfgSection);
  q1.start();
  Thread.sleep(30000);
  long start=Time.currentElapsedTime();
  q1.shutdown();
  long end=Time.currentElapsedTime();
  if ((end - start) > maxwait) {
    Assert.fail("QuorumPeer took " + (end - start) + " to shutdown, expected "+ maxwait);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.ReconfigFailureCasesTest </h4><pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testReconfigVersionConditionFails() throws Exception {
  qu=new QuorumUtil(1);
  qu.disableJMXTest=true;
  qu.startAll();
  ZooKeeper[] zkArr=ReconfigTest.createHandles(qu);
  List<String> leavingServers=new ArrayList<String>();
  leavingServers.add("3");
  try {
    zkArr[1].reconfig(null,leavingServers,null,8,null);
    Assert.fail("Reconfig should have failed since the current config version is not 8");
  }
 catch (  KeeperException.BadVersionException e) {
  }
catch (  Exception e) {
    Assert.fail("Should have been BadVersionException!");
  }
  ReconfigTest.closeAllHandles(zkArr);
}

</code></pre>

<br>
<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testTooFewRemainingPariticipants() throws Exception {
  qu=new QuorumUtil(1);
  qu.disableJMXTest=true;
  qu.startAll();
  ZooKeeper[] zkArr=ReconfigTest.createHandles(qu);
  List<String> leavingServers=new ArrayList<String>();
  leavingServers.add("2");
  leavingServers.add("3");
  try {
    zkArr[1].reconfig(null,leavingServers,null,-1,null);
    Assert.fail("Reconfig should have failed since the current config version is not 8");
  }
 catch (  KeeperException.BadArgumentsException e) {
  }
catch (  Exception e) {
    Assert.fail("Should have been BadArgumentsException!");
  }
  ReconfigTest.closeAllHandles(zkArr);
}

</code></pre>

<br>
<pre class="type-9 type-5 type-3 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testObserverToParticipantConversionFails() throws Exception {
  ClientBase.setupTestEnv();
  final int SERVER_COUNT=4;
  int[][] ports=ReconfigRecoveryTest.generatePorts(SERVER_COUNT);
  HashSet<Integer> observers=new HashSet<Integer>();
  observers.add(3);
  StringBuilder sb=ReconfigRecoveryTest.generateConfig(SERVER_COUNT,ports,observers);
  String currentQuorumCfgSection=sb.toString();
  String nextQuorumCfgSection=currentQuorumCfgSection.replace("observer","participant");
  MainThread mt[]=new MainThread[SERVER_COUNT];
  ZooKeeper zk[]=new ZooKeeper[SERVER_COUNT];
  for (int i=1; i < SERVER_COUNT; i++) {
    mt[i]=new MainThread(i,ports[i][2],currentQuorumCfgSection,true,"100000000");
    mt[i].start();
    zk[i]=new ZooKeeper("127.0.0.1:" + ports[i][2],ClientBase.CONNECTION_TIMEOUT,this);
  }
  for (int i=1; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + ports[i][2],CONNECTION_TIMEOUT * 2));
  }
  try {
    zk[1].reconfig("","",nextQuorumCfgSection,-1,new Stat());
    Assert.fail("Reconfig should have failed with NewConfigNoQuorum");
  }
 catch (  NewConfigNoQuorum e) {
  }
catch (  Exception e) {
    Assert.fail("Reconfig should have failed with NewConfigNoQuorum");
  }
  ArrayList<String> leavingServers=new ArrayList<String>();
  leavingServers.add("3");
  ReconfigTest.reconfig(zk[1],null,leavingServers,null,-1);
  ReconfigTest.testNormalOperation(zk[2],zk[3]);
  ReconfigTest.testServerHasConfig(zk[3],null,leavingServers);
  List<String> newMembers=Arrays.asList(nextQuorumCfgSection.split("\n"));
  ReconfigTest.reconfig(zk[1],null,null,newMembers,-1);
  ReconfigTest.testNormalOperation(zk[2],zk[3]);
  for (int i=1; i < SERVER_COUNT; i++) {
    ReconfigTest.testServerHasConfig(zk[i],newMembers,null);
  }
  for (int i=1; i < SERVER_COUNT; i++) {
    zk[i].close();
    mt[i].shutdown();
  }
}

</code></pre>

<br>
<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testIncrementalReconfigInvokedOnHiearchicalQS() throws Exception {
  qu=new QuorumUtil(2);
  qu.disableJMXTest=true;
  qu.startAll();
  ZooKeeper[] zkArr=ReconfigTest.createHandles(qu);
  ArrayList<String> members=new ArrayList<String>();
  members.add("group.1=3:4:5");
  members.add("group.2=1:2");
  members.add("weight.1=0");
  members.add("weight.2=0");
  members.add("weight.3=1");
  members.add("weight.4=1");
  members.add("weight.5=1");
  for (int i=1; i <= 5; i++) {
    members.add("server." + i + "=127.0.0.1:"+ qu.getPeer(i).peer.getQuorumAddress().getPort()+ ":"+ qu.getPeer(i).peer.getElectionAddress().getPort()+ ";"+ "127.0.0.1:"+ qu.getPeer(i).peer.getClientPort());
  }
  ReconfigTest.reconfig(zkArr[1],null,null,members,-1);
  ReconfigTest.testNormalOperation(zkArr[1],zkArr[2]);
  List<String> leavingServers=new ArrayList<String>();
  leavingServers.add("3");
  try {
    zkArr[1].reconfig(null,leavingServers,null,-1,null);
    Assert.fail("Reconfig should have failed since the current config isn't Majority QS");
  }
 catch (  KeeperException.BadArgumentsException e) {
  }
catch (  Exception e) {
    Assert.fail("Should have been BadArgumentsException!");
  }
  ReconfigTest.closeAllHandles(zkArr);
}

</code></pre>

<br>
<pre class="type-3 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLeaderTimesoutOnNewQuorum() throws Exception {
  qu=new QuorumUtil(1);
  qu.disableJMXTest=true;
  qu.startAll();
  ZooKeeper[] zkArr=ReconfigTest.createHandles(qu);
  List<String> leavingServers=new ArrayList<String>();
  leavingServers.add("3");
  qu.shutdown(2);
  try {
    zkArr[1].reconfig(null,leavingServers,null,-1,null);
    Assert.fail("Reconfig should have failed since we don't have quorum of new config");
  }
 catch (  KeeperException.ConnectionLossException e) {
  }
catch (  Exception e) {
    Assert.fail("Should have been ConnectionLossException!");
  }
  Assert.assertEquals(QuorumStats.Provider.LOOKING_STATE,qu.getPeer(1).peer.getServerState());
  Assert.assertEquals(QuorumStats.Provider.LOOKING_STATE,qu.getPeer(3).peer.getServerState());
  ReconfigTest.closeAllHandles(zkArr);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.StandaloneDisabledTest </h4><pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Test normal quorum operations work cleanly
 * with just a single server.
 */
@Test public void startSingleServerTest() throws Exception {
  setUpData();
  startServer(leaderId,serverStrings.get(leaderId) + "\n");
  ReconfigTest.testServerHasConfig(zkHandles[leaderId],null,null);
  LOG.info("Initial Configuration:\n" + new String(zkHandles[leaderId].getConfig(this,new Stat())));
  startFollowers();
  testReconfig(leaderId,true,reconfigServers);
  LOG.info("Configuration after adding 2 followers:\n" + new String(zkHandles[leaderId].getConfig(this,new Stat())));
  shutDownServer(leaderId);
  ReconfigTest.testNormalOperation(zkHandles[follower1],zkHandles[follower2]);
  reconfigServers.clear();
  reconfigServers.add(Integer.toString(follower2));
  try {
    ReconfigTest.reconfig(zkHandles[follower1],null,reconfigServers,null,-1);
    Assert.fail("reconfig completed successfully even though there is no quorum up in new config!");
  }
 catch (  KeeperException.NewConfigNoQuorum e) {
  }
  reconfigServers.clear();
  reconfigServers.add(Integer.toString(leaderId));
  reconfigServers.add(Integer.toString(follower1));
  testReconfig(follower2,false,reconfigServers);
  LOG.info("Configuration after removing leader and follower 1:\n" + new String(zkHandles[follower2].getConfig(this,new Stat())));
  reconfigServers.clear();
  reconfigServers.add(Integer.toString(follower2));
  try {
    zkHandles[follower2].reconfig(null,reconfigServers,null,-1,new Stat());
    Assert.fail("reconfig completed successfully even though there is no quorum up in new config!");
  }
 catch (  KeeperException.BadArgumentsException e) {
  }
catch (  Exception e) {
    Assert.fail("Should have been BadArgumentsException!");
  }
  ArrayList<String> observerStrings=new ArrayList<String>();
  startObservers(observerStrings);
  testReconfig(follower2,true,reconfigServers);
  testReconfig(follower2,true,observerStrings);
  LOG.info("Configuration after adding two observers:\n" + new String(zkHandles[follower2].getConfig(this,new Stat())));
  shutDownData();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.Zab1_0Test </h4><pre class="type-5 type-3 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * In this test, the leader sets the last accepted epoch to 5. The call
 * to getEpochToPropose should set epoch to 6 and wait until another 
 * follower executes it. If in getEpochToPropose we don't check if
 * lastAcceptedEpoch == epoch, then the call from the subsequent
 * follower with lastAcceptedEpoch = 6 doesn't change the value
 * of epoch, and the test fails. It passes with the fix to predicate.{@link https://issues.apache.org/jira/browse/ZOOKEEPER-1343}
 * @throws Exception
 */
@Test public void testLastAcceptedEpoch() throws Exception {
  File tmpDir=File.createTempFile("test","dir",testData);
  tmpDir.delete();
  tmpDir.mkdir();
  Leader leader=null;
  LeadThread leadThread=null;
  try {
    QuorumPeer peer=createQuorumPeer(tmpDir);
    leader=createMockLeader(tmpDir,peer);
    peer.leader=leader;
    peer.setAcceptedEpoch(5);
    leadThread=new LeadThread(leader);
    leadThread.start();
    while (((MockLeader)leader).getCurrentEpochToPropose() != 6) {
      Thread.sleep(20);
    }
    try {
      long epoch=leader.getEpochToPropose(1,6);
      Assert.assertEquals("New proposed epoch is wrong",7,epoch);
    }
 catch (    Exception e) {
      Assert.fail("Timed out in getEpochToPropose");
    }
  }
  finally {
    if (leader != null) {
      leader.shutdown("end of test");
    }
    if (leadThread != null) {
      leadThread.interrupt();
      leadThread.join();
    }
    TestUtils.deleteFileRecursively(tmpDir);
  }
}

</code></pre>

<br>
<pre class="type-3 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTxnTimeout() throws Exception {
  testLeaderConversation(new LeaderConversation(){
    public void converseWithLeader(    InputArchive ia,    OutputArchive oa,    Leader l) throws IOException, InterruptedException, org.apache.zookeeper.server.quorum.Leader.XidRolloverException {
      Assert.assertEquals(0,l.self.getAcceptedEpoch());
      Assert.assertEquals(0,l.self.getCurrentEpoch());
      LearnerInfo li=new LearnerInfo(1,0x10000,0);
      byte liBytes[]=new byte[20];
      ByteBufferOutputStream.record2ByteBuffer(li,ByteBuffer.wrap(liBytes));
      QuorumPacket qp=new QuorumPacket(Leader.FOLLOWERINFO,0,liBytes,null);
      oa.writeRecord(qp,null);
      readPacketSkippingPing(ia,qp);
      Assert.assertEquals(Leader.LEADERINFO,qp.getType());
      Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
      Assert.assertEquals(ByteBuffer.wrap(qp.getData()).getInt(),0x10000);
      Assert.assertEquals(1,l.self.getAcceptedEpoch());
      Assert.assertEquals(0,l.self.getCurrentEpoch());
      qp=new QuorumPacket(Leader.ACKEPOCH,0,new byte[4],null);
      oa.writeRecord(qp,null);
      readPacketSkippingPing(ia,qp);
      Assert.assertEquals(Leader.DIFF,qp.getType());
      readPacketSkippingPing(ia,qp);
      Assert.assertEquals(Leader.NEWLEADER,qp.getType());
      Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
      Assert.assertEquals(1,l.self.getAcceptedEpoch());
      Assert.assertEquals(1,l.self.getCurrentEpoch());
      qp=new QuorumPacket(Leader.ACK,qp.getZxid(),null,null);
      oa.writeRecord(qp,null);
      readPacketSkippingPing(ia,qp);
      Assert.assertEquals(Leader.UPTODATE,qp.getType());
      long zxid=l.zk.getZxid();
      l.propose(new Request(1,1,ZooDefs.OpCode.create,new TxnHeader(1,1,zxid,1,ZooDefs.OpCode.create),new CreateTxn("/test","hola".getBytes(),null,true,0),zxid));
      readPacketSkippingPing(ia,qp);
      Assert.assertEquals(Leader.PROPOSAL,qp.getType());
      LOG.info("Proposal sent.");
      for (int i=0; i < (2 * SYNC_LIMIT) + 2; i++) {
        try {
          ia.readRecord(qp,null);
          LOG.info("Ping received: " + i);
          qp=new QuorumPacket(Leader.PING,qp.getZxid(),"".getBytes(),null);
          oa.writeRecord(qp,null);
        }
 catch (        EOFException e) {
          return;
        }
      }
      Assert.fail("Connection hasn't been closed by leader after transaction times out.");
    }
  }
);
}

</code></pre>

<br>
<pre class="type-5 type-3 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLeaderInConnectingFollowers() throws Exception {
  File tmpDir=File.createTempFile("test","dir",testData);
  tmpDir.delete();
  tmpDir.mkdir();
  Leader leader=null;
  try {
    QuorumPeer peer=createQuorumPeer(tmpDir);
    leader=createLeader(tmpDir,peer);
    peer.leader=leader;
    peer.setAcceptedEpoch(5);
    FollowerMockThread f1=new FollowerMockThread(1,leader,true);
    FollowerMockThread f2=new FollowerMockThread(2,leader,true);
    f1.start();
    f2.start();
    f1.join(leader.self.getInitLimit() * leader.self.getTickTime() + 5000);
    f2.join(leader.self.getInitLimit() * leader.self.getTickTime() + 5000);
    try {
      long epoch=leader.getEpochToPropose(leader.self.getId(),leader.self.getAcceptedEpoch());
      Assert.assertEquals("leader got wrong epoch from getEpochToPropose",6,epoch);
    }
 catch (    Exception e) {
      Assert.fail("leader timed out in getEpochToPropose");
    }
  }
  finally {
    if (leader != null) {
      leader.shutdown("end of test");
    }
    TestUtils.deleteFileRecursively(tmpDir);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ACLRootTest </h4><pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testRootAcl() throws Exception {
  ZooKeeper zk=createClient();
  try {
    zk.addAuthInfo("digest","pat:test".getBytes());
    zk.setACL("/",Ids.CREATOR_ALL_ACL,-1);
    zk.getData("/",false,null);
    zk.close();
    zk=createClient();
    try {
      zk.getData("/",false,null);
      Assert.fail("validate auth");
    }
 catch (    KeeperException.NoAuthException e) {
    }
    try {
      zk.create("/apps",null,Ids.CREATOR_ALL_ACL,CreateMode.PERSISTENT);
      Assert.fail("validate auth");
    }
 catch (    KeeperException.InvalidACLException e) {
    }
    zk.addAuthInfo("digest","world:anyone".getBytes());
    try {
      zk.create("/apps",null,Ids.CREATOR_ALL_ACL,CreateMode.PERSISTENT);
      Assert.fail("validate auth");
    }
 catch (    KeeperException.NoAuthException e) {
    }
    zk.close();
    zk=createClient();
    zk.addAuthInfo("digest","pat:test".getBytes());
    zk.getData("/",false,null);
    zk.create("/apps",null,Ids.CREATOR_ALL_ACL,CreateMode.PERSISTENT);
    zk.delete("/apps",-1);
    zk.setACL("/",Ids.OPEN_ACL_UNSAFE,-1);
    zk.close();
    zk=createClient();
    zk.getData("/",false,null);
    zk.create("/apps",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    try {
      zk.create("/apps",null,Ids.CREATOR_ALL_ACL,CreateMode.PERSISTENT);
      Assert.fail("validate auth");
    }
 catch (    KeeperException.InvalidACLException e) {
    }
    zk.delete("/apps",-1);
    zk.addAuthInfo("digest","world:anyone".getBytes());
    zk.create("/apps",null,Ids.CREATOR_ALL_ACL,CreateMode.PERSISTENT);
    zk.close();
    zk=createClient();
    zk.delete("/apps",-1);
  }
  finally {
    zk.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.AsyncTest </h4><pre class="type-3 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAsync() throws IOException, InterruptedException, KeeperException {
  ZooKeeper zk=null;
  zk=createClient();
  try {
    zk.addAuthInfo("digest","ben:passwd".getBytes());
    zk.create("/ben",new byte[0],Ids.READ_ACL_UNSAFE,CreateMode.PERSISTENT,this,results);
    zk.create("/ben/2",new byte[0],Ids.CREATOR_ALL_ACL,CreateMode.PERSISTENT,this,results);
    zk.delete("/ben",-1,this,results);
    zk.create("/ben2",new byte[0],Ids.CREATOR_ALL_ACL,CreateMode.PERSISTENT,this,results);
    zk.getData("/ben2",false,this,results);
synchronized (results) {
      while (results.size() < 5) {
        results.wait();
      }
    }
    Assert.assertEquals(0,(int)results.get(0));
    Assert.assertEquals(Code.NOAUTH,Code.get(results.get(1)));
    Assert.assertEquals(0,(int)results.get(2));
    Assert.assertEquals(0,(int)results.get(3));
    Assert.assertEquals(0,(int)results.get(4));
  }
  finally {
    zk.close();
  }
  zk=createClient();
  try {
    zk.addAuthInfo("digest","ben:passwd2".getBytes());
    try {
      zk.getData("/ben2",false,new Stat());
      Assert.fail("Should have received a permission error");
    }
 catch (    KeeperException e) {
      Assert.assertEquals(Code.NOAUTH,e.code());
    }
  }
  finally {
    zk.close();
  }
  zk=createClient();
  try {
    zk.addAuthInfo("digest","ben:passwd".getBytes());
    zk.getData("/ben2",false,new Stat());
  }
  finally {
    zk.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.AtomicFileOutputStreamTest </h4><pre class="type-3 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test case where the flush() fails at close time - make sure that we clean
 * up after ourselves and don't touch any existing file at the destination
 */
@Test public void testFailToFlush() throws IOException {
  FileOutputStream fos=new FileOutputStream(dstFile);
  fos.write(TEST_STRING_2.getBytes());
  fos.close();
  OutputStream failingStream=createFailingStream();
  failingStream.write(TEST_STRING.getBytes());
  try {
    failingStream.close();
    fail("Close didn't throw exception");
  }
 catch (  IOException ioe) {
  }
  assertEquals(TEST_STRING_2,ClientBase.readFile(dstFile));
  assertEquals("Temporary file should have been cleaned up",dstFile.getName(),ClientBase.join(",",testDir.list()));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.AuthTest </h4><pre class="type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testBadAuthThenSendOtherCommands() throws Exception {
  ZooKeeper zk=createClient();
  try {
    zk.addAuthInfo("INVALID","BAR".getBytes());
    zk.exists("/foobar",false);
    zk.getData("/path1",false,null);
    Assert.fail("Should get auth state error");
  }
 catch (  KeeperException.AuthFailedException e) {
    if (!authFailed.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS)) {
      Assert.fail("Should have called my watcher");
    }
  }
 finally {
    zk.close();
  }
}

</code></pre>

<br>
<pre class="type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testBadAuthNotifiesWatch() throws Exception {
  ZooKeeper zk=createClient();
  try {
    zk.addAuthInfo("FOO","BAR".getBytes());
    zk.getData("/path1",false,null);
    Assert.fail("Should get auth state error");
  }
 catch (  KeeperException.AuthFailedException e) {
    if (!authFailed.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS)) {
      Assert.fail("Should have called my watcher");
    }
  }
 finally {
    zk.close();
  }
}

</code></pre>

<br>
<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testSuper() throws Exception {
  ZooKeeper zk=createClient();
  try {
    zk.addAuthInfo("digest","pat:pass".getBytes());
    zk.create("/path1",null,Ids.CREATOR_ALL_ACL,CreateMode.PERSISTENT);
    zk.close();
    zk=createClient();
    try {
      zk.getData("/path1",false,null);
      Assert.fail("auth verification");
    }
 catch (    KeeperException.NoAuthException e) {
    }
    zk.close();
    zk=createClient();
    zk.addAuthInfo("digest","pat:pass2".getBytes());
    try {
      zk.getData("/path1",false,null);
      Assert.fail("auth verification");
    }
 catch (    KeeperException.NoAuthException e) {
    }
    zk.close();
    zk=createClient();
    zk.addAuthInfo("digest","super:test2".getBytes());
    try {
      zk.getData("/path1",false,null);
      Assert.fail("auth verification");
    }
 catch (    KeeperException.NoAuthException e) {
    }
    zk.close();
    zk=createClient();
    zk.addAuthInfo("digest","super:test".getBytes());
    zk.getData("/path1",false,null);
  }
  finally {
    zk.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ClientTest </h4><pre class="type-10 type-3 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testACLs() throws Exception {
  ZooKeeper zk=null;
  try {
    zk=createClient();
    try {
      zk.create("/acltest",new byte[0],Ids.CREATOR_ALL_ACL,CreateMode.PERSISTENT);
      Assert.fail("Should have received an invalid acl error");
    }
 catch (    InvalidACLException e) {
      LOG.info("Test successful, invalid acl received : " + e.getMessage());
    }
    try {
      ArrayList<ACL> testACL=new ArrayList<ACL>();
      testACL.add(new ACL(Perms.ALL | Perms.ADMIN,Ids.AUTH_IDS));
      testACL.add(new ACL(Perms.ALL | Perms.ADMIN,new Id("ip","127.0.0.1/8")));
      zk.create("/acltest",new byte[0],testACL,CreateMode.PERSISTENT);
      Assert.fail("Should have received an invalid acl error");
    }
 catch (    InvalidACLException e) {
      LOG.info("Test successful, invalid acl received : " + e.getMessage());
    }
    try {
      ArrayList<ACL> testACL=new ArrayList<ACL>();
      testACL.add(new ACL(Perms.ALL | Perms.ADMIN,new Id()));
      zk.create("/nullidtest",new byte[0],testACL,CreateMode.PERSISTENT);
      Assert.fail("Should have received an invalid acl error");
    }
 catch (    InvalidACLException e) {
      LOG.info("Test successful, invalid acl received : " + e.getMessage());
    }
    zk.addAuthInfo("digest","ben:passwd".getBytes());
    ArrayList<ACL> testACL=new ArrayList<ACL>();
    testACL.add(new ACL(Perms.ALL,new Id("auth","")));
    testACL.add(new ACL(Perms.WRITE,new Id("ip","127.0.0.1")));
    zk.create("/acltest",new byte[0],testACL,CreateMode.PERSISTENT);
    zk.close();
    zk=createClient();
    zk.addAuthInfo("digest","ben:passwd2".getBytes());
    if (skipACL) {
      try {
        zk.getData("/acltest",false,null);
      }
 catch (      KeeperException e) {
        Assert.fail("Badauth reads should succeed with skipACL.");
      }
    }
 else {
      try {
        zk.getData("/acltest",false,null);
        Assert.fail("Should have received a permission error");
      }
 catch (      KeeperException e) {
        Assert.assertEquals(Code.NOAUTH,e.code());
      }
    }
    zk.addAuthInfo("digest","ben:passwd".getBytes());
    zk.getData("/acltest",false,null);
    zk.setACL("/acltest",Ids.OPEN_ACL_UNSAFE,-1);
    zk.close();
    zk=createClient();
    zk.getData("/acltest",false,null);
    List<ACL> acls=zk.getACL("/acltest",new Stat());
    Assert.assertEquals(1,acls.size());
    Assert.assertEquals(Ids.OPEN_ACL_UNSAFE,acls);
    acls=zk.getACL("/acltest",null);
    Assert.assertEquals(1,acls.size());
    Assert.assertEquals(Ids.OPEN_ACL_UNSAFE,acls);
    zk.close();
  }
  finally {
    if (zk != null) {
      zk.close();
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeleteWithChildren() throws Exception {
  ZooKeeper zk=createClient();
  zk.create("/parent",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/parent/child",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  try {
    zk.delete("/parent",-1);
    Assert.fail("Should have received a not equals message");
  }
 catch (  KeeperException e) {
    Assert.assertEquals(KeeperException.Code.NOTEMPTY,e.code());
  }
  zk.delete("/parent/child",-1);
  zk.delete("/parent",-1);
  zk.close();
}

</code></pre>

<br>
<pre class="type-10 type-3 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNullAuthId() throws Exception {
  ZooKeeper zk=null;
  try {
    zk=createClient();
    zk.addAuthInfo("digest","ben:passwd".getBytes());
    ArrayList<ACL> testACL=new ArrayList<ACL>();
    testACL.add(new ACL(Perms.ALL,new Id("auth",null)));
    zk.create("/acltest",new byte[0],testACL,CreateMode.PERSISTENT);
    zk.close();
    zk=createClient();
    zk.addAuthInfo("digest","ben:passwd2".getBytes());
    if (skipACL) {
      try {
        zk.getData("/acltest",false,null);
      }
 catch (      KeeperException e) {
        Assert.fail("Badauth reads should succeed with skipACL.");
      }
    }
 else {
      try {
        zk.getData("/acltest",false,null);
        Assert.fail("Should have received a permission error");
      }
 catch (      KeeperException e) {
        Assert.assertEquals(Code.NOAUTH,e.code());
      }
    }
    zk.addAuthInfo("digest","ben:passwd".getBytes());
    zk.getData("/acltest",false,null);
    zk.setACL("/acltest",Ids.OPEN_ACL_UNSAFE,-1);
    zk.close();
    zk=createClient();
    zk.getData("/acltest",false,null);
    List<ACL> acls=zk.getACL("/acltest",new Stat());
    Assert.assertEquals(1,acls.size());
    Assert.assertEquals(Ids.OPEN_ACL_UNSAFE,acls);
  }
  finally {
    if (zk != null) {
      zk.close();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.CnxManagerTest </h4><pre class="type-10 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSocketTimeout() throws Exception {
  QuorumPeer peer=new QuorumPeer(peers,peerTmpdir[1],peerTmpdir[1],peerClientPort[1],3,1,2000,2,2);
  QuorumCnxManager cnxManager=new QuorumCnxManager(peer);
  QuorumCnxManager.Listener listener=cnxManager.listener;
  if (listener != null) {
    listener.start();
  }
 else {
    LOG.error("Null listener when initializing cnx manager");
  }
  int port=peers.get(peer.getId()).electionAddr.getPort();
  LOG.info("Election port: " + port);
  Thread.sleep(1000);
  Socket sock=new Socket();
  sock.connect(peers.get(1L).electionAddr,5000);
  long begin=Time.currentElapsedTime();
  cnxManager.receiveConnection(sock);
  long end=Time.currentElapsedTime();
  if ((end - begin) > ((peer.getSyncLimit() * peer.getTickTime()) + 500))   Assert.fail("Waited more than necessary");
  cnxManager.halt();
  Assert.assertFalse(cnxManager.listener.isAlive());
}

</code></pre>

<br>
<pre class="type-10 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCnxManager() throws Exception {
  CnxManagerThread thread=new CnxManagerThread();
  thread.start();
  QuorumPeer peer=new QuorumPeer(peers,peerTmpdir[1],peerTmpdir[1],peerClientPort[1],3,1,1000,2,2);
  QuorumCnxManager cnxManager=new QuorumCnxManager(peer);
  QuorumCnxManager.Listener listener=cnxManager.listener;
  if (listener != null) {
    listener.start();
  }
 else {
    LOG.error("Null listener when initializing cnx manager");
  }
  cnxManager.toSend(0L,createMsg(ServerState.LOOKING.ordinal(),1,-1,1));
  Message m=null;
  int numRetries=1;
  while ((m == null) && (numRetries++ <= THRESHOLD)) {
    m=cnxManager.pollRecvQueue(3000,TimeUnit.MILLISECONDS);
    if (m == null)     cnxManager.connectAll();
  }
  Assert.assertTrue("Exceeded number of retries",numRetries <= THRESHOLD);
  thread.join(5000);
  if (thread.isAlive()) {
    Assert.fail("Thread didn't join");
  }
 else {
    if (thread.failed)     Assert.fail("Did not receive expected message");
  }
  cnxManager.halt();
  Assert.assertFalse(cnxManager.listener.isAlive());
}

</code></pre>

<br>
<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testInitialMessage() throws Exception {
  InitialMessage msg;
  ByteArrayOutputStream bos;
  DataInputStream din;
  DataOutputStream dout;
  String hostport;
  try {
    hostport="10.0.0.2:3888";
    bos=new ByteArrayOutputStream();
    dout=new DataOutputStream(bos);
    dout.writeLong(5L);
    dout.writeInt(hostport.getBytes().length);
    dout.writeBytes(hostport);
    din=new DataInputStream(new ByteArrayInputStream(bos.toByteArray()));
    msg=InitialMessage.parse(-65530L,din);
    Assert.fail("bad protocol version accepted");
  }
 catch (  InitialMessage.InitialMessageException ex) {
  }
  try {
    hostport=createLongString(1048576);
    bos=new ByteArrayOutputStream();
    dout=new DataOutputStream(bos);
    dout.writeLong(5L);
    dout.writeInt(hostport.getBytes().length);
    dout.writeBytes(hostport);
    din=new DataInputStream(new ByteArrayInputStream(bos.toByteArray()));
    msg=InitialMessage.parse(QuorumCnxManager.PROTOCOL_VERSION,din);
    Assert.fail("long message accepted");
  }
 catch (  InitialMessage.InitialMessageException ex) {
  }
  try {
    hostport="what's going on here?";
    bos=new ByteArrayOutputStream();
    dout=new DataOutputStream(bos);
    dout.writeLong(5L);
    dout.writeInt(hostport.getBytes().length);
    dout.writeBytes(hostport);
    din=new DataInputStream(new ByteArrayInputStream(bos.toByteArray()));
    msg=InitialMessage.parse(QuorumCnxManager.PROTOCOL_VERSION,din);
    Assert.fail("bad hostport accepted");
  }
 catch (  InitialMessage.InitialMessageException ex) {
  }
  try {
    hostport="10.0.0.2:3888";
    bos=new ByteArrayOutputStream();
    dout=new DataOutputStream(bos);
    dout.writeLong(5L);
    dout.writeInt(hostport.getBytes().length);
    dout.writeBytes(hostport);
    din=new DataInputStream(new ByteArrayInputStream(bos.toByteArray()));
    msg=InitialMessage.parse(QuorumCnxManager.PROTOCOL_VERSION,din);
  }
 catch (  InitialMessage.InitialMessageException ex) {
    Assert.fail(ex.toString());
  }
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests a bug in QuorumCnxManager that causes a spin lock
 * when a negative value is sent. This test checks if the
 * connection is being closed upon a message with negative
 * length.
 * @throws Exception
 */
@Test public void testCnxManagerSpinLock() throws Exception {
  QuorumPeer peer=new QuorumPeer(peers,peerTmpdir[1],peerTmpdir[1],peerClientPort[1],3,1,1000,2,2);
  QuorumCnxManager cnxManager=new QuorumCnxManager(peer);
  QuorumCnxManager.Listener listener=cnxManager.listener;
  if (listener != null) {
    listener.start();
  }
 else {
    LOG.error("Null listener when initializing cnx manager");
  }
  int port=peers.get(peer.getId()).electionAddr.getPort();
  LOG.info("Election port: " + port);
  Thread.sleep(1000);
  SocketChannel sc=SocketChannel.open();
  sc.socket().connect(peers.get(1L).electionAddr,5000);
  InetSocketAddress otherAddr=peers.get(new Long(2)).electionAddr;
  DataOutputStream dout=new DataOutputStream(sc.socket().getOutputStream());
  dout.writeLong(QuorumCnxManager.PROTOCOL_VERSION);
  dout.writeLong(new Long(2));
  String addr=otherAddr.getHostString() + ":" + otherAddr.getPort();
  byte[] addr_bytes=addr.getBytes();
  dout.writeInt(addr_bytes.length);
  dout.write(addr_bytes);
  dout.flush();
  ByteBuffer msgBuffer=ByteBuffer.wrap(new byte[4]);
  msgBuffer.putInt(-20);
  msgBuffer.position(0);
  sc.write(msgBuffer);
  Thread.sleep(1000);
  try {
    for (int i=0; i < 100; i++) {
      msgBuffer.position(0);
      sc.write(msgBuffer);
    }
    Assert.fail("Socket has not been closed");
  }
 catch (  Exception e) {
    LOG.info("Socket has been closed as expected");
  }
  peer.shutdown();
  cnxManager.halt();
  Assert.assertFalse(cnxManager.listener.isAlive());
}

</code></pre>

<br>
<pre class="type-10 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCnxManagerTimeout() throws Exception {
  Random rand=new Random();
  byte b=(byte)rand.nextInt();
  int deadPort=PortAssignment.unique();
  String deadAddress="10.1.1." + b;
  LOG.info("This is the dead address I'm trying: " + deadAddress);
  peers.put(Long.valueOf(2),new QuorumServer(2,new InetSocketAddress(deadAddress,deadPort),new InetSocketAddress(deadAddress,PortAssignment.unique()),new InetSocketAddress(deadAddress,PortAssignment.unique())));
  peerTmpdir[2]=ClientBase.createTmpDir();
  QuorumPeer peer=new QuorumPeer(peers,peerTmpdir[1],peerTmpdir[1],peerClientPort[1],3,1,1000,2,2);
  QuorumCnxManager cnxManager=new QuorumCnxManager(peer);
  QuorumCnxManager.Listener listener=cnxManager.listener;
  if (listener != null) {
    listener.start();
  }
 else {
    LOG.error("Null listener when initializing cnx manager");
  }
  long begin=Time.currentElapsedTime();
  cnxManager.toSend(2L,createMsg(ServerState.LOOKING.ordinal(),1,-1,1));
  long end=Time.currentElapsedTime();
  if ((end - begin) > 6000)   Assert.fail("Waited more than necessary");
  cnxManager.halt();
  Assert.assertFalse(cnxManager.listener.isAlive());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.CreateModeTest </h4><pre class="type-3 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInvalidFlagConversion() throws KeeperException {
  try {
    CreateMode.fromFlag(99);
    Assert.fail("Shouldn't be able to convert 99 to a CreateMode.");
  }
 catch (  KeeperException ke) {
    Assert.assertEquals(Code.BADARGUMENTS,ke.code());
  }
  try {
    CreateMode.fromFlag(-1);
    Assert.fail("Shouldn't be able to convert -1 to a CreateMode.");
  }
 catch (  KeeperException ke) {
    Assert.assertEquals(Code.BADARGUMENTS,ke.code());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.EventTypeTest </h4><pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testInvalidIntConversion(){
  try {
    EventType.fromInt(324242);
    Assert.fail("Was able to create an invalid EventType via an integer");
  }
 catch (  RuntimeException re) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.FLENewEpochTest </h4><pre class="type-9 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testLENewEpoch() throws Exception {
  LOG.info("TestLE: " + getTestName() + ", "+ count);
  for (int i=0; i < count; i++) {
    peers.put(Long.valueOf(i),new QuorumServer(i,new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",PortAssignment.unique())));
    tmpdir[i]=ClientBase.createTmpDir();
    port[i]=PortAssignment.unique();
  }
  for (int i=1; i < count; i++) {
    QuorumPeer peer=new QuorumPeer(peers,tmpdir[i],tmpdir[i],port[i],3,i,1000,2,2);
    peer.startLeaderElection();
    LEThread thread=new LEThread(peer,i);
    thread.start();
    threads.add(thread);
  }
  if (!start0.tryAcquire(4000,java.util.concurrent.TimeUnit.MILLISECONDS))   Assert.fail("First leader election failed");
  QuorumPeer peer=new QuorumPeer(peers,tmpdir[0],tmpdir[0],port[0],3,0,1000,2,2);
  peer.startLeaderElection();
  LEThread thread=new LEThread(peer,0);
  thread.start();
  threads.add(thread);
  LOG.info("Started threads " + getTestName());
  for (int i=0; i < threads.size(); i++) {
    threads.get(i).join(10000);
    if (threads.get(i).isAlive()) {
      Assert.fail("Threads didn't join");
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.FLEPredicateTest </h4><pre class="type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPredicate() throws IOException {
  peers=new HashMap<Long,QuorumServer>(3);
  for (int i=0; i < 3; i++) {
    peers.put(Long.valueOf(i),new QuorumServer(i,new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",PortAssignment.unique())));
  }
  try {
    File tmpDir=ClientBase.createTmpDir();
    QuorumPeer peer=new QuorumPeer(peers,tmpDir,tmpDir,PortAssignment.unique(),3,0,1000,2,2);
    MockFLE mock=new MockFLE(peer);
    mock.start();
    Assert.assertFalse(mock.predicate(4L,0L,0L,3L,0L,2L));
    Assert.assertTrue(mock.predicate(0L,0L,1L,1L,0L,0L));
    Assert.assertTrue(mock.predicate(0L,1L,0L,1L,0L,0L));
    Assert.assertTrue(mock.predicate(1L,1L,0L,0L,1L,0L));
  }
 catch (  IOException e) {
    LOG.error("Exception while creating quorum peer",e);
    Assert.fail("Exception while creating quorum peer");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.FLERestartTest </h4><pre class="type-9 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testLERestart() throws Exception {
  LOG.info("TestLE: " + getTestName() + ", "+ count);
  for (int i=0; i < count; i++) {
    peers.put(Long.valueOf(i),new QuorumServer(i,new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",PortAssignment.unique())));
    tmpdir[i]=ClientBase.createTmpDir();
    port[i]=PortAssignment.unique();
  }
  for (int i=0; i < count; i++) {
    QuorumPeer peer=new QuorumPeer(peers,tmpdir[i],tmpdir[i],port[i],3,i,1000,2,2);
    peer.startLeaderElection();
    FLERestartThread thread=new FLERestartThread(peer,i);
    thread.start();
    restartThreads.add(thread);
  }
  LOG.info("Started threads " + getTestName());
  for (int i=0; i < restartThreads.size(); i++) {
    restartThreads.get(i).join(10000);
    if (restartThreads.get(i).isAlive()) {
      Assert.fail("Threads didn't join");
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.FLETest </h4><pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testDoubleElection() throws Exception {
  try {
    runElection(2);
  }
 catch (  Exception e) {
    Assert.fail(e.toString());
  }
}

</code></pre>

<br>
<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testTripleElection() throws Exception {
  try {
    runElection(3);
  }
 catch (  Exception e) {
    Assert.fail(e.toString());
  }
}

</code></pre>

<br>
<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testSingleElection() throws Exception {
  try {
    runElection(1);
  }
 catch (  Exception e) {
    Assert.fail(e.toString());
  }
}

</code></pre>

<br>
<pre class="type-5 type-10 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testJoinInconsistentEnsemble() throws Exception {
  int sid;
  QuorumPeer peer;
  int waitTime=10 * 1000;
  ArrayList<QuorumPeer> peerList=new ArrayList<QuorumPeer>();
  for (sid=0; sid < 3; sid++) {
    peers.put(Long.valueOf(sid),new QuorumServer(sid,new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",PortAssignment.unique())));
    tmpdir[sid]=ClientBase.createTmpDir();
    port[sid]=PortAssignment.unique();
  }
  for (sid=0; sid < 2; sid++) {
    peer=new QuorumPeer(peers,tmpdir[sid],tmpdir[sid],port[sid],3,sid,2000,2,2);
    LOG.info("Starting peer " + peer.getId());
    peer.start();
    peerList.add(sid,peer);
  }
  peer=peerList.get(0);
  VerifyState v1=new VerifyState(peerList.get(0));
  v1.start();
  v1.join(waitTime);
  Assert.assertFalse("Unable to form cluster in " + waitTime + " ms",!v1.isSuccess());
  long leaderSid=peer.getCurrentVote().getId();
  long zxid=peer.getCurrentVote().getZxid();
  long electionEpoch=peer.getCurrentVote().getElectionEpoch();
  ServerState state=peer.getCurrentVote().getState();
  long peerEpoch=peer.getCurrentVote().getPeerEpoch();
  Vote newVote=new Vote(leaderSid,zxid + 100,electionEpoch + 100,peerEpoch,state);
  peer.setCurrentVote(newVote);
  peer=new QuorumPeer(peers,tmpdir[2],tmpdir[2],port[2],3,2,2000,2,2);
  LOG.info("Starting peer " + peer.getId());
  peer.start();
  peerList.add(sid,peer);
  v1=new VerifyState(peer);
  v1.start();
  v1.join(waitTime);
  if (v1.isAlive()) {
    Assert.fail("Peer " + peer.getId() + " failed to join the cluster "+ "within "+ waitTime+ " ms");
  }
  for (int id=0; id < 3; id++) {
    peer=peerList.get(id);
    if (peer != null) {
      peer.shutdown();
    }
  }
}

</code></pre>

<br>
<pre class="type-5 type-10 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testJoin() throws Exception {
  int sid;
  QuorumPeer peer;
  int waitTime=10 * 1000;
  ArrayList<QuorumPeer> peerList=new ArrayList<QuorumPeer>();
  for (sid=0; sid < 3; sid++) {
    port[sid]=PortAssignment.unique();
    peers.put(Long.valueOf(sid),new QuorumServer(sid,new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",port[sid])));
    tmpdir[sid]=ClientBase.createTmpDir();
  }
  for (sid=0; sid < 2; sid++) {
    peer=new QuorumPeer(peers,tmpdir[sid],tmpdir[sid],port[sid],3,sid,2000,2,2);
    LOG.info("Starting peer " + peer.getId());
    peer.start();
    peerList.add(sid,peer);
  }
  peer=peerList.get(0);
  VerifyState v1=new VerifyState(peerList.get(0));
  v1.start();
  v1.join(waitTime);
  Assert.assertFalse("Unable to form cluster in " + waitTime + " ms",!v1.isSuccess());
  peer=new QuorumPeer(peers,tmpdir[sid],tmpdir[sid],port[sid],3,sid,2000,2,2);
  LOG.info("Starting peer " + peer.getId());
  peer.start();
  peerList.add(sid,peer);
  v1=new VerifyState(peer);
  v1.start();
  v1.join(waitTime);
  if (v1.isAlive()) {
    Assert.fail("Peer " + peer.getId() + " failed to join the cluster "+ "within "+ waitTime+ " ms");
  }
 else   if (!v1.isSuccess()) {
    Assert.fail("Incorrect LEADING state for peer " + peer.getId());
  }
  for (int id=0; id < 3; id++) {
    peer=peerList.get(id);
    if (peer != null) {
      peer.shutdown();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.FLEZeroWeightTest </h4><pre class="type-9 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testZeroWeightQuorum() throws Exception {
  LOG.info("TestZeroWeightQuorum: " + getTestName() + ", "+ count);
  for (int i=0; i < count; i++) {
    InetSocketAddress addr1=new InetSocketAddress("127.0.0.1",PortAssignment.unique());
    InetSocketAddress addr2=new InetSocketAddress("127.0.0.1",PortAssignment.unique());
    InetSocketAddress addr3=new InetSocketAddress("127.0.0.1",PortAssignment.unique());
    port[i]=addr3.getPort();
    qp.setProperty("server." + i,"127.0.0.1:" + addr1.getPort() + ":"+ addr2.getPort()+ ";"+ port[i]);
    peers.put(Long.valueOf(i),new QuorumServer(i,addr1,addr2,addr3));
    tmpdir[i]=ClientBase.createTmpDir();
  }
  for (int i=0; i < count; i++) {
    QuorumHierarchical hq=new QuorumHierarchical(qp);
    QuorumPeer peer=new QuorumPeer(peers,tmpdir[i],tmpdir[i],port[i],3,i,1000,2,2,hq);
    peer.startLeaderElection();
    LEThread thread=new LEThread(peer,i);
    thread.start();
    threads.add(thread);
  }
  LOG.info("Started threads " + getTestName());
  for (int i=0; i < threads.size(); i++) {
    threads.get(i).join(15000);
    if (threads.get(i).isAlive()) {
      Assert.fail("Threads didn't join");
    }
 else {
      if (threads.get(i).fail)       Assert.fail("Elected zero-weight server");
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.FollowerResyncConcurrencyTest </h4><pre class="type-5 type-10 type-3 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify that the server is sending the proper zxid, and as a result
 * the watch doesn't fire. See ZOOKEEPER-1412.
 */
@Test public void testFollowerWatcherResync() throws Exception {
  QuorumUtil qu=new QuorumUtil(1);
  qu.startAll();
  int index=1;
  while (qu.getPeer(index).peer.follower == null) {
    index++;
  }
  LOG.info("Connecting to follower: {}",index);
  TestableZooKeeper zk1=createTestableClient("localhost:" + qu.getPeer(index).peer.getClientPort());
  zk1.create("/foo","foo".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher watcher=new MyWatcher();
  TestableZooKeeper zk2=createTestableClient(watcher,"localhost:" + qu.getPeer(index).peer.getClientPort());
  zk2.exists("/foo",true);
  watcher.reset();
  zk2.testableConnloss();
  if (!watcher.clientConnected.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS)) {
    fail("Unable to connect to server");
  }
  assertArrayEquals("foo".getBytes(),zk2.getData("/foo",false,null));
  assertNull(watcher.events.poll(5,TimeUnit.SECONDS));
  zk1.close();
  zk2.close();
  qu.shutdownAll();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.KeeperStateTest </h4><pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testInvalidIntConversion(){
  try {
    KeeperState.fromInt(324142);
    Assert.fail("Was able to create an invalid KeeperState via an integer");
  }
 catch (  RuntimeException re) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.LENonTerminateTest </h4><pre class="type-10 type-3 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This tests ZK-569.
 * With three peers A, B and C, the following could happen:
 * 1. Round 1, A,B and C all vote for themselves
 * 2. Round 2, C dies, A and B vote for C
 * 3. Because C has died, votes for it are ignored, but A and B never
 * reset their votes. Hence LE never terminates. ZK-569 fixes this by
 * resetting votes to themselves if the set of votes for live peers is null.
 */
@Test public void testNonTermination() throws Exception {
  LOG.info("TestNonTermination: " + getTestName() + ", "+ count);
  for (int i=0; i < count; i++) {
    int clientport=PortAssignment.unique();
    peers.put(Long.valueOf(i),new QuorumServer(i,new InetSocketAddress("127.0.0.1",clientport),new InetSocketAddress("127.0.0.1",PortAssignment.unique())));
    tmpdir[i]=ClientBase.createTmpDir();
    port[i]=clientport;
  }
  QuorumPeer peer1=new MockQuorumPeer(peers,tmpdir[0],tmpdir[0],port[0],0,0,2,2,2);
  peer1.startLeaderElection();
  LEThread thread1=new LEThread(peer1,0);
  QuorumPeer peer2=new MockQuorumPeer(peers,tmpdir[1],tmpdir[1],port[1],0,1,2,2,2);
  peer2.startLeaderElection();
  LEThread thread2=new LEThread(peer2,1);
  Thread thread3=new Thread(){
    public void run(){
      try {
        mockServer();
      }
 catch (      Exception e) {
        LOG.error("exception",e);
        Assert.fail("Exception when running mocked server " + e);
      }
    }
  }
;
  thread3.start();
  Assert.assertTrue("mockServer did not start in 5s",mockLatch.await(5000,TimeUnit.MILLISECONDS));
  thread1.start();
  thread2.start();
  thread1.join(15000);
  thread2.join(15000);
  thread3.join(15000);
  if (thread1.isAlive() || thread2.isAlive() || thread3.isAlive()) {
    Assert.fail("Threads didn't join");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.LETest </h4><pre class="type-9 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testLE() throws Exception {
  int count=30;
  HashMap<Long,QuorumServer> peers=new HashMap<Long,QuorumServer>(count);
  ArrayList<LEThread> threads=new ArrayList<LEThread>(count);
  File tmpdir[]=new File[count];
  int port[]=new int[count];
  votes=new Vote[count];
  for (int i=0; i < count; i++) {
    peers.put(Long.valueOf(i),new QuorumServer(i,new InetSocketAddress("127.0.0.1",PortAssignment.unique())));
    tmpdir[i]=ClientBase.createTmpDir();
    port[i]=PortAssignment.unique();
  }
  LeaderElection le[]=new LeaderElection[count];
  leaderDies=true;
  boolean allowOneBadLeader=leaderDies;
  for (int i=0; i < le.length; i++) {
    QuorumPeer peer=new QuorumPeer(peers,tmpdir[i],tmpdir[i],port[i],0,i,1000,2,2);
    peer.startLeaderElection();
    le[i]=new LeaderElection(peer);
    LEThread thread=new LEThread(le[i],peer,i);
    thread.start();
    threads.add(thread);
  }
  for (int i=0; i < threads.size(); i++) {
    threads.get(i).join(15000);
    if (threads.get(i).isAlive()) {
      Assert.fail("Threads didn't join");
    }
  }
  long id=votes[0].getId();
  for (int i=1; i < votes.length; i++) {
    if (votes[i] == null) {
      Assert.fail("Thread " + i + " had a null vote");
    }
    if (votes[i].getId() != id) {
      if (allowOneBadLeader && votes[i].getId() == i) {
        allowOneBadLeader=false;
      }
 else {
        Assert.fail("Thread " + i + " got "+ votes[i].getId()+ " expected "+ id);
      }
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.LoadFromLogTest </h4><pre class="type-3 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify snap/log dir create with/without autocreate enabled.
 */
@Test public void testDatadirAutocreate() throws Exception {
  ClientBase.setupTestEnv();
  File tmpDir=ClientBase.createTmpDir();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  final int PORT=Integer.parseInt(HOSTPORT.split(":")[1]);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  zks.shutdown();
  f.shutdown();
  Assert.assertTrue("waiting for server being down ",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
  try {
    System.setProperty(FileTxnSnapLog.ZOOKEEPER_DATADIR_AUTOCREATE,"false");
    tmpDir=ClientBase.createTmpDir();
    zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
    f=ServerCnxnFactory.createFactory(PORT,-1);
    f.startup(zks);
    Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
    Assert.fail("Server should not have started without datadir");
  }
 catch (  IOException e) {
    LOG.info("Server failed to start - correct behavior " + e);
  }
 finally {
    System.setProperty(FileTxnSnapLog.ZOOKEEPER_DATADIR_AUTOCREATE,FileTxnSnapLog.ZOOKEEPER_DATADIR_AUTOCREATE_DEFAULT);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.MultiTransactionTest </h4><pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testInvalidVersion() throws Exception {
  try {
    multi(zk,Arrays.asList(Op.create("/multi",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT),Op.delete("/multi",1)));
    Assert.fail("delete /multi should have failed");
  }
 catch (  KeeperException e) {
  }
}

</code></pre>

<br>
<pre class="type-3 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpdateConflict() throws Exception {
  Assert.assertNull(zk.exists("/multi",null));
  try {
    multi(zk,Arrays.asList(Op.create("/multi",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT),Op.setData("/multi","X".getBytes(),0),Op.setData("/multi","Y".getBytes(),0)));
    Assert.fail("Should have thrown a KeeperException for invalid version");
  }
 catch (  KeeperException e) {
    LOG.error("STACKTRACE: ",e);
  }
  Assert.assertNull(zk.exists("/multi",null));
  multi(zk,Arrays.asList(Op.create("/multi",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT),Op.setData("/multi","X".getBytes(),0),Op.setData("/multi","Y".getBytes(),1)));
  Assert.assertArrayEquals(zk.getData("/multi",false,null),"Y".getBytes());
}

</code></pre>

<br>
<pre class="type-3 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNoWatchesTriggeredForFailedMultiRequest() throws InterruptedException, KeeperException {
  HasTriggeredWatcher watcher=new HasTriggeredWatcher();
  zk.getChildren("/",watcher);
  try {
    multi(zk,Arrays.asList(Op.create("/t",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT),Op.delete("/nonexisting",-1)));
    fail("expected previous multi op to fail!");
  }
 catch (  KeeperException.NoNodeException e) {
  }
  SyncCallback cb=new SyncCallback();
  zk.sync("/",cb,null);
  cb.done.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS);
  assertEquals(1,watcher.triggered.getCount());
}

</code></pre>

<br>
<pre class="type-3 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeleteUpdateConflict() throws Exception {
  try {
    multi(zk,Arrays.asList(Op.create("/multi",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT),Op.delete("/multi",0),Op.setData("/multi","Y".getBytes(),0)));
    Assert.fail("/multi should have been deleted so setData should have failed");
  }
 catch (  KeeperException e) {
  }
  Assert.assertNull(zk.exists("/multi",null));
}

</code></pre>

<br>
<pre class="type-10 type-3 type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetResults() throws Exception {
  Iterable<Op> ops=Arrays.asList(Op.create("/multi",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT),Op.delete("/multi",0),Op.setData("/multi","Y".getBytes(),0),Op.create("/foo",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT));
  List<OpResult> results=null;
  if (useAsync) {
    final MultiResult res=new MultiResult();
    zk.multi(ops,new MultiCallback(){
      @Override public void processResult(      int rc,      String path,      Object ctx,      List<OpResult> opResults){
synchronized (res) {
          res.rc=rc;
          res.results=opResults;
          res.finished=true;
          res.notifyAll();
        }
      }
    }
,null);
synchronized (res) {
      while (!res.finished) {
        res.wait();
      }
    }
    Assert.assertFalse("/multi should have been deleted so setData should have failed",KeeperException.Code.OK.intValue() == res.rc);
    Assert.assertNull(zk.exists("/multi",null));
    results=res.results;
  }
 else {
    try {
      zk.multi(ops);
      Assert.fail("/multi should have been deleted so setData should have failed");
    }
 catch (    KeeperException e) {
      Assert.assertNull(zk.exists("/multi",null));
      results=e.getResults();
    }
  }
  Assert.assertNotNull(results);
  for (  OpResult r : results) {
    LOG.info("RESULT==> {}",r);
    if (r instanceof ErrorResult) {
      ErrorResult er=(ErrorResult)r;
      LOG.info("ERROR RESULT: {} ERR=>{}",er,KeeperException.Code.get(er.getErr()));
    }
  }
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTransactionBuilder() throws Exception {
  List<OpResult> results=commit(zk.transaction().create("/t1",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT).create("/t1/child",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT).create("/t2",null,Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL));
  assertEquals(3,results.size());
  for (  OpResult r : results) {
    CreateResult c=(CreateResult)r;
    assertTrue(c.getPath().startsWith("/t"));
    assertNotNull(c.toString());
  }
  assertNotNull(zk.exists("/t1",false));
  assertNotNull(zk.exists("/t1/child",false));
  assertNotNull(zk.exists("/t2",false));
  results=commit(zk.transaction().check("/t1",0).check("/t1/child",0).check("/t2",0));
  assertEquals(3,results.size());
  for (  OpResult r : results) {
    CheckResult c=(CheckResult)r;
    assertNotNull(c.toString());
  }
  try {
    results=commit(zk.transaction().check("/t1",0).check("/t1/child",0).check("/t2",1));
    fail();
  }
 catch (  KeeperException.BadVersionException e) {
  }
  results=commit(zk.transaction().check("/t1",0).setData("/t1",new byte[0],0));
  assertEquals(2,results.size());
  for (  OpResult r : results) {
    assertNotNull(r.toString());
  }
  try {
    results=commit(zk.transaction().check("/t1",1).setData("/t1",new byte[0],2));
    fail();
  }
 catch (  KeeperException.BadVersionException e) {
  }
  results=commit(zk.transaction().check("/t1",1).check("/t1/child",0).check("/t2",0));
  assertEquals(3,results.size());
  results=commit(zk.transaction().delete("/t2",-1).delete("/t1/child",-1));
  assertEquals(2,results.size());
  for (  OpResult r : results) {
    DeleteResult d=(DeleteResult)r;
    assertNotNull(d.toString());
  }
  assertNotNull(zk.exists("/t1",false));
  assertNull(zk.exists("/t1/child",false));
  assertNull(zk.exists("/t2",false));
}

</code></pre>

<br>
<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * ZOOKEEPER-2052:
 * Multi abort shouldn't have any side effect.
 * We fix a bug in rollback and the following scenario should work:
 * 1. multi delete abort because of not empty directory
 * 2. ephemeral nodes under that directory are deleted
 * 3. multi delete should succeed.
 */
@Test public void testMultiRollback() throws Exception {
  zk.create("/foo",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  ZooKeeper epheZk=createClient();
  epheZk.create("/foo/bar",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  List<Op> opList=Arrays.asList(Op.delete("/foo",-1));
  try {
    zk.multi(opList);
    Assert.fail("multi delete should failed for not empty directory");
  }
 catch (  KeeperException.NotEmptyException e) {
  }
  final CountDownLatch latch=new CountDownLatch(1);
  zk.exists("/foo/bar",new Watcher(){
    @Override public void process(    WatchedEvent event){
      if (event.getType() == Event.EventType.NodeDeleted) {
        latch.countDown();
      }
    }
  }
);
  epheZk.close();
  latch.await();
  try {
    zk.getData("/foo/bar",false,null);
    Assert.fail("ephemeral node should have been deleted");
  }
 catch (  KeeperException.NoNodeException e) {
  }
  zk.multi(opList);
  try {
    zk.getData("/foo",false,null);
    Assert.fail("persistent node should have been deleted after multi");
  }
 catch (  KeeperException.NoNodeException e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.QuorumTest </h4><pre class="type-3 type-2 type-1 type-17 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
- Is not executed with the test suite
"></span><br>
/** 
 * Connect to two different servers with two different handles using the same session and
 * make sure we cannot do any changes.
 */
@Test @Ignore public void testSessionMove() throws Exception {
  String hps[]=qb.hostPort.split(",");
  DiscoWatcher oldWatcher=new DiscoWatcher();
  DisconnectableZooKeeper zk=new DisconnectableZooKeeper(hps[0],ClientBase.CONNECTION_TIMEOUT,oldWatcher);
  zk.create("/t1",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  zk.dontReconnect();
  DiscoWatcher watcher=new DiscoWatcher();
  DisconnectableZooKeeper zknew=new DisconnectableZooKeeper(hps[1],ClientBase.CONNECTION_TIMEOUT,watcher,zk.getSessionId(),zk.getSessionPasswd());
  zknew.create("/t2",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  try {
    zk.create("/t3",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
    Assert.fail("Should have lost the connection");
  }
 catch (  KeeperException.ConnectionLossException e) {
    for (int i=0; i < 30; i++) {
      if (oldWatcher.zkDisco) {
        break;
      }
      Thread.sleep(1000);
    }
    Assert.assertTrue(oldWatcher.zkDisco);
  }
  ArrayList<ZooKeeper> toClose=new ArrayList<ZooKeeper>();
  toClose.add(zknew);
  for (int i=0; i < 10; i++) {
    zknew.dontReconnect();
    zknew=new DisconnectableZooKeeper(hps[1],ClientBase.CONNECTION_TIMEOUT,new DiscoWatcher(),zk.getSessionId(),zk.getSessionPasswd());
    toClose.add(zknew);
    zknew.create("/t-" + i,new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  }
  for (  ZooKeeper z : toClose) {
    z.close();
  }
  zk.close();
}

</code></pre>

<br>
<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * See ZOOKEEPER-790 for details 
 */
@Test public void testFollowersStartAfterLeader() throws Exception {
  qu=new QuorumUtil(1);
  CountdownWatcher watcher=new CountdownWatcher();
  qu.startQuorum();
  int index=1;
  while (qu.getPeer(index).peer.leader == null)   index++;
  qu.shutdown(index);
  qu.start(index);
  ZooKeeper zk=new ZooKeeper("127.0.0.1:" + qu.getPeer((index == 1) ? 2 : 1).peer.getClientPort(),ClientBase.CONNECTION_TIMEOUT,watcher);
  try {
    watcher.waitForConnected(CONNECTION_TIMEOUT);
  }
 catch (  TimeoutException e) {
    Assert.fail("client could not connect to reestablished quorum: giving up after 30+ seconds.");
  }
  zk.close();
}

</code></pre>

<br>
<pre class="type-9 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Make sure that we can change sessions
 * from follower to leader.
 * @throws IOException
 * @throws InterruptedException
 * @throws KeeperException
 */
@Test public void testSessionMoved() throws Exception {
  String hostPorts[]=qb.hostPort.split(",");
  DisconnectableZooKeeper zk=new DisconnectableZooKeeper(hostPorts[0],ClientBase.CONNECTION_TIMEOUT,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  zk.create("/sessionMoveTest",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  for (int i=0; i < hostPorts.length * 2; i++) {
    zk.dontReconnect();
    DisconnectableZooKeeper zknew=new DisconnectableZooKeeper(hostPorts[(i + 1) % hostPorts.length],ClientBase.CONNECTION_TIMEOUT,new Watcher(){
      public void process(      WatchedEvent event){
      }
    }
,zk.getSessionId(),zk.getSessionPasswd());
    zknew.setData("/",new byte[1],-1);
    final int result[]=new int[1];
    result[0]=Integer.MAX_VALUE;
    zknew.sync("/",new AsyncCallback.VoidCallback(){
      public void processResult(      int rc,      String path,      Object ctx){
synchronized (result) {
          result[0]=rc;
          result.notify();
        }
      }
    }
,null);
synchronized (result) {
      if (result[0] == Integer.MAX_VALUE) {
        result.wait(5000);
      }
    }
    LOG.info(hostPorts[(i + 1) % hostPorts.length] + " Sync returned " + result[0]);
    Assert.assertTrue(result[0] == KeeperException.Code.OK.intValue());
    try {
      zk.setData("/",new byte[1],-1);
      Assert.fail("Should have lost the connection");
    }
 catch (    KeeperException.ConnectionLossException e) {
    }
    zk=zknew;
  }
  zk.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.QuorumUtilTest </h4><pre class="type-10 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * <p>
 * This test ensures that all JXM beans associated to a {@link QuorumPeer}are unregistered when shuted down ({@link QuorumUtil#shutdown(int)}). It
 * allows a successfull restarting of several zookeeper servers ({@link QuorumPeer}) running on the same JVM.
 * <p>
 * See ZOOKEEPER-1214 for details.
 */
@Test public void validateAllMXBeanAreUnregistered() throws IOException {
  QuorumUtil qU=new QuorumUtil(1);
  LOG.info(">-->> Starting up all servers...");
  qU.startAll();
  LOG.info(">-->> Servers up and running...");
  int leaderIndex=qU.getLeaderServer();
  int firstFollowerIndex=0;
  int secondFollowerIndex=0;
switch (leaderIndex) {
case 1:
    firstFollowerIndex=2;
  secondFollowerIndex=3;
break;
case 2:
firstFollowerIndex=1;
secondFollowerIndex=3;
break;
case 3:
firstFollowerIndex=1;
secondFollowerIndex=2;
break;
default :
Assert.fail("Unexpected leaderIndex value: " + leaderIndex);
break;
}
LOG.info(">-->> Shuting down server [{}]",firstFollowerIndex);
qU.shutdown(firstFollowerIndex);
LOG.info(">-->> Shuting down server [{}]",secondFollowerIndex);
qU.shutdown(secondFollowerIndex);
LOG.info(">-->> Restarting server [{}]",firstFollowerIndex);
qU.restart(firstFollowerIndex);
LOG.info(">-->> Restarting server [{}]",secondFollowerIndex);
qU.restart(secondFollowerIndex);
qU.shutdownAll();
Set<ZKMBeanInfo> pending=MBeanRegistry.getInstance().getRegisteredBeans();
Assert.assertTrue("The following beans should have been unregistered: " + pending,pending.isEmpty());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ReadOnlyModeTest </h4><pre class="type-3 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test write operations using multi request.
 */
@Test(timeout=90000) public void testMultiTransaction() throws Exception {
  CountdownWatcher watcher=new CountdownWatcher();
  ZooKeeper zk=new ZooKeeper(qu.getConnString(),CONNECTION_TIMEOUT,watcher,true);
  watcher.waitForConnected(CONNECTION_TIMEOUT);
  final String data="Data to be read in RO mode";
  final String node1="/tnode1";
  final String node2="/tnode2";
  zk.create(node1,data.getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  watcher.reset();
  qu.shutdown(2);
  watcher.waitForConnected(CONNECTION_TIMEOUT);
  Assert.assertEquals("Should be in r-o mode",States.CONNECTEDREADONLY,zk.getState());
  String remoteData=new String(zk.getData(node1,false,null));
  Assert.assertEquals("Failed to read data in r-o mode",data,remoteData);
  try {
    Transaction transaction=zk.transaction();
    transaction.setData(node1,"no way".getBytes(),-1);
    transaction.create(node2,data.getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    transaction.commit();
    Assert.fail("Write operation using multi-transaction" + " api has succeeded during RO mode");
  }
 catch (  NotReadOnlyException e) {
  }
  Assert.assertNull("Should have created the znode:" + node2,zk.exists(node2,false));
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Basic test of read-only client functionality. Tries to read and write
 * during read-only mode, then regains a quorum and tries to write again.
 */
@Test(timeout=90000) public void testReadOnlyClient() throws Exception {
  CountdownWatcher watcher=new CountdownWatcher();
  ZooKeeper zk=new ZooKeeper(qu.getConnString(),CONNECTION_TIMEOUT,watcher,true);
  watcher.waitForConnected(CONNECTION_TIMEOUT);
  final String data="Data to be read in RO mode";
  final String node="/tnode";
  zk.create(node,data.getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  watcher.reset();
  qu.shutdown(2);
  zk.close();
  zk=new ZooKeeper(qu.getConnString(),CONNECTION_TIMEOUT,watcher,true);
  watcher.waitForConnected(CONNECTION_TIMEOUT);
  String remoteData=new String(zk.getData(node,false,null));
  Assert.assertEquals(data,remoteData);
  try {
    zk.setData(node,"no way".getBytes(),-1);
    Assert.fail("Write operation has succeeded during RO mode");
  }
 catch (  NotReadOnlyException e) {
  }
  watcher.reset();
  qu.start(2);
  Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + qu.getPeer(2).clientPort,CONNECTION_TIMEOUT));
  zk.close();
  watcher.reset();
  zk=new ZooKeeper(qu.getConnString(),CONNECTION_TIMEOUT,watcher,true);
  watcher.waitForConnected(CONNECTION_TIMEOUT);
  zk.setData(node,"We're in the quorum now".getBytes(),-1);
  zk.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ReconfigTest </h4><pre class="type-5 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * 1. removes and adds back two servers (incl leader). One of the servers is added back as observer
 * 2. tests that reconfig fails if quorum of new config is not up
 * 3. tests that a server that's not up during reconfig learns the new config when it comes up
 * @throws Exception
 */
@Test public void testRemoveAddTwo() throws Exception {
  qu=new QuorumUtil(2);
  qu.disableJMXTest=true;
  qu.startAll();
  ZooKeeper[] zkArr=createHandles(qu);
  List<String> leavingServers=new ArrayList<String>();
  List<String> joiningServers=new ArrayList<String>();
  int leaderIndex=getLeaderId(qu);
  int leavingIndex1=leaderIndex;
  int leavingIndex2=(leaderIndex == 1) ? 2 : 1;
  int stayingIndex1=1, stayingIndex2=1, stayingIndex3=1;
  while (stayingIndex1 == leavingIndex1 || stayingIndex1 == leavingIndex2)   stayingIndex1++;
  while (stayingIndex2 == leavingIndex1 || stayingIndex2 == leavingIndex2 || stayingIndex2 == stayingIndex1)   stayingIndex2++;
  while (stayingIndex3 == leavingIndex1 || stayingIndex3 == leavingIndex2 || stayingIndex3 == stayingIndex1 || stayingIndex3 == stayingIndex2)   stayingIndex3++;
  leavingServers.add(Integer.toString(leavingIndex1));
  leavingServers.add(Integer.toString(leavingIndex2));
  joiningServers.add("server." + leavingIndex1 + "=localhost:"+ qu.getPeer(leavingIndex1).peer.getQuorumAddress().getPort()+ ":"+ qu.getPeer(leavingIndex1).peer.getElectionAddress().getPort()+ ":participant;localhost:"+ qu.getPeer(leavingIndex1).peer.getClientPort());
  joiningServers.add("server." + leavingIndex2 + "=localhost:"+ qu.getPeer(leavingIndex2).peer.getQuorumAddress().getPort()+ ":"+ qu.getPeer(leavingIndex2).peer.getElectionAddress().getPort()+ ":observer;localhost:"+ qu.getPeer(leavingIndex2).peer.getClientPort());
  qu.shutdown(leavingIndex1);
  qu.shutdown(leavingIndex2);
  reconfig(zkArr[stayingIndex2],null,leavingServers,null,-1);
  qu.shutdown(stayingIndex2);
  testServerHasConfig(zkArr[stayingIndex1],null,leavingServers);
  testServerHasConfig(zkArr[stayingIndex3],null,leavingServers);
  testNormalOperation(zkArr[stayingIndex1],zkArr[stayingIndex3]);
  Thread.sleep(10000);
  try {
    reconfig(zkArr[stayingIndex1],joiningServers,null,null,-1);
    Assert.fail("reconfig completed successfully even though there is no quorum up in new config!");
  }
 catch (  KeeperException.NewConfigNoQuorum e) {
  }
  qu.restart(stayingIndex2);
  reconfig(zkArr[stayingIndex1],joiningServers,null,null,-1);
  testNormalOperation(zkArr[stayingIndex2],zkArr[stayingIndex3]);
  testServerHasConfig(zkArr[stayingIndex2],joiningServers,null);
  qu.restart(leavingIndex2);
  Assert.assertTrue(qu.getPeer(leavingIndex2).peer.getPeerState() == ServerState.OBSERVING);
  testNormalOperation(zkArr[stayingIndex2],zkArr[leavingIndex2]);
  testServerHasConfig(zkArr[leavingIndex2],joiningServers,null);
  closeAllHandles(zkArr);
}

</code></pre>

<br>
<pre class="type-9 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testRemoveAddOne() throws Exception {
  qu=new QuorumUtil(1);
  qu.disableJMXTest=true;
  qu.startAll();
  ZooKeeper[] zkArr=createHandles(qu);
  List<String> leavingServers=new ArrayList<String>();
  List<String> joiningServers=new ArrayList<String>();
  int leaderIndex=getLeaderId(qu);
  int leavingIndex=(leaderIndex == 1) ? 2 : 1;
  for (int i=0; i < 2; i++) {
    ZooKeeper zk1=(leavingIndex == leaderIndex) ? zkArr[leaderIndex] : zkArr[(leaderIndex % qu.ALL) + 1];
    ZooKeeper zk2=(leavingIndex == leaderIndex) ? zkArr[(leaderIndex % qu.ALL) + 1] : zkArr[leaderIndex];
    leavingServers.add(Integer.toString(leavingIndex));
    joiningServers.add("server." + leavingIndex + "=localhost:"+ qu.getPeer(leavingIndex).peer.getQuorumAddress().getPort()+ ":"+ qu.getPeer(leavingIndex).peer.getElectionAddress().getPort()+ ":participant;localhost:"+ qu.getPeer(leavingIndex).peer.getClientPort());
    String configStr=reconfig(zk1,null,leavingServers,null,-1);
    testServerHasConfig(zk2,null,leavingServers);
    testNormalOperation(zk2,zk1);
    QuorumVerifier qv=qu.getPeer(1).peer.configFromString(configStr);
    long version=qv.getVersion();
    try {
      reconfig(zk2,joiningServers,null,null,version + 1);
      Assert.fail("reconfig succeeded even though version condition was incorrect!");
    }
 catch (    KeeperException.BadVersionException e) {
    }
    reconfig(zk2,joiningServers,null,null,version);
    testNormalOperation(zk1,zk2);
    testServerHasConfig(zk1,joiningServers,null);
    leavingIndex=leaderIndex=getLeaderId(qu);
    leavingServers.clear();
    joiningServers.clear();
  }
  closeAllHandles(zkArr);
}

</code></pre>

<br>
<pre class="type-9 type-5 type-3 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPortChange() throws Exception {
  qu=new QuorumUtil(1);
  qu.disableJMXTest=true;
  qu.startAll();
  ZooKeeper[] zkArr=createHandles(qu);
  List<String> joiningServers=new ArrayList<String>();
  int leaderIndex=getLeaderId(qu);
  int followerIndex=leaderIndex == 1 ? 2 : 1;
  int quorumPort=qu.getPeer(followerIndex).peer.getQuorumAddress().getPort();
  int electionPort=qu.getPeer(followerIndex).peer.getElectionAddress().getPort();
  int oldClientPort=qu.getPeer(followerIndex).peer.getClientPort();
  int newClientPort=PortAssignment.unique();
  joiningServers.add("server." + followerIndex + "=localhost:"+ quorumPort+ ":"+ electionPort+ ":participant;localhost:"+ newClientPort);
  testNormalOperation(zkArr[followerIndex],zkArr[leaderIndex]);
  reconfig(zkArr[followerIndex],joiningServers,null,null,-1);
  try {
    for (int i=0; i < 20; i++) {
      Thread.sleep(1000);
      zkArr[followerIndex].setData("/test","teststr".getBytes(),-1);
    }
  }
 catch (  KeeperException.ConnectionLossException e) {
    Assert.fail("Existing client disconnected when client port changed!");
  }
  zkArr[followerIndex].close();
  zkArr[followerIndex]=new ZooKeeper("127.0.0.1:" + oldClientPort,ClientBase.CONNECTION_TIMEOUT,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  for (int i=0; i < 10; i++) {
    try {
      Thread.sleep(1000);
      zkArr[followerIndex].setData("/test","teststr".getBytes(),-1);
      Assert.fail("New client connected to old client port!");
    }
 catch (    KeeperException.ConnectionLossException e) {
    }
  }
  zkArr[followerIndex].close();
  zkArr[followerIndex]=new ZooKeeper("127.0.0.1:" + newClientPort,ClientBase.CONNECTION_TIMEOUT,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  testNormalOperation(zkArr[followerIndex],zkArr[leaderIndex]);
  testServerHasConfig(zkArr[followerIndex],joiningServers,null);
  Assert.assertEquals(newClientPort,qu.getPeer(followerIndex).peer.getClientPort());
  joiningServers.clear();
  int newQuorumPort=PortAssignment.unique();
  joiningServers.add("server." + leaderIndex + "=localhost:"+ newQuorumPort+ ":"+ qu.getPeer(leaderIndex).peer.getElectionAddress().getPort()+ ":participant;localhost:"+ qu.getPeer(leaderIndex).peer.getClientPort());
  reconfig(zkArr[leaderIndex],joiningServers,null,null,-1);
  testNormalOperation(zkArr[followerIndex],zkArr[leaderIndex]);
  Assert.assertTrue(qu.getPeer(leaderIndex).peer.getQuorumAddress().getPort() == newQuorumPort);
  Assert.assertTrue(getLeaderId(qu) != leaderIndex);
  joiningServers.clear();
  for (int i=1; i <= 3; i++) {
    joiningServers.add("server." + i + "=localhost:"+ qu.getPeer(i).peer.getQuorumAddress().getPort()+ ":"+ PortAssignment.unique()+ ":participant;localhost:"+ qu.getPeer(i).peer.getClientPort());
  }
  reconfig(zkArr[1],joiningServers,null,null,-1);
  leaderIndex=getLeaderId(qu);
  int follower1=leaderIndex == 1 ? 2 : 1;
  int follower2=1;
  while (follower2 == leaderIndex || follower2 == follower1)   follower2++;
  qu.shutdown(getLeaderId(qu));
  testNormalOperation(zkArr[follower2],zkArr[follower1]);
  testServerHasConfig(zkArr[follower1],joiningServers,null);
  testServerHasConfig(zkArr[follower2],joiningServers,null);
  closeAllHandles(zkArr);
}

</code></pre>

<br>
<pre class="type-9 type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testQuorumSystemChange() throws Exception {
  qu=new QuorumUtil(3);
  qu.disableJMXTest=true;
  qu.startAll();
  ZooKeeper[] zkArr=createHandles(qu);
  ArrayList<String> members=new ArrayList<String>();
  members.add("group.1=3:4:5");
  members.add("group.2=1:2");
  members.add("weight.1=0");
  members.add("weight.2=0");
  members.add("weight.3=1");
  members.add("weight.4=1");
  members.add("weight.5=1");
  for (int i=1; i <= 5; i++) {
    members.add("server." + i + "=127.0.0.1:"+ qu.getPeer(i).peer.getQuorumAddress().getPort()+ ":"+ qu.getPeer(i).peer.getElectionAddress().getPort()+ ";"+ "127.0.0.1:"+ qu.getPeer(i).peer.getClientPort());
  }
  reconfig(zkArr[1],null,null,members,-1);
  testNormalOperation(zkArr[2],zkArr[3]);
  testNormalOperation(zkArr[4],zkArr[5]);
  for (int i=1; i <= 5; i++) {
    if (!(qu.getPeer(i).peer.quorumVerifier instanceof QuorumHierarchical))     Assert.fail("peer " + i + " doesn't think the quorum system is Hieararchical!");
  }
  qu.shutdown(1);
  qu.shutdown(2);
  qu.shutdown(3);
  qu.shutdown(7);
  qu.shutdown(6);
  testNormalOperation(zkArr[4],zkArr[5]);
  qu.restart(1);
  qu.restart(2);
  members.clear();
  for (int i=1; i <= 3; i++) {
    members.add("server." + i + "=127.0.0.1:"+ qu.getPeer(i).peer.getQuorumAddress().getPort()+ ":"+ qu.getPeer(i).peer.getElectionAddress().getPort()+ ";"+ "127.0.0.1:"+ qu.getPeer(i).peer.getClientPort());
  }
  reconfig(zkArr[1],null,null,members,-1);
  testNormalOperation(zkArr[1],zkArr[2]);
  qu.shutdown(4);
  qu.shutdown(5);
  testNormalOperation(zkArr[1],zkArr[2]);
  for (int i=1; i <= 2; i++) {
    if (!(qu.getPeer(i).peer.quorumVerifier instanceof QuorumMaj))     Assert.fail("peer " + i + " doesn't think the quorum system is a majority quorum system!");
  }
  closeAllHandles(zkArr);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.SSLTest </h4><pre class="type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Developers might use standalone mode (which is the default for one server).
 * This test checks SSL works in standalone mode of ZK server.
 * <p/>
 * Note that in this test the Zk server has only secureClientPort
 */
@Test public void testSecureStandaloneServer() throws Exception {
  Integer secureClientPort=PortAssignment.unique();
  MainThread mt=new MainThread(MainThread.UNSET_MYID,"",secureClientPort,false);
  mt.start();
  final CountDownLatch latch=new CountDownLatch(1);
  ZooKeeper zk=new ZooKeeper("127.0.0.1:" + secureClientPort,TIMEOUT,new Watcher(){
    @Override public void process(    WatchedEvent event){
      if (event.getState() != Event.KeeperState.SyncConnected) {
        Assert.fail("failed to connect to ZK server secure client port");
      }
      latch.countDown();
    }
  }
);
  if (!latch.await(TIMEOUT,TimeUnit.MILLISECONDS)) {
    Assert.fail("Timeout connecting to ZK server secure port");
  }
  zk.create("/test","".getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.delete("/test",-1);
  zk.close();
  mt.shutdown();
}

</code></pre>

<br>
<pre class="type-9 type-10 type-3 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test checks that SSL works in cluster setup of ZK servers, which includes:
 * 1. setting "secureClientPort" in "zoo.cfg" file.
 * 2. setting jvm flags for serverCnxn, keystore, truststore.
 * Finally, a zookeeper client should be able to connect to the secure port and
 * communicate with server via secure connection.
 * <p/>
 * Note that in this test a ZK server has two ports -- clientPort and secureClientPort.
 */
@Test public void testSecureQuorumServer() throws Exception {
  final int SERVER_COUNT=3;
  final int clientPorts[]=new int[SERVER_COUNT];
  final Integer secureClientPorts[]=new Integer[SERVER_COUNT];
  StringBuilder sb=new StringBuilder();
  for (int i=0; i < SERVER_COUNT; i++) {
    clientPorts[i]=PortAssignment.unique();
    secureClientPorts[i]=PortAssignment.unique();
    String server=String.format("server.%d=localhost:%d:%d:participant;localhost:%d",i,PortAssignment.unique(),PortAssignment.unique(),clientPorts[i]);
    sb.append(server + "\n");
  }
  String quorumCfg=sb.toString();
  MainThread[] mt=new MainThread[SERVER_COUNT];
  for (int i=0; i < SERVER_COUNT; i++) {
    mt[i]=new MainThread(i,quorumCfg,secureClientPorts[i],true);
    mt[i].start();
  }
  for (int i=0; i < SERVER_COUNT; i++) {
    Assert.assertTrue("waiting for server " + i + " being up",ClientBase.waitForServerUp("127.0.0.1:" + clientPorts[i],TIMEOUT));
    final CountDownLatch latch=new CountDownLatch(1);
    ZooKeeper zk=new ZooKeeper("127.0.0.1:" + secureClientPorts[i],TIMEOUT,new Watcher(){
      @Override public void process(      WatchedEvent event){
        if (event.getState() != Event.KeeperState.SyncConnected) {
          Assert.fail("failed to connect to ZK server secure client port");
        }
        latch.countDown();
      }
    }
);
    if (!latch.await(TIMEOUT,TimeUnit.MILLISECONDS)) {
      Assert.fail("Timeout connecting to ZK server secure port");
    }
    zk.create("/test","".getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    zk.delete("/test",-1);
    zk.close();
  }
  for (int i=0; i < mt.length; i++) {
    mt[i].shutdown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.SaslAuthDesignatedClientTest </h4><pre class="type-3 type-2 type-6 type-15 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSaslConfig() throws Exception {
  ZooKeeper zk=createClient();
  try {
    zk.getChildren("/",false);
    Assert.assertFalse(zk.getSaslClient().clientTunneledAuthenticationInProgress());
    Assert.assertEquals(zk.getSaslClient().getSaslState(),ZooKeeperSaslClient.SaslState.COMPLETE);
    Assert.assertNotNull(javax.security.auth.login.Configuration.getConfiguration().getAppConfigurationEntry("MyZookeeperClient"));
    Assert.assertSame(zk.getSaslClient().getLoginContext(),"MyZookeeperClient");
  }
 catch (  KeeperException e) {
    Assert.fail("test failed :" + e);
  }
 finally {
    zk.close();
  }
}

</code></pre>

<br>
<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testAuth() throws Exception {
  ZooKeeper zk=createClient();
  try {
    zk.create("/path1",null,Ids.CREATOR_ALL_ACL,CreateMode.PERSISTENT);
    Thread.sleep(1000);
  }
 catch (  KeeperException e) {
    Assert.fail("test failed :" + e);
  }
 finally {
    zk.close();
  }
}

</code></pre>

<br>
<pre class="type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReadAccessUser() throws Exception {
  System.setProperty("zookeeper.letAnySaslUserDoX","anyone");
  ZooKeeper zk=createClient();
  List<ACL> aclList=new ArrayList<ACL>();
  ACL acl=new ACL(Perms.ADMIN | Perms.CREATE | Perms.WRITE| Perms.DELETE,new Id("sasl","fakeuser"));
  ACL acl1=new ACL(Perms.READ,new Id("sasl","anyone"));
  aclList.add(acl);
  aclList.add(acl1);
  try {
    zk.create("/abc","testData".getBytes(),aclList,CreateMode.PERSISTENT);
  }
 catch (  KeeperException e) {
    Assert.fail("Unable to create znode");
  }
  zk.close();
  Thread.sleep(100);
  zk=createClient();
  try {
    zk.setData("/abc","testData1".getBytes(),-1);
    Assert.fail("Should not be able to set data");
  }
 catch (  KeeperException.NoAuthException e) {
  }
  try {
    byte[] bytedata=zk.getData("/abc",null,null);
    String data=new String(bytedata);
    Assert.assertTrue("testData".equals(data));
  }
 catch (  KeeperException e) {
    Assert.fail("failed to get data");
  }
  zk.close();
  Thread.sleep(100);
  System.setProperty(ZooKeeperSaslClient.ENABLE_CLIENT_SASL_KEY,"false");
  try {
    zk=createClient();
    try {
      zk.getData("/abc",null,null);
      Assert.fail("Should not be able to read data when not authenticated");
    }
 catch (    KeeperException.NoAuthException e) {
    }
    zk.close();
  }
  finally {
    System.setProperty(ZooKeeperSaslClient.ENABLE_CLIENT_SASL_KEY,"true");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.SaslAuthDesignatedServerTest </h4><pre class="type-3 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAuth() throws Exception {
  MyWatcher watcher=new MyWatcher();
  ZooKeeper zk=createClient(watcher);
  watcher.authCompleted.await(AUTHENTICATION_TIMEOUT,TimeUnit.MILLISECONDS);
  Assert.assertEquals(authFailed.get(),0);
  try {
    zk.create("/path1",null,Ids.CREATOR_ALL_ACL,CreateMode.PERSISTENT);
  }
 catch (  KeeperException e) {
    Assert.fail("test failed :" + e);
  }
 finally {
    zk.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.SaslAuthFailDesignatedClientTest </h4><pre class="type-10 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testAuth() throws Exception {
  CountdownWatcher watcher=new CountdownWatcher();
  TestableZooKeeper zk=new TestableZooKeeper(hostPort,CONNECTION_TIMEOUT,watcher);
  if (!watcher.clientConnected.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS)) {
    Assert.fail("Unable to connect to server");
  }
  try {
    zk.create("/path1",null,Ids.CREATOR_ALL_ACL,CreateMode.PERSISTENT);
    Assert.fail("Should have gotten exception.");
  }
 catch (  KeeperException e) {
    LOG.info("Got exception as expected: " + e);
  }
 finally {
    zk.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.SaslAuthFailTest </h4><pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testAuthFail() throws Exception {
  ZooKeeper zk=createClient();
  try {
    zk.create("/path1",null,Ids.CREATOR_ALL_ACL,CreateMode.PERSISTENT);
    Assert.fail("Should have gotten exception.");
  }
 catch (  Exception e) {
    LOG.info("Got exception as expected: " + e);
  }
 finally {
    zk.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.SaslAuthMissingClientConfigTest </h4><pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testAuth() throws Exception {
  ZooKeeper zk=createClient();
  try {
    zk.create("/path1",null,Ids.CREATOR_ALL_ACL,CreateMode.PERSISTENT);
    Assert.fail("Should have gotten exception.");
  }
 catch (  KeeperException e) {
    LOG.info("Got exception as expected: " + e);
  }
 finally {
    zk.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.SaslAuthTest </h4><pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testInvalidSaslIds() throws Exception {
  ZooKeeper zk=createClient();
  List<String> invalidIds=new ArrayList<String>();
  invalidIds.add("user@KERB.REALM/server.com");
  invalidIds.add("user@KERB.REALM1@KERB.REALM2");
  int i=0;
  for (  String invalidId : invalidIds) {
    List<ACL> aclList=new ArrayList<ACL>();
    try {
      ACL acl=new ACL(0,new Id("sasl",invalidId));
      aclList.add(acl);
      zk.create("/invalid" + i,null,aclList,CreateMode.PERSISTENT);
      Assert.fail("SASLAuthenticationProvider.isValid() failed to catch invalid Id.");
    }
 catch (    KeeperException.InvalidACLException e) {
    }
 finally {
      i++;
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.SessionTest </h4><pre class="type-9 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Make sure that we cannot have two connections with the same
 * session id.
 * @throws IOException
 * @throws InterruptedException
 * @throws KeeperException
 */
@Test public void testSessionMove() throws Exception {
  String hostPorts[]=HOSTPORT.split(",");
  DisconnectableZooKeeper zk=new DisconnectableZooKeeper(hostPorts[0],CONNECTION_TIMEOUT,new MyWatcher("0"));
  zk.create("/sessionMoveTest",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  for (int i=0; i < hostPorts.length * 2; i++) {
    zk.dontReconnect();
    DisconnectableZooKeeper zknew=new DisconnectableZooKeeper(hostPorts[(i + 1) % hostPorts.length],CONNECTION_TIMEOUT,new MyWatcher(Integer.toString(i + 1)),zk.getSessionId(),zk.getSessionPasswd());
    final int result[]=new int[1];
    result[0]=Integer.MAX_VALUE;
    zknew.sync("/",new AsyncCallback.VoidCallback(){
      public void processResult(      int rc,      String path,      Object ctx){
synchronized (result) {
          result[0]=rc;
          result.notify();
        }
      }
    }
,null);
synchronized (result) {
      if (result[0] == Integer.MAX_VALUE) {
        result.wait(5000);
      }
    }
    LOG.info(hostPorts[(i + 1) % hostPorts.length] + " Sync returned " + result[0]);
    Assert.assertTrue(result[0] == KeeperException.Code.OK.intValue());
    zknew.setData("/",new byte[1],-1);
    try {
      zk.setData("/",new byte[1],-1);
      Assert.fail("Should have lost the connection");
    }
 catch (    KeeperException.ConnectionLossException e) {
      LOG.info("Got connection loss exception as expected");
    }
    zk=zknew;
  }
  zk.close();
}

</code></pre>

<br>
<pre class="type-5 type-3 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test verifies that when the session id is reused, and the original
 * client is disconnected, but not session closed, that the server
 * will remove ephemeral nodes created by the original session.
 */
@Test public void testSession() throws IOException, InterruptedException, KeeperException {
  DisconnectableZooKeeper zk=createClient();
  zk.create("/e",new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  LOG.info("zk with session id 0x" + Long.toHexString(zk.getSessionId()) + " was destroyed!");
  zk.disconnect();
  Stat stat=new Stat();
  startSignal=new CountDownLatch(1);
  zk=new DisconnectableZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,new MyWatcher("testSession"),zk.getSessionId(),zk.getSessionPasswd());
  startSignal.await();
  LOG.info("zk with session id 0x" + Long.toHexString(zk.getSessionId()) + " was created!");
  zk.getData("/e",false,stat);
  LOG.info("After get data /e");
  zk.close();
  zk=createClient();
  Assert.assertEquals(null,zk.exists("/e",false));
  LOG.info("before close zk with session id 0x" + Long.toHexString(zk.getSessionId()) + "!");
  zk.close();
  try {
    zk.getData("/e",false,stat);
    Assert.fail("Should have received a SessionExpiredException");
  }
 catch (  KeeperException.SessionExpiredException e) {
  }
  AsyncCallback.DataCallback cb=new AsyncCallback.DataCallback(){
    String status="not done";
    public void processResult(    int rc,    String p,    Object c,    byte[] b,    Stat s){
synchronized (this) {
        status=KeeperException.Code.get(rc).toString();
        this.notify();
      }
    }
    public String toString(){
      return status;
    }
  }
;
  zk.getData("/e",false,cb,null);
synchronized (cb) {
    if (cb.toString().equals("not done")) {
      cb.wait(1000);
    }
  }
  Assert.assertEquals(KeeperException.Code.SESSIONEXPIRED.toString(),cb.toString());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.SessionTrackerCheckTest </h4><pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testLearnerSessionTracker() throws Exception {
  Expirer expirer=new Expirer(1);
  LearnerSessionTracker tracker=new LearnerSessionTracker(expirer,sessionsWithTimeouts,TICK_TIME,expirer.sid,true,testZKSListener());
  long sessionId=0xb100ded;
  try {
    tracker.checkSession(sessionId,null);
    Assert.fail("Unknown session should have failed");
  }
 catch (  SessionExpiredException e) {
  }
  sessionsWithTimeouts.put(sessionId,CONNECTION_TIMEOUT);
  try {
    tracker.checkSession(sessionId,null);
  }
 catch (  Exception e) {
    Assert.fail("Global session should not fail");
  }
  sessionId=0xf005ba11;
  tracker.addSession(sessionId,CONNECTION_TIMEOUT);
  try {
    tracker.checkSession(sessionId,null);
  }
 catch (  Exception e) {
    Assert.fail("Local session should not fail");
  }
  sessionsWithTimeouts.put(sessionId,CONNECTION_TIMEOUT);
  try {
    tracker.checkSession(sessionId,null);
  }
 catch (  Exception e) {
    Assert.fail("Session during upgrade should not fail");
  }
  tracker=new LearnerSessionTracker(expirer,sessionsWithTimeouts,TICK_TIME,expirer.sid,false,testZKSListener());
  sessionId=0xdeadbeef;
  try {
    tracker.checkSession(sessionId,null);
  }
 catch (  Exception e) {
    Assert.fail("Should not get any exception");
  }
}

</code></pre>

<br>
<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testLeaderSessionTracker() throws Exception {
  Expirer expirer=new Expirer(2);
  LeaderSessionTracker tracker=new LeaderSessionTracker(expirer,sessionsWithTimeouts,TICK_TIME,expirer.sid,true,testZKSListener());
  long sessionId=((expirer.sid + 1) << 56) + 1;
  try {
    tracker.checkSession(sessionId,null);
  }
 catch (  Exception e) {
    Assert.fail("local session from other server should not fail");
  }
  tracker.addGlobalSession(sessionId,CONNECTION_TIMEOUT);
  try {
    tracker.checkSession(sessionId,null);
  }
 catch (  Exception e) {
    Assert.fail("Global session should not fail");
  }
  try {
    tracker.checkGlobalSession(sessionId,null);
  }
 catch (  Exception e) {
    Assert.fail("Global session should not fail " + e);
  }
  sessionId=(expirer.sid << 56) + 1;
  ;
  tracker.addSession(sessionId,CONNECTION_TIMEOUT);
  try {
    tracker.checkSession(sessionId,null);
  }
 catch (  Exception e) {
    Assert.fail("Local session on the leader should not fail");
  }
  tracker.addGlobalSession(sessionId,CONNECTION_TIMEOUT);
  try {
    tracker.checkSession(sessionId,null);
  }
 catch (  Exception e) {
    Assert.fail("Session during upgrade should not fail");
  }
  try {
    tracker.checkGlobalSession(sessionId,null);
  }
 catch (  Exception e) {
    Assert.fail("Global session should not fail " + e);
  }
  tracker=new LeaderSessionTracker(expirer,sessionsWithTimeouts,TICK_TIME,expirer.sid,false,testZKSListener());
  sessionId=0xdeadbeef;
  tracker.addSession(sessionId,CONNECTION_TIMEOUT);
  try {
    tracker.checkSession(sessionId,null);
  }
 catch (  Exception e) {
    Assert.fail("Global session should not fail");
  }
  try {
    tracker.checkGlobalSession(sessionId,null);
  }
 catch (  Exception e) {
    Assert.fail("Global session should not fail");
  }
  sessionId=((expirer.sid + 1) << 56) + 2;
  try {
    tracker.checkSession(sessionId,null);
    Assert.fail("local session from other server should fail");
  }
 catch (  SessionExpiredException e) {
  }
  sessionId=((expirer.sid) << 56) + 2;
  try {
    tracker.checkSession(sessionId,null);
    Assert.fail("local session from the leader should fail");
  }
 catch (  SessionExpiredException e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.StandaloneTest </h4><pre class="type-3 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify that reconfiguration in standalone mode fails with
 * KeeperException.UnimplementedException.
 */
@Test public void testStandaloneReconfigFails() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT=PortAssignment.unique();
  final String HOSTPORT="127.0.0.1:" + CLIENT_PORT;
  File tmpDir=ClientBase.createTmpDir();
  ZooKeeperServer zks=new ZooKeeperServer(tmpDir,tmpDir,3000);
  ServerCnxnFactory f=ServerCnxnFactory.createFactory(CLIENT_PORT,-1);
  f.startup(zks);
  Assert.assertTrue("waiting for server being up ",ClientBase.waitForServerUp(HOSTPORT,CONNECTION_TIMEOUT));
  CountdownWatcher watcher=new CountdownWatcher();
  ZooKeeper zk=new ZooKeeper(HOSTPORT,CONNECTION_TIMEOUT,watcher);
  watcher.waitForConnected(CONNECTION_TIMEOUT);
  List<String> joiners=new ArrayList<String>();
  joiners.add("server.2=localhost:1234:1235;1236");
  try {
    zk.reconfig(joiners,null,null,-1,new Stat());
    Assert.fail("Reconfiguration in standalone should trigger " + "UnimplementedException");
  }
 catch (  KeeperException.UnimplementedException ex) {
  }
  zk.close();
  zks.shutdown();
  f.shutdown();
  Assert.assertTrue("waiting for server being down ",ClientBase.waitForServerDown(HOSTPORT,CONNECTION_TIMEOUT));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.SyncCallTest </h4><pre class="type-9 type-10 type-3 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSync() throws Exception {
  try {
    LOG.info("Starting ZK:" + (new Date()).toString());
    opsCount=new CountDownLatch(limit);
    ZooKeeper zk=createClient();
    LOG.info("Beginning test:" + (new Date()).toString());
    for (int i=0; i < 50; i++)     zk.create("/test" + i,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT,(StringCallback)this,results);
    for (int i=50; i < 100; i++) {
      zk.create("/test" + i,new byte[0],Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT,(Create2Callback)this,results);
    }
    zk.sync("/test",this,results);
    for (int i=0; i < 100; i++)     zk.delete("/test" + i,0,this,results);
    for (int i=0; i < 100; i++)     zk.getChildren("/",new NullWatcher(),(ChildrenCallback)this,results);
    for (int i=0; i < 100; i++)     zk.getChildren("/",new NullWatcher(),(Children2Callback)this,results);
    LOG.info("Submitted all operations:" + (new Date()).toString());
    if (!opsCount.await(10000,TimeUnit.MILLISECONDS))     Assert.fail("Haven't received all confirmations" + opsCount.getCount());
    for (int i=0; i < limit; i++) {
      Assert.assertEquals(0,(int)results.get(i));
    }
  }
 catch (  IOException e) {
    System.out.println(e.toString());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.TruncateTest </h4><pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testTruncate() throws IOException, InterruptedException, KeeperException {
  String hostPort="127.0.0.1:" + PortAssignment.unique();
  int maxCnxns=100;
  ServerCnxnFactory factory=ClientBase.createNewServerInstance(null,hostPort,maxCnxns);
  ClientBase.startServerInstance(dataDir1,factory,hostPort);
  ClientBase.shutdownServerInstance(factory,hostPort);
  File origfile=new File(new File(dataDir1,"version-2"),"snapshot.0");
  File newfile=new File(new File(dataDir1,"version-2"),"snapshot.100000000");
  origfile.renameTo(newfile);
  factory=ClientBase.createNewServerInstance(null,hostPort,maxCnxns);
  ClientBase.startServerInstance(dataDir1,factory,hostPort);
  ZooKeeper zk=new ZooKeeper(hostPort,15000,nullWatcher);
  for (int i=0; i < 50; i++) {
    zk.create("/" + i,new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  }
  zk.close();
  ZKDatabase zkDb;
{
    ZooKeeperServer zs=ClientBase.getServer(factory);
    zkDb=zs.getZKDatabase();
  }
  factory.shutdown();
  try {
    zkDb.close();
  }
 catch (  IOException ie) {
    LOG.warn("Error closing logs ",ie);
  }
  int tickTime=2000;
  int initLimit=3;
  int syncLimit=3;
  int port1=PortAssignment.unique();
  int port2=PortAssignment.unique();
  int port3=PortAssignment.unique();
  HashMap<Long,QuorumServer> peers=new HashMap<Long,QuorumServer>();
  peers.put(Long.valueOf(1),new QuorumServer(1,new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",port1)));
  peers.put(Long.valueOf(2),new QuorumServer(2,new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",port2)));
  peers.put(Long.valueOf(3),new QuorumServer(3,new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",port3)));
  QuorumPeer s2=new QuorumPeer(peers,dataDir2,dataDir2,port2,0,2,tickTime,initLimit,syncLimit);
  s2.start();
  QuorumPeer s3=new QuorumPeer(peers,dataDir3,dataDir3,port3,0,3,tickTime,initLimit,syncLimit);
  s3.start();
  connected=false;
  zk=new ZooKeeper("127.0.0.1:" + port2,15000,nullWatcher);
  while (!connected) {
    Thread.sleep(1000);
  }
  for (int i=0; i < 10; i++) {
    zk.create("/" + i,new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  }
  zk.close();
  final ZooKeeper zk2=new ZooKeeper("127.0.0.1:" + port2,15000,nullWatcher);
  zk2.getData("/9",false,new Stat());
  try {
    zk2.getData("/10",false,new Stat());
    Assert.fail("Should have gotten an error");
  }
 catch (  KeeperException.NoNodeException e) {
  }
  QuorumPeer s1=new QuorumPeer(peers,dataDir1,dataDir1,port1,0,1,tickTime,initLimit,syncLimit);
  s1.start();
  connected=false;
  ZooKeeper zk1=new ZooKeeper("127.0.0.1:" + port1,15000,nullWatcher);
  while (!connected) {
    Thread.sleep(1000);
  }
  zk1.getData("/9",false,new Stat());
  try {
    zk1.getData("/12",false,new Stat());
    Assert.fail("Should have gotten an error");
  }
 catch (  KeeperException.NoNodeException e) {
  }
  zk1.close();
  QuorumBase.shutdown(s1);
  QuorumBase.shutdown(s2);
  QuorumBase.shutdown(s3);
}

</code></pre>

<br>
<pre class="type-9 type-3 type-2 type-6 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTruncationNullLog() throws Exception {
  File tmpdir=ClientBase.createTmpDir();
  FileTxnSnapLog snaplog=new FileTxnSnapLog(tmpdir,tmpdir);
  ZKDatabase zkdb=new ZKDatabase(snaplog);
  for (int i=1; i <= 100; i++) {
    append(zkdb,i);
  }
  zkdb.close();
  File[] logs=snaplog.getDataDir().listFiles();
  for (int i=0; i < logs.length; i++) {
    LOG.debug("Deleting: {}",logs[i].getName());
    Assert.assertTrue("Failed to delete log file: " + logs[i].getName(),logs[i].delete());
  }
  try {
    zkdb.truncateLog(1);
    Assert.assertTrue("Should not get here",false);
  }
 catch (  IOException e) {
    Assert.assertTrue("Should have received an IOException",true);
  }
catch (  NullPointerException npe) {
    Assert.fail("This should not throw NPE!");
  }
  ClientBase.recursiveDelete(tmpdir);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.WatchedEventTest </h4><pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testCreatingWatchedEventFromInvalidWrapper(){
  try {
    WatcherEvent wep=new WatcherEvent(-2342,-252352,"foo");
    new WatchedEvent(wep);
    Assert.fail("Was able to create WatchedEvent from bad wrapper");
  }
 catch (  RuntimeException re) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.WatcherFuncTest </h4><pre class="type-3 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetDataSync() throws IOException, InterruptedException, KeeperException {
  try {
    lsnr.getData("/foo",true,null);
    Assert.fail();
  }
 catch (  KeeperException e) {
    Assert.assertEquals(KeeperException.Code.NONODE,e.code());
    Assert.assertEquals("/foo",e.getPath());
  }
  try {
    lsnr.getData("/foo/bar",true,null);
    Assert.fail();
  }
 catch (  KeeperException e) {
    Assert.assertEquals(KeeperException.Code.NONODE,e.code());
    Assert.assertEquals("/foo/bar",e.getPath());
  }
  client.create("/foo","parent".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertNotNull(lsnr.getData("/foo",true,null));
  client.create("/foo/bar","child".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertNotNull(lsnr.getData("/foo/bar",true,null));
  client.setData("/foo","parent".getBytes(),-1);
  expected.add(EventType.NodeDataChanged);
  client.setData("/foo/bar","child".getBytes(),-1);
  expected.add(EventType.NodeDataChanged);
  verify();
  Assert.assertNotNull(lsnr.getData("/foo",true,null));
  Assert.assertNotNull(lsnr.getData("/foo/bar",true,null));
  client.delete("/foo/bar",-1);
  expected.add(EventType.NodeDeleted);
  client.delete("/foo",-1);
  expected.add(EventType.NodeDeleted);
  verify();
}

</code></pre>

<br>
<pre class="type-3 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetChildrenSync() throws IOException, InterruptedException, KeeperException {
  try {
    lsnr.getChildren("/foo",true);
    Assert.fail();
  }
 catch (  KeeperException e) {
    Assert.assertEquals(KeeperException.Code.NONODE,e.code());
    Assert.assertEquals("/foo",e.getPath());
  }
  try {
    lsnr.getChildren("/foo/bar",true);
    Assert.fail();
  }
 catch (  KeeperException e) {
    Assert.assertEquals(KeeperException.Code.NONODE,e.code());
    Assert.assertEquals("/foo/bar",e.getPath());
  }
  client.create("/foo","parent".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertNotNull(lsnr.getChildren("/foo",true));
  client.create("/foo/bar","child".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  expected.add(EventType.NodeChildrenChanged);
  Assert.assertNotNull(lsnr.getChildren("/foo/bar",true));
  client.setData("/foo","parent".getBytes(),-1);
  client.setData("/foo/bar","child".getBytes(),-1);
  Assert.assertNotNull(lsnr.exists("/foo",true));
  Assert.assertNotNull(lsnr.getChildren("/foo",true));
  Assert.assertNotNull(lsnr.getChildren("/foo/bar",true));
  client.delete("/foo/bar",-1);
  expected.add(EventType.NodeDeleted);
  expected.add(EventType.NodeChildrenChanged);
  client.delete("/foo",-1);
  expected.add(EventType.NodeDeleted);
  verify();
}

</code></pre>

<br>
<pre class="type-3 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetDataSyncWObj() throws IOException, InterruptedException, KeeperException {
  SimpleWatcher w1=new SimpleWatcher(null);
  SimpleWatcher w2=new SimpleWatcher(null);
  SimpleWatcher w3=new SimpleWatcher(null);
  SimpleWatcher w4=new SimpleWatcher(null);
  List<EventType> e2=new ArrayList<EventType>();
  try {
    lsnr.getData("/foo",w1,null);
    Assert.fail();
  }
 catch (  KeeperException e) {
    Assert.assertEquals(KeeperException.Code.NONODE,e.code());
    Assert.assertEquals("/foo",e.getPath());
  }
  try {
    lsnr.getData("/foo/bar",w2,null);
    Assert.fail();
  }
 catch (  KeeperException e) {
    Assert.assertEquals(KeeperException.Code.NONODE,e.code());
    Assert.assertEquals("/foo/bar",e.getPath());
  }
  client.create("/foo","parent".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertNotNull(lsnr.getData("/foo",true,null));
  Assert.assertNotNull(lsnr.getData("/foo",w1,null));
  client.create("/foo/bar","child".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertNotNull(lsnr.getData("/foo/bar",w2,null));
  Assert.assertNotNull(lsnr.getData("/foo/bar",w3,null));
  Assert.assertNotNull(lsnr.getData("/foo/bar",w4,null));
  Assert.assertNotNull(lsnr.getData("/foo/bar",w4,null));
  client.setData("/foo","parent".getBytes(),-1);
  expected.add(EventType.NodeDataChanged);
  client.setData("/foo/bar","child".getBytes(),-1);
  e2.add(EventType.NodeDataChanged);
  lsnr_dwatch.verify(expected);
  w1.verify(expected);
  w2.verify(e2);
  w3.verify(e2);
  w4.verify(e2);
  expected.clear();
  e2.clear();
  Assert.assertNotNull(lsnr.getData("/foo",true,null));
  Assert.assertNotNull(lsnr.getData("/foo",w1,null));
  Assert.assertNotNull(lsnr.getData("/foo/bar",w2,null));
  Assert.assertNotNull(lsnr.getData("/foo/bar",w3,null));
  Assert.assertNotNull(lsnr.getData("/foo/bar",w3,null));
  Assert.assertNotNull(lsnr.getData("/foo/bar",w4,null));
  client.delete("/foo/bar",-1);
  expected.add(EventType.NodeDeleted);
  client.delete("/foo",-1);
  e2.add(EventType.NodeDeleted);
  lsnr_dwatch.verify(expected);
  w1.verify(expected);
  w2.verify(e2);
  w3.verify(e2);
  w4.verify(e2);
  expected.clear();
  e2.clear();
}

</code></pre>

<br>
<pre class="type-3 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExistsSync() throws IOException, InterruptedException, KeeperException {
  Assert.assertNull(lsnr.exists("/foo",true));
  Assert.assertNull(lsnr.exists("/foo/bar",true));
  client.create("/foo","parent".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  expected.add(EventType.NodeCreated);
  client.create("/foo/bar","child".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  expected.add(EventType.NodeCreated);
  verify();
  Assert.assertNotNull(lsnr.exists("/foo",true));
  Assert.assertNotNull(lsnr.exists("/foo/bar",true));
  try {
    Assert.assertNull(lsnr.exists("/car",true));
    client.setData("/car","missing".getBytes(),-1);
    Assert.fail();
  }
 catch (  KeeperException e) {
    Assert.assertEquals(KeeperException.Code.NONODE,e.code());
    Assert.assertEquals("/car",e.getPath());
  }
  try {
    Assert.assertNull(lsnr.exists("/foo/car",true));
    client.setData("/foo/car","missing".getBytes(),-1);
    Assert.fail();
  }
 catch (  KeeperException e) {
    Assert.assertEquals(KeeperException.Code.NONODE,e.code());
    Assert.assertEquals("/foo/car",e.getPath());
  }
  client.setData("/foo","parent".getBytes(),-1);
  expected.add(EventType.NodeDataChanged);
  client.setData("/foo/bar","child".getBytes(),-1);
  expected.add(EventType.NodeDataChanged);
  verify();
  Assert.assertNotNull(lsnr.exists("/foo",true));
  Assert.assertNotNull(lsnr.exists("/foo/bar",true));
  client.delete("/foo/bar",-1);
  expected.add(EventType.NodeDeleted);
  client.delete("/foo",-1);
  expected.add(EventType.NodeDeleted);
  verify();
}

</code></pre>

<br>
<pre class="type-3 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetChildrenSyncWObj() throws IOException, InterruptedException, KeeperException {
  SimpleWatcher w1=new SimpleWatcher(null);
  SimpleWatcher w2=new SimpleWatcher(null);
  SimpleWatcher w3=new SimpleWatcher(null);
  SimpleWatcher w4=new SimpleWatcher(null);
  List<EventType> e2=new ArrayList<EventType>();
  try {
    lsnr.getChildren("/foo",true);
    Assert.fail();
  }
 catch (  KeeperException e) {
    Assert.assertEquals(KeeperException.Code.NONODE,e.code());
    Assert.assertEquals("/foo",e.getPath());
  }
  try {
    lsnr.getChildren("/foo/bar",true);
    Assert.fail();
  }
 catch (  KeeperException e) {
    Assert.assertEquals(KeeperException.Code.NONODE,e.code());
    Assert.assertEquals("/foo/bar",e.getPath());
  }
  client.create("/foo","parent".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertNotNull(lsnr.getChildren("/foo",true));
  Assert.assertNotNull(lsnr.getChildren("/foo",w1));
  client.create("/foo/bar","child".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  expected.add(EventType.NodeChildrenChanged);
  Assert.assertNotNull(lsnr.getChildren("/foo/bar",w2));
  Assert.assertNotNull(lsnr.getChildren("/foo/bar",w2));
  Assert.assertNotNull(lsnr.getChildren("/foo/bar",w3));
  Assert.assertNotNull(lsnr.getChildren("/foo/bar",w4));
  client.setData("/foo","parent".getBytes(),-1);
  client.setData("/foo/bar","child".getBytes(),-1);
  Assert.assertNotNull(lsnr.exists("/foo",true));
  Assert.assertNotNull(lsnr.exists("/foo",w1));
  Assert.assertNotNull(lsnr.exists("/foo",true));
  Assert.assertNotNull(lsnr.exists("/foo",w1));
  Assert.assertNotNull(lsnr.getChildren("/foo",true));
  Assert.assertNotNull(lsnr.getChildren("/foo",w1));
  Assert.assertNotNull(lsnr.getChildren("/foo/bar",w2));
  Assert.assertNotNull(lsnr.getChildren("/foo/bar",w3));
  Assert.assertNotNull(lsnr.getChildren("/foo/bar",w4));
  Assert.assertNotNull(lsnr.getChildren("/foo/bar",w4));
  client.delete("/foo/bar",-1);
  e2.add(EventType.NodeDeleted);
  expected.add(EventType.NodeChildrenChanged);
  client.delete("/foo",-1);
  expected.add(EventType.NodeDeleted);
  lsnr_dwatch.verify(expected);
  w1.verify(expected);
  w2.verify(e2);
  w3.verify(e2);
  w4.verify(e2);
  expected.clear();
  e2.clear();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.system.SimpleSysTest </h4><pre class="type-9 type-10 type-3 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test checks the following:
 * 1) All clients connect successfully
 * 2) Half of the servers die (assuming odd number) and a write succeeds
 * 3) All servers are restarted and cluster stays alive
 * 4) Clients see a change by the server
 * 5) Clients' ephemeral nodes are cleaned up
 * @throws Exception
 */
@Test public void testSimpleCase() throws Exception {
  configureServers(serverCount);
  configureClients(clientCount,SimpleClient.class,getHostPort());
  Stat stat=new Stat();
  startServers();
  LOG.debug("Connecting to " + getHostPort());
  ZooKeeper zk=new ZooKeeper(getHostPort(),15000,this);
  waitForConnect(zk,10000);
  zk.create("/simpleCase","orig".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  startClients();
  for (int i=0; i < getClientCount(); i++) {
    for (int j=0; j < maxTries; j++) {
      try {
        byte b[]=zk.getData("/simpleCase/" + i,false,stat);
        Assert.assertEquals("orig",new String(b));
      }
 catch (      NoNodeException e) {
        if (j + 1 == maxTries) {
          Assert.fail("Max tries exceeded on client " + i);
        }
        Thread.sleep(1000);
      }
    }
  }
  for (int i=0; i < getServerCount(); i++) {
    stopServer(i);
    if (i + 1 > getServerCount() / 2) {
      startServer(i);
    }
 else     if (i + 1 == getServerCount() / 2) {
      Assert.assertTrue("Connection didn't recover",waitForConnect(zk,10000));
      try {
        zk.setData("/simpleCase","new".getBytes(),-1);
      }
 catch (      ConnectionLossException e) {
        Assert.assertTrue("Connection didn't recover",waitForConnect(zk,10000));
        zk.setData("/simpleCase","new".getBytes(),-1);
      }
      for (int j=0; j < i; j++) {
        LOG.info("Starting server " + j);
        startServer(i);
      }
    }
  }
  Thread.sleep(100);
  Assert.assertTrue("Servers didn't bounce",waitForConnect(zk,15000));
  try {
    zk.getData("/simpleCase",false,stat);
  }
 catch (  ConnectionLossException e) {
    Assert.assertTrue("Servers didn't bounce",waitForConnect(zk,15000));
  }
  for (int i=0; i < getClientCount(); i++) {
    for (int j=0; j < maxTries; j++) {
      byte data[]=zk.getData("/simpleCase/" + i,false,stat);
      if (new String(data).equals("new")) {
        break;
      }
      if (j + 1 == maxTries) {
        Assert.fail("max tries exceeded for " + i);
      }
      Thread.sleep(1000);
    }
  }
  zk.setData("/simpleCase","die".getBytes(),-1);
  for (int i=0; i < getClientCount(); i++) {
    try {
      for (int j=0; j < maxTries; j++) {
        zk.getData("/simpleCase/" + i,false,stat);
        if (j + 1 == maxTries) {
          Assert.fail("max tries exceeded waiting for child " + i + " to die");
        }
        Thread.sleep(200);
      }
    }
 catch (    NoNodeException e) {
    }
  }
  stopClients();
  stopServers();
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
