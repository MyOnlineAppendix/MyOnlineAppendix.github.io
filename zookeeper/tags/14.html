<h3><span class=" glyphicon glyphicon-tag"/>&nbspPublicFieldVerifier</h3><kbd>Verifies values related to public fields.</kbd><br><br><br><h4 style="margin:0px">Class: org.apache.zookeeper.server.ByteBufferInputStreamTest </h4><pre class="type-5 type-6 type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testReadArrayOffsetLength_AtEndOfStream() throws Exception {
  for (int i=0; i < DATA_BYTES.length; i++) {
    in.read();
  }
  byte[] expected=Arrays.copyOf(bs,bs.length);
  assertEquals(-1,in.read(bs,2,2));
  assertArrayEquals(expected,bs);
}

</code></pre>

<br>
<pre class="type-6 type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testReadArrayOffsetLength_HitEndOfStream() throws Exception {
  for (int i=0; i < DATA_BYTES.length - 1; i++) {
    in.read();
  }
  assertEquals(1,in.read(bs,2,2));
  byte[] expected=new byte[]{(byte)1,(byte)2,DATA_BYTES[DATA_BYTES.length - 1],(byte)4};
  assertArrayEquals(expected,bs);
}

</code></pre>

<br>
<pre class="type-6 type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testSkip2() throws Exception {
  for (int i=0; i < DATA_BYTES.length / 2; i++) {
    in.read();
  }
  long skipAmount=DATA_BYTES.length / 4;
  assertEquals(skipAmount,in.skip(skipAmount));
  int idx=DATA_BYTES.length / 2 + (int)skipAmount;
  assertEquals(DATA_BYTES[idx++],in.read());
  assertEquals(DATA_BYTES[idx++],in.read());
}

</code></pre>

<br>
<pre class="type-9 type-6 type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testAvailable() throws Exception {
  for (int i=DATA_BYTES.length; i > 0; i--) {
    assertEquals(i,in.available());
    in.read();
  }
  assertEquals(0,in.available());
}

</code></pre>

<br>
<pre class="type-5 type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testReadArrayOffsetLength_0Length() throws Exception {
  byte[] expected=Arrays.copyOf(bs,bs.length);
  assertEquals(0,in.read(bs,2,0));
  assertArrayEquals(expected,bs);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.DataTreeTest </h4><pre class="type-2 type-6 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies values related to public fields.
"></span><br>
/** 
 * For ZOOKEEPER-1046 test if cversion is getting incremented correctly.
 */
@Test(timeout=60000) public void testIncrementCversion() throws Exception {
  dt.createNode("/test",new byte[0],null,0,dt.getNode("/").stat.getCversion() + 1,1,1);
  DataNode zk=dt.getNode("/test");
  int prevCversion=zk.stat.getCversion();
  long prevPzxid=zk.stat.getPzxid();
  dt.setCversionPzxid("/test/",prevCversion + 1,prevPzxid + 1);
  int newCversion=zk.stat.getCversion();
  long newPzxid=zk.stat.getPzxid();
  Assert.assertTrue("<cversion, pzxid> verification failed. Expected: <" + (prevCversion + 1) + ", "+ (prevPzxid + 1)+ ">, found: <"+ newCversion+ ", "+ newPzxid+ ">",(newCversion == prevCversion + 1 && newPzxid == prevPzxid + 1));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.PrepRequestProcessorTest </h4><pre class="type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test checks that a successful multi will change outstanding record
 * and failed multi shouldn't change outstanding record.
 */
@Test public void testMultiOutstandingChange() throws Exception {
  zks.getZKDatabase().dataTree.createNode("/foo",new byte[0],Ids.OPEN_ACL_UNSAFE,0,0,0,0);
  Assert.assertNull(zks.outstandingChangesForPath.get("/foo"));
  process(Arrays.asList(Op.setData("/foo",new byte[0],-1)));
  ChangeRecord cr=zks.outstandingChangesForPath.get("/foo");
  Assert.assertNotNull("Change record wasn't set",cr);
  Assert.assertEquals("Record zxid wasn't set correctly",1,cr.zxid);
  process(Arrays.asList(Op.delete("/foo",-1)));
  cr=zks.outstandingChangesForPath.get("/foo");
  Assert.assertEquals("Record zxid wasn't set correctly",2,cr.zxid);
  process(Arrays.asList(Op.delete("/foo",-1)));
  cr=zks.outstandingChangesForPath.get("/foo");
  Assert.assertEquals("Record zxid wasn't set correctly",2,cr.zxid);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.SessionTrackerTest </h4><pre class="type-5 type-6 type-8 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies values related to public fields.
"></span><br>
/** 
 * Verify the session closure request has reached PrepRequestProcessor soon
 * after session expiration by the session tracker
 */
@Test(timeout=20000) public void testCloseSessionRequestAfterSessionExpiry() throws Exception {
  ZooKeeperServer zks=setupSessionTracker();
  latch=new CountDownLatch(1);
  zks.sessionTracker.addSession(sessionId,sessionTimeout);
  SessionTrackerImpl sessionTrackerImpl=(SessionTrackerImpl)zks.sessionTracker;
  SessionImpl sessionImpl=sessionTrackerImpl.sessionsById.get(sessionId);
  Assert.assertNotNull("Sessionid:" + sessionId + " doesn't exists in sessiontracker",sessionImpl);
  Object sessionOwner=new Object();
  sessionTrackerImpl.checkSession(sessionId,sessionOwner);
  latch.await(sessionTimeout * 2,TimeUnit.MILLISECONDS);
  sessionTrackerImpl.removeSession(sessionId);
  SessionImpl actualSession=sessionTrackerImpl.sessionsById.get(sessionId);
  Assert.assertNull("Session:" + sessionId + " still exists after removal",actualSession);
}

</code></pre>

<br>
<pre class="type-5 type-3 type-2 type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify the create session call in the Leader.FinalRequestProcessor after
 * the session expiration.
 */
@Test(timeout=20000) public void testAddSessionAfterSessionExpiry() throws Exception {
  ZooKeeperServer zks=setupSessionTracker();
  latch=new CountDownLatch(1);
  zks.sessionTracker.addSession(sessionId,sessionTimeout);
  SessionTrackerImpl sessionTrackerImpl=(SessionTrackerImpl)zks.sessionTracker;
  SessionImpl sessionImpl=sessionTrackerImpl.sessionsById.get(sessionId);
  Assert.assertNotNull("Sessionid:" + sessionId + " doesn't exists in sessiontracker",sessionImpl);
  Object sessionOwner=new Object();
  sessionTrackerImpl.checkSession(sessionId,sessionOwner);
  latch.await(sessionTimeout * 2,TimeUnit.MILLISECONDS);
  sessionTrackerImpl.addSession(sessionId,sessionTimeout);
  try {
    sessionTrackerImpl.checkSession(sessionId,sessionOwner);
    Assert.fail("Should throw session expiry exception " + "as the session has expired and closed");
  }
 catch (  KeeperException.SessionExpiredException e) {
  }
  Assert.assertTrue("Session didn't expired",sessionImpl.isClosing());
  Assert.assertFalse("Session didn't expired",sessionTrackerImpl.touchSession(sessionId,sessionTimeout));
  Assert.assertEquals("Duplicate session expiry request has been generated",1,firstProcessor.getCountOfCloseSessionReq());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.jersey.CreateTest </h4><pre class="type-5 type-10 type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreate() throws Exception {
  WebResource wr=znodesr.path(path).queryParam("dataformat",encoding).queryParam("name",name);
  if (data == null) {
    wr=wr.queryParam("null","true");
  }
  if (sequence) {
    wr=wr.queryParam("sequence","true");
  }
  Builder builder=wr.accept(accept);
  ClientResponse cr;
  if (data == null) {
    cr=builder.post(ClientResponse.class);
  }
 else {
    cr=builder.post(ClientResponse.class,data);
  }
  Assert.assertEquals(expectedStatus,cr.getClientResponseStatus());
  if (expectedPath == null) {
    return;
  }
  ZPath zpath=cr.getEntity(ZPath.class);
  if (sequence) {
    Assert.assertTrue(zpath.path.startsWith(expectedPath.path));
    Assert.assertTrue(zpath.uri.startsWith(znodesr.path(path).toString()));
  }
 else {
    Assert.assertEquals(expectedPath,zpath);
    Assert.assertEquals(znodesr.path(path).toString(),zpath.uri);
  }
  byte[] data=zk.getData(zpath.path,false,new Stat());
  if (data == null && this.data == null) {
    return;
  }
 else   if (data == null || this.data == null) {
    Assert.assertEquals(data,this.data);
  }
 else {
    Assert.assertTrue(new String(data) + " == " + new String(this.data),Arrays.equals(data,this.data));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.jersey.RootTest </h4><pre class="type-5 type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreate() throws Exception {
  String path="/";
  String name="roottest-create";
  byte[] data="foo".getBytes();
  WebResource wr=znodesr.path(path).queryParam("dataformat","utf8").queryParam("name",name);
  Builder builder=wr.accept(MediaType.APPLICATION_JSON);
  ClientResponse cr;
  cr=builder.post(ClientResponse.class,data);
  Assert.assertEquals(ClientResponse.Status.CREATED,cr.getClientResponseStatus());
  ZPath zpath=cr.getEntity(ZPath.class);
  Assert.assertEquals(new ZPath(path + name),zpath);
  Assert.assertEquals(znodesr.path(path).toString(),zpath.uri);
  byte[] rdata=zk.getData(zpath.path,false,new Stat());
  Assert.assertTrue(new String(rdata) + " == " + new String(data),Arrays.equals(rdata,data));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.jersey.SessionTest </h4><pre class="type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeleteSession(){
  ZSession session=createSession("30");
  WebResource wr=sessionsr.path(session.id);
  Builder b=wr.accept(MediaType.APPLICATION_JSON);
  Assert.assertTrue(ZooKeeperService.isConnected(CONTEXT_PATH,session.id));
  ClientResponse cr=b.delete(ClientResponse.class,null);
  Assert.assertEquals(ClientResponse.Status.NO_CONTENT,cr.getClientResponseStatus());
  Assert.assertFalse(ZooKeeperService.isConnected(CONTEXT_PATH,session.id));
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSendHeartbeat() throws InterruptedException {
  ZSession session=createSession("2");
  Thread.sleep(1000);
  WebResource wr=sessionsr.path(session.id);
  Builder b=wr.accept(MediaType.APPLICATION_JSON);
  ClientResponse cr=b.put(ClientResponse.class,null);
  Assert.assertEquals(ClientResponse.Status.OK,cr.getClientResponseStatus());
  Thread.sleep(1500);
  Assert.assertTrue(ZooKeeperService.isConnected(CONTEXT_PATH,session.id));
  Thread.sleep(1000);
  Assert.assertFalse(ZooKeeperService.isConnected(CONTEXT_PATH,session.id));
}

</code></pre>

<br>
<pre class="type-6 type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testCreateEphemeralZNode() throws KeeperException, InterruptedException, IOException {
  ZSession session=createSession("30");
  WebResource wr=znodesr.path("/").queryParam("op","create").queryParam("name","ephemeral-test").queryParam("ephemeral","true").queryParam("session",session.id).queryParam("null","true");
  Builder b=wr.accept(MediaType.APPLICATION_JSON);
  ClientResponse cr=b.post(ClientResponse.class);
  Assert.assertEquals(ClientResponse.Status.CREATED,cr.getClientResponseStatus());
  Stat stat=new Stat();
  zk.getData("/ephemeral-test",false,stat);
  ZooKeeper sessionZK=ZooKeeperService.getClient(CONTEXT_PATH,session.id);
  Assert.assertEquals(stat.getEphemeralOwner(),sessionZK.getSessionId());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.jersey.SetTest </h4><pre class="type-5 type-10 type-3 type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSet() throws Exception {
  if (expectedStat != null) {
    zk.create(expectedStat.path,"initial".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  }
  WebResource wr=znodesr.path(path).queryParam("dataformat",encoding);
  if (data == null) {
    wr=wr.queryParam("null","true");
  }
  Builder builder=wr.accept(accept).type(MediaType.APPLICATION_OCTET_STREAM);
  ClientResponse cr;
  if (data == null) {
    cr=builder.put(ClientResponse.class);
  }
 else {
    cr=builder.put(ClientResponse.class,new String(data));
  }
  Assert.assertEquals(expectedStatus,cr.getClientResponseStatus());
  if (expectedStat == null) {
    return;
  }
  ZStat zstat=cr.getEntity(ZStat.class);
  Assert.assertEquals(expectedStat,zstat);
  byte[] data=zk.getData(zstat.path,false,new Stat());
  if (data == null && this.data == null) {
    return;
  }
 else   if (data == null || this.data == null) {
    Assert.fail((data == null ? null : new String(data)) + " == " + (this.data == null ? null : new String(this.data)));
  }
 else {
    Assert.assertTrue(new String(data) + " == " + new String(this.data),Arrays.equals(data,this.data));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.LearnerTest </h4><pre class="type-5 type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void syncTest() throws Exception {
  File tmpFile=File.createTempFile("test",".dir",testData);
  tmpFile.delete();
  try {
    FileTxnSnapLog ftsl=new FileTxnSnapLog(tmpFile,tmpFile);
    SimpleLearner sl=new SimpleLearner(ftsl);
    long startZxid=sl.zk.getLastProcessedZxid();
    ByteArrayOutputStream baos=new ByteArrayOutputStream();
    BinaryOutputArchive oa=BinaryOutputArchive.getArchive(baos);
    sl.leaderOs=BinaryOutputArchive.getArchive(new ByteArrayOutputStream());
    sl.bufferedOutput=new BufferedOutputStream(System.out);
    sl.sock=new Socket();
    QuorumPacket qp=new QuorumPacket(Leader.SNAP,0,null,null);
    oa.writeRecord(qp,null);
    sl.zk.getZKDatabase().serializeSnapshot(oa);
    oa.writeString("BenWasHere","signature");
    TxnHeader hdr=new TxnHeader(0,0,0,0,ZooDefs.OpCode.create);
    CreateTxn txn=new CreateTxn("/foo",new byte[0],new ArrayList<ACL>(),false,sl.zk.getZKDatabase().getNode("/").stat.getCversion());
    ByteArrayOutputStream tbaos=new ByteArrayOutputStream();
    BinaryOutputArchive boa=BinaryOutputArchive.getArchive(tbaos);
    hdr.serialize(boa,"hdr");
    txn.serialize(boa,"txn");
    tbaos.close();
    qp=new QuorumPacket(Leader.PROPOSAL,1,tbaos.toByteArray(),null);
    oa.writeRecord(qp,null);
    sl.leaderIs=BinaryInputArchive.getArchive(new ByteArrayInputStream(baos.toByteArray()));
    try {
      sl.syncWithLeader(3);
    }
 catch (    EOFException e) {
    }
    sl.zk.shutdown();
    sl=new SimpleLearner(ftsl);
    Assert.assertEquals(startZxid,sl.zk.getLastProcessedZxid());
  }
  finally {
    TestUtils.deleteFileRecursively(tmpFile);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.QuorumPeerMainTest </h4><pre class="type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies that the server is able to redefine if user configured only
 * minSessionTimeout limit
 */
@Test public void testWithOnlyMinSessionTimeout() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT_QP1=PortAssignment.unique();
  final int CLIENT_PORT_QP2=PortAssignment.unique();
  String quorumCfgSection="server.1=127.0.0.1:" + PortAssignment.unique() + ":"+ PortAssignment.unique()+ "\nserver.2=127.0.0.1:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique();
  final int minSessionTimeOut=15000;
  final String configs="minSessionTimeout=" + minSessionTimeOut + "\n";
  MainThread q1=new MainThread(1,CLIENT_PORT_QP1,quorumCfgSection,configs);
  MainThread q2=new MainThread(2,CLIENT_PORT_QP2,quorumCfgSection,configs);
  q1.start();
  q2.start();
  Assert.assertTrue("waiting for server 1 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP1,CONNECTION_TIMEOUT));
  Assert.assertTrue("waiting for server 2 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP2,CONNECTION_TIMEOUT));
  QuorumPeer quorumPeer=q1.main.quorumPeer;
  final int maxSessionTimeOut=quorumPeer.tickTime * 20;
  Assert.assertEquals("minimumSessionTimeOut is not considered",minSessionTimeOut,quorumPeer.getMinSessionTimeout());
  Assert.assertEquals("maximumSessionTimeOut is wrong",maxSessionTimeOut,quorumPeer.getMaxSessionTimeout());
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies that the server is able to redefine the min/max session
 * timeouts
 */
@Test public void testMinMaxSessionTimeOut() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT_QP1=PortAssignment.unique();
  final int CLIENT_PORT_QP2=PortAssignment.unique();
  String quorumCfgSection="server.1=127.0.0.1:" + PortAssignment.unique() + ":"+ PortAssignment.unique()+ "\nserver.2=127.0.0.1:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique();
  final int minSessionTimeOut=10000;
  final int maxSessionTimeOut=15000;
  final String configs="maxSessionTimeout=" + maxSessionTimeOut + "\n"+ "minSessionTimeout="+ minSessionTimeOut+ "\n";
  MainThread q1=new MainThread(1,CLIENT_PORT_QP1,quorumCfgSection,configs);
  MainThread q2=new MainThread(2,CLIENT_PORT_QP2,quorumCfgSection,configs);
  q1.start();
  q2.start();
  Assert.assertTrue("waiting for server 1 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP1,CONNECTION_TIMEOUT));
  Assert.assertTrue("waiting for server 2 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP2,CONNECTION_TIMEOUT));
  QuorumPeer quorumPeer=q1.main.quorumPeer;
  Assert.assertEquals("minimumSessionTimeOut is not considered",minSessionTimeOut,quorumPeer.getMinSessionTimeout());
  Assert.assertEquals("maximumSessionTimeOut is not considered",maxSessionTimeOut,quorumPeer.getMaxSessionTimeout());
}

</code></pre>

<br>
<pre class="type-2 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify the ability to start a cluster.
 */
@Test public void testQuorum() throws Exception {
  ClientBase.setupTestEnv();
  final int CLIENT_PORT_QP1=PortAssignment.unique();
  final int CLIENT_PORT_QP2=PortAssignment.unique();
  String quorumCfgSection="server.1=127.0.0.1:" + PortAssignment.unique() + ":"+ PortAssignment.unique()+ ";"+ CLIENT_PORT_QP1+ "\nserver.2=127.0.0.1:"+ PortAssignment.unique()+ ":"+ PortAssignment.unique()+ ";"+ CLIENT_PORT_QP2;
  MainThread q1=new MainThread(1,CLIENT_PORT_QP1,quorumCfgSection);
  MainThread q2=new MainThread(2,CLIENT_PORT_QP2,quorumCfgSection);
  q1.start();
  q2.start();
  Assert.assertTrue("waiting for server 1 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP1,CONNECTION_TIMEOUT));
  Assert.assertTrue("waiting for server 2 being up",ClientBase.waitForServerUp("127.0.0.1:" + CLIENT_PORT_QP2,CONNECTION_TIMEOUT));
  QuorumPeer quorumPeer=q1.main.quorumPeer;
  int tickTime=quorumPeer.getTickTime();
  Assert.assertEquals("Default value of minimumSessionTimeOut is not considered",tickTime * 2,quorumPeer.getMinSessionTimeout());
  Assert.assertEquals("Default value of maximumSessionTimeOut is not considered",tickTime * 20,quorumPeer.getMaxSessionTimeout());
  ZooKeeper zk=new ZooKeeper("127.0.0.1:" + CLIENT_PORT_QP1,ClientBase.CONNECTION_TIMEOUT,this);
  waitForOne(zk,States.CONNECTED);
  zk.create("/foo_q1","foobar1".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertEquals(new String(zk.getData("/foo_q1",null,null)),"foobar1");
  zk.close();
  zk=new ZooKeeper("127.0.0.1:" + CLIENT_PORT_QP2,ClientBase.CONNECTION_TIMEOUT,this);
  waitForOne(zk,States.CONNECTED);
  zk.create("/foo_q2","foobar2".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Assert.assertEquals(new String(zk.getData("/foo_q2",null,null)),"foobar2");
  zk.close();
  q1.shutdown();
  q2.shutdown();
  Assert.assertTrue("waiting for server 1 down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_QP1,ClientBase.CONNECTION_TIMEOUT));
  Assert.assertTrue("waiting for server 2 down",ClientBase.waitForServerDown("127.0.0.1:" + CLIENT_PORT_QP2,ClientBase.CONNECTION_TIMEOUT));
}

</code></pre>

<br>
<pre class="type-5 type-2 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test the case of server with highest zxid not present at leader election and joining later.
 * This test case is for reproducing the issue and fixing the bug mentioned in ZOOKEEPER-1154
 * and ZOOKEEPER-1156.
 */
@Test public void testHighestZxidJoinLate() throws Exception {
  numServers=3;
  servers=LaunchServers(numServers);
  String path="/hzxidtest";
  int leader=-1;
  for (int i=0; i < numServers; i++) {
    if (servers.mt[i].main.quorumPeer.leader != null) {
      leader=i;
    }
  }
  Assert.assertTrue("There should be a leader",leader >= 0);
  int nonleader=(leader + 1) % numServers;
  byte[] input=new byte[1];
  input[0]=1;
  byte[] output;
  servers.zk[leader].create(path + leader,input,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  servers.zk[leader].create(path + nonleader,input,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  output=servers.zk[leader].getData(path + nonleader,false,null);
  for (int i=0; i < numServers; i++) {
    if (i != leader) {
      servers.mt[i].shutdown();
    }
  }
  input[0]=2;
  servers.zk[leader].setData(path + leader,input,-1,null,null);
  Thread.sleep(500);
  servers.mt[leader].shutdown();
  System.gc();
  waitForAll(servers.zk,States.CONNECTING);
  for (int i=0; i < numServers; i++) {
    if (i != leader) {
      servers.mt[i].start();
    }
  }
  waitForOne(servers.zk[nonleader],States.CONNECTED);
  output=servers.zk[nonleader].getData(path + leader,false,null);
  Assert.assertEquals("Expecting old value 1 since 2 isn't committed yet",output[0],1);
  servers.zk[nonleader].setData(path + nonleader,input,-1);
  servers.mt[leader].start();
  waitForOne(servers.zk[leader],States.CONNECTED);
  output=servers.zk[leader].getData(path + leader,false,null);
  Assert.assertEquals("Validating that the deposed leader has rolled back that change it had written",output[0],1);
  output=servers.zk[leader].getData(path + nonleader,false,null);
  Assert.assertEquals("Validating that the deposed leader caught up on changes it missed",output[0],2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.QuorumPeerTest </h4><pre class="type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
/** 
 * Test case for https://issues.apache.org/jira/browse/ZOOKEEPER-2301
 */
@Test public void testQuorumPeerListendOnSpecifiedClientIP() throws IOException {
  long myId=1;
  File dataDir=ClientBase.createTmpDir();
  int clientPort=PortAssignment.unique();
  String clientIP="127.0.0.2";
  Map<Long,QuorumServer> peersView=new HashMap<Long,QuorumServer>();
  peersView.put(Long.valueOf(myId),new QuorumServer(myId,new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress(clientIP,clientPort),LearnerType.PARTICIPANT));
  QuorumPeer peer1=new QuorumPeer(peersView,dataDir,dataDir,clientPort,electionAlg,myId,tickTime,initLimit,syncLimit);
  String hostString1=peer1.cnxnFactory.getLocalAddress().getHostString();
  assertEquals(clientIP,hostString1);
  peer1.shutdown();
  peersView.clear();
  clientPort=PortAssignment.unique();
  clientIP="127.0.0.3";
  peersView.put(Long.valueOf(myId),new QuorumServer(myId,new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress("127.0.0.1",PortAssignment.unique()),new InetSocketAddress(clientIP,clientPort),LearnerType.PARTICIPANT));
  QuorumPeer peer2=new QuorumPeer(peersView,dataDir,dataDir,clientPort,electionAlg,myId,tickTime,initLimit,syncLimit);
  String hostString2=peer2.cnxnFactory.getLocalAddress().getHostString();
  assertEquals(clientIP,hostString2);
  peer2.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.server.quorum.Zab1_0Test </h4><pre class="type-5 type-6 type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testNormalFollowerRun() throws Exception {
  testFollowerConversation(new FollowerConversation(){
    @Override public void converseWithFollower(    InputArchive ia,    OutputArchive oa,    Follower f) throws Exception {
      File tmpDir=File.createTempFile("test","dir",testData);
      tmpDir.delete();
      tmpDir.mkdir();
      File logDir=f.fzk.getTxnLogFactory().getDataDir().getParentFile();
      File snapDir=f.fzk.getTxnLogFactory().getSnapDir().getParentFile();
      try {
        Assert.assertEquals(0,f.self.getAcceptedEpoch());
        Assert.assertEquals(0,f.self.getCurrentEpoch());
        ZKDatabase zkDb=new ZKDatabase(new FileTxnSnapLog(tmpDir,tmpDir));
        final long firstZxid=ZxidUtils.makeZxid(1,1);
        zkDb.processTxn(new TxnHeader(13,1313,firstZxid,33,ZooDefs.OpCode.create),new CreateTxn("/foo","data1".getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,false,1));
        Stat stat=new Stat();
        Assert.assertEquals("data1",new String(zkDb.getData("/foo",stat,null)));
        QuorumPacket qp=new QuorumPacket();
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.FOLLOWERINFO,qp.getType());
        Assert.assertEquals(qp.getZxid(),0);
        LearnerInfo learnInfo=new LearnerInfo();
        ByteBufferInputStream.byteBuffer2Record(ByteBuffer.wrap(qp.getData()),learnInfo);
        Assert.assertEquals(learnInfo.getProtocolVersion(),0x10000);
        Assert.assertEquals(learnInfo.getServerid(),0);
        qp.setType(Leader.LEADERINFO);
        qp.setZxid(ZxidUtils.makeZxid(1,0));
        byte protoBytes[]=new byte[4];
        ByteBuffer.wrap(protoBytes).putInt(0x10000);
        qp.setData(protoBytes);
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACKEPOCH,qp.getType());
        Assert.assertEquals(0,qp.getZxid());
        Assert.assertEquals(ZxidUtils.makeZxid(0,0),ByteBuffer.wrap(qp.getData()).getInt());
        Assert.assertEquals(1,f.self.getAcceptedEpoch());
        Assert.assertEquals(0,f.self.getCurrentEpoch());
        qp.setType(Leader.SNAP);
        qp.setData(new byte[0]);
        qp.setZxid(zkDb.getDataTreeLastProcessedZxid());
        oa.writeRecord(qp,null);
        zkDb.serializeSnapshot(oa);
        oa.writeString("BenWasHere",null);
        qp.setType(Leader.NEWLEADER);
        qp.setZxid(ZxidUtils.makeZxid(1,0));
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACK,qp.getType());
        Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
        Assert.assertEquals(1,f.self.getAcceptedEpoch());
        Assert.assertEquals(1,f.self.getCurrentEpoch());
        Assert.assertEquals(firstZxid,f.fzk.getLastProcessedZxid());
        ZKDatabase zkDb2=new ZKDatabase(new FileTxnSnapLog(logDir,snapDir));
        long lastZxid=zkDb2.loadDataBase();
        Assert.assertEquals("data1",new String(zkDb2.getData("/foo",stat,null)));
        Assert.assertEquals(firstZxid,lastZxid);
        long proposalZxid=ZxidUtils.makeZxid(1,1000);
        proposeSetData(qp,proposalZxid,"data2",2);
        oa.writeRecord(qp,null);
        TrackerWatcher watcher=new TrackerWatcher();
        Assert.assertEquals("data1",new String(f.fzk.getZKDatabase().getData("/foo",stat,watcher)));
        qp.setType(Leader.COMMIT);
        qp.setZxid(proposalZxid);
        oa.writeRecord(qp,null);
        qp.setType(Leader.UPTODATE);
        qp.setZxid(0);
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACK,qp.getType());
        Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACK,qp.getType());
        Assert.assertEquals(proposalZxid,qp.getZxid());
        watcher.waitForChange();
        Assert.assertEquals("data2",new String(f.fzk.getZKDatabase().getData("/foo",stat,null)));
        zkDb2=new ZKDatabase(new FileTxnSnapLog(logDir,snapDir));
        lastZxid=zkDb2.loadDataBase();
        Assert.assertEquals("data2",new String(zkDb2.getData("/foo",stat,null)));
        Assert.assertEquals(proposalZxid,lastZxid);
      }
  finally {
        TestUtils.deleteFileRecursively(tmpDir);
      }
    }
    private void proposeSetData(    QuorumPacket qp,    long zxid,    String data,    int version) throws IOException {
      qp.setType(Leader.PROPOSAL);
      qp.setZxid(zxid);
      TxnHeader hdr=new TxnHeader(4,1414,qp.getZxid(),55,ZooDefs.OpCode.setData);
      SetDataTxn sdt=new SetDataTxn("/foo",data.getBytes(),version);
      ByteArrayOutputStream baos=new ByteArrayOutputStream();
      OutputArchive boa=BinaryOutputArchive.getArchive(baos);
      boa.writeRecord(hdr,null);
      boa.writeRecord(sdt,null);
      qp.setData(baos.toByteArray());
    }
  }
);
}

</code></pre>

<br>
<pre class="type-5 type-3 type-6 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLeaderInConnectingFollowers() throws Exception {
  File tmpDir=File.createTempFile("test","dir",testData);
  tmpDir.delete();
  tmpDir.mkdir();
  Leader leader=null;
  try {
    QuorumPeer peer=createQuorumPeer(tmpDir);
    leader=createLeader(tmpDir,peer);
    peer.leader=leader;
    peer.setAcceptedEpoch(5);
    FollowerMockThread f1=new FollowerMockThread(1,leader,true);
    FollowerMockThread f2=new FollowerMockThread(2,leader,true);
    f1.start();
    f2.start();
    f1.join(leader.self.getInitLimit() * leader.self.getTickTime() + 5000);
    f2.join(leader.self.getInitLimit() * leader.self.getTickTime() + 5000);
    try {
      long epoch=leader.getEpochToPropose(leader.self.getId(),leader.self.getAcceptedEpoch());
      Assert.assertEquals("leader got wrong epoch from getEpochToPropose",6,epoch);
    }
 catch (    Exception e) {
      Assert.fail("leader timed out in getEpochToPropose");
    }
  }
  finally {
    if (leader != null) {
      leader.shutdown("end of test");
    }
    TestUtils.deleteFileRecursively(tmpDir);
  }
}

</code></pre>

<br>
<pre class="type-5 type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNormalFollowerRunWithDiff() throws Exception {
  testFollowerConversation(new FollowerConversation(){
    @Override public void converseWithFollower(    InputArchive ia,    OutputArchive oa,    Follower f) throws Exception {
      File tmpDir=File.createTempFile("test","dir",testData);
      tmpDir.delete();
      tmpDir.mkdir();
      File logDir=f.fzk.getTxnLogFactory().getDataDir().getParentFile();
      File snapDir=f.fzk.getTxnLogFactory().getSnapDir().getParentFile();
      try {
        Assert.assertEquals(0,f.self.getAcceptedEpoch());
        Assert.assertEquals(0,f.self.getCurrentEpoch());
        ZKDatabase zkDb=new ZKDatabase(new FileTxnSnapLog(tmpDir,tmpDir));
        final long firstZxid=ZxidUtils.makeZxid(1,1);
        zkDb.processTxn(new TxnHeader(13,1313,firstZxid,33,ZooDefs.OpCode.create),new CreateTxn("/foo","data1".getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,false,1));
        Stat stat=new Stat();
        Assert.assertEquals("data1",new String(zkDb.getData("/foo",stat,null)));
        QuorumPacket qp=new QuorumPacket();
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.FOLLOWERINFO,qp.getType());
        Assert.assertEquals(qp.getZxid(),0);
        LearnerInfo learnInfo=new LearnerInfo();
        ByteBufferInputStream.byteBuffer2Record(ByteBuffer.wrap(qp.getData()),learnInfo);
        Assert.assertEquals(learnInfo.getProtocolVersion(),0x10000);
        Assert.assertEquals(learnInfo.getServerid(),0);
        qp.setType(Leader.LEADERINFO);
        qp.setZxid(ZxidUtils.makeZxid(1,0));
        byte protoBytes[]=new byte[4];
        ByteBuffer.wrap(protoBytes).putInt(0x10000);
        qp.setData(protoBytes);
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACKEPOCH,qp.getType());
        Assert.assertEquals(0,qp.getZxid());
        Assert.assertEquals(ZxidUtils.makeZxid(0,0),ByteBuffer.wrap(qp.getData()).getInt());
        Assert.assertEquals(1,f.self.getAcceptedEpoch());
        Assert.assertEquals(0,f.self.getCurrentEpoch());
        qp.setType(Leader.DIFF);
        qp.setData(new byte[0]);
        qp.setZxid(zkDb.getDataTreeLastProcessedZxid());
        oa.writeRecord(qp,null);
        final long createSessionZxid=ZxidUtils.makeZxid(1,2);
        proposeNewSession(qp,createSessionZxid,0x333);
        oa.writeRecord(qp,null);
        qp.setType(Leader.COMMIT);
        qp.setZxid(createSessionZxid);
        oa.writeRecord(qp,null);
        qp.setType(Leader.NEWLEADER);
        qp.setZxid(ZxidUtils.makeZxid(1,0));
        qp.setData(null);
        oa.writeRecord(qp,null);
        qp.setType(Leader.UPTODATE);
        qp.setZxid(0);
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACK,qp.getType());
        Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACK,qp.getType());
        Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
        Assert.assertEquals(1,f.self.getAcceptedEpoch());
        Assert.assertEquals(1,f.self.getCurrentEpoch());
        Assert.assertEquals(createSessionZxid,f.fzk.getLastProcessedZxid());
        ZKDatabase zkDb2=new ZKDatabase(new FileTxnSnapLog(logDir,snapDir));
        zkDb2.loadDataBase();
        LOG.info("zkdb2 sessions:" + zkDb2.getSessions());
        Assert.assertNotNull(zkDb2.getSessionWithTimeOuts().get(4L));
      }
  finally {
        TestUtils.deleteFileRecursively(tmpDir);
      }
    }
    private void proposeNewSession(    QuorumPacket qp,    long zxid,    long sessionId) throws IOException {
      qp.setType(Leader.PROPOSAL);
      qp.setZxid(zxid);
      TxnHeader hdr=new TxnHeader(4,1414,qp.getZxid(),55,ZooDefs.OpCode.createSession);
      CreateSessionTxn cst=new CreateSessionTxn(30000);
      ByteArrayOutputStream baos=new ByteArrayOutputStream();
      OutputArchive boa=BinaryOutputArchive.getArchive(baos);
      boa.writeRecord(hdr,null);
      boa.writeRecord(cst,null);
      qp.setData(baos.toByteArray());
    }
  }
);
}

</code></pre>

<br>
<pre class="type-5 type-6 type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
@Test public void testNormalObserverRun() throws Exception {
  testObserverConversation(new ObserverConversation(){
    @Override public void converseWithObserver(    InputArchive ia,    OutputArchive oa,    Observer o) throws Exception {
      File tmpDir=File.createTempFile("test","dir",testData);
      tmpDir.delete();
      tmpDir.mkdir();
      File logDir=o.zk.getTxnLogFactory().getDataDir().getParentFile();
      File snapDir=o.zk.getTxnLogFactory().getSnapDir().getParentFile();
      try {
        Assert.assertEquals(0,o.self.getAcceptedEpoch());
        Assert.assertEquals(0,o.self.getCurrentEpoch());
        ZKDatabase zkDb=new ZKDatabase(new FileTxnSnapLog(tmpDir,tmpDir));
        final long foo1Zxid=ZxidUtils.makeZxid(1,1);
        final long foo2Zxid=ZxidUtils.makeZxid(1,2);
        zkDb.processTxn(new TxnHeader(13,1313,foo1Zxid,33,ZooDefs.OpCode.create),new CreateTxn("/foo1","data1".getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,false,1));
        zkDb.processTxn(new TxnHeader(13,1313,foo2Zxid,33,ZooDefs.OpCode.create),new CreateTxn("/foo2","data1".getBytes(),ZooDefs.Ids.OPEN_ACL_UNSAFE,false,1));
        Stat stat=new Stat();
        Assert.assertEquals("data1",new String(zkDb.getData("/foo1",stat,null)));
        Assert.assertEquals("data1",new String(zkDb.getData("/foo2",stat,null)));
        QuorumPacket qp=new QuorumPacket();
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.OBSERVERINFO,qp.getType());
        Assert.assertEquals(qp.getZxid(),0);
        LearnerInfo learnInfo=new LearnerInfo();
        ByteBufferInputStream.byteBuffer2Record(ByteBuffer.wrap(qp.getData()),learnInfo);
        Assert.assertEquals(learnInfo.getProtocolVersion(),0x10000);
        Assert.assertEquals(learnInfo.getServerid(),0);
        qp.setType(Leader.LEADERINFO);
        qp.setZxid(ZxidUtils.makeZxid(1,0));
        byte protoBytes[]=new byte[4];
        ByteBuffer.wrap(protoBytes).putInt(0x10000);
        qp.setData(protoBytes);
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACKEPOCH,qp.getType());
        Assert.assertEquals(0,qp.getZxid());
        Assert.assertEquals(ZxidUtils.makeZxid(0,0),ByteBuffer.wrap(qp.getData()).getInt());
        Assert.assertEquals(1,o.self.getAcceptedEpoch());
        Assert.assertEquals(0,o.self.getCurrentEpoch());
        qp.setType(Leader.SNAP);
        qp.setData(new byte[0]);
        qp.setZxid(zkDb.getDataTreeLastProcessedZxid());
        oa.writeRecord(qp,null);
        zkDb.serializeSnapshot(oa);
        oa.writeString("BenWasHere",null);
        qp.setType(Leader.NEWLEADER);
        qp.setZxid(ZxidUtils.makeZxid(1,0));
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACK,qp.getType());
        Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
        Assert.assertEquals(1,o.self.getAcceptedEpoch());
        Assert.assertEquals(1,o.self.getCurrentEpoch());
        Assert.assertEquals(foo2Zxid,o.zk.getLastProcessedZxid());
        ZKDatabase zkDb2=new ZKDatabase(new FileTxnSnapLog(logDir,snapDir));
        long lastZxid=zkDb2.loadDataBase();
        Assert.assertEquals("data1",new String(zkDb2.getData("/foo1",stat,null)));
        Assert.assertEquals(foo2Zxid,lastZxid);
        TrackerWatcher watcher=new TrackerWatcher();
        Assert.assertEquals("data1",new String(o.zk.getZKDatabase().getData("/foo2",stat,watcher)));
        long proposalZxid=ZxidUtils.makeZxid(1,1000);
        proposeSetData(qp,"/foo1",proposalZxid,"data2",2);
        oa.writeRecord(qp,null);
        qp.setType(Leader.COMMIT);
        qp.setZxid(proposalZxid);
        oa.writeRecord(qp,null);
        long informZxid=ZxidUtils.makeZxid(1,1001);
        proposeSetData(qp,"/foo2",informZxid,"data2",2);
        qp.setType(Leader.INFORM);
        oa.writeRecord(qp,null);
        qp.setType(Leader.UPTODATE);
        qp.setZxid(0);
        oa.writeRecord(qp,null);
        readPacketSkippingPing(ia,qp);
        Assert.assertEquals(Leader.ACK,qp.getType());
        Assert.assertEquals(ZxidUtils.makeZxid(1,0),qp.getZxid());
        watcher.waitForChange();
        Assert.assertEquals("data2",new String(o.zk.getZKDatabase().getData("/foo1",stat,null)));
        Assert.assertEquals("data2",new String(o.zk.getZKDatabase().getData("/foo2",stat,null)));
        o.zk.shutdown();
        zkDb2=new ZKDatabase(new FileTxnSnapLog(logDir,snapDir));
        lastZxid=zkDb2.loadDataBase();
        Assert.assertEquals("data2",new String(zkDb2.getData("/foo1",stat,null)));
        Assert.assertEquals("data2",new String(zkDb2.getData("/foo2",stat,null)));
        Assert.assertEquals(informZxid,lastZxid);
      }
  finally {
        TestUtils.deleteFileRecursively(tmpDir);
      }
    }
    private void proposeSetData(    QuorumPacket qp,    String path,    long zxid,    String data,    int version) throws IOException {
      qp.setType(Leader.PROPOSAL);
      qp.setZxid(zxid);
      TxnHeader hdr=new TxnHeader(4,1414,qp.getZxid(),55,ZooDefs.OpCode.setData);
      SetDataTxn sdt=new SetDataTxn(path,data.getBytes(),version);
      ByteArrayOutputStream baos=new ByteArrayOutputStream();
      OutputArchive boa=BinaryOutputArchive.getArchive(baos);
      boa.writeRecord(hdr,null);
      boa.writeRecord(sdt,null);
      qp.setData(baos.toByteArray());
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ClientTest </h4><pre class="type-9 type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Register multiple watchers and verify that they all get notified and
 * in the right order.
 */
@Test public void testMutipleWatcherObjs() throws IOException, InterruptedException, KeeperException {
  ZooKeeper zk=createClient(new CountdownWatcher(),hostPort);
  try {
    MyWatcher watchers[]=new MyWatcher[100];
    MyWatcher watchers2[]=new MyWatcher[watchers.length];
    for (int i=0; i < watchers.length; i++) {
      watchers[i]=new MyWatcher();
      watchers2[i]=new MyWatcher();
      zk.create("/foo-" + i,("foodata" + i).getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    }
    Stat stat=new Stat();
    for (int i=0; i < watchers.length; i++) {
      Assert.assertNotNull(zk.getData("/foo-" + i,watchers[i],stat));
    }
    for (int i=0; i < watchers.length; i++) {
      Assert.assertNotNull(zk.exists("/foo-" + i,watchers[i]));
    }
    for (int i=0; i < watchers.length; i++) {
      zk.setData("/foo-" + i,("foodata2-" + i).getBytes(),-1);
      zk.setData("/foo-" + i,("foodata3-" + i).getBytes(),-1);
    }
    for (int i=0; i < watchers.length; i++) {
      WatchedEvent event=watchers[i].events.poll(10,TimeUnit.SECONDS);
      Assert.assertEquals("/foo-" + i,event.getPath());
      Assert.assertEquals(EventType.NodeDataChanged,event.getType());
      Assert.assertEquals(KeeperState.SyncConnected,event.getState());
      Assert.assertEquals(0,watchers[i].events.size());
    }
    for (int i=0; i < watchers.length; i++) {
      Assert.assertNotNull(zk.getData("/foo-" + i,watchers[i],stat));
      Assert.assertNotNull(zk.exists("/foo-" + i,watchers[i]));
    }
    for (int i=0; i < watchers.length; i++) {
      zk.setData("/foo-" + i,("foodata4-" + i).getBytes(),-1);
      zk.setData("/foo-" + i,("foodata5-" + i).getBytes(),-1);
    }
    for (int i=0; i < watchers.length; i++) {
      WatchedEvent event=watchers[i].events.poll(10,TimeUnit.SECONDS);
      Assert.assertEquals("/foo-" + i,event.getPath());
      Assert.assertEquals(EventType.NodeDataChanged,event.getType());
      Assert.assertEquals(KeeperState.SyncConnected,event.getState());
      Assert.assertEquals(0,watchers[i].events.size());
    }
    for (int i=0; i < watchers.length; i++) {
      Assert.assertNotNull(zk.getData("/foo-" + i,watchers[i],stat));
      Assert.assertNotNull(zk.exists("/foo-" + i,watchers2[i]));
    }
    for (int i=0; i < watchers.length; i++) {
      zk.setData("/foo-" + i,("foodata6-" + i).getBytes(),-1);
      zk.setData("/foo-" + i,("foodata7-" + i).getBytes(),-1);
    }
    for (int i=0; i < watchers.length; i++) {
      WatchedEvent event=watchers[i].events.poll(10,TimeUnit.SECONDS);
      Assert.assertEquals("/foo-" + i,event.getPath());
      Assert.assertEquals(EventType.NodeDataChanged,event.getType());
      Assert.assertEquals(KeeperState.SyncConnected,event.getState());
      Assert.assertEquals(0,watchers[i].events.size());
      WatchedEvent event2=watchers2[i].events.poll(10,TimeUnit.SECONDS);
      Assert.assertEquals("/foo-" + i,event2.getPath());
      Assert.assertEquals(EventType.NodeDataChanged,event2.getType());
      Assert.assertEquals(KeeperState.SyncConnected,event2.getState());
      Assert.assertEquals(0,watchers2[i].events.size());
    }
  }
  finally {
    if (zk != null) {
      zk.close();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.DisconnectedWatcherTest </h4><pre class="type-5 type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testChildWatcherAutoResetWithChroot() throws Exception {
  ZooKeeper zk1=createClient();
  zk1.create("/ch1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher watcher=new MyWatcher();
  ZooKeeper zk2=createClient(watcher,hostPort + "/ch1");
  zk2.getChildren("/",true);
  zk1.create("/youdontmatter1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk1.create("/ch1/youshouldmatter1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  WatchedEvent e=watcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
  Assert.assertNotNull(e);
  Assert.assertEquals(EventType.NodeChildrenChanged,e.getType());
  Assert.assertEquals("/",e.getPath());
  MyWatcher childWatcher=new MyWatcher();
  zk2.getChildren("/",childWatcher);
  stopServer();
  watcher.waitForDisconnected(3000);
  startServer();
  watcher.waitForConnected(3000);
  zk1.create("/ch1/youshouldmatter2",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  e=childWatcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
  Assert.assertNotNull(e);
  Assert.assertEquals(EventType.NodeChildrenChanged,e.getType());
  Assert.assertEquals("/",e.getPath());
}

</code></pre>

<br>
<pre class="type-5 type-10 type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testManyChildWatchersAutoReset() throws Exception {
  ZooKeeper zk1=createClient();
  MyWatcher watcher=new MyWatcher();
  ZooKeeper zk2=createClient(watcher);
  String pathBase="/long-path-000000000-111111111-222222222-333333333-444444444-" + "555555555-666666666-777777777-888888888-999999999";
  zk1.create(pathBase,null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  List<String> paths=new ArrayList<String>();
  for (int i=0; i < 10000; i++) {
    String path=zk1.create(pathBase + "/ch-",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
    paths.add(path);
  }
  MyWatcher childWatcher=new MyWatcher();
  int i=0;
  for (  String path : paths) {
    if (i % 3 == 0) {
      zk2.getChildren(path,childWatcher);
    }
 else     if (i % 3 == 1) {
      zk2.exists(path + "/foo",childWatcher);
    }
 else     if (i % 3 == 2) {
      zk2.getData(path,childWatcher,null);
    }
    i++;
  }
  stopServer();
  watcher.waitForDisconnected(30000);
  startServer();
  watcher.waitForConnected(30000);
  i=0;
  for (  String path : paths) {
    if (i % 3 == 0) {
      zk1.create(path + "/ch",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
      WatchedEvent e=childWatcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
      Assert.assertNotNull(e);
      Assert.assertEquals(EventType.NodeChildrenChanged,e.getType());
      Assert.assertEquals(path,e.getPath());
    }
 else     if (i % 3 == 1) {
      zk1.create(path + "/foo",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
      WatchedEvent e=childWatcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
      Assert.assertNotNull(e);
      Assert.assertEquals(EventType.NodeCreated,e.getType());
      Assert.assertEquals(path + "/foo",e.getPath());
    }
 else     if (i % 3 == 2) {
      zk1.setData(path,new byte[]{1,2,3},-1);
      WatchedEvent e=childWatcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
      Assert.assertNotNull(e);
      Assert.assertEquals(EventType.NodeDataChanged,e.getType());
      Assert.assertEquals(path,e.getPath());
    }
    i++;
  }
}

</code></pre>

<br>
<pre class="type-5 type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDefaultWatcherAutoResetWithChroot() throws Exception {
  ZooKeeper zk1=createClient();
  zk1.create("/ch1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher watcher=new MyWatcher();
  ZooKeeper zk2=createClient(watcher,hostPort + "/ch1");
  zk2.getChildren("/",true);
  zk1.create("/youdontmatter1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk1.create("/ch1/youshouldmatter1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  WatchedEvent e=watcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
  Assert.assertNotNull(e);
  Assert.assertEquals(EventType.NodeChildrenChanged,e.getType());
  Assert.assertEquals("/",e.getPath());
  zk2.getChildren("/",true);
  stopServer();
  watcher.waitForDisconnected(3000);
  startServer();
  watcher.waitForConnected(3000);
  zk1.create("/ch1/youshouldmatter2",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  e=watcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
  Assert.assertNotNull(e);
  Assert.assertEquals(EventType.NodeChildrenChanged,e.getType());
  Assert.assertEquals("/",e.getPath());
}

</code></pre>

<br>
<pre class="type-5 type-6 type-8 type-4 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeepChildWatcherAutoResetWithChroot() throws Exception {
  ZooKeeper zk1=createClient();
  zk1.create("/ch1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk1.create("/ch1/here",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk1.create("/ch1/here/we",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk1.create("/ch1/here/we/are",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher watcher=new MyWatcher();
  ZooKeeper zk2=createClient(watcher,hostPort + "/ch1/here/we");
  zk2.getChildren("/are",true);
  zk1.create("/ch1/here/we/are/now",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  WatchedEvent e=watcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
  Assert.assertNotNull(e);
  Assert.assertEquals(EventType.NodeChildrenChanged,e.getType());
  Assert.assertEquals("/are",e.getPath());
  MyWatcher childWatcher=new MyWatcher();
  zk2.getChildren("/are",childWatcher);
  stopServer();
  watcher.waitForDisconnected(3000);
  startServer();
  watcher.waitForConnected(3000);
  zk1.create("/ch1/here/we/are/again",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  e=childWatcher.events.poll(TIMEOUT,TimeUnit.MILLISECONDS);
  Assert.assertNotNull(e);
  Assert.assertEquals(EventType.NodeChildrenChanged,e.getType());
  Assert.assertEquals("/are",e.getPath());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.QuorumTest </h4><pre class="type-2 type-8 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLeaderShutdown() throws IOException, InterruptedException, KeeperException {
  ZooKeeper zk=new DisconnectableZooKeeper(qb.hostPort,ClientBase.CONNECTION_TIMEOUT,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  zk.create("/blah",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.create("/blah/blah",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  Leader leader=qb.s1.leader;
  if (leader == null)   leader=qb.s2.leader;
  if (leader == null)   leader=qb.s3.leader;
  if (leader == null)   leader=qb.s4.leader;
  if (leader == null)   leader=qb.s5.leader;
  Assert.assertNotNull(leader);
  for (int i=0; i < 5000; i++) {
    zk.setData("/blah/blah",new byte[0],-1,new AsyncCallback.StatCallback(){
      public void processResult(      int rc,      String path,      Object ctx,      Stat stat){
        counter++;
        if (rc != 0) {
          errors++;
        }
      }
    }
,null);
  }
  for (  LearnerHandler f : leader.getForwardingFollowers()) {
    f.getSocket().shutdownInput();
  }
  for (int i=0; i < 5000; i++) {
    zk.setData("/blah/blah",new byte[0],-1,new AsyncCallback.StatCallback(){
      public void processResult(      int rc,      String path,      Object ctx,      Stat stat){
        counter++;
        if (rc != 0) {
          errors++;
        }
      }
    }
,null);
  }
  Assert.assertTrue(qb.s1.isAlive());
  Assert.assertTrue(qb.s2.isAlive());
  Assert.assertTrue(qb.s3.isAlive());
  Assert.assertTrue(qb.s4.isAlive());
  Assert.assertTrue(qb.s5.isAlive());
  zk.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.QuorumZxidSyncTest </h4><pre class="type-2 type-6 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies values related to public fields.
"></span><br>
/** 
 * find out what happens when a follower connects to leader that is behind
 */
@Test public void testBehindLeader() throws Exception {
  ClientBase.waitForServerUp(qb.hostPort,10000);
  ClientBase.waitForServerUp(qb.hostPort,10000);
  ZooKeeper zk=new ZooKeeper(qb.hostPort,10000,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  zk.create("/0",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.close();
  qb.shutdownServers();
  qb.startServers();
  ClientBase.waitForServerUp(qb.hostPort,10000);
  qb.shutdownServers();
  qb.startServers();
  ClientBase.waitForServerUp(qb.hostPort,10000);
  zk=new ZooKeeper(qb.hostPort,10000,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  zk.create("/1",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.close();
  qb.shutdownServers();
  qb.startServers();
  ClientBase.waitForServerUp(qb.hostPort,10000);
  qb.shutdownServers();
  qb.startServers();
  ClientBase.waitForServerUp(qb.hostPort,10000);
  zk=new ZooKeeper(qb.hostPort,10000,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  zk.create("/2",new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.close();
  qb.shutdownServers();
  deleteFiles(qb.s1dir);
  deleteFiles(qb.s2dir);
  deleteFiles(qb.s3dir);
  deleteFiles(qb.s4dir);
  qb.setupServers();
  qb.s1.start();
  qb.s2.start();
  qb.s3.start();
  qb.s4.start();
  Assert.assertTrue("Servers didn't come up",ClientBase.waitForServerUp(qb.hostPort,10000));
  qb.s5.start();
  String hostPort="127.0.0.1:" + qb.s5.getClientPort();
  Assert.assertFalse("Servers came up, but shouldn't have since it's ahead of leader",ClientBase.waitForServerUp(hostPort,10000));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.RepeatStartupTest </h4><pre class="type-5 type-2 type-6 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies values related to public fields.
"></span><br>
/** 
 * bring up 5 quorum peers and then shut them down
 * and then bring one of the nodes as server
 * @throws Exception might be thrown here
 */
@Test public void testFail() throws Exception {
  QuorumBase qb=new QuorumBase();
  qb.setUp();
  System.out.println("Comment: the servers are at " + qb.hostPort);
  ZooKeeper zk=qb.createClient();
  zk.create("/test",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  zk.close();
  QuorumBase.shutdown(qb.s1);
  QuorumBase.shutdown(qb.s2);
  QuorumBase.shutdown(qb.s3);
  QuorumBase.shutdown(qb.s4);
  QuorumBase.shutdown(qb.s5);
  String hp=qb.hostPort.split(",")[0];
  ZooKeeperServer zks=new ZooKeeperServer(qb.s1.getTxnFactory().getSnapDir(),qb.s1.getTxnFactory().getDataDir(),3000);
  final int PORT=Integer.parseInt(hp.split(":")[1]);
  ServerCnxnFactory factory=ServerCnxnFactory.createFactory(PORT,-1);
  factory.startup(zks);
  System.out.println("Comment: starting factory");
  Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp("127.0.0.1:" + PORT,QuorumTest.CONNECTION_TIMEOUT));
  factory.shutdown();
  zks.shutdown();
  Assert.assertTrue("waiting for server down",ClientBase.waitForServerDown("127.0.0.1:" + PORT,QuorumTest.CONNECTION_TIMEOUT));
  System.out.println("Comment: shutting down standalone");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.WatcherTest </h4><pre class="type-9 type-6 type-4 type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
"></span><br>
/** 
 * Verify that we get all of the events we expect to get. This particular
 * case verifies that we see all of the data events on a particular node.
 * There was a bug (ZOOKEEPER-137) that resulted in events being dropped
 * in some cases (timing).
 * @throws IOException
 * @throws InterruptedException
 * @throws KeeperException
 */
@Test public void testWatcherCorrectness() throws IOException, InterruptedException, KeeperException {
  ZooKeeper zk=null;
  try {
    MyWatcher watcher=new MyWatcher();
    zk=createClient(watcher,hostPort);
    StatCallback scb=new StatCallback(){
      public void processResult(      int rc,      String path,      Object ctx,      Stat stat){
      }
    }
;
    VoidCallback vcb=new VoidCallback(){
      public void processResult(      int rc,      String path,      Object ctx){
      }
    }
;
    String names[]=new String[10];
    for (int i=0; i < names.length; i++) {
      String name=zk.create("/tc-","initialvalue".getBytes(),Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT_SEQUENTIAL);
      names[i]=name;
      Stat stat=new Stat();
      zk.getData(name,watcher,stat);
      zk.setData(name,"new".getBytes(),stat.getVersion(),scb,null);
      stat=zk.exists(name,watcher);
      zk.delete(name,stat.getVersion(),vcb,null);
    }
    for (int i=0; i < names.length; i++) {
      String name=names[i];
      WatchedEvent event=watcher.events.poll(10,TimeUnit.SECONDS);
      Assert.assertEquals(name,event.getPath());
      Assert.assertEquals(Event.EventType.NodeDataChanged,event.getType());
      Assert.assertEquals(Event.KeeperState.SyncConnected,event.getState());
      event=watcher.events.poll(10,TimeUnit.SECONDS);
      Assert.assertEquals(name,event.getPath());
      Assert.assertEquals(Event.EventType.NodeDeleted,event.getType());
      Assert.assertEquals(Event.KeeperState.SyncConnected,event.getState());
    }
  }
  finally {
    if (zk != null) {
      zk.close();
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.zookeeper.test.ZkDatabaseCorruptionTest </h4><pre class="type-9 type-10 type-2 type-6 type-8 type-14 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCorruption() throws Exception {
  ClientBase.waitForServerUp(qb.hostPort,10000);
  ClientBase.waitForServerUp(qb.hostPort,10000);
  ZooKeeper zk=new ZooKeeper(qb.hostPort,10000,new Watcher(){
    public void process(    WatchedEvent event){
    }
  }
);
  SyncRequestProcessor.setSnapCount(100);
  for (int i=0; i < 2000; i++) {
    zk.create("/0-" + i,new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT,new NoopStringCallback(),null);
  }
  zk.close();
  long leaderSid=1;
  QuorumPeer leader=null;
  for (  QuorumPeer quorumPeer : Arrays.asList(qb.s1,qb.s2,qb.s3,qb.s4,qb.s5)) {
    if (quorumPeer.getPeerState() == ServerState.LEADING) {
      leader=quorumPeer;
      break;
    }
    ++leaderSid;
  }
  Assert.assertNotNull("Cannot find the leader.",leader);
  leader.shutdown();
  FileTxnSnapLog snapLog=leader.getTxnFactory();
  File snapDir=snapLog.getSnapDir();
  corruptAllSnapshots(snapDir);
  qb.shutdownServers();
  qb.setupServers();
  if (leaderSid != 1)   qb.s1.start();
 else   leader=qb.s1;
  if (leaderSid != 2)   qb.s2.start();
 else   leader=qb.s2;
  if (leaderSid != 3)   qb.s3.start();
 else   leader=qb.s3;
  if (leaderSid != 4)   qb.s4.start();
 else   leader=qb.s4;
  if (leaderSid != 5)   qb.s5.start();
 else   leader=qb.s5;
  try {
    leader.start();
    Assert.assertTrue(false);
  }
 catch (  RuntimeException re) {
    LOG.info("Got an error: expected",re);
  }
  String[] list=qb.hostPort.split(",");
  for (int i=0; i < 5; i++) {
    if (leaderSid != (i + 1)) {
      String hp=list[i];
      Assert.assertTrue("waiting for server up",ClientBase.waitForServerUp(hp,CONNECTION_TIMEOUT));
      LOG.info("{} is accepting client connections",hp);
    }
 else {
      LOG.info("Skipping the leader");
    }
  }
  zk=qb.createClient();
  SyncRequestProcessor.setSnapCount(100);
  for (int i=2000; i < 4000; i++) {
    zk.create("/0-" + i,new byte[0],ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT,new NoopStringCallback(),null);
  }
  zk.close();
  if (leaderSid != 1)   QuorumBase.shutdown(qb.s1);
  if (leaderSid != 2)   QuorumBase.shutdown(qb.s2);
  if (leaderSid != 3)   QuorumBase.shutdown(qb.s3);
  if (leaderSid != 4)   QuorumBase.shutdown(qb.s4);
  if (leaderSid != 5)   QuorumBase.shutdown(qb.s5);
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
