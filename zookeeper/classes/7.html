<h3 style="margin:0px">Class: org.apache.zookeeper.RemoveWatchesTest (23 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(21)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(20)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(20)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(15)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(14)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(13)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(4)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-5 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies removal of multiple data watchers when there is server
 * connection
 */
@Test(timeout=90000) public void testMultipleDataWatchers() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  MyWatcher w1=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
  removeWatches(zk2,"/node1",w2,WatcherType.Data,false,Code.OK);
  Assert.assertEquals("Didn't find data watcher",1,zk2.getDataWatches().size());
  Assert.assertEquals("Didn't find data watcher","/node1",zk2.getDataWatches().get(0));
  removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove data watcher",w2.matches());
  if (zk1 != null) {
    zk1.close();
    zk1=null;
  }
  List<EventType> events=w2.getEventsAfterWatchRemoval();
  Assert.assertEquals("Shouldn't get NodeDeletedEvent after watch removal",0,events.size());
}

</code></pre>

<pre class="type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Any - removes only the configured child watcher
 * function
 */
@Test(timeout=90000) public void testRemoveAnyChildWatcher() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",2);
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w2);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w1);
  removeWatches(zk2,"/node1",w2,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
  Assert.assertEquals("Didn't find child watcher",1,zk2.getChildWatches().size());
  Assert.assertEquals("Didn't find data watcher",1,zk2.getDataWatches().size());
  removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove watchers",w1.matches());
}

</code></pre>

<pre class="type-3 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies given watcher doesn't exists!
 */
@Test(timeout=90000) public void testNoWatcherException() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",2);
  MyWatcher w2=new MyWatcher("/node1",2);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNull("Didn't set data watches",zk2.exists("/node2",w2));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w2);
  MyWatcher w3=new MyWatcher("/node1",2);
  try {
    removeWatches(zk2,"/node1",w3,WatcherType.Any,false,Code.NOWATCHER);
    Assert.fail("Should throw exception as given watcher doesn't exists");
  }
 catch (  KeeperException.NoWatcherException nwe) {
  }
  try {
    removeWatches(zk2,"/node1",w3,WatcherType.Children,false,Code.NOWATCHER);
    Assert.fail("Should throw exception as given watcher doesn't exists");
  }
 catch (  KeeperException.NoWatcherException nwe) {
  }
  try {
    removeWatches(zk2,"/node1",w3,WatcherType.Data,false,Code.NOWATCHER);
    Assert.fail("Should throw exception as given watcher doesn't exists");
  }
 catch (  KeeperException.NoWatcherException nwe) {
  }
  try {
    removeWatches(zk2,"/nonexists",w3,WatcherType.Data,false,Code.NOWATCHER);
    Assert.fail("Should throw exception as given watcher doesn't exists");
  }
 catch (  KeeperException.NoWatcherException nwe) {
  }
}

</code></pre>

<pre class="type-5 type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Data - removes only the configured data watcher
 * function
 */
@Test(timeout=90000) public void testRemoveAllDataWatchesOnAPath() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  final CountDownLatch dWatchCount=new CountDownLatch(2);
  final CountDownLatch rmWatchCount=new CountDownLatch(2);
  Watcher w1=new Watcher(){
    @Override public void process(    WatchedEvent event){
switch (event.getType()) {
case DataWatchRemoved:
        rmWatchCount.countDown();
      break;
case NodeDataChanged:
    dWatchCount.countDown();
  break;
default :
break;
}
}
}
;
Watcher w2=new Watcher(){
@Override public void process(WatchedEvent event){
switch (event.getType()) {
case DataWatchRemoved:
rmWatchCount.countDown();
break;
case NodeDataChanged:
dWatchCount.countDown();
break;
default :
break;
}
}
}
;
LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
Assert.assertTrue("Server session is not a watcher",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Data));
removeAllWatches(zk2,"/node1",WatcherType.Data,false,Code.OK);
Assert.assertTrue("Didn't remove data watcher",rmWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
Assert.assertFalse("Server session is still a watcher after removal",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Data));
}

</code></pre>

<pre class="type-5 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies null watcher with WatcherType.Data - remove all data
 * watchers. Child watchers shouldn't be removed
 */
@Test(timeout=90000) public void testRemoveAllDataWatchers() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",1);
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w2);
  removeWatches(zk2,"/node1",w1,WatcherType.Data,false,Code.OK);
  removeWatches(zk2,"/node1",w2,WatcherType.Data,false,Code.OK);
  zk1.create("/node1/child",null,Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  Assert.assertTrue("Didn't remove data watcher",w1.matches());
  Assert.assertTrue("Didn't remove data watcher",w2.matches());
  int count=10;
  while (count > 0) {
    if (w1.getEventsAfterWatchRemoval().size() > 0 && w2.getEventsAfterWatchRemoval().size() > 0) {
      break;
    }
    count--;
    Thread.sleep(1000);
  }
  List<EventType> events=w1.getEventsAfterWatchRemoval();
  Assert.assertEquals("Didn't get NodeChildrenChanged event",1,events.size());
  Assert.assertTrue("Didn't get NodeChildrenChanged event",events.contains(EventType.NodeChildrenChanged));
  events=w2.getEventsAfterWatchRemoval();
  Assert.assertEquals("Didn't get NodeChildrenChanged event",1,events.size());
  Assert.assertTrue("Didn't get NodeChildrenChanged event",events.contains(EventType.NodeChildrenChanged));
}

</code></pre>

<pre class="type-9 type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies removal of many watchers locally when no connection and
 * WatcherType#Any. Also, verifies internal watchManager datastructures
 */
@Test(timeout=90000) public void testManyWatchersWhenNoConnection() throws Exception {
  int count=3;
  List<MyWatcher> wList=new ArrayList<MyWatcher>(count);
  MyWatcher w;
  String path="/node";
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    zk1.create(nodePath,null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    nodePath+="/";
  }
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    w=new MyWatcher(path + i,2);
    wList.add(w);
    LOG.info("Adding child watcher {} on path {}",new Object[]{w,nodePath});
    zk1.getChildren(nodePath,w);
    nodePath+="/";
  }
  Assert.assertEquals("Failed to add watchers!",count,zk1.getChildWatches().size());
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    w=wList.get(i);
    LOG.info("Adding data watcher {} on path {}",new Object[]{w,nodePath});
    zk1.getData(nodePath,w,null);
    nodePath+="/";
  }
  Assert.assertEquals("Failed to add watchers!",count,zk1.getDataWatches().size());
  stopServer();
  for (int i=0; i < count; i++) {
    final MyWatcher watcher=wList.get(i);
    removeWatches(zk1,path + i,watcher,WatcherType.Any,true,Code.OK);
    Assert.assertTrue("Didn't remove watcher",watcher.matches());
  }
  Assert.assertEquals("Didn't remove watch references!",0,zk1.getChildWatches().size());
  Assert.assertEquals("Didn't remove watch references!",0,zk1.getDataWatches().size());
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Test verifies given watcher doesn't exists!
 */
@Test(timeout=90000) public void testRemoveAllNoWatcherException() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  try {
    removeAllWatches(zk2,"/node1",WatcherType.Any,false,Code.NOWATCHER);
    Assert.fail("Should throw exception as given watcher doesn't exists");
  }
 catch (  KeeperException.NoWatcherException nwe) {
  }
}

</code></pre>

<pre class="type-5 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies removal of single watcher when there is server connection
 */
@Test(timeout=90000) public void testRemoveSingleWatcher() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  zk1.create("/node2",null,Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  MyWatcher w1=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  MyWatcher w2=new MyWatcher("/node2",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node2",w2));
  removeWatches(zk2,"/node1",w1,WatcherType.Data,false,Code.OK);
  Assert.assertEquals("Didn't find data watcher",1,zk2.getDataWatches().size());
  Assert.assertEquals("Didn't find data watcher","/node2",zk2.getDataWatches().get(0));
  removeWatches(zk2,"/node2",w2,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove data watcher",w2.matches());
  if (zk1 != null) {
    zk1.close();
    zk1=null;
  }
  List<EventType> events=w1.getEventsAfterWatchRemoval();
  Assert.assertFalse("Shouldn't get NodeDeletedEvent after watch removal",events.contains(EventType.NodeDeleted));
  Assert.assertEquals("Shouldn't get NodeDeletedEvent after watch removal",0,events.size());
}

</code></pre>

<pre class="type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Children - removes only the configured child
 * watcher function
 */
@Test(timeout=90000) public void testRemoveAllChildWatchesOnAPath() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  final CountDownLatch cWatchCount=new CountDownLatch(2);
  final CountDownLatch rmWatchCount=new CountDownLatch(2);
  Watcher w1=new Watcher(){
    @Override public void process(    WatchedEvent event){
switch (event.getType()) {
case ChildWatchRemoved:
        rmWatchCount.countDown();
      break;
case NodeChildrenChanged:
    cWatchCount.countDown();
  break;
default :
break;
}
}
}
;
Watcher w2=new Watcher(){
@Override public void process(WatchedEvent event){
switch (event.getType()) {
case ChildWatchRemoved:
rmWatchCount.countDown();
break;
case NodeChildrenChanged:
cWatchCount.countDown();
break;
default :
break;
}
}
}
;
LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w1).size());
LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w2).size());
Assert.assertTrue("Server session is not a watcher",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Children));
removeAllWatches(zk2,"/node1",WatcherType.Children,false,Code.OK);
Assert.assertTrue("Didn't remove child watcher",rmWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
Assert.assertFalse("Server session is still a watcher after removal",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Children));
}

</code></pre>

<pre class="type-5 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies null watcher with WatcherType.Children - remove all child
 * watchers. Data watchers shouldn't be removed
 */
@Test(timeout=90000) public void testRemoveAllChildWatchers() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",1);
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w2);
  removeWatches(zk2,"/node1",w1,WatcherType.Children,false,Code.OK);
  removeWatches(zk2,"/node1",w2,WatcherType.Children,false,Code.OK);
  zk1.setData("/node1","test".getBytes(),-1);
  Assert.assertTrue("Didn't remove child watcher",w1.matches());
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
  int count=10;
  while (count > 0) {
    if (w1.getEventsAfterWatchRemoval().size() > 0 && w2.getEventsAfterWatchRemoval().size() > 0) {
      break;
    }
    count--;
    Thread.sleep(1000);
  }
  List<EventType> events=w1.getEventsAfterWatchRemoval();
  Assert.assertEquals("Didn't get NodeDataChanged event",1,events.size());
  Assert.assertTrue("Didn't get NodeDataChanged event",events.contains(EventType.NodeDataChanged));
  events=w2.getEventsAfterWatchRemoval();
  Assert.assertEquals("Didn't get NodeDataChanged event",1,events.size());
  Assert.assertTrue("Didn't get NodeDataChanged event",events.contains(EventType.NodeDataChanged));
}

</code></pre>

<pre class="type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies removing watcher having namespace
 */
@Test(timeout=90000) public void testChRootRemoveWatcher() throws Exception {
  String chRoot="/appsX";
  zk1.create("/appsX",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  if (zk1 != null) {
    zk1.close();
  }
  if (zk2 != null) {
    zk2.close();
  }
  zk1=createClient(this.hostPort + chRoot);
  zk2=createClient(this.hostPort + chRoot);
  LOG.info("Creating child znode /node1 using chRoot client");
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",2);
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w2);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w1);
  removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w1.matches());
  Assert.assertEquals("Didn't find child watcher",1,zk2.getChildWatches().size());
  removeWatches(zk2,"/node1",w2,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
}

</code></pre>

<pre class="type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Any - removes only the configured data watcher
 * function
 */
@Test(timeout=90000) public void testRemoveAnyDataWatcher() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",1);
  MyWatcher w2=new MyWatcher("/node1",2);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w2);
  removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove data watcher",w1.matches());
  Assert.assertEquals("Didn't find child watcher",1,zk2.getChildWatches().size());
  Assert.assertEquals("Didn't find data watcher",1,zk2.getDataWatches().size());
  removeWatches(zk2,"/node1",w2,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
}

</code></pre>

<pre class="type-9 type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies many child watchers. Also, verifies internal datastructure
 * 'watchManager.childWatches'
 */
@Test(timeout=90000) public void testManyChildWatchers() throws Exception {
  int count=50;
  List<MyWatcher> wList=new ArrayList<MyWatcher>(count);
  MyWatcher w;
  String path="/node";
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    zk1.create(nodePath,null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    nodePath+="/";
  }
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    w=new MyWatcher(path + i,1);
    wList.add(w);
    LOG.info("Adding child watcher {} on path {}",new Object[]{w,nodePath});
    zk1.getChildren(nodePath,w);
    nodePath+="/";
  }
  Assert.assertEquals("Failed to add watchers!",count,zk1.getChildWatches().size());
  for (int i=0; i < count; i++) {
    final MyWatcher watcher=wList.get(i);
    removeWatches(zk1,path + i,watcher,WatcherType.Children,false,Code.OK);
    Assert.assertTrue("Didn't remove child watcher",watcher.matches());
  }
  Assert.assertEquals("Didn't remove watch references!",0,zk1.getChildWatches().size());
}

</code></pre>

<pre class="type-5 type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Data - removes only the configured data watcher
 * function
 */
@Test(timeout=90000) public void testRemoveWhenMultipleDataWatchesOnAPath() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  final CountDownLatch dataWatchCount=new CountDownLatch(1);
  final CountDownLatch rmWatchCount=new CountDownLatch(1);
  Watcher w1=new Watcher(){
    @Override public void process(    WatchedEvent event){
      if (event.getType() == EventType.DataWatchRemoved) {
        rmWatchCount.countDown();
      }
    }
  }
;
  Watcher w2=new Watcher(){
    @Override public void process(    WatchedEvent event){
      if (event.getType() == EventType.NodeDataChanged) {
        dataWatchCount.countDown();
      }
    }
  }
;
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
  removeWatches(zk2,"/node1",w1,WatcherType.Data,false,Code.OK);
  Assert.assertTrue("Didn't remove data watcher",rmWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
  zk1.setData("/node1","test".getBytes(),-1);
  LOG.info("Waiting for data watchers to be notified");
  Assert.assertTrue("Didn't get data watch notification!",dataWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
}

</code></pre>

<pre class="type-3 type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies when there is no server connection. Remove watches when
 * local=true, otw should retain it
 */
@Test(timeout=90000) public void testRemoveWatcherWhenNoConnection() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",2);
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w2);
  stopServer();
  removeWatches(zk2,"/node1",w2,WatcherType.Any,true,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
  Assert.assertFalse("Shouldn't remove data watcher",w1.matches());
  try {
    removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.CONNECTIONLOSS);
    Assert.fail("Should throw exception as last watch removal requires server connection");
  }
 catch (  KeeperException.ConnectionLossException nwe) {
  }
  Assert.assertFalse("Shouldn't remove data watcher",w1.matches());
  removeWatches(zk2,"/node1",w1,WatcherType.Any,true,Code.OK);
  Assert.assertTrue("Didn't remove data watcher",w1.matches());
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Verify that if a given watcher doesn't exist, the server properly
 * returns an error code for it.
 * In our Java client implementation, we check that a given watch exists at
 * two points:
 * 1) before submitting the RemoveWatches request
 * 2) after a successful server response, when the watcher needs to be
 * removed
 * Since this can be racy (i.e. a watch can fire while a RemoveWatches
 * request is in-flight), we need to verify that the watch was actually
 * removed (i.e. from ZKDatabase and DataTree) and return NOWATCHER if
 * needed.
 * Also, other implementations might not do a client side check before
 * submitting a RemoveWatches request. If we don't do a server side check,
 * we would just return ZOK even if no watch was removed.
 */
@Test(timeout=90000) public void testNoWatcherServerException() throws InterruptedException, IOException, TimeoutException {
  CountdownWatcher watcher=new CountdownWatcher();
  MyZooKeeper zk=new MyZooKeeper(hostPort,CONNECTION_TIMEOUT,watcher);
  boolean nw=false;
  watcher.waitForConnected(CONNECTION_TIMEOUT);
  try {
    zk.removeWatches("/nowatchhere",watcher,WatcherType.Data,false);
  }
 catch (  KeeperException nwe) {
    if (nwe.code().intValue() == Code.NOWATCHER.intValue()) {
      nw=true;
    }
  }
  Assert.assertTrue("Server didn't return NOWATCHER",zk.getRemoveWatchesRC() == Code.NOWATCHER.intValue());
  Assert.assertTrue("NoWatcherException didn't happen",nw);
}

</code></pre>

<pre class="type-5 type-2 type-6 type-8 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Any - removes all the configured child,data
 * watcher functions
 */
@Test(timeout=90000) public void testRemoveAllWatchesOnAPath() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  final CountDownLatch watchCount=new CountDownLatch(2);
  final CountDownLatch rmWatchCount=new CountDownLatch(4);
  Watcher w1=new Watcher(){
    @Override public void process(    WatchedEvent event){
switch (event.getType()) {
case ChildWatchRemoved:
case DataWatchRemoved:
        rmWatchCount.countDown();
      break;
case NodeChildrenChanged:
case NodeDataChanged:
    watchCount.countDown();
  break;
default :
break;
}
}
}
;
Watcher w2=new Watcher(){
@Override public void process(WatchedEvent event){
switch (event.getType()) {
case ChildWatchRemoved:
case DataWatchRemoved:
rmWatchCount.countDown();
break;
case NodeChildrenChanged:
case NodeDataChanged:
watchCount.countDown();
break;
default :
break;
}
}
}
;
LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w1).size());
LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w2).size());
LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
Assert.assertTrue("Server session is not a watcher",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Data));
removeAllWatches(zk2,"/node1",WatcherType.Any,false,Code.OK);
Assert.assertTrue("Didn't remove data watcher",rmWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
Assert.assertFalse("Server session is still a watcher after removal",isServerSessionWatcher(zk2.getSessionId(),"/node1",WatcherType.Data));
Assert.assertEquals("Received watch notification after removal!",2,watchCount.getCount());
}

</code></pre>

<pre class="type-2 type-6 type-8 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies null watcher with WatcherType.Any - remove all the watchers
 * data, child, exists
 */
@Test(timeout=90000) public void testRemoveAllWatchers() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",2);
  MyWatcher w2=new MyWatcher("/node1",2);
  LOG.info("Adding data watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w1));
  LOG.info("Adding data watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertNotNull("Didn't set data watches",zk2.exists("/node1",w2));
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w2);
  removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.OK);
  removeWatches(zk2,"/node1",w2,WatcherType.Any,false,Code.OK);
  zk1.create("/node1/child",null,Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL);
  Assert.assertTrue("Didn't remove data watcher",w1.matches());
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
}

</code></pre>

<pre class="type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies WatcherType.Children - removes only the configured child
 * watcher function
 */
@Test(timeout=90000) public void testRemoveWhenMultipleChildWatchesOnAPath() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  final CountDownLatch childWatchCount=new CountDownLatch(1);
  final CountDownLatch rmWatchCount=new CountDownLatch(1);
  Watcher w1=new Watcher(){
    @Override public void process(    WatchedEvent event){
      if (event.getType() == EventType.ChildWatchRemoved) {
        rmWatchCount.countDown();
      }
    }
  }
;
  Watcher w2=new Watcher(){
    @Override public void process(    WatchedEvent event){
      if (event.getType() == EventType.NodeChildrenChanged) {
        childWatchCount.countDown();
      }
    }
  }
;
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w1).size());
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  Assert.assertEquals("Didn't set child watches",0,zk2.getChildren("/node1",w2).size());
  removeWatches(zk2,"/node1",w1,WatcherType.Children,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",rmWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
  zk1.create("/node1/node2",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  LOG.info("Waiting for child watchers to be notified");
  Assert.assertTrue("Didn't get child watch notification!",childWatchCount.await(CONNECTION_TIMEOUT,TimeUnit.MILLISECONDS));
}

</code></pre>

<pre class="type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies removal of multiple child watchers when there is server
 * connection
 */
@Test(timeout=90000) public void testMultipleChildWatchers() throws IOException, InterruptedException, KeeperException {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  MyWatcher w1=new MyWatcher("/node1",1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w1,"/node1"});
  zk2.getChildren("/node1",w1);
  MyWatcher w2=new MyWatcher("/node1",1);
  LOG.info("Adding child watcher {} on path {}",new Object[]{w2,"/node1"});
  zk2.getChildren("/node1",w2);
  removeWatches(zk2,"/node1",w2,WatcherType.Children,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w2.matches());
  Assert.assertEquals("Didn't find child watcher",1,zk2.getChildWatches().size());
  removeWatches(zk2,"/node1",w1,WatcherType.Any,false,Code.OK);
  Assert.assertTrue("Didn't remove child watcher",w1.matches());
  zk1.create("/node1/node2",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  int count=30;
  while (count > 0) {
    if (w1.getEventsAfterWatchRemoval().size() > 0) {
      break;
    }
    count--;
    Thread.sleep(100);
  }
  List<EventType> events=w2.getEventsAfterWatchRemoval();
  Assert.assertEquals("Shouldn't get NodeChildrenChanged event",0,events.size());
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Test verifies null watcher
 */
@Test(timeout=30000) public void testNullWatcherReference() throws Exception {
  zk1.create("/node1",null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
  try {
    if (useAsync) {
      zk1.removeWatches("/node1",null,WatcherType.Data,false,null,null);
    }
 else {
      zk1.removeWatches("/node1",null,WatcherType.Data,false);
    }
    Assert.fail("Must throw IllegalArgumentException as watcher is null!");
  }
 catch (  IllegalArgumentException iae) {
  }
}

</code></pre>

<pre class="type-9 type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies many pre-node watchers. Also, verifies internal
 * datastructure 'watchManager.existWatches'
 */
@Test(timeout=90000) public void testManyPreNodeWatchers() throws Exception {
  int count=50;
  List<MyWatcher> wList=new ArrayList<MyWatcher>(count);
  MyWatcher w;
  String path="/node";
  for (int i=0; i < count; i++) {
    final String nodePath=path + i;
    w=new MyWatcher(nodePath,1);
    wList.add(w);
    LOG.info("Adding pre node watcher {} on path {}",new Object[]{w,nodePath});
    zk1.exists(nodePath,w);
  }
  Assert.assertEquals("Failed to add watchers!",count,zk1.getExistWatches().size());
  for (int i=0; i < count; i++) {
    final MyWatcher watcher=wList.get(i);
    removeWatches(zk1,path + i,watcher,WatcherType.Data,false,Code.OK);
    Assert.assertTrue("Didn't remove data watcher",watcher.matches());
  }
  Assert.assertEquals("Didn't remove watch references!",0,zk1.getExistWatches().size());
}

</code></pre>

<pre class="type-9 type-5 type-2 type-6 type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test verifies many data watchers. Also, verifies internal datastructure
 * 'watchManager.dataWatches'
 */
@Test(timeout=90000) public void testManyDataWatchers() throws Exception {
  int count=50;
  List<MyWatcher> wList=new ArrayList<MyWatcher>(count);
  MyWatcher w;
  String path="/node";
  for (int i=0; i < count; i++) {
    String nodePath=path + i;
    w=new MyWatcher(path + i,1);
    wList.add(w);
    zk1.create(nodePath,null,Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
    LOG.info("Adding data watcher {} on path {}",new Object[]{w,nodePath});
    zk1.getData(nodePath,w,null);
    nodePath+="/";
  }
  Assert.assertEquals("Failed to add watchers!",count,zk1.getDataWatches().size());
  for (int i=0; i < count; i++) {
    final MyWatcher watcher=wList.get(i);
    removeWatches(zk1,path + i,watcher,WatcherType.Data,false,Code.OK);
    Assert.assertTrue("Didn't remove data watcher",watcher.matches());
  }
  Assert.assertEquals("Didn't remove watch references!",0,zk1.getDataWatches().size());
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
