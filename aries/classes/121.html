<h3 style="margin:0px">Class: org.apache.aries.jndi.url.ServiceRegistryContextTest (16 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(6)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(6)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(6)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(5)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >ExceptionVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-10 type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Check that we get a NameNotFoundException if we lookup something not in the
 * registry.
 * @throws NamingException
 */
@Test(expected=NameNotFoundException.class) public void testLookupForServiceWeNeverHad() throws NamingException {
  BundleMock mock=new BundleMock("scooby.doo",new Properties());
  Thread.currentThread().setContextClassLoader(mock.getClassLoader());
  InitialContext ctx=new InitialContext();
  ctx.lookup("osgi:service/java.lang.Integer");
}

</code></pre>

<pre class="type-10 type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=ServiceException.class) public void checkProxyWhenServiceGoes() throws ServiceException, NamingException {
  BundleMock mock=new BundleMock("scooby.doo",new Properties());
  Thread.currentThread().setContextClassLoader(mock.getClassLoader());
  InitialContext ctx=new InitialContext();
  Runnable r=(Runnable)ctx.lookup("osgi:service/java.lang.Runnable");
  r.run();
  Skeleton.getSkeleton(service).assertCalled(new MethodCall(Runnable.class,"run"));
  reg.unregister();
  r.run();
}

</code></pre>

<pre class="type-5 type-8 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void checkServiceListLookup() throws NamingException {
  BundleMock mock=new BundleMock("scooby.doo",new Properties());
  Thread.currentThread().setContextClassLoader(mock.getClassLoader());
  InitialContext ctx=new InitialContext();
  String className=Runnable.class.getName();
  Runnable t=Skeleton.newMock(Runnable.class);
  reg.unregister();
  ServiceRegistration reg=bc.registerService(className,t,null);
  ServiceRegistration reg2=bc.registerService("java.lang.Thread",new Thread(),null);
  Context ctx2=(Context)ctx.lookup("osgi:servicelist/java.lang.Runnable");
  Runnable r=(Runnable)ctx2.lookup(String.valueOf(reg.getReference().getProperty(Constants.SERVICE_ID)));
  r.run();
  Skeleton.getSkeleton(t).assertCalled(new MethodCall(Runnable.class,"run"));
  reg.unregister();
  try {
    r.run();
    fail("Should have received a ServiceException");
  }
 catch (  ServiceException e) {
    assertEquals("service exception has the wrong type",ServiceException.UNREGISTERED,e.getType());
  }
  try {
    ctx2.lookup(String.valueOf(reg2.getReference().getProperty(Constants.SERVICE_ID)));
    fail("Expected a NameNotFoundException");
  }
 catch (  NameNotFoundException e) {
  }
}

</code></pre>

<pre class="type-4 type-3 type-7 type-1 type-8 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void checkServiceListListBindings() throws NamingException {
  BundleMock mock=new BundleMock("scooby.doo",new Properties());
  Thread.currentThread().setContextClassLoader(mock.getClassLoader());
  InitialContext ctx=new InitialContext();
  String className=Runnable.class.getName();
  MethodCall run=new MethodCall(Runnable.class,"run");
  Runnable t=Skeleton.newMock(Runnable.class);
  Runnable t2=Skeleton.newMock(Runnable.class);
  reg.unregister();
  ServiceRegistration reg=bc.registerService(className,t,null);
  ServiceRegistration reg2=bc.registerService(className,t2,null);
  NamingEnumeration<Binding> ne=ctx.listBindings("osgi:servicelist/" + className);
  assertTrue(ne.hasMoreElements());
  Binding bnd=ne.nextElement();
  assertEquals(String.valueOf(reg.getReference().getProperty(Constants.SERVICE_ID)),bnd.getName());
  assertTrue("Class name not correct. Was: " + bnd.getClassName(),bnd.getClassName().contains("Proxy") || bnd.getClassName().contains("EnhancerByCGLIB"));
  Runnable r=(Runnable)bnd.getObject();
  assertNotNull(r);
  r.run();
  Skeleton.getSkeleton(t).assertCalledExactNumberOfTimes(run,1);
  Skeleton.getSkeleton(t2).assertNotCalled(run);
  assertTrue(ne.hasMoreElements());
  bnd=ne.nextElement();
  assertEquals(String.valueOf(reg2.getReference().getProperty(Constants.SERVICE_ID)),bnd.getName());
  assertTrue("Class name not correct. Was: " + bnd.getClassName(),bnd.getClassName().contains("Proxy") || bnd.getClassName().contains("EnhancerByCGLIB"));
  r=(Runnable)bnd.getObject();
  assertNotNull(r);
  r.run();
  Skeleton.getSkeleton(t).assertCalledExactNumberOfTimes(run,1);
  Skeleton.getSkeleton(t2).assertCalledExactNumberOfTimes(run,1);
  assertFalse(ne.hasMoreElements());
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
"></span><br>
/** 
 * This test checks that we can pass a filter in without things blowing up.
 * Right now our mock service registry does not implement filtering, so the
 * effect is the same as simpleJNDILookup, but we at least know it is not
 * blowing up.
 * @throws NamingException
 */
@Test public void jndiLookupWithFilter() throws NamingException {
  BundleMock mock=new BundleMock("scooby.doo",new Properties());
  Thread.currentThread().setContextClassLoader(mock.getClassLoader());
  InitialContext ctx=new InitialContext();
  Object s=ctx.lookup("osgi:service/java.lang.Runnable/(rubbish=smelly)");
  assertNotNull("We didn't get a service back from our lookup :(",s);
  service.run();
  Skeleton.getSkeleton(service).assertCalledExactNumberOfTimes(new MethodCall(Runnable.class,"run"),1);
  Skeleton.getSkeleton(mock.getBundleContext()).assertCalled(new MethodCall(BundleContext.class,"getServiceReferences","java.lang.Runnable","(rubbish=smelly)"));
}

</code></pre>

<pre class="type-4 type-3 type-1 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBaseLookup() throws NamingException {
  BundleMock mock=new BundleMock("scooby.doo",new Properties());
  Thread.currentThread().setContextClassLoader(mock.getClassLoader());
  InitialContext ctx=new InitialContext();
  Context ctx2=(Context)ctx.lookup("osgi:service");
  Runnable r1=(Runnable)ctx2.lookup("java.lang.Runnable");
  assertNotNull(r1);
  assertTrue("expected proxied service class",r1 != service);
  Runnable r2=(Runnable)ctx.lookup("aries:services/java.lang.Runnable");
  assertNotNull(r2);
  assertTrue("expected non-proxied service class",r2 == service);
}

</code></pre>

<pre class="type-10 type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Check that we get a NameNotFoundException if we lookup after the service
 * has been unregistered.
 * @throws NamingException
 */
@Test(expected=NameNotFoundException.class) public void testLookupWhenServiceHasBeenRemoved() throws NamingException {
  reg.unregister();
  BundleMock mock=new BundleMock("scooby.doo",new Properties());
  Thread.currentThread().setContextClassLoader(mock.getClassLoader());
  InitialContext ctx=new InitialContext();
  ctx.lookup("osgi:service/java.lang.Runnable");
}

</code></pre>

<pre class="type-4 type-3 type-1 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test does a simple JNDI lookup to prove that works.
 * @throws NamingException
 */
@Test public void simpleJNDILookup() throws NamingException {
  System.setProperty(Context.URL_PKG_PREFIXES,"helloMatey");
  InitialContext ctx=new InitialContext(new Hashtable<Object,Object>());
  BundleMock mock=new BundleMock("scooby.doo.1",new Properties());
  Thread.currentThread().setContextClassLoader(mock.getClassLoader());
  Runnable s=(Runnable)ctx.lookup("osgi:service/java.lang.Runnable");
  assertNotNull("We didn't get a service back from our lookup :(",s);
  s.run();
  Skeleton.getSkeleton(service).assertCalledExactNumberOfTimes(new MethodCall(Runnable.class,"run"),1);
  Skeleton skel=Skeleton.getSkeleton(mock.getBundleContext());
  skel.assertCalled(new MethodCall(BundleContext.class,"getServiceReferences","java.lang.Runnable",null));
  ctx=new InitialContext(new Hashtable<Object,Object>());
  mock=new BundleMock("scooby.doo.2",new Properties());
  Thread.currentThread().setContextClassLoader(mock.getClassLoader());
  s=(Runnable)ctx.lookup("osgi:service/java.lang.Runnable");
  String packages=System.getProperty(Context.URL_PKG_PREFIXES,null);
  assertTrue(ctx.getEnvironment().containsValue(packages));
  assertNotNull("We didn't get a service back from our lookup :(",s);
  s.run();
  Skeleton.getSkeleton(service).assertCalledExactNumberOfTimes(new MethodCall(Runnable.class,"run"),2);
  skel=Skeleton.getSkeleton(mock.getBundleContext());
  skel.assertCalled(new MethodCall(BundleContext.class,"getServiceReferences","java.lang.Runnable",null));
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
/** 
 * This method does the setup to ensure we always have a service.
 * @throws NamingException 
 * @throws NoSuchFieldException 
 * @throws SecurityException 
 * @throws IllegalAccessException 
 * @throws IllegalArgumentException 
 */
@Before public void registerService() throws NamingException, SecurityException, NoSuchFieldException, IllegalArgumentException, IllegalAccessException {
  bc=Skeleton.newMock(new BundleContextMock(),BundleContext.class);
  registerProxyManager();
  new org.apache.aries.jndi.startup.Activator().start(bc);
  new Activator().start(bc);
  service=Skeleton.newMock(Runnable.class);
  registerService(service);
}

</code></pre>

<pre class="type-7 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
/** 
 * This test checks that we correctly register and deregister the url context
 * object factory in the service registry.
 */
@Test public void testJNDIRegistration(){
  ServiceReference ref=bc.getServiceReference(ObjectFactory.class.getName());
  assertNotNull("The aries url context object factory was not registered",ref);
  ObjectFactory factory=(ObjectFactory)bc.getService(ref);
  assertNotNull("The aries url context object factory was null",factory);
}

</code></pre>

<pre class="type-5 type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLookupWithPause() throws NamingException {
  BundleMock mock=new BundleMock("scooby.doo",new Properties());
  Thread.currentThread().setContextClassLoader(mock.getClassLoader());
  Hashtable<Object,Object> env=new Hashtable<Object,Object>();
  env.put(JNDIConstants.REBIND_TIMEOUT,1000);
  InitialContext ctx=new InitialContext(env);
  Context ctx2=(Context)ctx.lookup("osgi:service");
  Runnable r1=(Runnable)ctx2.lookup("java.lang.Runnable");
  reg.unregister();
  long startTime=System.currentTimeMillis();
  try {
    r1.run();
    fail("Should have received an exception");
  }
 catch (  ServiceException e) {
    long endTime=System.currentTimeMillis();
    long diff=endTime - startTime;
    assertTrue("The run method did not fail in the expected time (1s): " + diff,diff >= 1000);
  }
}

</code></pre>

<pre class="type-4 type-3 type-7 type-8 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void checkServiceListList() throws NamingException {
  BundleMock mock=new BundleMock("scooby.doo",new Properties());
  Thread.currentThread().setContextClassLoader(mock.getClassLoader());
  InitialContext ctx=new InitialContext();
  String className=Runnable.class.getName();
  Runnable t=Skeleton.newMock(Runnable.class);
  reg.unregister();
  ServiceRegistration reg=bc.registerService(className,t,null);
  ServiceRegistration reg2=bc.registerService(className,new Thread(),null);
  NamingEnumeration<NameClassPair> ne=ctx.list("osgi:servicelist/" + className);
  assertTrue(ne.hasMoreElements());
  NameClassPair ncp=ne.nextElement();
  assertEquals(String.valueOf(reg.getReference().getProperty(Constants.SERVICE_ID)),ncp.getName());
  assertTrue("Class name not correct. Was: " + ncp.getClassName(),ncp.getClassName().contains("Proxy"));
  assertTrue(ne.hasMoreElements());
  ncp=ne.nextElement();
  assertEquals(String.valueOf(reg2.getReference().getProperty(Constants.SERVICE_ID)),ncp.getName());
  assertEquals("Class name not correct.",Thread.class.getName(),ncp.getClassName());
  assertFalse(ne.hasMoreElements());
}

</code></pre>

<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void checkProxyDynamism() throws NamingException {
  BundleMock mock=new BundleMock("scooby.doo",new Properties());
  Thread.currentThread().setContextClassLoader(mock.getClassLoader());
  InitialContext ctx=new InitialContext();
  String className=Runnable.class.getName();
  Runnable t=Skeleton.newMock(Runnable.class);
  Runnable t2=Skeleton.newMock(Runnable.class);
  reg.unregister();
  ServiceRegistration reg=bc.registerService(className,t,null);
  bc.registerService(className,t2,null);
  Runnable r=(Runnable)ctx.lookup("osgi:service/java.lang.Runnable");
  r.run();
  Skeleton.getSkeleton(t).assertCalledExactNumberOfTimes(new MethodCall(Runnable.class,"run"),1);
  Skeleton.getSkeleton(t2).assertNotCalled(new MethodCall(Runnable.class,"run"));
  reg.unregister();
  r.run();
  Skeleton.getSkeleton(t).assertCalledExactNumberOfTimes(new MethodCall(Runnable.class,"run"),1);
  Skeleton.getSkeleton(t2).assertCalledExactNumberOfTimes(new MethodCall(Runnable.class,"run"),1);
}

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
/** 
 * Make sure we clear the caches out before the next test.
 */
@After public void teardown(){
  BundleContextMock.clear();
  Thread.currentThread().setContextClassLoader(this.getClass().getClassLoader());
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
"></span><br>
@Test public void jndiLookupServiceNameTest() throws NamingException, SQLException {
  InitialContext ctx=new InitialContext(new Hashtable<Object,Object>());
  BundleMock mock=new BundleMock("scooby.doo",new Properties());
  Thread.currentThread().setContextClassLoader(mock.getClassLoader());
  DataSource first=Skeleton.newMock(DataSource.class);
  DataSource second=Skeleton.newMock(DataSource.class);
  Hashtable<String,String> properties=new Hashtable<String,String>();
  properties.put("osgi.jndi.service.name","jdbc/myDataSource");
  bc.registerService(DataSource.class.getName(),first,properties);
  properties=new Hashtable<String,String>();
  properties.put("osgi.jndi.service.name","jdbc/myDataSource2");
  bc.registerService(DataSource.class.getName(),second,properties);
  DataSource s=(DataSource)ctx.lookup("osgi:service/jdbc/myDataSource");
  assertNotNull(s);
  s=(DataSource)ctx.lookup("osgi:service/javax.sql.DataSource/(osgi.jndi.service.name=jdbc/myDataSource2)");
  assertNotNull(s);
  s.isWrapperFor(DataSource.class);
  Skeleton.getSkeleton(second).assertCalled(new MethodCall(DataSource.class,"isWrapperFor",Class.class));
}

</code></pre>

<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void checkServiceOrderObserved() throws NamingException {
  BundleMock mock=new BundleMock("scooby.doo",new Properties());
  Thread.currentThread().setContextClassLoader(mock.getClassLoader());
  InitialContext ctx=new InitialContext();
  String className=Runnable.class.getName();
  Runnable t=Skeleton.newMock(Runnable.class);
  Runnable t2=Skeleton.newMock(Runnable.class);
  reg.unregister();
  ServiceRegistration reg=bc.registerService(className,t,null);
  ServiceRegistration reg2=bc.registerService(className,t2,null);
  Runnable r=(Runnable)ctx.lookup("osgi:service/java.lang.Runnable");
  r.run();
  Skeleton.getSkeleton(t).assertCalledExactNumberOfTimes(new MethodCall(Runnable.class,"run"),1);
  Skeleton.getSkeleton(t2).assertNotCalled(new MethodCall(Runnable.class,"run"));
  reg.unregister();
  reg2.unregister();
  Hashtable<String,Object> props=new Hashtable<String,Object>();
  props.put(Constants.SERVICE_RANKING,55);
  t=Skeleton.newMock(Runnable.class);
  t2=Skeleton.newMock(Runnable.class);
  bc.registerService(className,t,null);
  bc.registerService(className,t2,props);
  r=(Runnable)ctx.lookup("osgi:service/java.lang.Runnable");
  r.run();
  Skeleton.getSkeleton(t).assertNotCalled(new MethodCall(Runnable.class,"run"));
  Skeleton.getSkeleton(t2).assertCalledExactNumberOfTimes(new MethodCall(Runnable.class,"run"),1);
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
