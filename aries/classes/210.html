<h3 style="margin:0px">Class: org.apache.aries.subsystem.itests.defect.Aries1383Test (41 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(22)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(12)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(6)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies whether two objects/variables are the same"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >IdentityVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testStop() throws Exception {
  Subsystem root=getRootSubsystem();
  Subsystem subsystem=installSubsystem(root,APPLICATION_EMPTY,applicationEmpty(),false);
  try {
    startSubsystem(subsystem,false);
    try {
      stopSubsystem(subsystem);
    }
 catch (    Exception e) {
      e.printStackTrace();
      fail("Subsystem should have stopped");
    }
  }
  finally {
    uninstallSubsystemSilently(subsystem);
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void test7() throws Exception {
  Subsystem root=getRootSubsystem();
  subsystemEvents.clear();
  try {
    Subsystem subsystem=root.install(APPLICATION_INSTALL_FAILED,applicationInstallFailed());
    uninstallSubsystemSilently(subsystem);
    fail("Subsystem should not have installed");
  }
 catch (  SubsystemException e) {
    e.printStackTrace();
    long id=lastSubsystemId();
    assertEvent(id,APPLICATION_INSTALL_FAILED,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.INSTALLING,subsystemEvents.poll(id,5000),ServiceEvent.REGISTERED);
    assertEvent(id,APPLICATION_INSTALL_FAILED,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.INSTALL_FAILED,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
    assertEvent(id,APPLICATION_INSTALL_FAILED,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.UNINSTALLING,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
    assertEvent(id,APPLICATION_INSTALL_FAILED,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.UNINSTALLED,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testStart() throws Exception {
  Subsystem root=getRootSubsystem();
  Subsystem subsystem=installSubsystem(root,APPLICATION_EMPTY,applicationEmpty(),false);
  try {
    startSubsystem(subsystem,false);
    stopSubsystemSilently(subsystem);
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail("Subsystem should have started");
  }
 finally {
    uninstallSubsystemSilently(subsystem);
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testInstall() throws Exception {
  Subsystem root=getRootSubsystem();
  try {
    Subsystem subsystem=installSubsystem(root,APPLICATION_EMPTY,applicationEmpty(),false);
    uninstallSubsystemSilently(subsystem);
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail("Subsystem should have installed");
  }
}

</code></pre>

<pre class="type-7 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void test5() throws Exception {
  Subsystem root=getRootSubsystem();
  subsystemEvents.clear();
  Subsystem subsystem=root.install("application",new SubsystemArchiveBuilder().header(SubsystemConstants.SUBSYSTEM_SYMBOLICNAME,"application").header(SubsystemConstants.SUBSYSTEM_TYPE,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()).build());
  try {
    long id=subsystem.getSubsystemId();
    assertEvent(subsystem,State.INSTALLING,subsystemEvents.poll(id,5000));
    assertNull(subsystemEvents.poll(id,1));
    subsystem.start();
    try {
      assertEvent(subsystem,State.INSTALLED,subsystemEvents.poll(id,5000));
      assertEvent(subsystem,State.RESOLVING,subsystemEvents.poll(id,5000));
      assertEvent(subsystem,State.RESOLVED,subsystemEvents.poll(id,5000));
      assertEvent(subsystem,State.STARTING,subsystemEvents.poll(id,5000));
      assertEvent(subsystem,State.ACTIVE,subsystemEvents.poll(id,5000));
      assertNull(subsystemEvents.poll(id,1));
    }
  finally {
      stopSubsystemSilently(subsystem);
    }
  }
  finally {
    uninstallSubsystemSilently(subsystem);
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testAutoInstallDependenciesComposite() throws Exception {
  Subsystem root=getRootSubsystem();
  Subsystem b=installSubsystem(root,"b",new SubsystemArchiveBuilder().symbolicName("b").type(SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()).content("a;version=\"[0,0]\"").exportPackage("a").importPackage("b").bundle("a",new BundleArchiveBuilder().symbolicName("a").importPackage("b").exportPackage("a").build()).bundle("b",new BundleArchiveBuilder().symbolicName("b").exportPackage("b").build()).build(),false);
  uninstallableSubsystems.add(b);
  try {
    Subsystem a=installSubsystem(root,"a",new SubsystemArchiveBuilder().symbolicName("a").type(SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION).bundle("a",new BundleArchiveBuilder().symbolicName("a").importPackage("a").build()).build(),true);
    uninstallableSubsystems.add(a);
    assertState(EnumSet.of(State.INSTALLED,State.RESOLVED),b);
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail("Subsystem should have installed");
  }
}

</code></pre>

<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testComApiComImplComClient() throws Exception {
  Subsystem root=getRootSubsystem();
  final Subsystem shared=installSubsystem(root,"shared",new SubsystemArchiveBuilder().symbolicName("shared").type(SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()+ ';'+ SubsystemConstants.PROVISION_POLICY_DIRECTIVE+ ":="+ SubsystemConstants.PROVISION_POLICY_ACCEPT_DEPENDENCIES).importPackage("org.osgi.framework").build(),false);
  uninstallableSubsystems.add(shared);
  shared.start();
  stoppableSubsystems.add(shared);
  @SuppressWarnings("unchecked") Callable<Subsystem>[] installCallables=new Callable[]{new Callable<Subsystem>(){
    @Override public Subsystem call() throws Exception {
      Subsystem result=installSubsystem(shared,"client",new SubsystemArchiveBuilder().symbolicName("client").type(SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE).content("client;version=\"[0,0]\"").importPackage("org.osgi.framework").requireCapability("osgi.service;filter:=\"(objectClass=" + TestService.class.getName() + ")\";effective:=active").importService(TestService.class.getName()).requireBundle("api,impl").bundle("client",new BundleArchiveBuilder().symbolicName("client").importPackage("org.osgi.framework").requireCapability("osgi.service;filter:=\"(objectClass=" + TestService.class.getName() + ")\";effective:=active").requireBundle("api,impl").activator(TestServiceClientActivator.class).build()).build(),false);
      return result;
    }
  }
,new Callable<Subsystem>(){
    @Override public Subsystem call() throws Exception {
      Subsystem result=installSubsystem(shared,"impl",new SubsystemArchiveBuilder().symbolicName("impl").type(SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE).content("impl;version=\"[0,0]\"").provideCapability("osgi.service;objectClass:List<String>=\"" + TestService.class.getName() + "\"").exportService(TestService.class.getName()).importPackage("org.osgi.framework").requireBundle("api").provideCapability("osgi.wiring.bundle;osgi.wiring.bundle=impl;bundle-version=0").bundle("impl",new BundleArchiveBuilder().symbolicName("impl").provideCapability("osgi.service;objectClass:List<String>=\"" + TestService.class.getName() + "\"").importPackage("org.osgi.framework").requireBundle("api").clazz(TestServiceImpl.class).activator(TestServiceImplActivator.class).build()).build(),false);
      return result;
    }
  }
,new Callable<Subsystem>(){
    @Override public Subsystem call() throws Exception {
      Subsystem result=installSubsystem(shared,"api",new SubsystemArchiveBuilder().symbolicName("api").type(SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE).content("api;version=\"[0,0]\"").exportPackage("org.apache.aries.subsystem.itests.defect").provideCapability("osgi.wiring.bundle;osgi.wiring.bundle=api;bundle-version=0").bundle("api",new BundleArchiveBuilder().symbolicName("api").exportPackage("org.apache.aries.subsystem.itests.defect").clazz(TestService.class).build()).build(),false);
      return result;
    }
  }
};
  ExecutorService executor=Executors.newFixedThreadPool(3);
  List<Future<Subsystem>> installFutures=executor.invokeAll(Arrays.asList(installCallables));
  final Subsystem client=installFutures.get(0).get();
  final Subsystem impl=installFutures.get(1).get();
  final Subsystem api=installFutures.get(2).get();
  @SuppressWarnings("unchecked") Callable<Void>[] startCallables=new Callable[]{new Callable<Void>(){
    @Override public Void call() throws Exception {
      client.start();
      assertEvent(client,State.INSTALLED,subsystemEvents.poll(client.getSubsystemId(),5000));
      assertEvent(client,State.RESOLVING,subsystemEvents.poll(client.getSubsystemId(),5000));
      assertEvent(client,State.RESOLVED,subsystemEvents.poll(client.getSubsystemId(),5000));
      assertEvent(client,State.STARTING,subsystemEvents.poll(client.getSubsystemId(),5000));
      assertEvent(client,State.ACTIVE,subsystemEvents.poll(client.getSubsystemId(),5000));
      return null;
    }
  }
,new Callable<Void>(){
    @Override public Void call() throws Exception {
      impl.start();
      assertEvent(impl,State.INSTALLED,subsystemEvents.poll(impl.getSubsystemId(),5000));
      assertEvent(impl,State.RESOLVING,subsystemEvents.poll(impl.getSubsystemId(),5000));
      assertEvent(impl,State.RESOLVED,subsystemEvents.poll(impl.getSubsystemId(),5000));
      assertEvent(impl,State.STARTING,subsystemEvents.poll(impl.getSubsystemId(),5000));
      assertEvent(impl,State.ACTIVE,subsystemEvents.poll(impl.getSubsystemId(),5000));
      return null;
    }
  }
,new Callable<Void>(){
    @Override public Void call() throws Exception {
      api.start();
      assertEvent(api,State.INSTALLED,subsystemEvents.poll(api.getSubsystemId(),5000));
      assertEvent(api,State.RESOLVING,subsystemEvents.poll(api.getSubsystemId(),5000));
      assertEvent(api,State.RESOLVED,subsystemEvents.poll(api.getSubsystemId(),5000));
      assertEvent(api,State.STARTING,subsystemEvents.poll(api.getSubsystemId(),5000));
      assertEvent(api,State.ACTIVE,subsystemEvents.poll(api.getSubsystemId(),5000));
      return null;
    }
  }
};
  List<Future<Void>> startFutures=executor.invokeAll(Arrays.asList(startCallables));
  startFutures.get(0).get();
  startFutures.get(1).get();
  startFutures.get(2).get();
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testMatchingCapabilityInDisconnectedRegion() throws Exception {
  Subsystem root=getRootSubsystem();
  BundleArchiveBuilder b1Builder=new BundleArchiveBuilder().symbolicName("b1").exportPackage("b1");
  Bundle b1=root.getBundleContext().installBundle("b1",b1Builder.build());
  try {
    Subsystem a1=installSubsystem(root,"a1",new SubsystemArchiveBuilder().symbolicName("a1").type(SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()+ ';'+ SubsystemConstants.PROVISION_POLICY_DIRECTIVE+ ":="+ SubsystemConstants.PROVISION_POLICY_ACCEPT_DEPENDENCIES).build(),false);
    uninstallableSubsystems.add(a1);
    startSubsystem(a1,false);
    stoppableSubsystems.add(a1);
    removeConnectionWithParent(a1);
    Subsystem a2=installSubsystem(a1,"a2",new SubsystemArchiveBuilder().symbolicName("a2").type(SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION).content("b2").bundle("b2",new BundleArchiveBuilder().symbolicName("b2").importPackage("b1").build()).bundle("b1",b1Builder.build()).build(),false);
    uninstallableSubsystems.add(a2);
    assertState(State.INSTALLING,a2);
    assertNotConstituent(a1,"b1");
    try {
      startSubsystem(a2,false);
      stoppableSubsystems.add(a2);
      assertConstituent(a1,"b1");
    }
 catch (    SubsystemException e) {
      e.printStackTrace();
      fail("Subsystem should have started");
    }
  }
  finally {
    uninstallSilently(b1);
  }
}

</code></pre>

<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void test3() throws Exception {
  Subsystem root=getRootSubsystem();
  Subsystem subsystem=installSubsystem(root,APPLICATION_EMPTY,applicationEmpty(),false);
  try {
    assertReferences(Subsystem.class,"(&(subsystem.symbolicName=" + APPLICATION_EMPTY + ")(subsystem.version=0.0.0)(subsystem.type="+ SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION+ ")(subsystem.state="+ State.INSTALLING+ "))",1);
    assertReferences(AriesSubsystem.class,"(&(subsystem.symbolicName=" + APPLICATION_EMPTY + ")(subsystem.version=0.0.0)(subsystem.type="+ SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION+ ")(subsystem.state="+ State.INSTALLING+ "))",1);
  }
  finally {
    uninstallSubsystemSilently(subsystem);
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void test4e3bCompliance() throws Exception {
  serviceRegistrations.add(bundleContext.registerService(Repository.class,new TestRepository.Builder().resource(new TestRepositoryContent.Builder().capability(new TestCapability.Builder().namespace(IdentityNamespace.IDENTITY_NAMESPACE).attribute(IdentityNamespace.IDENTITY_NAMESPACE,"a").attribute(IdentityNamespace.CAPABILITY_VERSION_ATTRIBUTE,Version.emptyVersion).attribute(IdentityNamespace.CAPABILITY_TYPE_ATTRIBUTE,IdentityNamespace.TYPE_BUNDLE)).capability(new TestCapability.Builder().namespace(PackageNamespace.PACKAGE_NAMESPACE).attribute(PackageNamespace.PACKAGE_NAMESPACE,"x").attribute(IdentityNamespace.CAPABILITY_VERSION_ATTRIBUTE,Version.emptyVersion)).capability(new TestCapability.Builder().namespace(BundleNamespace.BUNDLE_NAMESPACE).attribute(BundleNamespace.BUNDLE_NAMESPACE,"a").attribute(BundleNamespace.CAPABILITY_BUNDLE_VERSION_ATTRIBUTE,Version.emptyVersion)).content(new BundleArchiveBuilder().symbolicName("a").exportPackage("x").buildAsBytes()).build()).resource(new TestRepositoryContent.Builder().capability(new TestCapability.Builder().namespace(IdentityNamespace.IDENTITY_NAMESPACE).attribute(IdentityNamespace.IDENTITY_NAMESPACE,"b").attribute(IdentityNamespace.CAPABILITY_VERSION_ATTRIBUTE,Version.emptyVersion).attribute(IdentityNamespace.CAPABILITY_TYPE_ATTRIBUTE,IdentityNamespace.TYPE_BUNDLE)).capability(new TestCapability.Builder().namespace("y")).content(new BundleArchiveBuilder().symbolicName("b").header("Provide-Capability","y").buildAsBytes()).build()).build(),null));
  Subsystem root=getRootSubsystem();
  try {
    Subsystem s1=installSubsystem(root,"s1",new SubsystemArchiveBuilder().symbolicName("s1").type(SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE).subsystem("s3",new SubsystemArchiveBuilder().symbolicName("s3").type(SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE).subsystem("s2",new SubsystemArchiveBuilder().symbolicName("s2").type(SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION).bundle("c",new BundleArchiveBuilder().symbolicName("c").importPackage("x").build()).bundle("d",new BundleArchiveBuilder().symbolicName("d").header("Require-Bundle","a").build()).bundle("e",new BundleArchiveBuilder().symbolicName("e").header("Require-Capability","y").build()).build()).build()).build(),true);
    uninstallableSubsystems.add(s1);
    fail("Subsystem should not have installed");
  }
 catch (  SubsystemException e) {
    e.printStackTrace();
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void test12() throws Exception {
  Subsystem root=getRootSubsystem();
  subsystemEvents.clear();
  Subsystem subsystem=root.install(APPLICATION_START_FAILURE,applicationStartFailure());
  try {
    subsystem.start();
    stopSubsystemSilently(subsystem);
    fail("Subsystem should not have started");
  }
 catch (  SubsystemException e) {
    e.printStackTrace();
    long id=lastSubsystemId();
    assertEvent(id,APPLICATION_START_FAILURE,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.INSTALLING,subsystemEvents.poll(id,5000),ServiceEvent.REGISTERED);
    assertEvent(id,APPLICATION_START_FAILURE,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.INSTALLED,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
    assertEvent(id,APPLICATION_START_FAILURE,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.RESOLVING,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
    assertEvent(id,APPLICATION_START_FAILURE,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.RESOLVED,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
    assertEvent(id,APPLICATION_START_FAILURE,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.STARTING,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
    assertEvent(id,APPLICATION_START_FAILURE,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.RESOLVED,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
  }
 finally {
    uninstallSubsystemSilently(subsystem);
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testUninstall() throws Exception {
  Subsystem root=getRootSubsystem();
  Subsystem subsystem=installSubsystem(root,APPLICATION_EMPTY,applicationEmpty(),false);
  try {
    uninstallSubsystem(subsystem);
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail("Subsystem should have uninstalled");
  }
}

</code></pre>

<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void test21() throws Exception {
  serviceRegistrations.add(bundleContext.registerService(Repository.class,new TestRepository.Builder().resource(new TestRepositoryContent.Builder().capability(new TestCapability.Builder().namespace(IdentityNamespace.IDENTITY_NAMESPACE).attribute(IdentityNamespace.IDENTITY_NAMESPACE,"b1").attribute(IdentityNamespace.CAPABILITY_VERSION_ATTRIBUTE,Version.emptyVersion).attribute(IdentityNamespace.CAPABILITY_TYPE_ATTRIBUTE,IdentityNamespace.TYPE_BUNDLE)).requirement(new TestRequirement.Builder().namespace(PackageNamespace.PACKAGE_NAMESPACE).directive(PackageNamespace.REQUIREMENT_FILTER_DIRECTIVE,"(osgi.wiring.package=b4)")).content(new BundleArchiveBuilder().symbolicName("b1").importPackage("b4").buildAsBytes()).build()).resource(new TestRepositoryContent.Builder().capability(new TestCapability.Builder().namespace(IdentityNamespace.IDENTITY_NAMESPACE).attribute(IdentityNamespace.IDENTITY_NAMESPACE,"b2").attribute(IdentityNamespace.CAPABILITY_VERSION_ATTRIBUTE,Version.emptyVersion).attribute(IdentityNamespace.CAPABILITY_TYPE_ATTRIBUTE,IdentityNamespace.TYPE_BUNDLE)).requirement(new TestRequirement.Builder().namespace(PackageNamespace.PACKAGE_NAMESPACE).directive(PackageNamespace.REQUIREMENT_FILTER_DIRECTIVE,"(osgi.wiring.package=b5)")).content(new BundleArchiveBuilder().symbolicName("b2").importPackage("b5").buildAsBytes()).build()).resource(new TestRepositoryContent.Builder().capability(new TestCapability.Builder().namespace(IdentityNamespace.IDENTITY_NAMESPACE).attribute(IdentityNamespace.IDENTITY_NAMESPACE,"b3").attribute(IdentityNamespace.CAPABILITY_VERSION_ATTRIBUTE,Version.emptyVersion).attribute(IdentityNamespace.CAPABILITY_TYPE_ATTRIBUTE,IdentityNamespace.TYPE_BUNDLE)).requirement(new TestRequirement.Builder().namespace(PackageNamespace.PACKAGE_NAMESPACE).directive(PackageNamespace.REQUIREMENT_FILTER_DIRECTIVE,"(osgi.wiring.package=b6)")).content(new BundleArchiveBuilder().symbolicName("b3").importPackage("b6").buildAsBytes()).build()).resource(new TestRepositoryContent.Builder().capability(new TestCapability.Builder().namespace(IdentityNamespace.IDENTITY_NAMESPACE).attribute(IdentityNamespace.IDENTITY_NAMESPACE,"b4").attribute(IdentityNamespace.CAPABILITY_VERSION_ATTRIBUTE,Version.emptyVersion).attribute(IdentityNamespace.CAPABILITY_TYPE_ATTRIBUTE,IdentityNamespace.TYPE_BUNDLE)).capability(new TestCapability.Builder().namespace(PackageNamespace.PACKAGE_NAMESPACE).attribute(PackageNamespace.PACKAGE_NAMESPACE,"b4")).content(new BundleArchiveBuilder().symbolicName("b4").exportPackage("b4").buildAsBytes()).build()).resource(new TestRepositoryContent.Builder().capability(new TestCapability.Builder().namespace(IdentityNamespace.IDENTITY_NAMESPACE).attribute(IdentityNamespace.IDENTITY_NAMESPACE,"b5").attribute(IdentityNamespace.CAPABILITY_VERSION_ATTRIBUTE,Version.emptyVersion).attribute(IdentityNamespace.CAPABILITY_TYPE_ATTRIBUTE,IdentityNamespace.TYPE_BUNDLE)).capability(new TestCapability.Builder().namespace(PackageNamespace.PACKAGE_NAMESPACE).attribute(PackageNamespace.PACKAGE_NAMESPACE,"b5")).content(new BundleArchiveBuilder().symbolicName("b5").exportPackage("b5").buildAsBytes()).build()).resource(new TestRepositoryContent.Builder().capability(new TestCapability.Builder().namespace(IdentityNamespace.IDENTITY_NAMESPACE).attribute(IdentityNamespace.IDENTITY_NAMESPACE,"b6").attribute(IdentityNamespace.CAPABILITY_VERSION_ATTRIBUTE,Version.emptyVersion).attribute(IdentityNamespace.CAPABILITY_TYPE_ATTRIBUTE,IdentityNamespace.TYPE_BUNDLE)).capability(new TestCapability.Builder().namespace(PackageNamespace.PACKAGE_NAMESPACE).attribute(PackageNamespace.PACKAGE_NAMESPACE,"b6")).content(new BundleArchiveBuilder().symbolicName("b6").exportPackage("b6").buildAsBytes()).build()).build(),null));
  Subsystem root=getRootSubsystem();
  Subsystem s1=installSubsystem(root,"s1",new SubsystemArchiveBuilder().symbolicName("s1").type(SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()+ ';'+ SubsystemConstants.PROVISION_POLICY_DIRECTIVE+ ":="+ SubsystemConstants.PROVISION_POLICY_ACCEPT_DEPENDENCIES).build(),false);
  uninstallableSubsystems.add(s1);
  startSubsystem(s1,false);
  stoppableSubsystems.add(s1);
  Subsystem f2=installSubsystem(s1,"f2",new SubsystemArchiveBuilder().symbolicName("f2").type(SubsystemConstants.SUBSYSTEM_TYPE_FEATURE).content("b2,b3").build(),false);
  uninstallableSubsystems.add(f2);
  assertChild(s1,"f2",null,SubsystemConstants.SUBSYSTEM_TYPE_FEATURE);
  assertConstituent(s1,"f2",null,SubsystemConstants.SUBSYSTEM_TYPE_FEATURE);
  assertConstituent(f2,"b2");
  assertConstituent(f2,"b3");
  Subsystem f1=installSubsystem(s1,"f1",new SubsystemArchiveBuilder().symbolicName("f1").type(SubsystemConstants.SUBSYSTEM_TYPE_FEATURE).content("b1,b2").build(),false);
  uninstallableSubsystems.add(f1);
  assertChild(s1,"f1",null,SubsystemConstants.SUBSYSTEM_TYPE_FEATURE);
  assertConstituent(s1,"f1",null,SubsystemConstants.SUBSYSTEM_TYPE_FEATURE);
  assertConstituent(f1,"b1");
  assertConstituent(f1,"b2");
  startSubsystem(f1,false);
  stoppableSubsystems.add(f1);
  assertState(EnumSet.of(State.RESOLVED,State.ACTIVE),f2);
  assertConstituent(s1,"b4");
  assertConstituent(s1,"b5");
  assertConstituent(s1,"b6");
}

</code></pre>

<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void test1() throws Exception {
  Subsystem root=getRootSubsystem();
  final Subsystem c1=installSubsystem(root,"c1",new SubsystemArchiveBuilder().symbolicName("c1").type(SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()).build(),false);
  uninstallableSubsystems.add(c1);
  c1.start();
  stoppableSubsystems.add(c1);
  @SuppressWarnings("unchecked") Callable<Subsystem>[] installCallables=new Callable[]{new Callable<Subsystem>(){
    @Override public Subsystem call() throws Exception {
      Subsystem result=installSubsystem(c1,"a1",new SubsystemArchiveBuilder().symbolicName("a1").type(SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()).content("b1").bundle("b1",new BundleArchiveBuilder().symbolicName("b1").importPackage("b2").build()).build(),false);
      uninstallableSubsystems.add(result);
      return result;
    }
  }
,new Callable<Subsystem>(){
    @Override public Subsystem call() throws Exception {
      Subsystem result=installSubsystem(c1,"f1",new SubsystemArchiveBuilder().symbolicName("f1").type(SubsystemConstants.SUBSYSTEM_TYPE_FEATURE + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()).content("b2").bundle("b2",new BundleArchiveBuilder().symbolicName("b2").exportPackage("b2").importPackage("b3").build()).build(),false);
      uninstallableSubsystems.add(result);
      return result;
    }
  }
,new Callable<Subsystem>(){
    @Override public Subsystem call() throws Exception {
      Subsystem result=installSubsystem(c1,"f2",new SubsystemArchiveBuilder().symbolicName("f2").type(SubsystemConstants.SUBSYSTEM_TYPE_FEATURE + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()).content("b4").bundle("b4",new BundleArchiveBuilder().symbolicName("b4").exportPackage("b4").importPackage("b2").importPackage("b3").build()).build(),false);
      uninstallableSubsystems.add(result);
      return result;
    }
  }
,new Callable<Subsystem>(){
    @Override public Subsystem call() throws Exception {
      Subsystem result=installSubsystem(c1,"c2",new SubsystemArchiveBuilder().symbolicName("c2").type(SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()).content("b3;version=\"[0,0]\"").exportPackage("b3").importPackage("b4").bundle("b3",new BundleArchiveBuilder().symbolicName("b3").exportPackage("b3").importPackage("b4").build()).build(),false);
      uninstallableSubsystems.add(result);
      return result;
    }
  }
};
  ExecutorService executor=Executors.newFixedThreadPool(4);
  List<Future<Subsystem>> installFutures=executor.invokeAll(Arrays.asList(installCallables));
  final Subsystem a1=installFutures.get(0).get();
  assertConstituent(a1,"b1");
  final Subsystem f1=installFutures.get(1).get();
  assertConstituent(f1,"b2");
  final Subsystem f2=installFutures.get(2).get();
  assertConstituent(f2,"b4");
  final Subsystem c2=installFutures.get(3).get();
  assertConstituent(c2,"b3");
  @SuppressWarnings("unchecked") Callable<Null>[] startCallables=new Callable[]{new Callable<Null>(){
    @Override public Null call() throws Exception {
      a1.start();
      assertEvent(a1,State.INSTALLED,subsystemEvents.poll(a1.getSubsystemId(),5000));
      assertEvent(a1,State.RESOLVING,subsystemEvents.poll(a1.getSubsystemId(),5000));
      assertEvent(a1,State.RESOLVED,subsystemEvents.poll(a1.getSubsystemId(),5000));
      stoppableSubsystems.add(a1);
      return null;
    }
  }
,new Callable<Null>(){
    @Override public Null call() throws Exception {
      f1.start();
      assertEvent(f1,State.INSTALLED,subsystemEvents.poll(f1.getSubsystemId(),5000));
      assertEvent(f1,State.RESOLVING,subsystemEvents.poll(f1.getSubsystemId(),5000));
      assertEvent(f1,State.RESOLVED,subsystemEvents.poll(f1.getSubsystemId(),5000));
      stoppableSubsystems.add(f1);
      return null;
    }
  }
,new Callable<Null>(){
    @Override public Null call() throws Exception {
      f2.start();
      assertEvent(f2,State.INSTALLED,subsystemEvents.poll(f2.getSubsystemId(),5000));
      assertEvent(f2,State.RESOLVING,subsystemEvents.poll(f2.getSubsystemId(),5000));
      assertEvent(f2,State.RESOLVED,subsystemEvents.poll(f2.getSubsystemId(),5000));
      stoppableSubsystems.add(f2);
      return null;
    }
  }
,new Callable<Null>(){
    @Override public Null call() throws Exception {
      c2.start();
      assertEvent(c2,State.INSTALLED,subsystemEvents.poll(c2.getSubsystemId(),5000));
      assertEvent(c2,State.RESOLVING,subsystemEvents.poll(c2.getSubsystemId(),5000));
      assertEvent(c2,State.RESOLVED,subsystemEvents.poll(c2.getSubsystemId(),5000));
      stoppableSubsystems.add(c2);
      return null;
    }
  }
};
  List<Future<Null>> startFutures=executor.invokeAll(Arrays.asList(startCallables));
  startFutures.get(0).get();
  startFutures.get(1).get();
  startFutures.get(2).get();
  startFutures.get(3).get();
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void test10() throws Exception {
  Subsystem root=getRootSubsystem();
  try {
    Subsystem subsystem=installSubsystem(root,APPLICATION_INVALID_PROVISION_DEPENDENCIES,applicationInvalidProvisionDependencies(),false);
    uninstallSubsystemSilently(subsystem);
    fail("Subsystem should not have installed");
  }
 catch (  SubsystemException e) {
    e.printStackTrace();
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testAutoInstallDependenciesFeature() throws Exception {
  Subsystem root=getRootSubsystem();
  Subsystem shared=installSubsystem(root,"shared",new SubsystemArchiveBuilder().symbolicName("shared").type(SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()+ ';'+ SubsystemConstants.PROVISION_POLICY_DIRECTIVE+ ":="+ SubsystemConstants.PROVISION_POLICY_ACCEPT_DEPENDENCIES).build(),false);
  uninstallableSubsystems.add(shared);
  startSubsystem(shared,false);
  Subsystem b=installSubsystem(shared,"b",new SubsystemArchiveBuilder().symbolicName("b").type(SubsystemConstants.SUBSYSTEM_TYPE_FEATURE).content("a").bundle("a",new BundleArchiveBuilder().symbolicName("a").importPackage("b").exportPackage("a").build()).bundle("b",new BundleArchiveBuilder().symbolicName("b").exportPackage("b").build()).build(),false);
  try {
    installSubsystem(shared,"a",new SubsystemArchiveBuilder().symbolicName("a").type(SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION + ';' + AriesProvisionDependenciesDirective.INSTALL.toString()).bundle("a",new BundleArchiveBuilder().symbolicName("a").importPackage("a").build()).build(),true);
    assertState(EnumSet.of(State.INSTALLED,State.RESOLVED),b);
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail("Subsystem should have installed");
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void test15a() throws Exception {
  Subsystem root=getRootSubsystem();
  try {
    Subsystem subsystem=installSubsystem(root,FEATURE_PROVISION_DEPENDENCIES_RESOLVE,featureProvisionDependenciesResolve(),false);
    uninstallSubsystemSilently(subsystem);
    fail("Subsystem should not have installed");
  }
 catch (  SubsystemException e) {
    e.printStackTrace();
  }
}

</code></pre>

<pre class="type-4 type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void test13() throws Exception {
  Subsystem root=getRootSubsystem();
  Map<String,String> headers=root.getSubsystemHeaders(null);
  String headerStr=headers.get(SubsystemConstants.SUBSYSTEM_TYPE);
  SubsystemTypeHeader header=new SubsystemTypeHeader(headerStr);
  AriesProvisionDependenciesDirective directive=header.getAriesProvisionDependenciesDirective();
  assertEquals("Wrong directive",AriesProvisionDependenciesDirective.INSTALL,directive);
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void test16b() throws Exception {
  Subsystem root=getRootSubsystem();
  Subsystem application=installSubsystem(root,"application",new SubsystemArchiveBuilder().symbolicName("application").type(SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION + ';' + AriesProvisionDependenciesDirective.INSTALL.toString()).build(),true);
  try {
    Subsystem feature=installSubsystem(application,"feature",new SubsystemArchiveBuilder().symbolicName("feature").type(SubsystemConstants.SUBSYSTEM_TYPE_FEATURE + ';' + AriesProvisionDependenciesDirective.INSTALL.toString()).build(),true);
    uninstallSubsystemSilently(feature);
  }
 catch (  SubsystemException e) {
    e.printStackTrace();
    fail("Subsystem should have installed");
  }
 finally {
    uninstallSubsystemSilently(application);
  }
}

</code></pre>

<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testFullLifeCycle() throws Exception {
  Subsystem root=getRootSubsystem();
  Subsystem subsystem=installSubsystem(root,APPLICATION_EMPTY,applicationEmpty(),false);
  startSubsystem(subsystem,false);
  stopSubsystem(subsystem);
  uninstallSubsystem(subsystem);
}

</code></pre>

<pre class="type-4 type-7 type-13 type-1 type-8 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void test19() throws Exception {
  Subsystem root=getRootSubsystem();
  subsystemEvents.clear();
  Subsystem feature1=installSubsystem(root,"feature1",new SubsystemArchiveBuilder().symbolicName("feature1").type(SubsystemConstants.SUBSYSTEM_TYPE_FEATURE).build());
  try {
    Subsystem feature2=installSubsystem(root,"feature2",new SubsystemArchiveBuilder().symbolicName("feature2").type(SubsystemConstants.SUBSYSTEM_TYPE_FEATURE + ';' + AriesProvisionDependenciesDirective.INSTALL.toString()).build());
    try {
      SubsystemArchiveBuilder applicationArchive=new SubsystemArchiveBuilder().symbolicName("application").type(SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()+ ';'+ SubsystemConstants.PROVISION_POLICY_DIRECTIVE+ ":="+ SubsystemConstants.PROVISION_POLICY_ACCEPT_DEPENDENCIES).content("bundle1").bundle("bundle1",new BundleArchiveBuilder().symbolicName("bundle1").importPackage("a").build()).bundle("bundle2",new BundleArchiveBuilder().symbolicName("bundle2").exportPackage("a").build());
      Subsystem application1=feature1.install("application",applicationArchive.build());
      Subsystem application2=feature2.install("application",applicationArchive.build());
      assertSame("Wrong subsystem",application1,application2);
      assertEquals("Wrong subsystem",application1,application2);
      assertChild(feature1,"application");
      assertChild(feature2,"application");
      long id=application1.getSubsystemId();
      assertEvent(id,"application",Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.INSTALLING,subsystemEvents.poll(id,5000),ServiceEvent.REGISTERED);
      assertNull("Unexpected event",subsystemEvents.poll(id,1));
      assertConstituent(application1,"bundle1");
      assertNotConstituent(application1,"bundle2");
      application1.start();
      try {
        assertEvent(id,"application",Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.INSTALLED,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
        assertEvent(id,"application",Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.RESOLVING,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
        assertEvent(id,"application",Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.RESOLVED,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
        assertEvent(id,"application",Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.STARTING,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
        assertEvent(id,"application",Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.ACTIVE,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
        assertNull("Unexpected event",subsystemEvents.poll(id,1));
        assertConstituent(application1,"bundle2");
      }
  finally {
        stopSubsystemSilently(application1);
      }
    }
  finally {
      uninstallSubsystemSilently(feature2);
    }
  }
  finally {
    uninstallSubsystemSilently(feature1);
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testProvideCapabilityNamespaceOnly() throws Exception {
  Subsystem root=getRootSubsystem();
  Subsystem c1=installSubsystem(root,"c1",new SubsystemArchiveBuilder().symbolicName("c1").type(SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE).provideCapability("y").build());
  uninstallableSubsystems.add(c1);
  try {
    startSubsystem(c1);
    stoppableSubsystems.add(c1);
  }
 catch (  SubsystemException e) {
    e.printStackTrace();
    fail("Subsystem should have started");
  }
}

</code></pre>

<pre class="type-4 type-7 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void test17() throws Exception {
  Subsystem root=getRootSubsystem();
  subsystemEvents.clear();
  Subsystem parent=root.install(APPLICATION_B,applicationB());
  try {
    long id=parent.getSubsystemId();
    assertEvent(id,APPLICATION_B,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.INSTALLING,subsystemEvents.poll(id,5000),ServiceEvent.REGISTERED);
    assertNull("Unexpected event",subsystemEvents.poll(id,1));
    assertNotConstituent(root,BUNDLE_B);
    assertConstituent(parent,BUNDLE_A);
    Subsystem child=getChild(parent,APPLICATION_A);
    assertNotNull("Missing child",child);
    id=child.getSubsystemId();
    assertEvent(id,APPLICATION_A,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.INSTALLING,subsystemEvents.poll(id,5000),ServiceEvent.REGISTERED);
    assertNull("Unexpected event",subsystemEvents.poll(id,1));
    assertNotConstituent(root,BUNDLE_D);
    assertConstituent(child,BUNDLE_A);
    assertConstituent(child,BUNDLE_C);
    parent.start();
    try {
      id=parent.getSubsystemId();
      assertEvent(id,APPLICATION_B,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.INSTALLED,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
      assertEvent(id,APPLICATION_B,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.RESOLVING,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
      assertEvent(id,APPLICATION_B,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.RESOLVED,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
      assertEvent(id,APPLICATION_B,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.STARTING,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
      assertEvent(id,APPLICATION_B,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.ACTIVE,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
      assertNull("Unexpected event",subsystemEvents.poll(id,1));
      assertConstituent(root,BUNDLE_B);
      id=child.getSubsystemId();
      assertEvent(id,APPLICATION_A,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.INSTALLED,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
      assertEvent(id,APPLICATION_A,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.RESOLVING,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
      assertEvent(id,APPLICATION_A,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.RESOLVED,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
      assertEvent(id,APPLICATION_A,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.STARTING,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
      assertEvent(id,APPLICATION_A,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.ACTIVE,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
      assertNull("Unexpected event",subsystemEvents.poll(id,1));
      assertConstituent(root,BUNDLE_D);
    }
  finally {
      stopSubsystemSilently(parent);
    }
  }
  finally {
    uninstallSubsystemSilently(parent);
  }
}

</code></pre>

<pre class="type-5 type-8 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void test8() throws Exception {
  Subsystem root=getRootSubsystem();
  try {
    Subsystem subsystem=installSubsystem(root,APPLICATION_INSTALL_FAILED,applicationInstallFailed(),false);
    uninstallSubsystemSilently(subsystem);
    fail("Subsystem should not have installed");
  }
 catch (  SubsystemException e) {
    e.printStackTrace();
    assertEquals("Subsystem service should not exist",0,bundleContext.getServiceReferences(Subsystem.class,"(" + SubsystemConstants.SUBSYSTEM_ID_PROPERTY + "="+ lastSubsystemId()+ ")").size());
  }
}

</code></pre>

<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void test20() throws Exception {
  serviceRegistrations.add(bundleContext.registerService(Repository.class,new TestRepository.Builder().resource(new TestRepositoryContent.Builder().capability(new TestCapability.Builder().namespace(IdentityNamespace.IDENTITY_NAMESPACE).attribute(IdentityNamespace.IDENTITY_NAMESPACE,"b1").attribute(IdentityNamespace.CAPABILITY_VERSION_ATTRIBUTE,Version.emptyVersion).attribute(IdentityNamespace.CAPABILITY_TYPE_ATTRIBUTE,IdentityNamespace.TYPE_BUNDLE)).content(new BundleArchiveBuilder().symbolicName("b1").exportPackage("a").buildAsBytes()).build()).resource(new TestRepositoryContent.Builder().capability(new TestCapability.Builder().namespace(IdentityNamespace.IDENTITY_NAMESPACE).attribute(IdentityNamespace.IDENTITY_NAMESPACE,"b2").attribute(IdentityNamespace.CAPABILITY_VERSION_ATTRIBUTE,Version.emptyVersion).attribute(IdentityNamespace.CAPABILITY_TYPE_ATTRIBUTE,IdentityNamespace.TYPE_BUNDLE)).content(new BundleArchiveBuilder().symbolicName("b2").importPackage("a").buildAsBytes()).build()).build(),null));
  Subsystem root=getRootSubsystem();
  Subsystem s1=installSubsystem(root,"s1",new SubsystemArchiveBuilder().symbolicName("s1").type(SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()).build(),false);
  uninstallableSubsystems.add(s1);
  startSubsystem(s1,false);
  stoppableSubsystems.add(s1);
  Subsystem f2=installSubsystem(s1,"f2",new SubsystemArchiveBuilder().symbolicName("f2").type(SubsystemConstants.SUBSYSTEM_TYPE_FEATURE).content("b2").build(),false);
  uninstallableSubsystems.add(f2);
  assertChild(s1,"f2",null,SubsystemConstants.SUBSYSTEM_TYPE_FEATURE);
  assertConstituent(f2,"b2");
  Subsystem f1=installSubsystem(s1,"f1",new SubsystemArchiveBuilder().symbolicName("f1").type(SubsystemConstants.SUBSYSTEM_TYPE_FEATURE).content("b1").build(),false);
  uninstallableSubsystems.add(f1);
  assertChild(s1,"f1",null,SubsystemConstants.SUBSYSTEM_TYPE_FEATURE);
  assertConstituent(f1,"b1");
  assertNotConstituent(root,"b1");
}

</code></pre>

<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void test6() throws Exception {
  Subsystem root=getRootSubsystem();
  Subsystem subsystem=root.install("application",new SubsystemArchiveBuilder().symbolicName("application").type(SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()).content("bundle1").bundle("bundle1",new BundleArchiveBuilder().symbolicName("bundle1").exportPackage("a").importPackage("b").build()).bundle("bundle2",new BundleArchiveBuilder().symbolicName("bundle2").exportPackage("b").build()).build());
  try {
    assertNotConstituent(root,"bundle2");
    startSubsystem(subsystem,false);
    try {
      assertConstituent(root,"bundle2");
    }
  finally {
      stopSubsystemSilently(subsystem);
    }
  }
  finally {
    uninstallSubsystemSilently(subsystem);
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void test11() throws Exception {
  Subsystem root=getRootSubsystem();
  subsystemEvents.clear();
  Subsystem subsystem=root.install(APPLICATION_DEPENDENCY_IN_ARCHIVE,applicationDependencyInArchive());
  ServiceRegistration<ResolverHookFactory> registration=bundleContext.registerService(ResolverHookFactory.class,new ResolverHookFactory(){
    @Override public ResolverHook begin(    Collection<BundleRevision> triggers){
      return new ResolverHook(){
        @Override public void filterResolvable(        Collection<BundleRevision> candidates){
          for (Iterator<BundleRevision> i=candidates.iterator(); i.hasNext(); ) {
            BundleRevision revision=i.next();
            if (revision.getSymbolicName().equals(BUNDLE_B)) {
              i.remove();
            }
          }
        }
        @Override public void filterSingletonCollisions(        BundleCapability singleton,        Collection<BundleCapability> collisionCandidates){
        }
        @Override public void filterMatches(        BundleRequirement requirement,        Collection<BundleCapability> candidates){
        }
        @Override public void end(){
        }
      }
;
    }
  }
,null);
  try {
    subsystem.start();
    stopSubsystemSilently(subsystem);
    fail("Subsystem should not have started");
  }
 catch (  SubsystemException e) {
    e.printStackTrace();
    long id=lastSubsystemId();
    assertEvent(id,APPLICATION_DEPENDENCY_IN_ARCHIVE,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.INSTALLING,subsystemEvents.poll(id,5000),ServiceEvent.REGISTERED);
    assertEvent(id,APPLICATION_DEPENDENCY_IN_ARCHIVE,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.INSTALLED,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
    assertEvent(id,APPLICATION_DEPENDENCY_IN_ARCHIVE,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.RESOLVING,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
    assertEvent(id,APPLICATION_DEPENDENCY_IN_ARCHIVE,Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.INSTALLED,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
  }
 finally {
    registration.unregister();
    uninstallSubsystemSilently(subsystem);
  }
}

</code></pre>

<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void test4() throws Exception {
  Subsystem root=getRootSubsystem();
  Subsystem subsystem=installSubsystem(root,APPLICATION_DEPENDENCY_IN_ARCHIVE,applicationDependencyInArchive(),false);
  try {
    assertConstituent(subsystem,BUNDLE_A);
    assertNotConstituent(subsystem,BUNDLE_B);
    assertNotConstituent(root,BUNDLE_B);
  }
  finally {
    uninstallSubsystemSilently(subsystem);
  }
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
"></span><br>
@Test public void testRestart() throws Exception {
  Subsystem root=getRootSubsystem();
  Subsystem a1=installSubsystem(root,"a1",new SubsystemArchiveBuilder().symbolicName("a1").type(SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()).content("b1,c1;type=osgi.subsystem.composite").bundle("b1",new BundleArchiveBuilder().symbolicName("b1").importPackage("b2").build()).bundle("b2",new BundleArchiveBuilder().symbolicName("b2").exportPackage("b2").build()).subsystem("c1",new SubsystemArchiveBuilder().symbolicName("c1").type(SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()).content("b1;version=\"[0,0]\"").importPackage("b2").bundle("b1",new BundleArchiveBuilder().symbolicName("b1").importPackage("b2").build()).build()).build(),false);
  uninstallableSubsystems.add(a1);
  assertChild(root,"a1");
  assertState(State.INSTALLING,a1);
  Subsystem c1=getChild(a1,"c1",null,SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE);
  assertNotNull("Missing child",c1);
  assertState(State.INSTALLING,c1);
  restartSubsystemsImplBundle();
  root=getRootSubsystem();
  a1=getChild(root,"a1");
  assertNotNull("Missing child",a1);
  uninstallableSubsystems.add(a1);
  assertState(State.INSTALLING,a1);
  assertConstituent(a1,"b1");
  assertNotConstituent(root,"b2");
  c1=getChild(a1,"c1",null,SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE);
  assertNotNull("Missing child",c1);
  uninstallableSubsystems.add(c1);
  assertConstituent(c1,"b1");
  startSubsystem(c1,false);
  stoppableSubsystems.add(c1);
  assertState(State.INSTALLED,a1);
  stoppableSubsystems.add(a1);
  assertConstituent(root,"b2");
}

</code></pre>

<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void test2() throws Exception {
  Subsystem root=getRootSubsystem();
  Subsystem subsystem=installSubsystem(root,APPLICATION_EMPTY,applicationEmpty(),false);
  try {
    assertState(State.INSTALLING,subsystem);
  }
  finally {
    uninstallSubsystemSilently(subsystem);
  }
}

</code></pre>

<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testComApiComImplAppClient() throws Exception {
  Subsystem root=getRootSubsystem();
  final Subsystem shared=installSubsystem(root,"shared",new SubsystemArchiveBuilder().symbolicName("shared").type(SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()+ ';'+ SubsystemConstants.PROVISION_POLICY_DIRECTIVE+ ":="+ SubsystemConstants.PROVISION_POLICY_ACCEPT_DEPENDENCIES).importPackage("org.osgi.framework").build(),false);
  uninstallableSubsystems.add(shared);
  shared.start();
  stoppableSubsystems.add(shared);
  @SuppressWarnings("unchecked") Callable<Subsystem>[] installCallables=new Callable[]{new Callable<Subsystem>(){
    @Override public Subsystem call() throws Exception {
      Subsystem result=installSubsystem(shared,"client",new SubsystemArchiveBuilder().symbolicName("client").type(SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION).bundle("client",new BundleArchiveBuilder().symbolicName("client").importPackage("org.apache.aries.subsystem.itests.defect").requireCapability("osgi.service;filter:=\"(objectClass=" + TestService.class.getName() + ")\";effective:=active").build()).build(),false);
      uninstallableSubsystems.add(result);
      return result;
    }
  }
,new Callable<Subsystem>(){
    @Override public Subsystem call() throws Exception {
      Subsystem result=installSubsystem(shared,"impl",new SubsystemArchiveBuilder().symbolicName("impl").type(SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE).content("impl;version=\"[0,0]\"").provideCapability("osgi.service;objectClass:List<String>=\"" + TestService.class.getName() + "\"").importPackage("org.osgi.framework").requireBundle("api").bundle("impl",new BundleArchiveBuilder().symbolicName("impl").provideCapability("osgi.service;objectClass:List<String>=\"" + TestService.class.getName() + "\"").importPackage("org.osgi.framework").requireBundle("api").clazz(TestServiceImpl.class).activator(TestServiceImplActivator.class).build()).build(),false);
      uninstallableSubsystems.add(result);
      return result;
    }
  }
,new Callable<Subsystem>(){
    @Override public Subsystem call() throws Exception {
      Subsystem result=installSubsystem(shared,"api",new SubsystemArchiveBuilder().symbolicName("api").type(SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE).content("api;version=\"[0,0]\"").exportPackage("org.apache.aries.subsystem.itests.defect").provideCapability("osgi.wiring.bundle;osgi.wiring.bundle=api;bundle-version=0").bundle("api",new BundleArchiveBuilder().symbolicName("api").exportPackage("org.apache.aries.subsystem.itests.defect").clazz(TestService.class).build()).build(),false);
      uninstallableSubsystems.add(result);
      return result;
    }
  }
};
  ExecutorService executor=Executors.newFixedThreadPool(3);
  List<Future<Subsystem>> installFutures=executor.invokeAll(Arrays.asList(installCallables));
  final Subsystem a1=installFutures.get(0).get();
  final Subsystem c1=installFutures.get(1).get();
  final Subsystem c2=installFutures.get(2).get();
  @SuppressWarnings("unchecked") Callable<Void>[] startCallables=new Callable[]{new Callable<Void>(){
    @Override public Void call() throws Exception {
      a1.start();
      stoppableSubsystems.add(a1);
      assertEvent(a1,State.INSTALLED,subsystemEvents.poll(a1.getSubsystemId(),5000));
      assertEvent(a1,State.RESOLVING,subsystemEvents.poll(a1.getSubsystemId(),5000));
      assertEvent(a1,State.RESOLVED,subsystemEvents.poll(a1.getSubsystemId(),5000));
      assertEvent(a1,State.STARTING,subsystemEvents.poll(a1.getSubsystemId(),5000));
      assertEvent(a1,State.ACTIVE,subsystemEvents.poll(a1.getSubsystemId(),5000));
      return null;
    }
  }
,new Callable<Void>(){
    @Override public Void call() throws Exception {
      c1.start();
      stoppableSubsystems.add(c1);
      assertEvent(c1,State.INSTALLED,subsystemEvents.poll(c1.getSubsystemId(),5000));
      assertEvent(c1,State.RESOLVING,subsystemEvents.poll(c1.getSubsystemId(),5000));
      assertEvent(c1,State.RESOLVED,subsystemEvents.poll(c1.getSubsystemId(),5000));
      assertEvent(c1,State.STARTING,subsystemEvents.poll(c1.getSubsystemId(),5000));
      assertEvent(c1,State.ACTIVE,subsystemEvents.poll(c1.getSubsystemId(),5000));
      return null;
    }
  }
,new Callable<Void>(){
    @Override public Void call() throws Exception {
      c2.start();
      stoppableSubsystems.add(c2);
      assertEvent(c2,State.INSTALLED,subsystemEvents.poll(c2.getSubsystemId(),5000));
      assertEvent(c2,State.RESOLVING,subsystemEvents.poll(c2.getSubsystemId(),5000));
      assertEvent(c2,State.RESOLVED,subsystemEvents.poll(c2.getSubsystemId(),5000));
      assertEvent(c2,State.STARTING,subsystemEvents.poll(c2.getSubsystemId(),5000));
      assertEvent(c2,State.ACTIVE,subsystemEvents.poll(c2.getSubsystemId(),5000));
      return null;
    }
  }
};
  List<Future<Void>> startFutures=executor.invokeAll(Arrays.asList(startCallables));
  startFutures.get(0).get();
  startFutures.get(1).get();
  startFutures.get(2).get();
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testImplicitlyInstalledChildOverridesProvisionDependencies() throws Exception {
  Subsystem root=getRootSubsystem();
  subsystemEvents.clear();
  try {
    Subsystem subsystem=root.install("parent",new SubsystemArchiveBuilder().symbolicName("parent").type(SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION + ';' + AriesProvisionDependenciesDirective.INSTALL.toString()).subsystem("child",new SubsystemArchiveBuilder().symbolicName("child").type(SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()).build()).build());
    uninstallSubsystemSilently(subsystem);
    fail("Subsystem should not have installed");
  }
 catch (  SubsystemException e) {
    e.printStackTrace();
  }
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
"></span><br>
@Test public void testRestart2() throws Exception {
  Subsystem root=getRootSubsystem();
  Subsystem c1=installSubsystem(root,"c1",new SubsystemArchiveBuilder().symbolicName("c1").type(SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()).content("c1b1;version=\"[0,0]\"").exportPackage("c1b1").importPackage("c2b1").bundle("c1b1",new BundleArchiveBuilder().symbolicName("c1b1").exportPackage("c1b1").importPackage("c2b1").build()).build(),false);
  uninstallableSubsystems.add(c1);
  Subsystem c2=installSubsystem(root,"c2",new SubsystemArchiveBuilder().symbolicName("c2").type(SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()).content("c2b1;version=\"[0,0]\"").exportPackage("c2b1").importPackage("c1b1").bundle("c2b1",new BundleArchiveBuilder().symbolicName("c2b1").exportPackage("c2b1").importPackage("c1b1").build()).build(),false);
  uninstallableSubsystems.add(c2);
  assertChild(root,"c1",null,SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE);
  assertChild(root,"c2",null,SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE);
  restartSubsystemsImplBundle();
  root=getRootSubsystem();
  c1=getChild(root,"c1",null,SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE);
  assertNotNull("Missing child",c1);
  uninstallableSubsystems.add(c1);
  c2=getChild(root,"c2",null,SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE);
  assertNotNull("Missing child",c2);
  uninstallableSubsystems.add(c2);
  startSubsystem(c1,false);
  stoppableSubsystems.add(c1);
  try {
    assertState(EnumSet.of(State.RESOLVED,State.ACTIVE),c2);
  }
 catch (  AssertionError e) {
    System.out.println(c2.getState());
  }
}

</code></pre>

<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void test14() throws Exception {
  Subsystem root=getRootSubsystem();
  Subsystem subsystem=installSubsystem(root,APPLICATION_PROVISION_DEPENDENCIES_INSTALL,applicationProvisionDependenciesInstall(),true);
  try {
    assertConstituent(subsystem,BUNDLE_A);
    assertConstituent(root,BUNDLE_B);
    startSubsystem(subsystem,true);
    stopSubsystem(subsystem);
  }
  finally {
    uninstallSubsystem(subsystem);
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void test16a() throws Exception {
  Subsystem root=getRootSubsystem();
  try {
    Subsystem subsystem=installSubsystem(root,FEATURE_PROVISION_DEPENDENCIES_INSTALL,new SubsystemArchiveBuilder().symbolicName("application").type(SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION + ';' + AriesProvisionDependenciesDirective.INSTALL.toString()).build(),true);
    uninstallSubsystemSilently(subsystem);
  }
 catch (  SubsystemException e) {
    e.printStackTrace();
    fail("Subsystem should have installed");
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void test15b() throws Exception {
  Subsystem root=getRootSubsystem();
  Subsystem application=installSubsystem(root,APPLICATION_PROVISION_DEPENDENCIES_INSTALL,applicationProvisionDependenciesInstall(),true);
  try {
    Subsystem feature=installSubsystem(application,FEATURE_PROVISION_DEPENDENCIES_RESOLVE,featureProvisionDependenciesResolve(),false);
    uninstallSubsystemSilently(feature);
    fail("Subsystem should not have installed");
  }
 catch (  SubsystemException e) {
    e.printStackTrace();
  }
 finally {
    uninstallSubsystemSilently(application);
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testInstallChildIntoInstallingParent() throws Exception {
  Subsystem root=getRootSubsystem();
  Subsystem subsystem=installSubsystem(root,APPLICATION_DEPENDENCY_IN_ARCHIVE,applicationDependencyInArchive(),false);
  try {
    assertState(State.INSTALLING,subsystem);
    installSubsystem(subsystem,APPLICATION_A,applicationA(),false);
    fail("Subsystem should not have installed");
  }
 catch (  SubsystemException e) {
    e.printStackTrace();
  }
 finally {
    uninstallSubsystemSilently(subsystem);
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void test16c() throws Exception {
  Subsystem root=getRootSubsystem();
  try {
    Subsystem subsystem=installSubsystem(root,"application",new SubsystemArchiveBuilder().symbolicName("application").type(SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()).subsystem("feature",new SubsystemArchiveBuilder().symbolicName("feature").type(SubsystemConstants.SUBSYSTEM_TYPE_FEATURE + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()).build()).build(),false);
    uninstallSubsystemSilently(subsystem);
  }
 catch (  SubsystemException e) {
    e.printStackTrace();
    fail("Subsystem should have installed");
  }
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void test9() throws Exception {
  Subsystem root=getRootSubsystem();
  Subsystem subsystem=installSubsystem(root,APPLICATION_MISSING_DEPENDENCY,applicationMissingDependency(),false);
  try {
    startSubsystem(subsystem,false);
    stopSubsystemSilently(subsystem);
    fail("Subsystem should not have started");
  }
 catch (  SubsystemException e) {
    e.printStackTrace();
    assertState(State.INSTALLING,subsystem);
  }
 finally {
    uninstallSubsystemSilently(subsystem);
  }
}

</code></pre>

<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testInterleavingContentDependencies() throws Exception {
  Subsystem root=getRootSubsystem();
  Subsystem c1=installSubsystem(root,"c1",new SubsystemArchiveBuilder().symbolicName("c1").type(SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()).content("c1b1;version=\"[0,0]\"").exportPackage("c1b1").importPackage("c2b1").bundle("c1b1",new BundleArchiveBuilder().symbolicName("c1b1").exportPackage("c1b1").importPackage("c2b1").build()).build(),false);
  uninstallableSubsystems.add(c1);
  Subsystem c2=installSubsystem(root,"c2",new SubsystemArchiveBuilder().symbolicName("c2").type(SubsystemConstants.SUBSYSTEM_TYPE_COMPOSITE + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()).content("c2b1;version=\"[0,0]\"").exportPackage("c2b1").importPackage("c1b1").bundle("c2b1",new BundleArchiveBuilder().symbolicName("c2b1").exportPackage("c2b1").importPackage("c1b1").build()).build(),false);
  uninstallableSubsystems.add(c2);
  startSubsystem(c1,false);
  stoppableSubsystems.add(c1);
  assertState(EnumSet.of(State.RESOLVED,State.ACTIVE),c2);
  stoppableSubsystems.add(c2);
}

</code></pre>

<pre class="type-7 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void test18() throws Exception {
  Subsystem root=getRootSubsystem();
  subsystemEvents.clear();
  Subsystem parent=root.install("parent",new SubsystemArchiveBuilder().symbolicName("parent").type(SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION + ';' + AriesProvisionDependenciesDirective.INSTALL.toString()+ ';'+ SubsystemConstants.PROVISION_POLICY_DIRECTIVE+ ":="+ SubsystemConstants.PROVISION_POLICY_ACCEPT_DEPENDENCIES).content("bundle1").bundle("bundle1",new BundleArchiveBuilder().symbolicName("bundle1").importPackage("a").build()).bundle("bundle2",new BundleArchiveBuilder().symbolicName("bundle2").exportPackage("a").build()).build());
  try {
    long id=parent.getSubsystemId();
    assertEvent(id,"parent",Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.INSTALLING,subsystemEvents.poll(id,5000),ServiceEvent.REGISTERED);
    assertEvent(id,"parent",Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.INSTALLED,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
    assertNull("Unexpected event",subsystemEvents.poll(id,1));
    assertConstituent(parent,"bundle2");
    assertConstituent(parent,"bundle1");
    parent.start();
    Subsystem child=parent.install("child",new SubsystemArchiveBuilder().symbolicName("child").type(SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION + ';' + AriesProvisionDependenciesDirective.RESOLVE.toString()).content("bundle3").bundle("bundle3",new BundleArchiveBuilder().symbolicName("bundle3").importPackage("b").build()).bundle("bundle4",new BundleArchiveBuilder().symbolicName("bundle4").exportPackage("b").build()).build());
    id=child.getSubsystemId();
    assertEvent(id,"child",Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.INSTALLING,subsystemEvents.poll(id,5000),ServiceEvent.REGISTERED);
    assertNull("Unexpected event",subsystemEvents.poll(id,1));
    assertNotConstituent(parent,"bundle4");
    assertConstituent(child,"bundle3");
    child.start();
    try {
      id=parent.getSubsystemId();
      assertEvent(id,"parent",Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.RESOLVING,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
      assertEvent(id,"parent",Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.RESOLVED,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
      assertEvent(id,"parent",Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.STARTING,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
      assertEvent(id,"parent",Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.ACTIVE,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
      assertNull("Unexpected event",subsystemEvents.poll(id,1));
      id=child.getSubsystemId();
      assertEvent(id,"child",Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.INSTALLED,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
      assertEvent(id,"child",Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.RESOLVING,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
      assertEvent(id,"child",Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.RESOLVED,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
      assertEvent(id,"child",Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.STARTING,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
      assertEvent(id,"child",Version.emptyVersion,SubsystemConstants.SUBSYSTEM_TYPE_APPLICATION,State.ACTIVE,subsystemEvents.poll(id,5000),ServiceEvent.MODIFIED);
      assertNull("Unexpected event",subsystemEvents.poll(id,1));
      assertConstituent(parent,"bundle4");
    }
  finally {
      stopSubsystemSilently(parent);
    }
  }
  finally {
    uninstallSubsystemSilently(parent);
  }
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
