<h3 style="margin:0px">Class: org.apache.jackrabbit.oak.jcr.observation.ObservationTest (30 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(28)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(26)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(19)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(12)</kbd></button>&nbsp;<button id="16"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('16')" data-toggle="tooltip" title="Sets implicit assumptions "><kbd id="tag-16"class="label-info"style="display: inline-block;font-size:7pt" >AssumptionSetter&nbsp;(10)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void setup() throws RepositoryException {
  Session session=getAdminSession();
  NodeTypeManager ntMgr=session.getWorkspace().getNodeTypeManager();
  NodeTypeTemplate mixTest=ntMgr.createNodeTypeTemplate();
  mixTest.setName(TEST_TYPE);
  mixTest.setMixin(true);
  ntMgr.registerNodeType(mixTest,false);
  Node n=session.getRootNode().addNode(TEST_NODE);
  n.setProperty("test_property1",42);
  n.setProperty("test_property2","forty_two");
  n.addMixin(TEST_TYPE);
  Node refNode=n.addNode(REFERENCEABLE_NODE);
  refNode.addMixin(JcrConstants.MIX_REFERENCEABLE);
  test_uuid=refNode.getProperty(JcrConstants.JCR_UUID).getString();
  session.save();
  observingSession=createAdminSession();
  observationManager=observingSession.getWorkspace().getObservationManager();
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void removeSubtree() throws RepositoryException, ExecutionException, InterruptedException {
  Node n=getNode(TEST_PATH);
  n.addNode("a").addNode("b").addNode("c");
  getAdminSession().save();
  ExpectationListener listener=new ExpectationListener();
  observationManager.addEventListener(listener,ALL_EVENTS,"/",true,null,null,false);
  listener.expectRemove(n.getNode("a")).remove();
  getAdminSession().save();
  List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
  assertTrue("Missing events: " + missing,missing.isEmpty());
  List<Event> unexpected=listener.getUnexpected();
  assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
}

</code></pre>

<pre class="type-9 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void moveSubtree() throws RepositoryException, ExecutionException, InterruptedException {
  Node n=getNode(TEST_PATH);
  n.addNode("a").addNode("b").addNode("c");
  getAdminSession().save();
  ExpectationListener listener=new ExpectationListener();
  observationManager.addEventListener(listener,ALL_EVENTS,"/",true,null,null,false);
  getAdminSession().move(TEST_PATH + "/a",TEST_PATH + "/t");
  listener.expect(TEST_PATH + "/t",NODE_MOVED);
  listener.expect(TEST_PATH + "/a",NODE_REMOVED);
  listener.expect(TEST_PATH + "/a/jcr:primaryType",PROPERTY_REMOVED);
  listener.expect(TEST_PATH + "/t",NODE_ADDED);
  getAdminSession().save();
  List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
  assertTrue("Missing events: " + missing,missing.isEmpty());
  List<Event> unexpected=listener.getUnexpected();
  assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
}

</code></pre>

<pre class="type-9 type-7 type-16 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void disjunctPaths() throws ExecutionException, InterruptedException, RepositoryException {
  assumeTrue(observationManager instanceof JackrabbitObservationManager);
  JackrabbitObservationManager oManager=(JackrabbitObservationManager)observationManager;
  ExpectationListener listener=new ExpectationListener();
  JackrabbitEventFilter filter=new JackrabbitEventFilter().setAdditionalPaths(TEST_PATH + "/a",TEST_PATH + "/x").setEventTypes(NODE_ADDED);
  oManager.addEventListener(listener,filter);
  Node testNode=getNode(TEST_PATH);
  Node b=testNode.addNode("a").addNode("b");
  b.addNode("c");
  Node y=testNode.addNode("x").addNode("y");
  y.addNode("z");
  listener.expect(b.getPath(),NODE_ADDED);
  listener.expect(y.getPath(),NODE_ADDED);
  testNode.getSession().save();
  List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
  assertTrue("Missing events: " + missing,missing.isEmpty());
  List<Event> unexpected=listener.getUnexpected();
  assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void observation() throws RepositoryException, ExecutionException, InterruptedException {
  ExpectationListener listener=new ExpectationListener();
  observationManager.addEventListener(listener,ALL_EVENTS,"/",true,null,null,false);
  try {
    Node n=getNode(TEST_PATH);
    listener.expectAdd(n.setProperty("p0","v0"));
    Node n1=listener.expectAdd(n.addNode("n1"));
    listener.expectAdd(n1.setProperty("p1","v1"));
    listener.expectAdd(n1.setProperty("p2","v2"));
    listener.expectAdd(n.addNode("n2"));
    getAdminSession().save();
    List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
    assertTrue("Missing events: " + missing,missing.isEmpty());
    List<Event> unexpected=listener.getUnexpected();
    assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
    listener.expectAdd(n.setProperty("property",42));
    Node n3=listener.expectAdd(n.addNode("n3"));
    listener.expectAdd(n3.setProperty("p3","v3"));
    listener.expectChange(n1.setProperty("p1","v1.1"));
    listener.expectRemove(n1.getProperty("p2")).remove();
    listener.expectRemove(n.getNode("n2")).remove();
    listener.expectAdd(n.addNode("{4}"));
    getAdminSession().save();
    missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
    assertTrue("Missing events: " + missing,missing.isEmpty());
    unexpected=listener.getUnexpected();
    assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
  }
  finally {
    observationManager.removeEventListener(listener);
  }
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void typeFilter() throws RepositoryException, InterruptedException, ExecutionException {
  ExpectationListener listener=new ExpectationListener();
  observationManager.addEventListener(listener,ALL_EVENTS,"/",true,null,new String[]{TEST_TYPE},false);
  try {
    Node n=getNode(TEST_PATH);
    Property p=n.setProperty("p","v");
    listener.expectAdd(p);
    Node n1=n.addNode("n1");
    listener.expect(n1.getPath(),NODE_ADDED);
    n1.addNode("n2");
    getAdminSession().save();
    List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
    assertTrue("Missing events: " + missing,missing.isEmpty());
    List<Event> unexpected=listener.getUnexpected();
    assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
    listener.expectChange(p).setValue("v2");
    getAdminSession().save();
    missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
    assertTrue("Missing events: " + missing,missing.isEmpty());
    unexpected=listener.getUnexpected();
    assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
    listener.expectRemove(p).remove();
    getAdminSession().save();
    missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
    assertTrue("Missing events: " + missing,missing.isEmpty());
    unexpected=listener.getUnexpected();
    assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
  }
  finally {
    observationManager.removeEventListener(listener);
  }
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void pathFilterWithTrailingSlash() throws Exception {
  final String path="/events/only/here";
  ExpectationListener listener=new ExpectationListener();
  listener.expect(new Expectation(path){
    @Override public boolean onEvent(    Event event) throws Exception {
      return PathUtils.isAncestor(path,event.getPath());
    }
  }
);
  observationManager.addEventListener(listener,NODE_ADDED,path + '/',true,null,null,false);
  try {
    Node root=getNode("/");
    root.addNode("events").addNode("only").addNode("here").addNode("at");
    root.getSession().save();
    List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
    assertTrue("Missing events: " + missing,missing.isEmpty());
    List<Event> unexpected=listener.getUnexpected();
    assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
  }
  finally {
    observationManager.removeEventListener(listener);
  }
}

</code></pre>

<pre class="type-9 type-7 type-6 type-16 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void addSubtreeFilter() throws RepositoryException, ExecutionException, InterruptedException {
  assumeTrue(observationManager instanceof ObservationManagerImpl);
  ObservationManagerImpl oManager=(ObservationManagerImpl)observationManager;
  ExpectationListener listener=new ExpectationListener();
  FilterBuilder builder=new FilterBuilder();
  builder.condition(builder.addSubtree());
  oManager.addEventListener(listener,builder.build());
  Node testNode=getNode(TEST_PATH);
  Node a=listener.expectAdd(testNode.addNode("a"));
  a.addNode("c");
  testNode.getSession().save();
  List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
  assertTrue("Missing events: " + missing,missing.isEmpty());
  List<Event> unexpected=listener.getUnexpected();
  assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
}

</code></pre>

<pre class="type-9 type-7 type-6 type-16 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void removeSubtreeFilter() throws RepositoryException, ExecutionException, InterruptedException {
  assumeTrue(observationManager instanceof ObservationManagerImpl);
  Node testNode=getNode(TEST_PATH);
  testNode.addNode("a").addNode("c");
  testNode.getSession().save();
  ObservationManagerImpl oManager=(ObservationManagerImpl)observationManager;
  ExpectationListener listener=new ExpectationListener();
  FilterBuilder builder=new FilterBuilder();
  builder.condition(builder.deleteSubtree());
  oManager.addEventListener(listener,builder.build());
  listener.expectRemove(testNode.getNode("a")).remove();
  testNode.getSession().save();
  List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
  assertTrue("Missing events: " + missing,missing.isEmpty());
  List<Event> unexpected=listener.getUnexpected();
  assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
}

</code></pre>

<pre class="type-9 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void uuidFilter() throws RepositoryException, InterruptedException, ExecutionException {
  ExpectationListener listener=new ExpectationListener();
  observationManager.addEventListener(listener,ALL_EVENTS,"/",true,new String[]{test_uuid},null,false);
  try {
    Node nonRefNode=getNode(TEST_PATH);
    Node refNode=nonRefNode.getNode(REFERENCEABLE_NODE);
    nonRefNode.addNode("n");
    listener.expect(refNode.addNode("r").getPath(),NODE_ADDED);
    getAdminSession().save();
    List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
    assertTrue("Missing events: " + missing,missing.isEmpty());
    List<Event> unexpected=listener.getUnexpected();
    assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
  }
  finally {
    observationManager.removeEventListener(listener);
  }
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void propertyValues() throws RepositoryException, ExecutionException, InterruptedException {
  Node n=getNode(TEST_PATH);
  n.setProperty("toChange",new String[]{"one","two"},PropertyType.STRING);
  n.setProperty("toDelete",new String[]{"three","four"},PropertyType.STRING);
  getAdminSession().save();
  ExpectationListener listener=new ExpectationListener();
  observationManager.addEventListener(listener,ALL_EVENTS,"/",true,null,null,false);
  try {
    n.setProperty("added",new String[]{"five","six"},PropertyType.STRING);
    listener.expectValues(null,n.getProperty("added").getValues());
    Value[] before=n.getProperty("toChange").getValues();
    n.getProperty("toChange").setValue(new String[]{"1","2"});
    listener.expectValues(before,n.getProperty("toChange").getValues());
    before=n.getProperty("toDelete").getValues();
    n.getProperty("toDelete").remove();
    listener.expectValues(before,null);
    getAdminSession().save();
    List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
    assertTrue("Missing events: " + missing,missing.isEmpty());
    List<Event> unexpected=listener.getUnexpected();
    assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
  }
  finally {
    observationManager.removeEventListener(listener);
  }
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void tearDown(){
  observingSession.logout();
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testMove() throws RepositoryException, ExecutionException, InterruptedException {
  Node testNode=getNode(TEST_PATH);
  Session session=testNode.getSession();
  Node nodeA=testNode.addNode("a");
  Node nodeAA=nodeA.addNode("aa");
  Node nodeT=testNode.addNode("t");
  Node nodeS=testNode.addNode("s");
  session.save();
  ExpectationListener listener=new ExpectationListener();
  observationManager.addEventListener(listener,NODE_MOVED,"/",true,null,null,false);
  String src1=nodeA.getPath();
  String dst1=nodeT.getPath() + "/b";
  session.move(src1,dst1);
  listener.expectMove(src1,dst1);
  String src2=nodeT.getPath() + "/b/aa";
  String dst2=nodeS.getPath() + "/bb";
  session.move(src2,dst2);
  listener.expectMove(src1 + "/aa",dst2);
  session.save();
  List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
  assertTrue("Missing events: " + missing,missing.isEmpty());
  List<Event> unexpected=listener.getUnexpected();
  assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
}

</code></pre>

<pre class="type-9 type-7 type-16 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void noDuplicates() throws ExecutionException, InterruptedException, RepositoryException {
  assumeTrue(observationManager instanceof JackrabbitObservationManager);
  JackrabbitObservationManager oManager=(JackrabbitObservationManager)observationManager;
  ExpectationListener listener=new ExpectationListener();
  JackrabbitEventFilter filter=new JackrabbitEventFilter().setAdditionalPaths(TEST_PATH + "/a",TEST_PATH + "/a").setEventTypes(NODE_ADDED);
  oManager.addEventListener(listener,filter);
  Node testNode=getNode(TEST_PATH);
  Node b=testNode.addNode("a").addNode("b");
  b.addNode("c");
  Node y=testNode.addNode("x").addNode("y");
  y.addNode("z");
  listener.expect(b.getPath(),NODE_ADDED);
  testNode.getSession().save();
  List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
  assertTrue("Missing events: " + missing,missing.isEmpty());
  List<Event> unexpected=listener.getUnexpected();
  assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
}

</code></pre>

<pre class="type-9 type-7 type-6 type-16 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRename() throws RepositoryException, ExecutionException, InterruptedException {
  Node testNode=getNode(TEST_PATH);
  Session session=testNode.getSession();
  Node nodeA=testNode.addNode("a");
  String parentPath=testNode.getPath();
  session.save();
  assumeTrue(nodeA instanceof JackrabbitNode);
  ExpectationListener listener=new ExpectationListener();
  observationManager.addEventListener(listener,NODE_MOVED,"/",true,null,null,false);
  ((JackrabbitNode)nodeA).rename("b");
  listener.expectMove(parentPath + "/a",parentPath + "/b");
  session.save();
  List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
  assertTrue("Missing events: " + missing,missing.isEmpty());
  List<Event> unexpected=listener.getUnexpected();
  assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
}

</code></pre>

<pre class="type-9 type-7 type-16 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void parentPathExclude() throws ExecutionException, InterruptedException, RepositoryException {
  assumeTrue(observationManager instanceof JackrabbitObservationManager);
  Node n=getNode(TEST_PATH).addNode("n");
  getAdminSession().save();
  JackrabbitObservationManager oManager=(JackrabbitObservationManager)observationManager;
  ExpectationListener listener=new ExpectationListener();
  JackrabbitEventFilter filter=new JackrabbitEventFilter().setAbsPath(n.getPath()).setIsDeep(true).setExcludedPaths(n.getParent().getPath()).setEventTypes(ALL_EVENTS);
  oManager.addEventListener(listener,filter);
  n.addNode("n1");
  getAdminSession().save();
  List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
  assertTrue("Missing events: " + missing,missing.isEmpty());
  List<Event> unexpected=listener.getUnexpected();
  assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void identifier() throws RepositoryException, InterruptedException, ExecutionException {
  ExpectationListener listener=new ExpectationListener();
  observationManager.addEventListener(listener,NODE_ADDED,TEST_PATH,true,null,null,false);
  try {
    Node n=getNode(TEST_PATH);
    listener.expect(new Expectation("Has correct id"){
      @Override public boolean onEvent(      Event event) throws Exception {
        return (TEST_PATH + "/newNode").equals(event.getIdentifier());
      }
    }
);
    n.addNode("newNode");
    getAdminSession().save();
    List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
    assertTrue("Missing events: " + missing,missing.isEmpty());
    List<Event> unexpected=listener.getUnexpected();
    assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
  }
  finally {
    observationManager.removeEventListener(listener);
  }
}

</code></pre>

<pre class="type-9 type-7 type-16 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void filterPropertyOfChild() throws RepositoryException, ExecutionException, InterruptedException {
  assumeTrue(observationManager instanceof ObservationManagerImpl);
  ObservationManagerImpl oManager=(ObservationManagerImpl)observationManager;
  ExpectationListener listener=new ExpectationListener();
  FilterBuilder builder=new FilterBuilder();
  builder.condition(builder.property(Selectors.fromThis("b/c"),"foo",new Predicate<PropertyState>(){
    @Override public boolean apply(    PropertyState property){
      return "bar".equals(property.getValue(STRING));
    }
  }
));
  oManager.addEventListener(listener,builder.build());
  Node testNode=getNode(TEST_PATH);
  Node a=testNode.addNode("a");
  a.addNode("b").addNode("c").setProperty("foo","bar");
  a.addNode("d");
  Node x=testNode.addNode("x");
  x.addNode("b").addNode("c").setProperty("foo","baz");
  x.addNode("d");
  listener.expect(a.getPath(),NODE_ADDED);
  testNode.getSession().save();
  List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
  assertTrue("Missing events: " + missing,missing.isEmpty());
  List<Event> unexpected=listener.getUnexpected();
  assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void addSubtree() throws RepositoryException, ExecutionException, InterruptedException {
  ExpectationListener listener=new ExpectationListener();
  observationManager.addEventListener(listener,ALL_EVENTS,"/",true,null,null,false);
  Node n=getNode(TEST_PATH);
  Node a=listener.expectAdd(n.addNode("a"));
  Node b=listener.expectAdd(a.addNode("b"));
  listener.expectAdd(b.addNode("c"));
  getAdminSession().save();
  List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
  assertTrue("Missing events: " + missing,missing.isEmpty());
  List<Event> unexpected=listener.getUnexpected();
  assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void infoMap() throws RepositoryException, ExecutionException, InterruptedException {
  Node n=getNode(TEST_PATH);
  Node n3=n.addNode("n3");
  n3.setProperty("p1","q1");
  n3.setProperty("p2","q2");
  getAdminSession().save();
  ExpectationListener listener=new ExpectationListener();
  observationManager.addEventListener(listener,ALL_EVENTS,"/",true,null,null,false);
  try {
    n.addNode("n1","oak:Unstructured");
    n.addNode("n2");
    n.getNode("n2").addMixin(TEST_TYPE);
    n3.setProperty("p1","changed");
    n3.setProperty("p2",(String)null);
    listener.expect(new Expectation("infoMap for n1"){
      @Override public boolean onEvent(      Event event) throws Exception {
        if (event.getType() == NODE_ADDED && event.getPath().endsWith("n1")) {
          Map<?,?> info=event.getInfo();
          return info != null && "oak:Unstructured".equals(info.get(JCR_PRIMARYTYPE));
        }
 else {
          return false;
        }
      }
    }
);
    listener.expect(new Expectation("infoMap for n1/jcr:primaryType"){
      @Override public boolean onEvent(      Event event) throws Exception {
        if (event.getType() == PROPERTY_ADDED && event.getPath().endsWith("n1/jcr:primaryType")) {
          Map<?,?> info=event.getInfo();
          return info != null && "oak:Unstructured".equals(info.get(JCR_PRIMARYTYPE));
        }
 else {
          return false;
        }
      }
    }
);
    listener.expect(new Expectation("infoMap for n2"){
      @Override public boolean onEvent(      Event event) throws Exception {
        if (event.getType() == NODE_ADDED && event.getPath().endsWith("n2")) {
          Map<?,?> info=event.getInfo();
          if (info == null) {
            return false;
          }
          Object mixinTypes=info.get(JCR_MIXINTYPES);
          if (!(mixinTypes instanceof String[])) {
            return false;
          }
          Object primaryType=info.get(JCR_PRIMARYTYPE);
          String[] mixins=(String[])mixinTypes;
          return NT_UNSTRUCTURED.equals(primaryType) && mixins.length == 1 && TEST_TYPE.equals(mixins[0]);
        }
 else {
          return false;
        }
      }
    }
);
    listener.expect(new Expectation("n2/jcr:primaryType"){
      @Override public boolean onEvent(      Event event) throws Exception {
        return event.getType() == PROPERTY_ADDED && event.getPath().endsWith("n2/jcr:primaryType");
      }
    }
);
    listener.expect(new Expectation("n2/jcr:mixinTypes"){
      @Override public boolean onEvent(      Event event) throws Exception {
        return event.getType() == PROPERTY_ADDED && event.getPath().endsWith("n2/jcr:mixinTypes");
      }
    }
);
    listener.expect(new Expectation("infoMap for n3/p1"){
      @Override public boolean onEvent(      Event event) throws Exception {
        if (event.getType() == PROPERTY_CHANGED && event.getPath().endsWith("n3/p1")) {
          Map<?,?> info=event.getInfo();
          return info != null && NT_UNSTRUCTURED.equals(info.get(JCR_PRIMARYTYPE));
        }
 else {
          return false;
        }
      }
    }
);
    listener.expect(new Expectation("infoMap for n3/p2"){
      @Override public boolean onEvent(      Event event) throws Exception {
        if (event.getType() == PROPERTY_REMOVED && event.getPath().endsWith("n3/p2")) {
          Map<?,?> info=event.getInfo();
          return info != null && NT_UNSTRUCTURED.equals(info.get(JCR_PRIMARYTYPE));
        }
 else {
          return false;
        }
      }
    }
);
    getAdminSession().save();
    List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
    assertTrue("Missing events: " + missing,missing.isEmpty());
    List<Event> unexpected=listener.getUnexpected();
    assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
  }
  finally {
    observationManager.removeEventListener(listener);
  }
}

</code></pre>

<pre class="type-9 type-7 type-16 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void filterPropertyOfParent() throws RepositoryException, ExecutionException, InterruptedException {
  assumeTrue(observationManager instanceof ObservationManagerImpl);
  ObservationManagerImpl oManager=(ObservationManagerImpl)observationManager;
  ExpectationListener listener=new ExpectationListener();
  FilterBuilder builder=new FilterBuilder();
  builder.condition(builder.property(Selectors.PARENT,"foo",new Predicate<PropertyState>(){
    @Override public boolean apply(    PropertyState property){
      return "bar".equals(property.getValue(STRING));
    }
  }
));
  oManager.addEventListener(listener,builder.build());
  Node testNode=getNode(TEST_PATH);
  Node a=testNode.addNode("a");
  Node x=testNode.addNode("x");
  a.setProperty("foo","bar");
  x.setProperty("foo","baz");
  a.addNode("b");
  x.addNode("y");
  listener.expect(a.getPath() + "/jcr:primaryType",PROPERTY_ADDED);
  listener.expect(a.getPath() + "/foo",PROPERTY_ADDED);
  listener.expect(a.getPath() + "/b",NODE_ADDED);
  testNode.getSession().save();
  List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
  assertTrue("Missing events: " + missing,missing.isEmpty());
  List<Event> unexpected=listener.getUnexpected();
  assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
}

</code></pre>

<pre class="type-9 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void pathFilter() throws Exception {
  final String path="/events/only/here";
  for (  boolean deep : new boolean[]{false,true}) {
    Node root=getNode("/");
    if (root.hasNode("events")) {
      root.getNode("events").remove();
      root.getSession().save();
    }
    ExpectationListener listener=new ExpectationListener();
    observationManager.addEventListener(listener,NODE_ADDED,path,deep,null,null,false);
    try {
      root.addNode("events").addNode("only").addNode("here").addNode("below").addNode("this");
      listener.expect("/events/only/here/below",NODE_ADDED);
      if (deep) {
        listener.expect("/events/only/here/below/this",NODE_ADDED);
      }
      root.getSession().save();
      List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
      assertTrue("Missing events: " + missing,missing.isEmpty());
      List<Event> unexpected=listener.getUnexpected();
      assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
    }
  finally {
      observationManager.removeEventListener(listener);
    }
  }
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testReorder() throws RepositoryException, InterruptedException, ExecutionException {
  Node testNode=getNode(TEST_PATH);
  Node nodeA=testNode.addNode("a","nt:unstructured");
  Node nodeB=testNode.addNode("b","nt:unstructured");
  testNode.getSession().save();
  ExpectationListener listener=new ExpectationListener();
  observationManager.addEventListener(listener,NODE_MOVED,"/",true,null,null,false);
  listener.expect(new Expectation("orderBefore"){
    @Override public boolean onEvent(    Event event) throws Exception {
      if (event.getType() != NODE_MOVED || event.getInfo() == null) {
        return false;
      }
      Map<?,?> info=event.getInfo();
      if (PathUtils.concat(TEST_PATH,"a").equals(event.getPath())) {
        return "a".equals(info.get("srcChildRelPath")) && "b".equals(info.get("destChildRelPath"));
      }
 else       if (PathUtils.concat(TEST_PATH,"b").equals(event.getPath())) {
        return "b".equals(info.get("srcChildRelPath")) && "a".equals(info.get("destChildRelPath"));
      }
 else {
        return false;
      }
    }
  }
);
  testNode.orderBefore(nodeA.getName(),null);
  testNode.getSession().save();
  List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
  assertTrue("Missing events: " + missing,missing.isEmpty());
  List<Event> unexpected=listener.getUnexpected();
  assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
}

</code></pre>

<pre class="type-9 type-7 type-6 type-16 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void pathExclude() throws ExecutionException, InterruptedException, RepositoryException {
  assumeTrue(observationManager instanceof JackrabbitObservationManager);
  JackrabbitObservationManager oManager=(JackrabbitObservationManager)observationManager;
  ExpectationListener listener=new ExpectationListener();
  JackrabbitEventFilter filter=new JackrabbitEventFilter().setAbsPath(TEST_PATH).setIsDeep(true).setExcludedPaths(TEST_PATH + "/c",TEST_PATH + "/d","/x/y").setEventTypes(ALL_EVENTS);
  oManager.addEventListener(listener,filter);
  Node n=getNode(TEST_PATH);
  listener.expectAdd(listener.expectAdd(listener.expectAdd(n.addNode("a")).addNode("a1")).setProperty("p","q"));
  listener.expectAdd(listener.expectAdd(n.addNode("b")).setProperty("p","q"));
  n.addNode("c").addNode("c1").setProperty("p","q");
  n.addNode("d").setProperty("p","q");
  getAdminSession().save();
  List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
  assertTrue("Missing events: " + missing,missing.isEmpty());
  List<Event> unexpected=listener.getUnexpected();
  assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void observation2() throws RepositoryException, InterruptedException, ExecutionException {
  ExpectationListener listener=new ExpectationListener();
  observationManager.addEventListener(listener,ALL_EVENTS,"/",true,null,null,false);
  try {
    Node n=getNode(TEST_PATH);
    listener.expectAdd(n.addNode("n1"));
    getAdminSession().save();
    List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
    assertTrue("Missing events: " + missing,missing.isEmpty());
    List<Event> unexpected=listener.getUnexpected();
    assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
    listener.expectAdd(n.addNode("n2"));
    listener.expectRemove(n.getNode("n1")).remove();
    getAdminSession().save();
    missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
    assertTrue("Missing events: " + missing,missing.isEmpty());
    unexpected=listener.getUnexpected();
    assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
  }
  finally {
    observationManager.removeEventListener(listener);
  }
}

</code></pre>

<pre class="type-7 type-6 type-8 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void observationDispose() throws RepositoryException, InterruptedException, ExecutionException, TimeoutException {
  final ExpectationListener listener=new ExpectationListener();
  Expectation hasEvents=listener.expect(new Expectation("has events after registering"));
  final Expectation noEvents=listener.expect(new Expectation("has no more events after unregistering",false));
  observationManager.addEventListener(listener,ALL_EVENTS,"/",true,null,null,false);
  final Session s=getAdminSession();
  ScheduledExecutorService service=newSingleThreadScheduledExecutor();
  service.scheduleWithFixedDelay(new Runnable(){
    private int c;
    @Override public void run(){
      try {
        s.getNode(TEST_PATH).addNode("c" + c++).getSession().save();
      }
 catch (      RepositoryException e) {
        throw new RuntimeException(e);
      }
    }
  }
,10,10,TimeUnit.MILLISECONDS);
  assertNotNull(hasEvents.get(TIME_OUT,TimeUnit.SECONDS));
  Executors.newSingleThreadExecutor().submit(new Callable<Void>(){
    @Override public Void call() throws Exception {
      observationManager.removeEventListener(listener);
      noEvents.enable(true);
      return null;
    }
  }
).get(10,TimeUnit.SECONDS);
  assertFalse(noEvents.wait(4,TimeUnit.SECONDS));
  service.shutdown();
  service.awaitTermination(10,TimeUnit.SECONDS);
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void observationOnRootNode() throws Exception {
  ExpectationListener listener=new ExpectationListener();
  observationManager.addEventListener(listener,PROPERTY_ADDED,"/",true,null,null,false);
  try {
    Node root=getNode("/");
    listener.expectAdd(root.setProperty("prop","value"));
    root.getSession().save();
    List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
    assertTrue("Missing events: " + missing,missing.isEmpty());
    List<Event> unexpected=listener.getUnexpected();
    assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
  }
  finally {
    observationManager.removeEventListener(listener);
  }
}

</code></pre>

<pre class="type-9 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void propertyValue() throws RepositoryException, ExecutionException, InterruptedException {
  ExpectationListener listener=new ExpectationListener();
  observationManager.addEventListener(listener,ALL_EVENTS,"/",true,null,null,false);
  try {
    Node n=getNode(TEST_PATH);
    n.setProperty("added",42);
    listener.expectValue(null,n.getProperty("added").getValue());
    Value before=n.getProperty("test_property1").getValue();
    n.getProperty("test_property1").setValue(43);
    listener.expectValue(before,n.getProperty("test_property1").getValue());
    before=n.getProperty("test_property2").getValue();
    n.getProperty("test_property2").remove();
    listener.expectValue(before,null);
    getAdminSession().save();
    List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
    assertTrue("Missing events: " + missing,missing.isEmpty());
    List<Event> unexpected=listener.getUnexpected();
    assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
  }
  finally {
    observationManager.removeEventListener(listener);
  }
}

</code></pre>

<pre class="type-9 type-7 type-16 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void filterDisjunctPaths() throws ExecutionException, InterruptedException, RepositoryException {
  assumeTrue(observationManager instanceof JackrabbitObservationManager);
  ObservationManagerImpl oManager=(ObservationManagerImpl)observationManager;
  ExpectationListener listener=new ExpectationListener();
  FilterBuilder builder=new FilterBuilder();
  builder.condition(builder.any(builder.path(TEST_PATH + "/a/b"),builder.path(TEST_PATH + "/x/y")));
  oManager.addEventListener(listener,builder.build());
  Node testNode=getNode(TEST_PATH);
  Node b=testNode.addNode("a").addNode("b");
  b.addNode("c");
  Node y=testNode.addNode("x").addNode("y");
  y.addNode("z");
  listener.expect(b.getPath(),NODE_ADDED);
  listener.expect(y.getPath(),NODE_ADDED);
  testNode.getSession().save();
  List<Expectation> missing=listener.getMissing(TIME_OUT,TimeUnit.SECONDS);
  assertTrue("Missing events: " + missing,missing.isEmpty());
  List<Event> unexpected=listener.getUnexpected();
  assertTrue("Unexpected events: " + unexpected,unexpected.isEmpty());
}

</code></pre>

<pre class="type-7 type-6 type-8 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void observationDisposeFromListener() throws RepositoryException, InterruptedException, ExecutionException, TimeoutException {
  final ExpectationListener listener=new ExpectationListener();
  Expectation unregistered=listener.expect(new Expectation("Unregistering listener from event handler should not block"){
    @Override public boolean onEvent(    Event event) throws Exception {
      observationManager.removeEventListener(listener);
      return true;
    }
  }
);
  observationManager.addEventListener(listener,ALL_EVENTS,"/",true,null,null,false);
  assertTrue(observationManager.getRegisteredEventListeners().hasNext());
  Node n=getNode(TEST_PATH);
  n.addNode("c");
  n.getSession().save();
  assertNotNull(unregistered.get(TIME_OUT,TimeUnit.SECONDS));
  assertFalse(observationManager.getRegisteredEventListeners().hasNext());
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
