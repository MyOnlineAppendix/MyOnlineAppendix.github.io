<h3 style="margin:0px">Class: org.apache.jackrabbit.oak.plugins.document.DocumentSplitTest (22 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(19)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(13)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(13)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(13)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(12)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(8)</kbd></button>&nbsp;<button id="12"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('12')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-12"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(3)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >ExceptionVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-9 type-12 type-5 type-7 type-6 type-4 type-8 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void cascadingWithSplitRatio(){
  String id=Utils.getIdFromPath("/test");
  mk.commit("/","+\"test\":{}",null,null);
  DocumentStore store=mk.getDocumentStore();
  int clusterId=mk.getNodeStore().getClusterId();
  UpdateOp op=new UpdateOp(id,false);
  for (int i=0; i < 1000; i++) {
    Revision r=Revision.newRevision(2);
    op.setMapEntry("prop",r,"some long test value with many characters");
    NodeDocument.setRevision(op,r,"c");
  }
  store.findAndUpdate(NODES,op);
  NodeDocument doc=store.find(NODES,id);
  assertNotNull(doc);
  assertTrue(doc.getMemory() > NodeDocument.DOC_SIZE_THRESHOLD);
  for (int i=0; i < NUM_REVS_THRESHOLD / 2; i++) {
    Revision r=Revision.newRevision(clusterId);
    op.setMapEntry("prop",r,"value");
    NodeDocument.setRevision(op,r,"c");
  }
  TreeSet<Revision> prev=Sets.newTreeSet(StableRevisionComparator.INSTANCE);
  for (int i=0; i < PREV_SPLIT_FACTOR; i++) {
    Revision low=Revision.newRevision(clusterId);
    Revision high=Revision.newRevision(clusterId);
    prev.add(high);
    NodeDocument.setPrevious(op,new Range(high,low,0));
  }
  store.findAndUpdate(NODES,op);
  doc=store.find(NODES,id);
  assertNotNull(doc);
  List<UpdateOp> splitOps=Lists.newArrayList(doc.split(mk.getNodeStore(),mk.getNodeStore().getHeadRevision()));
  assertEquals(2,splitOps.size());
  op=splitOps.get(0);
  String newPrevId=Utils.getPreviousIdFor("/test",prev.last(),1);
  assertEquals(newPrevId,op.getId());
  op=splitOps.get(1);
  assertEquals(id,op.getId());
  for (  Map.Entry<Key,Operation> entry : op.getChanges().entrySet()) {
    Revision r=entry.getKey().getRevision();
    assertNotNull(r);
    assertEquals(clusterId,r.getClusterId());
    if (entry.getKey().getName().equals("_prev")) {
      if (entry.getValue().type == REMOVE_MAP_ENTRY) {
        assertTrue(prev.contains(r));
      }
 else       if (entry.getValue().type == SET_MAP_ENTRY) {
        assertEquals(newPrevId,Utils.getPreviousIdFor("/test",r,1));
      }
 else {
        fail("unexpected update operation " + entry);
      }
    }
 else {
      fail("unexpected update operation " + entry);
    }
  }
}

</code></pre>

<pre class="type-7 type-6 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void splitDocWithHasBinary() throws Exception {
  DocumentStore store=mk.getDocumentStore();
  DocumentNodeStore ns=mk.getNodeStore();
  NodeBuilder b1=ns.getRoot().builder();
  b1.child("test").child("foo").setProperty("binaryProp",ns.createBlob(randomStream(1,4096)));
  ns.merge(b1,EmptyHook.INSTANCE,CommitInfo.EMPTY);
  for (int i=0; i < NodeDocument.NUM_REVS_THRESHOLD; i++) {
    b1=ns.getRoot().builder();
    b1.child("test").child("foo").setProperty("prop",i);
    ns.merge(b1,EmptyHook.INSTANCE,CommitInfo.EMPTY);
  }
  ns.runBackgroundOperations();
  NodeDocument doc=store.find(NODES,Utils.getIdFromPath("/test/foo"));
  List<NodeDocument> prevDocs=ImmutableList.copyOf(doc.getAllPreviousDocs());
  assertEquals(1,prevDocs.size());
  assertTrue(doc.hasBinary());
  assertTrue(prevDocs.get(0).hasBinary());
}

</code></pre>

<pre class="type-13 type-7 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void removeGarbage() throws Exception {
  final DocumentStore store=mk.getDocumentStore();
  final DocumentNodeStore ns=mk.getNodeStore();
  final List<Exception> exceptions=Lists.newArrayList();
  final List<RevisionVector> revisions=Lists.newArrayList();
  Thread t=new Thread(new Runnable(){
    @Override public void run(){
      try {
        for (int i=0; i < 200; i++) {
          NodeBuilder builder=ns.getRoot().builder();
          builder.child("foo").child("node").child("node").child("node").child("node");
          builder.child("bar").child("node").child("node").child("node").child("node");
          merge(ns,builder);
          revisions.add(ns.getHeadRevision());
          builder=ns.getRoot().builder();
          builder.child("foo").child("node").remove();
          builder.child("bar").child("node").remove();
          merge(ns,builder);
          revisions.add(ns.getHeadRevision());
        }
      }
 catch (      CommitFailedException e) {
        exceptions.add(e);
      }
    }
  }
);
  t.start();
  RevisionContext rc=new TestRevisionContext(ns);
  while (t.isAlive()) {
    for (    String id : ns.getSplitCandidates()) {
      RevisionVector head=ns.getHeadRevision();
      NodeDocument doc=store.find(NODES,id);
      List<UpdateOp> ops=SplitOperations.forDocument(doc,rc,head,NUM_REVS_THRESHOLD);
      Set<Revision> removed=Sets.newHashSet();
      Set<Revision> added=Sets.newHashSet();
      for (      UpdateOp op : ops) {
        for (        Map.Entry<Key,Operation> e : op.getChanges().entrySet()) {
          if (!"_deleted".equals(e.getKey().getName())) {
            continue;
          }
          Revision r=e.getKey().getRevision();
          if (e.getValue().type == Operation.Type.REMOVE_MAP_ENTRY) {
            removed.add(r);
          }
 else           if (e.getValue().type == Operation.Type.SET_MAP_ENTRY) {
            added.add(r);
          }
        }
      }
      removed.removeAll(added);
      assertTrue("SplitOperations must not remove committed changes: " + removed,removed.isEmpty());
    }
    ns.runBackgroundOperations();
  }
  for (  NodeDocument doc : Utils.getAllDocuments(store)) {
    if (doc.isSplitDocument() || Utils.getDepthFromId(doc.getId()) < 2) {
      continue;
    }
    Set<Revision> revs=Sets.newHashSet();
    for (    RevisionVector rv : revisions) {
      Iterables.addAll(revs,rv);
    }
    revs.removeAll(doc.getValueMap("_deleted").keySet());
    assertTrue("Missing _deleted entries on " + doc.getId() + ": "+ revs,revs.isEmpty());
  }
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void cascadingSplitLongPath(){
  String p="/";
  while (!Utils.isLongPath(p)) {
    p=PathUtils.concat(p,"long-path-element");
  }
  cascadingSplit(p);
}

</code></pre>

<pre class="type-7 type-6 type-8 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void commitRootForChildrenFlag() throws Exception {
  DocumentStore store=mk.getDocumentStore();
  DocumentNodeStore ns=mk.getNodeStore();
  for (int i=0; i < NUM_REVS_THRESHOLD * 2; i++) {
    NodeBuilder builder=ns.getRoot().builder();
    builder.child("test").child("child-" + i);
    merge(ns,builder);
  }
  ns.runBackgroundOperations();
  NodeDocument doc=store.find(NODES,Utils.getIdFromPath("/test"));
  assertNotNull(doc);
  assertTrue(doc.getLocalCommitRoot().size() < NUM_REVS_THRESHOLD);
}

</code></pre>

<pre class="type-7 type-6 type-4 type-8 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void splitPropertyRevisions() throws Exception {
  DocumentStore store=mk.getDocumentStore();
  mk.commit("/","+\"foo\":{}",null,null);
  NodeDocument doc=store.find(NODES,Utils.getIdFromPath("/foo"));
  assertNotNull(doc);
  Set<Revision> revisions=Sets.newHashSet();
  while (revisions.size() <= NodeDocument.NUM_REVS_THRESHOLD) {
    revisions.add(Revision.fromString(mk.commit("/","^\"foo/prop\":" + revisions.size(),null,null)));
  }
  mk.runBackgroundOperations();
  doc=store.find(NODES,Utils.getIdFromPath("/foo"));
  assertNotNull(doc);
  Map<Revision,String> localRevs=doc.getLocalRevisions();
  assertEquals(1,localRevs.size());
  for (  Revision rev : revisions) {
    assertTrue(doc.isCommitted(rev));
  }
  Map<Revision,String> valueMap=doc.getValueMap("prop");
  assertEquals((long)revisions.size(),valueMap.size());
  valueMap=doc.getLocalMap("prop");
  assertEquals(1L,valueMap.size());
}

</code></pre>

<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSplitDocNoChild() throws Exception {
  DocumentStore store=mk.getDocumentStore();
  DocumentNodeStore ns=mk.getNodeStore();
  mk.commit("/","+\"test\":{\"node\":{}}",null,null);
  mk.commit("/test","+\"foo\":{}+\"bar\":{}",null,null);
  for (int i=0; i < NodeDocument.NUM_REVS_THRESHOLD; i++) {
    mk.commit("/test/foo","^\"prop\":" + i,null,null);
  }
  ns.runBackgroundOperations();
  NodeDocument doc=store.find(NODES,Utils.getIdFromPath("/test/foo"));
  List<NodeDocument> prevDocs=ImmutableList.copyOf(doc.getAllPreviousDocs());
  assertEquals(1,prevDocs.size());
  assertEquals(SplitDocType.DEFAULT_LEAF,prevDocs.get(0).getSplitDocType());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void cascadingSplit(){
  cascadingSplit("/test/node");
}

</code></pre>

<pre class="type-12 type-7 type-6 type-4 type-8 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void cluster(){
  MemoryDocumentStore ds=new MemoryDocumentStore();
  MemoryBlobStore bs=new MemoryBlobStore();
  DocumentMK.Builder builder;
  builder=new DocumentMK.Builder();
  builder.setDocumentStore(ds).setBlobStore(bs).setAsyncDelay(0);
  DocumentMK mk1=builder.setClusterId(1).open();
  mk1.commit("/","+\"test\":{\"prop1\":0}",null,null);
  mk1.backgroundWrite();
  builder=new DocumentMK.Builder();
  builder.setDocumentStore(ds).setBlobStore(bs).setAsyncDelay(0);
  DocumentMK mk2=builder.setClusterId(2).open();
  builder=new DocumentMK.Builder();
  builder.setDocumentStore(ds).setBlobStore(bs).setAsyncDelay(0);
  DocumentMK mk3=builder.setClusterId(3).open();
  for (int i=0; i < NodeDocument.NUM_REVS_THRESHOLD; i++) {
    mk1.commit("/","^\"test/prop1\":" + i,null,null);
    mk2.commit("/","^\"test/prop2\":" + i,null,null);
    mk3.commit("/","^\"test/prop3\":" + i,null,null);
  }
  mk1.runBackgroundOperations();
  mk2.runBackgroundOperations();
  mk3.runBackgroundOperations();
  NodeDocument doc=ds.find(NODES,Utils.getIdFromPath("/test"));
  assertNotNull(doc);
  Map<Revision,String> revs=doc.getLocalRevisions();
  assertEquals(3,revs.size());
  revs=doc.getValueMap("_revisions");
  assertEquals(3 * NodeDocument.NUM_REVS_THRESHOLD,revs.size());
  Revision previous=null;
  for (  Map.Entry<Revision,String> entry : revs.entrySet()) {
    if (previous != null) {
      assertTrue(previous.compareRevisionTimeThenClusterId(entry.getKey()) > 0);
    }
    previous=entry.getKey();
  }
  mk1.dispose();
  mk2.dispose();
  mk3.dispose();
}

</code></pre>

<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void mainPath(){
  Revision r=Revision.fromString("r1-0-1");
  for (  String path : new String[]{"/","/test","/test/path"}) {
    DocumentStore store=mk.getDocumentStore();
    NodeDocument doc=new NodeDocument(store);
    String id=Utils.getPreviousIdFor(path,r,0);
    doc.put(NodeDocument.ID,id);
    assertEquals(path,doc.getMainPath());
  }
}

</code></pre>

<pre class="type-7 type-6 type-4 type-8 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void splitCommitRoot() throws Exception {
  DocumentStore store=mk.getDocumentStore();
  mk.commit("/","+\"foo\":{}+\"bar\":{}",null,null);
  NodeDocument doc=store.find(NODES,Utils.getIdFromPath("/foo"));
  assertNotNull(doc);
  Set<Revision> commitRoots=Sets.newHashSet();
  commitRoots.addAll(doc.getLocalCommitRoot().keySet());
  while (commitRoots.size() <= NodeDocument.NUM_REVS_THRESHOLD) {
    commitRoots.add(Revision.fromString(mk.commit("/","^\"foo/prop\":" + commitRoots.size() + "^\"bar/prop\":"+ commitRoots.size(),null,null)));
  }
  mk.runBackgroundOperations();
  doc=store.find(NODES,Utils.getIdFromPath("/foo"));
  assertNotNull(doc);
  Map<Revision,String> commits=doc.getLocalCommitRoot();
  assertEquals(2,commits.size());
  for (  Revision rev : commitRoots) {
    assertTrue(doc.isCommitted(rev));
  }
}

</code></pre>

<pre class="type-9 type-12 type-5 type-6 type-8 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void readLocalCommitInfo() throws Exception {
  final Set<String> readSet=Sets.newHashSet();
  DocumentStore store=new MemoryDocumentStore(){
    @Override public <T extends Document>T find(    Collection<T> collection,    String key,    int maxCacheAge){
      readSet.add(key);
      return super.find(collection,key,maxCacheAge);
    }
  }
;
  DocumentNodeStore ns=new DocumentMK.Builder().setDocumentStore(store).setAsyncDelay(0).getNodeStore();
  NodeBuilder builder=ns.getRoot().builder();
  builder.child("test");
  ns.merge(builder,EmptyHook.INSTANCE,CommitInfo.EMPTY);
  for (int i=0; i < NUM_REVS_THRESHOLD; i++) {
    builder=ns.getRoot().builder();
    builder.setProperty("p",i);
    builder.child("test").setProperty("p",i);
    builder.child("test").setProperty("q",i);
    ns.merge(builder,EmptyHook.INSTANCE,CommitInfo.EMPTY);
  }
  builder=ns.getRoot().builder();
  builder.child("test").removeProperty("q");
  ns.merge(builder,EmptyHook.INSTANCE,CommitInfo.EMPTY);
  ns.runBackgroundOperations();
  NodeDocument doc=store.find(NODES,Utils.getIdFromPath("/test"));
  assertNotNull(doc);
  readSet.clear();
  doc.getNodeAtRevision(ns,ns.getHeadRevision(),null);
  for (  String id : Sets.newHashSet(readSet)) {
    doc=store.find(NODES,id);
    assertNotNull(doc);
    if (doc.isSplitDocument() && !doc.getMainPath().equals("/")) {
      fail("must not access previous document: " + id);
    }
  }
  ns.dispose();
}

</code></pre>

<pre class="type-5 type-7 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void purgeAllButMostRecentCommitRoot() throws Exception {
  DocumentStore store=mk.getDocumentStore();
  DocumentNodeStore ns1=mk.getNodeStore();
  NodeBuilder builder1=ns1.getRoot().builder();
  builder1.child("test");
  merge(ns1,builder1);
  ns1.runBackgroundOperations();
  DocumentNodeStore ns2=new DocumentMK.Builder().setDocumentStore(store).setAsyncDelay(0).setClusterId(ns1.getClusterId() + 1).getNodeStore();
  ns2.setMaxBackOffMillis(0);
  assertTrue(ns2.getRoot().hasChildNode("test"));
  NodeBuilder builder2=ns2.getRoot().builder();
  builder2.child("test").remove();
  for (int i=0; i < NUM_REVS_THRESHOLD * 2; i++) {
    builder1=ns1.getRoot().builder();
    builder1.child("test").child("child-" + i);
    merge(ns1,builder1);
  }
  ns1.runBackgroundOperations();
  try {
    merge(ns2,builder2);
    fail("merge must fail with CommitFailedException");
  }
 catch (  CommitFailedException e) {
  }
  ns2.dispose();
}

</code></pre>

<pre class="type-11 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void splitPreviousDocument(){
  NodeDocument doc=new NodeDocument(mk.getDocumentStore());
  doc.put(NodeDocument.ID,Utils.getIdFromPath("/test"));
  doc.put(NodeDocument.SD_TYPE,NodeDocument.SplitDocType.DEFAULT.type);
  RevisionVector head=mk.getNodeStore().getHeadRevision();
  SplitOperations.forDocument(doc,DummyRevisionContext.INSTANCE,head,NUM_REVS_THRESHOLD);
}

</code></pre>

<pre class="type-9 type-12 type-7 type-6 type-4 type-8 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void splitDeleted() throws Exception {
  DocumentStore store=mk.getDocumentStore();
  DocumentNodeStore ns=mk.getNodeStore();
  Set<Revision> revisions=Sets.newHashSet();
  mk.commit("/","+\"foo\":{}",null,null);
  NodeDocument doc=store.find(NODES,Utils.getIdFromPath("/foo"));
  assertNotNull(doc);
  revisions.addAll(doc.getLocalRevisions().keySet());
  boolean create=false;
  while (revisions.size() <= NodeDocument.NUM_REVS_THRESHOLD) {
    if (create) {
      revisions.add(Revision.fromString(mk.commit("/","+\"foo\":{}",null,null)));
    }
 else {
      revisions.add(Revision.fromString(mk.commit("/","-\"foo\"",null,null)));
    }
    create=!create;
  }
  mk.runBackgroundOperations();
  String head=mk.getHeadRevision();
  doc=store.find(NODES,Utils.getIdFromPath("/foo"));
  assertNotNull(doc);
  Map<Revision,String> deleted=doc.getLocalDeleted();
  assertEquals(1,deleted.size());
  for (  Revision rev : revisions) {
    assertTrue("document should contain revision (or have revision in commit root path):" + rev,doc.containsRevision(rev) || doc.getCommitRootPath(rev) != null);
    assertTrue(doc.isCommitted(rev));
  }
  DocumentNodeState node=ns.getNode("/foo",RevisionVector.fromString(head));
  if (create) {
    assertNull(node);
  }
 else {
    assertNotNull(node);
  }
}

</code></pre>

<pre class="type-9 type-7 type-6 type-4 type-8 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void keepCommitRootForMostRecentChanges() throws Exception {
  DocumentStore store=mk.getDocumentStore();
  NodeStore ns=mk.getNodeStore();
  NodeBuilder builder=ns.getRoot().builder();
  builder.setProperty("p",-1);
  NodeBuilder test=builder.child("test");
  test.setProperty("foo",-1);
  test.setProperty("bar",-1);
  ns.merge(builder,EmptyHook.INSTANCE,CommitInfo.EMPTY);
  for (int i=0; i < NUM_REVS_THRESHOLD; i++) {
    builder=ns.getRoot().builder();
    builder.setProperty("p",i);
    test=builder.child("test");
    test.setProperty("foo",i);
    ns.merge(builder,EmptyHook.INSTANCE,CommitInfo.EMPTY);
  }
  mk.runBackgroundOperations();
  NodeDocument doc=store.find(NODES,Utils.getIdFromPath("/test"));
  assertNotNull(doc);
  Map<Revision,String> valueMap=doc.getValueMap("bar");
  assertFalse(valueMap.isEmpty());
  Revision r=valueMap.keySet().iterator().next();
  assertTrue(doc.getLocalCommitRoot().containsKey(r));
  List<NodeDocument> prevDocs=Lists.newArrayList(doc.getAllPreviousDocs());
  assertEquals(1,prevDocs.size());
  NodeDocument prev=prevDocs.get(0);
  assertTrue(prev.getLocalCommitRoot().containsKey(r));
}

</code></pre>

<pre class="type-9 type-6 type-4 type-8 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void splitRevisionsManyClusterNodes(){
  int numClusterNodes=5;
  String id=Utils.getIdFromPath("/test");
  mk.commit("/","+\"test\":{}",null,null);
  DocumentStore store=mk.getDocumentStore();
  int clusterId=mk.getNodeStore().getClusterId();
  List<Revision> revs=Lists.newArrayList();
  UpdateOp op=new UpdateOp(id,false);
  for (int i=0; i < numClusterNodes; i++) {
    for (int j=0; j < NUM_REVS_THRESHOLD; j++) {
      Revision r=Revision.newRevision(i + 1);
      if (clusterId == r.getClusterId()) {
        revs.add(r);
      }
      op.setMapEntry("prop",r,"value");
      NodeDocument.setRevision(op,r,"c");
    }
  }
  store.findAndUpdate(NODES,op);
  NodeDocument doc=store.find(NODES,id);
  assertNotNull(doc);
  List<UpdateOp> splitOps=Lists.newArrayList(doc.split(mk.getNodeStore(),mk.getNodeStore().getHeadRevision()));
  assertEquals(2,splitOps.size());
  String prevId=Utils.getPreviousIdFor("/test",revs.get(revs.size() - 2),0);
  assertEquals(prevId,splitOps.get(0).getId());
  assertEquals(id,splitOps.get(1).getId());
}

</code></pre>

<pre class="type-9 type-7 type-6 type-4 type-8 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void keepRevisionsForMostRecentChanges() throws Exception {
  DocumentStore store=mk.getDocumentStore();
  NodeStore ns=mk.getNodeStore();
  NodeBuilder builder=ns.getRoot().builder();
  builder.setProperty("foo",-1);
  builder.setProperty("bar",-1);
  ns.merge(builder,EmptyHook.INSTANCE,CommitInfo.EMPTY);
  for (int i=0; i < NUM_REVS_THRESHOLD; i++) {
    builder=ns.getRoot().builder();
    builder.setProperty("foo",i);
    ns.merge(builder,EmptyHook.INSTANCE,CommitInfo.EMPTY);
  }
  mk.runBackgroundOperations();
  NodeDocument doc=store.find(NODES,Utils.getIdFromPath("/"));
  assertNotNull(doc);
  Map<Revision,String> valueMap=doc.getValueMap("bar");
  assertFalse(valueMap.isEmpty());
  Revision r=valueMap.keySet().iterator().next();
  assertTrue(doc.getLocalRevisions().containsKey(r));
  List<NodeDocument> prevDocs=Lists.newArrayList(doc.getAllPreviousDocs());
  assertEquals(1,prevDocs.size());
  NodeDocument prev=prevDocs.get(0);
  assertTrue(prev.getLocalRevisions().containsKey(r));
}

</code></pre>

<pre class="type-13 type-9 type-6 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void manyRevisions(){
  final int numMKs=3;
  MemoryDocumentStore ds=new MemoryDocumentStore();
  MemoryBlobStore bs=new MemoryBlobStore();
  List<Set<String>> changes=new ArrayList<Set<String>>();
  List<DocumentMK> mks=new ArrayList<DocumentMK>();
  for (int i=1; i <= numMKs; i++) {
    DocumentMK.Builder builder=new DocumentMK.Builder();
    builder.setDocumentStore(ds).setBlobStore(bs).setAsyncDelay(0);
    DocumentMK mk=builder.setClusterId(i).open();
    mks.add(mk);
    changes.add(new HashSet<String>());
    if (i == 1) {
      mk.commit("/","+\"test\":{}",null,null);
      mk.runBackgroundOperations();
    }
  }
  List<String> propNames=Arrays.asList("prop1","prop2","prop3");
  Random random=new Random(0);
  for (int i=0; i < 1000; i++) {
    int mkIdx=random.nextInt(mks.size());
    DocumentMK mk=mks.get(mkIdx);
    DocumentNodeStore ns=mk.getNodeStore();
    String name=propNames.get(random.nextInt(propNames.size()));
    for (int j=0; j < changes.size(); j++) {
      Set<String> c=changes.get(j);
      if (c.contains(name)) {
        syncMKs(mks,j);
        c.clear();
        break;
      }
    }
    NodeDocument doc=ds.find(NODES,Utils.getIdFromPath("/test"));
    assertNotNull(doc);
    RevisionVector head=ns.getHeadRevision();
    Revision lastRev=ns.getPendingModifications().get("/test");
    DocumentNodeState n=doc.getNodeAtRevision(mk.getNodeStore(),head,lastRev);
    assertNotNull(n);
    String value=n.getPropertyAsString(name);
    if (value == null) {
      value=String.valueOf(0);
    }
 else {
      value=String.valueOf(Integer.parseInt(value) + 1);
    }
    mk.commit("/test","^\"" + name + "\":"+ value,null,null);
    changes.get(mkIdx).add(name);
  }
  for (  DocumentMK mk : mks) {
    mk.dispose();
  }
}

</code></pre>

<pre class="type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSplitPropAndCommitOnly() throws Exception {
  DocumentStore store=mk.getDocumentStore();
  DocumentNodeStore ns=mk.getNodeStore();
  NodeBuilder b1=ns.getRoot().builder();
  b1.child("test").child("foo").child("bar");
  ns.merge(b1,EmptyHook.INSTANCE,CommitInfo.EMPTY);
  for (int i=0; i < NodeDocument.NUM_REVS_THRESHOLD; i++) {
    b1=ns.getRoot().builder();
    b1.child("test").child("foo").setProperty("prop",i);
    b1.child("test").setProperty("prop",i);
    ns.merge(b1,EmptyHook.INSTANCE,CommitInfo.EMPTY);
  }
  ns.runBackgroundOperations();
  NodeDocument doc=store.find(NODES,Utils.getIdFromPath("/test/foo"));
  List<NodeDocument> prevDocs=ImmutableList.copyOf(doc.getAllPreviousDocs());
  assertEquals(1,prevDocs.size());
  assertEquals(SplitDocType.COMMIT_ROOT_ONLY,prevDocs.get(0).getSplitDocType());
}

</code></pre>

<pre class="type-7 type-6 type-4 type-8 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void splitRevisions() throws Exception {
  DocumentStore store=mk.getDocumentStore();
  DocumentNodeStore ns=mk.getNodeStore();
  Set<Revision> revisions=Sets.newHashSet();
  NodeDocument doc=store.find(NODES,Utils.getIdFromPath("/"));
  assertNotNull(doc);
  revisions.addAll(doc.getLocalRevisions().keySet());
  revisions.add(Revision.fromString(mk.commit("/","+\"foo\":{}+\"bar\":{}",null,null)));
  while (revisions.size() <= NodeDocument.NUM_REVS_THRESHOLD) {
    revisions.add(Revision.fromString(mk.commit("/","+\"foo/node-" + revisions.size() + "\":{}"+ "+\"bar/node-"+ revisions.size()+ "\":{}",null,null)));
  }
  mk.runBackgroundOperations();
  String head=mk.getHeadRevision();
  doc=store.find(NODES,Utils.getIdFromPath("/"));
  assertNotNull(doc);
  Map<Revision,String> revs=doc.getLocalRevisions();
  assertEquals(1,revs.size());
  for (  Revision rev : revisions) {
    assertTrue(doc.containsRevision(rev));
    assertTrue(doc.isCommitted(rev));
  }
  assertNotNull(ns.getNode("/",RevisionVector.fromString(head)));
  NodeDocument prevDoc=Iterators.getOnlyElement(doc.getAllPreviousDocs());
  assertEquals(SplitDocType.DEFAULT,prevDoc.getSplitDocType());
  mk.commit("/","+\"baz\":{}",null,null);
  ns.setAsyncDelay(0);
  mk.backgroundWrite();
}

</code></pre>

<pre class="type-9 type-6 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void commitRootInPrevious(){
  DocumentStore store=mk.getDocumentStore();
  DocumentNodeStore ns=mk.getNodeStore();
  mk.commit("/","+\"test\":{\"node\":{}}",null,null);
  mk.commit("/test","+\"foo\":{}+\"bar\":{}",null,null);
  mk.commit("/test","^\"foo/prop\":0^\"bar/prop\":0",null,null);
  NodeDocument doc=store.find(NODES,Utils.getIdFromPath("/test/foo"));
  assertNotNull(doc);
  String rev=null;
  for (int i=0; i < NodeDocument.NUM_REVS_THRESHOLD; i++) {
    rev=mk.commit("/test/foo","^\"prop\":" + i,null,null);
  }
  ns.runBackgroundOperations();
  doc=store.find(NODES,Utils.getIdFromPath("/test/foo"));
  assertNotNull(doc);
  DocumentNodeState node=doc.getNodeAtRevision(ns,RevisionVector.fromString(rev),null);
  assertNotNull(node);
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
