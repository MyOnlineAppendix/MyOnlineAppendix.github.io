<h3 style="margin:0px">Class: org.apache.jackrabbit.oak.plugins.index.lucene.LucenePropertyIndexTest (69 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(35)</kbd></button>&nbsp;<button id="15"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('15')" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements"><kbd id="tag-15"class="label-info"style="display: inline-block;font-size:7pt" >ConditionMatcher&nbsp;(28)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void lucenPropertyBooleanComplexOrQueries() throws Exception {
  fulltextBooleanComplexOrQueries(true);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void fulltextSearchWithCustomAnalyzer() throws Exception {
  Tree idx=createFulltextIndex(root.getTree("/"),"test");
  TestUtil.useV2(idx);
  Tree anl=idx.addChild(LuceneIndexConstants.ANALYZERS).addChild(LuceneIndexConstants.ANL_DEFAULT);
  anl.addChild(LuceneIndexConstants.ANL_TOKENIZER).setProperty(LuceneIndexConstants.ANL_NAME,"whitespace");
  anl.addChild(LuceneIndexConstants.ANL_FILTERS).addChild("stop");
  Tree test=root.getTree("/").addChild("test");
  test.setProperty("foo","fox jumping");
  root.commit();
  assertQuery("select * from [nt:base] where CONTAINS(*, 'fox was jumping')",asList("/test"));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void relativePropertyAndCursor() throws Exception {
  Tree idx=createIndex("test1",of("propa","propb"));
  TestUtil.useV2(idx);
  idx.setProperty(LuceneIndexConstants.FULL_TEXT_ENABLED,true);
  Tree propNode=idx.addChild(PROP_NODE);
  Tree propA=propNode.addChild("propa");
  propA.setProperty(LuceneIndexConstants.PROP_TYPE,PropertyType.TYPENAME_STRING);
  propA.setProperty(LuceneIndexConstants.FIELD_BOOST,2.0);
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  root.commit();
  for (int i=0; i < LucenePropertyIndex.LUCENE_QUERY_BATCH_SIZE; i++) {
    test.addChild("a" + i).addChild("doNotInclude").setProperty("propa","foo");
  }
  test.addChild("b").addChild("jcr:content").setProperty("propb","foo");
  root.commit();
  String queryString="/jcr:root//element(*, nt:base)[jcr:contains(jcr:content, 'foo' )]";
  assertQuery(queryString,"xpath",asList("/test/b"));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void sortQueriesWithLong() throws Exception {
  Tree idx=createIndex("test1",of("foo","bar"));
  Tree propIdx=idx.addChild(PROP_NODE).addChild("foo");
  propIdx.setProperty(LuceneIndexConstants.PROP_TYPE,PropertyType.TYPENAME_LONG);
  root.commit();
  assertSortedLong();
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void sortQueriesWithStringIgnoredMulti_OrderedProps() throws Exception {
  Tree idx=createIndex("test1",of("foo","bar"));
  idx.setProperty(createProperty(INCLUDE_PROPERTY_NAMES,of("bar"),STRINGS));
  idx.setProperty(createProperty(ORDERED_PROP_NAMES,of("foo"),STRINGS));
  idx.addChild(PROP_NODE).addChild("foo");
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  List<String> values=createStrings(NUMBER_OF_NODES);
  List<Tuple> tuples=Lists.newArrayListWithCapacity(values.size());
  for (int i=0; i < values.size(); i++) {
    Tree child=test.addChild("n" + i);
    child.setProperty("foo",values.get(i));
    child.setProperty("bar","baz");
    tuples.add(new Tuple(values.get(i),child.getPath()));
  }
  Tree child=test.addChild("a");
  child.setProperty("foo",of("w","z"),Type.STRINGS);
  child.setProperty("bar","baz");
  root.commit();
  assertOrderedQuery("select [jcr:path] from [nt:base] where [bar] = 'baz' order by [foo]",Lists.newArrayList(Iterables.concat(Lists.newArrayList("/test/a"),getSortedPaths(tuples,OrderDirection.ASC))));
  assertOrderedQuery("select [jcr:path] from [nt:base] where [bar] = 'baz' order by [foo] DESC",Lists.newArrayList(Iterables.concat(getSortedPaths(tuples,OrderDirection.DESC),Lists.newArrayList("/test/a"))));
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void rangeQueriesWithLong() throws Exception {
  Tree idx=createIndex("test1",of("propa","propb"));
  Tree propIdx=idx.addChild(PROP_NODE).addChild("propa");
  propIdx.setProperty(LuceneIndexConstants.PROP_TYPE,PropertyType.TYPENAME_LONG);
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  test.addChild("a").setProperty("propa",10);
  test.addChild("b").setProperty("propa",20);
  test.addChild("c").setProperty("propa",30);
  test.addChild("c").setProperty("propb","foo");
  test.addChild("d").setProperty("propb","foo");
  root.commit();
  assertThat(explain("select [jcr:path] from [nt:base] where [propa] >= 20"),containsString("lucene:test1"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] >= 20",asList("/test/b","/test/c"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] >= 20",asList("/test/b","/test/c"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] = 20",asList("/test/b"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] <= 20",asList("/test/b","/test/a"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] < 20",asList("/test/a"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] = 20 or [propa] = 10 ",asList("/test/b","/test/a"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] > 10 and [propa] < 30",asList("/test/b"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] in (10,20)",asList("/test/b","/test/a"));
  assertQuery("select [jcr:path] from [nt:base] where propa is not null",asList("/test/a","/test/b","/test/c"));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void sortQueriesWithString_OrderedProps() throws Exception {
  Tree idx=createIndex("test1",of("foo","bar"));
  idx.setProperty(createProperty(INCLUDE_PROPERTY_NAMES,of("bar"),STRINGS));
  idx.setProperty(createProperty(ORDERED_PROP_NAMES,of("foo"),STRINGS));
  idx.addChild(PROP_NODE).addChild("foo");
  root.commit();
  assertSortedString();
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void determinePropTypeFromRestriction() throws Exception {
  Tree idx=createIndex("test1",of("propa","propb"));
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  test.addChild("a").setProperty("propa",10);
  test.addChild("b").setProperty("propa",20);
  test.addChild("c").setProperty("propa",30);
  test.addChild("c").setProperty("propb","foo");
  test.addChild("d").setProperty("propb","foo");
  root.commit();
  assertThat(explain("select [jcr:path] from [nt:base] where [propa] >= 20"),containsString("lucene:test1"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] >= 20",asList("/test/b","/test/c"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] >= 20",asList("/test/b","/test/c"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] = 20",asList("/test/b"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] <= 20",asList("/test/b","/test/a"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] < 20",asList("/test/a"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] = 20 or [propa] = 10 ",asList("/test/b","/test/a"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] > 10 and [propa] < 30",asList("/test/b"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] in (10,20)",asList("/test/b","/test/a"));
  assertQuery("select [jcr:path] from [nt:base] where propa is not null",asList("/test/a","/test/b","/test/c"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void shutdownExecutor(){
  executorService.shutdown();
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void sortQueriesWithStringAndLong() throws Exception {
  Tree idx=createIndex("test1",of("foo","bar","baz"));
  Tree propIdx=idx.addChild(PROP_NODE).addChild("baz");
  propIdx.setProperty(LuceneIndexConstants.PROP_TYPE,PropertyType.TYPENAME_LONG);
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  int firstPropSize=5;
  List<String> values=createStrings(firstPropSize);
  List<Long> longValues=createLongs(NUMBER_OF_NODES);
  List<Tuple2> tuples=Lists.newArrayListWithCapacity(values.size());
  Random r=new Random();
  for (int i=0; i < values.size(); i++) {
    String val=values.get(r.nextInt(firstPropSize));
    Tree child=test.addChild("n" + i);
    child.setProperty("foo",val);
    child.setProperty("baz",longValues.get(i));
    child.setProperty("bar","baz");
    tuples.add(new Tuple2(val,longValues.get(i),child.getPath()));
  }
  root.commit();
  assertOrderedQuery("select [jcr:path] from [nt:base] where [bar] = 'baz' order by [foo] asc, [baz] desc",getSortedPaths(tuples));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void unionSortQueries() throws Exception {
  Tree idx=createIndex("test1",of("propa","propb","propc","propd"));
  idx.setProperty(createProperty(ORDERED_PROP_NAMES,of("propd"),STRINGS));
  useV2(idx);
  Tree test=root.getTree("/").addChild("test");
  root.commit();
  int seed=-3;
  for (int i=0; i < 5; i++) {
    Tree a=test.addChild("a" + i);
    a.setProperty("propa","a" + i);
    seed+=3;
    a.setProperty("propd",seed);
  }
  seed=-2;
  for (int i=0; i < 5; i++) {
    Tree a=test.addChild("b" + i);
    a.setProperty("propb","b" + i);
    seed+=3;
    a.setProperty("propd",seed);
  }
  seed=-1;
  for (int i=0; i < 5; i++) {
    Tree a=test.addChild("c" + i);
    a.setProperty("propc","c" + i);
    seed+=3;
    a.setProperty("propd",seed);
  }
  root.commit();
  assertQuery("/jcr:root//element(*, nt:base)[(@propa = 'a4' or @propb = 'b3')] order by @propd",XPATH,asList("/test/b3","/test/a4"));
  assertQuery("/jcr:root//element(*, nt:base)[(@propa = 'a3' or @propb = 'b0' or @propc = 'c2')] order by @propd",XPATH,asList("/test/b0","/test/c2","/test/a3"));
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void redundantNotNullCheck() throws Exception {
  Tree idx=createIndex("test1",of("tags"));
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  test.addChild("a").setProperty("tags",of("a","b"),Type.STRINGS);
  test.addChild("b").setProperty("tags",of("a","c"),Type.STRINGS);
  root.commit();
  String q="SELECT * FROM [nt:unstructured] as content WHERE ISDESCENDANTNODE('/content/dam/en/us')\n" + "and(\n" + "    content.[tags] = 'Products:A'\n"+ "    or content.[tags] = 'Products:A/B'\n"+ "    or content.[tags] = 'Products:A/B'\n"+ "    or content.[tags] = 'Products:A'\n"+ ")\n"+ "and(\n"+ "    content.[tags] = 'DocTypes:A'\n"+ "    or content.[tags] = 'DocTypes:B'\n"+ "    or content.[tags] = 'DocTypes:C'\n"+ "    or content.[tags] = 'ProblemType:A'\n"+ ")\n"+ "and(\n"+ "    content.[hasRendition] IS NULL\n"+ "    or content.[hasRendition] = 'false'\n"+ ")";
  assertThat(explain(q),not(containsString("[content].[tags] is not null")));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void luceneBooleanComplexOrQueries() throws Exception {
  fulltextBooleanComplexOrQueries(false);
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void sortFulltextQueriesWithJcrScore() throws Exception {
  Tree idx=createIndex("test1",of("propa"));
  idx.setProperty(LuceneIndexConstants.FULL_TEXT_ENABLED,true);
  useV2(idx);
  Tree test=root.getTree("/").addChild("test");
  root.commit();
  test.addChild("a").setProperty("propa","foo");
  test.addChild("b").setProperty("propa","foo");
  test.addChild("c").setProperty("propa","foo");
  root.commit();
  String query="measure //*[jcr:contains(., 'foo' )] order by @jcr:score descending";
  assertThat(measureWithLimit(query,XPATH,1),containsString("scanCount: 1"));
  query="measure //*[jcr:contains(., 'foo' )] order by @jcr:score";
  assertThat(measureWithLimit(query,XPATH,1),containsString("scanCount: 3"));
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void pathInclude() throws Exception {
  Tree idx=createIndex("test1",of("propa","propb"));
  idx.setProperty(createProperty(PROP_INCLUDED_PATHS,of("/test/a"),Type.STRINGS));
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  test.addChild("a").setProperty("propa",10);
  test.addChild("a").addChild("b").setProperty("propa",10);
  test.addChild("c").setProperty("propa",10);
  root.commit();
  assertThat(explain("select [jcr:path] from [nt:base] where [propa] = 10"),containsString("lucene:test1"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] = 10",asList("/test/a","/test/a/b"));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void nativeQueries() throws Exception {
  Tree idx=createIndex("test1",of("propa","propb"));
  idx.addChild(PROP_NODE).addChild("propa");
  idx.setProperty(LuceneIndexConstants.FUNC_NAME,"foo");
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  test.addChild("a").setProperty("propa","humpty");
  test.addChild("b").setProperty("propa","dumpty");
  test.addChild("c").setProperty("propa","humpy");
  root.commit();
  assertQuery("select [jcr:path] from [nt:base] where native('foo', 'propa:(humpty OR dumpty)')",asList("/test/a","/test/b"));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void orderByScore() throws Exception {
  Tree idx=createIndex("test1",of("propa"));
  idx.addChild(PROP_NODE).addChild("propa");
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  test.addChild("a").setProperty("propa","a");
  root.commit();
  assertQuery("select [jcr:path] from [nt:base] where propa is not null order by [jcr:score]",asList("/test/a"));
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void indexSelectionVsNodeType() throws Exception {
  Tree luceneIndex=createIndex("test1",of("propa"));
  luceneIndex.setProperty(IndexConstants.ENTRY_COUNT_PROPERTY_NAME,5L,Type.LONG);
  Tree nodeTypeIndex=root.getTree("/").getChild("oak:index").getChild("nodetype");
  nodeTypeIndex.setProperty(IndexConstants.ENTRY_COUNT_PROPERTY_NAME,50L,Type.LONG);
  nodeTypeIndex.setProperty(IndexConstants.KEY_COUNT_PROPERTY_NAME,10L,Type.LONG);
  Tree test=root.getTree("/").addChild("test");
  test.setProperty("jcr:primaryType","nt:unstructured",Type.NAME);
  List<String> paths=Lists.newArrayList();
  for (int idx=0; idx < 15; idx++) {
    Tree a=test.addChild("n" + idx);
    a.setProperty("jcr:primaryType","nt:unstructured",Type.NAME);
    a.setProperty("propa","foo");
    paths.add("/test/n" + idx);
  }
  root.commit();
  String propaQuery="select [jcr:path] from [nt:unstructured] where [propa] = 'foo'";
  assertThat(explain(propaQuery),containsString("lucene:test1"));
  assertQuery(propaQuery,paths);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void sortQueriesWithDateStringMixed_OrderedProps() throws Exception {
  Tree idx=createIndex("test1",of("foo","bar"));
  idx.setProperty(createProperty(INCLUDE_PROPERTY_NAMES,of("bar"),STRINGS));
  idx.setProperty(createProperty(ORDERED_PROP_NAMES,of("foo"),STRINGS));
  Tree propIdx=idx.addChild(PROP_NODE).addChild("foo");
  propIdx.setProperty(LuceneIndexConstants.PROP_TYPE,PropertyType.TYPENAME_DATE);
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  List<Calendar> values=createDates(NUMBER_OF_NODES);
  List<Tuple> tuples=Lists.newArrayListWithCapacity(values.size());
  for (int i=0; i < values.size(); i++) {
    Tree child=test.addChild("n" + i);
    child.setProperty("bar","baz");
    if (i != 0) {
      child.setProperty("foo",values.get(i));
      tuples.add(new Tuple(values.get(i),child.getPath()));
    }
 else {
      child.setProperty("foo",String.valueOf(values.get(i).getTimeInMillis()));
    }
  }
  root.commit();
  assertOrderedQuery("select [jcr:path] from [nt:base] where [bar] = 'baz' order by [foo]",Lists.newArrayList(Iterables.concat(Lists.newArrayList("/test/n0"),getSortedPaths(tuples,OrderDirection.ASC))));
  assertOrderedQuery("select [jcr:path] from [nt:base] where [bar] = 'baz' order by [foo] DESC",Lists.newArrayList(Iterables.concat(getSortedPaths(tuples,OrderDirection.DESC),Lists.newArrayList("/test/n0"))));
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void indexingBasedOnMixinWithInheritence() throws Exception {
  Tree idx=createIndex("test1",of("propa","propb"));
  Tree props=TestUtil.newRulePropTree(idx,"mix:mimeType");
  Tree prop=props.addChild(TestUtil.unique("prop"));
  prop.setProperty(LuceneIndexConstants.PROP_NAME,"jcr:mimeType");
  prop.setProperty(LuceneIndexConstants.PROP_PROPERTY_INDEX,true);
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  createNodeWithType(test,"a","nt:resource").setProperty("jcr:mimeType","a");
  createNodeWithType(test,"b","nt:resource").setProperty("jcr:mimeType","c");
  test.addChild("c").setProperty("jcr:mimeType","a");
  root.commit();
  String propabQuery="select [jcr:path] from [mix:mimeType] where [jcr:mimeType] = 'a'";
  assertThat(explain(propabQuery),containsString("lucene:test1(/oak:index/test1)"));
  assertQuery(propabQuery,asList("/test/a"));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void propertyExistenceQuery() throws Exception {
  Tree idx=createIndex("test1",of("propa","propb"));
  idx.addChild(PROP_NODE).addChild("propa");
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  test.addChild("a").setProperty("propa","a");
  test.addChild("b").setProperty("propa","c");
  test.addChild("c").setProperty("propb","e");
  root.commit();
  assertQuery("select [jcr:path] from [nt:base] where propa is not null",asList("/test/a","/test/b"));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void indexTimeFieldBoost() throws Exception {
  Tree idx=createIndex("test1",of("propa","propb","propc"));
  idx.setProperty(LuceneIndexConstants.FULL_TEXT_ENABLED,true);
  Tree propNode=idx.addChild(PROP_NODE);
  Tree propA=propNode.addChild("propa");
  propA.setProperty(LuceneIndexConstants.PROP_TYPE,PropertyType.TYPENAME_STRING);
  propA.setProperty(LuceneIndexConstants.FIELD_BOOST,2.0);
  Tree propB=propNode.addChild("propb");
  propB.setProperty(LuceneIndexConstants.PROP_TYPE,PropertyType.TYPENAME_STRING);
  propB.setProperty(LuceneIndexConstants.FIELD_BOOST,1.0);
  Tree propC=propNode.addChild("propc");
  propC.setProperty(LuceneIndexConstants.PROP_TYPE,PropertyType.TYPENAME_STRING);
  propC.setProperty(LuceneIndexConstants.FIELD_BOOST,4.0);
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  root.commit();
  test.addChild("a").setProperty("propa","foo");
  test.addChild("b").setProperty("propb","foo");
  test.addChild("c").setProperty("propc","foo");
  root.commit();
  String queryString="//* [jcr:contains(., 'foo' )]";
  assertOrderedQuery(queryString,asList("/test/c","/test/a","/test/b"),XPATH,true);
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void aggregationAndExcludeProperty() throws Exception {
  NodeTypeRegistry.register(root,IOUtils.toInputStream(TestUtil.TEST_NODE_TYPE),"test nodeType");
  Tree idx=createIndex("test1",of("propa","propb"));
  Tree props=TestUtil.newRulePropTree(idx,TestUtil.NT_TEST);
  Tree prop=props.addChild(TestUtil.unique("prop"));
  prop.setProperty(LuceneIndexConstants.PROP_NAME,"jcr:title");
  prop.setProperty(LuceneIndexConstants.PROP_PROPERTY_INDEX,true);
  Tree prop1=props.addChild(TestUtil.unique("prop"));
  prop1.setProperty(LuceneIndexConstants.PROP_NAME,"original/jcr:content/type");
  prop1.setProperty(LuceneIndexConstants.PROP_NODE_SCOPE_INDEX,false);
  prop1.setProperty(LuceneIndexConstants.PROP_PROPERTY_INDEX,true);
  newNodeAggregator(idx).newRuleWithName(NT_FILE,newArrayList(JCR_CONTENT,JCR_CONTENT + "/*")).newRuleWithName(TestUtil.NT_TEST,newArrayList("/*"));
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  Tree a=createNodeWithType(test,"a",TestUtil.NT_TEST);
  Tree af=createFileNode(a,"original","hello","text/plain");
  af.setProperty("type","jpg");
  af.setProperty("class","image");
  root.commit();
  assertQuery("select [jcr:path] from [oak:TestNode] where contains(*, 'hello')",asList("/test/a"));
  assertQuery("select [jcr:path] from [oak:TestNode] where contains(*, 'image')",asList("/test/a"));
  assertQuery("select [jcr:path] from [oak:TestNode] where contains(*, 'jpg')",Collections.<String>emptyList());
  assertThat(explain("select [jcr:path] from [oak:TestNode] where [original/jcr:content/type] = 'foo'"),containsString("original/jcr:content/type:foo"));
}

</code></pre>

<pre class="type-7 type-6 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void preExtractedTextProvider() throws Exception {
  Tree idx=createFulltextIndex(root.getTree("/"),"test");
  TestUtil.useV2(idx);
  root.commit();
  AccessStateProvidingBlob testBlob=new AccessStateProvidingBlob("fox is jumping","id1");
  MapBasedProvider textProvider=new MapBasedProvider();
  textProvider.write("id1","lion");
  editorProvider.getExtractedTextCache().setExtractedTextProvider(textProvider);
  Tree test=root.getTree("/").addChild("test");
  createFileNode(test,"text",testBlob,"text/plain");
  root.commit();
  assertTrue(testBlob.isStreamAccessed());
  assertQuery("select * from [nt:base] where CONTAINS(*, 'fox ')",asList("/test/text/jcr:content"));
  assertEquals(0,textProvider.accessCount);
  testBlob.resetState();
  root.getTree(idx.getPath()).setProperty(IndexConstants.REINDEX_PROPERTY_NAME,true);
  root.commit();
  assertFalse(testBlob.isStreamAccessed());
  assertQuery("select * from [nt:base] where CONTAINS(*, 'lion ')",asList("/test/text/jcr:content"));
  assertEquals(1,textProvider.accessCount);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testWithRelativeProperty() throws Exception {
  Tree parent=root.getTree("/");
  Tree idx=createIndex(parent,"test1",of("b/propa","propb"));
  root.commit();
  Tree test=parent.addChild("test2");
  test.addChild("a").addChild("b").setProperty("propa","a");
  root.commit();
  assertQuery("select [jcr:path] from [nt:base] as s where [b/propa] = 'a'",asList("/test2/a"));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void maxExtractLengthCheck() throws Exception {
  Tree idx=createFulltextIndex(root.getTree("/"),"test");
  TestUtil.useV2(idx);
  Tree test=root.getTree("/").addChild("test");
  createFileNode(test,"text","red brown fox was jumping","text/plain");
  root.commit();
  assertQuery("select * from [nt:base] where CONTAINS(*, 'jumping')",asList("/test/text/jcr:content"));
  assertQuery("select * from [nt:base] where CONTAINS(*, 'red')",asList("/test/text/jcr:content"));
  idx=root.getTree("/oak:index/test");
  idx.addChild(TIKA).setProperty(LuceneIndexConstants.TIKA_MAX_EXTRACT_LENGTH,15);
  idx.setProperty(IndexConstants.REINDEX_PROPERTY_NAME,true);
  root.commit();
  assertQuery("select * from [nt:base] where CONTAINS(*, 'jumping')",Collections.<String>emptyList());
  assertQuery("select * from [nt:base] where CONTAINS(*, 'red')",asList("/test/text/jcr:content"));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void luceneAndExclude() throws Exception {
  Tree indexDefn=createTestIndexNode(root.getTree("/"),LuceneIndexConstants.TYPE_LUCENE);
  Tree r=root.getTree("/").addChild("test");
  Tree n=r.addChild("node1");
  n.setProperty("title","test text");
  n.setProperty("mytext","the quick brown fox jumps over the lazy dog.");
  n=r.addChild("node2");
  n.setProperty("title","other text");
  n.setProperty("mytext","the quick brown fox jumps over the lazy dog.");
  root.commit();
  String sql="SELECT * FROM [nt:base] WHERE [jcr:path] LIKE \'" + r.getPath() + "/%\'"+ " AND CONTAINS(*, \'text \'\'fox jumps\'\' -other\')";
  assertQuery(sql,asList("/test/node1"));
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void nodeNameViaPropDefinition() throws Exception {
  Tree idx=createIndex("test1",Collections.EMPTY_SET);
  useV2(idx);
  Tree rules=idx.addChild(LuceneIndexConstants.INDEX_RULES);
  rules.setOrderableChildren(true);
  Tree rule=rules.addChild("nt:base");
  Tree propDef=rule.addChild(PROP_NODE).addChild("nodeName");
  propDef.setProperty(PROP_NAME,PROPDEF_PROP_NODE_NAME);
  propDef.setProperty(PROP_PROPERTY_INDEX,true);
  root.commit();
  Tree test=root.getTree("/");
  test.addChild("foo");
  test.addChild("camelCase");
  test.addChild("test").addChild("bar");
  root.commit();
  String propabQuery="select [jcr:path] from [nt:base] where LOCALNAME() = 'foo'";
  assertThat(explain(propabQuery),containsString("lucene:test1(/oak:index/test1) :nodeName:foo"));
  assertQuery(propabQuery,asList("/foo"));
  assertQuery("select [jcr:path] from [nt:base] where LOCALNAME() = 'bar'",asList("/test/bar"));
  assertQuery("select [jcr:path] from [nt:base] where LOCALNAME() LIKE 'foo'",asList("/foo"));
  assertQuery("select [jcr:path] from [nt:base] where LOCALNAME() LIKE 'camel%'",asList("/camelCase"));
  assertQuery("select [jcr:path] from [nt:base] where NAME() = 'bar'",asList("/test/bar"));
  assertQuery("select [jcr:path] from [nt:base] where NAME() LIKE 'foo'",asList("/foo"));
  assertQuery("select [jcr:path] from [nt:base] where NAME() LIKE 'camel%'",asList("/camelCase"));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void binaryNotIndexedWhenNotSupportedMimeType() throws Exception {
  Tree idx=createFulltextIndex(root.getTree("/"),"test");
  TestUtil.useV2(idx);
  Tree test=root.getTree("/").addChild("test");
  String path=createFileNode(test,"text","red brown fox was jumping","text/plain").getPath();
  root.commit();
  assertQuery("select * from [nt:base] where CONTAINS(*, 'jumping')",asList("/test/text/jcr:content"));
  root.getTree(path).setProperty(JcrConstants.JCR_MIMETYPE,"foo/bar");
  root.commit();
  assertQuery("select * from [nt:base] where CONTAINS(*, 'jumping')",Collections.<String>emptyList());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void rangeQueriesWithDouble() throws Exception {
  Tree idx=createIndex("test1",of("propa","propb"));
  Tree propIdx=idx.addChild(PROP_NODE).addChild("propa");
  propIdx.setProperty(LuceneIndexConstants.PROP_TYPE,PropertyType.TYPENAME_DOUBLE);
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  test.addChild("a").setProperty("propa",10.1);
  test.addChild("b").setProperty("propa",20.4);
  test.addChild("c").setProperty("propa",30.7);
  test.addChild("c").setProperty("propb","foo");
  test.addChild("d").setProperty("propb","foo");
  root.commit();
  assertQuery("select [jcr:path] from [nt:base] where [propa] >= 20.3",asList("/test/b","/test/c"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] = 20.4",asList("/test/b"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] <= 20.5",asList("/test/b","/test/a"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] < 20.4",asList("/test/a"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] > 10.5 and [propa] < 30",asList("/test/b"));
  assertQuery("select [jcr:path] from [nt:base] where propa is not null",asList("/test/a","/test/b","/test/c"));
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void sortQueriesWithLong_NotIndexed_relativeProps() throws Exception {
  Tree idx=createIndex("test1",Collections.<String>emptySet());
  idx.setProperty(createProperty(ORDERED_PROP_NAMES,of("foo/bar"),STRINGS));
  Tree propIdx=idx.addChild(PROP_NODE).addChild("foo").addChild("bar");
  propIdx.setProperty(LuceneIndexConstants.PROP_TYPE,PropertyType.TYPENAME_LONG);
  root.commit();
  assertThat(explain("select [jcr:path] from [nt:base] order by [foo/bar]"),containsString("lucene:test1"));
  Tree test=root.getTree("/").addChild("test");
  List<Long> values=createLongs(NUMBER_OF_NODES);
  List<Tuple> tuples=Lists.newArrayListWithCapacity(values.size());
  for (int i=0; i < values.size(); i++) {
    Tree child=test.addChild("n" + i);
    child.addChild("foo").setProperty("bar",values.get(i));
    tuples.add(new Tuple(values.get(i),child.getPath()));
  }
  root.commit();
  assertOrderedQuery("select [jcr:path] from [nt:base] order by [foo/bar]",getSortedPaths(tuples,OrderDirection.ASC));
  assertOrderedQuery("select [jcr:path] from [nt:base]  order by [foo/bar] DESC",getSortedPaths(tuples,OrderDirection.DESC));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void indexDefinitionBelowRoot2() throws Exception {
  Tree parent=root.getTree("/").addChild("test");
  Tree idx=createIndex(parent,"test1",of("propa","propb"));
  idx.setProperty(LuceneIndexConstants.EVALUATE_PATH_RESTRICTION,true);
  idx.addChild(PROP_NODE).addChild("propa");
  root.commit();
  Tree test=parent.addChild("test2").addChild("test3");
  test.addChild("a").setProperty("propa","a");
  root.commit();
  assertQuery("select [jcr:path] from [nt:base] as s where ISDESCENDANTNODE(s, '/test/test2') and propa = 'a'",asList("/test/test2/test3/a"));
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void indexSelectionFulltextVsNodeType() throws Exception {
  Tree nodeTypeIdx=root.getTree("/oak:index/nodetype");
  nodeTypeIdx.setProperty(PropertyStates.createProperty(DECLARING_NODE_TYPES,of("nt:file"),NAMES));
  nodeTypeIdx.setProperty(IndexConstants.REINDEX_PROPERTY_NAME,true);
  nodeTypeIdx.setProperty(IndexConstants.ENTRY_COUNT_PROPERTY_NAME,Long.MAX_VALUE);
  Tree luceneIndex=createFullTextIndex(root.getTree("/"),"lucene");
  Tree test=root.getTree("/").addChild("test");
  setNodeType(test,"nt:file");
  setNodeType(test.addChild("a"),"nt:file");
  setNodeType(test.addChild("b"),"nt:file");
  setNodeType(test.addChild("c"),"nt:base");
  root.commit();
  String propabQuery="/jcr:root//element(*, nt:file)";
  System.out.println(explainXpath(propabQuery));
  assertThat(explainXpath(propabQuery),containsString("nodeType"));
}

</code></pre>

<pre class="type-9 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void multiValueAnd() throws Exception {
  Tree idx=createIndex("test1",of("tags"));
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  test.addChild("a").setProperty("tags",of("a","b"),Type.STRINGS);
  test.addChild("b").setProperty("tags",of("a","c"),Type.STRINGS);
  root.commit();
  String q="SELECT * FROM [nt:unstructured] as content WHERE ISDESCENDANTNODE('/content/dam/en/us')\n" + "and(\n" + "    content.[tags] = 'Products:A'\n"+ "    or content.[tags] = 'Products:A/B'\n"+ "    or content.[tags] = 'Products:A/B'\n"+ "    or content.[tags] = 'Products:A'\n"+ ")\n"+ "and(\n"+ "    content.[tags] = 'DocTypes:A'\n"+ "    or content.[tags] = 'DocTypes:B'\n"+ "    or content.[tags] = 'DocTypes:C'\n"+ "    or content.[tags] = 'ProblemType:A'\n"+ ")\n"+ "and(\n"+ "    content.[hasRendition] IS NULL\n"+ "    or content.[hasRendition] = 'false'\n"+ ")";
  String explain=explain(q);
  System.out.println(explain);
  String luceneQuery=explain.substring(0,explain.indexOf('\n'));
  assertEquals("[nt:unstructured] as [content] /* lucene:test1(/oak:index/test1) " + "+(tags:Products:A tags:Products:A/B) " + "+(tags:DocTypes:A tags:DocTypes:B tags:DocTypes:C tags:ProblemType:A)",luceneQuery);
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void sortQueriesWithLong_NotIndexed() throws Exception {
  Tree idx=createIndex("test1",Collections.<String>emptySet());
  idx.setProperty(createProperty(ORDERED_PROP_NAMES,of("foo"),STRINGS));
  Tree propIdx=idx.addChild(PROP_NODE).addChild("foo");
  propIdx.setProperty(LuceneIndexConstants.PROP_TYPE,PropertyType.TYPENAME_LONG);
  root.commit();
  assertThat(explain("select [jcr:path] from [nt:base] order by [foo]"),containsString("lucene:test1"));
  List<Tuple> tuples=createDataForLongProp();
  assertOrderedQuery("select [jcr:path] from [nt:base] order by [foo]",getSortedPaths(tuples,OrderDirection.ASC));
  assertOrderedQuery("select [jcr:path] from [nt:base]  order by [foo] DESC",getSortedPaths(tuples,OrderDirection.DESC));
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void indexingBasedOnMixinAndRelativeProps() throws Exception {
  Tree idx=createIndex("test1",of("propa","propb"));
  Tree props=TestUtil.newRulePropTree(idx,"mix:title");
  Tree prop1=props.addChild(TestUtil.unique("prop"));
  prop1.setProperty(LuceneIndexConstants.PROP_NAME,"jcr:title");
  prop1.setProperty(LuceneIndexConstants.PROP_PROPERTY_INDEX,true);
  Tree prop2=props.addChild(TestUtil.unique("prop"));
  prop2.setProperty(LuceneIndexConstants.PROP_NAME,"jcr:content/type");
  prop2.setProperty(LuceneIndexConstants.PROP_PROPERTY_INDEX,true);
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  Tree a=createNodeWithMixinType(test,"a","mix:title");
  a.setProperty("jcr:title","a");
  a.addChild("jcr:content").setProperty("type","foo-a");
  Tree c=createNodeWithMixinType(test,"c","mix:title");
  c.setProperty("jcr:title","c");
  c.addChild("jcr:content").setProperty("type","foo-c");
  test.addChild("c").setProperty("jcr:title","a");
  root.commit();
  String propabQuery="select [jcr:path] from [mix:title] where [jcr:content/type] = 'foo-a'";
  assertThat(explain(propabQuery),containsString("lucene:test1(/oak:index/test1)"));
  assertQuery(propabQuery,asList("/test/a"));
}

</code></pre>

<pre class="type-7 type-6 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void excludedBlobContentNotAccessed() throws Exception {
  Tree idx=createFulltextIndex(root.getTree("/"),"test");
  TestUtil.useV2(idx);
  AccessStateProvidingBlob testBlob=new AccessStateProvidingBlob("<?xml version=\"1.0\" encoding=\"UTF-8\"?><msg>sky is blue</msg>");
  Tree test=root.getTree("/").addChild("test");
  createFileNode(test,"zip",testBlob,"application/zip");
  root.commit();
  assertFalse(testBlob.isStreamAccessed());
  assertEquals(0,testBlob.readByteCount());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void sortQueriesWithDate() throws Exception {
  Tree idx=createIndex("test1",of("foo","bar"));
  Tree propIdx=idx.addChild(PROP_NODE).addChild("foo");
  propIdx.setProperty(LuceneIndexConstants.PROP_TYPE,PropertyType.TYPENAME_DATE);
  root.commit();
  assertSortedDate();
}

</code></pre>

<pre class="type-9 type-7 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void explainScoreTest() throws Exception {
  Tree idx=createIndex("test1",of("propa"));
  idx.addChild(PROP_NODE).addChild("propa");
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  test.addChild("a").setProperty("propa","a");
  root.commit();
  String query="select [oak:scoreExplanation] from [nt:base] where propa='a'";
  List<String> result=executeQuery(query,SQL2,false,false);
  assertEquals(1,result.size());
  assertTrue(result.get(0).contains("(MATCH)"));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void customTikaConfig() throws Exception {
  Tree idx=createFulltextIndex(root.getTree("/"),"test");
  TestUtil.useV2(idx);
  Tree test=root.getTree("/").addChild("test");
  createFileNode(test,"text","fox is jumping","text/plain");
  createFileNode(test,"xml","<?xml version=\"1.0\" encoding=\"UTF-8\"?><msg>sky is blue</msg>","application/xml");
  root.commit();
  assertQuery("select * from [nt:base] where CONTAINS(*, 'fox ')",asList("/test/text/jcr:content"));
  assertQuery("select * from [nt:base] where CONTAINS(*, 'sky ')",asList("/test/xml/jcr:content"));
  idx=root.getTree("/oak:index/test");
  String tikaConfig="<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n" + "<properties>\n" + "  <detectors>\n"+ "    <detector class=\"org.apache.tika.detect.DefaultDetector\"/>\n"+ "  </detectors>\n"+ "  <parsers>\n"+ "    <parser class=\"org.apache.tika.parser.DefaultParser\"/>\n"+ "    <parser class=\"org.apache.tika.parser.EmptyParser\">\n"+ "      <mime>application/xml</mime>\n"+ "    </parser>\n"+ "  </parsers>\n"+ "</properties>";
  idx.addChild(LuceneIndexConstants.TIKA).addChild(LuceneIndexConstants.TIKA_CONFIG).addChild(JCR_CONTENT).setProperty(JCR_DATA,tikaConfig.getBytes());
  idx.setProperty(IndexConstants.REINDEX_PROPERTY_NAME,true);
  root.commit();
  assertQuery("select * from [nt:base] where CONTAINS(*, 'fox ')",asList("/test/text/jcr:content"));
  assertQuery("select * from [nt:base] where CONTAINS(*, 'sky ')",Collections.<String>emptyList());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void maxFieldLengthCheck() throws Exception {
  Tree idx=createFulltextIndex(root.getTree("/"),"test");
  TestUtil.useV2(idx);
  Tree test=root.getTree("/").addChild("test");
  test.setProperty("text","red brown fox was jumping");
  root.commit();
  assertQuery("select * from [nt:base] where CONTAINS(*, 'jumping')",asList("/test"));
  idx=root.getTree("/oak:index/test");
  idx.setProperty(LuceneIndexConstants.MAX_FIELD_LENGTH,2);
  idx.setProperty(IndexConstants.REINDEX_PROPERTY_NAME,true);
  root.commit();
  assertQuery("select * from [nt:base] where CONTAINS(*, 'jumping')",Collections.<String>emptyList());
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void usedAsNodeTypeIndex() throws Exception {
  Tree nodeTypeIdx=root.getTree("/oak:index/nodetype");
  nodeTypeIdx.setProperty(PropertyStates.createProperty(DECLARING_NODE_TYPES,of("nt:resource"),NAMES));
  nodeTypeIdx.setProperty(IndexConstants.REINDEX_PROPERTY_NAME,true);
  Tree indexWithType=createIndex("test2",of(JcrConstants.JCR_PRIMARYTYPE,"propb"));
  indexWithType.setProperty(PropertyStates.createProperty(DECLARING_NODE_TYPES,of("nt:file"),NAMES));
  Tree test=root.getTree("/").addChild("test");
  setNodeType(test,"nt:file");
  root.commit();
  setNodeType(test.addChild("a"),"nt:file");
  setNodeType(test.addChild("b"),"nt:file");
  setNodeType(test.addChild("c"),"nt:base");
  root.commit();
  String propabQuery="select [jcr:path] from [nt:file]";
  assertThat(explain(propabQuery),containsString("lucene:test2"));
  assertQuery(propabQuery,asList("/test/a","/test/b","/test"));
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void usedAsNodeTypeIndex2() throws Exception {
  Tree nodeTypeIdx=root.getTree("/oak:index/nodetype");
  nodeTypeIdx.setProperty(PropertyStates.createProperty(DECLARING_NODE_TYPES,of("nt:resource"),NAMES));
  nodeTypeIdx.setProperty(IndexConstants.REINDEX_PROPERTY_NAME,true);
  Tree indexWithType=createIndex("test2",of("propb"));
  indexWithType.setProperty(PropertyStates.createProperty(DECLARING_NODE_TYPES,of("nt:file"),NAMES));
  indexWithType.setProperty(LuceneIndexConstants.FULL_TEXT_ENABLED,true);
  TestUtil.useV2(indexWithType);
  Tree test=root.getTree("/").addChild("test");
  setNodeType(test,"nt:file");
  root.commit();
  setNodeType(test.addChild("a"),"nt:file");
  setNodeType(test.addChild("b"),"nt:file");
  setNodeType(test.addChild("c"),"nt:base");
  root.commit();
  String propabQuery="select [jcr:path] from [nt:file]";
  assertThat(explain(propabQuery),containsString("lucene:test2"));
  assertQuery(propabQuery,asList("/test/a","/test/b","/test"));
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void emptyIndex() throws Exception {
  Tree idx=createIndex("test1",of("propa","propb"));
  idx.addChild(PROP_NODE).addChild("propa");
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  test.addChild("a");
  test.addChild("b");
  root.commit();
  assertThat(explain("select [jcr:path] from [nt:base] where [propa] = 'foo'"),containsString("lucene:test1"));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void likeQueriesWithString() throws Exception {
  Tree idx=createIndex("test1",of("propa","propb"));
  idx.addChild(PROP_NODE).addChild("propa");
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  test.addChild("a").setProperty("propa","humpty");
  test.addChild("b").setProperty("propa","dumpty");
  test.addChild("c").setProperty("propa","humpy");
  root.commit();
  assertQuery("select [jcr:path] from [nt:base] where propa like 'hum%'",asList("/test/a","/test/c"));
  assertQuery("select [jcr:path] from [nt:base] where propa like '%ty'",asList("/test/a","/test/b"));
  assertQuery("select [jcr:path] from [nt:base] where propa like '%ump%'",asList("/test/a","/test/b","/test/c"));
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void declaringNodeTypeSingleIndex() throws Exception {
  Tree indexWithType=createIndex("test2",of("propa","propb"));
  indexWithType.setProperty(PropertyStates.createProperty(DECLARING_NODE_TYPES,of("nt:unstructured"),Type.STRINGS));
  Tree test=root.getTree("/").addChild("test");
  test.setProperty("jcr:primaryType","nt:unstructured",Type.NAME);
  root.commit();
  Tree a=test.addChild("a");
  a.setProperty("jcr:primaryType","nt:unstructured",Type.NAME);
  a.setProperty("propa","foo");
  a.setProperty("propb","baz");
  Tree b=test.addChild("b");
  b.setProperty("jcr:primaryType","nt:unstructured",Type.NAME);
  b.setProperty("propa","foo");
  b.setProperty("propb","baz");
  root.commit();
  String propabQuery="select [jcr:path] from [nt:unstructured] where [propb] = 'baz' and " + "[propa] = 'foo'";
  assertThat(explain(propabQuery),containsString("lucene:test2"));
  assertQuery(propabQuery,asList("/test/a","/test/b"));
  String propNoIdxQuery="select [jcr:path] from [nt:base] where [propb] = 'baz'";
  assertThat(explain(propNoIdxQuery),containsString("no-index"));
  assertQuery(propNoIdxQuery,ImmutableList.<String>of());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void sortQueriesWithDouble() throws Exception {
  Tree idx=createIndex("test1",of("foo","bar"));
  Tree propIdx=idx.addChild(PROP_NODE).addChild("foo");
  propIdx.setProperty(LuceneIndexConstants.PROP_TYPE,PropertyType.TYPENAME_DOUBLE);
  root.commit();
  assertSortedDouble();
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void propertyNonExistenceQuery() throws Exception {
  NodeTypeRegistry.register(root,IOUtils.toInputStream(TestUtil.TEST_NODE_TYPE),"test nodeType");
  Tree idx=createIndex("test1",of("propa","propb"));
  Tree props=TestUtil.newRulePropTree(idx,TestUtil.NT_TEST);
  Tree prop=props.addChild(TestUtil.unique("prop"));
  prop.setProperty(LuceneIndexConstants.PROP_NAME,"propa");
  prop.setProperty(LuceneIndexConstants.PROP_PROPERTY_INDEX,true);
  prop.setProperty(LuceneIndexConstants.PROP_NULL_CHECK_ENABLED,true);
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  createNodeWithType(test,"a","oak:TestNode").setProperty("propa","a");
  createNodeWithType(test,"b","oak:TestNode").setProperty("propa","c");
  createNodeWithType(test,"c","oak:TestNode").setProperty("propb","e");
  root.commit();
  String propabQuery="select [jcr:path] from [oak:TestNode] where [propa] is null";
  assertThat(explain(propabQuery),containsString("lucene:test1(/oak:index/test1) :nullProps:propa"));
  assertQuery(propabQuery,asList("/test/c"));
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void declaringNodeTypeSameProp() throws Exception {
  createIndex("test1",of("propa"));
  Tree indexWithType=createIndex("test2",of("propa"));
  indexWithType.setProperty(PropertyStates.createProperty(DECLARING_NODE_TYPES,of("nt:unstructured"),Type.STRINGS));
  Tree test=root.getTree("/").addChild("test");
  test.setProperty("jcr:primaryType","nt:unstructured",Type.NAME);
  root.commit();
  Tree a=test.addChild("a");
  a.setProperty("jcr:primaryType","nt:unstructured",Type.NAME);
  a.setProperty("propa","foo");
  Tree b=test.addChild("b");
  b.setProperty("jcr:primaryType","nt:unstructured",Type.NAME);
  b.setProperty("propa","foo");
  test.addChild("c").setProperty("propa","foo");
  test.addChild("d").setProperty("propa","foo");
  root.commit();
  String propabQuery="select [jcr:path] from [nt:unstructured] where [propa] = 'foo'";
  assertThat(explain(propabQuery),containsString("lucene:test2"));
  assertQuery(propabQuery,asList("/test/a","/test/b"));
  String propcdQuery="select [jcr:path] from [nt:base] where [propa] = 'foo'";
  assertThat(explain(propcdQuery),containsString("lucene:test1"));
  assertQuery(propcdQuery,asList("/test/a","/test/b","/test/c","/test/d"));
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void pathExclude() throws Exception {
  Tree idx=createIndex("test1",of("propa","propb"));
  idx.setProperty(createProperty(PROP_EXCLUDED_PATHS,of("/test/a"),Type.STRINGS));
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  test.addChild("a").setProperty("propa",10);
  test.addChild("a").addChild("b").setProperty("propa",10);
  test.addChild("c").setProperty("propa",10);
  root.commit();
  assertThat(explain("select [jcr:path] from [nt:base] where [propa] = 10"),containsString("lucene:test1"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] = 10",asList("/test/c"));
  test=root.getTree("/").getChild("test");
  test.addChild("a").addChild("e").setProperty("propa",10);
  test.addChild("f").setProperty("propa",10);
  root.commit();
  assertQuery("select [jcr:path] from [nt:base] where [propa] = 10",asList("/test/c","/test/f"));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void fulltextQueryWithSpecialChars() throws Exception {
  Tree idx=createIndex("test1",of("propa","propb"));
  Tree props=TestUtil.newRulePropTree(idx,"nt:base");
  Tree prop1=props.addChild(TestUtil.unique("prop"));
  prop1.setProperty(LuceneIndexConstants.PROP_NAME,"tag");
  prop1.setProperty(LuceneIndexConstants.PROP_ANALYZED,true);
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  test.setProperty("tag","stockphotography:business/business_abstract");
  Tree test2=root.getTree("/").addChild("test2");
  test2.setProperty("tag","foo!");
  root.commit();
  String propabQuery="select * from [nt:base] where CONTAINS(tag, " + "'stockphotography:business/business_abstract')";
  assertPlanAndQuery(propabQuery,"lucene:test1(/oak:index/test1)",asList("/test"));
  String query2="select * from [nt:base] where CONTAINS(tag, 'foo!')";
  assertPlanAndQuery(query2,"lucene:test1(/oak:index/test1)",asList("/test2"));
}

</code></pre>

<pre class="type-9 type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void boostTitleOverDescription() throws Exception {
  NodeTypeRegistry.register(root,IOUtils.toInputStream(TestUtil.TEST_NODE_TYPE),"test nodeType");
  Tree idx=createIndex("test1",of("propa","propb"));
  Tree props=TestUtil.newRulePropTree(idx,TestUtil.NT_TEST);
  Tree title=props.addChild("title");
  title.setProperty(LuceneIndexConstants.PROP_NAME,"jcr:content/jcr:title");
  title.setProperty(LuceneIndexConstants.PROP_NODE_SCOPE_INDEX,true);
  title.setProperty(LuceneIndexConstants.FIELD_BOOST,4.0);
  Tree desc=props.addChild("desc");
  desc.setProperty(LuceneIndexConstants.PROP_NAME,"jcr:content/jcr:description");
  desc.setProperty(LuceneIndexConstants.PROP_NODE_SCOPE_INDEX,true);
  desc.setProperty(LuceneIndexConstants.FIELD_BOOST,2.0);
  Tree text=props.addChild("text");
  text.setProperty(LuceneIndexConstants.PROP_NAME,"jcr:content/text");
  text.setProperty(LuceneIndexConstants.PROP_NODE_SCOPE_INDEX,true);
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  Tree a=createNodeWithType(test,"a","oak:TestNode").addChild("jcr:content");
  a.setProperty("jcr:title","Batman");
  a.setProperty("jcr:description","Silent angel of Gotham");
  a.setProperty("text","once upon a time a long text phrase so as to add penalty to /test/a and nullifying boost");
  Tree b=createNodeWithType(test,"b","oak:TestNode").addChild("jcr:content");
  b.setProperty("jcr:title","Superman");
  b.setProperty("jcr:description","Tale of two heroes Superman and Batman");
  b.setProperty("text","some stuff");
  Tree c=createNodeWithType(test,"c","oak:TestNode").addChild("jcr:content");
  c.setProperty("jcr:title","Ironman");
  c.setProperty("jcr:description","New kid in the town");
  c.setProperty("text","Friend of batman?");
  root.commit();
  String queryString="//element(*,oak:TestNode)[jcr:contains(., 'batman')]";
  String explain=explainXpath(queryString);
  assertThat(explain,containsString("full:jcr:content/jcr:title:batman^4.0"));
  assertThat(explain,containsString("full:jcr:content/jcr:description:batman^2.0"));
  assertThat(explain,containsString(":fulltext:batman"));
  assertOrderedQuery(queryString,asList("/test/a","/test/b","/test/c"),XPATH,true);
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void propertyExistenceQuery2() throws Exception {
  NodeTypeRegistry.register(root,IOUtils.toInputStream(TestUtil.TEST_NODE_TYPE),"test nodeType");
  Tree idx=createIndex("test1",of("propa","propb"));
  Tree props=TestUtil.newRulePropTree(idx,TestUtil.NT_TEST);
  Tree prop=props.addChild(TestUtil.unique("prop"));
  prop.setProperty(LuceneIndexConstants.PROP_NAME,"propa");
  prop.setProperty(LuceneIndexConstants.PROP_PROPERTY_INDEX,true);
  prop.setProperty(LuceneIndexConstants.PROP_NOT_NULL_CHECK_ENABLED,true);
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  createNodeWithType(test,"a","oak:TestNode").setProperty("propa","a");
  createNodeWithType(test,"b","oak:TestNode").setProperty("propa","c");
  createNodeWithType(test,"c","oak:TestNode").setProperty("propb","e");
  root.commit();
  String propabQuery="select [jcr:path] from [oak:TestNode] where [propa] is not null";
  assertThat(explain(propabQuery),containsString("lucene:test1(/oak:index/test1) :notNullProps:propa"));
  assertQuery(propabQuery,asList("/test/a","/test/b"));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void sortQueriesWithString() throws Exception {
  Tree idx=createIndex("test1",of("foo","bar"));
  idx.addChild(PROP_NODE).addChild("foo");
  root.commit();
  assertSortedString();
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void indexSelection() throws Exception {
  createIndex("test1",of("propa","propb"));
  createIndex("test2",of("propc"));
  Tree test=root.getTree("/").addChild("test");
  test.addChild("a").setProperty("propa","foo");
  test.addChild("b").setProperty("propa","foo");
  test.addChild("c").setProperty("propa","foo2");
  test.addChild("d").setProperty("propc","foo");
  test.addChild("e").setProperty("propd","foo");
  root.commit();
  String propaQuery="select [jcr:path] from [nt:base] where [propa] = 'foo'";
  assertThat(explain(propaQuery),containsString("lucene:test1"));
  assertThat(explain("select [jcr:path] from [nt:base] where [propc] = 'foo'"),containsString("lucene:test2"));
  assertQuery(propaQuery,asList("/test/a","/test/b"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] = 'foo2'",asList("/test/c"));
  assertQuery("select [jcr:path] from [nt:base] where [propc] = 'foo'",asList("/test/d"));
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void nodeName() throws Exception {
  Tree idx=createIndex("test1",of("propa","propb"));
  Tree rules=idx.addChild(LuceneIndexConstants.INDEX_RULES);
  rules.setOrderableChildren(true);
  Tree rule=rules.addChild("nt:base");
  rule.setProperty(LuceneIndexConstants.INDEX_NODE_NAME,true);
  root.commit();
  Tree test=root.getTree("/");
  test.addChild("foo");
  test.addChild("camelCase");
  test.addChild("test").addChild("bar");
  root.commit();
  String propabQuery="select [jcr:path] from [nt:base] where LOCALNAME() = 'foo'";
  assertThat(explain(propabQuery),containsString("lucene:test1(/oak:index/test1) :nodeName:foo"));
  assertQuery(propabQuery,asList("/foo"));
  assertQuery("select [jcr:path] from [nt:base] where LOCALNAME() = 'bar'",asList("/test/bar"));
  assertQuery("select [jcr:path] from [nt:base] where LOCALNAME() LIKE 'foo'",asList("/foo"));
  assertQuery("select [jcr:path] from [nt:base] where LOCALNAME() LIKE 'camel%'",asList("/camelCase"));
  assertQuery("select [jcr:path] from [nt:base] where NAME() = 'bar'",asList("/test/bar"));
  assertQuery("select [jcr:path] from [nt:base] where NAME() LIKE 'foo'",asList("/foo"));
  assertQuery("select [jcr:path] from [nt:base] where NAME() LIKE 'camel%'",asList("/camelCase"));
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void unionSortResultCount() throws Exception {
  Tree idx=createIndex("test1",of("propa","propb","propc"));
  idx.setProperty(createProperty(ORDERED_PROP_NAMES,of("propc"),STRINGS));
  useV2(idx);
  Tree test=root.getTree("/").addChild("test");
  root.commit();
  List<Integer> nodes=Lists.newArrayList();
  Random r=new Random();
  int seed=-2;
  for (int i=0; i < 1000; i++) {
    Tree a=test.addChild("a" + i);
    a.setProperty("propa","fooa");
    seed+=2;
    int num=r.nextInt(100);
    a.setProperty("propc",num);
    nodes.add(num);
  }
  seed=-1;
  for (int i=0; i < 1000; i++) {
    Tree a=test.addChild("b" + i);
    a.setProperty("propb","foob");
    seed+=2;
    int num=100 + r.nextInt(100);
    a.setProperty("propc",num);
    nodes.add(num);
  }
  root.commit();
  String query="measure /jcr:root//element(*, nt:base)[(@propa = 'fooa' or @propb = 'foob')] order by @propc";
  assertThat(measureWithLimit(query,XPATH,100),containsString("scanCount: 101"));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void indexTimeFieldBoostAndRelativeProperty() throws Exception {
  Tree index=root.getTree("/");
  Tree indexDefn=createTestIndexNode(index,LuceneIndexConstants.TYPE_LUCENE);
  useV2(indexDefn);
  addPropertyDefn(indexDefn,"jcr:content/metadata/title",4.0);
  addPropertyDefn(indexDefn,"jcr:content/metadata/title2",2.0);
  addPropertyDefn(indexDefn,"propa",1.0);
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  usc(test,"a").setProperty("propa","foo foo foo");
  usc(test,"b").addChild("jcr:content").addChild("metadata").setProperty("title","foo");
  usc(test,"c").addChild("jcr:content").addChild("metadata").setProperty("title2","foo");
  root.commit();
  String queryString="//element(*, oak:Unstructured)[jcr:contains(., 'foo' )]";
  assertOrderedQuery(queryString,asList("/test/b","/test/c","/test/a"),XPATH,true);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void indexDefinitionBelowRoot() throws Exception {
  Tree parent=root.getTree("/").addChild("test");
  Tree idx=createIndex(parent,"test1",of("propa","propb"));
  idx.setProperty(LuceneIndexConstants.EVALUATE_PATH_RESTRICTION,true);
  idx.addChild(PROP_NODE).addChild("propa");
  root.commit();
  Tree test=parent.addChild("test2");
  test.addChild("a").setProperty("propa","a");
  root.commit();
  assertQuery("select [jcr:path] from [nt:base] as s where ISDESCENDANTNODE(s, '/test') and propa = 'a'",asList("/test/test2/a"));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void rangeQueriesWithDate() throws Exception {
  Tree idx=createIndex("test1",of("propa","propb"));
  Tree propIdx=idx.addChild(PROP_NODE).addChild("propa");
  propIdx.setProperty(LuceneIndexConstants.PROP_TYPE,PropertyType.TYPENAME_DATE);
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  test.addChild("a").setProperty("propa",createCal("14/02/2014"));
  test.addChild("b").setProperty("propa",createCal("14/03/2014"));
  test.addChild("c").setProperty("propa",createCal("14/04/2014"));
  test.addChild("c").setProperty("propb","foo");
  test.addChild("d").setProperty("propb","foo");
  root.commit();
  assertQuery("select [jcr:path] from [nt:base] where [propa] >= " + dt("15/02/2014"),asList("/test/b","/test/c"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] <=" + dt("15/03/2014"),asList("/test/b","/test/a"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] < " + dt("14/03/2014"),asList("/test/a"));
  assertQuery("select [jcr:path] from [nt:base] where [propa] > " + dt("15/02/2014") + " and [propa] < "+ dt("13/04/2014"),asList("/test/b"));
  assertQuery("select [jcr:path] from [nt:base] where propa is not null",asList("/test/a","/test/b","/test/c"));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void sortQueriesWithLong_OrderedProps() throws Exception {
  Tree idx=createIndex("test1",of("foo","bar"));
  idx.setProperty(createProperty(INCLUDE_PROPERTY_NAMES,of("bar"),STRINGS));
  idx.setProperty(createProperty(ORDERED_PROP_NAMES,of("foo"),STRINGS));
  Tree propIdx=idx.addChild(PROP_NODE).addChild("foo");
  propIdx.setProperty(LuceneIndexConstants.PROP_TYPE,PropertyType.TYPENAME_LONG);
  root.commit();
  assertSortedLong();
}

</code></pre>

<pre class="type-7 type-6 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void preExtractedTextCache() throws Exception {
  Tree idx=createFulltextIndex(root.getTree("/"),"test");
  TestUtil.useV2(idx);
  root.commit();
  AccessStateProvidingBlob testBlob=new AccessStateProvidingBlob("fox is jumping","id1");
  Tree test=root.getTree("/").addChild("test");
  createFileNode(test,"text",testBlob,"text/plain");
  root.commit();
  editorProvider.getExtractedTextCache().resetCache();
  test=root.getTree("/").addChild("test");
  createFileNode(test,"text2",testBlob,"text/plain");
  root.commit();
  assertTrue(testBlob.isStreamAccessed());
  assertEquals(2,testBlob.accessCount);
  testBlob.resetState();
  editorProvider.getExtractedTextCache().resetCache();
  test=root.getTree("/").addChild("test");
  createFileNode(test,"text3",testBlob,"text/plain");
  createFileNode(test,"text4",testBlob,"text/plain");
  root.commit();
  assertTrue(testBlob.isStreamAccessed());
  assertEquals(1,testBlob.accessCount);
  testBlob.resetState();
  test=root.getTree("/").addChild("test");
  createFileNode(test,"text5",testBlob,"text/plain");
  root.commit();
  assertFalse(testBlob.isStreamAccessed());
  assertEquals(0,testBlob.accessCount);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void sortQueriesWithDouble_OrderedProps() throws Exception {
  Tree idx=createIndex("test1",of("foo","bar"));
  idx.setProperty(createProperty(INCLUDE_PROPERTY_NAMES,of("bar"),STRINGS));
  idx.setProperty(createProperty(ORDERED_PROP_NAMES,of("foo"),STRINGS));
  Tree propIdx=idx.addChild(PROP_NODE).addChild("foo");
  propIdx.setProperty(LuceneIndexConstants.PROP_TYPE,PropertyType.TYPENAME_DOUBLE);
  root.commit();
  assertSortedDouble();
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void indexingPropertyWithAnalyzeButQueryWithWildcard() throws Exception {
  Tree index=root.getTree("/");
  Tree idx=index.addChild(INDEX_DEFINITIONS_NAME).addChild("test2");
  idx.setProperty(JcrConstants.JCR_PRIMARYTYPE,INDEX_DEFINITIONS_NODE_TYPE,Type.NAME);
  idx.setProperty(TYPE_PROPERTY_NAME,LuceneIndexConstants.TYPE_LUCENE);
  idx.setProperty(REINDEX_PROPERTY_NAME,true);
  Tree props=TestUtil.newRulePropTree(idx,"nt:base");
  Tree prop=props.addChild(TestUtil.unique("jcr:mimeType"));
  prop.setProperty(LuceneIndexConstants.PROP_NAME,"jcr:mimeType");
  prop.setProperty(LuceneIndexConstants.PROP_PROPERTY_INDEX,true);
  prop.setProperty(LuceneIndexConstants.PROP_ANALYZED,true);
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  test.addChild("a").setProperty("jcr:mimeType","1234");
  test.addChild("b").setProperty("other","1234");
  test.addChild("c").setProperty("jcr:mimeType","a");
  root.commit();
  String query;
  query="/jcr:root/test//*[jcr:contains(@jcr:mimeType, '1234')]";
  assertThat(explainXpath(query),containsString("lucene:test2(/oak:index/test2)"));
  assertQuery(query,"xpath",asList("/test/a"));
  query="/jcr:root/test//*[jcr:contains(., '1234')]";
  assertThat(explainXpath(query),containsString("no-index"));
  query="/jcr:root/test//*[@jcr:mimeType = '1234']";
  assertThat(explainXpath(query),containsString("lucene:test2(/oak:index/test2)"));
  assertQuery(query,"xpath",asList("/test/a"));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void sortQueriesWithDate_OrderedProps() throws Exception {
  Tree idx=createIndex("test1",of("foo","bar"));
  idx.setProperty(createProperty(INCLUDE_PROPERTY_NAMES,of("bar"),STRINGS));
  idx.setProperty(createProperty(ORDERED_PROP_NAMES,of("foo"),STRINGS));
  Tree propIdx=idx.addChild(PROP_NODE).addChild("foo");
  propIdx.setProperty(LuceneIndexConstants.PROP_TYPE,PropertyType.TYPENAME_DATE);
  root.commit();
  assertSortedDate();
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void indexingBasedOnMixin() throws Exception {
  Tree idx=createIndex("test1",of("propa","propb"));
  Tree props=TestUtil.newRulePropTree(idx,"mix:title");
  Tree prop=props.addChild(TestUtil.unique("prop"));
  prop.setProperty(LuceneIndexConstants.PROP_NAME,"jcr:title");
  prop.setProperty(LuceneIndexConstants.PROP_PROPERTY_INDEX,true);
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  createNodeWithMixinType(test,"a","mix:title").setProperty("jcr:title","a");
  createNodeWithMixinType(test,"b","mix:title").setProperty("jcr:title","c");
  test.addChild("c").setProperty("jcr:title","a");
  root.commit();
  String propabQuery="select [jcr:path] from [mix:title] where [jcr:title] = 'a'";
  assertThat(explain(propabQuery),containsString("lucene:test1(/oak:index/test1)"));
  assertQuery(propabQuery,asList("/test/a"));
}

</code></pre>

<pre class="type-15 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies logic rules using matcher-style statements
"></span><br>
@Test public void sortQueriesWithJcrScore() throws Exception {
  Tree idx=createIndex("test1",of("propa","n0","n1","n2"));
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  for (int i=3; i > 0; i--) {
    Tree child=test.addChild("n" + i);
    child.setProperty("propa","foo");
  }
  root.commit();
  String query="measure select [jcr:path] from [nt:base] where [propa] = 'foo' order by [jcr:score] desc";
  assertThat(measureWithLimit(query,SQL2,1),containsString("scanCount: 1"));
  query="measure select [jcr:path] from [nt:base] where [propa] = 'foo' order by [jcr:score]";
  assertThat(measureWithLimit(query,SQL2,1),containsString("scanCount: 3"));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void binaryNotIndexedWhenMimeTypeNull() throws Exception {
  Tree idx=createFulltextIndex(root.getTree("/"),"test");
  TestUtil.useV2(idx);
  Tree test=root.getTree("/").addChild("test");
  String path=createFileNode(test,"text","red brown fox was jumping","text/plain").getPath();
  root.commit();
  assertQuery("select * from [nt:base] where CONTAINS(*, 'jumping')",asList("/test/text/jcr:content"));
  root.getTree(path).removeProperty(JcrConstants.JCR_MIMETYPE);
  root.commit();
  assertQuery("select * from [nt:base] where CONTAINS(*, 'jumping')",Collections.<String>emptyList());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void rangeQueriesWithString() throws Exception {
  Tree idx=createIndex("test1",of("propa","propb"));
  idx.addChild(PROP_NODE).addChild("propa");
  root.commit();
  Tree test=root.getTree("/").addChild("test");
  test.addChild("a").setProperty("propa","a");
  test.addChild("b").setProperty("propa","b is b");
  test.addChild("c").setProperty("propa","c");
  test.addChild("c").setProperty("propb","e");
  test.addChild("d").setProperty("propb","f");
  test.addChild("e").setProperty("propb","g");
  root.commit();
  assertQuery("select [jcr:path] from [nt:base] where propa = 'a'",asList("/test/a"));
  assertQuery("select [jcr:path] from [nt:base] where propa = 'b is b'",asList("/test/b"));
  assertQuery("select [jcr:path] from [nt:base] where propa in ('a', 'c')",asList("/test/a","/test/c"));
  assertQuery("select [jcr:path] from [nt:base] where [propb] >= 'f'",asList("/test/d","/test/e"));
  assertQuery("select [jcr:path] from [nt:base] where [propb] <= 'f'",asList("/test/c","/test/d"));
  assertQuery("select [jcr:path] from [nt:base] where [propb] > 'e'",asList("/test/d","/test/e"));
  assertQuery("select [jcr:path] from [nt:base] where [propb] < 'g'",asList("/test/c","/test/d"));
  assertQuery("select [jcr:path] from [nt:base] where propa is not null",asList("/test/a","/test/b","/test/c"));
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
