<h3 style="margin:0px">Class: org.apache.jackrabbit.oak.plugins.document.RevisionTest (6 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void difference() throws InterruptedException {
  long t0=Revision.getCurrentTimestamp();
  Revision r0=Revision.newRevision(0);
  Revision r1=Revision.newRevision(0);
  long t1=Revision.getCurrentTimestamp();
  assertTrue(Revision.getTimestampDifference(r1,r0) <= (t1 - t0));
  long t2;
  do {
    t2=Revision.getCurrentTimestamp();
  }
 while (t1 == t2);
  Revision r2=Revision.newRevision(0);
  assertTrue(Revision.getTimestampDifference(r2,r1) > 0);
}

</code></pre>

<pre class="type-7 type-6 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void equalsHashCode(){
  Revision a=Revision.newRevision(0);
  Revision b=Revision.newRevision(0);
  assertTrue(a.equals(a));
  assertFalse(a.equals(b));
  assertFalse(b.equals(a));
  assertFalse(a.hashCode() == b.hashCode());
  Revision a1=Revision.fromString(a.toString());
  assertTrue(a.equals(a1));
  assertTrue(a1.equals(a));
  Revision a2=new Revision(a.getTimestamp(),a.getCounter(),a.getClusterId());
  assertTrue(a.equals(a2));
  assertTrue(a2.equals(a));
  assertEquals(a.hashCode(),a1.hashCode());
  assertEquals(a.hashCode(),a2.hashCode());
  Revision x1=new Revision(a.getTimestamp() + 1,a.getCounter(),a.getClusterId());
  assertFalse(a.equals(x1));
  assertFalse(x1.equals(a));
  assertFalse(a.hashCode() == x1.hashCode());
  Revision x2=new Revision(a.getTimestamp(),a.getCounter() + 1,a.getClusterId());
  assertFalse(a.equals(x2));
  assertFalse(x2.equals(a));
  assertFalse(a.hashCode() == x2.hashCode());
  Revision x3=new Revision(a.getTimestamp(),a.getCounter(),a.getClusterId() + 1);
  assertFalse(a.equals(x3));
  assertFalse(x3.equals(a));
  assertFalse(a.hashCode() == x3.hashCode());
}

</code></pre>

<pre class="type-13 type-5 type-7 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void compare() throws InterruptedException {
  Revision last=Revision.newRevision(0);
  try {
    last.compareRevisionTime(null);
    fail();
  }
 catch (  NullPointerException e) {
  }
  for (int i=0; i < 1000; i++) {
    Revision r=Revision.newRevision(0);
    assertTrue(r.compareRevisionTime(r) == 0);
    assertTrue(r.compareRevisionTime(last) > 0);
    assertTrue(last.compareRevisionTime(r) < 0);
    last=r;
    if (i % 100 == 0) {
      Thread.sleep(1);
    }
  }
}

</code></pre>

<pre class="type-13 type-9 type-7 type-6 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void fromStringToString(){
  for (int i=0; i < 10000; i++) {
    Revision r=Revision.newRevision(i);
    Revision r2=Revision.fromString(r.toString());
    assertEquals(r.toString(),r2.toString());
    assertEquals(r.hashCode(),r2.hashCode());
    assertTrue(r.equals(r2));
  }
}

</code></pre>

<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects are null
"></span><br>
@Test public void uniqueRevision2() throws Exception {
  List<Thread> threads=new ArrayList<Thread>();
  final AtomicBoolean stop=new AtomicBoolean();
  final Set<Revision> set=Collections.synchronizedSet(new HashSet<Revision>());
  final Revision[] duplicate=new Revision[1];
  for (int i=0; i < 20; i++) {
    Thread thread=new Thread(new Runnable(){
      @Override public void run(){
        Revision[] last=new Revision[1024];
        while (!stop.get()) {
          for (          Revision r : last) {
            set.remove(r);
          }
          for (int i=0; i < last.length; i++) {
            last[i]=Revision.newRevision(1);
          }
          for (          Revision r : last) {
            if (!set.add(r)) {
              duplicate[0]=r;
            }
          }
        }
      }
    }
);
    thread.start();
    threads.add(thread);
  }
  Thread.sleep(200);
  stop.set(true);
  for (  Thread t : threads) {
    t.join();
  }
  assertNull("Duplicate revision",duplicate[0]);
}

</code></pre>

<pre class="type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void uniqueRevision() throws Exception {
  final BlockingQueue<Revision> revisionQueue=Queues.newLinkedBlockingQueue();
  int noOfThreads=60;
  final int noOfLoops=1000;
  List<Thread> workers=new ArrayList<Thread>();
  final AtomicBoolean stop=new AtomicBoolean();
  final CountDownLatch startLatch=new CountDownLatch(1);
  final CountDownLatch stopLatch=new CountDownLatch(noOfThreads);
  for (int i=0; i < noOfThreads; i++) {
    workers.add(new Thread(new Runnable(){
      @Override public void run(){
        Uninterruptibles.awaitUninterruptibly(startLatch);
        for (int j=0; j < noOfLoops && !stop.get(); j++) {
          revisionQueue.add(Revision.newRevision(1));
        }
        stopLatch.countDown();
      }
    }
));
  }
  final List<Revision> duplicates=Lists.newArrayList();
  final Set<Revision> seenRevs=Sets.newHashSet();
  workers.add(new Thread(new Runnable(){
    @Override public void run(){
      startLatch.countDown();
      while (!stop.get()) {
        List<Revision> revs=Lists.newArrayList();
        Queues.drainUninterruptibly(revisionQueue,revs,5,100,TimeUnit.MILLISECONDS);
        record(revs);
      }
      List<Revision> revs=Lists.newArrayList();
      revisionQueue.drainTo(revs);
      record(revs);
    }
    private void record(    List<Revision> revs){
      for (      Revision rev : revs) {
        if (!seenRevs.add(rev)) {
          duplicates.add(rev);
        }
      }
      if (!duplicates.isEmpty()) {
        stop.set(true);
      }
    }
  }
));
  for (  Thread t : workers) {
    t.start();
  }
  stopLatch.await();
  stop.set(true);
  for (  Thread t : workers) {
    t.join();
  }
  assertTrue(String.format("Duplicate rev seen %s %n Seen %s",duplicates,seenRevs),duplicates.isEmpty());
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
