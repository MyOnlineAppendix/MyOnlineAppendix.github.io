<h3 style="margin:0px">Class: org.apache.jackrabbit.oak.plugins.document.ValueMapTest (4 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(2)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void mergeSorted1() throws Exception {
  MemoryDocumentStore store=new MemoryDocumentStore();
  Revision r1=new Revision(1,0,1);
  Revision r2=new Revision(2,0,1);
  Revision r3=new Revision(3,0,1);
  Revision r4=new Revision(4,0,1);
  Revision r5=new Revision(5,0,1);
  Revision r6=new Revision(6,0,1);
  Revision r7=new Revision(7,0,1);
  Range range1=new Range(r7,r5,0);
  Range range2=new Range(r4,r1,0);
  String prevId1=Utils.getPreviousIdFor("/",range1.high,0);
  UpdateOp prevOp1=new UpdateOp(prevId1,true);
  prevOp1.set(Document.ID,prevId1);
  NodeDocument.setRevision(prevOp1,r5,"c");
  NodeDocument.setRevision(prevOp1,r7,"c");
  String prevId2=Utils.getPreviousIdFor("/",range2.high,0);
  UpdateOp prevOp2=new UpdateOp(prevId2,true);
  prevOp1.set(Document.ID,prevId2);
  NodeDocument.setRevision(prevOp2,r1,"c");
  NodeDocument.setRevision(prevOp2,r2,"c");
  NodeDocument.setRevision(prevOp2,r4,"c");
  String rootId=Utils.getIdFromPath("/");
  UpdateOp op=new UpdateOp(rootId,true);
  op.set(Document.ID,rootId);
  NodeDocument.setRevision(op,r3,"c");
  NodeDocument.setRevision(op,r6,"c");
  NodeDocument.setPrevious(op,range1);
  NodeDocument.setPrevious(op,range2);
  store.create(NODES,Lists.newArrayList(op,prevOp1,prevOp2));
  NodeDocument doc=store.find(NODES,rootId);
  Iterators.size(doc.getValueMap(NodeDocument.REVISIONS).entrySet().iterator());
}

</code></pre>

<pre class="type-9 type-7 type-6 type-4 type-8 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void previousDocs1(){
  String rootPath="/";
  String rootId=Utils.getIdFromPath(rootPath);
  Revision r0=new Revision(0,0,1);
  MemoryDocumentStore store=new MemoryDocumentStore();
  UpdateOp op=new UpdateOp(Utils.getPreviousIdFor(rootPath,r0,0),true);
  op.set(ID,op.getId());
  op.setMapEntry("prop",r0,"0");
  NodeDocument.setRevision(op,r0,"c");
  store.createOrUpdate(NODES,op);
  Revision r1low=new Revision(1,0,1);
  Revision r1high=new Revision(1,10,1);
  op=new UpdateOp(Utils.getPreviousIdFor(rootPath,r1high,0),true);
  op.set(ID,op.getId());
  for (int i=r1low.getCounter(); i <= r1high.getCounter(); i++) {
    Revision r=new Revision(1,i,1);
    op.setMapEntry("foo",r,String.valueOf(i));
    NodeDocument.setRevision(op,r,"c");
  }
  store.createOrUpdate(NODES,op);
  op=new UpdateOp(rootId,true);
  op.set(ID,op.getId());
  Revision r2=new Revision(2,0,1);
  op.setMapEntry("prop",r2,"1");
  NodeDocument.setRevision(op,r2,"c");
  NodeDocument.setPrevious(op,new Range(r0,r0,0));
  NodeDocument.setPrevious(op,new Range(r1high,r1low,0));
  store.createOrUpdate(NODES,op);
  NodeDocument doc=store.find(NODES,rootId);
  assertNotNull(doc);
  Set<Revision> revs=doc.getValueMap("prop").keySet();
  assertEquals(2,revs.size());
  assertTrue(revs.contains(r0));
  assertTrue(revs.contains(r2));
  Iterator<Revision> it=revs.iterator();
  assertTrue(it.hasNext());
  assertEquals(r2,it.next());
  assertTrue(it.hasNext());
  assertEquals(r0,it.next());
}

</code></pre>

<pre class="type-9 type-6 type-4 type-8 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void previousDocs2(){
  MemoryDocumentStore store=new MemoryDocumentStore();
  String rootPath="/";
  String rootId=Utils.getIdFromPath(rootPath);
  Revision r01=new Revision(0,0,1);
  Revision r12=new Revision(1,0,2);
  Revision r22=new Revision(2,0,2);
  Revision r31=new Revision(3,0,1);
  Revision r42=new Revision(4,0,2);
  Revision r51=new Revision(5,0,1);
  UpdateOp op=new UpdateOp(Utils.getPreviousIdFor(rootPath,r31,0),true);
  op.set(ID,op.getId());
  op.setMapEntry("p0",r01,"0");
  NodeDocument.setRevision(op,r01,"c");
  op.setMapEntry("p1",r31,"1");
  NodeDocument.setRevision(op,r31,"c");
  store.createOrUpdate(NODES,op);
  op=new UpdateOp(Utils.getPreviousIdFor(rootPath,r42,0),true);
  op.set(ID,op.getId());
  op.setMapEntry("p1",r12,"0");
  NodeDocument.setRevision(op,r12,"c");
  op.setMapEntry("p1",r22,"1");
  NodeDocument.setRevision(op,r22,"c");
  op.setMapEntry("p0",r42,"1");
  NodeDocument.setRevision(op,r42,"c");
  store.createOrUpdate(NODES,op);
  op=new UpdateOp(rootId,true);
  op.set(ID,op.getId());
  op.setMapEntry("p0",r51,"2");
  op.setMapEntry("p1",r51,"2");
  NodeDocument.setRevision(op,r51,"c");
  NodeDocument.setPrevious(op,new Range(r42,r12,0));
  NodeDocument.setPrevious(op,new Range(r31,r01,0));
  store.createOrUpdate(NODES,op);
  NodeDocument doc=store.find(NODES,rootId);
  assertNotNull(doc);
  List<NodeDocument> prevDocs=Lists.newArrayList(doc.getPreviousDocs("p1",null));
  assertEquals(2,prevDocs.size());
  assertEquals(Utils.getPreviousIdFor(rootPath,r31,0),prevDocs.get(0).getId());
  assertEquals(Utils.getPreviousIdFor(rootPath,r42,0),prevDocs.get(1).getId());
  List<Revision> revs=new ArrayList<Revision>();
  for (  Revision r : doc.getValueMap("p1").keySet()) {
    revs.add(r);
  }
  assertEquals(Arrays.asList(r51,r31,r22,r12),revs);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void mergeSorted() throws Exception {
  DocumentNodeStore store=new DocumentMK.Builder().setAsyncDelay(0).getNodeStore();
  DocumentStore docStore=store.getDocumentStore();
  String id=Utils.getIdFromPath("/");
  List<NodeBuilder> branches=Lists.newArrayList();
  int i=0;
  while (docStore.find(NODES,id).getPreviousRanges().size() < 2) {
    i++;
    NodeBuilder builder=store.getRoot().builder();
    builder.child("foo").setProperty("prop",i);
    builder.child("bar").setProperty("prop",i);
    if (i % 7 == 0) {
      int numRevs=docStore.find(NODES,id).getLocalRevisions().size();
      NodeBuilder child=builder.child("node" + i);
      int p=0;
      while (numRevs == docStore.find(NODES,id).getLocalRevisions().size()) {
        child.setProperty("prop",p++);
      }
      branches.add(builder);
    }
 else {
      store.merge(builder,EmptyHook.INSTANCE,CommitInfo.EMPTY);
    }
    store.runBackgroundOperations();
  }
  NodeDocument doc=docStore.find(NODES,id);
  Iterators.size(doc.getValueMap(NodeDocument.REVISIONS).entrySet().iterator());
  store.dispose();
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
