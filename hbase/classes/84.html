<h3 style="margin:0px">Class: org.apache.hadoop.hbase.client.TestHCM (18 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(12)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(10)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(7)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(7)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(6)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(4)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="18"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('18')" data-toggle="tooltip" title="Is not executed with the test suite"><kbd id="tag-18"class="label-info"style="display: inline-block;font-size:7pt" >IgnoredMethod&nbsp;(2)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;<button id="17"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('17')" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution"><kbd id="tag-17"class="label-info"style="display: inline-block;font-size:7pt" >ExceptionVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testConnectionRideOverClusterRestart() throws IOException, InterruptedException {
  Configuration config=new Configuration(TEST_UTIL.getConfiguration());
  TableName tableName=TableName.valueOf("testConnectionRideOverClusterRestart");
  TEST_UTIL.createTable(tableName,new byte[][]{FAM_NAM}).close();
  Connection connection=ConnectionFactory.createConnection(config);
  Table table=connection.getTable(tableName);
  table.get(new Get(Bytes.toBytes("foo")));
  TEST_UTIL.shutdownMiniHBaseCluster();
  TEST_UTIL.restartHBaseCluster(2);
  table.get(new Get(Bytes.toBytes("foo")));
  TEST_UTIL.deleteTable(tableName);
  table.close();
  connection.close();
}

</code></pre>

<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * Test that Connection or Pool are not closed when managed externally
 * @throws Exception
 */
@Test public void testConnectionManagement() throws Exception {
  Table table0=TEST_UTIL.createTable(TABLE_NAME1,FAM_NAM);
  Connection conn=ConnectionFactory.createConnection(TEST_UTIL.getConfiguration());
  HTable table=(HTable)conn.getTable(TABLE_NAME1);
  table.close();
  assertFalse(conn.isClosed());
  assertFalse(table.getPool().isShutdown());
  table=(HTable)conn.getTable(TABLE_NAME1);
  table.close();
  assertFalse(table.getPool().isShutdown());
  conn.close();
  assertTrue(table.getPool().isShutdown());
  table0.close();
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that connection can become idle without breaking everything.
 */
@Test public void testConnectionIdle() throws Exception {
  TableName tableName=TableName.valueOf("HCM-testConnectionIdle");
  TEST_UTIL.createTable(tableName,FAM_NAM).close();
  int idleTime=20000;
  boolean previousBalance=TEST_UTIL.getHBaseAdmin().setBalancerRunning(false,true);
  Configuration c2=new Configuration(TEST_UTIL.getConfiguration());
  c2.set(HConstants.HBASE_CLIENT_INSTANCE_ID,String.valueOf(-1));
  c2.setInt(HConstants.HBASE_CLIENT_RETRIES_NUMBER,1);
  c2.setInt(RpcClient.IDLE_TIME,idleTime);
  Connection connection=ConnectionFactory.createConnection(c2);
  final Table table=connection.getTable(tableName);
  Put put=new Put(ROW);
  put.addColumn(FAM_NAM,ROW,ROW);
  table.put(put);
  ManualEnvironmentEdge mee=new ManualEnvironmentEdge();
  mee.setValue(System.currentTimeMillis());
  EnvironmentEdgeManager.injectEdge(mee);
  LOG.info("first get");
  table.get(new Get(ROW));
  LOG.info("first get - changing the time & sleeping");
  mee.incValue(idleTime + 1000);
  Thread.sleep(1500);
  LOG.info("second get - connection has been marked idle in the middle");
  table.get(new Get(ROW));
  mee.incValue(idleTime + 1000);
  LOG.info("third get - connection is idle, but the reader doesn't know yet");
  table.get(new Get(ROW));
  LOG.info("we're done - time will change back");
  table.close();
  connection.close();
  EnvironmentEdgeManager.reset();
  TEST_UTIL.getHBaseAdmin().setBalancerRunning(previousBalance,true);
}

</code></pre>

<pre class="type-7 type-8 type-5 type-6 type-18 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
- Is not executed with the test suite
"></span><br>
@Ignore("Test presumes RETRY_BACKOFF will never change; it has") @Test public void testErrorBackoffTimeCalculation() throws Exception {
  final long ANY_PAUSE=100;
  ServerName location=ServerName.valueOf("127.0.0.1",1,0);
  ServerName diffLocation=ServerName.valueOf("127.0.0.1",2,0);
  ManualEnvironmentEdge timeMachine=new ManualEnvironmentEdge();
  EnvironmentEdgeManager.injectEdge(timeMachine);
  try {
    long timeBase=timeMachine.currentTime();
    long largeAmountOfTime=ANY_PAUSE * 1000;
    ConnectionImplementation.ServerErrorTracker tracker=new ConnectionImplementation.ServerErrorTracker(largeAmountOfTime,100);
    assertEquals(0,tracker.calculateBackoffTime(location,ANY_PAUSE));
    tracker.reportServerError(location);
    assertEqualsWithJitter(ANY_PAUSE,tracker.calculateBackoffTime(location,ANY_PAUSE));
    tracker.reportServerError(location);
    tracker.reportServerError(location);
    tracker.reportServerError(location);
    assertEqualsWithJitter(ANY_PAUSE * 5,tracker.calculateBackoffTime(location,ANY_PAUSE));
    assertEquals(0,tracker.calculateBackoffTime(diffLocation,ANY_PAUSE));
    tracker.reportServerError(diffLocation);
    assertEqualsWithJitter(ANY_PAUSE,tracker.calculateBackoffTime(diffLocation,ANY_PAUSE));
    assertEqualsWithJitter(ANY_PAUSE * 10,tracker.calculateBackoffTime(location,ANY_PAUSE * 2));
    long timeShift=(long)(ANY_PAUSE * 0.5);
    timeMachine.setValue(timeBase + timeShift);
    assertEqualsWithJitter((ANY_PAUSE * 5) - timeShift,tracker.calculateBackoffTime(location,ANY_PAUSE),ANY_PAUSE * 2);
    timeMachine.setValue(timeBase + ANY_PAUSE * 100);
    assertEquals(0,tracker.calculateBackoffTime(location,ANY_PAUSE));
    long timeLeft=(long)(ANY_PAUSE * 0.5);
    timeMachine.setValue(timeBase + largeAmountOfTime - timeLeft);
    assertTrue(tracker.canTryMore(1));
    tracker.reportServerError(location);
    assertEquals(timeLeft,tracker.calculateBackoffTime(location,ANY_PAUSE));
    timeMachine.setValue(timeBase + largeAmountOfTime);
    assertFalse(tracker.canTryMore(1));
  }
  finally {
    EnvironmentEdgeManager.reset();
  }
}

</code></pre>

<pre class="type-4 type-7 type-8 type-13 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testClusterConnection() throws IOException {
  ThreadPoolExecutor otherPool=new ThreadPoolExecutor(1,1,5,TimeUnit.SECONDS,new SynchronousQueue<Runnable>(),Threads.newDaemonThreadFactory("test-hcm"));
  Connection con1=ConnectionFactory.createConnection(TEST_UTIL.getConfiguration());
  Connection con2=ConnectionFactory.createConnection(TEST_UTIL.getConfiguration(),otherPool);
  assertTrue(otherPool == ((ConnectionImplementation)con2).getCurrentBatchPool());
  TableName tableName=TableName.valueOf("testClusterConnection");
  TEST_UTIL.createTable(tableName,FAM_NAM).close();
  HTable t=(HTable)con1.getTable(tableName,otherPool);
  assertNull("Internal Thread pool should be null",((ConnectionImplementation)con1).getCurrentBatchPool());
  assertTrue(otherPool == t.getPool());
  t.close();
  t=(HTable)con2.getTable(tableName);
  assertTrue(otherPool == t.getPool());
  t.close();
  t=(HTable)con2.getTable(tableName);
  assertTrue(otherPool == t.getPool());
  t.close();
  t=(HTable)con2.getTable(tableName);
  assertTrue(otherPool == t.getPool());
  t.close();
  t=(HTable)con1.getTable(tableName);
  ExecutorService pool=((ConnectionImplementation)con1).getCurrentBatchPool();
  assertNotNull("An internal Thread pool should have been created",pool);
  assertTrue(t.getPool() == pool);
  t.close();
  t=(HTable)con1.getTable(tableName);
  assertTrue(t.getPool() == pool);
  t.close();
  con1.close();
  assertTrue(pool.isShutdown());
  con2.close();
  assertFalse(otherPool.isShutdown());
  otherPool.shutdownNow();
}

</code></pre>

<pre class="type-10 type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Test that an operation can fail if we read the global operation timeout, even if the
 * individual timeout is fine. We do that with:
 * - client side: an operation timeout of 30 seconds
 * - server side: we sleep 20 second at each attempt. The first work fails, the second one
 * succeeds. But the client won't wait that much, because 20 + 20 > 30, so the client
 * timeouted when the server answers.
 */
@Test public void testOperationTimeout() throws Exception {
  HTableDescriptor hdt=TEST_UTIL.createTableDescriptor("HCM-testOperationTimeout");
  hdt.addCoprocessor(SleepAndFailFirstTime.class.getName());
  Table t=TEST_UTIL.createTable(hdt,new byte[][]{FAM_NAM},null);
  if (t instanceof HTable) {
    HTable table=(HTable)t;
    table.setOperationTimeout(120 * 1000);
    table.get(new Get(FAM_NAM));
    SleepAndFailFirstTime.ct.set(0);
    try {
      table.setOperationTimeout(30 * 1000);
      table.get(new Get(FAM_NAM));
      Assert.fail("We expect an exception here");
    }
 catch (    SocketTimeoutException e) {
      LOG.info("We received an exception, as expected ",e);
    }
catch (    IOException e) {
      Assert.fail("Wrong exception:" + e.getMessage());
    }
 finally {
      table.close();
    }
  }
}

</code></pre>

<pre class="type-4 type-11 type-7 type-8 type-13 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that when we delete a location using the first row of a region
 * that we really delete it.
 * @throws Exception
 */
@Test public void testRegionCaching() throws Exception {
  TEST_UTIL.createMultiRegionTable(TABLE_NAME,FAM_NAM).close();
  Configuration conf=new Configuration(TEST_UTIL.getConfiguration());
  conf.setInt(HConstants.HBASE_CLIENT_RETRIES_NUMBER,0);
  Connection connection=ConnectionFactory.createConnection(conf);
  final Table table=connection.getTable(TABLE_NAME);
  TEST_UTIL.waitUntilAllRegionsAssigned(table.getName());
  Put put=new Put(ROW);
  put.addColumn(FAM_NAM,ROW,ROW);
  table.put(put);
  ConnectionImplementation conn=(ConnectionImplementation)connection;
  assertNotNull(conn.getCachedLocation(TABLE_NAME,ROW));
  final int nextPort=conn.getCachedLocation(TABLE_NAME,ROW).getRegionLocation().getPort() + 1;
  HRegionLocation loc=conn.getCachedLocation(TABLE_NAME,ROW).getRegionLocation();
  conn.updateCachedLocation(loc.getRegionInfo(),loc.getServerName(),ServerName.valueOf("127.0.0.1",nextPort,HConstants.LATEST_TIMESTAMP),HConstants.LATEST_TIMESTAMP);
  Assert.assertEquals(conn.getCachedLocation(TABLE_NAME,ROW).getRegionLocation().getPort(),nextPort);
  conn.clearRegionCache(TABLE_NAME,ROW.clone());
  RegionLocations rl=conn.getCachedLocation(TABLE_NAME,ROW);
  assertNull("What is this location?? " + rl,rl);
  conn.clearRegionCache(TABLE_NAME);
  Assert.assertEquals(0,conn.getNumberOfCachedRegionLocations(TABLE_NAME));
  Put put2=new Put(ROW);
  put2.addColumn(FAM_NAM,ROW,ROW);
  table.put(put2);
  assertNotNull(conn.getCachedLocation(TABLE_NAME,ROW));
  assertNotNull(conn.getCachedLocation(TableName.valueOf(TABLE_NAME.getName()),ROW.clone()));
  TEST_UTIL.getHBaseAdmin().setBalancerRunning(false,false);
  HMaster master=TEST_UTIL.getMiniHBaseCluster().getMaster();
  while (master.getAssignmentManager().getRegionStates().isRegionsInTransition()) {
    Thread.sleep(1);
  }
  HRegionLocation toMove=conn.getCachedLocation(TABLE_NAME,ROW).getRegionLocation();
  byte[] regionName=toMove.getRegionInfo().getRegionName();
  byte[] encodedRegionNameBytes=toMove.getRegionInfo().getEncodedNameAsBytes();
  int curServerId=TEST_UTIL.getHBaseCluster().getServerWith(regionName);
  int destServerId=(curServerId == 0 ? 1 : 0);
  HRegionServer curServer=TEST_UTIL.getHBaseCluster().getRegionServer(curServerId);
  HRegionServer destServer=TEST_UTIL.getHBaseCluster().getRegionServer(destServerId);
  ServerName destServerName=destServer.getServerName();
  Assert.assertTrue(curServer != destServer);
  Assert.assertFalse(curServer.getServerName().equals(destServer.getServerName()));
  Assert.assertFalse(toMove.getPort() == destServerName.getPort());
  Assert.assertNotNull(curServer.getOnlineRegion(regionName));
  Assert.assertNull(destServer.getOnlineRegion(regionName));
  Assert.assertFalse(TEST_UTIL.getMiniHBaseCluster().getMaster().getAssignmentManager().getRegionStates().isRegionsInTransition());
  LOG.info("Move starting region=" + toMove.getRegionInfo().getRegionNameAsString());
  TEST_UTIL.getHBaseAdmin().move(toMove.getRegionInfo().getEncodedNameAsBytes(),destServerName.getServerName().getBytes());
  while (destServer.getOnlineRegion(regionName) == null || destServer.getRegionsInTransitionInRS().containsKey(encodedRegionNameBytes) || curServer.getRegionsInTransitionInRS().containsKey(encodedRegionNameBytes) || master.getAssignmentManager().getRegionStates().isRegionsInTransition()) {
    Thread.sleep(1);
  }
  LOG.info("Move finished for region=" + toMove.getRegionInfo().getRegionNameAsString());
  Assert.assertNull(curServer.getOnlineRegion(regionName));
  Assert.assertNotNull(destServer.getOnlineRegion(regionName));
  Assert.assertFalse(destServer.getRegionsInTransitionInRS().containsKey(encodedRegionNameBytes));
  Assert.assertFalse(curServer.getRegionsInTransitionInRS().containsKey(encodedRegionNameBytes));
  Assert.assertFalse(conn.getCachedLocation(TABLE_NAME,ROW).getRegionLocation().getPort() == destServerName.getPort());
  LOG.info("Put starting");
  Put put3=new Put(ROW);
  put3.addColumn(FAM_NAM,ROW,ROW);
  try {
    table.put(put3);
    Assert.fail("Unreachable point");
  }
 catch (  RetriesExhaustedWithDetailsException e) {
    LOG.info("Put done, exception caught: " + e.getClass());
    Assert.assertEquals(1,e.getNumExceptions());
    Assert.assertEquals(1,e.getCauses().size());
    Assert.assertArrayEquals(e.getRow(0).getRow(),ROW);
    Throwable cause=ClientExceptionsUtil.findException(e.getCause(0));
    Assert.assertNotNull(cause);
    Assert.assertTrue(cause instanceof RegionMovedException);
  }
  Assert.assertNotNull("Cached connection is null",conn.getCachedLocation(TABLE_NAME,ROW));
  Assert.assertEquals("Previous server was " + curServer.getServerName().getHostAndPort(),destServerName.getPort(),conn.getCachedLocation(TABLE_NAME,ROW).getRegionLocation().getPort());
  Assert.assertFalse(destServer.getRegionsInTransitionInRS().containsKey(encodedRegionNameBytes));
  Assert.assertFalse(curServer.getRegionsInTransitionInRS().containsKey(encodedRegionNameBytes));
  LOG.info("Move starting region=" + toMove.getRegionInfo().getRegionNameAsString());
  TEST_UTIL.getHBaseAdmin().move(toMove.getRegionInfo().getEncodedNameAsBytes(),curServer.getServerName().getServerName().getBytes());
  while (curServer.getOnlineRegion(regionName) == null || destServer.getRegionsInTransitionInRS().containsKey(encodedRegionNameBytes) || curServer.getRegionsInTransitionInRS().containsKey(encodedRegionNameBytes) || master.getAssignmentManager().getRegionStates().isRegionsInTransition()) {
    Thread.sleep(1);
  }
  Assert.assertNotNull(curServer.getOnlineRegion(regionName));
  Assert.assertNull(destServer.getOnlineRegion(regionName));
  LOG.info("Move finished for region=" + toMove.getRegionInfo().getRegionNameAsString());
  Assert.assertFalse(conn.getCachedLocation(TABLE_NAME,ROW).getRegionLocation().getPort() == curServer.getServerName().getPort());
  Scan sc=new Scan();
  sc.setStopRow(ROW);
  sc.setStartRow(ROW);
  TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_CLIENT_RETRIES_NUMBER,1);
  try {
    ResultScanner rs=table.getScanner(sc);
    while (rs.next() != null) {
    }
    Assert.fail("Unreachable point");
  }
 catch (  RetriesExhaustedException e) {
    LOG.info("Scan done, expected exception caught: " + e.getClass());
  }
  Assert.assertNotNull(conn.getCachedLocation(TABLE_NAME,ROW));
  Assert.assertEquals("Previous server was " + destServer.getServerName().getHostAndPort(),curServer.getServerName().getPort(),conn.getCachedLocation(TABLE_NAME,ROW).getRegionLocation().getPort());
  TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_CLIENT_RETRIES_NUMBER,HConstants.DEFAULT_HBASE_CLIENT_RETRIES_NUMBER);
  table.close();
  connection.close();
}

</code></pre>

<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * Naive test to check that HConnection#getAdmin returns a properly constructed HBaseAdmin object
 * @throws IOException Unable to construct admin
 */
@Test public void testAdminFactory() throws IOException {
  Connection con1=ConnectionFactory.createConnection(TEST_UTIL.getConfiguration());
  Admin admin=con1.getAdmin();
  assertTrue(admin.getConnection() == con1);
  assertTrue(admin.getConfiguration() == TEST_UTIL.getConfiguration());
  con1.close();
}

</code></pre>

<pre class="type-7 type-13 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that stale cache updates don't override newer cached values.
 */
@Test public void testCacheSeqNums() throws Exception {
  Table table=TEST_UTIL.createMultiRegionTable(TABLE_NAME2,FAM_NAM);
  Put put=new Put(ROW);
  put.addColumn(FAM_NAM,ROW,ROW);
  table.put(put);
  ConnectionImplementation conn=(ConnectionImplementation)TEST_UTIL.getConnection();
  HRegionLocation location=conn.getCachedLocation(TABLE_NAME2,ROW).getRegionLocation();
  assertNotNull(location);
  ServerName anySource=ServerName.valueOf(location.getHostname(),location.getPort() - 1,0L);
  int nextPort=location.getPort() + 1;
  conn.updateCachedLocation(location.getRegionInfo(),location.getServerName(),ServerName.valueOf("127.0.0.1",nextPort,0),location.getSeqNum() - 1);
  location=conn.getCachedLocation(TABLE_NAME2,ROW).getRegionLocation();
  Assert.assertEquals(nextPort,location.getPort());
  nextPort=location.getPort() + 1;
  conn.updateCachedLocation(location.getRegionInfo(),location.getServerName(),ServerName.valueOf("127.0.0.1",nextPort,0),location.getSeqNum() - 1);
  location=conn.getCachedLocation(TABLE_NAME2,ROW).getRegionLocation();
  Assert.assertEquals(nextPort,location.getPort());
  nextPort=location.getPort() + 1;
  conn.updateCachedLocation(location.getRegionInfo(),anySource,ServerName.valueOf("127.0.0.1",nextPort,0),location.getSeqNum() + 1);
  location=conn.getCachedLocation(TABLE_NAME2,ROW).getRegionLocation();
  Assert.assertEquals(nextPort,location.getPort());
  nextPort=location.getPort() + 1;
  conn.updateCachedLocation(location.getRegionInfo(),anySource,ServerName.valueOf("127.0.0.1",nextPort,0),location.getSeqNum() - 1);
  location=conn.getCachedLocation(TABLE_NAME2,ROW).getRegionLocation();
  Assert.assertEquals(nextPort - 1,location.getPort());
  table.close();
}

</code></pre>

<pre class="type-4 type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testClosing() throws Exception {
  Configuration configuration=new Configuration(TEST_UTIL.getConfiguration());
  configuration.set(HConstants.HBASE_CLIENT_INSTANCE_ID,String.valueOf(_randy.nextInt()));
  Connection c1=ConnectionFactory.createConnection(configuration);
  Connection c2=ConnectionFactory.createConnection(configuration);
  assertTrue(c1 != c2);
  c1.close();
  assertTrue(c1.isClosed());
  assertFalse(c2.isClosed());
  c2.close();
  assertTrue(c2.isClosed());
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@AfterClass public static void tearDownAfterClass() throws Exception {
  TEST_UTIL.shutdownMiniCluster();
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test that we can handle connection close: it will trigger a retry, but the calls will
 * finish.
 */
@Test public void testConnectionCloseAllowsInterrupt() throws Exception {
  testConnectionClose(true);
}

</code></pre>

<pre class="type-7 type-13 type-17 type-6 type-18 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
- Is not executed with the test suite
"></span><br>
@Ignore @Test(expected=RegionServerStoppedException.class) public void testClusterStatus() throws Exception {
  TableName tn=TableName.valueOf("testClusterStatus");
  byte[] cf="cf".getBytes();
  byte[] rk="rk1".getBytes();
  JVMClusterUtil.RegionServerThread rs=TEST_UTIL.getHBaseCluster().startRegionServer();
  rs.waitForServerOnline();
  final ServerName sn=rs.getRegionServer().getServerName();
  Table t=TEST_UTIL.createTable(tn,cf);
  TEST_UTIL.waitTableAvailable(tn);
  while (TEST_UTIL.getHBaseCluster().getMaster().getAssignmentManager().getRegionStates().isRegionsInTransition()) {
    Thread.sleep(1);
  }
  final ConnectionImplementation hci=(ConnectionImplementation)TEST_UTIL.getConnection();
  try (RegionLocator l=TEST_UTIL.getConnection().getRegionLocator(tn)){
    while (l.getRegionLocation(rk).getPort() != sn.getPort()) {
      TEST_UTIL.getHBaseAdmin().move(l.getRegionLocation(rk).getRegionInfo().getEncodedNameAsBytes(),Bytes.toBytes(sn.toString()));
      while (TEST_UTIL.getHBaseCluster().getMaster().getAssignmentManager().getRegionStates().isRegionsInTransition()) {
        Thread.sleep(1);
      }
      hci.clearRegionCache(tn);
    }
    Assert.assertNotNull(hci.clusterStatusListener);
    TEST_UTIL.assertRegionOnServer(l.getRegionLocation(rk).getRegionInfo(),sn,20000);
  }
   Put p1=new Put(rk);
  p1.addColumn(cf,"qual".getBytes(),"val".getBytes());
  t.put(p1);
  rs.getRegionServer().abort("I'm dead");
  TEST_UTIL.waitFor(40000,1000,true,new Waiter.Predicate<Exception>(){
    @Override public boolean evaluate() throws Exception {
      return TEST_UTIL.getHBaseCluster().getMaster().getServerManager().getDeadServers().isDeadServer(sn);
    }
  }
);
  TEST_UTIL.waitFor(40000,1000,true,new Waiter.Predicate<Exception>(){
    @Override public boolean evaluate() throws Exception {
      return hci.clusterStatusListener.isDeadServer(sn);
    }
  }
);
  t.close();
  hci.getClient(sn);
}

</code></pre>

<pre class="type-4 type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * Trivial test to verify that nobody messes with{@link ConnectionFactory#createConnection(Configuration)}
 */
@Test public void testCreateConnection() throws Exception {
  Configuration configuration=TEST_UTIL.getConfiguration();
  Connection c1=ConnectionFactory.createConnection(configuration);
  Connection c2=ConnectionFactory.createConnection(configuration);
  assertTrue(c1 != c2);
  assertTrue(c1.getConfiguration() == c2.getConfiguration());
}

</code></pre>

<pre class="type-4 type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * This test checks that one can connect to the cluster with only the
 * ZooKeeper quorum set. Other stuff like master address will be read
 * from ZK by the client.
 */
@Test public void testConnection() throws Exception {
  Configuration c=new Configuration();
  c.set(HConstants.ZOOKEEPER_QUORUM,TEST_UTIL.getConfiguration().get(HConstants.ZOOKEEPER_QUORUM));
  c.set(HConstants.ZOOKEEPER_CLIENT_PORT,TEST_UTIL.getConfiguration().get(HConstants.ZOOKEEPER_CLIENT_PORT));
  HConnection conn=(HConnection)ConnectionFactory.createConnection(c);
  assertTrue(conn.isMasterRunning());
  conn.close();
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testConnectionNotAllowsInterrupt() throws Exception {
  testConnectionClose(false);
}

</code></pre>

<pre class="type-4 type-11 type-7 type-8 type-13 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that the connection to the dead server is cut immediately when we receive the
 * notification.
 * @throws Exception
 */
@Test public void testConnectionCut() throws Exception {
  TableName tableName=TableName.valueOf("HCM-testConnectionCut");
  TEST_UTIL.createTable(tableName,FAM_NAM).close();
  boolean previousBalance=TEST_UTIL.getHBaseAdmin().setBalancerRunning(false,true);
  Configuration c2=new Configuration(TEST_UTIL.getConfiguration());
  c2.set(HConstants.HBASE_CLIENT_INSTANCE_ID,String.valueOf(-1));
  c2.setInt(HConstants.HBASE_CLIENT_RETRIES_NUMBER,0);
  c2.setInt(HConstants.HBASE_RPC_TIMEOUT_KEY,30 * 1000);
  final Connection connection=ConnectionFactory.createConnection(c2);
  final Table table=connection.getTable(tableName);
  Put p=new Put(FAM_NAM);
  p.addColumn(FAM_NAM,FAM_NAM,FAM_NAM);
  table.put(p);
  final ConnectionImplementation hci=(ConnectionImplementation)connection;
  final HRegionLocation loc;
  try (RegionLocator rl=connection.getRegionLocator(tableName)){
    loc=rl.getRegionLocation(FAM_NAM);
  }
   Get get=new Get(FAM_NAM);
  Assert.assertNotNull(table.get(get));
  get=new Get(FAM_NAM);
  get.setFilter(new BlockingFilter());
  Thread t=new Thread(){
    @Override public void run(){
synchronized (syncBlockingFilter) {
        try {
          syncBlockingFilter.wait();
        }
 catch (        InterruptedException e) {
          throw new RuntimeException(e);
        }
      }
      hci.clusterStatusListener.deadServerHandler.newDead(loc.getServerName());
    }
  }
;
  t.start();
  try {
    table.get(get);
    Assert.fail();
  }
 catch (  IOException expected) {
    LOG.debug("Received: " + expected);
    Assert.assertFalse(expected instanceof SocketTimeoutException);
    Assert.assertFalse(syncBlockingFilter.get());
  }
 finally {
    syncBlockingFilter.set(true);
    t.join();
    TEST_UTIL.getHBaseAdmin().setBalancerRunning(previousBalance,true);
  }
  table.close();
  connection.close();
}

</code></pre>

<pre class="type-4 type-7 type-8 type-13 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMulti() throws Exception {
  Table table=TEST_UTIL.createMultiRegionTable(TABLE_NAME3,FAM_NAM);
  try {
    ConnectionImplementation conn=(ConnectionImplementation)TEST_UTIL.getConnection();
    conn.clearRegionCache(TABLE_NAME3);
    Assert.assertEquals(0,conn.getNumberOfCachedRegionLocations(TABLE_NAME3));
    TEST_UTIL.getHBaseAdmin().setBalancerRunning(false,false);
    HMaster master=TEST_UTIL.getMiniHBaseCluster().getMaster();
    while (master.getAssignmentManager().getRegionStates().isRegionsInTransition()) {
      Thread.sleep(1);
    }
    Put put=new Put(ROW_X);
    put.addColumn(FAM_NAM,ROW_X,ROW_X);
    table.put(put);
    HRegionLocation toMove=conn.getCachedLocation(TABLE_NAME3,ROW_X).getRegionLocation();
    byte[] regionName=toMove.getRegionInfo().getRegionName();
    byte[] encodedRegionNameBytes=toMove.getRegionInfo().getEncodedNameAsBytes();
    int curServerId=TEST_UTIL.getHBaseCluster().getServerWith(regionName);
    int destServerId=(curServerId == 0 ? 1 : 0);
    HRegionServer curServer=TEST_UTIL.getHBaseCluster().getRegionServer(curServerId);
    HRegionServer destServer=TEST_UTIL.getHBaseCluster().getRegionServer(destServerId);
    ServerName destServerName=destServer.getServerName();
    List<Region> regions=curServer.getOnlineRegions(TABLE_NAME3);
    byte[] otherRow=null;
    for (    Region region : regions) {
      if (!region.getRegionInfo().getEncodedName().equals(toMove.getRegionInfo().getEncodedName()) && Bytes.BYTES_COMPARATOR.compare(region.getRegionInfo().getStartKey(),ROW_X) < 0) {
        otherRow=region.getRegionInfo().getStartKey();
        break;
      }
    }
    assertNotNull(otherRow);
    if (otherRow.length <= 0)     otherRow=Bytes.toBytes("aaa");
    Put put2=new Put(otherRow);
    put2.addColumn(FAM_NAM,otherRow,otherRow);
    table.put(put2);
    Assert.assertTrue(curServer != destServer);
    Assert.assertNotEquals(curServer.getServerName(),destServer.getServerName());
    Assert.assertNotEquals(toMove.getPort(),destServerName.getPort());
    Assert.assertNotNull(curServer.getOnlineRegion(regionName));
    Assert.assertNull(destServer.getOnlineRegion(regionName));
    Assert.assertFalse(TEST_UTIL.getMiniHBaseCluster().getMaster().getAssignmentManager().getRegionStates().isRegionsInTransition());
    LOG.info("Move starting region=" + toMove.getRegionInfo().getRegionNameAsString());
    TEST_UTIL.getHBaseAdmin().move(toMove.getRegionInfo().getEncodedNameAsBytes(),destServerName.getServerName().getBytes());
    while (destServer.getOnlineRegion(regionName) == null || destServer.getRegionsInTransitionInRS().containsKey(encodedRegionNameBytes) || curServer.getRegionsInTransitionInRS().containsKey(encodedRegionNameBytes) || master.getAssignmentManager().getRegionStates().isRegionsInTransition()) {
      Thread.sleep(1);
    }
    LOG.info("Move finished for region=" + toMove.getRegionInfo().getRegionNameAsString());
    Assert.assertNull(curServer.getOnlineRegion(regionName));
    Assert.assertNotNull(destServer.getOnlineRegion(regionName));
    Assert.assertFalse(destServer.getRegionsInTransitionInRS().containsKey(encodedRegionNameBytes));
    Assert.assertFalse(curServer.getRegionsInTransitionInRS().containsKey(encodedRegionNameBytes));
    Assert.assertFalse(conn.getCachedLocation(TABLE_NAME3,ROW_X).getRegionLocation().getPort() == destServerName.getPort());
    final int prevNumRetriesVal=setNumTries(conn,2);
    Put put3=new Put(ROW_X);
    put3.addColumn(FAM_NAM,ROW_X,ROW_X);
    Put put4=new Put(otherRow);
    put4.addColumn(FAM_NAM,otherRow,otherRow);
    ArrayList<Put> actions=Lists.newArrayList(put4,put3);
    table.batch(actions,null);
    setNumTries(conn,prevNumRetriesVal);
  }
  finally {
    table.close();
  }
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
