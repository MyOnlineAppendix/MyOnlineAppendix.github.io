<h3 style="margin:0px">Class: org.apache.hadoop.hbase.master.balancer.TestStochasticLoadBalancer (20 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(10)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(6)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(6)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="18"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('18')" data-toggle="tooltip" title="Is not executed with the test suite"><kbd id="tag-18"class="label-info"style="display: inline-block;font-size:7pt" >IgnoredMethod&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testTableSkewCost(){
  Configuration conf=HBaseConfiguration.create();
  StochasticLoadBalancer.CostFunction costFunction=new StochasticLoadBalancer.TableSkewCostFunction(conf);
  for (  int[] mockCluster : clusterStateMocks) {
    BaseLoadBalancer.Cluster cluster=mockCluster(mockCluster);
    costFunction.init(cluster);
    double cost=costFunction.cost();
    assertTrue(cost >= 0);
    assertTrue(cost <= 1.01);
  }
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=800000) public void testMidCluster3(){
  int numNodes=100;
  int numRegions=2000;
  int numRegionsPerServer=9;
  int replication=1;
  int numTables=110;
  testWithCluster(numNodes,numRegions,numRegionsPerServer,replication,numTables,true,true);
}

</code></pre>

<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testReplicaCost(){
  Configuration conf=HBaseConfiguration.create();
  StochasticLoadBalancer.CostFunction costFunction=new StochasticLoadBalancer.RegionReplicaHostCostFunction(conf);
  for (  int[] mockCluster : clusterStateMocks) {
    BaseLoadBalancer.Cluster cluster=mockCluster(mockCluster);
    costFunction.init(cluster);
    double cost=costFunction.cost();
    assertTrue(cost >= 0);
    assertTrue(cost <= 1.01);
  }
}

</code></pre>

<pre class="type-1 type-18 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
- Is not executed with the test suite
"></span><br>
@Ignore @Test(timeout=800000) public void testRegionReplicationOnMidClusterSameHosts(){
  conf.setLong(StochasticLoadBalancer.MAX_STEPS_KEY,2000000L);
  conf.setLong("hbase.master.balancer.stochastic.maxRunningTime",90 * 1000);
  conf.setFloat("hbase.master.balancer.stochastic.maxMovePercent",1.0f);
  loadBalancer.setConf(conf);
  int numHosts=100;
  int numRegions=100 * 100;
  int replication=3;
  int numRegionsPerServer=5;
  int numTables=10;
  Map<ServerName,List<HRegionInfo>> serverMap=createServerMap(numHosts,numRegions,numRegionsPerServer,replication,numTables);
  int numNodesPerHost=4;
  Map<ServerName,List<HRegionInfo>> newServerMap=new TreeMap<ServerName,List<HRegionInfo>>(serverMap);
  for (  Map.Entry<ServerName,List<HRegionInfo>> entry : serverMap.entrySet()) {
    for (int i=1; i < numNodesPerHost; i++) {
      ServerName s1=entry.getKey();
      ServerName s2=ServerName.valueOf(s1.getHostname(),s1.getPort() + i,1);
      newServerMap.put(s2,new ArrayList<HRegionInfo>());
    }
  }
  testWithCluster(newServerMap,null,true,true);
}

</code></pre>

<pre class="type-4 type-9 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKeepRegionLoad() throws Exception {
  ServerName sn=ServerName.valueOf("test:8080",100);
  int numClusterStatusToAdd=20000;
  for (int i=0; i < numClusterStatusToAdd; i++) {
    ServerLoad sl=mock(ServerLoad.class);
    RegionLoad rl=mock(RegionLoad.class);
    when(rl.getStores()).thenReturn(i);
    Map<byte[],RegionLoad> regionLoadMap=new TreeMap<byte[],RegionLoad>(Bytes.BYTES_COMPARATOR);
    regionLoadMap.put(Bytes.toBytes(REGION_KEY),rl);
    when(sl.getRegionsLoad()).thenReturn(regionLoadMap);
    ClusterStatus clusterStatus=mock(ClusterStatus.class);
    when(clusterStatus.getServers()).thenReturn(Arrays.asList(sn));
    when(clusterStatus.getLoad(sn)).thenReturn(sl);
    loadBalancer.setClusterStatus(clusterStatus);
  }
  assertTrue(loadBalancer.loads.get(REGION_KEY) != null);
  assertTrue(loadBalancer.loads.get(REGION_KEY).size() == 15);
  Queue<RegionLoad> loads=loadBalancer.loads.get(REGION_KEY);
  int i=0;
  while (loads.size() > 0) {
    RegionLoad rl=loads.remove();
    assertEquals(i + (numClusterStatusToAdd - 15),rl.getStores());
    i++;
  }
}

</code></pre>

<pre class="type-4 type-13 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
"></span><br>
@Test(timeout=60000) public void testLosingRs() throws Exception {
  int numNodes=3;
  int numRegions=20;
  int numRegionsPerServer=3;
  int replication=1;
  int numTables=2;
  Map<ServerName,List<HRegionInfo>> serverMap=createServerMap(numNodes,numRegions,numRegionsPerServer,replication,numTables);
  List<ServerAndLoad> list=convertToList(serverMap);
  List<RegionPlan> plans=loadBalancer.balanceCluster(serverMap);
  assertNotNull(plans);
  List<ServerAndLoad> balancedCluster=reconcile(list,plans,serverMap);
  assertClusterAsBalanced(balancedCluster);
  ServerName sn=serverMap.keySet().toArray(new ServerName[serverMap.size()])[0];
  ServerName deadSn=ServerName.valueOf(sn.getHostname(),sn.getPort(),sn.getStartcode() - 100);
  serverMap.put(deadSn,new ArrayList<HRegionInfo>(0));
  plans=loadBalancer.balanceCluster(serverMap);
  assertNull(plans);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=60000) public void testSmallCluster(){
  int numNodes=10;
  int numRegions=1000;
  int numRegionsPerServer=40;
  int replication=1;
  int numTables=10;
  testWithCluster(numNodes,numRegions,numRegionsPerServer,replication,numTables,true,true);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=800000) public void testMidCluster2(){
  int numNodes=200;
  int numRegions=100000;
  int numRegionsPerServer=40;
  int replication=1;
  int numTables=400;
  testWithCluster(numNodes,numRegions,numRegionsPerServer,replication,numTables,false,false);
}

</code></pre>

<pre class="type-7 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReplicaCostForReplicas(){
  Configuration conf=HBaseConfiguration.create();
  StochasticLoadBalancer.CostFunction costFunction=new StochasticLoadBalancer.RegionReplicaHostCostFunction(conf);
  int[] servers=new int[]{3,3,3,3,3};
  TreeMap<ServerName,List<HRegionInfo>> clusterState=mockClusterServers(servers);
  BaseLoadBalancer.Cluster cluster;
  cluster=new BaseLoadBalancer.Cluster(clusterState,null,null,null);
  costFunction.init(cluster);
  double costWithoutReplicas=costFunction.cost();
  assertEquals(0,costWithoutReplicas,0);
  HRegionInfo replica1=RegionReplicaUtil.getRegionInfoForReplica(clusterState.firstEntry().getValue().get(0),1);
  clusterState.lastEntry().getValue().add(replica1);
  cluster=new BaseLoadBalancer.Cluster(clusterState,null,null,null);
  costFunction.init(cluster);
  double costWith1ReplicaDifferentServer=costFunction.cost();
  assertEquals(0,costWith1ReplicaDifferentServer,0);
  HRegionInfo replica2=RegionReplicaUtil.getRegionInfoForReplica(replica1,2);
  clusterState.lastEntry().getValue().add(replica2);
  cluster=new BaseLoadBalancer.Cluster(clusterState,null,null,null);
  costFunction.init(cluster);
  double costWith1ReplicaSameServer=costFunction.cost();
  assertTrue(costWith1ReplicaDifferentServer < costWith1ReplicaSameServer);
  HRegionInfo replica3;
  Iterator<Entry<ServerName,List<HRegionInfo>>> it;
  Entry<ServerName,List<HRegionInfo>> entry;
  clusterState=mockClusterServers(servers);
  it=clusterState.entrySet().iterator();
  entry=it.next();
  HRegionInfo hri=entry.getValue().get(0);
  replica1=RegionReplicaUtil.getRegionInfoForReplica(hri,1);
  replica2=RegionReplicaUtil.getRegionInfoForReplica(hri,2);
  replica3=RegionReplicaUtil.getRegionInfoForReplica(hri,3);
  entry.getValue().add(replica1);
  entry.getValue().add(replica2);
  it.next().getValue().add(replica3);
  cluster=new BaseLoadBalancer.Cluster(clusterState,null,null,null);
  costFunction.init(cluster);
  double costWith3ReplicasSameServer=costFunction.cost();
  clusterState=mockClusterServers(servers);
  hri=clusterState.firstEntry().getValue().get(0);
  replica1=RegionReplicaUtil.getRegionInfoForReplica(hri,1);
  replica2=RegionReplicaUtil.getRegionInfoForReplica(hri,2);
  replica3=RegionReplicaUtil.getRegionInfoForReplica(hri,3);
  clusterState.firstEntry().getValue().add(replica1);
  clusterState.lastEntry().getValue().add(replica2);
  clusterState.lastEntry().getValue().add(replica3);
  cluster=new BaseLoadBalancer.Cluster(clusterState,null,null,null);
  costFunction.init(cluster);
  double costWith2ReplicasOnTwoServers=costFunction.cost();
  assertTrue(costWith2ReplicasOnTwoServers < costWith3ReplicasSameServer);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=60000) public void testSmallCluster2(){
  int numNodes=20;
  int numRegions=2000;
  int numRegionsPerServer=40;
  int replication=1;
  int numTables=10;
  testWithCluster(numNodes,numRegions,numRegionsPerServer,replication,numTables,true,true);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=800000) public void testRegionReplicasOnSmallCluster(){
  int numNodes=10;
  int numRegions=1000;
  int replication=3;
  int numRegionsPerServer=80;
  int numTables=10;
  testWithCluster(numNodes,numRegions,numRegionsPerServer,replication,numTables,true,true);
}

</code></pre>

<pre class="type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMoveCost() throws Exception {
  Configuration conf=HBaseConfiguration.create();
  StochasticLoadBalancer.CostFunction costFunction=new StochasticLoadBalancer.MoveCostFunction(conf);
  for (  int[] mockCluster : clusterStateMocks) {
    BaseLoadBalancer.Cluster cluster=mockCluster(mockCluster);
    costFunction.init(cluster);
    double cost=costFunction.cost();
    assertEquals(0.0f,cost,0.001);
    cluster.setNumRegions(200);
    cluster.setNumMovedRegions(10);
    cost=costFunction.cost();
    assertEquals(0.05f,cost,0.001);
    cluster.setNumMovedRegions(100);
    cost=costFunction.cost();
    assertEquals(0.5f,cost,0.001);
    cluster.setNumMovedRegions(200);
    cost=costFunction.cost();
    assertEquals(1.0f,cost,0.001);
    cluster.setNumRegions(10000);
    cluster.setNumMovedRegions(250);
    cost=costFunction.cost();
    assertEquals(0.1f,cost,0.001);
    cluster.setNumMovedRegions(1250);
    cost=costFunction.cost();
    assertEquals(0.5f,cost,0.001);
    cluster.setNumMovedRegions(2500);
    cost=costFunction.cost();
    assertEquals(1.0f,cost,0.01);
  }
}

</code></pre>

<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testNeedsBalanceForColocatedReplicas(){
  List<HRegionInfo> regions=randomRegions(1);
  ServerName s1=ServerName.valueOf("host1",1000,11111);
  ServerName s2=ServerName.valueOf("host11",1000,11111);
  Map<ServerName,List<HRegionInfo>> map=new HashMap<ServerName,List<HRegionInfo>>();
  map.put(s1,regions);
  regions.add(RegionReplicaUtil.getRegionInfoForReplica(regions.get(0),1));
  regions=randomRegions(1);
  map.put(s2,regions);
  assertTrue(loadBalancer.needsBalance(new Cluster(map,null,null,null)));
  map.clear();
  regions=randomRegions(1);
  List<HRegionInfo> regionsOnS2=new ArrayList<HRegionInfo>(1);
  regionsOnS2.add(RegionReplicaUtil.getRegionInfoForReplica(regions.get(0),1));
  map.put(s1,regions);
  map.put(s2,regionsOnS2);
  map.put(ServerName.valueOf("host2",1000,11111),randomRegions(1));
  assertTrue(loadBalancer.needsBalance(new Cluster(map,null,null,new ForTestRackManagerOne())));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=800000) public void testMidCluster(){
  int numNodes=100;
  int numRegions=10000;
  int numRegionsPerServer=60;
  int replication=1;
  int numTables=40;
  testWithCluster(numNodes,numRegions,numRegionsPerServer,replication,numTables,true,true);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=800000) public void testRegionReplicationOnMidClusterWithRacks(){
  conf.setLong(StochasticLoadBalancer.MAX_STEPS_KEY,10000000L);
  conf.setFloat("hbase.master.balancer.stochastic.maxMovePercent",1.0f);
  conf.setLong("hbase.master.balancer.stochastic.maxRunningTime",120 * 1000);
  loadBalancer.setConf(conf);
  int numNodes=30;
  int numRegions=numNodes * 30;
  int replication=3;
  int numRegionsPerServer=28;
  int numTables=10;
  int numRacks=4;
  Map<ServerName,List<HRegionInfo>> serverMap=createServerMap(numNodes,numRegions,numRegionsPerServer,replication,numTables);
  RackManager rm=new ForTestRackManager(numRacks);
  testWithCluster(serverMap,rm,false,true);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testLargeCluster(){
  int numNodes=1000;
  int numRegions=100000;
  int numRegionsPerServer=80;
  int numTables=100;
  int replication=1;
  testWithCluster(numNodes,numRegions,numRegionsPerServer,replication,numTables,true,true);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=60000) public void testSmallCluster3(){
  int numNodes=20;
  int numRegions=2000;
  int numRegionsPerServer=1;
  int replication=1;
  int numTables=10;
  testWithCluster(numNodes,numRegions,numRegionsPerServer,replication,numTables,false,false);
}

</code></pre>

<pre class="type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCostFromArray(){
  Configuration conf=HBaseConfiguration.create();
  StochasticLoadBalancer.CostFromRegionLoadFunction costFunction=new StochasticLoadBalancer.MemstoreSizeCostFunction(conf);
  costFunction.init(mockCluster(new int[]{0,0,0,0,1}));
  double[] statOne=new double[100];
  for (int i=0; i < 100; i++) {
    statOne[i]=10;
  }
  assertEquals(0,costFunction.costFromArray(statOne),0.01);
  double[] statTwo=new double[101];
  for (int i=0; i < 100; i++) {
    statTwo[i]=0;
  }
  statTwo[100]=100;
  assertEquals(1,costFunction.costFromArray(statTwo),0.01);
  double[] statThree=new double[200];
  for (int i=0; i < 100; i++) {
    statThree[i]=(0);
    statThree[i + 100]=100;
  }
  assertEquals(0.5,costFunction.costFromArray(statThree),0.01);
}

</code></pre>

<pre class="type-4 type-13 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
"></span><br>
/** 
 * Test the load balancing algorithm.
 * Invariant is that all servers should be hosting either floor(average) or
 * ceiling(average)
 * @throws Exception
 */
@Test public void testBalanceCluster() throws Exception {
  for (  int[] mockCluster : clusterStateMocks) {
    Map<ServerName,List<HRegionInfo>> servers=mockClusterServers(mockCluster);
    List<ServerAndLoad> list=convertToList(servers);
    LOG.info("Mock Cluster : " + printMock(list) + " "+ printStats(list));
    List<RegionPlan> plans=loadBalancer.balanceCluster(servers);
    List<ServerAndLoad> balancedCluster=reconcile(list,plans,servers);
    LOG.info("Mock Balance : " + printMock(balancedCluster));
    assertClusterAsBalanced(balancedCluster);
    List<RegionPlan> secondPlans=loadBalancer.balanceCluster(servers);
    assertNull(secondPlans);
    for (    Map.Entry<ServerName,List<HRegionInfo>> entry : servers.entrySet()) {
      returnRegions(entry.getValue());
      returnServer(entry.getKey());
    }
  }
}

</code></pre>

<pre class="type-7 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSkewCost(){
  Configuration conf=HBaseConfiguration.create();
  StochasticLoadBalancer.CostFunction costFunction=new StochasticLoadBalancer.RegionCountSkewCostFunction(conf);
  for (  int[] mockCluster : clusterStateMocks) {
    costFunction.init(mockCluster(mockCluster));
    double cost=costFunction.cost();
    assertTrue(cost >= 0);
    assertTrue(cost <= 1.01);
  }
  costFunction.init(mockCluster(new int[]{0,0,0,0,1}));
  assertEquals(0,costFunction.cost(),0.01);
  costFunction.init(mockCluster(new int[]{0,0,0,1,1}));
  assertEquals(0,costFunction.cost(),0.01);
  costFunction.init(mockCluster(new int[]{0,0,1,1,1}));
  assertEquals(0,costFunction.cost(),0.01);
  costFunction.init(mockCluster(new int[]{0,1,1,1,1}));
  assertEquals(0,costFunction.cost(),0.01);
  costFunction.init(mockCluster(new int[]{1,1,1,1,1}));
  assertEquals(0,costFunction.cost(),0.01);
  costFunction.init(mockCluster(new int[]{10000,0,0,0,0}));
  assertEquals(1,costFunction.cost(),0.01);
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
