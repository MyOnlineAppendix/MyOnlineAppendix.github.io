<h3 style="margin:0px">Class: org.apache.hadoop.hbase.namespace.TestNamespaceAuditor (14 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(11)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(10)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(10)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(8)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(7)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(2)</kbd></button>&nbsp;<button id="17"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('17')" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution"><kbd id="tag-17"class="label-info"style="display: inline-block;font-size:7pt" >ExceptionVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(2)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testValidQuotas() throws Exception {
  boolean exceptionCaught=false;
  FileSystem fs=UTIL.getHBaseCluster().getMaster().getMasterFileSystem().getFileSystem();
  Path rootDir=UTIL.getHBaseCluster().getMaster().getMasterFileSystem().getRootDir();
  NamespaceDescriptor nspDesc=NamespaceDescriptor.create(prefix + "vq1").addConfiguration(TableNamespaceManager.KEY_MAX_REGIONS,"hihdufh").addConfiguration(TableNamespaceManager.KEY_MAX_TABLES,"2").build();
  try {
    ADMIN.createNamespace(nspDesc);
  }
 catch (  Exception exp) {
    LOG.warn(exp);
    exceptionCaught=true;
  }
 finally {
    assertTrue(exceptionCaught);
    assertFalse(fs.exists(FSUtils.getNamespaceDir(rootDir,nspDesc.getName())));
  }
  nspDesc=NamespaceDescriptor.create(prefix + "vq2").addConfiguration(TableNamespaceManager.KEY_MAX_REGIONS,"-456").addConfiguration(TableNamespaceManager.KEY_MAX_TABLES,"2").build();
  try {
    ADMIN.createNamespace(nspDesc);
  }
 catch (  Exception exp) {
    LOG.warn(exp);
    exceptionCaught=true;
  }
 finally {
    assertTrue(exceptionCaught);
    assertFalse(fs.exists(FSUtils.getNamespaceDir(rootDir,nspDesc.getName())));
  }
  nspDesc=NamespaceDescriptor.create(prefix + "vq3").addConfiguration(TableNamespaceManager.KEY_MAX_REGIONS,"10").addConfiguration(TableNamespaceManager.KEY_MAX_TABLES,"sciigd").build();
  try {
    ADMIN.createNamespace(nspDesc);
  }
 catch (  Exception exp) {
    LOG.warn(exp);
    exceptionCaught=true;
  }
 finally {
    assertTrue(exceptionCaught);
    assertFalse(fs.exists(FSUtils.getNamespaceDir(rootDir,nspDesc.getName())));
  }
  nspDesc=NamespaceDescriptor.create(prefix + "vq4").addConfiguration(TableNamespaceManager.KEY_MAX_REGIONS,"10").addConfiguration(TableNamespaceManager.KEY_MAX_TABLES,"-1500").build();
  try {
    ADMIN.createNamespace(nspDesc);
  }
 catch (  Exception exp) {
    LOG.warn(exp);
    exceptionCaught=true;
  }
 finally {
    assertTrue(exceptionCaught);
    assertFalse(fs.exists(FSUtils.getNamespaceDir(rootDir,nspDesc.getName())));
  }
}

</code></pre>

<pre class="type-4 type-7 type-13 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRestoreSnapshot() throws Exception {
  String nsp=prefix + "_testRestoreSnapshot";
  NamespaceDescriptor nspDesc=NamespaceDescriptor.create(nsp).addConfiguration(TableNamespaceManager.KEY_MAX_REGIONS,"10").build();
  ADMIN.createNamespace(nspDesc);
  assertNotNull("Namespace descriptor found null.",ADMIN.getNamespaceDescriptor(nsp));
  TableName tableName1=TableName.valueOf(nsp + TableName.NAMESPACE_DELIM + "table1");
  HTableDescriptor tableDescOne=new HTableDescriptor(tableName1);
  ADMIN.createTable(tableDescOne,Bytes.toBytes("AAA"),Bytes.toBytes("ZZZ"),4);
  NamespaceTableAndRegionInfo nstate=getNamespaceState(nsp);
  assertEquals("Intial region count should be 4.",4,nstate.getRegionCount());
  String snapshot="snapshot_testRestoreSnapshot";
  ADMIN.snapshot(snapshot,tableName1);
  List<HRegionInfo> regions=ADMIN.getTableRegions(tableName1);
  Collections.sort(regions);
  ADMIN.split(tableName1,Bytes.toBytes("JJJ"));
  Thread.sleep(2000);
  assertEquals("Total regions count should be 5.",5,nstate.getRegionCount());
  ADMIN.disableTable(tableName1);
  ADMIN.restoreSnapshot(snapshot);
  assertEquals("Total regions count should be 4 after restore.",4,nstate.getRegionCount());
  ADMIN.enableTable(tableName1);
  ADMIN.deleteSnapshot(snapshot);
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@AfterClass public static void tearDown() throws Exception {
  UTIL.shutdownMiniCluster();
}

</code></pre>

<pre class="type-7 type-13 type-17 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(expected=QuotaExceededException.class) public void testCloneSnapshotQuotaExceed() throws Exception {
  String nsp=prefix + "_testTableQuotaExceedWithCloneSnapshot";
  NamespaceDescriptor nspDesc=NamespaceDescriptor.create(nsp).addConfiguration(TableNamespaceManager.KEY_MAX_TABLES,"1").build();
  ADMIN.createNamespace(nspDesc);
  assertNotNull("Namespace descriptor found null.",ADMIN.getNamespaceDescriptor(nsp));
  TableName tableName=TableName.valueOf(nsp + TableName.NAMESPACE_DELIM + "table1");
  TableName cloneTableName=TableName.valueOf(nsp + TableName.NAMESPACE_DELIM + "table2");
  HTableDescriptor tableDescOne=new HTableDescriptor(tableName);
  ADMIN.createTable(tableDescOne);
  String snapshot="snapshot_testTableQuotaExceedWithCloneSnapshot";
  ADMIN.snapshot(snapshot,tableName);
  ADMIN.cloneSnapshot(snapshot,cloneTableName);
  ADMIN.deleteSnapshot(snapshot);
}

</code></pre>

<pre class="type-7 type-13 type-5 type-17 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(expected=QuotaExceededException.class) public void testExceedTableQuotaInNamespace() throws Exception {
  String nsp=prefix + "_testExceedTableQuotaInNamespace";
  NamespaceDescriptor nspDesc=NamespaceDescriptor.create(nsp).addConfiguration(TableNamespaceManager.KEY_MAX_TABLES,"1").build();
  ADMIN.createNamespace(nspDesc);
  assertNotNull("Namespace descriptor found null.",ADMIN.getNamespaceDescriptor(nsp));
  assertEquals(ADMIN.listNamespaceDescriptors().length,3);
  HTableDescriptor tableDescOne=new HTableDescriptor(TableName.valueOf(nsp + TableName.NAMESPACE_DELIM + "table1"));
  HTableDescriptor tableDescTwo=new HTableDescriptor(TableName.valueOf(nsp + TableName.NAMESPACE_DELIM + "table2"));
  ADMIN.createTable(tableDescOne);
  ADMIN.createTable(tableDescTwo,Bytes.toBytes("AAA"),Bytes.toBytes("ZZZ"),4);
}

</code></pre>

<pre class="type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRegionMerge() throws Exception {
  String nsp1=prefix + "_regiontest";
  NamespaceDescriptor nspDesc=NamespaceDescriptor.create(nsp1).addConfiguration(TableNamespaceManager.KEY_MAX_REGIONS,"3").addConfiguration(TableNamespaceManager.KEY_MAX_TABLES,"2").build();
  ADMIN.createNamespace(nspDesc);
  final TableName tableTwo=TableName.valueOf(nsp1 + TableName.NAMESPACE_DELIM + "table2");
  byte[] columnFamily=Bytes.toBytes("info");
  HTableDescriptor tableDescOne=new HTableDescriptor(tableTwo);
  tableDescOne.addFamily(new HColumnDescriptor(columnFamily));
  final int initialRegions=3;
  ADMIN.createTable(tableDescOne,Bytes.toBytes("1"),Bytes.toBytes("2000"),initialRegions);
  Connection connection=ConnectionFactory.createConnection(UTIL.getConfiguration());
  try (Table table=connection.getTable(tableTwo)){
    UTIL.loadNumericRows(table,Bytes.toBytes("info"),1000,1999);
  }
   ADMIN.flush(tableTwo);
  List<HRegionInfo> hris=ADMIN.getTableRegions(tableTwo);
  Collections.sort(hris);
  final Set<String> encodedRegionNamesToMerge=Sets.newHashSet(hris.get(0).getEncodedName(),hris.get(1).getEncodedName());
  ADMIN.mergeRegions(hris.get(0).getEncodedNameAsBytes(),hris.get(1).getEncodedNameAsBytes(),false);
  UTIL.waitFor(10000,100,new Waiter.ExplainingPredicate<Exception>(){
    @Override public boolean evaluate() throws Exception {
      RegionStates regionStates=UTIL.getMiniHBaseCluster().getMaster().getAssignmentManager().getRegionStates();
      for (      HRegionInfo hri : ADMIN.getTableRegions(tableTwo)) {
        if (encodedRegionNamesToMerge.contains(hri.getEncodedName())) {
          return false;
        }
        if (!regionStates.isRegionInState(hri,RegionState.State.OPEN)) {
          return false;
        }
      }
      return true;
    }
    @Override public String explainFailure() throws Exception {
      RegionStates regionStates=UTIL.getMiniHBaseCluster().getMaster().getAssignmentManager().getRegionStates();
      for (      HRegionInfo hri : ADMIN.getTableRegions(tableTwo)) {
        if (encodedRegionNamesToMerge.contains(hri.getEncodedName())) {
          return hri + " which is expected to be merged is still online";
        }
        if (!regionStates.isRegionInState(hri,RegionState.State.OPEN)) {
          return hri + " is still in not opened";
        }
      }
      return "Unknown";
    }
  }
);
  hris=ADMIN.getTableRegions(tableTwo);
  assertEquals(initialRegions - 1,hris.size());
  Collections.sort(hris);
  final HRegionInfo hriToSplit=hris.get(1);
  ADMIN.split(tableTwo,Bytes.toBytes("500"));
  UTIL.waitFor(10000,100,new Waiter.ExplainingPredicate<Exception>(){
    @Override public boolean evaluate() throws Exception {
      RegionStates regionStates=UTIL.getMiniHBaseCluster().getMaster().getAssignmentManager().getRegionStates();
      for (      HRegionInfo hri : ADMIN.getTableRegions(tableTwo)) {
        if (hri.getEncodedName().equals(hriToSplit.getEncodedName())) {
          return false;
        }
        if (!regionStates.isRegionInState(hri,RegionState.State.OPEN)) {
          return false;
        }
      }
      return true;
    }
    @Override public String explainFailure() throws Exception {
      RegionStates regionStates=UTIL.getMiniHBaseCluster().getMaster().getAssignmentManager().getRegionStates();
      for (      HRegionInfo hri : ADMIN.getTableRegions(tableTwo)) {
        if (hri.getEncodedName().equals(hriToSplit.getEncodedName())) {
          return hriToSplit + " which is expected to be split is still online";
        }
        if (!regionStates.isRegionInState(hri,RegionState.State.OPEN)) {
          return hri + " is still in not opened";
        }
      }
      return "Unknown";
    }
  }
);
  hris=ADMIN.getTableRegions(tableTwo);
  assertEquals(initialRegions,hris.size());
  Collections.sort(hris);
  MiniHBaseCluster cluster=UTIL.getHBaseCluster();
  HRegionServer regionServer=cluster.getRegionServer(0);
  RegionServerCoprocessorHost cpHost=regionServer.getRegionServerCoprocessorHost();
  Coprocessor coprocessor=cpHost.findCoprocessor(CPRegionServerObserver.class.getName());
  CPRegionServerObserver regionServerObserver=(CPRegionServerObserver)coprocessor;
  regionServerObserver.failMerge(true);
  regionServerObserver.triggered=false;
  ADMIN.mergeRegions(hris.get(1).getEncodedNameAsBytes(),hris.get(2).getEncodedNameAsBytes(),false);
  regionServerObserver.waitUtilTriggered();
  hris=ADMIN.getTableRegions(tableTwo);
  assertEquals(initialRegions,hris.size());
  Collections.sort(hris);
  HRegionInfo hriToSplit2=hris.get(1);
  ADMIN.split(tableTwo,TableInputFormatBase.getSplitKey(hriToSplit2.getStartKey(),hriToSplit2.getEndKey(),true));
  Thread.sleep(2000);
  assertEquals(initialRegions,ADMIN.getTableRegions(tableTwo).size());
}

</code></pre>

<pre class="type-4 type-7 type-13 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCloneSnapshot() throws Exception {
  String nsp=prefix + "_testCloneSnapshot";
  NamespaceDescriptor nspDesc=NamespaceDescriptor.create(nsp).addConfiguration(TableNamespaceManager.KEY_MAX_TABLES,"2").addConfiguration(TableNamespaceManager.KEY_MAX_REGIONS,"20").build();
  ADMIN.createNamespace(nspDesc);
  assertNotNull("Namespace descriptor found null.",ADMIN.getNamespaceDescriptor(nsp));
  TableName tableName=TableName.valueOf(nsp + TableName.NAMESPACE_DELIM + "table1");
  TableName cloneTableName=TableName.valueOf(nsp + TableName.NAMESPACE_DELIM + "table2");
  HTableDescriptor tableDescOne=new HTableDescriptor(tableName);
  ADMIN.createTable(tableDescOne,Bytes.toBytes("AAA"),Bytes.toBytes("ZZZ"),4);
  String snapshot="snapshot_testCloneSnapshot";
  ADMIN.snapshot(snapshot,tableName);
  ADMIN.cloneSnapshot(snapshot,cloneTableName);
  int tableLength;
  try (RegionLocator locator=ADMIN.getConnection().getRegionLocator(tableName)){
    tableLength=locator.getStartKeys().length;
  }
   assertEquals(tableName.getNameAsString() + " should have four regions.",4,tableLength);
  try (RegionLocator locator=ADMIN.getConnection().getRegionLocator(cloneTableName)){
    tableLength=locator.getStartKeys().length;
  }
   assertEquals(cloneTableName.getNameAsString() + " should have four regions.",4,tableLength);
  NamespaceTableAndRegionInfo nstate=getNamespaceState(nsp);
  assertEquals("Total tables count should be 2.",2,nstate.getTables().size());
  assertEquals("Total regions count should be.",8,nstate.getRegionCount());
  ADMIN.deleteSnapshot(snapshot);
}

</code></pre>

<pre class="type-7 type-8 type-13 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTableOperations() throws Exception {
  String nsp=prefix + "_np2";
  NamespaceDescriptor nspDesc=NamespaceDescriptor.create(nsp).addConfiguration(TableNamespaceManager.KEY_MAX_REGIONS,"5").addConfiguration(TableNamespaceManager.KEY_MAX_TABLES,"2").build();
  ADMIN.createNamespace(nspDesc);
  assertNotNull("Namespace descriptor found null.",ADMIN.getNamespaceDescriptor(nsp));
  assertEquals(ADMIN.listNamespaceDescriptors().length,3);
  HTableDescriptor tableDescOne=new HTableDescriptor(TableName.valueOf(nsp + TableName.NAMESPACE_DELIM + "table1"));
  HTableDescriptor tableDescTwo=new HTableDescriptor(TableName.valueOf(nsp + TableName.NAMESPACE_DELIM + "table2"));
  HTableDescriptor tableDescThree=new HTableDescriptor(TableName.valueOf(nsp + TableName.NAMESPACE_DELIM + "table3"));
  ADMIN.createTable(tableDescOne);
  boolean constraintViolated=false;
  try {
    ADMIN.createTable(tableDescTwo,Bytes.toBytes("AAA"),Bytes.toBytes("ZZZ"),5);
  }
 catch (  Exception exp) {
    assertTrue(exp instanceof IOException);
    constraintViolated=true;
  }
 finally {
    assertTrue("Constraint not violated for table " + tableDescTwo.getTableName(),constraintViolated);
  }
  ADMIN.createTable(tableDescTwo,Bytes.toBytes("AAA"),Bytes.toBytes("ZZZ"),4);
  NamespaceTableAndRegionInfo nspState=getQuotaManager().getState(nsp);
  assertNotNull(nspState);
  assertTrue(nspState.getTables().size() == 2);
  assertTrue(nspState.getRegionCount() == 5);
  constraintViolated=false;
  try {
    ADMIN.createTable(tableDescThree);
  }
 catch (  Exception exp) {
    assertTrue(exp instanceof IOException);
    constraintViolated=true;
  }
 finally {
    assertTrue("Constraint not violated for table " + tableDescThree.getTableName(),constraintViolated);
  }
}

</code></pre>

<pre class="type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testStatePreserve() throws Exception {
  final String nsp1=prefix + "_testStatePreserve";
  NamespaceDescriptor nspDesc=NamespaceDescriptor.create(nsp1).addConfiguration(TableNamespaceManager.KEY_MAX_REGIONS,"20").addConfiguration(TableNamespaceManager.KEY_MAX_TABLES,"10").build();
  ADMIN.createNamespace(nspDesc);
  TableName tableOne=TableName.valueOf(nsp1 + TableName.NAMESPACE_DELIM + "table1");
  TableName tableTwo=TableName.valueOf(nsp1 + TableName.NAMESPACE_DELIM + "table2");
  TableName tableThree=TableName.valueOf(nsp1 + TableName.NAMESPACE_DELIM + "table3");
  HTableDescriptor tableDescOne=new HTableDescriptor(tableOne);
  HTableDescriptor tableDescTwo=new HTableDescriptor(tableTwo);
  HTableDescriptor tableDescThree=new HTableDescriptor(tableThree);
  ADMIN.createTable(tableDescOne,Bytes.toBytes("1"),Bytes.toBytes("1000"),3);
  ADMIN.createTable(tableDescTwo,Bytes.toBytes("1"),Bytes.toBytes("1000"),3);
  ADMIN.createTable(tableDescThree,Bytes.toBytes("1"),Bytes.toBytes("1000"),4);
  ADMIN.disableTable(tableThree);
  deleteTable(tableThree);
  UTIL.waitFor(1000,new Waiter.Predicate<Exception>(){
    @Override public boolean evaluate() throws Exception {
      return (getNamespaceState(nsp1).getTables().size() == 2);
    }
  }
);
  NamespaceTableAndRegionInfo before=getNamespaceState(nsp1);
  restartMaster();
  NamespaceTableAndRegionInfo after=getNamespaceState(nsp1);
  assertEquals("Expected: " + before.getTables() + " Found: "+ after.getTables(),before.getTables().size(),after.getTables().size());
}

</code></pre>

<pre class="type-4 type-11 type-7 type-13 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRestoreSnapshotQuotaExceed() throws Exception {
  String nsp=prefix + "_testRestoreSnapshotQuotaExceed";
  NamespaceDescriptor nspDesc=NamespaceDescriptor.create(nsp).addConfiguration(TableNamespaceManager.KEY_MAX_REGIONS,"10").build();
  ADMIN.createNamespace(nspDesc);
  NamespaceDescriptor ndesc=ADMIN.getNamespaceDescriptor(nsp);
  assertNotNull("Namespace descriptor found null.",ndesc);
  TableName tableName1=TableName.valueOf(nsp + TableName.NAMESPACE_DELIM + "table1");
  HTableDescriptor tableDescOne=new HTableDescriptor(tableName1);
  ADMIN.createTable(tableDescOne,Bytes.toBytes("AAA"),Bytes.toBytes("ZZZ"),4);
  NamespaceTableAndRegionInfo nstate=getNamespaceState(nsp);
  assertEquals("Intial region count should be 4.",4,nstate.getRegionCount());
  String snapshot="snapshot_testRestoreSnapshotQuotaExceed";
  ADMIN.snapshot(snapshot,tableName1);
  List<HRegionInfo> regions=ADMIN.getTableRegions(tableName1);
  Collections.sort(regions);
  ADMIN.split(tableName1,Bytes.toBytes("JJJ"));
  Thread.sleep(2000);
  assertEquals("Total regions count should be 5.",5,nstate.getRegionCount());
  ndesc.setConfiguration(TableNamespaceManager.KEY_MAX_REGIONS,"2");
  ADMIN.modifyNamespace(ndesc);
  ADMIN.disableTable(tableName1);
  try {
    ADMIN.restoreSnapshot(snapshot);
    fail("Region quota is exceeded so QuotaExceededException should be thrown but HBaseAdmin" + " wraps IOException into RestoreSnapshotException");
  }
 catch (  RestoreSnapshotException ignore) {
  }
  ADMIN.enableTable(tableName1);
  ADMIN.deleteSnapshot(snapshot);
}

</code></pre>

<pre class="type-4 type-7 type-13 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeleteTable() throws Exception {
  String namespace=prefix + "_dummy";
  NamespaceDescriptor nspDesc=NamespaceDescriptor.create(namespace).addConfiguration(TableNamespaceManager.KEY_MAX_REGIONS,"100").addConfiguration(TableNamespaceManager.KEY_MAX_TABLES,"3").build();
  ADMIN.createNamespace(nspDesc);
  assertNotNull("Namespace descriptor found null.",ADMIN.getNamespaceDescriptor(namespace));
  NamespaceTableAndRegionInfo stateInfo=getNamespaceState(nspDesc.getName());
  assertNotNull("Namespace state found null for " + namespace,stateInfo);
  HTableDescriptor tableDescOne=new HTableDescriptor(TableName.valueOf(namespace + TableName.NAMESPACE_DELIM + "table1"));
  HTableDescriptor tableDescTwo=new HTableDescriptor(TableName.valueOf(namespace + TableName.NAMESPACE_DELIM + "table2"));
  ADMIN.createTable(tableDescOne);
  ADMIN.createTable(tableDescTwo,Bytes.toBytes("AAA"),Bytes.toBytes("ZZZ"),5);
  stateInfo=getNamespaceState(nspDesc.getName());
  assertNotNull("Namespace state found to be null.",stateInfo);
  assertEquals(2,stateInfo.getTables().size());
  assertEquals(5,stateInfo.getRegionCountOfTable(tableDescTwo.getTableName()));
  assertEquals(6,stateInfo.getRegionCount());
  ADMIN.disableTable(tableDescOne.getTableName());
  deleteTable(tableDescOne.getTableName());
  stateInfo=getNamespaceState(nspDesc.getName());
  assertNotNull("Namespace state found to be null.",stateInfo);
  assertEquals(5,stateInfo.getRegionCount());
  assertEquals(1,stateInfo.getTables().size());
  ADMIN.disableTable(tableDescTwo.getTableName());
  deleteTable(tableDescTwo.getTableName());
  ADMIN.deleteNamespace(namespace);
  stateInfo=getNamespaceState(namespace);
  assertNull("Namespace state not found to be null.",stateInfo);
}

</code></pre>

<pre class="type-4 type-7 type-8 type-13 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRegionOperations() throws Exception {
  String nsp1=prefix + "_regiontest";
  NamespaceDescriptor nspDesc=NamespaceDescriptor.create(nsp1).addConfiguration(TableNamespaceManager.KEY_MAX_REGIONS,"2").addConfiguration(TableNamespaceManager.KEY_MAX_TABLES,"2").build();
  ADMIN.createNamespace(nspDesc);
  boolean constraintViolated=false;
  final TableName tableOne=TableName.valueOf(nsp1 + TableName.NAMESPACE_DELIM + "table1");
  byte[] columnFamily=Bytes.toBytes("info");
  HTableDescriptor tableDescOne=new HTableDescriptor(tableOne);
  tableDescOne.addFamily(new HColumnDescriptor(columnFamily));
  NamespaceTableAndRegionInfo stateInfo;
  try {
    ADMIN.createTable(tableDescOne,Bytes.toBytes("1"),Bytes.toBytes("1000"),7);
  }
 catch (  Exception exp) {
    assertTrue(exp instanceof DoNotRetryIOException);
    LOG.info(exp);
    constraintViolated=true;
  }
 finally {
    assertTrue(constraintViolated);
  }
  assertFalse(ADMIN.tableExists(tableOne));
  ADMIN.createTable(tableDescOne);
  Connection connection=ConnectionFactory.createConnection(UTIL.getConfiguration());
  Table htable=connection.getTable(tableOne);
  UTIL.loadNumericRows(htable,Bytes.toBytes("info"),1,1000);
  ADMIN.flush(tableOne);
  stateInfo=getNamespaceState(nsp1);
  assertEquals(1,stateInfo.getTables().size());
  assertEquals(1,stateInfo.getRegionCount());
  restartMaster();
  HRegion actualRegion=UTIL.getHBaseCluster().getRegions(tableOne).get(0);
  CustomObserver observer=(CustomObserver)actualRegion.getCoprocessorHost().findCoprocessor(CustomObserver.class.getName());
  assertNotNull(observer);
  ADMIN.split(tableOne,Bytes.toBytes("500"));
  observer.postSplit.await();
  assertEquals(2,ADMIN.getTableRegions(tableOne).size());
  actualRegion=UTIL.getHBaseCluster().getRegions(tableOne).get(0);
  observer=(CustomObserver)actualRegion.getCoprocessorHost().findCoprocessor(CustomObserver.class.getName());
  assertNotNull(observer);
  ADMIN.compact(tableOne);
  observer.postCompact.await();
  ADMIN.split(tableOne,getSplitKey(actualRegion.getRegionInfo().getStartKey(),actualRegion.getRegionInfo().getEndKey()));
  observer.postSplit.await();
  List<HRegionInfo> hris=ADMIN.getTableRegions(tableOne);
  assertEquals(2,hris.size());
  assertTrue("split completed",observer.preSplitBeforePONR.getCount() == 1);
  htable.close();
}

</code></pre>

<pre class="type-3 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@After public void cleanup() throws Exception, KeeperException {
  for (  HTableDescriptor table : ADMIN.listTables()) {
    ADMIN.disableTable(table.getTableName());
    deleteTable(table.getTableName());
  }
  for (  NamespaceDescriptor ns : ADMIN.listNamespaceDescriptors()) {
    if (ns.getName().startsWith(prefix)) {
      ADMIN.deleteNamespace(ns.getName());
    }
  }
  assertTrue("Quota manager not enabled",UTIL.getHBaseCluster().getMaster().getMasterQuotaManager().isQuotaEnabled());
}

</code></pre>

<pre class="type-4 type-11 type-7 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRecreateTableWithSameNameAfterFirstTimeFailure() throws Exception {
  String nsp1=prefix + "_testRecreateTable";
  NamespaceDescriptor nspDesc=NamespaceDescriptor.create(nsp1).addConfiguration(TableNamespaceManager.KEY_MAX_REGIONS,"20").addConfiguration(TableNamespaceManager.KEY_MAX_TABLES,"1").build();
  ADMIN.createNamespace(nspDesc);
  final TableName tableOne=TableName.valueOf(nsp1 + TableName.NAMESPACE_DELIM + "table1");
  byte[] columnFamily=Bytes.toBytes("info");
  HTableDescriptor tableDescOne=new HTableDescriptor(tableOne);
  tableDescOne.addFamily(new HColumnDescriptor(columnFamily));
  MasterSyncObserver.throwExceptionInPreCreateTableHandler=true;
  try {
    try {
      ADMIN.createTable(tableDescOne);
      fail("Table " + tableOne.toString() + "creation should fail.");
    }
 catch (    Exception exp) {
      LOG.error(exp);
    }
    assertFalse(ADMIN.tableExists(tableOne));
    NamespaceTableAndRegionInfo nstate=getNamespaceState(nsp1);
    assertEquals("First table creation failed in namespace so number of tables in namespace " + "should be 0.",0,nstate.getTables().size());
    MasterSyncObserver.throwExceptionInPreCreateTableHandler=false;
    try {
      ADMIN.createTable(tableDescOne);
    }
 catch (    Exception e) {
      fail("Table " + tableOne.toString() + "creation should succeed.");
      LOG.error(e);
    }
    assertTrue(ADMIN.tableExists(tableOne));
    nstate=getNamespaceState(nsp1);
    assertEquals("First table was created successfully so table size in namespace should " + "be one now.",1,nstate.getTables().size());
  }
  finally {
    MasterSyncObserver.throwExceptionInPreCreateTableHandler=false;
    if (ADMIN.tableExists(tableOne)) {
      ADMIN.disableTable(tableOne);
      deleteTable(tableOne);
    }
    ADMIN.deleteNamespace(nsp1);
  }
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
