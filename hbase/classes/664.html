<h3 style="margin:0px">Class: org.apache.hadoop.hbase.snapshot.TestExportSnapshot (12 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(6)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(2)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testEmptyExportFileSystemState() throws Exception {
  testExportFileSystemState(tableName,emptySnapshotName,emptySnapshotName,0);
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Check that ExportSnapshot will return a failure if something fails.
 */
@Test public void testExportFailure() throws Exception {
  assertEquals(1,runExportAndInjectFailures(snapshotName,false));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testExportWithTargetName() throws Exception {
  final byte[] targetName=Bytes.toBytes("testExportWithTargetName");
  testExportFileSystemState(tableName,snapshotName,targetName,tableNumFiles);
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Check that ExportSnapshot will succede if something fails but the retry succede.
 */
@Test public void testExportRetry() throws Exception {
  assertEquals(0,runExportAndInjectFailures(snapshotName,true));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testExportFileSystemStateWithSkipTmp() throws Exception {
  TEST_UTIL.getConfiguration().setBoolean(ExportSnapshot.CONF_SKIP_TMP,true);
  testExportFileSystemState(tableName,snapshotName,snapshotName,tableNumFiles);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testConsecutiveExports() throws Exception {
  Path copyDir=getLocalDestinationDir();
  testExportFileSystemState(tableName,snapshotName,snapshotName,tableNumFiles,copyDir,false);
  testExportFileSystemState(tableName,snapshotName,snapshotName,tableNumFiles,copyDir,true);
  removeExportDir(copyDir);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Verify if exported snapshot and copied files matches the original one.
 */
@Test public void testExportFileSystemState() throws Exception {
  testExportFileSystemState(tableName,snapshotName,snapshotName,tableNumFiles);
}

</code></pre>

<pre class="type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Verfy the result of getBalanceSplits() method.
 * The result are groups of files, used as input list for the "export" mappers.
 * All the groups should have similar amount of data.
 * The input list is a pair of file path and length.
 * The getBalanceSplits() function sort it by length,
 * and assign to each group a file, going back and forth through the groups.
 */
@Test public void testBalanceSplit() throws Exception {
  List<Pair<SnapshotFileInfo,Long>> files=new ArrayList<Pair<SnapshotFileInfo,Long>>();
  for (long i=0; i <= 20; i++) {
    SnapshotFileInfo fileInfo=SnapshotFileInfo.newBuilder().setType(SnapshotFileInfo.Type.HFILE).setHfile("file-" + i).build();
    files.add(new Pair<SnapshotFileInfo,Long>(fileInfo,i));
  }
  List<List<Pair<SnapshotFileInfo,Long>>> splits=ExportSnapshot.getBalancedSplits(files,5);
  assertEquals(5,splits.size());
  String[] split0=new String[]{"file-20","file-11","file-10","file-1","file-0"};
  verifyBalanceSplit(splits.get(0),split0,42);
  String[] split1=new String[]{"file-19","file-12","file-9","file-2"};
  verifyBalanceSplit(splits.get(1),split1,42);
  String[] split2=new String[]{"file-18","file-13","file-8","file-3"};
  verifyBalanceSplit(splits.get(2),split2,42);
  String[] split3=new String[]{"file-17","file-14","file-7","file-4"};
  verifyBalanceSplit(splits.get(3),split3,42);
  String[] split4=new String[]{"file-16","file-15","file-6","file-5"};
  verifyBalanceSplit(splits.get(4),split4,42);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Mock a snapshot with files in the archive dir,
 * two regions, and one reference file.
 */
@Test public void testSnapshotWithRefsExportFileSystemState() throws Exception {
  Configuration conf=TEST_UTIL.getConfiguration();
  Path rootDir=TEST_UTIL.getHBaseCluster().getMaster().getMasterFileSystem().getRootDir();
  FileSystem fs=TEST_UTIL.getHBaseCluster().getMaster().getMasterFileSystem().getFileSystem();
  SnapshotMock snapshotMock=new SnapshotMock(TEST_UTIL.getConfiguration(),fs,rootDir);
  SnapshotMock.SnapshotBuilder builder=snapshotMock.createSnapshotV2("tableWithRefsV1","tableWithRefsV1");
  testSnapshotWithRefsExportFileSystemState(builder);
  snapshotMock=new SnapshotMock(TEST_UTIL.getConfiguration(),fs,rootDir);
  builder=snapshotMock.createSnapshotV2("tableWithRefsV2","tableWithRefsV2");
  testSnapshotWithRefsExportFileSystemState(builder);
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@AfterClass public static void tearDownAfterClass() throws Exception {
  TEST_UTIL.shutdownMiniMapReduceCluster();
  TEST_UTIL.shutdownMiniCluster();
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
/** 
 * Create a table and take a snapshot of the table used by the export test.
 */
@Before public void setUp() throws Exception {
  this.admin=TEST_UTIL.getHBaseAdmin();
  long tid=System.currentTimeMillis();
  tableName=TableName.valueOf("testtb-" + tid);
  snapshotName=Bytes.toBytes("snaptb0-" + tid);
  emptySnapshotName=Bytes.toBytes("emptySnaptb0-" + tid);
  createTable();
  admin.snapshot(emptySnapshotName,tableName);
  SnapshotTestingUtils.loadData(TEST_UTIL,tableName,50,FAMILY);
  tableNumFiles=admin.getTableRegions(tableName).size();
  admin.snapshot(snapshotName,tableName);
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void tearDown() throws Exception {
  TEST_UTIL.deleteTable(tableName);
  SnapshotTestingUtils.deleteAllSnapshots(TEST_UTIL.getHBaseAdmin());
  SnapshotTestingUtils.deleteArchiveDirectory(TEST_UTIL);
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
