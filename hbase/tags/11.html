<h3><span class=" glyphicon glyphicon-tag"/>&nbspUtilityVerifier</h3><kbd>Verifies (un)successful execution of the test case by reporting explicitly a failure</kbd><br><br><br><h4 style="margin:0px">Class: org.apache.hadoop.hbase.IntegrationTestManyRegions </h4><pre class="type-10 type-11 type-7 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateTableWithRegions() throws Exception {
  CountDownLatch doneSignal=new CountDownLatch(1);
  Worker worker=new Worker(doneSignal,util.getHBaseAdmin());
  Thread t=new Thread(worker);
  LOG.info("Launching worker thread to create the table.");
  t.start();
  boolean workerComplete=false;
  workerComplete=doneSignal.await(TIMEOUT_MINUTES,TimeUnit.MINUTES);
  if (!workerComplete) {
    t.interrupt();
    fail("Timeout limit expired.");
  }
  assertTrue("Table creation failed.",worker.isSuccess());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.TestCompoundConfiguration </h4><pre class="type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBasicFunctionality() throws ClassNotFoundException {
  CompoundConfiguration compoundConf=new CompoundConfiguration().add(baseConf);
  assertEquals("1",compoundConf.get("A"));
  assertEquals(2,compoundConf.getInt("B",0));
  assertEquals(3,compoundConf.getInt("C",0));
  assertEquals(0,compoundConf.getInt("D",0));
  assertEquals(CompoundConfiguration.class,compoundConf.getClassByName(CompoundConfiguration.class.getName()));
  try {
    compoundConf.getClassByName("bad_class_name");
    fail("Trying to load bad_class_name should throw an exception");
  }
 catch (  ClassNotFoundException e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.TestHTableDescriptor </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testIllegalHTableNames(){
  for (  String tn : illegalTableNames) {
    try {
      TableName.isLegalFullyQualifiedTableName(Bytes.toBytes(tn));
      fail("invalid tablename " + tn + " should have failed");
    }
 catch (    Exception e) {
    }
  }
}

</code></pre>

<br>
<pre class="type-10 type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testAddCoprocessorWithSpecStr() throws IOException {
  HTableDescriptor htd=new HTableDescriptor(TableName.META_TABLE_NAME);
  String cpName="a.b.c.d";
  boolean expected=false;
  try {
    htd.addCoprocessorWithSpec(cpName);
  }
 catch (  IllegalArgumentException iae) {
    expected=true;
  }
  if (!expected)   fail();
  try {
    htd.addCoprocessorWithSpec("file:///some/path" + "|" + cpName);
  }
 catch (  IllegalArgumentException iae) {
    expected=false;
  }
  if (expected)   fail();
  String spec="hdfs:///foo.jar|com.foo.FooRegionObserver|1001|arg1=1,arg2=2";
  try {
    htd.addCoprocessorWithSpec(spec);
  }
 catch (  IllegalArgumentException iae) {
    expected=false;
  }
  if (expected)   fail();
  try {
    htd.addCoprocessorWithSpec(spec);
  }
 catch (  IOException ioe) {
    expected=true;
  }
  if (!expected)   fail();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.TestLocalHBaseCluster </h4><pre class="type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Check that we can start a local HBase cluster specifying a custom master
 * and regionserver class and then cast back to those classes; also that
 * the cluster will launch and terminate cleanly. See HBASE-6011. Uses the
 * HBaseTestingUtility facilities for creating a LocalHBaseCluster with
 * custom master and regionserver classes.
 */
@Test public void testLocalHBaseCluster() throws Exception {
  TEST_UTIL.startMiniCluster(1,1,null,MyHMaster.class,MyHRegionServer.class);
  try {
    int val=((MyHMaster)TEST_UTIL.getHBaseCluster().getMaster(0)).echo(42);
    assertEquals(42,val);
  }
 catch (  ClassCastException e) {
    fail("Could not cast master to our class");
  }
  try {
    int val=((MyHRegionServer)TEST_UTIL.getHBaseCluster().getRegionServer(0)).echo(42);
    assertEquals(42,val);
  }
 catch (  ClassCastException e) {
    fail("Could not cast regionserver to our class");
  }
  TEST_UTIL.shutdownMiniCluster();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.TestNamespace </h4><pre class="type-11 type-7 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void createTableTest() throws IOException, InterruptedException {
  String testName="createTableTest";
  String nsName=prefix + "_" + testName;
  LOG.info(testName);
  HTableDescriptor desc=new HTableDescriptor(TableName.valueOf(nsName + ":my_table"));
  HColumnDescriptor colDesc=new HColumnDescriptor("my_cf");
  desc.addFamily(colDesc);
  try {
    admin.createTable(desc);
    fail("Expected no namespace exists exception");
  }
 catch (  NamespaceNotFoundException ex) {
  }
  admin.createNamespace(NamespaceDescriptor.create(nsName).build());
  admin.createTable(desc);
  TEST_UTIL.waitTableAvailable(desc.getTableName().getName(),10000);
  FileSystem fs=FileSystem.get(TEST_UTIL.getConfiguration());
  assertTrue(fs.exists(new Path(master.getMasterFileSystem().getRootDir(),new Path(HConstants.BASE_NAMESPACE_DIR,new Path(nsName,desc.getTableName().getQualifierAsString())))));
  assertEquals(1,admin.listTables().length);
  try {
    admin.deleteNamespace(nsName);
    fail("Expected non-empty namespace constraint exception");
  }
 catch (  Exception ex) {
    LOG.info("Caught expected exception: " + ex);
  }
  Table table=TEST_UTIL.getConnection().getTable(desc.getTableName());
  Put p=new Put(Bytes.toBytes("row1"));
  p.addColumn(Bytes.toBytes("my_cf"),Bytes.toBytes("my_col"),Bytes.toBytes("value1"));
  table.put(p);
  admin.flush(desc.getTableName());
  Get g=new Get(Bytes.toBytes("row1"));
  assertTrue(table.exists(g));
  TEST_UTIL.deleteTable(desc.getTableName());
  admin.deleteNamespace(nsName);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.TestSerialization </h4><pre class="type-4 type-11 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateKeyValueInvalidNegativeLength(){
  KeyValue kv_0=new KeyValue(Bytes.toBytes("myRow"),Bytes.toBytes("myCF"),Bytes.toBytes("myQualifier"),12345L,Bytes.toBytes("my12345"));
  KeyValue kv_1=new KeyValue(Bytes.toBytes("myRow"),Bytes.toBytes("myCF"),Bytes.toBytes("myQualifier"),12345L,Bytes.toBytes("my123"));
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  DataOutputStream dos=new DataOutputStream(baos);
  long l=0;
  try {
    l=KeyValue.oswrite(kv_0,dos,false);
    l+=KeyValue.oswrite(kv_1,dos,false);
    assertEquals(100L,l);
  }
 catch (  IOException e) {
    fail("Unexpected IOException" + e.getMessage());
  }
  ByteArrayInputStream bais=new ByteArrayInputStream(baos.toByteArray());
  DataInputStream dis=new DataInputStream(bais);
  try {
    KeyValueUtil.create(dis);
    assertTrue(kv_0.equals(kv_1));
  }
 catch (  Exception e) {
    fail("Unexpected Exception" + e.getMessage());
  }
  try {
    KeyValueUtil.create(-1,dis);
    fail("Expected corrupt stream");
  }
 catch (  Exception e) {
    assertEquals("Failed read -1 bytes, stream corrupt?",e.getMessage());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.TestZooKeeper </h4><pre class="type-11 type-7 type-13 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Create a bunch of znodes in a hierarchy, try deleting one that has childs (it will fail), then
 * delete it recursively, then delete the last znode
 * @throws Exception
 */
@Test public void testZNodeDeletes() throws Exception {
  ZooKeeperWatcher zkw=new ZooKeeperWatcher(new Configuration(TEST_UTIL.getConfiguration()),TestZooKeeper.class.getName(),null);
  ZKUtil.createWithParents(zkw,"/l1/l2/l3/l4");
  try {
    ZKUtil.deleteNode(zkw,"/l1/l2");
    fail("We should not be able to delete if znode has childs");
  }
 catch (  KeeperException ex) {
    assertNotNull(ZKUtil.getDataNoWatch(zkw,"/l1/l2/l3/l4",null));
  }
  ZKUtil.deleteNodeRecursively(zkw,"/l1/l2");
  assertNull(ZKUtil.getDataNoWatch(zkw,"/l1/l2/l3/l4",null));
  ZKUtil.deleteNodeRecursively(zkw,"/l1/l2");
  ZKUtil.deleteNode(zkw,"/l1");
  assertNull(ZKUtil.getDataNoWatch(zkw,"/l1/l2",null));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.backup.TestHFileArchiving </h4><pre class="type-3 type-11 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@After public void tearDown() throws Exception {
  try {
    clearArchiveDirectory();
  }
 catch (  IOException e) {
    Assert.fail("Failure to delete archive directory:" + e.getMessage());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.client.TestAdmin1 </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=300000) public void testCreateTableWithOnlyEmptyStartRow() throws IOException {
  byte[] tableName=Bytes.toBytes("testCreateTableWithOnlyEmptyStartRow");
  byte[][] splitKeys=new byte[1][];
  splitKeys[0]=HConstants.EMPTY_BYTE_ARRAY;
  HTableDescriptor desc=new HTableDescriptor(TableName.valueOf(tableName));
  desc.addFamily(new HColumnDescriptor("col"));
  try {
    admin.createTable(desc,splitKeys);
    fail("Test case should fail as empty split key is passed.");
  }
 catch (  IllegalArgumentException e) {
  }
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=300000) public void testDeleteLastColumnFamily() throws Exception {
  TableName tableName=TableName.valueOf("testDeleteLastColumnFamily");
  TEST_UTIL.createTable(tableName,HConstants.CATALOG_FAMILY).close();
  while (!this.admin.isTableEnabled(TableName.valueOf("testDeleteLastColumnFamily"))) {
    Thread.sleep(10);
  }
  try {
    this.admin.deleteColumnFamily(tableName,HConstants.CATALOG_FAMILY);
    fail("Should have failed to delete the only column family of a table");
  }
 catch (  InvalidFamilyOperationException ex) {
  }
  this.admin.disableTable(tableName);
  try {
    this.admin.deleteColumnFamily(tableName,HConstants.CATALOG_FAMILY);
    fail("Should have failed to delete the only column family of a table");
  }
 catch (  InvalidFamilyOperationException ex) {
  }
  this.admin.deleteTable(tableName);
}

</code></pre>

<br>
<pre class="type-4 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=300000) public void testCreateTableNumberOfRegions() throws IOException, InterruptedException {
  TableName tableName=TableName.valueOf("testCreateTableNumberOfRegions");
  HTableDescriptor desc=new HTableDescriptor(tableName);
  desc.addFamily(new HColumnDescriptor(HConstants.CATALOG_FAMILY));
  admin.createTable(desc);
  List<HRegionLocation> regions;
  try (RegionLocator l=TEST_UTIL.getConnection().getRegionLocator(tableName)){
    regions=l.getAllRegionLocations();
    assertEquals("Table should have only 1 region",1,regions.size());
  }
   TableName TABLE_2=TableName.valueOf(tableName.getNameAsString() + "_2");
  desc=new HTableDescriptor(TABLE_2);
  desc.addFamily(new HColumnDescriptor(HConstants.CATALOG_FAMILY));
  admin.createTable(desc,new byte[][]{new byte[]{42}});
  try (RegionLocator l=TEST_UTIL.getConnection().getRegionLocator(TABLE_2)){
    regions=l.getAllRegionLocations();
    assertEquals("Table should have only 2 region",2,regions.size());
  }
   TableName TABLE_3=TableName.valueOf(tableName.getNameAsString() + "_3");
  desc=new HTableDescriptor(TABLE_3);
  desc.addFamily(new HColumnDescriptor(HConstants.CATALOG_FAMILY));
  admin.createTable(desc,"a".getBytes(),"z".getBytes(),3);
  try (RegionLocator l=TEST_UTIL.getConnection().getRegionLocator(TABLE_3)){
    regions=l.getAllRegionLocations();
    assertEquals("Table should have only 3 region",3,regions.size());
  }
   TableName TABLE_4=TableName.valueOf(tableName.getNameAsString() + "_4");
  desc=new HTableDescriptor(TABLE_4);
  desc.addFamily(new HColumnDescriptor(HConstants.CATALOG_FAMILY));
  try {
    admin.createTable(desc,"a".getBytes(),"z".getBytes(),2);
    fail("Should not be able to create a table with only 2 regions using this API.");
  }
 catch (  IllegalArgumentException eae) {
  }
  TableName TABLE_5=TableName.valueOf(tableName.getNameAsString() + "_5");
  desc=new HTableDescriptor(TABLE_5);
  desc.addFamily(new HColumnDescriptor(HConstants.CATALOG_FAMILY));
  admin.createTable(desc,new byte[]{1},new byte[]{127},16);
  try (RegionLocator l=TEST_UTIL.getConnection().getRegionLocator(TABLE_5)){
    regions=l.getAllRegionLocations();
    assertEquals("Table should have 16 region",16,regions.size());
  }
 }

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=300000) public void testCreateTableWithEmptyRowInTheSplitKeys() throws IOException {
  byte[] tableName=Bytes.toBytes("testCreateTableWithEmptyRowInTheSplitKeys");
  byte[][] splitKeys=new byte[3][];
  splitKeys[0]="region1".getBytes();
  splitKeys[1]=HConstants.EMPTY_BYTE_ARRAY;
  splitKeys[2]="region2".getBytes();
  HTableDescriptor desc=new HTableDescriptor(TableName.valueOf(tableName));
  desc.addFamily(new HColumnDescriptor("col"));
  try {
    admin.createTable(desc,splitKeys);
    fail("Test case should fail as empty split key is passed.");
  }
 catch (  IllegalArgumentException e) {
    LOG.info("Expected ",e);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.client.TestAdmin2 </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=300000) public void testDisableCatalogTable() throws Exception {
  try {
    this.admin.disableTable(TableName.META_TABLE_NAME);
    fail("Expected to throw ConstraintException");
  }
 catch (  ConstraintException e) {
  }
  HTableDescriptor htd=new HTableDescriptor(TableName.valueOf("testDisableCatalogTable".getBytes()));
  HColumnDescriptor hcd=new HColumnDescriptor("cf1".getBytes());
  htd.addFamily(hcd);
  TEST_UTIL.getHBaseAdmin().createTable(htd);
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=300000) public void testIsEnabledOrDisabledOnUnknownTable() throws Exception {
  try {
    admin.isTableEnabled(TableName.valueOf("unkownTable"));
    fail("Test should fail if isTableEnabled called on unknown table.");
  }
 catch (  IOException e) {
  }
  try {
    admin.isTableDisabled(TableName.valueOf("unkownTable"));
    fail("Test should fail if isTableDisabled called on unknown table.");
  }
 catch (  IOException e) {
  }
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=300000) public void testCloseRegionWhenServerNameIsNull() throws Exception {
  byte[] TABLENAME=Bytes.toBytes("TestHBACloseRegion3");
  createTableWithDefaultConf(TABLENAME);
  HRegionServer rs=TEST_UTIL.getRSForFirstRegionInTable(TableName.valueOf(TABLENAME));
  try {
    List<HRegionInfo> onlineRegions=ProtobufUtil.getOnlineRegions(rs.getRSRpcServices());
    for (    HRegionInfo regionInfo : onlineRegions) {
      if (!regionInfo.isMetaTable()) {
        if (regionInfo.getRegionNameAsString().contains("TestHBACloseRegion3")) {
          admin.closeRegionWithEncodedRegionName(regionInfo.getEncodedName(),null);
        }
      }
    }
    fail("The test should throw exception if the servername passed is null.");
  }
 catch (  IllegalArgumentException e) {
  }
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=300000) public void testCloseRegionWhenServerNameIsEmpty() throws Exception {
  byte[] TABLENAME=Bytes.toBytes("TestHBACloseRegionWhenServerNameIsEmpty");
  createTableWithDefaultConf(TABLENAME);
  HRegionServer rs=TEST_UTIL.getRSForFirstRegionInTable(TableName.valueOf(TABLENAME));
  try {
    List<HRegionInfo> onlineRegions=ProtobufUtil.getOnlineRegions(rs.getRSRpcServices());
    for (    HRegionInfo regionInfo : onlineRegions) {
      if (!regionInfo.isMetaTable()) {
        if (regionInfo.getRegionNameAsString().contains("TestHBACloseRegionWhenServerNameIsEmpty")) {
          admin.closeRegionWithEncodedRegionName(regionInfo.getEncodedName()," ");
        }
      }
    }
    fail("The test should throw exception if the servername passed is empty.");
  }
 catch (  IllegalArgumentException e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.client.TestAsyncProcess </h4><pre class="type-11 type-7 type-13 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCallQueueTooLarge() throws IOException {
  ClusterConnection conn=new MyConnectionImpl(conf);
  BufferedMutatorImpl mutator=(BufferedMutatorImpl)conn.getBufferedMutator(DUMMY_TABLE);
  AsyncProcessWithFailure ap=new AsyncProcessWithFailure(conn,conf,new CallQueueTooBigException());
  mutator.ap=ap;
  Assert.assertNotNull(mutator.ap.createServerErrorTracker());
  Put p=createPut(1,true);
  mutator.mutate(p);
  try {
    mutator.flush();
    Assert.fail();
  }
 catch (  RetriesExhaustedWithDetailsException expected) {
  }
  Assert.assertEquals(NB_RETRIES + 1,ap.callsCt.get());
}

</code></pre>

<br>
<pre class="type-11 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMaxTask() throws Exception {
  final AsyncProcess ap=new MyAsyncProcess(createHConnection(),conf,false);
  for (int i=0; i < 1000; i++) {
    ap.incTaskCounters(Arrays.asList("dummy".getBytes()),sn);
  }
  final Thread myThread=Thread.currentThread();
  Thread t=new Thread(){
    @Override public void run(){
      Threads.sleep(2000);
      myThread.interrupt();
    }
  }
;
  List<Put> puts=new ArrayList<Put>();
  puts.add(createPut(1,true));
  t.start();
  try {
    ap.submit(DUMMY_TABLE,puts,false,null,false);
    Assert.fail("We should have been interrupted.");
  }
 catch (  InterruptedIOException expected) {
  }
  final long sleepTime=2000;
  Thread t2=new Thread(){
    @Override public void run(){
      Threads.sleep(sleepTime);
      while (ap.tasksInProgress.get() > 0) {
        ap.decTaskCounters(Arrays.asList("dummy".getBytes()),sn);
      }
    }
  }
;
  t2.start();
  long start=System.currentTimeMillis();
  ap.submit(DUMMY_TABLE,new ArrayList<Row>(),false,null,false);
  long end=System.currentTimeMillis();
  Assert.assertTrue(start + 100L + sleepTime > end);
}

</code></pre>

<br>
<pre class="type-4 type-11 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBatch() throws IOException, InterruptedException {
  ClusterConnection conn=new MyConnectionImpl(conf);
  HTable ht=new HTable(conn,new BufferedMutatorParams(DUMMY_TABLE));
  ht.multiAp=new MyAsyncProcess(conn,conf,false);
  List<Put> puts=new ArrayList<Put>();
  puts.add(createPut(1,true));
  puts.add(createPut(1,true));
  puts.add(createPut(1,true));
  puts.add(createPut(1,true));
  puts.add(createPut(1,false));
  puts.add(createPut(1,true));
  puts.add(createPut(1,false));
  Object[] res=new Object[puts.size()];
  try {
    ht.processBatch(puts,res);
    Assert.fail();
  }
 catch (  RetriesExhaustedException expected) {
  }
  Assert.assertEquals(res[0],success);
  Assert.assertEquals(res[1],success);
  Assert.assertEquals(res[2],success);
  Assert.assertEquals(res[3],success);
  Assert.assertEquals(res[4],failure);
  Assert.assertEquals(res[5],success);
  Assert.assertEquals(res[6],failure);
}

</code></pre>

<br>
<pre class="type-11 type-7 type-8 type-13 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testErrorsServers() throws IOException {
  Configuration configuration=new Configuration(conf);
  ClusterConnection conn=new MyConnectionImpl(configuration);
  BufferedMutatorImpl mutator=new BufferedMutatorImpl(conn,null,null,new BufferedMutatorParams(DUMMY_TABLE));
  configuration.setBoolean(ConnectionImplementation.RETRIES_BY_SERVER_KEY,true);
  MyAsyncProcess ap=new MyAsyncProcess(conn,configuration,true);
  mutator.ap=ap;
  Assert.assertNotNull(mutator.ap.createServerErrorTracker());
  Assert.assertTrue(mutator.ap.serverTrackerTimeout > 200);
  mutator.ap.serverTrackerTimeout=1;
  Put p=createPut(1,false);
  mutator.mutate(p);
  try {
    mutator.flush();
    Assert.fail();
  }
 catch (  RetriesExhaustedWithDetailsException expected) {
  }
  Assert.assertEquals(NB_RETRIES + 1,ap.callsCt.get());
}

</code></pre>

<br>
<pre class="type-11 type-7 type-13 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGlobalErrors() throws IOException {
  ClusterConnection conn=new MyConnectionImpl(conf);
  BufferedMutatorImpl mutator=(BufferedMutatorImpl)conn.getBufferedMutator(DUMMY_TABLE);
  AsyncProcessWithFailure ap=new AsyncProcessWithFailure(conn,conf,new IOException("test"));
  mutator.ap=ap;
  Assert.assertNotNull(mutator.ap.createServerErrorTracker());
  Put p=createPut(1,true);
  mutator.mutate(p);
  try {
    mutator.flush();
    Assert.fail();
  }
 catch (  RetriesExhaustedWithDetailsException expected) {
  }
  Assert.assertEquals(NB_RETRIES + 1,ap.callsCt.get());
}

</code></pre>

<br>
<pre class="type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHTableFailedPutAndNewPut() throws Exception {
  ClusterConnection conn=createHConnection();
  BufferedMutatorImpl mutator=new BufferedMutatorImpl(conn,null,null,new BufferedMutatorParams(DUMMY_TABLE).writeBufferSize(0));
  MyAsyncProcess ap=new MyAsyncProcess(conn,conf,true);
  mutator.ap=ap;
  Put p=createPut(1,false);
  mutator.mutate(p);
  ap.waitUntilDone();
  p=createPut(1,true);
  Assert.assertEquals(0,mutator.writeAsyncBuffer.size());
  try {
    mutator.mutate(p);
    Assert.fail();
  }
 catch (  RetriesExhaustedException expected) {
  }
  Assert.assertEquals("the put should not been inserted.",0,mutator.writeAsyncBuffer.size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.client.TestCheckAndMutate </h4><pre class="type-11 type-7 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCheckAndMutate() throws Exception {
  final TableName tableName=TableName.valueOf("TestPutWithDelete");
  final byte[] rowKey=Bytes.toBytes("12345");
  final byte[] family=Bytes.toBytes("cf");
  Table table=TEST_UTIL.createTable(tableName,family);
  TEST_UTIL.waitTableAvailable(tableName.getName(),5000);
  try {
    Put put=new Put(rowKey);
    put.addColumn(family,Bytes.toBytes("A"),Bytes.toBytes("a"));
    put.addColumn(family,Bytes.toBytes("B"),Bytes.toBytes("b"));
    put.addColumn(family,Bytes.toBytes("C"),Bytes.toBytes("c"));
    table.put(put);
    Get get=new Get(rowKey);
    Result result=table.get(get);
    assertTrue("Column A value should be a",Bytes.toString(result.getValue(family,Bytes.toBytes("A"))).equals("a"));
    assertTrue("Column B value should be b",Bytes.toString(result.getValue(family,Bytes.toBytes("B"))).equals("b"));
    assertTrue("Column C value should be c",Bytes.toString(result.getValue(family,Bytes.toBytes("C"))).equals("c"));
    RowMutations rm=new RowMutations(rowKey);
    put=new Put(rowKey);
    put.addColumn(family,Bytes.toBytes("A"),Bytes.toBytes("a"));
    put.addColumn(family,Bytes.toBytes("B"),Bytes.toBytes("b"));
    rm.add(put);
    Delete del=new Delete(rowKey);
    del.addColumn(family,Bytes.toBytes("C"));
    rm.add(del);
    boolean res=table.checkAndMutate(rowKey,family,Bytes.toBytes("A"),CompareFilter.CompareOp.EQUAL,Bytes.toBytes("a"),rm);
    assertTrue(res);
    get=new Get(rowKey);
    result=table.get(get);
    assertTrue("Column A value should be a",Bytes.toString(result.getValue(family,Bytes.toBytes("A"))).equals("a"));
    assertTrue("Column B value should be b",Bytes.toString(result.getValue(family,Bytes.toBytes("B"))).equals("b"));
    assertTrue("Column C should not exist",result.getValue(family,Bytes.toBytes("C")) == null);
    try {
      Put p=new Put(rowKey);
      byte[] value=new byte[0];
      p.addColumn(new byte[]{'b','o','g','u','s'},new byte[]{'A'},value);
      rm=new RowMutations(rowKey);
      rm.add(p);
      table.checkAndMutate(rowKey,family,Bytes.toBytes("A"),CompareFilter.CompareOp.EQUAL,Bytes.toBytes("a"),rm);
      fail("Expected NoSuchColumnFamilyException");
    }
 catch (    NoSuchColumnFamilyException e) {
    }
  }
  finally {
    table.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.client.TestClientNoCluster </h4><pre class="type-11 type-8 type-6 type-18 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
- Is not executed with the test suite
"></span><br>
/** 
 * Remove the @Ignore to try out timeout and retry asettings
 * @throws IOException
 */
@Ignore @Test public void testTimeoutAndRetries() throws IOException {
  Configuration localConfig=HBaseConfiguration.create(this.conf);
  localConfig.set("hbase.client.connection.impl",RpcTimeoutConnection.class.getName());
  Connection connection=ConnectionFactory.createConnection(localConfig);
  Table table=connection.getTable(TableName.META_TABLE_NAME);
  Throwable t=null;
  LOG.info("Start");
  try {
    table.exists(new Get(Bytes.toBytes("abc")));
  }
 catch (  SocketTimeoutException e) {
    LOG.info("Got expected exception",e);
    t=e;
  }
catch (  RetriesExhaustedException e) {
    fail();
  }
 finally {
    table.close();
  }
  connection.close();
  LOG.info("Stop");
  assertTrue(t != null);
}

</code></pre>

<br>
<pre class="type-11 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that operation timeout prevails over rpc default timeout and retries, etc.
 * @throws IOException
 */
@Test public void testRpcTimeout() throws IOException {
  Configuration localConfig=HBaseConfiguration.create(this.conf);
  localConfig.set("hbase.client.connection.impl",RpcTimeoutConnection.class.getName());
  int pause=10;
  localConfig.setInt("hbase.client.pause",pause);
  localConfig.setInt(HConstants.HBASE_CLIENT_RETRIES_NUMBER,10);
  localConfig.setInt(HConstants.HBASE_CLIENT_META_OPERATION_TIMEOUT,pause - 1);
  Connection connection=ConnectionFactory.createConnection(localConfig);
  Table table=connection.getTable(TableName.META_TABLE_NAME);
  Throwable t=null;
  try {
    table.exists(new Get(Bytes.toBytes("abc")));
  }
 catch (  SocketTimeoutException e) {
    LOG.info("Got expected exception",e);
    t=e;
  }
catch (  RetriesExhaustedException e) {
    fail();
  }
 finally {
    table.close();
    connection.close();
  }
  assertTrue(t != null);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.client.TestClientScanner </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Tests the case where all replicas of a region throw an exception. It should not cause a hang
 * but the exception should propagate to the client
 */
@Test(timeout=30000) public void testExceptionsFromReplicasArePropagated() throws IOException {
  scan.setConsistency(Consistency.TIMELINE);
  rpcFactory=new MockRpcRetryingCallerFactory(conf);
  conf.set(RpcRetryingCallerFactory.CUSTOM_CALLER_CONF_KEY,MockRpcRetryingCallerFactory.class.getName());
  when(clusterConn.locateRegion((TableName)any(),(byte[])any(),anyBoolean(),anyBoolean(),anyInt())).thenReturn(new RegionLocations(null,null,null));
  try (MockClientScanner scanner=new MockClientScanner(conf,scan,TableName.valueOf("table"),clusterConn,rpcFactory,controllerFactory,pool,Integer.MAX_VALUE)){
    Iterator<Result> iter=scanner.iterator();
    while (iter.hasNext()) {
      iter.next();
    }
    fail("Should have failed with RetriesExhaustedException");
  }
 catch (  RetriesExhaustedException expected) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.client.TestFromClientSide </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testNull() throws Exception {
  TableName TABLE=TableName.valueOf("testNull");
  try {
    TEST_UTIL.createTable((TableName)null,FAMILY);
    fail("Creating a table with null name passed, should have failed");
  }
 catch (  Exception e) {
  }
  try {
    TEST_UTIL.createTable(TABLE,new byte[][]{(byte[])null});
    fail("Creating a table with a null family passed, should fail");
  }
 catch (  Exception e) {
  }
  Table ht=TEST_UTIL.createTable(TABLE,FAMILY);
  try {
    Put put=new Put((byte[])null);
    put.addColumn(FAMILY,QUALIFIER,VALUE);
    ht.put(put);
    fail("Inserting a null row worked, should throw exception");
  }
 catch (  Exception e) {
  }
{
    Put put=new Put(ROW);
    put.addColumn(FAMILY,null,VALUE);
    ht.put(put);
    getTestNull(ht,ROW,FAMILY,VALUE);
    scanTestNull(ht,ROW,FAMILY,VALUE);
    Delete delete=new Delete(ROW);
    delete.addColumns(FAMILY,null);
    ht.delete(delete);
    Get get=new Get(ROW);
    Result result=ht.get(get);
    assertEmptyResult(result);
  }
  byte[] TABLE2=Bytes.toBytes("testNull2");
  ht=TEST_UTIL.createTable(TableName.valueOf(TABLE2),FAMILY);
  try {
    Put put=new Put(ROW);
    put.addColumn(FAMILY,HConstants.EMPTY_BYTE_ARRAY,VALUE);
    ht.put(put);
    getTestNull(ht,ROW,FAMILY,VALUE);
    scanTestNull(ht,ROW,FAMILY,VALUE);
    TEST_UTIL.flush();
    getTestNull(ht,ROW,FAMILY,VALUE);
    scanTestNull(ht,ROW,FAMILY,VALUE);
    Delete delete=new Delete(ROW);
    delete.addColumns(FAMILY,HConstants.EMPTY_BYTE_ARRAY);
    ht.delete(delete);
    Get get=new Get(ROW);
    Result result=ht.get(get);
    assertEmptyResult(result);
  }
 catch (  Exception e) {
    throw new IOException("Using a row with null qualifier threw exception, should ");
  }
  try {
    Put put=new Put(ROW);
    put.addColumn(FAMILY,QUALIFIER,null);
    ht.put(put);
    Get get=new Get(ROW);
    get.addColumn(FAMILY,QUALIFIER);
    Result result=ht.get(get);
    assertSingleResult(result,ROW,FAMILY,QUALIFIER,null);
    Scan scan=new Scan();
    scan.addColumn(FAMILY,QUALIFIER);
    result=getSingleScanResult(ht,scan);
    assertSingleResult(result,ROW,FAMILY,QUALIFIER,null);
    Delete delete=new Delete(ROW);
    delete.addColumns(FAMILY,QUALIFIER);
    ht.delete(delete);
    get=new Get(ROW);
    result=ht.get(get);
    assertEmptyResult(result);
  }
 catch (  Exception e) {
    throw new IOException("Null values should be allowed, but threw exception");
  }
}

</code></pre>

<br>
<pre class="type-11 type-7 type-13 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRowMutation() throws Exception {
  LOG.info("Starting testRowMutation");
  final TableName TABLENAME=TableName.valueOf("testRowMutation");
  Table t=TEST_UTIL.createTable(TABLENAME,FAMILY);
  byte[][] QUALIFIERS=new byte[][]{Bytes.toBytes("a"),Bytes.toBytes("b")};
  RowMutations arm=new RowMutations(ROW);
  Put p=new Put(ROW);
  p.addColumn(FAMILY,QUALIFIERS[0],VALUE);
  arm.add(p);
  t.mutateRow(arm);
  Get g=new Get(ROW);
  Result r=t.get(g);
  assertEquals(0,Bytes.compareTo(VALUE,r.getValue(FAMILY,QUALIFIERS[0])));
  arm=new RowMutations(ROW);
  p=new Put(ROW);
  p.addColumn(FAMILY,QUALIFIERS[1],VALUE);
  arm.add(p);
  Delete d=new Delete(ROW);
  d.addColumns(FAMILY,QUALIFIERS[0]);
  arm.add(d);
  t.mutateRow(arm);
  r=t.get(g);
  assertEquals(0,Bytes.compareTo(VALUE,r.getValue(FAMILY,QUALIFIERS[1])));
  assertNull(r.getValue(FAMILY,QUALIFIERS[0]));
  try {
    arm=new RowMutations(ROW);
    p=new Put(ROW);
    p.addColumn(new byte[]{'b','o','g','u','s'},QUALIFIERS[0],VALUE);
    arm.add(p);
    t.mutateRow(arm);
    fail("Expected NoSuchColumnFamilyException");
  }
 catch (  NoSuchColumnFamilyException e) {
  }
}

</code></pre>

<br>
<pre class="type-11 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNegativeTimestamp() throws IOException {
  Table table=TEST_UTIL.createTable(TableName.valueOf("testNegativeTimestamp"),FAMILY);
  try {
    Put put=new Put(ROW,-1);
    put.addColumn(FAMILY,QUALIFIER,VALUE);
    table.put(put);
    fail("Negative timestamps should not have been allowed");
  }
 catch (  IllegalArgumentException ex) {
    assertTrue(ex.getMessage().contains("negative"));
  }
  try {
    Put put=new Put(ROW);
    long ts=-1;
    put.addColumn(FAMILY,QUALIFIER,ts,VALUE);
    table.put(put);
    fail("Negative timestamps should not have been allowed");
  }
 catch (  IllegalArgumentException ex) {
    assertTrue(ex.getMessage().contains("negative"));
  }
  try {
    Delete delete=new Delete(ROW,-1);
    table.delete(delete);
    fail("Negative timestamps should not have been allowed");
  }
 catch (  IllegalArgumentException ex) {
    assertTrue(ex.getMessage().contains("negative"));
  }
  try {
    Delete delete=new Delete(ROW);
    delete.addFamily(FAMILY,-1);
    table.delete(delete);
    fail("Negative timestamps should not have been allowed");
  }
 catch (  IllegalArgumentException ex) {
    assertTrue(ex.getMessage().contains("negative"));
  }
  try {
    Scan scan=new Scan();
    scan.setTimeRange(-1,1);
    table.getScanner(scan);
    fail("Negative timestamps should not have been allowed");
  }
 catch (  IllegalArgumentException ex) {
    assertTrue(ex.getMessage().contains("negative"));
  }
  try {
    new KeyValue(Bytes.toBytes(42),Bytes.toBytes(42),Bytes.toBytes(42),-1,Bytes.toBytes(42));
  }
 catch (  IllegalArgumentException ex) {
    fail("KeyValue SHOULD allow negative timestamps");
  }
  table.close();
}

</code></pre>

<br>
<pre class="type-4 type-11 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testIllegalTableDescriptor() throws Exception {
  HTableDescriptor htd=new HTableDescriptor(TableName.valueOf("testIllegalTableDescriptor"));
  HColumnDescriptor hcd=new HColumnDescriptor(FAMILY);
  checkTableIsIllegal(htd);
  htd.addFamily(hcd);
  checkTableIsLegal(htd);
  htd.setMaxFileSize(1024);
  checkTableIsIllegal(htd);
  htd.setMaxFileSize(0);
  checkTableIsIllegal(htd);
  htd.setMaxFileSize(1024 * 1024 * 1024);
  checkTableIsLegal(htd);
  htd.setMemStoreFlushSize(1024);
  checkTableIsIllegal(htd);
  htd.setMemStoreFlushSize(0);
  checkTableIsIllegal(htd);
  htd.setMemStoreFlushSize(128 * 1024 * 1024);
  checkTableIsLegal(htd);
  htd.setRegionSplitPolicyClassName("nonexisting.foo.class");
  checkTableIsIllegal(htd);
  htd.setRegionSplitPolicyClassName(null);
  checkTableIsLegal(htd);
  hcd.setBlocksize(0);
  checkTableIsIllegal(htd);
  hcd.setBlocksize(1024 * 1024 * 128);
  checkTableIsIllegal(htd);
  hcd.setBlocksize(1024);
  checkTableIsLegal(htd);
  hcd.setTimeToLive(0);
  checkTableIsIllegal(htd);
  hcd.setTimeToLive(-1);
  checkTableIsIllegal(htd);
  hcd.setTimeToLive(1);
  checkTableIsLegal(htd);
  hcd.setMinVersions(-1);
  checkTableIsIllegal(htd);
  hcd.setMinVersions(3);
  try {
    hcd.setMaxVersions(2);
    fail();
  }
 catch (  IllegalArgumentException ex) {
    hcd.setMaxVersions(10);
  }
  checkTableIsLegal(htd);
  hcd.setMaxVersions(4);
  hcd.setMinVersions(5);
  checkTableIsIllegal(htd);
  hcd.setMinVersions(3);
  hcd.setScope(-1);
  checkTableIsIllegal(htd);
  hcd.setScope(0);
  checkTableIsLegal(htd);
  try {
    hcd.setDFSReplication((short)-1);
    fail("Illegal value for setDFSReplication did not throw");
  }
 catch (  IllegalArgumentException e) {
  }
  hcd.setValue(HColumnDescriptor.DFS_REPLICATION,"-1");
  checkTableIsIllegal(htd);
  try {
    hcd.setDFSReplication((short)-1);
    fail("Should throw exception if an illegal value is explicitly being set");
  }
 catch (  IllegalArgumentException e) {
  }
  htd.setMemStoreFlushSize(0);
  ListAppender listAppender=new ListAppender();
  Logger log=Logger.getLogger(HMaster.class);
  log.addAppender(listAppender);
  log.setLevel(Level.WARN);
  htd.setConfiguration("hbase.table.sanity.checks",Boolean.FALSE.toString());
  checkTableIsLegal(htd);
  assertFalse(listAppender.getMessages().isEmpty());
  assertTrue(listAppender.getMessages().get(0).startsWith("MEMSTORE_FLUSHSIZE for table " + "descriptor or \"hbase.hregion.memstore.flush.size\" (0) is too small, which might " + "cause very frequent flushing."));
  log.removeAppender(listAppender);
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testMaxKeyValueSize() throws Exception {
  TableName TABLE=TableName.valueOf("testMaxKeyValueSize");
  Configuration conf=TEST_UTIL.getConfiguration();
  String oldMaxSize=conf.get(TableConfiguration.MAX_KEYVALUE_SIZE_KEY);
  Table ht=TEST_UTIL.createTable(TABLE,FAMILY);
  byte[] value=new byte[4 * 1024 * 1024];
  Put put=new Put(ROW);
  put.addColumn(FAMILY,QUALIFIER,value);
  ht.put(put);
  try {
    TEST_UTIL.getConfiguration().setInt(TableConfiguration.MAX_KEYVALUE_SIZE_KEY,2 * 1024 * 1024);
    try (Connection connection=ConnectionFactory.createConnection(TEST_UTIL.getConfiguration())){
      try (Table t=connection.getTable(TableName.valueOf(FAMILY))){
        put=new Put(ROW);
        put.addColumn(FAMILY,QUALIFIER,value);
        t.put(put);
      }
     }
     fail("Inserting a too large KeyValue worked, should throw exception");
  }
 catch (  Exception e) {
  }
  conf.set(TableConfiguration.MAX_KEYVALUE_SIZE_KEY,oldMaxSize);
}

</code></pre>

<br>
<pre class="type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCheckAndPut() throws IOException {
  final byte[] anotherrow=Bytes.toBytes("anotherrow");
  final byte[] value2=Bytes.toBytes("abcd");
  Table table=TEST_UTIL.createTable(TableName.valueOf("testCheckAndPut"),FAMILY);
  Put put1=new Put(ROW);
  put1.addColumn(FAMILY,QUALIFIER,VALUE);
  boolean ok=table.checkAndPut(ROW,FAMILY,QUALIFIER,VALUE,put1);
  assertEquals(ok,false);
  ok=table.checkAndPut(ROW,FAMILY,QUALIFIER,null,put1);
  assertEquals(ok,true);
  ok=table.checkAndPut(ROW,FAMILY,QUALIFIER,null,put1);
  assertEquals(ok,false);
  Put put2=new Put(ROW);
  put2.addColumn(FAMILY,QUALIFIER,value2);
  ok=table.checkAndPut(ROW,FAMILY,QUALIFIER,VALUE,put2);
  assertEquals(ok,true);
  Put put3=new Put(anotherrow);
  put3.addColumn(FAMILY,QUALIFIER,VALUE);
  try {
    ok=table.checkAndPut(ROW,FAMILY,QUALIFIER,value2,put3);
    fail("trying to check and modify different rows should have failed.");
  }
 catch (  Exception e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.client.TestFromClientSide3 </h4><pre class="type-11 type-7 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetEmptyRow() throws Exception {
  Admin admin=TEST_UTIL.getHBaseAdmin();
  HTableDescriptor desc=new HTableDescriptor(TableName.valueOf(Bytes.toBytes("test")));
  desc.addFamily(new HColumnDescriptor(FAMILY));
  admin.createTable(desc);
  Table table=TEST_UTIL.getConnection().getTable(desc.getTableName());
  Put put=new Put(ROW_BYTES);
  put.addColumn(FAMILY,COL_QUAL,VAL_BYTES);
  table.put(put);
  Result res=null;
  try {
    res=table.get(new Get(new byte[0]));
    fail();
  }
 catch (  IllegalArgumentException e) {
  }
  assertTrue(res == null);
  res=table.get(new Get(Bytes.toBytes("r1-not-exist")));
  assertTrue(res.isEmpty() == true);
  res=table.get(new Get(ROW_BYTES));
  assertTrue(Arrays.equals(res.getValue(FAMILY,COL_QUAL),VAL_BYTES));
  table.close();
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testHTableBatchWithEmptyPut() throws Exception {
  Table table=TEST_UTIL.createTable(TableName.valueOf("testHTableBatchWithEmptyPut"),new byte[][]{FAMILY});
  try {
    List actions=(List)new ArrayList();
    Object[] results=new Object[2];
    Put put1=new Put(ROW);
    actions.add(put1);
    Put put2=new Put(ANOTHERROW);
    put2.addColumn(FAMILY,QUALIFIER,VALUE);
    actions.add(put2);
    table.batch(actions,results);
    fail("Empty Put should have failed the batch call");
  }
 catch (  IllegalArgumentException iae) {
  }
 finally {
    table.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.client.TestGet </h4><pre class="type-4 type-11 type-7 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDynamicFilter() throws Exception {
  Configuration conf=HBaseConfiguration.create();
  String localPath=conf.get("hbase.local.dir") + File.separator + "jars"+ File.separator;
  File jarFile=new File(localPath,"MockFilter.jar");
  jarFile.delete();
  assertFalse("Should be deleted: " + jarFile.getPath(),jarFile.exists());
  ClientProtos.Get getProto1=ClientProtos.Get.parseFrom(Base64.decode(PB_GET));
  ClientProtos.Get getProto2=ClientProtos.Get.parseFrom(Base64.decode(PB_GET_WITH_FILTER_LIST));
  try {
    ProtobufUtil.toGet(getProto1);
    fail("Should not be able to load the filter class");
  }
 catch (  IOException ioe) {
    assertTrue(ioe.getCause() instanceof ClassNotFoundException);
  }
  try {
    ProtobufUtil.toGet(getProto2);
    fail("Should not be able to load the filter class");
  }
 catch (  IOException ioe) {
    assertTrue(ioe.getCause() instanceof InvocationTargetException);
    InvocationTargetException ite=(InvocationTargetException)ioe.getCause();
    assertTrue(ite.getTargetException() instanceof DeserializationException);
  }
  FileOutputStream fos=new FileOutputStream(jarFile);
  fos.write(Base64.decode(MOCK_FILTER_JAR));
  fos.close();
  Get get1=ProtobufUtil.toGet(getProto1);
  assertEquals("test.MockFilter",get1.getFilter().getClass().getName());
  Get get2=ProtobufUtil.toGet(getProto2);
  assertTrue(get2.getFilter() instanceof FilterList);
  List<Filter> filters=((FilterList)get2.getFilter()).getFilters();
  assertEquals(3,filters.size());
  assertEquals("test.MockFilter",filters.get(0).getClass().getName());
  assertEquals("my.MockFilter",filters.get(1).getClass().getName());
  assertTrue(filters.get(2) instanceof KeyOnlyFilter);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.client.TestHBaseAdminNoCluster </h4><pre class="type-11 type-6 type-18 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Contains more than 2 JUnit-based stereotypes
- Is not executed with the test suite
"></span><br>
/** 
 * Verify that PleaseHoldException gets retried.
 * HBASE-8764
 * @throws IOException
 * @throws ZooKeeperConnectionException
 * @throws MasterNotRunningException
 * @throws ServiceException
 */
@Ignore @Test public void testMasterMonitorCallableRetries() throws MasterNotRunningException, ZooKeeperConnectionException, IOException, ServiceException {
  Configuration configuration=HBaseConfiguration.create();
  configuration.setLong(HConstants.HBASE_CLIENT_PAUSE,1);
  final int count=10;
  configuration.setInt(HConstants.HBASE_CLIENT_RETRIES_NUMBER,count);
  ClusterConnection connection=HConnectionTestingUtility.getMockedConnection(configuration);
  MasterKeepAliveConnection masterAdmin=Mockito.mock(MasterKeepAliveConnection.class);
  Mockito.when(masterAdmin.createTable((RpcController)Mockito.any(),(CreateTableRequest)Mockito.any())).thenThrow(new ServiceException("Test fail").initCause(new PleaseHoldException("test")));
  Mockito.when(connection.getKeepAliveMasterService()).thenReturn(masterAdmin);
  Admin admin=new HBaseAdmin(connection);
  try {
    HTableDescriptor htd=new HTableDescriptor(TableName.valueOf("testMasterMonitorCollableRetries"));
    try {
      admin.createTable(htd,HBaseTestingUtility.KEYS_FOR_HBA_CREATE_TABLE);
      fail();
    }
 catch (    RetriesExhaustedException e) {
      LOG.info("Expected fail",e);
    }
    Mockito.verify(masterAdmin,Mockito.atLeast(count)).createTable((RpcController)Mockito.any(),(CreateTableRequest)Mockito.any());
  }
  finally {
    admin.close();
    if (connection != null)     connection.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.client.TestHCM </h4><pre class="type-10 type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Test that an operation can fail if we read the global operation timeout, even if the
 * individual timeout is fine. We do that with:
 * - client side: an operation timeout of 30 seconds
 * - server side: we sleep 20 second at each attempt. The first work fails, the second one
 * succeeds. But the client won't wait that much, because 20 + 20 > 30, so the client
 * timeouted when the server answers.
 */
@Test public void testOperationTimeout() throws Exception {
  HTableDescriptor hdt=TEST_UTIL.createTableDescriptor("HCM-testOperationTimeout");
  hdt.addCoprocessor(SleepAndFailFirstTime.class.getName());
  Table t=TEST_UTIL.createTable(hdt,new byte[][]{FAM_NAM},null);
  if (t instanceof HTable) {
    HTable table=(HTable)t;
    table.setOperationTimeout(120 * 1000);
    table.get(new Get(FAM_NAM));
    SleepAndFailFirstTime.ct.set(0);
    try {
      table.setOperationTimeout(30 * 1000);
      table.get(new Get(FAM_NAM));
      Assert.fail("We expect an exception here");
    }
 catch (    SocketTimeoutException e) {
      LOG.info("We received an exception, as expected ",e);
    }
catch (    IOException e) {
      Assert.fail("Wrong exception:" + e.getMessage());
    }
 finally {
      table.close();
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-11 type-7 type-8 type-13 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that when we delete a location using the first row of a region
 * that we really delete it.
 * @throws Exception
 */
@Test public void testRegionCaching() throws Exception {
  TEST_UTIL.createMultiRegionTable(TABLE_NAME,FAM_NAM).close();
  Configuration conf=new Configuration(TEST_UTIL.getConfiguration());
  conf.setInt(HConstants.HBASE_CLIENT_RETRIES_NUMBER,0);
  Connection connection=ConnectionFactory.createConnection(conf);
  final Table table=connection.getTable(TABLE_NAME);
  TEST_UTIL.waitUntilAllRegionsAssigned(table.getName());
  Put put=new Put(ROW);
  put.addColumn(FAM_NAM,ROW,ROW);
  table.put(put);
  ConnectionImplementation conn=(ConnectionImplementation)connection;
  assertNotNull(conn.getCachedLocation(TABLE_NAME,ROW));
  final int nextPort=conn.getCachedLocation(TABLE_NAME,ROW).getRegionLocation().getPort() + 1;
  HRegionLocation loc=conn.getCachedLocation(TABLE_NAME,ROW).getRegionLocation();
  conn.updateCachedLocation(loc.getRegionInfo(),loc.getServerName(),ServerName.valueOf("127.0.0.1",nextPort,HConstants.LATEST_TIMESTAMP),HConstants.LATEST_TIMESTAMP);
  Assert.assertEquals(conn.getCachedLocation(TABLE_NAME,ROW).getRegionLocation().getPort(),nextPort);
  conn.clearRegionCache(TABLE_NAME,ROW.clone());
  RegionLocations rl=conn.getCachedLocation(TABLE_NAME,ROW);
  assertNull("What is this location?? " + rl,rl);
  conn.clearRegionCache(TABLE_NAME);
  Assert.assertEquals(0,conn.getNumberOfCachedRegionLocations(TABLE_NAME));
  Put put2=new Put(ROW);
  put2.addColumn(FAM_NAM,ROW,ROW);
  table.put(put2);
  assertNotNull(conn.getCachedLocation(TABLE_NAME,ROW));
  assertNotNull(conn.getCachedLocation(TableName.valueOf(TABLE_NAME.getName()),ROW.clone()));
  TEST_UTIL.getHBaseAdmin().setBalancerRunning(false,false);
  HMaster master=TEST_UTIL.getMiniHBaseCluster().getMaster();
  while (master.getAssignmentManager().getRegionStates().isRegionsInTransition()) {
    Thread.sleep(1);
  }
  HRegionLocation toMove=conn.getCachedLocation(TABLE_NAME,ROW).getRegionLocation();
  byte[] regionName=toMove.getRegionInfo().getRegionName();
  byte[] encodedRegionNameBytes=toMove.getRegionInfo().getEncodedNameAsBytes();
  int curServerId=TEST_UTIL.getHBaseCluster().getServerWith(regionName);
  int destServerId=(curServerId == 0 ? 1 : 0);
  HRegionServer curServer=TEST_UTIL.getHBaseCluster().getRegionServer(curServerId);
  HRegionServer destServer=TEST_UTIL.getHBaseCluster().getRegionServer(destServerId);
  ServerName destServerName=destServer.getServerName();
  Assert.assertTrue(curServer != destServer);
  Assert.assertFalse(curServer.getServerName().equals(destServer.getServerName()));
  Assert.assertFalse(toMove.getPort() == destServerName.getPort());
  Assert.assertNotNull(curServer.getOnlineRegion(regionName));
  Assert.assertNull(destServer.getOnlineRegion(regionName));
  Assert.assertFalse(TEST_UTIL.getMiniHBaseCluster().getMaster().getAssignmentManager().getRegionStates().isRegionsInTransition());
  LOG.info("Move starting region=" + toMove.getRegionInfo().getRegionNameAsString());
  TEST_UTIL.getHBaseAdmin().move(toMove.getRegionInfo().getEncodedNameAsBytes(),destServerName.getServerName().getBytes());
  while (destServer.getOnlineRegion(regionName) == null || destServer.getRegionsInTransitionInRS().containsKey(encodedRegionNameBytes) || curServer.getRegionsInTransitionInRS().containsKey(encodedRegionNameBytes) || master.getAssignmentManager().getRegionStates().isRegionsInTransition()) {
    Thread.sleep(1);
  }
  LOG.info("Move finished for region=" + toMove.getRegionInfo().getRegionNameAsString());
  Assert.assertNull(curServer.getOnlineRegion(regionName));
  Assert.assertNotNull(destServer.getOnlineRegion(regionName));
  Assert.assertFalse(destServer.getRegionsInTransitionInRS().containsKey(encodedRegionNameBytes));
  Assert.assertFalse(curServer.getRegionsInTransitionInRS().containsKey(encodedRegionNameBytes));
  Assert.assertFalse(conn.getCachedLocation(TABLE_NAME,ROW).getRegionLocation().getPort() == destServerName.getPort());
  LOG.info("Put starting");
  Put put3=new Put(ROW);
  put3.addColumn(FAM_NAM,ROW,ROW);
  try {
    table.put(put3);
    Assert.fail("Unreachable point");
  }
 catch (  RetriesExhaustedWithDetailsException e) {
    LOG.info("Put done, exception caught: " + e.getClass());
    Assert.assertEquals(1,e.getNumExceptions());
    Assert.assertEquals(1,e.getCauses().size());
    Assert.assertArrayEquals(e.getRow(0).getRow(),ROW);
    Throwable cause=ClientExceptionsUtil.findException(e.getCause(0));
    Assert.assertNotNull(cause);
    Assert.assertTrue(cause instanceof RegionMovedException);
  }
  Assert.assertNotNull("Cached connection is null",conn.getCachedLocation(TABLE_NAME,ROW));
  Assert.assertEquals("Previous server was " + curServer.getServerName().getHostAndPort(),destServerName.getPort(),conn.getCachedLocation(TABLE_NAME,ROW).getRegionLocation().getPort());
  Assert.assertFalse(destServer.getRegionsInTransitionInRS().containsKey(encodedRegionNameBytes));
  Assert.assertFalse(curServer.getRegionsInTransitionInRS().containsKey(encodedRegionNameBytes));
  LOG.info("Move starting region=" + toMove.getRegionInfo().getRegionNameAsString());
  TEST_UTIL.getHBaseAdmin().move(toMove.getRegionInfo().getEncodedNameAsBytes(),curServer.getServerName().getServerName().getBytes());
  while (curServer.getOnlineRegion(regionName) == null || destServer.getRegionsInTransitionInRS().containsKey(encodedRegionNameBytes) || curServer.getRegionsInTransitionInRS().containsKey(encodedRegionNameBytes) || master.getAssignmentManager().getRegionStates().isRegionsInTransition()) {
    Thread.sleep(1);
  }
  Assert.assertNotNull(curServer.getOnlineRegion(regionName));
  Assert.assertNull(destServer.getOnlineRegion(regionName));
  LOG.info("Move finished for region=" + toMove.getRegionInfo().getRegionNameAsString());
  Assert.assertFalse(conn.getCachedLocation(TABLE_NAME,ROW).getRegionLocation().getPort() == curServer.getServerName().getPort());
  Scan sc=new Scan();
  sc.setStopRow(ROW);
  sc.setStartRow(ROW);
  TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_CLIENT_RETRIES_NUMBER,1);
  try {
    ResultScanner rs=table.getScanner(sc);
    while (rs.next() != null) {
    }
    Assert.fail("Unreachable point");
  }
 catch (  RetriesExhaustedException e) {
    LOG.info("Scan done, expected exception caught: " + e.getClass());
  }
  Assert.assertNotNull(conn.getCachedLocation(TABLE_NAME,ROW));
  Assert.assertEquals("Previous server was " + destServer.getServerName().getHostAndPort(),curServer.getServerName().getPort(),conn.getCachedLocation(TABLE_NAME,ROW).getRegionLocation().getPort());
  TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_CLIENT_RETRIES_NUMBER,HConstants.DEFAULT_HBASE_CLIENT_RETRIES_NUMBER);
  table.close();
  connection.close();
}

</code></pre>

<br>
<pre class="type-4 type-11 type-7 type-8 type-13 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that the connection to the dead server is cut immediately when we receive the
 * notification.
 * @throws Exception
 */
@Test public void testConnectionCut() throws Exception {
  TableName tableName=TableName.valueOf("HCM-testConnectionCut");
  TEST_UTIL.createTable(tableName,FAM_NAM).close();
  boolean previousBalance=TEST_UTIL.getHBaseAdmin().setBalancerRunning(false,true);
  Configuration c2=new Configuration(TEST_UTIL.getConfiguration());
  c2.set(HConstants.HBASE_CLIENT_INSTANCE_ID,String.valueOf(-1));
  c2.setInt(HConstants.HBASE_CLIENT_RETRIES_NUMBER,0);
  c2.setInt(HConstants.HBASE_RPC_TIMEOUT_KEY,30 * 1000);
  final Connection connection=ConnectionFactory.createConnection(c2);
  final Table table=connection.getTable(tableName);
  Put p=new Put(FAM_NAM);
  p.addColumn(FAM_NAM,FAM_NAM,FAM_NAM);
  table.put(p);
  final ConnectionImplementation hci=(ConnectionImplementation)connection;
  final HRegionLocation loc;
  try (RegionLocator rl=connection.getRegionLocator(tableName)){
    loc=rl.getRegionLocation(FAM_NAM);
  }
   Get get=new Get(FAM_NAM);
  Assert.assertNotNull(table.get(get));
  get=new Get(FAM_NAM);
  get.setFilter(new BlockingFilter());
  Thread t=new Thread(){
    @Override public void run(){
synchronized (syncBlockingFilter) {
        try {
          syncBlockingFilter.wait();
        }
 catch (        InterruptedException e) {
          throw new RuntimeException(e);
        }
      }
      hci.clusterStatusListener.deadServerHandler.newDead(loc.getServerName());
    }
  }
;
  t.start();
  try {
    table.get(get);
    Assert.fail();
  }
 catch (  IOException expected) {
    LOG.debug("Received: " + expected);
    Assert.assertFalse(expected instanceof SocketTimeoutException);
    Assert.assertFalse(syncBlockingFilter.get());
  }
 finally {
    syncBlockingFilter.set(true);
    t.join();
    TEST_UTIL.getHBaseAdmin().setBalancerRunning(previousBalance,true);
  }
  table.close();
  connection.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.client.TestIncrementsFromClientSide </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testIncrementInvalidArguments() throws Exception {
  LOG.info("Starting " + this.name.getMethodName());
  final TableName TABLENAME=TableName.valueOf(filterStringSoTableNameSafe(this.name.getMethodName()));
  Table ht=TEST_UTIL.createTable(TABLENAME,FAMILY);
  final byte[] COLUMN=Bytes.toBytes("column");
  try {
    ht.incrementColumnValue(null,FAMILY,COLUMN,5);
    fail("Should have thrown IOException");
  }
 catch (  IOException iox) {
  }
  try {
    ht.incrementColumnValue(ROW,null,COLUMN,5);
    fail("Should have thrown IOException");
  }
 catch (  IOException iox) {
  }
  try {
    ht.incrementColumnValue(ROW,FAMILY,null,5);
    fail("Should have thrown IOException");
  }
 catch (  IOException iox) {
  }
  try {
    Increment incNoRow=new Increment((byte[])null);
    incNoRow.addColumn(FAMILY,COLUMN,5);
    fail("Should have thrown IllegalArgumentException");
  }
 catch (  IllegalArgumentException iax) {
  }
catch (  NullPointerException npe) {
  }
  try {
    Increment incNoFamily=new Increment(ROW);
    incNoFamily.addColumn(null,COLUMN,5);
    fail("Should have thrown IllegalArgumentException");
  }
 catch (  IllegalArgumentException iax) {
  }
  try {
    Increment incNoQualifier=new Increment(ROW);
    incNoQualifier.addColumn(FAMILY,null,5);
    fail("Should have thrown IllegalArgumentException");
  }
 catch (  IllegalArgumentException iax) {
  }
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testIncrementingInvalidValue() throws Exception {
  LOG.info("Starting " + this.name.getMethodName());
  final TableName TABLENAME=TableName.valueOf(filterStringSoTableNameSafe(this.name.getMethodName()));
  Table ht=TEST_UTIL.createTable(TABLENAME,FAMILY);
  final byte[] COLUMN=Bytes.toBytes("column");
  Put p=new Put(ROW);
  p.addColumn(FAMILY,COLUMN,Bytes.toBytes(5));
  ht.put(p);
  try {
    ht.incrementColumnValue(ROW,FAMILY,COLUMN,5);
    fail("Should have thrown DoNotRetryIOException");
  }
 catch (  DoNotRetryIOException iox) {
  }
  Increment inc=new Increment(ROW);
  inc.addColumn(FAMILY,COLUMN,5);
  try {
    ht.increment(inc);
    fail("Should have thrown DoNotRetryIOException");
  }
 catch (  DoNotRetryIOException iox) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.client.TestMetaWithReplicas </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testAccessingUnknownTables() throws Exception {
  Configuration conf=new Configuration(TEST_UTIL.getConfiguration());
  conf.setBoolean(HConstants.USE_META_REPLICAS,true);
  Table table=TEST_UTIL.getConnection().getTable(TableName.valueOf("RandomTable"));
  Get get=new Get(Bytes.toBytes("foo"));
  try {
    table.get(get);
  }
 catch (  TableNotFoundException t) {
    return;
  }
  fail("Expected TableNotFoundException");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.client.TestMultiParallel </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=300000) public void testNonceCollision() throws Exception {
  LOG.info("test=testNonceCollision");
  final Connection connection=ConnectionFactory.createConnection(UTIL.getConfiguration());
  Table table=connection.getTable(TEST_TABLE);
  Put put=new Put(ONE_ROW);
  put.addColumn(BYTES_FAMILY,QUALIFIER,Bytes.toBytes(0L));
  NonceGenerator cnm=new PerClientRandomNonceGenerator(){
    long lastNonce=-1;
    @Override public synchronized long newNonce(){
      long nonce=0;
      if (lastNonce == -1) {
        lastNonce=nonce=super.newNonce();
      }
 else {
        nonce=lastNonce;
        lastNonce=-1L;
      }
      return nonce;
    }
  }
;
  NonceGenerator oldCnm=ConnectionUtils.injectNonceGeneratorForTesting((ClusterConnection)connection,cnm);
  try {
    Increment inc=new Increment(ONE_ROW);
    inc.addColumn(BYTES_FAMILY,QUALIFIER,1L);
    table.increment(inc);
    inc=new Increment(ONE_ROW);
    inc.addColumn(BYTES_FAMILY,QUALIFIER,1L);
    try {
      table.increment(inc);
      fail("Should have thrown an exception");
    }
 catch (    OperationConflictException ex) {
    }
    Get get=new Get(ONE_ROW);
    get.addColumn(BYTES_FAMILY,QUALIFIER);
    Result result=table.get(get);
    validateResult(result,QUALIFIER,Bytes.toBytes(1L));
    int numRequests=40;
    final CountDownLatch startedLatch=new CountDownLatch(numRequests);
    final CountDownLatch startLatch=new CountDownLatch(1);
    final CountDownLatch doneLatch=new CountDownLatch(numRequests);
    for (int i=0; i < numRequests; ++i) {
      Runnable r=new Runnable(){
        @Override public void run(){
          Table table=null;
          try {
            table=connection.getTable(TEST_TABLE);
          }
 catch (          IOException e) {
            fail("Not expected");
          }
          Increment inc=new Increment(ONE_ROW);
          inc.addColumn(BYTES_FAMILY,QUALIFIER,1L);
          startedLatch.countDown();
          try {
            startLatch.await();
          }
 catch (          InterruptedException e) {
            fail("Not expected");
          }
          try {
            table.increment(inc);
          }
 catch (          OperationConflictException ex) {
          }
catch (          IOException ioEx) {
            fail("Not expected");
          }
          doneLatch.countDown();
        }
      }
;
      Threads.setDaemonThreadRunning(new Thread(r));
    }
    startedLatch.await();
    startLatch.countDown();
    doneLatch.await();
    get=new Get(ONE_ROW);
    get.addColumn(BYTES_FAMILY,QUALIFIER);
    result=table.get(get);
    validateResult(result,QUALIFIER,Bytes.toBytes((numRequests / 2) + 1L));
    table.close();
  }
  finally {
    ConnectionImplementation.injectNonceGeneratorForTesting((ClusterConnection)connection,oldCnm);
  }
}

</code></pre>

<br>
<pre class="type-4 type-11 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBadFam() throws Exception {
  LOG.info("test=testBadFam");
  Table table=UTIL.getConnection().getTable(TEST_TABLE);
  List<Row> actions=new ArrayList<Row>();
  Put p=new Put(Bytes.toBytes("row1"));
  p.addColumn(Bytes.toBytes("bad_family"),Bytes.toBytes("qual"),Bytes.toBytes("value"));
  actions.add(p);
  p=new Put(Bytes.toBytes("row2"));
  p.addColumn(BYTES_FAMILY,Bytes.toBytes("qual"),Bytes.toBytes("value"));
  actions.add(p);
  Object[] r=new Object[actions.size()];
  try {
    table.batch(actions,r);
    fail();
  }
 catch (  RetriesExhaustedWithDetailsException ex) {
    LOG.debug(ex);
    assertFalse(ex.mayHaveClusterIssues());
  }
  assertEquals(2,r.length);
  assertTrue(r[0] instanceof Throwable);
  assertTrue(r[1] instanceof Result);
  table.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.client.TestRestoreSnapshotFromClient </h4><pre class="type-11 type-7 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCorruptedSnapshot() throws IOException, InterruptedException {
  SnapshotTestingUtils.corruptSnapshot(TEST_UTIL,Bytes.toString(snapshotName0));
  TableName cloneName=TableName.valueOf("corruptedClone-" + System.currentTimeMillis());
  try {
    admin.cloneSnapshot(snapshotName0,cloneName);
    fail("Expected CorruptedSnapshotException, got succeeded cloneSnapshot()");
  }
 catch (  CorruptedSnapshotException e) {
    assertFalse(admin.tableExists(cloneName));
  }
catch (  Exception e) {
    fail("Expected CorruptedSnapshotException got: " + e);
  }
}

</code></pre>

<br>
<pre class="type-4 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRestoreSchemaChange() throws Exception {
  Table table=TEST_UTIL.getConnection().getTable(tableName);
  admin.disableTable(tableName);
  admin.addColumnFamily(tableName,getTestRestoreSchemaChangeHCD());
  admin.enableTable(tableName);
  assertEquals(2,table.getTableDescriptor().getFamilies().size());
  HTableDescriptor htd=admin.getTableDescriptor(tableName);
  assertEquals(2,htd.getFamilies().size());
  SnapshotTestingUtils.loadData(TEST_UTIL,tableName,500,TEST_FAMILY2);
  long snapshot2Rows=snapshot1Rows + 500;
  assertEquals(snapshot2Rows,countRows(table));
  assertEquals(500,countRows(table,TEST_FAMILY2));
  Set<String> fsFamilies=getFamiliesFromFS(tableName);
  assertEquals(2,fsFamilies.size());
  admin.disableTable(tableName);
  admin.snapshot(snapshotName2,tableName);
  admin.restoreSnapshot(snapshotName0);
  admin.enableTable(tableName);
  assertEquals(1,table.getTableDescriptor().getFamilies().size());
  try {
    countRows(table,TEST_FAMILY2);
    fail("family '" + Bytes.toString(TEST_FAMILY2) + "' should not exists");
  }
 catch (  NoSuchColumnFamilyException e) {
  }
  assertEquals(snapshot0Rows,countRows(table));
  htd=admin.getTableDescriptor(tableName);
  assertEquals(1,htd.getFamilies().size());
  fsFamilies=getFamiliesFromFS(tableName);
  assertEquals(1,fsFamilies.size());
  admin.disableTable(tableName);
  admin.restoreSnapshot(snapshotName2);
  admin.enableTable(tableName);
  htd=admin.getTableDescriptor(tableName);
  assertEquals(2,htd.getFamilies().size());
  assertEquals(2,table.getTableDescriptor().getFamilies().size());
  assertEquals(500,countRows(table,TEST_FAMILY2));
  assertEquals(snapshot2Rows,countRows(table));
  fsFamilies=getFamiliesFromFS(tableName);
  assertEquals(2,fsFamilies.size());
  table.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.client.TestScan </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testSetAuthorizations(){
  Scan scan=new Scan();
  try {
    scan.setAuthorizations(new Authorizations("\u002b|\u0029"));
    scan.setAuthorizations(new Authorizations("A","B","0123","A0","1A1","_a"));
    scan.setAuthorizations(new Authorizations("A|B"));
    scan.setAuthorizations(new Authorizations("A&B"));
    scan.setAuthorizations(new Authorizations("!B"));
    scan.setAuthorizations(new Authorizations("A","(A)"));
    scan.setAuthorizations(new Authorizations("A","{A"));
    scan.setAuthorizations(new Authorizations(" "));
    scan.setAuthorizations(new Authorizations(":B"));
    scan.setAuthorizations(new Authorizations("-B"));
    scan.setAuthorizations(new Authorizations(".B"));
    scan.setAuthorizations(new Authorizations("/B"));
  }
 catch (  IllegalArgumentException e) {
    fail("should not throw exception");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.client.TestScannerTimeout </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Test that we do get a ScannerTimeoutException
 * @throws Exception
 */
@Test(timeout=300000) public void test2481() throws Exception {
  LOG.info("START ************ test2481");
  Scan scan=new Scan();
  scan.setCaching(1);
  Table table=TEST_UTIL.getConnection().getTable(TABLE_NAME);
  ResultScanner r=table.getScanner(scan);
  int count=0;
  try {
    Result res=r.next();
    while (res != null) {
      count++;
      if (count == 5) {
        Thread.sleep(SCANNER_TIMEOUT + THREAD_WAKE_FREQUENCY + 100);
      }
      res=r.next();
    }
  }
 catch (  ScannerTimeoutException e) {
    LOG.info("Got the timeout " + e.getMessage(),e);
    return;
  }
 finally {
    table.close();
  }
  fail("We should be timing out");
  LOG.info("END ************ test2481");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.client.TestSnapshotFromClient </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Test snapshotting not allowed hbase:meta and -ROOT-
 * @throws Exception
 */
@Test(timeout=300000) public void testMetaTablesSnapshot() throws Exception {
  Admin admin=UTIL.getHBaseAdmin();
  byte[] snapshotName=Bytes.toBytes("metaSnapshot");
  try {
    admin.snapshot(snapshotName,TableName.META_TABLE_NAME);
    fail("taking a snapshot of hbase:meta should not be allowed");
  }
 catch (  IllegalArgumentException e) {
  }
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=300000) public void testSnapshotFailsOnNonExistantTable() throws Exception {
  Admin admin=UTIL.getHBaseAdmin();
  SnapshotTestingUtils.assertNoSnapshots(admin);
  String tableName="_not_a_table";
  boolean fail=false;
  do {
    try {
      admin.getTableDescriptor(TableName.valueOf(tableName));
      fail=true;
      LOG.error("Table:" + tableName + " already exists, checking a new name");
      tableName=tableName + "!";
    }
 catch (    TableNotFoundException e) {
      fail=false;
    }
  }
 while (fail);
  try {
    admin.snapshot("fail",TableName.valueOf(tableName));
    fail("Snapshot succeeded even though there is not table.");
  }
 catch (  SnapshotCreationException e) {
    LOG.info("Correctly failed to snapshot a non-existant table:" + e.getMessage());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.client.replication.TestReplicationAdmin </h4><pre class="type-4 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAddPeerWithUnDeletedQueues() throws Exception {
  Configuration conf=TEST_UTIL.getConfiguration();
  ZooKeeperWatcher zkw=new ZooKeeperWatcher(conf,"Test HBaseAdmin",null);
  ReplicationQueues repQueues=ReplicationFactory.getReplicationQueues(zkw,conf,null);
  repQueues.init("server1");
  repQueues.addLog(ID_ONE,"file1");
  try {
    admin.addPeer(ID_ONE,KEY_ONE);
    fail();
  }
 catch (  ReplicationException e) {
  }
  repQueues.removeQueue(ID_ONE);
  assertEquals(0,repQueues.getAllQueues().size());
  repQueues.addLog(ID_ONE + "-server2","file1");
  try {
    admin.addPeer(ID_ONE,KEY_ONE);
    fail();
  }
 catch (  ReplicationException e) {
  }
  repQueues.removeAllQueues();
  zkw.close();
}

</code></pre>

<br>
<pre class="type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Simple testing of adding and removing peers, basically shows that
 * all interactions with ZK work
 * @throws Exception
 */
@Test public void testAddRemovePeer() throws Exception {
  admin.addPeer(ID_ONE,KEY_ONE);
  try {
    admin.addPeer(ID_ONE,KEY_ONE);
  }
 catch (  IllegalArgumentException iae) {
  }
  assertEquals(1,admin.getPeersCount());
  try {
    admin.removePeer(ID_SECOND);
    fail();
  }
 catch (  IllegalArgumentException iae) {
  }
  assertEquals(1,admin.getPeersCount());
  try {
    admin.addPeer(ID_SECOND,KEY_SECOND);
  }
 catch (  IllegalStateException iae) {
    fail();
  }
  assertEquals(2,admin.getPeersCount());
  admin.removePeer(ID_ONE);
  assertEquals(1,admin.getPeersCount());
  admin.removePeer(ID_SECOND);
  assertEquals(0,admin.getPeersCount());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.client.replication.TestReplicationAdminWithClusters </h4><pre class="type-11 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=300000) public void testEnableReplicationWhenTableDescriptorIsNotSameInClusters() throws Exception {
  HTableDescriptor table=admin2.getTableDescriptor(tableName);
  HColumnDescriptor f=new HColumnDescriptor("newFamily");
  table.addFamily(f);
  admin2.disableTable(tableName);
  admin2.modifyTable(tableName,table);
  admin2.enableTable(tableName);
  try {
    adminExt.enableTableRep(tableName);
    fail("Exception should be thrown if table descriptors in the clusters are not same.");
  }
 catch (  RuntimeException ignored) {
  }
  admin1.disableTable(tableName);
  admin1.modifyTable(tableName,table);
  admin1.enableTable(tableName);
  adminExt.enableTableRep(tableName);
  table=admin1.getTableDescriptor(tableName);
  for (  HColumnDescriptor fam : table.getColumnFamilies()) {
    assertEquals(fam.getScope(),HConstants.REPLICATION_SCOPE_GLOBAL);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.constraint.TestConstraint </h4><pre class="type-4 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that constraints will fail properly
 * @throws Exception
 */
@SuppressWarnings("unchecked") @Test(timeout=60000) public void testConstraintFails() throws Exception {
  HTableDescriptor desc=new HTableDescriptor(tableName);
  for (  byte[] family : new byte[][]{dummy,test}) {
    desc.addFamily(new HColumnDescriptor(family));
  }
  Constraints.add(desc,AllFailConstraint.class);
  util.getHBaseAdmin().createTable(desc);
  Table table=util.getConnection().getTable(tableName);
  Put put=new Put(row1);
  byte[] qualifier=new byte[0];
  put.addColumn(dummy,qualifier,"fail".getBytes());
  LOG.warn("Doing put in table");
  try {
    table.put(put);
    fail("This put should not have suceeded - AllFailConstraint was not run!");
  }
 catch (  RetriesExhaustedWithDetailsException e) {
    List<Throwable> causes=e.getCauses();
    assertEquals("More than one failure cause - should only be the failure constraint exception",1,causes.size());
    Throwable t=causes.get(0);
    assertEquals(ConstraintException.class,t.getClass());
  }
  table.close();
}

</code></pre>

<br>
<pre class="type-11 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Check to make sure a constraint is unloaded when it fails
 * @throws Exception
 */
@Test public void testIsUnloaded() throws Exception {
  HTableDescriptor desc=new HTableDescriptor(tableName);
  for (  byte[] family : new byte[][]{dummy,test}) {
    desc.addFamily(new HColumnDescriptor(family));
  }
  Constraints.add(desc,RuntimeFailConstraint.class);
  Constraints.add(desc,CheckWasRunConstraint.class);
  CheckWasRunConstraint.wasRun=false;
  util.getHBaseAdmin().createTable(desc);
  Table table=util.getConnection().getTable(tableName);
  Put put=new Put(row1);
  byte[] qualifier=new byte[0];
  put.addColumn(dummy,qualifier,"pass".getBytes());
  try {
    table.put(put);
    fail("RuntimeFailConstraint wasn't triggered - this put shouldn't work!");
  }
 catch (  Exception e) {
  }
  table.put(put);
  assertFalse(CheckWasRunConstraint.wasRun);
  table.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.constraint.TestConstraints </h4><pre class="type-4 type-11 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@SuppressWarnings("unchecked") @Test public void testReadWriteWithConf() throws Throwable {
  HTableDescriptor desc=new HTableDescriptor(TableName.valueOf("table"));
  Constraints.add(desc,new Pair<Class<? extends Constraint>,Configuration>(CheckConfigurationConstraint.class,CheckConfigurationConstraint.getConfiguration()));
  List<? extends Constraint> c=Constraints.getConstraints(desc,this.getClass().getClassLoader());
  assertEquals(1,c.size());
  assertEquals(CheckConfigurationConstraint.class,c.get(0).getClass());
  Constraints.add(desc,new Pair<Class<? extends Constraint>,Configuration>(CheckConfigurationConstraint.class,new Configuration(false)));
  try {
    Constraints.getConstraints(desc,this.getClass().getClassLoader());
    fail("No exception thrown  - configuration not overwritten");
  }
 catch (  IllegalArgumentException e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.coprocessor.TestCoprocessorEndpoint </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testCoprocessorError() throws Exception {
  Configuration configuration=new Configuration(util.getConfiguration());
  configuration.setInt(HConstants.HBASE_CLIENT_RETRIES_NUMBER,1);
  Table table=util.getConnection().getTable(TEST_TABLE);
  try {
    CoprocessorRpcChannel protocol=table.coprocessorService(ROWS[0]);
    TestRpcServiceProtos.TestProtobufRpcProto.BlockingInterface service=TestRpcServiceProtos.TestProtobufRpcProto.newBlockingStub(protocol);
    service.error(null,TestProtos.EmptyRequestProto.getDefaultInstance());
    fail("Should have thrown an exception");
  }
 catch (  ServiceException e) {
  }
 finally {
    table.close();
  }
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testMasterCoprocessorError() throws Throwable {
  Admin admin=util.getHBaseAdmin();
  TestRpcServiceProtos.TestProtobufRpcProto.BlockingInterface service=TestRpcServiceProtos.TestProtobufRpcProto.newBlockingStub(admin.coprocessorService());
  try {
    service.error(null,TestProtos.EmptyRequestProto.getDefaultInstance());
    fail("Should have thrown an exception");
  }
 catch (  ServiceException e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.coprocessor.TestCoprocessorInterface </h4><pre class="type-4 type-9 type-11 type-7 type-8 type-13 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSharedData() throws IOException {
  TableName tableName=TableName.valueOf(name.getMethodName());
  byte[][] families={fam1,fam2,fam3};
  Configuration hc=initSplit();
  Region region=initHRegion(tableName,name.getMethodName(),hc,new Class<?>[]{},families);
  for (int i=0; i < 3; i++) {
    HBaseTestCase.addContent(region,fam3);
    region.flush(true);
  }
  region.compact(false);
  byte[] splitRow=((HRegion)region).checkSplit();
  assertNotNull(splitRow);
  Region[] regions=split(region,splitRow);
  for (int i=0; i < regions.length; i++) {
    regions[i]=reopenRegion(regions[i],CoprocessorImpl.class,CoprocessorII.class);
  }
  Coprocessor c=regions[0].getCoprocessorHost().findCoprocessor(CoprocessorImpl.class.getName());
  Coprocessor c2=regions[0].getCoprocessorHost().findCoprocessor(CoprocessorII.class.getName());
  Object o=((CoprocessorImpl)c).getSharedData().get("test1");
  Object o2=((CoprocessorII)c2).getSharedData().get("test2");
  assertNotNull(o);
  assertNotNull(o2);
  assertFalse(((CoprocessorImpl)c).getSharedData() == ((CoprocessorII)c2).getSharedData());
  for (int i=1; i < regions.length; i++) {
    c=regions[i].getCoprocessorHost().findCoprocessor(CoprocessorImpl.class.getName());
    c2=regions[i].getCoprocessorHost().findCoprocessor(CoprocessorII.class.getName());
    assertTrue(((CoprocessorImpl)c).getSharedData().get("test1") == o);
    assertTrue(((CoprocessorII)c2).getSharedData().get("test2") == o2);
  }
  for (int i=0; i < regions.length; i++) {
    try {
      byte[] r=regions[i].getRegionInfo().getStartKey();
      if (r == null || r.length <= 0) {
        r=new byte[]{0};
      }
      Get g=new Get(r);
      regions[i].get(g);
      fail();
    }
 catch (    org.apache.hadoop.hbase.DoNotRetryIOException xc) {
    }
    assertNull(regions[i].getCoprocessorHost().findCoprocessor(CoprocessorII.class.getName()));
  }
  c=regions[0].getCoprocessorHost().findCoprocessor(CoprocessorImpl.class.getName());
  assertTrue(((CoprocessorImpl)c).getSharedData().get("test1") == o);
  c=c2=null;
  System.gc();
  region=reopenRegion(regions[0],CoprocessorImpl.class,CoprocessorII.class);
  c=region.getCoprocessorHost().findCoprocessor(CoprocessorImpl.class.getName());
  assertTrue(((CoprocessorImpl)c).getSharedData().get("test1") == o);
  c2=region.getCoprocessorHost().findCoprocessor(CoprocessorII.class.getName());
  Object o3=((CoprocessorII)c2).getSharedData().get("test2");
  assertFalse(o3 == o2);
  HBaseTestingUtility.closeRegionAndWAL(region);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.coprocessor.TestMasterCoprocessorExceptionWithAbort </h4><pre class="type-9 type-11 type-7 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testExceptionFromCoprocessorWhenCreatingTable() throws IOException {
  MiniHBaseCluster cluster=UTIL.getHBaseCluster();
  HMaster master=cluster.getMaster();
  MasterCoprocessorHost host=master.getMasterCoprocessorHost();
  BuggyMasterObserver cp=(BuggyMasterObserver)host.findCoprocessor(BuggyMasterObserver.class.getName());
  assertFalse("No table created yet",cp.wasCreateTableCalled());
  ZooKeeperWatcher zkw=new ZooKeeperWatcher(UTIL.getConfiguration(),"unittest",new Abortable(){
    @Override public void abort(    String why,    Throwable e){
      throw new RuntimeException("Fatal ZK error: " + why,e);
    }
    @Override public boolean isAborted(){
      return false;
    }
  }
);
  MasterTracker masterTracker=new MasterTracker(zkw,"/hbase/master",new Abortable(){
    @Override public void abort(    String why,    Throwable e){
      throw new RuntimeException("Fatal ZK master tracker error, why=",e);
    }
    @Override public boolean isAborted(){
      return false;
    }
  }
);
  masterTracker.start();
  zkw.registerListener(masterTracker);
  assertTrue(HMaster.getLoadedCoprocessors().contains(TestMasterCoprocessorExceptionWithAbort.BuggyMasterObserver.class.getName()));
  CreateTableThread createTableThread=new CreateTableThread(UTIL);
  createTableThread.start();
  for (int i=0; i < 30; i++) {
    if (masterTracker.masterZKNodeWasDeleted == true) {
      break;
    }
    try {
      Thread.sleep(1000);
    }
 catch (    InterruptedException e) {
      fail("InterruptedException while waiting for master zk node to " + "be deleted.");
    }
  }
  assertTrue("Master aborted on coprocessor exception, as expected.",masterTracker.masterZKNodeWasDeleted);
  createTableThread.interrupt();
  try {
    createTableThread.join(1000);
  }
 catch (  InterruptedException e) {
    assertTrue("Ignoring InterruptedException while waiting for " + " createTableThread.join().",true);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.coprocessor.TestMasterCoprocessorExceptionWithRemove </h4><pre class="type-11 type-7 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=30000) public void testExceptionFromCoprocessorWhenCreatingTable() throws IOException {
  MiniHBaseCluster cluster=UTIL.getHBaseCluster();
  HMaster master=cluster.getMaster();
  MasterCoprocessorHost host=master.getMasterCoprocessorHost();
  BuggyMasterObserver cp=(BuggyMasterObserver)host.findCoprocessor(BuggyMasterObserver.class.getName());
  assertFalse("No table created yet",cp.wasCreateTableCalled());
  ZooKeeperWatcher zkw=new ZooKeeperWatcher(UTIL.getConfiguration(),"unittest",new Abortable(){
    @Override public void abort(    String why,    Throwable e){
      throw new RuntimeException("Fatal ZK error: " + why,e);
    }
    @Override public boolean isAborted(){
      return false;
    }
  }
);
  MasterTracker masterTracker=new MasterTracker(zkw,"/hbase/master",new Abortable(){
    @Override public void abort(    String why,    Throwable e){
      throw new RuntimeException("Fatal Zookeeper tracker error, why=",e);
    }
    @Override public boolean isAborted(){
      return false;
    }
  }
);
  masterTracker.start();
  zkw.registerListener(masterTracker);
  String coprocessorName=BuggyMasterObserver.class.getName();
  assertTrue(HMaster.getLoadedCoprocessors().contains(coprocessorName));
  HTableDescriptor htd1=new HTableDescriptor(TableName.valueOf(TEST_TABLE1));
  htd1.addFamily(new HColumnDescriptor(TEST_FAMILY1));
  boolean threwDNRE=false;
  try {
    Admin admin=UTIL.getHBaseAdmin();
    admin.createTable(htd1);
  }
 catch (  IOException e) {
    if (e.getClass().getName().equals("org.apache.hadoop.hbase.DoNotRetryIOException")) {
      threwDNRE=true;
    }
  }
 finally {
    assertTrue(threwDNRE);
  }
  try {
    Thread.sleep(3000);
  }
 catch (  InterruptedException e) {
    fail("InterruptedException while sleeping.");
  }
  assertFalse("Master survived coprocessor NPE, as expected.",masterTracker.masterZKNodeWasDeleted);
  String loadedCoprocessors=HMaster.getLoadedCoprocessors();
  assertTrue(loadedCoprocessors.contains(coprocessorName));
  HTableDescriptor htd2=new HTableDescriptor(TableName.valueOf(TEST_TABLE2));
  htd2.addFamily(new HColumnDescriptor(TEST_FAMILY2));
  Admin admin=UTIL.getHBaseAdmin();
  try {
    admin.createTable(htd2);
  }
 catch (  IOException e) {
    fail("Failed to create table after buggy coprocessor removal: " + e);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.coprocessor.TestRegionServerCoprocessorExceptionWithAbort </h4><pre class="type-9 type-11 type-7 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testExceptionFromCoprocessorDuringPut() throws Exception {
  Configuration conf=TEST_UTIL.getConfiguration();
  conf.setInt(HConstants.HBASE_CLIENT_RETRIES_NUMBER,2);
  conf.set(CoprocessorHost.REGION_COPROCESSOR_CONF_KEY,BuggyRegionObserver.class.getName());
  conf.setBoolean(CoprocessorHost.ABORT_ON_ERROR_KEY,true);
  TEST_UTIL.startMiniCluster(2);
  try {
    final byte[] TEST_FAMILY=Bytes.toBytes("aaa");
    Table table=TEST_UTIL.createMultiRegionTable(TABLE_NAME,TEST_FAMILY);
    TEST_UTIL.waitUntilAllRegionsAssigned(TABLE_NAME);
    final HRegionServer regionServer=TEST_UTIL.getRSForFirstRegionInTable(TABLE_NAME);
    try {
      final byte[] ROW=Bytes.toBytes("aaa");
      Put put=new Put(ROW);
      put.addColumn(TEST_FAMILY,ROW,ROW);
      table.put(put);
    }
 catch (    IOException e) {
    }
    boolean aborted=false;
    for (int i=0; i < 10; i++) {
      aborted=regionServer.isAborted();
      if (aborted) {
        break;
      }
      try {
        Thread.sleep(1000);
      }
 catch (      InterruptedException e) {
        fail("InterruptedException while waiting for regionserver " + "zk node to be deleted.");
      }
    }
    Assert.assertTrue("The region server should have aborted",aborted);
    table.close();
  }
  finally {
    TEST_UTIL.shutdownMiniCluster();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.coprocessor.TestRegionServerCoprocessorExceptionWithRemove </h4><pre class="type-9 type-11 type-7 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testExceptionFromCoprocessorDuringPut() throws IOException, InterruptedException {
  TableName TEST_TABLE=TableName.valueOf("observed_table");
  byte[] TEST_FAMILY=Bytes.toBytes("aaa");
  Table table=TEST_UTIL.createMultiRegionTable(TEST_TABLE,TEST_FAMILY);
  TEST_UTIL.waitUntilAllRegionsAssigned(TEST_TABLE);
  HRegionServer regionServer=TEST_UTIL.getRSForFirstRegionInTable(TEST_TABLE);
  boolean threwIOE=false;
  try {
    final byte[] ROW=Bytes.toBytes("aaa");
    Put put=new Put(ROW);
    put.addColumn(TEST_FAMILY,ROW,ROW);
    table.put(put);
    table.put(put);
  }
 catch (  IOException e) {
    threwIOE=true;
  }
 finally {
    assertTrue("The regionserver should have thrown an exception",threwIOE);
  }
  for (int i=0; i < 10; i++) {
    assertFalse(regionServer.isAborted());
    try {
      Thread.sleep(1000);
    }
 catch (    InterruptedException e) {
      fail("InterruptedException while waiting for regionserver " + "zk node to be deleted.");
    }
  }
  table.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.errorhandling.TestForeignExceptionDispatcher </h4><pre class="type-11 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that a dispatcher only dispatches only the first exception, and does not propagate
 * subsequent exceptions.
 */
@Test public void testErrorPropagation(){
  ForeignExceptionListener listener1=Mockito.mock(ForeignExceptionListener.class);
  ForeignExceptionListener listener2=Mockito.mock(ForeignExceptionListener.class);
  ForeignExceptionDispatcher dispatcher=new ForeignExceptionDispatcher();
  dispatcher.addListener(listener1);
  dispatcher.addListener(listener2);
  dispatcher.receive(EXTEXN);
  Mockito.verify(listener1,Mockito.times(1)).receive(EXTEXN);
  Mockito.verify(listener2,Mockito.times(1)).receive(EXTEXN);
  try {
    dispatcher.rethrowException();
    fail("Monitor should have thrown an exception after getting error.");
  }
 catch (  ForeignException ex) {
    assertTrue("Got an unexpected exception:" + ex,ex.getCause() == EXTEXN.getCause());
    LOG.debug("Got the testing exception!");
  }
  dispatcher.receive(EXTEXN2);
  Mockito.verify(listener1,Mockito.never()).receive(EXTEXN2);
  Mockito.verify(listener2,Mockito.never()).receive(EXTEXN2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.errorhandling.TestTimeoutExceptionInjector </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Demonstrate TimeoutExceptionInjector semantics -- completion means no more exceptions passed to
 * error listener.
 */
@Test(timeout=60000) public void testStartAfterComplete() throws InterruptedException {
  final long time=10;
  ForeignExceptionListener listener=Mockito.mock(ForeignExceptionListener.class);
  TimeoutExceptionInjector timer=new TimeoutExceptionInjector(listener,time);
  timer.complete();
  try {
    timer.start();
    fail("Timer should fail to start after complete.");
  }
 catch (  IllegalStateException e) {
    LOG.debug("Correctly failed timer: " + e.getMessage());
  }
  Thread.sleep(time + 1);
  Mockito.verifyZeroInteractions(listener);
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Demonstrate TimeoutExceptionInjector semantics -- triggering fires exception and completes
 * the timer.
 */
@Test(timeout=60000) public void testStartAfterTrigger() throws InterruptedException {
  final long time=10;
  ForeignExceptionListener listener=Mockito.mock(ForeignExceptionListener.class);
  TimeoutExceptionInjector timer=new TimeoutExceptionInjector(listener,time);
  timer.trigger();
  try {
    timer.start();
    fail("Timer should fail to start after complete.");
  }
 catch (  IllegalStateException e) {
    LOG.debug("Correctly failed timer: " + e.getMessage());
  }
  Thread.sleep(time * 2);
  Mockito.verify(listener,Mockito.times(1)).receive(Mockito.any(ForeignException.class));
  Mockito.verifyNoMoreInteractions(listener);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.http.TestHttpServerWebapps </h4><pre class="type-11 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test that an invalid webapp triggers an exception
 * @throws Throwable if something went wrong
 */
@Test public void testMissingServerResource() throws Throwable {
  try {
    HttpServer server=createServer("NoSuchWebapp");
    String serverDescription=server.toString();
    stop(server);
    fail("Expected an exception, got " + serverDescription);
  }
 catch (  FileNotFoundException expected) {
    log.debug("Expected exception " + expected,expected);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.http.TestServletFilter </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Similar to the above test case, except that it uses a different API to add the
 * filter. Regression test for HADOOP-8786.
 */
@Test public void testContextSpecificServletFilterWhenInitThrowsException() throws Exception {
  Configuration conf=new Configuration();
  HttpServer http=createTestServer(conf);
  HttpServer.defineFilter(http.webAppContext,"ErrorFilter",ErrorFilter.class.getName(),null,null);
  try {
    http.start();
    fail("expecting exception");
  }
 catch (  IOException e) {
    GenericTestUtils.assertExceptionContains("Unable to initialize WebAppContext",e);
  }
}

</code></pre>

<br>
<pre class="type-11 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testServletFilterWhenInitThrowsException() throws Exception {
  Configuration conf=new Configuration();
  conf.set(HttpServer.FILTER_INITIALIZERS_PROPERTY,ErrorFilter.Initializer.class.getName());
  HttpServer http=createTestServer(conf);
  try {
    http.start();
    fail("expecting exception");
  }
 catch (  IOException e) {
    assertTrue(e.getMessage().contains("Problem in starting http server. Server handlers failed"));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.http.conf.TestConfServlet </h4><pre class="type-11 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBadFormat() throws Exception {
  StringWriter sw=new StringWriter();
  try {
    ConfServlet.writeResponse(getTestConf(),sw,"not a format");
    fail("writeResponse with bad format didn't throw!");
  }
 catch (  ConfServlet.BadFormatException bfe) {
  }
  assertEquals("",sw.toString());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.io.encoding.TestDataBlockEncoders </h4><pre class="type-4 type-9 type-10 type-11 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testNextOnSample() throws IOException {
  List<KeyValue> sampleKv=generator.generateTestKeyValues(NUMBER_OF_KV,includesTags);
  for (  DataBlockEncoding encoding : DataBlockEncoding.values()) {
    if (this.useOffheapData && encoding == DataBlockEncoding.PREFIX_TREE)     continue;
    if (encoding.getEncoder() == null) {
      continue;
    }
    DataBlockEncoder encoder=encoding.getEncoder();
    ByteBuffer encodedBuffer=encodeKeyValues(encoding,sampleKv,getEncodingContext(Compression.Algorithm.NONE,encoding),this.useOffheapData);
    HFileContext meta=new HFileContextBuilder().withHBaseCheckSum(false).withIncludesMvcc(includesMemstoreTS).withIncludesTags(includesTags).withCompression(Compression.Algorithm.NONE).build();
    DataBlockEncoder.EncodedSeeker seeker=encoder.createSeeker(CellComparator.COMPARATOR,encoder.newDataBlockDecodingContext(meta));
    seeker.setCurrentBuffer(new SingleByteBuff(encodedBuffer));
    int i=0;
    do {
      KeyValue expectedKeyValue=sampleKv.get(i);
      Cell cell=seeker.getCell();
      if (CellComparator.COMPARATOR.compareKeyIgnoresMvcc(expectedKeyValue,cell) != 0) {
        int commonPrefix=CellUtil.findCommonPrefixInFlatKey(expectedKeyValue,cell,false,true);
        fail(String.format("next() produces wrong results " + "encoder: %s i: %d commonPrefix: %d" + "\n expected %s\n actual      %s",encoder.toString(),i,commonPrefix,Bytes.toStringBinary(expectedKeyValue.getBuffer(),expectedKeyValue.getKeyOffset(),expectedKeyValue.getKeyLength()),CellUtil.toString(cell,false)));
      }
      i++;
    }
 while (seeker.next());
  }
}

</code></pre>

<br>
<pre class="type-4 type-10 type-11 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
"></span><br>
/** 
 * Test whether the decompression of first key is implemented correctly.
 * @throws IOException
 */
@Test public void testFirstKeyInBlockOnSample() throws IOException {
  List<KeyValue> sampleKv=generator.generateTestKeyValues(NUMBER_OF_KV,includesTags);
  for (  DataBlockEncoding encoding : DataBlockEncoding.values()) {
    if (this.useOffheapData && encoding == DataBlockEncoding.PREFIX_TREE)     continue;
    if (encoding.getEncoder() == null) {
      continue;
    }
    DataBlockEncoder encoder=encoding.getEncoder();
    ByteBuffer encodedBuffer=encodeKeyValues(encoding,sampleKv,getEncodingContext(Compression.Algorithm.NONE,encoding),this.useOffheapData);
    Cell key=encoder.getFirstKeyCellInBlock(new SingleByteBuff(encodedBuffer));
    KeyValue firstKv=sampleKv.get(0);
    if (0 != CellComparator.COMPARATOR.compareKeyIgnoresMvcc(key,firstKv)) {
      int commonPrefix=CellUtil.findCommonPrefixInFlatKey(key,firstKv,false,true);
      fail(String.format("Bug in '%s' commonPrefix %d",encoder.toString(),commonPrefix));
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.io.encoding.TestPrefixTreeEncoding </h4><pre class="type-4 type-9 type-10 type-11 type-7 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testScanWithRandomData() throws Exception {
  PrefixTreeCodec encoder=new PrefixTreeCodec();
  ByteArrayOutputStream baosInMemory=new ByteArrayOutputStream();
  DataOutputStream userDataStream=new DataOutputStream(baosInMemory);
  HFileContext meta=new HFileContextBuilder().withHBaseCheckSum(false).withIncludesMvcc(false).withIncludesTags(includesTag).withCompression(Algorithm.NONE).build();
  HFileBlockEncodingContext blkEncodingCtx=new HFileBlockDefaultEncodingContext(DataBlockEncoding.PREFIX_TREE,new byte[0],meta);
  generateRandomTestData(kvset,numBatchesWritten++,includesTag,encoder,blkEncodingCtx,userDataStream);
  EncodedSeeker seeker=encoder.createSeeker(CellComparator.COMPARATOR,encoder.newDataBlockDecodingContext(meta));
  byte[] onDiskBytes=baosInMemory.toByteArray();
  ByteBuffer readBuffer=ByteBuffer.wrap(onDiskBytes,DataBlockEncoding.ID_SIZE,onDiskBytes.length - DataBlockEncoding.ID_SIZE);
  seeker.setCurrentBuffer(new SingleByteBuff(readBuffer));
  Cell previousKV=null;
  do {
    Cell currentKV=seeker.getCell();
    System.out.println(currentKV);
    if (previousKV != null && CellComparator.COMPARATOR.compare(currentKV,previousKV) < 0) {
      dumpInputKVSet();
      fail("Current kv " + currentKV + " is smaller than previous keyvalue "+ previousKV);
    }
    if (!includesTag) {
      assertFalse(currentKV.getTagsLength() > 0);
    }
 else {
      Assert.assertTrue(currentKV.getTagsLength() > 0);
    }
    previousKV=currentKV;
  }
 while (seeker.next());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.io.hfile.TestFixedFileTrailer </h4><pre class="type-4 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTrailer() throws IOException {
  FixedFileTrailer t=new FixedFileTrailer(version,HFileReaderImpl.PBUF_TRAILER_MINOR_VERSION);
  t.setDataIndexCount(3);
  t.setEntryCount(((long)Integer.MAX_VALUE) + 1);
  t.setLastDataBlockOffset(291);
  t.setNumDataIndexLevels(3);
  t.setComparatorClass(CellComparator.COMPARATOR.getClass());
  t.setFirstDataBlockOffset(9081723123L);
  t.setUncompressedDataIndexSize(827398717L);
  t.setLoadOnOpenOffset(128);
  t.setMetaIndexCount(7);
  t.setTotalUncompressedBytes(129731987);
{
    DataOutputStream dos=new DataOutputStream(baos);
    t.serialize(dos);
    dos.flush();
    assertEquals(dos.size(),FixedFileTrailer.getTrailerSize(version));
  }
  byte[] bytes=baos.toByteArray();
  baos.reset();
  assertEquals(bytes.length,FixedFileTrailer.getTrailerSize(version));
  ByteArrayInputStream bais=new ByteArrayInputStream(bytes);
{
    DataInputStream dis=new DataInputStream(bais);
    FixedFileTrailer t2=new FixedFileTrailer(version,HFileReaderImpl.PBUF_TRAILER_MINOR_VERSION);
    t2.deserialize(dis);
    assertEquals(-1,bais.read());
    checkLoadedTrailer(version,t,t2);
  }
  Path trailerPath=new Path(util.getDataTestDir(),"trailer_" + version);
{
    for (    byte invalidVersion : new byte[]{HFile.MIN_FORMAT_VERSION - 1,HFile.MAX_FORMAT_VERSION + 1}) {
      bytes[bytes.length - 1]=invalidVersion;
      writeTrailer(trailerPath,null,bytes);
      try {
        readTrailer(trailerPath);
        fail("Exception expected");
      }
 catch (      IllegalArgumentException ex) {
        String msg=ex.getMessage();
        String cleanMsg=msg.replaceAll("^(java(\\.[a-zA-Z]+)+:\\s+)?|\\s+\\(.*\\)\\s*$","");
        assertEquals("Actual exception message is \"" + msg + "\".\n"+ "Cleaned-up message","Invalid HFile version: " + invalidVersion,cleanMsg);
        LOG.info("Got an expected exception: " + msg);
      }
    }
  }
  writeTrailer(trailerPath,t,null);
  FixedFileTrailer t4=readTrailer(trailerPath);
  checkLoadedTrailer(version,t,t4);
  String trailerStr=t.toString();
  assertEquals("Invalid number of fields in the string representation " + "of the trailer: " + trailerStr,NUM_FIELDS_BY_VERSION[version - 2],trailerStr.split(", ").length);
  assertEquals(trailerStr,t4.toString());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.io.hfile.TestHFile </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Create 0-length hfile and show that it fails
 */
@Test public void testCorrupt0LengthHFile() throws IOException {
  if (cacheConf == null)   cacheConf=new CacheConfig(conf);
  Path f=new Path(ROOT_DIR,testName.getMethodName());
  FSDataOutputStream fsos=fs.create(f);
  fsos.close();
  try {
    Reader r=HFile.createReader(fs,f,cacheConf,conf);
  }
 catch (  CorruptHFileException che) {
    return;
  }
  fail("Should have thrown exception");
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Create a truncated hfile and verify that exception thrown.
 */
@Test public void testCorruptTruncatedHFile() throws IOException {
  if (cacheConf == null)   cacheConf=new CacheConfig(conf);
  Path f=new Path(ROOT_DIR,testName.getMethodName());
  HFileContext context=new HFileContextBuilder().build();
  Writer w=HFile.getWriterFactory(conf,cacheConf).withPath(this.fs,f).withFileContext(context).create();
  writeSomeRecords(w,0,100,false);
  w.close();
  Path trunc=new Path(f.getParent(),"trucated");
  truncateFile(fs,w.getPath(),trunc);
  try {
    Reader r=HFile.createReader(fs,trunc,cacheConf,conf);
  }
 catch (  CorruptHFileException che) {
    return;
  }
  fail("Should have thrown exception");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.io.hfile.TestHFileBlockCompatibility </h4><pre class="type-4 type-10 type-11 type-7 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReaderV2() throws IOException {
  if (includesTag) {
    TEST_UTIL.getConfiguration().setInt("hfile.format.version",3);
  }
  for (  Compression.Algorithm algo : COMPRESSION_ALGORITHMS) {
    for (    boolean pread : new boolean[]{false,true}) {
      LOG.info("testReaderV2: Compression algorithm: " + algo + ", pread="+ pread);
      Path path=new Path(TEST_UTIL.getDataTestDir(),"blocks_v2_" + algo);
      FSDataOutputStream os=fs.create(path);
      Writer hbw=new Writer(algo,null,includesMemstoreTS,includesTag);
      long totalSize=0;
      for (int blockId=0; blockId < 2; ++blockId) {
        DataOutputStream dos=hbw.startWriting(BlockType.DATA);
        for (int i=0; i < 1234; ++i)         dos.writeInt(i);
        hbw.writeHeaderAndData(os);
        totalSize+=hbw.getOnDiskSizeWithHeader();
      }
      os.close();
      FSDataInputStream is=fs.open(path);
      HFileContext meta=new HFileContextBuilder().withHBaseCheckSum(false).withIncludesMvcc(includesMemstoreTS).withIncludesTags(includesTag).withCompression(algo).build();
      HFileBlock.FSReader hbr=new HFileBlock.FSReaderImpl(new FSDataInputStreamWrapper(is),totalSize,fs,path,meta);
      HFileBlock b=hbr.readBlockData(0,-1,-1,pread);
      is.close();
      b.sanityCheck();
      assertEquals(4936,b.getUncompressedSizeWithoutHeader());
      assertEquals(algo == GZ ? 2173 : 4936,b.getOnDiskSizeWithoutHeader() - b.totalChecksumBytes());
      HFileBlock expected=b;
      if (algo == GZ) {
        is=fs.open(path);
        hbr=new HFileBlock.FSReaderImpl(new FSDataInputStreamWrapper(is),totalSize,fs,path,meta);
        b=hbr.readBlockData(0,2173 + HConstants.HFILEBLOCK_HEADER_SIZE_NO_CHECKSUM + b.totalChecksumBytes(),-1,pread);
        assertEquals(expected,b);
        int wrongCompressedSize=2172;
        try {
          b=hbr.readBlockData(0,wrongCompressedSize + HConstants.HFILEBLOCK_HEADER_SIZE_NO_CHECKSUM,-1,pread);
          fail("Exception expected");
        }
 catch (        IOException ex) {
          String expectedPrefix="On-disk size without header provided is " + wrongCompressedSize + ", but block header contains "+ b.getOnDiskSizeWithoutHeader()+ ".";
          assertTrue("Invalid exception message: '" + ex.getMessage() + "'.\nMessage is expected to start with: '"+ expectedPrefix+ "'",ex.getMessage().startsWith(expectedPrefix));
        }
        is.close();
      }
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.io.hfile.TestHFileDataBlockEncoder </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Test encoding with offheap keyvalue. This test just verifies if the encoders
 * work with DBB and does not use the getXXXArray() API
 * @throws IOException
 */
@Test public void testEncodingWithOffheapKeyValue() throws IOException {
  if (blockEncoder.getDataBlockEncoding() == DataBlockEncoding.PREFIX_TREE) {
    return;
  }
  try {
    List<Cell> kvs=generator.generateTestExtendedOffheapKeyValues(60,true);
    HFileContext meta=new HFileContextBuilder().withIncludesMvcc(includesMemstoreTS).withIncludesTags(true).withHBaseCheckSum(true).withCompression(Algorithm.NONE).withBlockSize(0).withChecksumType(ChecksumType.NULL).build();
    writeBlock(kvs,meta,true);
  }
 catch (  IllegalArgumentException e) {
    fail("No exception should have been thrown");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.ipc.AbstractTestIPC </h4><pre class="type-11 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRTEDuringConnectionSetup() throws Exception {
  Configuration conf=HBaseConfiguration.create();
  TestRpcServer rpcServer=new TestRpcServer();
  AbstractRpcClient client=createRpcClientRTEDuringConnectionSetup(conf);
  try {
    rpcServer.start();
    MethodDescriptor md=SERVICE.getDescriptorForType().findMethodByName("echo");
    EchoRequestProto param=EchoRequestProto.newBuilder().setMessage("hello").build();
    InetSocketAddress address=rpcServer.getListenerAddress();
    if (address == null) {
      throw new IOException("Listener channel is closed");
    }
    client.call(null,md,param,null,User.getCurrent(),address,new MetricsConnection.CallStats());
    fail("Expected an exception to have been thrown!");
  }
 catch (  Exception e) {
    LOG.info("Caught expected exception: " + e.toString());
    assertTrue(StringUtils.stringifyException(e).contains("Injected fault"));
  }
 finally {
    client.close();
    rpcServer.stop();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.ipc.TestAsyncIPC </h4><pre class="type-11 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRTEDuringAsyncConnectionSetup() throws Exception {
  TestRpcServer rpcServer=new TestRpcServer();
  AsyncRpcClient client=createRpcClientRTEDuringConnectionSetup(CONF);
  try {
    rpcServer.start();
    InetSocketAddress address=rpcServer.getListenerAddress();
    if (address == null) {
      throw new IOException("Listener channel is closed");
    }
    MethodDescriptor md=SERVICE.getDescriptorForType().findMethodByName("echo");
    EchoRequestProto param=EchoRequestProto.newBuilder().setMessage("hello").build();
    RpcChannel channel=client.createRpcChannel(ServerName.valueOf(address.getHostName(),address.getPort(),System.currentTimeMillis()),User.getCurrent(),0);
    final AtomicBoolean done=new AtomicBoolean(false);
    PayloadCarryingRpcController controller=new PayloadCarryingRpcController();
    controller.notifyOnFail(new RpcCallback<IOException>(){
      @Override public void run(      IOException e){
        done.set(true);
        LOG.info("Caught expected exception: " + e.toString());
        assertTrue(StringUtils.stringifyException(e).contains("Injected fault"));
      }
    }
);
    channel.callMethod(md,controller,param,md.getOutputType().toProto(),new RpcCallback<Message>(){
      @Override public void run(      Message parameter){
        done.set(true);
        fail("Expected an exception to have been thrown!");
      }
    }
);
    TEST_UTIL.waitFor(1000,new Waiter.Predicate<Exception>(){
      @Override public boolean evaluate() throws Exception {
        return done.get();
      }
    }
);
  }
  finally {
    client.close();
    rpcServer.stop();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.ipc.TestProtoBufRpc </h4><pre class="type-4 type-11 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testProtoBufRpc() throws Exception {
  RpcClient rpcClient=RpcClientFactory.createClient(conf,HConstants.CLUSTER_ID_DEFAULT);
  try {
    BlockingRpcChannel channel=rpcClient.createBlockingRpcChannel(ServerName.valueOf(this.isa.getHostName(),this.isa.getPort(),System.currentTimeMillis()),User.getCurrent(),0);
    TestRpcServiceProtos.TestProtobufRpcProto.BlockingInterface stub=TestRpcServiceProtos.TestProtobufRpcProto.newBlockingStub(channel);
    TestProtos.EmptyRequestProto emptyRequest=TestProtos.EmptyRequestProto.newBuilder().build();
    stub.ping(null,emptyRequest);
    EchoRequestProto echoRequest=EchoRequestProto.newBuilder().setMessage("hello").build();
    EchoResponseProto echoResponse=stub.echo(null,echoRequest);
    Assert.assertEquals(echoResponse.getMessage(),"hello");
    try {
      stub.error(null,emptyRequest);
      Assert.fail("Expected exception is not thrown");
    }
 catch (    ServiceException e) {
    }
  }
  finally {
    rpcClient.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.mapreduce.TestCellCounter </h4><pre class="type-11 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test main method of CellCounter
 */
@Test(timeout=300000) public void testCellCounterMain() throws Exception {
  PrintStream oldPrintStream=System.err;
  SecurityManager SECURITY_MANAGER=System.getSecurityManager();
  LauncherSecurityManager newSecurityManager=new LauncherSecurityManager();
  System.setSecurityManager(newSecurityManager);
  ByteArrayOutputStream data=new ByteArrayOutputStream();
  String[] args={};
  System.setErr(new PrintStream(data));
  try {
    System.setErr(new PrintStream(data));
    try {
      CellCounter.main(args);
      fail("should be SecurityException");
    }
 catch (    SecurityException e) {
      assertEquals(-1,newSecurityManager.getExitCode());
      assertTrue(data.toString().contains("ERROR: Wrong number of parameters:"));
      assertTrue(data.toString().contains("Usage:"));
    }
  }
  finally {
    System.setErr(oldPrintStream);
    System.setSecurityManager(SECURITY_MANAGER);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.mapreduce.TestCopyTable </h4><pre class="type-11 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test main method of CopyTable.
 */
@Test public void testMainMethod() throws Exception {
  String[] emptyArgs={"-h"};
  PrintStream oldWriter=System.err;
  ByteArrayOutputStream data=new ByteArrayOutputStream();
  PrintStream writer=new PrintStream(data);
  System.setErr(writer);
  SecurityManager SECURITY_MANAGER=System.getSecurityManager();
  LauncherSecurityManager newSecurityManager=new LauncherSecurityManager();
  System.setSecurityManager(newSecurityManager);
  try {
    CopyTable.main(emptyArgs);
    fail("should be exit");
  }
 catch (  SecurityException e) {
    assertEquals(1,newSecurityManager.getExitCode());
  }
 finally {
    System.setErr(oldWriter);
    System.setSecurityManager(SECURITY_MANAGER);
  }
  assertTrue(data.toString().contains("rs.class"));
  assertTrue(data.toString().contains("Usage:"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.mapreduce.TestHashTable </h4><pre class="type-4 type-9 type-10 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHashTable() throws Exception {
  final TableName tableName=TableName.valueOf("testHashTable");
  final byte[] family=Bytes.toBytes("family");
  final byte[] column1=Bytes.toBytes("c1");
  final byte[] column2=Bytes.toBytes("c2");
  final byte[] column3=Bytes.toBytes("c3");
  int numRows=100;
  int numRegions=10;
  int numHashFiles=3;
  byte[][] splitRows=new byte[numRegions - 1][];
  for (int i=1; i < numRegions; i++) {
    splitRows[i - 1]=Bytes.toBytes(numRows * i / numRegions);
  }
  long timestamp=1430764183454L;
  Table t1=TEST_UTIL.createTable(tableName,family,splitRows);
  for (int i=0; i < numRows; i++) {
    Put p=new Put(Bytes.toBytes(i),timestamp);
    p.addColumn(family,column1,column1);
    p.addColumn(family,column2,column2);
    p.addColumn(family,column3,column3);
    t1.put(p);
  }
  t1.close();
  HashTable hashTable=new HashTable(TEST_UTIL.getConfiguration());
  Path testDir=TEST_UTIL.getDataTestDirOnTestFS(tableName.getNameAsString());
  long batchSize=300;
  int code=hashTable.run(new String[]{"--batchsize=" + batchSize,"--numhashfiles=" + numHashFiles,"--scanbatch=2",tableName.getNameAsString(),testDir.toString()});
  assertEquals("test job failed",0,code);
  FileSystem fs=TEST_UTIL.getTestFileSystem();
  HashTable.TableHash tableHash=HashTable.TableHash.read(fs.getConf(),testDir);
  assertEquals(tableName.getNameAsString(),tableHash.tableName);
  assertEquals(batchSize,tableHash.batchSize);
  assertEquals(numHashFiles,tableHash.numHashFiles);
  assertEquals(numHashFiles - 1,tableHash.partitions.size());
  for (  ImmutableBytesWritable bytes : tableHash.partitions) {
    LOG.debug("partition: " + Bytes.toInt(bytes.get()));
  }
  ImmutableMap<Integer,ImmutableBytesWritable> expectedHashes=ImmutableMap.<Integer,ImmutableBytesWritable>builder().put(-1,new ImmutableBytesWritable(Bytes.fromHex("714cb10a9e3b5569852980edd8c6ca2f"))).put(5,new ImmutableBytesWritable(Bytes.fromHex("28d961d9252ce8f8d44a07b38d3e1d96"))).put(10,new ImmutableBytesWritable(Bytes.fromHex("f6bbc4a224d8fd929b783a92599eaffa"))).put(15,new ImmutableBytesWritable(Bytes.fromHex("522deb5d97f73a414ecc11457be46881"))).put(20,new ImmutableBytesWritable(Bytes.fromHex("b026f2611aaa46f7110116d807545352"))).put(25,new ImmutableBytesWritable(Bytes.fromHex("39ffc1a3094aa12a2e90ffd9cef2ce93"))).put(30,new ImmutableBytesWritable(Bytes.fromHex("f6b4d75727ce9a30ac29e4f08f601666"))).put(35,new ImmutableBytesWritable(Bytes.fromHex("422e2d2f1eb79a8f02171a705a42c090"))).put(40,new ImmutableBytesWritable(Bytes.fromHex("559ad61c900fffefea0a15abf8a97bc3"))).put(45,new ImmutableBytesWritable(Bytes.fromHex("23019084513eca41cee436b2a29611cb"))).put(50,new ImmutableBytesWritable(Bytes.fromHex("b40467d222ddb4949b142fe145ee9edc"))).put(55,new ImmutableBytesWritable(Bytes.fromHex("372bf89fcd8ca4b7ab3c1add9d07f7e4"))).put(60,new ImmutableBytesWritable(Bytes.fromHex("69ae0585e6255de27dce974e332b8f8b"))).put(65,new ImmutableBytesWritable(Bytes.fromHex("8029610044297aad0abdbecd485d8e59"))).put(70,new ImmutableBytesWritable(Bytes.fromHex("de5f784f7f78987b6e57ecfd81c8646f"))).put(75,new ImmutableBytesWritable(Bytes.fromHex("1cd757cc4e1715c8c3b1c24447a1ec56"))).put(80,new ImmutableBytesWritable(Bytes.fromHex("f9a53aacfeb6142b08066615e7038095"))).put(85,new ImmutableBytesWritable(Bytes.fromHex("89b872b7e639df32d3276b33928c0c91"))).put(90,new ImmutableBytesWritable(Bytes.fromHex("45eeac0646d46a474ea0484175faed38"))).put(95,new ImmutableBytesWritable(Bytes.fromHex("f57c447e32a08f4bf1abb2892839ac56"))).build();
  Map<Integer,ImmutableBytesWritable> actualHashes=new HashMap<Integer,ImmutableBytesWritable>();
  Path dataDir=new Path(testDir,HashTable.HASH_DATA_DIR);
  for (int i=0; i < numHashFiles; i++) {
    Path hashPath=new Path(dataDir,HashTable.TableHash.getDataFileName(i));
    MapFile.Reader reader=new MapFile.Reader(hashPath,fs.getConf());
    ImmutableBytesWritable key=new ImmutableBytesWritable();
    ImmutableBytesWritable hash=new ImmutableBytesWritable();
    while (reader.next(key,hash)) {
      String keyString=Bytes.toHex(key.get(),key.getOffset(),key.getLength());
      LOG.debug("Key: " + (keyString.isEmpty() ? "-1" : Integer.parseInt(keyString,16)) + " Hash: "+ Bytes.toHex(hash.get(),hash.getOffset(),hash.getLength()));
      int intKey=-1;
      if (key.getLength() > 0) {
        intKey=Bytes.toInt(key.get(),key.getOffset(),key.getLength());
      }
      if (actualHashes.containsKey(intKey)) {
        Assert.fail("duplicate key in data files: " + intKey);
      }
      actualHashes.put(intKey,new ImmutableBytesWritable(hash.copyBytes()));
    }
    reader.close();
  }
  FileStatus[] files=fs.listStatus(testDir);
  for (  FileStatus file : files) {
    LOG.debug("Output file: " + file.getPath());
  }
  files=fs.listStatus(dataDir);
  for (  FileStatus file : files) {
    LOG.debug("Data file: " + file.getPath());
  }
  if (!expectedHashes.equals(actualHashes)) {
    LOG.error("Diff: " + Maps.difference(expectedHashes,actualHashes));
  }
  Assert.assertEquals(expectedHashes,actualHashes);
  TEST_UTIL.deleteTable(tableName);
  TEST_UTIL.cleanupDataTestDirOnTestFS();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.mapreduce.TestImportExport </h4><pre class="type-11 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * test main method. Export should print help and call System.exit
 */
@Test public void testExportMain() throws Exception {
  PrintStream oldPrintStream=System.err;
  SecurityManager SECURITY_MANAGER=System.getSecurityManager();
  LauncherSecurityManager newSecurityManager=new LauncherSecurityManager();
  System.setSecurityManager(newSecurityManager);
  ByteArrayOutputStream data=new ByteArrayOutputStream();
  String[] args={};
  System.setErr(new PrintStream(data));
  try {
    System.setErr(new PrintStream(data));
    Export.main(args);
    fail("should be SecurityException");
  }
 catch (  SecurityException e) {
    assertEquals(-1,newSecurityManager.getExitCode());
    assertTrue(data.toString().contains("Wrong number of arguments:"));
    assertTrue(data.toString().contains("Usage: Export [-D <property=value>]* <tablename> <outputdir> [<versions> " + "[<starttime> [<endtime>]] [^[regex pattern] or [Prefix] to filter]]"));
    assertTrue(data.toString().contains("-D hbase.mapreduce.scan.column.family=<familyName>"));
    assertTrue(data.toString().contains("-D hbase.mapreduce.include.deleted.rows=true"));
    assertTrue(data.toString().contains("-Dhbase.client.scanner.caching=100"));
    assertTrue(data.toString().contains("-Dmapreduce.map.speculative=false"));
    assertTrue(data.toString().contains("-Dmapreduce.reduce.speculative=false"));
    assertTrue(data.toString().contains("-Dhbase.export.scanner.batch=10"));
  }
 finally {
    System.setErr(oldPrintStream);
    System.setSecurityManager(SECURITY_MANAGER);
  }
}

</code></pre>

<br>
<pre class="type-11 type-7 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWithMultipleDeleteFamilyMarkersOfSameRowSameFamily() throws Exception {
  TableName EXPORT_TABLE=TableName.valueOf("exportWithMultipleDeleteFamilyMarkersOfSameRowSameFamily");
  HTableDescriptor desc=new HTableDescriptor(EXPORT_TABLE);
  desc.addFamily(new HColumnDescriptor(FAMILYA).setMaxVersions(5).setKeepDeletedCells(KeepDeletedCells.TRUE));
  UTIL.getHBaseAdmin().createTable(desc);
  Table exportT=UTIL.getConnection().getTable(EXPORT_TABLE);
  Put p=new Put(ROW1);
  p.addColumn(FAMILYA,QUAL,now,QUAL);
  exportT.put(p);
  Delete d=new Delete(ROW1,now + 3);
  exportT.delete(d);
  p=new Put(ROW1);
  p.addColumn(FAMILYA,QUAL,now + 5,"s".getBytes());
  exportT.put(p);
  d=new Delete(ROW1,now + 7);
  exportT.delete(d);
  String[] args=new String[]{"-D" + Export.RAW_SCAN + "=true",EXPORT_TABLE.getNameAsString(),FQ_OUTPUT_DIR,"1000"};
  assertTrue(runExport(args));
  String IMPORT_TABLE="importWithMultipleDeleteFamilyMarkersOfSameRowSameFamily";
  desc=new HTableDescriptor(TableName.valueOf(IMPORT_TABLE));
  desc.addFamily(new HColumnDescriptor(FAMILYA).setMaxVersions(5).setKeepDeletedCells(KeepDeletedCells.TRUE));
  UTIL.getHBaseAdmin().createTable(desc);
  Table importT=UTIL.getConnection().getTable(TableName.valueOf(IMPORT_TABLE));
  args=new String[]{IMPORT_TABLE,FQ_OUTPUT_DIR};
  assertTrue(runImport(args));
  Scan s=new Scan();
  s.setMaxVersions();
  s.setRaw(true);
  ResultScanner importedTScanner=importT.getScanner(s);
  Result importedTResult=importedTScanner.next();
  ResultScanner exportedTScanner=exportT.getScanner(s);
  Result exportedTResult=exportedTScanner.next();
  try {
    Result.compareResults(exportedTResult,importedTResult);
  }
 catch (  Exception e) {
    fail("Original and imported tables data comparision failed with error:" + e.getMessage());
  }
 finally {
    exportT.close();
    importT.close();
  }
}

</code></pre>

<br>
<pre class="type-11 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * test main method. Import should print help and call System.exit
 */
@Test public void testImportMain() throws Exception {
  PrintStream oldPrintStream=System.err;
  SecurityManager SECURITY_MANAGER=System.getSecurityManager();
  LauncherSecurityManager newSecurityManager=new LauncherSecurityManager();
  System.setSecurityManager(newSecurityManager);
  ByteArrayOutputStream data=new ByteArrayOutputStream();
  String[] args={};
  System.setErr(new PrintStream(data));
  try {
    System.setErr(new PrintStream(data));
    Import.main(args);
    fail("should be SecurityException");
  }
 catch (  SecurityException e) {
    assertEquals(-1,newSecurityManager.getExitCode());
    assertTrue(data.toString().contains("Wrong number of arguments:"));
    assertTrue(data.toString().contains("-Dimport.bulk.output=/path/for/output"));
    assertTrue(data.toString().contains("-Dimport.filter.class=<name of filter class>"));
    assertTrue(data.toString().contains("-Dimport.bulk.output=/path/for/output"));
    assertTrue(data.toString().contains("-Dmapreduce.reduce.speculative=false"));
  }
 finally {
    System.setErr(oldPrintStream);
    System.setSecurityManager(SECURITY_MANAGER);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.mapreduce.TestImportTsvParser </h4><pre class="type-11 type-7 type-5 type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTsvParseAttributesKey() throws BadTsvLineException {
  TsvParser parser=new TsvParser("HBASE_ROW_KEY,col_a,HBASE_TS_KEY,HBASE_ATTRIBUTES_KEY","\t");
  assertEquals(0,parser.getRowKeyColumnIndex());
  byte[] line=Bytes.toBytes("rowkey\tval_a\t1234\tkey=>value");
  ParsedLine parse=parser.parse(line,line.length);
  assertEquals(18,parse.getAttributeKeyOffset());
  assertEquals(3,parser.getAttributesKeyColumnIndex());
  String attributes[]=parse.getIndividualAttributes();
  assertEquals(attributes[0],"key=>value");
  try {
    line=Bytes.toBytes("rowkey\tval_a\t1234");
    parser.parse(line,line.length);
    fail("Should get BadTsvLineException on empty rowkey.");
  }
 catch (  BadTsvLineException b) {
  }
  parser=new TsvParser("HBASE_ATTRIBUTES_KEY,col_a,HBASE_ROW_KEY,HBASE_TS_KEY","\t");
  assertEquals(2,parser.getRowKeyColumnIndex());
  line=Bytes.toBytes("key=>value\tval_a\trowkey\t1234");
  parse=parser.parse(line,line.length);
  assertEquals(0,parse.getAttributeKeyOffset());
  assertEquals(0,parser.getAttributesKeyColumnIndex());
  attributes=parse.getIndividualAttributes();
  assertEquals(attributes[0],"key=>value");
  try {
    line=Bytes.toBytes("val_a");
    ParsedLine parse2=parser.parse(line,line.length);
    fail("Should get BadTsvLineException when number of columns less than rowkey position.");
  }
 catch (  BadTsvLineException b) {
  }
  parser=new TsvParser("col_a,HBASE_ATTRIBUTES_KEY,HBASE_TS_KEY,HBASE_ROW_KEY","\t");
  assertEquals(3,parser.getRowKeyColumnIndex());
  line=Bytes.toBytes("val_a\tkey0=>value0,key1=>value1,key2=>value2\t1234\trowkey");
  parse=parser.parse(line,line.length);
  assertEquals(1,parser.getAttributesKeyColumnIndex());
  assertEquals(6,parse.getAttributeKeyOffset());
  String[] attr=parse.getIndividualAttributes();
  int i=0;
  for (  String str : attr) {
    assertEquals(("key" + i + "=>"+ "value"+ i),str);
    i++;
  }
}

</code></pre>

<br>
<pre class="type-11 type-7 type-5 type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTsvParserParseRowKey() throws BadTsvLineException {
  TsvParser parser=new TsvParser("HBASE_ROW_KEY,col_a,HBASE_TS_KEY","\t");
  assertEquals(0,parser.getRowKeyColumnIndex());
  byte[] line=Bytes.toBytes("rowkey\tval_a\t1234");
  Pair<Integer,Integer> rowKeyOffsets=parser.parseRowKey(line,line.length);
  assertEquals(0,rowKeyOffsets.getFirst().intValue());
  assertEquals(6,rowKeyOffsets.getSecond().intValue());
  try {
    line=Bytes.toBytes("\t\tval_a\t1234");
    parser.parseRowKey(line,line.length);
    fail("Should get BadTsvLineException on empty rowkey.");
  }
 catch (  BadTsvLineException b) {
  }
  parser=new TsvParser("col_a,HBASE_ROW_KEY,HBASE_TS_KEY","\t");
  assertEquals(1,parser.getRowKeyColumnIndex());
  line=Bytes.toBytes("val_a\trowkey\t1234");
  rowKeyOffsets=parser.parseRowKey(line,line.length);
  assertEquals(6,rowKeyOffsets.getFirst().intValue());
  assertEquals(6,rowKeyOffsets.getSecond().intValue());
  try {
    line=Bytes.toBytes("val_a");
    rowKeyOffsets=parser.parseRowKey(line,line.length);
    fail("Should get BadTsvLineException when number of columns less than rowkey position.");
  }
 catch (  BadTsvLineException b) {
  }
  parser=new TsvParser("col_a,HBASE_TS_KEY,HBASE_ROW_KEY","\t");
  assertEquals(2,parser.getRowKeyColumnIndex());
  line=Bytes.toBytes("val_a\t1234\trowkey");
  rowKeyOffsets=parser.parseRowKey(line,line.length);
  assertEquals(11,rowKeyOffsets.getFirst().intValue());
  assertEquals(6,rowKeyOffsets.getSecond().intValue());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.mapreduce.TestLoadIncrementalHFiles </h4><pre class="type-11 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testLoadTooMayHFiles() throws Exception {
  Path dir=util.getDataTestDirOnTestFS("testLoadTooMayHFiles");
  FileSystem fs=util.getTestFileSystem();
  dir=dir.makeQualified(fs);
  Path familyDir=new Path(dir,Bytes.toString(FAMILY));
  byte[] from=Bytes.toBytes("begin");
  byte[] to=Bytes.toBytes("end");
  for (int i=0; i <= MAX_FILES_PER_REGION_PER_FAMILY; i++) {
    HFileTestUtil.createHFile(util.getConfiguration(),fs,new Path(familyDir,"hfile_" + i),FAMILY,QUALIFIER,from,to,1000);
  }
  LoadIncrementalHFiles loader=new LoadIncrementalHFiles(util.getConfiguration());
  String[] args={dir.toString(),"mytable_testLoadTooMayHFiles"};
  try {
    loader.run(args);
    fail("Bulk loading too many files should fail");
  }
 catch (  IOException ie) {
    assertTrue(ie.getMessage().contains("Trying to load more than " + MAX_FILES_PER_REGION_PER_FAMILY + " hfiles"));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.mapreduce.TestLoadIncrementalHFilesSplitRecovery </h4><pre class="type-11 type-17 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This simulates an remote exception which should cause LIHF to exit with an
 * exception.
 */
@Test(expected=IOException.class,timeout=120000) public void testGroupOrSplitFailure() throws Exception {
  TableName table=TableName.valueOf("groupOrSplitFailure");
  try (Connection connection=ConnectionFactory.createConnection(util.getConfiguration())){
    setupTable(connection,table,10);
    LoadIncrementalHFiles lih=new LoadIncrementalHFiles(util.getConfiguration()){
      int i=0;
      @Override protected List<LoadQueueItem> groupOrSplit(      Multimap<ByteBuffer,LoadQueueItem> regionGroups,      final LoadQueueItem item,      final Table table,      final Pair<byte[][],byte[][]> startEndKeys) throws IOException {
        i++;
        if (i == 5) {
          throw new IOException("failure");
        }
        return super.groupOrSplit(regionGroups,item,table,startEndKeys);
      }
    }
;
    Path dir=buildBulkFiles(table,1);
    try (Table t=connection.getTable(table);RegionLocator locator=connection.getRegionLocator(table);Admin admin=connection.getAdmin()){
      lih.doBulkLoad(dir,admin,t,locator);
    }
   }
   fail("doBulkLoad should have thrown an exception");
}

</code></pre>

<br>
<pre class="type-11 type-17 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that shows that exception thrown from the RS side will result in an
 * exception on the LIHFile client.
 */
@Test(expected=IOException.class,timeout=120000) public void testBulkLoadPhaseFailure() throws Exception {
  TableName table=TableName.valueOf("bulkLoadPhaseFailure");
  final AtomicInteger attmptedCalls=new AtomicInteger();
  final AtomicInteger failedCalls=new AtomicInteger();
  util.getConfiguration().setInt(HConstants.HBASE_CLIENT_RETRIES_NUMBER,2);
  try (Connection connection=ConnectionFactory.createConnection(this.util.getConfiguration())){
    setupTable(connection,table,10);
    LoadIncrementalHFiles lih=new LoadIncrementalHFiles(util.getConfiguration()){
      @Override protected List<LoadQueueItem> tryAtomicRegionLoad(      final Connection conn,      TableName tableName,      final byte[] first,      Collection<LoadQueueItem> lqis) throws IOException {
        int i=attmptedCalls.incrementAndGet();
        if (i == 1) {
          Connection errConn=null;
          try {
            errConn=getMockedConnection(util.getConfiguration());
          }
 catch (          Exception e) {
            LOG.fatal("mocking cruft, should never happen",e);
            throw new RuntimeException("mocking cruft, should never happen");
          }
          failedCalls.incrementAndGet();
          return super.tryAtomicRegionLoad((HConnection)errConn,tableName,first,lqis);
        }
        return super.tryAtomicRegionLoad((HConnection)conn,tableName,first,lqis);
      }
    }
;
    try {
      Path dir=buildBulkFiles(table,1);
      try (Table t=connection.getTable(table);RegionLocator locator=connection.getRegionLocator(table);Admin admin=connection.getAdmin()){
        lih.doBulkLoad(dir,admin,t,locator);
      }
     }
  finally {
      util.getConfiguration().setInt(HConstants.HBASE_CLIENT_RETRIES_NUMBER,HConstants.DEFAULT_HBASE_CLIENT_RETRIES_NUMBER);
    }
    fail("doBulkLoad should have thrown an exception");
  }
 }

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.mapreduce.TestMapReduceExamples </h4><pre class="type-11 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test main method of SampleUploader.
 */
@Test public void testMainSampleUploader() throws Exception {
  PrintStream oldPrintStream=System.err;
  SecurityManager SECURITY_MANAGER=System.getSecurityManager();
  LauncherSecurityManager newSecurityManager=new LauncherSecurityManager();
  System.setSecurityManager(newSecurityManager);
  ByteArrayOutputStream data=new ByteArrayOutputStream();
  String[] args={};
  System.setErr(new PrintStream(data));
  try {
    System.setErr(new PrintStream(data));
    try {
      SampleUploader.main(args);
      fail("should be SecurityException");
    }
 catch (    SecurityException e) {
      assertEquals(-1,newSecurityManager.getExitCode());
      assertTrue(data.toString().contains("Wrong number of arguments:"));
      assertTrue(data.toString().contains("Usage: SampleUploader <input> <tablename>"));
    }
  }
  finally {
    System.setErr(oldPrintStream);
    System.setSecurityManager(SECURITY_MANAGER);
  }
}

</code></pre>

<br>
<pre class="type-11 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test main method of IndexBuilder
 */
@Test public void testMainIndexBuilder() throws Exception {
  PrintStream oldPrintStream=System.err;
  SecurityManager SECURITY_MANAGER=System.getSecurityManager();
  LauncherSecurityManager newSecurityManager=new LauncherSecurityManager();
  System.setSecurityManager(newSecurityManager);
  ByteArrayOutputStream data=new ByteArrayOutputStream();
  String[] args={};
  System.setErr(new PrintStream(data));
  try {
    System.setErr(new PrintStream(data));
    try {
      IndexBuilder.main(args);
      fail("should be SecurityException");
    }
 catch (    SecurityException e) {
      assertEquals(-1,newSecurityManager.getExitCode());
      assertTrue(data.toString().contains("arguments supplied, required: 3"));
      assertTrue(data.toString().contains("Usage: IndexBuilder <TABLE_NAME> <COLUMN_FAMILY> <ATTR> [<ATTR> ...]"));
    }
  }
  finally {
    System.setErr(oldPrintStream);
    System.setSecurityManager(SECURITY_MANAGER);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.mapreduce.TestRowCounter </h4><pre class="type-11 type-7 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * test main method. Import should print help and call System.exit
 */
@Test public void testImportMain() throws Exception {
  PrintStream oldPrintStream=System.err;
  SecurityManager SECURITY_MANAGER=System.getSecurityManager();
  LauncherSecurityManager newSecurityManager=new LauncherSecurityManager();
  System.setSecurityManager(newSecurityManager);
  ByteArrayOutputStream data=new ByteArrayOutputStream();
  String[] args={};
  System.setErr(new PrintStream(data));
  try {
    System.setErr(new PrintStream(data));
    try {
      RowCounter.main(args);
      fail("should be SecurityException");
    }
 catch (    SecurityException e) {
      assertEquals(-1,newSecurityManager.getExitCode());
      assertTrue(data.toString().contains("Wrong number of parameters:"));
      assertTrue(data.toString().contains("Usage: RowCounter [options] <tablename> " + "[--starttime=[start] --endtime=[end] " + "[--range=[startKey],[endKey]] "+ "[<column1> <column2>...]"));
      assertTrue(data.toString().contains("-Dhbase.client.scanner.caching=100"));
      assertTrue(data.toString().contains("-Dmapreduce.map.speculative=false"));
    }
    data.reset();
    try {
      args=new String[2];
      args[0]="table";
      args[1]="--range=1";
      RowCounter.main(args);
      fail("should be SecurityException");
    }
 catch (    SecurityException e) {
      assertEquals(-1,newSecurityManager.getExitCode());
      assertTrue(data.toString().contains("Please specify range in such format as \"--range=a,b\" or, with only one boundary," + " \"--range=,b\" or \"--range=a,\""));
      assertTrue(data.toString().contains("Usage: RowCounter [options] <tablename> " + "[--starttime=[start] --endtime=[end] " + "[--range=[startKey],[endKey]] "+ "[<column1> <column2>...]"));
    }
  }
  finally {
    System.setErr(oldPrintStream);
    System.setSecurityManager(SECURITY_MANAGER);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.mapreduce.TestWALPlayer </h4><pre class="type-11 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test main method
 */
@Test public void testMainMethod() throws Exception {
  PrintStream oldPrintStream=System.err;
  SecurityManager SECURITY_MANAGER=System.getSecurityManager();
  LauncherSecurityManager newSecurityManager=new LauncherSecurityManager();
  System.setSecurityManager(newSecurityManager);
  ByteArrayOutputStream data=new ByteArrayOutputStream();
  String[] args={};
  System.setErr(new PrintStream(data));
  try {
    System.setErr(new PrintStream(data));
    try {
      WALPlayer.main(args);
      fail("should be SecurityException");
    }
 catch (    SecurityException e) {
      assertEquals(-1,newSecurityManager.getExitCode());
      assertTrue(data.toString().contains("ERROR: Wrong number of arguments:"));
      assertTrue(data.toString().contains("Usage: WALPlayer [options] <wal inputdir>" + " <tables> [<tableMappings>]"));
      assertTrue(data.toString().contains("-Dwal.bulk.output=/path/for/output"));
    }
  }
  finally {
    System.setErr(oldPrintStream);
    System.setSecurityManager(SECURITY_MANAGER);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.master.TestAssignmentManagerOnCluster </h4><pre class="type-4 type-9 type-10 type-11 type-7 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This tests offlining a region
 */
@Test(timeout=60000) public void testOfflineRegion() throws Exception {
  TableName table=TableName.valueOf("testOfflineRegion");
  try {
    HRegionInfo hri=createTableAndGetOneRegion(table);
    RegionStates regionStates=TEST_UTIL.getHBaseCluster().getMaster().getAssignmentManager().getRegionStates();
    ServerName serverName=regionStates.getRegionServerOfRegion(hri);
    TEST_UTIL.assertRegionOnServer(hri,serverName,200);
    admin.offline(hri.getRegionName());
    long timeoutTime=System.currentTimeMillis() + 800;
    while (true) {
      if (regionStates.getRegionByStateOfTable(table).get(RegionState.State.OFFLINE).contains(hri))       break;
      long now=System.currentTimeMillis();
      if (now > timeoutTime) {
        fail("Failed to offline the region in time");
        break;
      }
      Thread.sleep(10);
    }
    RegionState regionState=regionStates.getRegionState(hri);
    assertTrue(regionState.isOffline());
  }
  finally {
    TEST_UTIL.deleteTable(table);
  }
}

</code></pre>

<br>
<pre class="type-4 type-9 type-10 type-11 type-7 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This tests moving a region
 */
@Test(timeout=50000) public void testMoveRegion() throws Exception {
  TableName table=TableName.valueOf("testMoveRegion");
  try {
    HRegionInfo hri=createTableAndGetOneRegion(table);
    HMaster master=TEST_UTIL.getHBaseCluster().getMaster();
    RegionStates regionStates=master.getAssignmentManager().getRegionStates();
    ServerName serverName=regionStates.getRegionServerOfRegion(hri);
    ServerManager serverManager=master.getServerManager();
    ServerName destServerName=null;
    List<JVMClusterUtil.RegionServerThread> regionServers=TEST_UTIL.getHBaseCluster().getLiveRegionServerThreads();
    for (    JVMClusterUtil.RegionServerThread regionServer : regionServers) {
      HRegionServer destServer=regionServer.getRegionServer();
      destServerName=destServer.getServerName();
      if (!destServerName.equals(serverName) && serverManager.isServerOnline(destServerName)) {
        break;
      }
    }
    assertTrue(destServerName != null && !destServerName.equals(serverName));
    TEST_UTIL.getHBaseAdmin().move(hri.getEncodedNameAsBytes(),Bytes.toBytes(destServerName.getServerName()));
    long timeoutTime=System.currentTimeMillis() + 30000;
    while (true) {
      ServerName sn=regionStates.getRegionServerOfRegion(hri);
      if (sn != null && sn.equals(destServerName)) {
        TEST_UTIL.assertRegionOnServer(hri,sn,200);
        break;
      }
      long now=System.currentTimeMillis();
      if (now > timeoutTime) {
        fail("Failed to move the region in time: " + regionStates.getRegionState(hri));
      }
      regionStates.waitForUpdate(50);
    }
  }
  finally {
    TEST_UTIL.deleteTable(table);
  }
}

</code></pre>

<br>
<pre class="type-4 type-11 type-7 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * If a table is deleted, we should not be able to move it anymore.
 * Otherwise, the region will be brought back.
 * @throws Exception
 */
@Test(timeout=50000) public void testMoveRegionOfDeletedTable() throws Exception {
  TableName table=TableName.valueOf("testMoveRegionOfDeletedTable");
  Admin admin=TEST_UTIL.getHBaseAdmin();
  try {
    HRegionInfo hri=createTableAndGetOneRegion(table);
    HMaster master=TEST_UTIL.getHBaseCluster().getMaster();
    AssignmentManager am=master.getAssignmentManager();
    RegionStates regionStates=am.getRegionStates();
    ServerName serverName=regionStates.getRegionServerOfRegion(hri);
    ServerName destServerName=null;
    for (int i=0; i < 3; i++) {
      HRegionServer destServer=TEST_UTIL.getHBaseCluster().getRegionServer(i);
      if (!destServer.getServerName().equals(serverName)) {
        destServerName=destServer.getServerName();
        break;
      }
    }
    assertTrue(destServerName != null && !destServerName.equals(serverName));
    TEST_UTIL.deleteTable(table);
    try {
      admin.move(hri.getEncodedNameAsBytes(),Bytes.toBytes(destServerName.getServerName()));
      fail("We should not find the region");
    }
 catch (    IOException ioe) {
      assertTrue(ioe instanceof UnknownRegionException);
    }
    am.balance(new RegionPlan(hri,serverName,destServerName));
    assertFalse("The region should not be in transition",regionStates.isRegionInTransition(hri));
  }
  finally {
    if (admin.tableExists(table)) {
      TEST_UTIL.deleteTable(table);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.master.TestClockSkewDetection </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testClockSkewDetection() throws Exception {
  final Configuration conf=HBaseConfiguration.create();
  ServerManager sm=new ServerManager(new Server(){
    @Override public ClusterConnection getConnection(){
      return null;
    }
    @Override public MetaTableLocator getMetaTableLocator(){
      return null;
    }
    @Override public Configuration getConfiguration(){
      return conf;
    }
    @Override public ServerName getServerName(){
      return null;
    }
    @Override public ZooKeeperWatcher getZooKeeper(){
      return null;
    }
    @Override public CoordinatedStateManager getCoordinatedStateManager(){
      return null;
    }
    @Override public void abort(    String why,    Throwable e){
    }
    @Override public boolean isAborted(){
      return false;
    }
    @Override public boolean isStopped(){
      return false;
    }
    @Override public void stop(    String why){
    }
    @Override public ChoreService getChoreService(){
      return null;
    }
    @Override public ClusterConnection getClusterConnection(){
      return null;
    }
  }
,null,false);
  LOG.debug("regionServerStartup 1");
  InetAddress ia1=InetAddress.getLocalHost();
  RegionServerStartupRequest.Builder request=RegionServerStartupRequest.newBuilder();
  request.setPort(1234);
  request.setServerStartCode(-1);
  request.setServerCurrentTime(System.currentTimeMillis());
  sm.regionServerStartup(request.build(),ia1);
  final Configuration c=HBaseConfiguration.create();
  long maxSkew=c.getLong("hbase.master.maxclockskew",30000);
  long warningSkew=c.getLong("hbase.master.warningclockskew",1000);
  try {
    LOG.debug("Test: Master Time > Region Server Time");
    LOG.debug("regionServerStartup 2");
    InetAddress ia2=InetAddress.getLocalHost();
    request=RegionServerStartupRequest.newBuilder();
    request.setPort(1235);
    request.setServerStartCode(-1);
    request.setServerCurrentTime(System.currentTimeMillis() - maxSkew * 2);
    sm.regionServerStartup(request.build(),ia2);
    fail("HMaster should have thrown a ClockOutOfSyncException but didn't.");
  }
 catch (  ClockOutOfSyncException e) {
    LOG.info("Recieved expected exception: " + e);
  }
  try {
    LOG.debug("Test: Master Time < Region Server Time");
    LOG.debug("regionServerStartup 3");
    InetAddress ia3=InetAddress.getLocalHost();
    request=RegionServerStartupRequest.newBuilder();
    request.setPort(1236);
    request.setServerStartCode(-1);
    request.setServerCurrentTime(System.currentTimeMillis() + maxSkew * 2);
    sm.regionServerStartup(request.build(),ia3);
    fail("HMaster should have thrown a ClockOutOfSyncException but didn't.");
  }
 catch (  ClockOutOfSyncException e) {
    LOG.info("Recieved expected exception: " + e);
  }
  LOG.debug("regionServerStartup 4");
  InetAddress ia4=InetAddress.getLocalHost();
  request=RegionServerStartupRequest.newBuilder();
  request.setPort(1237);
  request.setServerStartCode(-1);
  request.setServerCurrentTime(System.currentTimeMillis() - warningSkew * 2);
  sm.regionServerStartup(request.build(),ia4);
  LOG.debug("regionServerStartup 5");
  InetAddress ia5=InetAddress.getLocalHost();
  request=RegionServerStartupRequest.newBuilder();
  request.setPort(1238);
  request.setServerStartCode(-1);
  request.setServerCurrentTime(System.currentTimeMillis() + warningSkew * 2);
  sm.regionServerStartup(request.build(),ia5);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.master.TestMaster </h4><pre class="type-11 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMoveRegionWhenNotInitialized(){
  MiniHBaseCluster cluster=TEST_UTIL.getHBaseCluster();
  HMaster m=cluster.getMaster();
  try {
    m.setInitialized(false);
    HRegionInfo meta=HRegionInfo.FIRST_META_REGIONINFO;
    m.move(meta.getEncodedNameAsBytes(),null);
    fail("Region should not be moved since master is not initialized");
  }
 catch (  IOException ioe) {
    assertTrue(ioe instanceof PleaseHoldException);
  }
 finally {
    m.setInitialized(true);
  }
}

</code></pre>

<br>
<pre class="type-11 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMoveThrowsUnknownRegionException() throws IOException {
  TableName tableName=TableName.valueOf("testMoveThrowsUnknownRegionException");
  HTableDescriptor htd=new HTableDescriptor(tableName);
  HColumnDescriptor hcd=new HColumnDescriptor("value");
  htd.addFamily(hcd);
  admin.createTable(htd,null);
  try {
    HRegionInfo hri=new HRegionInfo(tableName,Bytes.toBytes("A"),Bytes.toBytes("Z"));
    admin.move(hri.getEncodedNameAsBytes(),null);
    fail("Region should not be moved since it is fake");
  }
 catch (  IOException ioe) {
    assertTrue(ioe instanceof UnknownRegionException);
  }
 finally {
    TEST_UTIL.deleteTable(tableName);
  }
}

</code></pre>

<br>
<pre class="type-11 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMoveThrowsPleaseHoldException() throws IOException {
  TableName tableName=TableName.valueOf("testMoveThrowsPleaseHoldException");
  HMaster master=TEST_UTIL.getMiniHBaseCluster().getMaster();
  HTableDescriptor htd=new HTableDescriptor(tableName);
  HColumnDescriptor hcd=new HColumnDescriptor("value");
  htd.addFamily(hcd);
  admin.createTable(htd,null);
  try {
    List<HRegionInfo> tableRegions=admin.getTableRegions(tableName);
    master.setInitialized(false);
    admin.move(tableRegions.get(0).getEncodedNameAsBytes(),null);
    fail("Region should not be moved since master is not initialized");
  }
 catch (  IOException ioe) {
    assertTrue(StringUtils.stringifyException(ioe).contains("PleaseHoldException"));
  }
 finally {
    master.setInitialized(true);
    TEST_UTIL.deleteTable(tableName);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.master.TestTableLockManager </h4><pre class="type-4 type-9 type-10 type-11 type-7 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=600000) public void testTableReadLock() throws Exception {
  prepareMiniCluster();
  LoadTestTool loadTool=new LoadTestTool();
  loadTool.setConf(TEST_UTIL.getConfiguration());
  int numKeys=10000;
  final TableName tableName=TableName.valueOf("testTableReadLock");
  final Admin admin=TEST_UTIL.getHBaseAdmin();
  final HTableDescriptor desc=new HTableDescriptor(tableName);
  final byte[] family=Bytes.toBytes("test_cf");
  desc.addFamily(new HColumnDescriptor(family));
  admin.createTable(desc);
  int ret=loadTool.run(new String[]{"-tn",tableName.getNameAsString(),"-write",String.format("%d:%d:%d",1,10,10),"-num_keys",String.valueOf(numKeys),"-skip_init"});
  if (0 != ret) {
    String errorMsg="Load failed with error code " + ret;
    LOG.error(errorMsg);
    fail(errorMsg);
  }
  int familyValues=admin.getTableDescriptor(tableName).getFamily(family).getValues().size();
  StoppableImplementation stopper=new StoppableImplementation();
  final ChoreService choreService=new ChoreService("TEST_SERVER_NAME");
  ScheduledChore alterThread=new ScheduledChore("Alter Chore",stopper,10000){
    @Override protected void chore(){
      Random random=new Random();
      try {
        HTableDescriptor htd=admin.getTableDescriptor(tableName);
        String val=String.valueOf(random.nextInt());
        htd.getFamily(family).setValue(val,val);
        desc.getFamily(family).setValue(val,val);
        admin.modifyTable(tableName,htd);
      }
 catch (      Exception ex) {
        LOG.warn("Caught exception",ex);
        fail(ex.getMessage());
      }
    }
  }
;
  ScheduledChore splitThread=new ScheduledChore("Split thread",stopper,5000){
    @Override public void chore(){
      try {
        HRegion region=TEST_UTIL.getSplittableRegion(tableName,-1);
        if (region != null) {
          byte[] regionName=region.getRegionInfo().getRegionName();
          admin.flushRegion(regionName);
          admin.compactRegion(regionName);
          admin.splitRegion(regionName);
        }
 else {
          LOG.warn("Could not find suitable region for the table.  Possibly the " + "region got closed and the attempts got over before " + "the region could have got reassigned.");
        }
      }
 catch (      NotServingRegionException nsre) {
        LOG.warn("Caught exception",nsre);
      }
catch (      Exception ex) {
        LOG.warn("Caught exception",ex);
        fail(ex.getMessage());
      }
    }
  }
;
  choreService.scheduleChore(alterThread);
  choreService.scheduleChore(splitThread);
  TEST_UTIL.waitTableEnabled(tableName);
  while (true) {
    List<HRegionInfo> regions=admin.getTableRegions(tableName);
    LOG.info(String.format("Table #regions: %d regions: %s:",regions.size(),regions));
    assertEquals(admin.getTableDescriptor(tableName),desc);
    for (    HRegion region : TEST_UTIL.getMiniHBaseCluster().getRegions(tableName)) {
      HTableDescriptor regionTableDesc=region.getTableDesc();
      assertEquals(desc,regionTableDesc);
    }
    if (regions.size() >= 5) {
      break;
    }
    Threads.sleep(1000);
  }
  stopper.stop("test finished");
  int newFamilyValues=admin.getTableDescriptor(tableName).getFamily(family).getValues().size();
  LOG.info(String.format("Altered the table %d times",newFamilyValues - familyValues));
  assertTrue(newFamilyValues > familyValues);
  ret=loadTool.run(new String[]{"-tn",tableName.getNameAsString(),"-read","100:10","-num_keys",String.valueOf(numKeys),"-skip_init"});
  if (0 != ret) {
    String errorMsg="Verify failed with error code " + ret;
    LOG.error(errorMsg);
    fail(errorMsg);
  }
  admin.close();
  choreService.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.master.cleaner.TestReplicationHFileCleaner </h4><pre class="type-10 type-11 type-7 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetDeletableFiles() throws Exception {
  Path notDeletablefile=new Path(root,"testGetDeletableFiles_1");
  fs.createNewFile(notDeletablefile);
  assertTrue("Test file not created!",fs.exists(notDeletablefile));
  Path deletablefile=new Path(root,"testGetDeletableFiles_2");
  fs.createNewFile(deletablefile);
  assertTrue("Test file not created!",fs.exists(deletablefile));
  List<FileStatus> files=new ArrayList<FileStatus>(2);
  FileStatus f=new FileStatus();
  f.setPath(deletablefile);
  files.add(f);
  f=new FileStatus();
  f.setPath(notDeletablefile);
  files.add(f);
  List<String> hfiles=new ArrayList<>(1);
  hfiles.add(notDeletablefile.getName());
  rq.addHFileRefs(peerId,hfiles);
  ReplicationHFileCleaner cleaner=new ReplicationHFileCleaner();
  cleaner.setConf(conf);
  Iterator<FileStatus> deletableFilesIterator=cleaner.getDeletableFiles(files).iterator();
  int i=0;
  while (deletableFilesIterator.hasNext() && i < 2) {
    i++;
  }
  if (i > 2) {
    fail("File " + notDeletablefile + " should not be deletable as its hfile reference node is not added.");
  }
  assertTrue(deletableFilesIterator.next().getPath().equals(deletablefile));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.master.cleaner.TestSnapshotFromMaster </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=300000) public void testDeleteSnapshot() throws Exception {
  String snapshotName="completed";
  SnapshotDescription snapshot=SnapshotDescription.newBuilder().setName(snapshotName).build();
  DeleteSnapshotRequest request=DeleteSnapshotRequest.newBuilder().setSnapshot(snapshot).build();
  try {
    master.getMasterRpcServices().deleteSnapshot(null,request);
    fail("Master didn't throw exception when attempting to delete snapshot that doesn't exist");
  }
 catch (  ServiceException e) {
    LOG.debug("Correctly failed delete of non-existant snapshot:" + e.getMessage());
  }
  Path snapshotDir=SnapshotDescriptionUtils.getCompletedSnapshotDir(snapshotName,rootDir);
  SnapshotDescriptionUtils.writeSnapshotInfo(snapshot,snapshotDir,fs);
  master.getMasterRpcServices().deleteSnapshot(null,request);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.master.handler.TestEnableTableHandler </h4><pre class="type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * We were only clearing rows that had a hregioninfo column in hbase:meta.  Mangled rows that
 * were missing the hregioninfo because of error were being left behind messing up any
 * subsequent table made with the same name. HBASE-12980
 * @throws IOException
 * @throws InterruptedException
 */
@Test(timeout=60000) public void testDeleteForSureClearsAllTableRowsFromMeta() throws IOException, InterruptedException {
  final TableName tableName=TableName.valueOf("testDeleteForSureClearsAllTableRowsFromMeta");
  final Admin admin=TEST_UTIL.getHBaseAdmin();
  final HTableDescriptor desc=new HTableDescriptor(tableName);
  desc.addFamily(new HColumnDescriptor(FAMILYNAME));
  try {
    createTable(TEST_UTIL,desc,HBaseTestingUtility.KEYS_FOR_HBA_CREATE_TABLE);
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail("Got an exception while creating " + tableName);
  }
  try (Table metaTable=TEST_UTIL.getConnection().getTable(TableName.META_TABLE_NAME)){
    try (ResultScanner scanner=metaTable.getScanner(MetaTableAccessor.getScanForTableName(TEST_UTIL.getConnection(),tableName))){
      for (      Result result : scanner) {
        Delete d=new Delete(result.getRow());
        d.addColumn(HConstants.CATALOG_FAMILY,HConstants.REGIONINFO_QUALIFIER);
        LOG.info("Mangled: " + d);
        metaTable.delete(d);
        break;
      }
    }
     admin.disableTable(tableName);
    TEST_UTIL.waitTableDisabled(tableName.getName());
    try {
      deleteTable(TEST_UTIL,tableName);
    }
 catch (    Exception e) {
      e.printStackTrace();
      fail("Got an exception while deleting " + tableName);
    }
    int rowCount=0;
    try (ResultScanner scanner=metaTable.getScanner(MetaTableAccessor.getScanForTableName(TEST_UTIL.getConnection(),tableName))){
      for (      Result result : scanner) {
        LOG.info("Found when none expected: " + result);
        rowCount++;
      }
    }
     assertEquals(0,rowCount);
  }
 }

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.master.handler.TestTableDeleteFamilyHandler </h4><pre class="type-4 type-9 type-10 type-11 type-7 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void deleteColumnFamilyTwice() throws Exception {
  Admin admin=TEST_UTIL.getHBaseAdmin();
  HTableDescriptor beforehtd=admin.getTableDescriptor(TABLENAME);
  String cfToDelete="cf1";
  FileSystem fs=TEST_UTIL.getDFSCluster().getFileSystem();
  assertTrue(admin.isTableAvailable(TABLENAME));
  HColumnDescriptor[] families=beforehtd.getColumnFamilies();
  Boolean foundCF=false;
  int i;
  for (i=0; i < families.length; i++) {
    if (families[i].getNameAsString().equals(cfToDelete)) {
      foundCF=true;
      break;
    }
  }
  assertTrue(foundCF);
  Path tableDir=FSUtils.getTableDir(TEST_UTIL.getDefaultRootDirPath(),TABLENAME);
  assertTrue(fs.exists(tableDir));
  FileStatus[] fileStatus=fs.listStatus(tableDir);
  foundCF=false;
  for (i=0; i < fileStatus.length; i++) {
    if (fileStatus[i].isDirectory() == true) {
      FileStatus[] cf=fs.listStatus(fileStatus[i].getPath(),new PathFilter(){
        @Override public boolean accept(        Path p){
          if (p.getName().contains(HConstants.RECOVERED_EDITS_DIR)) {
            return false;
          }
          return true;
        }
      }
);
      for (int j=0; j < cf.length; j++) {
        if (cf[j].isDirectory() == true && cf[j].getPath().getName().equals(cfToDelete)) {
          foundCF=true;
          break;
        }
      }
    }
    if (foundCF) {
      break;
    }
  }
  assertTrue(foundCF);
  if (admin.isTableEnabled(TABLENAME)) {
    admin.disableTable(TABLENAME);
  }
  admin.deleteColumnFamily(TABLENAME,Bytes.toBytes(cfToDelete));
  fileStatus=fs.listStatus(tableDir);
  for (i=0; i < fileStatus.length; i++) {
    if (fileStatus[i].isDirectory() == true) {
      FileStatus[] cf=fs.listStatus(fileStatus[i].getPath(),new PathFilter(){
        @Override public boolean accept(        Path p){
          if (WALSplitter.isSequenceIdFile(p)) {
            return false;
          }
          return true;
        }
      }
);
      for (int j=0; j < cf.length; j++) {
        if (cf[j].isDirectory() == true) {
          assertFalse(cf[j].getPath().getName().equals(cfToDelete));
        }
      }
    }
  }
  try {
    admin.deleteColumnFamily(TABLENAME,Bytes.toBytes(cfToDelete));
    Assert.fail("Delete a non-exist column family should fail");
  }
 catch (  InvalidFamilyOperationException e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.master.handler.TestTableDescriptorModification </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testAddSameColumnFamilyTwice() throws IOException {
  Admin admin=TEST_UTIL.getHBaseAdmin();
  HTableDescriptor baseHtd=new HTableDescriptor(TABLE_NAME);
  baseHtd.addFamily(new HColumnDescriptor(FAMILY_0));
  admin.createTable(baseHtd);
  admin.disableTable(TABLE_NAME);
  try {
    verifyTableDescriptor(TABLE_NAME,FAMILY_0);
    admin.addColumnFamily(TABLE_NAME,new HColumnDescriptor(FAMILY_1));
    verifyTableDescriptor(TABLE_NAME,FAMILY_0,FAMILY_1);
    try {
      admin.addColumnFamily(TABLE_NAME,new HColumnDescriptor(FAMILY_1));
      Assert.fail("Delete a non-exist column family should fail");
    }
 catch (    InvalidFamilyOperationException e) {
    }
  }
  finally {
    admin.deleteTable(TABLE_NAME);
  }
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testDeleteSameColumnFamilyTwice() throws IOException {
  Admin admin=TEST_UTIL.getHBaseAdmin();
  HTableDescriptor baseHtd=new HTableDescriptor(TABLE_NAME);
  baseHtd.addFamily(new HColumnDescriptor(FAMILY_0));
  baseHtd.addFamily(new HColumnDescriptor(FAMILY_1));
  admin.createTable(baseHtd);
  admin.disableTable(TABLE_NAME);
  try {
    verifyTableDescriptor(TABLE_NAME,FAMILY_0,FAMILY_1);
    admin.deleteColumnFamily(TABLE_NAME,FAMILY_1);
    verifyTableDescriptor(TABLE_NAME,FAMILY_0);
    try {
      admin.deleteColumnFamily(TABLE_NAME,FAMILY_1);
      Assert.fail("Delete a non-exist column family should fail");
    }
 catch (    Exception e) {
    }
  }
  finally {
    admin.deleteTable(TABLE_NAME);
  }
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testModifyNonExistingColumnFamily() throws IOException {
  Admin admin=TEST_UTIL.getHBaseAdmin();
  HColumnDescriptor cfDescriptor=new HColumnDescriptor(FAMILY_1);
  int blockSize=cfDescriptor.getBlocksize();
  HTableDescriptor baseHtd=new HTableDescriptor(TABLE_NAME);
  baseHtd.addFamily(new HColumnDescriptor(FAMILY_0));
  admin.createTable(baseHtd);
  admin.disableTable(TABLE_NAME);
  try {
    verifyTableDescriptor(TABLE_NAME,FAMILY_0);
    int newBlockSize=2 * blockSize;
    cfDescriptor.setBlocksize(newBlockSize);
    try {
      admin.modifyColumnFamily(TABLE_NAME,cfDescriptor);
      Assert.fail("Modify a non-exist column family should fail");
    }
 catch (    InvalidFamilyOperationException e) {
    }
  }
  finally {
    admin.deleteTable(TABLE_NAME);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.master.procedure.TestDisableTableProcedure </h4><pre class="type-11 type-7 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testDisableTableMultipleTimes() throws Exception {
  final TableName tableName=TableName.valueOf("testDisableTableMultipleTimes");
  final ProcedureExecutor<MasterProcedureEnv> procExec=getMasterProcedureExecutor();
  MasterProcedureTestingUtility.createTable(procExec,tableName,null,"f1","f2");
  long procId1=procExec.submitProcedure(new DisableTableProcedure(procExec.getEnvironment(),tableName,false),nonceGroup,nonce);
  ProcedureTestingUtility.waitProcedure(procExec,procId1);
  ProcedureTestingUtility.assertProcNotFailed(procExec,procId1);
  MasterProcedureTestingUtility.validateTableIsDisabled(UTIL.getHBaseCluster().getMaster(),tableName);
  long procId2=procExec.submitProcedure(new DisableTableProcedure(procExec.getEnvironment(),tableName,false),nonceGroup + 1,nonce + 1);
  ProcedureTestingUtility.waitProcedure(procExec,procId2);
  ProcedureInfo result=procExec.getResult(procId2);
  assertTrue(result.isFailed());
  LOG.debug("Disable failed with exception: " + result.getExceptionFullMessage());
  assertTrue(ProcedureTestingUtility.getExceptionCause(result) instanceof TableNotEnabledException);
  try {
    final ProcedurePrepareLatch prepareLatch=new ProcedurePrepareLatch.CompatibilityLatch();
    long procId3=procExec.submitProcedure(new DisableTableProcedure(procExec.getEnvironment(),tableName,false,prepareLatch),nonceGroup + 2,nonce + 2);
    prepareLatch.await();
    Assert.fail("Disable should throw exception through latch.");
  }
 catch (  TableNotEnabledException tnee) {
    LOG.debug("Disable failed with expected exception.");
  }
  long procId4=procExec.submitProcedure(new DisableTableProcedure(procExec.getEnvironment(),tableName,true));
  ProcedureTestingUtility.waitProcedure(procExec,procId4);
  ProcedureTestingUtility.assertProcNotFailed(procExec,procId4);
  MasterProcedureTestingUtility.validateTableIsDisabled(UTIL.getHBaseCluster().getMaster(),tableName);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.master.procedure.TestEnableTableProcedure </h4><pre class="type-11 type-7 type-8 type-17 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000,expected=TableNotDisabledException.class) public void testEnableNonDisabledTable() throws Exception {
  final TableName tableName=TableName.valueOf("testEnableNonExistingTable");
  final ProcedureExecutor<MasterProcedureEnv> procExec=getMasterProcedureExecutor();
  MasterProcedureTestingUtility.createTable(procExec,tableName,null,"f1","f2");
  long procId1=procExec.submitProcedure(new EnableTableProcedure(procExec.getEnvironment(),tableName,false),nonceGroup,nonce);
  ProcedureTestingUtility.waitProcedure(procExec,procId1);
  ProcedureInfo result=procExec.getResult(procId1);
  assertTrue(result.isFailed());
  LOG.debug("Enable failed with exception: " + result.getExceptionFullMessage());
  assertTrue(ProcedureTestingUtility.getExceptionCause(result) instanceof TableNotDisabledException);
  long procId2=procExec.submitProcedure(new EnableTableProcedure(procExec.getEnvironment(),tableName,true),nonceGroup + 1,nonce + 1);
  ProcedureTestingUtility.waitProcedure(procExec,procId2);
  ProcedureTestingUtility.assertProcNotFailed(procExec,procId2);
  final ProcedurePrepareLatch prepareLatch=new ProcedurePrepareLatch.CompatibilityLatch();
  long procId3=procExec.submitProcedure(new EnableTableProcedure(procExec.getEnvironment(),tableName,false,prepareLatch),nonceGroup + 2,nonce + 2);
  prepareLatch.await();
  Assert.fail("Enable should throw exception through latch.");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.master.procedure.TestWALProcedureStoreOnHDFS </h4><pre class="type-9 type-11 type-7 type-8 type-5 type-17 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000,expected=RuntimeException.class) public void testWalAbortOnLowReplication() throws Exception {
  initConfig(UTIL.getConfiguration());
  setup();
  try {
    assertEquals(3,UTIL.getDFSCluster().getDataNodes().size());
    LOG.info("Stop DataNode");
    UTIL.getDFSCluster().stopDataNode(0);
    assertEquals(2,UTIL.getDFSCluster().getDataNodes().size());
    store.insert(new TestProcedure(1,-1),null);
    for (long i=2; store.isRunning(); ++i) {
      assertEquals(2,UTIL.getDFSCluster().getDataNodes().size());
      store.insert(new TestProcedure(i,-1),null);
      Thread.sleep(100);
    }
    assertFalse(store.isRunning());
    fail("The store.insert() should throw an exeption");
  }
  finally {
    tearDown();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.master.snapshot.TestSnapshotManager </h4><pre class="type-4 type-11 type-7 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify the snapshot support based on the configuration.
 */
@Test public void testSnapshotSupportConfiguration() throws Exception {
  Configuration conf=new Configuration();
  SnapshotManager manager=getNewManager(conf);
  assertFalse("Snapshot should be disabled with no configuration",isSnapshotSupported(manager));
  conf=new Configuration();
  conf.setBoolean(SnapshotManager.HBASE_SNAPSHOT_ENABLED,true);
  manager=getNewManager(conf);
  assertTrue("Snapshot should be enabled",isSnapshotSupported(manager));
  conf=new Configuration();
  conf.setBoolean(SnapshotManager.HBASE_SNAPSHOT_ENABLED,false);
  manager=getNewManager(conf);
  assertFalse("Snapshot should be disabled",isSnapshotSupported(manager));
  conf=new Configuration();
  conf.setStrings(HFileCleaner.MASTER_HFILE_CLEANER_PLUGINS,SnapshotHFileCleaner.class.getName(),HFileLinkCleaner.class.getName());
  conf.setBoolean(SnapshotManager.HBASE_SNAPSHOT_ENABLED,false);
  manager=getNewManager(conf);
  assertFalse("Snapshot should be disabled",isSnapshotSupported(manager));
  conf=new Configuration();
  conf.setStrings(HFileCleaner.MASTER_HFILE_CLEANER_PLUGINS,SnapshotHFileCleaner.class.getName(),HFileLinkCleaner.class.getName());
  manager=getNewManager(conf);
  assertTrue("Snapshot should be enabled, because cleaners are present",isSnapshotSupported(manager));
  Path rootDir=UTIL.getDataTestDir();
  Path testSnapshotDir=SnapshotDescriptionUtils.getCompletedSnapshotDir("testSnapshotSupportConfiguration",rootDir);
  fs.mkdirs(testSnapshotDir);
  try {
    conf=new Configuration();
    conf.setBoolean(SnapshotManager.HBASE_SNAPSHOT_ENABLED,false);
    manager=getNewManager(conf);
    fail("Master should not start when snapshot is disabled, but snapshots are present");
  }
 catch (  UnsupportedOperationException e) {
  }
 finally {
    fs.delete(testSnapshotDir,true);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.namespace.TestNamespaceAuditor </h4><pre class="type-4 type-11 type-7 type-13 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRestoreSnapshotQuotaExceed() throws Exception {
  String nsp=prefix + "_testRestoreSnapshotQuotaExceed";
  NamespaceDescriptor nspDesc=NamespaceDescriptor.create(nsp).addConfiguration(TableNamespaceManager.KEY_MAX_REGIONS,"10").build();
  ADMIN.createNamespace(nspDesc);
  NamespaceDescriptor ndesc=ADMIN.getNamespaceDescriptor(nsp);
  assertNotNull("Namespace descriptor found null.",ndesc);
  TableName tableName1=TableName.valueOf(nsp + TableName.NAMESPACE_DELIM + "table1");
  HTableDescriptor tableDescOne=new HTableDescriptor(tableName1);
  ADMIN.createTable(tableDescOne,Bytes.toBytes("AAA"),Bytes.toBytes("ZZZ"),4);
  NamespaceTableAndRegionInfo nstate=getNamespaceState(nsp);
  assertEquals("Intial region count should be 4.",4,nstate.getRegionCount());
  String snapshot="snapshot_testRestoreSnapshotQuotaExceed";
  ADMIN.snapshot(snapshot,tableName1);
  List<HRegionInfo> regions=ADMIN.getTableRegions(tableName1);
  Collections.sort(regions);
  ADMIN.split(tableName1,Bytes.toBytes("JJJ"));
  Thread.sleep(2000);
  assertEquals("Total regions count should be 5.",5,nstate.getRegionCount());
  ndesc.setConfiguration(TableNamespaceManager.KEY_MAX_REGIONS,"2");
  ADMIN.modifyNamespace(ndesc);
  ADMIN.disableTable(tableName1);
  try {
    ADMIN.restoreSnapshot(snapshot);
    fail("Region quota is exceeded so QuotaExceededException should be thrown but HBaseAdmin" + " wraps IOException into RestoreSnapshotException");
  }
 catch (  RestoreSnapshotException ignore) {
  }
  ADMIN.enableTable(tableName1);
  ADMIN.deleteSnapshot(snapshot);
}

</code></pre>

<br>
<pre class="type-4 type-11 type-7 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRecreateTableWithSameNameAfterFirstTimeFailure() throws Exception {
  String nsp1=prefix + "_testRecreateTable";
  NamespaceDescriptor nspDesc=NamespaceDescriptor.create(nsp1).addConfiguration(TableNamespaceManager.KEY_MAX_REGIONS,"20").addConfiguration(TableNamespaceManager.KEY_MAX_TABLES,"1").build();
  ADMIN.createNamespace(nspDesc);
  final TableName tableOne=TableName.valueOf(nsp1 + TableName.NAMESPACE_DELIM + "table1");
  byte[] columnFamily=Bytes.toBytes("info");
  HTableDescriptor tableDescOne=new HTableDescriptor(tableOne);
  tableDescOne.addFamily(new HColumnDescriptor(columnFamily));
  MasterSyncObserver.throwExceptionInPreCreateTableHandler=true;
  try {
    try {
      ADMIN.createTable(tableDescOne);
      fail("Table " + tableOne.toString() + "creation should fail.");
    }
 catch (    Exception exp) {
      LOG.error(exp);
    }
    assertFalse(ADMIN.tableExists(tableOne));
    NamespaceTableAndRegionInfo nstate=getNamespaceState(nsp1);
    assertEquals("First table creation failed in namespace so number of tables in namespace " + "should be 0.",0,nstate.getTables().size());
    MasterSyncObserver.throwExceptionInPreCreateTableHandler=false;
    try {
      ADMIN.createTable(tableDescOne);
    }
 catch (    Exception e) {
      fail("Table " + tableOne.toString() + "creation should succeed.");
      LOG.error(e);
    }
    assertTrue(ADMIN.tableExists(tableOne));
    nstate=getNamespaceState(nsp1);
    assertEquals("First table was created successfully so table size in namespace should " + "be one now.",1,nstate.getTables().size());
  }
  finally {
    MasterSyncObserver.throwExceptionInPreCreateTableHandler=false;
    if (ADMIN.tableExists(tableOne)) {
      ADMIN.disableTable(tableOne);
      deleteTable(tableOne);
    }
    ADMIN.deleteNamespace(nsp1);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.nio.TestMultiByteBuff </h4><pre class="type-4 type-11 type-7 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testArrayBasedMethods(){
  byte[] b=new byte[15];
  ByteBuffer bb1=ByteBuffer.wrap(b,1,10).slice();
  ByteBuffer bb2=ByteBuffer.allocate(15);
  ByteBuff mbb1=new MultiByteBuff(bb1,bb2);
  assertFalse(mbb1.hasArray());
  try {
    mbb1.array();
    fail();
  }
 catch (  UnsupportedOperationException e) {
  }
  try {
    mbb1.arrayOffset();
    fail();
  }
 catch (  UnsupportedOperationException e) {
  }
  mbb1=new SingleByteBuff(bb1);
  assertTrue(mbb1.hasArray());
  assertEquals(1,mbb1.arrayOffset());
  assertEquals(b,mbb1.array());
  mbb1=new SingleByteBuff(ByteBuffer.allocateDirect(10));
  assertFalse(mbb1.hasArray());
  try {
    mbb1.array();
    fail();
  }
 catch (  UnsupportedOperationException e) {
  }
  try {
    mbb1.arrayOffset();
    fail();
  }
 catch (  UnsupportedOperationException e) {
  }
}

</code></pre>

<br>
<pre class="type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWritesAndReads(){
  ByteBuffer bb1=ByteBuffer.allocate(15);
  ByteBuffer bb2=ByteBuffer.allocate(15);
  int i1=4;
  bb1.putInt(i1);
  long l1=45L, l2=100L, l3=12345L;
  bb1.putLong(l1);
  short s1=2;
  bb1.putShort(s1);
  byte[] b=Bytes.toBytes(l2);
  bb1.put(b,0,1);
  bb2.put(b,1,7);
  bb2.putLong(l3);
  MultiByteBuff mbb=new MultiByteBuff(bb1,bb2);
  assertEquals(l1,mbb.getLong(4));
  assertEquals(l2,mbb.getLong(14));
  assertEquals(l3,mbb.getLong(22));
  assertEquals(i1,mbb.getInt(0));
  assertEquals(s1,mbb.getShort(12));
  assertEquals(i1,mbb.getInt());
  assertEquals(l1,mbb.getLong());
  assertEquals(s1,mbb.getShort());
  assertEquals(l2,mbb.getLong());
  assertEquals(l3,mbb.getLong());
  bb1=ByteBuffer.allocate(15);
  bb2=ByteBuffer.allocate(15);
  mbb=new MultiByteBuff(bb1,bb2);
  byte b1=5, b2=31;
  mbb.put(b1);
  mbb.putLong(l1);
  mbb.putInt(i1);
  mbb.putLong(l2);
  mbb.put(b2);
  mbb.position(mbb.position() + 2);
  try {
    mbb.putLong(l3);
    fail("'Should have thrown BufferOverflowException");
  }
 catch (  BufferOverflowException e) {
  }
  mbb.position(mbb.position() - 2);
  mbb.putLong(l3);
  mbb.rewind();
  assertEquals(b1,mbb.get());
  assertEquals(l1,mbb.getLong());
  assertEquals(i1,mbb.getInt());
  assertEquals(l2,mbb.getLong());
  assertEquals(b2,mbb.get());
  assertEquals(l3,mbb.getLong());
  mbb.put(21,b1);
  mbb.position(21);
  assertEquals(b1,mbb.get());
  mbb.put(b);
  assertEquals(l2,mbb.getLong(22));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.quotas.TestQuotaAdmin </h4><pre class="type-10 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testThrottleType() throws Exception {
  Admin admin=TEST_UTIL.getHBaseAdmin();
  String userName=User.getCurrent().getShortName();
  admin.setQuota(QuotaSettingsFactory.throttleUser(userName,ThrottleType.READ_NUMBER,6,TimeUnit.MINUTES));
  admin.setQuota(QuotaSettingsFactory.throttleUser(userName,ThrottleType.WRITE_NUMBER,12,TimeUnit.MINUTES));
  admin.setQuota(QuotaSettingsFactory.bypassGlobals(userName,true));
  try (QuotaRetriever scanner=QuotaRetriever.open(TEST_UTIL.getConfiguration())){
    int countThrottle=0;
    int countGlobalBypass=0;
    for (    QuotaSettings settings : scanner) {
switch (settings.getQuotaType()) {
case THROTTLE:
        ThrottleSettings throttle=(ThrottleSettings)settings;
      if (throttle.getSoftLimit() == 6) {
        assertEquals(ThrottleType.READ_NUMBER,throttle.getThrottleType());
      }
 else       if (throttle.getSoftLimit() == 12) {
        assertEquals(ThrottleType.WRITE_NUMBER,throttle.getThrottleType());
      }
 else {
        fail("should not come here, because don't set quota with this limit");
      }
    assertEquals(userName,throttle.getUserName());
  assertEquals(null,throttle.getTableName());
assertEquals(null,throttle.getNamespace());
assertEquals(TimeUnit.MINUTES,throttle.getTimeUnit());
countThrottle++;
break;
case GLOBAL_BYPASS:
countGlobalBypass++;
break;
default :
fail("unexpected settings type: " + settings.getQuotaType());
}
}
assertEquals(2,countThrottle);
assertEquals(1,countGlobalBypass);
}
 admin.setQuota(QuotaSettingsFactory.unthrottleUser(userName));
assertNumResults(1,null);
admin.setQuota(QuotaSettingsFactory.bypassGlobals(userName,false));
assertNumResults(0,null);
}

</code></pre>

<br>
<pre class="type-10 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSimpleScan() throws Exception {
  Admin admin=TEST_UTIL.getHBaseAdmin();
  String userName=User.getCurrent().getShortName();
  admin.setQuota(QuotaSettingsFactory.throttleUser(userName,ThrottleType.REQUEST_NUMBER,6,TimeUnit.MINUTES));
  admin.setQuota(QuotaSettingsFactory.bypassGlobals(userName,true));
  try (QuotaRetriever scanner=QuotaRetriever.open(TEST_UTIL.getConfiguration())){
    int countThrottle=0;
    int countGlobalBypass=0;
    for (    QuotaSettings settings : scanner) {
      LOG.debug(settings);
switch (settings.getQuotaType()) {
case THROTTLE:
        ThrottleSettings throttle=(ThrottleSettings)settings;
      assertEquals(userName,throttle.getUserName());
    assertEquals(null,throttle.getTableName());
  assertEquals(null,throttle.getNamespace());
assertEquals(6,throttle.getSoftLimit());
assertEquals(TimeUnit.MINUTES,throttle.getTimeUnit());
countThrottle++;
break;
case GLOBAL_BYPASS:
countGlobalBypass++;
break;
default :
fail("unexpected settings type: " + settings.getQuotaType());
}
}
assertEquals(1,countThrottle);
assertEquals(1,countGlobalBypass);
}
 admin.setQuota(QuotaSettingsFactory.unthrottleUser(userName));
assertNumResults(1,null);
admin.setQuota(QuotaSettingsFactory.bypassGlobals(userName,false));
assertNumResults(0,null);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.regionserver.TestAtomicOperation </h4><pre class="type-9 type-10 type-11 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test multi-threaded row mutations.
 */
@Test public void testRowMutationMultiThreads() throws IOException {
  LOG.info("Starting test testRowMutationMultiThreads");
  initHRegion(tableName,name.getMethodName(),fam1);
  int numThreads=10;
  int opsPerThread=250;
  AtomicOperation[] all=new AtomicOperation[numThreads];
  AtomicLong timeStamps=new AtomicLong(0);
  AtomicInteger failures=new AtomicInteger(0);
  for (int i=0; i < numThreads; i++) {
    all[i]=new AtomicOperation(region,opsPerThread,timeStamps,failures){
      @Override public void run(){
        boolean op=true;
        for (int i=0; i < numOps; i++) {
          try {
            if (i % 10 == 0) {
synchronized (region) {
                LOG.debug("flushing");
                region.flush(true);
                if (i % 100 == 0) {
                  region.compact(false);
                }
              }
            }
            long ts=timeStamps.incrementAndGet();
            RowMutations rm=new RowMutations(row);
            if (op) {
              Put p=new Put(row,ts);
              p.addColumn(fam1,qual1,value1);
              p.setDurability(Durability.ASYNC_WAL);
              rm.add(p);
              Delete d=new Delete(row);
              d.addColumns(fam1,qual2,ts);
              d.setDurability(Durability.ASYNC_WAL);
              rm.add(d);
            }
 else {
              Delete d=new Delete(row);
              d.addColumns(fam1,qual1,ts);
              d.setDurability(Durability.ASYNC_WAL);
              rm.add(d);
              Put p=new Put(row,ts);
              p.addColumn(fam1,qual2,value2);
              p.setDurability(Durability.ASYNC_WAL);
              rm.add(p);
            }
            region.mutateRow(rm);
            op^=true;
            Get g=new Get(row);
            Result r=region.get(g);
            if (r.size() != 1) {
              LOG.debug(r);
              failures.incrementAndGet();
              fail();
            }
          }
 catch (          IOException e) {
            e.printStackTrace();
            failures.incrementAndGet();
            fail();
          }
        }
      }
    }
;
  }
  for (int i=0; i < numThreads; i++) {
    all[i].start();
  }
  for (int i=0; i < numThreads; i++) {
    try {
      all[i].join();
    }
 catch (    InterruptedException e) {
    }
  }
  assertEquals(0,failures.get());
}

</code></pre>

<br>
<pre class="type-9 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAppendMultiThreads() throws IOException {
  LOG.info("Starting test testAppendMultiThreads");
  initHRegion(tableName,name.getMethodName(),new int[]{1,3},fam1,fam2);
  int numThreads=100;
  int opsPerThread=100;
  AtomicOperation[] all=new AtomicOperation[numThreads];
  final byte[] val=new byte[]{1};
  AtomicInteger failures=new AtomicInteger(0);
  for (int i=0; i < numThreads; i++) {
    all[i]=new AtomicOperation(region,opsPerThread,null,failures){
      @Override public void run(){
        for (int i=0; i < numOps; i++) {
          try {
            Append a=new Append(row);
            a.add(fam1,qual1,val);
            a.add(fam1,qual2,val);
            a.add(fam2,qual3,val);
            a.setDurability(Durability.ASYNC_WAL);
            region.append(a,HConstants.NO_NONCE,HConstants.NO_NONCE);
            Get g=new Get(row);
            Result result=region.get(g);
            assertEquals(result.getValue(fam1,qual1).length,result.getValue(fam1,qual2).length);
            assertEquals(result.getValue(fam1,qual1).length,result.getValue(fam2,qual3).length);
          }
 catch (          IOException e) {
            e.printStackTrace();
            failures.incrementAndGet();
            fail();
          }
        }
      }
    }
;
  }
  for (int i=0; i < numThreads; i++) {
    all[i].start();
  }
  for (int i=0; i < numThreads; i++) {
    try {
      all[i].join();
    }
 catch (    InterruptedException e) {
    }
  }
  assertEquals(0,failures.get());
  Get g=new Get(row);
  Result result=region.get(g);
  assertEquals(result.getValue(fam1,qual1).length,10000);
  assertEquals(result.getValue(fam1,qual2).length,10000);
  assertEquals(result.getValue(fam2,qual3).length,10000);
}

</code></pre>

<br>
<pre class="type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testIncrementWithNonExistingFamily() throws IOException {
  initHRegion(tableName,name.getMethodName(),fam1);
  final Increment inc=new Increment(row);
  inc.addColumn(fam1,qual1,1);
  inc.addColumn(fam2,qual2,1);
  inc.setDurability(Durability.ASYNC_WAL);
  try {
    region.increment(inc,HConstants.NO_NONCE,HConstants.NO_NONCE);
  }
 catch (  NoSuchColumnFamilyException e) {
    final Get g=new Get(row);
    final Result result=region.get(g);
    assertEquals(null,result.getValue(fam1,qual1));
    assertEquals(null,result.getValue(fam2,qual2));
  }
catch (  Exception e) {
    fail("Increment operation should fail with NoSuchColumnFamilyException.");
  }
}

</code></pre>

<br>
<pre class="type-9 type-10 type-11 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test multi-threaded region mutations.
 */
@Test public void testMultiRowMutationMultiThreads() throws IOException {
  LOG.info("Starting test testMultiRowMutationMultiThreads");
  initHRegion(tableName,name.getMethodName(),fam1);
  int numThreads=10;
  int opsPerThread=250;
  AtomicOperation[] all=new AtomicOperation[numThreads];
  AtomicLong timeStamps=new AtomicLong(0);
  AtomicInteger failures=new AtomicInteger(0);
  final List<byte[]> rowsToLock=Arrays.asList(row,row2);
  for (int i=0; i < numThreads; i++) {
    all[i]=new AtomicOperation(region,opsPerThread,timeStamps,failures){
      @Override public void run(){
        boolean op=true;
        for (int i=0; i < numOps; i++) {
          try {
            if (i % 10 == 0) {
synchronized (region) {
                LOG.debug("flushing");
                region.flush(true);
                if (i % 100 == 0) {
                  region.compact(false);
                }
              }
            }
            long ts=timeStamps.incrementAndGet();
            List<Mutation> mrm=new ArrayList<Mutation>();
            if (op) {
              Put p=new Put(row2,ts);
              p.addColumn(fam1,qual1,value1);
              p.setDurability(Durability.ASYNC_WAL);
              mrm.add(p);
              Delete d=new Delete(row);
              d.addColumns(fam1,qual1,ts);
              d.setDurability(Durability.ASYNC_WAL);
              mrm.add(d);
            }
 else {
              Delete d=new Delete(row2);
              d.addColumns(fam1,qual1,ts);
              d.setDurability(Durability.ASYNC_WAL);
              mrm.add(d);
              Put p=new Put(row,ts);
              p.setDurability(Durability.ASYNC_WAL);
              p.addColumn(fam1,qual1,value2);
              mrm.add(p);
            }
            region.mutateRowsWithLocks(mrm,rowsToLock,HConstants.NO_NONCE,HConstants.NO_NONCE);
            op^=true;
            Scan s=new Scan(row);
            RegionScanner rs=region.getScanner(s);
            List<Cell> r=new ArrayList<Cell>();
            while (rs.next(r))             ;
            rs.close();
            if (r.size() != 1) {
              LOG.debug(r);
              failures.incrementAndGet();
              fail();
            }
          }
 catch (          IOException e) {
            e.printStackTrace();
            failures.incrementAndGet();
            fail();
          }
        }
      }
    }
;
  }
  for (int i=0; i < numThreads; i++) {
    all[i].start();
  }
  for (int i=0; i < numThreads; i++) {
    try {
      all[i].join();
    }
 catch (    InterruptedException e) {
    }
  }
  assertEquals(0,failures.get());
}

</code></pre>

<br>
<pre class="type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAppendWithNonExistingFamily() throws IOException {
  initHRegion(tableName,name.getMethodName(),fam1);
  final String v1="Value";
  final Append a=new Append(row);
  a.add(fam1,qual1,Bytes.toBytes(v1));
  a.add(fam2,qual2,Bytes.toBytes(v1));
  Result result=null;
  try {
    result=region.append(a,HConstants.NO_NONCE,HConstants.NO_NONCE);
    fail("Append operation should fail with NoSuchColumnFamilyException.");
  }
 catch (  NoSuchColumnFamilyException e) {
    assertEquals(null,result);
  }
catch (  Exception e) {
    fail("Append operation should fail with NoSuchColumnFamilyException.");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.regionserver.TestCompactSplitThread </h4><pre class="type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testThreadPoolSizeTuning() throws Exception {
  Configuration conf=TEST_UTIL.getConfiguration();
  conf.setInt(CompactSplitThread.LARGE_COMPACTION_THREADS,3);
  conf.setInt(CompactSplitThread.SMALL_COMPACTION_THREADS,4);
  conf.setInt(CompactSplitThread.SPLIT_THREADS,5);
  conf.setInt(CompactSplitThread.MERGE_THREADS,6);
  TEST_UTIL.startMiniCluster(1);
  Connection conn=ConnectionFactory.createConnection(conf);
  try {
    HTableDescriptor htd=new HTableDescriptor(tableName);
    htd.addFamily(new HColumnDescriptor(family));
    htd.setCompactionEnabled(false);
    TEST_UTIL.getHBaseAdmin().createTable(htd);
    TEST_UTIL.waitTableAvailable(tableName);
    HRegionServer regionServer=TEST_UTIL.getRSForFirstRegionInTable(tableName);
    assertEquals(3,regionServer.compactSplitThread.getLargeCompactionThreadNum());
    assertEquals(4,regionServer.compactSplitThread.getSmallCompactionThreadNum());
    assertEquals(5,regionServer.compactSplitThread.getSplitThreadNum());
    assertEquals(6,regionServer.compactSplitThread.getMergeThreadNum());
    conf.setInt(CompactSplitThread.LARGE_COMPACTION_THREADS,4);
    conf.setInt(CompactSplitThread.SMALL_COMPACTION_THREADS,5);
    conf.setInt(CompactSplitThread.SPLIT_THREADS,6);
    conf.setInt(CompactSplitThread.MERGE_THREADS,7);
    try {
      regionServer.compactSplitThread.onConfigurationChange(conf);
    }
 catch (    IllegalArgumentException iae) {
      Assert.fail("Update bigger configuration failed!");
    }
    assertEquals(4,regionServer.compactSplitThread.getLargeCompactionThreadNum());
    assertEquals(5,regionServer.compactSplitThread.getSmallCompactionThreadNum());
    assertEquals(6,regionServer.compactSplitThread.getSplitThreadNum());
    assertEquals(7,regionServer.compactSplitThread.getMergeThreadNum());
    conf.setInt(CompactSplitThread.LARGE_COMPACTION_THREADS,2);
    conf.setInt(CompactSplitThread.SMALL_COMPACTION_THREADS,3);
    conf.setInt(CompactSplitThread.SPLIT_THREADS,4);
    conf.setInt(CompactSplitThread.MERGE_THREADS,5);
    try {
      regionServer.compactSplitThread.onConfigurationChange(conf);
    }
 catch (    IllegalArgumentException iae) {
      Assert.fail("Update smaller configuration failed!");
    }
    assertEquals(2,regionServer.compactSplitThread.getLargeCompactionThreadNum());
    assertEquals(3,regionServer.compactSplitThread.getSmallCompactionThreadNum());
    assertEquals(4,regionServer.compactSplitThread.getSplitThreadNum());
    assertEquals(5,regionServer.compactSplitThread.getMergeThreadNum());
  }
  finally {
    conn.close();
    TEST_UTIL.shutdownMiniCluster();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.regionserver.TestCompaction </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testCompactionWithCorruptResult() throws Exception {
  int nfiles=10;
  for (int i=0; i < nfiles; i++) {
    createStoreFile(r);
  }
  HStore store=(HStore)r.getStore(COLUMN_FAMILY);
  Collection<StoreFile> storeFiles=store.getStorefiles();
  DefaultCompactor tool=(DefaultCompactor)store.storeEngine.getCompactor();
  tool.compactForTesting(storeFiles,false);
  FileSystem fs=store.getFileSystem();
  Path dstPath=store.getRegionFileSystem().createTempName();
  FSDataOutputStream stream=fs.create(dstPath,null,true,512,(short)3,(long)1024,null);
  stream.writeChars("CORRUPT FILE!!!!");
  stream.close();
  Path origPath=store.getRegionFileSystem().commitStoreFile(Bytes.toString(COLUMN_FAMILY),dstPath);
  try {
    ((HStore)store).moveFileIntoPlace(origPath);
  }
 catch (  Exception e) {
    assert (fs.exists(origPath));
    assert (!fs.exists(dstPath));
    System.out.println("testCompactionWithCorruptResult Passed");
    return;
  }
  fail("testCompactionWithCorruptResult failed since no exception was" + "thrown while completing a corrupt file");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.regionserver.TestFSErrorsExposed </h4><pre class="type-4 type-11 type-7 type-8 type-13 type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Injects errors into the pread calls of an on-disk file, and makes
 * sure those bubble up to the HFile scanner
 */
@Test public void testHFileScannerThrowsErrors() throws IOException {
  Path hfilePath=new Path(new Path(util.getDataTestDir("internalScannerExposesErrors"),"regionname"),"familyname");
  HFileSystem hfs=(HFileSystem)util.getTestFileSystem();
  FaultyFileSystem faultyfs=new FaultyFileSystem(hfs.getBackingFs());
  FileSystem fs=new HFileSystem(faultyfs);
  CacheConfig cacheConf=new CacheConfig(util.getConfiguration());
  HFileContext meta=new HFileContextBuilder().withBlockSize(2 * 1024).build();
  StoreFile.Writer writer=new StoreFile.WriterBuilder(util.getConfiguration(),cacheConf,hfs).withOutputDir(hfilePath).withFileContext(meta).build();
  TestStoreFile.writeStoreFile(writer,Bytes.toBytes("cf"),Bytes.toBytes("qual"));
  StoreFile sf=new StoreFile(fs,writer.getPath(),util.getConfiguration(),cacheConf,BloomType.NONE);
  StoreFile.Reader reader=sf.createReader();
  HFileScanner scanner=reader.getScanner(false,true);
  FaultyInputStream inStream=faultyfs.inStreams.get(0).get();
  assertNotNull(inStream);
  scanner.seekTo();
  assertTrue(scanner.next());
  faultyfs.startFaults();
  try {
    int scanned=0;
    while (scanner.next()) {
      scanned++;
    }
    fail("Scanner didn't throw after faults injected");
  }
 catch (  IOException ioe) {
    LOG.info("Got expected exception",ioe);
    assertTrue(ioe.getMessage().contains("Fault"));
  }
  reader.close(true);
}

</code></pre>

<br>
<pre class="type-11 type-8 type-21 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Cluster test which starts a region server with a region, then
 * removes the data from HDFS underneath it, and ensures that
 * errors are bubbled to the client.
 */
@Test(timeout=5 * 60 * 1000) public void testFullSystemBubblesFSErrors() throws Exception {
  Assume.assumeTrue(!util.isReadShortCircuitOn());
  try {
    util.getConfiguration().setInt(HConstants.HBASE_CLIENT_RETRIES_NUMBER,1);
    util.startMiniCluster(1);
    TableName tableName=TableName.valueOf("table");
    byte[] fam=Bytes.toBytes("fam");
    Admin admin=util.getHBaseAdmin();
    HTableDescriptor desc=new HTableDescriptor(tableName);
    desc.addFamily(new HColumnDescriptor(fam).setMaxVersions(1).setBlockCacheEnabled(false));
    admin.createTable(desc);
    try (Table table=util.getConnection().getTable(tableName)){
      util.loadTable(table,fam,false);
      util.flush();
      util.countRows(table);
      util.getDFSCluster().shutdownDataNodes();
      try {
        util.countRows(table);
        fail("Did not fail to count after removing data");
      }
 catch (      Exception e) {
        LOG.info("Got expected error",e);
        assertTrue(e.getMessage().contains("Could not seek"));
      }
    }
     util.getDFSCluster().restartDataNodes();
  }
  finally {
    MiniHBaseCluster cluster=util.getMiniHBaseCluster();
    if (cluster != null)     cluster.killAll();
    util.shutdownMiniCluster();
  }
}

</code></pre>

<br>
<pre class="type-4 type-11 type-7 type-8 type-13 type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Injects errors into the pread calls of an on-disk file, and makes
 * sure those bubble up to the StoreFileScanner
 */
@Test public void testStoreFileScannerThrowsErrors() throws IOException {
  Path hfilePath=new Path(new Path(util.getDataTestDir("internalScannerExposesErrors"),"regionname"),"familyname");
  HFileSystem hfs=(HFileSystem)util.getTestFileSystem();
  FaultyFileSystem faultyfs=new FaultyFileSystem(hfs.getBackingFs());
  HFileSystem fs=new HFileSystem(faultyfs);
  CacheConfig cacheConf=new CacheConfig(util.getConfiguration());
  HFileContext meta=new HFileContextBuilder().withBlockSize(2 * 1024).build();
  StoreFile.Writer writer=new StoreFile.WriterBuilder(util.getConfiguration(),cacheConf,hfs).withOutputDir(hfilePath).withFileContext(meta).build();
  TestStoreFile.writeStoreFile(writer,Bytes.toBytes("cf"),Bytes.toBytes("qual"));
  StoreFile sf=new StoreFile(fs,writer.getPath(),util.getConfiguration(),cacheConf,BloomType.NONE);
  List<StoreFileScanner> scanners=StoreFileScanner.getScannersForStoreFiles(Collections.singletonList(sf),false,true,false,false,0);
  KeyValueScanner scanner=scanners.get(0);
  FaultyInputStream inStream=faultyfs.inStreams.get(0).get();
  assertNotNull(inStream);
  scanner.seek(KeyValue.LOWESTKEY);
  assertNotNull(scanner.next());
  faultyfs.startFaults();
  try {
    int scanned=0;
    while (scanner.next() != null) {
      scanned++;
    }
    fail("Scanner didn't throw after faults injected");
  }
 catch (  IOException ioe) {
    LOG.info("Got expected exception",ioe);
    assertTrue(ioe.getMessage().contains("Could not iterate"));
  }
  scanner.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.regionserver.TestFailedAppendAndSync </h4><pre class="type-11 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Reproduce locking up that happens when we get an exceptions appending and syncing.
 * See HBASE-14317.
 * First I need to set up some mocks for Server and RegionServerServices. I also need to
 * set up a dodgy WAL that will throw an exception when we go to append to it.
 */
@Test(timeout=300000) public void testLockupAroundBadAssignSync() throws IOException {
  final AtomicLong rolls=new AtomicLong(0);
class DodgyFSLog extends FSHLog {
    volatile boolean throwSyncException=false;
    volatile boolean throwAppendException=false;
    public DodgyFSLog(    FileSystem fs,    Path root,    String logDir,    Configuration conf) throws IOException {
      super(fs,root,logDir,conf);
    }
    @Override public byte[][] rollWriter(    boolean force) throws FailedLogCloseException, IOException {
      byte[][] regions=super.rollWriter(force);
      rolls.getAndIncrement();
      return regions;
    }
    @Override protected Writer createWriterInstance(    Path path) throws IOException {
      final Writer w=super.createWriterInstance(path);
      return new Writer(){
        @Override public void close() throws IOException {
          w.close();
        }
        @Override public void sync() throws IOException {
          if (throwSyncException) {
            throw new IOException("FAKE! Failed to replace a bad datanode...");
          }
          w.sync();
        }
        @Override public void append(        Entry entry) throws IOException {
          if (throwAppendException) {
            throw new IOException("FAKE! Failed to replace a bad datanode...");
          }
          w.append(entry);
        }
        @Override public long getLength() throws IOException {
          return w.getLength();
        }
      }
;
    }
  }
  Server server=mock(Server.class);
  when(server.getConfiguration()).thenReturn(CONF);
  when(server.isStopped()).thenReturn(false);
  when(server.isAborted()).thenReturn(false);
  RegionServerServices services=mock(RegionServerServices.class);
  FileSystem fs=FileSystem.get(CONF);
  Path rootDir=new Path(dir + getName());
  DodgyFSLog dodgyWAL=new DodgyFSLog(fs,rootDir,getName(),CONF);
  LogRoller logRoller=new LogRoller(server,services);
  logRoller.addWAL(dodgyWAL);
  logRoller.start();
  boolean threwOnSync=false;
  boolean threwOnAppend=false;
  boolean threwOnBoth=false;
  HRegion region=initHRegion(tableName,null,null,dodgyWAL);
  try {
    byte[] value=Bytes.toBytes(getName());
    try {
      Put put=new Put(value);
      put.addColumn(COLUMN_FAMILY_BYTES,Bytes.toBytes("1"),value);
      region.put(put);
    }
 catch (    IOException ioe) {
      fail();
    }
    long rollsCount=rolls.get();
    try {
      dodgyWAL.throwAppendException=true;
      dodgyWAL.throwSyncException=false;
      Put put=new Put(value);
      put.addColumn(COLUMN_FAMILY_BYTES,Bytes.toBytes("3"),value);
      region.put(put);
    }
 catch (    IOException ioe) {
      threwOnAppend=true;
    }
    while (rollsCount == rolls.get())     Threads.sleep(100);
    rollsCount=rolls.get();
    try {
      dodgyWAL.throwAppendException=true;
      dodgyWAL.throwSyncException=true;
      Put put=new Put(value);
      put.addColumn(COLUMN_FAMILY_BYTES,Bytes.toBytes("4"),value);
      region.put(put);
    }
 catch (    IOException ioe) {
      threwOnBoth=true;
    }
    while (rollsCount == rolls.get())     Threads.sleep(100);
    Mockito.verify(server,Mockito.atLeast(0)).abort(Mockito.anyString(),(Throwable)Mockito.anyObject());
    try {
      dodgyWAL.throwAppendException=false;
      dodgyWAL.throwSyncException=true;
      Put put=new Put(value);
      put.addColumn(COLUMN_FAMILY_BYTES,Bytes.toBytes("2"),value);
      region.put(put);
    }
 catch (    IOException ioe) {
      threwOnSync=true;
    }
    while (true) {
      try {
        Mockito.verify(server,Mockito.atLeast(1)).abort(Mockito.anyString(),(Throwable)Mockito.anyObject());
        break;
      }
 catch (      WantedButNotInvoked t) {
        Threads.sleep(1);
      }
    }
  }
  finally {
    Mockito.when(server.isStopped()).thenReturn(true);
    if (logRoller != null)     logRoller.interrupt();
    if (region != null) {
      try {
        region.close(true);
      }
 catch (      DroppedSnapshotException e) {
        LOG.info("On way out; expected!",e);
      }
    }
    if (dodgyWAL != null)     dodgyWAL.close();
    assertTrue("The regionserver should have thrown an exception",threwOnBoth);
    assertTrue("The regionserver should have thrown an exception",threwOnAppend);
    assertTrue("The regionserver should have thrown an exception",threwOnSync);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.regionserver.TestHRegion </h4><pre class="type-10 type-11 type-7 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Testcase to check state of region initialization task set to ABORTED or not
 * if any exceptions during initialization
 * @throws Exception
 */
@Test public void testStatusSettingToAbortIfAnyExceptionDuringRegionInitilization() throws Exception {
  TableName tableName=TableName.valueOf(name.getMethodName());
  HRegionInfo info=null;
  try {
    FileSystem fs=Mockito.mock(FileSystem.class);
    Mockito.when(fs.exists((Path)Mockito.anyObject())).thenThrow(new IOException());
    HTableDescriptor htd=new HTableDescriptor(tableName);
    htd.addFamily(new HColumnDescriptor("cf"));
    info=new HRegionInfo(htd.getTableName(),HConstants.EMPTY_BYTE_ARRAY,HConstants.EMPTY_BYTE_ARRAY,false);
    Path path=new Path(dir + "testStatusSettingToAbortIfAnyExceptionDuringRegionInitilization");
    region=HRegion.newHRegion(path,null,fs,CONF,info,htd,null);
    region.initialize();
    fail("Region initialization should fail due to IOException");
  }
 catch (  IOException io) {
    List<MonitoredTask> tasks=TaskMonitor.get().getTasks();
    for (    MonitoredTask monitoredTask : tasks) {
      if (!(monitoredTask instanceof MonitoredRPCHandler) && monitoredTask.getDescription().contains(region.toString())) {
        assertTrue("Region state should be ABORTED.",monitoredTask.getState().equals(MonitoredTask.State.ABORTED));
        break;
      }
    }
  }
 finally {
    HBaseTestingUtility.closeRegionAndWAL(region);
  }
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Test RegionTooBusyException thrown when region is busy
 */
@Test(timeout=24000) public void testRegionTooBusy() throws IOException {
  String method="testRegionTooBusy";
  TableName tableName=TableName.valueOf(method);
  byte[] family=Bytes.toBytes("family");
  long defaultBusyWaitDuration=CONF.getLong("hbase.busy.wait.duration",HRegion.DEFAULT_BUSY_WAIT_DURATION);
  CONF.setLong("hbase.busy.wait.duration",1000);
  region=initHRegion(tableName,method,CONF,family);
  final AtomicBoolean stopped=new AtomicBoolean(true);
  Thread t=new Thread(new Runnable(){
    @Override public void run(){
      try {
        region.lock.writeLock().lock();
        stopped.set(false);
        while (!stopped.get()) {
          Thread.sleep(100);
        }
      }
 catch (      InterruptedException ie) {
      }
 finally {
        region.lock.writeLock().unlock();
      }
    }
  }
);
  t.start();
  Get get=new Get(row);
  try {
    while (stopped.get()) {
      Thread.sleep(100);
    }
    region.get(get);
    fail("Should throw RegionTooBusyException");
  }
 catch (  InterruptedException ie) {
    fail("test interrupted");
  }
catch (  RegionTooBusyException e) {
  }
 finally {
    stopped.set(true);
    try {
      t.join();
    }
 catch (    Throwable e) {
    }
    HBaseTestingUtility.closeRegionAndWAL(region);
    region=null;
    CONF.setLong("hbase.busy.wait.duration",defaultBusyWaitDuration);
  }
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testCheckAndPut_wrongRowInPut() throws IOException {
  TableName tableName=TableName.valueOf(name.getMethodName());
  this.region=initHRegion(tableName,this.getName(),CONF,COLUMNS);
  try {
    Put put=new Put(row2);
    put.addColumn(fam1,qual1,value1);
    try {
      region.checkAndMutate(row,fam1,qual1,CompareOp.EQUAL,new BinaryComparator(value2),put,false);
      fail();
    }
 catch (    org.apache.hadoop.hbase.DoNotRetryIOException expected) {
    }
  }
  finally {
    HBaseTestingUtility.closeRegionAndWAL(this.region);
    this.region=null;
  }
}

</code></pre>

<br>
<pre class="type-4 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test we do not lose data if we fail a flush and then close.
 * Part of HBase-10466.  Tests the following from the issue description:
 * "Bug 1: Wrong calculation of HRegion.memstoreSize: When a flush fails, data to be flushed is
 * kept in each MemStore's snapshot and wait for next flush attempt to continue on it. But when
 * the next flush succeeds, the counter of total memstore size in HRegion is always deduced by
 * the sum of current memstore sizes instead of snapshots left from previous failed flush. This
 * calculation is problematic that almost every time there is failed flush, HRegion.memstoreSize
 * gets reduced by a wrong value. If region flush could not proceed for a couple cycles, the size
 * in current memstore could be much larger than the snapshot. It's likely to drift memstoreSize
 * much smaller than expected. In extreme case, if the error accumulates to even bigger than
 * HRegion's memstore size limit, any further flush is skipped because flush does not do anything
 * if memstoreSize is not larger than 0."
 * @throws Exception
 */
@Test(timeout=60000) public void testFlushSizeAccounting() throws Exception {
  final Configuration conf=HBaseConfiguration.create(CONF);
  final String callingMethod=name.getMethodName();
  final WAL wal=createWALCompatibleWithFaultyFileSystem(callingMethod,conf,tableName);
  conf.setInt("hbase.hstore.flush.retries.number",1);
  final User user=User.createUserForTesting(conf,this.name.getMethodName(),new String[]{"foo"});
  conf.setClass("fs.file.impl",FaultyFileSystem.class,FileSystem.class);
  user.runAs(new PrivilegedExceptionAction(){
    @Override public Object run() throws Exception {
      FileSystem fs=FileSystem.get(conf);
      Assert.assertEquals(FaultyFileSystem.class,fs.getClass());
      FaultyFileSystem ffs=(FaultyFileSystem)fs;
      HRegion region=null;
      try {
        region=initHRegion(tableName,null,null,callingMethod,conf,false,Durability.SYNC_WAL,wal,COLUMN_FAMILY_BYTES);
        long size=region.getMemstoreSize();
        Assert.assertEquals(0,size);
        Put p1=new Put(row);
        p1.add(new KeyValue(row,COLUMN_FAMILY_BYTES,qual1,1,(byte[])null));
        region.put(p1);
        final long sizeOfOnePut=region.getMemstoreSize();
        try {
          LOG.info("Flushing");
          region.flush(true);
          Assert.fail("Didn't bubble up IOE!");
        }
 catch (        DroppedSnapshotException dse) {
          region.closing.set(false);
        }
        ffs.fault.set(false);
        Assert.assertEquals(sizeOfOnePut,region.getMemstoreSize());
        Put p2=new Put(row);
        p2.add(new KeyValue(row,COLUMN_FAMILY_BYTES,qual2,2,(byte[])null));
        p2.add(new KeyValue(row,COLUMN_FAMILY_BYTES,qual3,3,(byte[])null));
        region.put(p2);
        Assert.assertEquals(sizeOfOnePut * 3,region.getMemstoreSize());
        region.flush(true);
        Assert.assertEquals(sizeOfOnePut * 2,region.getMemstoreSize());
      }
  finally {
        HBaseTestingUtility.closeRegionAndWAL(region);
      }
      return null;
    }
  }
);
  FileSystem.closeAllForUGI(user.getUGI());
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testRegionReplicaSecondaryIsReadOnly() throws IOException {
  Path rootDir=new Path(dir + "testRegionReplicaSecondary");
  FSUtils.setRootDir(TEST_UTIL.getConfiguration(),rootDir);
  byte[][] families=new byte[][]{Bytes.toBytes("cf1"),Bytes.toBytes("cf2"),Bytes.toBytes("cf3")};
  byte[] cq=Bytes.toBytes("cq");
  HTableDescriptor htd=new HTableDescriptor(TableName.valueOf("testRegionReplicaSecondary"));
  for (  byte[] family : families) {
    htd.addFamily(new HColumnDescriptor(family));
  }
  long time=System.currentTimeMillis();
  HRegionInfo primaryHri=new HRegionInfo(htd.getTableName(),HConstants.EMPTY_START_ROW,HConstants.EMPTY_END_ROW,false,time,0);
  HRegionInfo secondaryHri=new HRegionInfo(htd.getTableName(),HConstants.EMPTY_START_ROW,HConstants.EMPTY_END_ROW,false,time,1);
  HRegion primaryRegion=null, secondaryRegion=null;
  try {
    primaryRegion=HBaseTestingUtility.createRegionAndWAL(primaryHri,rootDir,TEST_UTIL.getConfiguration(),htd);
    putData(primaryRegion,0,1000,cq,families);
    primaryRegion.flush(true);
    secondaryRegion=HRegion.openHRegion(rootDir,secondaryHri,htd,null,CONF);
    try {
      putData(secondaryRegion,0,1000,cq,families);
      fail("Should have thrown exception");
    }
 catch (    IOException ex) {
    }
  }
  finally {
    if (primaryRegion != null) {
      HBaseTestingUtility.closeRegionAndWAL(primaryRegion);
    }
    if (secondaryRegion != null) {
      HBaseTestingUtility.closeRegionAndWAL(secondaryRegion);
    }
  }
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * This method tests https://issues.apache.org/jira/browse/HBASE-2516.
 * @throws IOException
 */
@Test public void testGetScanner_WithRegionClosed() throws IOException {
  byte[] fam1=Bytes.toBytes("fam1");
  byte[] fam2=Bytes.toBytes("fam2");
  byte[][] families={fam1,fam2};
  String method=this.getName();
  try {
    this.region=initHRegion(tableName,method,CONF,families);
  }
 catch (  IOException e) {
    e.printStackTrace();
    fail("Got IOException during initHRegion, " + e.getMessage());
  }
  try {
    region.closed.set(true);
    try {
      region.getScanner(null);
      fail("Expected to get an exception during getScanner on a region that is closed");
    }
 catch (    NotServingRegionException e) {
    }
catch (    IOException e) {
      fail("Got wrong type of exception - should be a NotServingRegionException, but was an IOException: " + e.getMessage());
    }
  }
  finally {
    HBaseTestingUtility.closeRegionAndWAL(this.region);
    this.region=null;
  }
}

</code></pre>

<br>
<pre class="type-4 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=60000) public void testCloseWithFailingFlush() throws Exception {
  final Configuration conf=HBaseConfiguration.create(CONF);
  final String callingMethod=name.getMethodName();
  final WAL wal=createWALCompatibleWithFaultyFileSystem(callingMethod,conf,tableName);
  conf.setInt("hbase.hstore.flush.retries.number",1);
  final User user=User.createUserForTesting(conf,this.name.getMethodName(),new String[]{"foo"});
  conf.setClass("fs.file.impl",FaultyFileSystem.class,FileSystem.class);
  user.runAs(new PrivilegedExceptionAction(){
    @Override public Object run() throws Exception {
      FileSystem fs=FileSystem.get(conf);
      Assert.assertEquals(FaultyFileSystem.class,fs.getClass());
      FaultyFileSystem ffs=(FaultyFileSystem)fs;
      HRegion region=null;
      try {
        region=initHRegion(tableName,null,null,callingMethod,conf,false,Durability.SYNC_WAL,wal,COLUMN_FAMILY_BYTES);
        long size=region.getMemstoreSize();
        Assert.assertEquals(0,size);
        Put p1=new Put(row);
        p1.add(new KeyValue(row,COLUMN_FAMILY_BYTES,qual1,1,(byte[])null));
        region.put(p1);
        Store store=region.getStore(COLUMN_FAMILY_BYTES);
        StoreFlushContext storeFlushCtx=store.createFlushContext(12345);
        storeFlushCtx.prepare();
        Put p2=new Put(row);
        p2.add(new KeyValue(row,COLUMN_FAMILY_BYTES,qual2,2,(byte[])null));
        p2.add(new KeyValue(row,COLUMN_FAMILY_BYTES,qual3,3,(byte[])null));
        region.put(p2);
        region.close();
        fail();
      }
 catch (      DroppedSnapshotException dse) {
        LOG.info("Expected DroppedSnapshotException");
      }
 finally {
        ffs.fault.set(false);
        HBaseTestingUtility.closeRegionAndWAL(region);
      }
      return null;
    }
  }
);
  FileSystem.closeAllForUGI(user.getUGI());
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=60000) public void testFlushMarkersWALFail() throws Exception {
  String method=name.getMethodName();
  TableName tableName=TableName.valueOf(method);
  byte[] family=Bytes.toBytes("family");
  Path logDir=TEST_UTIL.getDataTestDirOnTestFS(method + "log");
  final Configuration walConf=new Configuration(TEST_UTIL.getConfiguration());
  FSUtils.setRootDir(walConf,logDir);
class FailAppendFlushMarkerWAL extends FSHLog {
    volatile FlushAction[] flushActions=null;
    public FailAppendFlushMarkerWAL(    FileSystem fs,    Path root,    String logDir,    Configuration conf) throws IOException {
      super(fs,root,logDir,conf);
    }
    @Override protected Writer createWriterInstance(    Path path) throws IOException {
      final Writer w=super.createWriterInstance(path);
      return new Writer(){
        @Override public void close() throws IOException {
          w.close();
        }
        @Override public void sync() throws IOException {
          w.sync();
        }
        @Override public void append(        Entry entry) throws IOException {
          List<Cell> cells=entry.getEdit().getCells();
          if (WALEdit.isMetaEditFamily(cells.get(0))) {
            FlushDescriptor desc=WALEdit.getFlushDescriptor(cells.get(0));
            if (desc != null) {
              for (              FlushAction flushAction : flushActions) {
                if (desc.getAction().equals(flushAction)) {
                  throw new IOException("Failed to append flush marker! " + flushAction);
                }
              }
            }
          }
          w.append(entry);
        }
        @Override public long getLength() throws IOException {
          return w.getLength();
        }
      }
;
    }
  }
  FailAppendFlushMarkerWAL wal=new FailAppendFlushMarkerWAL(FileSystem.get(walConf),FSUtils.getRootDir(walConf),getName(),walConf);
  this.region=initHRegion(tableName,HConstants.EMPTY_START_ROW,HConstants.EMPTY_END_ROW,method,CONF,false,Durability.USE_DEFAULT,wal,family);
  try {
    int i=0;
    Put put=new Put(Bytes.toBytes(i));
    put.setDurability(Durability.SKIP_WAL);
    put.addColumn(family,Bytes.toBytes(i),Bytes.toBytes(i));
    region.put(put);
    wal.flushActions=new FlushAction[]{FlushAction.START_FLUSH};
    try {
      region.flush(true);
      fail("This should have thrown exception");
    }
 catch (    DroppedSnapshotException unexpected) {
      throw unexpected;
    }
catch (    IOException expected) {
    }
    region.close(true);
    wal.close();
    wal.flushActions=new FlushAction[]{FlushAction.COMMIT_FLUSH};
    wal=new FailAppendFlushMarkerWAL(FileSystem.get(walConf),FSUtils.getRootDir(walConf),getName(),walConf);
    this.region=initHRegion(tableName,HConstants.EMPTY_START_ROW,HConstants.EMPTY_END_ROW,method,CONF,false,Durability.USE_DEFAULT,wal,family);
    region.put(put);
    wal.flushActions=new FlushAction[]{FlushAction.COMMIT_FLUSH,FlushAction.ABORT_FLUSH};
    try {
      region.flush(true);
      fail("This should have thrown exception");
    }
 catch (    DroppedSnapshotException expected) {
    }
catch (    IOException unexpected) {
      throw unexpected;
    }
  }
  finally {
    HBaseTestingUtility.closeRegionAndWAL(this.region);
    this.region=null;
  }
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testHolesInMeta() throws Exception {
  byte[] family=Bytes.toBytes("family");
  this.region=initHRegion(tableName,Bytes.toBytes("x"),Bytes.toBytes("z"),method,CONF,false,family);
  try {
    byte[] rowNotServed=Bytes.toBytes("a");
    Get g=new Get(rowNotServed);
    try {
      region.get(g);
      fail();
    }
 catch (    WrongRegionException x) {
    }
    byte[] row=Bytes.toBytes("y");
    g=new Get(row);
    region.get(g);
  }
  finally {
    HBaseTestingUtility.closeRegionAndWAL(this.region);
    this.region=null;
  }
}

</code></pre>

<br>
<pre class="type-11 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that there is server-side filtering for invalid timestamp upper
 * bound. Note that the timestamp lower bound is automatically handled for us
 * by the TTL field.
 */
@Test public void testPutWithTsSlop() throws IOException {
  byte[] fam=Bytes.toBytes("info");
  byte[][] families={fam};
  String method=this.getName();
  CONF.setInt("hbase.hregion.keyvalue.timestamp.slop.millisecs",1000);
  this.region=initHRegion(tableName,method,CONF,families);
  boolean caughtExcep=false;
  try {
    try {
      region.put(new Put(row).addColumn(fam,Bytes.toBytes("qual"),Bytes.toBytes("value")));
      region.put(new Put(row).addColumn(fam,Bytes.toBytes("qual"),System.currentTimeMillis() + 2000,Bytes.toBytes("value")));
      fail("Expected IOE for TS out of configured timerange");
    }
 catch (    FailedSanityCheckException ioe) {
      LOG.debug("Received expected exception",ioe);
      caughtExcep=true;
    }
    assertTrue("Should catch FailedSanityCheckException",caughtExcep);
  }
  finally {
    HBaseTestingUtility.closeRegionAndWAL(this.region);
    this.region=null;
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.regionserver.TestHRegionInfo </h4><pre class="type-11 type-7 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testContainsRange(){
  HTableDescriptor tableDesc=new HTableDescriptor(TableName.valueOf("testtable"));
  HRegionInfo hri=new HRegionInfo(tableDesc.getTableName(),Bytes.toBytes("a"),Bytes.toBytes("g"));
  assertTrue(hri.containsRange(Bytes.toBytes("a"),Bytes.toBytes("a")));
  assertTrue(hri.containsRange(Bytes.toBytes("b"),Bytes.toBytes("c")));
  assertTrue(hri.containsRange(Bytes.toBytes("a"),Bytes.toBytes("c")));
  assertTrue(hri.containsRange(Bytes.toBytes("c"),Bytes.toBytes("c")));
  assertFalse(hri.containsRange(Bytes.toBytes("a"),Bytes.toBytes("g")));
  assertFalse(hri.containsRange(Bytes.toBytes("g"),Bytes.toBytes("g")));
  assertFalse(hri.containsRange(Bytes.toBytes("z"),Bytes.toBytes("z")));
  try {
    hri.containsRange(Bytes.toBytes("z"),Bytes.toBytes("a"));
    fail("Invalid range did not throw IAE");
  }
 catch (  IllegalArgumentException iae) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.regionserver.TestHRegionReplayEvents </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Tests the reads enabled flag for the region. When unset all reads should be rejected
 */
@Test public void testRegionReadsEnabledFlag() throws IOException {
  putDataByReplay(secondaryRegion,0,100,cq,families);
  verifyData(secondaryRegion,0,100,cq,families);
  secondaryRegion.setReadsEnabled(false);
  try {
    verifyData(secondaryRegion,0,100,cq,families);
    fail("Should have failed with IOException");
  }
 catch (  IOException ex) {
  }
  putDataByReplay(secondaryRegion,100,100,cq,families);
  secondaryRegion.setReadsEnabled(true);
  verifyData(secondaryRegion,0,200,cq,families);
}

</code></pre>

<br>
<pre class="type-10 type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Tests whether edits coming in for replay are skipped which have smaller seq id than the seqId
 * of the last replayed region open event.
 */
@Test public void testSkippingEditsWithSmallerSeqIdAfterRegionOpenEvent() throws IOException {
  putDataWithFlushes(primaryRegion,100,100,0);
  int numRows=100;
  primaryRegion.close();
  primaryRegion=HRegion.openHRegion(rootDir,primaryHri,htd,walPrimary,CONF,rss,null);
  reader=createWALReaderForPrimary();
  List<RegionEventDescriptor> regionEvents=Lists.newArrayList();
  List<WAL.Entry> edits=Lists.newArrayList();
  LOG.info("-- Replaying edits and region events in secondary");
  while (true) {
    WAL.Entry entry=reader.next();
    if (entry == null) {
      break;
    }
    FlushDescriptor flushDesc=WALEdit.getFlushDescriptor(entry.getEdit().getCells().get(0));
    RegionEventDescriptor regionEventDesc=WALEdit.getRegionEventDescriptor(entry.getEdit().getCells().get(0));
    if (flushDesc != null) {
    }
 else     if (regionEventDesc != null) {
      regionEvents.add(regionEventDesc);
    }
 else {
      edits.add(entry);
    }
  }
  secondaryRegion.replayWALRegionEventMarker(RegionEventDescriptor.newBuilder(regionEvents.get(0)).setLogSequenceNumber(regionEvents.get(2).getLogSequenceNumber()).build());
  for (  WAL.Entry entry : edits) {
    replayEdit(secondaryRegion,entry);
  }
  boolean expectedFail=false;
  try {
    verifyData(secondaryRegion,0,numRows,cq,families);
  }
 catch (  AssertionError e) {
    expectedFail=true;
  }
  if (!expectedFail) {
    fail("Should have failed this verification");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.regionserver.TestHeapMemoryManager </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testWhenMemstoreAndBlockCacheMaxMinChecksFails() throws Exception {
  BlockCacheStub blockCache=new BlockCacheStub(0);
  MemstoreFlusherStub memStoreFlusher=new MemstoreFlusherStub(0);
  Configuration conf=HBaseConfiguration.create();
  conf.setFloat(HeapMemoryManager.MEMSTORE_SIZE_MAX_RANGE_KEY,0.75f);
  conf.setFloat(HeapMemoryManager.BLOCK_CACHE_SIZE_MIN_RANGE_KEY,0.06f);
  try {
    new HeapMemoryManager(blockCache,memStoreFlusher,new RegionServerStub(conf),new RegionServerAccountingStub());
    fail();
  }
 catch (  RuntimeException e) {
  }
  conf=HBaseConfiguration.create();
  conf.setFloat(HeapMemoryManager.MEMSTORE_SIZE_MIN_RANGE_KEY,0.2f);
  conf.setFloat(HeapMemoryManager.BLOCK_CACHE_SIZE_MAX_RANGE_KEY,0.7f);
  try {
    new HeapMemoryManager(blockCache,memStoreFlusher,new RegionServerStub(conf),new RegionServerAccountingStub());
    fail();
  }
 catch (  RuntimeException e) {
  }
}

</code></pre>

<br>
<pre class="type-11 type-5 type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWhenL2BlockCacheIsOnHeap() throws Exception {
  HeapMemoryManager heapMemoryManager=null;
  BlockCacheStub blockCache=new BlockCacheStub((long)(maxHeapSize * 0.4));
  MemstoreFlusherStub memStoreFlusher=new MemstoreFlusherStub((long)(maxHeapSize * 0.3));
  Configuration conf=HBaseConfiguration.create();
  conf.setFloat(HeapMemoryManager.MEMSTORE_SIZE_MAX_RANGE_KEY,0.7f);
  conf.setFloat(HeapMemoryManager.MEMSTORE_SIZE_MIN_RANGE_KEY,0.1f);
  conf.setFloat(HeapMemoryManager.BLOCK_CACHE_SIZE_MAX_RANGE_KEY,0.7f);
  conf.setFloat(HeapMemoryManager.BLOCK_CACHE_SIZE_MIN_RANGE_KEY,0.1f);
  conf.setInt(DefaultHeapMemoryTuner.NUM_PERIODS_TO_IGNORE,0);
  conf.setFloat(HeapMemorySizeUtil.MEMSTORE_SIZE_KEY,0.4F);
  conf.setFloat(HConstants.HFILE_BLOCK_CACHE_SIZE_KEY,0.3F);
  conf.setFloat(HConstants.BUCKET_CACHE_SIZE_KEY,0.1F);
  conf.set(HConstants.BUCKET_CACHE_IOENGINE_KEY,"heap");
  conf.setLong(HeapMemoryManager.HBASE_RS_HEAP_MEMORY_TUNER_PERIOD,1000);
  conf.setClass(HeapMemoryManager.HBASE_RS_HEAP_MEMORY_TUNER_CLASS,CustomHeapMemoryTuner.class,HeapMemoryTuner.class);
  try {
    heapMemoryManager=new HeapMemoryManager(blockCache,memStoreFlusher,new RegionServerStub(conf),new RegionServerAccountingStub());
    fail("Should have failed as the collective heap memory need is above 80%");
  }
 catch (  Exception e) {
  }
  conf.setFloat(HeapMemoryManager.MEMSTORE_SIZE_MAX_RANGE_KEY,0.6f);
  conf.setFloat(HeapMemoryManager.BLOCK_CACHE_SIZE_MAX_RANGE_KEY,0.6f);
  heapMemoryManager=new HeapMemoryManager(blockCache,memStoreFlusher,new RegionServerStub(conf),new RegionServerAccountingStub());
  long oldMemstoreSize=memStoreFlusher.memstoreSize;
  long oldBlockCacheSize=blockCache.maxSize;
  final ChoreService choreService=new ChoreService("TEST_SERVER_NAME");
  heapMemoryManager.start(choreService);
  CustomHeapMemoryTuner.memstoreSize=0.4f;
  CustomHeapMemoryTuner.blockCacheSize=0.4f;
  Thread.sleep(1500);
  assertEquals(oldMemstoreSize,memStoreFlusher.memstoreSize);
  assertEquals(oldBlockCacheSize,blockCache.maxSize);
  CustomHeapMemoryTuner.memstoreSize=0.1f;
  CustomHeapMemoryTuner.blockCacheSize=0.5f;
  waitForTune(memStoreFlusher,memStoreFlusher.memstoreSize);
  assertHeapSpace(0.1f,memStoreFlusher.memstoreSize);
  assertHeapSpace(0.5f,blockCache.maxSize);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.regionserver.TestKeepDeletes </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * The ExplicitColumnTracker does not support "raw" scanning.
 */
@Test public void testRawScanWithColumns() throws Exception {
  HTableDescriptor htd=hbu.createTableDescriptor(name.getMethodName(),0,3,HConstants.FOREVER,KeepDeletedCells.TRUE);
  Region region=hbu.createLocalHRegion(htd,null,null);
  Scan s=new Scan();
  s.setRaw(true);
  s.setMaxVersions();
  s.addColumn(c0,c0);
  try {
    region.getScanner(s);
    fail("raw scanner with columns should have failed");
  }
 catch (  org.apache.hadoop.hbase.DoNotRetryIOException dnre) {
  }
  HBaseTestingUtility.closeRegionAndWAL(region);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.regionserver.TestMiniBatchOperationInProgress </h4><pre class="type-11 type-7 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMiniBatchOperationInProgressMethods(){
  Pair<Mutation,Integer>[] operations=new Pair[10];
  OperationStatus[] retCodeDetails=new OperationStatus[10];
  WALEdit[] walEditsFromCoprocessors=new WALEdit[10];
  for (int i=0; i < 10; i++) {
    operations[i]=new Pair<Mutation,Integer>(new Put(Bytes.toBytes(i)),null);
  }
  MiniBatchOperationInProgress<Pair<Mutation,Integer>> miniBatch=new MiniBatchOperationInProgress<Pair<Mutation,Integer>>(operations,retCodeDetails,walEditsFromCoprocessors,0,5);
  assertEquals(5,miniBatch.size());
  assertTrue(Bytes.equals(Bytes.toBytes(0),miniBatch.getOperation(0).getFirst().getRow()));
  assertTrue(Bytes.equals(Bytes.toBytes(2),miniBatch.getOperation(2).getFirst().getRow()));
  assertTrue(Bytes.equals(Bytes.toBytes(4),miniBatch.getOperation(4).getFirst().getRow()));
  try {
    miniBatch.getOperation(5);
    fail("Should throw Exception while accessing out of range");
  }
 catch (  ArrayIndexOutOfBoundsException e) {
  }
  miniBatch.setOperationStatus(1,OperationStatus.FAILURE);
  assertEquals(OperationStatus.FAILURE,retCodeDetails[1]);
  try {
    miniBatch.setOperationStatus(6,OperationStatus.FAILURE);
    fail("Should throw Exception while accessing out of range");
  }
 catch (  ArrayIndexOutOfBoundsException e) {
  }
  try {
    miniBatch.setWalEdit(5,new WALEdit());
    fail("Should throw Exception while accessing out of range");
  }
 catch (  ArrayIndexOutOfBoundsException e) {
  }
  miniBatch=new MiniBatchOperationInProgress<Pair<Mutation,Integer>>(operations,retCodeDetails,walEditsFromCoprocessors,7,10);
  try {
    miniBatch.setWalEdit(-1,new WALEdit());
    fail("Should throw Exception while accessing out of range");
  }
 catch (  ArrayIndexOutOfBoundsException e) {
  }
  try {
    miniBatch.getOperation(-1);
    fail("Should throw Exception while accessing out of range");
  }
 catch (  ArrayIndexOutOfBoundsException e) {
  }
  try {
    miniBatch.getOperation(3);
    fail("Should throw Exception while accessing out of range");
  }
 catch (  ArrayIndexOutOfBoundsException e) {
  }
  try {
    miniBatch.getOperationStatus(9);
    fail("Should throw Exception while accessing out of range");
  }
 catch (  ArrayIndexOutOfBoundsException e) {
  }
  try {
    miniBatch.setOperationStatus(3,OperationStatus.FAILURE);
    fail("Should throw Exception while accessing out of range");
  }
 catch (  ArrayIndexOutOfBoundsException e) {
  }
  assertTrue(Bytes.equals(Bytes.toBytes(7),miniBatch.getOperation(0).getFirst().getRow()));
  assertTrue(Bytes.equals(Bytes.toBytes(9),miniBatch.getOperation(2).getFirst().getRow()));
  miniBatch.setOperationStatus(1,OperationStatus.SUCCESS);
  assertEquals(OperationStatus.SUCCESS,retCodeDetails[8]);
  WALEdit wal=new WALEdit();
  miniBatch.setWalEdit(0,wal);
  assertEquals(wal,walEditsFromCoprocessors[7]);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.regionserver.TestRegionFavoredNodes </h4><pre class="type-9 type-11 type-21 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Sets implicit assumptions ">AssumptionSetter</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Sets implicit assumptions 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFavoredNodes() throws Exception {
  Assume.assumeTrue(createWithFavoredNode != null);
  InetSocketAddress[] nodes=new InetSocketAddress[REGION_SERVERS];
  List<DataNode> datanodes=TEST_UTIL.getDFSCluster().getDataNodes();
  Method selfAddress;
  try {
    selfAddress=DataNode.class.getMethod("getSelfAddr");
  }
 catch (  NoSuchMethodException ne) {
    selfAddress=DataNode.class.getMethod("getXferAddress");
  }
  for (int i=0; i < REGION_SERVERS; i++) {
    nodes[i]=(InetSocketAddress)selfAddress.invoke(datanodes.get(i));
  }
  String[] nodeNames=new String[REGION_SERVERS];
  for (int i=0; i < REGION_SERVERS; i++) {
    nodeNames[i]=nodes[i].getAddress().getHostAddress() + ":" + nodes[i].getPort();
  }
  for (int i=0; i < REGION_SERVERS; i++) {
    HRegionServer server=TEST_UTIL.getHBaseCluster().getRegionServer(i);
    List<Region> regions=server.getOnlineRegions(TABLE_NAME);
    for (    Region region : regions) {
      List<org.apache.hadoop.hbase.protobuf.generated.HBaseProtos.ServerName> favoredNodes=new ArrayList<org.apache.hadoop.hbase.protobuf.generated.HBaseProtos.ServerName>(3);
      String encodedRegionName=region.getRegionInfo().getEncodedName();
      for (int j=0; j < FAVORED_NODES_NUM; j++) {
        org.apache.hadoop.hbase.protobuf.generated.HBaseProtos.ServerName.Builder b=org.apache.hadoop.hbase.protobuf.generated.HBaseProtos.ServerName.newBuilder();
        b.setHostName(nodes[(i + j) % REGION_SERVERS].getAddress().getHostAddress());
        b.setPort(nodes[(i + j) % REGION_SERVERS].getPort());
        b.setStartCode(-1);
        favoredNodes.add(b.build());
      }
      server.updateRegionFavoredNodesMapping(encodedRegionName,favoredNodes);
    }
  }
  for (int i=0; i < FLUSHES; i++) {
    TEST_UTIL.loadTable(table,COLUMN_FAMILY,false);
    TEST_UTIL.flush();
  }
  for (int i=0; i < REGION_SERVERS; i++) {
    HRegionServer server=TEST_UTIL.getHBaseCluster().getRegionServer(i);
    List<Region> regions=server.getOnlineRegions(TABLE_NAME);
    for (    Region region : regions) {
      List<String> files=region.getStoreFileList(new byte[][]{COLUMN_FAMILY});
      for (      String file : files) {
        FileStatus status=TEST_UTIL.getDFSCluster().getFileSystem().getFileStatus(new Path(new URI(file).getPath()));
        BlockLocation[] lbks=((DistributedFileSystem)TEST_UTIL.getDFSCluster().getFileSystem()).getFileBlockLocations(status,0,Long.MAX_VALUE);
        for (        BlockLocation lbk : lbks) {
          locations:           for (          String info : lbk.getNames()) {
            for (int j=0; j < FAVORED_NODES_NUM; j++) {
              if (info.equals(nodeNames[(i + j) % REGION_SERVERS])) {
                continue locations;
              }
            }
            fail("Block location " + info + " not a favored node");
          }
        }
      }
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.regionserver.TestRegionMergeTransactionOnCluster </h4><pre class="type-11 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * This test tests 1, merging region not online;
 * 2, merging same two regions; 3, merging unknown regions.
 * They are in one test case so that we don't have to create
 * many tables, and these tests are simple.
 */
@Test public void testMerge() throws Exception {
  LOG.info("Starting testMerge");
  final TableName tableName=TableName.valueOf("testMerge");
  try {
    Table table=createTableAndLoadData(master,tableName);
    RegionStates regionStates=master.getAssignmentManager().getRegionStates();
    List<HRegionInfo> regions=regionStates.getRegionsOfTable(tableName);
    HRegionInfo a=regions.get(0);
    HRegionInfo b=regions.get(1);
    regionStates.regionOffline(a);
    try {
      admin.mergeRegions(a.getEncodedNameAsBytes(),b.getEncodedNameAsBytes(),false);
      fail("Offline regions should not be able to merge");
    }
 catch (    IOException ie) {
      System.out.println(ie);
      assertTrue("Exception should mention regions not online",StringUtils.stringifyException(ie).contains("regions not online") && ie instanceof MergeRegionException);
    }
    try {
      admin.mergeRegions(b.getEncodedNameAsBytes(),b.getEncodedNameAsBytes(),true);
      fail("A region should not be able to merge with itself, even forcifully");
    }
 catch (    IOException ie) {
      assertTrue("Exception should mention regions not online",StringUtils.stringifyException(ie).contains("region to itself") && ie instanceof MergeRegionException);
    }
    try {
      admin.mergeRegions(Bytes.toBytes("-f1"),Bytes.toBytes("-f2"),true);
      fail("Unknown region could not be merged");
    }
 catch (    IOException ie) {
      assertTrue("UnknownRegionException should be thrown",ie instanceof UnknownRegionException);
    }
    table.close();
  }
  finally {
    TEST_UTIL.deleteTable(tableName);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.regionserver.TestRegionServerNoMaster </h4><pre class="type-11 type-7 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests an on-the-fly RPC that was scheduled for the earlier RS on the same port
 * for openRegion. The region server should reject this RPC. (HBASE-9721)
 */
@Test public void testOpenCloseRegionRPCIntendedForPreviousServer() throws Exception {
  Assert.assertTrue(getRS().getRegion(regionName).isAvailable());
  ServerName sn=getRS().getServerName();
  ServerName earlierServerName=ServerName.valueOf(sn.getHostname(),sn.getPort(),1);
  try {
    CloseRegionRequest request=RequestConverter.buildCloseRegionRequest(earlierServerName,regionName);
    getRS().getRSRpcServices().closeRegion(null,request);
    Assert.fail("The closeRegion should have been rejected");
  }
 catch (  ServiceException se) {
    Assert.assertTrue(se.getCause() instanceof IOException);
    Assert.assertTrue(se.getCause().getMessage().contains("This RPC was intended for a different server"));
  }
  closeRegionNoZK();
  try {
    AdminProtos.OpenRegionRequest orr=RequestConverter.buildOpenRegionRequest(earlierServerName,hri,null,null);
    getRS().getRSRpcServices().openRegion(null,orr);
    Assert.fail("The openRegion should have been rejected");
  }
 catch (  ServiceException se) {
    Assert.assertTrue(se.getCause() instanceof IOException);
    Assert.assertTrue(se.getCause().getMessage().contains("This RPC was intended for a different server"));
  }
 finally {
    openRegion(HTU,getRS(),hri);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.regionserver.TestScanner </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Test that closing a scanner while a client is using it doesn't throw
 * NPEs but instead a UnknownScannerException. HBASE-2503
 * @throws Exception
 */
@Test public void testRaceBetweenClientAndTimeout() throws Exception {
  try {
    this.region=TEST_UTIL.createLocalHRegion(TESTTABLEDESC,null,null);
    HBaseTestCase.addContent(this.region,HConstants.CATALOG_FAMILY);
    Scan scan=new Scan();
    InternalScanner s=region.getScanner(scan);
    List<Cell> results=new ArrayList<Cell>();
    try {
      s.next(results);
      s.close();
      s.next(results);
      fail("We don't want anything more, we should be failing");
    }
 catch (    UnknownScannerException ex) {
      return;
    }
  }
  finally {
    HBaseTestingUtility.closeRegionAndWAL(this.region);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.regionserver.TestServerNonceManager </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testNoEndWithoutStart(){
  ServerNonceManager nm=createManager();
  try {
    nm.endOperation(NO_NONCE,1,true);
    fail("Should have thrown");
  }
 catch (  AssertionError err) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.regionserver.TestSplitTransactionOnCluster </h4><pre class="type-4 type-11 type-7 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSplitWithRegionReplicas() throws Exception {
  final TableName tableName=TableName.valueOf("foobar");
  HTableDescriptor htd=TESTING_UTIL.createTableDescriptor("foobar");
  htd.setRegionReplication(2);
  htd.addCoprocessor(SlowMeCopro.class.getName());
  Table t=TESTING_UTIL.createTable(htd,new byte[][]{Bytes.toBytes("cf")},null);
  List<HRegion> oldRegions;
  do {
    oldRegions=cluster.getRegions(tableName);
    Thread.sleep(10);
  }
 while (oldRegions.size() != 2);
  for (  HRegion h : oldRegions)   LOG.debug("OLDREGION " + h.getRegionInfo());
  try {
    int regionServerIndex=cluster.getServerWith(oldRegions.get(0).getRegionInfo().getRegionName());
    HRegionServer regionServer=cluster.getRegionServer(regionServerIndex);
    insertData(tableName,admin,t);
    admin.setBalancerRunning(false,true);
    cluster.getMaster().setCatalogJanitorEnabled(false);
    boolean tableExists=MetaTableAccessor.tableExists(regionServer.getConnection(),tableName);
    assertEquals("The specified table should be present.",true,tableExists);
    final HRegion region=findSplittableRegion(oldRegions);
    regionServerIndex=cluster.getServerWith(region.getRegionInfo().getRegionName());
    regionServer=cluster.getRegionServer(regionServerIndex);
    assertTrue("not able to find a splittable region",region != null);
    SplitTransactionImpl st=new SplitTransactionImpl(region,Bytes.toBytes("row2"));
    try {
      st.prepare();
      st.execute(regionServer,regionServer);
    }
 catch (    IOException e) {
      e.printStackTrace();
      fail("Split execution should have succeeded with no exceptions thrown " + e);
    }
    List<HRegion> newRegions;
    do {
      newRegions=cluster.getRegions(tableName);
      for (      HRegion h : newRegions)       LOG.debug("NEWREGION " + h.getRegionInfo());
      Thread.sleep(1000);
    }
 while ((newRegions.contains(oldRegions.get(0)) || newRegions.contains(oldRegions.get(1))) || newRegions.size() != 4);
    tableExists=MetaTableAccessor.tableExists(regionServer.getConnection(),tableName);
    assertEquals("The specified table should be present.",true,tableExists);
    byte[] b1="row1".getBytes();
    Get g=new Get(b1);
    g.setConsistency(Consistency.STRONG);
    Result r=t.get(g);
    Assert.assertFalse(r.isStale());
    LOG.info("exists stale after flush done");
    SlowMeCopro.getCdl().set(new CountDownLatch(1));
    g=new Get(b1);
    g.setConsistency(Consistency.TIMELINE);
    r=t.get(g);
    Assert.assertTrue(r.isStale());
    SlowMeCopro.getCdl().get().countDown();
  }
  finally {
    SlowMeCopro.getCdl().get().countDown();
    admin.setBalancerRunning(true,false);
    cluster.getMaster().setCatalogJanitorEnabled(true);
    t.close();
  }
}

</code></pre>

<br>
<pre class="type-4 type-9 type-11 type-7 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * If a table has regions that have no store files in a region, they should split successfully
 * into two regions with no store files.
 */
@Test(timeout=60000) public void testSplitRegionWithNoStoreFiles() throws Exception {
  final TableName tableName=TableName.valueOf("testSplitRegionWithNoStoreFiles");
  createTableAndWait(tableName,HConstants.CATALOG_FAMILY);
  List<HRegion> regions=cluster.getRegions(tableName);
  HRegionInfo hri=getAndCheckSingleTableRegion(regions);
  ensureTableRegionNotOnSameServerAsMeta(admin,hri);
  int regionServerIndex=cluster.getServerWith(regions.get(0).getRegionInfo().getRegionName());
  HRegionServer regionServer=cluster.getRegionServer(regionServerIndex);
  this.admin.setBalancerRunning(false,true);
  cluster.getMaster().setCatalogJanitorEnabled(false);
  try {
    printOutRegions(regionServer,"Initial regions: ");
    Configuration conf=cluster.getConfiguration();
    HBaseFsck.debugLsr(conf,new Path("/"));
    Path rootDir=FSUtils.getRootDir(conf);
    FileSystem fs=TESTING_UTIL.getDFSCluster().getFileSystem();
    Map<String,Path> storefiles=FSUtils.getTableStoreFilePathMap(null,fs,rootDir,tableName);
    assertEquals("Expected nothing but found " + storefiles.toString(),storefiles.size(),0);
    regions=cluster.getRegions(tableName);
    final HRegion region=findSplittableRegion(regions);
    assertTrue("not able to find a splittable region",region != null);
    SplitTransactionImpl st=new MockedSplitTransaction(region,Bytes.toBytes("row2"));
    try {
      st.prepare();
      st.execute(regionServer,regionServer);
    }
 catch (    IOException e) {
      fail("Split execution should have succeeded with no exceptions thrown");
    }
    List<HRegion> daughters=cluster.getRegions(tableName);
    assertTrue(daughters.size() == 2);
    HBaseFsck.debugLsr(conf,new Path("/"));
    Map<String,Path> storefilesAfter=FSUtils.getTableStoreFilePathMap(null,fs,rootDir,tableName);
    assertEquals("Expected nothing but found " + storefilesAfter.toString(),storefilesAfter.size(),0);
    hri=region.getRegionInfo();
    AssignmentManager am=cluster.getMaster().getAssignmentManager();
    RegionStates regionStates=am.getRegionStates();
    long start=EnvironmentEdgeManager.currentTime();
    while (!regionStates.isRegionInState(hri,State.SPLIT)) {
      assertFalse("Timed out in waiting split parent to be in state SPLIT",EnvironmentEdgeManager.currentTime() - start > 60000);
      Thread.sleep(500);
    }
    am.assign(hri,true);
    assertFalse("Split region can't be assigned",regionStates.isRegionInTransition(hri));
    assertTrue(regionStates.isRegionInState(hri,State.SPLIT));
    am.unassign(hri,null);
    assertFalse("Split region can't be unassigned",regionStates.isRegionInTransition(hri));
    assertTrue(regionStates.isRegionInState(hri,State.SPLIT));
  }
  finally {
    admin.setBalancerRunning(true,false);
    cluster.getMaster().setCatalogJanitorEnabled(true);
  }
}

</code></pre>

<br>
<pre class="type-4 type-11 type-7 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Not really restarting the master. Simulate it by clear of new region
 * state since it is not persisted, will be lost after master restarts.
 */
@Test(timeout=180000) public void testSplitAndRestartingMaster() throws Exception {
  LOG.info("Starting testSplitAndRestartingMaster");
  final TableName tableName=TableName.valueOf("testSplitAndRestartingMaster");
  createTableAndWait(tableName,HConstants.CATALOG_FAMILY);
  List<HRegion> regions=cluster.getRegions(tableName);
  HRegionInfo hri=getAndCheckSingleTableRegion(regions);
  ensureTableRegionNotOnSameServerAsMeta(admin,hri);
  int regionServerIndex=cluster.getServerWith(regions.get(0).getRegionInfo().getRegionName());
  HRegionServer regionServer=cluster.getRegionServer(regionServerIndex);
  this.admin.setBalancerRunning(false,true);
  cluster.getMaster().setCatalogJanitorEnabled(false);
  try {
    MyMasterRpcServices.enabled.set(true);
    regions=cluster.getRegions(tableName);
    final HRegion region=findSplittableRegion(regions);
    assertTrue("not able to find a splittable region",region != null);
    SplitTransactionImpl st=new SplitTransactionImpl(region,Bytes.toBytes("row2"));
    try {
      st.prepare();
      st.execute(regionServer,regionServer);
    }
 catch (    IOException e) {
      fail("Split execution should have succeeded with no exceptions thrown");
    }
    List<HRegion> daughters=cluster.getRegions(tableName);
    LOG.info("xxx " + regions.size() + AssignmentManager.TEST_SKIP_SPLIT_HANDLING);
    assertTrue(daughters.size() == 2);
  }
  finally {
    MyMasterRpcServices.enabled.set(false);
    admin.setBalancerRunning(true,false);
    cluster.getMaster().setCatalogJanitorEnabled(true);
  }
}

</code></pre>

<br>
<pre class="type-10 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=180000) public void testSplitHooksBeforeAndAfterPONR() throws Exception {
  TableName firstTable=TableName.valueOf("testSplitHooksBeforeAndAfterPONR_1");
  TableName secondTable=TableName.valueOf("testSplitHooksBeforeAndAfterPONR_2");
  HColumnDescriptor hcd=new HColumnDescriptor("cf");
  HTableDescriptor desc=new HTableDescriptor(firstTable);
  desc.addCoprocessor(MockedRegionObserver.class.getName());
  desc.addFamily(hcd);
  admin.createTable(desc);
  TESTING_UTIL.waitUntilAllRegionsAssigned(firstTable);
  desc=new HTableDescriptor(secondTable);
  desc.addFamily(hcd);
  admin.createTable(desc);
  TESTING_UTIL.waitUntilAllRegionsAssigned(secondTable);
  List<HRegion> firstTableRegions=cluster.getRegions(firstTable);
  List<HRegion> secondTableRegions=cluster.getRegions(secondTable);
  if (firstTableRegions.size() == 0 || secondTableRegions.size() == 0) {
    fail("Each table should have at least one region.");
  }
  ServerName serverName=cluster.getServerHoldingRegion(firstTable,firstTableRegions.get(0).getRegionInfo().getRegionName());
  admin.move(secondTableRegions.get(0).getRegionInfo().getEncodedNameAsBytes(),Bytes.toBytes(serverName.getServerName()));
  Table table1=null;
  Table table2=null;
  try {
    table1=TESTING_UTIL.getConnection().getTable(firstTable);
    table2=TESTING_UTIL.getConnection().getTable(firstTable);
    insertData(firstTable,admin,table1);
    insertData(secondTable,admin,table2);
    admin.split(firstTable,"row2".getBytes());
    firstTableRegions=cluster.getRegions(firstTable);
    while (firstTableRegions.size() != 2) {
      Thread.sleep(1000);
      firstTableRegions=cluster.getRegions(firstTable);
    }
    assertEquals("Number of regions after split should be 2.",2,firstTableRegions.size());
    secondTableRegions=cluster.getRegions(secondTable);
    assertEquals("Number of regions after split should be 2.",2,secondTableRegions.size());
  }
  finally {
    if (table1 != null) {
      table1.close();
    }
    if (table2 != null) {
      table2.close();
    }
    TESTING_UTIL.deleteTable(firstTable);
    TESTING_UTIL.deleteTable(secondTable);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.regionserver.TestStore </h4><pre class="type-4 type-11 type-7 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHandleErrorsInFlush() throws Exception {
  LOG.info("Setting up a faulty file system that cannot write");
  final Configuration conf=HBaseConfiguration.create();
  User user=User.createUserForTesting(conf,"testhandleerrorsinflush",new String[]{"foo"});
  conf.setClass("fs.file.impl",FaultyFileSystem.class,FileSystem.class);
  user.runAs(new PrivilegedExceptionAction(){
    @Override public Object run() throws Exception {
      FileSystem fs=FileSystem.get(conf);
      Assert.assertEquals(FaultyFileSystem.class,fs.getClass());
      init(name.getMethodName(),conf);
      LOG.info("Adding some data");
      store.add(new KeyValue(row,family,qf1,1,(byte[])null));
      store.add(new KeyValue(row,family,qf2,1,(byte[])null));
      store.add(new KeyValue(row,family,qf3,1,(byte[])null));
      LOG.info("Before flush, we should have no files");
      Collection<StoreFileInfo> files=store.getRegionFileSystem().getStoreFiles(store.getColumnFamilyName());
      Assert.assertEquals(0,files != null ? files.size() : 0);
      try {
        LOG.info("Flushing");
        flush(1);
        Assert.fail("Didn't bubble up IOE!");
      }
 catch (      IOException ioe) {
        Assert.assertTrue(ioe.getMessage().contains("Fault injected"));
      }
      LOG.info("After failed flush, we should still have no files!");
      files=store.getRegionFileSystem().getStoreFiles(store.getColumnFamilyName());
      Assert.assertEquals(0,files != null ? files.size() : 0);
      store.getHRegion().getWAL().close();
      return null;
    }
  }
);
  FileSystem.closeAllForUGI(user.getUGI());
}

</code></pre>

<br>
<pre class="type-4 type-11 type-7 type-8 type-5 type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test we do not lose data if we fail a flush and then close.
 * Part of HBase-10466
 * @throws Exception
 */
@Test public void testFlushSizeAccounting() throws Exception {
  LOG.info("Setting up a faulty file system that cannot write in " + this.name.getMethodName());
  final Configuration conf=HBaseConfiguration.create();
  conf.setInt("hbase.hstore.flush.retries.number",1);
  User user=User.createUserForTesting(conf,this.name.getMethodName(),new String[]{"foo"});
  conf.setClass("fs.file.impl",FaultyFileSystem.class,FileSystem.class);
  user.runAs(new PrivilegedExceptionAction(){
    @Override public Object run() throws Exception {
      FileSystem fs=FileSystem.get(conf);
      Assert.assertEquals(FaultyFileSystem.class,fs.getClass());
      FaultyFileSystem ffs=(FaultyFileSystem)fs;
      init(name.getMethodName(),conf);
      long size=store.memstore.getFlushableSize();
      Assert.assertEquals(0,size);
      LOG.info("Adding some data");
      long kvSize=store.add(new KeyValue(row,family,qf1,1,(byte[])null));
      size=store.memstore.getFlushableSize();
      Assert.assertEquals(kvSize,size);
      try {
        LOG.info("Flushing");
        flushStore(store,id++);
        Assert.fail("Didn't bubble up IOE!");
      }
 catch (      IOException ioe) {
        Assert.assertTrue(ioe.getMessage().contains("Fault injected"));
      }
      size=store.memstore.getFlushableSize();
      Assert.assertEquals(kvSize,size);
      store.add(new KeyValue(row,family,qf2,2,(byte[])null));
      Assert.assertEquals(kvSize,size);
      ffs.fault.set(false);
      flushStore(store,id++);
      size=store.memstore.getFlushableSize();
      Assert.assertEquals(kvSize,size);
      flushStore(store,id++);
      size=store.memstore.getFlushableSize();
      Assert.assertEquals(0,size);
      return null;
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.regionserver.TestStoreFileRefresherChore </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testIsStale() throws IOException {
  int period=0;
  byte[][] families=new byte[][]{Bytes.toBytes("cf")};
  byte[] qf=Bytes.toBytes("cq");
  HRegionServer regionServer=mock(HRegionServer.class);
  List<Region> regions=new ArrayList<Region>();
  when(regionServer.getOnlineRegionsLocalContext()).thenReturn(regions);
  when(regionServer.getConfiguration()).thenReturn(TEST_UTIL.getConfiguration());
  HTableDescriptor htd=getTableDesc(TableName.valueOf("testIsStale"),families);
  Region primary=initHRegion(htd,HConstants.EMPTY_START_ROW,HConstants.EMPTY_END_ROW,0);
  Region replica1=initHRegion(htd,HConstants.EMPTY_START_ROW,HConstants.EMPTY_END_ROW,1);
  regions.add(primary);
  regions.add(replica1);
  StaleStorefileRefresherChore chore=new StaleStorefileRefresherChore(period,regionServer,new StoppableImplementation());
  putData(primary,0,100,qf,families);
  primary.flush(true);
  verifyData(primary,0,100,qf,families);
  try {
    verifyData(replica1,0,100,qf,families);
    Assert.fail("should have failed");
  }
 catch (  AssertionError ex) {
  }
  chore.chore();
  verifyData(replica1,0,100,qf,families);
  ((FailingHRegionFileSystem)((HRegion)replica1).getRegionFileSystem()).fail=true;
  putData(primary,100,100,qf,families);
  primary.flush(true);
  verifyData(primary,0,200,qf,families);
  chore.chore();
  verifyData(replica1,0,100,qf,families);
  try {
    verifyData(replica1,100,100,qf,families);
    Assert.fail("should have failed");
  }
 catch (  AssertionError ex) {
  }
  chore.isStale=true;
  chore.chore();
  try {
    verifyData(replica1,0,100,qf,families);
    Assert.fail("should have failed with IOException");
  }
 catch (  IOException ex) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.regionserver.compactions.TestFIFOCompactionPolicy </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testSanityCheckBlockingStoreFiles() throws Exception {
  Configuration conf=TEST_UTIL.getConfiguration();
  conf.setInt(HStore.BLOCKING_STOREFILES_KEY,10);
  TEST_UTIL.startMiniCluster(1);
  HBaseAdmin admin=TEST_UTIL.getHBaseAdmin();
  TableName tableName=TableName.valueOf(getClass().getSimpleName() + "-BlockingStoreFiles");
  if (admin.tableExists(tableName)) {
    admin.disableTable(tableName);
    admin.deleteTable(tableName);
  }
  HTableDescriptor desc=new HTableDescriptor(tableName);
  desc.setConfiguration(DefaultStoreEngine.DEFAULT_COMPACTION_POLICY_CLASS_KEY,FIFOCompactionPolicy.class.getName());
  desc.setConfiguration(HConstants.HBASE_REGION_SPLIT_POLICY_KEY,DisabledRegionSplitPolicy.class.getName());
  HColumnDescriptor colDesc=new HColumnDescriptor(family);
  colDesc.setTimeToLive(1);
  desc.addFamily(colDesc);
  try {
    admin.createTable(desc);
    Assert.fail();
  }
 catch (  Exception e) {
  }
 finally {
    TEST_UTIL.shutdownMiniCluster();
  }
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testSanityCheckTTL() throws Exception {
  Configuration conf=TEST_UTIL.getConfiguration();
  conf.setInt(HStore.BLOCKING_STOREFILES_KEY,10000);
  TEST_UTIL.startMiniCluster(1);
  HBaseAdmin admin=TEST_UTIL.getHBaseAdmin();
  TableName tableName=TableName.valueOf(getClass().getSimpleName() + "-TTL");
  if (admin.tableExists(tableName)) {
    admin.disableTable(tableName);
    admin.deleteTable(tableName);
  }
  HTableDescriptor desc=new HTableDescriptor(tableName);
  desc.setConfiguration(DefaultStoreEngine.DEFAULT_COMPACTION_POLICY_CLASS_KEY,FIFOCompactionPolicy.class.getName());
  desc.setConfiguration(HConstants.HBASE_REGION_SPLIT_POLICY_KEY,DisabledRegionSplitPolicy.class.getName());
  HColumnDescriptor colDesc=new HColumnDescriptor(family);
  desc.addFamily(colDesc);
  try {
    admin.createTable(desc);
    Assert.fail();
  }
 catch (  Exception e) {
  }
 finally {
    TEST_UTIL.shutdownMiniCluster();
  }
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testSanityCheckMinVersion() throws Exception {
  Configuration conf=TEST_UTIL.getConfiguration();
  conf.setInt(HStore.BLOCKING_STOREFILES_KEY,10000);
  TEST_UTIL.startMiniCluster(1);
  HBaseAdmin admin=TEST_UTIL.getHBaseAdmin();
  TableName tableName=TableName.valueOf(getClass().getSimpleName() + "-MinVersion");
  if (admin.tableExists(tableName)) {
    admin.disableTable(tableName);
    admin.deleteTable(tableName);
  }
  HTableDescriptor desc=new HTableDescriptor(tableName);
  desc.setConfiguration(DefaultStoreEngine.DEFAULT_COMPACTION_POLICY_CLASS_KEY,FIFOCompactionPolicy.class.getName());
  desc.setConfiguration(HConstants.HBASE_REGION_SPLIT_POLICY_KEY,DisabledRegionSplitPolicy.class.getName());
  HColumnDescriptor colDesc=new HColumnDescriptor(family);
  colDesc.setTimeToLive(1);
  colDesc.setMinVersions(1);
  desc.addFamily(colDesc);
  try {
    admin.createTable(desc);
    Assert.fail();
  }
 catch (  Exception e) {
  }
 finally {
    TEST_UTIL.shutdownMiniCluster();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.regionserver.wal.TestFSHLog </h4><pre class="type-11 type-17 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(expected=IOException.class) public void testFailedToCreateWALIfParentRenamed() throws IOException {
  final String name="testFailedToCreateWALIfParentRenamed";
  FSHLog log=new FSHLog(fs,FSUtils.getRootDir(conf),name,HConstants.HREGION_OLDLOGDIR_NAME,conf,null,true,null,null);
  long filenum=System.currentTimeMillis();
  Path path=log.computeFilename(filenum);
  log.createWriterInstance(path);
  Path parent=path.getParent();
  path=log.computeFilename(filenum + 1);
  Path newPath=new Path(parent.getParent(),parent.getName() + "-splitting");
  fs.rename(parent,newPath);
  log.createWriterInstance(path);
  fail("It should fail to create the new WAL");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.regionserver.wal.TestLogRollAbort </h4><pre class="type-10 type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * Tests the case where a RegionServer enters a GC pause,
 * comes back online after the master declared it dead and started to split.
 * Want log rolling after a master split to fail. See HBASE-2312.
 */
@Test(timeout=300000) public void testLogRollAfterSplitStart() throws IOException {
  LOG.info("Verify wal roll after split starts will fail.");
  String logName="testLogRollAfterSplitStart";
  Path thisTestsDir=new Path(HBASEDIR,DefaultWALProvider.getWALDirectoryName(logName));
  final WALFactory wals=new WALFactory(conf,null,logName);
  try {
    TableName tableName=TableName.valueOf(this.getClass().getName());
    HRegionInfo regioninfo=new HRegionInfo(tableName,HConstants.EMPTY_START_ROW,HConstants.EMPTY_END_ROW);
    final WAL log=wals.getWAL(regioninfo.getEncodedNameAsBytes(),regioninfo.getTable().getNamespace());
    MultiVersionConcurrencyControl mvcc=new MultiVersionConcurrencyControl(1);
    final int total=20;
    for (int i=0; i < total; i++) {
      WALEdit kvs=new WALEdit();
      kvs.add(new KeyValue(Bytes.toBytes(i),tableName.getName(),tableName.getName()));
      HTableDescriptor htd=new HTableDescriptor(tableName);
      htd.addFamily(new HColumnDescriptor("column"));
      log.append(htd,regioninfo,new WALKey(regioninfo.getEncodedNameAsBytes(),tableName,System.currentTimeMillis(),mvcc),kvs,true);
    }
    log.sync();
    ((FSHLog)log).replaceWriter(((FSHLog)log).getOldPath(),null,null,null);
    Path rsSplitDir=thisTestsDir.suffix(DefaultWALProvider.SPLITTING_EXT);
    if (!fs.rename(thisTestsDir,rsSplitDir)) {
      throw new IOException("Failed fs.rename for log split: " + thisTestsDir);
    }
    LOG.debug("Renamed region directory: " + rsSplitDir);
    LOG.debug("Processing the old log files.");
    WALSplitter.split(HBASEDIR,rsSplitDir,OLDLOGDIR,fs,conf,wals);
    LOG.debug("Trying to roll the WAL.");
    try {
      log.rollWriter();
      Assert.fail("rollWriter() did not throw any exception.");
    }
 catch (    IOException ioe) {
      if (ioe.getCause() instanceof FileNotFoundException) {
        LOG.info("Got the expected exception: ",ioe.getCause());
      }
 else {
        Assert.fail("Unexpected exception: " + ioe);
      }
    }
  }
  finally {
    wals.close();
    if (fs.exists(thisTestsDir)) {
      fs.delete(thisTestsDir,true);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.regionserver.wal.TestWALReplay </h4><pre class="type-4 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that we could recover the data correctly after aborting flush. In the
 * test, first we abort flush after writing some data, then writing more data
 * and flush again, at last verify the data.
 * @throws IOException
 */
@Test public void testReplayEditsAfterAbortingFlush() throws IOException {
  final TableName tableName=TableName.valueOf("testReplayEditsAfterAbortingFlush");
  final HRegionInfo hri=createBasic3FamilyHRegionInfo(tableName);
  final Path basedir=FSUtils.getTableDir(this.hbaseRootDir,tableName);
  deleteDir(basedir);
  final HTableDescriptor htd=createBasic3FamilyHTD(tableName);
  HRegion region3=HBaseTestingUtility.createRegionAndWAL(hri,hbaseRootDir,this.conf,htd);
  HBaseTestingUtility.closeRegionAndWAL(region3);
  WAL wal=createWAL(this.conf);
  RegionServerServices rsServices=Mockito.mock(RegionServerServices.class);
  Mockito.doReturn(false).when(rsServices).isAborted();
  when(rsServices.getServerName()).thenReturn(ServerName.valueOf("foo",10,10));
  Configuration customConf=new Configuration(this.conf);
  customConf.set(DefaultStoreEngine.DEFAULT_STORE_FLUSHER_CLASS_KEY,CustomStoreFlusher.class.getName());
  HRegion region=HRegion.openHRegion(this.hbaseRootDir,hri,htd,wal,customConf,rsServices,null);
  int writtenRowCount=10;
  List<HColumnDescriptor> families=new ArrayList<HColumnDescriptor>(htd.getFamilies());
  for (int i=0; i < writtenRowCount; i++) {
    Put put=new Put(Bytes.toBytes(tableName + Integer.toString(i)));
    put.addColumn(families.get(i % families.size()).getName(),Bytes.toBytes("q"),Bytes.toBytes("val"));
    region.put(put);
  }
  RegionScanner scanner=region.getScanner(new Scan());
  assertEquals(writtenRowCount,getScannedCount(scanner));
  CustomStoreFlusher.throwExceptionWhenFlushing.set(true);
  try {
    region.flush(true);
    fail("Injected exception hasn't been thrown");
  }
 catch (  Throwable t) {
    LOG.info("Expected simulated exception when flushing region," + t.getMessage());
    Mockito.doReturn(true).when(rsServices).isAborted();
    region.setClosing(false);
  }
  int moreRow=10;
  for (int i=writtenRowCount; i < writtenRowCount + moreRow; i++) {
    Put put=new Put(Bytes.toBytes(tableName + Integer.toString(i)));
    put.addColumn(families.get(i % families.size()).getName(),Bytes.toBytes("q"),Bytes.toBytes("val"));
    region.put(put);
  }
  writtenRowCount+=moreRow;
  CustomStoreFlusher.throwExceptionWhenFlushing.set(false);
  try {
    region.flush(true);
  }
 catch (  IOException t) {
    LOG.info("Expected exception when flushing region because server is stopped," + t.getMessage());
  }
  region.close(true);
  wal.shutdown();
  runWALSplit(this.conf);
  WAL wal2=createWAL(this.conf);
  Mockito.doReturn(false).when(rsServices).isAborted();
  HRegion region2=HRegion.openHRegion(this.hbaseRootDir,hri,htd,wal2,this.conf,rsServices,null);
  scanner=region2.getScanner(new Scan());
  assertEquals(writtenRowCount,getScannedCount(scanner));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.replication.TestReplicationChangingPeerRegionservers </h4><pre class="type-9 type-2 type-10 type-11 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Allocates resources before the execution of the test cases
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * @throws java.lang.Exception
 */
@Before public void setUp() throws Exception {
  for (  JVMClusterUtil.RegionServerThread r : utility1.getHBaseCluster().getRegionServerThreads()) {
    utility1.getHBaseAdmin().rollWALWriter(r.getRegionServer().getServerName());
  }
  utility1.deleteTableData(tableName);
  Scan scan=new Scan();
  int lastCount=0;
  for (int i=0; i < NB_RETRIES; i++) {
    if (i == NB_RETRIES - 1) {
      fail("Waited too much time for truncate");
    }
    ResultScanner scanner=htable2.getScanner(scan);
    Result[] res=scanner.next(NB_ROWS_IN_BIG_BATCH);
    scanner.close();
    if (res.length != 0) {
      if (res.length < lastCount) {
        i--;
      }
      lastCount=res.length;
      LOG.info("Still got " + res.length + " rows");
      Thread.sleep(SLEEP_TIME);
    }
 else {
      break;
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.replication.TestReplicationDisableInactivePeer </h4><pre class="type-4 type-9 type-10 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test disabling an inactive peer. Add a peer which is inactive, trying to
 * insert, disable the peer, then activate the peer and make sure nothing is
 * replicated. In Addition, enable the peer and check the updates are
 * replicated.
 * @throws Exception
 */
@Test(timeout=600000) public void testDisableInactivePeer() throws Exception {
  admin.enablePeer("2");
  utility2.shutdownMiniHBaseCluster();
  byte[] rowkey=Bytes.toBytes("disable inactive peer");
  Put put=new Put(rowkey);
  put.addColumn(famName,row,row);
  htable1.put(put);
  Thread.sleep(SLEEP_TIME * NB_RETRIES);
  admin.disablePeer("2");
  utility2.startMiniHBaseCluster(1,2);
  Get get=new Get(rowkey);
  for (int i=0; i < NB_RETRIES; i++) {
    Result res=htable2.get(get);
    if (res.size() >= 1) {
      fail("Replication wasn't disabled");
    }
 else {
      LOG.info("Row not replicated, let's wait a bit more...");
      Thread.sleep(SLEEP_TIME);
    }
  }
  admin.enablePeer("2");
  Thread.sleep(SLEEP_TIME * NB_RETRIES);
  for (int i=0; i < NB_RETRIES; i++) {
    Result res=htable2.get(get);
    if (res.size() == 0) {
      LOG.info("Row not available");
      Thread.sleep(SLEEP_TIME * NB_RETRIES);
    }
 else {
      assertArrayEquals(res.value(),row);
      return;
    }
  }
  fail("Waited too much time for put replication");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.replication.TestReplicationSmallTests </h4><pre class="type-4 type-9 type-10 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Integration test for TestReplicationAdmin, removes and re-add a peer
 * cluster
 * @throws Exception
 */
@Test(timeout=300000) public void testAddAndRemoveClusters() throws Exception {
  LOG.info("testAddAndRemoveClusters");
  admin.removePeer("2");
  Thread.sleep(SLEEP_TIME);
  byte[] rowKey=Bytes.toBytes("Won't be replicated");
  Put put=new Put(rowKey);
  put.addColumn(famName,row,row);
  htable1.put(put);
  Get get=new Get(rowKey);
  for (int i=0; i < NB_RETRIES; i++) {
    if (i == NB_RETRIES - 1) {
      break;
    }
    Result res=htable2.get(get);
    if (res.size() >= 1) {
      fail("Not supposed to be replicated");
    }
 else {
      LOG.info("Row not replicated, let's wait a bit more...");
      Thread.sleep(SLEEP_TIME);
    }
  }
  admin.addPeer("2",utility2.getClusterKey());
  Thread.sleep(SLEEP_TIME);
  rowKey=Bytes.toBytes("do rep");
  put=new Put(rowKey);
  put.addColumn(famName,row,row);
  LOG.info("Adding new row");
  htable1.put(put);
  get=new Get(rowKey);
  for (int i=0; i < NB_RETRIES; i++) {
    if (i == NB_RETRIES - 1) {
      fail("Waited too much time for put replication");
    }
    Result res=htable2.get(get);
    if (res.size() == 0) {
      LOG.info("Row not available");
      Thread.sleep(SLEEP_TIME * i);
    }
 else {
      assertArrayEquals(res.value(),row);
      break;
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-9 type-10 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Verify that version and column delete marker types are replicated
 * correctly.
 * @throws Exception
 */
@Test(timeout=300000) public void testDeleteTypes() throws Exception {
  LOG.info("testDeleteTypes");
  final byte[] v1=Bytes.toBytes("v1");
  final byte[] v2=Bytes.toBytes("v2");
  final byte[] v3=Bytes.toBytes("v3");
  htable1=utility1.getConnection().getTable(tableName);
  long t=EnvironmentEdgeManager.currentTime();
  Put put=new Put(row);
  put.addColumn(famName,row,t,v1);
  htable1.put(put);
  put=new Put(row);
  put.addColumn(famName,row,t + 1,v2);
  htable1.put(put);
  put=new Put(row);
  put.addColumn(famName,row,t + 2,v3);
  htable1.put(put);
  Get get=new Get(row);
  get.setMaxVersions();
  for (int i=0; i < NB_RETRIES; i++) {
    if (i == NB_RETRIES - 1) {
      fail("Waited too much time for put replication");
    }
    Result res=htable2.get(get);
    if (res.size() < 3) {
      LOG.info("Rows not available");
      Thread.sleep(SLEEP_TIME);
    }
 else {
      assertArrayEquals(CellUtil.cloneValue(res.rawCells()[0]),v3);
      assertArrayEquals(CellUtil.cloneValue(res.rawCells()[1]),v2);
      assertArrayEquals(CellUtil.cloneValue(res.rawCells()[2]),v1);
      break;
    }
  }
  Delete d=new Delete(row);
  d.addColumn(famName,row,t);
  htable1.delete(d);
  get=new Get(row);
  get.setMaxVersions();
  for (int i=0; i < NB_RETRIES; i++) {
    if (i == NB_RETRIES - 1) {
      fail("Waited too much time for put replication");
    }
    Result res=htable2.get(get);
    if (res.size() > 2) {
      LOG.info("Version not deleted");
      Thread.sleep(SLEEP_TIME);
    }
 else {
      assertArrayEquals(CellUtil.cloneValue(res.rawCells()[0]),v3);
      assertArrayEquals(CellUtil.cloneValue(res.rawCells()[1]),v2);
      break;
    }
  }
  d=new Delete(row);
  d.addColumns(famName,row,t + 2);
  htable1.delete(d);
  get=new Get(row);
  for (int i=0; i < NB_RETRIES; i++) {
    if (i == NB_RETRIES - 1) {
      fail("Waited too much time for del replication");
    }
    Result res=htable2.get(get);
    if (res.size() >= 1) {
      LOG.info("Rows not deleted");
      Thread.sleep(SLEEP_TIME);
    }
 else {
      break;
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-9 type-10 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Do a more intense version testSmallBatch, one  that will trigger
 * wal rolling and other non-trivial code paths
 * @throws Exception
 */
@Test(timeout=300000) public void testLoading() throws Exception {
  LOG.info("Writing out rows to table1 in testLoading");
  List<Put> puts=new ArrayList<Put>();
  for (int i=0; i < NB_ROWS_IN_BIG_BATCH; i++) {
    Put put=new Put(Bytes.toBytes(i));
    put.addColumn(famName,row,row);
    puts.add(put);
  }
  htable1.setWriteBufferSize(1024);
  htable1.put(puts);
  Scan scan=new Scan();
  ResultScanner scanner=htable1.getScanner(scan);
  Result[] res=scanner.next(NB_ROWS_IN_BIG_BATCH);
  scanner.close();
  assertEquals(NB_ROWS_IN_BIG_BATCH,res.length);
  LOG.info("Looking in table2 for replicated rows in testLoading");
  long start=System.currentTimeMillis();
  final long retries=NB_RETRIES * 10;
  for (int i=0; i < retries; i++) {
    scan=new Scan();
    scanner=htable2.getScanner(scan);
    res=scanner.next(NB_ROWS_IN_BIG_BATCH);
    scanner.close();
    if (res.length != NB_ROWS_IN_BIG_BATCH) {
      if (i == retries - 1) {
        int lastRow=-1;
        for (        Result result : res) {
          int currentRow=Bytes.toInt(result.getRow());
          for (int row=lastRow + 1; row < currentRow; row++) {
            LOG.error("Row missing: " + row);
          }
          lastRow=currentRow;
        }
        LOG.error("Last row: " + lastRow);
        fail("Waited too much time for normal batch replication, " + res.length + " instead of "+ NB_ROWS_IN_BIG_BATCH+ "; waited="+ (System.currentTimeMillis() - start)+ "ms");
      }
 else {
        LOG.info("Only got " + res.length + " rows... retrying");
        Thread.sleep(SLEEP_TIME);
      }
    }
 else {
      break;
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-9 type-10 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test disable/enable replication, trying to insert, make sure nothing's
 * replicated, enable it, the insert should be replicated
 * @throws Exception
 */
@Test(timeout=300000) public void testDisableEnable() throws Exception {
  admin.disablePeer("2");
  byte[] rowkey=Bytes.toBytes("disable enable");
  Put put=new Put(rowkey);
  put.addColumn(famName,row,row);
  htable1.put(put);
  Get get=new Get(rowkey);
  for (int i=0; i < NB_RETRIES; i++) {
    Result res=htable2.get(get);
    if (res.size() >= 1) {
      fail("Replication wasn't disabled");
    }
 else {
      LOG.info("Row not replicated, let's wait a bit more...");
      Thread.sleep(SLEEP_TIME);
    }
  }
  admin.enablePeer("2");
  for (int i=0; i < NB_RETRIES; i++) {
    Result res=htable2.get(get);
    if (res.size() == 0) {
      LOG.info("Row not available");
      Thread.sleep(SLEEP_TIME);
    }
 else {
      assertArrayEquals(res.value(),row);
      return;
    }
  }
  fail("Waited too much time for put replication");
}

</code></pre>

<br>
<pre class="type-4 type-10 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Do a small loading into a table, make sure the data is really the same,
 * then run the VerifyReplication job to check the results. Do a second
 * comparison where all the cells are different.
 * @throws Exception
 */
@Test(timeout=300000) public void testVerifyRepJob() throws Exception {
  testSmallBatch();
  String[] args=new String[]{"2",tableName.getNameAsString()};
  Job job=VerifyReplication.createSubmittableJob(CONF_WITH_LOCALFS,args);
  if (job == null) {
    fail("Job wasn't created, see the log");
  }
  if (!job.waitForCompletion(true)) {
    fail("Job failed, see the log");
  }
  assertEquals(NB_ROWS_IN_BATCH,job.getCounters().findCounter(VerifyReplication.Verifier.Counters.GOODROWS).getValue());
  assertEquals(0,job.getCounters().findCounter(VerifyReplication.Verifier.Counters.BADROWS).getValue());
  Scan scan=new Scan();
  ResultScanner rs=htable2.getScanner(scan);
  Put put=null;
  for (  Result result : rs) {
    put=new Put(result.getRow());
    Cell firstVal=result.rawCells()[0];
    put.addColumn(CellUtil.cloneFamily(firstVal),CellUtil.cloneQualifier(firstVal),Bytes.toBytes("diff data"));
    htable2.put(put);
  }
  Delete delete=new Delete(put.getRow());
  htable2.delete(delete);
  job=VerifyReplication.createSubmittableJob(CONF_WITH_LOCALFS,args);
  if (job == null) {
    fail("Job wasn't created, see the log");
  }
  if (!job.waitForCompletion(true)) {
    fail("Job failed, see the log");
  }
  assertEquals(0,job.getCounters().findCounter(VerifyReplication.Verifier.Counters.GOODROWS).getValue());
  assertEquals(NB_ROWS_IN_BATCH,job.getCounters().findCounter(VerifyReplication.Verifier.Counters.BADROWS).getValue());
}

</code></pre>

<br>
<pre class="type-4 type-9 type-10 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Try a small batch upload using the write buffer, check it's replicated
 * @throws Exception
 */
@Test(timeout=300000) public void testSmallBatch() throws Exception {
  LOG.info("testSmallBatch");
  List<Put> puts=new ArrayList<>();
  for (int i=0; i < NB_ROWS_IN_BATCH; i++) {
    Put put=new Put(Bytes.toBytes(i));
    put.addColumn(famName,row,row);
    puts.add(put);
  }
  htable1.put(puts);
  Scan scan=new Scan();
  ResultScanner scanner1=htable1.getScanner(scan);
  Result[] res1=scanner1.next(NB_ROWS_IN_BATCH);
  scanner1.close();
  assertEquals(NB_ROWS_IN_BATCH,res1.length);
  for (int i=0; i < NB_RETRIES; i++) {
    scan=new Scan();
    if (i == NB_RETRIES - 1) {
      fail("Waited too much time for normal batch replication");
    }
    ResultScanner scanner=htable2.getScanner(scan);
    Result[] res=scanner.next(NB_ROWS_IN_BATCH);
    scanner.close();
    if (res.length != NB_ROWS_IN_BATCH) {
      LOG.info("Only got " + res.length + " rows");
      Thread.sleep(SLEEP_TIME);
    }
 else {
      break;
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-9 type-10 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Add a row, check it's replicated, delete it, check's gone
 * @throws Exception
 */
@Test(timeout=300000) public void testSimplePutDelete() throws Exception {
  LOG.info("testSimplePutDelete");
  Put put=new Put(row);
  put.addColumn(famName,row,row);
  htable1=utility1.getConnection().getTable(tableName);
  htable1.put(put);
  Get get=new Get(row);
  for (int i=0; i < NB_RETRIES; i++) {
    if (i == NB_RETRIES - 1) {
      fail("Waited too much time for put replication");
    }
    Result res=htable2.get(get);
    if (res.size() == 0) {
      LOG.info("Row not available");
      Thread.sleep(SLEEP_TIME);
    }
 else {
      assertArrayEquals(res.value(),row);
      break;
    }
  }
  Delete del=new Delete(row);
  htable1.delete(del);
  get=new Get(row);
  for (int i=0; i < NB_RETRIES; i++) {
    if (i == NB_RETRIES - 1) {
      fail("Waited too much time for del replication");
    }
    Result res=htable2.get(get);
    if (res.size() >= 1) {
      LOG.info("Row not deleted");
      Thread.sleep(SLEEP_TIME);
    }
 else {
      break;
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-9 type-10 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=300000) public void testVersionMismatchHBase14905() throws Exception {
  byte[] qualifierName=Bytes.toBytes("f1");
  Put put=new Put(Bytes.toBytes("r1"));
  long ts=System.currentTimeMillis();
  put.addColumn(famName,qualifierName,ts + 1,Bytes.toBytes("v1"));
  htable1.put(put);
  put.addColumn(famName,qualifierName,ts + 2,Bytes.toBytes("v2"));
  htable1.put(put);
  put.addColumn(famName,qualifierName,ts + 3,Bytes.toBytes("v3"));
  htable1.put(put);
  Scan scan=new Scan();
  scan.setMaxVersions(100);
  ResultScanner scanner1=htable1.getScanner(scan);
  Result[] res1=scanner1.next(1);
  scanner1.close();
  assertEquals(1,res1.length);
  assertEquals(3,res1[0].getColumnCells(famName,qualifierName).size());
  for (int i=0; i < NB_RETRIES; i++) {
    scan=new Scan();
    scan.setMaxVersions(100);
    scanner1=htable2.getScanner(scan);
    res1=scanner1.next(1);
    scanner1.close();
    if (res1.length != 1) {
      LOG.info("Only got " + res1.length + " rows");
      Thread.sleep(SLEEP_TIME);
    }
 else {
      int cellNumber=res1[0].getColumnCells(famName,Bytes.toBytes("f1")).size();
      if (cellNumber != 3) {
        LOG.info("Only got " + cellNumber + " cells");
        Thread.sleep(SLEEP_TIME);
      }
 else {
        break;
      }
    }
    if (i == NB_RETRIES - 1) {
      fail("Waited too much time for normal batch replication");
    }
  }
  try {
    admin.disablePeer("2");
    Put put2=new Put(Bytes.toBytes("r1"));
    put2.addColumn(famName,qualifierName,ts + 2,Bytes.toBytes("v99"));
    htable2.put(put2);
    scan=new Scan();
    scan.setMaxVersions(100);
    scanner1=htable2.getScanner(scan);
    res1=scanner1.next(NB_ROWS_IN_BATCH);
    scanner1.close();
    assertEquals(1,res1.length);
    assertEquals(3,res1[0].getColumnCells(famName,qualifierName).size());
    String[] args=new String[]{"--versions=100","2",tableName.getNameAsString()};
    Job job=VerifyReplication.createSubmittableJob(CONF_WITH_LOCALFS,args);
    if (job == null) {
      fail("Job wasn't created, see the log");
    }
    if (!job.waitForCompletion(true)) {
      fail("Job failed, see the log");
    }
    assertEquals(0,job.getCounters().findCounter(VerifyReplication.Verifier.Counters.GOODROWS).getValue());
    assertEquals(1,job.getCounters().findCounter(VerifyReplication.Verifier.Counters.BADROWS).getValue());
  }
  finally {
    admin.enablePeer("2");
  }
}

</code></pre>

<br>
<pre class="type-4 type-9 type-10 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=300000) public void testHBase14905() throws Exception {
  byte[] qualifierName=Bytes.toBytes("f1");
  Put put=new Put(Bytes.toBytes("r1"));
  put.addColumn(famName,qualifierName,Bytes.toBytes("v1002"));
  htable1.put(put);
  put.addColumn(famName,qualifierName,Bytes.toBytes("v1001"));
  htable1.put(put);
  put.addColumn(famName,qualifierName,Bytes.toBytes("v1112"));
  htable1.put(put);
  Scan scan=new Scan();
  scan.setMaxVersions(100);
  ResultScanner scanner1=htable1.getScanner(scan);
  Result[] res1=scanner1.next(1);
  scanner1.close();
  assertEquals(1,res1.length);
  assertEquals(3,res1[0].getColumnCells(famName,qualifierName).size());
  for (int i=0; i < NB_RETRIES; i++) {
    scan=new Scan();
    scan.setMaxVersions(100);
    scanner1=htable2.getScanner(scan);
    res1=scanner1.next(1);
    scanner1.close();
    if (res1.length != 1) {
      LOG.info("Only got " + res1.length + " rows");
      Thread.sleep(SLEEP_TIME);
    }
 else {
      int cellNumber=res1[0].getColumnCells(famName,Bytes.toBytes("f1")).size();
      if (cellNumber != 3) {
        LOG.info("Only got " + cellNumber + " cells");
        Thread.sleep(SLEEP_TIME);
      }
 else {
        break;
      }
    }
    if (i == NB_RETRIES - 1) {
      fail("Waited too much time for normal batch replication");
    }
  }
  put.addColumn(famName,qualifierName,Bytes.toBytes("v1111"));
  htable2.put(put);
  put.addColumn(famName,qualifierName,Bytes.toBytes("v1112"));
  htable2.put(put);
  scan=new Scan();
  scan.setMaxVersions(100);
  scanner1=htable2.getScanner(scan);
  res1=scanner1.next(NB_ROWS_IN_BATCH);
  scanner1.close();
  assertEquals(1,res1.length);
  assertEquals(5,res1[0].getColumnCells(famName,qualifierName).size());
  String[] args=new String[]{"--versions=100","2",tableName.getNameAsString()};
  Job job=VerifyReplication.createSubmittableJob(CONF_WITH_LOCALFS,args);
  if (job == null) {
    fail("Job wasn't created, see the log");
  }
  if (!job.waitForCompletion(true)) {
    fail("Job failed, see the log");
  }
  assertEquals(0,job.getCounters().findCounter(VerifyReplication.Verifier.Counters.GOODROWS).getValue());
  assertEquals(1,job.getCounters().findCounter(VerifyReplication.Verifier.Counters.BADROWS).getValue());
}

</code></pre>

<br>
<pre class="type-9 type-2 type-10 type-11 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Allocates resources before the execution of the test cases
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * @throws java.lang.Exception
 */
@Before public void setUp() throws Exception {
  for (  JVMClusterUtil.RegionServerThread r : utility1.getHBaseCluster().getRegionServerThreads()) {
    utility1.getHBaseAdmin().rollWALWriter(r.getRegionServer().getServerName());
  }
  utility1.deleteTableData(tableName);
  Scan scan=new Scan();
  int lastCount=0;
  for (int i=0; i < NB_RETRIES; i++) {
    if (i == NB_RETRIES - 1) {
      fail("Waited too much time for truncate");
    }
    ResultScanner scanner=htable2.getScanner(scan);
    Result[] res=scanner.next(NB_ROWS_IN_BIG_BATCH);
    scanner.close();
    if (res.length != 0) {
      if (res.length < lastCount) {
        i--;
      }
      lastCount=res.length;
      LOG.info("Still got " + res.length + " rows");
      Thread.sleep(SLEEP_TIME);
    }
 else {
      break;
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.replication.TestReplicationStateBasic </h4><pre class="type-11 type-7 type-8 type-13 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReplicationPeers() throws Exception {
  rp.init();
  try {
    rp.removePeer("bogus");
    fail("Should have thrown an IllegalArgumentException when passed a bogus peerId");
  }
 catch (  IllegalArgumentException e) {
  }
  try {
    rp.enablePeer("bogus");
    fail("Should have thrown an IllegalArgumentException when passed a bogus peerId");
  }
 catch (  IllegalArgumentException e) {
  }
  try {
    rp.disablePeer("bogus");
    fail("Should have thrown an IllegalArgumentException when passed a bogus peerId");
  }
 catch (  IllegalArgumentException e) {
  }
  try {
    rp.getStatusOfPeer("bogus");
    fail("Should have thrown an IllegalArgumentException when passed a bogus peerId");
  }
 catch (  IllegalArgumentException e) {
  }
  assertFalse(rp.peerAdded("bogus"));
  rp.peerRemoved("bogus");
  assertNull(rp.getPeerConf("bogus"));
  assertNumberOfPeers(0);
  rp.addPeer(ID_ONE,new ReplicationPeerConfig().setClusterKey(KEY_ONE),null);
  assertNumberOfPeers(1);
  rp.addPeer(ID_TWO,new ReplicationPeerConfig().setClusterKey(KEY_TWO),null);
  assertNumberOfPeers(2);
  try {
    rp.getStatusOfPeer(ID_ONE);
    fail("There are no connected peers, should have thrown an IllegalArgumentException");
  }
 catch (  IllegalArgumentException e) {
  }
  assertEquals(KEY_ONE,ZKConfig.getZooKeeperClusterKey(rp.getPeerConf(ID_ONE).getSecond()));
  rp.removePeer(ID_ONE);
  rp.peerRemoved(ID_ONE);
  assertNumberOfPeers(1);
  rp.addPeer(ID_ONE,new ReplicationPeerConfig().setClusterKey(KEY_ONE),null);
  rp.peerAdded(ID_ONE);
  assertNumberOfPeers(2);
  assertTrue(rp.getStatusOfPeer(ID_ONE));
  rp.disablePeer(ID_ONE);
  assertConnectedPeerStatus(false,ID_ONE);
  rp.enablePeer(ID_ONE);
  assertConnectedPeerStatus(true,ID_ONE);
  rp.peerRemoved(ID_ONE);
  assertNumberOfPeers(2);
  try {
    rp.getStatusOfPeer(ID_ONE);
    fail("There are no connected peers, should have thrown an IllegalArgumentException");
  }
 catch (  IllegalArgumentException e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.replication.TestReplicationTrackerZKImpl </h4><pre class="type-2 type-11 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Before public void setUp() throws Exception {
  zkw=HBaseTestingUtility.getZooKeeperWatcher(utility);
  String fakeRs1=ZKUtil.joinZNode(zkw.rsZNode,"hostname1.example.org:1234");
  try {
    ZKClusterId.setClusterId(zkw,new ClusterId());
    rp=ReplicationFactory.getReplicationPeers(zkw,conf,zkw);
    rp.init();
    rt=ReplicationFactory.getReplicationTracker(zkw,rp,conf,zkw,new DummyServer(fakeRs1));
  }
 catch (  Exception e) {
    fail("Exception during test setup: " + e);
  }
  rsRemovedCount=new AtomicInteger(0);
  rsRemovedData="";
  plChangedCount=new AtomicInteger(0);
  plChangedData=new ArrayList<String>();
  peerRemovedCount=new AtomicInteger(0);
  peerRemovedData="";
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.replication.TestReplicationWithTags </h4><pre class="type-9 type-10 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=300000) public void testReplicationWithCellTags() throws Exception {
  LOG.info("testSimplePutDelete");
  Put put=new Put(ROW);
  put.setAttribute("visibility",Bytes.toBytes("myTag3"));
  put.addColumn(FAMILY,ROW,ROW);
  htable1=utility1.getConnection().getTable(TABLE_NAME);
  htable1.put(put);
  Get get=new Get(ROW);
  try {
    for (int i=0; i < NB_RETRIES; i++) {
      if (i == NB_RETRIES - 1) {
        fail("Waited too much time for put replication");
      }
      Result res=htable2.get(get);
      if (res.size() == 0) {
        LOG.info("Row not available");
        Thread.sleep(SLEEP_TIME);
      }
 else {
        assertArrayEquals(res.value(),ROW);
        assertEquals(1,TestCoprocessorForTagsAtSink.tags.size());
        Tag tag=TestCoprocessorForTagsAtSink.tags.get(0);
        assertEquals(TAG_TYPE,tag.getType());
        break;
      }
    }
  }
  finally {
    TestCoprocessorForTagsAtSink.tags=null;
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.replication.regionserver.TestReplicationWALReaderManager </h4><pre class="type-9 type-10 type-11 type-7 type-13 type-5 type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void test() throws Exception {
  Path path=pathWatcher.currentPath;
  assertEquals(0,logManager.getPosition());
  appendToLog();
  assertNotNull(logManager.openReader(path));
  logManager.seek();
  WAL.Entry entry=logManager.readNextAndSetPosition();
  assertNotNull(entry);
  entry=logManager.readNextAndSetPosition();
  assertNull(entry);
  logManager.closeReader();
  long oldPos=logManager.getPosition();
  appendToLog();
  assertNotNull(logManager.openReader(path));
  logManager.seek();
  entry=logManager.readNextAndSetPosition();
  assertNotEquals(oldPos,logManager.getPosition());
  assertNotNull(entry);
  logManager.closeReader();
  oldPos=logManager.getPosition();
  log.rollWriter();
  assertNotNull(logManager.openReader(path));
  logManager.seek();
  entry=logManager.readNextAndSetPosition();
  assertEquals(oldPos,logManager.getPosition());
  assertNull(entry);
  logManager.finishCurrentFile();
  path=pathWatcher.currentPath;
  for (int i=0; i < nbRows; i++) {
    appendToLogPlus(walEditKVs);
  }
  log.rollWriter();
  logManager.openReader(path);
  logManager.seek();
  for (int i=0; i < nbRows; i++) {
    WAL.Entry e=logManager.readNextAndSetPosition();
    if (e == null) {
      fail("Should have enough entries");
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.security.TestEncryptionUtil </h4><pre class="type-4 type-11 type-7 type-8 type-13 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKeyWrapping() throws Exception {
  Configuration conf=new Configuration();
  conf.set(HConstants.CRYPTO_KEYPROVIDER_CONF_KEY,KeyProviderForTesting.class.getName());
  byte[] keyBytes=new byte[AES.KEY_LENGTH];
  new SecureRandom().nextBytes(keyBytes);
  String algorithm=conf.get(HConstants.CRYPTO_KEY_ALGORITHM_CONF_KEY,HConstants.CIPHER_AES);
  Key key=new SecretKeySpec(keyBytes,algorithm);
  byte[] wrappedKeyBytes=EncryptionUtil.wrapKey(conf,"hbase",key);
  assertNotNull(wrappedKeyBytes);
  Key unwrappedKey=EncryptionUtil.unwrapKey(conf,"hbase",wrappedKeyBytes);
  assertNotNull(unwrappedKey);
  assertTrue(unwrappedKey instanceof SecretKeySpec);
  assertTrue("Unwrapped key bytes do not match original",Bytes.equals(keyBytes,unwrappedKey.getEncoded()));
  try {
    EncryptionUtil.unwrapKey(conf,"other",wrappedKeyBytes);
    fail("Unwrap with incorrect key did not throw KeyException");
  }
 catch (  KeyException e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.security.TestHBaseSaslRpcClient </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testSaslClientCallbackHandlerWithException(){
  final Token<? extends TokenIdentifier> token=createTokenMock();
  when(token.getIdentifier()).thenReturn(DEFAULT_USER_NAME.getBytes());
  when(token.getPassword()).thenReturn(DEFAULT_USER_PASSWORD.getBytes());
  final SaslClientCallbackHandler saslClCallbackHandler=new SaslClientCallbackHandler(token);
  try {
    saslClCallbackHandler.handle(new Callback[]{mock(TextOutputCallback.class)});
  }
 catch (  UnsupportedCallbackException expEx) {
  }
catch (  Exception ex) {
    fail("testSaslClientCallbackHandlerWithException error : " + ex.getMessage());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.security.access.TestAccessController </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=180000) public void testCheckPermissions() throws Exception {
  AccessTestAction globalAdmin=new AccessTestAction(){
    @Override public Void run() throws Exception {
      checkGlobalPerms(TEST_UTIL,Permission.Action.ADMIN);
      return null;
    }
  }
;
  verifyGlobal(globalAdmin);
  AccessTestAction globalReadWrite=new AccessTestAction(){
    @Override public Void run() throws Exception {
      checkGlobalPerms(TEST_UTIL,Permission.Action.READ,Permission.Action.WRITE);
      return null;
    }
  }
;
  verifyGlobal(globalReadWrite);
  final byte[] TEST_Q1=Bytes.toBytes("q1");
  final byte[] TEST_Q2=Bytes.toBytes("q2");
  User userTable=User.createUserForTesting(conf,"user_check_perms_table",new String[0]);
  User userColumn=User.createUserForTesting(conf,"user_check_perms_family",new String[0]);
  User userQualifier=User.createUserForTesting(conf,"user_check_perms_q",new String[0]);
  grantOnTable(TEST_UTIL,userTable.getShortName(),TEST_TABLE,null,null,Permission.Action.READ);
  grantOnTable(TEST_UTIL,userColumn.getShortName(),TEST_TABLE,TEST_FAMILY,null,Permission.Action.READ);
  grantOnTable(TEST_UTIL,userQualifier.getShortName(),TEST_TABLE,TEST_FAMILY,TEST_Q1,Permission.Action.READ);
  try {
    AccessTestAction tableRead=new AccessTestAction(){
      @Override public Void run() throws Exception {
        checkTablePerms(TEST_UTIL,TEST_TABLE,null,null,Permission.Action.READ);
        return null;
      }
    }
;
    AccessTestAction columnRead=new AccessTestAction(){
      @Override public Void run() throws Exception {
        checkTablePerms(TEST_UTIL,TEST_TABLE,TEST_FAMILY,null,Permission.Action.READ);
        return null;
      }
    }
;
    AccessTestAction qualifierRead=new AccessTestAction(){
      @Override public Void run() throws Exception {
        checkTablePerms(TEST_UTIL,TEST_TABLE,TEST_FAMILY,TEST_Q1,Permission.Action.READ);
        return null;
      }
    }
;
    AccessTestAction multiQualifierRead=new AccessTestAction(){
      @Override public Void run() throws Exception {
        checkTablePerms(TEST_UTIL,TEST_TABLE,new Permission[]{new TablePermission(TEST_TABLE,TEST_FAMILY,TEST_Q1,Permission.Action.READ),new TablePermission(TEST_TABLE,TEST_FAMILY,TEST_Q2,Permission.Action.READ)});
        return null;
      }
    }
;
    AccessTestAction globalAndTableRead=new AccessTestAction(){
      @Override public Void run() throws Exception {
        checkTablePerms(TEST_UTIL,TEST_TABLE,new Permission[]{new Permission(Permission.Action.READ),new TablePermission(TEST_TABLE,null,(byte[])null,Permission.Action.READ)});
        return null;
      }
    }
;
    AccessTestAction noCheck=new AccessTestAction(){
      @Override public Void run() throws Exception {
        checkTablePerms(TEST_UTIL,TEST_TABLE,new Permission[0]);
        return null;
      }
    }
;
    verifyAllowed(tableRead,SUPERUSER,userTable);
    verifyDenied(tableRead,userColumn,userQualifier);
    verifyAllowed(columnRead,SUPERUSER,userTable,userColumn);
    verifyDenied(columnRead,userQualifier);
    verifyAllowed(qualifierRead,SUPERUSER,userTable,userColumn,userQualifier);
    verifyAllowed(multiQualifierRead,SUPERUSER,userTable,userColumn);
    verifyDenied(multiQualifierRead,userQualifier);
    verifyAllowed(globalAndTableRead,SUPERUSER);
    verifyDenied(globalAndTableRead,userTable,userColumn,userQualifier);
    verifyAllowed(noCheck,SUPERUSER,userTable,userColumn,userQualifier);
    AccessTestAction familyReadWrite=new AccessTestAction(){
      @Override public Void run() throws Exception {
        checkTablePerms(TEST_UTIL,TEST_TABLE,TEST_FAMILY,null,Permission.Action.READ,Permission.Action.WRITE);
        return null;
      }
    }
;
    verifyAllowed(familyReadWrite,SUPERUSER,USER_OWNER,USER_CREATE,USER_RW);
    verifyDenied(familyReadWrite,USER_NONE,USER_RO);
    CheckPermissionsRequest checkRequest=CheckPermissionsRequest.newBuilder().addPermission(AccessControlProtos.Permission.newBuilder().setType(AccessControlProtos.Permission.Type.Table).setTablePermission(AccessControlProtos.TablePermission.newBuilder().setTableName(ProtobufUtil.toProtoTableName(TEST_TABLE)).addAction(AccessControlProtos.Permission.Action.CREATE))).build();
    Table acl=systemUserConnection.getTable(AccessControlLists.ACL_TABLE_NAME);
    try {
      BlockingRpcChannel channel=acl.coprocessorService(new byte[0]);
      AccessControlService.BlockingInterface protocol=AccessControlService.newBlockingStub(channel);
      try {
        protocol.checkPermissions(null,checkRequest);
        fail("this should have thrown CoprocessorException");
      }
 catch (      ServiceException ex) {
      }
    }
  finally {
      acl.close();
    }
  }
  finally {
    revokeFromTable(TEST_UTIL,userTable.getShortName(),TEST_TABLE,null,null,Permission.Action.READ);
    revokeFromTable(TEST_UTIL,userColumn.getShortName(),TEST_TABLE,TEST_FAMILY,null,Permission.Action.READ);
    revokeFromTable(TEST_UTIL,userQualifier.getShortName(),TEST_TABLE,TEST_FAMILY,TEST_Q1,Permission.Action.READ);
  }
}

</code></pre>

<br>
<pre class="type-9 type-10 type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=180000) public void testGlobalAuthorizationForNewRegisteredRS() throws Exception {
  LOG.debug("Test for global authorization for a new registered RegionServer.");
  MiniHBaseCluster hbaseCluster=TEST_UTIL.getHBaseCluster();
  final Admin admin=TEST_UTIL.getHBaseAdmin();
  HTableDescriptor htd=new HTableDescriptor(TEST_TABLE2);
  htd.addFamily(new HColumnDescriptor(TEST_FAMILY));
  createTable(TEST_UTIL,htd);
  JVMClusterUtil.RegionServerThread newRsThread=hbaseCluster.startRegionServer();
  final HRegionServer newRs=newRsThread.getRegionServer();
  List<HRegionLocation> regions;
  try (RegionLocator locator=systemUserConnection.getRegionLocator(TEST_TABLE2)){
    regions=locator.getAllRegionLocations();
  }
   HRegionLocation location=regions.get(0);
  final HRegionInfo hri=location.getRegionInfo();
  final ServerName server=location.getServerName();
  try (Table table=systemUserConnection.getTable(TEST_TABLE2)){
    AccessTestAction moveAction=new AccessTestAction(){
      @Override public Object run() throws Exception {
        admin.move(hri.getEncodedNameAsBytes(),Bytes.toBytes(newRs.getServerName().getServerName()));
        return null;
      }
    }
;
    SUPERUSER.runAs(moveAction);
    final int RETRIES_LIMIT=10;
    int retries=0;
    while (newRs.getOnlineRegions(TEST_TABLE2).size() < 1 && retries < RETRIES_LIMIT) {
      LOG.debug("Waiting for region to be opened. Already retried " + retries + " times.");
      try {
        Thread.sleep(1000);
      }
 catch (      InterruptedException e) {
      }
      retries++;
      if (retries == RETRIES_LIMIT - 1) {
        fail("Retry exhaust for waiting region to be opened.");
      }
    }
    AccessTestAction putAction=new AccessTestAction(){
      @Override public Object run() throws Exception {
        Put put=new Put(Bytes.toBytes("test"));
        put.addColumn(TEST_FAMILY,Bytes.toBytes("qual"),Bytes.toBytes("value"));
        table.put(put);
        return null;
      }
    }
;
    USER_ADMIN.runAs(putAction);
  }
 }

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.security.visibility.TestExpressionParser </h4><pre class="type-11 type-7 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCasesSeperatedByDoubleQuotes() throws Exception {
  ExpressionNode node=null;
  try {
    node=parser.parse("\u0027&\"|\u002b&\u003f");
    fail("Excpetion must be thrown as there are special characters without quotes");
  }
 catch (  ParseException e) {
  }
  node=parser.parse(CellVisibility.quote("\u0027") + "&" + CellVisibility.quote("\"")+ "|"+ CellVisibility.quote("\u002b" + "&" + "\u003f"));
  assertTrue(node instanceof NonLeafExpressionNode);
  NonLeafExpressionNode nlNode=(NonLeafExpressionNode)node;
  assertEquals(Operator.OR,nlNode.getOperator());
  assertEquals(2,nlNode.getChildExps().size());
  assertEquals("\u002b" + "&" + "\u003f",((LeafExpressionNode)nlNode.getChildExps().get(1)).getIdentifier());
  assertTrue(nlNode.getChildExps().get(0) instanceof NonLeafExpressionNode);
  nlNode=(NonLeafExpressionNode)nlNode.getChildExps().get(0);
  assertEquals(Operator.AND,nlNode.getOperator());
  assertEquals(2,nlNode.getChildExps().size());
  assertEquals("\"",((LeafExpressionNode)nlNode.getChildExps().get(1)).getIdentifier());
  assertEquals("\u0027",((LeafExpressionNode)nlNode.getChildExps().get(0)).getIdentifier());
  try {
    node=parser.parse(CellVisibility.quote("\u0027&\\") + "|" + CellVisibility.quote("\u002b" + "&" + "\\")+ CellVisibility.quote("$$\""));
    fail("Excpetion must be thrown as there is not operator");
  }
 catch (  ParseException e) {
  }
  node=parser.parse(CellVisibility.quote("\u0027" + "&" + "\\") + "|" + CellVisibility.quote("\u003f" + "&" + "\\")+ "&"+ CellVisibility.quote("$$\""));
  assertTrue(node instanceof NonLeafExpressionNode);
  nlNode=(NonLeafExpressionNode)node;
  assertEquals(Operator.AND,nlNode.getOperator());
  assertEquals(2,nlNode.getChildExps().size());
  assertEquals("$$\"",((LeafExpressionNode)nlNode.getChildExps().get(1)).getIdentifier());
  assertTrue(nlNode.getChildExps().get(0) instanceof NonLeafExpressionNode);
  nlNode=(NonLeafExpressionNode)nlNode.getChildExps().get(0);
  assertEquals(Operator.OR,nlNode.getOperator());
  assertEquals(2,nlNode.getChildExps().size());
  assertEquals("\u0027" + "&" + "\\",((LeafExpressionNode)nlNode.getChildExps().get(0)).getIdentifier());
  assertEquals("\u003f" + "&" + "\\",((LeafExpressionNode)nlNode.getChildExps().get(1)).getIdentifier());
  try {
    node=parser.parse(CellVisibility.quote("\u002b&\\") + "|" + CellVisibility.quote("\u0027&\\")+ "&"+ "\"$$");
    fail("Excpetion must be thrown as there is no end quote");
  }
 catch (  ParseException e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.security.visibility.TestVisibilityLabels </h4><pre class="type-4 type-11 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSetAndGetUserAuths() throws Throwable {
  final String user="user1";
  PrivilegedExceptionAction<Void> action=new PrivilegedExceptionAction<Void>(){
    public Void run() throws Exception {
      String[] auths={SECRET,CONFIDENTIAL};
      try (Connection conn=ConnectionFactory.createConnection(conf)){
        VisibilityClient.setAuths(conn,auths,user);
      }
 catch (      Throwable e) {
      }
      return null;
    }
  }
;
  SUPERUSER.runAs(action);
  try (Table ht=TEST_UTIL.getConnection().getTable(LABELS_TABLE_NAME)){
    Scan scan=new Scan();
    scan.setAuthorizations(new Authorizations(VisibilityUtils.SYSTEM_LABEL));
    ResultScanner scanner=ht.getScanner(scan);
    Result result=null;
    List<Result> results=new ArrayList<Result>();
    while ((result=scanner.next()) != null) {
      results.add(result);
    }
    List<String> auths=extractAuths(user,results);
    assertTrue(auths.contains(SECRET));
    assertTrue(auths.contains(CONFIDENTIAL));
    assertEquals(2,auths.size());
  }
   action=new PrivilegedExceptionAction<Void>(){
    public Void run() throws Exception {
      GetAuthsResponse authsResponse=null;
      try (Connection conn=ConnectionFactory.createConnection(conf)){
        authsResponse=VisibilityClient.getAuths(conn,user);
      }
 catch (      Throwable e) {
        fail("Should not have failed");
      }
      List<String> authsList=new ArrayList<String>();
      for (      ByteString authBS : authsResponse.getAuthList()) {
        authsList.add(Bytes.toString(authBS.toByteArray()));
      }
      assertEquals(2,authsList.size());
      assertTrue(authsList.contains(SECRET));
      assertTrue(authsList.contains(CONFIDENTIAL));
      return null;
    }
  }
;
  SUPERUSER.runAs(action);
  action=new PrivilegedExceptionAction<Void>(){
    public Void run() throws Exception {
      String[] auths1={SECRET,CONFIDENTIAL};
      GetAuthsResponse authsResponse=null;
      try (Connection conn=ConnectionFactory.createConnection(conf)){
        VisibilityClient.setAuths(conn,auths1,user);
        try {
          authsResponse=VisibilityClient.getAuths(conn,user);
        }
 catch (        Throwable e) {
          fail("Should not have failed");
        }
      }
 catch (      Throwable e) {
      }
      List<String> authsList=new ArrayList<String>();
      for (      ByteString authBS : authsResponse.getAuthList()) {
        authsList.add(Bytes.toString(authBS.toByteArray()));
      }
      assertEquals(2,authsList.size());
      assertTrue(authsList.contains(SECRET));
      assertTrue(authsList.contains(CONFIDENTIAL));
      return null;
    }
  }
;
  SUPERUSER.runAs(action);
}

</code></pre>

<br>
<pre class="type-4 type-11 type-7 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testClearUserAuths() throws Throwable {
  PrivilegedExceptionAction<Void> action=new PrivilegedExceptionAction<Void>(){
    public Void run() throws Exception {
      String[] auths={SECRET,CONFIDENTIAL,PRIVATE};
      String user="testUser";
      try (Connection conn=ConnectionFactory.createConnection(conf)){
        VisibilityClient.setAuths(conn,auths,user);
      }
 catch (      Throwable e) {
        fail("Should not have failed");
      }
      auths=new String[]{SECRET,PUBLIC,CONFIDENTIAL};
      VisibilityLabelsResponse response=null;
      try (Connection conn=ConnectionFactory.createConnection(conf)){
        response=VisibilityClient.clearAuths(conn,auths,user);
      }
 catch (      Throwable e) {
        fail("Should not have failed");
      }
      List<RegionActionResult> resultList=response.getResultList();
      assertEquals(3,resultList.size());
      assertTrue(resultList.get(0).getException().getValue().isEmpty());
      assertEquals("org.apache.hadoop.hbase.DoNotRetryIOException",resultList.get(1).getException().getName());
      assertTrue(Bytes.toString(resultList.get(1).getException().getValue().toByteArray()).contains("org.apache.hadoop.hbase.security.visibility.InvalidLabelException: " + "Label 'public' is not set for the user testUser"));
      assertTrue(resultList.get(2).getException().getValue().isEmpty());
      try (Connection connection=ConnectionFactory.createConnection(conf);Table ht=connection.getTable(LABELS_TABLE_NAME)){
        ResultScanner scanner=ht.getScanner(new Scan());
        Result result=null;
        List<Result> results=new ArrayList<Result>();
        while ((result=scanner.next()) != null) {
          results.add(result);
        }
        List<String> curAuths=extractAuths(user,results);
        assertTrue(curAuths.contains(PRIVATE));
        assertEquals(1,curAuths.size());
      }
       GetAuthsResponse authsResponse=null;
      try (Connection conn=ConnectionFactory.createConnection(conf)){
        authsResponse=VisibilityClient.getAuths(conn,user);
      }
 catch (      Throwable e) {
        fail("Should not have failed");
      }
      List<String> authsList=new ArrayList<String>();
      for (      ByteString authBS : authsResponse.getAuthList()) {
        authsList.add(Bytes.toString(authBS.toByteArray()));
      }
      assertEquals(1,authsList.size());
      assertTrue(authsList.contains(PRIVATE));
      return null;
    }
  }
;
  SUPERUSER.runAs(action);
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testUserShouldNotDoDDLOpOnLabelsTable() throws Exception {
  Admin admin=TEST_UTIL.getHBaseAdmin();
  try {
    admin.disableTable(LABELS_TABLE_NAME);
    fail("Lables table should not get disabled by user.");
  }
 catch (  Exception e) {
  }
  try {
    admin.deleteTable(LABELS_TABLE_NAME);
    fail("Lables table should not get disabled by user.");
  }
 catch (  Exception e) {
  }
  try {
    HColumnDescriptor hcd=new HColumnDescriptor("testFamily");
    admin.addColumnFamily(LABELS_TABLE_NAME,hcd);
    fail("Lables table should not get altered by user.");
  }
 catch (  Exception e) {
  }
  try {
    admin.deleteColumnFamily(LABELS_TABLE_NAME,VisibilityConstants.LABELS_TABLE_FAMILY);
    fail("Lables table should not get altered by user.");
  }
 catch (  Exception e) {
  }
  try {
    HColumnDescriptor hcd=new HColumnDescriptor(VisibilityConstants.LABELS_TABLE_FAMILY);
    hcd.setBloomFilterType(BloomType.ROWCOL);
    admin.modifyColumnFamily(LABELS_TABLE_NAME,hcd);
    fail("Lables table should not get altered by user.");
  }
 catch (  Exception e) {
  }
  try {
    HTableDescriptor htd=new HTableDescriptor(LABELS_TABLE_NAME);
    htd.addFamily(new HColumnDescriptor("f1"));
    htd.addFamily(new HColumnDescriptor("f2"));
    admin.modifyTable(LABELS_TABLE_NAME,htd);
    fail("Lables table should not get altered by user.");
  }
 catch (  Exception e) {
  }
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testVisibilityLabelsInPutsThatDoesNotMatchAnyDefinedLabels() throws Exception {
  TableName tableName=TableName.valueOf(TEST_NAME.getMethodName());
  try {
    createTableAndWriteDataWithLabels(tableName,"SAMPLE_LABEL","TEST");
    fail("Should have failed with failed sanity check exception");
  }
 catch (  Exception e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.security.visibility.TestVisibilityLabelsWithDefaultVisLabelService </h4><pre class="type-4 type-11 type-7 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAddLabels() throws Throwable {
  PrivilegedExceptionAction<VisibilityLabelsResponse> action=new PrivilegedExceptionAction<VisibilityLabelsResponse>(){
    public VisibilityLabelsResponse run() throws Exception {
      String[] labels={"L1",SECRET,"L2","invalid~","L3"};
      VisibilityLabelsResponse response=null;
      try (Connection conn=ConnectionFactory.createConnection(conf)){
        response=VisibilityClient.addLabels(conn,labels);
      }
 catch (      Throwable e) {
        fail("Should not have thrown exception");
      }
      List<RegionActionResult> resultList=response.getResultList();
      assertEquals(5,resultList.size());
      assertTrue(resultList.get(0).getException().getValue().isEmpty());
      assertEquals("org.apache.hadoop.hbase.DoNotRetryIOException",resultList.get(1).getException().getName());
      assertTrue(Bytes.toString(resultList.get(1).getException().getValue().toByteArray()).contains("org.apache.hadoop.hbase.security.visibility.LabelAlreadyExistsException: " + "Label 'secret' already exists"));
      assertTrue(resultList.get(2).getException().getValue().isEmpty());
      assertTrue(resultList.get(3).getException().getValue().isEmpty());
      assertTrue(resultList.get(4).getException().getValue().isEmpty());
      return null;
    }
  }
;
  SUPERUSER.runAs(action);
}

</code></pre>

<br>
<pre class="type-4 type-11 type-7 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testListLabelsWithRegEx() throws Throwable {
  PrivilegedExceptionAction<ListLabelsResponse> action=new PrivilegedExceptionAction<ListLabelsResponse>(){
    public ListLabelsResponse run() throws Exception {
      ListLabelsResponse response=null;
      try (Connection conn=ConnectionFactory.createConnection(conf)){
        response=VisibilityClient.listLabels(conn,".*secret");
      }
 catch (      Throwable e) {
        fail("Should not have thrown exception");
      }
      List<ByteString> labels=response.getLabelList();
      assertEquals(2,labels.size());
      assertTrue(labels.contains(ByteString.copyFrom(SECRET.getBytes())));
      assertTrue(labels.contains(ByteString.copyFrom(TOPSECRET.getBytes())));
      return null;
    }
  }
;
  SUPERUSER.runAs(action);
}

</code></pre>

<br>
<pre class="type-4 type-11 type-7 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testListLabels() throws Throwable {
  PrivilegedExceptionAction<ListLabelsResponse> action=new PrivilegedExceptionAction<ListLabelsResponse>(){
    public ListLabelsResponse run() throws Exception {
      ListLabelsResponse response=null;
      try (Connection conn=ConnectionFactory.createConnection(conf)){
        response=VisibilityClient.listLabels(conn,null);
      }
 catch (      Throwable e) {
        fail("Should not have thrown exception");
      }
      List<ByteString> labels=response.getLabelList();
      assertEquals(12,labels.size());
      assertTrue(labels.contains(ByteString.copyFrom(SECRET.getBytes())));
      assertTrue(labels.contains(ByteString.copyFrom(TOPSECRET.getBytes())));
      assertTrue(labels.contains(ByteString.copyFrom(CONFIDENTIAL.getBytes())));
      assertTrue(labels.contains(ByteString.copyFrom("ABC".getBytes())));
      assertTrue(labels.contains(ByteString.copyFrom("XYZ".getBytes())));
      assertFalse(labels.contains(ByteString.copyFrom(SYSTEM_LABEL.getBytes())));
      return null;
    }
  }
;
  SUPERUSER.runAs(action);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.security.visibility.TestVisibilityLablesWithGroups </h4><pre class="type-4 type-11 type-7 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGroupAuths() throws Exception {
  final TableName tableName=TableName.valueOf(TEST_NAME.getMethodName());
  TEST_UTIL.createTable(tableName,CF);
  SUPERUSER.runAs(new PrivilegedExceptionAction<Void>(){
    public Void run() throws Exception {
      try (Connection connection=ConnectionFactory.createConnection(conf);Table table=connection.getTable(tableName)){
        Put put=new Put(ROW_1);
        put.addColumn(CF,Q1,HConstants.LATEST_TIMESTAMP,value1);
        put.setCellVisibility(new CellVisibility(SECRET));
        table.put(put);
        put=new Put(ROW_1);
        put.addColumn(CF,Q2,HConstants.LATEST_TIMESTAMP,value2);
        put.setCellVisibility(new CellVisibility(CONFIDENTIAL));
        table.put(put);
        put=new Put(ROW_1);
        put.addColumn(CF,Q3,HConstants.LATEST_TIMESTAMP,value3);
        table.put(put);
      }
       return null;
    }
  }
);
  SUPERUSER.runAs(new PrivilegedExceptionAction<Void>(){
    public Void run() throws Exception {
      try (Connection connection=ConnectionFactory.createConnection(conf);Table table=connection.getTable(tableName)){
        Scan s=new Scan();
        ResultScanner scanner=table.getScanner(s);
        Result[] next=scanner.next(1);
        assertTrue(next.length == 1);
        CellScanner cellScanner=next[0].cellScanner();
        cellScanner.advance();
        Cell current=cellScanner.current();
        assertTrue(Bytes.equals(current.getRowArray(),current.getRowOffset(),current.getRowLength(),ROW_1,0,ROW_1.length));
        assertTrue(Bytes.equals(current.getQualifierArray(),current.getQualifierOffset(),current.getQualifierLength(),Q1,0,Q1.length));
        assertTrue(Bytes.equals(current.getValueArray(),current.getValueOffset(),current.getValueLength(),value1,0,value1.length));
        cellScanner.advance();
        current=cellScanner.current();
        assertTrue(Bytes.equals(current.getRowArray(),current.getRowOffset(),current.getRowLength(),ROW_1,0,ROW_1.length));
        assertTrue(Bytes.equals(current.getQualifierArray(),current.getQualifierOffset(),current.getQualifierLength(),Q2,0,Q2.length));
        assertTrue(Bytes.equals(current.getValueArray(),current.getValueOffset(),current.getValueLength(),value2,0,value2.length));
        cellScanner.advance();
        current=cellScanner.current();
        assertTrue(Bytes.equals(current.getRowArray(),current.getRowOffset(),current.getRowLength(),ROW_1,0,ROW_1.length));
        assertTrue(Bytes.equals(current.getQualifierArray(),current.getQualifierOffset(),current.getQualifierLength(),Q3,0,Q3.length));
        assertTrue(Bytes.equals(current.getValueArray(),current.getValueOffset(),current.getValueLength(),value3,0,value3.length));
      }
       return null;
    }
  }
);
  SUPERUSER.runAs(new PrivilegedExceptionAction<Void>(){
    public Void run() throws Exception {
      GetAuthsResponse authsResponse=null;
      try (Connection conn=ConnectionFactory.createConnection(conf)){
        authsResponse=VisibilityClient.getAuths(conn,"@testgroup");
      }
 catch (      Throwable e) {
        fail("Should not have failed");
      }
      List<String> authsList=new ArrayList<String>();
      for (      ByteString authBS : authsResponse.getAuthList()) {
        authsList.add(Bytes.toString(authBS.toByteArray()));
      }
      assertEquals(1,authsList.size());
      assertTrue(authsList.contains(CONFIDENTIAL));
      return null;
    }
  }
);
  TESTUSER.runAs(new PrivilegedExceptionAction<Void>(){
    public Void run() throws Exception {
      try (Connection connection=ConnectionFactory.createConnection(conf);Table table=connection.getTable(tableName)){
        Scan s=new Scan();
        ResultScanner scanner=table.getScanner(s);
        Result[] next=scanner.next(1);
        assertTrue(next.length == 1);
        CellScanner cellScanner=next[0].cellScanner();
        cellScanner.advance();
        Cell current=cellScanner.current();
        assertTrue(Bytes.equals(current.getRowArray(),current.getRowOffset(),current.getRowLength(),ROW_1,0,ROW_1.length));
        assertTrue(Bytes.equals(current.getQualifierArray(),current.getQualifierOffset(),current.getQualifierLength(),Q2,0,Q2.length));
        assertTrue(Bytes.equals(current.getValueArray(),current.getValueOffset(),current.getValueLength(),value2,0,value2.length));
        cellScanner.advance();
        current=cellScanner.current();
        assertTrue(Bytes.equals(current.getRowArray(),current.getRowOffset(),current.getRowLength(),ROW_1,0,ROW_1.length));
        assertTrue(Bytes.equals(current.getQualifierArray(),current.getQualifierOffset(),current.getQualifierLength(),Q3,0,Q3.length));
        assertTrue(Bytes.equals(current.getValueArray(),current.getValueOffset(),current.getValueLength(),value3,0,value3.length));
        Scan s1=new Scan();
        s1.setAuthorizations(new Authorizations(new String[]{SECRET,CONFIDENTIAL}));
        ResultScanner scanner1=table.getScanner(s1);
        Result[] next1=scanner1.next(1);
        assertTrue(next1.length == 1);
        CellScanner cellScanner1=next1[0].cellScanner();
        cellScanner1.advance();
        Cell current1=cellScanner1.current();
        assertTrue(Bytes.equals(current1.getRowArray(),current1.getRowOffset(),current1.getRowLength(),ROW_1,0,ROW_1.length));
        assertTrue(Bytes.equals(current1.getQualifierArray(),current1.getQualifierOffset(),current1.getQualifierLength(),Q2,0,Q2.length));
        assertTrue(Bytes.equals(current1.getValueArray(),current1.getValueOffset(),current1.getValueLength(),value2,0,value2.length));
        cellScanner1.advance();
        current1=cellScanner1.current();
        assertTrue(Bytes.equals(current1.getRowArray(),current1.getRowOffset(),current1.getRowLength(),ROW_1,0,ROW_1.length));
        assertTrue(Bytes.equals(current1.getQualifierArray(),current1.getQualifierOffset(),current1.getQualifierLength(),Q3,0,Q3.length));
        assertTrue(Bytes.equals(current1.getValueArray(),current1.getValueOffset(),current1.getValueLength(),value3,0,value3.length));
        Scan s2=new Scan();
        s2.setAuthorizations(new Authorizations(new String[]{SECRET}));
        ResultScanner scanner2=table.getScanner(s2);
        Result next2=scanner2.next();
        CellScanner cellScanner2=next2.cellScanner();
        cellScanner2.advance();
        Cell current2=cellScanner2.current();
        assertTrue(Bytes.equals(current2.getRowArray(),current2.getRowOffset(),current2.getRowLength(),ROW_1,0,ROW_1.length));
        assertTrue(Bytes.equals(current2.getQualifierArray(),current2.getQualifierOffset(),current2.getQualifierLength(),Q3,0,Q3.length));
        assertTrue(Bytes.equals(current2.getValueArray(),current2.getValueOffset(),current2.getValueLength(),value3,0,value3.length));
        assertFalse(cellScanner2.advance());
      }
       return null;
    }
  }
);
  SUPERUSER.runAs(new PrivilegedExceptionAction<Void>(){
    public Void run() throws Exception {
      VisibilityLabelsResponse response=null;
      try (Connection conn=ConnectionFactory.createConnection(conf)){
        response=VisibilityClient.clearAuths(conn,new String[]{CONFIDENTIAL},"@testgroup");
      }
 catch (      Throwable e) {
        fail("Should not have failed");
      }
      return null;
    }
  }
);
  SUPERUSER.runAs(new PrivilegedExceptionAction<Void>(){
    public Void run() throws Exception {
      GetAuthsResponse authsResponse=null;
      try (Connection conn=ConnectionFactory.createConnection(conf)){
        authsResponse=VisibilityClient.getAuths(conn,"@testgroup");
      }
 catch (      Throwable e) {
        fail("Should not have failed");
      }
      List<String> authsList=new ArrayList<String>();
      for (      ByteString authBS : authsResponse.getAuthList()) {
        authsList.add(Bytes.toString(authBS.toByteArray()));
      }
      assertEquals(0,authsList.size());
      return null;
    }
  }
);
  TESTUSER.runAs(new PrivilegedExceptionAction<Void>(){
    public Void run() throws Exception {
      try (Connection connection=ConnectionFactory.createConnection(conf);Table table=connection.getTable(tableName)){
        Scan s1=new Scan();
        s1.setAuthorizations(new Authorizations(new String[]{SECRET,CONFIDENTIAL}));
        ResultScanner scanner1=table.getScanner(s1);
        Result[] next1=scanner1.next(1);
        assertTrue(next1.length == 1);
        CellScanner cellScanner1=next1[0].cellScanner();
        cellScanner1.advance();
        Cell current1=cellScanner1.current();
        assertTrue(Bytes.equals(current1.getRowArray(),current1.getRowOffset(),current1.getRowLength(),ROW_1,0,ROW_1.length));
        assertTrue(Bytes.equals(current1.getQualifierArray(),current1.getQualifierOffset(),current1.getQualifierLength(),Q3,0,Q3.length));
        assertTrue(Bytes.equals(current1.getValueArray(),current1.getValueOffset(),current1.getValueLength(),value3,0,value3.length));
        assertFalse(cellScanner1.advance());
      }
       return null;
    }
  }
);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.security.visibility.TestVisibilityWithCheckAuths </h4><pre class="type-11 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLabelsWithAppend() throws Throwable {
  PrivilegedExceptionAction<VisibilityLabelsResponse> action=new PrivilegedExceptionAction<VisibilityLabelsResponse>(){
    @Override public VisibilityLabelsResponse run() throws Exception {
      try (Connection conn=ConnectionFactory.createConnection(conf)){
        return VisibilityClient.setAuths(conn,new String[]{TOPSECRET},USER.getShortName());
      }
 catch (      Throwable e) {
      }
      return null;
    }
  }
;
  SUPERUSER.runAs(action);
  final TableName tableName=TableName.valueOf(TEST_NAME.getMethodName());
  try (Table table=TEST_UTIL.createTable(tableName,fam)){
    final byte[] row1=Bytes.toBytes("row1");
    final byte[] val=Bytes.toBytes("a");
    PrivilegedExceptionAction<Void> actiona=new PrivilegedExceptionAction<Void>(){
      @Override public Void run() throws Exception {
        try (Connection connection=ConnectionFactory.createConnection(conf);Table table=connection.getTable(tableName)){
          Put put=new Put(row1);
          put.addColumn(fam,qual,HConstants.LATEST_TIMESTAMP,val);
          put.setCellVisibility(new CellVisibility(TOPSECRET));
          table.put(put);
        }
         return null;
      }
    }
;
    USER.runAs(actiona);
    actiona=new PrivilegedExceptionAction<Void>(){
      @Override public Void run() throws Exception {
        try (Connection connection=ConnectionFactory.createConnection(conf);Table table=connection.getTable(tableName)){
          Append append=new Append(row1);
          append.add(fam,qual,Bytes.toBytes("b"));
          table.append(append);
        }
         return null;
      }
    }
;
    USER.runAs(actiona);
    actiona=new PrivilegedExceptionAction<Void>(){
      @Override public Void run() throws Exception {
        try (Connection connection=ConnectionFactory.createConnection(conf);Table table=connection.getTable(tableName)){
          Append append=new Append(row1);
          append.add(fam,qual,Bytes.toBytes("c"));
          append.setCellVisibility(new CellVisibility(PUBLIC));
          table.append(append);
          Assert.fail("Testcase should fail with AccesDeniedException");
        }
 catch (        Throwable t) {
          assertTrue(t.getMessage().contains("AccessDeniedException"));
        }
        return null;
      }
    }
;
    USER.runAs(actiona);
  }
 }

</code></pre>

<br>
<pre class="type-11 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testVerifyAccessDeniedForInvalidUserAuths() throws Exception {
  PrivilegedExceptionAction<VisibilityLabelsResponse> action=new PrivilegedExceptionAction<VisibilityLabelsResponse>(){
    @Override public VisibilityLabelsResponse run() throws Exception {
      try (Connection conn=ConnectionFactory.createConnection(conf)){
        return VisibilityClient.setAuths(conn,new String[]{TOPSECRET},USER.getShortName());
      }
 catch (      Throwable e) {
      }
      return null;
    }
  }
;
  SUPERUSER.runAs(action);
  final TableName tableName=TableName.valueOf(TEST_NAME.getMethodName());
  Admin hBaseAdmin=TEST_UTIL.getHBaseAdmin();
  HColumnDescriptor colDesc=new HColumnDescriptor(fam);
  colDesc.setMaxVersions(5);
  HTableDescriptor desc=new HTableDescriptor(tableName);
  desc.addFamily(colDesc);
  hBaseAdmin.createTable(desc);
  try {
    TEST_UTIL.getHBaseAdmin().flush(tableName);
    PrivilegedExceptionAction<Void> actiona=new PrivilegedExceptionAction<Void>(){
      @Override public Void run() throws Exception {
        try (Connection connection=ConnectionFactory.createConnection(conf);Table table=connection.getTable(tableName)){
          Put p=new Put(row1);
          p.setCellVisibility(new CellVisibility(PUBLIC + "&" + TOPSECRET));
          p.addColumn(fam,qual,125l,value);
          table.put(p);
          Assert.fail("Testcase should fail with AccesDeniedException");
        }
 catch (        Throwable t) {
          assertTrue(t.getMessage().contains("AccessDeniedException"));
        }
        return null;
      }
    }
;
    USER.runAs(actiona);
  }
 catch (  Exception e) {
    throw new IOException(e);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.security.visibility.TestWithDisabledAuthorization </h4><pre class="type-4 type-11 type-7 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=180000) public void testManageUserAuths() throws Throwable {
  SUPERUSER.runAs(new PrivilegedExceptionAction<Void>(){
    public Void run() throws Exception {
      try (Connection conn=ConnectionFactory.createConnection(conf)){
        VisibilityClient.setAuths(conn,new String[]{SECRET,CONFIDENTIAL},USER_RW.getShortName());
      }
 catch (      Throwable t) {
        fail("Should not have failed");
      }
      return null;
    }
  }
);
  PrivilegedExceptionAction<List<String>> getAuths=new PrivilegedExceptionAction<List<String>>(){
    public List<String> run() throws Exception {
      GetAuthsResponse authsResponse=null;
      try (Connection conn=ConnectionFactory.createConnection(conf)){
        authsResponse=VisibilityClient.getAuths(conn,USER_RW.getShortName());
      }
 catch (      Throwable t) {
        fail("Should not have failed");
      }
      List<String> authsList=new ArrayList<String>();
      for (      ByteString authBS : authsResponse.getAuthList()) {
        authsList.add(Bytes.toString(authBS.toByteArray()));
      }
      return authsList;
    }
  }
;
  List<String> authsList=SUPERUSER.runAs(getAuths);
  assertEquals(2,authsList.size());
  assertTrue(authsList.contains(SECRET));
  assertTrue(authsList.contains(CONFIDENTIAL));
  SUPERUSER.runAs(new PrivilegedExceptionAction<Void>(){
    public Void run() throws Exception {
      try (Connection conn=ConnectionFactory.createConnection(conf)){
        VisibilityClient.clearAuths(conn,new String[]{SECRET},USER_RW.getShortName());
      }
 catch (      Throwable t) {
        fail("Should not have failed");
      }
      return null;
    }
  }
);
  authsList=SUPERUSER.runAs(getAuths);
  assertEquals(1,authsList.size());
  assertTrue(authsList.contains(CONFIDENTIAL));
  SUPERUSER.runAs(new PrivilegedExceptionAction<Void>(){
    public Void run() throws Exception {
      try (Connection conn=ConnectionFactory.createConnection(conf)){
        VisibilityClient.clearAuths(conn,new String[]{CONFIDENTIAL},USER_RW.getShortName());
      }
 catch (      Throwable t) {
        fail("Should not have failed");
      }
      return null;
    }
  }
);
  authsList=SUPERUSER.runAs(getAuths);
  assertEquals(0,authsList.size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.snapshot.TestFlushSnapshotFromClient </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=300000) public void testSnapshotFailsOnNonExistantTable() throws Exception {
  Admin admin=UTIL.getHBaseAdmin();
  SnapshotTestingUtils.assertNoSnapshots(admin);
  TableName tableName=TableName.valueOf("_not_a_table");
  boolean fail=false;
  do {
    try {
      admin.getTableDescriptor(tableName);
      fail=true;
      LOG.error("Table:" + tableName + " already exists, checking a new name");
      tableName=TableName.valueOf(tableName + "!");
    }
 catch (    TableNotFoundException e) {
      fail=false;
    }
  }
 while (fail);
  try {
    admin.snapshot("fail",tableName,SnapshotDescription.Type.FLUSH);
    fail("Snapshot succeeded even though there is not table.");
  }
 catch (  SnapshotCreationException e) {
    LOG.info("Correctly failed to snapshot a non-existant table:" + e.getMessage());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.snapshot.TestSnapshotDescriptionUtils </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testValidateMissingTableName(){
  Configuration conf=new Configuration(false);
  try {
    SnapshotDescriptionUtils.validate(SnapshotDescription.newBuilder().setName("fail").build(),conf);
    fail("Snapshot was considered valid without a table name");
  }
 catch (  IllegalArgumentException e) {
    LOG.debug("Correctly failed when snapshot doesn't have a tablename");
  }
}

</code></pre>

<br>
<pre class="type-11 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that we throw an exception if there is no working snapshot directory when we attempt to
 * 'complete' the snapshot
 * @throws Exception on failure
 */
@Test public void testCompleteSnapshotWithNoSnapshotDirectoryFailure() throws Exception {
  Path snapshotDir=new Path(root,HConstants.SNAPSHOT_DIR_NAME);
  Path tmpDir=new Path(snapshotDir,".tmp");
  Path workingDir=new Path(tmpDir,"not_a_snapshot");
  assertFalse("Already have working snapshot dir: " + workingDir + " but shouldn't. Test file leak?",fs.exists(workingDir));
  SnapshotDescription snapshot=SnapshotDescription.newBuilder().setName("snapshot").build();
  try {
    SnapshotDescriptionUtils.completeSnapshot(snapshot,root,workingDir,fs);
    fail("Shouldn't successfully complete move of a non-existent directory.");
  }
 catch (  IOException e) {
    LOG.info("Correctly failed to move non-existant directory: " + e.getMessage());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.thrift2.TestThriftHBaseServiceHandler </h4><pre class="type-4 type-9 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testScanWithFilter() throws Exception {
  ThriftHBaseServiceHandler handler=createHandler();
  ByteBuffer table=wrap(tableAname);
  TColumnValue columnValue=new TColumnValue(wrap(familyAname),wrap(qualifierAname),wrap(valueAname));
  List<TColumnValue> columnValues=new ArrayList<TColumnValue>();
  columnValues.add(columnValue);
  for (int i=0; i < 10; i++) {
    TPut put=new TPut(wrap(("testScanWithFilter" + i).getBytes()),columnValues);
    handler.put(table,put);
  }
  TScan scan=new TScan();
  List<TColumn> columns=new ArrayList<TColumn>();
  TColumn column=new TColumn();
  column.setFamily(familyAname);
  column.setQualifier(qualifierAname);
  columns.add(column);
  scan.setColumns(columns);
  scan.setStartRow("testScanWithFilter".getBytes());
  scan.setStopRow("testScanWithFilter\uffff".getBytes());
  scan.setFilterString(wrap(("KeyOnlyFilter()").getBytes()));
  int scanId=handler.openScanner(table,scan);
  List<TResult> results=handler.getScannerRows(scanId,10);
  assertEquals(10,results.size());
  for (int i=0; i < 10; i++) {
    assertArrayEquals(("testScanWithFilter" + i).getBytes(),results.get(i).getRow());
    assertEquals(0,results.get(i).getColumnValues().get(0).getValue().length);
  }
  results=handler.getScannerRows(scanId,10);
  assertEquals(0,results.size());
  handler.closeScanner(scanId);
  try {
    handler.getScannerRows(scanId,10);
    fail("Scanner id should be invalid");
  }
 catch (  TIllegalArgument e) {
  }
}

</code></pre>

<br>
<pre class="type-4 type-9 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testScanWithBatchSize() throws Exception {
  ThriftHBaseServiceHandler handler=createHandler();
  ByteBuffer table=wrap(tableAname);
  List<TColumnValue> columnValues=new ArrayList<TColumnValue>();
  for (int i=0; i < 100; i++) {
    String colNum=pad(i,(byte)3);
    TColumnValue columnValue=new TColumnValue(wrap(familyAname),wrap(("col" + colNum).getBytes()),wrap(("val" + colNum).getBytes()));
    columnValues.add(columnValue);
  }
  TPut put=new TPut(wrap(("testScanWithBatchSize").getBytes()),columnValues);
  handler.put(table,put);
  TScan scan=new TScan();
  List<TColumn> columns=new ArrayList<TColumn>();
  TColumn column=new TColumn();
  column.setFamily(familyAname);
  columns.add(column);
  scan.setColumns(columns);
  scan.setStartRow("testScanWithBatchSize".getBytes());
  scan.setStopRow("testScanWithBatchSize\uffff".getBytes());
  scan.setBatchSize(10);
  int scanId=handler.openScanner(table,scan);
  List<TResult> results=null;
  for (int i=0; i < 10; i++) {
    results=handler.getScannerRows(scanId,1);
    assertEquals(1,results.size());
    List<TColumnValue> cols=results.get(0).getColumnValues();
    assertEquals(10,cols.size());
    for (int y=0; y < 10; y++) {
      int colNum=y + (10 * i);
      String colNumPad=pad(colNum,(byte)3);
      assertArrayEquals(("col" + colNumPad).getBytes(),cols.get(y).getQualifier());
    }
  }
  results=handler.getScannerRows(scanId,1);
  assertEquals(0,results.size());
  handler.closeScanner(scanId);
  try {
    handler.getScannerRows(scanId,1);
    fail("Scanner id should be invalid");
  }
 catch (  TIllegalArgument e) {
  }
}

</code></pre>

<br>
<pre class="type-4 type-9 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testScan() throws Exception {
  ThriftHBaseServiceHandler handler=createHandler();
  ByteBuffer table=wrap(tableAname);
  TColumnValue columnValue=new TColumnValue(wrap(familyAname),wrap(qualifierAname),wrap(valueAname));
  List<TColumnValue> columnValues=new ArrayList<TColumnValue>();
  columnValues.add(columnValue);
  for (int i=0; i < 10; i++) {
    TPut put=new TPut(wrap(("testScan" + i).getBytes()),columnValues);
    handler.put(table,put);
  }
  TScan scan=new TScan();
  List<TColumn> columns=new ArrayList<TColumn>();
  TColumn column=new TColumn();
  column.setFamily(familyAname);
  column.setQualifier(qualifierAname);
  columns.add(column);
  scan.setColumns(columns);
  scan.setStartRow("testScan".getBytes());
  scan.setStopRow("testScan\uffff".getBytes());
  int scanId=handler.openScanner(table,scan);
  List<TResult> results=handler.getScannerRows(scanId,10);
  assertEquals(10,results.size());
  for (int i=0; i < 10; i++) {
    assertArrayEquals(("testScan" + i).getBytes(),results.get(i).getRow());
  }
  results=handler.getScannerRows(scanId,10);
  assertEquals(0,results.size());
  handler.closeScanner(scanId);
  try {
    handler.getScannerRows(scanId,10);
    fail("Scanner id should be invalid");
  }
 catch (  TIllegalArgument e) {
  }
}

</code></pre>

<br>
<pre class="type-4 type-9 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReverseScan() throws Exception {
  ThriftHBaseServiceHandler handler=createHandler();
  ByteBuffer table=wrap(tableAname);
  TColumnValue columnValue=new TColumnValue(wrap(familyAname),wrap(qualifierAname),wrap(valueAname));
  List<TColumnValue> columnValues=new ArrayList<TColumnValue>();
  columnValues.add(columnValue);
  for (int i=0; i < 10; i++) {
    TPut put=new TPut(wrap(("testReverseScan" + i).getBytes()),columnValues);
    handler.put(table,put);
  }
  TScan scan=new TScan();
  scan.setReversed(true);
  List<TColumn> columns=new ArrayList<TColumn>();
  TColumn column=new TColumn();
  column.setFamily(familyAname);
  column.setQualifier(qualifierAname);
  columns.add(column);
  scan.setColumns(columns);
  scan.setStartRow("testReverseScan\uffff".getBytes());
  scan.setStopRow("testReverseScan".getBytes());
  int scanId=handler.openScanner(table,scan);
  List<TResult> results=handler.getScannerRows(scanId,10);
  assertEquals(10,results.size());
  for (int i=0; i < 10; i++) {
    assertArrayEquals(("testReverseScan" + (9 - i)).getBytes(),results.get(i).getRow());
  }
  results=handler.getScannerRows(scanId,10);
  assertEquals(0,results.size());
  handler.closeScanner(scanId);
  try {
    handler.getScannerRows(scanId,10);
    fail("Scanner id should be invalid");
  }
 catch (  TIllegalArgument e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.thrift2.TestThriftHBaseServiceHandlerWithLabels </h4><pre class="type-4 type-9 type-10 type-11 type-7 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testScanWithVisibilityLabels() throws Exception {
  ThriftHBaseServiceHandler handler=createHandler();
  ByteBuffer table=wrap(tableAname);
  TColumnValue columnValue=new TColumnValue(wrap(familyAname),wrap(qualifierAname),wrap(valueAname));
  List<TColumnValue> columnValues=new ArrayList<TColumnValue>();
  columnValues.add(columnValue);
  for (int i=0; i < 10; i++) {
    TPut put=new TPut(wrap(("testScan" + i).getBytes()),columnValues);
    if (i == 5) {
      put.setCellVisibility(new TCellVisibility().setExpression(PUBLIC));
    }
 else {
      put.setCellVisibility(new TCellVisibility().setExpression("(" + SECRET + "|"+ CONFIDENTIAL+ ")"+ "&"+ "!"+ TOPSECRET));
    }
    handler.put(table,put);
  }
  TScan scan=new TScan();
  List<TColumn> columns=new ArrayList<TColumn>();
  TColumn column=new TColumn();
  column.setFamily(familyAname);
  column.setQualifier(qualifierAname);
  columns.add(column);
  scan.setColumns(columns);
  scan.setStartRow("testScan".getBytes());
  scan.setStopRow("testScan\uffff".getBytes());
  TAuthorization tauth=new TAuthorization();
  List<String> labels=new ArrayList<String>();
  labels.add(SECRET);
  labels.add(PRIVATE);
  tauth.setLabels(labels);
  scan.setAuthorizations(tauth);
  int scanId=handler.openScanner(table,scan);
  List<TResult> results=handler.getScannerRows(scanId,10);
  assertEquals(9,results.size());
  Assert.assertFalse(Bytes.equals(results.get(5).getRow(),("testScan" + 5).getBytes()));
  for (int i=0; i < 9; i++) {
    if (i < 5) {
      assertArrayEquals(("testScan" + i).getBytes(),results.get(i).getRow());
    }
 else     if (i == 5) {
      continue;
    }
 else {
      assertArrayEquals(("testScan" + (i + 1)).getBytes(),results.get(i).getRow());
    }
  }
  results=handler.getScannerRows(scanId,9);
  assertEquals(0,results.size());
  handler.closeScanner(scanId);
  try {
    handler.getScannerRows(scanId,9);
    fail("Scanner id should be invalid");
  }
 catch (  TIllegalArgument e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.util.TestByteBufferUtils </h4><pre class="type-4 type-11 type-5 type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test copying to stream from buffer.
 */
@Test public void testMoveBufferToStream(){
  final int arrayOffset=7;
  final int initialPosition=10;
  final int endPadding=5;
  byte[] arrayWrapper=new byte[arrayOffset + initialPosition + array.length+ endPadding];
  System.arraycopy(array,0,arrayWrapper,arrayOffset + initialPosition,array.length);
  ByteBuffer buffer=ByteBuffer.wrap(arrayWrapper,arrayOffset,initialPosition + array.length).slice();
  assertEquals(initialPosition + array.length,buffer.limit());
  assertEquals(0,buffer.position());
  buffer.position(initialPosition);
  ByteArrayOutputStream bos=new ByteArrayOutputStream();
  try {
    ByteBufferUtils.moveBufferToStream(bos,buffer,array.length);
  }
 catch (  IOException e) {
    fail("IOException in testCopyToStream()");
  }
  assertArrayEquals(array,bos.toByteArray());
  assertEquals(initialPosition + array.length,buffer.position());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.util.TestCompressionTest </h4><pre class="type-11 type-8 type-13 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExceptionCaching(){
  try {
    CompressionTest.testCompression(Compression.Algorithm.LZO);
    fail();
  }
 catch (  IOException e) {
    assertNotNull(e.getCause());
  }
  try {
    CompressionTest.testCompression(Compression.Algorithm.LZO);
    fail();
  }
 catch (  IOException e) {
    assertNull(e.getCause());
  }
  assertFalse(CompressionTest.testCompression("LZO"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.util.TestConcatenatedLists </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testUnsupportedOps(){
  ConcatenatedLists<Long> c=new ConcatenatedLists<Long>();
  c.addSublist(Arrays.asList(0L,1L));
  try {
    c.add(2L);
    fail("Should throw");
  }
 catch (  UnsupportedOperationException ex) {
  }
  try {
    c.addAll(Arrays.asList(2L,3L));
    fail("Should throw");
  }
 catch (  UnsupportedOperationException ex) {
  }
  try {
    c.remove(0L);
    fail("Should throw");
  }
 catch (  UnsupportedOperationException ex) {
  }
  try {
    c.removeAll(Arrays.asList(0L,1L));
    fail("Should throw");
  }
 catch (  UnsupportedOperationException ex) {
  }
  try {
    c.clear();
    fail("Should throw");
  }
 catch (  UnsupportedOperationException ex) {
  }
  try {
    c.retainAll(Arrays.asList(0L,1L));
    fail("Should throw");
  }
 catch (  UnsupportedOperationException ex) {
  }
  Iterator<Long> iter=c.iterator();
  iter.next();
  try {
    iter.remove();
    fail("Should throw");
  }
 catch (  UnsupportedOperationException ex) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.util.TestDefaultEnvironmentEdge </h4><pre class="type-11 type-7 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetCurrentTimeUsesSystemClock(){
  DefaultEnvironmentEdge edge=new DefaultEnvironmentEdge();
  long systemTime=System.currentTimeMillis();
  long edgeTime=edge.currentTime();
  assertTrue("System time must be either the same or less than the edge time",systemTime < edgeTime || systemTime == edgeTime);
  try {
    Thread.sleep(1);
  }
 catch (  InterruptedException e) {
    fail(e.getMessage());
  }
  long secondEdgeTime=edge.currentTime();
  assertTrue("Second time must be greater than the first",secondEdgeTime > edgeTime);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.util.TestDrainBarrier </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testUnmatchedEndAssert() throws Exception {
  DrainBarrier barrier=new DrainBarrier();
  try {
    barrier.endOp();
    fail("Should have asserted");
  }
 catch (  AssertionError e) {
  }
  barrier.beginOp();
  barrier.beginOp();
  barrier.endOp();
  barrier.endOp();
  try {
    barrier.endOp();
    fail("Should have asserted");
  }
 catch (  AssertionError e) {
  }
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testMultipleStopOnceAssert() throws Exception {
  DrainBarrier barrier=new DrainBarrier();
  barrier.stopAndDrainOpsOnce();
  try {
    barrier.stopAndDrainOpsOnce();
    fail("Should have asserted");
  }
 catch (  AssertionError e) {
  }
}

</code></pre>

<br>
<pre class="type-11 type-7 type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testStopIsBlockedByOps() throws Exception {
  final DrainBarrier barrier=new DrainBarrier();
  barrier.beginOp();
  barrier.beginOp();
  barrier.beginOp();
  barrier.endOp();
  Thread stoppingThread=new Thread(new Runnable(){
    @Override public void run(){
      try {
        barrier.stopAndDrainOpsOnce();
      }
 catch (      InterruptedException e) {
        fail("Should not have happened");
      }
    }
  }
);
  stoppingThread.start();
  barrier.endOp();
  stoppingThread.join(1000);
  assertTrue(stoppingThread.isAlive());
  barrier.endOp();
  stoppingThread.join(30000);
  assertFalse(stoppingThread.isAlive());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.util.TestDynamicClassLoader </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testLoadClassFromLocalPath() throws Exception {
  ClassLoader parent=TestDynamicClassLoader.class.getClassLoader();
  DynamicClassLoader classLoader=new DynamicClassLoader(conf,parent);
  String className="TestLoadClassFromLocalPath";
  deleteClass(className);
  try {
    classLoader.loadClass(className);
    fail("Should not be able to load class " + className);
  }
 catch (  ClassNotFoundException cnfe) {
  }
  try {
    String folder=TEST_UTIL.getDataTestDir().toString();
    ClassLoaderTestHelper.buildJar(folder,className,null,ClassLoaderTestHelper.localDirPath(conf));
    classLoader.loadClass(className);
  }
 catch (  ClassNotFoundException cnfe) {
    LOG.error("Should be able to load class " + className,cnfe);
    fail(cnfe.getMessage());
  }
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testLoadClassFromLocalPathWithDynamicDirOff() throws Exception {
  conf.setBoolean("hbase.use.dynamic.jars",false);
  ClassLoader parent=TestDynamicClassLoader.class.getClassLoader();
  DynamicClassLoader classLoader=new DynamicClassLoader(conf,parent);
  String className="TestLoadClassFromLocalPath";
  deleteClass(className);
  try {
    String folder=TEST_UTIL.getDataTestDir().toString();
    ClassLoaderTestHelper.buildJar(folder,className,null,ClassLoaderTestHelper.localDirPath(conf));
    classLoader.loadClass(className);
    fail("Should not be able to load class " + className);
  }
 catch (  ClassNotFoundException cnfe) {
  }
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testLoadClassFromAnotherPath() throws Exception {
  ClassLoader parent=TestDynamicClassLoader.class.getClassLoader();
  DynamicClassLoader classLoader=new DynamicClassLoader(conf,parent);
  String className="TestLoadClassFromAnotherPath";
  deleteClass(className);
  try {
    classLoader.loadClass(className);
    fail("Should not be able to load class " + className);
  }
 catch (  ClassNotFoundException cnfe) {
  }
  try {
    String folder=TEST_UTIL.getDataTestDir().toString();
    ClassLoaderTestHelper.buildJar(folder,className,null);
    classLoader.loadClass(className);
  }
 catch (  ClassNotFoundException cnfe) {
    LOG.error("Should be able to load class " + className,cnfe);
    fail(cnfe.getMessage());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.util.TestEncryptionTest </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testTestKeyProvider(){
  Configuration conf=HBaseConfiguration.create();
  try {
    conf.set(HConstants.CRYPTO_KEYPROVIDER_CONF_KEY,KeyProviderForTesting.class.getName());
    EncryptionTest.testKeyProvider(conf);
  }
 catch (  Exception e) {
    fail("Instantiation of test key provider should have passed");
  }
  try {
    conf.set(HConstants.CRYPTO_KEYPROVIDER_CONF_KEY,FailingKeyProvider.class.getName());
    EncryptionTest.testKeyProvider(conf);
    fail("Instantiation of bad test key provider should have failed check");
  }
 catch (  Exception e) {
  }
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testTestCipherProvider(){
  Configuration conf=HBaseConfiguration.create();
  try {
    conf.set(HConstants.CRYPTO_CIPHERPROVIDER_CONF_KEY,DefaultCipherProvider.class.getName());
    EncryptionTest.testCipherProvider(conf);
  }
 catch (  Exception e) {
    fail("Instantiation of test cipher provider should have passed");
  }
  try {
    conf.set(HConstants.CRYPTO_CIPHERPROVIDER_CONF_KEY,FailingCipherProvider.class.getName());
    EncryptionTest.testCipherProvider(conf);
    fail("Instantiation of bad test cipher provider should have failed check");
  }
 catch (  Exception e) {
  }
}

</code></pre>

<br>
<pre class="type-11 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testTestCipher(){
  Configuration conf=HBaseConfiguration.create();
  conf.set(HConstants.CRYPTO_KEYPROVIDER_CONF_KEY,KeyProviderForTesting.class.getName());
  String algorithm=conf.get(HConstants.CRYPTO_KEY_ALGORITHM_CONF_KEY,HConstants.CIPHER_AES);
  try {
    EncryptionTest.testEncryption(conf,algorithm,null);
  }
 catch (  Exception e) {
    fail("Test for cipher " + algorithm + " should have succeeded");
  }
  try {
    EncryptionTest.testEncryption(conf,"foobar",null);
    fail("Test for bogus cipher should have failed");
  }
 catch (  Exception e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.util.TestFSTableDescriptors </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testReadingInvalidDirectoryFromFS() throws IOException {
  FileSystem fs=FileSystem.get(UTIL.getConfiguration());
  try {
    new FSTableDescriptors(UTIL.getConfiguration(),fs,FSUtils.getRootDir(UTIL.getConfiguration())).get(TableName.valueOf(HConstants.HBASE_TEMP_DIRECTORY));
    fail("Shouldn't be able to read a table descriptor for the archive directory.");
  }
 catch (  Exception e) {
    LOG.debug("Correctly got error when reading a table descriptor from the archive directory: " + e.getMessage());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.util.TestHBaseFsckOneRS </h4><pre class="type-9 type-10 type-11 type-7 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=180000) public void testHbckAfterRegionMerge() throws Exception {
  TableName table=TableName.valueOf("testMergeRegionFilesInHdfs");
  Table meta=null;
  try {
    TEST_UTIL.getHBaseCluster().getMaster().setCatalogJanitorEnabled(false);
    setupTable(table);
    assertEquals(ROWKEYS.length,countRows());
    try (RegionLocator rl=connection.getRegionLocator(tbl.getName())){
      admin.flush(table);
      HRegionInfo region1=rl.getRegionLocation(Bytes.toBytes("A")).getRegionInfo();
      HRegionInfo region2=rl.getRegionLocation(Bytes.toBytes("B")).getRegionInfo();
      int regionCountBeforeMerge=rl.getAllRegionLocations().size();
      assertNotEquals(region1,region2);
      admin.mergeRegions(region1.getEncodedNameAsBytes(),region2.getEncodedNameAsBytes(),false);
      long timeout=System.currentTimeMillis() + 30 * 1000;
      while (true) {
        if (rl.getAllRegionLocations().size() < regionCountBeforeMerge) {
          break;
        }
 else         if (System.currentTimeMillis() > timeout) {
          fail("Time out waiting on region " + region1.getEncodedName() + " and "+ region2.getEncodedName()+ " be merged");
        }
        Thread.sleep(10);
      }
      assertEquals(ROWKEYS.length,countRows());
      HBaseFsck hbck=doFsck(conf,false);
      assertNoErrors(hbck);
    }
   }
  finally {
    TEST_UTIL.getHBaseCluster().getMaster().setCatalogJanitorEnabled(true);
    cleanupTable(table);
    IOUtils.closeQuietly(meta);
  }
}

</code></pre>

<br>
<pre class="type-10 type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * This test makes sure that parallel instances of Hbck is disabled.
 * @throws Exception
 */
@Test(timeout=180000) public void testParallelHbck() throws Exception {
  final ExecutorService service;
  final Future<HBaseFsck> hbck1, hbck2;
class RunHbck implements Callable<HBaseFsck> {
    boolean fail=true;
    @Override public HBaseFsck call(){
      Configuration c=new Configuration(conf);
      c.setInt("hbase.hbck.lockfile.attempts",1);
      c.setInt("hbase.hbck.lockfile.maxwaittime",3);
      try {
        return doFsck(c,true);
      }
 catch (      Exception e) {
        if (e.getMessage().contains("Duplicate hbck")) {
          fail=false;
        }
      }
      if (fail)       fail();
      return null;
    }
  }
  service=Executors.newFixedThreadPool(2);
  hbck1=service.submit(new RunHbck());
  hbck2=service.submit(new RunHbck());
  service.shutdown();
  service.awaitTermination(15,TimeUnit.SECONDS);
  HBaseFsck h1=hbck1.get();
  HBaseFsck h2=hbck2.get();
  assert (h1 == null || h2 == null);
  if (h1 != null) {
    assert (h1.getRetCode() >= 0);
  }
  if (h2 != null) {
    assert (h2.getRetCode() >= 0);
  }
}

</code></pre>

<br>
<pre class="type-10 type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
/** 
 * test region boundaries and make sure store file had been created.
 * @throws Exception
 */
@Test(timeout=180000) public void testRegionBoundariesCheckWithFlushTable() throws Exception {
  HBaseFsck hbck=doFsck(conf,false);
  assertNoErrors(hbck);
  TableName table=TableName.valueOf("testRegionBoundariesCheckWithFlushTable");
  try {
    setupTable(table);
    admin.flush(table);
    hbck.connect();
    hbck.checkRegionBoundaries();
    assertNoErrors(hbck);
  }
 catch (  IllegalArgumentException e) {
    if (e.getMessage().endsWith("not a valid DFS filename.")) {
      fail("Table directory path is not valid." + e.getMessage());
    }
  }
 finally {
    hbck.close();
  }
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=180000) public void testCheckTableLocks() throws Exception {
  IncrementingEnvironmentEdge edge=new IncrementingEnvironmentEdge(0);
  EnvironmentEdgeManager.injectEdge(edge);
  HBaseFsck hbck=doFsck(conf,false);
  assertNoErrors(hbck);
  ServerName mockName=ServerName.valueOf("localhost",60000,1);
  final TableName tableName=TableName.valueOf("foo");
  final TableLockManager tableLockManager=TableLockManager.createTableLockManager(conf,TEST_UTIL.getZooKeeperWatcher(),mockName);
  TableLockManager.TableLock writeLock=tableLockManager.writeLock(tableName,"testCheckTableLocks");
  writeLock.acquire();
  hbck=doFsck(conf,false);
  assertNoErrors(hbck);
  edge.incrementTime(conf.getLong(TableLockManager.TABLE_LOCK_EXPIRE_TIMEOUT,TableLockManager.DEFAULT_TABLE_LOCK_EXPIRE_TIMEOUT_MS));
  hbck=doFsck(conf,false);
  assertErrors(hbck,new HBaseFsck.ErrorReporter.ERROR_CODE[]{HBaseFsck.ErrorReporter.ERROR_CODE.EXPIRED_TABLE_LOCK});
  final CountDownLatch latch=new CountDownLatch(1);
  new Thread(){
    @Override public void run(){
      TableLockManager.TableLock readLock=tableLockManager.writeLock(tableName,"testCheckTableLocks");
      try {
        latch.countDown();
        readLock.acquire();
      }
 catch (      IOException ex) {
        fail();
      }
catch (      IllegalStateException ex) {
        return;
      }
      fail("should not have come here");
    }
  }
.start();
  latch.await();
  Threads.sleep(300);
  hbck=doFsck(conf,false);
  assertErrors(hbck,new HBaseFsck.ErrorReporter.ERROR_CODE[]{HBaseFsck.ErrorReporter.ERROR_CODE.EXPIRED_TABLE_LOCK});
  edge.incrementTime(conf.getLong(TableLockManager.TABLE_LOCK_EXPIRE_TIMEOUT,TableLockManager.DEFAULT_TABLE_LOCK_EXPIRE_TIMEOUT_MS));
  hbck=doFsck(conf,false);
  assertErrors(hbck,new HBaseFsck.ErrorReporter.ERROR_CODE[]{HBaseFsck.ErrorReporter.ERROR_CODE.EXPIRED_TABLE_LOCK,HBaseFsck.ErrorReporter.ERROR_CODE.EXPIRED_TABLE_LOCK});
  conf.setLong(TableLockManager.TABLE_LOCK_EXPIRE_TIMEOUT,1);
  Threads.sleep(10);
  hbck=doFsck(conf,true);
  hbck=doFsck(conf,false);
  assertNoErrors(hbck);
  writeLock=tableLockManager.writeLock(tableName,"should acquire without blocking");
  writeLock.acquire();
  writeLock.release();
  tableLockManager.tableDeleted(tableName);
}

</code></pre>

<br>
<pre class="type-10 type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=180000) public void testRegionBoundariesCheck() throws Exception {
  HBaseFsck hbck=doFsck(conf,false);
  assertNoErrors(hbck);
  try {
    hbck.connect();
    hbck.checkRegionBoundaries();
  }
 catch (  IllegalArgumentException e) {
    if (e.getMessage().endsWith("not a valid DFS filename.")) {
      fail("Table directory path is not valid." + e.getMessage());
    }
  }
 finally {
    hbck.close();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.util.TestOrderedBytes </h4><pre class="type-11 type-5 type-17 type-12 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Verifies that exceptions are thrown during the test case execution
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Assert invalid input byte[] are rejected by BlobCopy
 */
@Test(expected=IllegalArgumentException.class) public void testBlobCopyNoZeroBytes(){
  byte[] val={0x01,0x02,0x00,0x03};
  byte[] ascExpected={0x38,0x01,0x02,0x00,0x03};
  PositionedByteRange buf=new SimplePositionedMutableByteRange(val.length + 1);
  OrderedBytes.encodeBlobCopy(buf,val,Order.ASCENDING);
  assertArrayEquals(ascExpected,buf.getBytes());
  buf.set(val.length + 2);
  OrderedBytes.encodeBlobCopy(buf,val,Order.DESCENDING);
  fail("test should never get here.");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.util.TestSortedList </h4><pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testReadOnlyIterators() throws Exception {
  SortedList<String> list=new SortedList<String>(Lists.newArrayList("a","b","c","d","e"),new StringComparator());
  Iterator<String> i=list.iterator();
  i.next();
  try {
    i.remove();
    fail("Iterator should have thrown an exception");
  }
 catch (  UnsupportedOperationException e) {
  }
  ListIterator<String> li=list.listIterator();
  li.next();
  try {
    li.add("a");
    fail("Iterator should have thrown an exception");
  }
 catch (  UnsupportedOperationException e) {
  }
  try {
    li.set("b");
    fail("Iterator should have thrown an exception");
  }
 catch (  UnsupportedOperationException e) {
  }
  try {
    li.remove();
    fail("Iterator should have thrown an exception");
  }
 catch (  UnsupportedOperationException e) {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.util.TestTableName </h4><pre class="type-11 type-17 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyTableName(){
  for (  String tn : emptyNames) {
    TableName.isLegalFullyQualifiedTableName(Bytes.toBytes(tn));
    fail("invalid tablename " + tn + " should have failed with IllegalArgumentException");
  }
}

</code></pre>

<br>
<pre class="type-11 type-17 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testInvalidNamespace(){
  for (  String tn : invalidNamespace) {
    TableName.isLegalFullyQualifiedTableName(Bytes.toBytes(tn));
    fail("invalid namespace " + tn + " should have failed with IllegalArgumentException for namespace");
  }
}

</code></pre>

<br>
<pre class="type-11 type-17 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testEmptyNamespaceName(){
  for (  String nn : emptyNames) {
    TableName.isLegalNamespaceName(Bytes.toBytes(nn));
    fail("invalid Namespace name " + nn + " should have failed with IllegalArgumentException");
  }
}

</code></pre>

<br>
<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testIllegalHTableNames(){
  for (  String tn : illegalTableNames) {
    try {
      TableName.isLegalFullyQualifiedTableName(Bytes.toBytes(tn));
      fail("invalid tablename " + tn + " should have failed");
    }
 catch (    Exception e) {
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.util.TestWeakObjectPool </h4><pre class="type-10 type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=1000) public void testCongestion() throws Exception {
  final int THREAD_COUNT=100;
  final AtomicBoolean assertionFailed=new AtomicBoolean();
  final AtomicReference expectedObjRef=new AtomicReference();
  final CountDownLatch prepareLatch=new CountDownLatch(THREAD_COUNT);
  final CountDownLatch startLatch=new CountDownLatch(1);
  final CountDownLatch endLatch=new CountDownLatch(THREAD_COUNT);
  for (int i=0; i < THREAD_COUNT; i++) {
    new Thread(){
      @Override public void run(){
        prepareLatch.countDown();
        try {
          startLatch.await();
          Object obj=pool.get("a");
          if (!expectedObjRef.compareAndSet(null,obj)) {
            if (expectedObjRef.get() != obj) {
              assertionFailed.set(true);
            }
          }
        }
 catch (        Exception e) {
          assertionFailed.set(true);
        }
 finally {
          endLatch.countDown();
        }
      }
    }
.start();
  }
  prepareLatch.await();
  startLatch.countDown();
  endLatch.await();
  if (assertionFailed.get()) {
    Assert.fail();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.hbase.wal.TestWALFactory </h4><pre class="type-11 type-7 type-8 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test new HDFS-265 sync.
 * @throws Exception
 */
@Test public void Broken_testSync() throws Exception {
  TableName tableName=TableName.valueOf(currentTest.getMethodName());
  MultiVersionConcurrencyControl mvcc=new MultiVersionConcurrencyControl(1);
  Path p=new Path(dir,currentTest.getMethodName() + ".fsdos");
  FSDataOutputStream out=fs.create(p);
  out.write(tableName.getName());
  Method syncMethod=null;
  try {
    syncMethod=out.getClass().getMethod("hflush",new Class<?>[]{});
  }
 catch (  NoSuchMethodException e) {
    try {
      syncMethod=out.getClass().getMethod("sync",new Class<?>[]{});
    }
 catch (    NoSuchMethodException ex) {
      fail("This version of Hadoop supports neither Syncable.sync() " + "nor Syncable.hflush().");
    }
  }
  syncMethod.invoke(out,new Object[]{});
  FSDataInputStream in=fs.open(p);
  assertTrue(in.available() > 0);
  byte[] buffer=new byte[1024];
  int read=in.read(buffer);
  assertEquals(tableName.getName().length,read);
  out.close();
  in.close();
  final int total=20;
  WAL.Reader reader=null;
  try {
    HRegionInfo info=new HRegionInfo(tableName,null,null,false);
    HTableDescriptor htd=new HTableDescriptor(tableName);
    htd.addFamily(new HColumnDescriptor(tableName.getName()));
    final WAL wal=wals.getWAL(info.getEncodedNameAsBytes(),info.getTable().getNamespace());
    for (int i=0; i < total; i++) {
      WALEdit kvs=new WALEdit();
      kvs.add(new KeyValue(Bytes.toBytes(i),tableName.getName(),tableName.getName()));
      wal.append(htd,info,new WALKey(info.getEncodedNameAsBytes(),tableName,System.currentTimeMillis(),mvcc),kvs,true);
    }
    wal.sync();
    Path walPath=DefaultWALProvider.getCurrentFileName(wal);
    reader=wals.createReader(fs,walPath);
    int count=0;
    WAL.Entry entry=new WAL.Entry();
    while ((entry=reader.next(entry)) != null)     count++;
    assertEquals(total,count);
    reader.close();
    for (int i=0; i < total; i++) {
      WALEdit kvs=new WALEdit();
      kvs.add(new KeyValue(Bytes.toBytes(i),tableName.getName(),tableName.getName()));
      wal.append(htd,info,new WALKey(info.getEncodedNameAsBytes(),tableName,System.currentTimeMillis(),mvcc),kvs,true);
    }
    wal.sync();
    reader=wals.createReader(fs,walPath);
    count=0;
    while ((entry=reader.next(entry)) != null)     count++;
    assertTrue(count >= total);
    reader.close();
    wal.sync();
    reader=wals.createReader(fs,walPath);
    count=0;
    while ((entry=reader.next(entry)) != null)     count++;
    assertEquals(total * 2,count);
    reader.close();
    final byte[] value=new byte[1025 * 1024];
    for (int i=0; i < total; i++) {
      WALEdit kvs=new WALEdit();
      kvs.add(new KeyValue(Bytes.toBytes(i),tableName.getName(),value));
      wal.append(htd,info,new WALKey(info.getEncodedNameAsBytes(),tableName,System.currentTimeMillis(),mvcc),kvs,true);
    }
    wal.sync();
    reader=wals.createReader(fs,walPath);
    count=0;
    while ((entry=reader.next(entry)) != null)     count++;
    assertEquals(total * 3,count);
    reader.close();
    wal.shutdown();
    reader=wals.createReader(fs,walPath);
    count=0;
    while ((entry=reader.next(entry)) != null)     count++;
    assertEquals(total * 3,count);
    reader.close();
  }
  finally {
    if (reader != null)     reader.close();
  }
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
