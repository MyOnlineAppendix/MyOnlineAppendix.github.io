<h3 style="margin:0px">Class: org.apache.sling.launchpad.webapp.integrationtest.accessManager.ModifyAceTest (17 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(15)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(15)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(14)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(14)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="16"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('16')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-16"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-16 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void cleanup() throws Exception {
  H.tearDown();
  Credentials creds=new UsernamePasswordCredentials("admin","admin");
  if (testFolderUrl != null) {
    String postUrl=testFolderUrl;
    List<NameValuePair> postParams=new ArrayList<NameValuePair>();
    postParams.add(new NameValuePair(":operation","delete"));
    H.assertAuthenticatedPostStatus(creds,postUrl,HttpServletResponse.SC_OK,postParams,null);
  }
  if (testGroupId != null) {
    String postUrl=HttpTest.HTTP_BASE_URL + "/system/userManager/group/" + testGroupId+ ".delete.html";
    List<NameValuePair> postParams=new ArrayList<NameValuePair>();
    H.assertAuthenticatedPostStatus(creds,postUrl,HttpServletResponse.SC_OK,postParams,null);
  }
  if (testUserId != null) {
    String postUrl=HttpTest.HTTP_BASE_URL + "/system/userManager/user/" + testUserId+ ".delete.html";
    List<NameValuePair> postParams=new ArrayList<NameValuePair>();
    H.assertAuthenticatedPostStatus(creds,postUrl,HttpServletResponse.SC_OK,postParams,null);
  }
  if (testUserId2 != null) {
    String postUrl=HttpTest.HTTP_BASE_URL + "/system/userManager/user/" + testUserId2+ ".delete.html";
    List<NameValuePair> postParams=new ArrayList<NameValuePair>();
    H.assertAuthenticatedPostStatus(creds,postUrl,HttpServletResponse.SC_OK,postParams,null);
  }
}

</code></pre>

<pre class="type-9 type-3 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test to verify adding an ACE after an existing ACE 
 * the ACL
 */
@Test public void testAddAceOrderByAfter() throws IOException, JSONException {
  createAceOrderTestFolderWithOneAce();
  testGroupId=H.createTestGroup();
  addOrUpdateAce(testFolderUrl,testGroupId,true,"after " + testUserId);
  String getUrl=testFolderUrl + ".acl.json";
  Credentials creds=new UsernamePasswordCredentials("admin","admin");
  String json=H.getAuthenticatedContent(creds,getUrl,HttpTest.CONTENT_TYPE_JSON,null,HttpServletResponse.SC_OK);
  assertNotNull(json);
  JSONObject jsonObject=new JSONObject(json);
  assertEquals(2,jsonObject.length());
  JSONObject user=jsonObject.getJSONObject(testUserId);
  assertNotNull(user);
  assertEquals(testUserId,user.getString("principal"));
  assertEquals(0,user.getInt("order"));
  JSONObject group=jsonObject.getJSONObject(testGroupId);
  assertNotNull(group);
  assertEquals(testGroupId,group.getString("principal"));
  assertEquals(1,group.getInt("order"));
}

</code></pre>

<pre class="type-9 type-3 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for SLING-997, preserve privileges that were not posted with the modifyAce 
 * request.
 */
@Test public void testMergeAceForUser() throws IOException, JSONException {
  testUserId=H.createTestUser();
  testFolderUrl=H.createTestFolder();
  String postUrl=testFolderUrl + ".modifyAce.html";
  List<NameValuePair> postParams=new ArrayList<NameValuePair>();
  postParams.add(new NameValuePair("principalId",testUserId));
  postParams.add(new NameValuePair("privilege@jcr:read","granted"));
  postParams.add(new NameValuePair("privilege@jcr:readAccessControl","granted"));
  postParams.add(new NameValuePair("privilege@jcr:addChildNodes","granted"));
  postParams.add(new NameValuePair("privilege@jcr:modifyAccessControl","denied"));
  postParams.add(new NameValuePair("privilege@jcr:removeChildNodes","denied"));
  Credentials creds=new UsernamePasswordCredentials("admin","admin");
  H.assertAuthenticatedPostStatus(creds,postUrl,HttpServletResponse.SC_OK,postParams,null);
  String getUrl=testFolderUrl + ".acl.json";
  String json=H.getAuthenticatedContent(creds,getUrl,HttpTest.CONTENT_TYPE_JSON,null,HttpServletResponse.SC_OK);
  assertNotNull(json);
  JSONObject jsonObject=new JSONObject(json);
  assertEquals(1,jsonObject.length());
  JSONObject aceObject=jsonObject.optJSONObject(testUserId);
  assertNotNull(aceObject);
  String principalString=aceObject.optString("principal");
  assertEquals(testUserId,principalString);
  int order=aceObject.optInt("order");
  assertEquals(0,order);
  JSONArray grantedArray=aceObject.optJSONArray("granted");
  assertNotNull(grantedArray);
  assertEquals(3,grantedArray.length());
  Set<String> grantedPrivilegeNames=new HashSet<String>();
  for (int i=0; i < grantedArray.length(); i++) {
    grantedPrivilegeNames.add(grantedArray.getString(i));
  }
  H.assertPrivilege(grantedPrivilegeNames,true,"jcr:read");
  H.assertPrivilege(grantedPrivilegeNames,true,"jcr:readAccessControl");
  H.assertPrivilege(grantedPrivilegeNames,true,"jcr:addChildNodes");
  JSONArray deniedArray=aceObject.optJSONArray("denied");
  assertNotNull(deniedArray);
  assertEquals(2,deniedArray.length());
  Set<String> deniedPrivilegeNames=new HashSet<String>();
  for (int i=0; i < deniedArray.length(); i++) {
    deniedPrivilegeNames.add(deniedArray.getString(i));
  }
  H.assertPrivilege(deniedPrivilegeNames,true,"jcr:modifyAccessControl");
  H.assertPrivilege(deniedPrivilegeNames,true,"jcr:removeChildNodes");
  List<NameValuePair> postParams2=new ArrayList<NameValuePair>();
  postParams2.add(new NameValuePair("principalId",testUserId));
  postParams2.add(new NameValuePair("privilege@jcr:readAccessControl","none"));
  postParams2.add(new NameValuePair("privilege@jcr:modifyProperties","granted"));
  postParams2.add(new NameValuePair("privilege@jcr:modifyAccessControl","denied"));
  postParams2.add(new NameValuePair("privilege@jcr:removeChildNodes","none"));
  postParams2.add(new NameValuePair("privilege@jcr:removeNode","denied"));
  H.assertAuthenticatedPostStatus(creds,postUrl,HttpServletResponse.SC_OK,postParams2,null);
  String json2=H.getAuthenticatedContent(creds,getUrl,HttpTest.CONTENT_TYPE_JSON,null,HttpServletResponse.SC_OK);
  assertNotNull(json2);
  JSONObject jsonObject2=new JSONObject(json2);
  assertEquals(1,jsonObject2.length());
  JSONObject aceObject2=jsonObject2.optJSONObject(testUserId);
  assertNotNull(aceObject2);
  String principalString2=aceObject2.optString("principal");
  assertEquals(testUserId,principalString2);
  JSONArray grantedArray2=aceObject2.optJSONArray("granted");
  assertNotNull(grantedArray2);
  assertEquals(3,grantedArray2.length());
  Set<String> grantedPrivilegeNames2=new HashSet<String>();
  for (int i=0; i < grantedArray2.length(); i++) {
    grantedPrivilegeNames2.add(grantedArray2.getString(i));
  }
  H.assertPrivilege(grantedPrivilegeNames2,true,"jcr:read");
  H.assertPrivilege(grantedPrivilegeNames2,true,"jcr:addChildNodes");
  H.assertPrivilege(grantedPrivilegeNames2,true,"jcr:modifyProperties");
  JSONArray deniedArray2=aceObject2.optJSONArray("denied");
  assertNotNull(deniedArray2);
  assertEquals(2,deniedArray2.length());
  Set<String> deniedPrivilegeNames2=new HashSet<String>();
  for (int i=0; i < deniedArray2.length(); i++) {
    deniedPrivilegeNames2.add(deniedArray2.getString(i));
  }
  H.assertPrivilege(deniedPrivilegeNames2,true,"jcr:modifyAccessControl");
  H.assertPrivilege(deniedPrivilegeNames2,true,"jcr:removeNode");
}

</code></pre>

<pre class="type-9 type-3 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test to verify adding an ACE at a specific index inside 
 * the ACL
 */
@Test public void testAddAceOrderByNumeric() throws IOException, JSONException {
  createAceOrderTestFolderWithOneAce();
  testGroupId=H.createTestGroup();
  addOrUpdateAce(testFolderUrl,testGroupId,true,"0");
  String getUrl=testFolderUrl + ".acl.json";
  Credentials creds=new UsernamePasswordCredentials("admin","admin");
  String json=H.getAuthenticatedContent(creds,getUrl,HttpTest.CONTENT_TYPE_JSON,null,HttpServletResponse.SC_OK);
  assertNotNull(json);
  JSONObject jsonObject=new JSONObject(json);
  assertEquals(2,jsonObject.length());
  JSONObject group=jsonObject.getJSONObject(testGroupId);
  assertNotNull(group);
  assertEquals(testGroupId,group.getString("principal"));
  assertEquals(0,group.getInt("order"));
  JSONObject user=jsonObject.getJSONObject(testUserId);
  assertNotNull(user);
  assertEquals(testUserId,user.getString("principal"));
  assertEquals(1,user.getInt("order"));
  testUserId2=H.createTestUser();
  addOrUpdateAce(testFolderUrl,testUserId2,true,"1");
  String json2=H.getAuthenticatedContent(creds,getUrl,HttpTest.CONTENT_TYPE_JSON,null,HttpServletResponse.SC_OK);
  assertNotNull(json2);
  JSONObject jsonObject2=new JSONObject(json2);
  assertEquals(3,jsonObject2.length());
  JSONObject group2=jsonObject2.getJSONObject(testGroupId);
  assertNotNull(group2);
  assertEquals(testGroupId,group2.getString("principal"));
  assertEquals(0,group2.getInt("order"));
  JSONObject user3=jsonObject2.getJSONObject(testUserId2);
  assertNotNull(user3);
  assertEquals(testUserId2,user3.getString("principal"));
  assertEquals(1,user3.getInt("order"));
  JSONObject user2=jsonObject2.getJSONObject(testUserId);
  assertNotNull(user2);
  assertEquals(testUserId,user2.getString("principal"));
  assertEquals(2,user2.getInt("order"));
}

</code></pre>

<pre class="type-9 type-3 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for SLING-997, preserve privileges that were not posted with the modifyAce 
 * request.
 */
@Test public void testMergeAceForUserCombineAggregatePrivilege() throws IOException, JSONException {
  testUserId=H.createTestUser();
  testFolderUrl=H.createTestFolder();
  String postUrl=testFolderUrl + ".modifyAce.html";
  List<NameValuePair> postParams=new ArrayList<NameValuePair>();
  postParams.add(new NameValuePair("principalId",testUserId));
  postParams.add(new NameValuePair("privilege@jcr:read","granted"));
  postParams.add(new NameValuePair("privilege@jcr:removeNode","denied"));
  Credentials creds=new UsernamePasswordCredentials("admin","admin");
  H.assertAuthenticatedPostStatus(creds,postUrl,HttpServletResponse.SC_OK,postParams,null);
  String getUrl=testFolderUrl + ".acl.json";
  String json=H.getAuthenticatedContent(creds,getUrl,HttpTest.CONTENT_TYPE_JSON,null,HttpServletResponse.SC_OK);
  assertNotNull(json);
  JSONObject jsonObject=new JSONObject(json);
  assertEquals(1,jsonObject.length());
  JSONObject aceObject=jsonObject.optJSONObject(testUserId);
  assertNotNull(aceObject);
  assertEquals(testUserId,aceObject.optString("principal"));
  JSONArray grantedArray=aceObject.getJSONArray("granted");
  assertNotNull(grantedArray);
  assertEquals(1,grantedArray.length());
  Set<String> grantedPrivilegeNames=new HashSet<String>();
  for (int i=0; i < grantedArray.length(); i++) {
    grantedPrivilegeNames.add(grantedArray.getString(i));
  }
  H.assertPrivilege(grantedPrivilegeNames,true,"jcr:read");
  JSONArray deniedArray=aceObject.getJSONArray("denied");
  assertNotNull(deniedArray);
  assertEquals(1,deniedArray.length());
  Set<String> deniedPrivilegeNames=new HashSet<String>();
  for (int i=0; i < deniedArray.length(); i++) {
    deniedPrivilegeNames.add(deniedArray.getString(i));
  }
  H.assertPrivilege(deniedPrivilegeNames,true,"jcr:removeNode");
  List<NameValuePair> postParams2=new ArrayList<NameValuePair>();
  postParams2.add(new NameValuePair("principalId",testUserId));
  postParams2.add(new NameValuePair("privilege@jcr:write","denied"));
  H.assertAuthenticatedPostStatus(creds,postUrl,HttpServletResponse.SC_OK,postParams2,null);
  String json2=H.getAuthenticatedContent(creds,getUrl,HttpTest.CONTENT_TYPE_JSON,null,HttpServletResponse.SC_OK);
  assertNotNull(json2);
  JSONObject jsonObject2=new JSONObject(json2);
  assertEquals(1,jsonObject2.length());
  JSONObject aceObject2=jsonObject2.optJSONObject(testUserId);
  assertNotNull(aceObject2);
  assertEquals(testUserId,aceObject.optString("principal"));
  JSONArray grantedArray2=aceObject2.optJSONArray("granted");
  assertNotNull(grantedArray2);
  assertEquals(1,grantedArray2.length());
  Set<String> grantedPrivilegeNames2=new HashSet<String>();
  for (int i=0; i < grantedArray2.length(); i++) {
    grantedPrivilegeNames2.add(grantedArray2.getString(i));
  }
  H.assertPrivilege(grantedPrivilegeNames2,true,"jcr:read");
  JSONArray deniedArray2=aceObject2.optJSONArray("denied");
  assertNotNull(deniedArray2);
  assertEquals(1,deniedArray2.length());
  Set<String> deniedPrivilegeNames2=new HashSet<String>();
  for (int i=0; i < deniedArray2.length(); i++) {
    deniedPrivilegeNames2.add(deniedArray2.getString(i));
  }
  H.assertPrivilege(deniedPrivilegeNames2,true,"jcr:write");
}

</code></pre>

<pre class="type-9 type-3 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test to verify adding an ACE in the first position of 
 * the ACL
 */
@Test public void testAddAceOrderByFirst() throws IOException, JSONException {
  createAceOrderTestFolderWithOneAce();
  testGroupId=H.createTestGroup();
  addOrUpdateAce(testFolderUrl,testGroupId,true,"first");
  String getUrl=testFolderUrl + ".acl.json";
  Credentials creds=new UsernamePasswordCredentials("admin","admin");
  String json=H.getAuthenticatedContent(creds,getUrl,HttpTest.CONTENT_TYPE_JSON,null,HttpServletResponse.SC_OK);
  assertNotNull(json);
  JSONObject jsonObject=new JSONObject(json);
  assertEquals(2,jsonObject.length());
  JSONObject group=jsonObject.getJSONObject(testGroupId);
  assertNotNull(group);
  assertEquals(testGroupId,group.getString("principal"));
  assertEquals(0,group.getInt("order"));
  JSONObject user=jsonObject.getJSONObject(testUserId);
  assertNotNull(user);
  assertEquals(testUserId,user.getString("principal"));
  assertEquals(1,user.getInt("order"));
}

</code></pre>

<pre class="type-9 type-3 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for SLING-3010
 */
@Test public void testMergeAceForUserGrantNestedAggregatePrivilegeAfterDenySuperAggregatePrivilege() throws IOException, JSONException {
  testUserId=H.createTestUser();
  testFolderUrl=H.createTestFolder();
  String postUrl=testFolderUrl + ".modifyAce.json";
  List<NameValuePair> postParams=new ArrayList<NameValuePair>();
  postParams.add(new NameValuePair("principalId",testUserId));
  postParams.add(new NameValuePair("privilege@jcr:versionManagement","denied"));
  postParams.add(new NameValuePair("privilege@jcr:read","denied"));
  postParams.add(new NameValuePair("privilege@jcr:modifyAccessControl","denied"));
  postParams.add(new NameValuePair("privilege@rep:write","denied"));
  Credentials creds=new UsernamePasswordCredentials("admin","admin");
  H.getAuthenticatedPostContent(creds,postUrl,HttpTest.CONTENT_TYPE_JSON,postParams,HttpServletResponse.SC_OK);
  postParams=new ArrayList<NameValuePair>();
  postParams.add(new NameValuePair("principalId",testUserId));
  postParams.add(new NameValuePair("privilege@jcr:versionManagement","granted"));
  postParams.add(new NameValuePair("privilege@jcr:read","granted"));
  postParams.add(new NameValuePair("privilege@jcr:modifyAccessControl","granted"));
  postParams.add(new NameValuePair("privilege@jcr:write","granted"));
  H.getAuthenticatedPostContent(creds,postUrl,HttpTest.CONTENT_TYPE_JSON,postParams,HttpServletResponse.SC_OK);
  String getUrl=testFolderUrl + ".acl.json";
  String json=H.getAuthenticatedContent(creds,getUrl,HttpTest.CONTENT_TYPE_JSON,null,HttpServletResponse.SC_OK);
  assertNotNull(json);
  JSONObject jsonObject=new JSONObject(json);
  assertEquals(1,jsonObject.length());
  JSONObject aceObject=jsonObject.optJSONObject(testUserId);
  assertNotNull(aceObject);
  assertEquals(testUserId,aceObject.optString("principal"));
  JSONArray grantedArray=aceObject.getJSONArray("granted");
  assertNotNull(grantedArray);
  assertEquals(4,grantedArray.length());
  Set<String> grantedPrivilegeNames=new HashSet<String>();
  for (int i=0; i < grantedArray.length(); i++) {
    grantedPrivilegeNames.add(grantedArray.getString(i));
  }
  H.assertPrivilege(grantedPrivilegeNames,true,"jcr:versionManagement");
  H.assertPrivilege(grantedPrivilegeNames,true,"jcr:read");
  H.assertPrivilege(grantedPrivilegeNames,true,"jcr:modifyAccessControl");
  H.assertPrivilege(grantedPrivilegeNames,true,"jcr:write");
  JSONArray deniedArray=aceObject.getJSONArray("denied");
  assertNotNull(deniedArray);
  assertEquals(1,deniedArray.length());
  Set<String> deniedPrivilegeNames=new HashSet<String>();
  for (int i=0; i < deniedArray.length(); i++) {
    deniedPrivilegeNames.add(deniedArray.getString(i));
  }
  H.assertPrivilege(deniedPrivilegeNames,true,"jcr:nodeTypeManagement");
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void setup() throws Exception {
  H.setUp();
}

</code></pre>

<pre class="type-9 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
/** 
 * Test for SLING-1677
 */
@Test public void testModifyAceResponseAsJSON() throws IOException, JSONException {
  testUserId=H.createTestUser();
  testFolderUrl=H.createTestFolder();
  String postUrl=testFolderUrl + ".modifyAce.json";
  List<NameValuePair> postParams=new ArrayList<NameValuePair>();
  postParams.add(new NameValuePair("principalId",testUserId));
  postParams.add(new NameValuePair("privilege@jcr:read","granted"));
  postParams.add(new NameValuePair("privilege@jcr:write","denied"));
  postParams.add(new NameValuePair("privilege@jcr:modifyAccessControl","bogus"));
  Credentials creds=new UsernamePasswordCredentials("admin","admin");
  String json=H.getAuthenticatedPostContent(creds,postUrl,HttpTest.CONTENT_TYPE_JSON,postParams,HttpServletResponse.SC_OK);
  JSONObject jsonObject=new JSONObject(json);
  assertNotNull(jsonObject);
}

</code></pre>

<pre class="type-9 type-3 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testModifyAceForUser() throws IOException, JSONException {
  testUserId=H.createTestUser();
  testFolderUrl=H.createTestFolder();
  String postUrl=testFolderUrl + ".modifyAce.html";
  List<NameValuePair> postParams=new ArrayList<NameValuePair>();
  postParams.add(new NameValuePair("principalId",testUserId));
  postParams.add(new NameValuePair("privilege@jcr:read","granted"));
  postParams.add(new NameValuePair("privilege@jcr:write","denied"));
  postParams.add(new NameValuePair("privilege@jcr:modifyAccessControl","bogus"));
  Credentials creds=new UsernamePasswordCredentials("admin","admin");
  H.assertAuthenticatedPostStatus(creds,postUrl,HttpServletResponse.SC_OK,postParams,null);
  String getUrl=testFolderUrl + ".acl.json";
  String json=H.getAuthenticatedContent(creds,getUrl,HttpTest.CONTENT_TYPE_JSON,null,HttpServletResponse.SC_OK);
  assertNotNull(json);
  JSONObject jsonObject=new JSONObject(json);
  assertEquals(1,jsonObject.length());
  JSONObject aceObject=jsonObject.optJSONObject(testUserId);
  assertNotNull(aceObject);
  String principalString=aceObject.optString("principal");
  assertEquals(testUserId,principalString);
  int order=aceObject.optInt("order");
  assertEquals(0,order);
  JSONArray grantedArray=aceObject.optJSONArray("granted");
  assertNotNull(grantedArray);
  assertEquals(1,grantedArray.length());
  assertEquals("jcr:read",grantedArray.getString(0));
  JSONArray deniedArray=aceObject.optJSONArray("denied");
  assertNotNull(deniedArray);
  assertEquals(1,deniedArray.length());
  assertEquals("jcr:write",deniedArray.getString(0));
}

</code></pre>

<pre class="type-9 type-3 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for SLING-3010
 */
@Test public void testMergeAceForUserGrantAggregatePrivilegePartsAfterDenyAggregatePrivilege() throws IOException, JSONException {
  testUserId=H.createTestUser();
  testFolderUrl=H.createTestFolder();
  String postUrl=testFolderUrl + ".modifyAce.json";
  List<NameValuePair> postParams=new ArrayList<NameValuePair>();
  postParams.add(new NameValuePair("principalId",testUserId));
  postParams.add(new NameValuePair("privilege@jcr:versionManagement","denied"));
  postParams.add(new NameValuePair("privilege@jcr:read","denied"));
  postParams.add(new NameValuePair("privilege@jcr:modifyAccessControl","denied"));
  postParams.add(new NameValuePair("privilege@rep:write","denied"));
  Credentials creds=new UsernamePasswordCredentials("admin","admin");
  H.getAuthenticatedPostContent(creds,postUrl,HttpTest.CONTENT_TYPE_JSON,postParams,HttpServletResponse.SC_OK);
  postParams=new ArrayList<NameValuePair>();
  postParams.add(new NameValuePair("principalId",testUserId));
  postParams.add(new NameValuePair("privilege@jcr:versionManagement","granted"));
  postParams.add(new NameValuePair("privilege@jcr:read","granted"));
  postParams.add(new NameValuePair("privilege@jcr:modifyAccessControl","granted"));
  postParams.add(new NameValuePair("privilege@jcr:nodeTypeManagement","granted"));
  postParams.add(new NameValuePair("privilege@jcr:write","granted"));
  H.getAuthenticatedPostContent(creds,postUrl,HttpTest.CONTENT_TYPE_JSON,postParams,HttpServletResponse.SC_OK);
  String getUrl=testFolderUrl + ".acl.json";
  String json=H.getAuthenticatedContent(creds,getUrl,HttpTest.CONTENT_TYPE_JSON,null,HttpServletResponse.SC_OK);
  assertNotNull(json);
  JSONObject jsonObject=new JSONObject(json);
  assertEquals(1,jsonObject.length());
  JSONObject aceObject=jsonObject.optJSONObject(testUserId);
  assertNotNull(aceObject);
  assertEquals(testUserId,aceObject.optString("principal"));
  JSONArray grantedArray=aceObject.getJSONArray("granted");
  assertNotNull(grantedArray);
  Set<String> grantedPrivilegeNames=new HashSet<String>();
  for (int i=0; i < grantedArray.length(); i++) {
    grantedPrivilegeNames.add(grantedArray.getString(i));
  }
  H.assertPrivilege(grantedPrivilegeNames,true,"jcr:versionManagement");
  H.assertPrivilege(grantedPrivilegeNames,true,"jcr:read");
  H.assertPrivilege(grantedPrivilegeNames,true,"jcr:modifyAccessControl");
  H.assertPrivilege(grantedPrivilegeNames,true,"rep:write");
  assertEquals("Expecting the correct number of privileges in " + grantedPrivilegeNames,4,grantedPrivilegeNames.size());
  JSONArray deniedArray=aceObject.optJSONArray("denied");
  assertNull(deniedArray);
}

</code></pre>

<pre class="type-9 type-3 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testModifyAceForGroup() throws IOException, JSONException {
  testGroupId=H.createTestGroup();
  testFolderUrl=H.createTestFolder();
  String postUrl=testFolderUrl + ".modifyAce.html";
  List<NameValuePair> postParams=new ArrayList<NameValuePair>();
  postParams.add(new NameValuePair("principalId",testGroupId));
  postParams.add(new NameValuePair("privilege@jcr:read","granted"));
  postParams.add(new NameValuePair("privilege@jcr:write","denied"));
  postParams.add(new NameValuePair("privilege@jcr:modifyAccessControl","bogus"));
  Credentials creds=new UsernamePasswordCredentials("admin","admin");
  H.assertAuthenticatedPostStatus(creds,postUrl,HttpServletResponse.SC_OK,postParams,null);
  String getUrl=testFolderUrl + ".acl.json";
  String json=H.getAuthenticatedContent(creds,getUrl,HttpTest.CONTENT_TYPE_JSON,null,HttpServletResponse.SC_OK);
  assertNotNull(json);
  JSONObject jsonObject=new JSONObject(json);
  assertEquals(1,jsonObject.length());
  JSONObject aceObject=jsonObject.optJSONObject(testGroupId);
  assertNotNull(aceObject);
  int order=aceObject.optInt("order");
  assertEquals(0,order);
  String principalString=aceObject.optString("principal");
  assertEquals(testGroupId,principalString);
  JSONArray grantedArray=aceObject.optJSONArray("granted");
  assertNotNull(grantedArray);
  assertEquals(1,grantedArray.length());
  assertEquals("jcr:read",grantedArray.getString(0));
  JSONArray deniedArray=aceObject.optJSONArray("denied");
  assertNotNull(deniedArray);
  assertEquals("jcr:write",deniedArray.getString(0));
}

</code></pre>

<pre class="type-13 type-9 type-3 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test ACE update with a deny privilege for an ACE that already contains
 * a grant privilege 
 */
@Test public void testMergeAceForUserDenyPrivilegeAfterGrantPrivilege() throws IOException, JSONException {
  testUserId=H.createTestUser();
  testFolderUrl=H.createTestFolder();
  String postUrl=testFolderUrl + ".modifyAce.html";
  List<NameValuePair> postParams=new ArrayList<NameValuePair>();
  postParams.add(new NameValuePair("principalId",testUserId));
  postParams.add(new NameValuePair("privilege@jcr:write","granted"));
  Credentials creds=new UsernamePasswordCredentials("admin","admin");
  H.assertAuthenticatedPostStatus(creds,postUrl,HttpServletResponse.SC_OK,postParams,null);
  String getUrl=testFolderUrl + ".acl.json";
  String json=H.getAuthenticatedContent(creds,getUrl,HttpTest.CONTENT_TYPE_JSON,null,HttpServletResponse.SC_OK);
  assertNotNull(json);
  JSONObject jsonObject=new JSONObject(json);
  assertEquals(1,jsonObject.length());
  JSONObject aceObject=jsonObject.optJSONObject(testUserId);
  assertNotNull(aceObject);
  assertEquals(testUserId,aceObject.optString("principal"));
  JSONArray grantedArray=aceObject.optJSONArray("granted");
  assertNotNull(grantedArray);
  assertEquals(1,grantedArray.length());
  Set<String> grantedPrivilegeNames=new HashSet<String>();
  for (int i=0; i < grantedArray.length(); i++) {
    grantedPrivilegeNames.add(grantedArray.getString(i));
  }
  H.assertPrivilege(grantedPrivilegeNames,true,"jcr:write");
  assertFalse(aceObject.has("denied"));
  List<NameValuePair> postParams2=new ArrayList<NameValuePair>();
  postParams2.add(new NameValuePair("principalId",testUserId));
  postParams2.add(new NameValuePair("privilege@jcr:nodeTypeManagement","denied"));
  H.assertAuthenticatedPostStatus(creds,postUrl,HttpServletResponse.SC_OK,postParams2,null);
  String json2=H.getAuthenticatedContent(creds,getUrl,HttpTest.CONTENT_TYPE_JSON,null,HttpServletResponse.SC_OK);
  assertNotNull(json2);
  JSONObject jsonObject2=new JSONObject(json2);
  assertEquals(1,jsonObject2.length());
  JSONObject aceObject2=jsonObject2.optJSONObject(testUserId);
  assertNotNull(aceObject2);
  assertEquals(testUserId,aceObject2.optString("principal"));
  JSONArray grantedArray2=aceObject2.optJSONArray("granted");
  assertNotNull(grantedArray2);
  assertEquals(1,grantedArray2.length());
  Set<String> grantedPrivilegeNames2=new HashSet<String>();
  for (int i=0; i < grantedArray2.length(); i++) {
    grantedPrivilegeNames2.add(grantedArray2.getString(i));
  }
  H.assertPrivilege(grantedPrivilegeNames2,true,"jcr:write");
  JSONArray deniedArray2=aceObject2.optJSONArray("denied");
  assertNotNull(deniedArray2);
  assertEquals(1,deniedArray2.length());
  Set<String> deniedPrivilegeNames2=new HashSet<String>();
  for (int i=0; i < deniedArray2.length(); i++) {
    deniedPrivilegeNames2.add(deniedArray2.getString(i));
  }
  H.assertPrivilege(deniedPrivilegeNames2,true,"jcr:nodeTypeManagement");
}

</code></pre>

<pre class="type-9 type-3 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test to verify adding an ACE at the end 
 * the ACL
 */
@Test public void testAddAceOrderByLast() throws IOException, JSONException {
  createAceOrderTestFolderWithOneAce();
  testGroupId=H.createTestGroup();
  addOrUpdateAce(testFolderUrl,testGroupId,true,"last");
  String getUrl=testFolderUrl + ".acl.json";
  Credentials creds=new UsernamePasswordCredentials("admin","admin");
  String json=H.getAuthenticatedContent(creds,getUrl,HttpTest.CONTENT_TYPE_JSON,null,HttpServletResponse.SC_OK);
  assertNotNull(json);
  JSONObject jsonObject=new JSONObject(json);
  assertEquals(2,jsonObject.length());
  JSONObject user=jsonObject.getJSONObject(testUserId);
  assertNotNull(user);
  assertEquals(testUserId,user.getString("principal"));
  assertEquals(0,user.getInt("order"));
  JSONObject group=jsonObject.getJSONObject(testGroupId);
  assertNotNull(group);
  assertEquals(testGroupId,group.getString("principal"));
  assertEquals(1,group.getInt("order"));
}

</code></pre>

<pre class="type-9 type-3 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test to verify adding an ACE before an existing ACE 
 * the ACL
 */
@Test public void testAddAceOrderByBefore() throws IOException, JSONException {
  createAceOrderTestFolderWithOneAce();
  testGroupId=H.createTestGroup();
  addOrUpdateAce(testFolderUrl,testGroupId,true,"before " + testUserId);
  String getUrl=testFolderUrl + ".acl.json";
  Credentials creds=new UsernamePasswordCredentials("admin","admin");
  String json=H.getAuthenticatedContent(creds,getUrl,HttpTest.CONTENT_TYPE_JSON,null,HttpServletResponse.SC_OK);
  assertNotNull(json);
  JSONObject jsonObject=new JSONObject(json);
  assertEquals(2,jsonObject.length());
  JSONObject group=jsonObject.getJSONObject(testGroupId);
  assertNotNull(group);
  assertEquals(testGroupId,group.getString("principal"));
  assertEquals(0,group.getInt("order"));
  JSONObject user=jsonObject.getJSONObject(testUserId);
  assertNotNull(user);
  assertEquals(testUserId,user.getString("principal"));
  assertEquals(1,user.getInt("order"));
}

</code></pre>

<pre class="type-9 type-3 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test to make sure modifying an existing ace without changing the order 
 * leaves the ACE in the same position in the ACL
 */
@Test public void testUpdateAcePreservePosition() throws IOException, JSONException {
  createAceOrderTestFolderWithOneAce();
  testGroupId=H.createTestGroup();
  addOrUpdateAce(testFolderUrl,testGroupId,true,"first");
  addOrUpdateAce(testFolderUrl,testGroupId,false,null);
  String getUrl=testFolderUrl + ".acl.json";
  Credentials creds=new UsernamePasswordCredentials("admin","admin");
  String json=H.getAuthenticatedContent(creds,getUrl,HttpTest.CONTENT_TYPE_JSON,null,HttpServletResponse.SC_OK);
  assertNotNull(json);
  JSONObject jsonObject=new JSONObject(json);
  assertEquals(2,jsonObject.length());
  JSONObject group=jsonObject.getJSONObject(testGroupId);
  assertNotNull(group);
  assertEquals(testGroupId,group.getString("principal"));
  assertEquals(0,group.getInt("order"));
  JSONObject user=jsonObject.getJSONObject(testUserId);
  assertNotNull(user);
  assertEquals(testUserId,user.getString("principal"));
  assertEquals(1,user.getInt("order"));
}

</code></pre>

<pre class="type-9 type-3 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test for SLING-997, preserve privileges that were not posted with the modifyAce 
 * request.
 */
@Test public void testMergeAceForUserSplitAggregatePrincipal() throws IOException, JSONException {
  testUserId=H.createTestUser();
  testFolderUrl=H.createTestFolder();
  String postUrl=testFolderUrl + ".modifyAce.html";
  List<NameValuePair> postParams=new ArrayList<NameValuePair>();
  postParams.add(new NameValuePair("principalId",testUserId));
  postParams.add(new NameValuePair("privilege@jcr:read","granted"));
  postParams.add(new NameValuePair("privilege@jcr:write","denied"));
  Credentials creds=new UsernamePasswordCredentials("admin","admin");
  H.assertAuthenticatedPostStatus(creds,postUrl,HttpServletResponse.SC_OK,postParams,null);
  String getUrl=testFolderUrl + ".acl.json";
  String json=H.getAuthenticatedContent(creds,getUrl,HttpTest.CONTENT_TYPE_JSON,null,HttpServletResponse.SC_OK);
  assertNotNull(json);
  JSONObject jsonObject=new JSONObject(json);
  assertEquals(1,jsonObject.length());
  JSONObject aceObject=jsonObject.optJSONObject(testUserId);
  assertNotNull(aceObject);
  assertEquals(testUserId,aceObject.optString("principal"));
  JSONArray grantedArray=aceObject.optJSONArray("granted");
  assertNotNull(grantedArray);
  assertEquals(1,grantedArray.length());
  Set<String> grantedPrivilegeNames=new HashSet<String>();
  for (int i=0; i < grantedArray.length(); i++) {
    grantedPrivilegeNames.add(grantedArray.getString(i));
  }
  H.assertPrivilege(grantedPrivilegeNames,true,"jcr:read");
  JSONArray deniedArray=aceObject.optJSONArray("denied");
  assertNotNull(deniedArray);
  assertEquals(1,deniedArray.length());
  Set<String> deniedPrivilegeNames=new HashSet<String>();
  for (int i=0; i < deniedArray.length(); i++) {
    deniedPrivilegeNames.add(deniedArray.getString(i));
  }
  H.assertPrivilege(deniedPrivilegeNames,true,"jcr:write");
  List<NameValuePair> postParams2=new ArrayList<NameValuePair>();
  postParams2.add(new NameValuePair("principalId",testUserId));
  postParams2.add(new NameValuePair("privilege@jcr:modifyProperties","granted"));
  H.assertAuthenticatedPostStatus(creds,postUrl,HttpServletResponse.SC_OK,postParams2,null);
  String json2=H.getAuthenticatedContent(creds,getUrl,HttpTest.CONTENT_TYPE_JSON,null,HttpServletResponse.SC_OK);
  assertNotNull(json2);
  JSONObject jsonObject2=new JSONObject(json2);
  assertEquals(1,jsonObject2.length());
  JSONObject aceObject2=jsonObject2.optJSONObject(testUserId);
  assertNotNull(aceObject2);
  assertEquals(testUserId,aceObject2.optString("principal"));
  JSONArray grantedArray2=aceObject2.optJSONArray("granted");
  assertNotNull(grantedArray2);
  assertEquals(2,grantedArray2.length());
  Set<String> grantedPrivilegeNames2=new HashSet<String>();
  for (int i=0; i < grantedArray2.length(); i++) {
    grantedPrivilegeNames2.add(grantedArray2.getString(i));
  }
  H.assertPrivilege(grantedPrivilegeNames2,true,"jcr:read");
  H.assertPrivilege(grantedPrivilegeNames2,true,"jcr:modifyProperties");
  JSONArray deniedArray2=aceObject2.optJSONArray("denied");
  assertNotNull(deniedArray2);
  assertEquals(3,deniedArray2.length());
  Set<String> deniedPrivilegeNames2=new HashSet<String>();
  for (int i=0; i < deniedArray2.length(); i++) {
    deniedPrivilegeNames2.add(deniedArray2.getString(i));
  }
  H.assertPrivilege(deniedPrivilegeNames2,false,"jcr:write");
  H.assertPrivilege(deniedPrivilegeNames2,true,"jcr:addChildNodes");
  H.assertPrivilege(deniedPrivilegeNames2,true,"jcr:removeNode");
  H.assertPrivilege(deniedPrivilegeNames2,true,"jcr:removeChildNodes");
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
