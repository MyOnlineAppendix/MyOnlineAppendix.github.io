<h3 style="margin:0px">Class: org.apache.sling.discovery.commons.providers.base.TestViewStateManager (26 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(20)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="16"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('16')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-16"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testBindChangingChangedChangingActivate() throws Exception {
  final DummyListener listener=new DummyListener();
  mgr.bind(listener);
  TestHelper.assertNoEvents(listener);
  mgr.handleChanging();
  TestHelper.assertNoEvents(listener);
  final BaseTopologyView view=new DummyTopologyView().addInstance();
  mgr.handleNewView(view);
  TestHelper.assertNoEvents(listener);
  mgr.handleChanging();
  TestHelper.assertNoEvents(listener);
  mgr.handleActivated();
  TestHelper.assertNoEvents(listener);
  final BaseTopologyView view2=new DummyTopologyView().addInstance();
  mgr.handleNewView(view2);
  assertEvents(listener,EventHelper.newInitEvent(view2));
  randomEventLoop(defaultRandom,listener);
}

</code></pre>

<pre class="type-13 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testDuplicateListeners() throws Exception {
  final DummyListener listener=new DummyListener();
  mgr.bind(listener);
  mgr.bind(listener);
  assertTrue(mgr.unbind(listener));
  assertFalse(mgr.unbind(listener));
  mgr.handleActivated();
  assertFalse(mgr.unbind(listener));
  mgr.bind(listener);
  mgr.bind(listener);
  assertTrue(mgr.unbind(listener));
  assertFalse(mgr.unbind(listener));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testActivateBindChangingDuplicateHandleNewView() throws Exception {
  final DummyListener listener=new DummyListener();
  mgr.handleActivated();
  mgr.bind(listener);
  mgr.handleChanging();
  final DummyTopologyView view=new DummyTopologyView().addInstance();
  mgr.handleNewView(view);
  assertEvents(listener,EventHelper.newInitEvent(view));
  mgr.handleNewView(DummyTopologyView.clone(view));
  TestHelper.assertNoEvents(listener);
  randomEventLoop(defaultRandom,listener);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testActivateChangingChangedBind() throws Exception {
  final DummyListener listener=new DummyListener();
  mgr.handleActivated();
  TestHelper.assertNoEvents(listener);
  mgr.handleChanging();
  TestHelper.assertNoEvents(listener);
  final BaseTopologyView view=new DummyTopologyView().addInstance();
  mgr.handleNewView(view);
  TestHelper.assertNoEvents(listener);
  mgr.bind(listener);
  assertEvents(listener,EventHelper.newInitEvent(view));
  randomEventLoop(defaultRandom,listener);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testBindActivateChangingBindChanged() throws Exception {
  final DummyListener listener1=new DummyListener();
  final DummyListener listener2=new DummyListener();
  mgr.bind(listener1);
  TestHelper.assertNoEvents(listener1);
  mgr.handleActivated();
  TestHelper.assertNoEvents(listener1);
  mgr.handleChanging();
  TestHelper.assertNoEvents(listener1);
  mgr.bind(listener2);
  TestHelper.assertNoEvents(listener1);
  TestHelper.assertNoEvents(listener2);
  final BaseTopologyView view=new DummyTopologyView().addInstance();
  mgr.handleNewView(view);
  assertEvents(listener1,EventHelper.newInitEvent(view));
  assertEvents(listener2,EventHelper.newInitEvent(view));
  randomEventLoop(defaultRandom,listener1,listener2);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testActivateBindChangingChangedBindDuplicateHandleNewView() throws Exception {
  final DummyListener listener1=new DummyListener();
  mgr.handleActivated();
  mgr.bind(listener1);
  mgr.handleChanging();
  final DummyTopologyView view=new DummyTopologyView().addInstance();
  mgr.handleNewView(view);
  assertEvents(listener1,EventHelper.newInitEvent(view));
  final DummyListener listener2=new DummyListener();
  mgr.bind(listener2);
  mgr.handleNewView(DummyTopologyView.clone(view));
  TestHelper.assertNoEvents(listener1);
  assertEvents(listener2,EventHelper.newInitEvent(view));
  randomEventLoop(defaultRandom,listener1,listener2);
}

</code></pre>

<pre class="type-13 type-9 type-3 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testClusterSyncService_withConcurrency() throws Exception {
  final org.apache.log4j.Logger commonsLogger=LogManager.getRootLogger().getLogger("org.apache.sling.discovery.commons.providers");
  final org.apache.log4j.Level logLevel=commonsLogger.getLevel();
  commonsLogger.setLevel(Level.INFO);
  final Semaphore serviceSemaphore=new Semaphore(0);
  final Semaphore testSemaphore=new Semaphore(0);
  final ReentrantLock lock=new ReentrantLock();
  final ClusterSyncServiceWithSemaphore cs=new ClusterSyncServiceWithSemaphore(lock,serviceSemaphore);
  mgr=new ViewStateManagerImpl(lock,cs);
  final DummyListener listener=new DummyListener();
  mgr.bind(listener);
  TestHelper.assertNoEvents(listener);
  mgr.handleActivated();
  TestHelper.assertNoEvents(listener);
  final String slingId1=UUID.randomUUID().toString();
  final String slingId2=UUID.randomUUID().toString();
  final String slingId3=UUID.randomUUID().toString();
  final String clusterId=UUID.randomUUID().toString();
  final DefaultClusterView cluster=new DefaultClusterView(clusterId);
  final DummyTopologyView view1=new DummyTopologyView().addInstance(slingId1,cluster,true,true).addInstance(slingId2,cluster,false,false).addInstance(slingId3,cluster,false,false);
  final DummyTopologyView view2=DummyTopologyView.clone(view1).removeInstance(slingId2);
  final DummyTopologyView view3=DummyTopologyView.clone(view1).removeInstance(slingId2).removeInstance(slingId3);
  async(new Runnable(){
    public void run(){
      mgr.handleNewView(view1);
    }
  }
);
  Thread.sleep(1000);
  TestHelper.assertNoEvents(listener);
  assertEquals("should have one thread now waiting",1,serviceSemaphore.getQueueLength());
  serviceSemaphore.release(1);
  Thread.sleep(1000);
  assertEvents(listener,EventHelper.newInitEvent(view1));
  mgr.handleChanging();
  assertEquals(0,mgr.waitForAsyncEvents(500));
  assertEvents(listener,EventHelper.newChangingEvent(view1));
  async(new Runnable(){
    public void run(){
      mgr.handleNewView(view2);
    }
  }
);
  logger.debug("run: waiting 1sec");
  Thread.sleep(1000);
  logger.debug("run: asserting no events");
  TestHelper.assertNoEvents(listener);
  assertEquals("should have one thread now waiting",1,serviceSemaphore.getQueueLength());
  assertFalse("should not be locked",lock.isLocked());
  logger.debug("run: issuing a second event");
  async(new Runnable(){
    public void run(){
      logger.debug("run2: calling handleChanging...");
      mgr.handleChanging();
      try {
        logger.debug("run2: done with handleChanging, acquiring testSemaphore...");
        testSemaphore.acquire();
        logger.debug("run2: calling handleNewView...");
        mgr.handleNewView(view3);
        logger.debug("run2: done with handleNewView...");
      }
 catch (      InterruptedException e) {
        logger.error("interrupted: " + e,e);
      }
    }
  }
);
  logger.debug("run: waiting 1sec");
  Thread.sleep(1000);
  int remainingAsyncEvents=mgr.waitForAsyncEvents(2000);
  logger.info("run: result of waitForAsyncEvent is: " + remainingAsyncEvents);
  assertEquals("should have one thread now waiting",1,serviceSemaphore.getQueueLength());
  assertEquals("should be acquiring (by thread2)",1,testSemaphore.getQueueLength());
  testSemaphore.release();
  logger.debug("run: waiting 1sec");
  Thread.sleep(1000);
  assertEquals("should have two async events now in the queue or being sent",2,mgr.waitForAsyncEvents(500));
  assertEquals("but should only have 1 thread actually sitting on the semaphore waiting",1,serviceSemaphore.getQueueLength());
  logger.debug("run: releasing consistencyService");
  serviceSemaphore.release(1);
  logger.debug("run: waiting 1sec");
  Thread.sleep(1000);
  assertFalse("should not be locked",lock.isLocked());
  TestHelper.assertNoEvents(listener);
  serviceSemaphore.release(1);
  logger.debug("run: waiting 1sec");
  Thread.sleep(1000);
  logger.debug("run: asserting 1 event");
  final TopologyEvent changedEvent=EventHelper.newChangedEvent(view1,view3);
  assertEvents(listener,changedEvent);
  commonsLogger.setLevel(Level.INFO);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testBindActivateChangedDeactivateChangedActivateChanged() throws Exception {
  final DummyListener listener=new DummyListener();
  mgr.bind(listener);
  TestHelper.assertNoEvents(listener);
  mgr.handleActivated();
  TestHelper.assertNoEvents(listener);
  final BaseTopologyView view1=new DummyTopologyView().addInstance();
  mgr.handleNewView(view1);
  assertEvents(listener,EventHelper.newInitEvent(view1));
  mgr.handleDeactivated();
  TestHelper.assertNoEvents(listener);
  final BaseTopologyView view2=new DummyTopologyView().addInstance();
  mgr.handleNewView(view2);
  TestHelper.assertNoEvents(listener);
  mgr.bind(listener);
  mgr.handleActivated();
  assertEvents(listener,EventHelper.newInitEvent(view2));
  final BaseTopologyView view3=new DummyTopologyView().addInstance();
  mgr.handleNewView(view3);
  assertEvents(listener,EventHelper.newChangingEvent(view2),EventHelper.newChangedEvent(view2,view3));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testBindActivateChangedChanged() throws Exception {
  final DummyListener listener=new DummyListener();
  mgr.handleActivated();
  TestHelper.assertNoEvents(listener);
  mgr.bind(listener);
  TestHelper.assertNoEvents(listener);
  mgr.handleChanging();
  TestHelper.assertNoEvents(listener);
  final BaseTopologyView view1=new DummyTopologyView().addInstance();
  mgr.handleNewView(view1);
  assertEvents(listener,EventHelper.newInitEvent(view1));
  final BaseTopologyView view2=new DummyTopologyView().addInstance();
  mgr.handleNewView(view2);
  assertEvents(listener,EventHelper.newChangingEvent(view1),EventHelper.newChangedEvent(view1,view2));
  randomEventLoop(defaultRandom,listener);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testBindActivateBindChangingChanged() throws Exception {
  final DummyListener listener1=new DummyListener();
  final DummyListener listener2=new DummyListener();
  mgr.bind(listener1);
  TestHelper.assertNoEvents(listener1);
  mgr.handleActivated();
  TestHelper.assertNoEvents(listener1);
  mgr.bind(listener2);
  TestHelper.assertNoEvents(listener1);
  TestHelper.assertNoEvents(listener2);
  mgr.handleChanging();
  TestHelper.assertNoEvents(listener1);
  TestHelper.assertNoEvents(listener2);
  final BaseTopologyView view=new DummyTopologyView().addInstance();
  mgr.handleNewView(view);
  assertEvents(listener1,EventHelper.newInitEvent(view));
  assertEvents(listener2,EventHelper.newInitEvent(view));
  randomEventLoop(defaultRandom,listener1,listener2);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testBindChangingChangedActivate() throws Exception {
  final DummyListener listener=new DummyListener();
  mgr.bind(listener);
  TestHelper.assertNoEvents(listener);
  mgr.handleChanging();
  TestHelper.assertNoEvents(listener);
  final BaseTopologyView view=new DummyTopologyView().addInstance();
  mgr.handleNewView(view);
  TestHelper.assertNoEvents(listener);
  mgr.handleActivated();
  assertEvents(listener,EventHelper.newInitEvent(view));
  randomEventLoop(defaultRandom,listener);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testClusterSyncService_noConcurrency() throws Exception {
  final org.apache.log4j.Logger commonsLogger=LogManager.getRootLogger().getLogger("org.apache.sling.discovery.commons.providers");
  final org.apache.log4j.Level logLevel=commonsLogger.getLevel();
  commonsLogger.setLevel(Level.INFO);
  final Semaphore serviceSemaphore=new Semaphore(0);
  final ReentrantLock lock=new ReentrantLock();
  final ClusterSyncServiceWithSemaphore cs=new ClusterSyncServiceWithSemaphore(lock,serviceSemaphore);
  mgr=new ViewStateManagerImpl(lock,cs);
  final DummyListener listener=new DummyListener();
  mgr.bind(listener);
  TestHelper.assertNoEvents(listener);
  mgr.handleActivated();
  TestHelper.assertNoEvents(listener);
  final String slingId1=UUID.randomUUID().toString();
  final String slingId2=UUID.randomUUID().toString();
  final String clusterId=UUID.randomUUID().toString();
  final DefaultClusterView cluster=new DefaultClusterView(clusterId);
  final DummyTopologyView view1=new DummyTopologyView().addInstance(slingId1,cluster,true,true).addInstance(slingId2,cluster,false,false);
  async(new Runnable(){
    public void run(){
      mgr.handleNewView(view1);
    }
  }
);
  Thread.sleep(1000);
  TestHelper.assertNoEvents(listener);
  serviceSemaphore.release(1);
  Thread.sleep(1000);
  assertEvents(listener,EventHelper.newInitEvent(view1));
  final DummyTopologyView view2=view1.clone();
  mgr.handleChanging();
  assertEvents(listener,EventHelper.newChangingEvent(view1));
  view2.removeInstance(slingId2);
  async(new Runnable(){
    public void run(){
      mgr.handleNewView(view2);
    }
  }
);
  logger.debug("run: waiting for 1sec");
  Thread.sleep(1000);
  logger.debug("run: asserting no events");
  TestHelper.assertNoEvents(listener);
  logger.debug("run: releasing consistencyService");
  serviceSemaphore.release(1);
  logger.debug("run: waiting 1sec");
  Thread.sleep(1000);
  logger.debug("run: asserting 1 event");
  assertEvents(listener,EventHelper.newChangedEvent(view1,view2));
  commonsLogger.setLevel(Level.INFO);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testBindChangingActivateChanged() throws Exception {
  final DummyListener listener=new DummyListener();
  mgr.bind(listener);
  TestHelper.assertNoEvents(listener);
  mgr.handleChanging();
  TestHelper.assertNoEvents(listener);
  mgr.handleActivated();
  TestHelper.assertNoEvents(listener);
  final BaseTopologyView view=new DummyTopologyView().addInstance();
  mgr.handleNewView(view);
  assertEvents(listener,EventHelper.newInitEvent(view));
  randomEventLoop(defaultRandom,listener);
}

</code></pre>

<pre class="type-11 type-13 type-9 type-3 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOnlyDiffersInProperties() throws Exception {
  final org.apache.log4j.Logger discoveryLogger=LogManager.getRootLogger().getLogger("org.apache.sling.discovery");
  discoveryLogger.setLevel(Level.DEBUG);
  logger.info("testOnlyDiffersInProperties: start");
  final String slingId1=UUID.randomUUID().toString();
  final String slingId2=UUID.randomUUID().toString();
  final String slingId3=UUID.randomUUID().toString();
  final String clusterId=UUID.randomUUID().toString();
  final DefaultClusterView cluster=new DefaultClusterView(clusterId);
  final DummyTopologyView view1=new DummyTopologyView().addInstance(slingId1,cluster,true,true).addInstance(slingId2,cluster,false,false).addInstance(slingId3,cluster,false,false);
  final DummyTopologyView view2=DummyTopologyView.clone(view1).removeInstance(slingId2);
  final DummyTopologyView view3=DummyTopologyView.clone(view1).removeInstance(slingId2).removeInstance(slingId3);
  DummyTopologyView view1Cloned=DummyTopologyView.clone(view1);
  logger.info("testOnlyDiffersInProperties: handleNewView(view1)");
  mgr.handleNewView(view1);
  logger.info("testOnlyDiffersInProperties: handleActivated()");
  mgr.handleActivated();
  assertEquals(0,mgr.waitForAsyncEvents(5000));
  assertFalse(mgr.onlyDiffersInProperties(view1));
  assertFalse(mgr.onlyDiffersInProperties(view2));
  assertFalse(mgr.onlyDiffersInProperties(view3));
  logger.info("testOnlyDiffersInProperties: handleNewView(view2)");
  mgr.handleNewView(view2);
  assertEquals(0,mgr.waitForAsyncEvents(5000));
  assertFalse(mgr.onlyDiffersInProperties(view1));
  assertFalse(mgr.onlyDiffersInProperties(view2));
  assertFalse(mgr.onlyDiffersInProperties(view3));
  logger.info("testOnlyDiffersInProperties: handleNewView(view3)");
  mgr.handleNewView(view3);
  assertEquals(0,mgr.waitForAsyncEvents(5000));
  assertFalse(mgr.onlyDiffersInProperties(view1));
  assertFalse(mgr.onlyDiffersInProperties(view2));
  assertFalse(mgr.onlyDiffersInProperties(view3));
  final DummyTopologyView view4=DummyTopologyView.clone(view1Cloned);
  final DummyTopologyView view5=DummyTopologyView.clone(view1Cloned);
  final DummyTopologyView view6=DummyTopologyView.clone(view1Cloned);
  logger.info("testOnlyDiffersInProperties: handleNewView(view1cloned)");
  mgr.handleNewView(view1Cloned);
  assertEquals(0,mgr.waitForAsyncEvents(5000));
  DefaultInstanceDescription i4_1=(DefaultInstanceDescription)view4.getInstance(slingId1);
  i4_1.setProperty("a","b");
  logger.info("testOnlyDiffersInProperties: onlyDiffersInProperties(view4)");
  assertTrue(mgr.onlyDiffersInProperties(view4));
  DefaultInstanceDescription i5_1=(DefaultInstanceDescription)view5.getInstance(slingId1);
  i5_1.setProperty("a","b");
  logger.info("testOnlyDiffersInProperties: onlyDiffersInProperties(view5)");
  assertTrue(mgr.onlyDiffersInProperties(view5));
  DummyTopologyView view4Cloned=DummyTopologyView.clone(view4);
  mgr.handleNewView(view4);
  assertEquals(0,mgr.waitForAsyncEvents(5000));
  logger.info("testOnlyDiffersInProperties: onlyDiffersInProperties(view4Cloned)");
  assertFalse(mgr.onlyDiffersInProperties(view4Cloned));
  logger.info("testOnlyDiffersInProperties: onlyDiffersInProperties(view5)");
  assertFalse(mgr.onlyDiffersInProperties(view5));
  DefaultInstanceDescription i6_1=(DefaultInstanceDescription)view6.getInstance(slingId1);
  i6_1.setProperty("a","c");
  logger.info("testOnlyDiffersInProperties: onlyDiffersInProperties(view6)");
  assertTrue(mgr.onlyDiffersInProperties(view6));
  String originalId=view6.getLocalClusterSyncTokenId();
  view6.setId(UUID.randomUUID().toString());
  logger.info("testOnlyDiffersInProperties: onlyDiffersInProperties(view6) [2]");
  assertFalse(mgr.onlyDiffersInProperties(view6));
  view6.setId(originalId);
  logger.info("testOnlyDiffersInProperties: onlyDiffersInProperties(view6) [3]");
  assertTrue(mgr.onlyDiffersInProperties(view6));
  view6.setId(null);
  logger.info("testOnlyDiffersInProperties: onlyDiffersInProperties(view6) [4]");
  assertFalse(mgr.onlyDiffersInProperties(view6));
  view6.setId(originalId);
  logger.info("testOnlyDiffersInProperties: onlyDiffersInProperties(view6) [5]");
  assertTrue(mgr.onlyDiffersInProperties(view6));
  view4.setId(null);
  view6.setId(null);
  logger.info("testOnlyDiffersInProperties: onlyDiffersInProperties(view6) [6]");
  assertTrue(mgr.onlyDiffersInProperties(view6));
  view6.setId(originalId);
  logger.info("testOnlyDiffersInProperties: onlyDiffersInProperties(view6) [7]");
  assertFalse(mgr.onlyDiffersInProperties(view6));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testBindActivateChangedDeactivateChangingActivateChanged() throws Exception {
  final DummyListener listener=new DummyListener();
  mgr.bind(listener);
  TestHelper.assertNoEvents(listener);
  mgr.handleActivated();
  TestHelper.assertNoEvents(listener);
  final BaseTopologyView view1=new DummyTopologyView().addInstance();
  mgr.handleNewView(view1);
  assertEvents(listener,EventHelper.newInitEvent(view1));
  mgr.handleDeactivated();
  TestHelper.assertNoEvents(listener);
  mgr.handleChanging();
  TestHelper.assertNoEvents(listener);
  mgr.bind(listener);
  mgr.handleActivated();
  TestHelper.assertNoEvents(listener);
  final BaseTopologyView view2=new DummyTopologyView().addInstance();
  mgr.handleNewView(view2);
  assertEvents(listener,EventHelper.newInitEvent(view2));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testActivateChangingBindChanged() throws Exception {
  final DummyListener listener=new DummyListener();
  mgr.handleActivated();
  TestHelper.assertNoEvents(listener);
  mgr.handleChanging();
  TestHelper.assertNoEvents(listener);
  mgr.bind(listener);
  TestHelper.assertNoEvents(listener);
  final BaseTopologyView view=new DummyTopologyView().addInstance();
  mgr.handleNewView(view);
  assertEvents(listener,EventHelper.newInitEvent(view));
  randomEventLoop(defaultRandom,listener);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testBindChangedChangingActivate() throws Exception {
  final DummyListener listener=new DummyListener();
  mgr.bind(listener);
  TestHelper.assertNoEvents(listener);
  final BaseTopologyView view=new DummyTopologyView().addInstance();
  mgr.handleNewView(view);
  TestHelper.assertNoEvents(listener);
  mgr.handleChanging();
  TestHelper.assertNoEvents(listener);
  mgr.handleActivated();
  TestHelper.assertNoEvents(listener);
  final BaseTopologyView view2=new DummyTopologyView().addInstance();
  mgr.handleNewView(view2);
  assertEvents(listener,EventHelper.newInitEvent(view2));
  randomEventLoop(defaultRandom,listener);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testBindActivateChangedChangingDeactivateActivateChangingChanged() throws Exception {
  final DummyListener listener=new DummyListener();
  mgr.bind(listener);
  TestHelper.assertNoEvents(listener);
  mgr.handleActivated();
  TestHelper.assertNoEvents(listener);
  final BaseTopologyView view1=new DummyTopologyView().addInstance();
  mgr.handleNewView(view1);
  assertEvents(listener,EventHelper.newInitEvent(view1));
  mgr.handleChanging();
  assertEvents(listener,EventHelper.newChangingEvent(view1));
  mgr.handleDeactivated();
  TestHelper.assertNoEvents(listener);
  mgr.bind(listener);
  mgr.handleActivated();
  TestHelper.assertNoEvents(listener);
  mgr.handleChanging();
  TestHelper.assertNoEvents(listener);
  final BaseTopologyView view2=new DummyTopologyView().addInstance();
  mgr.handleNewView(view2);
  assertEvents(listener,EventHelper.newInitEvent(view2));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPropertiesChanged() throws Exception {
  final DummyListener listener=new DummyListener();
  mgr.handleActivated();
  mgr.bind(listener);
  mgr.handleChanging();
  DummyTopologyView oldView=new DummyTopologyView().addInstance();
  DefaultInstanceDescription localInstance=(DefaultInstanceDescription)oldView.getLocalInstance();
  localInstance.setProperty("foo","bar1");
  mgr.handleNewView(oldView);
  TopologyEvent initEvent=EventHelper.newInitEvent(oldView.clone());
  assertEvents(listener,initEvent);
  DummyTopologyView newView=oldView.clone();
  oldView.setNotCurrent();
  localInstance=(DefaultInstanceDescription)newView.getLocalInstance();
  localInstance.setProperty("foo","bar2");
  mgr.handleNewView(newView);
  Thread.sleep(2000);
  TopologyEvent propertiesChangedEvent=EventHelper.newPropertiesChangedEvent(oldView.clone(),newView.clone());
  assertEvents(listener,propertiesChangedEvent);
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void setup() throws Exception {
  mgr=new ViewStateManagerImpl(new ReentrantLock(),new ClusterSyncService(){
    public void sync(    BaseTopologyView view,    Runnable callback){
      callback.run();
    }
    @Override public void cancelSync(){
    }
  }
);
  defaultRandom=new Random(1234123412);
  final org.apache.log4j.Logger discoveryLogger=LogManager.getRootLogger().getLogger("org.apache.sling.discovery");
  logLevel=discoveryLogger.getLevel();
  discoveryLogger.setLevel(Level.INFO);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testBindActivateChangingChanged() throws Exception {
  final DummyListener listener=new DummyListener();
  mgr.bind(listener);
  TestHelper.assertNoEvents(listener);
  mgr.handleActivated();
  TestHelper.assertNoEvents(listener);
  mgr.handleChanging();
  TestHelper.assertNoEvents(listener);
  final BaseTopologyView view=new DummyTopologyView().addInstance();
  mgr.handleNewView(view);
  assertEvents(listener,EventHelper.newInitEvent(view));
  randomEventLoop(defaultRandom,listener);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testActivateBindChangingChanged() throws Exception {
  final DummyListener listener=new DummyListener();
  mgr.handleActivated();
  TestHelper.assertNoEvents(listener);
  mgr.bind(listener);
  TestHelper.assertNoEvents(listener);
  mgr.handleChanging();
  TestHelper.assertNoEvents(listener);
  final BaseTopologyView view=new DummyTopologyView().addInstance();
  mgr.handleNewView(view);
  assertEvents(listener,EventHelper.newInitEvent(view));
  randomEventLoop(defaultRandom,listener);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testChangedPropertiesChanged() throws Exception {
  final DummyListener listener=new DummyListener();
  mgr.installMinEventDelayHandler(new DiscoveryService(){
    @Override public TopologyView getTopology(){
      throw new IllegalStateException("not yet impl");
    }
  }
,new DummyScheduler(),1);
  mgr.handleActivated();
  TestHelper.assertNoEvents(listener);
  mgr.bind(listener);
  TestHelper.assertNoEvents(listener);
  mgr.handleChanging();
  TestHelper.assertNoEvents(listener);
  final BaseTopologyView view1=new DummyTopologyView().addInstance();
  InstanceDescription instance1=view1.getInstances().iterator().next();
  ClusterView cluster1=instance1.getClusterView();
  mgr.handleNewView(view1);
  assertEvents(listener,EventHelper.newInitEvent(view1));
  DefaultClusterView cluster2=new DefaultClusterView(new String(cluster1.getId()));
  final BaseTopologyView view2=new DummyTopologyView(view1.getLocalClusterSyncTokenId()).addInstance(instance1.getSlingId(),cluster2,instance1.isLeader(),instance1.isLocal());
  DefaultInstanceDescription instance2=(DefaultInstanceDescription)view2.getLocalInstance();
  instance2.setProperty("foo","bar");
  mgr.handleNewView(view2);
  assertEvents(listener,EventHelper.newPropertiesChangedEvent(view1,view2));
}

</code></pre>

<pre class="type-16 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void teardown() throws Exception {
  if (mgr != null) {
    mgr.handleDeactivated();
  }
  mgr=null;
  defaultRandom=null;
  final org.apache.log4j.Logger discoveryLogger=LogManager.getRootLogger().getLogger("org.apache.sling.discovery");
  discoveryLogger.setLevel(logLevel);
}

</code></pre>

<pre class="type-11 type-9 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCancelSync() throws Exception {
  final List<Runnable> syncCallbacks=new LinkedList<Runnable>();
  mgr=new ViewStateManagerImpl(new ReentrantLock(),new ClusterSyncService(){
    public void sync(    BaseTopologyView view,    Runnable callback){
synchronized (syncCallbacks) {
        syncCallbacks.add(callback);
      }
    }
    @Override public void cancelSync(){
synchronized (syncCallbacks) {
        syncCallbacks.clear();
      }
    }
  }
);
  mgr.handleActivated();
  final DummyListener listener=new DummyListener();
  mgr.bind(listener);
  mgr.handleChanging();
  final BaseTopologyView view=new DummyTopologyView().addInstance();
  mgr.handleNewView(view);
  assertEquals(0,mgr.waitForAsyncEvents(1000));
  TestHelper.assertNoEvents(listener);
synchronized (syncCallbacks) {
    assertEquals(1,syncCallbacks.size());
  }
  String id1=UUID.randomUUID().toString();
  String id2=UUID.randomUUID().toString();
  final BaseTopologyView view2=TestHelper.newView(true,id1,id1,id1,id2);
  mgr.handleNewView(view2);
  assertEquals(0,mgr.waitForAsyncEvents(1000));
  TestHelper.assertNoEvents(listener);
synchronized (syncCallbacks) {
    assertEquals(1,syncCallbacks.size());
    syncCallbacks.get(0).run();
    syncCallbacks.clear();
  }
  assertEquals(0,mgr.waitForAsyncEvents(1000));
  assertEvents(listener,EventHelper.newInitEvent(view2));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testActivateChangedBindDuplicateHandleNewView() throws Exception {
  final DummyListener listener=new DummyListener();
  mgr.handleActivated();
  TestHelper.assertNoEvents(listener);
  final DummyTopologyView view=new DummyTopologyView().addInstance();
  mgr.handleNewView(view);
  TestHelper.assertNoEvents(listener);
  mgr.bind(listener);
  assertEvents(listener,EventHelper.newInitEvent(view));
  mgr.handleNewView(DummyTopologyView.clone(view));
  TestHelper.assertNoEvents(listener);
  randomEventLoop(defaultRandom,listener);
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
