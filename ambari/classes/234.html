<h3 style="margin:0px">Class: org.apache.ambari.server.controller.internal.RepositoryVersionResourceProviderTest (12 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(8)</kbd></button>&nbsp;<button id="16"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('16')" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution"><kbd id="tag-16"class="label-info"style="display: inline-block;font-size:7pt" >ExceptionVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCreateResourcesAsAdministrator() throws Exception {
  testCreateResources(TestAuthenticationFactory.createAdministrator());
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGetResourcesAsClusterAdministrator() throws Exception {
  testGetResources(TestAuthenticationFactory.createClusterAdministrator());
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testVersionInStack(){
  StackId sid=new StackId("HDP-2.3");
  StackId sid2=new StackId("HDP-2.3.NEW");
  Assert.assertEquals(true,RepositoryVersionEntity.isVersionInStack(sid,"2.3"));
  Assert.assertEquals(true,RepositoryVersionEntity.isVersionInStack(sid2,"2.3"));
  Assert.assertEquals(true,RepositoryVersionEntity.isVersionInStack(sid,"2.3.1"));
  Assert.assertEquals(true,RepositoryVersionEntity.isVersionInStack(sid2,"2.3.1"));
  Assert.assertEquals(true,RepositoryVersionEntity.isVersionInStack(sid,"2.3.2.0-2300"));
  Assert.assertEquals(true,RepositoryVersionEntity.isVersionInStack(sid2,"2.3.2.1-3562"));
  Assert.assertEquals(false,RepositoryVersionEntity.isVersionInStack(sid,"2.4.2.0-2300"));
  Assert.assertEquals(false,RepositoryVersionEntity.isVersionInStack(sid2,"2.1"));
}

</code></pre>

<pre class="type-10 type-2 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testValidateRepositoryVersion() throws Exception {
  StackDAO stackDAO=injector.getInstance(StackDAO.class);
  StackEntity stackEntity=stackDAO.find("HDP","1.1");
  Assert.assertNotNull(stackEntity);
  final RepositoryVersionResourceProvider provider=(RepositoryVersionResourceProvider)injector.getInstance(ResourceProviderFactory.class).getRepositoryVersionResourceProvider();
  final RepositoryVersionEntity entity=new RepositoryVersionEntity();
  entity.setDisplayName("name");
  entity.setStack(stackEntity);
  entity.setVersion("1.1");
  entity.setOperatingSystems("[{\"OperatingSystems/os_type\":\"redhat6\",\"repositories\":[{\"Repositories/repo_id\":\"1\",\"Repositories/repo_name\":\"1\",\"Repositories/base_url\":\"http://example.com/repo1\"}]}]");
  provider.validateRepositoryVersion(entity);
  entity.setVersion("1.1-17");
  provider.validateRepositoryVersion(entity);
  entity.setVersion("1.1.1.1");
  provider.validateRepositoryVersion(entity);
  entity.setVersion("1.1.343432.2");
  provider.validateRepositoryVersion(entity);
  entity.setVersion("1.1.343432.2-234234324");
  provider.validateRepositoryVersion(entity);
  entity.setOperatingSystems(jsonStringRedhat7);
  try {
    provider.validateRepositoryVersion(entity);
    Assert.fail("Should throw exception");
  }
 catch (  Exception ex) {
  }
  entity.setOperatingSystems("");
  try {
    provider.validateRepositoryVersion(entity);
    Assert.fail("Should throw exception");
  }
 catch (  Exception ex) {
  }
  StackEntity bigtop=new StackEntity();
  stackEntity.setStackName("BIGTOP");
  entity.setStack(bigtop);
  try {
    provider.validateRepositoryVersion(entity);
    Assert.fail("Should throw exception");
  }
 catch (  Exception ex) {
  }
  final RepositoryVersionDAO repositoryVersionDAO=injector.getInstance(RepositoryVersionDAO.class);
  entity.setDisplayName("name");
  entity.setStack(stackEntity);
  entity.setVersion("1.1");
  entity.setOperatingSystems("[{\"OperatingSystems/os_type\":\"redhat6\",\"repositories\":[{\"Repositories/repo_id\":\"1\",\"Repositories/repo_name\":\"1\",\"Repositories/base_url\":\"http://example.com/repo1\"}]}]");
  repositoryVersionDAO.create(entity);
  final RepositoryVersionEntity entity2=new RepositoryVersionEntity();
  entity2.setId(2l);
  entity2.setDisplayName("name2");
  entity2.setStack(stackEntity);
  entity2.setVersion("1.2");
  entity2.setOperatingSystems("[{\"OperatingSystems/os_type\":\"redhat6\",\"repositories\":[{\"Repositories/repo_id\":\"1\",\"Repositories/repo_name\":\"1\",\"Repositories/base_url\":\"http://example.com/repo1\"}]}]");
  try {
    provider.validateRepositoryVersion(entity2);
    Assert.fail("Should throw exception: Base url http://example.com/repo1 is already defined for another repository version");
  }
 catch (  Exception ex) {
  }
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGetResourcesAsAdministrator() throws Exception {
  testGetResources(TestAuthenticationFactory.createAdministrator());
}

</code></pre>

<pre class="type-16 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=AuthorizationException.class) public void testCreateResourcesAsClusterAdministrator() throws Exception {
  testCreateResources(TestAuthenticationFactory.createClusterAdministrator());
}

</code></pre>

<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void after(){
  injector.getInstance(PersistService.class).stop();
  injector=null;
  SecurityContextHolder.getContext().setAuthentication(null);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDeleteResourcesAsAdministrator() throws Exception {
  testDeleteResources(TestAuthenticationFactory.createAdministrator());
}

</code></pre>

<pre class="type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void before() throws Exception {
  final Set<String> validVersions=Sets.newHashSet("1.1","1.1-17","1.1.1.1","1.1.343432.2","1.1.343432.2-234234324");
  final Set<StackInfo> stacks=new HashSet<StackInfo>();
  final AmbariMetaInfo ambariMetaInfo=Mockito.mock(AmbariMetaInfo.class);
  clusterVersionDAO=Mockito.mock(ClusterVersionDAO.class);
  final InMemoryDefaultTestModule injectorModule=new InMemoryDefaultTestModule(){
    @Override protected void configure(){
      super.configure();
      bind(AmbariMetaInfo.class).toInstance(ambariMetaInfo);
      bind(ClusterVersionDAO.class).toInstance(clusterVersionDAO);
    }
  }
;
  injector=Guice.createInjector(injectorModule);
  final StackInfo stackInfo=new StackInfo(){
    @Override public Map<String,UpgradePack> getUpgradePacks(){
      final Map<String,UpgradePack> map=new HashMap<String,UpgradePack>();
      final UpgradePack pack1=new UpgradePack(){
        @Override public String getName(){
          return "pack1";
        }
        @Override public String getTarget(){
          return "1.1.*.*";
        }
      }
;
      final UpgradePack pack2=new UpgradePack(){
        @Override public String getName(){
          return "pack2";
        }
        @Override public String getTarget(){
          return "1.1.*.*";
        }
      }
;
      map.put("pack1",pack1);
      map.put("pack2",pack2);
      return map;
    }
  }
;
  stackInfo.setName("HDP");
  stackInfo.setVersion("1.1");
  stacks.add(stackInfo);
  Mockito.when(ambariMetaInfo.getStack(Mockito.anyString(),Mockito.anyString())).thenAnswer(new Answer<StackInfo>(){
    @Override public StackInfo answer(    InvocationOnMock invocation) throws Throwable {
      final String stack=invocation.getArguments()[0].toString();
      final String version=invocation.getArguments()[1].toString();
      if (stack.equals("HDP") && validVersions.contains(version)) {
        return stackInfo;
      }
 else {
        throw new Exception("error");
      }
    }
  }
);
  Mockito.when(ambariMetaInfo.getStacks()).thenReturn(stacks);
  Mockito.when(ambariMetaInfo.getUpgradePacks(Mockito.anyString(),Mockito.anyString())).thenAnswer(new Answer<Map<String,UpgradePack>>(){
    @Override public Map<String,UpgradePack> answer(    InvocationOnMock invocation) throws Throwable {
      return stackInfo.getUpgradePacks();
    }
  }
);
  final HashSet<OperatingSystemInfo> osInfos=new HashSet<OperatingSystemInfo>();
  osInfos.add(new OperatingSystemInfo("redhat6"));
  osInfos.add(new OperatingSystemInfo("redhat7"));
  Mockito.when(ambariMetaInfo.getOperatingSystems(Mockito.anyString(),Mockito.anyString())).thenAnswer(new Answer<Set<OperatingSystemInfo>>(){
    @Override public Set<OperatingSystemInfo> answer(    InvocationOnMock invocation) throws Throwable {
      final String stack=invocation.getArguments()[0].toString();
      final String version=invocation.getArguments()[1].toString();
      if (stack.equals("HDP") && validVersions.contains(version)) {
        return osInfos;
      }
 else {
        return new HashSet<OperatingSystemInfo>();
      }
    }
  }
);
  Mockito.when(clusterVersionDAO.findByStackAndVersion(Mockito.anyString(),Mockito.anyString(),Mockito.anyString())).thenAnswer(new Answer<List<ClusterVersionEntity>>(){
    @Override public List<ClusterVersionEntity> answer(    InvocationOnMock invocation) throws Throwable {
      final String stack=invocation.getArguments()[0].toString();
      final String version=invocation.getArguments()[1].toString();
      if (stack.equals("HDP-1.1") && version.equals("1.1.1.1")) {
        return getNoClusterVersions();
      }
 else {
        return getInstallFailedClusterVersions();
      }
    }
  }
);
  injector.getInstance(GuiceJpaInitializer.class);
  StackDAO stackDAO=injector.getInstance(StackDAO.class);
  StackEntity stackEntity=new StackEntity();
  stackEntity.setStackName("HDP");
  stackEntity.setStackVersion("1.1");
  stackDAO.create(stackEntity);
  Clusters clusters=injector.getInstance(Clusters.class);
  clusters.addCluster("c1",new StackId("HDP","1.1"));
}

</code></pre>

<pre class="type-16 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=AuthorizationException.class) public void testDeleteResourcesAsClusterAdministrator() throws Exception {
  testDeleteResources(TestAuthenticationFactory.createClusterAdministrator());
}

</code></pre>

<pre class="type-16 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=AuthorizationException.class) public void testUpdateResourcesAsClusterAdministrator() throws Exception {
  testUpdateResources(TestAuthenticationFactory.createClusterAdministrator());
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUpdateResourcesAsAdministrator() throws Exception {
  testUpdateResources(TestAuthenticationFactory.createAdministrator());
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
