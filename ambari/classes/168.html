<h3 style="margin:0px">Class: org.apache.ambari.server.controller.KerberosHelperTest (49 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(27)</kbd></button>&nbsp;<button id="16"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('16')" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution"><kbd id="tag-16"class="label-info"style="display: inline-block;font-size:7pt" >ExceptionVerifier&nbsp;(15)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(13)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(10)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(9)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(7)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(6)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Is an empty test case"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >EmptyTester&nbsp;(1)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testExecuteCustomOperationsInvalidOperation() throws Exception {
  KerberosHelper kerberosHelper=injector.getInstance(KerberosHelper.class);
  final Cluster cluster=createNiceMock(Cluster.class);
  try {
    kerberosHelper.executeCustomOperations(cluster,Collections.singletonMap("invalid_operation","false"),null,true);
  }
 catch (  Throwable t) {
    Assert.fail("Exception should not have been thrown");
  }
}

</code></pre>

<pre class="type-10 type-16 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(expected=AmbariException.class) public void testRegenerateKeytabsInvalidValue() throws Exception {
  KerberosHelper kerberosHelper=injector.getInstance(KerberosHelper.class);
  final Cluster cluster=createNiceMock(Cluster.class);
  kerberosHelper.executeCustomOperations(cluster,Collections.singletonMap("regenerate_keytabs","false"),null,true);
  Assert.fail("AmbariException should have failed");
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCreateTestIdentity_ManageIdentitiesTrue() throws Exception {
  testCreateTestIdentity(new PrincipalKeyCredential("principal","password"),Boolean.TRUE);
}

</code></pre>

<pre class="type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEnsureHeadlessIdentities() throws Exception {
  Map<String,String> propertiesKrb5Conf=new HashMap<String,String>();
  Map<String,String> propertiesKerberosEnv=new HashMap<String,String>();
  propertiesKerberosEnv.put("realm","EXAMPLE.COM");
  propertiesKerberosEnv.put("kdc_type","mit-kdc");
  propertiesKerberosEnv.put("password_length","20");
  propertiesKerberosEnv.put("password_min_lowercase_letters","1");
  propertiesKerberosEnv.put("password_min_uppercase_letters","1");
  propertiesKerberosEnv.put("password_min_digits","1");
  propertiesKerberosEnv.put("password_min_punctuation","0");
  propertiesKerberosEnv.put("password_min_whitespace","0");
  Config configKrb5Conf=createMock(Config.class);
  expect(configKrb5Conf.getProperties()).andReturn(propertiesKrb5Conf).times(1);
  Config configKerberosEnv=createMock(Config.class);
  expect(configKerberosEnv.getProperties()).andReturn(propertiesKerberosEnv).times(1);
  Host host1=createMockHost("host1");
  Host host2=createMockHost("host3");
  Host host3=createMockHost("host2");
  Map<String,ServiceComponentHost> service1Component1HostMap=new HashMap<String,ServiceComponentHost>();
  service1Component1HostMap.put("host1",createMockServiceComponentHost());
  Map<String,ServiceComponentHost> service2Component1HostMap=new HashMap<String,ServiceComponentHost>();
  service2Component1HostMap.put("host2",createMockServiceComponentHost());
  Map<String,ServiceComponent> service1ComponentMap=new HashMap<String,ServiceComponent>();
  service1ComponentMap.put("COMPONENT11",createMockComponent("COMPONENT11",true,service1Component1HostMap));
  Map<String,ServiceComponent> service2ComponentMap=new HashMap<String,ServiceComponent>();
  service2ComponentMap.put("COMPONENT21",createMockComponent("COMPONENT21",true,service2Component1HostMap));
  Service service1=createMockService("SERVICE1",service1ComponentMap);
  Service service2=createMockService("SERVICE2",service2ComponentMap);
  Map<String,Service> servicesMap=new HashMap<String,Service>();
  servicesMap.put("SERVICE1",service1);
  servicesMap.put("SERVICE2",service2);
  Cluster cluster=createMock(Cluster.class);
  expect(cluster.getDesiredConfigByType("krb5-conf")).andReturn(configKrb5Conf).times(1);
  expect(cluster.getDesiredConfigByType("kerberos-env")).andReturn(configKerberosEnv).times(1);
  expect(cluster.getSecurityType()).andReturn(SecurityType.KERBEROS).times(1);
  expect(cluster.getCurrentStackVersion()).andReturn(new StackId("HDP","2.2")).times(1);
  expect(cluster.getClusterName()).andReturn("c1").times(4);
  expect(cluster.getHosts()).andReturn(Arrays.asList(host1,host2,host3)).times(1);
  expect(cluster.getServices()).andReturn(servicesMap).times(1);
  Map<String,String> kerberosDescriptorProperties=new HashMap<String,String>();
  kerberosDescriptorProperties.put("additional_realms","");
  kerberosDescriptorProperties.put("keytab_dir","/etc/security/keytabs");
  kerberosDescriptorProperties.put("realm","${kerberos-env/realm}");
  ArrayList<KerberosIdentityDescriptor> service1Component1Identities=new ArrayList<KerberosIdentityDescriptor>();
  service1Component1Identities.add(createMockIdentityDescriptor("s1c1_1.user",createMockPrincipalDescriptor("s1c1_1@${realm}",KerberosPrincipalType.USER,"s1c1",null),createMockKeytabDescriptor("s1c1_1.user.keytab",null)));
  service1Component1Identities.add(createMockIdentityDescriptor("s1c1_1.service",createMockPrincipalDescriptor("s1c1_1/_HOST@${realm}",KerberosPrincipalType.SERVICE,"s1c1",null),createMockKeytabDescriptor("s1c1_1.service.keytab",null)));
  HashMap<String,KerberosComponentDescriptor> service1ComponentDescriptorMap=new HashMap<String,KerberosComponentDescriptor>();
  service1ComponentDescriptorMap.put("COMPONENT11",createMockComponentDescriptor("COMPONENT11",service1Component1Identities,null));
  List<KerberosIdentityDescriptor> service1Identities=new ArrayList<KerberosIdentityDescriptor>();
  service1Identities.add(createMockIdentityDescriptor("s1_1.user",createMockPrincipalDescriptor("s1_1@${realm}",KerberosPrincipalType.USER,"s1",null),createMockKeytabDescriptor("s1_1.user.keytab",null)));
  service1Identities.add(createMockIdentityDescriptor("s1_1.service",createMockPrincipalDescriptor("s1/_HOST@${realm}",KerberosPrincipalType.SERVICE,"s1",null),createMockKeytabDescriptor("s1.service.keytab",null)));
  KerberosServiceDescriptor service1KerberosDescriptor=createMockServiceDescriptor("SERVICE1",service1ComponentDescriptorMap,service1Identities);
  ArrayList<KerberosIdentityDescriptor> service2Component1Identities=new ArrayList<KerberosIdentityDescriptor>();
  service2Component1Identities.add(createMockIdentityDescriptor("s2_1.user",createMockPrincipalDescriptor("s2_1@${realm}",KerberosPrincipalType.USER,"s2",null),createMockKeytabDescriptor("s2_1.user.keytab",null)));
  service2Component1Identities.add(createMockIdentityDescriptor("s2c1_1.service",createMockPrincipalDescriptor("s2c1_1/_HOST@${realm}",KerberosPrincipalType.SERVICE,"s2c1",null),createMockKeytabDescriptor("s2c1_1.service.keytab",null)));
  HashMap<String,KerberosComponentDescriptor> service2ComponentDescriptorMap=new HashMap<String,KerberosComponentDescriptor>();
  service2ComponentDescriptorMap.put("COMPONENT21",createMockComponentDescriptor("COMPONENT21",service2Component1Identities,null));
  KerberosServiceDescriptor service2KerberosDescriptor=createMockServiceDescriptor("SERVICE2",service2ComponentDescriptorMap,null);
  KerberosDescriptor kerberosDescriptor=createMock(KerberosDescriptor.class);
  expect(kerberosDescriptor.getProperties()).andReturn(kerberosDescriptorProperties);
  expect(kerberosDescriptor.getService("SERVICE1")).andReturn(service1KerberosDescriptor).times(1);
  expect(kerberosDescriptor.getService("SERVICE2")).andReturn(service2KerberosDescriptor).times(1);
  setupGetDescriptorFromStack(kerberosDescriptor);
  Map<String,Map<String,String>> existingConfigurations=new HashMap<String,Map<String,String>>();
  existingConfigurations.put("kerberos-env",propertiesKerberosEnv);
  Set<String> services=new HashSet<String>(){
{
      add("SERVICE1");
      add("SERVICE2");
    }
  }
;
  Capture<? extends String> capturePrincipal=newCapture(CaptureType.ALL);
  Capture<? extends String> capturePrincipalForKeytab=newCapture(CaptureType.ALL);
  CreatePrincipalsServerAction createPrincipalsServerAction=injector.getInstance(CreatePrincipalsServerAction.class);
  expect(createPrincipalsServerAction.createPrincipal(capture(capturePrincipal),eq(false),anyObject(Map.class),anyObject(KerberosOperationHandler.class),isNull(ActionLog.class))).andReturn(new CreatePrincipalsServerAction.CreatePrincipalResult("anything","password",1)).times(3);
  CreateKeytabFilesServerAction createKeytabFilesServerAction=injector.getInstance(CreateKeytabFilesServerAction.class);
  expect(createKeytabFilesServerAction.createKeytab(capture(capturePrincipalForKeytab),eq("password"),eq(1),anyObject(KerberosOperationHandler.class),eq(true),eq(true),isNull(ActionLog.class))).andReturn(new Keytab()).times(3);
  replayAll();
  AmbariMetaInfo ambariMetaInfo=injector.getInstance(AmbariMetaInfo.class);
  ambariMetaInfo.init();
  CredentialStoreService credentialStoreService=injector.getInstance(CredentialStoreService.class);
  credentialStoreService.setCredential(cluster.getClusterName(),KerberosHelper.KDC_ADMINISTRATOR_CREDENTIAL_ALIAS,new PrincipalKeyCredential("principal","password"),CredentialStoreType.TEMPORARY);
  KerberosHelper kerberosHelper=injector.getInstance(KerberosHelper.class);
  kerberosHelper.ensureHeadlessIdentities(cluster,existingConfigurations,services);
  verifyAll();
  List<? extends String> capturedPrincipals=capturePrincipal.getValues();
  assertEquals(3,capturedPrincipals.size());
  assertTrue(capturedPrincipals.contains("s1_1@EXAMPLE.COM"));
  assertTrue(capturedPrincipals.contains("s1c1_1@EXAMPLE.COM"));
  assertTrue(capturedPrincipals.contains("s2_1@EXAMPLE.COM"));
  List<? extends String> capturedPrincipalsForKeytab=capturePrincipalForKeytab.getValues();
  assertEquals(3,capturedPrincipalsForKeytab.size());
  assertTrue(capturedPrincipalsForKeytab.contains("s1_1@EXAMPLE.COM"));
  assertTrue(capturedPrincipalsForKeytab.contains("s1c1_1@EXAMPLE.COM"));
  assertTrue(capturedPrincipalsForKeytab.contains("s2_1@EXAMPLE.COM"));
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCreateTestIdentityNoCredentials_ManageIdentitiesFalse() throws Exception {
  testCreateTestIdentity(null,Boolean.FALSE);
}

</code></pre>

<pre class="type-16 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=KerberosInvalidConfigurationException.class) public void testEnableKerberos_ManageIdentitiesTrueKdcNull() throws Exception {
  testEnableKerberos(new PrincipalKeyCredential("principal","password"),null,"true",true,false);
}

</code></pre>

<pre class="type-4 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetActiveIdentities_SingleServiceSingleHost() throws Exception {
  Map<String,Collection<KerberosIdentityDescriptor>> identities=testGetActiveIdentities("c1","host2","SERVICE1",null,true,SecurityType.KERBEROS);
  Assert.assertNotNull(identities);
  Assert.assertEquals(1,identities.size());
  Collection<KerberosIdentityDescriptor> hostIdentities;
  hostIdentities=identities.get("host2");
  Assert.assertNotNull(hostIdentities);
  Assert.assertEquals(2,hostIdentities.size());
  validateIdentities(hostIdentities,new HashMap<String,Map<String,Object>>(){
{
      put("identity1",new HashMap<String,Object>(){
{
          put("principal_name","service1/host2@EXAMPLE.COM");
          put("principal_type",KerberosPrincipalType.SERVICE);
          put("principal_configuration","service1-site/component1.kerberos.principal");
          put("principal_local_username","service1");
          put("keytab_file","${keytab_dir}/service1.keytab");
          put("keytab_owner_name","service1");
          put("keytab_owner_access","rw");
          put("keytab_group_name","hadoop");
          put("keytab_group_access","");
          put("keytab_configuration","service1-site/component1.keytab.file");
          put("keytab_cachable",false);
        }
      }
);
      put("identity3",new HashMap<String,Object>(){
{
          put("principal_name","service1/host2@EXAMPLE.COM");
          put("principal_type",KerberosPrincipalType.SERVICE);
          put("principal_configuration","service1-site/service1.kerberos.principal");
          put("principal_local_username","service1");
          put("keytab_file","${keytab_dir}/service1.service.keytab");
          put("keytab_owner_name","service1");
          put("keytab_owner_access","rw");
          put("keytab_group_name","hadoop");
          put("keytab_group_access","");
          put("keytab_configuration","service1-site/service1.keytab.file");
          put("keytab_cachable",false);
        }
      }
);
    }
  }
);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCreateTestIdentity_ManageIdentitiesFalse() throws Exception {
  testCreateTestIdentity(new PrincipalKeyCredential("principal","password"),Boolean.FALSE);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGetActiveIdentities_SecurityTypeNone_All() throws Exception {
  testGetActiveIdentities_All(SecurityType.NONE);
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetManageIdentitiesDirective_NotSet() throws Exception {
  KerberosHelper kerberosHelper=injector.getInstance(KerberosHelper.class);
  assertEquals(null,kerberosHelper.getManageIdentitiesDirective(null));
  assertEquals(null,kerberosHelper.getManageIdentitiesDirective(Collections.<String,String>emptyMap()));
  assertEquals(null,kerberosHelper.getManageIdentitiesDirective(new HashMap<String,String>(){
{
      put(KerberosHelper.DIRECTIVE_MANAGE_KERBEROS_IDENTITIES,null);
      put("some_directive_0","false");
      put("some_directive_1",null);
    }
  }
));
  assertEquals(null,kerberosHelper.getManageIdentitiesDirective(new HashMap<String,String>(){
{
      put("some_directive_0","false");
      put("some_directive_1",null);
    }
  }
));
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testRegenerateKeytabsValidateSkipInvalidHost() throws Exception {
  testRegenerateKeytabs(new PrincipalKeyCredential("principal","password"),true,true);
}

</code></pre>

<pre class="type-16 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=KerberosMissingAdminCredentialsException.class) public void testCreateTestIdentityNoCredentials_ManageIdentitiesDefault() throws Exception {
  testCreateTestIdentity(null,null);
}

</code></pre>

<pre class="type-5 type-16 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(expected=KerberosMissingAdminCredentialsException.class) public void testEnableKerberosMissingCredentials() throws Exception {
  try {
    testEnableKerberos(null,"mit-kdc","true",true,false);
  }
 catch (  IllegalArgumentException e) {
    Assert.assertTrue(e.getMessage().startsWith("Missing KDC administrator credentials"));
    throw e;
  }
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testEnableKerberos_UpgradeFromAmbari170KerberizedCluster() throws Exception {
  testEnableKerberos_UpgradeFromAmbari170KerberizedCluster(new PrincipalKeyCredential("principal","password"),"mit-kdc","true",true,false);
}

</code></pre>

<pre class="type-4 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSetAuthToLocalRules() throws Exception {
  KerberosHelper kerberosHelper=injector.getInstance(KerberosHelper.class);
  final KerberosPrincipalDescriptor principalDescriptor1=createMock(KerberosPrincipalDescriptor.class);
  expect(principalDescriptor1.getValue()).andReturn("principal1/host1@EXAMPLE.COM").times(1);
  expect(principalDescriptor1.getLocalUsername()).andReturn("principal1_user").times(1);
  final KerberosPrincipalDescriptor principalDescriptor2=createMock(KerberosPrincipalDescriptor.class);
  expect(principalDescriptor2.getValue()).andReturn("principal2/host2@EXAMPLE.COM").times(1);
  expect(principalDescriptor2.getLocalUsername()).andReturn("principal2_user").times(1);
  final KerberosPrincipalDescriptor principalDescriptor3=createMock(KerberosPrincipalDescriptor.class);
  expect(principalDescriptor3.getValue()).andReturn("principal3/host3@EXAMPLE.COM").times(1);
  expect(principalDescriptor3.getLocalUsername()).andReturn("principal3_user").times(1);
  final KerberosIdentityDescriptor identityDescriptor1=createMock(KerberosIdentityDescriptor.class);
  expect(identityDescriptor1.getPrincipalDescriptor()).andReturn(principalDescriptor1).times(1);
  final KerberosIdentityDescriptor identityDescriptor2=createMock(KerberosIdentityDescriptor.class);
  expect(identityDescriptor2.getPrincipalDescriptor()).andReturn(principalDescriptor2).times(1);
  final KerberosIdentityDescriptor identityDescriptor3=createMock(KerberosIdentityDescriptor.class);
  expect(identityDescriptor3.getPrincipalDescriptor()).andReturn(principalDescriptor3).times(1);
  final KerberosServiceDescriptor serviceDescriptor1=createMock(KerberosServiceDescriptor.class);
  expect(serviceDescriptor1.getName()).andReturn("SERVICE1").times(2);
  expect(serviceDescriptor1.getIdentities(true)).andReturn(Arrays.asList(identityDescriptor1,identityDescriptor2,identityDescriptor3)).times(1);
  expect(serviceDescriptor1.getComponents()).andReturn(null).times(1);
  expect(serviceDescriptor1.getAuthToLocalProperties()).andReturn(new HashSet<String>(Arrays.asList("default","explicit_multiple_lines|new_lines","explicit_multiple_lines_escaped|new_lines_escaped","explicit_single_line|spaces","service-site/default","service-site/explicit_multiple_lines|new_lines","service-site/explicit_multiple_lines_escaped|new_lines_escaped","service-site/explicit_single_line|spaces"))).times(1);
  final KerberosDescriptor kerberosDescriptor=createMock(KerberosDescriptor.class);
  expect(kerberosDescriptor.getProperty("additional_realms")).andReturn(null).times(1);
  expect(kerberosDescriptor.getIdentities()).andReturn(null).times(1);
  expect(kerberosDescriptor.getAuthToLocalProperties()).andReturn(null).times(1);
  expect(kerberosDescriptor.getServices()).andReturn(Collections.singletonMap("SERVICE1",serviceDescriptor1)).times(1);
  final Service service1=createNiceMock(Service.class);
  final Cluster cluster=createNiceMock(Cluster.class);
  expect(cluster.getServices()).andReturn(Collections.singletonMap("SERVICE1",service1)).times(1);
  Map<String,Map<String,String>> kerberosConfigurations=new HashMap<String,Map<String,String>>();
  replayAll();
  injector.getInstance(AmbariMetaInfo.class).init();
  Map existingConfigs=new HashMap<String,Map<String,String>>();
  existingConfigs.put("kerberos-env",new HashMap<String,String>());
  kerberosHelper.setAuthToLocalRules(kerberosDescriptor,cluster,"EXAMPLE.COM",existingConfigs,kerberosConfigurations);
  verifyAll();
  Map<String,String> configs;
  configs=kerberosConfigurations.get("");
  assertNotNull(configs);
  assertEquals("RULE:[1:$1@$0](.*@EXAMPLE.COM)s/@.*//\n" + "RULE:[2:$1@$0](principal1@EXAMPLE.COM)s/.*/principal1_user/\n" + "RULE:[2:$1@$0](principal2@EXAMPLE.COM)s/.*/principal2_user/\n"+ "RULE:[2:$1@$0](principal3@EXAMPLE.COM)s/.*/principal3_user/\n"+ "DEFAULT",configs.get("default"));
  assertEquals("RULE:[1:$1@$0](.*@EXAMPLE.COM)s/@.*//\n" + "RULE:[2:$1@$0](principal1@EXAMPLE.COM)s/.*/principal1_user/\n" + "RULE:[2:$1@$0](principal2@EXAMPLE.COM)s/.*/principal2_user/\n"+ "RULE:[2:$1@$0](principal3@EXAMPLE.COM)s/.*/principal3_user/\n"+ "DEFAULT",configs.get("explicit_multiple_lines"));
  assertEquals("RULE:[1:$1@$0](.*@EXAMPLE.COM)s/@.*//\\\n" + "RULE:[2:$1@$0](principal1@EXAMPLE.COM)s/.*/principal1_user/\\\n" + "RULE:[2:$1@$0](principal2@EXAMPLE.COM)s/.*/principal2_user/\\\n"+ "RULE:[2:$1@$0](principal3@EXAMPLE.COM)s/.*/principal3_user/\\\n"+ "DEFAULT",configs.get("explicit_multiple_lines_escaped"));
  assertEquals("RULE:[1:$1@$0](.*@EXAMPLE.COM)s/@.*// " + "RULE:[2:$1@$0](principal1@EXAMPLE.COM)s/.*/principal1_user/ " + "RULE:[2:$1@$0](principal2@EXAMPLE.COM)s/.*/principal2_user/ "+ "RULE:[2:$1@$0](principal3@EXAMPLE.COM)s/.*/principal3_user/ "+ "DEFAULT",configs.get("explicit_single_line"));
  configs=kerberosConfigurations.get("service-site");
  assertNotNull(configs);
  assertEquals("RULE:[1:$1@$0](.*@EXAMPLE.COM)s/@.*//\n" + "RULE:[2:$1@$0](principal1@EXAMPLE.COM)s/.*/principal1_user/\n" + "RULE:[2:$1@$0](principal2@EXAMPLE.COM)s/.*/principal2_user/\n"+ "RULE:[2:$1@$0](principal3@EXAMPLE.COM)s/.*/principal3_user/\n"+ "DEFAULT",configs.get("default"));
  assertEquals("RULE:[1:$1@$0](.*@EXAMPLE.COM)s/@.*//\n" + "RULE:[2:$1@$0](principal1@EXAMPLE.COM)s/.*/principal1_user/\n" + "RULE:[2:$1@$0](principal2@EXAMPLE.COM)s/.*/principal2_user/\n"+ "RULE:[2:$1@$0](principal3@EXAMPLE.COM)s/.*/principal3_user/\n"+ "DEFAULT",configs.get("explicit_multiple_lines"));
  assertEquals("RULE:[1:$1@$0](.*@EXAMPLE.COM)s/@.*//\\\n" + "RULE:[2:$1@$0](principal1@EXAMPLE.COM)s/.*/principal1_user/\\\n" + "RULE:[2:$1@$0](principal2@EXAMPLE.COM)s/.*/principal2_user/\\\n"+ "RULE:[2:$1@$0](principal3@EXAMPLE.COM)s/.*/principal3_user/\\\n"+ "DEFAULT",configs.get("explicit_multiple_lines_escaped"));
  assertEquals("RULE:[1:$1@$0](.*@EXAMPLE.COM)s/@.*// " + "RULE:[2:$1@$0](principal1@EXAMPLE.COM)s/.*/principal1_user/ " + "RULE:[2:$1@$0](principal2@EXAMPLE.COM)s/.*/principal2_user/ "+ "RULE:[2:$1@$0](principal3@EXAMPLE.COM)s/.*/principal3_user/ "+ "DEFAULT",configs.get("explicit_single_line"));
}

</code></pre>

<pre class="type-4 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetActiveIdentities_SingleService() throws Exception {
  Map<String,Collection<KerberosIdentityDescriptor>> identities=testGetActiveIdentities("c1",null,"SERVICE1",null,true,SecurityType.KERBEROS);
  Assert.assertNotNull(identities);
  Assert.assertEquals(2,identities.size());
  Collection<KerberosIdentityDescriptor> hostIdentities;
  hostIdentities=identities.get("host1");
  Assert.assertNotNull(hostIdentities);
  Assert.assertEquals(2,hostIdentities.size());
  validateIdentities(hostIdentities,new HashMap<String,Map<String,Object>>(){
{
      put("identity1",new HashMap<String,Object>(){
{
          put("principal_name","service1/host1@EXAMPLE.COM");
          put("principal_type",KerberosPrincipalType.SERVICE);
          put("principal_configuration","service1-site/component1.kerberos.principal");
          put("principal_local_username","service1");
          put("keytab_file","${keytab_dir}/service1.keytab");
          put("keytab_owner_name","service1");
          put("keytab_owner_access","rw");
          put("keytab_group_name","hadoop");
          put("keytab_group_access","");
          put("keytab_configuration","service1-site/component1.keytab.file");
          put("keytab_cachable",false);
        }
      }
);
      put("identity3",new HashMap<String,Object>(){
{
          put("principal_name","service1/host1@EXAMPLE.COM");
          put("principal_type",KerberosPrincipalType.SERVICE);
          put("principal_configuration","service1-site/service1.kerberos.principal");
          put("principal_local_username","service1");
          put("keytab_file","${keytab_dir}/service1.service.keytab");
          put("keytab_owner_name","service1");
          put("keytab_owner_access","rw");
          put("keytab_group_name","hadoop");
          put("keytab_group_access","");
          put("keytab_configuration","service1-site/service1.keytab.file");
          put("keytab_cachable",false);
        }
      }
);
    }
  }
);
  hostIdentities=identities.get("host2");
  Assert.assertNotNull(hostIdentities);
  Assert.assertEquals(2,hostIdentities.size());
  validateIdentities(hostIdentities,new HashMap<String,Map<String,Object>>(){
{
      put("identity1",new HashMap<String,Object>(){
{
          put("principal_name","service1/host2@EXAMPLE.COM");
          put("principal_type",KerberosPrincipalType.SERVICE);
          put("principal_configuration","service1-site/component1.kerberos.principal");
          put("principal_local_username","service1");
          put("keytab_file","${keytab_dir}/service1.keytab");
          put("keytab_owner_name","service1");
          put("keytab_owner_access","rw");
          put("keytab_group_name","hadoop");
          put("keytab_group_access","");
          put("keytab_configuration","service1-site/component1.keytab.file");
          put("keytab_cachable",false);
        }
      }
);
      put("identity3",new HashMap<String,Object>(){
{
          put("principal_name","service1/host2@EXAMPLE.COM");
          put("principal_type",KerberosPrincipalType.SERVICE);
          put("principal_configuration","service1-site/service1.kerberos.principal");
          put("principal_local_username","service1");
          put("keytab_file","${keytab_dir}/service1.service.keytab");
          put("keytab_owner_name","service1");
          put("keytab_owner_access","rw");
          put("keytab_group_name","hadoop");
          put("keytab_group_access","");
          put("keytab_configuration","service1-site/service1.keytab.file");
          put("keytab_cachable",false);
        }
      }
);
    }
  }
);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testEnsureIdentities() throws Exception {
  testEnsureIdentities(new PrincipalKeyCredential("principal","password"),null);
}

</code></pre>

<pre class="type-5 type-16 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(expected=KerberosMissingAdminCredentialsException.class) public void testEnableKerberosInvalidCredentials() throws Exception {
  try {
    testEnableKerberos(new PrincipalKeyCredential("invalid_principal","password"),"mit-kdc","true",true,false);
  }
 catch (  IllegalArgumentException e) {
    Assert.assertTrue(e.getMessage().startsWith("Invalid KDC administrator credentials"));
    throw e;
  }
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testRegenerateKeytabsValidateRequestStageContainer() throws Exception {
  testRegenerateKeytabs(new PrincipalKeyCredential("principal","password"),true,false);
}

</code></pre>

<pre class="type-16 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=AmbariException.class) public void testEnableKerberos_ManageIdentitiesTrueKdcNone() throws Exception {
  testEnableKerberos(new PrincipalKeyCredential("principal","password"),"none","true",true,false);
}

</code></pre>

<pre class="type-16 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=AmbariException.class) public void testMissingKerberosEnvConf() throws Exception {
  KerberosHelper kerberosHelper=injector.getInstance(KerberosHelper.class);
  final Map<String,String> kerberosEnvProperties=createMock(Map.class);
  expect(kerberosEnvProperties.get("realm")).andReturn("EXAMPLE.COM").once();
  expect(kerberosEnvProperties.get("kdc_host")).andReturn("10.0.100.1").once();
  final Map<String,String> krb5ConfProperties=createMock(Map.class);
  expect(krb5ConfProperties.get("kadmin_host")).andReturn("10.0.100.1").once();
  final Config krb5ConfConfig=createMock(Config.class);
  expect(krb5ConfConfig.getProperties()).andReturn(krb5ConfProperties).once();
  final Cluster cluster=createNiceMock(Cluster.class);
  expect(cluster.getDesiredConfigByType("krb5-conf")).andReturn(krb5ConfConfig).once();
  replayAll();
  kerberosHelper.toggleKerberos(cluster,SecurityType.KERBEROS,null,true);
  verifyAll();
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testEnableKerberos() throws Exception {
  testEnableKerberos(new PrincipalKeyCredential("principal","password"),"mit-kdc","true",true,false);
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetManageIdentitiesDirective_True() throws Exception {
  KerberosHelper kerberosHelper=injector.getInstance(KerberosHelper.class);
  assertEquals(Boolean.TRUE,kerberosHelper.getManageIdentitiesDirective(Collections.singletonMap(KerberosHelper.DIRECTIVE_MANAGE_KERBEROS_IDENTITIES,"true")));
  assertEquals(Boolean.TRUE,kerberosHelper.getManageIdentitiesDirective(Collections.singletonMap(KerberosHelper.DIRECTIVE_MANAGE_KERBEROS_IDENTITIES,"not_false")));
  assertEquals(Boolean.TRUE,kerberosHelper.getManageIdentitiesDirective(new HashMap<String,String>(){
{
      put(KerberosHelper.DIRECTIVE_MANAGE_KERBEROS_IDENTITIES,"true");
      put("some_directive_0","false");
      put("some_directive_1",null);
    }
  }
));
}

</code></pre>

<pre class="type-4 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetActiveIdentities_SingleHost() throws Exception {
  Map<String,Collection<KerberosIdentityDescriptor>> identities=testGetActiveIdentities("c1","host1",null,null,true,SecurityType.KERBEROS);
  Assert.assertNotNull(identities);
  Assert.assertEquals(1,identities.size());
  Collection<KerberosIdentityDescriptor> hostIdentities;
  hostIdentities=identities.get("host1");
  Assert.assertNotNull(hostIdentities);
  Assert.assertEquals(3,hostIdentities.size());
  validateIdentities(hostIdentities,new HashMap<String,Map<String,Object>>(){
{
      put("identity1",new HashMap<String,Object>(){
{
          put("principal_name","service1/host1@EXAMPLE.COM");
          put("principal_type",KerberosPrincipalType.SERVICE);
          put("principal_configuration","service1-site/component1.kerberos.principal");
          put("principal_local_username","service1");
          put("keytab_file","${keytab_dir}/service1.keytab");
          put("keytab_owner_name","service1");
          put("keytab_owner_access","rw");
          put("keytab_group_name","hadoop");
          put("keytab_group_access","");
          put("keytab_configuration","service1-site/component1.keytab.file");
          put("keytab_cachable",false);
        }
      }
);
      put("identity2",new HashMap<String,Object>(){
{
          put("principal_name","component2/host1@EXAMPLE.COM");
          put("principal_type",KerberosPrincipalType.SERVICE);
          put("principal_configuration","service2-site/component2.kerberos.principal");
          put("principal_local_username","service2");
          put("keytab_file","${keytab_dir}/service2.keytab");
          put("keytab_owner_name","service2");
          put("keytab_owner_access","rw");
          put("keytab_group_name","hadoop");
          put("keytab_group_access","");
          put("keytab_configuration","service2-site/component2.keytab.file");
          put("keytab_cachable",false);
        }
      }
);
      put("identity3",new HashMap<String,Object>(){
{
          put("principal_name","service1/host1@EXAMPLE.COM");
          put("principal_type",KerberosPrincipalType.SERVICE);
          put("principal_configuration","service1-site/service1.kerberos.principal");
          put("principal_local_username","service1");
          put("keytab_file","${keytab_dir}/service1.service.keytab");
          put("keytab_owner_name","service1");
          put("keytab_owner_access","rw");
          put("keytab_group_name","hadoop");
          put("keytab_group_access","");
          put("keytab_configuration","service1-site/service1.keytab.file");
          put("keytab_cachable",false);
        }
      }
);
    }
  }
);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testEnableKerberos_GetKerberosDescriptorFromStack() throws Exception {
  testEnableKerberos(new PrincipalKeyCredential("principal","password"),"mit-kdc","true",false,true);
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetServiceConfigurationUpdates() throws Exception {
  KerberosHelper kerberosHelper=injector.getInstance(KerberosHelper.class);
  final Host hostA=createMockHost("hostA");
  final Host hostB=createMockHost("hostB");
  final Host hostC=createMockHost("hostC");
  Collection<Host> hosts=Arrays.asList(hostA,hostB,hostC);
  final Map<String,String> kerberosEnvProperties=new HashMap<String,String>(){
{
      put("kdc_type","mit-kdc");
      put("realm","FOOBAR.COM");
      put("case_insensitive_username_rules","false");
    }
  }
;
  final Config kerberosEnvConfig=createMock(Config.class);
  expect(kerberosEnvConfig.getProperties()).andReturn(kerberosEnvProperties).atLeastOnce();
  final Map<String,String> krb5ConfProperties=createMock(Map.class);
  final Config krb5ConfConfig=createMock(Config.class);
  expect(krb5ConfConfig.getProperties()).andReturn(krb5ConfProperties).atLeastOnce();
  final KerberosPrincipalDescriptor principalDescriptor1=createMockPrincipalDescriptor("service1/_HOST@${realm}",KerberosPrincipalType.SERVICE,"service1user","service1-site/service.kerberos.principal");
  final KerberosPrincipalDescriptor principalDescriptor1a=createMockPrincipalDescriptor("component1a/_HOST@${realm}",KerberosPrincipalType.SERVICE,"service1user","service1-site/component1a.kerberos.principal");
  final KerberosPrincipalDescriptor principalDescriptor1b=createMockPrincipalDescriptor("component1b/_HOST@${realm}",KerberosPrincipalType.SERVICE,"service1user","service1-site/component1b.kerberos.principal");
  final KerberosPrincipalDescriptor principalDescriptor2a=createMockPrincipalDescriptor("component2a/_HOST@${realm}",KerberosPrincipalType.SERVICE,"service2user","service2-site/component2a.kerberos.principal");
  final KerberosPrincipalDescriptor principalDescriptor2b=createMockPrincipalDescriptor("component2b/_HOST@${realm}",KerberosPrincipalType.SERVICE,"service2user","service2-site/component2b.kerberos.principal");
  final KerberosPrincipalDescriptor principalDescriptor3a=createMockPrincipalDescriptor("component3a/_HOST@${realm}",KerberosPrincipalType.SERVICE,"service3user","service3-site/component3a.kerberos.principal");
  final KerberosKeytabDescriptor keytabDescriptor1=createMockKeytabDescriptor("keytab1","service1-site/service.kerberos.keytab");
  final KerberosKeytabDescriptor keytabDescriptor1a=createMockKeytabDescriptor("keytab1a","service1-site/component1a.kerberos.keytab");
  final KerberosKeytabDescriptor keytabDescriptor1b=createMockKeytabDescriptor("keytab1b","service1-site/component1b.kerberos.keytab");
  final KerberosKeytabDescriptor keytabDescriptor2a=createMockKeytabDescriptor("keytab2a","service2-site/component2a.kerberos.keytab");
  final KerberosKeytabDescriptor keytabDescriptor2b=createMockKeytabDescriptor("keytab2b","service2-site/component2b.kerberos.keytab");
  final KerberosKeytabDescriptor keytabDescriptor3a=createMockKeytabDescriptor("keytab3a","service3-site/component3a.kerberos.keytab");
  final KerberosIdentityDescriptor identityDescriptor1=createMockIdentityDescriptor("identity1",principalDescriptor1,keytabDescriptor1);
  final KerberosIdentityDescriptor identityDescriptor1a=createMockIdentityDescriptor("identity1a",principalDescriptor1a,keytabDescriptor1a);
  final KerberosIdentityDescriptor identityDescriptor1b=createMockIdentityDescriptor("identity1b",principalDescriptor1b,keytabDescriptor1b);
  final KerberosIdentityDescriptor identityDescriptor2a=createMockIdentityDescriptor("identity2a",principalDescriptor2a,keytabDescriptor2a);
  final KerberosIdentityDescriptor identityDescriptor2b=createMockIdentityDescriptor("identity2b",principalDescriptor2b,keytabDescriptor2b);
  final KerberosIdentityDescriptor identityDescriptor3a=createMockIdentityDescriptor("identity3a",principalDescriptor3a,keytabDescriptor3a);
  final KerberosComponentDescriptor componentDescriptor1a=createMockComponentDescriptor("COMPONENT1A",new ArrayList<KerberosIdentityDescriptor>(){
{
      add(identityDescriptor1a);
    }
  }
,new HashMap<String,KerberosConfigurationDescriptor>(){
{
      put("service1-site",createMockConfigurationDescriptor(Collections.singletonMap("component1a.property","${replacement1}")));
    }
  }
);
  final KerberosComponentDescriptor componentDescriptor1b=createMockComponentDescriptor("COMPONENT1B",new ArrayList<KerberosIdentityDescriptor>(){
{
      add(identityDescriptor1b);
    }
  }
,new HashMap<String,KerberosConfigurationDescriptor>(){
{
      put("service1-site",createMockConfigurationDescriptor(Collections.singletonMap("component1b.property","${type1/replacement1}")));
    }
  }
);
  final KerberosComponentDescriptor componentDescriptor2a=createMockComponentDescriptor("COMPONENT2A",new ArrayList<KerberosIdentityDescriptor>(){
{
      add(identityDescriptor2a);
    }
  }
,new HashMap<String,KerberosConfigurationDescriptor>(){
{
      put("service2-site",createMockConfigurationDescriptor(Collections.singletonMap("component2a.property","${type1/replacement2}")));
    }
  }
);
  final KerberosComponentDescriptor componentDescriptor2b=createMockComponentDescriptor("COMPONENT2B",new ArrayList<KerberosIdentityDescriptor>(){
{
      add(identityDescriptor2b);
    }
  }
,new HashMap<String,KerberosConfigurationDescriptor>(){
{
      put("service2-site",createMockConfigurationDescriptor(Collections.singletonMap("component2b.property","${type2/replacement1}")));
    }
  }
);
  final KerberosComponentDescriptor componentDescriptor3a=createMockComponentDescriptor("COMPONENT3A",new ArrayList<KerberosIdentityDescriptor>(){
{
      add(identityDescriptor3a);
    }
  }
,new HashMap<String,KerberosConfigurationDescriptor>(){
{
      put("service3-site",createMockConfigurationDescriptor(Collections.singletonMap("component3a.property","${type3/replacement1}")));
      put("core-site",createMockConfigurationDescriptor(Collections.singletonMap("component3b.property","${type3/replacement2}")));
    }
  }
);
  final KerberosServiceDescriptor serviceDescriptor1=createMockServiceDescriptor("SERVICE1",new HashMap<String,KerberosComponentDescriptor>(){
{
      put("COMPONENT1A",componentDescriptor1a);
      put("COMPONENT1B",componentDescriptor1b);
    }
  }
,new ArrayList<KerberosIdentityDescriptor>(){
{
      add(identityDescriptor1);
    }
  }
);
  final KerberosServiceDescriptor serviceDescriptor2=createMockServiceDescriptor("SERVICE2",new HashMap<String,KerberosComponentDescriptor>(){
{
      put("COMPONENT2A",componentDescriptor2a);
      put("COMPONENT2B",componentDescriptor2b);
    }
  }
,Collections.<KerberosIdentityDescriptor>emptyList());
  final KerberosServiceDescriptor serviceDescriptor3=createMockServiceDescriptor("SERVICE3",new HashMap<String,KerberosComponentDescriptor>(){
{
      put("COMPONENT3A",componentDescriptor3a);
    }
  }
,Collections.<KerberosIdentityDescriptor>emptyList());
  final Map<String,String> kerberosDescriptorProperties=new HashMap<String,String>();
  kerberosDescriptorProperties.put("realm","${kerberos-env/realm}");
  final KerberosDescriptor kerberosDescriptor=createMock(KerberosDescriptor.class);
  expect(kerberosDescriptor.getProperties()).andReturn(kerberosDescriptorProperties).atLeastOnce();
  expect(kerberosDescriptor.getServices()).andReturn(new HashMap<String,KerberosServiceDescriptor>(){
{
      put("SERVICE1",serviceDescriptor1);
      put("SERVICE2",serviceDescriptor2);
      put("SERVICE3",serviceDescriptor3);
    }
  }
).atLeastOnce();
  expect(kerberosDescriptor.getService("SERVICE1")).andReturn(serviceDescriptor1).atLeastOnce();
  expect(kerberosDescriptor.getService("SERVICE2")).andReturn(serviceDescriptor2).atLeastOnce();
  expect(kerberosDescriptor.getService("SERVICE3")).andReturn(serviceDescriptor3).atLeastOnce();
  expect(kerberosDescriptor.getProperty("additional_realms")).andReturn(null).atLeastOnce();
  expect(kerberosDescriptor.getIdentities()).andReturn(null).atLeastOnce();
  expect(kerberosDescriptor.getAuthToLocalProperties()).andReturn(Collections.singleton("core-site/auth.to.local")).atLeastOnce();
  final ResourceProvider artifactResourceProvider=createMock(ArtifactResourceProvider.class);
  expect(artifactResourceProvider.getResources(anyObject(Request.class),anyObject(Predicate.class))).andReturn(Collections.<Resource>emptySet()).atLeastOnce();
  expect(metaInfo.getKerberosDescriptor("HDP","2.2")).andReturn(kerberosDescriptor).atLeastOnce();
  expect(clusterController.ensureResourceProvider(Resource.Type.Artifact)).andReturn(artifactResourceProvider).atLeastOnce();
  RecommendationResponse.BlueprintConfigurations coreSiteRecommendation=createMock(RecommendationResponse.BlueprintConfigurations.class);
  expect(coreSiteRecommendation.getProperties()).andReturn(Collections.singletonMap("newPropertyRecommendation","newPropertyRecommendation"));
  RecommendationResponse.BlueprintConfigurations newTypeRecommendation=createMock(RecommendationResponse.BlueprintConfigurations.class);
  expect(newTypeRecommendation.getProperties()).andReturn(Collections.singletonMap("newTypeRecommendation","newTypeRecommendation"));
  RecommendationResponse.BlueprintConfigurations type1Recommendation=createMock(RecommendationResponse.BlueprintConfigurations.class);
  expect(type1Recommendation.getProperties()).andReturn(Collections.singletonMap("replacement1","not replaced"));
  RecommendationResponse.BlueprintConfigurations service1SiteRecommendation=createMock(RecommendationResponse.BlueprintConfigurations.class);
  expect(service1SiteRecommendation.getProperties()).andReturn(Collections.singletonMap("component1b.property","replaced value"));
  Map<String,RecommendationResponse.BlueprintConfigurations> configurations=new HashMap<String,RecommendationResponse.BlueprintConfigurations>();
  configurations.put("core-site",coreSiteRecommendation);
  configurations.put("new-type",newTypeRecommendation);
  configurations.put("type1",type1Recommendation);
  configurations.put("service1-site",service1SiteRecommendation);
  RecommendationResponse.Blueprint blueprint=createMock(RecommendationResponse.Blueprint.class);
  expect(blueprint.getConfigurations()).andReturn(configurations).once();
  RecommendationResponse.Recommendation recommendations=createMock(RecommendationResponse.Recommendation.class);
  expect(recommendations.getBlueprint()).andReturn(blueprint).once();
  RecommendationResponse recommendationResponse=createMock(RecommendationResponse.class);
  expect(recommendationResponse.getRecommendations()).andReturn(recommendations).once();
  StackAdvisorHelper stackAdvisorHelper=injector.getInstance(StackAdvisorHelper.class);
  expect(stackAdvisorHelper.recommend(anyObject(StackAdvisorRequest.class))).andReturn(null).once();
  expect(stackAdvisorHelper.recommend(anyObject(StackAdvisorRequest.class))).andReturn(recommendationResponse).once();
  final Service service1=createMockService("SERVICE1",new HashMap<String,ServiceComponent>(){
{
      put("COMPONENT1A",createMockComponent("COMPONENT1A",true,new HashMap<String,ServiceComponentHost>(){
{
          put("hostA",createMockServiceComponentHost());
        }
      }
));
      put("COMPONENT1B",createMockComponent("COMPONENT1B",false,new HashMap<String,ServiceComponentHost>(){
{
          put("hostB",createMockServiceComponentHost());
          put("hostC",createMockServiceComponentHost());
        }
      }
));
    }
  }
);
  final Service service2=createMockService("SERVICE2",new HashMap<String,ServiceComponent>(){
{
      put("COMPONENT2A",createMockComponent("COMPONENT2A",true,new HashMap<String,ServiceComponentHost>(){
{
          put("hostA",createMockServiceComponentHost());
        }
      }
));
      put("COMPONENT2B",createMockComponent("COMPONENT2B",false,new HashMap<String,ServiceComponentHost>(){
{
          put("hostB",createMockServiceComponentHost());
          put("hostC",createMockServiceComponentHost());
        }
      }
));
    }
  }
);
  final Service service3=createMockService("SERVICE3",new HashMap<String,ServiceComponent>(){
{
      put("COMPONENT3A",createMockComponent("COMPONENT3A",true,new HashMap<String,ServiceComponentHost>(){
{
          put("hostA",createMockServiceComponentHost());
        }
      }
));
    }
  }
);
  final Cluster cluster=createMock(Cluster.class);
  expect(cluster.getDesiredConfigByType("krb5-conf")).andReturn(krb5ConfConfig).atLeastOnce();
  expect(cluster.getDesiredConfigByType("kerberos-env")).andReturn(kerberosEnvConfig).atLeastOnce();
  expect(cluster.getSecurityType()).andReturn(SecurityType.KERBEROS).atLeastOnce();
  expect(cluster.getCurrentStackVersion()).andReturn(new StackId("HDP","2.2")).atLeastOnce();
  expect(cluster.getClusterName()).andReturn("c1").atLeastOnce();
  expect(cluster.getHosts()).andReturn(hosts).anyTimes();
  expect(cluster.getServices()).andReturn(new HashMap<String,Service>(){
{
      put("SERVICE1",service1);
      put("SERVICE2",service2);
      put("SERVICE3",service3);
    }
  }
).anyTimes();
  expect(cluster.isBluePrintDeployed()).andReturn(false).atLeastOnce();
  final Map<String,Map<String,String>> existingConfigurations=new HashMap<String,Map<String,String>>(){
{
      put("kerberos-env",kerberosEnvProperties);
      put("",new HashMap<String,String>(){
{
          put("replacement1","value1");
        }
      }
);
      put("type1",new HashMap<String,String>(){
{
          put("replacement1","value2");
          put("replacement2","value3");
        }
      }
);
      put("type2",new HashMap<String,String>(){
{
          put("replacement1","value4");
          put("replacement2","value5");
        }
      }
);
      put("type3",new HashMap<String,String>(){
{
          put("replacement1","value6");
          put("replacement2","value7");
        }
      }
);
    }
  }
;
  replayAll();
  injector.getInstance(AmbariMetaInfo.class).init();
  Map<String,Map<String,String>> updates1=kerberosHelper.getServiceConfigurationUpdates(cluster,existingConfigurations,new HashSet<String>(Arrays.asList("SERVICE1","SERVICE2","SERVICE3")),false,true,true);
  Map<String,Map<String,String>> updates2=kerberosHelper.getServiceConfigurationUpdates(cluster,existingConfigurations,new HashSet<String>(Arrays.asList("SERVICE1","SERVICE3")),false,true,true);
  verifyAll();
  Map<String,Map<String,String>> expectedUpdates=new HashMap<String,Map<String,String>>(){
{
      put("service1-site",new HashMap<String,String>(){
{
          put("service.kerberos.principal","service1/_HOST@FOOBAR.COM");
          put("service.kerberos.keytab","keytab1");
          put("component1a.kerberos.principal","component1a/_HOST@FOOBAR.COM");
          put("component1a.kerberos.keytab","keytab1a");
          put("component1a.property","value1");
          put("component1b.kerberos.principal","component1b/_HOST@FOOBAR.COM");
          put("component1b.kerberos.keytab","keytab1b");
          put("component1b.property","value2");
        }
      }
);
      put("service2-site",new HashMap<String,String>(){
{
          put("component2a.kerberos.principal","component2a/_HOST@FOOBAR.COM");
          put("component2a.kerberos.keytab","keytab2a");
          put("component2a.property","value3");
          put("component2b.kerberos.principal","component2b/_HOST@FOOBAR.COM");
          put("component2b.kerberos.keytab","keytab2b");
          put("component2b.property","value4");
        }
      }
);
      put("service3-site",new HashMap<String,String>(){
{
          put("component3a.kerberos.principal","component3a/_HOST@FOOBAR.COM");
          put("component3a.kerberos.keytab","keytab3a");
          put("component3a.property","value6");
        }
      }
);
      put("core-site",new HashMap<String,String>(){
{
          put("auth.to.local","RULE:[1:$1@$0](.*@FOOBAR.COM)s/@.*//\n" + "RULE:[2:$1@$0](component1a@FOOBAR.COM)s/.*/service1user/\n" + "RULE:[2:$1@$0](component1b@FOOBAR.COM)s/.*/service1user/\n"+ "RULE:[2:$1@$0](component2a@FOOBAR.COM)s/.*/service2user/\n"+ "RULE:[2:$1@$0](component2b@FOOBAR.COM)s/.*/service2user/\n"+ "RULE:[2:$1@$0](component3a@FOOBAR.COM)s/.*/service3user/\n"+ "RULE:[2:$1@$0](service1@FOOBAR.COM)s/.*/service1user/\n"+ "DEFAULT");
          put("component3b.property","value7");
        }
      }
);
    }
  }
;
  assertEquals(expectedUpdates,updates1);
  expectedUpdates.remove("service2-site");
  expectedUpdates.get("core-site").put("newPropertyRecommendation","newPropertyRecommendation");
  expectedUpdates.get("service1-site").put("component1b.property","replaced value");
  expectedUpdates.put("new-type",new HashMap<String,String>(){
{
      put("newTypeRecommendation","newTypeRecommendation");
    }
  }
);
  assertEquals(expectedUpdates,updates2);
  Map<String,Map<String,String>> expectedExistingConfigurations=new HashMap<String,Map<String,String>>(){
{
      put("kerberos-env",new HashMap<String,String>(){
{
          put("kdc_type","mit-kdc");
          put("realm","FOOBAR.COM");
          put("case_insensitive_username_rules","false");
        }
      }
);
      put("",new HashMap<String,String>(){
{
          put("replacement1","value1");
        }
      }
);
      put("type1",new HashMap<String,String>(){
{
          put("replacement1","value2");
          put("replacement2","value3");
        }
      }
);
      put("type2",new HashMap<String,String>(){
{
          put("replacement1","value4");
          put("replacement2","value5");
        }
      }
);
      put("type3",new HashMap<String,String>(){
{
          put("replacement1","value6");
          put("replacement2","value7");
        }
      }
);
    }
  }
;
  assertEquals(expectedExistingConfigurations,existingConfigurations);
}

</code></pre>

<pre class="type-2 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testIsClusterKerberosEnabled_false() throws Exception {
  KerberosHelper kerberosHelper=injector.getInstance(KerberosHelper.class);
  Cluster cluster=createStrictMock(Cluster.class);
  expect(cluster.getSecurityType()).andReturn(SecurityType.NONE);
  replay(cluster);
  assertFalse(kerberosHelper.isClusterKerberosEnabled(cluster));
  verify(cluster);
}

</code></pre>

<pre class="type-2 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testIsClusterKerberosEnabled_true() throws Exception {
  KerberosHelper kerberosHelper=injector.getInstance(KerberosHelper.class);
  Cluster cluster=createStrictMock(Cluster.class);
  expect(cluster.getSecurityType()).andReturn(SecurityType.KERBEROS);
  replay(cluster);
  assertTrue(kerberosHelper.isClusterKerberosEnabled(cluster));
  verify(cluster);
}

</code></pre>

<pre class="type-4 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetActiveIdentities_SingleComponent() throws Exception {
  Map<String,Collection<KerberosIdentityDescriptor>> identities=testGetActiveIdentities("c1",null,null,"COMPONENT2",true,SecurityType.KERBEROS);
  Assert.assertNotNull(identities);
  Assert.assertEquals(2,identities.size());
  Collection<KerberosIdentityDescriptor> hostIdentities;
  hostIdentities=identities.get("host1");
  Assert.assertNotNull(hostIdentities);
  Assert.assertEquals(1,hostIdentities.size());
  validateIdentities(hostIdentities,new HashMap<String,Map<String,Object>>(){
{
      put("identity2",new HashMap<String,Object>(){
{
          put("principal_name","component2/host1@EXAMPLE.COM");
          put("principal_type",KerberosPrincipalType.SERVICE);
          put("principal_configuration","service2-site/component2.kerberos.principal");
          put("principal_local_username","service2");
          put("keytab_file","${keytab_dir}/service2.keytab");
          put("keytab_owner_name","service2");
          put("keytab_owner_access","rw");
          put("keytab_group_name","hadoop");
          put("keytab_group_access","");
          put("keytab_configuration","service2-site/component2.keytab.file");
          put("keytab_cachable",false);
        }
      }
);
    }
  }
);
  hostIdentities=identities.get("host2");
  Assert.assertNotNull(hostIdentities);
  Assert.assertEquals(1,hostIdentities.size());
  validateIdentities(hostIdentities,new HashMap<String,Map<String,Object>>(){
{
      put("identity2",new HashMap<String,Object>(){
{
          put("principal_name","component2/host2@EXAMPLE.COM");
          put("principal_type",KerberosPrincipalType.SERVICE);
          put("principal_configuration","service2-site/component2.kerberos.principal");
          put("principal_local_username","service2");
          put("keytab_file","${keytab_dir}/service2.keytab");
          put("keytab_owner_name","service2");
          put("keytab_owner_access","rw");
          put("keytab_group_name","hadoop");
          put("keytab_group_access","");
          put("keytab_configuration","service2-site/component2.keytab.file");
          put("keytab_cachable",false);
        }
      }
);
    }
  }
);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDisableKerberos() throws Exception {
  testDisableKerberos(new PrincipalKeyCredential("principal","password"),false,true);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDeleteTestIdentity() throws Exception {
  testDeleteTestIdentity(new PrincipalKeyCredential("principal","password"));
}

</code></pre>

<pre class="type-5 type-16 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(expected=KerberosMissingAdminCredentialsException.class) public void testEnsureIdentitiesMissingCredentials() throws Exception {
  try {
    testEnsureIdentities(null,null);
  }
 catch (  IllegalArgumentException e) {
    Assert.assertTrue(e.getMessage().startsWith("Missing KDC administrator credentials"));
    throw e;
  }
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testEnableKerberos_GetKerberosDescriptorFromCluster() throws Exception {
  testEnableKerberos(new PrincipalKeyCredential("principal","password"),"mit-kdc","true",true,false);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCreateTestIdentity_ManageIdentitiesDefault() throws Exception {
  testCreateTestIdentity(new PrincipalKeyCredential("principal","password"),null);
}

</code></pre>

<pre class="type-16 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=KerberosMissingAdminCredentialsException.class) public void testCreateTestIdentityNoCredentials_ManageIdentitiesTrue() throws Exception {
  testCreateTestIdentity(null,Boolean.TRUE);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGetActiveIdentities_SecurityTypeKerberos_All() throws Exception {
  testGetActiveIdentities_All(SecurityType.KERBEROS);
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetManageIdentitiesDirective_False() throws Exception {
  KerberosHelper kerberosHelper=injector.getInstance(KerberosHelper.class);
  assertEquals(Boolean.FALSE,kerberosHelper.getManageIdentitiesDirective(Collections.singletonMap(KerberosHelper.DIRECTIVE_MANAGE_KERBEROS_IDENTITIES,"false")));
  assertEquals(Boolean.FALSE,kerberosHelper.getManageIdentitiesDirective(new HashMap<String,String>(){
{
      put(KerberosHelper.DIRECTIVE_MANAGE_KERBEROS_IDENTITIES,"false");
      put("some_directive_0","false");
      put("some_directive_1",null);
    }
  }
));
}

</code></pre>

<pre class="type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void setUp() throws Exception {
  reset(clusterController);
  reset(metaInfo);
  final KerberosOperationHandlerFactory kerberosOperationHandlerFactory=createMock(KerberosOperationHandlerFactory.class);
  expect(kerberosOperationHandlerFactory.getKerberosOperationHandler(KDCType.NONE)).andReturn(null).anyTimes();
  expect(kerberosOperationHandlerFactory.getKerberosOperationHandler(KDCType.MIT_KDC)).andReturn(new KerberosOperationHandler(){
    @Override public void open(    PrincipalKeyCredential administratorCredentials,    String defaultRealm,    Map<String,String> kerberosConfiguration) throws KerberosOperationException {
      setAdministratorCredential(administratorCredentials);
      setDefaultRealm(defaultRealm);
      setOpen(true);
    }
    @Override public void close() throws KerberosOperationException {
    }
    @Override public boolean principalExists(    String principal) throws KerberosOperationException {
      return "principal".equals(principal);
    }
    @Override public Integer createPrincipal(    String principal,    String password,    boolean service) throws KerberosOperationException {
      return null;
    }
    @Override public Integer setPrincipalPassword(    String principal,    String password) throws KerberosOperationException {
      return null;
    }
    @Override public boolean removePrincipal(    String principal) throws KerberosOperationException {
      return false;
    }
  }
).anyTimes();
  injector=Guice.createInjector(new AbstractModule(){
    @Override protected void configure(){
      bind(EntityManager.class).toInstance(createNiceMock(EntityManager.class));
      bind(DBAccessor.class).toInstance(createNiceMock(DBAccessor.class));
      bind(ClusterFactory.class).toInstance(createNiceMock(ClusterFactory.class));
      bind(HostFactory.class).toInstance(createNiceMock(HostFactory.class));
      bind(SecurityHelper.class).toInstance(createNiceMock(SecurityHelper.class));
      bind(OsFamily.class).toInstance(createNiceMock(OsFamily.class));
      bind(AmbariCustomCommandExecutionHelper.class).toInstance(createNiceMock(AmbariCustomCommandExecutionHelper.class));
      bind(AmbariManagementController.class).toInstance(createNiceMock(AmbariManagementController.class));
      bind(AmbariMetaInfo.class).toInstance(metaInfo);
      bind(ActionManager.class).toInstance(createNiceMock(ActionManager.class));
      bind(RequestFactory.class).toInstance(createNiceMock(RequestFactory.class));
      bind(StageFactory.class).toInstance(createNiceMock(StageFactory.class));
      bind(RoleGraphFactory.class).to(RoleGraphFactoryImpl.class);
      bind(Clusters.class).toInstance(createNiceMock(ClustersImpl.class));
      bind(ConfigHelper.class).toInstance(createNiceMock(ConfigHelper.class));
      bind(KerberosOperationHandlerFactory.class).toInstance(kerberosOperationHandlerFactory);
      bind(ClusterController.class).toInstance(clusterController);
      bind(KerberosDescriptorFactory.class).toInstance(kerberosDescriptorFactory);
      bind(KerberosConfigDataFileWriterFactory.class).toInstance(kerberosConfigDataFileWriterFactory);
      bind(StackManagerFactory.class).toInstance(createNiceMock(StackManagerFactory.class));
      bind(KerberosHelper.class).to(KerberosHelperImpl.class);
      bind(CredentialStoreService.class).to(CredentialStoreServiceImpl.class);
      bind(CreatePrincipalsServerAction.class).toInstance(createMock(CreatePrincipalsServerAction.class));
      bind(CreateKeytabFilesServerAction.class).toInstance(createMock(CreateKeytabFilesServerAction.class));
      bind(StackAdvisorHelper.class).toInstance(createMock(StackAdvisorHelper.class));
    }
  }
);
  setClusterController();
  StageUtils.setTopologyManager(topologyManager);
  expect(topologyManager.getPendingHostComponents()).andReturn(Collections.<String,Collection<String>>emptyMap()).anyTimes();
  CredentialStoreService credentialStoreService=injector.getInstance(CredentialStoreService.class);
  if (!credentialStoreService.isInitialized(CredentialStoreType.TEMPORARY)) {
    ((CredentialStoreServiceImpl)credentialStoreService).initializeTemporaryCredentialStore(10,TimeUnit.MINUTES,false);
  }
}

</code></pre>

<pre class="type-16 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=AmbariException.class) public void testMissingKrb5Conf() throws Exception {
  KerberosHelper kerberosHelper=injector.getInstance(KerberosHelper.class);
  final Map<String,String> kerberosEnvProperties=createMock(Map.class);
  expect(kerberosEnvProperties.get("ldap_url")).andReturn("").once();
  expect(kerberosEnvProperties.get("container_dn")).andReturn("").once();
  final Config kerberosEnvConfig=createMock(Config.class);
  expect(kerberosEnvConfig.getProperties()).andReturn(kerberosEnvProperties).once();
  final Cluster cluster=createNiceMock(Cluster.class);
  expect(cluster.getDesiredConfigByType("kerberos-env")).andReturn(kerberosEnvConfig).once();
  replayAll();
  kerberosHelper.toggleKerberos(cluster,SecurityType.KERBEROS,null,true);
  verifyAll();
}

</code></pre>

<pre class="type-5 type-16 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(expected=KerberosMissingAdminCredentialsException.class) public void testDeleteIdentitiesMissingCredentials() throws Exception {
  try {
    testDeleteIdentities(null);
  }
 catch (  IllegalArgumentException e) {
    Assert.assertTrue(e.getMessage().startsWith("Missing KDC administrator credentials"));
    throw e;
  }
}

</code></pre>

<pre class="type-5 type-16 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(expected=KerberosMissingAdminCredentialsException.class) public void testDeleteIdentitiesInvalidCredentials() throws Exception {
  try {
    testDeleteIdentities(new PrincipalKeyCredential("invalid_principal","password"));
  }
 catch (  IllegalArgumentException e) {
    Assert.assertTrue(e.getMessage().startsWith("Invalid KDC administrator credentials"));
    throw e;
  }
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testEnableKerberos_ManageIdentitiesFalseKdcNone() throws Exception {
  testEnableKerberos(new PrincipalKeyCredential("principal","password"),"none","false",true,false);
}

</code></pre>

<pre class="type-8 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is an empty test case">EmptyTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
- Is an empty test case
"></span><br>
@After public void tearDown() throws Exception {
}

</code></pre>

<pre class="type-5 type-16 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(expected=KerberosMissingAdminCredentialsException.class) public void testEnsureIdentitiesInvalidCredentials() throws Exception {
  try {
    testEnsureIdentities(new PrincipalKeyCredential("invalid_principal","password"),null);
  }
 catch (  IllegalArgumentException e) {
    Assert.assertTrue(e.getMessage().startsWith("Invalid KDC administrator credentials"));
    throw e;
  }
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testRegenerateKeytabs() throws Exception {
  testRegenerateKeytabs(new PrincipalKeyCredential("principal","password"),false,false);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testEnsureIdentities_FilteredHosts() throws Exception {
  testEnsureIdentities(new PrincipalKeyCredential("principal","password"),Collections.singleton("hostA"));
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDeleteIdentities() throws Exception {
  testDeleteIdentities(new PrincipalKeyCredential("principal","password"));
}

</code></pre>

<pre class="type-16 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=AmbariException.class) public void testMissingClusterEnv() throws Exception {
  KerberosHelper kerberosHelper=injector.getInstance(KerberosHelper.class);
  Cluster cluster=createNiceMock(Cluster.class);
  RequestStageContainer requestStageContainer=createNiceMock(RequestStageContainer.class);
  replayAll();
  kerberosHelper.toggleKerberos(cluster,SecurityType.KERBEROS,requestStageContainer,true);
  verifyAll();
}

</code></pre>

<pre class="type-16 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IllegalArgumentException.class) public void testGetActiveIdentities_MissingCluster() throws Exception {
  testGetActiveIdentities(null,null,null,null,true,SecurityType.KERBEROS);
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
