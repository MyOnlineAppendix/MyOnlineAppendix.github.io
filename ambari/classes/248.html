<h3 style="margin:0px">Class: org.apache.ambari.server.controller.internal.ServiceResourceProviderTest (24 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(15)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(7)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(7)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(6)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="16"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('16')" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution"><kbd id="tag-16"class="label-info"style="display: inline-block;font-size:7pt" >ExceptionVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-4 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeleteResourcesBadServiceState() throws Exception {
  AmbariManagementController managementController=createMock(AmbariManagementController.class);
  Clusters clusters=createNiceMock(Clusters.class);
  Cluster cluster=createNiceMock(Cluster.class);
  Service service=createNiceMock(Service.class);
  String serviceName="Service100";
  expect(managementController.getClusters()).andReturn(clusters).anyTimes();
  expect(clusters.getCluster("Cluster100")).andReturn(cluster).anyTimes();
  expect(cluster.getClusterId()).andReturn(2L).anyTimes();
  expect(cluster.getService(serviceName)).andReturn(service).anyTimes();
  expect(service.getDesiredState()).andReturn(State.STARTED).anyTimes();
  expect(service.getName()).andReturn(serviceName).anyTimes();
  expect(service.getServiceComponents()).andReturn(new HashMap<String,ServiceComponent>());
  expect(service.getCluster()).andReturn(cluster);
  cluster.deleteService(serviceName);
  replay(managementController,clusters,cluster,service);
  SecurityContextHolder.getContext().setAuthentication(TestAuthenticationFactory.createAdministrator());
  ResourceProvider provider=getServiceProvider(managementController);
  AbstractResourceProviderTest.TestObserver observer=new AbstractResourceProviderTest.TestObserver();
  ((ObservableResourceProvider)provider).addObserver(observer);
  Predicate predicate=new PredicateBuilder().property(ServiceResourceProvider.SERVICE_CLUSTER_NAME_PROPERTY_ID).equals("Cluster100").and().property(ServiceResourceProvider.SERVICE_SERVICE_NAME_PROPERTY_ID).equals(serviceName).toPredicate();
  provider.deleteResources(predicate);
  ResourceProviderEvent lastEvent=observer.getLastEvent();
  Assert.assertNotNull(lastEvent);
  Assert.assertEquals(Resource.Type.Service,lastEvent.getResourceType());
  Assert.assertEquals(ResourceProviderEvent.Type.Delete,lastEvent.getType());
  Assert.assertEquals(predicate,lastEvent.getPredicate());
  Assert.assertNull(lastEvent.getRequest());
  verify(managementController,clusters,cluster,service);
}

</code></pre>

<pre class="type-16 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=AuthorizationException.class) public void testDeleteResourcesAsServiceAdministrator() throws Exception {
  testDeleteResources(TestAuthenticationFactory.createServiceAdministrator());
}

</code></pre>

<pre class="type-16 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=AuthorizationException.class) public void testCreateResourcesAsServiceAdministrator() throws Exception {
  testCreateResources(TestAuthenticationFactory.createServiceAdministrator());
}

</code></pre>

<pre class="type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void clearAuthentication(){
  SecurityContextHolder.getContext().setAuthentication(null);
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetResources_KerberosSpecificProperties_KDCInvalidCredentials() throws Exception {
  AmbariManagementController managementController=createMock(AmbariManagementController.class);
  Clusters clusters=createNiceMock(Clusters.class);
  Cluster cluster=createNiceMock(Cluster.class);
  Service service0=createNiceMock(Service.class);
  ServiceResponse serviceResponse0=createNiceMock(ServiceResponse.class);
  StackId stackId=createNiceMock(StackId.class);
  ServiceFactory serviceFactory=createNiceMock(ServiceFactory.class);
  AmbariMetaInfo ambariMetaInfo=createNiceMock(AmbariMetaInfo.class);
  KerberosHelper kerberosHeper=createStrictMock(KerberosHelper.class);
  Map<String,Service> allResponseMap=new HashMap<String,Service>();
  allResponseMap.put("KERBEROS",service0);
  expect(managementController.getClusters()).andReturn(clusters).anyTimes();
  expect(managementController.getAmbariMetaInfo()).andReturn(ambariMetaInfo).anyTimes();
  expect(managementController.getServiceFactory()).andReturn(serviceFactory).anyTimes();
  expect(managementController.getHostComponents(EasyMock.<Set<ServiceComponentHostRequest>>anyObject())).andReturn(Collections.<ServiceComponentHostResponse>emptySet()).anyTimes();
  expect(clusters.getCluster("Cluster100")).andReturn(cluster).anyTimes();
  expect(cluster.getServices()).andReturn(allResponseMap).anyTimes();
  expect(cluster.getService("KERBEROS")).andReturn(service0);
  expect(service0.convertToResponse()).andReturn(serviceResponse0).anyTimes();
  expect(service0.getName()).andReturn("Service100").anyTimes();
  expect(serviceResponse0.getClusterName()).andReturn("Cluster100").anyTimes();
  expect(serviceResponse0.getServiceName()).andReturn("KERBEROS").anyTimes();
  kerberosHeper.validateKDCCredentials(cluster);
  expectLastCall().andThrow(new KerberosAdminAuthenticationException("Invalid KDC administrator credentials."));
  replay(managementController,clusters,cluster,service0,serviceResponse0,ambariMetaInfo,stackId,serviceFactory,kerberosHeper);
  SecurityContextHolder.getContext().setAuthentication(TestAuthenticationFactory.createAdministrator());
  ResourceProvider provider=getServiceProvider(managementController);
  Class<?> c=provider.getClass();
  Field f=c.getDeclaredField("kerberosHelper");
  f.setAccessible(true);
  f.set(provider,kerberosHeper);
  Predicate predicate=new PredicateBuilder().property(ServiceResourceProvider.SERVICE_CLUSTER_NAME_PROPERTY_ID).equals("Cluster100").and().property(ServiceResourceProvider.SERVICE_SERVICE_NAME_PROPERTY_ID).equals("KERBEROS").toPredicate();
  Request request=PropertyHelper.getReadRequest("ServiceInfo","Services");
  Set<Resource> resources=provider.getResources(request,predicate);
  Assert.assertEquals(1,resources.size());
  for (  Resource resource : resources) {
    Assert.assertEquals("Cluster100",resource.getPropertyValue(ServiceResourceProvider.SERVICE_CLUSTER_NAME_PROPERTY_ID));
    Assert.assertEquals("KERBEROS",resource.getPropertyValue(ServiceResourceProvider.SERVICE_SERVICE_NAME_PROPERTY_ID));
    Assert.assertEquals("INVALID_CREDENTIALS",resource.getPropertyValue("Services/attributes/kdc_validation_result"));
    Assert.assertEquals("Invalid KDC administrator credentials.",resource.getPropertyValue("Services/attributes/kdc_validation_failure_details"));
  }
  verify(managementController,clusters,cluster,service0,serviceResponse0,ambariMetaInfo,stackId,serviceFactory,kerberosHeper);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testDeleteResourcesBadComponentState() throws Exception {
  AmbariManagementController managementController=createMock(AmbariManagementController.class);
  Clusters clusters=createNiceMock(Clusters.class);
  Cluster cluster=createNiceMock(Cluster.class);
  Service service=createNiceMock(Service.class);
  ServiceComponent sc=createNiceMock(ServiceComponent.class);
  Map<String,ServiceComponent> scMap=new HashMap<String,ServiceComponent>();
  scMap.put("Component100",sc);
  State componentState=State.STARTED;
  String serviceName="Service100";
  expect(managementController.getClusters()).andReturn(clusters).anyTimes();
  expect(clusters.getCluster("Cluster100")).andReturn(cluster).anyTimes();
  expect(cluster.getService(serviceName)).andReturn(service).anyTimes();
  expect(service.getDesiredState()).andReturn(State.INSTALLED).anyTimes();
  expect(service.getName()).andReturn(serviceName).anyTimes();
  expect(service.getServiceComponents()).andReturn(scMap);
  expect(sc.getDesiredState()).andReturn(componentState).anyTimes();
  expect(sc.getName()).andReturn("Component100").anyTimes();
  expect(sc.canBeRemoved()).andReturn(componentState.isRemovableState()).anyTimes();
  replay(managementController,clusters,cluster,service,sc);
  SecurityContextHolder.getContext().setAuthentication(TestAuthenticationFactory.createAdministrator());
  ResourceProvider provider=getServiceProvider(managementController);
  AbstractResourceProviderTest.TestObserver observer=new AbstractResourceProviderTest.TestObserver();
  ((ObservableResourceProvider)provider).addObserver(observer);
  Predicate predicate=new PredicateBuilder().property(ServiceResourceProvider.SERVICE_CLUSTER_NAME_PROPERTY_ID).equals("Cluster100").and().property(ServiceResourceProvider.SERVICE_SERVICE_NAME_PROPERTY_ID).equals(serviceName).toPredicate();
  try {
    provider.deleteResources(predicate);
    Assert.fail("Expected exception deleting a service in a non-removable state.");
  }
 catch (  SystemException e) {
  }
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGetResourcesAsServiceAdministrator() throws Exception {
  testGetResources(TestAuthenticationFactory.createServiceAdministrator());
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGetResourcesAsAdministrator() throws Exception {
  testGetResources(TestAuthenticationFactory.createAdministrator());
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testReconfigureClientsFlagAsServiceAdministrator() throws Exception {
  testReconfigureClientsFlag(TestAuthenticationFactory.createServiceAdministrator());
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGetResourcesAsClusterAdministrator() throws Exception {
  testGetResources(TestAuthenticationFactory.createClusterAdministrator());
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testReconfigureClientsFlagAsAdministrator() throws Exception {
  testReconfigureClientsFlag(TestAuthenticationFactory.createAdministrator());
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDeleteResourcesAsAdministrator() throws Exception {
  testDeleteResources(TestAuthenticationFactory.createAdministrator());
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetResources_KerberosSpecificProperties() throws Exception {
  AmbariManagementController managementController=createMock(AmbariManagementController.class);
  Clusters clusters=createNiceMock(Clusters.class);
  Cluster cluster=createNiceMock(Cluster.class);
  Service service0=createNiceMock(Service.class);
  ServiceResponse serviceResponse0=createNiceMock(ServiceResponse.class);
  StackId stackId=createNiceMock(StackId.class);
  ServiceFactory serviceFactory=createNiceMock(ServiceFactory.class);
  AmbariMetaInfo ambariMetaInfo=createNiceMock(AmbariMetaInfo.class);
  KerberosHelper kerberosHeper=createStrictMock(KerberosHelper.class);
  Map<String,Service> allResponseMap=new HashMap<String,Service>();
  allResponseMap.put("KERBEROS",service0);
  expect(managementController.getClusters()).andReturn(clusters).anyTimes();
  expect(managementController.getAmbariMetaInfo()).andReturn(ambariMetaInfo).anyTimes();
  expect(managementController.getServiceFactory()).andReturn(serviceFactory).anyTimes();
  expect(managementController.getHostComponents(EasyMock.<Set<ServiceComponentHostRequest>>anyObject())).andReturn(Collections.<ServiceComponentHostResponse>emptySet()).anyTimes();
  expect(clusters.getCluster("Cluster100")).andReturn(cluster).anyTimes();
  expect(cluster.getServices()).andReturn(allResponseMap).anyTimes();
  expect(cluster.getService("KERBEROS")).andReturn(service0);
  expect(service0.convertToResponse()).andReturn(serviceResponse0).anyTimes();
  expect(service0.getName()).andReturn("Service100").anyTimes();
  expect(serviceResponse0.getClusterName()).andReturn("Cluster100").anyTimes();
  expect(serviceResponse0.getServiceName()).andReturn("KERBEROS").anyTimes();
  kerberosHeper.validateKDCCredentials(cluster);
  replay(managementController,clusters,cluster,service0,serviceResponse0,ambariMetaInfo,stackId,serviceFactory,kerberosHeper);
  SecurityContextHolder.getContext().setAuthentication(TestAuthenticationFactory.createAdministrator());
  ResourceProvider provider=getServiceProvider(managementController);
  Class<?> c=provider.getClass();
  Field f=c.getDeclaredField("kerberosHelper");
  f.setAccessible(true);
  f.set(provider,kerberosHeper);
  Predicate predicate=new PredicateBuilder().property(ServiceResourceProvider.SERVICE_CLUSTER_NAME_PROPERTY_ID).equals("Cluster100").and().property(ServiceResourceProvider.SERVICE_SERVICE_NAME_PROPERTY_ID).equals("KERBEROS").toPredicate();
  Request request=PropertyHelper.getReadRequest("ServiceInfo","Services");
  Set<Resource> resources=provider.getResources(request,predicate);
  Assert.assertEquals(1,resources.size());
  for (  Resource resource : resources) {
    Assert.assertEquals("Cluster100",resource.getPropertyValue(ServiceResourceProvider.SERVICE_CLUSTER_NAME_PROPERTY_ID));
    Assert.assertEquals("KERBEROS",resource.getPropertyValue(ServiceResourceProvider.SERVICE_SERVICE_NAME_PROPERTY_ID));
    Assert.assertEquals("OK",resource.getPropertyValue("Services/attributes/kdc_validation_result"));
    Assert.assertEquals("",resource.getPropertyValue("Services/attributes/kdc_validation_failure_details"));
  }
  verify(managementController,clusters,cluster,service0,serviceResponse0,ambariMetaInfo,stackId,serviceFactory,kerberosHeper);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUpdateResourcesAsAdministrator() throws Exception {
  testUpdateResources(TestAuthenticationFactory.createAdministrator());
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUpdateResourcesAsServiceAdministrator() throws Exception {
  testUpdateResources(TestAuthenticationFactory.createServiceAdministrator());
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetResources_KerberosSpecificProperties_NoKDCValidation() throws Exception {
  AmbariManagementController managementController=createMock(AmbariManagementController.class);
  Clusters clusters=createNiceMock(Clusters.class);
  Cluster cluster=createNiceMock(Cluster.class);
  Service service0=createNiceMock(Service.class);
  ServiceResponse serviceResponse0=createNiceMock(ServiceResponse.class);
  StackId stackId=createNiceMock(StackId.class);
  ServiceFactory serviceFactory=createNiceMock(ServiceFactory.class);
  AmbariMetaInfo ambariMetaInfo=createNiceMock(AmbariMetaInfo.class);
  KerberosHelper kerberosHelper=createStrictMock(KerberosHelper.class);
  Map<String,Service> allResponseMap=new HashMap<String,Service>();
  allResponseMap.put("KERBEROS",service0);
  expect(managementController.getClusters()).andReturn(clusters).anyTimes();
  expect(managementController.getAmbariMetaInfo()).andReturn(ambariMetaInfo).anyTimes();
  expect(managementController.getServiceFactory()).andReturn(serviceFactory).anyTimes();
  expect(managementController.getHostComponents(EasyMock.<Set<ServiceComponentHostRequest>>anyObject())).andReturn(Collections.<ServiceComponentHostResponse>emptySet()).anyTimes();
  expect(clusters.getCluster("Cluster100")).andReturn(cluster).anyTimes();
  expect(cluster.getServices()).andReturn(allResponseMap).anyTimes();
  expect(cluster.getService("KERBEROS")).andReturn(service0);
  expect(service0.convertToResponse()).andReturn(serviceResponse0).anyTimes();
  expect(service0.getName()).andReturn("Service100").anyTimes();
  expect(serviceResponse0.getClusterName()).andReturn("Cluster100").anyTimes();
  expect(serviceResponse0.getServiceName()).andReturn("KERBEROS").anyTimes();
  replay(managementController,clusters,cluster,service0,serviceResponse0,ambariMetaInfo,stackId,serviceFactory,kerberosHelper);
  SecurityContextHolder.getContext().setAuthentication(TestAuthenticationFactory.createAdministrator());
  ResourceProvider provider=getServiceProvider(managementController);
  Class<?> c=provider.getClass();
  Field f=c.getDeclaredField("kerberosHelper");
  f.setAccessible(true);
  f.set(provider,kerberosHelper);
  Predicate predicate=new PredicateBuilder().property(ServiceResourceProvider.SERVICE_CLUSTER_NAME_PROPERTY_ID).equals("Cluster100").and().property(ServiceResourceProvider.SERVICE_SERVICE_NAME_PROPERTY_ID).equals("KERBEROS").toPredicate();
  Request request=PropertyHelper.getReadRequest("ServiceInfo");
  Set<Resource> resources=provider.getResources(request,predicate);
  Assert.assertEquals(1,resources.size());
  for (  Resource resource : resources) {
    Assert.assertEquals("Cluster100",resource.getPropertyValue(ServiceResourceProvider.SERVICE_CLUSTER_NAME_PROPERTY_ID));
    Assert.assertEquals("KERBEROS",resource.getPropertyValue(ServiceResourceProvider.SERVICE_SERVICE_NAME_PROPERTY_ID));
  }
  verify(managementController,clusters,cluster,service0,serviceResponse0,ambariMetaInfo,stackId,serviceFactory,kerberosHelper);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCreateResourcesAsAdministrator() throws Exception {
  testCreateResources(TestAuthenticationFactory.createAdministrator());
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUpdateResourcesAsClusterAdministrator() throws Exception {
  testUpdateResources(TestAuthenticationFactory.createClusterAdministrator());
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testReconfigureClientsFlagAsClusterAdministrator() throws Exception {
  testReconfigureClientsFlag(TestAuthenticationFactory.createAdministrator("clusterAdmin"));
}

</code></pre>

<pre class="type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCheckPropertyIds() throws Exception {
  Set<String> propertyIds=new HashSet<String>();
  propertyIds.add("foo");
  propertyIds.add("cat1/foo");
  propertyIds.add("cat2/bar");
  propertyIds.add("cat2/baz");
  propertyIds.add("cat3/sub1/bam");
  propertyIds.add("cat4/sub2/sub3/bat");
  propertyIds.add("cat5/subcat5/map");
  Map<Resource.Type,String> keyPropertyIds=new HashMap<Resource.Type,String>();
  AmbariManagementController managementController=createMock(AmbariManagementController.class);
  MaintenanceStateHelper maintenanceStateHelperMock=createNiceMock(MaintenanceStateHelper.class);
  AbstractResourceProvider provider=new ServiceResourceProvider(propertyIds,keyPropertyIds,managementController,maintenanceStateHelperMock);
  Set<String> unsupported=provider.checkPropertyIds(Collections.singleton("foo"));
  Assert.assertTrue(unsupported.isEmpty());
  Assert.assertTrue(provider.checkPropertyIds(Collections.singleton("cat5/subcat5/map/key")).isEmpty());
  unsupported=provider.checkPropertyIds(Collections.singleton("bar"));
  Assert.assertEquals(1,unsupported.size());
  Assert.assertTrue(unsupported.contains("bar"));
  unsupported=provider.checkPropertyIds(Collections.singleton("cat1/foo"));
  Assert.assertTrue(unsupported.isEmpty());
  unsupported=provider.checkPropertyIds(Collections.singleton("cat1"));
  Assert.assertTrue(unsupported.isEmpty());
  unsupported=provider.checkPropertyIds(Collections.singleton("config"));
  Assert.assertTrue(unsupported.isEmpty());
  unsupported=provider.checkPropertyIds(Collections.singleton("config/unknown_property"));
  Assert.assertTrue(unsupported.isEmpty());
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetResources_KerberosSpecificProperties_KDCMissingCredentials() throws Exception {
  AmbariManagementController managementController=createMock(AmbariManagementController.class);
  Clusters clusters=createNiceMock(Clusters.class);
  Cluster cluster=createNiceMock(Cluster.class);
  Service service0=createNiceMock(Service.class);
  ServiceResponse serviceResponse0=createNiceMock(ServiceResponse.class);
  StackId stackId=createNiceMock(StackId.class);
  ServiceFactory serviceFactory=createNiceMock(ServiceFactory.class);
  AmbariMetaInfo ambariMetaInfo=createNiceMock(AmbariMetaInfo.class);
  KerberosHelper kerberosHeper=createStrictMock(KerberosHelper.class);
  Map<String,Service> allResponseMap=new HashMap<String,Service>();
  allResponseMap.put("KERBEROS",service0);
  expect(managementController.getClusters()).andReturn(clusters).anyTimes();
  expect(managementController.getAmbariMetaInfo()).andReturn(ambariMetaInfo).anyTimes();
  expect(managementController.getServiceFactory()).andReturn(serviceFactory).anyTimes();
  expect(managementController.getHostComponents((Set<ServiceComponentHostRequest>)anyObject())).andReturn(Collections.<ServiceComponentHostResponse>emptySet()).anyTimes();
  expect(clusters.getCluster("Cluster100")).andReturn(cluster).anyTimes();
  expect(cluster.getServices()).andReturn(allResponseMap).anyTimes();
  expect(cluster.getService("KERBEROS")).andReturn(service0);
  expect(service0.convertToResponse()).andReturn(serviceResponse0).anyTimes();
  expect(service0.getName()).andReturn("Service100").anyTimes();
  expect(serviceResponse0.getClusterName()).andReturn("Cluster100").anyTimes();
  expect(serviceResponse0.getServiceName()).andReturn("KERBEROS").anyTimes();
  kerberosHeper.validateKDCCredentials(cluster);
  expectLastCall().andThrow(new KerberosMissingAdminCredentialsException("Missing KDC administrator credentials."));
  replay(managementController,clusters,cluster,service0,serviceResponse0,ambariMetaInfo,stackId,serviceFactory,kerberosHeper);
  SecurityContextHolder.getContext().setAuthentication(TestAuthenticationFactory.createAdministrator());
  ResourceProvider provider=getServiceProvider(managementController);
  Class<?> c=provider.getClass();
  Field f=c.getDeclaredField("kerberosHelper");
  f.setAccessible(true);
  f.set(provider,kerberosHeper);
  Predicate predicate=new PredicateBuilder().property(ServiceResourceProvider.SERVICE_CLUSTER_NAME_PROPERTY_ID).equals("Cluster100").and().property(ServiceResourceProvider.SERVICE_SERVICE_NAME_PROPERTY_ID).equals("KERBEROS").toPredicate();
  Request request=PropertyHelper.getReadRequest("ServiceInfo","Services");
  Set<Resource> resources=provider.getResources(request,predicate);
  Assert.assertEquals(1,resources.size());
  for (  Resource resource : resources) {
    Assert.assertEquals("Cluster100",resource.getPropertyValue(ServiceResourceProvider.SERVICE_CLUSTER_NAME_PROPERTY_ID));
    Assert.assertEquals("KERBEROS",resource.getPropertyValue(ServiceResourceProvider.SERVICE_SERVICE_NAME_PROPERTY_ID));
    Assert.assertEquals("MISSING_CREDENTIALS",resource.getPropertyValue("Services/attributes/kdc_validation_result"));
    Assert.assertEquals("Missing KDC administrator credentials.",resource.getPropertyValue("Services/attributes/kdc_validation_failure_details"));
  }
  verify(managementController,clusters,cluster,service0,serviceResponse0,ambariMetaInfo,stackId,serviceFactory,kerberosHeper);
}

</code></pre>

<pre class="type-4 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeleteResourcesStoppedComponentState() throws Exception {
  AmbariManagementController managementController=createMock(AmbariManagementController.class);
  Clusters clusters=createNiceMock(Clusters.class);
  Cluster cluster=createNiceMock(Cluster.class);
  Service service=createNiceMock(Service.class);
class TestComponent {
    public String Name;
    public ServiceComponent Component;
    public State DesiredState;
    public TestComponent(    String name,    ServiceComponent component,    State desiredState){
      Name=name;
      Component=component;
      DesiredState=desiredState;
    }
  }
  TestComponent component1=new TestComponent("Component100",createNiceMock(ServiceComponent.class),State.INSTALLED);
  TestComponent component2=new TestComponent("Component101",createNiceMock(ServiceComponent.class),State.INSTALLED);
  TestComponent component3=new TestComponent("Component102",createNiceMock(ServiceComponent.class),State.INSTALLED);
  Map<String,ServiceComponent> scMap=new HashMap<String,ServiceComponent>();
  scMap.put(component1.Name,component1.Component);
  scMap.put(component2.Name,component2.Component);
  scMap.put(component3.Name,component3.Component);
  String clusterName="Cluster100";
  String serviceName="Service100";
  expect(managementController.getClusters()).andReturn(clusters).anyTimes();
  expect(clusters.getCluster(clusterName)).andReturn(cluster).anyTimes();
  expect(cluster.getService(serviceName)).andReturn(service).anyTimes();
  expect(service.getDesiredState()).andReturn(State.STARTED).anyTimes();
  expect(service.getName()).andReturn(serviceName).anyTimes();
  expect(service.getServiceComponents()).andReturn(scMap).anyTimes();
  expect(component1.Component.getDesiredState()).andReturn(component1.DesiredState).anyTimes();
  expect(component2.Component.getDesiredState()).andReturn(component2.DesiredState).anyTimes();
  expect(component3.Component.getDesiredState()).andReturn(component3.DesiredState).anyTimes();
  expect(component1.Component.canBeRemoved()).andReturn(component1.DesiredState.isRemovableState()).anyTimes();
  expect(component2.Component.canBeRemoved()).andReturn(component2.DesiredState.isRemovableState()).anyTimes();
  expect(component3.Component.canBeRemoved()).andReturn(component3.DesiredState.isRemovableState()).anyTimes();
  expect(service.getCluster()).andReturn(cluster);
  cluster.deleteService(serviceName);
  replay(managementController,clusters,cluster,service,component1.Component,component2.Component,component3.Component);
  SecurityContextHolder.getContext().setAuthentication(TestAuthenticationFactory.createAdministrator());
  ResourceProvider provider=getServiceProvider(managementController);
  AbstractResourceProviderTest.TestObserver observer=new AbstractResourceProviderTest.TestObserver();
  ((ObservableResourceProvider)provider).addObserver(observer);
  Predicate predicate=new PredicateBuilder().property(ServiceResourceProvider.SERVICE_CLUSTER_NAME_PROPERTY_ID).equals(clusterName).and().property(ServiceResourceProvider.SERVICE_SERVICE_NAME_PROPERTY_ID).equals(serviceName).toPredicate();
  provider.deleteResources(predicate);
  ResourceProviderEvent lastEvent=observer.getLastEvent();
  Assert.assertNotNull(lastEvent);
  Assert.assertEquals(Resource.Type.Service,lastEvent.getResourceType());
  Assert.assertEquals(ResourceProviderEvent.Type.Delete,lastEvent.getType());
  Assert.assertEquals(predicate,lastEvent.getPredicate());
  Assert.assertNull(lastEvent.getRequest());
  verify(managementController,clusters,cluster,service,component1.Component,component2.Component,component3.Component);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCreateResourcesAsClusterAdministrator() throws Exception {
  testCreateResources(TestAuthenticationFactory.createClusterAdministrator());
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDeleteResourcesAsClusterAdministrator() throws Exception {
  testDeleteResources(TestAuthenticationFactory.createClusterAdministrator());
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
