<h3 style="margin:0px">Class: org.apache.ambari.server.controller.internal.BlueprintConfigurationProcessorTest (132 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(120)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(50)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(46)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(27)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(24)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testHiveConfigClusterUpdatePropertiesFilterAuthenticationOffFilterThrowsError() throws Exception {
  reset(stack);
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> hiveSiteProperties=new HashMap<String,String>();
  properties.put("hive-site",hiveSiteProperties);
  hiveSiteProperties.put("hive.server2.authentication","NONE");
  hiveSiteProperties.put("hive.server2.authentication.kerberos.keytab"," ");
  hiveSiteProperties.put("hive.server2.authentication.kerberos.principal"," ");
  Map<String,Stack.ConfigProperty> mapOfMetadata=new HashMap<String,Stack.ConfigProperty>();
  Stack.ConfigProperty configProperty1=new Stack.ConfigProperty("hive-site","hive.server2.authentication.kerberos.keytab"," "){
    @Override Set<PropertyDependencyInfo> getDependsOnProperties(){
      PropertyDependencyInfo dependencyInfo=new PropertyDependencyInfo("hive-site","hive.server2.authentication");
      return Collections.singleton(dependencyInfo);
    }
  }
;
  Stack.ConfigProperty configProperty2=new Stack.ConfigProperty("hive-site","hive.server2.authentication.kerberos.principal"," "){
    @Override Set<PropertyDependencyInfo> getDependsOnProperties(){
      PropertyDependencyInfo dependencyInfo=new PropertyDependencyInfo("hive-site","hive.server2.authentication");
      return Collections.singleton(dependencyInfo);
    }
  }
;
  mapOfMetadata.put("hive.server2.authentication.kerberos.keytab",configProperty1);
  mapOfMetadata.put("hive.server2.authentication.kerberos.principal",configProperty2);
  expect(stack.getName()).andReturn("testStack").anyTimes();
  expect(stack.getVersion()).andReturn("1").anyTimes();
  expect(stack.isMasterComponent((String)anyObject())).andReturn(false).anyTimes();
  expect(stack.getServiceForConfigType("hive-site")).andThrow(new RuntimeException("Expected Test Error")).atLeastOnce();
  expect(stack.getConfigurationPropertiesWithMetadata("HIVE","hive-site")).andReturn(mapOfMetadata).atLeastOnce();
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  List<String> hosts=new ArrayList<String>();
  hosts.add("some-hose");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,hosts);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertTrue("hive.server2.authentication.kerberos.keytab should not have been filtered, due to error condition",hiveSiteProperties.containsKey("hive.server2.authentication.kerberos.keytab"));
  assertTrue("hive.server2.authentication.kerberos.principal should not have been filtered, due to error condition",hiveSiteProperties.containsKey("hive.server2.authentication.kerberos.principal"));
}

</code></pre>

<pre class="type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * There is no support currently for deploying a fully Kerberized
 * cluster with Blueprints.  This test verifies the current treatment
 * of Kerberos-related properties in a Blueprint export.
 * @throws Exception
 */
@Test public void testKerberosConfigExport() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> kerberosEnvProperties=new HashMap<String,String>();
  Map<String,String> coreSiteProperties=new HashMap<String,String>();
  configProperties.put("kerberos-env",kerberosEnvProperties);
  configProperties.put("core-site",coreSiteProperties);
  kerberosEnvProperties.put("admin_server_host",expectedHostName);
  kerberosEnvProperties.put("kdc_host",expectedHostName);
  coreSiteProperties.put("hadoop.proxyuser.yarn.hosts",expectedHostName);
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> groupComponents=new HashSet<String>();
  groupComponents.add("TEZ_CLIENT");
  groupComponents.add("RESOURCEMANAGER");
  Collection<String> hosts=new ArrayList<String>();
  hosts.add(expectedHostName);
  hosts.add("serverTwo");
  TestHostGroup group=new TestHostGroup(expectedHostGroupName,groupComponents,hosts);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  assertFalse("admin_server_host should not be present in exported blueprint in kerberos-env",kerberosEnvProperties.containsKey("admin_server_host"));
  assertFalse("kdc_host should not be present in exported blueprint in kerberos-env",kerberosEnvProperties.containsKey("kdc_host"));
  assertEquals("hadoop.proxyuser.yarn.hosts was not exported correctly",createExportedHostName("host_group_1"),coreSiteProperties.get("hadoop.proxyuser.yarn.hosts"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForClusterCreate_SingleHostProperty__defaultValue_hostGroupConfig() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> yarnSiteProps=new HashMap<String,String>();
  yarnSiteProps.put("yarn.resourcemanager.hostname","localhost");
  properties.put("yarn-site",yarnSiteProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> group1Components=new HashSet<String>();
  group1Components.add("NAMENODE");
  group1Components.add("SECONDARY_NAMENODE");
  group1Components.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("group1",group1Components,Collections.singleton("testhost"));
  Collection<String> group2Components=new HashSet<String>();
  group2Components.add("DATANODE");
  group2Components.add("HDFS_CLIENT");
  Map<String,Map<String,String>> group2Properties=new HashMap<String,Map<String,String>>();
  Map<String,String> group2YarnSiteProperties=new HashMap<String,String>();
  group2YarnSiteProperties.put("yarn.resourcemanager.resource-tracker.address","localhost");
  group2Properties.put("yarn-site",group2YarnSiteProperties);
  Configuration group2BPConfig=new Configuration(Collections.<String,Map<String,String>>emptyMap(),Collections.<String,Map<String,Map<String,String>>>emptyMap(),clusterConfig);
  Configuration group2Config=new Configuration(group2Properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),group2BPConfig);
  TestHostGroup group2=new TestHostGroup("group2",group2Components,Collections.singleton("testhost2"),group2Config);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertEquals("testhost",clusterConfig.getPropertyValue("yarn-site","yarn.resourcemanager.hostname"));
  assertEquals("testhost",group2Config.getProperties().get("yarn-site").get("yarn.resourcemanager.resource-tracker.address"));
}

</code></pre>

<pre class="type-4 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDoUpdateForClusterCreate_MultiHostProperty__defaultValues___YAML() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("storm.zookeeper.servers","['localhost']");
  properties.put("storm-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("ZOOKEEPER_SERVER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  hgComponents2.add("ZOOKEEPER_SERVER");
  Set<String> hosts2=new HashSet<String>();
  hosts2.add("testhost2");
  hosts2.add("testhost2a");
  hosts2.add("testhost2b");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,hosts2);
  Collection<String> hgComponents3=new HashSet<String>();
  hgComponents2.add("HDFS_CLIENT");
  hgComponents2.add("ZOOKEEPER_CLIENT");
  Set<String> hosts3=new HashSet<String>();
  hosts3.add("testhost3");
  hosts3.add("testhost3a");
  TestHostGroup group3=new TestHostGroup("group3",hgComponents3,hosts3);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  hostGroups.add(group3);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  String updatedVal=topology.getConfiguration().getFullProperties().get("storm-site").get("storm.zookeeper.servers");
  assertTrue(updatedVal.startsWith("["));
  assertTrue(updatedVal.endsWith("]"));
  updatedVal=updatedVal.replaceAll("[\\[\\]]","");
  String[] hosts=updatedVal.split(",");
  Collection<String> expectedHosts=new HashSet<String>();
  expectedHosts.add("'testhost'");
  expectedHosts.add("'testhost2'");
  expectedHosts.add("'testhost2a'");
  expectedHosts.add("'testhost2b'");
  assertEquals(4,hosts.length);
  for (  String host : hosts) {
    assertTrue(expectedHosts.contains(host));
    expectedHosts.remove(host);
  }
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testHiveConfigClusterUpdateDefaultValue() throws Exception {
  final String expectedHostGroupName="host_group_1";
  final String expectedHostName="c6401.ambari.apache.org";
  final String expectedPropertyValue="hive.metastore.local=false,hive.metastore.uris=thrift://localhost:9933,hive.metastore.sasl.enabled=false";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> webHCatSiteProperties=new HashMap<String,String>();
  properties.put("webhcat-site",webHCatSiteProperties);
  webHCatSiteProperties.put("templeton.hive.properties",expectedPropertyValue);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("HIVE_METASTORE");
  List<String> hosts=new ArrayList<String>();
  hosts.add(expectedHostName);
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,hosts);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertEquals("Unexpected config update for templeton.hive.properties","hive.metastore.local=false,hive.metastore.uris=thrift://" + expectedHostName + ":9933,hive.metastore.sasl.enabled=false",webHCatSiteProperties.get("templeton.hive.properties"));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testDoUpdateForClusterCreate_SingleHostProperty__MultipleMatchingHostGroupsError() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("yarn.resourcemanager.hostname","localhost");
  typeProps.put("yarn.timeline-service.address","localhost");
  properties.put("yarn-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> group1Components=new HashSet<String>();
  group1Components.add("NAMENODE");
  group1Components.add("SECONDARY_NAMENODE");
  group1Components.add("RESOURCEMANAGER");
  group1Components.add("APP_TIMELINE_SERVER");
  TestHostGroup group1=new TestHostGroup("group1",group1Components,Collections.singleton("testhost"));
  Collection<String> group2Components=new HashSet<String>();
  group2Components.add("DATANODE");
  group2Components.add("HDFS_CLIENT");
  group2Components.add("APP_TIMELINE_SERVER");
  TestHostGroup group2=new TestHostGroup("group2",group2Components,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  expect(stack.getCardinality("APP_TIMELINE_SERVER")).andReturn(new Cardinality("0-1")).anyTimes();
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  try {
    updater.doUpdateForClusterCreate();
    fail("IllegalArgumentException should have been thrown");
  }
 catch (  IllegalArgumentException illegalArgumentException) {
  }
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForClusterCreate_SingleHostProperty__exportedValue() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("yarn.resourcemanager.hostname","%HOSTGROUP::group1%");
  properties.put("yarn-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  String updatedVal=topology.getConfiguration().getFullProperties().get("yarn-site").get("yarn.resourcemanager.hostname");
  assertEquals("testhost",updatedVal);
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetRequiredHostGroups___invalidComponentCountOfZero() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> coreSiteMap=new HashMap<String,String>();
  properties.put("core-site",coreSiteMap);
  coreSiteMap.put("fs.defaultFS","localhost");
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  expect(stack.getCardinality("NAMENODE")).andReturn(new Cardinality("1")).anyTimes();
  Collection<String> hgComponents1=new HashSet<String>();
  hgComponents1.add("HIVE_SERVER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents1,Collections.singleton("host1"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton("host2"));
  Collection<TestHostGroup> hostGroups=new ArrayList<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  Collection<String> requiredGroups=updater.getRequiredHostGroups();
  assertEquals(0,requiredGroups.size());
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForClusterCreate_DBHostProperty__defaultValue() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> hiveSiteProps=new HashMap<String,String>();
  hiveSiteProps.put("javax.jdo.option.ConnectionURL","jdbc:mysql://localhost/hive?createDatabaseIfNotExist=true");
  Map<String,String> hiveEnvProps=new HashMap<String,String>();
  hiveEnvProps.put("hive_database","New MySQL Database");
  properties.put("hive-site",hiveSiteProps);
  properties.put("hive-env",hiveEnvProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("RESOURCEMANAGER");
  hgComponents.add("MYSQL_SERVER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  String updatedVal=topology.getConfiguration().getFullProperties().get("hive-site").get("javax.jdo.option.ConnectionURL");
  assertEquals("jdbc:mysql://testhost/hive?createDatabaseIfNotExist=true",updatedVal);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testHadoopWithNoRangerKmsServer() throws Exception {
  expect(stack.getCardinality("NAMENODE")).andReturn(new Cardinality("1-2")).anyTimes();
  expect(stack.getCardinality("DATANODE")).andReturn(new Cardinality("1+")).anyTimes();
  expect(stack.getCardinality("RANGER_KMS_SERVER")).andReturn(new Cardinality("1+")).anyTimes();
  final String configType="core-site";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> configProperties=new HashMap<String,String>();
  properties.put(configType,configProperties);
  configProperties.put("hadoop.security.key.provider.path","leave_untouched");
  Map<String,Map<String,String>> parentProperties=new HashMap<String,Map<String,String>>();
  Configuration parentClusterConfig=new Configuration(parentProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),parentClusterConfig);
  Collection<String> hdfsComponents=new HashSet<String>();
  hdfsComponents.add("NAMENODE");
  hdfsComponents.add("DATANODE");
  TestHostGroup group1=new TestHostGroup("group1",Collections.singletonList("DATANODE"),Collections.singleton("host1"));
  TestHostGroup group2=new TestHostGroup("group2",hdfsComponents,Collections.singleton("host2"));
  Collection<TestHostGroup> hostGroups=Lists.newArrayList(group1,group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForClusterCreate();
  assertEquals("leave_untouched",clusterConfig.getPropertyValue(configType,"hadoop.security.key.provider.path"));
}

</code></pre>

<pre class="type-4 type-13 type-10 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDoUpdateForClusterWithNameNodeHAEnabledAndActiveNodeSet() throws Exception {
  final String expectedNameService="mynameservice";
  final String expectedHostName="serverThree";
  final String expectedHostNameTwo="serverFour";
  final String expectedPortNum="808080";
  final String expectedNodeOne="nn1";
  final String expectedNodeTwo="nn2";
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> hdfsSiteProperties=new HashMap<String,String>();
  Map<String,String> hadoopEnvProperties=new HashMap<String,String>();
  properties.put("hdfs-site",hdfsSiteProperties);
  properties.put("hadoop-env",hadoopEnvProperties);
  hdfsSiteProperties.put("dfs.nameservices",expectedNameService);
  hdfsSiteProperties.put("dfs.ha.namenodes.mynameservice",expectedNodeOne + ", " + expectedNodeTwo);
  hdfsSiteProperties.put("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeOne,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hdfsSiteProperties.put("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeTwo,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hdfsSiteProperties.put("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeOne,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hdfsSiteProperties.put("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeTwo,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hdfsSiteProperties.put("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeOne,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hdfsSiteProperties.put("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeTwo,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hadoopEnvProperties.put("dfs_ha_initial_namenode_active",expectedHostName);
  hadoopEnvProperties.put("dfs_ha_initial_namenode_standby",expectedHostNameTwo);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  Collection<String> hosts=new ArrayList<String>();
  hosts.add(expectedHostName);
  hosts.add(expectedHostNameTwo);
  TestHostGroup group=new TestHostGroup(expectedHostGroupName,hgComponents,hosts);
  Collection<TestHostGroup> hostGroups=new ArrayList<TestHostGroup>();
  hostGroups.add(group);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  String expectedPropertyValue=hdfsSiteProperties.get("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeOne);
  if (!expectedPropertyValue.equals(expectedHostName + ":" + expectedPortNum) && !expectedPropertyValue.equals(expectedHostNameTwo + ":" + expectedPortNum)) {
    fail("HTTPS address HA property not properly exported");
  }
  assertEquals("HTTPS address HA property not properly exported",expectedPropertyValue,hdfsSiteProperties.get("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeTwo));
  assertEquals("HTTPS address HA property not properly exported",expectedPropertyValue,hdfsSiteProperties.get("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",expectedPropertyValue,hdfsSiteProperties.get("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeTwo));
  assertEquals("HTTPS address HA property not properly exported",expectedPropertyValue,hdfsSiteProperties.get("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",expectedPropertyValue,hdfsSiteProperties.get("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeTwo));
  assertEquals("Active Namenode hostname was not set correctly",expectedHostName,hadoopEnvProperties.get("dfs_ha_initial_namenode_active"));
  assertEquals("Standby Namenode hostname was not set correctly",expectedHostNameTwo,hadoopEnvProperties.get("dfs_ha_initial_namenode_standby"));
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testHBaseConfigClusterUpdatePropertiesFilterAuthorizationOn() throws Exception {
  reset(stack);
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> hbaseSiteProperties=new HashMap<String,String>();
  properties.put("hbase-site",hbaseSiteProperties);
  hbaseSiteProperties.put("hbase.security.authorization","true");
  hbaseSiteProperties.put("hbase.coprocessor.regionserver.classes"," ");
  Map<String,Stack.ConfigProperty> mapOfMetadata=new HashMap<String,Stack.ConfigProperty>();
  Stack.ConfigProperty configProperty1=new Stack.ConfigProperty("hbase-site","hbase.coprocessor.regionserver.classes"," "){
    @Override Set<PropertyDependencyInfo> getDependsOnProperties(){
      PropertyDependencyInfo dependencyInfo=new PropertyDependencyInfo("hbase-site","hbase.security.authorization");
      return Collections.singleton(dependencyInfo);
    }
  }
;
  mapOfMetadata.put("hbase.coprocessor.regionserver.classes",configProperty1);
  expect(stack.getName()).andReturn("testStack").anyTimes();
  expect(stack.getVersion()).andReturn("1").anyTimes();
  expect(stack.isMasterComponent((String)anyObject())).andReturn(false).anyTimes();
  expect(stack.getServiceForConfigType("hbase-site")).andReturn("HBASE").atLeastOnce();
  expect(stack.getConfigurationPropertiesWithMetadata("HBASE","hbase-site")).andReturn(mapOfMetadata).atLeastOnce();
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  List<String> hosts=new ArrayList<String>();
  hosts.add("some-hose");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,hosts);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertTrue("hbase.coprocessor.regionserver.classes should have been included in configuration",hbaseSiteProperties.containsKey("hbase.coprocessor.regionserver.classes"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testHdfsWithNoRangerKmsServer() throws Exception {
  expect(stack.getCardinality("NAMENODE")).andReturn(new Cardinality("1-2")).anyTimes();
  expect(stack.getCardinality("DATANODE")).andReturn(new Cardinality("1+")).anyTimes();
  expect(stack.getCardinality("RANGER_KMS_SERVER")).andReturn(new Cardinality("1+")).anyTimes();
  final String configType="hdfs-site";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> configProperties=new HashMap<String,String>();
  properties.put(configType,configProperties);
  configProperties.put("dfs.encryption.key.provider.uri","leave_untouched");
  Map<String,Map<String,String>> parentProperties=new HashMap<String,Map<String,String>>();
  Configuration parentClusterConfig=new Configuration(parentProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),parentClusterConfig);
  Collection<String> hdfsComponents=new HashSet<String>();
  hdfsComponents.add("NAMENODE");
  hdfsComponents.add("DATANODE");
  TestHostGroup group1=new TestHostGroup("group1",Collections.singletonList("DATANODE"),Collections.singleton("host1"));
  TestHostGroup group2=new TestHostGroup("group2",hdfsComponents,Collections.singleton("host2"));
  Collection<TestHostGroup> hostGroups=Lists.newArrayList(group1,group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForClusterCreate();
  assertEquals("leave_untouched",clusterConfig.getPropertyValue(configType,"dfs.encryption.key.provider.uri"));
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testDoUpdateForBlueprintExport_SingleHostProperty__ExternalReference() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("yarn.resourcemanager.hostname","external-host");
  properties.put("yarn-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  assertFalse(properties.get("yarn-site").containsKey("yarn.resourcemanager.hostname"));
}

</code></pre>

<pre class="type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOozieConfigExported() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedHostNameTwo="c6402.ambari.apache.org";
  final String expectedExternalHost="c6408.ambari.apache.org";
  final String expectedHostGroupName="host_group_1";
  final String expectedHostGroupNameTwo="host_group_2";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> oozieSiteProperties=new HashMap<String,String>();
  Map<String,String> oozieEnvProperties=new HashMap<String,String>();
  Map<String,String> coreSiteProperties=new HashMap<String,String>();
  configProperties.put("oozie-site",oozieSiteProperties);
  configProperties.put("oozie-env",oozieEnvProperties);
  configProperties.put("hive-env",oozieEnvProperties);
  configProperties.put("core-site",coreSiteProperties);
  oozieSiteProperties.put("oozie.base.url",expectedHostName);
  oozieSiteProperties.put("oozie.authentication.kerberos.principal",expectedHostName);
  oozieSiteProperties.put("oozie.service.HadoopAccessorService.kerberos.principal",expectedHostName);
  oozieSiteProperties.put("oozie.service.JPAService.jdbc.url","jdbc:mysql://" + expectedExternalHost + "/ooziedb");
  oozieEnvProperties.put("oozie_hostname",expectedHostName);
  oozieEnvProperties.put("oozie_existing_mysql_host",expectedExternalHost);
  oozieEnvProperties.put("oozie_heapsize","1024m");
  oozieEnvProperties.put("oozie_permsize","2048m");
  coreSiteProperties.put("hadoop.proxyuser.oozie.hosts",expectedHostName + "," + expectedHostNameTwo);
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> groupComponents=new HashSet<String>();
  groupComponents.add("OOZIE_SERVER");
  Collection<String> hosts=new ArrayList<String>();
  hosts.add(expectedHostName);
  hosts.add("serverTwo");
  TestHostGroup group=new TestHostGroup(expectedHostGroupName,groupComponents,hosts);
  Collection<String> groupComponents2=new HashSet<String>();
  groupComponents2.add("OOZIE_SERVER");
  Collection<String> hosts2=new ArrayList<String>();
  hosts2.add(expectedHostNameTwo);
  hosts2.add("serverFour");
  TestHostGroup group2=new TestHostGroup(expectedHostGroupNameTwo,groupComponents2,hosts2);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  assertEquals("oozie property not exported correctly",createExportedHostName(expectedHostGroupName),oozieSiteProperties.get("oozie.base.url"));
  assertEquals("oozie property not exported correctly",createExportedHostName(expectedHostGroupName),oozieSiteProperties.get("oozie.authentication.kerberos.principal"));
  assertEquals("oozie property not exported correctly",createExportedHostName(expectedHostGroupName),oozieSiteProperties.get("oozie.service.HadoopAccessorService.kerberos.principal"));
  assertEquals("oozie property not exported correctly",createExportedHostName(expectedHostGroupName),oozieEnvProperties.get("oozie_hostname"));
  assertEquals("oozie property not exported correctly",createExportedHostName(expectedHostGroupName) + "," + createExportedHostName(expectedHostGroupNameTwo),coreSiteProperties.get("hadoop.proxyuser.oozie.hosts"));
  assertFalse("oozie_existing_mysql_host should not have been present in the exported configuration",oozieEnvProperties.containsKey("oozie_existing_mysql_host"));
  assertFalse("oozie.service.JPAService.jdbc.url should not have been present in the exported configuration",oozieSiteProperties.containsKey("oozie.service.JPAService.jdbc.url"));
  assertEquals("oozie_heapsize should have been included in exported configuration","1024m",oozieEnvProperties.get("oozie_heapsize"));
  assertEquals("oozie_permsize should have been included in exported configuration","2048m",oozieEnvProperties.get("oozie_permsize"));
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDefaultUserAndGroupProxyPropertiesSetWhenNotProvided2() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> falconEnvProperties=new HashMap<String,String>();
  properties.put("falcon-env",falconEnvProperties);
  falconEnvProperties.put("falcon_user","test-falcon-user");
  Map<String,Map<String,String>> parentProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> oozieEnvProperties=new HashMap<String,String>();
  parentProperties.put("oozie-env",oozieEnvProperties);
  oozieEnvProperties.put("oozie_user","test-oozie-user");
  Map<String,String> coreSiteProperties=new HashMap<String,String>();
  parentProperties.put("core-site",coreSiteProperties);
  coreSiteProperties.put("hadoop.proxyuser.test-oozie-user.hosts","testOozieHostsVal");
  Configuration parentClusterConfig=new Configuration(parentProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),parentClusterConfig);
  Collection<String> hgComponents1=new HashSet<String>();
  hgComponents1.add("OOZIE_SERVER");
  hgComponents1.add("FALCON_SERVER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents1,Collections.singleton("host1"));
  Collection<TestHostGroup> hostGroups=Collections.singletonList(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForClusterCreate();
  Map<String,String> leafConfigCoreSiteProps=properties.get("core-site");
  assertEquals(3,leafConfigCoreSiteProps.size());
  assertEquals("testOozieHostsVal",clusterConfig.getPropertyValue("core-site","hadoop.proxyuser.test-oozie-user.hosts"));
  assertEquals("*",leafConfigCoreSiteProps.get("hadoop.proxyuser.test-oozie-user.groups"));
  assertEquals("*",leafConfigCoreSiteProps.get("hadoop.proxyuser.test-falcon-user.hosts"));
  assertEquals("*",leafConfigCoreSiteProps.get("hadoop.proxyuser.test-falcon-user.groups"));
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForClusterCreate_SingleHostProperty__exportedValue_WithPort_UsingMinusSymbolInHostGroupName() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("yarn.resourcemanager.hostname","%HOSTGROUP::os-amb-r6-secha-1427972156-hbaseha-3-6%:2180");
  properties.put("yarn-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("os-amb-r6-secha-1427972156-hbaseha-3-6",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  String updatedVal=topology.getConfiguration().getFullProperties().get("yarn-site").get("yarn.resourcemanager.hostname");
  assertEquals("testhost:2180",updatedVal);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoNameNodeHighAvailabilityExportWithHANotEnabled() throws Exception {
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> hdfsSiteProperties=new HashMap<String,String>();
  configProperties.put("hdfs-site",hdfsSiteProperties);
  assertEquals("Incorrect initial state for hdfs-site config",0,hdfsSiteProperties.size());
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> groupComponents=new HashSet<String>();
  groupComponents.add("NAMENODE");
  TestHostGroup group=new TestHostGroup("group1",groupComponents,Collections.singleton("host1"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  assertEquals("Incorrect state for hdfs-site config after HA call in non-HA environment, should be zero",0,hdfsSiteProperties.size());
}

</code></pre>

<pre class="type-4 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDoUpdateForClusterCreate_MultiHostProperty__exportedValues___YAML() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("storm.zookeeper.servers","['%HOSTGROUP::group1%:9090','%HOSTGROUP::group2%:9091']");
  typeProps.put("nimbus.seeds","[%HOSTGROUP::group1%, %HOSTGROUP::group4%]");
  properties.put("storm-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("ZOOKEEPER_SERVER");
  hgComponents.add("NIMBUS");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  hgComponents2.add("ZOOKEEPER_SERVER");
  hgComponents2.add("NIMBUS");
  Set<String> hosts2=new HashSet<String>();
  hosts2.add("testhost2");
  hosts2.add("testhost2a");
  hosts2.add("testhost2b");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,hosts2);
  Collection<String> hgComponents3=new HashSet<String>();
  hgComponents2.add("HDFS_CLIENT");
  hgComponents2.add("ZOOKEEPER_CLIENT");
  Set<String> hosts3=new HashSet<String>();
  hosts3.add("testhost3");
  hosts3.add("testhost3a");
  TestHostGroup group3=new TestHostGroup("group3",hgComponents3,hosts3);
  Collection<String> hgComponents4=new HashSet<String>();
  hgComponents4.add("NIMBUS");
  Set<String> hosts4=new HashSet<String>();
  hosts4.add("testhost4");
  TestHostGroup group4=new TestHostGroup("group4",hgComponents4,hosts4);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  hostGroups.add(group3);
  hostGroups.add(group4);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  String updatedVal=topology.getConfiguration().getFullProperties().get("storm-site").get("storm.zookeeper.servers");
  assertTrue(updatedVal.startsWith("["));
  assertTrue(updatedVal.endsWith("]"));
  updatedVal=updatedVal.replaceAll("[\\[\\]]","");
  String[] hosts=updatedVal.split(",");
  Collection<String> expectedHosts=new HashSet<String>();
  expectedHosts.add("'testhost:9090'");
  expectedHosts.add("'testhost2:9091'");
  expectedHosts.add("'testhost2a:9091'");
  expectedHosts.add("'testhost2b:9091'");
  assertEquals(4,hosts.length);
  for (  String host : hosts) {
    assertTrue(expectedHosts.contains(host));
    expectedHosts.remove(host);
  }
  String updatedNimbusSeedsVal=topology.getConfiguration().getFullProperties().get("storm-site").get("nimbus.seeds");
  assertTrue("Updated YAML value should start with bracket",updatedNimbusSeedsVal.startsWith("["));
  assertTrue("Updated YAML value should end with bracket",updatedNimbusSeedsVal.endsWith("]"));
  updatedNimbusSeedsVal=updatedNimbusSeedsVal.replaceAll("[\\[\\]]","");
  String[] nimbusHosts=updatedNimbusSeedsVal.split(",");
  Collection<String> expectedNimbusHosts=new HashSet<String>();
  expectedNimbusHosts.add("testhost");
  expectedNimbusHosts.add("testhost4");
  assertEquals("Incorrect number of hosts found in updated Nimbus config property",2,nimbusHosts.length);
  for (  String host : nimbusHosts) {
    assertTrue("Expected Nimbus host = " + host + " not found in nimbus.seeds property value",expectedNimbusHosts.contains(host));
    expectedHosts.remove(host);
  }
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRangerAdminProperties_HA() throws Exception {
  final String rangerAdminConfigType="admin-properties";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> rangerAdminProperties=new HashMap<String,String>();
  properties.put(rangerAdminConfigType,rangerAdminProperties);
  rangerAdminProperties.put("policymgr_external_url","http://my.ranger.loadbalancer.com");
  Map<String,Map<String,String>> parentProperties=new HashMap<String,Map<String,String>>();
  Configuration parentClusterConfig=new Configuration(parentProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),parentClusterConfig);
  Collection<String> rangerComponents=new HashSet<String>();
  rangerComponents.add("RANGER_ADMIN");
  rangerComponents.add("RANGER_USERSYNC");
  TestHostGroup group1=new TestHostGroup("group1",rangerComponents,Collections.singleton("host1"));
  TestHostGroup group2=new TestHostGroup("group2",rangerComponents,Collections.singleton("host2"));
  Collection<TestHostGroup> hostGroups=Lists.newArrayList(group1,group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForClusterCreate();
  assertEquals("http://my.ranger.loadbalancer.com",clusterConfig.getPropertyValue(rangerAdminConfigType,"policymgr_external_url"));
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testYamlMultiValueWithPlainFlowStyleFormatSingleValue() throws Exception {
  BlueprintConfigurationProcessor.YamlMultiValuePropertyDecorator yamlMultiValuePropertyDecorator=new BlueprintConfigurationProcessor.YamlMultiValuePropertyDecorator(null,BlueprintConfigurationProcessor.YamlMultiValuePropertyDecorator.FlowStyle.PLAIN);
  String originalValue="test_value";
  String newValue=yamlMultiValuePropertyDecorator.doFormat(originalValue);
  String expectedValue="[test_value]";
  assertEquals(expectedValue,newValue);
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAtlasHiveProperties() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> atlasProperties=new HashMap<String,String>();
  properties.put("application-properties",atlasProperties);
  atlasProperties.put("atlas.enableTLS","false");
  atlasProperties.put("atlas.server.bind.address","localhost");
  atlasProperties.put("atlas.server.http.port","21000");
  Map<String,String> atlasEnv=new HashMap<String,String>();
  properties.put("atlas-env",atlasEnv);
  Map<String,String> hiveProperties=new HashMap<String,String>();
  hiveProperties.put("hive.exec.post.hooks","");
  hiveProperties.put("atlas.cluster.name","primary");
  hiveProperties.put("atlas.rest.address","http://localhost:21000");
  properties.put("hive-site",hiveProperties);
  Map<String,Map<String,String>> parentProperties=new HashMap<String,Map<String,String>>();
  Configuration parentClusterConfig=new Configuration(parentProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),parentClusterConfig);
  Collection<String> hgComponents1=new HashSet<String>();
  hgComponents1.add("ATLAS_SERVER");
  hgComponents1.add("HIVE_SERVER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents1,Collections.singleton("host1"));
  Collection<TestHostGroup> hostGroups=Collections.singletonList(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForClusterCreate();
  assertEquals("org.apache.atlas.hive.hook.HiveHook",clusterConfig.getPropertyValue("hive-site","hive.exec.post.hooks"));
  assertEquals("1",clusterConfig.getPropertyValue("hive-site","atlas.cluster.name"));
  assertEquals("http://host1:21000",clusterConfig.getPropertyValue("hive-site","atlas.rest.address"));
  assertEquals("host1",clusterConfig.getPropertyValue("application-properties","atlas.server.bind.address"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testKafkaConfigExported() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedHostGroupName="host_group_1";
  final String expectedPortNumberOne="2112";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> kafkaBrokerProperties=new HashMap<String,String>();
  configProperties.put("kafka-broker",kafkaBrokerProperties);
  kafkaBrokerProperties.put("kafka.ganglia.metrics.host",createHostAddress(expectedHostName,expectedPortNumberOne));
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> groupComponents=new HashSet<String>();
  groupComponents.add("KAFKA_BROKER");
  Collection<String> hosts=new ArrayList<String>();
  hosts.add(expectedHostName);
  hosts.add("serverTwo");
  TestHostGroup group=new TestHostGroup(expectedHostGroupName,groupComponents,hosts);
  Collection<String> groupComponents2=new HashSet<String>();
  groupComponents2.add("NAMENODE");
  TestHostGroup group2=new TestHostGroup("group2",groupComponents2,Collections.singleton("group2Host"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  assertEquals("kafka Ganglia config not properly exported",createExportedHostName(expectedHostGroupName,expectedPortNumberOne),kafkaBrokerProperties.get("kafka.ganglia.metrics.host"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testOozieConfigClusterUpdateHAEnabledSpecifyingHostNamesDirectly() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedHostNameTwo="c6402.ambari.apache.org";
  final String expectedExternalHost="c6408.ambari.apache.org";
  final String expectedHostGroupName="host_group_1";
  final String expectedHostGroupNameTwo="host_group_2";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> oozieSiteProperties=new HashMap<String,String>();
  Map<String,String> oozieEnvProperties=new HashMap<String,String>();
  Map<String,String> coreSiteProperties=new HashMap<String,String>();
  configProperties.put("oozie-site",oozieSiteProperties);
  configProperties.put("oozie-env",oozieEnvProperties);
  configProperties.put("hive-env",oozieEnvProperties);
  configProperties.put("core-site",coreSiteProperties);
  oozieSiteProperties.put("oozie.base.url",expectedHostName);
  oozieSiteProperties.put("oozie.authentication.kerberos.principal",expectedHostName);
  oozieSiteProperties.put("oozie.service.HadoopAccessorService.kerberos.principal",expectedHostName);
  oozieSiteProperties.put("oozie.service.JPAService.jdbc.url","jdbc:mysql://" + expectedExternalHost + "/ooziedb");
  oozieSiteProperties.put("oozie.services.ext","org.apache.oozie.service.ZKLocksService,org.apache.oozie.service.ZKXLogStreamingService,org.apache.oozie.service.ZKJobsConcurrencyService,org.apache.oozie.service.ZKUUIDService");
  oozieEnvProperties.put("oozie_hostname",expectedHostName);
  oozieEnvProperties.put("oozie_existing_mysql_host",expectedExternalHost);
  coreSiteProperties.put("hadoop.proxyuser.oozie.hosts",expectedHostName + "," + expectedHostNameTwo);
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("OOZIE_SERVER");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,Collections.singleton("host1"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("OOZIE_SERVER");
  TestHostGroup group2=new TestHostGroup(expectedHostGroupNameTwo,hgComponents2,Collections.singleton("host2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  expect(stack.getCardinality("OOZIE_SERVER")).andReturn(new Cardinality("1+")).anyTimes();
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertEquals("oozie property not updated correctly",expectedHostName,oozieSiteProperties.get("oozie.base.url"));
  assertEquals("oozie property not updated correctly",expectedHostName,oozieSiteProperties.get("oozie.authentication.kerberos.principal"));
  assertEquals("oozie property not updated correctly",expectedHostName,oozieSiteProperties.get("oozie.service.HadoopAccessorService.kerberos.principal"));
  assertEquals("oozie property not updated correctly",expectedHostName,oozieEnvProperties.get("oozie_hostname"));
  assertEquals("oozie property not updated correctly",expectedHostName + "," + expectedHostNameTwo,coreSiteProperties.get("hadoop.proxyuser.oozie.hosts"));
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForBlueprintExport_SingleHostProperty() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("yarn.resourcemanager.hostname","testhost");
  properties.put("yarn-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  String updatedVal=properties.get("yarn-site").get("yarn.resourcemanager.hostname");
  assertEquals("%HOSTGROUP::group1%",updatedVal);
}

</code></pre>

<pre class="type-4 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDoUpdateForClusterCreate_MultiHostProperty__exportedValues___withPorts_UsingMinusSymbolInHostGroupName() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("ha.zookeeper.quorum","%HOSTGROUP::os-amb-r6-secha-1427972156-hbaseha-3-6%:2181,%HOSTGROUP::os-amb-r6-secha-1427972156-hbaseha-3-5%:2181,%HOSTGROUP::os-amb-r6-secha-1427972156-hbaseha-3-7%:2181");
  properties.put("core-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("ZOOKEEPER_SERVER");
  TestHostGroup group1=new TestHostGroup("os-amb-r6-secha-1427972156-hbaseha-3-6",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  hgComponents2.add("ZOOKEEPER_SERVER");
  Set<String> hosts2=new HashSet<String>();
  hosts2.add("testhost2");
  hosts2.add("testhost2a");
  hosts2.add("testhost2b");
  TestHostGroup group2=new TestHostGroup("os-amb-r6-secha-1427972156-hbaseha-3-5",hgComponents2,hosts2);
  Collection<String> hgComponents3=new HashSet<String>();
  hgComponents2.add("HDFS_CLIENT");
  hgComponents2.add("ZOOKEEPER_CLIENT");
  Set<String> hosts3=new HashSet<String>();
  hosts3.add("testhost3");
  hosts3.add("testhost3a");
  TestHostGroup group3=new TestHostGroup("os-amb-r6-secha-1427972156-hbaseha-3-7",hgComponents3,hosts3);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  hostGroups.add(group3);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  String updatedVal=topology.getConfiguration().getFullProperties().get("core-site").get("ha.zookeeper.quorum");
  String[] hosts=updatedVal.split(",");
  Collection<String> expectedHosts=new HashSet<String>();
  expectedHosts.add("testhost:2181");
  expectedHosts.add("testhost2:2181");
  expectedHosts.add("testhost2a:2181");
  expectedHosts.add("testhost2b:2181");
  expectedHosts.add("testhost3:2181");
  expectedHosts.add("testhost3a:2181");
  assertEquals(6,hosts.length);
  for (  String host : hosts) {
    assertTrue("Expected host :" + host + "was not included in the multi-server list in this property.",expectedHosts.contains(host));
    expectedHosts.remove(host);
  }
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testYamlMultiValueWithSingleQuoteFlowStyleFormatMultiValueInSquareBrackets() throws Exception {
  BlueprintConfigurationProcessor.YamlMultiValuePropertyDecorator yamlMultiValuePropertyDecorator=new BlueprintConfigurationProcessor.YamlMultiValuePropertyDecorator(null);
  String originalValue="['test_value1','test_value2']";
  String newValue=yamlMultiValuePropertyDecorator.doFormat(originalValue);
  String expectedValue="['test_value1','test_value2']";
  assertEquals(expectedValue,newValue);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testStormAmsPropertiesUserDefinedReporter() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> stormSite=new HashMap<String,String>();
  stormSite.put("metrics.reporter.register","user.Reporter");
  properties.put("storm-site",stormSite);
  Map<String,Map<String,String>> parentProperties=new HashMap<String,Map<String,String>>();
  Configuration parentClusterConfig=new Configuration(parentProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),parentClusterConfig);
  Collection<String> hgComponents1=new HashSet<String>();
  hgComponents1.add("METRICS_COLLECTOR");
  hgComponents1.add("NIMBUS");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents1,Collections.singleton("host1"));
  Collection<TestHostGroup> hostGroups=Collections.singletonList(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForClusterCreate();
  assertEquals("user.Reporter",clusterConfig.getPropertyValue("storm-site","metrics.reporter.register"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testHawqConfigClusterUpdate() throws Exception {
  final String expectedHostNameHawqMaster="c6401.apache.ambari.org";
  final String expectedHostNameHawqStandby="c6402.apache.ambari.org";
  final String expectedHostNameNamenode="c6403.apache.ambari.org";
  final String expectedPortNamenode="8020";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> hawqSite=new HashMap<String,String>();
  properties.put("hawq-site",hawqSite);
  hawqSite.put("hawq_master_address_host","localhost");
  hawqSite.put("hawq_standby_address_host","localhost");
  hawqSite.put("hawq_dfs_url",createHostAddress("localhost",expectedPortNamenode) + "/hawq_default");
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton(expectedHostNameNamenode));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("HAWQMASTER");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton(expectedHostNameHawqMaster));
  Collection<String> hgComponents3=new HashSet<String>();
  hgComponents3.add("HAWQSTANDBY");
  TestHostGroup group3=new TestHostGroup("group3",hgComponents3,Collections.singleton(expectedHostNameHawqStandby));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  hostGroups.add(group3);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertEquals(expectedHostNameHawqMaster,hawqSite.get("hawq_master_address_host"));
  assertEquals(expectedHostNameHawqStandby,hawqSite.get("hawq_standby_address_host"));
  assertEquals(createHostAddress(expectedHostNameNamenode,expectedPortNamenode) + "/hawq_default",hawqSite.get("hawq_dfs_url"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testHdfsWithRangerKmsServer_default() throws Exception {
  final String configType="hdfs-site";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> configProperties=new HashMap<String,String>();
  properties.put(configType,configProperties);
  configProperties.put("dfs.encryption.key.provider.uri","kms://http@localhost:9292/kms");
  Map<String,Map<String,String>> parentProperties=new HashMap<String,Map<String,String>>();
  Configuration parentClusterConfig=new Configuration(parentProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),parentClusterConfig);
  Collection<String> kmsServerComponents=new HashSet<String>();
  kmsServerComponents.add("RANGER_KMS_SERVER");
  Collection<String> hdfsComponents=new HashSet<String>();
  hdfsComponents.add("NAMENODE");
  hdfsComponents.add("DATANODE");
  TestHostGroup group1=new TestHostGroup("group1",kmsServerComponents,Collections.singleton("host1"));
  group1.components.add("DATANODE");
  TestHostGroup group2=new TestHostGroup("group2",hdfsComponents,Collections.singleton("host2"));
  Collection<TestHostGroup> hostGroups=Lists.newArrayList(group1,group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForClusterCreate();
  assertEquals("kms://http@host1:9292/kms",clusterConfig.getPropertyValue(configType,"dfs.encryption.key.provider.uri"));
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMultipleHostTopologyUpdaterWithYamlPropertySingleHostValue() throws Exception {
  String component="test_component";
  BlueprintConfigurationProcessor.MultipleHostTopologyUpdater mhtu=new BlueprintConfigurationProcessor.MultipleHostTopologyUpdater(component);
  String propertyOriginalValue1="['%HOSTGROUP::group_1%']";
  String propertyOriginalValue2="[%HOSTGROUP::group_1%]";
  String updatedValue1=mhtu.resolveHostGroupPlaceholder(propertyOriginalValue1,null,ImmutableList.<String>of("host1:100"));
  String updatedValue2=mhtu.resolveHostGroupPlaceholder(propertyOriginalValue2,null,ImmutableList.<String>of("host1:100"));
  assertEquals("host1:100",updatedValue1);
  assertEquals("host1:100",updatedValue2);
}

</code></pre>

<pre class="type-4 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testParseNameNodes() throws Exception {
  final String expectedServiceName="serviceOne";
  Map<String,String> hdfsSiteConfigMap=new HashMap<String,String>();
  hdfsSiteConfigMap.put("dfs.ha.namenodes." + expectedServiceName,"node1");
  String[] result=BlueprintConfigurationProcessor.parseNameNodes(expectedServiceName,hdfsSiteConfigMap);
  assertNotNull("Resulting array was null",result);
  assertEquals("Incorrect array size",1,result.length);
  assertEquals("Incorrect value for returned name nodes","node1",result[0]);
  hdfsSiteConfigMap.put("dfs.ha.namenodes." + expectedServiceName," nodeSeven, nodeEight, nodeNine");
  String[] resultTwo=BlueprintConfigurationProcessor.parseNameNodes(expectedServiceName,hdfsSiteConfigMap);
  assertNotNull("Resulting array was null",resultTwo);
  assertEquals("Incorrect array size",3,resultTwo.length);
  assertEquals("Incorrect value for returned name node","nodeSeven",resultTwo[0]);
  assertEquals("Incorrect value for returned name node","nodeEight",resultTwo[1]);
  assertEquals("Incorrect value for returned name node","nodeNine",resultTwo[2]);
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testYamlMultiValueWithSingleQuoteFlowStyleFormatMultiValue() throws Exception {
  BlueprintConfigurationProcessor.YamlMultiValuePropertyDecorator yamlMultiValuePropertyDecorator=new BlueprintConfigurationProcessor.YamlMultiValuePropertyDecorator(null);
  String originalValue="test_value1,test_value2";
  String newValue=yamlMultiValuePropertyDecorator.doFormat(originalValue);
  String expectedValue="['test_value1','test_value2']";
  assertEquals(expectedValue,newValue);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testHiveConfigClusterUpdateSpecifyingHostNamesHiveServer2HA() throws Exception {
  final String expectedHostGroupName="host_group_1";
  final String expectedPropertyValue="c6401.ambari.apache.org";
  final String expectedMetaStoreURIs="thrift://c6401.ambari.apache.org:9083,thrift://c6402.ambari.apache.org:9083";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> hiveEnvProperties=new HashMap<String,String>();
  Map<String,String> hiveSiteProperties=new HashMap<String,String>();
  configProperties.put("hive-env",hiveEnvProperties);
  configProperties.put("hive-site",hiveSiteProperties);
  hiveEnvProperties.put("hive_hostname",expectedPropertyValue);
  hiveSiteProperties.put("hive.server2.support.dynamic.service.discovery","true");
  hiveSiteProperties.put("hive.metastore.uris",expectedMetaStoreURIs);
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("HIVE_SERVER");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,Collections.singleton("some-host"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("HIVE_SERVER");
  TestHostGroup group2=new TestHostGroup("host_group_2",hgComponents2,Collections.singleton("some-host2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  expect(stack.getCardinality("HIVE_SERVER")).andReturn(new Cardinality("1+")).anyTimes();
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertEquals("Unexpected config update for hive_hostname",expectedPropertyValue,hiveEnvProperties.get("hive_hostname"));
  assertEquals("Unexpected config update for hive.metastore.uris",expectedMetaStoreURIs,hiveSiteProperties.get("hive.metastore.uris"));
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForBlueprintExport_MultiHostProperty__YAML() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("storm.zookeeper.servers","['testhost:5050','testhost2:9090','testhost2a:9090','testhost2b:9090']");
  typeProps.put("drpc_server_host","['testhost:5050']");
  typeProps.put("storm_ui_server_host","['testhost:5050']");
  typeProps.put("supervisor_hosts","['testhost:5050','testhost2:9090']");
  properties.put("storm-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("ZOOKEEPER_SERVER");
  hgComponents.add("DRPC_SERVER");
  hgComponents.add("STORM_UI_SERVER");
  hgComponents.add("SUPERVISOR");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  hgComponents2.add("ZOOKEEPER_SERVER");
  hgComponents2.add("SUPERVISOR");
  Set<String> hosts2=new HashSet<String>();
  hosts2.add("testhost2");
  hosts2.add("testhost2a");
  hosts2.add("testhost2b");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,hosts2);
  Collection<String> hgComponents3=new HashSet<String>();
  hgComponents2.add("HDFS_CLIENT");
  hgComponents2.add("ZOOKEEPER_CLIENT");
  Set<String> hosts3=new HashSet<String>();
  hosts3.add("testhost3");
  hosts3.add("testhost3a");
  TestHostGroup group3=new TestHostGroup("group3",hgComponents3,hosts3);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  hostGroups.add(group3);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  String updatedVal=properties.get("storm-site").get("storm.zookeeper.servers");
  assertEquals("['%HOSTGROUP::group1%:5050','%HOSTGROUP::group2%:9090']",updatedVal);
  String updatedVa2=properties.get("storm-site").get("drpc_server_host");
  assertEquals("['%HOSTGROUP::group1%:5050']",updatedVa2);
  String updatedVa3=properties.get("storm-site").get("storm_ui_server_host");
  assertEquals("['%HOSTGROUP::group1%:5050']",updatedVa3);
  String updatedVa4=properties.get("storm-site").get("supervisor_hosts");
  assertEquals("['%HOSTGROUP::group1%:5050','%HOSTGROUP::group2%:9090']",updatedVa4);
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testYamlMultiValueWithPlainFlowStyleFormatMultiValue() throws Exception {
  BlueprintConfigurationProcessor.YamlMultiValuePropertyDecorator yamlMultiValuePropertyDecorator=new BlueprintConfigurationProcessor.YamlMultiValuePropertyDecorator(null,BlueprintConfigurationProcessor.YamlMultiValuePropertyDecorator.FlowStyle.PLAIN);
  String originalValue="test_value1,test_value2";
  String newValue=yamlMultiValuePropertyDecorator.doFormat(originalValue);
  String expectedValue="[test_value1,test_value2]";
  assertEquals(expectedValue,newValue);
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForClusterVerifyRetrySettingsCustomized() throws Exception {
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  HashMap<String,String> clusterEnvProperties=new HashMap<String,String>();
  configProperties.put("cluster-env",clusterEnvProperties);
  clusterEnvProperties.put("command_retry_enabled","false");
  clusterEnvProperties.put("commands_to_retry","TEST");
  clusterEnvProperties.put("command_retry_max_time_in_sec","1");
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  TestHostGroup testHostGroup=new TestHostGroup("test-host-group-one",Collections.<String>emptySet(),Collections.<String>emptySet());
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,Collections.singleton(testHostGroup));
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  Set<String> updatedConfigTypes=updater.doUpdateForClusterCreate();
  assertEquals("Incorrect number of properties added to cluster-env for retry",3,clusterEnvProperties.size());
  assertEquals("command_retry_enabled was not set to the expected default","false",clusterEnvProperties.get("command_retry_enabled"));
  assertEquals("commands_to_retry was not set to the expected default","TEST",clusterEnvProperties.get("commands_to_retry"));
  assertEquals("command_retry_max_time_in_sec was not set to the expected default","1",clusterEnvProperties.get("command_retry_max_time_in_sec"));
  assertEquals("Incorrect number of config types updated",0,updatedConfigTypes.size());
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoNameNodeHighAvailabilityExportWithHAEnabled() throws Exception {
  final String expectedNameService="mynameservice";
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedPortNum="808080";
  final String expectedNodeOne="nn1";
  final String expectedNodeTwo="nn2";
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> hdfsSiteProperties=new HashMap<String,String>();
  Map<String,String> coreSiteProperties=new HashMap<String,String>();
  Map<String,String> hbaseSiteProperties=new HashMap<String,String>();
  configProperties.put("hdfs-site",hdfsSiteProperties);
  configProperties.put("core-site",coreSiteProperties);
  configProperties.put("hbase-site",hbaseSiteProperties);
  hdfsSiteProperties.put("dfs.nameservices",expectedNameService);
  hdfsSiteProperties.put("dfs.ha.namenodes.mynameservice",expectedNodeOne + ", " + expectedNodeTwo);
  hdfsSiteProperties.put("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeOne,expectedHostName + ":" + expectedPortNum);
  hdfsSiteProperties.put("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeTwo,expectedHostName + ":" + expectedPortNum);
  hdfsSiteProperties.put("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeOne,expectedHostName + ":" + expectedPortNum);
  hdfsSiteProperties.put("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeTwo,expectedHostName + ":" + expectedPortNum);
  hdfsSiteProperties.put("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeOne,expectedHostName + ":" + expectedPortNum);
  hdfsSiteProperties.put("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeTwo,expectedHostName + ":" + expectedPortNum);
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> groupComponents=new HashSet<String>();
  groupComponents.add("NAMENODE");
  Collection<String> hosts=new ArrayList<String>();
  hosts.add(expectedHostName);
  hosts.add("serverTwo");
  TestHostGroup group=new TestHostGroup(expectedHostGroupName,groupComponents,hosts);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  assertEquals("HTTPS address HA property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeTwo));
  assertEquals("HTTPS address HA property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeTwo));
  assertEquals("HTTPS address HA property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeTwo));
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testYamlMultiValueWithSingleQuoteFlowStyleFormatSingleValue() throws Exception {
  BlueprintConfigurationProcessor.YamlMultiValuePropertyDecorator yamlMultiValuePropertyDecorator=new BlueprintConfigurationProcessor.YamlMultiValuePropertyDecorator(null);
  String originalValue="test_value";
  String newValue=yamlMultiValuePropertyDecorator.doFormat(originalValue);
  String expectedValue="['test_value']";
  assertEquals(expectedValue,newValue);
}

</code></pre>

<pre class="type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHiveConfigClusterUpdateDefaultValueWithMetaStoreHA() throws Exception {
  final String expectedHostGroupName="host_group_1";
  final String expectedHostNameOne="c6401.ambari.apache.org";
  final String expectedHostNameTwo="c6402.ambari.apache.org";
  final String expectedPropertyValue="hive.metastore.local=false,hive.metastore.uris=thrift://localhost:9933,hive.metastore.sasl.enabled=false";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> webHCatSiteProperties=new HashMap<String,String>();
  configProperties.put("webhcat-site",webHCatSiteProperties);
  webHCatSiteProperties.put("templeton.hive.properties",expectedPropertyValue);
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("HIVE_METASTORE");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,Collections.singleton(expectedHostNameOne));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("HIVE_METASTORE");
  TestHostGroup group2=new TestHostGroup("host_group_2",hgComponents2,Collections.singleton(expectedHostNameTwo));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertEquals("Unexpected config update for templeton.hive.properties","hive.metastore.local=false,hive.metastore.uris=",webHCatSiteProperties.get("templeton.hive.properties").substring(0,47));
  assertEquals("Unexpected config update for templeton.hive.properties",",hive.metastore.sasl.enabled=false",webHCatSiteProperties.get("templeton.hive.properties").substring(123));
  List<String> parts=Arrays.asList(new String[]{"thrift://" + expectedHostNameOne + ":9933","thrift://" + expectedHostNameTwo + ":9933"});
  assertTrue("Unexpected config update for templeton.hive.properties",CollectionPresentationUtils.isStringPermutationOfCollection(webHCatSiteProperties.get("templeton.hive.properties"),parts,"\\,",47,34));
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testHiveConfigClusterUpdatePropertiesFilterAuthenticationOn() throws Exception {
  reset(stack);
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> hiveSiteProperties=new HashMap<String,String>();
  properties.put("hive-site",hiveSiteProperties);
  hiveSiteProperties.put("hive.server2.authentication","KERBEROS");
  hiveSiteProperties.put("hive.server2.authentication.kerberos.keytab"," ");
  hiveSiteProperties.put("hive.server2.authentication.kerberos.principal"," ");
  Map<String,Stack.ConfigProperty> mapOfMetadata=new HashMap<String,Stack.ConfigProperty>();
  Stack.ConfigProperty configProperty1=new Stack.ConfigProperty("hive-site","hive.server2.authentication.kerberos.keytab"," "){
    @Override Set<PropertyDependencyInfo> getDependsOnProperties(){
      PropertyDependencyInfo dependencyInfo=new PropertyDependencyInfo("hive-site","hive.server2.authentication");
      return Collections.singleton(dependencyInfo);
    }
  }
;
  Stack.ConfigProperty configProperty2=new Stack.ConfigProperty("hive-site","hive.server2.authentication.kerberos.principal"," "){
    @Override Set<PropertyDependencyInfo> getDependsOnProperties(){
      PropertyDependencyInfo dependencyInfo=new PropertyDependencyInfo("hive-site","hive.server2.authentication");
      return Collections.singleton(dependencyInfo);
    }
  }
;
  mapOfMetadata.put("hive.server2.authentication.kerberos.keytab",configProperty1);
  mapOfMetadata.put("hive.server2.authentication.kerberos.principal",configProperty2);
  expect(stack.getName()).andReturn("testStack").anyTimes();
  expect(stack.getVersion()).andReturn("1").anyTimes();
  expect(stack.isMasterComponent((String)anyObject())).andReturn(false).anyTimes();
  expect(stack.getServiceForConfigType("hive-site")).andReturn("HIVE").atLeastOnce();
  expect(stack.getConfigurationPropertiesWithMetadata("HIVE","hive-site")).andReturn(mapOfMetadata).atLeastOnce();
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  List<String> hosts=new ArrayList<String>();
  hosts.add("some-hose");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,hosts);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertTrue("hive.server2.authentication.kerberos.keytab should have been included in configuration",hiveSiteProperties.containsKey("hive.server2.authentication.kerberos.keytab"));
  assertTrue("hive.server2.authentication.kerberos.principal should have been included in configuration",hiveSiteProperties.containsKey("hive.server2.authentication.kerberos.principal"));
}

</code></pre>

<pre class="type-4 type-13 type-10 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDoUpdateForClusterWithNameNodeHAEnabledSpecifyingHostNamesDirectly() throws Exception {
  final String expectedNameService="mynameservice";
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedHostNameTwo="serverTwo";
  final String expectedPortNum="808080";
  final String expectedNodeOne="nn1";
  final String expectedNodeTwo="nn2";
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> hdfsSiteProperties=new HashMap<String,String>();
  Map<String,String> hbaseSiteProperties=new HashMap<String,String>();
  Map<String,String> hadoopEnvProperties=new HashMap<String,String>();
  Map<String,String> coreSiteProperties=new HashMap<String,String>();
  Map<String,String> accumuloSiteProperties=new HashMap<String,String>();
  configProperties.put("hdfs-site",hdfsSiteProperties);
  configProperties.put("hadoop-env",hadoopEnvProperties);
  configProperties.put("core-site",coreSiteProperties);
  configProperties.put("hbase-site",hbaseSiteProperties);
  configProperties.put("accumulo-site",accumuloSiteProperties);
  hdfsSiteProperties.put("dfs.nameservices",expectedNameService);
  hdfsSiteProperties.put("dfs.ha.namenodes.mynameservice",expectedNodeOne + ", " + expectedNodeTwo);
  hdfsSiteProperties.put("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeOne,createHostAddress(expectedHostName,expectedPortNum));
  hdfsSiteProperties.put("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeTwo,createHostAddress(expectedHostNameTwo,expectedPortNum));
  hdfsSiteProperties.put("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeOne,createHostAddress(expectedHostName,expectedPortNum));
  hdfsSiteProperties.put("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeTwo,createHostAddress(expectedHostNameTwo,expectedPortNum));
  hdfsSiteProperties.put("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeOne,createHostAddress(expectedHostName,expectedPortNum));
  hdfsSiteProperties.put("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeTwo,createHostAddress(expectedHostNameTwo,expectedPortNum));
  hdfsSiteProperties.put("dfs.secondary.http.address","localhost:8080");
  hdfsSiteProperties.put("dfs.namenode.secondary.http-address","localhost:8080");
  coreSiteProperties.put("fs.defaultFS","hdfs://" + expectedNameService);
  hbaseSiteProperties.put("hbase.rootdir","hdfs://" + expectedNameService + "/hbase/test/root/dir");
  accumuloSiteProperties.put("instance.volumes","hdfs://" + expectedNameService + "/accumulo/test/instance/volumes");
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,Collections.singleton(expectedHostName));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("NAMENODE");
  TestHostGroup group2=new TestHostGroup("host-group-2",hgComponents2,Collections.singleton(expectedHostNameTwo));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  expect(stack.getCardinality("NAMENODE")).andReturn(new Cardinality("1-2")).anyTimes();
  expect(stack.getCardinality("SECONDARY_NAMENODE")).andReturn(new Cardinality("1")).anyTimes();
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertEquals("HTTPS address HA property not properly exported",expectedHostName + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",expectedHostNameTwo + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeTwo));
  assertEquals("HTTPS address HA property not properly exported",expectedHostName + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",expectedHostNameTwo + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeTwo));
  assertEquals("HTTPS address HA property not properly exported",expectedHostName + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",expectedHostNameTwo + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeTwo));
  String activeHost=hadoopEnvProperties.get("dfs_ha_initial_namenode_active");
  if (activeHost.equals(expectedHostName)) {
    assertEquals("Standby Namenode hostname was not set correctly",expectedHostNameTwo,hadoopEnvProperties.get("dfs_ha_initial_namenode_standby"));
  }
 else   if (activeHost.equals(expectedHostNameTwo)) {
    assertEquals("Standby Namenode hostname was not set correctly",expectedHostName,hadoopEnvProperties.get("dfs_ha_initial_namenode_standby"));
  }
 else {
    fail("Active Namenode hostname was not set correctly: " + activeHost);
  }
  assertEquals("fs.defaultFS should not be modified by cluster update when NameNode HA is enabled.","hdfs://" + expectedNameService,coreSiteProperties.get("fs.defaultFS"));
  assertEquals("hbase.rootdir should not be modified by cluster update when NameNode HA is enabled.","hdfs://" + expectedNameService + "/hbase/test/root/dir",hbaseSiteProperties.get("hbase.rootdir"));
  assertEquals("instance.volumes should not be modified by cluster update when NameNode HA is enabled.","hdfs://" + expectedNameService + "/accumulo/test/instance/volumes",accumuloSiteProperties.get("instance.volumes"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testKafkaAmsProperties() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> stormSite=new HashMap<String,String>();
  stormSite.put("kafka.metrics.reporters","");
  properties.put("kafka-broker",stormSite);
  Map<String,Map<String,String>> parentProperties=new HashMap<String,Map<String,String>>();
  Configuration parentClusterConfig=new Configuration(parentProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),parentClusterConfig);
  Collection<String> hgComponents1=new HashSet<String>();
  hgComponents1.add("METRICS_COLLECTOR");
  hgComponents1.add("KAFKA_BROKER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents1,Collections.singleton("host1"));
  Collection<TestHostGroup> hostGroups=Collections.singletonList(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForClusterCreate();
  assertEquals("org.apache.hadoop.metrics2.sink.kafka.KafkaTimelineMetricsReporter",clusterConfig.getPropertyValue("kafka-broker","kafka.metrics.reporters"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testKafkaAmsPropertiesMultipleReporters() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> stormSite=new HashMap<String,String>();
  stormSite.put("kafka.metrics.reporters","user.Reporter");
  properties.put("kafka-broker",stormSite);
  Map<String,Map<String,String>> parentProperties=new HashMap<String,Map<String,String>>();
  Configuration parentClusterConfig=new Configuration(parentProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),parentClusterConfig);
  Collection<String> hgComponents1=new HashSet<String>();
  hgComponents1.add("METRICS_COLLECTOR");
  hgComponents1.add("KAFKA_BROKER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents1,Collections.singleton("host1"));
  Collection<TestHostGroup> hostGroups=Collections.singletonList(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForClusterCreate();
  assertEquals("user.Reporter,org.apache.hadoop.metrics2.sink.kafka.KafkaTimelineMetricsReporter",clusterConfig.getPropertyValue("kafka-broker","kafka.metrics.reporters"));
}

</code></pre>

<pre class="type-4 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRecommendConfiguration_applyStackDefaultsOnly() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedPortNum="808080";
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> coreSiteMap=new HashMap<String,String>();
  properties.put("core-site",coreSiteMap);
  coreSiteMap.put("fs.default.name",expectedHostName + ":" + expectedPortNum);
  coreSiteMap.put("fs.defaultFS","hdfs://" + expectedHostName + ":"+ expectedPortNum);
  coreSiteMap.put("fs.stackDefault.key2","dummyValue");
  Map<String,String> dummySiteMap=new HashMap<String,String>();
  properties.put("dummy-site",dummySiteMap);
  dummySiteMap.put("dummy.prop","dummyValue2");
  Map<String,Map<String,String>> parentProperties=new HashMap<String,Map<String,String>>();
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton(expectedHostGroupName));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  Configuration parentConfig=new Configuration(parentProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),createStackDefaults());
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),parentConfig);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  topology.getAdvisedConfigurations().putAll(createAdvisedConfigMap());
  topology.setConfigRecommendationStrategy(ConfigRecommendationStrategy.ONLY_STACK_DEFAULTS_APPLY);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  reset(stack);
  expect(stack.getConfiguration(bp.getServices())).andReturn(createStackDefaults()).anyTimes();
  replay(stack);
  Set<String> configTypeUpdated=configProcessor.doUpdateForClusterCreate();
  assertEquals(expectedHostName + ":" + expectedPortNum,clusterConfig.getPropertyValue("core-site","fs.default.name"));
  assertEquals("stackDefaultUpgraded",clusterConfig.getPropertyValue("core-site","fs.stackDefault.key1"));
  assertNull(clusterConfig.getPropertyValue("core-site","fs.stackDefault.key2"));
  assertNull(clusterConfig.getPropertyValue("core-site","fs.notStackDefault"));
  assertTrue(configTypeUpdated.contains("dummy-site"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testYarnConfigExported() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedPortNum="808080";
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> yarnSiteProperties=new HashMap<String,String>();
  configProperties.put("yarn-site",yarnSiteProperties);
  yarnSiteProperties.put("yarn.log.server.url","http://" + expectedHostName + ":19888/jobhistory/logs");
  yarnSiteProperties.put("yarn.resourcemanager.hostname",expectedHostName);
  yarnSiteProperties.put("yarn.resourcemanager.resource-tracker.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.webapp.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.scheduler.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.admin.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.timeline-service.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.timeline-service.webapp.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.timeline-service.webapp.https.address",expectedHostName + ":" + expectedPortNum);
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> groupComponents=new HashSet<String>();
  groupComponents.add("RESOURCEMANAGER");
  Collection<String> hosts=new ArrayList<String>();
  hosts.add(expectedHostName);
  hosts.add("serverTwo");
  TestHostGroup group=new TestHostGroup(expectedHostGroupName,groupComponents,hosts);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  assertEquals("Yarn Log Server URL was incorrectly exported","http://" + "%HOSTGROUP::" + expectedHostGroupName + "%"+ ":19888/jobhistory/logs",yarnSiteProperties.get("yarn.log.server.url"));
  assertEquals("Yarn ResourceManager hostname was incorrectly exported",createExportedHostName(expectedHostGroupName),yarnSiteProperties.get("yarn.resourcemanager.hostname"));
  assertEquals("Yarn ResourceManager tracker address was incorrectly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),yarnSiteProperties.get("yarn.resourcemanager.resource-tracker.address"));
  assertEquals("Yarn ResourceManager webapp address was incorrectly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),yarnSiteProperties.get("yarn.resourcemanager.webapp.address"));
  assertEquals("Yarn ResourceManager scheduler address was incorrectly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),yarnSiteProperties.get("yarn.resourcemanager.scheduler.address"));
  assertEquals("Yarn ResourceManager address was incorrectly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),yarnSiteProperties.get("yarn.resourcemanager.address"));
  assertEquals("Yarn ResourceManager admin address was incorrectly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),yarnSiteProperties.get("yarn.resourcemanager.admin.address"));
  assertEquals("Yarn ResourceManager timeline-service address was incorrectly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),yarnSiteProperties.get("yarn.timeline-service.address"));
  assertEquals("Yarn ResourceManager timeline webapp address was incorrectly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),yarnSiteProperties.get("yarn.timeline-service.webapp.address"));
  assertEquals("Yarn ResourceManager timeline webapp HTTPS address was incorrectly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),yarnSiteProperties.get("yarn.timeline-service.webapp.https.address"));
}

</code></pre>

<pre class="type-4 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDoUpdateForClusterCreate_SingleHostProperty__defaultValue() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  Map<String,String> typeProps2=new HashMap<String,String>();
  typeProps.put("yarn.resourcemanager.hostname","localhost");
  typeProps2.put("oozie_heapsize","1024");
  typeProps2.put("oozie_permsize","128");
  properties.put("oozie-env",typeProps2);
  properties.put("yarn-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> group1Components=new HashSet<String>();
  group1Components.add("NAMENODE");
  group1Components.add("SECONDARY_NAMENODE");
  group1Components.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("group1",group1Components,Collections.singleton("testhost"));
  Collection<String> group2Components=new HashSet<String>();
  group2Components.add("DATANODE");
  group2Components.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",group2Components,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  Set<String> configTypesUpdated=updater.doUpdateForClusterCreate();
  String updatedVal=properties.get("yarn-site").get("yarn.resourcemanager.hostname");
  assertEquals("testhost",updatedVal);
  String updatedVal1=properties.get("oozie-env").get("oozie_heapsize");
  assertEquals("1024m",updatedVal1);
  String updatedVal2=properties.get("oozie-env").get("oozie_permsize");
  assertEquals("128m",updatedVal2);
  assertEquals("Incorrect number of config types updated",3,configTypesUpdated.size());
  assertTrue("Expected config type not updated",configTypesUpdated.contains("oozie-env"));
  assertTrue("Expected config type not updated",configTypesUpdated.contains("yarn-site"));
  assertTrue("Expected config type not updated",configTypesUpdated.contains("cluster-env"));
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForBlueprintExportRangerHAPolicyMgrExternalUrlProperty() throws Exception {
  Map<String,String> rangerAdminProperties=Maps.newHashMap();
  rangerAdminProperties.put("DB_FLAVOR","test_db_flavor");
  rangerAdminProperties.put("policymgr_external_url","test_policymgr_external_url");
  Map<String,Map<String,String>> properties=ImmutableMap.of("admin-properties",rangerAdminProperties);
  Configuration clusterConfig=new Configuration(properties,ImmutableMap.<String,Map<String,Map<String,String>>>of());
  Collection<String> hostGroup1Components=ImmutableSet.of("RANGER_ADMIN");
  TestHostGroup group1=new TestHostGroup("group1",hostGroup1Components,Collections.singleton("testhost1"));
  Collection<String> hostGroup2Components=ImmutableSet.of("RANGER_ADMIN");
  TestHostGroup group2=new TestHostGroup("group2",hostGroup2Components,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=ImmutableSet.of(group1,group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  assertEquals("policymgr_external_url property's original value should be exported when Ranger Admin is deployed to multiple hosts.","test_policymgr_external_url",properties.get("admin-properties").get("policymgr_external_url"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoNameNodeHighAvailabilityExportWithHAEnabledNameServicePropertiesIncluded() throws Exception {
  final String expectedNameService="mynameservice";
  final String expectedHostName="c6401.apache.ambari.org";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> coreSiteProperties=new HashMap<String,String>();
  Map<String,String> hbaseSiteProperties=new HashMap<String,String>();
  Map<String,String> accumuloSiteProperties=new HashMap<String,String>();
  configProperties.put("core-site",coreSiteProperties);
  configProperties.put("hbase-site",hbaseSiteProperties);
  configProperties.put("accumulo-site",accumuloSiteProperties);
  coreSiteProperties.put("fs.defaultFS","hdfs://" + expectedNameService);
  hbaseSiteProperties.put("hbase.rootdir","hdfs://" + expectedNameService + "/apps/hbase/data");
  accumuloSiteProperties.put("instance.volumes","hdfs://" + expectedNameService + "/apps/accumulo/data");
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> groupComponents=new HashSet<String>();
  groupComponents.add("RESOURCEMANAGER");
  Collection<String> hosts=new ArrayList<String>();
  hosts.add(expectedHostName);
  hosts.add("serverTwo");
  TestHostGroup group=new TestHostGroup("group1",groupComponents,hosts);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  assertEquals("Property containing an HA nameservice (fs.defaultFS), was not correctly exported by the processor","hdfs://" + expectedNameService,coreSiteProperties.get("fs.defaultFS"));
  assertEquals("Property containing an HA nameservice (hbase.rootdir), was not correctly exported by the processor","hdfs://" + expectedNameService + "/apps/hbase/data",hbaseSiteProperties.get("hbase.rootdir"));
  assertEquals("Property containing an HA nameservice (instance.volumes), was not correctly exported by the processor","hdfs://" + expectedNameService + "/apps/accumulo/data",accumuloSiteProperties.get("instance.volumes"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testZookeeperConfigExported() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedHostNameTwo="c6402.ambari.apache.org";
  final String expectedHostGroupName="host_group_1";
  final String expectedHostGroupNameTwo="host_group_2";
  final String expectedPortNumberOne="2112";
  final String expectedPortNumberTwo="1221";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> coreSiteProperties=new HashMap<String,String>();
  Map<String,String> hbaseSiteProperties=new HashMap<String,String>();
  Map<String,String> webHCatSiteProperties=new HashMap<String,String>();
  Map<String,String> sliderClientProperties=new HashMap<String,String>();
  Map<String,String> yarnSiteProperties=new HashMap<String,String>();
  Map<String,String> kafkaBrokerProperties=new HashMap<String,String>();
  Map<String,String> accumuloSiteProperties=new HashMap<String,String>();
  configProperties.put("core-site",coreSiteProperties);
  configProperties.put("hbase-site",hbaseSiteProperties);
  configProperties.put("webhcat-site",webHCatSiteProperties);
  configProperties.put("slider-client",sliderClientProperties);
  configProperties.put("yarn-site",yarnSiteProperties);
  configProperties.put("kafka-broker",kafkaBrokerProperties);
  configProperties.put("accumulo-site",accumuloSiteProperties);
  coreSiteProperties.put("ha.zookeeper.quorum",expectedHostName + "," + expectedHostNameTwo);
  hbaseSiteProperties.put("hbase.zookeeper.quorum",expectedHostName + "," + expectedHostNameTwo);
  webHCatSiteProperties.put("templeton.zookeeper.hosts",expectedHostName + "," + expectedHostNameTwo);
  yarnSiteProperties.put("hadoop.registry.zk.quorum",createHostAddress(expectedHostName,expectedPortNumberOne) + "," + createHostAddress(expectedHostNameTwo,expectedPortNumberTwo));
  sliderClientProperties.put("slider.zookeeper.quorum",createHostAddress(expectedHostName,expectedPortNumberOne) + "," + createHostAddress(expectedHostNameTwo,expectedPortNumberTwo));
  kafkaBrokerProperties.put("zookeeper.connect",createHostAddress(expectedHostName,expectedPortNumberOne) + "," + createHostAddress(expectedHostNameTwo,expectedPortNumberTwo));
  accumuloSiteProperties.put("instance.zookeeper.host",createHostAddress(expectedHostName,expectedPortNumberOne) + "," + createHostAddress(expectedHostNameTwo,expectedPortNumberTwo));
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> groupComponents=new HashSet<String>();
  groupComponents.add("ZOOKEEPER_SERVER");
  Collection<String> hosts=new ArrayList<String>();
  hosts.add(expectedHostName);
  hosts.add("serverTwo");
  TestHostGroup group=new TestHostGroup(expectedHostGroupName,groupComponents,hosts);
  Collection<String> groupComponents2=new HashSet<String>();
  groupComponents2.add("ZOOKEEPER_SERVER");
  Collection<String> hosts2=new ArrayList<String>();
  hosts2.add(expectedHostNameTwo);
  hosts2.add("serverFour");
  TestHostGroup group2=new TestHostGroup(expectedHostGroupNameTwo,groupComponents2,hosts2);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  assertEquals("zookeeper config not properly exported",createExportedHostName(expectedHostGroupName) + "," + createExportedHostName(expectedHostGroupNameTwo),coreSiteProperties.get("ha.zookeeper.quorum"));
  assertEquals("zookeeper config not properly exported",createExportedHostName(expectedHostGroupName) + "," + createExportedHostName(expectedHostGroupNameTwo),hbaseSiteProperties.get("hbase.zookeeper.quorum"));
  assertEquals("zookeeper config not properly exported",createExportedHostName(expectedHostGroupName) + "," + createExportedHostName(expectedHostGroupNameTwo),webHCatSiteProperties.get("templeton.zookeeper.hosts"));
  assertEquals("yarn-site zookeeper config not properly exported",createExportedHostName(expectedHostGroupName,expectedPortNumberOne) + "," + createExportedHostName(expectedHostGroupNameTwo,expectedPortNumberTwo),yarnSiteProperties.get("hadoop.registry.zk.quorum"));
  assertEquals("slider-client zookeeper config not properly exported",createExportedHostName(expectedHostGroupName,expectedPortNumberOne) + "," + createExportedHostName(expectedHostGroupNameTwo,expectedPortNumberTwo),sliderClientProperties.get("slider.zookeeper.quorum"));
  assertEquals("kafka zookeeper config not properly exported",createExportedHostName(expectedHostGroupName,expectedPortNumberOne) + "," + createExportedHostName(expectedHostGroupNameTwo,expectedPortNumberTwo),kafkaBrokerProperties.get("zookeeper.connect"));
  assertEquals("accumulo-site zookeeper config not properly exported",createExportedHostName(expectedHostGroupName,expectedPortNumberOne) + "," + createExportedHostName(expectedHostGroupNameTwo,expectedPortNumberTwo),accumuloSiteProperties.get("instance.zookeeper.host"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testHiveConfigClusterUpdateCustomValueSpecifyingHostNamesMetaStoreHA() throws Exception {
  final String expectedHostGroupName="host_group_1";
  final String expectedPropertyValue="hive.metastore.local=false,hive.metastore.uris=thrift://headnode0.ivantestcluster2-ssh.d1.internal.cloudapp.net:9083,hive.user.install.directory=/user";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> webHCatSiteProperties=new HashMap<String,String>();
  configProperties.put("webhcat-site",webHCatSiteProperties);
  webHCatSiteProperties.put("templeton.hive.properties",expectedPropertyValue);
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,Collections.singleton("some-host"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  TestHostGroup group2=new TestHostGroup("host_group_2",hgComponents2,Collections.singleton("some-host2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertEquals("Unexpected config update for templeton.hive.properties",expectedPropertyValue,webHCatSiteProperties.get("templeton.hive.properties"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoNameNodeHighAvailabilityExportWithHAEnabledMultipleServices() throws Exception {
  final String expectedNameServiceOne="mynameserviceOne";
  final String expectedNameServiceTwo="mynameserviceTwo";
  final String expectedHostNameOne="c6401.apache.ambari.org";
  final String expectedHostNameTwo="c6402.apache.ambari.org";
  final String expectedPortNum="808080";
  final String expectedNodeOne="nn1";
  final String expectedNodeTwo="nn2";
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> hdfsSiteProperties=new HashMap<String,String>();
  configProperties.put("hdfs-site",hdfsSiteProperties);
  hdfsSiteProperties.put("dfs.nameservices",expectedNameServiceOne + "," + expectedNameServiceTwo);
  hdfsSiteProperties.put("dfs.ha.namenodes." + expectedNameServiceOne,expectedNodeOne + ", " + expectedNodeTwo);
  hdfsSiteProperties.put("dfs.ha.namenodes." + expectedNameServiceTwo,expectedNodeOne + ", " + expectedNodeTwo);
  hdfsSiteProperties.put("dfs.namenode.https-address." + expectedNameServiceOne + "."+ expectedNodeOne,expectedHostNameOne + ":" + expectedPortNum);
  hdfsSiteProperties.put("dfs.namenode.https-address." + expectedNameServiceOne + "."+ expectedNodeTwo,expectedHostNameOne + ":" + expectedPortNum);
  hdfsSiteProperties.put("dfs.namenode.http-address." + expectedNameServiceOne + "."+ expectedNodeOne,expectedHostNameOne + ":" + expectedPortNum);
  hdfsSiteProperties.put("dfs.namenode.http-address." + expectedNameServiceOne + "."+ expectedNodeTwo,expectedHostNameOne + ":" + expectedPortNum);
  hdfsSiteProperties.put("dfs.namenode.rpc-address." + expectedNameServiceOne + "."+ expectedNodeOne,expectedHostNameOne + ":" + expectedPortNum);
  hdfsSiteProperties.put("dfs.namenode.rpc-address." + expectedNameServiceOne + "."+ expectedNodeTwo,expectedHostNameOne + ":" + expectedPortNum);
  hdfsSiteProperties.put("dfs.namenode.https-address." + expectedNameServiceTwo + "."+ expectedNodeOne,expectedHostNameTwo + ":" + expectedPortNum);
  hdfsSiteProperties.put("dfs.namenode.https-address." + expectedNameServiceTwo + "."+ expectedNodeTwo,expectedHostNameTwo + ":" + expectedPortNum);
  hdfsSiteProperties.put("dfs.namenode.http-address." + expectedNameServiceTwo + "."+ expectedNodeOne,expectedHostNameTwo + ":" + expectedPortNum);
  hdfsSiteProperties.put("dfs.namenode.http-address." + expectedNameServiceTwo + "."+ expectedNodeTwo,expectedHostNameTwo + ":" + expectedPortNum);
  hdfsSiteProperties.put("dfs.namenode.rpc-address." + expectedNameServiceTwo + "."+ expectedNodeOne,expectedHostNameTwo + ":" + expectedPortNum);
  hdfsSiteProperties.put("dfs.namenode.rpc-address." + expectedNameServiceTwo + "."+ expectedNodeTwo,expectedHostNameTwo + ":" + expectedPortNum);
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> groupComponents=new HashSet<String>();
  groupComponents.add("RESOURCEMANAGER");
  Collection<String> hosts=new ArrayList<String>();
  hosts.add(expectedHostNameOne);
  hosts.add(expectedHostNameTwo);
  hosts.add("serverTwo");
  TestHostGroup group=new TestHostGroup(expectedHostGroupName,groupComponents,hosts);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  assertEquals("HTTPS address HA property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.namenode.https-address." + expectedNameServiceOne + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.namenode.https-address." + expectedNameServiceOne + "."+ expectedNodeTwo));
  assertEquals("HTTPS address HA property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.namenode.http-address." + expectedNameServiceOne + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.namenode.http-address." + expectedNameServiceOne + "."+ expectedNodeTwo));
  assertEquals("HTTPS address HA property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.namenode.rpc-address." + expectedNameServiceOne + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.namenode.rpc-address." + expectedNameServiceOne + "."+ expectedNodeTwo));
  assertEquals("HTTPS address HA property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.namenode.https-address." + expectedNameServiceTwo + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.namenode.https-address." + expectedNameServiceTwo + "."+ expectedNodeTwo));
  assertEquals("HTTPS address HA property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.namenode.http-address." + expectedNameServiceTwo + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.namenode.http-address." + expectedNameServiceTwo + "."+ expectedNodeTwo));
  assertEquals("HTTPS address HA property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.namenode.rpc-address." + expectedNameServiceTwo + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.namenode.rpc-address." + expectedNameServiceTwo + "."+ expectedNodeTwo));
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testHBaseConfigClusterUpdatePropertiesFilterAuthorizationOff() throws Exception {
  reset(stack);
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> hbaseSiteProperties=new HashMap<String,String>();
  properties.put("hbase-site",hbaseSiteProperties);
  hbaseSiteProperties.put("hbase.security.authorization","false");
  hbaseSiteProperties.put("hbase.coprocessor.regionserver.classes"," ");
  hbaseSiteProperties.put("hbase.coprocessor.master.classes","");
  Map<String,Stack.ConfigProperty> mapOfMetadata=new HashMap<String,Stack.ConfigProperty>();
  Stack.ConfigProperty configProperty1=new Stack.ConfigProperty("hbase-site","hbase.coprocessor.regionserver.classes"," "){
    @Override Set<PropertyDependencyInfo> getDependsOnProperties(){
      PropertyDependencyInfo dependencyInfo=new PropertyDependencyInfo("hbase-site","hbase.security.authorization");
      return Collections.singleton(dependencyInfo);
    }
  }
;
  Stack.ConfigProperty configProperty2=new Stack.ConfigProperty("hbase-site","hbase.coprocessor.master.classes",""){
    @Override Set<PropertyDependencyInfo> getDependsOnProperties(){
      PropertyDependencyInfo dependencyInfo=new PropertyDependencyInfo("hbase-site","hbase.security.authorization");
      return Collections.singleton(dependencyInfo);
    }
  }
;
  Stack.ConfigProperty configProperty3=new Stack.ConfigProperty("hbase-site","hbase.coprocessor.region.classes",""){
    @Override Set<PropertyDependencyInfo> getDependsOnProperties(){
      PropertyDependencyInfo dependencyInfo=new PropertyDependencyInfo("hbase-site","hbase.security.authorization");
      return Collections.singleton(dependencyInfo);
    }
  }
;
  mapOfMetadata.put("hbase.coprocessor.regionserver.classes",configProperty1);
  mapOfMetadata.put("hbase.coprocessor.master.classes",configProperty2);
  mapOfMetadata.put("hbase.coprocessor.region.classes",configProperty3);
  expect(stack.getName()).andReturn("testStack").anyTimes();
  expect(stack.getVersion()).andReturn("1").anyTimes();
  expect(stack.isMasterComponent((String)anyObject())).andReturn(false).anyTimes();
  expect(stack.getServiceForConfigType("hbase-site")).andReturn("HBASE").atLeastOnce();
  expect(stack.getConfigurationPropertiesWithMetadata("HBASE","hbase-site")).andReturn(mapOfMetadata).atLeastOnce();
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  List<String> hosts=new ArrayList<String>();
  hosts.add("some-hose");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,hosts);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertFalse("hbase.coprocessor.regionserver.classes should have been filtered out of configuration",hbaseSiteProperties.containsKey("hbase.coprocessor.regionserver.classes"));
  assertTrue("hbase.coprocessor.master.classes should not have been filtered out of configuration",hbaseSiteProperties.containsKey("hbase.coprocessor.master.classes"));
  assertTrue("hbase.coprocessor.region.classes should not have been filtered out of configuration",hbaseSiteProperties.containsKey("hbase.coprocessor.master.classes"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testFalconConfigExport() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedPortNum="808080";
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> falconStartupProperties=new HashMap<String,String>();
  configProperties.put("falcon-startup.properties",falconStartupProperties);
  falconStartupProperties.put("*.broker.url",expectedHostName + ":" + expectedPortNum);
  falconStartupProperties.put("*.falcon.service.authentication.kerberos.principal","falcon/" + expectedHostName + "@EXAMPLE.COM");
  falconStartupProperties.put("*.falcon.http.authentication.kerberos.principal","HTTP/" + expectedHostName + "@EXAMPLE.COM");
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> groupComponents=new HashSet<String>();
  groupComponents.add("FALCON_SERVER");
  Collection<String> hosts=new ArrayList<String>();
  hosts.add(expectedHostName);
  hosts.add("serverTwo");
  TestHostGroup group=new TestHostGroup(expectedHostGroupName,groupComponents,hosts);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  assertEquals("Falcon Broker URL property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),falconStartupProperties.get("*.broker.url"));
  assertEquals("Falcon Kerberos Principal property not properly exported","falcon/" + "%HOSTGROUP::" + expectedHostGroupName + "%"+ "@EXAMPLE.COM",falconStartupProperties.get("*.falcon.service.authentication.kerberos.principal"));
  assertEquals("Falcon Kerberos HTTP Principal property not properly exported","HTTP/" + "%HOSTGROUP::" + expectedHostGroupName + "%"+ "@EXAMPLE.COM",falconStartupProperties.get("*.falcon.http.authentication.kerberos.principal"));
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForClusterCreate_Storm_Nimbus_HA_Enabled__FQDN_ValuesSpecified_YAML() throws Exception {
  final String expectedValue="[c6401.ambari.apache.org, c6402.ambari.apache.org]";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("nimbus.seeds",expectedValue);
  properties.put("storm-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NIMBUS");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("NIMBUS");
  Set<String> hosts2=new HashSet<String>();
  hosts2.add("testhost2");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,hosts2);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  String updatedVal=topology.getConfiguration().getFullProperties().get("storm-site").get("nimbus.seeds");
  assertEquals("nimbus.seeds property should not be updated when FQDNs are specified in configuration",expectedValue,updatedVal);
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAtlasHiveProperties2() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> atlasProperties=new HashMap<String,String>();
  properties.put("application-properties",atlasProperties);
  atlasProperties.put("atlas.enableTLS","true");
  atlasProperties.put("atlas.server.bind.address","localhost");
  atlasProperties.put("atlas.server.https.port","99999");
  Map<String,String> atlasEnv=new HashMap<String,String>();
  properties.put("atlas-env",atlasEnv);
  Map<String,String> hiveProperties=new HashMap<String,String>();
  hiveProperties.put("hive.exec.post.hooks","foo");
  hiveProperties.put("atlas.cluster.name","userSpecified");
  hiveProperties.put("atlas.rest.address","http://localhost:21000");
  properties.put("hive-site",hiveProperties);
  Map<String,Map<String,String>> parentProperties=new HashMap<String,Map<String,String>>();
  Configuration parentClusterConfig=new Configuration(parentProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),parentClusterConfig);
  Collection<String> hgComponents1=new HashSet<String>();
  hgComponents1.add("ATLAS_SERVER");
  hgComponents1.add("HIVE_SERVER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents1,Collections.singleton("host1"));
  Collection<TestHostGroup> hostGroups=Collections.singletonList(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForClusterCreate();
  assertEquals("foo,org.apache.atlas.hive.hook.HiveHook",clusterConfig.getPropertyValue("hive-site","hive.exec.post.hooks"));
  assertEquals("userSpecified",clusterConfig.getPropertyValue("hive-site","atlas.cluster.name"));
  assertEquals("https://host1:99999",clusterConfig.getPropertyValue("hive-site","atlas.rest.address"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testKnoxSecurityConfigExported() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedHostNameTwo="c6402.ambari.apache.org";
  final String expectedHostGroupName="host_group_1";
  final String expectedHostGroupNameTwo="host_group_2";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> coreSiteProperties=new HashMap<String,String>();
  Map<String,String> webHCatSiteProperties=new HashMap<String,String>();
  Map<String,String> oozieSiteProperties=new HashMap<String,String>();
  configProperties.put("core-site",coreSiteProperties);
  configProperties.put("webhcat-site",webHCatSiteProperties);
  configProperties.put("oozie-site",oozieSiteProperties);
  coreSiteProperties.put("hadoop.proxyuser.knox.hosts",expectedHostName + "," + expectedHostNameTwo);
  webHCatSiteProperties.put("webhcat.proxyuser.knox.hosts",expectedHostName + "," + expectedHostNameTwo);
  oozieSiteProperties.put("hadoop.proxyuser.knox.hosts",expectedHostName + "," + expectedHostNameTwo);
  oozieSiteProperties.put("oozie.service.ProxyUserService.proxyuser.knox.hosts",expectedHostName + "," + expectedHostNameTwo);
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> groupComponents=new HashSet<String>();
  groupComponents.add("KNOX_GATEWAY");
  Collection<String> hosts=new ArrayList<String>();
  hosts.add(expectedHostName);
  hosts.add("serverTwo");
  TestHostGroup group=new TestHostGroup(expectedHostGroupName,groupComponents,hosts);
  Collection<String> groupComponents2=new HashSet<String>();
  groupComponents2.add("KNOX_GATEWAY");
  Collection<String> hosts2=new ArrayList<String>();
  hosts2.add(expectedHostNameTwo);
  hosts2.add("serverFour");
  TestHostGroup group2=new TestHostGroup(expectedHostGroupNameTwo,groupComponents2,hosts2);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  assertEquals("Knox for core-site config not properly exported",createExportedHostName(expectedHostGroupName) + "," + createExportedHostName(expectedHostGroupNameTwo),coreSiteProperties.get("hadoop.proxyuser.knox.hosts"));
  assertEquals("Knox config for WebHCat not properly exported",createExportedHostName(expectedHostGroupName) + "," + createExportedHostName(expectedHostGroupNameTwo),webHCatSiteProperties.get("webhcat.proxyuser.knox.hosts"));
  assertEquals("Knox config for Oozie not properly exported",createExportedHostName(expectedHostGroupName) + "," + createExportedHostName(expectedHostGroupNameTwo),oozieSiteProperties.get("hadoop.proxyuser.knox.hosts"));
  assertEquals("Knox config for Oozie not properly exported",createExportedHostName(expectedHostGroupName) + "," + createExportedHostName(expectedHostGroupNameTwo),oozieSiteProperties.get("oozie.service.ProxyUserService.proxyuser.knox.hosts"));
}

</code></pre>

<pre class="type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRecommendConfiguration_neverApply() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedPortNum="808080";
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> coreSiteMap=new HashMap<String,String>();
  properties.put("core-site",coreSiteMap);
  coreSiteMap.put("fs.default.name",expectedHostName + ":" + expectedPortNum);
  coreSiteMap.put("fs.defaultFS","hdfs://" + expectedHostName + ":"+ expectedPortNum);
  coreSiteMap.put("fs.stackDefault.key2","dummyValue");
  Map<String,Map<String,String>> parentProperties=new HashMap<String,Map<String,String>>();
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton(expectedHostGroupName));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  Configuration parentClusterConfig=new Configuration(parentProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),createStackDefaults());
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),parentClusterConfig);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  topology.getAdvisedConfigurations().putAll(createAdvisedConfigMap());
  topology.setConfigRecommendationStrategy(ConfigRecommendationStrategy.NEVER_APPLY);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForClusterCreate();
  assertEquals(expectedHostName + ":" + expectedPortNum,clusterConfig.getPropertyValue("core-site","fs.default.name"));
  assertNull(clusterConfig.getPropertyValue("core-site","fs.notStackDefault"));
  assertEquals("stackDefaultValue1",clusterConfig.getPropertyValue("core-site","fs.stackDefault.key1"));
  assertNotNull(clusterConfig.getPropertyValue("core-site","fs.stackDefault.key2"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testHdfsWithRangerKmsServer() throws Exception {
  final String configType="hdfs-site";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> configProperties=new HashMap<String,String>();
  properties.put(configType,configProperties);
  configProperties.put("dfs.encryption.key.provider.uri","kms://http@%HOSTGROUP::group1%;%HOSTGROUP::group2%:9292/kms");
  Map<String,Map<String,String>> parentProperties=new HashMap<String,Map<String,String>>();
  Configuration parentClusterConfig=new Configuration(parentProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),parentClusterConfig);
  Collection<String> kmsServerComponents=new HashSet<String>();
  kmsServerComponents.add("RANGER_KMS_SERVER");
  Collection<String> hdfsComponents=new HashSet<String>();
  hdfsComponents.add("NAMENODE");
  hdfsComponents.add("DATANODE");
  TestHostGroup group1=new TestHostGroup("group1",kmsServerComponents,Collections.singleton("host1"));
  group1.components.add("DATANODE");
  TestHostGroup group2=new TestHostGroup("group2",hdfsComponents,Collections.singleton("host2"));
  Collection<TestHostGroup> hostGroups=Lists.newArrayList(group1,group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForClusterCreate();
  assertEquals("kms://http@host1;host2:9292/kms",clusterConfig.getPropertyValue(configType,"dfs.encryption.key.provider.uri"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testFalconConfigClusterUpdate() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedPortNum="808080";
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> falconStartupProperties=new HashMap<String,String>();
  properties.put("falcon-startup.properties",falconStartupProperties);
  falconStartupProperties.put("*.broker.url",createExportedAddress(expectedPortNum,expectedHostGroupName));
  falconStartupProperties.put("*.falcon.service.authentication.kerberos.principal","falcon/" + createExportedHostName(expectedHostGroupName) + "@EXAMPLE.COM");
  falconStartupProperties.put("*.falcon.http.authentication.kerberos.principal","HTTP/" + createExportedHostName(expectedHostGroupName) + "@EXAMPLE.COM");
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("FALCON_SERVER");
  hgComponents.add("FALCON_CLIENT");
  List<String> hosts=new ArrayList<String>();
  hosts.add("c6401.apache.ambari.org");
  hosts.add("serverTwo");
  TestHostGroup group1=new TestHostGroup("host_group_1",hgComponents,hosts);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertEquals("Falcon Broker URL property not properly exported",expectedHostName + ":" + expectedPortNum,falconStartupProperties.get("*.broker.url"));
  assertEquals("Falcon Kerberos Principal property not properly exported","falcon/" + expectedHostName + "@EXAMPLE.COM",falconStartupProperties.get("*.falcon.service.authentication.kerberos.principal"));
  assertEquals("Falcon Kerberos HTTP Principal property not properly exported","HTTP/" + expectedHostName + "@EXAMPLE.COM",falconStartupProperties.get("*.falcon.http.authentication.kerberos.principal"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testHadoopWithRangerKmsServer_default() throws Exception {
  final String configType="core-site";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> configProperties=new HashMap<String,String>();
  properties.put(configType,configProperties);
  configProperties.put("hadoop.security.key.provider.path","kms://http@localhost:9292/kms");
  Map<String,Map<String,String>> parentProperties=new HashMap<String,Map<String,String>>();
  Configuration parentClusterConfig=new Configuration(parentProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),parentClusterConfig);
  Collection<String> kmsServerComponents=new HashSet<String>();
  kmsServerComponents.add("RANGER_KMS_SERVER");
  Collection<String> hdfsComponents=new HashSet<String>();
  hdfsComponents.add("NAMENODE");
  hdfsComponents.add("DATANODE");
  TestHostGroup group1=new TestHostGroup("group1",kmsServerComponents,Collections.singleton("host1"));
  group1.components.add("DATANODE");
  TestHostGroup group2=new TestHostGroup("group2",hdfsComponents,Collections.singleton("host2"));
  Collection<TestHostGroup> hostGroups=Lists.newArrayList(group1,group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForClusterCreate();
  assertEquals("kms://http@host1:9292/kms",clusterConfig.getPropertyValue(configType,"hadoop.security.key.provider.path"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testOozieHAEnabledExport() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedHostNameTwo="c6402.ambari.apache.org";
  final String expectedExternalHost="c6408.ambari.apache.org";
  final String expectedHostGroupName="host_group_1";
  final String expectedHostGroupNameTwo="host_group_2";
  final String expectedPortNum="80000";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> oozieSiteProperties=new HashMap<String,String>();
  Map<String,String> oozieEnvProperties=new HashMap<String,String>();
  Map<String,String> coreSiteProperties=new HashMap<String,String>();
  configProperties.put("oozie-site",oozieSiteProperties);
  configProperties.put("oozie-env",oozieEnvProperties);
  configProperties.put("hive-env",oozieEnvProperties);
  configProperties.put("core-site",coreSiteProperties);
  oozieSiteProperties.put("oozie.base.url",expectedHostName + ":" + expectedPortNum);
  oozieSiteProperties.put("oozie.authentication.kerberos.principal",expectedHostName);
  oozieSiteProperties.put("oozie.service.HadoopAccessorService.kerberos.principal",expectedHostName);
  oozieSiteProperties.put("oozie.service.JPAService.jdbc.url","jdbc:mysql://" + expectedExternalHost + "/ooziedb");
  oozieSiteProperties.put("oozie.services.ext","org.apache.oozie.service.ZKLocksService,org.apache.oozie.service.ZKXLogStreamingService,org.apache.oozie.service.ZKJobsConcurrencyService,org.apache.oozie.service.ZKUUIDService");
  oozieSiteProperties.put("oozie.zookeeper.connection.string",createHostAddress(expectedHostName,"2181") + "," + createHostAddress(expectedHostNameTwo,"2181"));
  oozieEnvProperties.put("oozie_hostname",expectedHostName);
  oozieEnvProperties.put("oozie_existing_mysql_host",expectedExternalHost);
  coreSiteProperties.put("hadoop.proxyuser.oozie.hosts",expectedHostName + "," + expectedHostNameTwo);
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("OOZIE_SERVER");
  hgComponents.add("ZOOKEEPER_SERVER");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,Collections.singleton(expectedHostName));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("OOZIE_SERVER");
  hgComponents2.add("ZOOKEEPER_SERVER");
  TestHostGroup group2=new TestHostGroup(expectedHostGroupNameTwo,hgComponents2,Collections.singleton(expectedHostNameTwo));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  expect(stack.getCardinality("OOZIE_SERVER")).andReturn(new Cardinality("1+")).anyTimes();
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForBlueprintExport();
  assertEquals("oozie property not updated correctly",createExportedHostName(expectedHostGroupName,expectedPortNum),oozieSiteProperties.get("oozie.base.url"));
  assertEquals("oozie property not updated correctly",createExportedHostName(expectedHostGroupName),oozieSiteProperties.get("oozie.authentication.kerberos.principal"));
  assertEquals("oozie property not updated correctly",createExportedHostName(expectedHostGroupName),oozieSiteProperties.get("oozie.service.HadoopAccessorService.kerberos.principal"));
  assertEquals("oozie property not updated correctly",createExportedHostName(expectedHostGroupName),oozieEnvProperties.get("oozie_hostname"));
  assertEquals("oozie property not updated correctly",createExportedHostName(expectedHostGroupName) + "," + createExportedHostName(expectedHostGroupNameTwo),coreSiteProperties.get("hadoop.proxyuser.oozie.hosts"));
  assertEquals("oozie property not updated correctly",createExportedAddress("2181",expectedHostGroupName) + "," + createExportedAddress("2181",expectedHostGroupNameTwo),oozieSiteProperties.get("oozie.zookeeper.connection.string"));
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForBlueprintExport_SingleHostProperty__withPort() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("fs.defaultFS","testhost:8020");
  properties.put("core-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  String updatedVal=properties.get("core-site").get("fs.defaultFS");
  assertEquals("%HOSTGROUP::group1%:8020",updatedVal);
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testTezConfigExport() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> tezSiteProperties=new HashMap<String,String>();
  configProperties.put("tez-site",tezSiteProperties);
  tezSiteProperties.put("tez.tez-ui.history-url.base","http://host:port/TEZ/TEZ_VIEW");
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> groupComponents=new HashSet<String>();
  groupComponents.add("TEZ_CLIENT");
  Collection<String> hosts=new ArrayList<String>();
  hosts.add(expectedHostName);
  hosts.add("serverTwo");
  TestHostGroup group=new TestHostGroup(expectedHostGroupName,groupComponents,hosts);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  assertFalse("tez.tez-ui.history-url.base should not be present in exported blueprint in tez-site",tezSiteProperties.containsKey("tez.tez-ui.history-url.base"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testHiveConfigExportedMultipleHiveMetaStoreServers() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedHostNameTwo="c6402.ambari.apache.org";
  final String expectedPortNum="808080";
  final String expectedHostGroupName="host_group_1";
  final String expectedHostGroupNameTwo="host_group_2";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> hiveSiteProperties=new HashMap<String,String>();
  Map<String,String> hiveEnvProperties=new HashMap<String,String>();
  Map<String,String> webHCatSiteProperties=new HashMap<String,String>();
  Map<String,String> coreSiteProperties=new HashMap<String,String>();
  configProperties.put("hive-site",hiveSiteProperties);
  configProperties.put("hive-env",hiveEnvProperties);
  configProperties.put("webhcat-site",webHCatSiteProperties);
  configProperties.put("core-site",coreSiteProperties);
  hiveSiteProperties.put("hive.metastore.uris","thrift://" + expectedHostName + ":"+ expectedPortNum+ ","+ "thrift://"+ expectedHostNameTwo+ ":"+ expectedPortNum);
  hiveSiteProperties.put("javax.jdo.option.ConnectionURL",expectedHostName + ":" + expectedPortNum);
  hiveSiteProperties.put("hive.zookeeper.quorum",expectedHostName + ":" + expectedPortNum+ ","+ expectedHostNameTwo+ ":"+ expectedPortNum);
  hiveSiteProperties.put("hive.cluster.delegation.token.store.zookeeper.connectString",expectedHostName + ":" + expectedPortNum+ ","+ expectedHostNameTwo+ ":"+ expectedPortNum);
  hiveEnvProperties.put("hive_hostname",expectedHostName);
  webHCatSiteProperties.put("templeton.hive.properties",expectedHostName + "," + expectedHostNameTwo);
  webHCatSiteProperties.put("templeton.kerberos.principal",expectedHostName);
  coreSiteProperties.put("hadoop.proxyuser.hive.hosts",expectedHostName + "," + expectedHostNameTwo);
  coreSiteProperties.put("hadoop.proxyuser.HTTP.hosts",expectedHostName + "," + expectedHostNameTwo);
  coreSiteProperties.put("hadoop.proxyuser.hcat.hosts",expectedHostName + "," + expectedHostNameTwo);
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> groupComponents=new HashSet<String>();
  groupComponents.add("NAMENODE");
  Collection<String> hosts=new ArrayList<String>();
  hosts.add(expectedHostName);
  hosts.add("serverTwo");
  TestHostGroup group=new TestHostGroup(expectedHostGroupName,groupComponents,hosts);
  Collection<String> groupComponents2=new HashSet<String>();
  groupComponents2.add("DATANODE");
  Collection<String> hosts2=new ArrayList<String>();
  hosts2.add(expectedHostNameTwo);
  hosts2.add("serverThree");
  TestHostGroup group2=new TestHostGroup(expectedHostGroupNameTwo,groupComponents2,hosts2);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  System.out.println("RWN: exported value of hive.metastore.uris = " + hiveSiteProperties.get("hive.metastore.uris"));
  assertEquals("hive property not properly exported","thrift://" + createExportedAddress(expectedPortNum,expectedHostGroupName) + ","+ "thrift://"+ createExportedAddress(expectedPortNum,expectedHostGroupNameTwo),hiveSiteProperties.get("hive.metastore.uris"));
  assertEquals("hive property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),hiveSiteProperties.get("javax.jdo.option.ConnectionURL"));
  assertEquals("hive property not properly exported",createExportedHostName(expectedHostGroupName),hiveEnvProperties.get("hive_hostname"));
  assertEquals("hive property not properly exported",createExportedHostName(expectedHostGroupName) + "," + createExportedHostName(expectedHostGroupNameTwo),webHCatSiteProperties.get("templeton.hive.properties"));
  assertEquals("hive property not properly exported",createExportedHostName(expectedHostGroupName),webHCatSiteProperties.get("templeton.kerberos.principal"));
  assertEquals("hive property not properly exported",createExportedHostName(expectedHostGroupName) + "," + createExportedHostName(expectedHostGroupNameTwo),coreSiteProperties.get("hadoop.proxyuser.hive.hosts"));
  assertEquals("hive property not properly exported",createExportedHostName(expectedHostGroupName) + "," + createExportedHostName(expectedHostGroupNameTwo),coreSiteProperties.get("hadoop.proxyuser.HTTP.hosts"));
  assertEquals("hive property not properly exported",createExportedHostName(expectedHostGroupName) + "," + createExportedHostName(expectedHostGroupNameTwo),coreSiteProperties.get("hadoop.proxyuser.hcat.hosts"));
  assertEquals("hive zookeeper quorum property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName) + "," + createExportedAddress(expectedPortNum,expectedHostGroupNameTwo),hiveSiteProperties.get("hive.zookeeper.quorum"));
  assertEquals("hive zookeeper connectString property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName) + "," + createExportedAddress(expectedPortNum,expectedHostGroupNameTwo),hiveSiteProperties.get("hive.cluster.delegation.token.store.zookeeper.connectString"));
}

</code></pre>

<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void tearDown(){
  reset(bp,serviceInfo,stack,ambariConext);
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForClusterCreate_MProperty__defaultValues() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("hbase_master_heapsize","512m");
  properties.put("hbase-env",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  String updatedVal=topology.getConfiguration().getFullProperties().get("hbase-env").get("hbase_master_heapsize");
  assertEquals("512m",updatedVal);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForBlueprintExport_SingleHostProperty_hostGroupConfiguration() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("yarn.resourcemanager.hostname","testhost");
  properties.put("yarn-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  Map<String,Map<String,String>> group2Properties=new HashMap<String,Map<String,String>>();
  Map<String,String> group2YarnSiteProps=new HashMap<String,String>();
  group2YarnSiteProps.put("yarn.resourcemanager.resource-tracker.address","testhost");
  group2Properties.put("yarn-site",group2YarnSiteProps);
  Configuration group2BPConfiguration=new Configuration(Collections.<String,Map<String,String>>emptyMap(),Collections.<String,Map<String,Map<String,String>>>emptyMap(),clusterConfig);
  Configuration group2Configuration=new Configuration(group2Properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),group2BPConfiguration);
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton("testhost2"),group2Configuration);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  assertEquals("%HOSTGROUP::group1%",properties.get("yarn-site").get("yarn.resourcemanager.hostname"));
  assertEquals("%HOSTGROUP::group1%",group2Configuration.getPropertyValue("yarn-site","yarn.resourcemanager.resource-tracker.address"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForClusterCreate_SingleHostProperty__defaultValue_BPHostGroupConfig() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> yarnSiteProps=new HashMap<String,String>();
  yarnSiteProps.put("yarn.resourcemanager.hostname","localhost");
  properties.put("yarn-site",yarnSiteProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> group1Components=new HashSet<String>();
  group1Components.add("NAMENODE");
  group1Components.add("SECONDARY_NAMENODE");
  group1Components.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("group1",group1Components,Collections.singleton("testhost"));
  Collection<String> group2Components=new HashSet<String>();
  group2Components.add("DATANODE");
  group2Components.add("HDFS_CLIENT");
  Map<String,Map<String,String>> group2BPProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> group2YarnSiteProperties=new HashMap<String,String>();
  group2YarnSiteProperties.put("yarn.resourcemanager.resource-tracker.address","localhost");
  group2BPProperties.put("yarn-site",group2YarnSiteProperties);
  Configuration group2BPConfig=new Configuration(group2BPProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),clusterConfig);
  Configuration group2Config=new Configuration(new HashMap<String,Map<String,String>>(),Collections.<String,Map<String,Map<String,String>>>emptyMap());
  TestHostGroup group2=new TestHostGroup("group2",group2Components,Collections.singleton("testhost2"),group2Config);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  topology.getHostGroupInfo().get("group2").getConfiguration().setParentConfiguration(group2BPConfig);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertEquals("testhost",clusterConfig.getPropertyValue("yarn-site","yarn.resourcemanager.hostname"));
  assertEquals("testhost",group2Config.getProperties().get("yarn-site").get("yarn.resourcemanager.resource-tracker.address"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRangerKmsServerProperties_default() throws Exception {
  final String kmsSiteConfigType="kms-site";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> kmsSiteProperties=new HashMap<String,String>();
  properties.put(kmsSiteConfigType,kmsSiteProperties);
  kmsSiteProperties.put("hadoop.kms.authentication.signer.secret.provider.zookeeper.connection.string",createHostAddress("%HOSTGROUP::group1%","2181"));
  Map<String,Map<String,String>> parentProperties=new HashMap<String,Map<String,String>>();
  Configuration parentClusterConfig=new Configuration(parentProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),parentClusterConfig);
  Collection<String> kmsServerComponents=new HashSet<String>();
  kmsServerComponents.add("RANGER_KMS_SERVER");
  TestHostGroup group1=new TestHostGroup("group1",kmsServerComponents,Collections.singleton("host1"));
  Collection<TestHostGroup> hostGroups=Collections.singleton(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForClusterCreate();
  assertEquals("host1:2181",clusterConfig.getPropertyValue(kmsSiteConfigType,"hadoop.kms.authentication.signer.secret.provider.zookeeper.connection.string"));
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForClusterCreate_MProperty__missingM() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("hbase_master_heapsize","512");
  properties.put("hbase-env",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  String updatedVal=topology.getConfiguration().getFullProperties().get("hbase-env").get("hbase_master_heapsize");
  assertEquals("512m",updatedVal);
}

</code></pre>

<pre class="type-4 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDoUpdateForClusterCreate_MultiHostProperty__defaultValues() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("hbase.zookeeper.quorum","localhost");
  properties.put("hbase-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("ZOOKEEPER_SERVER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  hgComponents2.add("ZOOKEEPER_SERVER");
  Set<String> hosts2=new HashSet<String>();
  hosts2.add("testhost2");
  hosts2.add("testhost2a");
  hosts2.add("testhost2b");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,hosts2);
  Collection<String> hgComponents3=new HashSet<String>();
  hgComponents2.add("HDFS_CLIENT");
  hgComponents2.add("ZOOKEEPER_CLIENT");
  Set<String> hosts3=new HashSet<String>();
  hosts3.add("testhost3");
  hosts3.add("testhost3a");
  TestHostGroup group3=new TestHostGroup("group3",hgComponents3,hosts3);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  hostGroups.add(group3);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  String updatedVal=topology.getConfiguration().getFullProperties().get("hbase-site").get("hbase.zookeeper.quorum");
  String[] hosts=updatedVal.split(",");
  Collection<String> expectedHosts=new HashSet<String>();
  expectedHosts.add("testhost");
  expectedHosts.add("testhost2");
  expectedHosts.add("testhost2a");
  expectedHosts.add("testhost2b");
  assertEquals(4,hosts.length);
  for (  String host : hosts) {
    assertTrue(expectedHosts.contains(host));
    expectedHosts.remove(host);
  }
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForClusterCreate_SingleHostProperty__defaultValue__WithPort() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("fs.defaultFS","localhost:5050");
  properties.put("core-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  String updatedVal=topology.getConfiguration().getFullProperties().get("core-site").get("fs.defaultFS");
  assertEquals("testhost:5050",updatedVal);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testStormAmsPropertiesDefault() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> stormSite=new HashMap<String,String>();
  stormSite.put("metrics.reporter.register","");
  properties.put("storm-site",stormSite);
  Map<String,Map<String,String>> parentProperties=new HashMap<String,Map<String,String>>();
  Configuration parentClusterConfig=new Configuration(parentProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),parentClusterConfig);
  Collection<String> hgComponents1=new HashSet<String>();
  hgComponents1.add("METRICS_COLLECTOR");
  hgComponents1.add("NIMBUS");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents1,Collections.singleton("host1"));
  Collection<TestHostGroup> hostGroups=Collections.singletonList(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForClusterCreate();
  assertEquals("org.apache.hadoop.metrics2.sink.storm.StormTimelineMetricsReporter",clusterConfig.getPropertyValue("storm-site","metrics.reporter.register"));
}

</code></pre>

<pre class="type-4 type-13 type-10 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDoUpdateForClusterWithNameNodeHAEnabled() throws Exception {
  final String expectedNameService="mynameservice";
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedHostNameTwo="serverTwo";
  final String expectedPortNum="808080";
  final String expectedNodeOne="nn1";
  final String expectedNodeTwo="nn2";
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> hdfsSiteProperties=new HashMap<String,String>();
  Map<String,String> hbaseSiteProperties=new HashMap<String,String>();
  Map<String,String> hadoopEnvProperties=new HashMap<String,String>();
  Map<String,String> coreSiteProperties=new HashMap<String,String>();
  Map<String,String> accumuloSiteProperties=new HashMap<String,String>();
  properties.put("hdfs-site",hdfsSiteProperties);
  properties.put("hadoop-env",hadoopEnvProperties);
  properties.put("core-site",coreSiteProperties);
  properties.put("hbase-site",hbaseSiteProperties);
  properties.put("accumulo-site",accumuloSiteProperties);
  hdfsSiteProperties.put("dfs.nameservices",expectedNameService);
  hdfsSiteProperties.put("dfs.ha.namenodes.mynameservice",expectedNodeOne + ", " + expectedNodeTwo);
  hdfsSiteProperties.put("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeOne,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hdfsSiteProperties.put("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeTwo,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hdfsSiteProperties.put("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeOne,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hdfsSiteProperties.put("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeTwo,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hdfsSiteProperties.put("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeOne,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hdfsSiteProperties.put("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeTwo,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hdfsSiteProperties.put("dfs.secondary.http.address","localhost:8080");
  hdfsSiteProperties.put("dfs.namenode.secondary.http-address","localhost:8080");
  hdfsSiteProperties.put("dfs.namenode.http-address","localhost:8080");
  hdfsSiteProperties.put("dfs.namenode.https-address","localhost:8081");
  hdfsSiteProperties.put("dfs.namenode.rpc-address","localhost:8082");
  coreSiteProperties.put("fs.defaultFS","hdfs://" + expectedNameService);
  hbaseSiteProperties.put("hbase.rootdir","hdfs://" + expectedNameService + "/hbase/test/root/dir");
  accumuloSiteProperties.put("instance.volumes","hdfs://" + expectedNameService + "/accumulo/test/instance/volumes");
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,Collections.singleton(expectedHostName));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("NAMENODE");
  TestHostGroup group2=new TestHostGroup("host-group-2",hgComponents2,Collections.singleton(expectedHostNameTwo));
  Collection<TestHostGroup> hostGroups=new ArrayList<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  expect(stack.getCardinality("NAMENODE")).andReturn(new Cardinality("1-2")).anyTimes();
  expect(stack.getCardinality("SECONDARY_NAMENODE")).andReturn(new Cardinality("1")).anyTimes();
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  Set<String> updatedConfigTypes=updater.doUpdateForClusterCreate();
  assertEquals("HTTPS address HA property not properly exported",expectedHostName + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",expectedHostName + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeTwo));
  assertEquals("HTTPS address HA property not properly exported",expectedHostName + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",expectedHostName + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeTwo));
  assertEquals("HTTPS address HA property not properly exported",expectedHostName + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",expectedHostName + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeTwo));
  String initialActiveHost=hadoopEnvProperties.get("dfs_ha_initial_namenode_active");
  String expectedStandbyHost=null;
  if (initialActiveHost.equals(expectedHostName)) {
    expectedStandbyHost=expectedHostNameTwo;
  }
 else   if (initialActiveHost.equals(expectedHostNameTwo)) {
    expectedStandbyHost=expectedHostName;
  }
 else {
    fail("Active Namenode hostname was not set correctly");
  }
  assertEquals("Standby Namenode hostname was not set correctly",expectedStandbyHost,hadoopEnvProperties.get("dfs_ha_initial_namenode_standby"));
  assertEquals("fs.defaultFS should not be modified by cluster update when NameNode HA is enabled.","hdfs://" + expectedNameService,coreSiteProperties.get("fs.defaultFS"));
  assertEquals("hbase.rootdir should not be modified by cluster update when NameNode HA is enabled.","hdfs://" + expectedNameService + "/hbase/test/root/dir",hbaseSiteProperties.get("hbase.rootdir"));
  assertEquals("instance.volumes should not be modified by cluster update when NameNode HA is enabled.","hdfs://" + expectedNameService + "/accumulo/test/instance/volumes",accumuloSiteProperties.get("instance.volumes"));
  assertFalse("dfs.namenode.http-address should have been filtered out of this HA configuration",hdfsSiteProperties.containsKey("dfs.namenode.http-address"));
  assertFalse("dfs.namenode.https-address should have been filtered out of this HA configuration",hdfsSiteProperties.containsKey("dfs.namenode.https-address"));
  assertFalse("dfs.namenode.rpc-address should have been filtered out of this HA configuration",hdfsSiteProperties.containsKey("dfs.namenode.rpc-address"));
  assertEquals("Incorrect number of updated config types returned, set = " + updatedConfigTypes,3,updatedConfigTypes.size());
  assertTrue("Expected config type not found in updated set",updatedConfigTypes.contains("cluster-env"));
  assertTrue("Expected config type not found in updated set",updatedConfigTypes.contains("hdfs-site"));
  assertTrue("Expected config type not found in updated set",updatedConfigTypes.contains("hadoop-env"));
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForClusterCreate_SingleHostProperty__MissingOptionalComponent() throws Exception {
  final String expectedHostName="localhost";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("yarn.timeline-service.address",expectedHostName);
  properties.put("yarn-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> group1Components=new HashSet<String>();
  group1Components.add("NAMENODE");
  group1Components.add("SECONDARY_NAMENODE");
  group1Components.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("group1",group1Components,Collections.singleton("testhost"));
  Collection<String> group2Components=new HashSet<String>();
  group2Components.add("DATANODE");
  group2Components.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",group2Components,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  expect(stack.getCardinality("APP_TIMELINE_SERVER")).andReturn(new Cardinality("0-1")).anyTimes();
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  String updatedVal=topology.getConfiguration().getFullProperties().get("yarn-site").get("yarn.timeline-service.address");
  assertEquals("Timeline Server config property should not have been updated",expectedHostName,updatedVal);
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForClusterCreate_DBHostProperty__external() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("javax.jdo.option.ConnectionURL","jdbc:mysql://myHost.com/hive?createDatabaseIfNotExist=true");
  typeProps.put("hive_database","Existing MySQL Database");
  properties.put("hive-env",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  String updatedVal=topology.getConfiguration().getFullProperties().get("hive-env").get("javax.jdo.option.ConnectionURL");
  assertEquals("jdbc:mysql://myHost.com/hive?createDatabaseIfNotExist=true",updatedVal);
}

</code></pre>

<pre class="type-4 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDoUpdateForClusterWithNameNodeHANotEnabled() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedHostNameTwo="serverTwo";
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> hdfsSiteProperties=new HashMap<String,String>();
  Map<String,String> hbaseSiteProperties=new HashMap<String,String>();
  Map<String,String> hadoopEnvProperties=new HashMap<String,String>();
  Map<String,String> coreSiteProperties=new HashMap<String,String>();
  Map<String,String> accumuloSiteProperties=new HashMap<String,String>();
  properties.put("hdfs-site",hdfsSiteProperties);
  properties.put("hadoop-env",hadoopEnvProperties);
  properties.put("core-site",coreSiteProperties);
  properties.put("hbase-site",hbaseSiteProperties);
  properties.put("accumulo-site",accumuloSiteProperties);
  hdfsSiteProperties.put("dfs.secondary.http.address","localhost:8080");
  hdfsSiteProperties.put("dfs.namenode.secondary.http-address","localhost:8080");
  hdfsSiteProperties.put("dfs.namenode.http-address","localhost:8080");
  hdfsSiteProperties.put("dfs.namenode.https-address","localhost:8081");
  hdfsSiteProperties.put("dfs.namenode.rpc-address","localhost:8082");
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,Collections.singleton(expectedHostName));
  Collection<String> hgComponents2=new HashSet<String>();
  TestHostGroup group2=new TestHostGroup("host-group-2",hgComponents2,Collections.singleton(expectedHostNameTwo));
  Collection<TestHostGroup> hostGroups=new ArrayList<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  expect(stack.getCardinality("NAMENODE")).andReturn(new Cardinality("1-2")).anyTimes();
  expect(stack.getCardinality("SECONDARY_NAMENODE")).andReturn(new Cardinality("1")).anyTimes();
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  Set<String> updatedConfigTypes=updater.doUpdateForClusterCreate();
  assertTrue("dfs.namenode.http-address should have been included in this HA configuration",hdfsSiteProperties.containsKey("dfs.namenode.http-address"));
  assertTrue("dfs.namenode.https-address should have been included in this HA configuration",hdfsSiteProperties.containsKey("dfs.namenode.https-address"));
  assertTrue("dfs.namenode.rpc-address should have been included in this HA configuration",hdfsSiteProperties.containsKey("dfs.namenode.rpc-address"));
  assertEquals("Incorrect number of updated config types returned, set = " + updatedConfigTypes,2,updatedConfigTypes.size());
  assertTrue("Expected config type 'cluster-env' not found in updated set",updatedConfigTypes.contains("cluster-env"));
  assertTrue("Expected config type 'hdfs-site' not found in updated set",updatedConfigTypes.contains("hdfs-site"));
}

</code></pre>

<pre class="type-4 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDoUpdateForClusterCreate_Storm_Nimbus_HA_Enabled__defaultValues_YAML() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("nimbus.seeds","localhost");
  properties.put("storm-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NIMBUS");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("NIMBUS");
  Set<String> hosts2=new HashSet<String>();
  hosts2.add("testhost2");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,hosts2);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  String updatedVal=topology.getConfiguration().getFullProperties().get("storm-site").get("nimbus.seeds");
  assertTrue("Updated YAML value should start with bracket",updatedVal.startsWith("["));
  assertTrue("Updated YAML value should end with bracket",updatedVal.endsWith("]"));
  updatedVal=updatedVal.replaceAll("[\\[\\]]","");
  String[] hosts=updatedVal.split(",");
  Collection<String> expectedHosts=new HashSet<String>();
  expectedHosts.add("testhost");
  expectedHosts.add("testhost2");
  assertEquals("Incorrect number of hosts found in updated Nimbus config property",2,hosts.length);
  for (  String host : hosts) {
    assertTrue("Expected host name = " + host + " not found in updated Nimbus config property",expectedHosts.contains(host));
    expectedHosts.remove(host);
  }
}

</code></pre>

<pre class="type-4 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDoUpdateForClusterCreate_MultiHostProperty__exportedValues___withPorts() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("templeton.zookeeper.hosts","%HOSTGROUP::group1%:9090,%HOSTGROUP::group2%:9091");
  properties.put("webhcat-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("ZOOKEEPER_SERVER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  hgComponents2.add("ZOOKEEPER_SERVER");
  Set<String> hosts2=new HashSet<String>();
  hosts2.add("testhost2");
  hosts2.add("testhost2a");
  hosts2.add("testhost2b");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,hosts2);
  Collection<String> hgComponents3=new HashSet<String>();
  hgComponents2.add("HDFS_CLIENT");
  hgComponents2.add("ZOOKEEPER_CLIENT");
  Set<String> hosts3=new HashSet<String>();
  hosts3.add("testhost3");
  hosts3.add("testhost3a");
  TestHostGroup group3=new TestHostGroup("group3",hgComponents3,hosts3);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  hostGroups.add(group3);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  String updatedVal=topology.getConfiguration().getFullProperties().get("webhcat-site").get("templeton.zookeeper.hosts");
  String[] hosts=updatedVal.split(",");
  Collection<String> expectedHosts=new HashSet<String>();
  expectedHosts.add("testhost:9090");
  expectedHosts.add("testhost2:9091");
  expectedHosts.add("testhost2a:9091");
  expectedHosts.add("testhost2b:9091");
  assertEquals(4,hosts.length);
  for (  String host : hosts) {
    assertTrue(expectedHosts.contains(host));
    expectedHosts.remove(host);
  }
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRangerAdminProperties() throws Exception {
  final String rangerAdminConfigType="admin-properties";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> rangerAdminProperties=new HashMap<String,String>();
  properties.put(rangerAdminConfigType,rangerAdminProperties);
  rangerAdminProperties.put("policymgr_external_url","http://%HOSTGROUP::group1%:100");
  Map<String,Map<String,String>> parentProperties=new HashMap<String,Map<String,String>>();
  Configuration parentClusterConfig=new Configuration(parentProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),parentClusterConfig);
  Collection<String> rangerComponents=new HashSet<String>();
  rangerComponents.add("RANGER_ADMIN");
  rangerComponents.add("RANGER_USERSYNC");
  TestHostGroup group1=new TestHostGroup("group1",rangerComponents,Collections.singleton("host1"));
  Collection<TestHostGroup> hostGroups=Collections.singletonList(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForClusterCreate();
  assertEquals("http://host1:100",clusterConfig.getPropertyValue(rangerAdminConfigType,"policymgr_external_url"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testYarnHighAvailabilityExport() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedHostNameTwo="c6402.apache.ambari.org";
  final String expectedPortNum="808080";
  final String expectedHostGroupName="host_group_1";
  final String expectedHostGroupNameTwo="host_group_2";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> yarnSiteProperties=new HashMap<String,String>();
  configProperties.put("yarn-site",yarnSiteProperties);
  yarnSiteProperties.put("yarn.log.server.url","http://" + expectedHostName + ":19888/jobhistory/logs");
  yarnSiteProperties.put("yarn.resourcemanager.hostname",expectedHostName);
  yarnSiteProperties.put("yarn.resourcemanager.resource-tracker.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.webapp.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.scheduler.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.admin.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.timeline-service.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.timeline-service.webapp.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.timeline-service.webapp.https.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.ha.enabled","true");
  yarnSiteProperties.put("yarn.resourcemanager.ha.rm-ids","rm1, rm2");
  yarnSiteProperties.put("yarn.resourcemanager.hostname.rm1",expectedHostName);
  yarnSiteProperties.put("yarn.resourcemanager.hostname.rm2",expectedHostNameTwo);
  yarnSiteProperties.put("yarn.resourcemanager.webapp.address.rm1",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.webapp.address.rm2",expectedHostNameTwo + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.webapp.https.address.rm1",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.webapp.https.address.rm2",expectedHostNameTwo + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.zk-address",expectedHostName + ":" + "2181"+ ","+ expectedHostNameTwo+ ":"+ "2181");
  yarnSiteProperties.put("yarn.resourcemanager.webapp.https.address",expectedHostName + ":" + "8080");
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("RESOURCEMANAGER");
  hgComponents.add("APP_TIMELINE_SERVER");
  hgComponents.add("HISTORYSERVER");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,Collections.singleton(expectedHostName));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("RESOURCEMANAGER");
  TestHostGroup group2=new TestHostGroup(expectedHostGroupNameTwo,hgComponents2,Collections.singleton(expectedHostNameTwo));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  expect(stack.getCardinality("RESOURCEMANAGER")).andReturn(new Cardinality("1-2")).anyTimes();
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForBlueprintExport();
  assertEquals("Yarn Log Server URL was incorrectly updated","http://" + createExportedAddress("19888",expectedHostGroupName) + "/jobhistory/logs",yarnSiteProperties.get("yarn.log.server.url"));
  assertEquals("Yarn ResourceManager hostname was incorrectly updated",createExportedHostName(expectedHostGroupName),yarnSiteProperties.get("yarn.resourcemanager.hostname"));
  assertEquals("Yarn ResourceManager tracker address was incorrectly updated",createExportedHostName(expectedHostGroupName,expectedPortNum),yarnSiteProperties.get("yarn.resourcemanager.resource-tracker.address"));
  assertEquals("Yarn ResourceManager webapp address was incorrectly updated",createExportedHostName(expectedHostGroupName,expectedPortNum),yarnSiteProperties.get("yarn.resourcemanager.webapp.address"));
  assertEquals("Yarn ResourceManager scheduler address was incorrectly updated",createExportedHostName(expectedHostGroupName,expectedPortNum),yarnSiteProperties.get("yarn.resourcemanager.scheduler.address"));
  assertEquals("Yarn ResourceManager address was incorrectly updated",createExportedHostName(expectedHostGroupName,expectedPortNum),yarnSiteProperties.get("yarn.resourcemanager.address"));
  assertEquals("Yarn ResourceManager admin address was incorrectly updated",createExportedHostName(expectedHostGroupName,expectedPortNum),yarnSiteProperties.get("yarn.resourcemanager.admin.address"));
  assertEquals("Yarn ResourceManager timeline-service address was incorrectly updated",createExportedHostName(expectedHostGroupName,expectedPortNum),yarnSiteProperties.get("yarn.timeline-service.address"));
  assertEquals("Yarn ResourceManager timeline webapp address was incorrectly updated",createExportedHostName(expectedHostGroupName,expectedPortNum),yarnSiteProperties.get("yarn.timeline-service.webapp.address"));
  assertEquals("Yarn ResourceManager timeline webapp HTTPS address was incorrectly updated",createExportedHostName(expectedHostGroupName,expectedPortNum),yarnSiteProperties.get("yarn.timeline-service.webapp.https.address"));
  assertEquals("Yarn ResourceManager rm1 hostname not exported properly",createExportedHostName(expectedHostGroupName),yarnSiteProperties.get("yarn.resourcemanager.hostname.rm1"));
  assertEquals("Yarn ResourceManager rm2 hostname not exported properly",createExportedHostName(expectedHostGroupNameTwo),yarnSiteProperties.get("yarn.resourcemanager.hostname.rm2"));
  assertEquals("Yarn ResourceManager rm1 web address not exported properly",createExportedHostName(expectedHostGroupName,expectedPortNum),yarnSiteProperties.get("yarn.resourcemanager.webapp.address.rm1"));
  assertEquals("Yarn ResourceManager rm2 web address not exported properly",createExportedHostName(expectedHostGroupNameTwo,expectedPortNum),yarnSiteProperties.get("yarn.resourcemanager.webapp.address.rm2"));
  assertEquals("Yarn ResourceManager rm1 HTTPS address not exported properly",createExportedHostName(expectedHostGroupName,expectedPortNum),yarnSiteProperties.get("yarn.resourcemanager.webapp.https.address.rm1"));
  assertEquals("Yarn ResourceManager rm2 HTTPS address not exported properly",createExportedHostName(expectedHostGroupNameTwo,expectedPortNum),yarnSiteProperties.get("yarn.resourcemanager.webapp.https.address.rm2"));
  assertEquals("Yarn Zookeeper address property not exported properly",createExportedHostName(expectedHostGroupName,"2181") + "," + createExportedHostName(expectedHostGroupNameTwo,"2181"),yarnSiteProperties.get("yarn.resourcemanager.zk-address"));
  assertEquals("Yarn RM webapp address not exported properly",createExportedHostName(expectedHostGroupName,"8080"),yarnSiteProperties.get("yarn.resourcemanager.webapp.https.address"));
}

</code></pre>

<pre class="type-4 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDoUpdateForClusterCreate_MultiHostProperty__defaultValues___withPorts() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("templeton.zookeeper.hosts","localhost:9090");
  properties.put("webhcat-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("ZOOKEEPER_SERVER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  hgComponents2.add("ZOOKEEPER_SERVER");
  Set<String> hosts2=new HashSet<String>();
  hosts2.add("testhost2");
  hosts2.add("testhost2a");
  hosts2.add("testhost2b");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,hosts2);
  Collection<String> hgComponents3=new HashSet<String>();
  hgComponents2.add("HDFS_CLIENT");
  hgComponents2.add("ZOOKEEPER_CLIENT");
  Set<String> hosts3=new HashSet<String>();
  hosts3.add("testhost3");
  hosts3.add("testhost3a");
  TestHostGroup group3=new TestHostGroup("group3",hgComponents3,hosts3);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  hostGroups.add(group3);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  String updatedVal=topology.getConfiguration().getFullProperties().get("webhcat-site").get("templeton.zookeeper.hosts");
  String[] hosts=updatedVal.split(",");
  Collection<String> expectedHosts=new HashSet<String>();
  expectedHosts.add("testhost:9090");
  expectedHosts.add("testhost2:9090");
  expectedHosts.add("testhost2a:9090");
  expectedHosts.add("testhost2b:9090");
  assertEquals(4,hosts.length);
  for (  String host : hosts) {
    assertTrue(expectedHosts.contains(host));
    expectedHosts.remove(host);
  }
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testDoUpdateForClusterCreate_SingleHostProperty__MissingComponent() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("yarn.resourcemanager.hostname","localhost");
  typeProps.put("yarn.timeline-service.address","localhost");
  properties.put("yarn-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> group1Components=new HashSet<String>();
  group1Components.add("NAMENODE");
  group1Components.add("SECONDARY_NAMENODE");
  group1Components.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("group1",group1Components,Collections.singleton("testhost"));
  Collection<String> group2Components=new HashSet<String>();
  group2Components.add("DATANODE");
  group2Components.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",group2Components,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  expect(stack.getCardinality("APP_TIMELINE_SERVER")).andReturn(new Cardinality("1")).anyTimes();
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  try {
    updater.doUpdateForClusterCreate();
    fail("IllegalArgumentException should have been thrown");
  }
 catch (  IllegalArgumentException illegalArgumentException) {
  }
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testHiveConfigClusterUpdateCustomValue() throws Exception {
  final String expectedHostGroupName="host_group_1";
  final String expectedPropertyValue="hive.metastore.local=false,hive.metastore.uris=thrift://headnode0.ivantestcluster2-ssh.d1.internal.cloudapp.net:9083,hive.user.install.directory=/user";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> webHCatSiteProperties=new HashMap<String,String>();
  properties.put("webhcat-site",webHCatSiteProperties);
  webHCatSiteProperties.put("templeton.hive.properties",expectedPropertyValue);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  List<String> hosts=new ArrayList<String>();
  hosts.add("some-hose");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,hosts);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertEquals("Unexpected config update for templeton.hive.properties",expectedPropertyValue,webHCatSiteProperties.get("templeton.hive.properties"));
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMultipleHostTopologyUpdaterWithMultiHostWithSuffixValue() throws Exception {
  String component="test_component";
  BlueprintConfigurationProcessor.MultipleHostTopologyUpdater mhtu=new BlueprintConfigurationProcessor.MultipleHostTopologyUpdater(component);
  String propertyOriginalValue="http://%HOSTGROUP::group_1,HOSTGROUP::group_2%/resource";
  String updatedValue=mhtu.resolveHostGroupPlaceholder(propertyOriginalValue,null,ImmutableList.<String>of("host1:100","host2:200"));
  assertEquals("http://host1:100,host2:200/resource",updatedValue);
}

</code></pre>

<pre class="type-4 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRecommendConfiguration_applyAlways() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedPortNum="808080";
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> coreSiteMap=new HashMap<String,String>();
  properties.put("core-site",coreSiteMap);
  coreSiteMap.put("fs.default.name",expectedHostName + ":" + expectedPortNum);
  coreSiteMap.put("fs.defaultFS","hdfs://" + expectedHostName + ":"+ expectedPortNum);
  coreSiteMap.put("fs.stackDefault.key2","dummyValue");
  Map<String,String> dummySiteMap=new HashMap<String,String>();
  properties.put("dummy-site",dummySiteMap);
  dummySiteMap.put("dummy.prop","dummyValue");
  Map<String,Map<String,String>> parentProperties=new HashMap<String,Map<String,String>>();
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton(expectedHostGroupName));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  Configuration parentClusterConfig=new Configuration(parentProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),createStackDefaults());
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),parentClusterConfig);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  topology.getAdvisedConfigurations().putAll(createAdvisedConfigMap());
  topology.setConfigRecommendationStrategy(ConfigRecommendationStrategy.ALWAYS_APPLY);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  Set<String> configTypes=configProcessor.doUpdateForClusterCreate();
  assertEquals(expectedHostName + ":" + expectedPortNum,clusterConfig.getPropertyValue("core-site","fs.default.name"));
  assertEquals("stackDefaultUpgraded",clusterConfig.getPropertyValue("core-site","fs.stackDefault.key1"));
  assertNull(clusterConfig.getPropertyValue("core-site","fs.stackDefault.key2"));
  assertNotNull(clusterConfig.getPropertyValue("core-site","fs.notStackDefault"));
  assertEquals(2,topology.getAdvisedConfigurations().size());
  assertFalse(configTypes.contains("dummy-site"));
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testHDFSConfigClusterUpdateQuorumJournalURLSpecifyingHostNamesDirectly() throws Exception {
  final String expectedHostNameOne="c6401.apache.ambari.org";
  final String expectedHostNameTwo="c6402.apache.ambari.org";
  final String expectedPortNum="808080";
  final String expectedHostGroupName="host_group_1";
  final String expectedHostGroupNameTwo="host_group_2";
  final String expectedQuorumJournalURL="qjournal://" + createHostAddress(expectedHostNameOne,expectedPortNum) + ";"+ createHostAddress(expectedHostNameTwo,expectedPortNum)+ "/mycluster";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> hdfsSiteProperties=new HashMap<String,String>();
  configProperties.put("hdfs-site",hdfsSiteProperties);
  hdfsSiteProperties.put("dfs.namenode.shared.edits.dir",expectedQuorumJournalURL);
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,Collections.singleton("host1"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  TestHostGroup group2=new TestHostGroup(expectedHostGroupNameTwo,hgComponents2,Collections.singleton("host2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertEquals("HDFS HA shared edits directory property should not have been modified, since FQDNs were specified.",expectedQuorumJournalURL,hdfsSiteProperties.get("dfs.namenode.shared.edits.dir"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDefaultUserAndGroupProxyPropertiesSetWhenNotProvided() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> coreSiteProperties=new HashMap<String,String>();
  Map<String,String> oozieEnvProperties=new HashMap<String,String>();
  Map<String,String> falconEnvProperties=new HashMap<String,String>();
  properties.put("core-site",coreSiteProperties);
  properties.put("oozie-env",oozieEnvProperties);
  properties.put("falcon-env",falconEnvProperties);
  coreSiteProperties.put("hadoop.proxyuser.test-oozie-user.hosts","testOozieHostsVal");
  coreSiteProperties.put("hadoop.proxyuser.test-oozie-user.groups","testOozieGroupsVal");
  oozieEnvProperties.put("oozie_user","test-oozie-user");
  falconEnvProperties.put("falcon_user","test-falcon-user");
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents1=new HashSet<String>();
  hgComponents1.add("OOZIE_SERVER");
  hgComponents1.add("FALCON_SERVER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents1,Collections.singleton("host1"));
  Collection<TestHostGroup> hostGroups=Collections.singletonList(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForClusterCreate();
  assertEquals(4,coreSiteProperties.size());
  assertEquals("testOozieHostsVal",coreSiteProperties.get("hadoop.proxyuser.test-oozie-user.hosts"));
  assertEquals("testOozieGroupsVal",coreSiteProperties.get("hadoop.proxyuser.test-oozie-user.groups"));
  assertEquals("*",coreSiteProperties.get("hadoop.proxyuser.test-falcon-user.hosts"));
  assertEquals("*",coreSiteProperties.get("hadoop.proxyuser.test-falcon-user.groups"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testHiveConfigClusterUpdateExportedHostGroupValue() throws Exception {
  final String expectedHostGroupName="host_group_1";
  final String expectedHostName="c6401.ambari.apache.org";
  final String expectedPropertyValue="hive.metastore.local=false,hive.metastore.uris=thrift://%HOSTGROUP::host_group_1%:9083,hive.metastore.sasl.enabled=false,hive.metastore.execute.setugi=true";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> webHCatSiteProperties=new HashMap<String,String>();
  properties.put("webhcat-site",webHCatSiteProperties);
  webHCatSiteProperties.put("templeton.hive.properties",expectedPropertyValue);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("HIVE_METASTORE");
  List<String> hosts=new ArrayList<String>();
  hosts.add(expectedHostName);
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,hosts);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertEquals("Unexpected config update for templeton.hive.properties","hive.metastore.local=false,hive.metastore.uris=thrift://" + expectedHostName + ":9083,hive.metastore.sasl.enabled=false,hive.metastore.execute.setugi=true",webHCatSiteProperties.get("templeton.hive.properties"));
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testYamlMultiValueWithSingleQuoteFlowStyleFormatSingleValueInSquareBrackets() throws Exception {
  BlueprintConfigurationProcessor.YamlMultiValuePropertyDecorator yamlMultiValuePropertyDecorator=new BlueprintConfigurationProcessor.YamlMultiValuePropertyDecorator(null);
  String originalValue="['test_value']";
  String newValue=yamlMultiValuePropertyDecorator.doFormat(originalValue);
  String expectedValue="['test_value']";
  assertEquals(expectedValue,newValue);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testHDFSConfigClusterUpdateQuorumJournalURL() throws Exception {
  final String expectedHostNameOne="c6401.apache.ambari.org";
  final String expectedHostNameTwo="c6402.apache.ambari.org";
  final String expectedPortNum="808080";
  final String expectedHostGroupName="host_group_1";
  final String expectedHostGroupNameTwo="host_group_2";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> hdfsSiteProperties=new HashMap<String,String>();
  properties.put("hdfs-site",hdfsSiteProperties);
  hdfsSiteProperties.put("dfs.namenode.shared.edits.dir","qjournal://" + createExportedAddress(expectedPortNum,expectedHostGroupName) + ";"+ createExportedAddress(expectedPortNum,expectedHostGroupNameTwo)+ "/mycluster");
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents1=new HashSet<String>();
  hgComponents1.add("NAMENODE");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents1,Collections.singleton(expectedHostNameOne));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("NAMENODE");
  TestHostGroup group2=new TestHostGroup(expectedHostGroupNameTwo,hgComponents2,Collections.singleton(expectedHostNameTwo));
  Collection<TestHostGroup> hostGroups=new ArrayList<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertEquals("HDFS HA shared edits directory property not properly updated for cluster create.","qjournal://" + createHostAddress(expectedHostNameOne,expectedPortNum) + ";"+ createHostAddress(expectedHostNameTwo,expectedPortNum)+ "/mycluster",hdfsSiteProperties.get("dfs.namenode.shared.edits.dir"));
}

</code></pre>

<pre class="type-4 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDoUpdateForClusterVerifyRetrySettingsDefault() throws Exception {
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  HashMap<String,String> clusterEnvProperties=new HashMap<String,String>();
  configProperties.put("cluster-env",clusterEnvProperties);
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  TestHostGroup testHostGroup=new TestHostGroup("test-host-group-one",Collections.<String>emptySet(),Collections.<String>emptySet());
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,Collections.singleton(testHostGroup));
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  Set<String> updatedConfigTypes=updater.doUpdateForClusterCreate();
  assertEquals("Incorrect number of properties added to cluster-env for retry",3,clusterEnvProperties.size());
  assertEquals("command_retry_enabled was not set to the expected default","true",clusterEnvProperties.get("command_retry_enabled"));
  assertEquals("commands_to_retry was not set to the expected default","INSTALL,START",clusterEnvProperties.get("commands_to_retry"));
  assertEquals("command_retry_max_time_in_sec was not set to the expected default","600",clusterEnvProperties.get("command_retry_max_time_in_sec"));
  assertEquals("Incorrect number of config types updated by this operation",1,updatedConfigTypes.size());
  assertTrue("Expected type not included in the updated set",updatedConfigTypes.contains("cluster-env"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testHiveConfigClusterUpdateUsingExportedNamesHiveServer2HA() throws Exception {
  final String expectedHostGroupNameOne="host_group_1";
  final String expectedHostGroupNameTwo="host_group_2";
  final String expectedHostNameOne="c6401.ambari.apache.org";
  final String expectedHostNameTwo="c6402.ambari.apache.org";
  final String inputMetaStoreURIs="thrift://" + createExportedAddress("9083",expectedHostGroupNameOne) + ","+ "thrift://"+ createExportedAddress("9083",expectedHostGroupNameTwo);
  final String expectedMetaStoreURIs="thrift://c6401.ambari.apache.org:9083,thrift://c6402.ambari.apache.org:9083";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> hiveEnvProperties=new HashMap<String,String>();
  Map<String,String> hiveSiteProperties=new HashMap<String,String>();
  configProperties.put("hive-env",hiveEnvProperties);
  configProperties.put("hive-site",hiveSiteProperties);
  hiveEnvProperties.put("hive_hostname",expectedHostNameOne);
  hiveSiteProperties.put("hive.server2.support.dynamic.service.discovery","true");
  hiveSiteProperties.put("hive.metastore.uris",inputMetaStoreURIs);
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("HIVE_SERVER");
  hgComponents.add("HIVE_METASTORE");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupNameOne,hgComponents,Collections.singleton(expectedHostNameOne));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("HIVE_SERVER");
  hgComponents2.add("HIVE_METASTORE");
  TestHostGroup group2=new TestHostGroup(expectedHostGroupNameTwo,hgComponents2,Collections.singleton(expectedHostNameTwo));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  expect(stack.getCardinality("HIVE_SERVER")).andReturn(new Cardinality("1+")).anyTimes();
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertEquals("Unexpected config update for hive_hostname",expectedHostNameOne,hiveEnvProperties.get("hive_hostname"));
  assertEquals("Unexpected config update for hive.metastore.uris",expectedMetaStoreURIs,hiveSiteProperties.get("hive.metastore.uris"));
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testYamlMultiValueWithPlainFlowStyleFormatMultiValueInSquareBrackets() throws Exception {
  BlueprintConfigurationProcessor.YamlMultiValuePropertyDecorator yamlMultiValuePropertyDecorator=new BlueprintConfigurationProcessor.YamlMultiValuePropertyDecorator(null,BlueprintConfigurationProcessor.YamlMultiValuePropertyDecorator.FlowStyle.PLAIN);
  String originalValue="[test_value1,test_value2]";
  String newValue=yamlMultiValuePropertyDecorator.doFormat(originalValue);
  String expectedValue="[test_value1,test_value2]";
  assertEquals(expectedValue,newValue);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testHiveConfigExported() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedHostNameTwo="c6402.ambari.apache.org";
  final String expectedPortNum="808080";
  final String expectedHostGroupName="host_group_1";
  final String expectedHostGroupNameTwo="host_group_2";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> hiveSiteProperties=new HashMap<String,String>();
  Map<String,String> hiveEnvProperties=new HashMap<String,String>();
  Map<String,String> webHCatSiteProperties=new HashMap<String,String>();
  Map<String,String> coreSiteProperties=new HashMap<String,String>();
  configProperties.put("hive-site",hiveSiteProperties);
  configProperties.put("hive-env",hiveEnvProperties);
  configProperties.put("webhcat-site",webHCatSiteProperties);
  configProperties.put("core-site",coreSiteProperties);
  hiveSiteProperties.put("hive.metastore.uris","thrift://" + expectedHostName + ":"+ expectedPortNum);
  hiveSiteProperties.put("javax.jdo.option.ConnectionURL",expectedHostName + ":" + expectedPortNum);
  hiveSiteProperties.put("hive.zookeeper.quorum",expectedHostName + ":" + expectedPortNum+ ","+ expectedHostNameTwo+ ":"+ expectedPortNum);
  hiveSiteProperties.put("hive.cluster.delegation.token.store.zookeeper.connectString",expectedHostName + ":" + expectedPortNum+ ","+ expectedHostNameTwo+ ":"+ expectedPortNum);
  hiveEnvProperties.put("hive_hostname",expectedHostName);
  webHCatSiteProperties.put("templeton.hive.properties",expectedHostName + "," + expectedHostNameTwo);
  webHCatSiteProperties.put("templeton.kerberos.principal",expectedHostName);
  coreSiteProperties.put("hadoop.proxyuser.hive.hosts",expectedHostName + "," + expectedHostNameTwo);
  coreSiteProperties.put("hadoop.proxyuser.HTTP.hosts",expectedHostName + "," + expectedHostNameTwo);
  coreSiteProperties.put("hadoop.proxyuser.hcat.hosts",expectedHostName + "," + expectedHostNameTwo);
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> groupComponents=new HashSet<String>();
  groupComponents.add("HIVE_SERVER");
  Collection<String> hosts=new ArrayList<String>();
  hosts.add(expectedHostName);
  hosts.add("serverTwo");
  TestHostGroup group=new TestHostGroup(expectedHostGroupName,groupComponents,hosts);
  Collection<String> groupComponents2=new HashSet<String>();
  groupComponents2.add("HIVE_CLIENT");
  Collection<String> hosts2=new ArrayList<String>();
  hosts2.add(expectedHostNameTwo);
  hosts2.add("serverFour");
  TestHostGroup group2=new TestHostGroup(expectedHostGroupNameTwo,groupComponents2,hosts2);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  assertEquals("hive property not properly exported","thrift://" + createExportedAddress(expectedPortNum,expectedHostGroupName),hiveSiteProperties.get("hive.metastore.uris"));
  assertEquals("hive property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),hiveSiteProperties.get("javax.jdo.option.ConnectionURL"));
  assertEquals("hive property not properly exported",createExportedHostName(expectedHostGroupName),hiveEnvProperties.get("hive_hostname"));
  assertEquals("hive property not properly exported",createExportedHostName(expectedHostGroupName) + "," + createExportedHostName(expectedHostGroupNameTwo),webHCatSiteProperties.get("templeton.hive.properties"));
  assertEquals("hive property not properly exported",createExportedHostName(expectedHostGroupName),webHCatSiteProperties.get("templeton.kerberos.principal"));
  assertEquals("hive property not properly exported",createExportedHostName(expectedHostGroupName) + "," + createExportedHostName(expectedHostGroupNameTwo),coreSiteProperties.get("hadoop.proxyuser.hive.hosts"));
  assertEquals("hive property not properly exported",createExportedHostName(expectedHostGroupName) + "," + createExportedHostName(expectedHostGroupNameTwo),coreSiteProperties.get("hadoop.proxyuser.HTTP.hosts"));
  assertEquals("hive property not properly exported",createExportedHostName(expectedHostGroupName) + "," + createExportedHostName(expectedHostGroupNameTwo),coreSiteProperties.get("hadoop.proxyuser.hcat.hosts"));
  assertEquals("hive zookeeper quorum property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName) + "," + createExportedAddress(expectedPortNum,expectedHostGroupNameTwo),hiveSiteProperties.get("hive.zookeeper.quorum"));
  assertEquals("hive zookeeper connectString property not properly exported",createExportedAddress(expectedPortNum,expectedHostGroupName) + "," + createExportedAddress(expectedPortNum,expectedHostGroupNameTwo),hiveSiteProperties.get("hive.cluster.delegation.token.store.zookeeper.connectString"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAllDefaultUserAndGroupProxyPropertiesSet() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> oozieEnvProperties=new HashMap<String,String>();
  Map<String,String> hiveEnvProperties=new HashMap<String,String>();
  Map<String,String> hbaseEnvProperties=new HashMap<String,String>();
  Map<String,String> falconEnvProperties=new HashMap<String,String>();
  properties.put("oozie-env",oozieEnvProperties);
  properties.put("hive-env",hiveEnvProperties);
  properties.put("hbase-env",hbaseEnvProperties);
  properties.put("falcon-env",falconEnvProperties);
  oozieEnvProperties.put("oozie_user","test-oozie-user");
  hiveEnvProperties.put("hive_user","test-hive-user");
  hiveEnvProperties.put("hcat_user","test-hcat-user");
  hbaseEnvProperties.put("hbase_user","test-hbase-user");
  falconEnvProperties.put("falcon_user","test-falcon-user");
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents1=new HashSet<String>();
  hgComponents1.add("OOZIE_SERVER");
  hgComponents1.add("HIVE_SERVER");
  hgComponents1.add("HBASE_MASTER");
  hgComponents1.add("FALCON_SERVER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents1,Collections.singleton("host1"));
  Collection<TestHostGroup> hostGroups=Collections.singletonList(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForClusterCreate();
  assertEquals("*",properties.get("core-site").get("hadoop.proxyuser.test-oozie-user.hosts"));
  assertEquals("*",properties.get("core-site").get("hadoop.proxyuser.test-oozie-user.groups"));
  assertEquals("*",properties.get("core-site").get("hadoop.proxyuser.test-hive-user.hosts"));
  assertEquals("*",properties.get("core-site").get("hadoop.proxyuser.test-hive-user.groups"));
  assertEquals("*",properties.get("core-site").get("hadoop.proxyuser.test-hcat-user.hosts"));
  assertEquals("*",properties.get("core-site").get("hadoop.proxyuser.test-hcat-user.groups"));
  assertEquals("*",properties.get("core-site").get("hadoop.proxyuser.test-hbase-user.hosts"));
  assertEquals("*",properties.get("core-site").get("hadoop.proxyuser.test-hbase-user.groups"));
  assertEquals("*",properties.get("core-site").get("hadoop.proxyuser.test-falcon-user.hosts"));
  assertEquals("*",properties.get("core-site").get("hadoop.proxyuser.test-falcon-user.groups"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRangerAdminProperties_defaults() throws Exception {
  final String rangerAdminConfigType="admin-properties";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> rangerAdminProperties=new HashMap<String,String>();
  properties.put(rangerAdminConfigType,rangerAdminProperties);
  rangerAdminProperties.put("policymgr_external_url","http://localhost:100");
  Map<String,Map<String,String>> parentProperties=new HashMap<String,Map<String,String>>();
  Configuration parentClusterConfig=new Configuration(parentProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),parentClusterConfig);
  Collection<String> rangerComponents=new HashSet<String>();
  rangerComponents.add("RANGER_ADMIN");
  rangerComponents.add("RANGER_USERSYNC");
  TestHostGroup group1=new TestHostGroup("group1",rangerComponents,Collections.singleton("host1"));
  Collection<TestHostGroup> hostGroups=Collections.singletonList(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForClusterCreate();
  assertEquals("http://host1:100",clusterConfig.getPropertyValue(rangerAdminConfigType,"policymgr_external_url"));
}

</code></pre>

<pre class="type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDoUpdateForBlueprintExport_PasswordFilterApplied() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("REPOSITORY_CONFIG_PASSWORD","test-password-one");
  typeProps.put("SSL_KEYSTORE_PASSWORD","test-password-two");
  typeProps.put("SSL_TRUSTSTORE_PASSWORD","test-password-three");
  typeProps.put("XAAUDIT.DB.PASSWORD","test-password-four");
  typeProps.put("test.ssl.password","test-password-five");
  typeProps.put("test.password.should.be.included","test-another-pwd");
  Map<String,String> customProps=new HashMap<String,String>();
  customProps.put("my_test_PASSWORD","should be excluded");
  customProps.put("PASSWORD_mytest","should be included");
  properties.put("ranger-yarn-plugin-properties",typeProps);
  properties.put("custom-test-properties",customProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  assertEquals("Exported properties map was not of the expected size",1,properties.get("custom-test-properties").size());
  assertEquals("ranger-yarn-plugin-properties config type was not properly exported",1,properties.get("ranger-yarn-plugin-properties").size());
  assertFalse("Password property should have been excluded",properties.get("ranger-yarn-plugin-properties").containsKey("REPOSITORY_CONFIG_PASSWORD"));
  assertFalse("Password property should have been excluded",properties.get("ranger-yarn-plugin-properties").containsKey("SSL_KEYSTORE_PASSWORD"));
  assertFalse("Password property should have been excluded",properties.get("ranger-yarn-plugin-properties").containsKey("SSL_TRUSTSTORE_PASSWORD"));
  assertFalse("Password property should have been excluded",properties.get("ranger-yarn-plugin-properties").containsKey("XAAUDIT.DB.PASSWORD"));
  assertFalse("Password property should have been excluded",properties.get("ranger-yarn-plugin-properties").containsKey("test.ssl.password"));
  assertTrue("Expected password property not found",properties.get("ranger-yarn-plugin-properties").containsKey("test.password.should.be.included"));
  assertEquals("custom-test-properties type was not properly exported",1,properties.get("custom-test-properties").size());
  assertFalse("Password property should have been excluded",properties.get("custom-test-properties").containsKey("my_test_PASSWORD"));
  assertTrue("Expected password property not found",properties.get("custom-test-properties").containsKey("PASSWORD_mytest"));
  assertEquals("Expected password property should not have been modified","should be included",properties.get("custom-test-properties").get("PASSWORD_mytest"));
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForClusterCreate_SingleHostProperty__MultipleAppTimelineServer() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("yarn.timeline-service.address","testhost:10200");
  typeProps.put("yarn.timeline-service.webapp.address","testhost:8188");
  typeProps.put("yarn.timeline-service.webapp.https.address","testhost:8190");
  properties.put("yarn-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> group1Components=new HashSet<String>();
  group1Components.add("NAMENODE");
  group1Components.add("SECONDARY_NAMENODE");
  group1Components.add("RESOURCEMANAGER");
  group1Components.add("APP_TIMELINE_SERVER");
  TestHostGroup group1=new TestHostGroup("group1",group1Components,Collections.singleton("testhost"));
  Collection<String> group2Components=new HashSet<String>();
  group2Components.add("DATANODE");
  group2Components.add("HDFS_CLIENT");
  group2Components.add("APP_TIMELINE_SERVER");
  TestHostGroup group2=new TestHostGroup("group2",group2Components,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  expect(stack.getCardinality("APP_TIMELINE_SERVER")).andReturn(new Cardinality("0-1")).anyTimes();
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  String updatedVal=topology.getConfiguration().getFullProperties().get("yarn-site").get("yarn.timeline-service.address");
  assertEquals("Timeline Server config property should not have been updated","testhost:10200",updatedVal);
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForBlueprintExport_MultiHostProperty() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("hbase.zookeeper.quorum","testhost,testhost2,testhost2a,testhost2b");
  properties.put("hbase-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("ZOOKEEPER_SERVER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  hgComponents2.add("ZOOKEEPER_SERVER");
  Set<String> hosts2=new HashSet<String>();
  hosts2.add("testhost2");
  hosts2.add("testhost2a");
  hosts2.add("testhost2b");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,hosts2);
  Collection<String> hgComponents3=new HashSet<String>();
  hgComponents2.add("HDFS_CLIENT");
  hgComponents2.add("ZOOKEEPER_CLIENT");
  Set<String> hosts3=new HashSet<String>();
  hosts3.add("testhost3");
  hosts3.add("testhost3a");
  TestHostGroup group3=new TestHostGroup("group3",hgComponents3,hosts3);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  hostGroups.add(group3);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  String updatedVal=properties.get("hbase-site").get("hbase.zookeeper.quorum");
  assertEquals("%HOSTGROUP::group1%,%HOSTGROUP::group2%",updatedVal);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testHDFSConfigClusterUpdateQuorumJournalURL_UsingMinusSymbolInHostName() throws Exception {
  final String expectedHostNameOne="c6401.apache.ambari.org";
  final String expectedHostNameTwo="c6402.apache.ambari.org";
  final String expectedPortNum="808080";
  final String expectedHostGroupName="host-group-1";
  final String expectedHostGroupNameTwo="host-group-2";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> hdfsSiteProperties=new HashMap<String,String>();
  properties.put("hdfs-site",hdfsSiteProperties);
  hdfsSiteProperties.put("dfs.namenode.shared.edits.dir","qjournal://" + createExportedAddress(expectedPortNum,expectedHostGroupName) + ";"+ createExportedAddress(expectedPortNum,expectedHostGroupNameTwo)+ "/mycluster");
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents1=new HashSet<String>();
  hgComponents1.add("NAMENODE");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents1,Collections.singleton(expectedHostNameOne));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("NAMENODE");
  TestHostGroup group2=new TestHostGroup(expectedHostGroupNameTwo,hgComponents2,Collections.singleton(expectedHostNameTwo));
  Collection<TestHostGroup> hostGroups=new ArrayList<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertEquals("HDFS HA shared edits directory property not properly updated for cluster create.","qjournal://" + createHostAddress(expectedHostNameOne,expectedPortNum) + ";"+ createHostAddress(expectedHostNameTwo,expectedPortNum)+ "/mycluster",hdfsSiteProperties.get("dfs.namenode.shared.edits.dir"));
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForClusterCreate_DBHostProperty__exportedValue() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> hiveSiteProps=new HashMap<String,String>();
  hiveSiteProps.put("javax.jdo.option.ConnectionURL","jdbc:mysql://%HOSTGROUP::group1%/hive?createDatabaseIfNotExist=true");
  Map<String,String> hiveEnvProps=new HashMap<String,String>();
  hiveEnvProps.put("hive_database","New MySQL Database");
  properties.put("hive-site",hiveSiteProps);
  properties.put("hive-env",hiveEnvProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("RESOURCEMANAGER");
  hgComponents.add("MYSQL_SERVER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  String updatedVal=topology.getConfiguration().getFullProperties().get("hive-site").get("javax.jdo.option.ConnectionURL");
  assertEquals("jdbc:mysql://testhost/hive?createDatabaseIfNotExist=true",updatedVal);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testYarnConfigExportedWithDefaultZeroHostAddress() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedPortNum="808080";
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> yarnSiteProperties=new HashMap<String,String>();
  configProperties.put("yarn-site",yarnSiteProperties);
  yarnSiteProperties.put("yarn.log.server.url","http://" + expectedHostName + ":19888/jobhistory/logs");
  yarnSiteProperties.put("yarn.resourcemanager.hostname",expectedHostName);
  yarnSiteProperties.put("yarn.resourcemanager.resource-tracker.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.webapp.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.scheduler.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.admin.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.timeline-service.address","0.0.0.0" + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.timeline-service.webapp.address","0.0.0.0" + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.timeline-service.webapp.https.address","0.0.0.0" + ":" + expectedPortNum);
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> groupComponents=new HashSet<String>();
  groupComponents.add("RESOURCEMANAGER");
  Collection<String> hosts=new ArrayList<String>();
  hosts.add(expectedHostName);
  hosts.add("serverTwo");
  TestHostGroup group=new TestHostGroup(expectedHostGroupName,groupComponents,hosts);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  assertEquals("Yarn Log Server URL was incorrectly exported","http://" + "%HOSTGROUP::" + expectedHostGroupName + "%"+ ":19888/jobhistory/logs",yarnSiteProperties.get("yarn.log.server.url"));
  assertEquals("Yarn ResourceManager hostname was incorrectly exported",createExportedHostName(expectedHostGroupName),yarnSiteProperties.get("yarn.resourcemanager.hostname"));
  assertEquals("Yarn ResourceManager tracker address was incorrectly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),yarnSiteProperties.get("yarn.resourcemanager.resource-tracker.address"));
  assertEquals("Yarn ResourceManager webapp address was incorrectly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),yarnSiteProperties.get("yarn.resourcemanager.webapp.address"));
  assertEquals("Yarn ResourceManager scheduler address was incorrectly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),yarnSiteProperties.get("yarn.resourcemanager.scheduler.address"));
  assertEquals("Yarn ResourceManager address was incorrectly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),yarnSiteProperties.get("yarn.resourcemanager.address"));
  assertEquals("Yarn ResourceManager admin address was incorrectly exported",createExportedAddress(expectedPortNum,expectedHostGroupName),yarnSiteProperties.get("yarn.resourcemanager.admin.address"));
  assertEquals("Yarn ResourceManager timeline-service address was incorrectly exported","0.0.0.0" + ":" + expectedPortNum,yarnSiteProperties.get("yarn.timeline-service.address"));
  assertEquals("Yarn ResourceManager timeline webapp address was incorrectly exported","0.0.0.0" + ":" + expectedPortNum,yarnSiteProperties.get("yarn.timeline-service.webapp.address"));
  assertEquals("Yarn ResourceManager timeline webapp HTTPS address was incorrectly exported","0.0.0.0" + ":" + expectedPortNum,yarnSiteProperties.get("yarn.timeline-service.webapp.https.address"));
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMultipleHostTopologyUpdaterWithYamlPropertyMultiHostValue() throws Exception {
  String component="test_component";
  BlueprintConfigurationProcessor.MultipleHostTopologyUpdater mhtu=new BlueprintConfigurationProcessor.MultipleHostTopologyUpdater(component);
  String propertyOriginalValue1="['%HOSTGROUP::group_1%', '%HOSTGROUP::group_2%']";
  String propertyOriginalValue2="[%HOSTGROUP::group_1%, %HOSTGROUP::group_2%]";
  String updatedValue1=mhtu.resolveHostGroupPlaceholder(propertyOriginalValue1,null,ImmutableList.<String>of("host1:100","host2:200"));
  String updatedValue2=mhtu.resolveHostGroupPlaceholder(propertyOriginalValue2,null,ImmutableList.<String>of("host1:100","host2:200"));
  assertEquals("host1:100,host2:200",updatedValue1);
  assertEquals("host1:100,host2:200",updatedValue2);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testFalconConfigClusterUpdateDefaultConfig() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedPortNum="808080";
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> falconStartupProperties=new HashMap<String,String>();
  properties.put("falcon-startup.properties",falconStartupProperties);
  falconStartupProperties.put("*.broker.url","localhost:" + expectedPortNum);
  falconStartupProperties.put("*.falcon.service.authentication.kerberos.principal","falcon/" + "localhost" + "@EXAMPLE.COM");
  falconStartupProperties.put("*.falcon.http.authentication.kerberos.principal","HTTP/" + "localhost" + "@EXAMPLE.COM");
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("FALCON_SERVER");
  hgComponents.add("FALCON_CLIENT");
  List<String> hosts=new ArrayList<String>();
  hosts.add(expectedHostName);
  hosts.add("serverTwo");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,hosts);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertEquals("Falcon Broker URL property not properly exported",expectedHostName + ":" + expectedPortNum,falconStartupProperties.get("*.broker.url"));
  assertEquals("Falcon Kerberos Principal property not properly exported","falcon/" + expectedHostName + "@EXAMPLE.COM",falconStartupProperties.get("*.falcon.service.authentication.kerberos.principal"));
  assertEquals("Falcon Kerberos HTTP Principal property not properly exported","HTTP/" + expectedHostName + "@EXAMPLE.COM",falconStartupProperties.get("*.falcon.http.authentication.kerberos.principal"));
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRelevantDefaultUserAndGroupProxyPropertiesSet() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> oozieEnvProperties=new HashMap<String,String>();
  Map<String,String> falconEnvProperties=new HashMap<String,String>();
  properties.put("oozie-env",oozieEnvProperties);
  properties.put("falcon-env",falconEnvProperties);
  oozieEnvProperties.put("oozie_user","test-oozie-user");
  falconEnvProperties.put("falcon_user","test-falcon-user");
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents1=new HashSet<String>();
  hgComponents1.add("OOZIE_SERVER");
  hgComponents1.add("FALCON_SERVER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents1,Collections.singleton("host1"));
  Collection<TestHostGroup> hostGroups=Collections.singletonList(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForClusterCreate();
  Map<String,String> coreSiteProperties=properties.get("core-site");
  assertEquals(4,coreSiteProperties.size());
  assertEquals("*",coreSiteProperties.get("hadoop.proxyuser.test-oozie-user.hosts"));
  assertEquals("*",coreSiteProperties.get("hadoop.proxyuser.test-oozie-user.groups"));
  assertEquals("*",coreSiteProperties.get("hadoop.proxyuser.test-falcon-user.hosts"));
  assertEquals("*",coreSiteProperties.get("hadoop.proxyuser.test-falcon-user.groups"));
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRangerKmsServerProperties() throws Exception {
  final String kmsSiteConfigType="kms-site";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> kmsSiteProperties=new HashMap<String,String>();
  properties.put(kmsSiteConfigType,kmsSiteProperties);
  kmsSiteProperties.put("hadoop.kms.authentication.signer.secret.provider.zookeeper.connection.string",createHostAddress("%HOSTGROUP::group1%","2181") + "," + createHostAddress("%HOSTGROUP::group2%","2181"));
  kmsSiteProperties.put("hadoop.kms.key.provider.uri","dbks://http@localhost:9292/kms");
  Map<String,Map<String,String>> parentProperties=new HashMap<String,Map<String,String>>();
  Configuration parentClusterConfig=new Configuration(parentProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),parentClusterConfig);
  Collection<String> kmsServerComponents=new HashSet<String>();
  kmsServerComponents.add("RANGER_KMS_SERVER");
  TestHostGroup group1=new TestHostGroup("group1",kmsServerComponents,Collections.singleton("host1"));
  TestHostGroup group2=new TestHostGroup("group2",kmsServerComponents,Collections.singleton("host2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForClusterCreate();
  assertEquals("host1:2181,host2:2181",clusterConfig.getPropertyValue(kmsSiteConfigType,"hadoop.kms.authentication.signer.secret.provider.zookeeper.connection.string"));
  assertEquals("dbks://http@localhost:9292/kms",clusterConfig.getPropertyValue(kmsSiteConfigType,"hadoop.kms.key.provider.uri"));
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testDoUpdateForBlueprintExport_DBHostProperty__External() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("javax.jdo.option.ConnectionURL","jdbc:mysql://external-host/hive?createDatabaseIfNotExist=true");
  properties.put("hive-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  assertFalse(properties.get("hive-site").containsKey("javax.jdo.option.ConnectionURL"));
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForBlueprintExport_SingleHostProperty_specifiedInParentConfig() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> yarnSiteProps=new HashMap<String,String>();
  yarnSiteProps.put("yarn.resourcemanager.hostname","testhost");
  properties.put("yarn-site",yarnSiteProps);
  Map<String,Map<String,String>> parentProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> parentYarnSiteProps=new HashMap<String,String>();
  parentYarnSiteProps.put("yarn.resourcemanager.resource-tracker.address","testhost");
  parentProperties.put("yarn-site",parentYarnSiteProps);
  Configuration parentClusterConfig=new Configuration(parentProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),parentClusterConfig);
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  assertEquals("%HOSTGROUP::group1%",clusterConfig.getPropertyValue("yarn-site","yarn.resourcemanager.hostname"));
  assertEquals("%HOSTGROUP::group1%",clusterConfig.getPropertyValue("yarn-site","yarn.resourcemanager.resource-tracker.address"));
}

</code></pre>

<pre class="type-4 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetRequiredHostGroups___multipleGroups() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> coreSiteMap=new HashMap<String,String>();
  properties.put("core-site",coreSiteMap);
  coreSiteMap.put("fs.defaultFS","localhost");
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  expect(stack.getCardinality("NAMENODE")).andReturn(new Cardinality("1")).anyTimes();
  Collection<String> hgComponents1=new HashSet<String>();
  hgComponents1.add("HIVE_SERVER");
  hgComponents1.add("NAMENODE");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents1,Collections.singleton("host1"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("NAMENODE");
  hgComponents2.add("DATANODE");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton("host2"));
  Collection<TestHostGroup> hostGroups=new ArrayList<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  Collection<String> requiredGroups=updater.getRequiredHostGroups();
  assertEquals(2,requiredGroups.size());
  assertTrue(requiredGroups.containsAll(Arrays.asList("group1","group2")));
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForClusterCreate_SingleHostProperty__exportedValue_UsingMinusSymbolInHostGroupName() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("yarn.resourcemanager.hostname","%HOSTGROUP::os-amb-r6-secha-1427972156-hbaseha-3-6%");
  properties.put("yarn-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("os-amb-r6-secha-1427972156-hbaseha-3-6",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  String updatedVal=topology.getConfiguration().getFullProperties().get("yarn-site").get("yarn.resourcemanager.hostname");
  assertEquals("testhost",updatedVal);
}

</code></pre>

<pre class="type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
@Test public void testHiveConfigClusterUpdatePropertiesFilterAuthenticationOff() throws Exception {
  reset(stack);
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> hiveSiteProperties=new HashMap<String,String>();
  properties.put("hive-site",hiveSiteProperties);
  hiveSiteProperties.put("hive.server2.authentication","NONE");
  hiveSiteProperties.put("hive.server2.authentication.kerberos.keytab"," ");
  hiveSiteProperties.put("hive.server2.authentication.kerberos.principal"," ");
  Map<String,Stack.ConfigProperty> mapOfMetadata=new HashMap<String,Stack.ConfigProperty>();
  Stack.ConfigProperty configProperty1=new Stack.ConfigProperty("hive-site","hive.server2.authentication.kerberos.keytab"," "){
    @Override Set<PropertyDependencyInfo> getDependsOnProperties(){
      PropertyDependencyInfo dependencyInfo=new PropertyDependencyInfo("hive-site","hive.server2.authentication");
      return Collections.singleton(dependencyInfo);
    }
  }
;
  Stack.ConfigProperty configProperty2=new Stack.ConfigProperty("hive-site","hive.server2.authentication.kerberos.principal"," "){
    @Override Set<PropertyDependencyInfo> getDependsOnProperties(){
      PropertyDependencyInfo dependencyInfo=new PropertyDependencyInfo("hive-site","hive.server2.authentication");
      return Collections.singleton(dependencyInfo);
    }
  }
;
  mapOfMetadata.put("hive.server2.authentication.kerberos.keytab",configProperty1);
  mapOfMetadata.put("hive.server2.authentication.kerberos.principal",configProperty2);
  expect(stack.getName()).andReturn("testStack").anyTimes();
  expect(stack.getVersion()).andReturn("1").anyTimes();
  expect(stack.isMasterComponent((String)anyObject())).andReturn(false).anyTimes();
  expect(stack.getServiceForConfigType("hive-site")).andReturn("HIVE").atLeastOnce();
  expect(stack.getConfigurationPropertiesWithMetadata("HIVE","hive-site")).andReturn(mapOfMetadata).atLeastOnce();
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  List<String> hosts=new ArrayList<String>();
  hosts.add("some-hose");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,hosts);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertFalse("hive.server2.authentication.kerberos.keytab should have been filtered out of configuration",hiveSiteProperties.containsKey("hive.server2.authentication.kerberos.keytab"));
  assertFalse("hive.server2.authentication.kerberos.principal should have been filtered out of configuration",hiveSiteProperties.containsKey("hive.server2.authentication.kerberos.principal"));
}

</code></pre>

<pre class="type-4 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testParseNameServices() throws Exception {
  Map<String,String> hdfsSiteConfigMap=new HashMap<String,String>();
  hdfsSiteConfigMap.put("dfs.nameservices","serviceOne");
  String[] result=BlueprintConfigurationProcessor.parseNameServices(hdfsSiteConfigMap);
  assertNotNull("Resulting array was null",result);
  assertEquals("Incorrect array size",1,result.length);
  assertEquals("Incorrect value for returned name service","serviceOne",result[0]);
  hdfsSiteConfigMap.put("dfs.nameservices"," serviceTwo, serviceThree, serviceFour");
  String[] resultTwo=BlueprintConfigurationProcessor.parseNameServices(hdfsSiteConfigMap);
  assertNotNull("Resulting array was null",resultTwo);
  assertEquals("Incorrect array size",3,resultTwo.length);
  assertEquals("Incorrect value for returned name service","serviceTwo",resultTwo[0]);
  assertEquals("Incorrect value for returned name service","serviceThree",resultTwo[1]);
  assertEquals("Incorrect value for returned name service","serviceFour",resultTwo[2]);
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForClusterCreate_SingleHostProperty__defaultValue_providedInParent() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> yarnSiteProps=new HashMap<String,String>();
  yarnSiteProps.put("yarn.resourcemanager.hostname","localhost");
  properties.put("yarn-site",yarnSiteProps);
  Map<String,Map<String,String>> parentProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> parentYarnSiteProps=new HashMap<String,String>();
  parentYarnSiteProps.put("yarn.resourcemanager.resource-tracker.address","localhost");
  parentProperties.put("yarn-site",parentYarnSiteProps);
  Configuration parentClusterConfig=new Configuration(parentProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),parentClusterConfig);
  Collection<String> group1Components=new HashSet<String>();
  group1Components.add("NAMENODE");
  group1Components.add("SECONDARY_NAMENODE");
  group1Components.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("group1",group1Components,Collections.singleton("testhost"));
  Collection<String> group2Components=new HashSet<String>();
  group2Components.add("DATANODE");
  group2Components.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",group2Components,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertEquals("testhost",clusterConfig.getPropertyValue("yarn-site","yarn.resourcemanager.hostname"));
  assertEquals("testhost",clusterConfig.getPropertyValue("yarn-site","yarn.resourcemanager.resource-tracker.address"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testYarnHighAvailabilityConfigClusterUpdateSpecifyingHostNamesDirectly() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedPortNum="808080";
  final String expectedHostGroupName="host_group_1";
  final String expectedHostGroupNameTwo="host_group_2";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> yarnSiteProperties=new HashMap<String,String>();
  configProperties.put("yarn-site",yarnSiteProperties);
  yarnSiteProperties.put("yarn.log.server.url","http://" + expectedHostName + ":19888/jobhistory/logs");
  yarnSiteProperties.put("yarn.resourcemanager.hostname",expectedHostName);
  yarnSiteProperties.put("yarn.resourcemanager.resource-tracker.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.webapp.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.scheduler.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.admin.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.timeline-service.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.timeline-service.webapp.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.timeline-service.webapp.https.address",expectedHostName + ":" + expectedPortNum);
  yarnSiteProperties.put("yarn.resourcemanager.ha.enabled","true");
  yarnSiteProperties.put("yarn.resourcemanager.ha.rm-ids","rm1, rm2");
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("RESOURCEMANAGER");
  hgComponents.add("APP_TIMELINE_SERVER");
  hgComponents.add("HISTORYSERVER");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,Collections.singleton(expectedHostName));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("RESOURCEMANAGER");
  TestHostGroup group2=new TestHostGroup(expectedHostGroupNameTwo,hgComponents2,Collections.singleton("host2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  expect(stack.getCardinality("RESOURCEMANAGER")).andReturn(new Cardinality("1-2")).anyTimes();
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertEquals("Yarn Log Server URL was incorrectly updated","http://" + expectedHostName + ":19888/jobhistory/logs",yarnSiteProperties.get("yarn.log.server.url"));
  assertEquals("Yarn ResourceManager hostname was incorrectly exported",expectedHostName,yarnSiteProperties.get("yarn.resourcemanager.hostname"));
  assertEquals("Yarn ResourceManager tracker address was incorrectly updated",createHostAddress(expectedHostName,expectedPortNum),yarnSiteProperties.get("yarn.resourcemanager.resource-tracker.address"));
  assertEquals("Yarn ResourceManager webapp address was incorrectly updated",createHostAddress(expectedHostName,expectedPortNum),yarnSiteProperties.get("yarn.resourcemanager.webapp.address"));
  assertEquals("Yarn ResourceManager scheduler address was incorrectly updated",createHostAddress(expectedHostName,expectedPortNum),yarnSiteProperties.get("yarn.resourcemanager.scheduler.address"));
  assertEquals("Yarn ResourceManager address was incorrectly updated",createHostAddress(expectedHostName,expectedPortNum),yarnSiteProperties.get("yarn.resourcemanager.address"));
  assertEquals("Yarn ResourceManager admin address was incorrectly updated",createHostAddress(expectedHostName,expectedPortNum),yarnSiteProperties.get("yarn.resourcemanager.admin.address"));
  assertEquals("Yarn ResourceManager timeline-service address was incorrectly updated",createHostAddress(expectedHostName,expectedPortNum),yarnSiteProperties.get("yarn.timeline-service.address"));
  assertEquals("Yarn ResourceManager timeline webapp address was incorrectly updated",createHostAddress(expectedHostName,expectedPortNum),yarnSiteProperties.get("yarn.timeline-service.webapp.address"));
  assertEquals("Yarn ResourceManager timeline webapp HTTPS address was incorrectly updated",createHostAddress(expectedHostName,expectedPortNum),yarnSiteProperties.get("yarn.timeline-service.webapp.https.address"));
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForClusterCreate_SingleHostProperty__exportedValue__WithPort() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("fs.defaultFS","%HOSTGROUP::group1%:5050");
  properties.put("core-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  String updatedVal=topology.getConfiguration().getFullProperties().get("core-site").get("fs.defaultFS");
  assertEquals("testhost:5050",updatedVal);
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMultipleHostTopologyUpdaterWithSingleHostWithSuffixValue() throws Exception {
  String component="test_component";
  BlueprintConfigurationProcessor.MultipleHostTopologyUpdater mhtu=new BlueprintConfigurationProcessor.MultipleHostTopologyUpdater(component);
  String propertyOriginalValue="http://%HOSTGROUP::group_1%#";
  String updatedValue=mhtu.resolveHostGroupPlaceholder(propertyOriginalValue,null,ImmutableList.<String>of("host1:100"));
  assertEquals("http://host1:100#",updatedValue);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testStormandKafkaConfigClusterUpdateWithGangliaServer() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> stormSiteProperties=new HashMap<String,String>();
  Map<String,String> kafkaBrokerProperties=new HashMap<String,String>();
  properties.put("storm-site",stormSiteProperties);
  properties.put("kafka-broker",kafkaBrokerProperties);
  stormSiteProperties.put("worker.childopts","localhost");
  stormSiteProperties.put("supervisor.childopts","localhost");
  stormSiteProperties.put("nimbus.childopts","localhost");
  kafkaBrokerProperties.put("kafka.ganglia.metrics.host","localhost");
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("GANGLIA_SERVER");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,Collections.singleton(expectedHostName));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertEquals("worker startup settings not properly handled by cluster create",expectedHostName,stormSiteProperties.get("worker.childopts"));
  assertEquals("supervisor startup settings not properly handled by cluster create",expectedHostName,stormSiteProperties.get("supervisor.childopts"));
  assertEquals("nimbus startup settings not properly handled by cluster create",expectedHostName,stormSiteProperties.get("nimbus.childopts"));
  assertEquals("Kafka ganglia host property not properly handled by cluster create",expectedHostName,kafkaBrokerProperties.get("kafka.ganglia.metrics.host"));
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMultipleHostTopologyUpdaterWithMultiHostValue() throws Exception {
  String component="test_component";
  BlueprintConfigurationProcessor.MultipleHostTopologyUpdater mhtu=new BlueprintConfigurationProcessor.MultipleHostTopologyUpdater(component);
  String propertyOriginalValue="%HOSTGROUP::group_1%:11,%HOSTGROUP::group_2%:11";
  String updatedValue=mhtu.resolveHostGroupPlaceholder(propertyOriginalValue,null,ImmutableList.<String>of("host1:100","host2:200"));
  assertEquals("host1:100,host2:200",updatedValue);
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForBlueprintExport_DBHostProperty() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> hiveSiteProps=new HashMap<String,String>();
  hiveSiteProps.put("javax.jdo.option.ConnectionURL","jdbc:mysql://testhost/hive?createDatabaseIfNotExist=true");
  properties.put("hive-site",hiveSiteProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("RESOURCEMANAGER");
  hgComponents.add("MYSQL_SERVER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  String updatedVal=properties.get("hive-site").get("javax.jdo.option.ConnectionURL");
  assertEquals("jdbc:mysql://%HOSTGROUP::group1%/hive?createDatabaseIfNotExist=true",updatedVal);
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForBlueprintExport_MultiHostProperty__WithPorts() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("templeton.zookeeper.hosts","testhost:5050,testhost2:9090,testhost2a:9090,testhost2b:9090");
  properties.put("webhcat-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("ZOOKEEPER_SERVER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  hgComponents2.add("ZOOKEEPER_SERVER");
  Set<String> hosts2=new HashSet<String>();
  hosts2.add("testhost2");
  hosts2.add("testhost2a");
  hosts2.add("testhost2b");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,hosts2);
  Collection<String> hgComponents3=new HashSet<String>();
  hgComponents2.add("HDFS_CLIENT");
  hgComponents2.add("ZOOKEEPER_CLIENT");
  Set<String> hosts3=new HashSet<String>();
  hosts3.add("testhost3");
  hosts3.add("testhost3a");
  TestHostGroup group3=new TestHostGroup("group3",hgComponents3,hosts3);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  hostGroups.add(group3);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  String updatedVal=properties.get("webhcat-site").get("templeton.zookeeper.hosts");
  assertEquals("%HOSTGROUP::group1%:5050,%HOSTGROUP::group2%:9090",updatedVal);
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForClusterCreate_MultiHostProperty_exportedValues_withPorts_singleHostValue() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> yarnSiteConfig=new HashMap<String,String>();
  yarnSiteConfig.put("hadoop.registry.zk.quorum","%HOSTGROUP::host_group_1%:2181");
  properties.put("yarn-site",yarnSiteConfig);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("ZOOKEEPER_SERVER");
  TestHostGroup group1=new TestHostGroup("host_group_1",hgComponents,Collections.singleton("testhost"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertEquals("Multi-host property with single host value was not correctly updated for cluster create.","testhost:2181",topology.getConfiguration().getFullProperties().get("yarn-site").get("hadoop.registry.zk.quorum"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testPropertyWithUndefinedHostisExported() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> properties=new HashMap<String,String>();
  configProperties.put("storm-site",properties);
  properties.put("storm.zookeeper.servers",expectedHostName);
  properties.put("nimbus.childopts","undefined");
  properties.put("worker.childopts","some other info, undefined, more info");
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> groupComponents=new HashSet<String>();
  groupComponents.add("ZOOKEEPER_SERVER");
  Collection<String> hosts=new ArrayList<String>();
  hosts.add(expectedHostName);
  hosts.add("serverTwo");
  TestHostGroup group=new TestHostGroup(expectedHostGroupName,groupComponents,hosts);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  assertEquals("Property was incorrectly exported","%HOSTGROUP::" + expectedHostGroupName + "%",properties.get("storm.zookeeper.servers"));
  assertEquals("Property with undefined host was incorrectly exported","undefined",properties.get("nimbus.childopts"));
  assertEquals("Property with undefined host was incorrectly exported","some other info, undefined, more info",properties.get("worker.childopts"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testStormAndKafkaConfigClusterUpdateWithoutGangliaServer() throws Exception {
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> stormSiteProperties=new HashMap<String,String>();
  Map<String,String> kafkaBrokerProperties=new HashMap<String,String>();
  properties.put("storm-site",stormSiteProperties);
  properties.put("kafka-broker",kafkaBrokerProperties);
  stormSiteProperties.put("worker.childopts","localhost");
  stormSiteProperties.put("supervisor.childopts","localhost");
  stormSiteProperties.put("nimbus.childopts","localhost");
  kafkaBrokerProperties.put("kafka.ganglia.metrics.host","localhost");
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("HIVE_METASTORE");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,Collections.singleton("testserver"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  expect(stack.getCardinality("GANGLIA_SERVER")).andReturn(new Cardinality("1")).anyTimes();
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertEquals("worker startup settings not properly handled by cluster create","localhost",stormSiteProperties.get("worker.childopts"));
  assertEquals("supervisor startup settings not properly handled by cluster create","localhost",stormSiteProperties.get("supervisor.childopts"));
  assertEquals("nimbus startup settings not properly handled by cluster create","localhost",stormSiteProperties.get("nimbus.childopts"));
  assertEquals("Kafka ganglia host property not properly handled by cluster create","localhost",kafkaBrokerProperties.get("kafka.ganglia.metrics.host"));
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testHDFSConfigExported() throws Exception {
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedPortNum="808080";
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> hdfsSiteProperties=new HashMap<String,String>();
  Map<String,String> coreSiteProperties=new HashMap<String,String>();
  Map<String,String> hbaseSiteProperties=new HashMap<String,String>();
  Map<String,String> accumuloSiteProperties=new HashMap<String,String>();
  configProperties.put("hdfs-site",hdfsSiteProperties);
  configProperties.put("core-site",coreSiteProperties);
  configProperties.put("hbase-site",hbaseSiteProperties);
  configProperties.put("accumulo-site",accumuloSiteProperties);
  hdfsSiteProperties.put("dfs.http.address",expectedHostName + ":" + expectedPortNum);
  hdfsSiteProperties.put("dfs.https.address",expectedHostName + ":" + expectedPortNum);
  hdfsSiteProperties.put("dfs.namenode.http-address",expectedHostName + ":" + expectedPortNum);
  hdfsSiteProperties.put("dfs.namenode.https-address",expectedHostName + ":" + expectedPortNum);
  hdfsSiteProperties.put("dfs.secondary.http.address",expectedHostName + ":" + expectedPortNum);
  hdfsSiteProperties.put("dfs.namenode.secondary.http-address",expectedHostName + ":" + expectedPortNum);
  hdfsSiteProperties.put("dfs.namenode.shared.edits.dir",expectedHostName + ":" + expectedPortNum);
  coreSiteProperties.put("fs.default.name",expectedHostName + ":" + expectedPortNum);
  coreSiteProperties.put("fs.defaultFS","hdfs://" + expectedHostName + ":"+ expectedPortNum);
  hbaseSiteProperties.put("hbase.rootdir","hdfs://" + expectedHostName + ":"+ expectedPortNum+ "/apps/hbase/data");
  accumuloSiteProperties.put("instance.volumes","hdfs://" + expectedHostName + ":"+ expectedPortNum+ "/apps/accumulo/data");
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> groupComponents=new HashSet<String>();
  groupComponents.add("NAMENODE");
  groupComponents.add("SECONDARY_NAMENODE");
  Collection<String> hosts=new ArrayList<String>();
  hosts.add(expectedHostName);
  hosts.add("serverTwo");
  TestHostGroup group=new TestHostGroup(expectedHostGroupName,groupComponents,hosts);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  assertEquals("hdfs config property not exported properly",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.http.address"));
  assertEquals("hdfs config property not exported properly",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.https.address"));
  assertEquals("hdfs config property not exported properly",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.namenode.http-address"));
  assertEquals("hdfs config property not exported properly",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.namenode.https-address"));
  assertEquals("hdfs config property not exported properly",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.secondary.http.address"));
  assertEquals("hdfs config property not exported properly",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.namenode.secondary.http-address"));
  assertEquals("hdfs config property not exported properly",createExportedAddress(expectedPortNum,expectedHostGroupName),hdfsSiteProperties.get("dfs.namenode.shared.edits.dir"));
  assertEquals("hdfs config in core-site not exported properly",createExportedAddress(expectedPortNum,expectedHostGroupName),coreSiteProperties.get("fs.default.name"));
  assertEquals("hdfs config in core-site not exported properly","hdfs://" + createExportedAddress(expectedPortNum,expectedHostGroupName),coreSiteProperties.get("fs.defaultFS"));
  assertEquals("hdfs config in hbase-site not exported properly","hdfs://" + createExportedAddress(expectedPortNum,expectedHostGroupName) + "/apps/hbase/data",hbaseSiteProperties.get("hbase.rootdir"));
  assertEquals("hdfs config in accumulo-site not exported properly","hdfs://" + createExportedAddress(expectedPortNum,expectedHostGroupName) + "/apps/accumulo/data",accumuloSiteProperties.get("instance.volumes"));
}

</code></pre>

<pre class="type-4 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDoUpdateForClusterCreate_MultiHostProperty__exportedValues() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> typeProps=new HashMap<String,String>();
  typeProps.put("hbase.zookeeper.quorum","%HOSTGROUP::group1%,%HOSTGROUP::group2%");
  properties.put("hbase-site",typeProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("ZOOKEEPER_SERVER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  hgComponents2.add("ZOOKEEPER_SERVER");
  Set<String> hosts2=new HashSet<String>();
  hosts2.add("testhost2");
  hosts2.add("testhost2a");
  hosts2.add("testhost2b");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,hosts2);
  Collection<String> hgComponents3=new HashSet<String>();
  hgComponents2.add("HDFS_CLIENT");
  hgComponents2.add("ZOOKEEPER_CLIENT");
  Set<String> hosts3=new HashSet<String>();
  hosts3.add("testhost3");
  hosts3.add("testhost3a");
  TestHostGroup group3=new TestHostGroup("group3",hgComponents3,hosts3);
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  hostGroups.add(group3);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  String updatedVal=topology.getConfiguration().getFullProperties().get("hbase-site").get("hbase.zookeeper.quorum");
  String[] hosts=updatedVal.split(",");
  Collection<String> expectedHosts=new HashSet<String>();
  expectedHosts.add("testhost");
  expectedHosts.add("testhost2");
  expectedHosts.add("testhost2a");
  expectedHosts.add("testhost2b");
  assertEquals(4,hosts.length);
  for (  String host : hosts) {
    assertTrue(expectedHosts.contains(host));
    expectedHosts.remove(host);
  }
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testYamlMultiValueFormatWithPlainFlowStyleSingleValueInSquareBrackets() throws Exception {
  BlueprintConfigurationProcessor.YamlMultiValuePropertyDecorator yamlMultiValuePropertyDecorator=new BlueprintConfigurationProcessor.YamlMultiValuePropertyDecorator(null,BlueprintConfigurationProcessor.YamlMultiValuePropertyDecorator.FlowStyle.PLAIN);
  String originalValue="[test_value]";
  String newValue=yamlMultiValuePropertyDecorator.doFormat(originalValue);
  String expectedValue="[test_value]";
  assertEquals(expectedValue,newValue);
}

</code></pre>

<pre class="type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void init() throws Exception {
  expect(bp.getStack()).andReturn(stack).anyTimes();
  expect(bp.getName()).andReturn("test-bp").anyTimes();
  expect(stack.getName()).andReturn("testStack").anyTimes();
  expect(stack.getVersion()).andReturn("1").anyTimes();
  expect(stack.isMasterComponent((String)anyObject())).andReturn(false).anyTimes();
  expect(stack.getConfigurationPropertiesWithMetadata(anyObject(String.class),anyObject(String.class))).andReturn(Collections.<String,Stack.ConfigProperty>emptyMap()).anyTimes();
  expect(serviceInfo.getRequiredProperties()).andReturn(Collections.<String,org.apache.ambari.server.state.PropertyInfo>emptyMap()).anyTimes();
  expect(serviceInfo.getRequiredServices()).andReturn(Collections.<String>emptyList()).anyTimes();
  Collection<String> hdfsComponents=new HashSet<String>();
  hdfsComponents.add("NAMENODE");
  hdfsComponents.add("SECONDARY_NAMENODE");
  hdfsComponents.add("DATANODE");
  hdfsComponents.add("HDFS_CLIENT");
  serviceComponents.put("HDFS",hdfsComponents);
  Collection<String> yarnComponents=new HashSet<String>();
  yarnComponents.add("RESOURCEMANAGER");
  yarnComponents.add("NODEMANAGER");
  yarnComponents.add("YARN_CLIENT");
  yarnComponents.add("APP_TIMELINE_SERVER");
  serviceComponents.put("YARN",yarnComponents);
  Collection<String> mrComponents=new HashSet<String>();
  mrComponents.add("MAPREDUCE2_CLIENT");
  mrComponents.add("HISTORY_SERVER");
  serviceComponents.put("MAPREDUCE2",mrComponents);
  Collection<String> zkComponents=new HashSet<String>();
  zkComponents.add("ZOOKEEPER_SERVER");
  zkComponents.add("ZOOKEEPER_CLIENT");
  serviceComponents.put("ZOOKEEPER",zkComponents);
  Collection<String> hiveComponents=new HashSet<String>();
  hiveComponents.add("MYSQL_SERVER");
  hiveComponents.add("HIVE_METASTORE");
  hiveComponents.add("HIVE_SERVER");
  serviceComponents.put("HIVE",hiveComponents);
  Collection<String> falconComponents=new HashSet<String>();
  falconComponents.add("FALCON_SERVER");
  falconComponents.add("FALCON_CLIENT");
  serviceComponents.put("FALCON",falconComponents);
  Collection<String> gangliaComponents=new HashSet<String>();
  gangliaComponents.add("GANGLIA_SERVER");
  gangliaComponents.add("GANGLIA_CLIENT");
  serviceComponents.put("GANGLIA",gangliaComponents);
  Collection<String> kafkaComponents=new HashSet<String>();
  kafkaComponents.add("KAFKA_BROKER");
  serviceComponents.put("KAFKA",kafkaComponents);
  Collection<String> knoxComponents=new HashSet<String>();
  knoxComponents.add("KNOX_GATEWAY");
  serviceComponents.put("KNOX",knoxComponents);
  Collection<String> oozieComponents=new HashSet<String>();
  oozieComponents.add("OOZIE_SERVER");
  oozieComponents.add("OOZIE_CLIENT");
  serviceComponents.put("OOZIE",oozieComponents);
  Collection<String> hbaseComponents=new HashSet<String>();
  hbaseComponents.add("HBASE_MASTER");
  serviceComponents.put("HBASE",hbaseComponents);
  Collection<String> atlasComponents=new HashSet<String>();
  atlasComponents.add("ATLAS_SERVER");
  atlasComponents.add("ATLAS_CLIENT");
  serviceComponents.put("ATLAS",atlasComponents);
  Collection<String> amsComponents=new HashSet<String>();
  amsComponents.add("METRICS_COLLECTOR");
  serviceComponents.put("AMBARI_METRICS",amsComponents);
  Collection<String> stormComponents=new HashSet<String>();
  stormComponents.add("NIMBUS");
  serviceComponents.put("STORM",stormComponents);
  for (  Map.Entry<String,Collection<String>> entry : serviceComponents.entrySet()) {
    String service=entry.getKey();
    for (    String component : entry.getValue()) {
      expect(stack.getServiceForComponent(component)).andReturn(service).anyTimes();
    }
  }
  expect(stack.getCardinality("MYSQL_SERVER")).andReturn(new Cardinality("0-1")).anyTimes();
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetRequiredHostGroups___validComponentCountOfZero() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> hiveSite=new HashMap<String,String>();
  properties.put("hive-site",hiveSite);
  Map<String,String> hiveEnv=new HashMap<String,String>();
  properties.put("hive-env",hiveEnv);
  hiveSite.put("javax.jdo.option.ConnectionURL","localhost:1111");
  hiveEnv.put("hive_database","New Database");
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents1=new HashSet<String>();
  hgComponents1.add("HIVE_SERVER");
  hgComponents1.add("NAMENODE");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents1,Collections.singleton("host1"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton("host2"));
  Collection<TestHostGroup> hostGroups=new ArrayList<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  Collection<String> requiredGroups=updater.getRequiredHostGroups();
  assertEquals(0,requiredGroups.size());
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDoUpdateForBlueprintExport_FilterProperties() throws Exception {
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> kerberosEnvProps=new HashMap<String,String>();
  kerberosEnvProps.put("admin_server_host","test");
  kerberosEnvProps.put("kdc_host","test");
  kerberosEnvProps.put("realm","test");
  kerberosEnvProps.put("kdc_type","test");
  kerberosEnvProps.put("ldap-url","test");
  kerberosEnvProps.put("container_dn","test");
  properties.put("kerberos-env",kerberosEnvProps);
  Map<String,String> krb5ConfProps=new HashMap<String,String>();
  krb5ConfProps.put("domains","test");
  properties.put("krb5-conf",krb5ConfProps);
  Map<String,String> tezSiteConfProps=new HashMap<String,String>();
  tezSiteConfProps.put("tez.tez-ui.history-url.base","test");
  properties.put("tez-site",tezSiteConfProps);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  hgComponents.add("SECONDARY_NAMENODE");
  hgComponents.add("RESOURCEMANAGER");
  TestHostGroup group1=new TestHostGroup("group1",hgComponents,Collections.singleton("testhost"));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("DATANODE");
  hgComponents2.add("HDFS_CLIENT");
  TestHostGroup group2=new TestHostGroup("group2",hgComponents2,Collections.singleton("testhost2"));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForBlueprintExport();
  assertEquals(properties.size(),3);
  assertEquals(((Map)properties.get("kerberos-env")).size(),0);
  assertEquals(((Map)properties.get("krb5-conf")).size(),0);
  assertEquals(((Map)properties.get("tez-site")).size(),0);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testHadoopWithRangerKmsServer() throws Exception {
  final String configType="core-site";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> configProperties=new HashMap<String,String>();
  properties.put(configType,configProperties);
  configProperties.put("hadoop.security.key.provider.path","kms://http@%HOSTGROUP::group1%;%HOSTGROUP::group2%:9292/kms");
  Map<String,Map<String,String>> parentProperties=new HashMap<String,Map<String,String>>();
  Configuration parentClusterConfig=new Configuration(parentProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap(),parentClusterConfig);
  Collection<String> kmsServerComponents=new HashSet<String>();
  kmsServerComponents.add("RANGER_KMS_SERVER");
  Collection<String> hdfsComponents=new HashSet<String>();
  hdfsComponents.add("NAMENODE");
  hdfsComponents.add("DATANODE");
  TestHostGroup group1=new TestHostGroup("group1",kmsServerComponents,Collections.singleton("host1"));
  group1.components.add("DATANODE");
  TestHostGroup group2=new TestHostGroup("group2",hdfsComponents,Collections.singleton("host2"));
  Collection<TestHostGroup> hostGroups=Lists.newArrayList(group1,group2);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor configProcessor=new BlueprintConfigurationProcessor(topology);
  configProcessor.doUpdateForClusterCreate();
  assertEquals("kms://http@host1;host2:9292/kms",clusterConfig.getPropertyValue(configType,"hadoop.security.key.provider.path"));
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
