<h3 style="margin:0px">Class: org.apache.ambari.server.upgrade.UpgradeCatalog210Test (17 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(8)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUpdateHBaseConfiguration() throws Exception {
  EasyMockSupport easyMockSupport=new EasyMockSupport();
  final AmbariManagementController mockAmbariManagementController=easyMockSupport.createNiceMock(AmbariManagementController.class);
  final ConfigHelper mockConfigHelper=easyMockSupport.createMock(ConfigHelper.class);
  final Clusters mockClusters=easyMockSupport.createStrictMock(Clusters.class);
  final Cluster mockClusterExpected=easyMockSupport.createNiceMock(Cluster.class);
  final Host mockHost=easyMockSupport.createNiceMock(Host.class);
  final Config mockHBaseSite=easyMockSupport.createNiceMock(Config.class);
  final Config mockHBaseEnv=easyMockSupport.createNiceMock(Config.class);
  final Map<String,String> propertiesExpectedHBaseSite=new HashMap<String,String>();
  propertiesExpectedHBaseSite.put("hbase.region.server.rpc.scheduler.factory.class","org.apache.phoenix.hbase.index.ipc.PhoenixIndexRpcSchedulerFactory");
  propertiesExpectedHBaseSite.put("hbase.security.authorization","true");
  final Map<String,String> propertiesExpectedHBaseEnv=new HashMap<String,String>();
  propertiesExpectedHBaseEnv.put("phoenix_sql_enabled","false");
  final Injector mockInjector=Guice.createInjector(new AbstractModule(){
    @Override protected void configure(){
      bind(AmbariManagementController.class).toInstance(mockAmbariManagementController);
      bind(ConfigHelper.class).toInstance(mockConfigHelper);
      bind(Clusters.class).toInstance(mockClusters);
      bind(DBAccessor.class).toInstance(createNiceMock(DBAccessor.class));
      bind(OsFamily.class).toInstance(createNiceMock(OsFamily.class));
    }
  }
);
  expect(mockAmbariManagementController.getClusters()).andReturn(mockClusters).once();
  expect(mockClusters.getClusters()).andReturn(new HashMap<String,Cluster>(){
{
      put("normal",mockClusterExpected);
    }
  }
).once();
  expect(mockClusterExpected.getDesiredConfigByType("hbase-site")).andReturn(mockHBaseSite).atLeastOnce();
  expect(mockClusterExpected.getDesiredConfigByType("hbase-env")).andReturn(mockHBaseEnv).atLeastOnce();
  expect(mockHBaseSite.getProperties()).andReturn(propertiesExpectedHBaseSite).anyTimes();
  expect(mockHBaseEnv.getProperties()).andReturn(propertiesExpectedHBaseEnv).anyTimes();
  Capture<String> configType=new Capture<String>();
  Capture<String> configTag=new Capture<String>();
  expect(mockClusterExpected.getConfig(capture(configType),capture(configTag))).andReturn(mockHBaseSite).atLeastOnce();
  easyMockSupport.replayAll();
  mockInjector.getInstance(UpgradeCatalog210.class).updateHBaseConfigs();
  easyMockSupport.verifyAll();
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUpdateStormConfiguration() throws Exception {
  EasyMockSupport easyMockSupport=new EasyMockSupport();
  final AmbariManagementController mockAmbariManagementController=easyMockSupport.createNiceMock(AmbariManagementController.class);
  final ConfigHelper mockConfigHelper=easyMockSupport.createMock(ConfigHelper.class);
  final Clusters mockClusters=easyMockSupport.createStrictMock(Clusters.class);
  final Cluster mockClusterExpected=easyMockSupport.createNiceMock(Cluster.class);
  final Config mockClusterEnv=easyMockSupport.createNiceMock(Config.class);
  final Config mockStormSite=easyMockSupport.createNiceMock(Config.class);
  final Map<String,String> propertiesExpectedClusterEnv=new HashMap<String,String>();
  propertiesExpectedClusterEnv.put("security_enabled","true");
  final Map<String,String> propertiesExpectedStormSite=new HashMap<String,String>();
  final Injector mockInjector=Guice.createInjector(new AbstractModule(){
    @Override protected void configure(){
      bind(AmbariManagementController.class).toInstance(mockAmbariManagementController);
      bind(ConfigHelper.class).toInstance(mockConfigHelper);
      bind(Clusters.class).toInstance(mockClusters);
      bind(DBAccessor.class).toInstance(createNiceMock(DBAccessor.class));
      bind(OsFamily.class).toInstance(createNiceMock(OsFamily.class));
    }
  }
);
  expect(mockAmbariManagementController.getClusters()).andReturn(mockClusters).once();
  expect(mockClusters.getClusters()).andReturn(new HashMap<String,Cluster>(){
{
      put("normal",mockClusterExpected);
    }
  }
).once();
  expect(mockClusterExpected.getDesiredConfigByType("cluster-env")).andReturn(mockClusterEnv).atLeastOnce();
  expect(mockClusterExpected.getDesiredConfigByType("storm-site")).andReturn(mockStormSite).atLeastOnce();
  expect(mockClusterEnv.getProperties()).andReturn(propertiesExpectedClusterEnv).anyTimes();
  expect(mockStormSite.getProperties()).andReturn(propertiesExpectedStormSite).anyTimes();
  easyMockSupport.replayAll();
  mockInjector.getInstance(UpgradeCatalog210.class).updateStormConfigs();
  easyMockSupport.verifyAll();
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testExecuteDMLUpdates() throws Exception {
  Method addNewConfigurationsFromXml=AbstractUpgradeCatalog.class.getDeclaredMethod("addNewConfigurationsFromXml");
  Method initializeClusterAndServiceWidgets=UpgradeCatalog210.class.getDeclaredMethod("initializeClusterAndServiceWidgets");
  Method addMissingConfigs=UpgradeCatalog210.class.getDeclaredMethod("addMissingConfigs");
  Method updateAlertDefinitions=UpgradeCatalog210.class.getDeclaredMethod("updateAlertDefinitions");
  Method removeStormRestApiServiceComponent=UpgradeCatalog210.class.getDeclaredMethod("removeStormRestApiServiceComponent");
  Method updateKerberosDescriptorArtifacts=AbstractUpgradeCatalog.class.getDeclaredMethod("updateKerberosDescriptorArtifacts");
  UpgradeCatalog210 upgradeCatalog210=createMockBuilder(UpgradeCatalog210.class).addMockedMethod(addNewConfigurationsFromXml).addMockedMethod(initializeClusterAndServiceWidgets).addMockedMethod(addMissingConfigs).addMockedMethod(updateAlertDefinitions).addMockedMethod(removeStormRestApiServiceComponent).addMockedMethod(updateKerberosDescriptorArtifacts).createMock();
  upgradeCatalog210.addNewConfigurationsFromXml();
  expectLastCall().once();
  upgradeCatalog210.initializeClusterAndServiceWidgets();
  expectLastCall().once();
  upgradeCatalog210.addMissingConfigs();
  expectLastCall().once();
  upgradeCatalog210.updateAlertDefinitions();
  expectLastCall().once();
  upgradeCatalog210.removeStormRestApiServiceComponent();
  expectLastCall().once();
  upgradeCatalog210.updateKerberosDescriptorArtifacts();
  expectLastCall().once();
  replay(upgradeCatalog210);
  upgradeCatalog210.executeDMLUpdates();
  verify(upgradeCatalog210);
}

</code></pre>

<pre class="type-4 type-2 type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testUpdateKerberosDescriptorArtifact_Simple() throws Exception {
  final KerberosDescriptorFactory kerberosDescriptorFactory=new KerberosDescriptorFactory();
  KerberosServiceDescriptor serviceDescriptor;
  URL systemResourceURL=ClassLoader.getSystemResource("kerberos/test_kerberos_descriptor_simple.json");
  assertNotNull(systemResourceURL);
  final KerberosDescriptor kerberosDescriptorOrig=kerberosDescriptorFactory.createInstance(new File(systemResourceURL.getFile()));
  assertNotNull(kerberosDescriptorOrig);
  assertNotNull(kerberosDescriptorOrig.getIdentity("hdfs"));
  serviceDescriptor=kerberosDescriptorOrig.getService("HDFS");
  assertNotNull(serviceDescriptor);
  assertNotNull(serviceDescriptor.getIdentity("/hdfs"));
  assertNull(serviceDescriptor.getIdentity("hdfs"));
  serviceDescriptor=kerberosDescriptorOrig.getService("OOZIE");
  assertNotNull(serviceDescriptor);
  assertNotNull(serviceDescriptor.getIdentity("/hdfs"));
  assertNull(serviceDescriptor.getIdentity("/HDFS/hdfs"));
  UpgradeCatalog210 upgradeMock=createMockBuilder(UpgradeCatalog210.class).createMock();
  Capture<Map<String,Object>> updatedData=new Capture<Map<String,Object>>();
  ArtifactEntity artifactEntity=createNiceMock(ArtifactEntity.class);
  expect(artifactEntity.getArtifactData()).andReturn(kerberosDescriptorOrig.toMap()).once();
  artifactEntity.setArtifactData(capture(updatedData));
  expectLastCall().once();
  replay(artifactEntity,upgradeMock);
  upgradeMock.updateKerberosDescriptorArtifact(createNiceMock(ArtifactDAO.class),artifactEntity);
  verify(artifactEntity,upgradeMock);
  KerberosDescriptor kerberosDescriptorUpdated=new KerberosDescriptorFactory().createInstance(updatedData.getValue());
  assertNotNull(kerberosDescriptorUpdated);
  assertNull(kerberosDescriptorUpdated.getIdentity("/hdfs"));
  serviceDescriptor=kerberosDescriptorUpdated.getService("HDFS");
  assertNotNull(serviceDescriptor);
  assertNull(serviceDescriptor.getIdentity("/hdfs"));
  assertNotNull(serviceDescriptor.getIdentity("hdfs"));
  serviceDescriptor=kerberosDescriptorUpdated.getService("OOZIE");
  assertNotNull(serviceDescriptor);
  assertNull(serviceDescriptor.getIdentity("/hdfs"));
  assertNotNull(serviceDescriptor.getIdentity("/HDFS/hdfs"));
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUpdateRangerHiveConfigs() throws Exception {
  EasyMockSupport easyMockSupport=new EasyMockSupport();
  final AmbariManagementController mockAmbariManagementController=easyMockSupport.createNiceMock(AmbariManagementController.class);
  final ConfigHelper mockConfigHelper=easyMockSupport.createMock(ConfigHelper.class);
  final Clusters mockClusters=easyMockSupport.createStrictMock(Clusters.class);
  final Cluster mockClusterExpected=easyMockSupport.createNiceMock(Cluster.class);
  final Config mockRangerPlugin=easyMockSupport.createNiceMock(Config.class);
  final Config mockHiveEnv=easyMockSupport.createNiceMock(Config.class);
  final Config mockHiveServer=easyMockSupport.createNiceMock(Config.class);
  final Map<String,String> propertiesExpectedRangerPlugin=new HashMap<String,String>();
  propertiesExpectedRangerPlugin.put("ranger-hive-plugin-enabled","yes");
  final Map<String,String> propertiesExpectedHiveEnv=new HashMap<String,String>();
  final Map<String,String> propertiesExpectedHiveServer2=new HashMap<String,String>();
  final Injector mockInjector=Guice.createInjector(new AbstractModule(){
    @Override protected void configure(){
      bind(AmbariManagementController.class).toInstance(mockAmbariManagementController);
      bind(ConfigHelper.class).toInstance(mockConfigHelper);
      bind(Clusters.class).toInstance(mockClusters);
      bind(DBAccessor.class).toInstance(createNiceMock(DBAccessor.class));
      bind(OsFamily.class).toInstance(createNiceMock(OsFamily.class));
    }
  }
);
  expect(mockAmbariManagementController.getClusters()).andReturn(mockClusters).once();
  expect(mockClusters.getClusters()).andReturn(new HashMap<String,Cluster>(){
{
      put("normal",mockClusterExpected);
    }
  }
).once();
  expect(mockClusterExpected.getDesiredConfigByType("ranger-hive-plugin-properties")).andReturn(mockRangerPlugin).atLeastOnce();
  expect(mockClusterExpected.getDesiredConfigByType("hive-env")).andReturn(mockHiveEnv).atLeastOnce();
  expect(mockClusterExpected.getDesiredConfigByType("hiveserver2-site")).andReturn(mockHiveServer).atLeastOnce();
  expect(mockRangerPlugin.getProperties()).andReturn(propertiesExpectedRangerPlugin).anyTimes();
  expect(mockHiveEnv.getProperties()).andReturn(propertiesExpectedHiveEnv).anyTimes();
  expect(mockHiveServer.getProperties()).andReturn(propertiesExpectedHiveServer2).anyTimes();
  ServiceConfigVersionResponse r=null;
  expect(mockClusterExpected.getConfig(anyObject(String.class),anyObject(String.class))).andReturn(mockHiveServer).anyTimes();
  expect(mockClusterExpected.addDesiredConfig("ambari-upgrade",Collections.singleton(mockHiveServer))).andReturn(r).times(3);
  easyMockSupport.replayAll();
  mockInjector.getInstance(UpgradeCatalog210.class).updateRangerHiveConfigs();
  easyMockSupport.verifyAll();
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUpdateHiveConfigs() throws Exception {
  EasyMockSupport easyMockSupport=new EasyMockSupport();
  final AmbariManagementController mockAmbariManagementController=easyMockSupport.createNiceMock(AmbariManagementController.class);
  final ConfigHelper mockConfigHelper=easyMockSupport.createMock(ConfigHelper.class);
  final Clusters mockClusters=easyMockSupport.createStrictMock(Clusters.class);
  final Cluster mockClusterExpected=easyMockSupport.createNiceMock(Cluster.class);
  final ServiceConfigVersionResponse mockServiceConfigVersionResponse=easyMockSupport.createNiceMock(ServiceConfigVersionResponse.class);
  final Config mockHiveEnv=easyMockSupport.createNiceMock(Config.class);
  final Config mockHiveServerSite=easyMockSupport.createNiceMock(Config.class);
  final Config mockHiveSite=easyMockSupport.createNiceMock(Config.class);
  final Map<String,String> propertiesExpectedHiveEnv=new HashMap<String,String>(){
{
      put("hive_security_authorization","none");
    }
  }
;
  final Map<String,String> propertiesExpectedHiveSite=new HashMap<String,String>(){
{
      put("hive.server2.authentication","pam");
      put("hive.server2.custom.authentication.class","");
    }
  }
;
  final Map<String,String> propertiesExpectedHiveServerSite=new HashMap<String,String>(){
{
      put("hive.security.authorization.manager","");
      put("hive.security.authenticator.manager","");
    }
  }
;
  final Map<String,Service> servicesExpected=new HashMap<String,Service>();
  final Injector mockInjector=Guice.createInjector(new AbstractModule(){
    @Override protected void configure(){
      bind(AmbariManagementController.class).toInstance(mockAmbariManagementController);
      bind(ConfigHelper.class).toInstance(mockConfigHelper);
      bind(Clusters.class).toInstance(mockClusters);
      bind(DBAccessor.class).toInstance(createNiceMock(DBAccessor.class));
      bind(OsFamily.class).toInstance(createNiceMock(OsFamily.class));
    }
  }
);
  expect(mockAmbariManagementController.getClusters()).andReturn(mockClusters).once();
  expect(mockClusters.getClusters()).andReturn(new HashMap<String,Cluster>(){
{
      put("normal",mockClusterExpected);
    }
  }
).once();
  Capture<String> configTypeEnv=new Capture<String>();
  Capture<String> configTypeSite=new Capture<String>();
  Capture<String> configTypeServerSite=new Capture<String>();
  expect(mockClusterExpected.getDesiredConfigByType("hive-env")).andReturn(mockHiveEnv).atLeastOnce();
  expect(mockClusterExpected.getDesiredConfigByType("hiveserver2-site")).andReturn(mockHiveServerSite).atLeastOnce();
  expect(mockHiveEnv.getProperties()).andReturn(propertiesExpectedHiveEnv).anyTimes();
  expect(mockHiveServerSite.getProperties()).andReturn(propertiesExpectedHiveServerSite).anyTimes();
  expect(mockClusterExpected.getConfig(capture(configTypeEnv),anyObject(String.class))).andReturn(mockHiveEnv).once();
  expect(mockClusterExpected.getConfig(capture(configTypeServerSite),anyObject(String.class))).andReturn(mockHiveServerSite).once();
  expect(mockClusterExpected.addDesiredConfig("ambari-upgrade",Collections.singleton(mockHiveEnv))).andReturn(mockServiceConfigVersionResponse).once();
  expect(mockClusterExpected.addDesiredConfig("ambari-upgrade",Collections.singleton(mockHiveServerSite))).andReturn(mockServiceConfigVersionResponse).once();
  expect(mockClusterExpected.getDesiredConfigByType("hive-site")).andReturn(mockHiveSite).atLeastOnce();
  expect(mockHiveSite.getProperties()).andReturn(propertiesExpectedHiveSite).anyTimes();
  expect(mockClusterExpected.getServices()).andReturn(servicesExpected).once();
  expect(mockClusterExpected.getConfig(capture(configTypeSite),anyObject(String.class))).andReturn(mockHiveSite).once();
  expect(mockClusterExpected.addDesiredConfig("ambari-upgrade",Collections.singleton(mockHiveSite))).andReturn(mockServiceConfigVersionResponse).once();
  easyMockSupport.replayAll();
  mockInjector.getInstance(UpgradeCatalog210.class).updateHiveConfigs();
  easyMockSupport.verifyAll();
  assertEquals("hive-env",configTypeEnv.getValue());
  assertEquals("hive-site",configTypeSite.getValue());
  assertEquals("hiveserver2-site",configTypeServerSite.getValue());
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testExecutePreDMLUpdates() throws Exception {
  Method executeStackPreDMLUpdates=UpgradeCatalog210.class.getDeclaredMethod("executeStackPreDMLUpdates");
  Method cleanupStackUpdates=UpgradeCatalog210.class.getDeclaredMethod("cleanupStackUpdates");
  final UpgradeCatalog210 upgradeCatalog210=createMockBuilder(UpgradeCatalog210.class).addMockedMethod(executeStackPreDMLUpdates).addMockedMethod(cleanupStackUpdates).createMock();
  final Injector mockInjector=Guice.createInjector(new AbstractModule(){
    @Override protected void configure(){
      bind(UpgradeCatalog210.class).toInstance(upgradeCatalog210);
      bind(DBAccessor.class).toInstance(createNiceMock(DBAccessor.class));
      bind(OsFamily.class).toInstance(createNiceMock(OsFamily.class));
    }
  }
);
  upgradeCatalog210.executeStackPreDMLUpdates();
  expectLastCall().once();
  replay(upgradeCatalog210);
  mockInjector.getInstance(UpgradeCatalog210.class).executePreDMLUpdates();
  verify(upgradeCatalog210);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testExecuteDDLUpdates() throws Exception {
  final DBAccessor dbAccessor=createNiceMock(DBAccessor.class);
  Configuration configuration=createNiceMock(Configuration.class);
  Connection connection=createNiceMock(Connection.class);
  Statement statement=createNiceMock(Statement.class);
  ResultSet resultSet=createNiceMock(ResultSet.class);
  expect(configuration.getDatabaseUrl()).andReturn(Configuration.JDBC_IN_MEMORY_URL).anyTimes();
  dbAccessor.getConnection();
  expectLastCall().andReturn(connection).anyTimes();
  connection.createStatement();
  expectLastCall().andReturn(statement).anyTimes();
  statement.executeQuery(anyObject(String.class));
  expectLastCall().andReturn(resultSet).anyTimes();
  AlertSectionDDL alertSectionDDL=new AlertSectionDDL();
  HostSectionDDL hostSectionDDL=new HostSectionDDL();
  WidgetSectionDDL widgetSectionDDL=new WidgetSectionDDL();
  ViewSectionDDL viewSectionDDL=new ViewSectionDDL();
  alertSectionDDL.execute(dbAccessor);
  hostSectionDDL.execute(dbAccessor);
  widgetSectionDDL.execute(dbAccessor);
  viewSectionDDL.execute(dbAccessor);
  replay(dbAccessor,configuration,resultSet,connection,statement);
  AbstractUpgradeCatalog upgradeCatalog=getUpgradeCatalog(dbAccessor);
  Class<?> c=AbstractUpgradeCatalog.class;
  Field f=c.getDeclaredField("configuration");
  f.setAccessible(true);
  f.set(upgradeCatalog,configuration);
  upgradeCatalog.executeDDLUpdates();
  verify(dbAccessor,configuration,resultSet,connection,statement);
  alertSectionDDL.verify(dbAccessor);
  hostSectionDDL.verify(dbAccessor);
  widgetSectionDDL.verify(dbAccessor);
  viewSectionDDL.verify(dbAccessor);
}

</code></pre>

<pre class="type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeleteStormRestApiServiceComponent() throws Exception {
  ClusterEntity clusterEntity=upgradeCatalogHelper.createCluster(injector,"c1",desiredStackEntity);
  ClusterServiceEntity clusterServiceEntity=upgradeCatalogHelper.createService(injector,clusterEntity,"STORM");
  HostEntity hostEntity=upgradeCatalogHelper.createHost(injector,clusterEntity,"h1");
  ClusterDAO clusterDAO=injector.getInstance(ClusterDAO.class);
  ClusterStateDAO clusterStateDAO=injector.getInstance(ClusterStateDAO.class);
  ClusterStateEntity clusterStateEntity=new ClusterStateEntity();
  clusterStateEntity.setClusterId(clusterEntity.getClusterId());
  clusterStateEntity.setClusterEntity(clusterEntity);
  clusterStateEntity.setCurrentStack(desiredStackEntity);
  clusterStateDAO.create(clusterStateEntity);
  clusterEntity.setClusterStateEntity(clusterStateEntity);
  clusterDAO.merge(clusterEntity);
  ServiceComponentDesiredStateEntity componentDesiredStateEntity=new ServiceComponentDesiredStateEntity();
  componentDesiredStateEntity.setClusterId(clusterEntity.getClusterId());
  componentDesiredStateEntity.setServiceName(clusterServiceEntity.getServiceName());
  componentDesiredStateEntity.setClusterServiceEntity(clusterServiceEntity);
  componentDesiredStateEntity.setComponentName("STORM_REST_API");
  componentDesiredStateEntity.setDesiredStack(desiredStackEntity);
  ServiceComponentDesiredStateDAO componentDesiredStateDAO=injector.getInstance(ServiceComponentDesiredStateDAO.class);
  componentDesiredStateDAO.create(componentDesiredStateEntity);
  HostComponentDesiredStateDAO hostComponentDesiredStateDAO=injector.getInstance(HostComponentDesiredStateDAO.class);
  HostComponentDesiredStateEntity hostComponentDesiredStateEntity=new HostComponentDesiredStateEntity();
  hostComponentDesiredStateEntity.setClusterId(clusterEntity.getClusterId());
  hostComponentDesiredStateEntity.setComponentName("STORM_REST_API");
  hostComponentDesiredStateEntity.setAdminState(HostComponentAdminState.INSERVICE);
  hostComponentDesiredStateEntity.setServiceName(clusterServiceEntity.getServiceName());
  hostComponentDesiredStateEntity.setServiceComponentDesiredStateEntity(componentDesiredStateEntity);
  hostComponentDesiredStateEntity.setHostEntity(hostEntity);
  hostComponentDesiredStateEntity.setDesiredStack(desiredStackEntity);
  hostComponentDesiredStateDAO.create(hostComponentDesiredStateEntity);
  HostComponentDesiredStateEntity entity=hostComponentDesiredStateDAO.findAll().get(0);
  Assert.assertEquals(HostComponentAdminState.INSERVICE.name(),entity.getAdminState().name());
  UpgradeCatalog210 upgradeCatalog210=injector.getInstance(UpgradeCatalog210.class);
  upgradeCatalog210.removeStormRestApiServiceComponent();
  ServiceComponentDesiredStateEntityPK entityPK=new ServiceComponentDesiredStateEntityPK();
  entityPK.setClusterId(clusterEntity.getClusterId());
  entityPK.setServiceName("STORM");
  entityPK.setComponentName("STORM_REST_API");
  Assert.assertNull(componentDesiredStateDAO.findByPK(entityPK));
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testInitializeClusterAndServiceWidgets() throws Exception {
  final AmbariManagementController controller=createStrictMock(AmbariManagementController.class);
  final Clusters clusters=createStrictMock(Clusters.class);
  final Cluster cluster=createStrictMock(Cluster.class);
  final Service service=createStrictMock(Service.class);
  final Map<String,Cluster> clusterMap=Collections.singletonMap("c1",cluster);
  final Map<String,Service> services=Collections.singletonMap("HBASE",service);
  Module module=new Module(){
    @Override public void configure(    Binder binder){
      binder.bind(AmbariManagementController.class).toInstance(controller);
      binder.bind(Clusters.class).toInstance(clusters);
      binder.bind(DBAccessor.class).toInstance(createNiceMock(DBAccessor.class));
      binder.bind(OsFamily.class).toInstance(createNiceMock(OsFamily.class));
    }
  }
;
  expect(controller.getClusters()).andReturn(clusters).anyTimes();
  expect(clusters.getClusters()).andReturn(clusterMap).anyTimes();
  controller.initializeWidgetsAndLayouts(cluster,null);
  expectLastCall().once();
  expect(cluster.getServices()).andReturn(services).once();
  controller.initializeWidgetsAndLayouts(cluster,service);
  expectLastCall().once();
  replay(controller,clusters,cluster);
  Injector injector=Guice.createInjector(module);
  injector.getInstance(UpgradeCatalog210.class).initializeClusterAndServiceWidgets();
  verify(controller,clusters,cluster);
}

</code></pre>

<pre class="type-4 type-2 type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testUpdateKerberosDescriptorArtifact_NoHDFSService() throws Exception {
  final KerberosDescriptorFactory kerberosDescriptorFactory=new KerberosDescriptorFactory();
  KerberosServiceDescriptor serviceDescriptor;
  URL systemResourceURL=ClassLoader.getSystemResource("kerberos/test_kerberos_descriptor_no_hdfs.json");
  assertNotNull(systemResourceURL);
  final KerberosDescriptor kerberosDescriptorOrig=kerberosDescriptorFactory.createInstance(new File(systemResourceURL.getFile()));
  assertNotNull(kerberosDescriptorOrig);
  assertNotNull(kerberosDescriptorOrig.getIdentity("hdfs"));
  serviceDescriptor=kerberosDescriptorOrig.getService("HDFS");
  assertNull(serviceDescriptor);
  serviceDescriptor=kerberosDescriptorOrig.getService("OOZIE");
  assertNotNull(serviceDescriptor);
  assertNotNull(serviceDescriptor.getIdentity("/hdfs"));
  assertNull(serviceDescriptor.getIdentity("/HDFS/hdfs"));
  UpgradeCatalog210 upgradeMock=createMockBuilder(UpgradeCatalog210.class).createMock();
  Capture<Map<String,Object>> updatedData=new Capture<Map<String,Object>>();
  ArtifactEntity artifactEntity=createNiceMock(ArtifactEntity.class);
  expect(artifactEntity.getArtifactData()).andReturn(kerberosDescriptorOrig.toMap()).once();
  artifactEntity.setArtifactData(capture(updatedData));
  expectLastCall().once();
  replay(artifactEntity,upgradeMock);
  upgradeMock.updateKerberosDescriptorArtifact(createNiceMock(ArtifactDAO.class),artifactEntity);
  verify(artifactEntity,upgradeMock);
  KerberosDescriptor kerberosDescriptorUpdated=new KerberosDescriptorFactory().createInstance(updatedData.getValue());
  assertNotNull(kerberosDescriptorUpdated);
  assertNull(kerberosDescriptorUpdated.getIdentity("/hdfs"));
  serviceDescriptor=kerberosDescriptorUpdated.getService("HDFS");
  assertNotNull(serviceDescriptor);
  assertNull(serviceDescriptor.getIdentity("/hdfs"));
  assertNotNull(serviceDescriptor.getIdentity("hdfs"));
  serviceDescriptor=kerberosDescriptorUpdated.getService("OOZIE");
  assertNotNull(serviceDescriptor);
  assertNull(serviceDescriptor.getIdentity("/hdfs"));
  assertNotNull(serviceDescriptor.getIdentity("/HDFS/hdfs"));
}

</code></pre>

<pre class="type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void init(){
  reset(entityManagerProvider);
  expect(entityManagerProvider.get()).andReturn(entityManager).anyTimes();
  replay(entityManagerProvider);
  injector=Guice.createInjector(new InMemoryDefaultTestModule());
  injector.getInstance(GuiceJpaInitializer.class);
  upgradeCatalogHelper=injector.getInstance(UpgradeCatalogHelper.class);
  injector.getInstance(AmbariMetaInfo.class);
  StackDAO stackDAO=injector.getInstance(StackDAO.class);
  desiredStackEntity=stackDAO.find("HDP","2.2.0");
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetTargetVersion() throws Exception {
  final DBAccessor dbAccessor=createNiceMock(DBAccessor.class);
  UpgradeCatalog upgradeCatalog=getUpgradeCatalog(dbAccessor);
  Assert.assertEquals("2.1.0",upgradeCatalog.getTargetVersion());
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetSourceVersion(){
  final DBAccessor dbAccessor=createNiceMock(DBAccessor.class);
  UpgradeCatalog upgradeCatalog=getUpgradeCatalog(dbAccessor);
  Assert.assertEquals("2.0.0",upgradeCatalog.getSourceVersion());
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void TestUpdateHiveEnvContent(){
  EasyMockSupport easyMockSupport=new EasyMockSupport();
  final AmbariManagementController mockAmbariManagementController=easyMockSupport.createNiceMock(AmbariManagementController.class);
  final ConfigHelper mockConfigHelper=easyMockSupport.createMock(ConfigHelper.class);
  final Clusters mockClusters=easyMockSupport.createStrictMock(Clusters.class);
  final Injector mockInjector=Guice.createInjector(new AbstractModule(){
    @Override protected void configure(){
      bind(AmbariManagementController.class).toInstance(mockAmbariManagementController);
      bind(ConfigHelper.class).toInstance(mockConfigHelper);
      bind(Clusters.class).toInstance(mockClusters);
      bind(DBAccessor.class).toInstance(createNiceMock(DBAccessor.class));
      bind(OsFamily.class).toInstance(createNiceMock(OsFamily.class));
    }
  }
);
  String content="# Start HIVE_AUX_JARS_PATH \n" + "if [ \"${HIVE_AUX_JARS_PATH}\" != \"\" ]; then\n" + "  export HIVE_AUX_JARS_PATH=${HIVE_AUX_JARS_PATH}\n"+ "elif [ -d \"/usr/hdp/current/hive-webhcat/share/hcatalog\" ]; then \n"+ "  export HIVE_AUX_JARS_PATH=/usr/hdp/current/hive-webhcat/share/hcatalog\n"+ "fi\n"+ "#End HIVE_AUX_JARS_PATH";
  String expectedContent="# Start HIVE_AUX_JARS_PATH \n" + "if [ \"${HIVE_AUX_JARS_PATH}\" != \"\" ]; then\n" + "  if [ -f \"${HIVE_AUX_JARS_PATH}\" ]; then    \n"+ "    export HIVE_AUX_JARS_PATH=${HIVE_AUX_JARS_PATH}\n"+ "  elif [ -d \"/usr/hdp/current/hive-webhcat/share/hcatalog\" ]; then\n"+ "    export HIVE_AUX_JARS_PATH=/usr/hdp/current/hive-webhcat/share/hcatalog/hive-hcatalog-core.jar\n"+ "  fi\n"+ "elif [ -d \"/usr/hdp/current/hive-webhcat/share/hcatalog\" ]; then\n"+ "  export HIVE_AUX_JARS_PATH=/usr/hdp/current/hive-webhcat/share/hcatalog/hive-hcatalog-core.jar\n"+ "fi\n"+ "#End HIVE_AUX_JARS_PATH";
  String modifiedContent=mockInjector.getInstance(UpgradeCatalog210.class).updateHiveEnvContent(content);
  Assert.assertEquals(modifiedContent,expectedContent);
}

</code></pre>

<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void tearDown(){
  injector.getInstance(PersistService.class).stop();
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUpdateHDFSConfiguration() throws Exception {
  EasyMockSupport easyMockSupport=new EasyMockSupport();
  final AmbariManagementController mockAmbariManagementController=easyMockSupport.createNiceMock(AmbariManagementController.class);
  final ConfigHelper mockConfigHelper=easyMockSupport.createMock(ConfigHelper.class);
  final Clusters mockClusters=easyMockSupport.createStrictMock(Clusters.class);
  final Cluster mockClusterExpected=easyMockSupport.createNiceMock(Cluster.class);
  final Config mockHdfsSite=easyMockSupport.createNiceMock(Config.class);
  final Config mockCoreSite=easyMockSupport.createStrictMock(Config.class);
  final Map<String,String> propertiesExpectedHdfs=new HashMap<String,String>();
  final Map<String,String> propertiesExpectedCoreSite=new HashMap<String,String>();
  propertiesExpectedCoreSite.put("fs.defaultFS","hdfs://EXAMPLE.COM:8020");
  final Injector mockInjector=Guice.createInjector(new AbstractModule(){
    @Override protected void configure(){
      bind(AmbariManagementController.class).toInstance(mockAmbariManagementController);
      bind(ConfigHelper.class).toInstance(mockConfigHelper);
      bind(Clusters.class).toInstance(mockClusters);
      bind(DBAccessor.class).toInstance(createNiceMock(DBAccessor.class));
      bind(OsFamily.class).toInstance(createNiceMock(OsFamily.class));
    }
  }
);
  expect(mockAmbariManagementController.getClusters()).andReturn(mockClusters).once();
  expect(mockClusters.getClusters()).andReturn(new HashMap<String,Cluster>(){
{
      put("normal",mockClusterExpected);
    }
  }
).once();
  expect(mockClusterExpected.getDesiredConfigByType("hadoop-env")).andReturn(null).once();
  expect(mockClusterExpected.getDesiredConfigByType("hdfs-site")).andReturn(mockHdfsSite).atLeastOnce();
  expect(mockClusterExpected.getHosts("HDFS","NAMENODE")).andReturn(new HashSet<String>(){
{
      add("host1");
    }
  }
).atLeastOnce();
  expect(mockHdfsSite.getProperties()).andReturn(propertiesExpectedHdfs).anyTimes();
  expect(mockClusterExpected.getDesiredConfigByType("core-site")).andReturn(mockCoreSite).anyTimes();
  expect(mockCoreSite.getProperties()).andReturn(propertiesExpectedCoreSite).anyTimes();
  easyMockSupport.replayAll();
  mockInjector.getInstance(UpgradeCatalog210.class).updateHdfsConfigs();
  easyMockSupport.verifyAll();
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
