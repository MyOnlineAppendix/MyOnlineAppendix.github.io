<h3 style="margin:0px">Class: org.apache.ambari.server.upgrade.UpgradeCatalog200Test (11 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(4)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void tearDown(){
  injector.getInstance(PersistService.class).stop();
}

</code></pre>

<pre class="type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExecuteDDLUpdates() throws Exception {
  final DBAccessor dbAccessor=createNiceMock(DBAccessor.class);
  Configuration configuration=createNiceMock(Configuration.class);
  Connection connection=createNiceMock(Connection.class);
  Statement statement=createNiceMock(Statement.class);
  ResultSet resultSet=createNiceMock(ResultSet.class);
  expect(configuration.getDatabaseUrl()).andReturn(Configuration.JDBC_IN_MEMORY_URL).anyTimes();
  Capture<DBAccessor.DBColumnInfo> alertDefinitionIgnoreColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> alertDefinitionDescriptionColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> alertTargetGlobalColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> hostComponentStateColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> hostComponentVersionColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> clustersSecurityTypeColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> hostComponentStateSecurityStateColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> hostComponentDesiredStateSecurityStateColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> hostRoleCommandRetryColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> stageSkippableColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> viewparameterLabelColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> viewparameterPlaceholderColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> viewparameterDefaultValueColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> serviceDesiredStateSecurityStateColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<List<DBAccessor.DBColumnInfo>> clusterVersionCapture=new Capture<List<DBAccessor.DBColumnInfo>>();
  Capture<List<DBAccessor.DBColumnInfo>> hostVersionCapture=new Capture<List<DBAccessor.DBColumnInfo>>();
  Capture<DBAccessor.DBColumnInfo> valueColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> dataValueColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<List<DBAccessor.DBColumnInfo>> alertTargetStatesCapture=new Capture<List<DBAccessor.DBColumnInfo>>();
  Capture<List<DBAccessor.DBColumnInfo>> artifactCapture=new Capture<List<DBAccessor.DBColumnInfo>>();
  Capture<List<DBAccessor.DBColumnInfo>> kerberosPrincipalCapture=new Capture<List<DBAccessor.DBColumnInfo>>();
  Capture<List<DBAccessor.DBColumnInfo>> kerberosPrincipalHostCapture=new Capture<List<DBAccessor.DBColumnInfo>>();
  Capture<List<DBAccessor.DBColumnInfo>> upgradeCapture=new Capture<List<DBAccessor.DBColumnInfo>>();
  Capture<List<DBAccessor.DBColumnInfo>> upgradeGroupCapture=new Capture<List<DBAccessor.DBColumnInfo>>();
  Capture<List<DBAccessor.DBColumnInfo>> upgradeItemCapture=new Capture<List<DBAccessor.DBColumnInfo>>();
  dbAccessor.addColumn(eq("alert_definition"),capture(alertDefinitionIgnoreColumnCapture));
  dbAccessor.addColumn(eq("alert_definition"),capture(alertDefinitionDescriptionColumnCapture));
  dbAccessor.createTable(eq("alert_target_states"),capture(alertTargetStatesCapture));
  dbAccessor.addColumn(eq("alert_target"),capture(alertTargetGlobalColumnCapture));
  dbAccessor.addColumn(eq("hostcomponentstate"),capture(hostComponentStateColumnCapture));
  dbAccessor.addColumn(eq("hostcomponentstate"),capture(hostComponentVersionColumnCapture));
  dbAccessor.addColumn(eq("host_role_command"),capture(hostRoleCommandRetryColumnCapture));
  dbAccessor.addColumn(eq("stage"),capture(stageSkippableColumnCapture));
  dbAccessor.addColumn(eq("clusters"),capture(clustersSecurityTypeColumnCapture));
  dbAccessor.addColumn(eq("hostcomponentstate"),capture(hostComponentStateSecurityStateColumnCapture));
  dbAccessor.addColumn(eq("hostcomponentdesiredstate"),capture(hostComponentDesiredStateSecurityStateColumnCapture));
  dbAccessor.addColumn(eq("viewparameter"),capture(viewparameterLabelColumnCapture));
  dbAccessor.addColumn(eq("viewparameter"),capture(viewparameterPlaceholderColumnCapture));
  dbAccessor.addColumn(eq("viewparameter"),capture(viewparameterDefaultValueColumnCapture));
  dbAccessor.addColumn(eq("servicedesiredstate"),capture(serviceDesiredStateSecurityStateColumnCapture));
  dbAccessor.createTable(eq("cluster_version"),capture(clusterVersionCapture),eq("id"));
  dbAccessor.createTable(eq("host_version"),capture(hostVersionCapture),eq("id"));
  dbAccessor.createTable(eq("upgrade"),capture(upgradeCapture),eq("upgrade_id"));
  dbAccessor.createTable(eq("upgrade_group"),capture(upgradeGroupCapture),eq("upgrade_group_id"));
  dbAccessor.createTable(eq("upgrade_item"),capture(upgradeItemCapture),eq("upgrade_item_id"));
  dbAccessor.createTable(eq("artifact"),capture(artifactCapture),eq("artifact_name"),eq("foreign_keys"));
  dbAccessor.createTable(eq("kerberos_principal"),capture(kerberosPrincipalCapture),eq("principal_name"));
  dbAccessor.createTable(eq("kerberos_principal_host"),capture(kerberosPrincipalHostCapture),eq("principal_name"),eq("host_name"));
  expect(dbAccessor.tableHasColumn("kerberos_principal_host","host_name")).andReturn(true).atLeastOnce();
  dbAccessor.addFKConstraint(eq("kerberos_principal_host"),eq("FK_krb_pr_host_hostname"),eq("host_name"),eq("hosts"),eq("host_name"),eq(true),eq(false));
  dbAccessor.addFKConstraint(eq("kerberos_principal_host"),eq("FK_krb_pr_host_principalname"),eq("principal_name"),eq("kerberos_principal"),eq("principal_name"),eq(true),eq(false));
  setViewInstancePropertyExpectations(dbAccessor,valueColumnCapture);
  setViewInstanceDataExpectations(dbAccessor,dataValueColumnCapture);
  dbAccessor.getConnection();
  expectLastCall().andReturn(connection).anyTimes();
  connection.createStatement();
  expectLastCall().andReturn(statement).anyTimes();
  statement.executeQuery(anyObject(String.class));
  expectLastCall().andReturn(resultSet).anyTimes();
  replay(dbAccessor,configuration,resultSet,statement,connection);
  AbstractUpgradeCatalog upgradeCatalog=getUpgradeCatalog(dbAccessor);
  Class<?> c=AbstractUpgradeCatalog.class;
  Field f=c.getDeclaredField("configuration");
  f.setAccessible(true);
  f.set(upgradeCatalog,configuration);
  upgradeCatalog.executeDDLUpdates();
  verify(dbAccessor,configuration,resultSet,statement,connection);
  verifyAlertDefinitionIgnoreColumn(alertDefinitionIgnoreColumnCapture);
  verifyAlertDefinitionDescriptionColumn(alertDefinitionDescriptionColumnCapture);
  verifyAlertTargetGlobal(alertTargetGlobalColumnCapture);
  verifyAlertTargetStatesTable(alertTargetStatesCapture);
  DBAccessor.DBColumnInfo upgradeStateColumn=hostComponentStateColumnCapture.getValue();
  assertEquals("upgrade_state",upgradeStateColumn.getName());
  assertEquals(32,(int)upgradeStateColumn.getLength());
  assertEquals(String.class,upgradeStateColumn.getType());
  assertEquals("NONE",upgradeStateColumn.getDefaultValue());
  assertFalse(upgradeStateColumn.isNullable());
  DBAccessor.DBColumnInfo upgradeVersionColumn=hostComponentVersionColumnCapture.getValue();
  assertEquals("version",upgradeVersionColumn.getName());
  assertEquals(32,(int)upgradeVersionColumn.getLength());
  assertEquals(String.class,upgradeVersionColumn.getType());
  assertEquals("UNKNOWN",upgradeVersionColumn.getDefaultValue());
  assertFalse(upgradeVersionColumn.isNullable());
  DBAccessor.DBColumnInfo upgradeRetryColumn=hostRoleCommandRetryColumnCapture.getValue();
  assertEquals("retry_allowed",upgradeRetryColumn.getName());
  assertEquals(1,(int)upgradeRetryColumn.getLength());
  assertEquals(Integer.class,upgradeRetryColumn.getType());
  assertEquals(0,upgradeRetryColumn.getDefaultValue());
  assertFalse(upgradeRetryColumn.isNullable());
  DBAccessor.DBColumnInfo upgradeSkippableColumn=stageSkippableColumnCapture.getValue();
  assertEquals("skippable",upgradeSkippableColumn.getName());
  assertEquals(1,(int)upgradeSkippableColumn.getLength());
  assertEquals(Integer.class,upgradeSkippableColumn.getType());
  assertEquals(0,upgradeSkippableColumn.getDefaultValue());
  assertFalse(upgradeSkippableColumn.isNullable());
  verifyClustersSecurityType(clustersSecurityTypeColumnCapture);
  verifyComponentSecurityStateColumn(hostComponentStateSecurityStateColumnCapture);
  verifyComponentSecurityStateColumn(hostComponentDesiredStateSecurityStateColumnCapture);
  verifyServiceSecurityStateColumn(serviceDesiredStateSecurityStateColumnCapture);
  verifyViewParameterColumns(viewparameterLabelColumnCapture,viewparameterPlaceholderColumnCapture,viewparameterDefaultValueColumnCapture);
  List<DBAccessor.DBColumnInfo> artifactColumns=artifactCapture.getValue();
  testCreateArtifactTable(artifactColumns);
  testCreateKerberosPrincipalTable(kerberosPrincipalCapture.getValue());
  testCreateKerberosPrincipalHostTable(kerberosPrincipalHostCapture.getValue());
  assertEquals(7,clusterVersionCapture.getValue().size());
  assertEquals(4,hostVersionCapture.getValue().size());
  assertViewInstancePropertyColumns(valueColumnCapture);
  assertViewInstanceDataColumns(dataValueColumnCapture);
  assertEquals(6,upgradeCapture.getValue().size());
  assertEquals(4,upgradeGroupCapture.getValue().size());
  assertEquals(7,upgradeItemCapture.getValue().size());
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testPersistHDPRepo() throws Exception {
  EasyMockSupport easyMockSupport=new EasyMockSupport();
  final AmbariManagementController mockAmbariManagementController=easyMockSupport.createStrictMock(AmbariManagementController.class);
  final AmbariMetaInfo mockAmbariMetaInfo=easyMockSupport.createNiceMock(AmbariMetaInfo.class);
  final StackInfo mockStackInfo=easyMockSupport.createNiceMock(StackInfo.class);
  final Clusters mockClusters=easyMockSupport.createStrictMock(Clusters.class);
  final Cluster mockCluster=easyMockSupport.createStrictMock(Cluster.class);
  final Map<String,Cluster> clusterMap=new HashMap<String,Cluster>();
  clusterMap.put("c1",mockCluster);
  OperatingSystemInfo osi=new OperatingSystemInfo("redhat6");
  HashSet<OperatingSystemInfo> osiSet=new HashSet<OperatingSystemInfo>();
  osiSet.add(osi);
  StackId stackId=new StackId("HDP","2.2");
  final RepositoryInfo mockRepositoryInfo=easyMockSupport.createNiceMock(RepositoryInfo.class);
  final Injector mockInjector=Guice.createInjector(new AbstractModule(){
    @Override protected void configure(){
      bind(AmbariManagementController.class).toInstance(mockAmbariManagementController);
      bind(Clusters.class).toInstance(mockClusters);
      bind(DBAccessor.class).toInstance(createNiceMock(DBAccessor.class));
      bind(EntityManager.class).toInstance(createNiceMock(EntityManager.class));
      bind(OsFamily.class).toInstance(createNiceMock(OsFamily.class));
    }
  }
);
  expect(mockAmbariManagementController.getAmbariMetaInfo()).andReturn(mockAmbariMetaInfo);
  expect(mockAmbariManagementController.getClusters()).andReturn(mockClusters).once();
  expect(mockClusters.getClusters()).andReturn(clusterMap).once();
  expect(mockCluster.getCurrentStackVersion()).andReturn(stackId).once();
  expect(mockCluster.getClusterName()).andReturn("cc").anyTimes();
  expect(mockAmbariMetaInfo.getOperatingSystems("HDP","2.2")).andReturn(osiSet).once();
  expect(mockAmbariMetaInfo.getRepository("HDP","2.2","redhat6","HDP-2.2")).andReturn(mockRepositoryInfo).once();
  expect(mockAmbariMetaInfo.getStack("HDP","2.2")).andReturn(mockStackInfo);
  expect(mockStackInfo.getRepositories()).andReturn(new ArrayList<RepositoryInfo>(){
{
      add(mockRepositoryInfo);
    }
  }
);
  expect(mockRepositoryInfo.getDefaultBaseUrl()).andReturn("http://baseurl").once();
  mockAmbariMetaInfo.updateRepoBaseURL("HDP","2.2","redhat6","HDP-2.2","http://baseurl");
  expectLastCall().once();
  easyMockSupport.replayAll();
  mockInjector.getInstance(UpgradeCatalog200.class).persistHDPRepo();
  easyMockSupport.verifyAll();
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetTargetVersion() throws Exception {
  final DBAccessor dbAccessor=createNiceMock(DBAccessor.class);
  UpgradeCatalog upgradeCatalog=getUpgradeCatalog(dbAccessor);
  Assert.assertEquals("2.0.0",upgradeCatalog.getTargetVersion());
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRepositoryTable(){
  final RepositoryInfo repositoryInfo1=new RepositoryInfo();
  repositoryInfo1.setOsType("redhat6");
  repositoryInfo1.setRepoId("HDP-2.2");
  repositoryInfo1.setBaseUrl("http://public-repo-1.hortonworks.com/HDP/centos6/2.x/updates/2.2.6.0");
  final RepositoryInfo repositoryInfo2=new RepositoryInfo();
  repositoryInfo2.setOsType("suse11");
  repositoryInfo2.setRepoId("HDP-UTILS-1.1.0.20");
  repositoryInfo2.setBaseUrl("http://public-repo-1.hortonworks.com/HDP-UTILS-1.1.0.20/repos/suse11sp3");
  List<RepositoryInfo> repos=new ArrayList<RepositoryInfo>(){
{
      add(repositoryInfo1);
      add(repositoryInfo2);
    }
  }
;
  String output=UpgradeCatalog200.repositoryTable(repos);
  assertEquals("  redhat6 |            HDP-2.2 | http://public-repo-1.hortonworks.com/HDP/centos6/2.x/updates/2.2.6.0 \n" + "   suse11 | HDP-UTILS-1.1.0.20 | http://public-repo-1.hortonworks.com/HDP-UTILS-1.1.0.20/repos/suse11sp3 \n",output);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUpdateFlumeEnvConfig() throws AmbariException {
  EasyMockSupport easyMockSupport=new EasyMockSupport();
  final AmbariManagementController mockAmbariManagementController=easyMockSupport.createNiceMock(AmbariManagementController.class);
  final Clusters mockClusters=easyMockSupport.createStrictMock(Clusters.class);
  final Cluster mockClusterExpected=easyMockSupport.createNiceMock(Cluster.class);
  final Map<String,String> propertiesFlumeEnv=new HashMap<String,String>(){
{
      put("content","test");
    }
  }
;
  final Config mockFlumeEnv=easyMockSupport.createNiceMock(Config.class);
  expect(mockFlumeEnv.getProperties()).andReturn(propertiesFlumeEnv).once();
  final Injector mockInjector=Guice.createInjector(new AbstractModule(){
    @Override protected void configure(){
      bind(AmbariManagementController.class).toInstance(mockAmbariManagementController);
      bind(Clusters.class).toInstance(mockClusters);
      bind(EntityManager.class).toInstance(entityManager);
      bind(DBAccessor.class).toInstance(createNiceMock(DBAccessor.class));
      bind(OsFamily.class).toInstance(createNiceMock(OsFamily.class));
    }
  }
);
  expect(mockAmbariManagementController.getClusters()).andReturn(mockClusters).once();
  expect(mockClusters.getClusters()).andReturn(new HashMap<String,Cluster>(){
{
      put("normal",mockClusterExpected);
    }
  }
).atLeastOnce();
  expect(mockClusterExpected.getDesiredConfigByType("flume-env")).andReturn(mockFlumeEnv).atLeastOnce();
  expect(mockFlumeEnv.getProperties()).andReturn(propertiesFlumeEnv).atLeastOnce();
  easyMockSupport.replayAll();
  mockInjector.getInstance(UpgradeCatalog200.class).updateFlumeEnvConfig();
  easyMockSupport.verifyAll();
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetSourceVersion(){
  final DBAccessor dbAccessor=createNiceMock(DBAccessor.class);
  UpgradeCatalog upgradeCatalog=getUpgradeCatalog(dbAccessor);
  Assert.assertEquals("1.7.0",upgradeCatalog.getSourceVersion());
}

</code></pre>

<pre class="type-2 type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
/** 
 * Tests that Nagios is correctly removed.
 * @throws Exception
 */
@Test public void testDeleteNagiosService() throws Exception {
  UpgradeCatalog200 upgradeCatalog200=injector.getInstance(UpgradeCatalog200.class);
  ServiceComponentDesiredStateDAO serviceComponentDesiredStateDAO=injector.getInstance(ServiceComponentDesiredStateDAO.class);
  HostComponentDesiredStateDAO hostComponentDesiredStateDAO=injector.getInstance(HostComponentDesiredStateDAO.class);
  HostComponentStateDAO hostComponentStateDAO=injector.getInstance(HostComponentStateDAO.class);
  ClusterServiceDAO clusterServiceDao=injector.getInstance(ClusterServiceDAO.class);
  StackDAO stackDAO=injector.getInstance(StackDAO.class);
  injector.getInstance(AmbariMetaInfo.class);
  StackEntity stackEntity=stackDAO.find(DESIRED_STACK.getStackName(),DESIRED_STACK.getStackVersion());
  assertNotNull(stackEntity);
  final ClusterEntity clusterEntity=upgradeCatalogHelper.createCluster(injector,CLUSTER_NAME,stackEntity);
  final ClusterServiceEntity clusterServiceEntityNagios=upgradeCatalogHelper.addService(injector,clusterEntity,"NAGIOS",stackEntity);
  final HostEntity hostEntity=upgradeCatalogHelper.createHost(injector,clusterEntity,HOST_NAME);
  upgradeCatalogHelper.addComponent(injector,clusterEntity,clusterServiceEntityNagios,hostEntity,"NAGIOS_SERVER",stackEntity);
  ServiceComponentDesiredStateEntityPK pkNagiosServer=new ServiceComponentDesiredStateEntityPK();
  pkNagiosServer.setComponentName("NAGIOS_SERVER");
  pkNagiosServer.setClusterId(clusterEntity.getClusterId());
  pkNagiosServer.setServiceName("NAGIOS");
  ServiceComponentDesiredStateEntity serviceComponentDesiredStateEntity=serviceComponentDesiredStateDAO.findByPK(pkNagiosServer);
  assertNotNull(serviceComponentDesiredStateEntity);
  HostComponentDesiredStateEntityPK hcDesiredStateEntityPk=new HostComponentDesiredStateEntityPK();
  hcDesiredStateEntityPk.setServiceName("NAGIOS");
  hcDesiredStateEntityPk.setClusterId(clusterEntity.getClusterId());
  hcDesiredStateEntityPk.setComponentName("NAGIOS_SERVER");
  hcDesiredStateEntityPk.setHostId(hostEntity.getHostId());
  HostComponentDesiredStateEntity hcDesiredStateEntity=hostComponentDesiredStateDAO.findByPK(hcDesiredStateEntityPk);
  assertNotNull(hcDesiredStateEntity);
  HostComponentStateEntity hcStateEntity=hostComponentStateDAO.findByIndex(clusterEntity.getClusterId(),"NAGIOS","NAGIOS_SERVER",hostEntity.getHostId());
  assertNotNull(hcStateEntity);
  ClusterServiceEntity clusterService=clusterServiceDao.findByClusterAndServiceNames(CLUSTER_NAME,"NAGIOS");
  upgradeCatalog200.removeNagiosService();
  clusterService=clusterServiceDao.findByClusterAndServiceNames(CLUSTER_NAME,"NAGIOS");
  assertNull(clusterService);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUpdateClusterEnvConfiguration() throws Exception {
  EasyMockSupport easyMockSupport=new EasyMockSupport();
  final AmbariManagementController mockAmbariManagementController=easyMockSupport.createStrictMock(AmbariManagementController.class);
  final ConfigHelper mockConfigHelper=easyMockSupport.createMock(ConfigHelper.class);
  final Clusters mockClusters=easyMockSupport.createStrictMock(Clusters.class);
  final Cluster mockClusterExpected=easyMockSupport.createStrictMock(Cluster.class);
  final Cluster mockClusterMissingSmokeUser=easyMockSupport.createStrictMock(Cluster.class);
  final Cluster mockClusterMissingConfig=easyMockSupport.createStrictMock(Cluster.class);
  final Config mockClusterEnvExpected=easyMockSupport.createStrictMock(Config.class);
  final Config mockClusterEnvMissingSmokeUser=easyMockSupport.createStrictMock(Config.class);
  final Map<String,String> propertiesExpectedT0=new HashMap<String,String>();
  propertiesExpectedT0.put("kerberos_domain","EXAMPLE.COM");
  propertiesExpectedT0.put("user_group","hadoop");
  propertiesExpectedT0.put("kinit_path_local","/usr/bin");
  propertiesExpectedT0.put("security_enabled","true");
  propertiesExpectedT0.put("smokeuser","ambari-qa");
  propertiesExpectedT0.put("smokeuser_keytab","/etc/security/keytabs/smokeuser.headless.keytab");
  propertiesExpectedT0.put("ignore_groupsusers_create","false");
  final Map<String,String> propertiesExpectedT1=new HashMap<String,String>(propertiesExpectedT0);
  propertiesExpectedT1.put("smokeuser_principal_name","ambari-qa");
  final Map<String,String> propertiesMissingSmokeUserT0=new HashMap<String,String>(propertiesExpectedT0);
  propertiesMissingSmokeUserT0.remove("smokeuser");
  final Map<String,String> propertiesMissingSmokeUserT1=new HashMap<String,String>(propertiesMissingSmokeUserT0);
  propertiesMissingSmokeUserT1.put("smokeuser_principal_name","ambari-qa");
  final PropertyInfo mockSmokeUserPropertyInfo=easyMockSupport.createStrictMock(PropertyInfo.class);
  final Injector mockInjector=Guice.createInjector(new AbstractModule(){
    @Override protected void configure(){
      bind(AmbariManagementController.class).toInstance(mockAmbariManagementController);
      bind(ConfigHelper.class).toInstance(mockConfigHelper);
      bind(Clusters.class).toInstance(mockClusters);
      bind(DBAccessor.class).toInstance(createNiceMock(DBAccessor.class));
      bind(OsFamily.class).toInstance(createNiceMock(OsFamily.class));
    }
  }
);
  expect(mockAmbariManagementController.getClusters()).andReturn(mockClusters).once();
  expect(mockClusters.getClusters()).andReturn(new HashMap<String,Cluster>(){
{
      put("normal",mockClusterExpected);
      put("missing_smokeuser",mockClusterMissingSmokeUser);
      put("missing_cluster-env",mockClusterMissingConfig);
    }
  }
).once();
  expect(mockClusterExpected.getDesiredConfigByType("cluster-env")).andReturn(mockClusterEnvExpected).once();
  expect(mockClusterEnvExpected.getProperties()).andReturn(propertiesExpectedT0).once();
  mockConfigHelper.createConfigType(mockClusterExpected,mockAmbariManagementController,"cluster-env",propertiesExpectedT1,UpgradeCatalog200.AUTHENTICATED_USER_NAME,"Upgrading to Ambari 2.0");
  expectLastCall().once();
  expect(mockClusterMissingSmokeUser.getDesiredConfigByType("cluster-env")).andReturn(mockClusterEnvMissingSmokeUser).once();
  expect(mockClusterEnvMissingSmokeUser.getProperties()).andReturn(propertiesMissingSmokeUserT0).once();
  expect(mockConfigHelper.getStackProperties(mockClusterMissingSmokeUser)).andReturn(Collections.singleton(mockSmokeUserPropertyInfo)).once();
  expect(mockSmokeUserPropertyInfo.getFilename()).andReturn("cluster-env.xml").once();
  expect(mockSmokeUserPropertyInfo.getValue()).andReturn("ambari-qa").once();
  mockConfigHelper.createConfigType(mockClusterMissingSmokeUser,mockAmbariManagementController,"cluster-env",propertiesMissingSmokeUserT1,UpgradeCatalog200.AUTHENTICATED_USER_NAME,"Upgrading to Ambari 2.0");
  expectLastCall().once();
  expect(mockClusterMissingConfig.getDesiredConfigByType("cluster-env")).andReturn(null).once();
  easyMockSupport.replayAll();
  mockInjector.getInstance(UpgradeCatalog200.class).updateClusterEnvConfiguration();
  easyMockSupport.verifyAll();
}

</code></pre>

<pre class="type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void init(){
  reset(entityManagerProvider);
  expect(entityManagerProvider.get()).andReturn(entityManager).anyTimes();
  replay(entityManagerProvider);
  injector=Guice.createInjector(new InMemoryDefaultTestModule());
  injector.getInstance(GuiceJpaInitializer.class);
  upgradeCatalogHelper=injector.getInstance(UpgradeCatalogHelper.class);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Tests that each DML method is invoked.
 * @throws Exception
 */
@Test public void testExecuteDMLUpdates() throws Exception {
  Method removeNagiosService=UpgradeCatalog200.class.getDeclaredMethod("removeNagiosService");
  Method updateHiveDatabaseType=UpgradeCatalog200.class.getDeclaredMethod("updateHiveDatabaseType");
  Method addNewConfigurationsFromXml=AbstractUpgradeCatalog.class.getDeclaredMethod("addNewConfigurationsFromXml");
  Method updateTezConfiguration=UpgradeCatalog200.class.getDeclaredMethod("updateTezConfiguration");
  Method updateFlumeEnvConfig=UpgradeCatalog200.class.getDeclaredMethod("updateFlumeEnvConfig");
  Method updateClusterEnvConfiguration=UpgradeCatalog200.class.getDeclaredMethod("updateClusterEnvConfiguration");
  Method updateConfigurationProperties=AbstractUpgradeCatalog.class.getDeclaredMethod("updateConfigurationProperties",String.class,Map.class,boolean.class,boolean.class);
  Method persistHDPRepo=UpgradeCatalog200.class.getDeclaredMethod("persistHDPRepo");
  UpgradeCatalog200 upgradeCatalog=createMockBuilder(UpgradeCatalog200.class).addMockedMethod(removeNagiosService).addMockedMethod(updateHiveDatabaseType).addMockedMethod(addNewConfigurationsFromXml).addMockedMethod(updateTezConfiguration).addMockedMethod(updateFlumeEnvConfig).addMockedMethod(updateConfigurationProperties).addMockedMethod(updateClusterEnvConfiguration).addMockedMethod(persistHDPRepo).createMock();
  upgradeCatalog.removeNagiosService();
  expectLastCall().once();
  upgradeCatalog.addNewConfigurationsFromXml();
  expectLastCall();
  upgradeCatalog.updateHiveDatabaseType();
  expectLastCall().once();
  upgradeCatalog.updateTezConfiguration();
  expectLastCall().once();
  upgradeCatalog.updateFlumeEnvConfig();
  expectLastCall().once();
  upgradeCatalog.updateConfigurationProperties("hive-site",Collections.singletonMap("hive.server2.transport.mode","binary"),false,false);
  expectLastCall();
  upgradeCatalog.persistHDPRepo();
  expectLastCall().once();
  upgradeCatalog.updateClusterEnvConfiguration();
  expectLastCall();
  replay(upgradeCatalog);
  upgradeCatalog.executeDMLUpdates();
  verify(upgradeCatalog);
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
