<h3 style="margin:0px">Class: org.apache.ambari.server.controller.internal.ArtifactResourceProviderTest (6 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void setUp() throws Exception {
  reset(dao,em,controller,request,clusters,cluster,entity,entity2);
  resourceProvider=new ArtifactResourceProvider(controller);
  setPrivateField(resourceProvider,"artifactDAO",dao);
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCreateResource() throws Exception {
  Capture<ArtifactEntity> createEntityCapture=new Capture<ArtifactEntity>();
  Map<String,Object> outerMap=new TreeMap<String,Object>();
  Map<String,Object> childMap=new TreeMap<String,Object>();
  outerMap.put("child",childMap);
  childMap.put("childKey","childValue");
  Map<String,Object> child2Map=new TreeMap<String,Object>();
  childMap.put("child2",child2Map);
  child2Map.put("child2Key","child2Value");
  Map<String,Object> child3Map=new TreeMap<String,Object>();
  child2Map.put("child3",child3Map);
  Map<String,Object> child4Map=new TreeMap<String,Object>();
  child3Map.put("child4",child4Map);
  child4Map.put("child4Key","child4Value");
  Set<Map<String,Object>> propertySet=new HashSet<Map<String,Object>>();
  propertySet.add(outerMap);
  propertySet.add(child4Map);
  Map<String,Object> artifact_data=new TreeMap<String,Object>();
  artifact_data.put("foo","bar");
  artifact_data.put("child",childMap);
  artifact_data.put("collection",propertySet);
  TreeMap<String,String> foreignKeys=new TreeMap<String,String>();
  foreignKeys.put("cluster","500");
  Map<String,String> requestInfoProps=new HashMap<String,String>();
  requestInfoProps.put(Request.REQUEST_INFO_BODY_PROPERTY,bodyJson);
  Map<String,Object> properties=new HashMap<String,Object>();
  properties.put("Artifacts/artifact_name","test-artifact");
  properties.put("Artifacts/cluster_name","test-cluster");
  properties.put("artifact_data/foo","bar");
  properties.put("artifact_data/child/childKey","childValue");
  properties.put("artifact_data/child/child2/child2Key","child2Value");
  properties.put("artifact_data/child/child2/child3/child4/child4Key","child4Value");
  Collection collectionProperties=new HashSet();
  properties.put("artifact_data/collection",collectionProperties);
  Map<String,Object> map1=new TreeMap<String,Object>();
  collectionProperties.add(map1);
  map1.put("foo","bar");
  map1.put("child/childKey","childValue");
  map1.put("child/child2/child2Key","child2Value");
  map1.put("child/child2/child3/child4/child4Key","child4Value");
  Map<String,Object> map2=new TreeMap<String,Object>();
  collectionProperties.add(map2);
  map2.put("child4Key","child4Value");
  Set<Map<String,Object>> requestProperties=Collections.singleton(properties);
  expect(request.getRequestInfoProperties()).andReturn(requestInfoProps).anyTimes();
  expect(request.getProperties()).andReturn(requestProperties).anyTimes();
  expect(controller.getClusters()).andReturn(clusters).anyTimes();
  expect(clusters.getCluster("test-cluster")).andReturn(cluster).anyTimes();
  expect(clusters.getClusterById(500L)).andReturn(cluster).anyTimes();
  expect(cluster.getClusterId()).andReturn(500L).anyTimes();
  expect(cluster.getClusterName()).andReturn("test-cluster").anyTimes();
  expect(dao.findByNameAndForeignKeys(eq("test-artifact"),eq(foreignKeys))).andReturn(null).once();
  dao.create(capture(createEntityCapture));
  replay(dao,em,controller,request,clusters,cluster,entity,entity2);
  resourceProvider.createResources(request);
  ArtifactEntity createEntity=createEntityCapture.getValue();
  assertEquals("test-artifact",createEntity.getArtifactName());
  Map<String,Object> actualArtifactData=createEntity.getArtifactData();
  assertEquals(artifact_data.size(),actualArtifactData.size());
  assertEquals(artifact_data.get("foo"),actualArtifactData.get("foo"));
  assertEquals(artifact_data.get("child"),actualArtifactData.get("child"));
  assertEquals(artifact_data.get("collection"),new HashSet(((Collection)actualArtifactData.get("collection"))));
  assertEquals(foreignKeys,createEntity.getForeignKeys());
}

</code></pre>

<pre class="type-13 type-10 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetResources_collection() throws Exception {
  Set<String> propertyIds=new HashSet<String>();
  TreeMap<String,String> foreignKeys=new TreeMap<String,String>();
  foreignKeys.put("cluster","500");
  List<ArtifactEntity> entities=new ArrayList<ArtifactEntity>();
  entities.add(entity);
  entities.add(entity2);
  Map<String,Object> artifact_data=Collections.<String,Object>singletonMap("foo","bar");
  Map<String,Object> artifact_data2=Collections.<String,Object>singletonMap("foo2","bar2");
  Map<String,String> responseForeignKeys=new HashMap<String,String>();
  responseForeignKeys.put("cluster","500");
  expect(controller.getClusters()).andReturn(clusters).anyTimes();
  expect(clusters.getCluster("test-cluster")).andReturn(cluster).anyTimes();
  expect(clusters.getClusterById(500L)).andReturn(cluster).anyTimes();
  expect(cluster.getClusterId()).andReturn(500L).anyTimes();
  expect(cluster.getClusterName()).andReturn("test-cluster").anyTimes();
  expect(request.getPropertyIds()).andReturn(propertyIds).anyTimes();
  expect(dao.findByForeignKeys(eq(foreignKeys))).andReturn(entities).anyTimes();
  expect(entity.getArtifactName()).andReturn("test-artifact").anyTimes();
  expect(entity.getForeignKeys()).andReturn(responseForeignKeys).anyTimes();
  expect(entity.getArtifactData()).andReturn(artifact_data).anyTimes();
  expect(entity2.getArtifactName()).andReturn("test-artifact2").anyTimes();
  expect(entity2.getForeignKeys()).andReturn(responseForeignKeys).anyTimes();
  expect(entity2.getArtifactData()).andReturn(artifact_data2).anyTimes();
  replay(dao,em,controller,request,clusters,cluster,entity,entity2);
  PredicateBuilder pb=new PredicateBuilder();
  Predicate predicate=pb.begin().property("Artifacts/cluster_name").equals("test-cluster").end().toPredicate();
  Set<Resource> response=resourceProvider.getResources(request,predicate);
  assertEquals(2,response.size());
  boolean artifact1Returned=false;
  boolean artifact2Returned=false;
  for (  Resource resource : response) {
    if (resource.getPropertyValue("Artifacts/artifact_name").equals("test-artifact")) {
      artifact1Returned=true;
      assertEquals("bar",resource.getPropertyValue("artifact_data/foo"));
      assertEquals("test-cluster",resource.getPropertyValue("Artifacts/cluster_name"));
    }
 else     if (resource.getPropertyValue("Artifacts/artifact_name").equals("test-artifact2")) {
      artifact2Returned=true;
      assertEquals("bar2",resource.getPropertyValue("artifact_data/foo2"));
      assertEquals("test-cluster",resource.getPropertyValue("Artifacts/cluster_name"));
    }
 else {
      fail("unexpected artifact name");
    }
  }
  assertTrue(artifact1Returned);
  assertTrue(artifact2Returned);
}

</code></pre>

<pre class="type-4 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetResources_instance() throws Exception {
  Set<String> propertyIds=new HashSet<String>();
  TreeMap<String,String> foreignKeys=new TreeMap<String,String>();
  foreignKeys.put("cluster","500");
  Map<String,Object> childMap=new TreeMap<String,Object>();
  childMap.put("childKey","childValue");
  Map<String,Object> child2Map=new TreeMap<String,Object>();
  childMap.put("child2",child2Map);
  child2Map.put("child2Key","child2Value");
  Map<String,Object> child3Map=new TreeMap<String,Object>();
  child2Map.put("child3",child3Map);
  Map<String,Object> child4Map=new TreeMap<String,Object>();
  child3Map.put("child4",child4Map);
  child4Map.put("child4Key","child4Value");
  Map<String,Object> artifact_data=new TreeMap<String,Object>();
  artifact_data.put("foo","bar");
  artifact_data.put("child",childMap);
  Map<String,String> responseForeignKeys=new HashMap<String,String>();
  responseForeignKeys.put("cluster","500");
  expect(controller.getClusters()).andReturn(clusters).anyTimes();
  expect(clusters.getCluster("test-cluster")).andReturn(cluster).anyTimes();
  expect(clusters.getClusterById(500L)).andReturn(cluster).anyTimes();
  expect(cluster.getClusterId()).andReturn(500L).anyTimes();
  expect(cluster.getClusterName()).andReturn("test-cluster").anyTimes();
  expect(request.getPropertyIds()).andReturn(propertyIds).anyTimes();
  expect(dao.findByNameAndForeignKeys(eq("test-artifact"),eq(foreignKeys))).andReturn(entity).once();
  expect(entity.getArtifactName()).andReturn("test-artifact").anyTimes();
  expect(entity.getForeignKeys()).andReturn(responseForeignKeys).anyTimes();
  expect(entity.getArtifactData()).andReturn(artifact_data).anyTimes();
  replay(dao,em,controller,request,clusters,cluster,entity,entity2);
  PredicateBuilder pb=new PredicateBuilder();
  Predicate predicate=pb.begin().property("Artifacts/cluster_name").equals("test-cluster").and().property("Artifacts/artifact_name").equals("test-artifact").end().toPredicate();
  Set<Resource> response=resourceProvider.getResources(request,predicate);
  assertEquals(1,response.size());
  Resource resource=response.iterator().next();
  Map<String,Map<String,Object>> responseProperties=resource.getPropertiesMap();
  assertEquals(5,responseProperties.size());
  Map<String,Object> artifactDataMap=responseProperties.get("artifact_data");
  assertEquals("bar",artifactDataMap.get("foo"));
  assertEquals("test-artifact",resource.getPropertyValue("Artifacts/artifact_name"));
  assertEquals("test-cluster",resource.getPropertyValue("Artifacts/cluster_name"));
  assertEquals("bar",resource.getPropertyValue("artifact_data/foo"));
  assertEquals("childValue",resource.getPropertyValue("artifact_data/child/childKey"));
  assertEquals("child2Value",resource.getPropertyValue("artifact_data/child/child2/child2Key"));
  assertEquals("child4Value",resource.getPropertyValue("artifact_data/child/child2/child3/child4/child4Key"));
}

</code></pre>

<pre class="type-13 type-10 type-2 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeleteResources() throws Exception {
  Capture<ArtifactEntity> deleteEntityCapture=new Capture<ArtifactEntity>();
  Capture<ArtifactEntity> deleteEntityCapture2=new Capture<ArtifactEntity>();
  TreeMap<String,String> foreignKeys=new TreeMap<String,String>();
  foreignKeys.put("cluster","500");
  List<ArtifactEntity> entities=new ArrayList<ArtifactEntity>();
  entities.add(entity);
  entities.add(entity2);
  Map<String,Object> artifact_data=Collections.<String,Object>singletonMap("foo","bar");
  Map<String,Object> artifact_data2=Collections.<String,Object>singletonMap("foo2","bar2");
  Map<String,String> responseForeignKeys=new HashMap<String,String>();
  responseForeignKeys.put("cluster","500");
  expect(controller.getClusters()).andReturn(clusters).anyTimes();
  expect(clusters.getCluster("test-cluster")).andReturn(cluster).anyTimes();
  expect(clusters.getClusterById(500L)).andReturn(cluster).anyTimes();
  expect(cluster.getClusterId()).andReturn(500L).anyTimes();
  expect(cluster.getClusterName()).andReturn("test-cluster").anyTimes();
  expect(entity.getArtifactName()).andReturn("test-artifact").anyTimes();
  expect(entity.getForeignKeys()).andReturn(responseForeignKeys).anyTimes();
  expect(entity.getArtifactData()).andReturn(artifact_data).anyTimes();
  expect(entity2.getArtifactName()).andReturn("test-artifact2").anyTimes();
  expect(entity2.getForeignKeys()).andReturn(responseForeignKeys).anyTimes();
  expect(entity2.getArtifactData()).andReturn(artifact_data2).anyTimes();
  expect(dao.findByForeignKeys(eq(foreignKeys))).andReturn(entities).once();
  expect(dao.findByNameAndForeignKeys(eq("test-artifact"),eq(foreignKeys))).andReturn(entity).once();
  dao.remove(capture(deleteEntityCapture));
  expect(dao.findByNameAndForeignKeys(eq("test-artifact2"),eq(foreignKeys))).andReturn(entity2).once();
  dao.remove(capture(deleteEntityCapture2));
  replay(dao,em,controller,request,clusters,cluster,entity,entity2);
  PredicateBuilder pb=new PredicateBuilder();
  Predicate predicate=pb.begin().property("Artifacts/cluster_name").equals("test-cluster").end().toPredicate();
  RequestStatus response=resourceProvider.deleteResources(predicate);
  ArtifactEntity deleteEntity=deleteEntityCapture.getValue();
  ArtifactEntity deleteEntity2=deleteEntityCapture2.getValue();
  if (deleteEntity.getArtifactName().equals("test-artifact")) {
    assertEquals("test-artifact2",deleteEntity2.getArtifactName());
  }
 else   if (deleteEntity.getArtifactName().equals("test-artifact2")) {
    assertEquals("test-artifact",deleteEntity2.getArtifactName());
  }
 else {
    fail("Unexpected artifact name: " + deleteEntity.getArtifactName());
  }
  assertEquals(foreignKeys,deleteEntity.getForeignKeys());
  assertEquals(foreignKeys,deleteEntity2.getForeignKeys());
  assertEquals(RequestStatus.Status.Complete,response.getStatus());
  verify(dao,em,controller,request,clusters,cluster,entity,entity2);
}

</code></pre>

<pre class="type-13 type-10 type-2 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpdateResources() throws Exception {
  Map<String,String> requestInfoProps=new HashMap<String,String>();
  requestInfoProps.put(Request.REQUEST_INFO_BODY_PROPERTY,bodyJson);
  Capture<ArtifactEntity> updateEntityCapture=new Capture<ArtifactEntity>();
  Capture<ArtifactEntity> updateEntityCapture2=new Capture<ArtifactEntity>();
  Set<String> propertyIds=new HashSet<String>();
  TreeMap<String,String> foreignKeys=new TreeMap<String,String>();
  foreignKeys.put("cluster","500");
  List<ArtifactEntity> entities=new ArrayList<ArtifactEntity>();
  entities.add(entity);
  entities.add(entity2);
  Map<String,Object> artifact_data=Collections.<String,Object>singletonMap("foo","bar");
  Map<String,Object> artifact_data2=Collections.<String,Object>singletonMap("foo2","bar2");
  Map<String,String> responseForeignKeys=new HashMap<String,String>();
  responseForeignKeys.put("cluster","500");
  Map<String,Object> properties=new HashMap<String,Object>();
  properties.put("Artifacts/artifact_name","test-artifact");
  properties.put("Artifacts/cluster_name","test-cluster");
  properties.put("artifact_data/foo","bar");
  properties.put("artifact_data/child/childKey","childValue");
  properties.put("artifact_data/child/child2/child2Key","child2Value");
  properties.put("artifact_data/child/child2/child3/child4/child4Key","child4Value");
  Set<Map<String,Object>> requestProperties=Collections.singleton(properties);
  Collection collectionProperties=new HashSet();
  properties.put("artifact_data/collection",collectionProperties);
  expect(request.getProperties()).andReturn(requestProperties).anyTimes();
  expect(request.getRequestInfoProperties()).andReturn(requestInfoProps).anyTimes();
  expect(controller.getClusters()).andReturn(clusters).anyTimes();
  expect(clusters.getCluster("test-cluster")).andReturn(cluster).anyTimes();
  expect(clusters.getClusterById(500L)).andReturn(cluster).anyTimes();
  expect(cluster.getClusterId()).andReturn(500L).anyTimes();
  expect(cluster.getClusterName()).andReturn("test-cluster").anyTimes();
  expect(request.getPropertyIds()).andReturn(propertyIds).anyTimes();
  expect(dao.findByForeignKeys(eq(foreignKeys))).andReturn(entities).anyTimes();
  expect(entity.getArtifactName()).andReturn("test-artifact").anyTimes();
  expect(entity.getForeignKeys()).andReturn(responseForeignKeys).anyTimes();
  expect(entity.getArtifactData()).andReturn(artifact_data).anyTimes();
  expect(entity2.getArtifactName()).andReturn("test-artifact2").anyTimes();
  expect(entity2.getForeignKeys()).andReturn(responseForeignKeys).anyTimes();
  expect(entity2.getArtifactData()).andReturn(artifact_data2).anyTimes();
  expect(dao.merge(capture(updateEntityCapture))).andReturn(entity).once();
  expect(dao.merge(capture(updateEntityCapture2))).andReturn(entity2).once();
  replay(dao,em,controller,request,clusters,cluster,entity,entity2);
  PredicateBuilder pb=new PredicateBuilder();
  Predicate predicate=pb.begin().property("Artifacts/cluster_name").equals("test-cluster").end().toPredicate();
  RequestStatus response=resourceProvider.updateResources(request,predicate);
  ArtifactEntity updateEntity=updateEntityCapture.getValue();
  ArtifactEntity updateEntity2=updateEntityCapture2.getValue();
  Gson serializer=new Gson();
  ArtifactEntity expected=new ArtifactEntity();
  expected.setArtifactData((Map<String,Object>)serializer.<Map<String,Object>>fromJson(bodyJson,Map.class).get("artifact_data"));
  assertEquals(expected.getArtifactData(),updateEntity.getArtifactData());
  assertEquals(expected.getArtifactData(),updateEntity2.getArtifactData());
  if (updateEntity.getArtifactName().equals("test-artifact")) {
    assertEquals("test-artifact2",updateEntity2.getArtifactName());
  }
 else   if (updateEntity.getArtifactName().equals("test-artifact2")) {
    assertEquals("test-artifact",updateEntity2.getArtifactName());
  }
 else {
    fail("Unexpected artifact name: " + updateEntity.getArtifactName());
  }
  assertEquals(foreignKeys,updateEntity.getForeignKeys());
  assertEquals(foreignKeys,updateEntity2.getForeignKeys());
  assertEquals(RequestStatus.Status.Complete,response.getStatus());
  verify(dao,em,controller,request,clusters,cluster,entity,entity2);
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
