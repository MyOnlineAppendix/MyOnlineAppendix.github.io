<h3 style="margin:0px">Class: org.apache.ambari.server.state.ConfigHelperTest.RunWithInMemoryDefaultTestModule (15 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(13)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(12)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(11)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(10)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(9)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(9)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-4 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCloneAttributesMap() throws Exception {
  Map<String,Map<String,String>> targetAttributesMap=new HashMap<String,Map<String,String>>();
  Map<String,String> attributesValues=new HashMap<String,String>();
  attributesValues.put("a","1");
  attributesValues.put("b","2");
  attributesValues.put("f","3");
  attributesValues.put("q","4");
  targetAttributesMap.put("attr",attributesValues);
  Map<String,Map<String,String>> sourceAttributesMap=new HashMap<String,Map<String,String>>();
  attributesValues=new HashMap<String,String>();
  attributesValues.put("a","5");
  attributesValues.put("f","6");
  sourceAttributesMap.put("attr",attributesValues);
  attributesValues=new HashMap<String,String>();
  attributesValues.put("f","7");
  attributesValues.put("q","8");
  sourceAttributesMap.put("attr1",attributesValues);
  configHelper.cloneAttributesMap(sourceAttributesMap,targetAttributesMap);
  Assert.assertEquals(2,targetAttributesMap.size());
  Assert.assertTrue(targetAttributesMap.containsKey("attr"));
  Assert.assertTrue(targetAttributesMap.containsKey("attr1"));
  Map<String,String> attributes=targetAttributesMap.get("attr");
  Assert.assertEquals(4,attributes.size());
  Assert.assertEquals("5",attributes.get("a"));
  Assert.assertEquals("2",attributes.get("b"));
  Assert.assertEquals("6",attributes.get("f"));
  Assert.assertEquals("4",attributes.get("q"));
  attributes=targetAttributesMap.get("attr1");
  Assert.assertEquals(2,attributes.size());
  Assert.assertEquals("7",attributes.get("f"));
  Assert.assertEquals("8",attributes.get("q"));
}

</code></pre>

<pre class="type-4 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCloneAttributesMapSourceIsNull() throws Exception {
  Map<String,Map<String,String>> targetAttributesMap=new HashMap<String,Map<String,String>>();
  Map<String,String> attributesValues=new HashMap<String,String>();
  attributesValues.put("a","1");
  attributesValues.put("b","2");
  attributesValues.put("f","3");
  attributesValues.put("q","4");
  targetAttributesMap.put("attr",attributesValues);
  Map<String,Map<String,String>> sourceAttributesMap=null;
  configHelper.cloneAttributesMap(sourceAttributesMap,targetAttributesMap);
  Assert.assertEquals(1,targetAttributesMap.size());
  Assert.assertTrue(targetAttributesMap.containsKey("attr"));
  Map<String,String> attributes=targetAttributesMap.get("attr");
  Assert.assertEquals(4,attributes.size());
  Assert.assertEquals("1",attributes.get("a"));
  Assert.assertEquals("2",attributes.get("b"));
  Assert.assertEquals("3",attributes.get("f"));
  Assert.assertEquals("4",attributes.get("q"));
}

</code></pre>

<pre class="type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpdateConfigTypeNoPropertyAttributes() throws Exception {
  Config currentConfig=cluster.getDesiredConfigByType("oozie-site");
  Map<String,String> properties=currentConfig.getProperties();
  Assert.assertEquals("version1",currentConfig.getTag());
  Assert.assertEquals("simple",properties.get("oozie.authentication.type"));
  Assert.assertEquals("false",properties.get("oozie.service.HadoopAccessorService.kerberos.enabled"));
  Map<String,String> updates=new HashMap<String,String>();
  updates.put("oozie.authentication.type","kerberos");
  updates.put("oozie.service.HadoopAccessorService.kerberos.enabled","true");
  configHelper.updateConfigType(cluster,managementController,"oozie-site",updates,null,"admin","Test " + "note");
  Config updatedConfig=cluster.getDesiredConfigByType("oozie-site");
  Assert.assertFalse("version1".equals(updatedConfig.getTag()));
  properties=updatedConfig.getProperties();
  Assert.assertTrue(properties.containsKey("oozie.authentication.type"));
  Assert.assertEquals("kerberos",properties.get("oozie.authentication.type"));
  Assert.assertTrue(properties.containsKey("oozie.service.HadoopAccessorService.kerberos.enabled"));
  Assert.assertEquals("true",properties.get("oozie.service.HadoopAccessorService.kerberos.enabled"));
}

</code></pre>

<pre class="type-4 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCloneAttributesMapTargetIsNull() throws Exception {
  Map<String,Map<String,String>> targetAttributesMap=null;
  Map<String,Map<String,String>> sourceAttributesMap=new HashMap<String,Map<String,String>>();
  Map<String,String> attributesValues=new HashMap<String,String>();
  attributesValues.put("a","5");
  attributesValues.put("f","6");
  sourceAttributesMap.put("attr",attributesValues);
  attributesValues=new HashMap<String,String>();
  attributesValues.put("f","7");
  attributesValues.put("q","8");
  sourceAttributesMap.put("attr1",attributesValues);
  configHelper.cloneAttributesMap(sourceAttributesMap,targetAttributesMap);
  Assert.assertEquals(2,sourceAttributesMap.size());
  Assert.assertTrue(sourceAttributesMap.containsKey("attr"));
  Assert.assertTrue(sourceAttributesMap.containsKey("attr1"));
  Map<String,String> attributes=sourceAttributesMap.get("attr");
  Assert.assertEquals(2,attributes.size());
  Assert.assertEquals("5",attributes.get("a"));
  Assert.assertEquals("6",attributes.get("f"));
  attributes=sourceAttributesMap.get("attr1");
  Assert.assertEquals(2,attributes.size());
  Assert.assertEquals("7",attributes.get("f"));
  Assert.assertEquals("8",attributes.get("q"));
}

</code></pre>

<pre class="type-4 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEffectivePropertiesWithOverrides() throws Exception {
  final Config config1=new ConfigImpl("core-site");
  config1.setTag("version122");
  Map<String,String> properties=new HashMap<String,String>();
  properties.put("a","b");
  properties.put("c","d");
  config1.setProperties(properties);
  final Config config2=new ConfigImpl("global");
  config2.setTag("version122");
  Map<String,String> properties2=new HashMap<String,String>();
  properties2.put("namenode_heapsize","1111");
  config2.setProperties(properties2);
  Long groupId=addConfigGroup("g1","t1",new ArrayList<String>(){
{
      add("h1");
    }
  }
,new ArrayList<Config>(){
{
      add(config1);
      add(config2);
    }
  }
);
  Assert.assertNotNull(groupId);
  Map<String,Map<String,String>> propertyMap=configHelper.getEffectiveConfigProperties(cluster,configHelper.getEffectiveDesiredTags(cluster,"h1"));
  Assert.assertNotNull(propertyMap);
  Assert.assertTrue(propertyMap.containsKey("global"));
  Map<String,String> globalProps=propertyMap.get("global");
  Assert.assertEquals("1111",globalProps.get("namenode_heapsize"));
  Assert.assertEquals("/hadoop/hdfs/namenode",globalProps.get("dfs_namenode_name_dir"));
  Assert.assertTrue(propertyMap.containsKey("core-site"));
  Map<String,String> coreProps=propertyMap.get("core-site");
  Assert.assertTrue(coreProps.containsKey("a"));
  Assert.assertTrue(coreProps.containsKey("c"));
  Assert.assertEquals("30",coreProps.get("ipc.client.connect.max.retries"));
}

</code></pre>

<pre class="type-2 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testCalculateIsStaleConfigs() throws Exception {
  Map<String,HostConfig> schReturn=new HashMap<String,HostConfig>();
  HostConfig hc=new HostConfig();
  hc.setDefaultVersionTag("version2");
  schReturn.put("flume-conf",hc);
  ServiceComponentHost sch=createNiceMock(ServiceComponentHost.class);
  expect(sch.getActualConfigs()).andReturn(schReturn).times(6);
  expect(sch.getHostName()).andReturn("h1").anyTimes();
  expect(sch.getClusterId()).andReturn(1l).anyTimes();
  expect(sch.getServiceName()).andReturn("FLUME").anyTimes();
  expect(sch.getServiceComponentName()).andReturn("FLUME_HANDLER").anyTimes();
  replay(sch);
  Assert.assertTrue(configHelper.isStaleConfigs(sch));
  HostConfig hc2=new HostConfig();
  hc2.setDefaultVersionTag("version1");
  schReturn.put("flume-conf",hc2);
  configHelper.invalidateStaleConfigsCache();
  Assert.assertFalse(configHelper.isStaleConfigs(sch));
  List<String> hosts=new ArrayList<String>();
  hosts.add("h1");
  List<Config> configs=new ArrayList<Config>();
  ConfigImpl configImpl=new ConfigImpl("flume-conf");
  configImpl.setTag("FLUME1");
  configs.add(configImpl);
  addConfigGroup("configGroup1","FLUME",hosts,configs);
  Assert.assertTrue(configHelper.isStaleConfigs(sch));
  HostConfig hc3=new HostConfig();
  hc3.setDefaultVersionTag("version1");
  hc3.getConfigGroupOverrides().put(1l,"FLUME1");
  schReturn.put("flume-conf",hc3);
  configHelper.invalidateStaleConfigsCache();
  Assert.assertFalse(configHelper.isStaleConfigs(sch));
  HostConfig hc4=new HostConfig();
  hc4.setDefaultVersionTag("version1");
  hc4.getConfigGroupOverrides().put(1l,"FLUME2");
  schReturn.put("flume-conf",hc4);
  configHelper.invalidateStaleConfigsCache();
  Assert.assertTrue(configHelper.isStaleConfigs(sch));
  HostConfig hc5=new HostConfig();
  hc5.setDefaultVersionTag("version3");
  hc5.getConfigGroupOverrides().put(1l,"FLUME1");
  schReturn.put("flume-conf",hc5);
  configHelper.invalidateStaleConfigsCache();
  Assert.assertTrue(configHelper.isStaleConfigs(sch));
  verify(sch);
}

</code></pre>

<pre class="type-4 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEffectivePropertiesAttributesWithOverrides() throws Exception {
  final Config config1=new ConfigImpl("core-site");
  config1.setTag("version122");
  Map<String,String> attributes=new HashMap<String,String>();
  attributes.put("fs.trash.interval","11");
  attributes.put("b","y");
  Map<String,Map<String,String>> config1Attributes=new HashMap<String,Map<String,String>>();
  config1Attributes.put("attribute1",attributes);
  config1.setPropertiesAttributes(config1Attributes);
  final Config config2=new ConfigImpl("global");
  config2.setTag("version122");
  attributes=new HashMap<String,String>();
  attributes.put("namenode_heapsize","z");
  attributes.put("c","q");
  Map<String,Map<String,String>> config2Attributes=new HashMap<String,Map<String,String>>();
  config2Attributes.put("attribute2",attributes);
  config2.setPropertiesAttributes(config2Attributes);
  Long groupId=addConfigGroup("g1","t1",new ArrayList<String>(){
{
      add("h1");
    }
  }
,new ArrayList<Config>(){
{
      add(config1);
      add(config2);
    }
  }
);
  Assert.assertNotNull(groupId);
  Map<String,Map<String,Map<String,String>>> effectiveAttributes=configHelper.getEffectiveConfigAttributes(cluster,configHelper.getEffectiveDesiredTags(cluster,"h1"));
  Assert.assertNotNull(effectiveAttributes);
  Assert.assertEquals(4,effectiveAttributes.size());
  Assert.assertTrue(effectiveAttributes.containsKey("global"));
  Map<String,Map<String,String>> globalAttrs=effectiveAttributes.get("global");
  Assert.assertEquals(1,globalAttrs.size());
  Assert.assertTrue(globalAttrs.containsKey("attribute2"));
  Map<String,String> attribute2Occurances=globalAttrs.get("attribute2");
  Assert.assertEquals(3,attribute2Occurances.size());
  Assert.assertTrue(attribute2Occurances.containsKey("namenode_heapsize"));
  Assert.assertEquals("z",attribute2Occurances.get("namenode_heapsize"));
  Assert.assertTrue(attribute2Occurances.containsKey("dfs_namenode_name_dir"));
  Assert.assertEquals("3",attribute2Occurances.get("dfs_namenode_name_dir"));
  Assert.assertTrue(attribute2Occurances.containsKey("c"));
  Assert.assertEquals("q",attribute2Occurances.get("c"));
  Assert.assertTrue(effectiveAttributes.containsKey("core-site"));
  Map<String,Map<String,String>> coreAttrs=effectiveAttributes.get("core-site");
  Assert.assertEquals(1,coreAttrs.size());
  Assert.assertTrue(coreAttrs.containsKey("attribute1"));
  Map<String,String> attribute1Occurances=coreAttrs.get("attribute1");
  Assert.assertEquals(3,attribute1Occurances.size());
  Assert.assertTrue(attribute1Occurances.containsKey("ipc.client.connect.max.retries"));
  Assert.assertEquals("1",attribute1Occurances.get("ipc.client.connect.max.retries"));
  Assert.assertTrue(attribute1Occurances.containsKey("fs.trash.interval"));
  Assert.assertEquals("11",attribute1Occurances.get("fs.trash.interval"));
  Assert.assertTrue(attribute1Occurances.containsKey("b"));
  Assert.assertEquals("y",attribute1Occurances.get("b"));
}

</code></pre>

<pre class="type-4 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testEffectiveTagsForHost() throws Exception {
  final Config config=new ConfigImpl("core-site");
  config.setTag("version122");
  Map<String,String> properties=new HashMap<String,String>();
  properties.put("a","b");
  properties.put("c","d");
  config.setProperties(properties);
  Long groupId=addConfigGroup("g1","t1",new ArrayList<String>(){
{
      add("h1");
    }
  }
,new ArrayList<Config>(){
{
      add(config);
    }
  }
);
  Assert.assertNotNull(groupId);
  Map<String,Map<String,String>> configTags=configHelper.getEffectiveDesiredTags(cluster,"h1");
  Assert.assertNotNull(configTags);
  Map<String,String> tagsWithOverrides=configTags.get("core-site");
  Assert.assertNotNull(tagsWithOverrides);
  Assert.assertTrue(tagsWithOverrides.containsKey(ConfigHelper.CLUSTER_DEFAULT_TAG));
  Assert.assertEquals("version1",tagsWithOverrides.get(ConfigHelper.CLUSTER_DEFAULT_TAG));
  Assert.assertTrue(tagsWithOverrides.containsKey(groupId.toString()));
  Assert.assertEquals("version122",tagsWithOverrides.get(groupId.toString()));
}

</code></pre>

<pre class="type-7 type-2 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Before public void setup() throws Exception {
  SecurityContextHolder.getContext().setAuthentication(TestAuthenticationFactory.createAdministrator("admin"));
  injector=Guice.createInjector(new InMemoryDefaultTestModule());
  injector.getInstance(GuiceJpaInitializer.class);
  clusters=injector.getInstance(Clusters.class);
  configGroupFactory=injector.getInstance(ConfigGroupFactory.class);
  configHelper=injector.getInstance(ConfigHelper.class);
  managementController=injector.getInstance(AmbariManagementController.class);
  clusterName="c1";
  clusters.addCluster(clusterName,new StackId("HDP-2.0.6"));
  cluster=clusters.getCluster(clusterName);
  Assert.assertNotNull(cluster);
  clusters.addHost("h1");
  clusters.addHost("h2");
  Assert.assertNotNull(clusters.getHost("h1"));
  Assert.assertNotNull(clusters.getHost("h2"));
  clusters.getHost("h1").persist();
  clusters.getHost("h2").persist();
  ConfigurationRequest cr=new ConfigurationRequest();
  cr.setClusterName(clusterName);
  cr.setType("core-site");
  cr.setVersionTag("version1");
  cr.setProperties(new HashMap<String,String>(){
{
      put("ipc.client.connect.max.retries","30");
      put("fs.trash.interval","30");
    }
  }
);
  cr.setPropertiesAttributes(new HashMap<String,Map<String,String>>(){
{
      Map<String,String> attrs=new HashMap<String,String>();
      attrs.put("ipc.client.connect.max.retries","1");
      attrs.put("fs.trash.interval","2");
      put("attribute1",attrs);
    }
  }
);
  final ClusterRequest clusterRequest1=new ClusterRequest(cluster.getClusterId(),clusterName,cluster.getDesiredStackVersion().getStackVersion(),null);
  clusterRequest1.setDesiredConfig(Collections.singletonList(cr));
  managementController.updateClusters(new HashSet<ClusterRequest>(){
{
      add(clusterRequest1);
    }
  }
,null);
  ConfigurationRequest cr2=new ConfigurationRequest();
  cr2.setClusterName(clusterName);
  cr2.setType("flume-conf");
  cr2.setVersionTag("version1");
  final ClusterRequest clusterRequest2=new ClusterRequest(cluster.getClusterId(),clusterName,cluster.getDesiredStackVersion().getStackVersion(),null);
  clusterRequest2.setDesiredConfig(Collections.singletonList(cr2));
  managementController.updateClusters(new HashSet<ClusterRequest>(){
{
      add(clusterRequest2);
    }
  }
,null);
  cr.setType("global");
  cr.setVersionTag("version1");
  cr.setProperties(new HashMap<String,String>(){
{
      put("dfs_namenode_name_dir","/hadoop/hdfs/namenode");
      put("namenode_heapsize","1024");
    }
  }
);
  cr.setPropertiesAttributes(new HashMap<String,Map<String,String>>(){
{
      Map<String,String> attrs=new HashMap<String,String>();
      attrs.put("dfs_namenode_name_dir","3");
      attrs.put("namenode_heapsize","4");
      put("attribute2",attrs);
    }
  }
);
  final ClusterRequest clusterRequest3=new ClusterRequest(cluster.getClusterId(),clusterName,cluster.getDesiredStackVersion().getStackVersion(),null);
  clusterRequest3.setDesiredConfig(Collections.singletonList(cr));
  managementController.updateClusters(new HashSet<ClusterRequest>(){
{
      add(clusterRequest3);
    }
  }
,null);
  ConfigurationRequest cr4=new ConfigurationRequest();
  cr4.setClusterName(clusterName);
  cr4.setType("oozie-site");
  cr4.setVersionTag("version1");
  cr4.setProperties(new HashMap<String,String>(){
{
      put("oozie.authentication.type","simple");
      put("oozie.service.HadoopAccessorService.kerberos.enabled","false");
    }
  }
);
  cr4.setPropertiesAttributes(null);
  final ClusterRequest clusterRequest4=new ClusterRequest(cluster.getClusterId(),clusterName,cluster.getDesiredStackVersion().getStackVersion(),null);
  clusterRequest4.setDesiredConfig(Collections.singletonList(cr4));
  managementController.updateClusters(new HashSet<ClusterRequest>(){
{
      add(clusterRequest4);
    }
  }
,null);
}

</code></pre>

<pre class="type-4 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMergeAttributesWithNoAttributeOverrides() throws Exception {
  Map<String,Map<String,String>> persistedAttributes=new HashMap<String,Map<String,String>>();
  Map<String,String> persistedFinalAttrs=new HashMap<String,String>();
  persistedFinalAttrs.put("a","true");
  persistedFinalAttrs.put("c","true");
  persistedFinalAttrs.put("d","true");
  persistedAttributes.put("final",persistedFinalAttrs);
  Map<String,Map<String,String>> confGroupAttributes=new HashMap<String,Map<String,String>>();
  Map<String,String> confGroupProperties=new HashMap<String,String>();
  confGroupProperties.put("a","any");
  confGroupProperties.put("b","any");
  confGroupProperties.put("c","any");
  Config overrideConfig=new ConfigImpl(cluster,"type",confGroupProperties,confGroupAttributes,injector);
  Map<String,Map<String,String>> result=configHelper.overrideAttributes(overrideConfig,persistedAttributes);
  Assert.assertNotNull(result);
  Assert.assertEquals(1,result.size());
  Map<String,String> finalResultAttributes=result.get("final");
  Assert.assertNotNull(finalResultAttributes);
  Assert.assertEquals(1,finalResultAttributes.size());
  Assert.assertEquals("true",finalResultAttributes.get("d"));
}

</code></pre>

<pre class="type-4 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMergeAttributesWithNullAttributes() throws Exception {
  Map<String,Map<String,String>> persistedAttributes=new HashMap<String,Map<String,String>>();
  Map<String,String> persistedFinalAttrs=new HashMap<String,String>();
  persistedFinalAttrs.put("a","true");
  persistedFinalAttrs.put("c","true");
  persistedFinalAttrs.put("d","true");
  persistedAttributes.put("final",persistedFinalAttrs);
  Map<String,String> confGroupProperties=new HashMap<String,String>();
  confGroupProperties.put("a","any");
  confGroupProperties.put("b","any");
  confGroupProperties.put("c","any");
  Config overrideConfig=new ConfigImpl(cluster,"type",confGroupProperties,null,injector);
  Map<String,Map<String,String>> result=configHelper.overrideAttributes(overrideConfig,persistedAttributes);
  Assert.assertNotNull(result);
  Assert.assertEquals(1,result.size());
  Map<String,String> finalResultAttributes=result.get("final");
  Assert.assertNotNull(finalResultAttributes);
  Assert.assertEquals(3,finalResultAttributes.size());
  Assert.assertEquals("true",finalResultAttributes.get("a"));
  Assert.assertEquals("true",finalResultAttributes.get("c"));
  Assert.assertEquals("true",finalResultAttributes.get("d"));
}

</code></pre>

<pre class="type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpdateConfigType() throws Exception {
  Config currentConfig=cluster.getDesiredConfigByType("core-site");
  Map<String,String> properties=currentConfig.getProperties();
  Map<String,Map<String,String>> propertiesAttributes=currentConfig.getPropertiesAttributes();
  Assert.assertNotNull(propertiesAttributes);
  Assert.assertEquals(1,propertiesAttributes.size());
  Assert.assertTrue(propertiesAttributes.containsKey("attribute1"));
  Assert.assertEquals("version1",currentConfig.getTag());
  Assert.assertEquals("30",properties.get("fs.trash.interval"));
  Assert.assertTrue(properties.containsKey("ipc.client.connect.max.retries"));
  Assert.assertTrue(propertiesAttributes.get("attribute1").containsKey("ipc.client.connect.max.retries"));
  Map<String,String> updates=new HashMap<String,String>();
  updates.put("new-property","new-value");
  updates.put("fs.trash.interval","updated-value");
  Collection<String> removals=Collections.singletonList("ipc.client.connect.max.retries");
  configHelper.updateConfigType(cluster,managementController,"core-site",updates,removals,"admin","Test note");
  Config updatedConfig=cluster.getDesiredConfigByType("core-site");
  propertiesAttributes=updatedConfig.getPropertiesAttributes();
  Assert.assertNotNull(propertiesAttributes);
  Assert.assertEquals(1,propertiesAttributes.size());
  Assert.assertTrue(propertiesAttributes.containsKey("attribute1"));
  Assert.assertFalse("version1".equals(updatedConfig.getTag()));
  properties=updatedConfig.getProperties();
  Assert.assertTrue(properties.containsKey("new-property"));
  Assert.assertEquals("new-value",properties.get("new-property"));
  Assert.assertTrue(properties.containsKey("fs.trash.interval"));
  Assert.assertEquals("updated-value",properties.get("fs.trash.interval"));
  Assert.assertEquals("2",propertiesAttributes.get("attribute1").get("fs.trash.interval"));
  Assert.assertFalse(properties.containsKey("ipc.client.connect.max.retries"));
  Assert.assertFalse(propertiesAttributes.get("attribute1").containsKey("ipc.client.connect.max.retries"));
}

</code></pre>

<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void tearDown(){
  injector.getInstance(PersistService.class).stop();
  SecurityContextHolder.getContext().setAuthentication(null);
}

</code></pre>

<pre class="type-4 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMergeAttributes() throws Exception {
  Map<String,Map<String,String>> persistedAttributes=new HashMap<String,Map<String,String>>();
  Map<String,String> persistedFinalAttrs=new HashMap<String,String>();
  persistedFinalAttrs.put("a","true");
  persistedFinalAttrs.put("c","true");
  persistedFinalAttrs.put("d","true");
  persistedAttributes.put("final",persistedFinalAttrs);
  Map<String,Map<String,String>> confGroupAttributes=new HashMap<String,Map<String,String>>();
  Map<String,String> confGroupFinalAttrs=new HashMap<String,String>();
  confGroupFinalAttrs.put("b","true");
  confGroupAttributes.put("final",confGroupFinalAttrs);
  Map<String,String> confGroupProperties=new HashMap<String,String>();
  confGroupProperties.put("a","any");
  confGroupProperties.put("b","any");
  confGroupProperties.put("c","any");
  Config overrideConfig=new ConfigImpl(cluster,"type",confGroupProperties,confGroupAttributes,injector);
  Map<String,Map<String,String>> result=configHelper.overrideAttributes(overrideConfig,persistedAttributes);
  Assert.assertNotNull(result);
  Assert.assertEquals(1,result.size());
  Map<String,String> finalResultAttributes=result.get("final");
  Assert.assertNotNull(finalResultAttributes);
  Assert.assertEquals(2,finalResultAttributes.size());
  Assert.assertEquals("true",finalResultAttributes.get("b"));
  Assert.assertEquals("true",finalResultAttributes.get("d"));
}

</code></pre>

<pre class="type-4 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMergeAttributesWithNullProperties() throws Exception {
  Map<String,Map<String,String>> persistedAttributes=new HashMap<String,Map<String,String>>();
  Map<String,String> persistedFinalAttrs=new HashMap<String,String>();
  persistedFinalAttrs.put("a","true");
  persistedFinalAttrs.put("c","true");
  persistedFinalAttrs.put("d","true");
  persistedAttributes.put("final",persistedFinalAttrs);
  Map<String,Map<String,String>> confGroupAttributes=new HashMap<String,Map<String,String>>();
  Map<String,String> confGroupFinalAttrs=new HashMap<String,String>();
  confGroupFinalAttrs.put("b","true");
  confGroupAttributes.put("final",confGroupFinalAttrs);
  Config overrideConfig=new ConfigImpl(cluster,"type",null,confGroupAttributes,injector);
  Map<String,Map<String,String>> result=configHelper.overrideAttributes(overrideConfig,persistedAttributes);
  Assert.assertNotNull(result);
  Assert.assertEquals(1,result.size());
  Map<String,String> finalResultAttributes=result.get("final");
  Assert.assertNotNull(finalResultAttributes);
  Assert.assertEquals(4,finalResultAttributes.size());
  Assert.assertEquals("true",finalResultAttributes.get("a"));
  Assert.assertEquals("true",finalResultAttributes.get("b"));
  Assert.assertEquals("true",finalResultAttributes.get("c"));
  Assert.assertEquals("true",finalResultAttributes.get("d"));
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
