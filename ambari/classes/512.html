<h3 style="margin:0px">Class: org.apache.ambari.server.upgrade.UpgradeCatalog221Test (15 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(6)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(6)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void test_AddCheckCommandTimeoutParam_ParamsNotAvailable(){
  UpgradeCatalog221 upgradeCatalog221=new UpgradeCatalog221(injector);
  String inputSource="{ \"path\" : \"test_path\", \"type\" : \"SCRIPT\"}";
  String expectedSource="{\"path\":\"test_path\",\"type\":\"SCRIPT\",\"parameters\":[{\"name\":\"check.command.timeout\",\"display_name\":\"Check command timeout\",\"value\":60.0,\"type\":\"NUMERIC\",\"description\":\"The maximum time before check command will be killed by timeout\",\"units\":\"seconds\"}]}";
  String result=upgradeCatalog221.addCheckCommandTimeoutParam(inputSource);
  Assert.assertEquals(result,expectedSource);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testExecuteDMLUpdates() throws Exception {
  Method addNewConfigurationsFromXml=AbstractUpgradeCatalog.class.getDeclaredMethod("addNewConfigurationsFromXml");
  Method updateAlerts=UpgradeCatalog221.class.getDeclaredMethod("updateAlerts");
  Method updateOozieConfigs=UpgradeCatalog221.class.getDeclaredMethod("updateOozieConfigs");
  Method updateTezConfigs=UpgradeCatalog221.class.getDeclaredMethod("updateTezConfigs");
  Method updateRangerKmsDbksConfigs=UpgradeCatalog221.class.getDeclaredMethod("updateRangerKmsDbksConfigs");
  Method updateAMSConfigs=UpgradeCatalog221.class.getDeclaredMethod("updateAMSConfigs");
  UpgradeCatalog221 upgradeCatalog221=createMockBuilder(UpgradeCatalog221.class).addMockedMethod(addNewConfigurationsFromXml).addMockedMethod(updateAlerts).addMockedMethod(updateOozieConfigs).addMockedMethod(updateTezConfigs).addMockedMethod(updateRangerKmsDbksConfigs).addMockedMethod(updateAMSConfigs).createMock();
  upgradeCatalog221.addNewConfigurationsFromXml();
  expectLastCall().once();
  upgradeCatalog221.updateAlerts();
  expectLastCall().once();
  upgradeCatalog221.updateOozieConfigs();
  expectLastCall().once();
  upgradeCatalog221.updateTezConfigs();
  expectLastCall().once();
  upgradeCatalog221.updateRangerKmsDbksConfigs();
  expectLastCall().once();
  upgradeCatalog221.updateAMSConfigs();
  expectLastCall().once();
  replay(upgradeCatalog221);
  upgradeCatalog221.executeDMLUpdates();
  verify(upgradeCatalog221);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUpdateAlertDefinitions(){
  EasyMockSupport easyMockSupport=new EasyMockSupport();
  long clusterId=1;
  final AmbariManagementController mockAmbariManagementController=easyMockSupport.createNiceMock(AmbariManagementController.class);
  final AlertDefinitionDAO mockAlertDefinitionDAO=easyMockSupport.createNiceMock(AlertDefinitionDAO.class);
  final Clusters mockClusters=easyMockSupport.createStrictMock(Clusters.class);
  final Cluster mockClusterExpected=easyMockSupport.createNiceMock(Cluster.class);
  final AlertDefinitionEntity mockAmsZookeeperProcessAlertDefinitionEntity=easyMockSupport.createNiceMock(AlertDefinitionEntity.class);
  final Injector mockInjector=Guice.createInjector(new AbstractModule(){
    @Override protected void configure(){
      bind(AmbariManagementController.class).toInstance(mockAmbariManagementController);
      bind(Clusters.class).toInstance(mockClusters);
      bind(EntityManager.class).toInstance(entityManager);
      bind(AlertDefinitionDAO.class).toInstance(mockAlertDefinitionDAO);
      bind(DBAccessor.class).toInstance(createNiceMock(DBAccessor.class));
      bind(OsFamily.class).toInstance(createNiceMock(OsFamily.class));
    }
  }
);
  expect(mockAmbariManagementController.getClusters()).andReturn(mockClusters).once();
  expect(mockClusters.getClusters()).andReturn(new HashMap<String,Cluster>(){
{
      put("normal",mockClusterExpected);
    }
  }
).atLeastOnce();
  expect(mockClusterExpected.getClusterId()).andReturn(clusterId).anyTimes();
  expect(mockAlertDefinitionDAO.findByName(eq(clusterId),eq("ams_metrics_collector_zookeeper_server_process"))).andReturn(mockAmsZookeeperProcessAlertDefinitionEntity).atLeastOnce();
  mockAlertDefinitionDAO.remove(mockAmsZookeeperProcessAlertDefinitionEntity);
  expectLastCall().once();
  easyMockSupport.replayAll();
  mockInjector.getInstance(UpgradeCatalog221.class).updateAlerts();
  easyMockSupport.verifyAll();
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void test_AddCheckCommandTimeoutParam_ParamsAvailable(){
  UpgradeCatalog221 upgradeCatalog221=new UpgradeCatalog221(injector);
  String inputSource="{\"path\":\"test_path\",\"type\":\"SCRIPT\",\"parameters\":[{\"name\":\"test\",\"display_name\":\"Test\",\"value\":10.0,\"type\":\"test\",\"description\":\"test\",\"units\":\"test\"}]}";
  String expectedSource="{\"path\":\"test_path\",\"type\":\"SCRIPT\",\"parameters\":[{\"name\":\"test\",\"display_name\":\"Test\",\"value\":10.0,\"type\":\"test\",\"description\":\"test\",\"units\":\"test\"},{\"name\":\"check.command.timeout\",\"display_name\":\"Check command timeout\",\"value\":60.0,\"type\":\"NUMERIC\",\"description\":\"The maximum time before check command will be killed by timeout\",\"units\":\"seconds\"}]}";
  String result=upgradeCatalog221.addCheckCommandTimeoutParam(inputSource);
  Assert.assertEquals(result,expectedSource);
}

</code></pre>

<pre class="type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void tearDown(){
  injector.getInstance(PersistService.class).stop();
}

</code></pre>

<pre class="type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void test_AddCheckCommandTimeoutParam_NeededParamAlreadyAdded(){
  UpgradeCatalog221 upgradeCatalog221=new UpgradeCatalog221(injector);
  String inputSource="{\"path\":\"test_path\",\"type\":\"SCRIPT\",\"parameters\":[{\"display_name\":\"Test\",\"value\":10.0,\"type\":\"test\",\"description\":\"test\",\"units\":\"test\"},{\"name\":\"check.command.timeout\",\"display_name\":\"Check command timeout\",\"value\":60.0,\"type\":\"NUMERIC\",\"description\":\"The maximum time before check command will be killed by timeout\",\"units\":\"seconds\"}]}";
  String expectedSource="{\"path\":\"test_path\",\"type\":\"SCRIPT\",\"parameters\":[{\"display_name\":\"Test\",\"value\":10.0,\"type\":\"test\",\"description\":\"test\",\"units\":\"test\"},{\"name\":\"check.command.timeout\",\"display_name\":\"Check command timeout\",\"value\":60.0,\"type\":\"NUMERIC\",\"description\":\"The maximum time before check command will be killed by timeout\",\"units\":\"seconds\"}]}";
  String result=upgradeCatalog221.addCheckCommandTimeoutParam(inputSource);
  Assert.assertEquals(result,expectedSource);
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUpdateAmsEnvContent() throws NoSuchMethodException, InvocationTargetException, IllegalAccessException {
  Method updateAmsEnvContent=UpgradeCatalog221.class.getDeclaredMethod("updateAmsEnvContent",String.class);
  UpgradeCatalog221 upgradeCatalog221=new UpgradeCatalog221(injector);
  String oldContent="some_content\n" + "# AMS Collector options\n" + "export AMS_COLLECTOR_OPTS=\"-Djava.library.path=/usr/lib/ams-hbase/lib/hadoop-native\"\n"+ "{% if security_enabled %}\n"+ "export AMS_COLLECTOR_OPTS=\"$AMS_COLLECTOR_OPTS -Djava.security.auth.login.config={{ams_collector_jaas_config_file}} "+ "-Dzookeeper.sasl.client.username={{zk_servicename}}\"\n"+ "{% endif %}";
  String expectedContent="some_content\n" + "# AMS Collector options\n" + "export AMS_COLLECTOR_OPTS=\"-Djava.library.path=/usr/lib/ams-hbase/lib/hadoop-native\"\n"+ "{% if security_enabled %}\n"+ "export AMS_COLLECTOR_OPTS=\"$AMS_COLLECTOR_OPTS -Djava.security.auth.login.config={{ams_collector_jaas_config_file}}\"\n"+ "{% endif %}";
  String result=(String)updateAmsEnvContent.invoke(upgradeCatalog221,oldContent);
  Assert.assertEquals(expectedContent,result);
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUpdateAmsHbaseEnvContent() throws NoSuchMethodException, InvocationTargetException, IllegalAccessException {
  Method updateAmsHbaseEnvContent=UpgradeCatalog221.class.getDeclaredMethod("updateAmsHbaseEnvContent",String.class);
  UpgradeCatalog221 upgradeCatalog221=new UpgradeCatalog221(injector);
  String oldContent="some_content\n" + "{% if security_enabled %}\n" + "export HBASE_OPTS=\"$HBASE_OPTS -Djava.security.auth.login.config={{client_jaas_config_file}} -Dzookeeper.sasl.client.username={{zk_servicename}}\"\n"+ "export HBASE_MASTER_OPTS=\"$HBASE_MASTER_OPTS -Djava.security.auth.login.config={{master_jaas_config_file}} -Dzookeeper.sasl.client.username={{zk_servicename}}\"\n"+ "export HBASE_REGIONSERVER_OPTS=\"$HBASE_REGIONSERVER_OPTS -Djava.security.auth.login.config={{regionserver_jaas_config_file}} -Dzookeeper.sasl.client.username={{zk_servicename}}\"\n"+ "export HBASE_ZOOKEEPER_OPTS=\"$HBASE_ZOOKEEPER_OPTS -Djava.security.auth.login.config={{ams_zookeeper_jaas_config_file}} -Dzookeeper.sasl.client.username={{zk_servicename}}\"\n"+ "{% endif %}";
  String expectedContent="some_content\n" + "{% if security_enabled %}\n" + "export HBASE_OPTS=\"$HBASE_OPTS -Djava.security.auth.login.config={{client_jaas_config_file}}\"\n"+ "export HBASE_MASTER_OPTS=\"$HBASE_MASTER_OPTS -Djava.security.auth.login.config={{master_jaas_config_file}}\"\n"+ "export HBASE_REGIONSERVER_OPTS=\"$HBASE_REGIONSERVER_OPTS -Djava.security.auth.login.config={{regionserver_jaas_config_file}}\"\n"+ "export HBASE_ZOOKEEPER_OPTS=\"$HBASE_ZOOKEEPER_OPTS -Djava.security.auth.login.config={{ams_zookeeper_jaas_config_file}}\"\n"+ "{% endif %}";
  String result=(String)updateAmsHbaseEnvContent.invoke(upgradeCatalog221,oldContent);
  Assert.assertEquals(expectedContent,result);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUpdateAmsHbaseSiteConfigs() throws Exception {
  Map<String,String> clusterEnvProperties=new HashMap<String,String>();
  Map<String,String> amsHbaseSecuritySite=new HashMap<String,String>();
  Map<String,String> newPropertiesAmsHbaseSite=new HashMap<String,String>();
  amsHbaseSecuritySite.put("zookeeper.znode.parent","/ams-hbase-unsecure");
  newPropertiesAmsHbaseSite.put("zookeeper.znode.parent","/ams-hbase-unsecure");
  testAmsHbaseSiteUpdates(new HashMap<String,String>(),newPropertiesAmsHbaseSite,amsHbaseSecuritySite,clusterEnvProperties);
  amsHbaseSecuritySite.put("zookeeper.znode.parent","/ams-hbase-secure");
  newPropertiesAmsHbaseSite.put("zookeeper.znode.parent","/ams-hbase-secure");
  testAmsHbaseSiteUpdates(new HashMap<String,String>(),newPropertiesAmsHbaseSite,amsHbaseSecuritySite,clusterEnvProperties);
  clusterEnvProperties.put("security_enabled","false");
  amsHbaseSecuritySite.put("zookeeper.znode.parent","");
  newPropertiesAmsHbaseSite.put("zookeeper.znode.parent","/ams-hbase-unsecure");
  testAmsHbaseSiteUpdates(new HashMap<String,String>(),newPropertiesAmsHbaseSite,amsHbaseSecuritySite,clusterEnvProperties);
  clusterEnvProperties.put("security_enabled","true");
  amsHbaseSecuritySite.put("zookeeper.znode.parent","/hbase");
  newPropertiesAmsHbaseSite.put("zookeeper.znode.parent","/ams-hbase-secure");
  testAmsHbaseSiteUpdates(new HashMap<String,String>(),newPropertiesAmsHbaseSite,amsHbaseSecuritySite,clusterEnvProperties);
  amsHbaseSecuritySite.put("hbase.zookeeper.property.clientPort","61181");
  newPropertiesAmsHbaseSite.put("hbase.zookeeper.property.clientPort","{{zookeeper_clientPort}}");
  testAmsHbaseSiteUpdates(Collections.singletonMap("hbase.zookeeper.property.clientPort","61181"),newPropertiesAmsHbaseSite,amsHbaseSecuritySite,clusterEnvProperties);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUpdateOozieConfigs() throws Exception {
  EasyMockSupport easyMockSupport=new EasyMockSupport();
  final AmbariManagementController mockAmbariManagementController=easyMockSupport.createNiceMock(AmbariManagementController.class);
  final Clusters mockClusters=easyMockSupport.createStrictMock(Clusters.class);
  final Cluster mockClusterExpected=easyMockSupport.createNiceMock(Cluster.class);
  final Config oozieSiteConf=easyMockSupport.createNiceMock(Config.class);
  final Map<String,String> propertiesOozieSite=new HashMap<String,String>(){
{
      put("oozie.service.HadoopAccessorService.hadoop.configurations","*=/etc/hadoop/conf");
    }
  }
;
  final Injector mockInjector=Guice.createInjector(new AbstractModule(){
    @Override protected void configure(){
      bind(AmbariManagementController.class).toInstance(mockAmbariManagementController);
      bind(Clusters.class).toInstance(mockClusters);
      bind(EntityManager.class).toInstance(entityManager);
      bind(DBAccessor.class).toInstance(createNiceMock(DBAccessor.class));
      bind(OsFamily.class).toInstance(createNiceMock(OsFamily.class));
    }
  }
);
  expect(mockAmbariManagementController.getClusters()).andReturn(mockClusters).once();
  expect(mockClusters.getClusters()).andReturn(new HashMap<String,Cluster>(){
{
      put("normal",mockClusterExpected);
    }
  }
).atLeastOnce();
  expect(mockClusterExpected.getDesiredConfigByType("oozie-site")).andReturn(oozieSiteConf).atLeastOnce();
  expect(oozieSiteConf.getProperties()).andReturn(propertiesOozieSite).once();
  UpgradeCatalog221 upgradeCatalog221=createMockBuilder(UpgradeCatalog221.class).withConstructor(Injector.class).withArgs(mockInjector).addMockedMethod("updateConfigurationPropertiesForCluster",Cluster.class,String.class,Map.class,boolean.class,boolean.class).createMock();
  upgradeCatalog221.updateConfigurationPropertiesForCluster(mockClusterExpected,"oozie-site",Collections.singletonMap("oozie.service.HadoopAccessorService.hadoop.configurations","*={{hadoop_conf_dir}}"),true,false);
  expectLastCall().once();
  easyMockSupport.replayAll();
  replay(upgradeCatalog221);
  upgradeCatalog221.updateOozieConfigs();
  easyMockSupport.verifyAll();
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUpdateRangerKmsDbksConfigs() throws Exception {
  EasyMockSupport easyMockSupport=new EasyMockSupport();
  final AmbariManagementController mockAmbariManagementController=easyMockSupport.createNiceMock(AmbariManagementController.class);
  final Clusters mockClusters=easyMockSupport.createStrictMock(Clusters.class);
  final Cluster mockClusterExpected=easyMockSupport.createNiceMock(Cluster.class);
  final Map<String,String> propertiesRangerKmsDbConfigs=new HashMap<String,String>();
  propertiesRangerKmsDbConfigs.put("DB_FLAVOR","MYSQL");
  propertiesRangerKmsDbConfigs.put("db_host","localhost");
  propertiesRangerKmsDbConfigs.put("db_name","testdb");
  final Config mockrangerKmsDbConfigs=easyMockSupport.createNiceMock(Config.class);
  final Injector mockInjector=Guice.createInjector(new AbstractModule(){
    @Override protected void configure(){
      bind(AmbariManagementController.class).toInstance(mockAmbariManagementController);
      bind(Clusters.class).toInstance(mockClusters);
      bind(EntityManager.class).toInstance(entityManager);
      bind(DBAccessor.class).toInstance(createNiceMock(DBAccessor.class));
      bind(OsFamily.class).toInstance(createNiceMock(OsFamily.class));
    }
  }
);
  expect(mockAmbariManagementController.getClusters()).andReturn(mockClusters).once();
  expect(mockClusters.getClusters()).andReturn(new HashMap<String,Cluster>(){
{
      put("normal",mockClusterExpected);
    }
  }
).atLeastOnce();
  expect(mockClusterExpected.getDesiredConfigByType("kms-properties")).andReturn(mockrangerKmsDbConfigs).atLeastOnce();
  expect(mockrangerKmsDbConfigs.getProperties()).andReturn(propertiesRangerKmsDbConfigs).times(3);
  easyMockSupport.replayAll();
  mockInjector.getInstance(UpgradeCatalog221.class).updateRangerKmsDbksConfigs();
  easyMockSupport.verifyAll();
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUpdateTezConfigs() throws Exception {
  EasyMockSupport easyMockSupport=new EasyMockSupport();
  final AmbariManagementController mockAmbariManagementController=easyMockSupport.createNiceMock(AmbariManagementController.class);
  final Clusters mockClusters=easyMockSupport.createStrictMock(Clusters.class);
  final Cluster mockClusterExpected=easyMockSupport.createNiceMock(Cluster.class);
  final Config tezSiteConf=easyMockSupport.createNiceMock(Config.class);
  final Map<String,String> propertiesTezSite=new HashMap<String,String>(){
{
      put("tez.counters.max","2000");
      put("tez.counters.max.groups","1000");
    }
  }
;
  StackId stackId=new StackId("HDP","2.3");
  final Injector mockInjector=Guice.createInjector(new AbstractModule(){
    @Override protected void configure(){
      bind(AmbariManagementController.class).toInstance(mockAmbariManagementController);
      bind(Clusters.class).toInstance(mockClusters);
      bind(EntityManager.class).toInstance(entityManager);
      bind(DBAccessor.class).toInstance(createNiceMock(DBAccessor.class));
      bind(OsFamily.class).toInstance(createNiceMock(OsFamily.class));
    }
  }
);
  expect(mockAmbariManagementController.getClusters()).andReturn(mockClusters).once();
  expect(mockClusters.getClusters()).andReturn(new HashMap<String,Cluster>(){
{
      put("normal",mockClusterExpected);
    }
  }
).atLeastOnce();
  expect(mockClusterExpected.getDesiredConfigByType("tez-site")).andReturn(tezSiteConf).atLeastOnce();
  expect(tezSiteConf.getProperties()).andReturn(propertiesTezSite).once();
  expect(mockClusterExpected.getCurrentStackVersion()).andReturn(stackId).once();
  UpgradeCatalog221 upgradeCatalog221=createMockBuilder(UpgradeCatalog221.class).withConstructor(Injector.class).withArgs(mockInjector).addMockedMethod("updateConfigurationPropertiesForCluster",Cluster.class,String.class,Map.class,boolean.class,boolean.class).createMock();
  Map<String,String> updates=new HashMap<String,String>();
  updates.put("tez.counters.max","10000");
  updates.put("tez.counters.max.groups","3000");
  upgradeCatalog221.updateConfigurationPropertiesForCluster(mockClusterExpected,"tez-site",updates,true,false);
  expectLastCall().once();
}

</code></pre>

<pre class="type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void init(){
  reset(entityManagerProvider);
  expect(entityManagerProvider.get()).andReturn(entityManager).anyTimes();
  replay(entityManagerProvider);
  injector=Guice.createInjector(new InMemoryDefaultTestModule());
  injector.getInstance(GuiceJpaInitializer.class);
  upgradeCatalogHelper=injector.getInstance(UpgradeCatalogHelper.class);
  injector.getInstance(AmbariMetaInfo.class);
  StackDAO stackDAO=injector.getInstance(StackDAO.class);
  desiredStackEntity=stackDAO.find("HDP","2.2.0");
}

</code></pre>

<pre class="type-2 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testUpdateAmsHbaseSecuritySiteConfigs() throws Exception {
  Map<String,String> oldPropertiesAmsHbaseSecuritySite=new HashMap<String,String>(){
{
      put("zookeeper.znode.parent","/ams-hbase-secure");
    }
  }
;
  Map<String,String> newPropertiesAmsHbaseSecuritySite=new HashMap<String,String>(){
{
    }
  }
;
  EasyMockSupport easyMockSupport=new EasyMockSupport();
  Clusters clusters=easyMockSupport.createNiceMock(Clusters.class);
  final Cluster cluster=easyMockSupport.createNiceMock(Cluster.class);
  Config mockAmsHbaseSecuritySite=easyMockSupport.createNiceMock(Config.class);
  expect(clusters.getClusters()).andReturn(new HashMap<String,Cluster>(){
{
      put("normal",cluster);
    }
  }
).once();
  expect(cluster.getDesiredConfigByType("ams-hbase-security-site")).andReturn(mockAmsHbaseSecuritySite).atLeastOnce();
  expect(mockAmsHbaseSecuritySite.getProperties()).andReturn(oldPropertiesAmsHbaseSecuritySite).times(2);
  Injector injector=easyMockSupport.createNiceMock(Injector.class);
  expect(injector.getInstance(Gson.class)).andReturn(null).anyTimes();
  expect(injector.getInstance(MaintenanceStateHelper.class)).andReturn(null).anyTimes();
  expect(injector.getInstance(KerberosHelper.class)).andReturn(createNiceMock(KerberosHelper.class)).anyTimes();
  replay(injector,clusters,mockAmsHbaseSecuritySite,cluster);
  AmbariManagementControllerImpl controller=createMockBuilder(AmbariManagementControllerImpl.class).addMockedMethod("createConfiguration").addMockedMethod("getClusters",new Class[]{}).addMockedMethod("createConfig").withConstructor(createNiceMock(ActionManager.class),clusters,injector).createNiceMock();
  Injector injector2=easyMockSupport.createNiceMock(Injector.class);
  Capture<Map> propertiesCapture=EasyMock.newCapture();
  expect(injector2.getInstance(AmbariManagementController.class)).andReturn(controller).anyTimes();
  expect(controller.getClusters()).andReturn(clusters).anyTimes();
  expect(controller.createConfig(anyObject(Cluster.class),anyString(),capture(propertiesCapture),anyString(),anyObject(Map.class))).andReturn(createNiceMock(Config.class)).once();
  replay(controller,injector2);
  new UpgradeCatalog221(injector2).updateAMSConfigs();
  easyMockSupport.verifyAll();
  Map<String,String> updatedProperties=propertiesCapture.getValue();
  assertTrue(Maps.difference(newPropertiesAmsHbaseSecuritySite,updatedProperties).areEqual());
}

</code></pre>

<pre class="type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExecuteDDLUpdates() throws Exception {
  final DBAccessor dbAccessor=createNiceMock(DBAccessor.class);
  dbAccessor.createIndex(eq("idx_stage_request_id"),eq("stage"),eq("request_id"));
  expectLastCall().once();
  dbAccessor.createIndex(eq("idx_hrc_request_id"),eq("host_role_command"),eq("request_id"));
  expectLastCall().once();
  dbAccessor.createIndex(eq("idx_rsc_request_id"),eq("role_success_criteria"),eq("request_id"));
  expectLastCall().once();
  Capture<DBAccessor.DBColumnInfo> capturedHostGroupComponentProvisionColumn=EasyMock.newCapture();
  dbAccessor.addColumn(eq("hostgroup_component"),capture(capturedHostGroupComponentProvisionColumn));
  expectLastCall().once();
  replay(dbAccessor);
  Module module=new Module(){
    @Override public void configure(    Binder binder){
      binder.bind(DBAccessor.class).toInstance(dbAccessor);
      binder.bind(OsFamily.class).toInstance(createNiceMock(OsFamily.class));
      binder.bind(EntityManager.class).toInstance(entityManager);
    }
  }
;
  Injector injector=Guice.createInjector(module);
  UpgradeCatalog221 upgradeCatalog221=injector.getInstance(UpgradeCatalog221.class);
  upgradeCatalog221.executeDDLUpdates();
  assertEquals("Incorrect column name added","provision_action",capturedHostGroupComponentProvisionColumn.getValue().getName());
  assertNull("Incorrect default value added",capturedHostGroupComponentProvisionColumn.getValue().getDefaultValue());
  assertEquals("Incorrect column type added",String.class,capturedHostGroupComponentProvisionColumn.getValue().getType());
  assertEquals("Incorrect column length added",255,capturedHostGroupComponentProvisionColumn.getValue().getLength().intValue());
  assertTrue("Incorrect column nullable state added",capturedHostGroupComponentProvisionColumn.getValue().isNullable());
  verify(dbAccessor);
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
