<h3 style="margin:0px">Class: org.apache.ambari.server.serveraction.kerberos.ADKerberosOperationHandlerTest (10 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(8)</kbd></button>&nbsp;<button id="16"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('16')" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution"><kbd id="tag-16"class="label-info"style="display: inline-block;font-size:7pt" >ExceptionVerifier&nbsp;(6)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="12"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('12')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-12"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="14"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('14')" data-toggle="tooltip" title="Is not executed with the test suite"><kbd id="tag-14"class="label-info"style="display: inline-block;font-size:7pt" >IgnoredMethod&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-16 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=KerberosAdminAuthenticationException.class) public void testTestAdministratorCredentialsIncorrectAdminPrincipal() throws Exception {
  PrincipalKeyCredential kc=new PrincipalKeyCredential("wrong",DEFAULT_ADMIN_PASSWORD);
  Map<String,String> kerberosEnvMap=new HashMap<String,String>(){
{
      put(ADKerberosOperationHandler.KERBEROS_ENV_LDAP_URL,DEFAULT_LDAP_URL);
      put(ADKerberosOperationHandler.KERBEROS_ENV_PRINCIPAL_CONTAINER_DN,DEFAULT_PRINCIPAL_CONTAINER_DN);
    }
  }
;
  ADKerberosOperationHandler handler=createMockBuilder(ADKerberosOperationHandler.class).addMockedMethod(ADKerberosOperationHandler.class.getDeclaredMethod("createInitialLdapContext",Properties.class,Control[].class)).createNiceMock();
  expect(handler.createInitialLdapContext(anyObject(Properties.class),anyObject(Control[].class))).andAnswer(new IAnswer<LdapContext>(){
    @Override public LdapContext answer() throws Throwable {
      throw new AuthenticationException();
    }
  }
).once();
  replayAll();
  handler.open(kc,DEFAULT_REALM,kerberosEnvMap);
  handler.testAdministratorCredentials();
  handler.close();
}

</code></pre>

<pre class="type-16 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=KerberosKDCConnectionException.class) public void testOpenExceptionLdapUrlNotProvided() throws Exception {
  KerberosOperationHandler handler=new ADKerberosOperationHandler();
  PrincipalKeyCredential kc=new PrincipalKeyCredential(DEFAULT_ADMIN_PRINCIPAL,DEFAULT_ADMIN_PASSWORD);
  Map<String,String> kerberosEnvMap=new HashMap<String,String>(){
{
      put(ADKerberosOperationHandler.KERBEROS_ENV_PRINCIPAL_CONTAINER_DN,DEFAULT_PRINCIPAL_CONTAINER_DN);
    }
  }
;
  handler.open(kc,DEFAULT_REALM,kerberosEnvMap);
  handler.close();
}

</code></pre>

<pre class="type-14 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Is not executed with the test suite
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Implementation to illustrate the use of operations on this class
 * @throws Throwable
 */
@Test @Ignore public void testLive() throws Throwable {
  ADKerberosOperationHandler handler=new ADKerberosOperationHandler();
  String principal=System.getProperty("principal");
  String password=System.getProperty("password");
  String realm=System.getProperty("realm");
  String ldapUrl=System.getProperty("ldap_url");
  String containerDN=System.getProperty("container_dn");
  if (principal == null) {
    principal=DEFAULT_ADMIN_PRINCIPAL;
  }
  if (password == null) {
    password=DEFAULT_ADMIN_PASSWORD;
  }
  if (realm == null) {
    realm=DEFAULT_REALM;
  }
  if (ldapUrl == null) {
    ldapUrl=DEFAULT_LDAP_URL;
  }
  if (containerDN == null) {
    containerDN=DEFAULT_PRINCIPAL_CONTAINER_DN;
  }
  PrincipalKeyCredential credentials=new PrincipalKeyCredential(principal,password);
  Map<String,String> kerberosEnvMap=new HashMap<String,String>();
  kerberosEnvMap.put(ADKerberosOperationHandler.KERBEROS_ENV_LDAP_URL,ldapUrl);
  kerberosEnvMap.put(ADKerberosOperationHandler.KERBEROS_ENV_PRINCIPAL_CONTAINER_DN,containerDN);
  handler.open(credentials,realm,kerberosEnvMap);
  System.out.println("Test Admin Credentials: " + handler.testAdministratorCredentials());
  System.out.println("Principal exists: " + handler.principalExists("nn/c1508.ambari.apache.org"));
  handler.close();
  handler.open(credentials,realm,kerberosEnvMap);
  String evaluatedPrincipal;
  evaluatedPrincipal="nn/c6501.ambari.apache.org@" + DEFAULT_REALM;
  if (handler.principalExists(evaluatedPrincipal)) {
    handler.setPrincipalPassword(evaluatedPrincipal,"some password");
  }
 else {
    handler.createPrincipal(evaluatedPrincipal,"some password",true);
  }
  evaluatedPrincipal="hdfs@" + DEFAULT_REALM;
  if (handler.principalExists(evaluatedPrincipal)) {
    handler.setPrincipalPassword(evaluatedPrincipal,"some password");
  }
 else {
    handler.createPrincipal(evaluatedPrincipal,"some password",true);
  }
  kerberosEnvMap.put(ADKerberosOperationHandler.KERBEROS_ENV_AD_CREATE_ATTRIBUTES_TEMPLATE,"#set( $user = \"${principal_primary}-${principal_digest}\" )" + "{" + "  \"objectClass\": ["+ "    \"top\","+ "    \"person\","+ "    \"organizationalPerson\","+ "    \"user\""+ "  ],"+ "  \"cn\": \"$user\","+ "  \"sAMAccountName\": \"$user.substring(0,20)\","+ "  #if( $is_service )"+ "  \"servicePrincipalName\": \"$principal_name\","+ "  #end"+ "  \"userPrincipalName\": \"$normalized_principal\","+ "  \"unicodePwd\": \"$password\","+ "  \"accountExpires\": \"0\","+ "  \"userAccountControl\": \"66048\""+ "}");
  handler.close();
  handler.open(credentials,realm,kerberosEnvMap);
  handler.removePrincipal("abcdefg");
  handler.removePrincipal("abcdefg/c1509.ambari.apache.org@" + DEFAULT_REALM);
  handler.createPrincipal("abcdefg/c1509.ambari.apache.org@" + DEFAULT_REALM,"some password",true);
  handler.createPrincipal("abcdefg@" + DEFAULT_REALM,"some password",false);
  handler.setPrincipalPassword("abcdefg/c1509.ambari.apache.org@" + DEFAULT_REALM,"some password");
  handler.close();
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testTestAdministratorCredentialsSuccess() throws Exception {
  PrincipalKeyCredential kc=new PrincipalKeyCredential(DEFAULT_ADMIN_PRINCIPAL,DEFAULT_ADMIN_PASSWORD);
  Map<String,String> kerberosEnvMap=new HashMap<String,String>(){
{
      put(ADKerberosOperationHandler.KERBEROS_ENV_LDAP_URL,DEFAULT_LDAP_URL);
      put(ADKerberosOperationHandler.KERBEROS_ENV_PRINCIPAL_CONTAINER_DN,DEFAULT_PRINCIPAL_CONTAINER_DN);
    }
  }
;
  ADKerberosOperationHandler handler=createMockBuilder(ADKerberosOperationHandler.class).addMockedMethod(ADKerberosOperationHandler.class.getDeclaredMethod("createInitialLdapContext",Properties.class,Control[].class)).addMockedMethod(ADKerberosOperationHandler.class.getDeclaredMethod("createSearchControls")).createNiceMock();
  expect(handler.createInitialLdapContext(anyObject(Properties.class),anyObject(Control[].class))).andAnswer(new IAnswer<LdapContext>(){
    @Override public LdapContext answer() throws Throwable {
      LdapContext ldapContext=createNiceMock(LdapContext.class);
      expect(ldapContext.search(anyObject(String.class),anyObject(String.class),anyObject(SearchControls.class))).andAnswer(new IAnswer<NamingEnumeration<SearchResult>>(){
        @Override public NamingEnumeration<SearchResult> answer() throws Throwable {
          NamingEnumeration<SearchResult> result=createNiceMock(NamingEnumeration.class);
          expect(result.hasMore()).andReturn(false).once();
          replay(result);
          return result;
        }
      }
).once();
      replay(ldapContext);
      return ldapContext;
    }
  }
).once();
  expect(handler.createSearchControls()).andAnswer(new IAnswer<SearchControls>(){
    @Override public SearchControls answer() throws Throwable {
      SearchControls searchControls=createNiceMock(SearchControls.class);
      replay(searchControls);
      return searchControls;
    }
  }
).once();
  replayAll();
  handler.open(kc,DEFAULT_REALM,kerberosEnvMap);
  handler.testAdministratorCredentials();
  handler.close();
}

</code></pre>

<pre class="type-16 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=KerberosLDAPContainerException.class) public void testOpenExceptionPrincipalContainerDnNotProvided() throws Exception {
  KerberosOperationHandler handler=new ADKerberosOperationHandler();
  PrincipalKeyCredential kc=new PrincipalKeyCredential(DEFAULT_ADMIN_PRINCIPAL,DEFAULT_ADMIN_PASSWORD);
  Map<String,String> kerberosEnvMap=new HashMap<String,String>(){
{
      put(ADKerberosOperationHandler.KERBEROS_ENV_LDAP_URL,DEFAULT_LDAP_URL);
    }
  }
;
  handler.open(kc,DEFAULT_REALM,kerberosEnvMap);
  handler.close();
}

</code></pre>

<pre class="type-12 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testProcessCreateTemplateCustom() throws Exception {
  PrincipalKeyCredential kc=new PrincipalKeyCredential(DEFAULT_ADMIN_PRINCIPAL,DEFAULT_ADMIN_PASSWORD);
  Map<String,String> kerberosEnvMap=new HashMap<String,String>(){
{
      put(ADKerberosOperationHandler.KERBEROS_ENV_LDAP_URL,DEFAULT_LDAP_URL);
      put(ADKerberosOperationHandler.KERBEROS_ENV_PRINCIPAL_CONTAINER_DN,DEFAULT_PRINCIPAL_CONTAINER_DN);
      put(ADKerberosOperationHandler.KERBEROS_ENV_AD_CREATE_ATTRIBUTES_TEMPLATE,"" + "#set( $user = \"${principal_primary}-${principal_digest}\" )" + "{"+ "  \"objectClass\": ["+ "    \"top\","+ "    \"person\","+ "    \"organizationalPerson\","+ "    \"user\""+ "  ],"+ "  \"cn\": \"$user\","+ "  \"sAMAccountName\": \"$user.substring(0,20)\","+ "  #if( $is_service )"+ "  \"servicePrincipalName\": \"$principal_name\","+ "  #end"+ "  \"userPrincipalName\": \"$normalized_principal\","+ "  \"unicodePwd\": \"$password\","+ "  \"accountExpires\": \"0\","+ "  \"userAccountControl\": \"66048\""+ "}");
    }
  }
;
  Capture<Name> capturedName=new Capture<Name>();
  Capture<Attributes> capturedAttributes=new Capture<Attributes>();
  ADKerberosOperationHandler handler=createMockBuilder(ADKerberosOperationHandler.class).addMockedMethod(ADKerberosOperationHandler.class.getDeclaredMethod("createInitialLdapContext",Properties.class,Control[].class)).addMockedMethod(ADKerberosOperationHandler.class.getDeclaredMethod("createSearchControls")).createNiceMock();
  NamingEnumeration<SearchResult> searchResult=createNiceMock(NamingEnumeration.class);
  expect(searchResult.hasMore()).andReturn(false).once();
  LdapContext ldapContext=createNiceMock(LdapContext.class);
  expect(ldapContext.search(anyObject(String.class),anyObject(String.class),anyObject(SearchControls.class))).andReturn(searchResult).once();
  expect(ldapContext.createSubcontext(capture(capturedName),capture(capturedAttributes))).andReturn(createNiceMock(DirContext.class)).once();
  expect(handler.createInitialLdapContext(anyObject(Properties.class),anyObject(Control[].class))).andReturn(ldapContext).once();
  expect(handler.createSearchControls()).andAnswer(new IAnswer<SearchControls>(){
    @Override public SearchControls answer() throws Throwable {
      SearchControls searchControls=createNiceMock(SearchControls.class);
      replay(searchControls);
      return searchControls;
    }
  }
).once();
  replayAll();
  handler.open(kc,DEFAULT_REALM,kerberosEnvMap);
  handler.createPrincipal("nn/c6501.ambari.apache.org","secret",true);
  handler.close();
  Attributes attributes=capturedAttributes.getValue();
  String[] objectClasses=new String[]{"top","person","organizationalPerson","user"};
  Assert.assertNotNull(attributes);
  Assert.assertEquals(8,attributes.size());
  Assert.assertNotNull(attributes.get("objectClass"));
  Assert.assertEquals(objectClasses.length,attributes.get("objectClass").size());
  for (int i=0; i < objectClasses.length; i++) {
    Assert.assertEquals(objectClasses[i],attributes.get("objectClass").get(i));
  }
  Assert.assertNotNull(attributes.get("cn"));
  Assert.assertEquals("nn-995e1580db28198e7fda1417ab5d894c877937d2",attributes.get("cn").get());
  Assert.assertNotNull(attributes.get("servicePrincipalName"));
  Assert.assertEquals("nn/c6501.ambari.apache.org",attributes.get("servicePrincipalName").get());
  Assert.assertNotNull(attributes.get("userPrincipalName"));
  Assert.assertEquals("nn/c6501.ambari.apache.org@HDP01.LOCAL",attributes.get("userPrincipalName").get());
  Assert.assertNotNull(attributes.get("sAMAccountName"));
  Assert.assertTrue(attributes.get("sAMAccountName").get().toString().length() <= 20);
  Assert.assertEquals("nn-995e1580db28198e7",attributes.get("sAMAccountName").get());
  Assert.assertNotNull(attributes.get("unicodePwd"));
  Assert.assertEquals("\"secret\"",new String((byte[])attributes.get("unicodePwd").get(),Charset.forName("UTF-16LE")));
  Assert.assertNotNull(attributes.get("accountExpires"));
  Assert.assertEquals("0",attributes.get("accountExpires").get());
  Assert.assertNotNull(attributes.get("userAccountControl"));
  Assert.assertEquals("66048",attributes.get("userAccountControl").get());
}

</code></pre>

<pre class="type-16 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=KerberosAdminAuthenticationException.class) public void testOpenExceptionAdminCredentialsNotProvided() throws Exception {
  KerberosOperationHandler handler=new ADKerberosOperationHandler();
  Map<String,String> kerberosEnvMap=new HashMap<String,String>(){
{
      put(ADKerberosOperationHandler.KERBEROS_ENV_LDAP_URL,DEFAULT_LDAP_URL);
      put(ADKerberosOperationHandler.KERBEROS_ENV_PRINCIPAL_CONTAINER_DN,DEFAULT_PRINCIPAL_CONTAINER_DN);
    }
  }
;
  handler.open(null,DEFAULT_REALM,kerberosEnvMap);
  handler.close();
}

</code></pre>

<pre class="type-16 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=KerberosAdminAuthenticationException.class) public void testTestAdministratorCredentialsIncorrectAdminPassword() throws Exception {
  PrincipalKeyCredential kc=new PrincipalKeyCredential(DEFAULT_ADMIN_PRINCIPAL,"wrong");
  Map<String,String> kerberosEnvMap=new HashMap<String,String>(){
{
      put(ADKerberosOperationHandler.KERBEROS_ENV_LDAP_URL,DEFAULT_LDAP_URL);
      put(ADKerberosOperationHandler.KERBEROS_ENV_PRINCIPAL_CONTAINER_DN,DEFAULT_PRINCIPAL_CONTAINER_DN);
    }
  }
;
  ADKerberosOperationHandler handler=createMockBuilder(ADKerberosOperationHandler.class).addMockedMethod(ADKerberosOperationHandler.class.getDeclaredMethod("createInitialLdapContext",Properties.class,Control[].class)).createNiceMock();
  expect(handler.createInitialLdapContext(anyObject(Properties.class),anyObject(Control[].class))).andAnswer(new IAnswer<LdapContext>(){
    @Override public LdapContext answer() throws Throwable {
      throw new AuthenticationException();
    }
  }
).once();
  replayAll();
  handler.open(kc,DEFAULT_REALM,kerberosEnvMap);
  handler.testAdministratorCredentials();
  handler.close();
}

</code></pre>

<pre class="type-4 type-12 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testProcessCreateTemplateDefault() throws Exception {
  PrincipalKeyCredential kc=new PrincipalKeyCredential(DEFAULT_ADMIN_PRINCIPAL,DEFAULT_ADMIN_PASSWORD);
  Map<String,String> kerberosEnvMap=new HashMap<String,String>(){
{
      put(ADKerberosOperationHandler.KERBEROS_ENV_LDAP_URL,DEFAULT_LDAP_URL);
      put(ADKerberosOperationHandler.KERBEROS_ENV_PRINCIPAL_CONTAINER_DN,DEFAULT_PRINCIPAL_CONTAINER_DN);
    }
  }
;
  Capture<Name> capturedName=new Capture<Name>(CaptureType.ALL);
  Capture<Attributes> capturedAttributes=new Capture<Attributes>(CaptureType.ALL);
  ADKerberosOperationHandler handler=createMockBuilder(ADKerberosOperationHandler.class).addMockedMethod(ADKerberosOperationHandler.class.getDeclaredMethod("createInitialLdapContext",Properties.class,Control[].class)).addMockedMethod(ADKerberosOperationHandler.class.getDeclaredMethod("createSearchControls")).createNiceMock();
  NamingEnumeration<SearchResult> searchResult=createNiceMock(NamingEnumeration.class);
  expect(searchResult.hasMore()).andReturn(false).once();
  LdapContext ldapContext=createNiceMock(LdapContext.class);
  expect(ldapContext.search(anyObject(String.class),anyObject(String.class),anyObject(SearchControls.class))).andReturn(searchResult).once();
  expect(ldapContext.createSubcontext(capture(capturedName),capture(capturedAttributes))).andReturn(createNiceMock(DirContext.class)).anyTimes();
  expect(handler.createInitialLdapContext(anyObject(Properties.class),anyObject(Control[].class))).andReturn(ldapContext).once();
  expect(handler.createSearchControls()).andAnswer(new IAnswer<SearchControls>(){
    @Override public SearchControls answer() throws Throwable {
      SearchControls searchControls=createNiceMock(SearchControls.class);
      replay(searchControls);
      return searchControls;
    }
  }
).once();
  replayAll();
  handler.open(kc,DEFAULT_REALM,kerberosEnvMap);
  handler.createPrincipal("nn/c6501.ambari.apache.org","secret",true);
  handler.createPrincipal("hdfs@" + DEFAULT_REALM,"secret",false);
  handler.close();
  List<Attributes> attributesList=capturedAttributes.getValues();
  Attributes attributes;
  attributes=attributesList.get(0);
  String[] objectClasses=new String[]{"top","person","organizationalPerson","user"};
  Assert.assertNotNull(attributes);
  Assert.assertEquals(7,attributes.size());
  Assert.assertNotNull(attributes.get("objectClass"));
  Assert.assertEquals(objectClasses.length,attributes.get("objectClass").size());
  for (int i=0; i < objectClasses.length; i++) {
    Assert.assertEquals(objectClasses[i],attributes.get("objectClass").get(i));
  }
  Assert.assertNotNull(attributes.get("cn"));
  Assert.assertEquals("nn/c6501.ambari.apache.org",attributes.get("cn").get());
  Assert.assertNotNull(attributes.get("servicePrincipalName"));
  Assert.assertEquals("nn/c6501.ambari.apache.org",attributes.get("servicePrincipalName").get());
  Assert.assertNotNull(attributes.get("userPrincipalName"));
  Assert.assertEquals("nn/c6501.ambari.apache.org@HDP01.LOCAL",attributes.get("userPrincipalName").get());
  Assert.assertNotNull(attributes.get("unicodePwd"));
  Assert.assertEquals("\"secret\"",new String((byte[])attributes.get("unicodePwd").get(),Charset.forName("UTF-16LE")));
  Assert.assertNotNull(attributes.get("accountExpires"));
  Assert.assertEquals("0",attributes.get("accountExpires").get());
  Assert.assertNotNull(attributes.get("userAccountControl"));
  Assert.assertEquals("66048",attributes.get("userAccountControl").get());
  attributes=attributesList.get(1);
  Assert.assertNotNull(attributes);
  Assert.assertEquals(6,attributes.size());
  Assert.assertNotNull(attributes.get("objectClass"));
  Assert.assertEquals(objectClasses.length,attributes.get("objectClass").size());
  for (int i=0; i < objectClasses.length; i++) {
    Assert.assertEquals(objectClasses[i],attributes.get("objectClass").get(i));
  }
  Assert.assertNotNull(attributes.get("cn"));
  Assert.assertEquals("hdfs",attributes.get("cn").get());
  Assert.assertNotNull(attributes.get("userPrincipalName"));
  Assert.assertEquals("hdfs@HDP01.LOCAL",attributes.get("userPrincipalName").get());
  Assert.assertNotNull(attributes.get("unicodePwd"));
  Assert.assertEquals("\"secret\"",new String((byte[])attributes.get("unicodePwd").get(),Charset.forName("UTF-16LE")));
  Assert.assertNotNull(attributes.get("accountExpires"));
  Assert.assertEquals("0",attributes.get("accountExpires").get());
  Assert.assertNotNull(attributes.get("userAccountControl"));
  Assert.assertEquals("66048",attributes.get("userAccountControl").get());
}

</code></pre>

<pre class="type-16 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=KerberosKDCConnectionException.class) public void testTestAdministratorCredentialsKDCConnectionException() throws Exception {
  PrincipalKeyCredential kc=new PrincipalKeyCredential(DEFAULT_ADMIN_PRINCIPAL,DEFAULT_ADMIN_PASSWORD);
  Map<String,String> kerberosEnvMap=new HashMap<String,String>(){
{
      put(ADKerberosOperationHandler.KERBEROS_ENV_LDAP_URL,"invalid");
      put(ADKerberosOperationHandler.KERBEROS_ENV_PRINCIPAL_CONTAINER_DN,DEFAULT_PRINCIPAL_CONTAINER_DN);
    }
  }
;
  ADKerberosOperationHandler handler=createMockBuilder(ADKerberosOperationHandler.class).addMockedMethod(ADKerberosOperationHandler.class.getDeclaredMethod("createInitialLdapContext",Properties.class,Control[].class)).createNiceMock();
  expect(handler.createInitialLdapContext(anyObject(Properties.class),anyObject(Control[].class))).andAnswer(new IAnswer<LdapContext>(){
    @Override public LdapContext answer() throws Throwable {
      throw new CommunicationException();
    }
  }
).once();
  replayAll();
  handler.open(kc,DEFAULT_REALM,kerberosEnvMap);
  handler.testAdministratorCredentials();
  handler.close();
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
