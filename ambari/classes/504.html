<h3 style="margin:0px">Class: org.apache.ambari.server.upgrade.UpgradeCatalog161Test (4 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(2)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(2)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@SuppressWarnings("unchecked") @Test public void testExecuteDMLUpdates() throws Exception {
  Configuration configuration=createNiceMock(Configuration.class);
  DBAccessor dbAccessor=createNiceMock(DBAccessor.class);
  Injector injector=createStrictMock(Injector.class);
  Provider provider=createStrictMock(Provider.class);
  EntityManager em=createStrictMock(EntityManager.class);
  EntityTransaction et=createMock(EntityTransaction.class);
  TypedQuery query=createMock(TypedQuery.class);
  Method m=AbstractUpgradeCatalog.class.getDeclaredMethod("updateConfigurationProperties",String.class,Map.class,boolean.class,boolean.class);
  UpgradeCatalog161 upgradeCatalog=createMockBuilder(UpgradeCatalog161.class).addMockedMethod(m).createMock();
  expect(configuration.getDatabaseUrl()).andReturn(Configuration.JDBC_IN_MEMORY_URL).anyTimes();
  expect(injector.getProvider(EntityManager.class)).andReturn(provider).anyTimes();
  expect(provider.get()).andReturn(em).anyTimes();
  expect(em.getTransaction()).andReturn(et);
  expect(et.isActive()).andReturn(true);
  expect(em.createQuery("UPDATE ClusterEntity SET provisioningState = " + ":provisioningState",ClusterEntity.class)).andReturn(query);
  expect(query.setParameter("provisioningState",State.INSTALLED)).andReturn(null);
  expect(query.executeUpdate()).andReturn(0);
  upgradeCatalog.updateConfigurationProperties("hbase-site",Collections.singletonMap("hbase.regionserver.info.port","60030"),false,false);
  expectLastCall();
  upgradeCatalog.updateConfigurationProperties("hbase-site",Collections.singletonMap("hbase.master.info.port","60010"),false,false);
  expectLastCall();
  upgradeCatalog.updateConfigurationProperties("hive-site",Collections.singletonMap("hive.heapsize","1024"),false,false);
  expectLastCall();
  upgradeCatalog.updateConfigurationProperties("pig-properties",Collections.singletonMap("pig-content","\n# Licensed to the Apache " + "Software Foundation (ASF) under one\n# or more contributor license agreements.  See the NOTICE file\n# " + "distributed with this work for additional information\n# regarding copyright ownership.  The ASF "+ "licenses this file\n# to you under the Apache License, Version 2.0 (the\n# \"License\"); you may "+ "not use this file except in compliance\n# with the License.  You may obtain a copy of the License "+ "at\n#\n#http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to "+ "in writing,\n# software distributed under the License is distributed on an\n# \"AS IS\" BASIS, WITHOUT "+ "WARRANTIES OR CONDITIONS OF ANY\n# KIND, either express or implied.  See the License for the\n# "+ "specific language governing permissions and limitations\n# under the License.\n\n# Pig default "+ "configuration file. All values can be overwritten by pig.properties and command line arguments.\n# "+ "see bin/pig -help\n\n# brief logging (no timestamps)\nbrief=false\n\n# debug level, INFO is default"+ "\ndebug=INFO\n\n# verbose print all log messages to screen (default to print only INFO and above to "+ "screen)\nverbose=false\n\n# exectype local|mapreduce, mapreduce is default\nexectype=mapreduce\n\n# "+ "Enable insertion of information about script into hadoop job conf \npig.script.info.enabled=true\n\n# "+ "Do not spill temp files smaller than this size (bytes)\npig.spill.size.threshold=5000000\n\n# "+ "EXPERIMENT: Activate garbage collection when spilling a file bigger than this size (bytes)\n# "+ "This should help reduce the number of files being spilled.\npig.spill.gc.activation.size=40000000\n\n# "+ "the following two parameters are to help estimate the reducer number\npig.exec.reducers.bytes.per."+ "reducer=1000000000\npig.exec.reducers.max=999\n\n# Temporary location to store the intermediate "+ "data.\npig.temp.dir=/tmp/\n\n# Threshold for merging FRJoin fragment files\npig.files.concatenation."+ "threshold=100\npig.optimistic.files.concatenation=false;\n\npig.disable.counter=false\n\n"+ "hcat.bin=/usr/bin/hcat"),true,false);
  expectLastCall();
  replay(upgradeCatalog,dbAccessor,configuration,injector,provider,em,et,query);
  Class<?> c=AbstractUpgradeCatalog.class;
  Field f=c.getDeclaredField("configuration");
  f.setAccessible(true);
  f.set(upgradeCatalog,configuration);
  f=c.getDeclaredField("dbAccessor");
  f.setAccessible(true);
  f.set(upgradeCatalog,dbAccessor);
  f=c.getDeclaredField("injector");
  f.setAccessible(true);
  f.set(upgradeCatalog,injector);
  upgradeCatalog.executeDMLUpdates();
  verify(upgradeCatalog,dbAccessor,configuration,injector,provider,em,et,query);
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetTargetVersion() throws Exception {
  final DBAccessor dbAccessor=createNiceMock(DBAccessor.class);
  UpgradeCatalog upgradeCatalog=getUpgradeCatalog(dbAccessor);
  Assert.assertEquals("1.6.1",upgradeCatalog.getTargetVersion());
}

</code></pre>

<pre class="type-4 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetSourceVersion(){
  final DBAccessor dbAccessor=createNiceMock(DBAccessor.class);
  UpgradeCatalog upgradeCatalog=getUpgradeCatalog(dbAccessor);
  Assert.assertEquals("1.6.0",upgradeCatalog.getSourceVersion());
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testExecuteDDLUpdates() throws Exception {
  final DBAccessor dbAccessor=createNiceMock(DBAccessor.class);
  Connection connection=createNiceMock(Connection.class);
  Statement statement=createNiceMock(Statement.class);
  Configuration configuration=createNiceMock(Configuration.class);
  ResultSet resultSet=createNiceMock(ResultSet.class);
  expect(configuration.getDatabaseUrl()).andReturn(Configuration.JDBC_IN_MEMORY_URL).anyTimes();
  Capture<DBAccessor.DBColumnInfo> provisioningStateColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<List<DBAccessor.DBColumnInfo>> operationLevelEntityColumnCapture=new Capture<List<DBAccessor.DBColumnInfo>>();
  Capture<DBAccessor.DBColumnInfo> labelColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> descriptionColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> visibleColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> viewIconColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> viewIcon64ColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> instanceIconColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> instanceIcon64ColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  setClustersConfigExpectations(dbAccessor,provisioningStateColumnCapture);
  setOperationLevelEntityConfigExpectations(dbAccessor,operationLevelEntityColumnCapture);
  setViewExpectations(dbAccessor,viewIconColumnCapture,viewIcon64ColumnCapture);
  dbAccessor.addColumn(eq("viewinstance"),anyObject(DBAccessor.DBColumnInfo.class));
  setViewInstanceExpectations(dbAccessor,labelColumnCapture,descriptionColumnCapture,visibleColumnCapture,instanceIconColumnCapture,instanceIcon64ColumnCapture);
  dbAccessor.getConnection();
  expectLastCall().andReturn(connection).anyTimes();
  connection.createStatement();
  expectLastCall().andReturn(statement).anyTimes();
  statement.executeQuery(anyObject(String.class));
  expectLastCall().andReturn(resultSet).anyTimes();
  resultSet.next();
  expectLastCall().andReturn(false).anyTimes();
  resultSet.close();
  expectLastCall().anyTimes();
  replay(dbAccessor,configuration,resultSet,statement,connection);
  AbstractUpgradeCatalog upgradeCatalog=getUpgradeCatalog(dbAccessor);
  Class<?> c=AbstractUpgradeCatalog.class;
  Field f=c.getDeclaredField("configuration");
  f.setAccessible(true);
  f.set(upgradeCatalog,configuration);
  upgradeCatalog.executeDDLUpdates();
  verify(dbAccessor,configuration,resultSet,statement,connection);
  assertClusterColumns(provisioningStateColumnCapture);
  assertOperationLevelEntityColumns(operationLevelEntityColumnCapture);
  assertViewColumns(viewIconColumnCapture,viewIcon64ColumnCapture);
  assertViewInstanceColumns(labelColumnCapture,descriptionColumnCapture,visibleColumnCapture,instanceIconColumnCapture,instanceIcon64ColumnCapture);
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
