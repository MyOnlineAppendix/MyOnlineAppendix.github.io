<h3><span class=" glyphicon glyphicon-tag"/>&nbspBranchVerifier</h3><kbd>Verifies assertions inside branch conditions</kbd><br><br><br><h4 style="margin:0px">Class: org.apache.ambari.server.actionmanager.TestActionDBAccessorImpl </h4><pre class="type-13 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAbortRequest() throws AmbariException {
  Stage s=stageFactory.createNew(requestId,"/a/b","cluster1",1L,"action db accessor test","clusterHostInfo","commandParamsStage","hostParamsStage");
  s.setStageId(stageId);
  clusters.addHost("host2");
  clusters.getHost("host2").persist();
  clusters.addHost("host3");
  clusters.getHost("host3").persist();
  clusters.addHost("host4");
  clusters.getHost("host4").persist();
  s.addHostRoleExecutionCommand("host1",Role.HBASE_MASTER,RoleCommand.START,new ServiceComponentHostStartEvent(Role.HBASE_MASTER.toString(),"host1",System.currentTimeMillis()),"cluster1","HBASE",false,false);
  s.addHostRoleExecutionCommand("host2",Role.HBASE_MASTER,RoleCommand.START,new ServiceComponentHostStartEvent(Role.HBASE_MASTER.toString(),"host2",System.currentTimeMillis()),"cluster1","HBASE",false,false);
  s.addHostRoleExecutionCommand("host3",Role.HBASE_REGIONSERVER,RoleCommand.START,new ServiceComponentHostStartEvent(Role.HBASE_REGIONSERVER.toString(),"host3",System.currentTimeMillis()),"cluster1","HBASE",false,false);
  s.addHostRoleExecutionCommand("host4",Role.HBASE_REGIONSERVER,RoleCommand.START,new ServiceComponentHostStartEvent(Role.HBASE_REGIONSERVER.toString(),"host4",System.currentTimeMillis()),"cluster1","HBASE",false,false);
  List<Stage> stages=new ArrayList<Stage>();
  stages.add(s);
  s.getOrderedHostRoleCommands().get(0).setStatus(HostRoleStatus.PENDING);
  s.getOrderedHostRoleCommands().get(1).setStatus(HostRoleStatus.IN_PROGRESS);
  s.getOrderedHostRoleCommands().get(2).setStatus(HostRoleStatus.QUEUED);
  HostRoleCommand cmd=s.getOrderedHostRoleCommands().get(3);
  String hostName=cmd.getHostName();
  cmd.setStatus(HostRoleStatus.COMPLETED);
  Request request=new Request(stages,clusters);
  db.persistActions(request);
  db.abortOperation(requestId);
  List<Long> aborted=new ArrayList<Long>();
  List<HostRoleCommand> commands=db.getRequestTasks(requestId);
  for (  HostRoleCommand command : commands) {
    if (command.getHostName().equals(hostName)) {
      assertEquals(HostRoleStatus.COMPLETED,command.getStatus());
    }
 else {
      assertEquals(HostRoleStatus.ABORTED,command.getStatus());
      aborted.add(command.getTaskId());
    }
  }
  db.resubmitTasks(aborted);
  commands=db.getRequestTasks(requestId);
  for (  HostRoleCommand command : commands) {
    if (command.getHostName().equals(hostName)) {
      assertEquals(HostRoleStatus.COMPLETED,command.getStatus());
    }
 else {
      assertEquals(HostRoleStatus.PENDING,command.getStatus());
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.agent.TestHeartbeatMonitor </h4><pre class="type-12 type-13 type-10 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHeartbeatStateCommandsEnqueueing() throws AmbariException, InterruptedException, InvalidStateTransitionException {
  StackId stackId=new StackId("HDP-0.1");
  Clusters clusters=injector.getInstance(Clusters.class);
  clusters.addHost(hostname1);
  setOsFamily(clusters.getHost(hostname1),"redhat","5.9");
  clusters.getHost(hostname1).persist();
  clusters.addCluster(clusterName,stackId);
  Cluster cluster=clusters.getCluster(clusterName);
  helper.getOrCreateRepositoryVersion(stackId,stackId.getStackVersion());
  cluster.createClusterVersion(stackId,stackId.getStackVersion(),"admin",RepositoryVersionState.UPGRADING);
  Set<String> hostNames=new HashSet<String>(){
{
      add(hostname1);
    }
  }
;
  clusters.mapHostsToCluster(hostNames,clusterName);
  Service hdfs=cluster.addService(serviceName);
  hdfs.persist();
  hdfs.addServiceComponent(Role.DATANODE.name()).persist();
  hdfs.getServiceComponent(Role.DATANODE.name()).addServiceComponentHost(hostname1).persist();
  hdfs.addServiceComponent(Role.NAMENODE.name()).persist();
  hdfs.getServiceComponent(Role.NAMENODE.name()).addServiceComponentHost(hostname1).persist();
  hdfs.addServiceComponent(Role.SECONDARY_NAMENODE.name()).persist();
  hdfs.getServiceComponent(Role.SECONDARY_NAMENODE.name()).addServiceComponentHost(hostname1).persist();
  hdfs.getServiceComponent(Role.DATANODE.name()).getServiceComponentHost(hostname1).setState(State.INSTALLED);
  hdfs.getServiceComponent(Role.NAMENODE.name()).getServiceComponentHost(hostname1).setState(State.INSTALLED);
  hdfs.getServiceComponent(Role.SECONDARY_NAMENODE.name()).getServiceComponentHost(hostname1).setState(State.INSTALLED);
  ActionQueue aqMock=mock(ActionQueue.class);
  ArgumentCaptor<AgentCommand> commandCaptor=ArgumentCaptor.forClass(AgentCommand.class);
  ActionManager am=mock(ActionManager.class);
  HeartbeatMonitor hm=new HeartbeatMonitor(clusters,aqMock,am,heartbeatMonitorWakeupIntervalMS,injector);
  HeartBeatHandler handler=new HeartBeatHandler(clusters,aqMock,am,injector);
  Register reg=new Register();
  reg.setHostname(hostname1);
  reg.setResponseId(12);
  reg.setTimestamp(System.currentTimeMillis() - 15);
  reg.setAgentVersion(ambariMetaInfo.getServerVersion());
  HostInfo hi=new HostInfo();
  hi.setOS("Centos5");
  reg.setHardwareProfile(hi);
  handler.handleRegistration(reg);
  HeartBeat hb=new HeartBeat();
  hb.setHostname(hostname1);
  hb.setNodeStatus(new HostStatus(HostStatus.Status.HEALTHY,"cool"));
  hb.setTimestamp(System.currentTimeMillis());
  hb.setResponseId(13);
  handler.handleHeartBeat(hb);
  LOG.info("YYY");
  clusters.getHost(hostname1).setLastHeartbeatTime(System.currentTimeMillis() - 15);
  hm.start();
  Thread.sleep(3 * heartbeatMonitorWakeupIntervalMS);
  hm.shutdown();
  int tryNumber=0;
  while (hm.isAlive()) {
    hm.join(2 * heartbeatMonitorWakeupIntervalMS);
    tryNumber++;
    if (tryNumber >= 5) {
      fail("HeartbeatMonitor should be already stopped");
    }
  }
  verify(aqMock,atLeast(2)).enqueue(eq(hostname1),commandCaptor.capture());
  List<AgentCommand> cmds=commandCaptor.getAllValues();
  assertTrue("HeartbeatMonitor should generate StatusCommands for host1",cmds.size() >= 2);
  for (  AgentCommand command : cmds) {
    assertEquals("HDFS",((StatusCommand)command).getServiceName());
  }
}

</code></pre>

<br>
<pre class="type-13 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testHeartbeatLossWithComponent() throws AmbariException, InterruptedException, InvalidStateTransitionException {
  StackId stackId=new StackId("HDP-0.1");
  Clusters clusters=injector.getInstance(Clusters.class);
  clusters.addHost(hostname1);
  setOsFamily(clusters.getHost(hostname1),"redhat","6.3");
  clusters.getHost(hostname1).persist();
  clusters.addCluster(clusterName,stackId);
  Cluster cluster=clusters.getCluster(clusterName);
  helper.getOrCreateRepositoryVersion(stackId,stackId.getStackVersion());
  cluster.createClusterVersion(stackId,stackId.getStackVersion(),"admin",RepositoryVersionState.UPGRADING);
  Set<String> hostNames=new HashSet<String>(){
{
      add(hostname1);
    }
  }
;
  clusters.mapHostsToCluster(hostNames,clusterName);
  Service hdfs=cluster.addService(serviceName);
  hdfs.persist();
  hdfs.addServiceComponent(Role.DATANODE.name()).persist();
  hdfs.getServiceComponent(Role.DATANODE.name()).addServiceComponentHost(hostname1).persist();
  hdfs.addServiceComponent(Role.NAMENODE.name()).persist();
  hdfs.getServiceComponent(Role.NAMENODE.name()).addServiceComponentHost(hostname1).persist();
  hdfs.addServiceComponent(Role.SECONDARY_NAMENODE.name()).persist();
  hdfs.getServiceComponent(Role.SECONDARY_NAMENODE.name()).addServiceComponentHost(hostname1).persist();
  hdfs.addServiceComponent(Role.HDFS_CLIENT.name()).persist();
  hdfs.getServiceComponent(Role.HDFS_CLIENT.name()).addServiceComponentHost(hostname1);
  ActionQueue aq=new ActionQueue();
  ActionManager am=mock(ActionManager.class);
  HeartbeatMonitor hm=new HeartbeatMonitor(clusters,aq,am,10,injector);
  HeartBeatHandler handler=new HeartBeatHandler(clusters,aq,am,injector);
  Register reg=new Register();
  reg.setHostname(hostname1);
  reg.setResponseId(12);
  reg.setTimestamp(System.currentTimeMillis() - 300);
  reg.setAgentVersion(ambariMetaInfo.getServerVersion());
  HostInfo hi=new HostInfo();
  hi.setOS("Centos5");
  reg.setHardwareProfile(hi);
  handler.handleRegistration(reg);
  cluster=clusters.getClustersForHost(hostname1).iterator().next();
  for (  ServiceComponentHost sch : cluster.getServiceComponentHosts(hostname1)) {
    if (sch.getServiceComponentName().equals("NAMENODE")) {
      sch.handleEvent(new ServiceComponentHostInstallEvent(sch.getServiceComponentName(),sch.getHostName(),System.currentTimeMillis(),"HDP-0.1"));
      sch.handleEvent(new ServiceComponentHostOpSucceededEvent(sch.getServiceComponentName(),sch.getHostName(),System.currentTimeMillis()));
      sch.handleEvent(new ServiceComponentHostStartedEvent(sch.getServiceComponentName(),sch.getHostName(),System.currentTimeMillis()));
    }
 else     if (sch.getServiceComponentName().equals("DATANODE")) {
      sch.handleEvent(new ServiceComponentHostInstallEvent(sch.getServiceComponentName(),sch.getHostName(),System.currentTimeMillis(),"HDP-0.1"));
    }
 else     if (sch.getServiceComponentName().equals("SECONDARY_NAMENODE")) {
      sch.handleEvent(new ServiceComponentHostInstallEvent(sch.getServiceComponentName(),sch.getHostName(),System.currentTimeMillis(),"HDP-0.1"));
      sch.handleEvent(new ServiceComponentHostOpSucceededEvent(sch.getServiceComponentName(),sch.getHostName(),System.currentTimeMillis()));
      sch.handleEvent(new ServiceComponentHostDisableEvent(sch.getServiceComponentName(),sch.getHostName(),System.currentTimeMillis()));
    }
  }
  HeartBeat hb=new HeartBeat();
  hb.setHostname(hostname1);
  hb.setNodeStatus(new HostStatus(HostStatus.Status.HEALTHY,"cool"));
  hb.setTimestamp(System.currentTimeMillis());
  hb.setResponseId(12);
  handler.handleHeartBeat(hb);
  hm.start();
  aq.enqueue(hostname1,new ExecutionCommand());
  while (aq.size(hostname1) != 0) {
    Thread.sleep(1);
  }
  hm.shutdown();
  cluster=clusters.getClustersForHost(hostname1).iterator().next();
  for (  ServiceComponentHost sch : cluster.getServiceComponentHosts(hostname1)) {
    Service s=cluster.getService(sch.getServiceName());
    ServiceComponent sc=s.getServiceComponent(sch.getServiceComponentName());
    if (sch.getServiceComponentName().equals("NAMENODE")) {
      assertEquals(sch.getServiceComponentName(),State.UNKNOWN,sch.getState());
    }
 else     if (sch.getServiceComponentName().equals("DATANODE")) {
      assertEquals(sch.getServiceComponentName(),State.INSTALLING,sch.getState());
    }
 else     if (sc.isClientComponent()) {
      assertEquals(sch.getServiceComponentName(),State.INIT,sch.getState());
    }
 else     if (sch.getServiceComponentName().equals("SECONDARY_NAMENODE")) {
      assertEquals(sch.getServiceComponentName(),State.DISABLED,sch.getState());
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.api.handlers.CreateHandlerTest </h4><pre class="type-13 type-10 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHandleRequest__Synchronous() throws Exception {
  Request request=createNiceMock(Request.class);
  RequestBody body=createNiceMock(RequestBody.class);
  ResourceInstance resource=createNiceMock(ResourceInstance.class);
  ResourceDefinition resourceDefinition=createNiceMock(ResourceDefinition.class);
  Query query=createStrictMock(Query.class);
  PersistenceManager pm=createStrictMock(PersistenceManager.class);
  RequestStatus status=createNiceMock(RequestStatus.class);
  Resource resource1=createNiceMock(Resource.class);
  Resource resource2=createNiceMock(Resource.class);
  Renderer renderer=new DefaultRenderer();
  Set<Resource> setResources=new HashSet<Resource>();
  setResources.add(resource1);
  setResources.add(resource2);
  expect(request.getResource()).andReturn(resource).atLeastOnce();
  expect(request.getQueryPredicate()).andReturn(null).atLeastOnce();
  expect(request.getRenderer()).andReturn(renderer);
  expect(request.getBody()).andReturn(body).atLeastOnce();
  expect(resource.getQuery()).andReturn(query);
  query.setRenderer(renderer);
  expect(resource.getResourceDefinition()).andReturn(resourceDefinition).anyTimes();
  expect(resourceDefinition.isCreatable()).andReturn(true).anyTimes();
  expect(pm.create(resource,body)).andReturn(status);
  expect(status.getStatus()).andReturn(RequestStatus.Status.Complete);
  expect(status.getAssociatedResources()).andReturn(setResources);
  expect(resource1.getType()).andReturn(Resource.Type.Cluster).anyTimes();
  expect(resource2.getType()).andReturn(Resource.Type.Cluster).anyTimes();
  replay(request,body,resource,resourceDefinition,query,pm,status,resource1,resource2);
  Result result=new TestCreateHandler(pm).handleRequest(request);
  assertNotNull(result);
  TreeNode<Resource> tree=result.getResultTree();
  assertEquals(1,tree.getChildren().size());
  TreeNode<Resource> resourcesNode=tree.getChild("resources");
  assertEquals(2,resourcesNode.getChildren().size());
  boolean foundResource1=false;
  boolean foundResource2=false;
  for (  TreeNode<Resource> child : resourcesNode.getChildren()) {
    Resource r=child.getObject();
    if (r == resource1 && !foundResource1) {
      foundResource1=true;
    }
 else     if (r == resource2 && !foundResource2) {
      foundResource2=true;
    }
 else {
      fail();
    }
  }
  assertEquals(ResultStatus.STATUS.CREATED,result.getStatus().getStatus());
  verify(request,body,resource,resourceDefinition,query,pm,status,resource1,resource2);
}

</code></pre>

<br>
<pre class="type-13 type-10 type-2 type-15 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHandleRequest__Asynchronous() throws Exception {
  Request request=createNiceMock(Request.class);
  RequestBody body=createNiceMock(RequestBody.class);
  ResourceInstance resource=createNiceMock(ResourceInstance.class);
  ResourceDefinition resourceDefinition=createNiceMock(ResourceDefinition.class);
  Query query=createStrictMock(Query.class);
  PersistenceManager pm=createStrictMock(PersistenceManager.class);
  RequestStatus status=createNiceMock(RequestStatus.class);
  Resource resource1=createNiceMock(Resource.class);
  Resource resource2=createNiceMock(Resource.class);
  Resource requestResource=createNiceMock(Resource.class);
  Renderer renderer=new DefaultRenderer();
  Set<Resource> setResources=new HashSet<Resource>();
  setResources.add(resource1);
  setResources.add(resource2);
  expect(request.getResource()).andReturn(resource).atLeastOnce();
  expect(request.getBody()).andReturn(body).atLeastOnce();
  expect(request.getQueryPredicate()).andReturn(null).atLeastOnce();
  expect(request.getRenderer()).andReturn(renderer);
  expect(resource.getQuery()).andReturn(query);
  query.setRenderer(renderer);
  expect(resource.getResourceDefinition()).andReturn(resourceDefinition).anyTimes();
  expect(resourceDefinition.isCreatable()).andReturn(true).anyTimes();
  expect(pm.create(resource,body)).andReturn(status);
  expect(status.getStatus()).andReturn(RequestStatus.Status.Accepted);
  expect(status.getAssociatedResources()).andReturn(setResources);
  expect(resource1.getType()).andReturn(Resource.Type.Cluster).anyTimes();
  expect(resource2.getType()).andReturn(Resource.Type.Cluster).anyTimes();
  expect(status.getRequestResource()).andReturn(requestResource).anyTimes();
  replay(request,body,resource,resourceDefinition,query,pm,status,resource1,resource2,requestResource);
  Result result=new TestCreateHandler(pm).handleRequest(request);
  assertNotNull(result);
  TreeNode<Resource> tree=result.getResultTree();
  assertEquals(2,tree.getChildren().size());
  TreeNode<Resource> resourcesNode=tree.getChild("resources");
  assertEquals(2,resourcesNode.getChildren().size());
  boolean foundResource1=false;
  boolean foundResource2=false;
  for (  TreeNode<Resource> child : resourcesNode.getChildren()) {
    Resource r=child.getObject();
    if (r == resource1 && !foundResource1) {
      foundResource1=true;
    }
 else     if (r == resource2 && !foundResource2) {
      foundResource2=true;
    }
 else {
      fail();
    }
  }
  TreeNode<Resource> statusNode=tree.getChild("request");
  assertNotNull(statusNode);
  assertEquals(0,statusNode.getChildren().size());
  assertSame(requestResource,statusNode.getObject());
  assertEquals(ResultStatus.STATUS.ACCEPTED,result.getStatus().getStatus());
  verify(request,body,resource,resourceDefinition,query,pm,status,resource1,resource2,requestResource);
}

</code></pre>

<br>
<pre class="type-13 type-10 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHandleRequest__Synchronous_NoPropsInBody() throws Exception {
  Request request=createNiceMock(Request.class);
  RequestBody body=createNiceMock(RequestBody.class);
  ResourceInstance resource=createNiceMock(ResourceInstance.class);
  ResourceDefinition resourceDefinition=createNiceMock(ResourceDefinition.class);
  Query query=createStrictMock(Query.class);
  PersistenceManager pm=createStrictMock(PersistenceManager.class);
  RequestStatus status=createNiceMock(RequestStatus.class);
  Resource resource1=createNiceMock(Resource.class);
  Resource resource2=createNiceMock(Resource.class);
  Renderer renderer=new DefaultRenderer();
  Set<Resource> setResources=new HashSet<Resource>();
  setResources.add(resource1);
  setResources.add(resource2);
  expect(request.getResource()).andReturn(resource).atLeastOnce();
  expect(request.getQueryPredicate()).andReturn(null).atLeastOnce();
  expect(request.getRenderer()).andReturn(renderer);
  expect(request.getBody()).andReturn(body);
  expect(resource.getQuery()).andReturn(query);
  query.setRenderer(renderer);
  expect(resource.getResourceDefinition()).andReturn(resourceDefinition).anyTimes();
  expect(resourceDefinition.isCreatable()).andReturn(true).anyTimes();
  expect(pm.create(resource,body)).andReturn(status);
  expect(status.getStatus()).andReturn(RequestStatus.Status.Complete);
  expect(status.getAssociatedResources()).andReturn(setResources);
  expect(resource1.getType()).andReturn(Resource.Type.Cluster).anyTimes();
  expect(resource2.getType()).andReturn(Resource.Type.Cluster).anyTimes();
  replay(request,body,resource,resourceDefinition,query,pm,status,resource1,resource2);
  Result result=new TestCreateHandler(pm).handleRequest(request);
  assertNotNull(result);
  TreeNode<Resource> tree=result.getResultTree();
  assertEquals(1,tree.getChildren().size());
  TreeNode<Resource> resourcesNode=tree.getChild("resources");
  assertEquals(2,resourcesNode.getChildren().size());
  boolean foundResource1=false;
  boolean foundResource2=false;
  for (  TreeNode<Resource> child : resourcesNode.getChildren()) {
    Resource r=child.getObject();
    if (r == resource1 && !foundResource1) {
      foundResource1=true;
    }
 else     if (r == resource2 && !foundResource2) {
      foundResource2=true;
    }
 else {
      fail();
    }
  }
  assertEquals(ResultStatus.STATUS.CREATED,result.getStatus().getStatus());
  verify(request,body,resource,resourceDefinition,query,pm,status,resource1,resource2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.api.handlers.DeleteHandlerTest </h4><pre class="type-13 type-10 type-2 type-15 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHandleRequest__Asynchronous() throws Exception {
  Request request=createMock(Request.class);
  RequestBody body=createNiceMock(RequestBody.class);
  ResourceInstance resource=createMock(ResourceInstance.class);
  PersistenceManager pm=createStrictMock(PersistenceManager.class);
  RequestStatus status=createMock(RequestStatus.class);
  Resource resource1=createMock(Resource.class);
  Resource resource2=createMock(Resource.class);
  Resource requestResource=createMock(Resource.class);
  Query query=createNiceMock(Query.class);
  Renderer renderer=new DefaultRenderer();
  Set<Resource> setResources=new HashSet<Resource>();
  setResources.add(resource1);
  setResources.add(resource2);
  expect(request.getResource()).andReturn(resource).anyTimes();
  expect(request.getBody()).andReturn(body).atLeastOnce();
  expect(request.getQueryPredicate()).andReturn(null).atLeastOnce();
  expect(resource.getQuery()).andReturn(query).atLeastOnce();
  expect(request.getRenderer()).andReturn(renderer);
  query.setRenderer(renderer);
  expect(pm.delete(resource,body)).andReturn(status);
  expect(status.getStatus()).andReturn(RequestStatus.Status.Accepted);
  expect(status.getAssociatedResources()).andReturn(setResources);
  expect(resource1.getType()).andReturn(Resource.Type.Cluster).anyTimes();
  expect(resource2.getType()).andReturn(Resource.Type.Cluster).anyTimes();
  expect(status.getRequestResource()).andReturn(requestResource).anyTimes();
  replay(request,body,resource,pm,status,resource1,resource2,requestResource,query);
  Result result=new TestDeleteHandler(pm).handleRequest(request);
  assertNotNull(result);
  TreeNode<Resource> tree=result.getResultTree();
  assertEquals(2,tree.getChildren().size());
  TreeNode<Resource> resourcesNode=tree.getChild("resources");
  assertEquals(2,resourcesNode.getChildren().size());
  boolean foundResource1=false;
  boolean foundResource2=false;
  for (  TreeNode<Resource> child : resourcesNode.getChildren()) {
    Resource r=child.getObject();
    if (r == resource1 && !foundResource1) {
      foundResource1=true;
    }
 else     if (r == resource2 && !foundResource2) {
      foundResource2=true;
    }
 else {
      fail();
    }
  }
  TreeNode<Resource> statusNode=tree.getChild("request");
  assertNotNull(statusNode);
  assertEquals(0,statusNode.getChildren().size());
  assertSame(requestResource,statusNode.getObject());
  assertEquals(ResultStatus.STATUS.ACCEPTED,result.getStatus().getStatus());
  verify(request,body,resource,pm,status,resource1,resource2,requestResource,query);
}

</code></pre>

<br>
<pre class="type-13 type-10 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHandleRequest__Synchronous() throws Exception {
  Request request=createMock(Request.class);
  RequestBody body=createNiceMock(RequestBody.class);
  ResourceInstance resource=createMock(ResourceInstance.class);
  PersistenceManager pm=createStrictMock(PersistenceManager.class);
  RequestStatus status=createMock(RequestStatus.class);
  Resource resource1=createMock(Resource.class);
  Resource resource2=createMock(Resource.class);
  Predicate userPredicate=createNiceMock(Predicate.class);
  Query query=createNiceMock(Query.class);
  Renderer renderer=new DefaultRenderer();
  Set<Resource> setResources=new HashSet<Resource>();
  setResources.add(resource1);
  setResources.add(resource2);
  expect(request.getResource()).andReturn(resource).atLeastOnce();
  expect(request.getBody()).andReturn(body).atLeastOnce();
  expect(request.getQueryPredicate()).andReturn(userPredicate).atLeastOnce();
  expect(resource.getQuery()).andReturn(query).atLeastOnce();
  expect(request.getRenderer()).andReturn(renderer);
  query.setRenderer(renderer);
  query.setUserPredicate(userPredicate);
  expect(pm.delete(resource,body)).andReturn(status);
  expect(status.getStatus()).andReturn(RequestStatus.Status.Complete);
  expect(status.getAssociatedResources()).andReturn(setResources);
  expect(resource1.getType()).andReturn(Resource.Type.Cluster).anyTimes();
  expect(resource2.getType()).andReturn(Resource.Type.Cluster).anyTimes();
  replay(request,body,resource,pm,status,resource1,resource2,userPredicate,query);
  Result result=new TestDeleteHandler(pm).handleRequest(request);
  assertNotNull(result);
  TreeNode<Resource> tree=result.getResultTree();
  assertEquals(1,tree.getChildren().size());
  TreeNode<Resource> resourcesNode=tree.getChild("resources");
  assertEquals(2,resourcesNode.getChildren().size());
  boolean foundResource1=false;
  boolean foundResource2=false;
  for (  TreeNode<Resource> child : resourcesNode.getChildren()) {
    Resource r=child.getObject();
    if (r == resource1 && !foundResource1) {
      foundResource1=true;
    }
 else     if (r == resource2 && !foundResource2) {
      foundResource2=true;
    }
 else {
      fail();
    }
  }
  assertEquals(ResultStatus.STATUS.OK,result.getStatus().getStatus());
  verify(request,body,resource,pm,status,resource1,resource2,userPredicate,query);
}

</code></pre>

<br>
<pre class="type-13 type-10 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHandleRequest__Synchronous_NoPropsInBody() throws Exception {
  Request request=createMock(Request.class);
  RequestBody body=createNiceMock(RequestBody.class);
  ResourceInstance resource=createMock(ResourceInstance.class);
  PersistenceManager pm=createStrictMock(PersistenceManager.class);
  RequestStatus status=createMock(RequestStatus.class);
  Resource resource1=createMock(Resource.class);
  Resource resource2=createMock(Resource.class);
  Predicate userPredicate=createNiceMock(Predicate.class);
  Query query=createNiceMock(Query.class);
  Renderer renderer=new DefaultRenderer();
  Set<Resource> setResources=new HashSet<Resource>();
  setResources.add(resource1);
  setResources.add(resource2);
  expect(request.getResource()).andReturn(resource).atLeastOnce();
  expect(request.getBody()).andReturn(body).atLeastOnce();
  expect(request.getQueryPredicate()).andReturn(userPredicate).atLeastOnce();
  expect(resource.getQuery()).andReturn(query).atLeastOnce();
  expect(request.getRenderer()).andReturn(renderer);
  query.setRenderer(renderer);
  query.setUserPredicate(userPredicate);
  expect(pm.delete(resource,body)).andReturn(status);
  expect(status.getStatus()).andReturn(RequestStatus.Status.Complete);
  expect(status.getAssociatedResources()).andReturn(setResources);
  expect(resource1.getType()).andReturn(Resource.Type.Cluster).anyTimes();
  expect(resource2.getType()).andReturn(Resource.Type.Cluster).anyTimes();
  replay(request,body,resource,pm,status,resource1,resource2,userPredicate,query);
  Result result=new TestDeleteHandler(pm).handleRequest(request);
  assertNotNull(result);
  TreeNode<Resource> tree=result.getResultTree();
  assertEquals(1,tree.getChildren().size());
  TreeNode<Resource> resourcesNode=tree.getChild("resources");
  assertEquals(2,resourcesNode.getChildren().size());
  boolean foundResource1=false;
  boolean foundResource2=false;
  for (  TreeNode<Resource> child : resourcesNode.getChildren()) {
    Resource r=child.getObject();
    if (r == resource1 && !foundResource1) {
      foundResource1=true;
    }
 else     if (r == resource2 && !foundResource2) {
      foundResource2=true;
    }
 else {
      fail();
    }
  }
  assertEquals(ResultStatus.STATUS.OK,result.getStatus().getStatus());
  verify(request,body,resource,pm,status,resource1,resource2,userPredicate,query);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.api.handlers.UpdateHandlerTest </h4><pre class="type-13 type-10 type-2 type-15 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHandleRequest__Asynchronous() throws Exception {
  Request request=createMock(Request.class);
  RequestBody body=createNiceMock(RequestBody.class);
  ResourceInstance resource=createMock(ResourceInstance.class);
  PersistenceManager pm=createStrictMock(PersistenceManager.class);
  RequestStatus status=createMock(RequestStatus.class);
  Resource resource1=createMock(Resource.class);
  Resource resource2=createMock(Resource.class);
  Resource requestResource=createMock(Resource.class);
  Predicate userPredicate=createNiceMock(Predicate.class);
  Query query=createNiceMock(Query.class);
  Renderer renderer=new DefaultRenderer();
  Set<Resource> setResources=new HashSet<Resource>();
  setResources.add(resource1);
  setResources.add(resource2);
  expect(request.getResource()).andReturn(resource).anyTimes();
  expect(request.getBody()).andReturn(body).anyTimes();
  expect(request.getQueryPredicate()).andReturn(userPredicate).atLeastOnce();
  expect(request.getRenderer()).andReturn(renderer);
  expect(resource.getQuery()).andReturn(query).atLeastOnce();
  query.setRenderer(renderer);
  query.setUserPredicate(userPredicate);
  expect(pm.update(resource,body)).andReturn(status);
  expect(status.getStatus()).andReturn(RequestStatus.Status.Accepted);
  expect(status.getAssociatedResources()).andReturn(setResources);
  expect(resource1.getType()).andReturn(Resource.Type.Cluster).anyTimes();
  expect(resource2.getType()).andReturn(Resource.Type.Cluster).anyTimes();
  expect(status.getRequestResource()).andReturn(requestResource).anyTimes();
  replay(request,body,resource,pm,status,resource1,resource2,requestResource,userPredicate,query);
  Result result=new TestUpdateHandler(pm).handleRequest(request);
  assertNotNull(result);
  TreeNode<Resource> tree=result.getResultTree();
  assertEquals(2,tree.getChildren().size());
  TreeNode<Resource> resourcesNode=tree.getChild("resources");
  assertEquals(2,resourcesNode.getChildren().size());
  boolean foundResource1=false;
  boolean foundResource2=false;
  for (  TreeNode<Resource> child : resourcesNode.getChildren()) {
    Resource r=child.getObject();
    if (r == resource1 && !foundResource1) {
      foundResource1=true;
    }
 else     if (r == resource2 && !foundResource2) {
      foundResource2=true;
    }
 else {
      fail();
    }
  }
  TreeNode<Resource> statusNode=tree.getChild("request");
  assertNotNull(statusNode);
  assertEquals(0,statusNode.getChildren().size());
  assertSame(requestResource,statusNode.getObject());
  assertEquals(ResultStatus.STATUS.ACCEPTED,result.getStatus().getStatus());
  verify(request,body,resource,pm,status,resource1,resource2,requestResource,userPredicate,query);
}

</code></pre>

<br>
<pre class="type-13 type-10 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHandleRequest__Synchronous() throws Exception {
  Request request=createMock(Request.class);
  RequestBody body=createNiceMock(RequestBody.class);
  ResourceInstance resource=createMock(ResourceInstance.class);
  PersistenceManager pm=createStrictMock(PersistenceManager.class);
  RequestStatus status=createMock(RequestStatus.class);
  Resource resource1=createMock(Resource.class);
  Resource resource2=createMock(Resource.class);
  Predicate userPredicate=createNiceMock(Predicate.class);
  Query query=createNiceMock(Query.class);
  Renderer renderer=new DefaultRenderer();
  Set<Resource> setResources=new HashSet<Resource>();
  setResources.add(resource1);
  setResources.add(resource2);
  expect(request.getResource()).andReturn(resource).anyTimes();
  expect(request.getBody()).andReturn(body).anyTimes();
  expect(request.getQueryPredicate()).andReturn(userPredicate).atLeastOnce();
  expect(request.getRenderer()).andReturn(renderer);
  expect(resource.getQuery()).andReturn(query).atLeastOnce();
  query.setRenderer(renderer);
  query.setUserPredicate(userPredicate);
  expect(pm.update(resource,body)).andReturn(status);
  expect(status.getStatus()).andReturn(RequestStatus.Status.Complete);
  expect(status.getAssociatedResources()).andReturn(setResources);
  expect(resource1.getType()).andReturn(Resource.Type.Cluster).anyTimes();
  expect(resource2.getType()).andReturn(Resource.Type.Cluster).anyTimes();
  replay(request,body,resource,pm,status,resource1,resource2,userPredicate,query);
  Result result=new TestUpdateHandler(pm).handleRequest(request);
  assertNotNull(result);
  TreeNode<Resource> tree=result.getResultTree();
  assertEquals(1,tree.getChildren().size());
  TreeNode<Resource> resourcesNode=tree.getChild("resources");
  assertEquals(2,resourcesNode.getChildren().size());
  boolean foundResource1=false;
  boolean foundResource2=false;
  for (  TreeNode<Resource> child : resourcesNode.getChildren()) {
    Resource r=child.getObject();
    if (r == resource1 && !foundResource1) {
      foundResource1=true;
    }
 else     if (r == resource2 && !foundResource2) {
      foundResource2=true;
    }
 else {
      fail();
    }
  }
  assertEquals(ResultStatus.STATUS.OK,result.getStatus().getStatus());
  verify(request,body,resource,pm,status,resource1,resource2,userPredicate,query);
}

</code></pre>

<br>
<pre class="type-13 type-10 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHandleRequest__Synchronous_NoPropsInBody() throws Exception {
  Request request=createMock(Request.class);
  RequestBody body=createNiceMock(RequestBody.class);
  ResourceInstance resource=createMock(ResourceInstance.class);
  PersistenceManager pm=createStrictMock(PersistenceManager.class);
  RequestStatus status=createMock(RequestStatus.class);
  Resource resource1=createMock(Resource.class);
  Resource resource2=createMock(Resource.class);
  Predicate userPredicate=createNiceMock(Predicate.class);
  Query query=createNiceMock(Query.class);
  Renderer renderer=new DefaultRenderer();
  Set<Resource> setResources=new HashSet<Resource>();
  setResources.add(resource1);
  setResources.add(resource2);
  expect(request.getResource()).andReturn(resource).anyTimes();
  expect(request.getBody()).andReturn(body).anyTimes();
  expect(request.getQueryPredicate()).andReturn(userPredicate).atLeastOnce();
  expect(request.getRenderer()).andReturn(renderer);
  expect(resource.getQuery()).andReturn(query).atLeastOnce();
  query.setRenderer(renderer);
  query.setUserPredicate(userPredicate);
  expect(pm.update(resource,body)).andReturn(status);
  expect(status.getStatus()).andReturn(RequestStatus.Status.Complete);
  expect(status.getAssociatedResources()).andReturn(setResources);
  expect(resource1.getType()).andReturn(Resource.Type.Cluster).anyTimes();
  expect(resource2.getType()).andReturn(Resource.Type.Cluster).anyTimes();
  replay(request,body,resource,pm,status,resource1,resource2,userPredicate,query);
  Result result=new TestUpdateHandler(pm).handleRequest(request);
  assertNotNull(result);
  TreeNode<Resource> tree=result.getResultTree();
  assertEquals(1,tree.getChildren().size());
  TreeNode<Resource> resourcesNode=tree.getChild("resources");
  assertEquals(2,resourcesNode.getChildren().size());
  boolean foundResource1=false;
  boolean foundResource2=false;
  for (  TreeNode<Resource> child : resourcesNode.getChildren()) {
    Resource r=child.getObject();
    if (r == resource1 && !foundResource1) {
      foundResource1=true;
    }
 else     if (r == resource2 && !foundResource2) {
      foundResource2=true;
    }
 else {
      fail();
    }
  }
  assertEquals(ResultStatus.STATUS.OK,result.getStatus().getStatus());
  verify(request,body,resource,pm,status,resource1,resource2,userPredicate,query);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.api.query.QueryImplTest </h4><pre class="type-4 type-13 type-10 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetJoinedResourceProperties() throws Exception {
  ResourceDefinition resourceDefinition=new StackResourceDefinition();
  Map<Resource.Type,String> mapIds=new HashMap<Resource.Type,String>();
  mapIds.put(Resource.Type.Stack,"HDP");
  QueryImpl instance=new TestQuery(mapIds,resourceDefinition);
  instance.addProperty("versions/*",null);
  instance.addProperty("versions/operating_systems/*",null);
  instance.addProperty("versions/operating_systems/repositories/*",null);
  instance.execute();
  Set<String> propertyIds=new HashSet<String>();
  propertyIds.add("versions/operating_systems/repositories/Repositories/repo_id");
  propertyIds.add("versions/operating_systems/OperatingSystems/os_type");
  Map<Resource,Set<Map<String,Object>>> resourcePropertiesMap=instance.getJoinedResourceProperties(propertyIds,null,null);
  Set<Map<String,Object>> propertyMaps=null;
  for (  Map.Entry<Resource,Set<Map<String,Object>>> resourceSetEntry : resourcePropertiesMap.entrySet()) {
    Assert.assertEquals(Resource.Type.Stack,resourceSetEntry.getKey().getType());
    propertyMaps=resourceSetEntry.getValue();
  }
  if (propertyMaps == null) {
    fail("No property maps found!");
  }
  Assert.assertEquals(6,propertyMaps.size());
  for (  Map<String,Object> map : propertyMaps) {
    Assert.assertEquals(2,map.size());
    Assert.assertTrue(map.containsKey("versions/operating_systems/OperatingSystems/os_type"));
    Assert.assertTrue(map.containsKey("versions/operating_systems/repositories/Repositories/repo_id"));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.api.query.render.ClusterBlueprintRendererTest </h4><pre class="type-4 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFinalizeResultWithAttributes() throws Exception {
  ServiceInfo hdfsService=new ServiceInfo();
  hdfsService.setName("HDFS");
  ServiceInfo mrService=new ServiceInfo();
  mrService.setName("MAPREDUCE");
  Result result=new ResultImpl(true);
  Map<String,Object> testDesiredConfigMap=new HashMap<String,Object>();
  DesiredConfig testDesiredConfig=new DesiredConfig();
  testDesiredConfig.setTag("test-tag-one");
  testDesiredConfigMap.put("test-type-one",testDesiredConfig);
  createClusterResultTree(result.getResultTree(),testDesiredConfigMap);
  ClusterBlueprintRenderer renderer=new TestBlueprintRenderer(topology);
  Result blueprintResult=renderer.finalizeResult(result);
  TreeNode<Resource> blueprintTree=blueprintResult.getResultTree();
  assertNull(blueprintTree.getStringProperty("isCollection"));
  assertEquals(1,blueprintTree.getChildren().size());
  TreeNode<Resource> blueprintNode=blueprintTree.getChildren().iterator().next();
  assertEquals(0,blueprintNode.getChildren().size());
  Resource blueprintResource=blueprintNode.getObject();
  Map<String,Map<String,Object>> properties=blueprintResource.getPropertiesMap();
  assertEquals("HDP",properties.get("Blueprints").get("stack_name"));
  assertEquals("1.3.3",properties.get("Blueprints").get("stack_version"));
  Collection<Map<String,Object>> host_groups=(Collection<Map<String,Object>>)properties.get("").get("host_groups");
  assertEquals(2,host_groups.size());
  for (  Map<String,Object> hostGroupProperties : host_groups) {
    String host_group_name=(String)hostGroupProperties.get("name");
    if (host_group_name.equals("host_group_1")) {
      assertEquals("1",hostGroupProperties.get("cardinality"));
      Collection<Map<String,String>> components=(Collection<Map<String,String>>)hostGroupProperties.get("components");
      assertEquals(5,components.size());
      Set<String> expectedValues=new HashSet<String>(Arrays.asList("JOBTRACKER","TASKTRACKER","NAMENODE","DATANODE","AMBARI_SERVER"));
      Set<String> actualValues=new HashSet<String>();
      for (      Map<String,String> componentProperties : components) {
        assertEquals(1,componentProperties.size());
        actualValues.add(componentProperties.get("name"));
      }
      assertEquals(expectedValues,actualValues);
    }
 else     if (host_group_name.equals("host_group_2")) {
      assertEquals("2",hostGroupProperties.get("cardinality"));
      Collection<Map<String,String>> components=(Collection<Map<String,String>>)hostGroupProperties.get("components");
      assertEquals(2,components.size());
      Set<String> expectedValues=new HashSet<String>(Arrays.asList("TASKTRACKER","DATANODE"));
      Set<String> actualValues=new HashSet<String>();
      for (      Map<String,String> componentProperties : components) {
        assertEquals(1,componentProperties.size());
        actualValues.add(componentProperties.get("name"));
      }
      assertEquals(expectedValues,actualValues);
    }
  }
  List<Map<String,Map<String,Map<String,?>>>> configurationsResult=(List<Map<String,Map<String,Map<String,?>>>>)blueprintResource.getPropertyValue("configurations");
  assertEquals("Incorrect number of config maps added",1,configurationsResult.size());
  Map<String,Map<String,?>> configMap=configurationsResult.iterator().next().get("test-type-one");
  assertNotNull("Expected config map was not included",configMap);
  assertEquals("Incorrect number of maps added under expected type",2,configMap.size());
  assertTrue("Expected properties map was not found",configMap.containsKey("properties"));
  assertTrue("Expected properties_attributes map was not found",configMap.containsKey("properties_attributes"));
  Map<String,?> propertiesResult=configMap.get("properties");
  assertEquals("Incorrect number of config properties found",1,propertiesResult.size());
  Map<String,?> attributesResult=configMap.get("properties_attributes");
  assertEquals("Incorrect number of config attributes found",1,attributesResult.size());
  assertEquals("Incorrect property value included","valueOne",propertiesResult.get("propertyOne"));
  assertNotNull("Expected attribute not found in exported Blueprint",attributesResult.get("final"));
  assertTrue("Attribute type map was not included",attributesResult.get("final") instanceof Map);
  Map<String,?> finalMap=(Map<String,?>)attributesResult.get("final");
  assertEquals("Attribute value is not correct","true",finalMap.get("propertyOne"));
}

</code></pre>

<br>
<pre class="type-4 type-13 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFinalizeResult() throws Exception {
  Result result=new ResultImpl(true);
  createClusterResultTree(result.getResultTree());
  ClusterBlueprintRenderer renderer=new TestBlueprintRenderer(topology);
  Result blueprintResult=renderer.finalizeResult(result);
  TreeNode<Resource> blueprintTree=blueprintResult.getResultTree();
  assertNull(blueprintTree.getStringProperty("isCollection"));
  assertEquals(1,blueprintTree.getChildren().size());
  TreeNode<Resource> blueprintNode=blueprintTree.getChildren().iterator().next();
  assertEquals(0,blueprintNode.getChildren().size());
  Resource blueprintResource=blueprintNode.getObject();
  Map<String,Map<String,Object>> properties=blueprintResource.getPropertiesMap();
  assertEquals("HDP",properties.get("Blueprints").get("stack_name"));
  assertEquals("1.3.3",properties.get("Blueprints").get("stack_version"));
  Collection<Map<String,Object>> host_groups=(Collection<Map<String,Object>>)properties.get("").get("host_groups");
  assertEquals(2,host_groups.size());
  for (  Map<String,Object> hostGroupProperties : host_groups) {
    String host_group_name=(String)hostGroupProperties.get("name");
    if (host_group_name.equals("host_group_1")) {
      assertEquals("1",hostGroupProperties.get("cardinality"));
      Collection<Map<String,String>> components=(Collection<Map<String,String>>)hostGroupProperties.get("components");
      assertEquals(5,components.size());
      Set<String> expectedValues=new HashSet<String>(Arrays.asList("JOBTRACKER","TASKTRACKER","NAMENODE","DATANODE","AMBARI_SERVER"));
      Set<String> actualValues=new HashSet<String>();
      for (      Map<String,String> componentProperties : components) {
        assertEquals(1,componentProperties.size());
        actualValues.add(componentProperties.get("name"));
      }
      assertEquals(expectedValues,actualValues);
    }
 else     if (host_group_name.equals("host_group_2")) {
      assertEquals("2",hostGroupProperties.get("cardinality"));
      Collection<Map<String,String>> components=(Collection<Map<String,String>>)hostGroupProperties.get("components");
      assertEquals(2,components.size());
      Set<String> expectedValues=new HashSet<String>(Arrays.asList("TASKTRACKER","DATANODE"));
      Set<String> actualValues=new HashSet<String>();
      for (      Map<String,String> componentProperties : components) {
        assertEquals(1,componentProperties.size());
        actualValues.add(componentProperties.get("name"));
      }
      assertEquals(expectedValues,actualValues);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.api.services.AmbariMetaInfoTest </h4><pre class="type-4 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetRepositoryUpdatedBaseUrl() throws Exception {
  String buildDir=tmpFolder.getRoot().getAbsolutePath();
  TestAmbariMetaInfo ambariMetaInfo=setupTempAmbariMetaInfo(buildDir);
  String newBaseUrl="http://myprivate-repo-1.hortonworks.com/HDP/centos6/2.x/updates/2.0.6.0";
  ambariMetaInfo.updateRepoBaseURL(STACK_NAME_HDP,"2.1.1","redhat6",HDP_REPO_ID,newBaseUrl);
  RepositoryInfo repoInfo=ambariMetaInfo.getRepository(STACK_NAME_HDP,"2.1.1","redhat6",HDP_REPO_ID);
  assertEquals(newBaseUrl,repoInfo.getBaseUrl());
  String prevBaseUrl=repoInfo.getDefaultBaseUrl();
  MetainfoDAO metainfoDAO=ambariMetaInfo.metaInfoDAO;
  reset(metainfoDAO);
  MetainfoEntity entity=createNiceMock(MetainfoEntity.class);
  expect(metainfoDAO.findByKey("repo:/HDP/2.1.1/redhat6/HDP-2.1.1:baseurl")).andReturn(entity).atLeastOnce();
  expect(entity.getMetainfoValue()).andReturn(newBaseUrl).atLeastOnce();
  replay(metainfoDAO,entity);
  ambariMetaInfo.init();
  waitForAllReposToBeResolved(ambariMetaInfo);
  List<RepositoryInfo> redhat6Repo=ambariMetaInfo.getRepositories(STACK_NAME_HDP,"2.1.1","redhat6");
  assertNotNull(redhat6Repo);
  for (  RepositoryInfo ri : redhat6Repo) {
    if (HDP_REPO_NAME.equals(ri.getRepoName())) {
      assertEquals(newBaseUrl,ri.getBaseUrl());
      assertFalse(ri.getBaseUrl().equals(ri.getDefaultBaseUrl()));
    }
  }
  Capture<MetainfoEntity> c=new Capture<MetainfoEntity>();
  metainfoDAO=ambariMetaInfo.metaInfoDAO;
  reset(metainfoDAO);
  reset(entity);
  expect(metainfoDAO.findByKey("repo:/HDP/2.1.1/redhat6/HDP-2.1.1:baseurl")).andReturn(entity).atLeastOnce();
  expect(metainfoDAO.merge(EasyMock.capture(c))).andReturn(entity).atLeastOnce();
  replay(metainfoDAO,entity);
  ambariMetaInfo.updateRepoBaseURL(STACK_NAME_HDP,"2.1.1","redhat6",HDP_REPO_ID,prevBaseUrl);
  assertEquals(prevBaseUrl,c.getValue().getMetainfoValue());
  assertTrue(repoInfo.isBaseUrlFromSaved());
}

</code></pre>

<br>
<pre class="type-4 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetRepositoryDefault() throws Exception {
  String buildDir=tmpFolder.getRoot().getAbsolutePath();
  AmbariMetaInfo ambariMetaInfo=setupTempAmbariMetaInfo(buildDir);
  ambariMetaInfo.init();
  waitForAllReposToBeResolved(ambariMetaInfo);
  List<RepositoryInfo> redhat6Repo=ambariMetaInfo.getRepositories(STACK_NAME_HDP,"2.1.1","redhat6");
  assertNotNull(redhat6Repo);
  for (  RepositoryInfo ri : redhat6Repo) {
    if (STACK_NAME_HDP.equals(ri.getRepoName())) {
      assertFalse(ri.getBaseUrl().equals(ri.getDefaultBaseUrl()));
      assertEquals(ri.getBaseUrl(),ri.getLatestBaseUrl());
    }
  }
}

</code></pre>

<br>
<pre class="type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCustomConfigDir() throws Exception {
  ServiceInfo service=metaInfo.getService(STACK_NAME_HDP,"2.0.7","MAPREDUCE2");
  boolean found=false;
  for (  PropertyInfo pi : service.getProperties()) {
    if (pi.getName().equals("mr2-prop")) {
      Assert.assertEquals("some-mr2-value",pi.getValue());
      found=true;
    }
  }
  Assert.assertTrue(found);
}

</code></pre>

<br>
<pre class="type-4 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHive134Dependencies() throws Exception {
  ServiceInfo service=metaInfo.getService(STACK_NAME_HDP,"1.3.4","HIVE");
  List<ComponentInfo> componentList=service.getComponents();
  Assert.assertEquals(4,componentList.size());
  for (  ComponentInfo component : componentList) {
    String name=component.getName();
    if (name.equals("HIVE_METASTORE")) {
      Assert.assertEquals(0,component.getDependencies().size());
      AutoDeployInfo autoDeploy=component.getAutoDeploy();
      Assert.assertTrue(autoDeploy.isEnabled());
      Assert.assertEquals("HIVE/HIVE_SERVER",autoDeploy.getCoLocate());
      Assert.assertEquals("1",component.getCardinality());
    }
    if (name.equals("HIVE_SERVER")) {
      List<DependencyInfo> dependencyList=component.getDependencies();
      Assert.assertEquals(1,dependencyList.size());
      DependencyInfo dependency=dependencyList.get(0);
      Assert.assertEquals("ZOOKEEPER/ZOOKEEPER_SERVER",dependency.getName());
      Assert.assertEquals("cluster",dependency.getScope());
      AutoDeployInfo autoDeploy=dependency.getAutoDeploy();
      Assert.assertTrue(autoDeploy.isEnabled());
      Assert.assertEquals("HIVE/HIVE_SERVER",autoDeploy.getCoLocate());
      Assert.assertNull(component.getAutoDeploy());
      Assert.assertEquals("1",component.getCardinality());
    }
    if (name.equals("MYSQL_SERVER")) {
      Assert.assertEquals(0,component.getDependencies().size());
      AutoDeployInfo autoDeploy=component.getAutoDeploy();
      Assert.assertTrue(autoDeploy.isEnabled());
      Assert.assertEquals("HIVE/HIVE_SERVER",autoDeploy.getCoLocate());
      Assert.assertEquals("1",component.getCardinality());
    }
    if (name.equals("HIVE_CLIENT")) {
      Assert.assertEquals(0,component.getDependencies().size());
      Assert.assertNull(component.getAutoDeploy());
      Assert.assertEquals("0+",component.getCardinality());
    }
  }
}

</code></pre>

<br>
<pre class="type-13 type-10 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetRepos() throws Exception {
  Map<String,List<RepositoryInfo>> repos=metaInfo.getRepository(STACK_NAME_HDP,STACK_VERSION_HDP);
  Set<String> centos5Cnt=new HashSet<String>();
  Set<String> centos6Cnt=new HashSet<String>();
  Set<String> redhat6cnt=new HashSet<String>();
  Set<String> redhat5cnt=new HashSet<String>();
  for (  List<RepositoryInfo> vals : repos.values()) {
    for (    RepositoryInfo repo : vals) {
      LOG.debug("Dumping repo info : " + repo.toString());
      if (repo.getOsType().equals("centos5")) {
        centos5Cnt.add(repo.getRepoId());
      }
 else       if (repo.getOsType().equals("centos6")) {
        centos6Cnt.add(repo.getRepoId());
      }
 else       if (repo.getOsType().equals("redhat6")) {
        redhat6cnt.add(repo.getRepoId());
      }
 else       if (repo.getOsType().equals("redhat5")) {
        redhat5cnt.add(repo.getRepoId());
      }
 else {
        fail("Found invalid os " + repo.getOsType());
      }
      if (repo.getRepoId().equals("epel")) {
        assertFalse(repo.getMirrorsList().isEmpty());
        assertNull(repo.getBaseUrl());
      }
 else {
        assertNull(repo.getMirrorsList());
        assertFalse(repo.getBaseUrl().isEmpty());
      }
    }
  }
  assertEquals(3,centos5Cnt.size());
  assertEquals(3,redhat6cnt.size());
  assertEquals(3,redhat5cnt.size());
  assertEquals(3,centos6Cnt.size());
}

</code></pre>

<br>
<pre class="type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPasswordPropertyAttribute() throws Exception {
  ServiceInfo service=metaInfo.getService(STACK_NAME_HDP,"2.0.1","HIVE");
  List<PropertyInfo> propertyInfoList=service.getProperties();
  Assert.assertNotNull(propertyInfoList);
  PropertyInfo passwordProperty=null;
  for (  PropertyInfo propertyInfo : propertyInfoList) {
    if (propertyInfo.isRequireInput() && propertyInfo.getPropertyTypes().contains(PropertyInfo.PropertyType.PASSWORD)) {
      passwordProperty=propertyInfo;
    }
 else {
      Assert.assertTrue(propertyInfo.getPropertyTypes().isEmpty());
    }
  }
  Assert.assertNotNull(passwordProperty);
  Assert.assertEquals("javax.jdo.option.ConnectionPassword",passwordProperty.getName());
}

</code></pre>

<br>
<pre class="type-13 type-10 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHBase134Dependencies() throws Exception {
  ServiceInfo service=metaInfo.getService(STACK_NAME_HDP,"1.3.4","HBASE");
  List<ComponentInfo> componentList=service.getComponents();
  Assert.assertEquals(3,componentList.size());
  for (  ComponentInfo component : componentList) {
    String name=component.getName();
    if (name.equals("HBASE_MASTER")) {
      List<DependencyInfo> dependencyList=component.getDependencies();
      Assert.assertEquals(2,dependencyList.size());
      for (      DependencyInfo dependency : dependencyList) {
        if (dependency.getName().equals("HDFS/HDFS_CLIENT")) {
          Assert.assertEquals("host",dependency.getScope());
          Assert.assertEquals(true,dependency.getAutoDeploy().isEnabled());
        }
 else         if (dependency.getName().equals("ZOOKEEPER/ZOOKEEPER_SERVER")) {
          Assert.assertEquals("cluster",dependency.getScope());
          AutoDeployInfo autoDeploy=dependency.getAutoDeploy();
          Assert.assertEquals(true,autoDeploy.isEnabled());
          Assert.assertEquals("HBASE/HBASE_MASTER",autoDeploy.getCoLocate());
        }
 else {
          Assert.fail("Unexpected dependency");
        }
      }
      Assert.assertNull(component.getAutoDeploy());
      Assert.assertEquals("1",component.getCardinality());
    }
    if (name.equals("HBASE_REGIONSERVER")) {
      Assert.assertEquals(0,component.getDependencies().size());
      Assert.assertNull(component.getAutoDeploy());
      Assert.assertEquals("1+",component.getCardinality());
    }
    if (name.equals("HBASE_CLIENT")) {
      Assert.assertEquals(0,component.getDependencies().size());
      Assert.assertNull(component.getAutoDeploy());
      Assert.assertEquals("0+",component.getCardinality());
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-13 type-10 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSqoop134Dependencies() throws Exception {
  ServiceInfo service=metaInfo.getService(STACK_NAME_HDP,"1.3.4","SQOOP");
  List<ComponentInfo> componentList=service.getComponents();
  Assert.assertEquals(1,componentList.size());
  ComponentInfo component=componentList.get(0);
  Assert.assertEquals("SQOOP",component.getName());
  List<DependencyInfo> dependencyList=component.getDependencies();
  Assert.assertEquals(2,dependencyList.size());
  for (  DependencyInfo dependency : dependencyList) {
    if (dependency.getName().equals("HDFS/HDFS_CLIENT")) {
      Assert.assertEquals("host",dependency.getScope());
      Assert.assertEquals(true,dependency.getAutoDeploy().isEnabled());
    }
 else     if (dependency.getName().equals("MAPREDUCE/MAPREDUCE_CLIENT")) {
      Assert.assertEquals("host",dependency.getScope());
      Assert.assertEquals(true,dependency.getAutoDeploy().isEnabled());
    }
 else {
      Assert.fail("Unexpected dependency");
    }
  }
  Assert.assertNull(component.getAutoDeploy());
  Assert.assertEquals("0+",component.getCardinality());
}

</code></pre>

<br>
<pre class="type-4 type-13 type-10 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWebHCat134Dependencies() throws Exception {
  ServiceInfo service=metaInfo.getService(STACK_NAME_HDP,"1.3.4","WEBHCAT");
  List<ComponentInfo> componentList=service.getComponents();
  Assert.assertEquals(1,componentList.size());
  ComponentInfo component=componentList.get(0);
  Assert.assertEquals("WEBHCAT_SERVER",component.getName());
  List<DependencyInfo> dependencyList=component.getDependencies();
  Assert.assertEquals(4,dependencyList.size());
  for (  DependencyInfo dependency : dependencyList) {
    if (dependency.getName().equals("HDFS/HDFS_CLIENT")) {
      Assert.assertEquals("host",dependency.getScope());
      Assert.assertEquals(true,dependency.getAutoDeploy().isEnabled());
    }
 else     if (dependency.getName().equals("MAPREDUCE/MAPREDUCE_CLIENT")) {
      Assert.assertEquals("host",dependency.getScope());
      Assert.assertEquals(true,dependency.getAutoDeploy().isEnabled());
    }
 else     if (dependency.getName().equals("ZOOKEEPER/ZOOKEEPER_SERVER")) {
      Assert.assertEquals("cluster",dependency.getScope());
      AutoDeployInfo autoDeploy=dependency.getAutoDeploy();
      Assert.assertEquals(true,autoDeploy.isEnabled());
      Assert.assertEquals("WEBHCAT/WEBHCAT_SERVER",autoDeploy.getCoLocate());
    }
 else     if (dependency.getName().equals("ZOOKEEPER/ZOOKEEPER_CLIENT")) {
      Assert.assertEquals("host",dependency.getScope());
      Assert.assertEquals(true,dependency.getAutoDeploy().isEnabled());
    }
 else {
      Assert.fail("Unexpected dependency");
    }
  }
  Assert.assertNull(component.getAutoDeploy());
  Assert.assertEquals("1",component.getCardinality());
}

</code></pre>

<br>
<pre class="type-4 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetRepositoryNoInternetDefault() throws Exception {
  String buildDir=tmpFolder.getRoot().getAbsolutePath();
  AmbariMetaInfo ambariMetaInfo=setupTempAmbariMetaInfo(buildDir);
  File latestUrlFile=new File(buildDir,"ambari-metaInfo/HDP/2.1.1/repos/hdp.json");
  if (System.getProperty("os.name").contains("Windows")) {
    latestUrlFile.deleteOnExit();
  }
 else {
    FileUtils.deleteQuietly(latestUrlFile);
    assertTrue(!latestUrlFile.exists());
  }
  ambariMetaInfo.init();
  List<RepositoryInfo> redhat6Repo=ambariMetaInfo.getRepositories(STACK_NAME_HDP,"2.1.1","redhat6");
  assertNotNull(redhat6Repo);
  for (  RepositoryInfo ri : redhat6Repo) {
    if (STACK_NAME_HDP.equals(ri.getRepoName())) {
      assertEquals(ri.getBaseUrl(),ri.getDefaultBaseUrl());
    }
  }
}

</code></pre>

<br>
<pre class="type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGanglia134Dependencies() throws Exception {
  ServiceInfo service=metaInfo.getService(STACK_NAME_HDP,"1.3.4","GANGLIA");
  List<ComponentInfo> componentList=service.getComponents();
  Assert.assertEquals(2,componentList.size());
  for (  ComponentInfo component : componentList) {
    String name=component.getName();
    if (name.equals("GANGLIA_SERVER")) {
      Assert.assertEquals(0,component.getDependencies().size());
      Assert.assertNull(component.getAutoDeploy());
      Assert.assertEquals("1",component.getCardinality());
    }
    if (name.equals("GANGLIA_MONITOR")) {
      Assert.assertEquals(0,component.getDependencies().size());
      Assert.assertTrue(component.getAutoDeploy().isEnabled());
      Assert.assertEquals("ALL",component.getCardinality());
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetRepositoryUpdatedUtilsBaseUrl() throws Exception {
  String stackVersion="0.2";
  String buildDir=tmpFolder.getRoot().getAbsolutePath();
  TestAmbariMetaInfo ambariMetaInfo=setupTempAmbariMetaInfo(buildDir);
  String newBaseUrl="http://myprivate-repo-1.hortonworks.com/HDP-Utils/centos6/2.x/updates/2.0.6.0";
  ambariMetaInfo.updateRepoBaseURL(STACK_NAME_HDP,stackVersion,"redhat6",REPO_ID,newBaseUrl);
  RepositoryInfo repoInfo=ambariMetaInfo.getRepository(STACK_NAME_HDP,stackVersion,"redhat6",REPO_ID);
  assertEquals(newBaseUrl,repoInfo.getBaseUrl());
  String prevBaseUrl=repoInfo.getDefaultBaseUrl();
  MetainfoDAO metainfoDAO=ambariMetaInfo.metaInfoDAO;
  reset(metainfoDAO);
  MetainfoEntity entity=createNiceMock(MetainfoEntity.class);
  expect(metainfoDAO.findByKey("repo:/HDP/0.2/redhat6/HDP-UTILS-1.1.0.15:baseurl")).andReturn(entity).atLeastOnce();
  expect(entity.getMetainfoValue()).andReturn(newBaseUrl).atLeastOnce();
  replay(metainfoDAO,entity);
  ambariMetaInfo.init();
  List<RepositoryInfo> redhat6Repo=ambariMetaInfo.getRepositories(STACK_NAME_HDP,stackVersion,"redhat6");
  assertNotNull(redhat6Repo);
  for (  RepositoryInfo ri : redhat6Repo) {
    if (HDP_UTILS_REPO_NAME.equals(ri.getRepoName())) {
      assertEquals(newBaseUrl,ri.getBaseUrl());
      assertFalse(ri.getBaseUrl().equals(ri.getDefaultBaseUrl()));
    }
  }
  ambariMetaInfo.updateRepoBaseURL(STACK_NAME_HDP,stackVersion,"redhat6",REPO_ID,prevBaseUrl);
}

</code></pre>

<br>
<pre class="type-13 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testZooKeeper134Dependencies() throws Exception {
  ServiceInfo service=metaInfo.getService(STACK_NAME_HDP,"1.3.4","ZOOKEEPER");
  List<ComponentInfo> componentList=service.getComponents();
  Assert.assertEquals(2,componentList.size());
  for (  ComponentInfo component : componentList) {
    String name=component.getName();
    if (name.equals("ZOOKEEPER_SERVER")) {
      Assert.assertEquals(0,component.getDependencies().size());
      Assert.assertNull(component.getAutoDeploy());
      Assert.assertEquals("1",component.getCardinality());
    }
    if (name.equals("ZOOKEEPER_CLIENT")) {
      Assert.assertEquals(0,component.getDependencies().size());
      Assert.assertNull(component.getAutoDeploy());
      Assert.assertEquals("0+",component.getCardinality());
    }
  }
}

</code></pre>

<br>
<pre class="type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMapReduce134Dependencies() throws Exception {
  ServiceInfo service=metaInfo.getService(STACK_NAME_HDP,"1.3.4","MAPREDUCE");
  List<ComponentInfo> componentList=service.getComponents();
  Assert.assertEquals(4,componentList.size());
  for (  ComponentInfo component : componentList) {
    String name=component.getName();
    if (name.equals("JOBTRACKER")) {
      Assert.assertEquals(0,component.getDependencies().size());
      Assert.assertNull(component.getAutoDeploy());
      Assert.assertEquals("1",component.getCardinality());
    }
    if (name.equals("TASKTRACKER")) {
      Assert.assertEquals(0,component.getDependencies().size());
      Assert.assertNull(component.getAutoDeploy());
      Assert.assertEquals("1+",component.getCardinality());
    }
    if (name.equals("HISTORYSERVER")) {
      Assert.assertEquals(0,component.getDependencies().size());
      AutoDeployInfo autoDeploy=component.getAutoDeploy();
      Assert.assertTrue(autoDeploy.isEnabled());
      Assert.assertEquals("MAPREDUCE/JOBTRACKER",autoDeploy.getCoLocate());
      Assert.assertEquals("1",component.getCardinality());
    }
    if (name.equals("MAPREDUCE_CLIENT")) {
      Assert.assertEquals(0,component.getDependencies().size());
      Assert.assertNull(component.getAutoDeploy());
      Assert.assertEquals("0+",component.getCardinality());
    }
  }
}

</code></pre>

<br>
<pre class="type-13 type-10 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOozie134Dependencies() throws Exception {
  ServiceInfo service=metaInfo.getService(STACK_NAME_HDP,"1.3.4","OOZIE");
  List<ComponentInfo> componentList=service.getComponents();
  Assert.assertEquals(2,componentList.size());
  for (  ComponentInfo component : componentList) {
    String name=component.getName();
    if (name.equals("OOZIE_SERVER")) {
      List<DependencyInfo> dependencyList=component.getDependencies();
      Assert.assertEquals(2,dependencyList.size());
      for (      DependencyInfo dependency : dependencyList) {
        if (dependency.getName().equals("HDFS/HDFS_CLIENT")) {
          Assert.assertEquals("host",dependency.getScope());
          Assert.assertEquals(true,dependency.getAutoDeploy().isEnabled());
        }
 else         if (dependency.getName().equals("MAPREDUCE/MAPREDUCE_CLIENT")) {
          Assert.assertEquals("host",dependency.getScope());
          Assert.assertEquals(true,dependency.getAutoDeploy().isEnabled());
        }
 else {
          Assert.fail("Unexpected dependency");
        }
      }
      Assert.assertNull(component.getAutoDeploy());
      Assert.assertEquals("1",component.getCardinality());
    }
    if (name.equals("OOZIE_CLIENT")) {
      List<DependencyInfo> dependencyList=component.getDependencies();
      Assert.assertEquals(2,dependencyList.size());
      for (      DependencyInfo dependency : dependencyList) {
        if (dependency.getName().equals("HDFS/HDFS_CLIENT")) {
          Assert.assertEquals("host",dependency.getScope());
          Assert.assertEquals(true,dependency.getAutoDeploy().isEnabled());
        }
 else         if (dependency.getName().equals("MAPREDUCE/MAPREDUCE_CLIENT")) {
          Assert.assertEquals("host",dependency.getScope());
          Assert.assertEquals(true,dependency.getAutoDeploy().isEnabled());
        }
 else {
          Assert.fail("Unexpected dependency");
        }
      }
      Assert.assertNull(component.getAutoDeploy());
      Assert.assertEquals("0+",component.getCardinality());
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetRepositoryNoInternetUpdatedBaseUrl() throws Exception {
  String newBaseUrl="http://myprivate-repo-1.hortonworks.com/HDP/centos6/2.x/updates/2.0.6.0";
  String buildDir=tmpFolder.getRoot().getAbsolutePath();
  TestAmbariMetaInfo ambariMetaInfo=setupTempAmbariMetaInfo(buildDir);
  File latestUrlFile=new File(buildDir,"ambari-metaInfo/HDP/2.1.1/repos/hdp.json");
  if (System.getProperty("os.name").contains("Windows")) {
    latestUrlFile.deleteOnExit();
  }
 else {
    FileUtils.deleteQuietly(latestUrlFile);
    assertTrue(!latestUrlFile.exists());
  }
  ambariMetaInfo.updateRepoBaseURL("HDP","2.1.1","redhat6","HDP-2.1.1",newBaseUrl);
  RepositoryInfo repoInfo=ambariMetaInfo.getRepository(STACK_NAME_HDP,"2.1.1","redhat6",STACK_NAME_HDP + "-2.1.1");
  assertEquals(newBaseUrl,repoInfo.getBaseUrl());
  String prevBaseUrl=repoInfo.getDefaultBaseUrl();
  MetainfoDAO metainfoDAO=ambariMetaInfo.metaInfoDAO;
  reset(metainfoDAO);
  MetainfoEntity entity=createNiceMock(MetainfoEntity.class);
  expect(metainfoDAO.findByKey("repo:/HDP/2.1.1/redhat6/HDP-2.1.1:baseurl")).andReturn(entity).atLeastOnce();
  expect(entity.getMetainfoValue()).andReturn(newBaseUrl).atLeastOnce();
  replay(metainfoDAO,entity);
  ambariMetaInfo.init();
  waitForAllReposToBeResolved(ambariMetaInfo);
  List<RepositoryInfo> redhat6Repo=ambariMetaInfo.getRepositories(STACK_NAME_HDP,"2.1.1","redhat6");
  assertNotNull(redhat6Repo);
  for (  RepositoryInfo ri : redhat6Repo) {
    if (STACK_NAME_HDP.equals(ri.getRepoName())) {
      assertEquals(newBaseUrl,ri.getBaseUrl());
      assertFalse(ri.getDefaultBaseUrl().equals(ri.getBaseUrl()));
    }
  }
  ambariMetaInfo.updateRepoBaseURL(STACK_NAME_HDP,"2.1.1","redhat6",STACK_NAME_HDP + "-2.1.1",prevBaseUrl);
}

</code></pre>

<br>
<pre class="type-13 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHDFS134Dependencies() throws Exception {
  ServiceInfo service=metaInfo.getService(STACK_NAME_HDP,"1.3.4","HDFS");
  List<ComponentInfo> componentList=service.getComponents();
  Assert.assertEquals(4,componentList.size());
  for (  ComponentInfo component : componentList) {
    String name=component.getName();
    if (name.equals("NAMENODE")) {
      Assert.assertEquals(0,component.getDependencies().size());
      Assert.assertNull(component.getAutoDeploy());
      Assert.assertEquals("1",component.getCardinality());
    }
    if (name.equals("DATANODE")) {
      Assert.assertEquals(0,component.getDependencies().size());
      Assert.assertNull(component.getAutoDeploy());
      Assert.assertEquals("1+",component.getCardinality());
    }
    if (name.equals("SECONDARY_NAMENODE")) {
      Assert.assertEquals(0,component.getDependencies().size());
      Assert.assertNull(component.getAutoDeploy());
      Assert.assertEquals("1",component.getCardinality());
    }
    if (name.equals("HDFS_CLIENT")) {
      Assert.assertEquals(0,component.getDependencies().size());
      Assert.assertNull(component.getAutoDeploy());
      Assert.assertEquals("0+",component.getCardinality());
    }
  }
}

</code></pre>

<br>
<pre class="type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCrossCheckJmxToGangliaMetrics() throws Exception {
  File stacks=new File("src/main/resources/stacks");
  File version=new File("src/test/resources/version");
  File commonServicesRoot=new File("src/main/resources/common-services");
  if (System.getProperty("os.name").contains("Windows")) {
    stacks=new File(ClassLoader.getSystemClassLoader().getResource("stacks").getPath());
    version=new File(new File(ClassLoader.getSystemClassLoader().getResource("").getPath()).getParent(),"version");
    commonServicesRoot=new File(ClassLoader.getSystemClassLoader().getResource("common-services").getPath());
  }
  Properties properties=new Properties();
  properties.setProperty(Configuration.METADATA_DIR_PATH,stacks.getPath());
  properties.setProperty(Configuration.COMMON_SERVICES_DIR_PATH,commonServicesRoot.getPath());
  properties.setProperty(Configuration.SERVER_VERSION_FILE,version.getPath());
  Configuration configuration=new Configuration(properties);
  TestAmbariMetaInfo ambariMetaInfo=new TestAmbariMetaInfo(configuration);
  ambariMetaInfo.replayAllMocks();
  try {
    ambariMetaInfo.init();
  }
 catch (  Exception e) {
    LOG.info("Error in metainfo initializing ",e);
    throw e;
  }
  waitForAllReposToBeResolved(ambariMetaInfo);
  String[] metricsTypes={Resource.Type.Component.name(),Resource.Type.HostComponent.name()};
  for (  StackInfo stackInfo : ambariMetaInfo.getStacks(STACK_NAME_HDP)) {
    for (    ServiceInfo serviceInfo : stackInfo.getServices()) {
      for (      ComponentInfo componentInfo : serviceInfo.getComponents()) {
        for (        String metricType : metricsTypes) {
          List<MetricDefinition> list=ambariMetaInfo.getMetrics(stackInfo.getName(),stackInfo.getVersion(),serviceInfo.getName(),componentInfo.getName(),metricType);
          String currentComponentInfo=stackInfo.getName() + "-" + stackInfo.getVersion()+ ", "+ serviceInfo.getName()+ ", "+ componentInfo.getName()+ ", "+ metricType;
          if (list == null) {
            LOG.info("No metrics found for " + currentComponentInfo);
            continue;
          }
          LOG.info("Cross-checking JMX-to-Ganglia metrics for " + currentComponentInfo);
          Map<String,Metric> jmxMetrics=Collections.emptyMap();
          for (          MetricDefinition metricDefinition : list) {
            if ("jmx".equals(metricDefinition.getType())) {
              jmxMetrics=metricDefinition.getMetrics();
              for (              Metric metric : jmxMetrics.values()) {
                Assert.assertTrue(metric.isPointInTime());
                Assert.assertFalse(metric.isTemporal());
              }
            }
          }
          LinkedList<String> failedMetrics=new LinkedList<String>();
          for (          MetricDefinition metricDefinition : list) {
            if ("ganglia".equals(metricDefinition.getType())) {
              for (              Map.Entry<String,Metric> metricEntry : metricDefinition.getMetrics().entrySet()) {
                Assert.assertTrue(metricEntry.getValue().isTemporal());
                if (metricEntry.getValue().isPointInTime() && jmxMetrics.containsKey(metricEntry.getKey())) {
                  failedMetrics.add(metricEntry.getKey());
                }
              }
            }
          }
          Assert.assertEquals(failedMetrics.toString() + " metrics defined with pointInTime=true for both jmx and ganglia types.",0,failedMetrics.size());
        }
      }
    }
  }
}

</code></pre>

<br>
<pre class="type-13 type-10 type-2 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testLatestRepo() throws Exception {
  StackManager sm=metaInfo.getStackManager();
  int maxWait=45000;
  int waitTime=0;
  while (waitTime < maxWait && !sm.haveAllRepoUrlsBeenResolved()) {
    Thread.sleep(5);
    waitTime+=5;
  }
  if (waitTime >= maxWait) {
    fail("Latest Repo tasks did not complete");
  }
  for (  RepositoryInfo ri : metaInfo.getRepositories("HDP","2.1.1","centos6")) {
    Assert.assertEquals("Expected the base url to be set properly","http://s3.amazonaws.com/dev.hortonworks.com/HDP/centos6/2.x/BUILDS/2.1.1.0-118",ri.getLatestBaseUrl());
    Assert.assertEquals("Expected the default URL to be the same as in the xml file","http://public-repo-1.hortonworks.com/HDP/centos6/2.x/updates/2.0.6.0",ri.getDefaultBaseUrl());
  }
  for (  RepositoryInfo ri : metaInfo.getRepositories("HDP","2.1.1","suse11")) {
    Assert.assertEquals("Expected hdp.json to be stripped from the url","http://s3.amazonaws.com/dev.hortonworks.com/HDP/suse11/2.x/BUILDS/2.1.1.0-118",ri.getLatestBaseUrl());
  }
  for (  RepositoryInfo ri : metaInfo.getRepositories("HDP","2.1.1","sles11")) {
    Assert.assertEquals("http://s3.amazonaws.com/dev.hortonworks.com/HDP/suse11/2.x/BUILDS/2.1.1.0-118",ri.getLatestBaseUrl());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.api.services.parsers.JsonRequestBodyParserTest </h4><pre class="type-13 type-10 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testParse_QueryPost() throws BodyParseException {
  RequestBodyParser parser=new JsonRequestBodyParser();
  RequestBody body=parser.parse(queryPostJson).iterator().next();
  Set<NamedPropertySet> setProperties=body.getNamedPropertySets();
  assertEquals(1,setProperties.size());
  boolean contains1=false;
  boolean contains2=false;
  boolean contains3=false;
  for (  NamedPropertySet ps : setProperties) {
    Map<String,Object> mapProps=ps.getProperties();
    assertEquals(1,mapProps.size());
    Set<Map<String,Object>> set=(Set<Map<String,Object>>)mapProps.get("services");
    for (    Map<String,Object> map : set) {
      String serviceName=(String)map.get("ServiceInfo/service_name");
      if (serviceName.equals("unitTestService1")) {
        assertEquals(1,map.size());
        contains1=true;
      }
 else       if (serviceName.equals("unitTestService2")) {
        assertEquals("prop1Value",map.get("ServiceInfo/property1"));
        assertEquals(2,map.size());
        contains2=true;
      }
 else       if (serviceName.equals("unitTestService3")) {
        assertEquals("prop2Value",map.get("ServiceInfo/Category/property2"));
        assertEquals(2,map.size());
        contains3=true;
      }
 else {
        fail("Unexpected service name");
      }
    }
  }
  assertTrue(contains1);
  assertTrue(contains2);
  assertTrue(contains3);
  String b=body.getBody();
  body=parser.parse(b).iterator().next();
  Set<NamedPropertySet> setProps2=body.getNamedPropertySets();
  assertEquals(1,setProps2.size());
  assertEquals(setProperties,setProps2);
  assertEquals("java.util.LinkedHashSet",body.getNamedPropertySets().iterator().next().getProperties().get("services").getClass().getName());
}

</code></pre>

<br>
<pre class="type-13 type-10 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testParse___QueryPost_QueryInBody() throws BodyParseException {
  RequestBodyParser parser=new JsonRequestBodyParser();
  RequestBody body=parser.parse(queryPostJsonWithQuery).iterator().next();
  Set<NamedPropertySet> setProperties=body.getNamedPropertySets();
  assertEquals("foo=bar",body.getQueryString());
  assertEquals(1,setProperties.size());
  boolean contains1=false;
  boolean contains2=false;
  boolean contains3=false;
  for (  NamedPropertySet ps : setProperties) {
    assertEquals("",ps.getName());
    Map<String,Object> mapProps=ps.getProperties();
    for (    Map.Entry<String,Object> entry : mapProps.entrySet()) {
      Set<Map<String,Object>> set=(Set<Map<String,Object>>)entry.getValue();
      for (      Map<String,Object> map : set) {
        String serviceName=(String)map.get("ServiceInfo/service_name");
        if (serviceName.equals("unitTestService1")) {
          assertEquals(1,map.size());
          contains1=true;
        }
 else         if (serviceName.equals("unitTestService2")) {
          assertEquals("prop1Value",map.get("ServiceInfo/property1"));
          assertEquals(2,map.size());
          contains2=true;
        }
 else         if (serviceName.equals("unitTestService3")) {
          assertEquals("prop2Value",map.get("ServiceInfo/Category/property2"));
          assertEquals(2,map.size());
          contains3=true;
        }
 else {
          fail("Unexpected service name");
        }
      }
    }
  }
  assertTrue(contains1);
  assertTrue(contains2);
  assertTrue(contains3);
  String b=body.getBody();
  assertEquals(queryPostJsonWithQuery,b);
  body=parser.parse(b).iterator().next();
  Set<NamedPropertySet> setProps2=body.getNamedPropertySets();
  assertEquals(1,setProps2.size());
  assertEquals(setProperties,setProps2);
}

</code></pre>

<br>
<pre class="type-13 type-10 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testParse___QueryPost_multipleSubResTypes() throws BodyParseException {
  RequestBodyParser parser=new JsonRequestBodyParser();
  RequestBody body=parser.parse(queryPostMultipleSubResourcesJson).iterator().next();
  Set<NamedPropertySet> setProperties=body.getNamedPropertySets();
  assertEquals(1,setProperties.size());
  boolean contains1=false;
  boolean contains2=false;
  for (  NamedPropertySet ps : setProperties) {
    Map<String,Object> mapProps=ps.getProperties();
    for (    Map.Entry<String,Object> entry : mapProps.entrySet()) {
      Set<Map<String,Object>> set=(Set<Map<String,Object>>)entry.getValue();
      for (      Map<String,Object> map : set) {
        String serviceName=(String)map.get("ServiceInfo/service_name");
        if (serviceName.equals("unitTestService1")) {
          assertEquals("foo",entry.getKey());
          assertEquals(1,map.size());
          contains1=true;
        }
 else         if (serviceName.equals("unitTestService2")) {
          assertEquals("bar",entry.getKey());
          assertEquals("prop2Value",map.get("ServiceInfo/Category/property2"));
          assertEquals(2,map.size());
          contains2=true;
        }
 else {
          fail("Unexpected service name");
        }
      }
    }
  }
  assertTrue(contains1);
  assertTrue(contains2);
  String b=body.getBody();
  body=parser.parse(b).iterator().next();
  Set<NamedPropertySet> setProps2=body.getNamedPropertySets();
  assertEquals(1,setProps2.size());
  assertEquals(setProperties,setProps2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.checks.UpgradeCheckOrderTest </h4><pre class="type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that instances of {@link AbstractCheckDescriptor} are ordered
 * correctly.
 * @throws Exception
 */
@Test public void testUpgradeOrder() throws Exception {
  String sourceResourceDirectory="src" + File.separator + "test"+ File.separator+ "resources";
  Properties properties=new Properties();
  properties.setProperty(Configuration.SERVER_PERSISTENCE_TYPE_KEY,"in-memory");
  properties.setProperty(Configuration.OS_VERSION_KEY,"centos6");
  properties.setProperty(Configuration.SHARED_RESOURCES_DIR_KEY,sourceResourceDirectory);
  Injector injector=Guice.createInjector(new ControllerModule(properties));
  UpgradeCheckRegistry registry=injector.getInstance(UpgradeCheckRegistry.class);
  UpgradeCheckRegistry registry2=injector.getInstance(UpgradeCheckRegistry.class);
  Assert.assertEquals(registry,registry2);
  List<AbstractCheckDescriptor> checks=registry.getUpgradeChecks();
  ClassPathScanningCandidateComponentProvider scanner=new ClassPathScanningCandidateComponentProvider(false);
  AssignableTypeFilter filter=new AssignableTypeFilter(AbstractCheckDescriptor.class);
  scanner.addIncludeFilter(filter);
  Set<BeanDefinition> beanDefinitions=scanner.findCandidateComponents("org.apache.ambari.server");
  Assert.assertEquals(beanDefinitions.size(),checks.size());
  AbstractCheckDescriptor lastCheck=null;
  for (  AbstractCheckDescriptor check : checks) {
    UpgradeCheckGroup group=UpgradeCheckGroup.DEFAULT;
    UpgradeCheckGroup lastGroup=UpgradeCheckGroup.DEFAULT;
    if (null != lastCheck) {
      UpgradeCheck annotation=check.getClass().getAnnotation(UpgradeCheck.class);
      UpgradeCheck lastAnnotation=lastCheck.getClass().getAnnotation(UpgradeCheck.class);
      if (null != annotation && null != lastAnnotation) {
        group=annotation.group();
        lastGroup=lastAnnotation.group();
        Assert.assertTrue(lastGroup.getOrder().compareTo(group.getOrder()) <= 0);
      }
    }
    lastCheck=check;
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.controller.AmbariManagementControllerTest </h4><pre class="type-4 type-13 type-10 type-2 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetHosts() throws AmbariException, AuthorizationException {
  setupClusterWithHosts("c1","HDP-0.2",new ArrayList<String>(){
{
      add("h1");
      add("h2");
    }
  }
,"centos5");
  setupClusterWithHosts("c2","HDP-0.2",new ArrayList<String>(){
{
      add("h3");
    }
  }
,"centos5");
  clusters.addHost("h4");
  setOsFamily(clusters.getHost("h4"),"redhat","5.9");
  clusters.getHost("h4").persist();
  Map<String,String> attrs=new HashMap<String,String>();
  attrs.put("a1","b1");
  clusters.getHost("h3").setHostAttributes(attrs);
  attrs.put("a2","b2");
  clusters.getHost("h4").setHostAttributes(attrs);
  HostRequest r=new HostRequest(null,null,null);
  Set<HostResponse> resps=HostResourceProviderTest.getHosts(controller,Collections.singleton(r));
  Assert.assertEquals(4,resps.size());
  Set<String> foundHosts=new HashSet<String>();
  for (  HostResponse resp : resps) {
    foundHosts.add(resp.getHostname());
    if (resp.getHostname().equals("h1")) {
      Assert.assertEquals("c1",resp.getClusterName());
      Assert.assertEquals(2,resp.getHostAttributes().size());
    }
 else     if (resp.getHostname().equals("h2")) {
      Assert.assertEquals("c1",resp.getClusterName());
      Assert.assertEquals(2,resp.getHostAttributes().size());
    }
 else     if (resp.getHostname().equals("h3")) {
      Assert.assertEquals("c2",resp.getClusterName());
      Assert.assertEquals(3,resp.getHostAttributes().size());
    }
 else     if (resp.getHostname().equals("h4")) {
      Assert.assertEquals("",resp.getClusterName());
      Assert.assertEquals(4,resp.getHostAttributes().size());
    }
 else {
      fail("Found invalid host");
    }
  }
  Assert.assertEquals(4,foundHosts.size());
  r=new HostRequest("h1",null,null);
  resps=HostResourceProviderTest.getHosts(controller,Collections.singleton(r));
  Assert.assertEquals(1,resps.size());
  HostResponse resp=resps.iterator().next();
  Assert.assertEquals("h1",resp.getHostname());
  Assert.assertEquals("c1",resp.getClusterName());
  Assert.assertEquals(2,resp.getHostAttributes().size());
}

</code></pre>

<br>
<pre class="type-13 type-2 type-1 type-14 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test @Ignore("Unsuported feature !") public void testConfigsAttachedToServiceNotCluster() throws AmbariException, AuthorizationException {
  String clusterName="foo1";
  createCluster(clusterName);
  clusters.getCluster(clusterName).setDesiredStackVersion(new StackId("HDP-0.1"));
  String serviceName="HDFS";
  createService(clusterName,serviceName,null);
  String componentName1="NAMENODE";
  String componentName2="DATANODE";
  String componentName3="HDFS_CLIENT";
  createServiceComponent(clusterName,serviceName,componentName1,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName2,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName3,State.INIT);
  String host1="h1";
  String host2="h2";
  addHostToCluster(host1,clusterName);
  addHostToCluster(host2,clusterName);
  createServiceComponentHost(clusterName,null,componentName1,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName2,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName2,host2,null);
  createServiceComponentHost(clusterName,serviceName,componentName3,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName3,host2,null);
  Map<String,String> configs=new HashMap<String,String>();
  configs.put("a","b");
  ConfigurationRequest cr1, cr2;
  cr1=new ConfigurationRequest(clusterName,"core-site","version1",configs,null);
  cr2=new ConfigurationRequest(clusterName,"hdfs-site","version1",configs,null);
  controller.createConfiguration(cr1);
  controller.createConfiguration(cr2);
  Map<String,String> configVersions=new HashMap<String,String>(){
{
      put("core-site","version1");
      put("hdfs-site","version1");
    }
  }
;
  ServiceRequest sr=new ServiceRequest(clusterName,serviceName,null);
  ServiceResourceProviderTest.updateServices(controller,Collections.singleton(sr),new HashMap<String,String>(),false,false);
  installService(clusterName,serviceName,false,false);
  long requestId=startService(clusterName,serviceName,true,false);
  Assert.assertEquals(0,clusters.getCluster(clusterName).getDesiredConfigs().size());
  List<Stage> stages=actionDB.getAllStages(requestId);
  boolean serviceCheckFound=false;
  for (  Stage stage : stages) {
    for (    HostRoleCommand hrc : stage.getOrderedHostRoleCommands()) {
      if (hrc.getRole().equals(Role.HDFS_SERVICE_CHECK)) {
        serviceCheckFound=true;
        Assert.assertEquals(2,hrc.getExecutionCommandWrapper().getExecutionCommand().getConfigurationTags().size());
      }
    }
  }
  Assert.assertEquals(true,serviceCheckFound);
}

</code></pre>

<br>
<pre class="type-4 type-13 type-10 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSecretReferences() throws AmbariException, AuthorizationException {
  final String host1="h1";
  final String host2="h2";
  Long clusterId=1L;
  String clusterName="foo1";
  Cluster cl=setupClusterWithHosts(clusterName,"HDP-2.0.5",new ArrayList<String>(){
{
      add(host1);
      add(host2);
    }
  }
,"centos5");
  String serviceName="HDFS";
  createService(clusterName,serviceName,null);
  String componentName1="NAMENODE";
  String componentName2="DATANODE";
  String componentName3="HDFS_CLIENT";
  createServiceComponent(clusterName,serviceName,componentName1,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName2,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName3,State.INIT);
  createServiceComponentHost(clusterName,serviceName,componentName1,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName2,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName3,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName2,host2,null);
  createServiceComponentHost(clusterName,serviceName,componentName3,host2,null);
  installService(clusterName,serviceName,false,false);
  ClusterRequest crReq;
  ConfigurationRequest cr;
  cr=new ConfigurationRequest(clusterName,"hdfs-site","version1",new HashMap<String,String>(){
{
      put("test.password","first");
      put("test.password.empty","");
    }
  }
,new HashMap<String,Map<String,String>>());
  crReq=new ClusterRequest(clusterId,clusterName,null,null);
  crReq.setDesiredConfig(Collections.singletonList(cr));
  controller.updateClusters(Collections.singleton(crReq),null);
  cr=new ConfigurationRequest(clusterName,"hdfs-site","version2",new HashMap<String,String>(){
{
      put("test.password","SECRET:hdfs-site:1:test.password");
      put("new","new");
    }
  }
,new HashMap<String,Map<String,String>>());
  crReq=new ClusterRequest(clusterId,clusterName,null,null);
  crReq.setDesiredConfig(Collections.singletonList(cr));
  controller.updateClusters(Collections.singleton(crReq),null);
  cr=new ConfigurationRequest(clusterName,"hdfs-site","version3",new HashMap<String,String>(){
{
      put("test.password","brandNewPassword");
    }
  }
,new HashMap<String,Map<String,String>>());
  crReq=new ClusterRequest(clusterId,clusterName,null,null);
  crReq.setDesiredConfig(Collections.singletonList(cr));
  controller.updateClusters(Collections.singleton(crReq),null);
  cr=new ConfigurationRequest(clusterName,"hdfs-site","version3",new HashMap<String,String>(){
{
      put("test.password","SECRET:hdfs-site:666:test.password");
    }
  }
,new HashMap<String,Map<String,String>>());
  crReq=new ClusterRequest(clusterId,clusterName,null,null);
  crReq.setDesiredConfig(Collections.singletonList(cr));
  try {
    controller.updateClusters(Collections.singleton(crReq),null);
    fail("Request need to be failed with wrong secret reference");
  }
 catch (  AmbariException e) {
  }
  cr=new ConfigurationRequest(clusterName,"hdfs-site","version4",new HashMap<String,String>(){
{
      put("foo","bar");
    }
  }
,new HashMap<String,Map<String,String>>());
  crReq=new ClusterRequest(clusterId,clusterName,null,null);
  crReq.setDesiredConfig(Collections.singletonList(cr));
  controller.updateClusters(Collections.singleton(crReq),null);
  cr=new ConfigurationRequest(clusterName,"hdfs-site","version5",new HashMap<String,String>(){
{
      put("test.password","SECRET:hdfs-site:4:test.password");
      put("new","new");
    }
  }
,new HashMap<String,Map<String,String>>());
  crReq=new ClusterRequest(clusterId,clusterName,null,null);
  crReq.setDesiredConfig(Collections.singletonList(cr));
  try {
    controller.updateClusters(Collections.singleton(crReq),null);
    fail("Request need to be failed with wrong secret reference");
  }
 catch (  AmbariException e) {
    assertEquals("Error when parsing secret reference. Cluster: foo1 ConfigType: hdfs-site ConfigVersion: 4 does not contain property 'test.password'",e.getMessage());
  }
  cl.getAllConfigs();
  assertEquals(cl.getAllConfigs().size(),4);
  Config v1=cl.getConfigByVersion("hdfs-site",1l);
  Config v2=cl.getConfigByVersion("hdfs-site",2l);
  Config v3=cl.getConfigByVersion("hdfs-site",3l);
  Config v4=cl.getConfigByVersion("hdfs-site",4l);
  assertEquals(v1.getProperties().get("test.password"),"first");
  assertEquals(v2.getProperties().get("test.password"),"first");
  assertEquals(v3.getProperties().get("test.password"),"brandNewPassword");
  assertFalse(v4.getProperties().containsKey("test.password"));
  final ConfigurationRequest configRequest=new ConfigurationRequest(clusterName,"hdfs-site",null,null,null);
  configRequest.setIncludeProperties(true);
  Set<ConfigurationResponse> requestedConfigs=controller.getConfigurations(new HashSet<ConfigurationRequest>(){
{
      add(configRequest);
    }
  }
);
  for (  ConfigurationResponse resp : requestedConfigs) {
    String secretName="SECRET:hdfs-site:" + resp.getVersion().toString() + ":test.password";
    if (resp.getConfigs().containsKey("test.password")) {
      assertEquals(resp.getConfigs().get("test.password"),secretName);
    }
    if (resp.getConfigs().containsKey("test.password.empty")) {
      assertEquals(resp.getConfigs().get("test.password.empty"),"");
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPassiveSkipServices() throws Exception {
  String clusterName="c1";
  createCluster(clusterName);
  clusters.getCluster(clusterName).setDesiredStackVersion(new StackId("HDP-0.1"));
  String serviceName1="HDFS";
  String serviceName2="MAPREDUCE";
  createService(clusterName,serviceName1,null);
  createService(clusterName,serviceName2,null);
  String componentName1_1="NAMENODE";
  String componentName1_2="DATANODE";
  String componentName1_3="HDFS_CLIENT";
  createServiceComponent(clusterName,serviceName1,componentName1_1,State.INIT);
  createServiceComponent(clusterName,serviceName1,componentName1_2,State.INIT);
  createServiceComponent(clusterName,serviceName1,componentName1_3,State.INIT);
  String componentName2_1="JOBTRACKER";
  String componentName2_2="TASKTRACKER";
  createServiceComponent(clusterName,serviceName2,componentName2_1,State.INIT);
  createServiceComponent(clusterName,serviceName2,componentName2_2,State.INIT);
  String host1="h1";
  String host2="h2";
  addHostToCluster(host1,clusterName);
  addHostToCluster(host2,clusterName);
  createServiceComponentHost(clusterName,serviceName1,componentName1_1,host1,null);
  createServiceComponentHost(clusterName,serviceName1,componentName1_2,host1,null);
  createServiceComponentHost(clusterName,serviceName1,componentName1_2,host2,null);
  createServiceComponentHost(clusterName,serviceName2,componentName2_1,host1,null);
  createServiceComponentHost(clusterName,serviceName2,componentName2_2,host2,null);
  MaintenanceStateHelper maintenanceStateHelper=MaintenanceStateHelperTest.getMaintenanceStateHelperInstance(clusters);
  installService(clusterName,serviceName1,false,false,maintenanceStateHelper,null);
  installService(clusterName,serviceName2,false,false,maintenanceStateHelper,null);
  startService(clusterName,serviceName1,false,false,maintenanceStateHelper);
  startService(clusterName,serviceName2,false,false,maintenanceStateHelper);
  Map<String,String> requestProperties=new HashMap<String,String>();
  requestProperties.put("context","Called from a test");
  Cluster cluster=clusters.getCluster(clusterName);
  for (  Service service : cluster.getServices().values()) {
    Assert.assertEquals(State.STARTED,service.getDesiredState());
  }
  Service service2=cluster.getService(serviceName2);
  service2.setMaintenanceState(MaintenanceState.ON);
  Set<ServiceRequest> srs=new HashSet<ServiceRequest>();
  srs.add(new ServiceRequest(clusterName,serviceName1,State.INSTALLED.name()));
  srs.add(new ServiceRequest(clusterName,serviceName2,State.INSTALLED.name()));
  RequestStatusResponse rsr=ServiceResourceProviderTest.updateServices(controller,srs,requestProperties,false,false,maintenanceStateHelper);
  for (  ShortTaskStatus sts : rsr.getTasks()) {
    String role=sts.getRole();
    Assert.assertFalse(role.equals(componentName2_1));
    Assert.assertFalse(role.equals(componentName2_2));
  }
  for (  Service service : cluster.getServices().values()) {
    if (service.getName().equals(serviceName2)) {
      Assert.assertEquals(State.STARTED,service.getDesiredState());
    }
 else {
      Assert.assertEquals(State.INSTALLED,service.getDesiredState());
    }
  }
  service2.setMaintenanceState(MaintenanceState.OFF);
  ServiceResourceProviderTest.updateServices(controller,srs,requestProperties,false,false,maintenanceStateHelper);
  for (  Service service : cluster.getServices().values()) {
    Assert.assertEquals(State.INSTALLED,service.getDesiredState());
  }
  startService(clusterName,serviceName1,false,false,maintenanceStateHelper);
  startService(clusterName,serviceName2,false,false,maintenanceStateHelper);
  Host h1=clusters.getHost(host1);
  h1.setMaintenanceState(cluster.getClusterId(),MaintenanceState.ON);
  srs=new HashSet<ServiceRequest>();
  srs.add(new ServiceRequest(clusterName,serviceName1,State.INSTALLED.name()));
  srs.add(new ServiceRequest(clusterName,serviceName2,State.INSTALLED.name()));
  rsr=ServiceResourceProviderTest.updateServices(controller,srs,requestProperties,false,false,maintenanceStateHelper);
  for (  ShortTaskStatus sts : rsr.getTasks()) {
    Assert.assertFalse(sts.getHostName().equals(host1));
  }
  h1.setMaintenanceState(cluster.getClusterId(),MaintenanceState.OFF);
  startService(clusterName,serviceName2,false,false,maintenanceStateHelper);
  service2.setMaintenanceState(MaintenanceState.ON);
  ServiceRequest sr=new ServiceRequest(clusterName,serviceName2,State.INSTALLED.name());
  rsr=ServiceResourceProviderTest.updateServices(controller,Collections.singleton(sr),requestProperties,false,false,maintenanceStateHelper);
  Assert.assertTrue("Service start request defaults to Cluster operation level," + "command does not create tasks",rsr == null || rsr.getTasks().size() == 0);
}

</code></pre>

<br>
<pre class="type-4 type-13 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testConfigsAttachedToServiceChecks() throws AmbariException, AuthorizationException {
  String clusterName="foo1";
  createCluster(clusterName);
  Cluster cluster=clusters.getCluster(clusterName);
  cluster.setDesiredStackVersion(new StackId("HDP-0.1"));
  String serviceName="HDFS";
  createService(clusterName,serviceName,null);
  String componentName1="NAMENODE";
  String componentName2="DATANODE";
  String componentName3="HDFS_CLIENT";
  createServiceComponent(clusterName,serviceName,componentName1,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName2,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName3,State.INIT);
  String host1="h1";
  String host2="h2";
  addHostToCluster(host1,clusterName);
  addHostToCluster(host2,clusterName);
  createServiceComponentHost(clusterName,null,componentName1,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName2,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName2,host2,null);
  createServiceComponentHost(clusterName,serviceName,componentName3,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName3,host2,null);
  Map<String,String> configs=new HashMap<String,String>();
  configs.put("a","b");
  ConfigurationRequest cr1, cr2;
  cr1=new ConfigurationRequest(clusterName,"core-site","version1",configs,null);
  cr2=new ConfigurationRequest(clusterName,"hdfs-site","version1",configs,null);
  ClusterRequest crReq=new ClusterRequest(cluster.getClusterId(),clusterName,null,null);
  crReq.setDesiredConfig(Collections.singletonList(cr1));
  controller.updateClusters(Collections.singleton(crReq),null);
  crReq=new ClusterRequest(cluster.getClusterId(),clusterName,null,null);
  crReq.setDesiredConfig(Collections.singletonList(cr2));
  controller.updateClusters(Collections.singleton(crReq),null);
  installService(clusterName,serviceName,false,false);
  long requestId=startService(clusterName,serviceName,true,false);
  List<Stage> stages=actionDB.getAllStages(requestId);
  boolean serviceCheckFound=false;
  for (  Stage stage : stages) {
    for (    HostRoleCommand hrc : stage.getOrderedHostRoleCommands()) {
      if (hrc.getRole().equals(Role.HDFS_SERVICE_CHECK)) {
        serviceCheckFound=true;
        Assert.assertEquals(2,hrc.getExecutionCommandWrapper().getExecutionCommand().getConfigurationTags().size());
      }
    }
  }
  Type type=new TypeToken<Map<String,String>>(){
  }
.getType();
  for (  Stage stage : actionDB.getAllStages(requestId)) {
    Map<String,String> hostParamsStage=StageUtils.getGson().fromJson(stage.getHostParamsStage(),type);
    Assert.assertNotNull(hostParamsStage.get("jdk_location"));
  }
  Assert.assertEquals(true,serviceCheckFound);
}

</code></pre>

<br>
<pre class="type-13 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testServiceStopWhileStopping() throws Exception {
  String clusterName="foo1";
  createCluster(clusterName);
  clusters.getCluster(clusterName).setDesiredStackVersion(new StackId("HDP-0.1"));
  String serviceName="HDFS";
  createService(clusterName,serviceName,null);
  String componentName1="NAMENODE";
  String componentName2="DATANODE";
  String componentName3="HDFS_CLIENT";
  createServiceComponent(clusterName,serviceName,componentName1,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName2,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName3,State.INIT);
  String host1="h1";
  String host2="h2";
  addHostToCluster(host1,clusterName);
  addHostToCluster(host2,clusterName);
  Map<String,String> mapRequestProps=new HashMap<String,String>();
  mapRequestProps.put("context","Called from a test");
  createServiceComponentHost(clusterName,null,componentName1,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName2,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName2,host2,null);
  createServiceComponentHost(clusterName,serviceName,componentName3,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName3,host2,null);
  Assert.assertNotNull(clusters.getCluster(clusterName).getService(serviceName).getServiceComponent(componentName1).getServiceComponentHost(host1));
  Assert.assertNotNull(clusters.getCluster(clusterName).getService(serviceName).getServiceComponent(componentName2).getServiceComponentHost(host1));
  Assert.assertNotNull(clusters.getCluster(clusterName).getService(serviceName).getServiceComponent(componentName2).getServiceComponentHost(host2));
  Assert.assertNotNull(clusters.getCluster(clusterName).getService(serviceName).getServiceComponent(componentName3).getServiceComponentHost(host1));
  Assert.assertNotNull(clusters.getCluster(clusterName).getService(serviceName).getServiceComponent(componentName3).getServiceComponentHost(host2));
  ServiceRequest r=new ServiceRequest(clusterName,serviceName,State.INSTALLED.toString());
  Set<ServiceRequest> requests=new HashSet<ServiceRequest>();
  requests.add(r);
  ServiceResourceProviderTest.updateServices(controller,requests,mapRequestProps,true,false);
  Assert.assertEquals(State.INSTALLED,clusters.getCluster(clusterName).getService(serviceName).getDesiredState());
  for (  ServiceComponent sc : clusters.getCluster(clusterName).getService(serviceName).getServiceComponents().values()) {
    for (    ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
      sch.setState(State.INSTALLED);
    }
  }
  r=new ServiceRequest(clusterName,serviceName,State.STARTED.toString());
  requests.clear();
  requests.add(r);
  ServiceResourceProviderTest.updateServices(controller,requests,mapRequestProps,true,false);
  for (  ServiceComponent sc : clusters.getCluster(clusterName).getService(serviceName).getServiceComponents().values()) {
    for (    ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
      if (!sch.getServiceComponentName().equals("HDFS_CLIENT")) {
        sch.setState(State.STARTED);
      }
    }
  }
  Assert.assertEquals(State.STARTED,clusters.getCluster(clusterName).getService(serviceName).getDesiredState());
  clusters.getCluster(clusterName).getService(serviceName).setDesiredState(State.STOPPING);
  for (  ServiceComponent sc : clusters.getCluster(clusterName).getService(serviceName).getServiceComponents().values()) {
    for (    ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
      if (!sch.getServiceComponentName().equals("HDFS_CLIENT")) {
        Assert.assertEquals(State.STARTED,sch.getDesiredState());
        sch.setState(State.STOPPING);
      }
 else       if (sch.getServiceComponentName().equals("DATANODE")) {
        ServiceComponentHostRequest r1=new ServiceComponentHostRequest(clusterName,serviceName,sch.getServiceComponentName(),sch.getHostName(),State.INSTALLED.name());
        Set<ServiceComponentHostRequest> reqs1=new HashSet<ServiceComponentHostRequest>();
        reqs1.add(r1);
        updateHostComponents(reqs1,Collections.<String,String>emptyMap(),true);
        Assert.assertEquals(State.INSTALLED,sch.getDesiredState());
      }
    }
  }
  r=new ServiceRequest(clusterName,serviceName,State.INSTALLED.toString());
  requests.clear();
  requests.add(r);
  ServiceResourceProviderTest.updateServices(controller,requests,mapRequestProps,true,false);
  for (  ServiceComponent sc : clusters.getCluster(clusterName).getService(serviceName).getServiceComponents().values()) {
    for (    ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
      if (!sch.getServiceComponentName().equals("HDFS_CLIENT")) {
        Assert.assertEquals(State.INSTALLED,sch.getDesiredState());
      }
    }
  }
}

</code></pre>

<br>
<pre class="type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testServiceCheckWhenHostIsUnhealthy() throws AmbariException, AuthorizationException {
  String clusterName="foo1";
  createCluster(clusterName);
  clusters.getCluster(clusterName).setDesiredStackVersion(new StackId("HDP-0.1"));
  String serviceName="HDFS";
  createService(clusterName,serviceName,null);
  String componentName1="NAMENODE";
  String componentName2="DATANODE";
  String componentName3="HDFS_CLIENT";
  createServiceComponent(clusterName,serviceName,componentName1,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName2,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName3,State.INIT);
  String host1="h1";
  String host2="h2";
  String host3="h3";
  addHostToCluster(host1,clusterName);
  addHostToCluster(host2,clusterName);
  addHostToCluster(host3,clusterName);
  createServiceComponentHost(clusterName,serviceName,componentName1,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName2,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName3,host2,null);
  createServiceComponentHost(clusterName,serviceName,componentName3,host3,null);
  installService(clusterName,serviceName,false,false);
  clusters.getHost("h3").setState(HostState.UNHEALTHY);
  clusters.getHost("h2").setState(HostState.HEALTHY);
  long requestId=startService(clusterName,serviceName,true,false);
  List<HostRoleCommand> commands=actionDB.getRequestTasks(requestId);
  int commandCount=0;
  for (  HostRoleCommand command : commands) {
    if (command.getRoleCommand() == RoleCommand.SERVICE_CHECK && command.getRole() == Role.HDFS_SERVICE_CHECK) {
      Assert.assertTrue(command.getHostName().equals("h2"));
      commandCount++;
    }
  }
  Assert.assertEquals("Expect only one service check.",1,commandCount);
  stopService(clusterName,serviceName,false,false);
  clusters.getHost("h3").setState(HostState.HEALTHY);
  clusters.getHost("h2").setState(HostState.HEARTBEAT_LOST);
  requestId=startService(clusterName,serviceName,true,false);
  commands=actionDB.getRequestTasks(requestId);
  commandCount=0;
  for (  HostRoleCommand command : commands) {
    if (command.getRoleCommand() == RoleCommand.SERVICE_CHECK && command.getRole() == Role.HDFS_SERVICE_CHECK) {
      Assert.assertTrue(command.getHostName().equals("h3"));
      commandCount++;
    }
  }
  Assert.assertEquals("Expect only one service check.",1,commandCount);
  RequestResourceFilter resourceFilter=new RequestResourceFilter("HDFS",null,null);
  ExecuteActionRequest actionRequest=new ExecuteActionRequest("foo1",Role.HDFS_SERVICE_CHECK.name(),null,false);
  actionRequest.getResourceFilters().add(resourceFilter);
  Map<String,String> requestProperties=new HashMap<String,String>();
  RequestStatusResponse response=controller.createAction(actionRequest,requestProperties);
  commands=actionDB.getRequestTasks(response.getRequestId());
  commandCount=0;
  for (  HostRoleCommand command : commands) {
    if (command.getRoleCommand() == RoleCommand.SERVICE_CHECK && command.getRole() == Role.HDFS_SERVICE_CHECK) {
      Assert.assertTrue(command.getHostName().equals("h3"));
      commandCount++;
    }
  }
  Assert.assertEquals("Expect only one service check.",1,commandCount);
  clusters.getHost("h3").setState(HostState.WAITING_FOR_HOST_STATUS_UPDATES);
  clusters.getHost("h2").setState(HostState.INIT);
  response=controller.createAction(actionRequest,requestProperties);
  commands=actionDB.getRequestTasks(response.getRequestId());
  commandCount=0;
  for (  HostRoleCommand command : commands) {
    if (command.getRoleCommand() == RoleCommand.SERVICE_CHECK && command.getRole() == Role.HDFS_SERVICE_CHECK) {
      Assert.assertTrue(command.getHostName().equals("h3") || command.getHostName().equals("h2"));
      commandCount++;
    }
  }
  Assert.assertEquals("Expect only one service check.",1,commandCount);
  Assert.assertEquals("",response.getRequestContext());
}

</code></pre>

<br>
<pre class="type-4 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testComponentCategorySentWithRestart() throws AmbariException, AuthorizationException {
  setupClusterWithHosts("c1","HDP-2.0.7",new ArrayList<String>(){
{
      add("h1");
    }
  }
,"centos5");
  Cluster cluster=clusters.getCluster("c1");
  cluster.setDesiredStackVersion(new StackId("HDP-2.0.7"));
  cluster.setCurrentStackVersion(new StackId("HDP-2.0.7"));
  ConfigFactory cf=injector.getInstance(ConfigFactory.class);
  Config config1=cf.createNew(cluster,"global",new HashMap<String,String>(){
{
      put("key1","value1");
    }
  }
,new HashMap<String,Map<String,String>>());
  config1.setTag("version1");
  Config config2=cf.createNew(cluster,"core-site",new HashMap<String,String>(){
{
      put("key1","value1");
    }
  }
,new HashMap<String,Map<String,String>>());
  config2.setTag("version1");
  cluster.addConfig(config1);
  cluster.addConfig(config2);
  Service hdfs=cluster.addService("HDFS");
  hdfs.persist();
  hdfs.addServiceComponent(Role.HDFS_CLIENT.name()).persist();
  hdfs.addServiceComponent(Role.NAMENODE.name()).persist();
  hdfs.addServiceComponent(Role.DATANODE.name()).persist();
  hdfs.getServiceComponent(Role.HDFS_CLIENT.name()).addServiceComponentHost("h1").persist();
  hdfs.getServiceComponent(Role.NAMENODE.name()).addServiceComponentHost("h1").persist();
  hdfs.getServiceComponent(Role.DATANODE.name()).addServiceComponentHost("h1").persist();
  installService("c1","HDFS",false,false);
  startService("c1","HDFS",false,false);
  Cluster c=clusters.getCluster("c1");
  Service s=c.getService("HDFS");
  Assert.assertEquals(State.STARTED,s.getDesiredState());
  for (  ServiceComponent sc : s.getServiceComponents().values()) {
    for (    ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
      if (sc.isClientComponent()) {
        Assert.assertEquals(State.INSTALLED,sch.getDesiredState());
      }
 else {
        Assert.assertEquals(State.STARTED,sch.getDesiredState());
      }
    }
  }
  Map<String,String> params=new HashMap<String,String>(){
{
      put("test","test");
    }
  }
;
  RequestResourceFilter resourceFilter=new RequestResourceFilter("HDFS","HDFS_CLIENT",new ArrayList<String>(){
{
      add("h1");
    }
  }
);
  ExecuteActionRequest actionRequest=new ExecuteActionRequest("c1","RESTART",params,false);
  actionRequest.getResourceFilters().add(resourceFilter);
  Map<String,String> requestProperties=new HashMap<String,String>();
  requestProperties.put(REQUEST_CONTEXT_PROPERTY,"Called from a test");
  requestProperties.put("hdfs_client","abc");
  RequestStatusResponse response=controller.createAction(actionRequest,requestProperties);
  List<Stage> stages=actionDB.getAllStages(response.getRequestId());
  Assert.assertNotNull(stages);
  HostRoleCommand hrc=null;
  Type type=new TypeToken<Map<String,String>>(){
  }
.getType();
  for (  Stage stage : stages) {
    for (    HostRoleCommand cmd : stage.getOrderedHostRoleCommands()) {
      if (cmd.getRole().equals(Role.HDFS_CLIENT)) {
        hrc=cmd;
      }
      Map<String,String> hostParamStage=StageUtils.getGson().fromJson(stage.getHostParamsStage(),type);
      Assert.assertTrue(hostParamStage.containsKey(ExecutionCommand.KeyNames.DB_DRIVER_FILENAME));
      Assert.assertTrue(hostParamStage.containsKey(ExecutionCommand.KeyNames.MYSQL_JDBC_URL));
      Assert.assertTrue(hostParamStage.containsKey(ExecutionCommand.KeyNames.ORACLE_JDBC_URL));
    }
  }
  Assert.assertNotNull(hrc);
  Assert.assertEquals("RESTART HDFS/HDFS_CLIENT",hrc.getCommandDetail());
  Map<String,String> roleParams=hrc.getExecutionCommandWrapper().getExecutionCommand().getRoleParams();
  Assert.assertNotNull(roleParams);
  Assert.assertEquals("CLIENT",roleParams.get(ExecutionCommand.KeyNames.COMPONENT_CATEGORY));
  Assert.assertTrue(hrc.getExecutionCommandWrapper().getExecutionCommand().getCommandParams().containsKey("hdfs_client"));
  Assert.assertEquals("abc",hrc.getExecutionCommandWrapper().getExecutionCommand().getCommandParams().get("hdfs_client"));
  Assert.assertEquals(requestProperties.get(REQUEST_CONTEXT_PROPERTY),response.getRequestContext());
}

</code></pre>

<br>
<pre class="type-4 type-13 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testConfigGroupOverridesWithServiceCheckActions() throws AmbariException, AuthorizationException {
  String clusterName="foo1";
  createCluster(clusterName);
  Cluster cluster=clusters.getCluster(clusterName);
  cluster.setDesiredStackVersion(new StackId("HDP-0.1"));
  String serviceName="HDFS";
  createService(clusterName,serviceName,null);
  String componentName1="NAMENODE";
  String componentName2="DATANODE";
  String componentName3="HDFS_CLIENT";
  createServiceComponent(clusterName,serviceName,componentName1,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName2,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName3,State.INIT);
  String host1="h1";
  String host2="h2";
  addHostToCluster(host1,clusterName);
  addHostToCluster(host2,clusterName);
  createServiceComponentHost(clusterName,null,componentName1,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName2,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName2,host2,null);
  createServiceComponentHost(clusterName,serviceName,componentName3,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName3,host2,null);
  Map<String,String> configs=new HashMap<String,String>();
  configs.put("a","b");
  ConfigurationRequest cr1, cr2;
  cr1=new ConfigurationRequest(clusterName,"core-site","version1",configs,null);
  cr2=new ConfigurationRequest(clusterName,"hdfs-site","version1",configs,null);
  ClusterRequest crReq=new ClusterRequest(cluster.getClusterId(),clusterName,null,null);
  crReq.setDesiredConfig(Collections.singletonList(cr1));
  controller.updateClusters(Collections.singleton(crReq),null);
  crReq=new ClusterRequest(cluster.getClusterId(),clusterName,null,null);
  crReq.setDesiredConfig(Collections.singletonList(cr2));
  controller.updateClusters(Collections.singleton(crReq),null);
  installService(clusterName,serviceName,false,false);
  configs=new HashMap<String,String>();
  configs.put("a","c");
  final Config config=new ConfigImpl("hdfs-site");
  config.setProperties(configs);
  config.setTag("version122");
  Long groupId=createConfigGroup(clusters.getCluster(clusterName),"g1","t1",new ArrayList<String>(){
{
      add("h1");
      add("h2");
    }
  }
,new ArrayList<Config>(){
{
      add(config);
    }
  }
);
  Assert.assertNotNull(groupId);
  long requestId=startService(clusterName,serviceName,true,false);
  HostRoleCommand smokeTestCmd=null;
  List<Stage> stages=actionDB.getAllStages(requestId);
  for (  Stage stage : stages) {
    for (    HostRoleCommand hrc : stage.getOrderedHostRoleCommands()) {
      if (hrc.getRole().equals(Role.HDFS_SERVICE_CHECK)) {
        Assert.assertEquals(2,hrc.getExecutionCommandWrapper().getExecutionCommand().getConfigurationTags().size());
        smokeTestCmd=hrc;
      }
    }
  }
  Assert.assertNotNull(smokeTestCmd);
  Assert.assertEquals("c",smokeTestCmd.getExecutionCommandWrapper().getExecutionCommand().getConfigurations().get("hdfs-site").get("a"));
}

</code></pre>

<br>
<pre class="type-13 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpdateConfigForRunningService() throws Exception {
  String clusterName="foo1";
  createCluster(clusterName);
  clusters.getCluster(clusterName).setDesiredStackVersion(new StackId("HDP-0.1"));
  String serviceName="HDFS";
  createService(clusterName,serviceName,null);
  String componentName1="NAMENODE";
  String componentName2="DATANODE";
  String componentName3="HDFS_CLIENT";
  Map<String,String> mapRequestProps=new HashMap<String,String>();
  mapRequestProps.put("context","Called from a test");
  createServiceComponent(clusterName,serviceName,componentName1,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName2,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName3,State.INIT);
  String host1="h1";
  String host2="h2";
  addHostToCluster(host1,clusterName);
  addHostToCluster(host2,clusterName);
  createServiceComponentHost(clusterName,null,componentName1,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName2,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName2,host2,null);
  createServiceComponentHost(clusterName,serviceName,componentName3,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName3,host2,null);
  Assert.assertNotNull(clusters.getCluster(clusterName).getService(serviceName).getServiceComponent(componentName1).getServiceComponentHost(host1));
  Assert.assertNotNull(clusters.getCluster(clusterName).getService(serviceName).getServiceComponent(componentName2).getServiceComponentHost(host1));
  Assert.assertNotNull(clusters.getCluster(clusterName).getService(serviceName).getServiceComponent(componentName2).getServiceComponentHost(host2));
  Assert.assertNotNull(clusters.getCluster(clusterName).getService(serviceName).getServiceComponent(componentName3).getServiceComponentHost(host1));
  Assert.assertNotNull(clusters.getCluster(clusterName).getService(serviceName).getServiceComponent(componentName3).getServiceComponentHost(host2));
  ServiceRequest r=new ServiceRequest(clusterName,serviceName,State.INSTALLED.toString());
  Set<ServiceRequest> requests=new HashSet<ServiceRequest>();
  requests.add(r);
  ServiceResourceProviderTest.updateServices(controller,requests,mapRequestProps,true,false);
  Assert.assertEquals(State.INSTALLED,clusters.getCluster(clusterName).getService(serviceName).getDesiredState());
  for (  ServiceComponent sc : clusters.getCluster(clusterName).getService(serviceName).getServiceComponents().values()) {
    for (    ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
      sch.setState(State.INSTALLED);
    }
  }
  r=new ServiceRequest(clusterName,serviceName,State.STARTED.toString());
  requests.clear();
  requests.add(r);
  ServiceResourceProviderTest.updateServices(controller,requests,mapRequestProps,true,false);
  for (  ServiceComponent sc : clusters.getCluster(clusterName).getService(serviceName).getServiceComponents().values()) {
    for (    ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
      sch.setState(State.STARTED);
    }
  }
  Assert.assertEquals(State.STARTED,clusters.getCluster(clusterName).getService(serviceName).getDesiredState());
  for (  ServiceComponent sc : clusters.getCluster(clusterName).getService(serviceName).getServiceComponents().values()) {
    if (sc.getName().equals("HDFS_CLIENT")) {
      Assert.assertEquals(State.INSTALLED,sc.getDesiredState());
    }
 else {
      Assert.assertEquals(State.STARTED,sc.getDesiredState());
    }
    for (    ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
      if (sch.getServiceComponentName().equals("HDFS_CLIENT")) {
        Assert.assertEquals(State.INSTALLED,sch.getDesiredState());
      }
 else {
        Assert.assertEquals(State.STARTED,sch.getDesiredState());
      }
    }
  }
  Map<String,String> configs=new HashMap<String,String>();
  configs.put("a","b");
  ConfigurationRequest cr1, cr2, cr3, cr4, cr5, cr6, cr7, cr8;
  cr1=new ConfigurationRequest(clusterName,"typeA","v1",configs,null);
  cr2=new ConfigurationRequest(clusterName,"typeB","v1",configs,null);
  cr3=new ConfigurationRequest(clusterName,"typeC","v1",configs,null);
  cr4=new ConfigurationRequest(clusterName,"typeD","v1",configs,null);
  cr5=new ConfigurationRequest(clusterName,"typeA","v2",configs,null);
  cr6=new ConfigurationRequest(clusterName,"typeB","v2",configs,null);
  cr7=new ConfigurationRequest(clusterName,"typeC","v2",configs,null);
  cr8=new ConfigurationRequest(clusterName,"typeE","v1",configs,null);
  controller.createConfiguration(cr1);
  controller.createConfiguration(cr2);
  controller.createConfiguration(cr3);
  controller.createConfiguration(cr4);
  controller.createConfiguration(cr5);
  controller.createConfiguration(cr6);
  controller.createConfiguration(cr7);
  controller.createConfiguration(cr8);
  Cluster cluster=clusters.getCluster(clusterName);
  Service s=cluster.getService(serviceName);
  ServiceComponent sc1=s.getServiceComponent(componentName1);
  ServiceComponent sc2=s.getServiceComponent(componentName2);
  ServiceComponentHost sch1=sc1.getServiceComponentHost(host1);
  Set<ServiceComponentHostRequest> schReqs=new HashSet<ServiceComponentHostRequest>();
  Set<ServiceComponentRequest> scReqs=new HashSet<ServiceComponentRequest>();
  Set<ServiceRequest> sReqs=new HashSet<ServiceRequest>();
  Map<String,String> configVersions=new HashMap<String,String>();
  configVersions.clear();
  configVersions.put("typeA","v1");
  configVersions.put("typeB","v1");
  configVersions.put("typeC","v1");
  schReqs.clear();
  schReqs.add(new ServiceComponentHostRequest(clusterName,serviceName,componentName1,host1,null));
  Assert.assertNull(updateHostComponents(schReqs,Collections.<String,String>emptyMap(),true));
  configVersions.clear();
  configVersions.put("typeC","v1");
  configVersions.put("typeD","v1");
  scReqs.clear();
  scReqs.add(new ServiceComponentRequest(clusterName,serviceName,componentName2,null));
  Assert.assertNull(ComponentResourceProviderTest.updateComponents(controller,scReqs,Collections.<String,String>emptyMap(),true));
  configVersions.clear();
  configVersions.put("typeA","v2");
  configVersions.put("typeC","v2");
  configVersions.put("typeE","v1");
  sReqs.clear();
  sReqs.add(new ServiceRequest(clusterName,serviceName,null));
  Assert.assertNull(ServiceResourceProviderTest.updateServices(controller,sReqs,mapRequestProps,true,false));
  configVersions.clear();
  configVersions.put("typeA","v1");
  configVersions.put("typeB","v1");
  configVersions.put("typeC","v1");
  schReqs.clear();
  schReqs.add(new ServiceComponentHostRequest(clusterName,serviceName,componentName1,host1,null));
  Assert.assertNull(updateHostComponents(schReqs,Collections.<String,String>emptyMap(),true));
  configVersions.clear();
  configVersions.put("typeC","v2");
  configVersions.put("typeD","v1");
  scReqs.clear();
  scReqs.add(new ServiceComponentRequest(clusterName,serviceName,componentName1,null));
  Assert.assertNull(ComponentResourceProviderTest.updateComponents(controller,scReqs,Collections.<String,String>emptyMap(),true));
}

</code></pre>

<br>
<pre class="type-4 type-13 type-10 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testInstallAndStartService() throws Exception {
  testCreateServiceComponentHostSimple();
  String clusterName="foo1";
  String serviceName="HDFS";
  Cluster cluster=clusters.getCluster(clusterName);
  Service s1=cluster.getService(serviceName);
  Map<String,Config> configs=new HashMap<String,Config>();
  Map<String,String> properties=new HashMap<String,String>();
  Map<String,Map<String,String>> propertiesAttributes=new HashMap<String,Map<String,String>>();
  properties.put("a","a1");
  properties.put("b","b1");
  Config c1=new ConfigImpl(cluster,"hdfs-site",properties,propertiesAttributes,injector);
  properties.put("c","c1");
  properties.put("d","d1");
  Config c2=new ConfigImpl(cluster,"core-site",properties,propertiesAttributes,injector);
  Config c3=new ConfigImpl(cluster,"foo-site",properties,propertiesAttributes,injector);
  Map<String,String> mapRequestProps=new HashMap<String,String>();
  mapRequestProps.put("context","Called from a test");
  c1.setTag("v1");
  c2.setTag("v1");
  c3.setTag("v1");
  cluster.addConfig(c1);
  cluster.addConfig(c2);
  cluster.addConfig(c3);
  c1.persist();
  c2.persist();
  c3.persist();
  configs.put(c1.getType(),c1);
  configs.put(c2.getType(),c2);
  ServiceRequest r=new ServiceRequest(clusterName,serviceName,State.INSTALLED.toString());
  Set<ServiceRequest> requests=new HashSet<ServiceRequest>();
  requests.add(r);
  RequestStatusResponse trackAction=ServiceResourceProviderTest.updateServices(controller,requests,mapRequestProps,true,false);
  Assert.assertEquals(State.INSTALLED,clusters.getCluster(clusterName).getService(serviceName).getDesiredState());
  for (  ServiceComponent sc : clusters.getCluster(clusterName).getService(serviceName).getServiceComponents().values()) {
    Assert.assertEquals(State.INSTALLED,sc.getDesiredState());
    for (    ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
      Assert.assertEquals(State.INSTALLED,sch.getDesiredState());
      Assert.assertEquals(State.INIT,sch.getState());
    }
  }
  List<ShortTaskStatus> taskStatuses=trackAction.getTasks();
  Assert.assertEquals(5,taskStatuses.size());
  boolean foundH1NN=false;
  boolean foundH1DN=false;
  boolean foundH2DN=false;
  boolean foundH1CLT=false;
  boolean foundH2CLT=false;
  for (  ShortTaskStatus taskStatus : taskStatuses) {
    LOG.debug("Task dump :" + taskStatus.toString());
    Assert.assertEquals(RoleCommand.INSTALL.toString(),taskStatus.getCommand());
    Assert.assertEquals(HostRoleStatus.PENDING.toString(),taskStatus.getStatus());
    if (taskStatus.getHostName().equals("h1")) {
      if (Role.NAMENODE.toString().equals(taskStatus.getRole())) {
        foundH1NN=true;
      }
 else       if (Role.DATANODE.toString().equals(taskStatus.getRole())) {
        foundH1DN=true;
      }
 else       if (Role.HDFS_CLIENT.toString().equals(taskStatus.getRole())) {
        foundH1CLT=true;
      }
 else {
        fail("Found invalid role for host h1");
      }
    }
 else     if (taskStatus.getHostName().equals("h2")) {
      if (Role.DATANODE.toString().equals(taskStatus.getRole())) {
        foundH2DN=true;
      }
 else       if (Role.HDFS_CLIENT.toString().equals(taskStatus.getRole())) {
        foundH2CLT=true;
      }
 else {
        fail("Found invalid role for host h2");
      }
    }
 else {
      fail("Found invalid host in task list");
    }
  }
  Assert.assertTrue(foundH1DN && foundH1NN && foundH2DN&& foundH1CLT&& foundH2CLT);
  List<Stage> stages=actionDB.getAllStages(trackAction.getRequestId());
  Assert.assertEquals(1,stages.size());
  for (  Stage stage : stages) {
    LOG.info("Stage Details for Install Service" + ", stageId=" + stage.getStageId() + ", actionId="+ stage.getActionId());
    for (    String host : stage.getHosts()) {
      for (      ExecutionCommandWrapper ecw : stage.getExecutionCommands(host)) {
        Assert.assertFalse(ecw.getExecutionCommand().getHostLevelParams().get("repo_info").isEmpty());
      }
    }
  }
  org.apache.ambari.server.controller.spi.Request request=PropertyHelper.getReadRequest(TaskResourceProvider.TASK_CLUSTER_NAME_PROPERTY_ID,TaskResourceProvider.TASK_REQUEST_ID_PROPERTY_ID,TaskResourceProvider.TASK_STAGE_ID_PROPERTY_ID);
  Predicate predicate=new PredicateBuilder().property(TaskResourceProvider.TASK_REQUEST_ID_PROPERTY_ID).equals(trackAction.getRequestId()).toPredicate();
  List<HostRoleCommandEntity> entities=hostRoleCommandDAO.findAll(request,predicate);
  Assert.assertEquals(5,entities.size());
  predicate=new PredicateBuilder().property(TaskResourceProvider.TASK_REQUEST_ID_PROPERTY_ID).equals(trackAction.getRequestId()).and().property(TaskResourceProvider.TASK_ID_PROPERTY_ID).equals(1L).toPredicate();
  entities=hostRoleCommandDAO.findAll(request,predicate);
  Assert.assertEquals(1,entities.size());
  for (  ServiceComponent sc : clusters.getCluster(clusterName).getService(serviceName).getServiceComponents().values()) {
    for (    ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
      sch.setState(State.INSTALLED);
    }
  }
  r=new ServiceRequest(clusterName,serviceName,State.STARTED.toString());
  requests.clear();
  requests.add(r);
  trackAction=ServiceResourceProviderTest.updateServices(controller,requests,mapRequestProps,true,false);
  Assert.assertEquals(State.STARTED,clusters.getCluster(clusterName).getService(serviceName).getDesiredState());
  for (  ServiceComponent sc : clusters.getCluster(clusterName).getService(serviceName).getServiceComponents().values()) {
    if (sc.getName().equals("HDFS_CLIENT")) {
      Assert.assertEquals(State.INSTALLED,sc.getDesiredState());
    }
 else {
      Assert.assertEquals(State.STARTED,sc.getDesiredState());
    }
    for (    ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
      if (sch.getServiceComponentName().equals("HDFS_CLIENT")) {
        Assert.assertEquals(State.INSTALLED,sch.getDesiredState());
      }
 else {
        Assert.assertEquals(State.STARTED,sch.getDesiredState());
      }
    }
  }
  stages=actionDB.getAllStages(trackAction.getRequestId());
  Assert.assertEquals(2,stages.size());
  StringBuilder sb=new StringBuilder();
  clusters.debugDump(sb);
  LOG.info("Cluster Dump: " + sb.toString());
  for (  ServiceComponent sc : clusters.getCluster(clusterName).getService(serviceName).getServiceComponents().values()) {
    for (    ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
      if (sc.isClientComponent()) {
        sch.setState(State.INSTALLED);
      }
 else {
        sch.setState(State.INSTALL_FAILED);
      }
    }
  }
  r=new ServiceRequest(clusterName,serviceName,State.INSTALLED.toString());
  requests.clear();
  requests.add(r);
  trackAction=ServiceResourceProviderTest.updateServices(controller,requests,mapRequestProps,true,false);
  Assert.assertEquals(State.INSTALLED,clusters.getCluster(clusterName).getService(serviceName).getDesiredState());
  for (  ServiceComponent sc : clusters.getCluster(clusterName).getService(serviceName).getServiceComponents().values()) {
    Assert.assertEquals(State.INSTALLED,sc.getDesiredState());
    for (    ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
      Assert.assertEquals(State.INSTALLED,sch.getDesiredState());
    }
  }
  stages=actionDB.getAllStages(trackAction.getRequestId());
  Assert.assertEquals(1,stages.size());
}

</code></pre>

<br>
<pre class="type-13 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReconfigureClientWithServiceStarted() throws Exception {
  String clusterName="foo1";
  createCluster(clusterName);
  Cluster cluster=clusters.getCluster(clusterName);
  cluster.setDesiredStackVersion(new StackId("HDP-0.1"));
  String serviceName="HDFS";
  createService(clusterName,serviceName,null);
  String componentName1="NAMENODE";
  String componentName2="DATANODE";
  String componentName3="HDFS_CLIENT";
  createServiceComponent(clusterName,serviceName,componentName1,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName2,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName3,State.INIT);
  String host1="h1";
  String host2="h2";
  addHostToCluster(host1,clusterName);
  addHostToCluster(host2,clusterName);
  createServiceComponentHost(clusterName,serviceName,componentName1,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName2,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName3,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName3,host2,null);
  Map<String,String> configs=new HashMap<String,String>();
  configs.put("a","b");
  Map<String,String> configs2=new HashMap<String,String>();
  configs2.put("c","d");
  ConfigurationRequest cr1, cr2, cr3;
  cr1=new ConfigurationRequest(clusterName,"core-site","version1",configs,null);
  cr2=new ConfigurationRequest(clusterName,"hdfs-site","version1",configs,null);
  ClusterRequest crReq=new ClusterRequest(cluster.getClusterId(),clusterName,null,null);
  crReq.setDesiredConfig(Collections.singletonList(cr1));
  controller.updateClusters(Collections.singleton(crReq),null);
  crReq=new ClusterRequest(cluster.getClusterId(),clusterName,null,null);
  crReq.setDesiredConfig(Collections.singletonList(cr2));
  controller.updateClusters(Collections.singleton(crReq),null);
  installService(clusterName,serviceName,false,false);
  startService(clusterName,serviceName,false,false);
  Cluster c=clusters.getCluster(clusterName);
  Service s=c.getService(serviceName);
  stopServiceComponentHosts(clusterName,serviceName);
  Assert.assertEquals(State.STARTED,s.getDesiredState());
  for (  ServiceComponent sc : s.getServiceComponents().values()) {
    for (    ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
      Assert.assertEquals(State.INSTALLED,sch.getDesiredState());
    }
  }
  cr3=new ConfigurationRequest(clusterName,"core-site","version122",configs2,null);
  crReq=new ClusterRequest(cluster.getClusterId(),clusterName,null,null);
  crReq.setDesiredConfig(Collections.singletonList(cr3));
  controller.updateClusters(Collections.singleton(crReq),null);
  long id=startService(clusterName,serviceName,false,true);
  List<Stage> stages=actionDB.getAllStages(id);
  HostRoleCommand clientHrc=null;
  for (  Stage stage : stages) {
    for (    HostRoleCommand hrc : stage.getOrderedHostRoleCommands()) {
      if (hrc.getHostName().equals(host2) && hrc.getRole().toString().equals("HDFS_CLIENT")) {
        clientHrc=hrc;
        Assert.assertEquals("version122",hrc.getExecutionCommandWrapper().getExecutionCommand().getConfigurationTags().get("core-site").get("tag"));
      }
    }
  }
  Assert.assertNotNull(clientHrc);
}

</code></pre>

<br>
<pre class="type-4 type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSkipTaskOnUnhealthyHosts() throws AmbariException, AuthorizationException {
  String clusterName="foo1";
  createCluster(clusterName);
  clusters.getCluster(clusterName).setDesiredStackVersion(new StackId("HDP-0.1"));
  String serviceName="HDFS";
  createService(clusterName,serviceName,null);
  String componentName1="NAMENODE";
  String componentName2="DATANODE";
  createServiceComponent(clusterName,serviceName,componentName1,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName2,State.INIT);
  String host1="h1";
  String host2="h2";
  String host3="h3";
  addHostToCluster(host1,clusterName);
  addHostToCluster(host2,clusterName);
  addHostToCluster(host3,clusterName);
  createServiceComponentHost(clusterName,serviceName,componentName1,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName2,host2,null);
  createServiceComponentHost(clusterName,serviceName,componentName2,host3,null);
  installService(clusterName,serviceName,false,false);
  clusters.getHost("h1").setState(HostState.HEALTHY);
  clusters.getHost("h2").setState(HostState.HEALTHY);
  clusters.getHost("h3").setState(HostState.HEARTBEAT_LOST);
  long requestId=startService(clusterName,serviceName,true,false);
  List<HostRoleCommand> commands=actionDB.getRequestTasks(requestId);
  Assert.assertEquals(3,commands.size());
  int commandCount=0;
  for (  HostRoleCommand command : commands) {
    if (command.getRoleCommand() == RoleCommand.START) {
      Assert.assertTrue(command.getHostName().equals("h1") || command.getHostName().equals("h2"));
      commandCount++;
    }
  }
  Assert.assertEquals("Expect only two task.",2,commandCount);
  stopService(clusterName,serviceName,false,false);
  clusters.getHost("h1").setState(HostState.HEARTBEAT_LOST);
  clusters.getHost("h2").setState(HostState.HEARTBEAT_LOST);
  clusters.getHost("h3").setState(HostState.HEALTHY);
  requestId=startService(clusterName,serviceName,true,false);
  commands=actionDB.getRequestTasks(requestId);
  commandCount=0;
  for (  HostRoleCommand command : commands) {
    if (command.getRoleCommand() == RoleCommand.START) {
      Assert.assertTrue(command.getHostName().equals("h3"));
      commandCount++;
    }
  }
  Assert.assertEquals("Expect only one task.",1,commandCount);
  stopService(clusterName,serviceName,false,false);
  clusters.getHost("h1").setState(HostState.HEALTHY);
  clusters.getHost("h2").setState(HostState.HEALTHY);
  clusters.getHost("h3").setState(HostState.HEALTHY);
  requestId=startService(clusterName,serviceName,true,false);
  commands=actionDB.getRequestTasks(requestId);
  commandCount=0;
  for (  HostRoleCommand command : commands) {
    if (command.getRoleCommand() == RoleCommand.START) {
      Assert.assertTrue(command.getHostName().equals("h3") || command.getHostName().equals("h2") || command.getHostName().equals("h1"));
      commandCount++;
    }
  }
  Assert.assertEquals("Expect all three task.",3,commandCount);
  clusters.getHost("h2").setState(HostState.HEARTBEAT_LOST);
  requestId=stopService(clusterName,serviceName,false,false);
  commands=actionDB.getRequestTasks(requestId);
  Assert.assertEquals(2,commands.size());
  commandCount=0;
  for (  HostRoleCommand command : commands) {
    if (command.getRoleCommand() == RoleCommand.STOP) {
      Assert.assertTrue(command.getHostName().equals("h3") || command.getHostName().equals("h1"));
      commandCount++;
    }
  }
  Assert.assertEquals("Expect only two task.",2,commandCount);
  Cluster cluster=clusters.getCluster(clusterName);
  Service s=cluster.getService(serviceName);
  ServiceComponent sc3=s.getServiceComponent(componentName2);
  for (  ServiceComponentHost sch : sc3.getServiceComponentHosts().values()) {
    if (sch.getHostName().equals("h3")) {
      sch.setState(State.INSTALL_FAILED);
    }
  }
  clusters.getHost("h3").setState(HostState.HEARTBEAT_LOST);
  clusters.getHost("h2").setState(HostState.HEALTHY);
  requestId=installService(clusterName,serviceName,false,false);
  Assert.assertEquals(-1,requestId);
  clusters.getHost("h3").setState(HostState.HEALTHY);
  requestId=installService(clusterName,serviceName,false,false);
  commands=actionDB.getRequestTasks(requestId);
  Assert.assertEquals(1,commands.size());
  commandCount=0;
  for (  HostRoleCommand command : commands) {
    if (command.getRoleCommand() == RoleCommand.INSTALL) {
      Assert.assertTrue(command.getHostName().equals("h3"));
      commandCount++;
    }
  }
  Assert.assertEquals("Expect only one task.",1,commandCount);
}

</code></pre>

<br>
<pre class="type-4 type-13 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMaintenanceState() throws Exception {
  String clusterName="c1";
  createCluster(clusterName);
  clusters.getCluster(clusterName).setDesiredStackVersion(new StackId("HDP-1.2.0"));
  String serviceName="HDFS";
  createService(clusterName,serviceName,null);
  String componentName1="NAMENODE";
  String componentName2="DATANODE";
  String componentName3="HDFS_CLIENT";
  createServiceComponent(clusterName,serviceName,componentName1,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName2,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName3,State.INIT);
  String host1="h1";
  String host2="h2";
  addHostToCluster(host1,clusterName);
  addHostToCluster(host2,clusterName);
  createServiceComponentHost(clusterName,serviceName,componentName1,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName2,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName2,host2,null);
  Map<String,String> requestProperties=new HashMap<String,String>();
  requestProperties.put("context","Called from a test");
  Cluster cluster=clusters.getCluster(clusterName);
  Service service=cluster.getService(serviceName);
  Map<String,Host> hosts=clusters.getHostsForCluster(clusterName);
  MaintenanceStateHelper maintenanceStateHelper=MaintenanceStateHelperTest.getMaintenanceStateHelperInstance(clusters);
  ServiceRequest sr=new ServiceRequest(clusterName,serviceName,null);
  sr.setMaintenanceState(MaintenanceState.ON.name());
  ServiceResourceProviderTest.updateServices(controller,Collections.singleton(sr),requestProperties,false,false,maintenanceStateHelper);
  Assert.assertEquals(MaintenanceState.ON,service.getMaintenanceState());
  for (  ServiceComponent sc : service.getServiceComponents().values()) {
    for (    ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
      Assert.assertEquals(MaintenanceState.IMPLIED_FROM_SERVICE,controller.getEffectiveMaintenanceState(sch));
      Assert.assertEquals(MaintenanceState.OFF,sch.getMaintenanceState());
    }
  }
  sr.setMaintenanceState(MaintenanceState.OFF.name());
  ServiceResourceProviderTest.updateServices(controller,Collections.singleton(sr),requestProperties,false,false,maintenanceStateHelper);
  Assert.assertEquals(MaintenanceState.OFF,service.getMaintenanceState());
  for (  ServiceComponent sc : service.getServiceComponents().values()) {
    for (    ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
      Assert.assertEquals(MaintenanceState.OFF,controller.getEffectiveMaintenanceState(sch));
      Assert.assertEquals(MaintenanceState.OFF,sch.getMaintenanceState());
    }
  }
  HostRequest hr=new HostRequest(host1,clusterName,requestProperties);
  hr.setMaintenanceState(MaintenanceState.ON.name());
  HostResourceProviderTest.updateHosts(controller,Collections.singleton(hr));
  Host host=hosts.get(host1);
  Assert.assertEquals(MaintenanceState.ON,host.getMaintenanceState(cluster.getClusterId()));
  for (  ServiceComponent sc : service.getServiceComponents().values()) {
    for (    ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
      MaintenanceState implied=controller.getEffectiveMaintenanceState(sch);
      if (sch.getHostName().equals(host1)) {
        Assert.assertEquals(MaintenanceState.IMPLIED_FROM_HOST,implied);
      }
 else {
        Assert.assertEquals(MaintenanceState.OFF,implied);
      }
      Assert.assertEquals(MaintenanceState.OFF,sch.getMaintenanceState());
    }
  }
  hr.setMaintenanceState(MaintenanceState.OFF.name());
  HostResourceProviderTest.updateHosts(controller,Collections.singleton(hr));
  host=hosts.get(host1);
  Assert.assertEquals(MaintenanceState.OFF,host.getMaintenanceState(cluster.getClusterId()));
  for (  ServiceComponent sc : service.getServiceComponents().values()) {
    for (    ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
      Assert.assertEquals(MaintenanceState.OFF,controller.getEffectiveMaintenanceState(sch));
      Assert.assertEquals(MaintenanceState.OFF,sch.getMaintenanceState());
    }
  }
  HostRequest hr1=new HostRequest(host1,clusterName,requestProperties);
  hr1.setMaintenanceState(MaintenanceState.ON.name());
  HostRequest hr2=new HostRequest(host2,clusterName,requestProperties);
  hr2.setMaintenanceState(MaintenanceState.ON.name());
  Set<HostRequest> set=new HashSet<HostRequest>();
  set.add(hr1);
  set.add(hr2);
  HostResourceProviderTest.updateHosts(controller,set);
  host=hosts.get(host1);
  Assert.assertEquals(MaintenanceState.ON,host.getMaintenanceState(cluster.getClusterId()));
  host=hosts.get(host2);
  Assert.assertEquals(MaintenanceState.ON,host.getMaintenanceState(cluster.getClusterId()));
  hr1=new HostRequest(host1,clusterName,requestProperties);
  hr1.setMaintenanceState(MaintenanceState.OFF.name());
  hr2=new HostRequest(host2,clusterName,requestProperties);
  hr2.setMaintenanceState(MaintenanceState.OFF.name());
  set=new HashSet<HostRequest>();
  set.add(hr1);
  set.add(hr2);
  HostResourceProviderTest.updateHosts(controller,set);
  host=hosts.get(host1);
  Assert.assertEquals(MaintenanceState.OFF,host.getMaintenanceState(cluster.getClusterId()));
  host=hosts.get(host2);
  Assert.assertEquals(MaintenanceState.OFF,host.getMaintenanceState(cluster.getClusterId()));
  ServiceComponentHost targetSch=service.getServiceComponent(componentName2).getServiceComponentHosts().get(host2);
  Assert.assertNotNull(targetSch);
  targetSch.setMaintenanceState(MaintenanceState.ON);
  Assert.assertEquals(MaintenanceState.ON,controller.getEffectiveMaintenanceState(targetSch));
  service.setMaintenanceState(MaintenanceState.ON);
  Assert.assertEquals(MaintenanceState.ON,controller.getEffectiveMaintenanceState(targetSch));
  targetSch.setMaintenanceState(MaintenanceState.OFF);
  Assert.assertEquals(MaintenanceState.IMPLIED_FROM_SERVICE,controller.getEffectiveMaintenanceState(targetSch));
  service.setMaintenanceState(MaintenanceState.OFF);
  Assert.assertEquals(MaintenanceState.OFF,controller.getEffectiveMaintenanceState(targetSch));
  host=hosts.get(host2);
  host.setMaintenanceState(cluster.getClusterId(),MaintenanceState.ON);
  Assert.assertEquals(MaintenanceState.IMPLIED_FROM_HOST,controller.getEffectiveMaintenanceState(targetSch));
  targetSch.setMaintenanceState(MaintenanceState.ON);
  Assert.assertEquals(MaintenanceState.ON,controller.getEffectiveMaintenanceState(targetSch));
  for (  ServiceComponent sc : service.getServiceComponents().values()) {
    for (    ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
      Assert.assertEquals(State.INIT,sch.getState());
    }
  }
  long id1=installService(clusterName,serviceName,false,false,maintenanceStateHelper,null);
  List<HostRoleCommand> hdfsCmds=actionDB.getRequestTasks(id1);
  Assert.assertNotNull(hdfsCmds);
  HostRoleCommand datanodeCmd=null;
  for (  HostRoleCommand cmd : hdfsCmds) {
    if (cmd.getRole().equals(Role.DATANODE)) {
      datanodeCmd=cmd;
    }
  }
  Assert.assertNotNull(datanodeCmd);
  for (  ServiceComponent sc : service.getServiceComponents().values()) {
    if (!sc.getName().equals(componentName2)) {
      continue;
    }
    for (    ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
      Assert.assertEquals(sch == targetSch ? State.INIT : State.INSTALLED,sch.getState());
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-13 type-10 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testServiceUpdateRecursive() throws AmbariException, AuthorizationException {
  String clusterName="foo1";
  createCluster(clusterName);
  clusters.getCluster(clusterName).setDesiredStackVersion(new StackId("HDP-0.2"));
  String serviceName1="HDFS";
  createService(clusterName,serviceName1,null);
  String serviceName2="HBASE";
  createService(clusterName,serviceName2,null);
  String componentName1="NAMENODE";
  String componentName2="DATANODE";
  String componentName3="HBASE_MASTER";
  String componentName4="HDFS_CLIENT";
  Map<String,String> mapRequestProps=new HashMap<String,String>();
  mapRequestProps.put("context","Called from a test");
  createServiceComponent(clusterName,serviceName1,componentName1,State.INIT);
  createServiceComponent(clusterName,serviceName1,componentName2,State.INIT);
  createServiceComponent(clusterName,serviceName2,componentName3,State.INIT);
  createServiceComponent(clusterName,serviceName1,componentName4,State.INIT);
  String host1="h1";
  String host2="h2";
  addHostToCluster(host1,clusterName);
  addHostToCluster(host2,clusterName);
  Set<ServiceComponentHostRequest> set1=new HashSet<ServiceComponentHostRequest>();
  ServiceComponentHostRequest r1=new ServiceComponentHostRequest(clusterName,serviceName1,componentName1,host1,State.INIT.toString());
  ServiceComponentHostRequest r2=new ServiceComponentHostRequest(clusterName,serviceName1,componentName2,host1,State.INIT.toString());
  ServiceComponentHostRequest r3=new ServiceComponentHostRequest(clusterName,serviceName1,componentName1,host2,State.INIT.toString());
  ServiceComponentHostRequest r4=new ServiceComponentHostRequest(clusterName,serviceName1,componentName2,host2,State.INIT.toString());
  ServiceComponentHostRequest r5=new ServiceComponentHostRequest(clusterName,serviceName2,componentName3,host1,State.INIT.toString());
  ServiceComponentHostRequest r6=new ServiceComponentHostRequest(clusterName,serviceName1,componentName4,host2,State.INIT.toString());
  set1.add(r1);
  set1.add(r2);
  set1.add(r3);
  set1.add(r4);
  set1.add(r5);
  set1.add(r6);
  controller.createHostComponents(set1);
  Cluster c1=clusters.getCluster(clusterName);
  Service s1=c1.getService(serviceName1);
  Service s2=c1.getService(serviceName2);
  ServiceComponent sc1=s1.getServiceComponent(componentName1);
  ServiceComponent sc2=s1.getServiceComponent(componentName2);
  ServiceComponent sc3=s2.getServiceComponent(componentName3);
  ServiceComponent sc4=s1.getServiceComponent(componentName4);
  ServiceComponentHost sch1=sc1.getServiceComponentHost(host1);
  ServiceComponentHost sch2=sc2.getServiceComponentHost(host1);
  ServiceComponentHost sch3=sc1.getServiceComponentHost(host2);
  ServiceComponentHost sch4=sc2.getServiceComponentHost(host2);
  ServiceComponentHost sch5=sc3.getServiceComponentHost(host1);
  ServiceComponentHost sch6=sc4.getServiceComponentHost(host2);
  s1.setDesiredState(State.INSTALLED);
  s2.setDesiredState(State.INSTALLED);
  sc1.setDesiredState(State.STARTED);
  sc2.setDesiredState(State.INIT);
  sc3.setDesiredState(State.STARTED);
  sc4.setDesiredState(State.INSTALLED);
  sch1.setDesiredState(State.INSTALLED);
  sch2.setDesiredState(State.INSTALLED);
  sch3.setDesiredState(State.INSTALLED);
  sch4.setDesiredState(State.INSTALLED);
  sch5.setDesiredState(State.INSTALLED);
  sch6.setDesiredState(State.INSTALLED);
  sch1.setState(State.INSTALLED);
  sch2.setState(State.INSTALLED);
  sch3.setState(State.INSTALLED);
  sch4.setState(State.INSTALLED);
  sch5.setState(State.INSTALLED);
  sch6.setState(State.INSTALLED);
  Set<ServiceRequest> reqs=new HashSet<ServiceRequest>();
  ServiceRequest req1, req2;
  try {
    reqs.clear();
    req1=new ServiceRequest(clusterName,serviceName1,State.STARTED.toString());
    reqs.add(req1);
    ServiceResourceProviderTest.updateServices(controller,reqs,mapRequestProps,true,false);
    fail("Expected failure for invalid state update");
  }
 catch (  Exception e) {
  }
  s1.setDesiredState(State.INSTALLED);
  s2.setDesiredState(State.INSTALLED);
  sc1.setDesiredState(State.STARTED);
  sc2.setDesiredState(State.INSTALLED);
  sc3.setDesiredState(State.STARTED);
  sch1.setDesiredState(State.INSTALLED);
  sch2.setDesiredState(State.INSTALLED);
  sch3.setDesiredState(State.INSTALLED);
  sch4.setDesiredState(State.INSTALLED);
  sch5.setDesiredState(State.INSTALLED);
  sch1.setState(State.INIT);
  sch2.setState(State.INSTALLED);
  sch3.setState(State.INIT);
  sch4.setState(State.INSTALLED);
  sch5.setState(State.INSTALLED);
  try {
    reqs.clear();
    req1=new ServiceRequest(clusterName,serviceName1,State.STARTED.toString());
    reqs.add(req1);
    ServiceResourceProviderTest.updateServices(controller,reqs,mapRequestProps,true,false);
    fail("Expected failure for invalid state update");
  }
 catch (  Exception e) {
  }
  s1.setDesiredState(State.INSTALLED);
  s2.setDesiredState(State.INSTALLED);
  sc1.setDesiredState(State.STARTED);
  sc2.setDesiredState(State.INSTALLED);
  sc3.setDesiredState(State.STARTED);
  sch1.setDesiredState(State.STARTED);
  sch2.setDesiredState(State.STARTED);
  sch3.setDesiredState(State.STARTED);
  sch4.setDesiredState(State.STARTED);
  sch5.setDesiredState(State.STARTED);
  sch1.setState(State.INSTALLED);
  sch2.setState(State.INSTALLED);
  sch3.setState(State.INSTALLED);
  sch4.setState(State.STARTED);
  sch5.setState(State.INSTALLED);
  reqs.clear();
  req1=new ServiceRequest(clusterName,serviceName1,State.STARTED.toString());
  req2=new ServiceRequest(clusterName,serviceName2,State.STARTED.toString());
  reqs.add(req1);
  reqs.add(req2);
  RequestStatusResponse trackAction=ServiceResourceProviderTest.updateServices(controller,reqs,mapRequestProps,true,false);
  Assert.assertEquals(State.STARTED,s1.getDesiredState());
  Assert.assertEquals(State.STARTED,s2.getDesiredState());
  Assert.assertEquals(State.STARTED,sc1.getDesiredState());
  Assert.assertEquals(State.STARTED,sc2.getDesiredState());
  Assert.assertEquals(State.STARTED,sc3.getDesiredState());
  Assert.assertEquals(State.INSTALLED,sc4.getDesiredState());
  Assert.assertEquals(State.STARTED,sch1.getDesiredState());
  Assert.assertEquals(State.STARTED,sch2.getDesiredState());
  Assert.assertEquals(State.STARTED,sch3.getDesiredState());
  Assert.assertEquals(State.STARTED,sch4.getDesiredState());
  Assert.assertEquals(State.STARTED,sch5.getDesiredState());
  Assert.assertEquals(State.INSTALLED,sch6.getDesiredState());
  Assert.assertEquals(State.INSTALLED,sch1.getState());
  Assert.assertEquals(State.INSTALLED,sch2.getState());
  Assert.assertEquals(State.INSTALLED,sch3.getState());
  Assert.assertEquals(State.STARTED,sch4.getState());
  Assert.assertEquals(State.INSTALLED,sch5.getState());
  Assert.assertEquals(State.INSTALLED,sch6.getState());
  long requestId=trackAction.getRequestId();
  List<Stage> stages=actionDB.getAllStages(requestId);
  for (  Stage stage : stages) {
    LOG.debug("Stage dump: " + stage.toString());
  }
  Assert.assertTrue(!stages.isEmpty());
  Assert.assertEquals(3,stages.size());
  Stage stage1=null, stage2=null, stage3=null;
  for (  Stage s : stages) {
    if (s.getStageId() == 0) {
      stage1=s;
    }
    if (s.getStageId() == 1) {
      stage2=s;
    }
    if (s.getStageId() == 2) {
      stage3=s;
    }
  }
  Assert.assertEquals(2,stage1.getExecutionCommands(host1).size());
  Assert.assertEquals(1,stage1.getExecutionCommands(host2).size());
  Assert.assertEquals(1,stage2.getExecutionCommands(host1).size());
  Assert.assertNotNull(stage1.getExecutionCommandWrapper(host1,"NAMENODE"));
  Assert.assertNotNull(stage1.getExecutionCommandWrapper(host1,"DATANODE"));
  Assert.assertNotNull(stage1.getExecutionCommandWrapper(host2,"NAMENODE"));
  Assert.assertNotNull(stage2.getExecutionCommandWrapper(host1,"HBASE_MASTER"));
  Assert.assertNull(stage1.getExecutionCommandWrapper(host2,"DATANODE"));
  Assert.assertNotNull(stage3.getExecutionCommandWrapper(host1,"HBASE_SERVICE_CHECK"));
  Assert.assertNotNull(stage2.getExecutionCommandWrapper(host2,"HDFS_SERVICE_CHECK"));
  Type type=new TypeToken<Map<String,String>>(){
  }
.getType();
  for (  Stage s : stages) {
    for (    List<ExecutionCommandWrapper> list : s.getExecutionCommands().values()) {
      for (      ExecutionCommandWrapper ecw : list) {
        if (ecw.getExecutionCommand().getRole().contains("SERVICE_CHECK")) {
          Map<String,String> hostParams=StageUtils.getGson().fromJson(s.getHostParamsStage(),type);
          Assert.assertNotNull(hostParams);
          Assert.assertTrue(hostParams.size() > 0);
          Assert.assertTrue(hostParams.containsKey("stack_version"));
          Assert.assertEquals(hostParams.get("stack_version"),c1.getDesiredStackVersion().getStackVersion());
        }
      }
    }
  }
  sch1.setState(State.STARTED);
  sch2.setState(State.STARTED);
  sch3.setState(State.STARTED);
  sch4.setState(State.STARTED);
  sch5.setState(State.STARTED);
  reqs.clear();
  req1=new ServiceRequest(clusterName,serviceName1,State.STARTED.toString());
  req2=new ServiceRequest(clusterName,serviceName2,State.STARTED.toString());
  reqs.add(req1);
  reqs.add(req2);
  trackAction=ServiceResourceProviderTest.updateServices(controller,reqs,mapRequestProps,true,false);
  Assert.assertNull(trackAction);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.controller.RootServiceResponseFactoryTest </h4><pre class="type-12 type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetRootServiceComponents() throws Exception {
  RootServiceComponentRequest request=new RootServiceComponentRequest(null,null);
  Set<RootServiceComponentResponse> rootServiceComponents;
  try {
    rootServiceComponents=responseFactory.getRootServiceComponents(request);
  }
 catch (  Exception e) {
    assertTrue(e instanceof ObjectNotFoundException);
  }
  RootServiceResponseFactory.Components ambariServerComponent=RootServiceResponseFactory.Components.AMBARI_SERVER;
  request=new RootServiceComponentRequest(null,ambariServerComponent.name());
  try {
    rootServiceComponents=responseFactory.getRootServiceComponents(request);
  }
 catch (  Exception e) {
    assertTrue(e instanceof ObjectNotFoundException);
  }
  request=new RootServiceComponentRequest(RootServiceResponseFactory.Services.AMBARI.name(),null);
  rootServiceComponents=responseFactory.getRootServiceComponents(request);
  assertEquals(RootServiceResponseFactory.Services.AMBARI.getComponents().length,rootServiceComponents.size());
  String ambariVersion=ambariMetaInfo.getServerVersion();
  for (int i=0; i < RootServiceResponseFactory.Services.AMBARI.getComponents().length; i++) {
    Components component=RootServiceResponseFactory.Services.AMBARI.getComponents()[i];
    if (component.name().equals(ambariServerComponent.name())) {
      for (      RootServiceComponentResponse response : rootServiceComponents) {
        if (response.getComponentName().equals(ambariServerComponent.name())) {
          assertEquals(ambariVersion,response.getComponentVersion());
          assertEquals(1,response.getProperties().size(),1);
          assertTrue(response.getProperties().containsKey("jdk_location"));
        }
      }
    }
 else {
      assertTrue(rootServiceComponents.contains(new RootServiceComponentResponse(component.name(),RootServiceResponseFactory.NOT_APPLICABLE,Collections.<String,String>emptyMap())));
    }
  }
  request=new RootServiceComponentRequest(RootServiceResponseFactory.Services.AMBARI.name(),RootServiceResponseFactory.Services.AMBARI.getComponents()[0].name());
  rootServiceComponents=responseFactory.getRootServiceComponents(request);
  assertEquals(1,rootServiceComponents.size());
  for (  RootServiceComponentResponse response : rootServiceComponents) {
    if (response.getComponentName().equals(RootServiceResponseFactory.Services.AMBARI.getComponents()[0].name())) {
      assertEquals(ambariVersion,response.getComponentVersion());
      assertEquals(2,response.getProperties().size());
      assertTrue(response.getProperties().containsKey("jdk_location"));
      assertTrue(response.getProperties().containsKey("java.version"));
    }
  }
  request=new RootServiceComponentRequest(RootServiceResponseFactory.Services.AMBARI.name(),"XXX");
  try {
    rootServiceComponents=responseFactory.getRootServiceComponents(request);
  }
 catch (  Exception e) {
    assertTrue(e instanceof ObjectNotFoundException);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.controller.internal.ArtifactResourceProviderTest </h4><pre class="type-13 type-10 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetResources_collection() throws Exception {
  Set<String> propertyIds=new HashSet<String>();
  TreeMap<String,String> foreignKeys=new TreeMap<String,String>();
  foreignKeys.put("cluster","500");
  List<ArtifactEntity> entities=new ArrayList<ArtifactEntity>();
  entities.add(entity);
  entities.add(entity2);
  Map<String,Object> artifact_data=Collections.<String,Object>singletonMap("foo","bar");
  Map<String,Object> artifact_data2=Collections.<String,Object>singletonMap("foo2","bar2");
  Map<String,String> responseForeignKeys=new HashMap<String,String>();
  responseForeignKeys.put("cluster","500");
  expect(controller.getClusters()).andReturn(clusters).anyTimes();
  expect(clusters.getCluster("test-cluster")).andReturn(cluster).anyTimes();
  expect(clusters.getClusterById(500L)).andReturn(cluster).anyTimes();
  expect(cluster.getClusterId()).andReturn(500L).anyTimes();
  expect(cluster.getClusterName()).andReturn("test-cluster").anyTimes();
  expect(request.getPropertyIds()).andReturn(propertyIds).anyTimes();
  expect(dao.findByForeignKeys(eq(foreignKeys))).andReturn(entities).anyTimes();
  expect(entity.getArtifactName()).andReturn("test-artifact").anyTimes();
  expect(entity.getForeignKeys()).andReturn(responseForeignKeys).anyTimes();
  expect(entity.getArtifactData()).andReturn(artifact_data).anyTimes();
  expect(entity2.getArtifactName()).andReturn("test-artifact2").anyTimes();
  expect(entity2.getForeignKeys()).andReturn(responseForeignKeys).anyTimes();
  expect(entity2.getArtifactData()).andReturn(artifact_data2).anyTimes();
  replay(dao,em,controller,request,clusters,cluster,entity,entity2);
  PredicateBuilder pb=new PredicateBuilder();
  Predicate predicate=pb.begin().property("Artifacts/cluster_name").equals("test-cluster").end().toPredicate();
  Set<Resource> response=resourceProvider.getResources(request,predicate);
  assertEquals(2,response.size());
  boolean artifact1Returned=false;
  boolean artifact2Returned=false;
  for (  Resource resource : response) {
    if (resource.getPropertyValue("Artifacts/artifact_name").equals("test-artifact")) {
      artifact1Returned=true;
      assertEquals("bar",resource.getPropertyValue("artifact_data/foo"));
      assertEquals("test-cluster",resource.getPropertyValue("Artifacts/cluster_name"));
    }
 else     if (resource.getPropertyValue("Artifacts/artifact_name").equals("test-artifact2")) {
      artifact2Returned=true;
      assertEquals("bar2",resource.getPropertyValue("artifact_data/foo2"));
      assertEquals("test-cluster",resource.getPropertyValue("Artifacts/cluster_name"));
    }
 else {
      fail("unexpected artifact name");
    }
  }
  assertTrue(artifact1Returned);
  assertTrue(artifact2Returned);
}

</code></pre>

<br>
<pre class="type-13 type-10 type-2 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeleteResources() throws Exception {
  Capture<ArtifactEntity> deleteEntityCapture=new Capture<ArtifactEntity>();
  Capture<ArtifactEntity> deleteEntityCapture2=new Capture<ArtifactEntity>();
  TreeMap<String,String> foreignKeys=new TreeMap<String,String>();
  foreignKeys.put("cluster","500");
  List<ArtifactEntity> entities=new ArrayList<ArtifactEntity>();
  entities.add(entity);
  entities.add(entity2);
  Map<String,Object> artifact_data=Collections.<String,Object>singletonMap("foo","bar");
  Map<String,Object> artifact_data2=Collections.<String,Object>singletonMap("foo2","bar2");
  Map<String,String> responseForeignKeys=new HashMap<String,String>();
  responseForeignKeys.put("cluster","500");
  expect(controller.getClusters()).andReturn(clusters).anyTimes();
  expect(clusters.getCluster("test-cluster")).andReturn(cluster).anyTimes();
  expect(clusters.getClusterById(500L)).andReturn(cluster).anyTimes();
  expect(cluster.getClusterId()).andReturn(500L).anyTimes();
  expect(cluster.getClusterName()).andReturn("test-cluster").anyTimes();
  expect(entity.getArtifactName()).andReturn("test-artifact").anyTimes();
  expect(entity.getForeignKeys()).andReturn(responseForeignKeys).anyTimes();
  expect(entity.getArtifactData()).andReturn(artifact_data).anyTimes();
  expect(entity2.getArtifactName()).andReturn("test-artifact2").anyTimes();
  expect(entity2.getForeignKeys()).andReturn(responseForeignKeys).anyTimes();
  expect(entity2.getArtifactData()).andReturn(artifact_data2).anyTimes();
  expect(dao.findByForeignKeys(eq(foreignKeys))).andReturn(entities).once();
  expect(dao.findByNameAndForeignKeys(eq("test-artifact"),eq(foreignKeys))).andReturn(entity).once();
  dao.remove(capture(deleteEntityCapture));
  expect(dao.findByNameAndForeignKeys(eq("test-artifact2"),eq(foreignKeys))).andReturn(entity2).once();
  dao.remove(capture(deleteEntityCapture2));
  replay(dao,em,controller,request,clusters,cluster,entity,entity2);
  PredicateBuilder pb=new PredicateBuilder();
  Predicate predicate=pb.begin().property("Artifacts/cluster_name").equals("test-cluster").end().toPredicate();
  RequestStatus response=resourceProvider.deleteResources(predicate);
  ArtifactEntity deleteEntity=deleteEntityCapture.getValue();
  ArtifactEntity deleteEntity2=deleteEntityCapture2.getValue();
  if (deleteEntity.getArtifactName().equals("test-artifact")) {
    assertEquals("test-artifact2",deleteEntity2.getArtifactName());
  }
 else   if (deleteEntity.getArtifactName().equals("test-artifact2")) {
    assertEquals("test-artifact",deleteEntity2.getArtifactName());
  }
 else {
    fail("Unexpected artifact name: " + deleteEntity.getArtifactName());
  }
  assertEquals(foreignKeys,deleteEntity.getForeignKeys());
  assertEquals(foreignKeys,deleteEntity2.getForeignKeys());
  assertEquals(RequestStatus.Status.Complete,response.getStatus());
  verify(dao,em,controller,request,clusters,cluster,entity,entity2);
}

</code></pre>

<br>
<pre class="type-13 type-10 type-2 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpdateResources() throws Exception {
  Map<String,String> requestInfoProps=new HashMap<String,String>();
  requestInfoProps.put(Request.REQUEST_INFO_BODY_PROPERTY,bodyJson);
  Capture<ArtifactEntity> updateEntityCapture=new Capture<ArtifactEntity>();
  Capture<ArtifactEntity> updateEntityCapture2=new Capture<ArtifactEntity>();
  Set<String> propertyIds=new HashSet<String>();
  TreeMap<String,String> foreignKeys=new TreeMap<String,String>();
  foreignKeys.put("cluster","500");
  List<ArtifactEntity> entities=new ArrayList<ArtifactEntity>();
  entities.add(entity);
  entities.add(entity2);
  Map<String,Object> artifact_data=Collections.<String,Object>singletonMap("foo","bar");
  Map<String,Object> artifact_data2=Collections.<String,Object>singletonMap("foo2","bar2");
  Map<String,String> responseForeignKeys=new HashMap<String,String>();
  responseForeignKeys.put("cluster","500");
  Map<String,Object> properties=new HashMap<String,Object>();
  properties.put("Artifacts/artifact_name","test-artifact");
  properties.put("Artifacts/cluster_name","test-cluster");
  properties.put("artifact_data/foo","bar");
  properties.put("artifact_data/child/childKey","childValue");
  properties.put("artifact_data/child/child2/child2Key","child2Value");
  properties.put("artifact_data/child/child2/child3/child4/child4Key","child4Value");
  Set<Map<String,Object>> requestProperties=Collections.singleton(properties);
  Collection collectionProperties=new HashSet();
  properties.put("artifact_data/collection",collectionProperties);
  expect(request.getProperties()).andReturn(requestProperties).anyTimes();
  expect(request.getRequestInfoProperties()).andReturn(requestInfoProps).anyTimes();
  expect(controller.getClusters()).andReturn(clusters).anyTimes();
  expect(clusters.getCluster("test-cluster")).andReturn(cluster).anyTimes();
  expect(clusters.getClusterById(500L)).andReturn(cluster).anyTimes();
  expect(cluster.getClusterId()).andReturn(500L).anyTimes();
  expect(cluster.getClusterName()).andReturn("test-cluster").anyTimes();
  expect(request.getPropertyIds()).andReturn(propertyIds).anyTimes();
  expect(dao.findByForeignKeys(eq(foreignKeys))).andReturn(entities).anyTimes();
  expect(entity.getArtifactName()).andReturn("test-artifact").anyTimes();
  expect(entity.getForeignKeys()).andReturn(responseForeignKeys).anyTimes();
  expect(entity.getArtifactData()).andReturn(artifact_data).anyTimes();
  expect(entity2.getArtifactName()).andReturn("test-artifact2").anyTimes();
  expect(entity2.getForeignKeys()).andReturn(responseForeignKeys).anyTimes();
  expect(entity2.getArtifactData()).andReturn(artifact_data2).anyTimes();
  expect(dao.merge(capture(updateEntityCapture))).andReturn(entity).once();
  expect(dao.merge(capture(updateEntityCapture2))).andReturn(entity2).once();
  replay(dao,em,controller,request,clusters,cluster,entity,entity2);
  PredicateBuilder pb=new PredicateBuilder();
  Predicate predicate=pb.begin().property("Artifacts/cluster_name").equals("test-cluster").end().toPredicate();
  RequestStatus response=resourceProvider.updateResources(request,predicate);
  ArtifactEntity updateEntity=updateEntityCapture.getValue();
  ArtifactEntity updateEntity2=updateEntityCapture2.getValue();
  Gson serializer=new Gson();
  ArtifactEntity expected=new ArtifactEntity();
  expected.setArtifactData((Map<String,Object>)serializer.<Map<String,Object>>fromJson(bodyJson,Map.class).get("artifact_data"));
  assertEquals(expected.getArtifactData(),updateEntity.getArtifactData());
  assertEquals(expected.getArtifactData(),updateEntity2.getArtifactData());
  if (updateEntity.getArtifactName().equals("test-artifact")) {
    assertEquals("test-artifact2",updateEntity2.getArtifactName());
  }
 else   if (updateEntity.getArtifactName().equals("test-artifact2")) {
    assertEquals("test-artifact",updateEntity2.getArtifactName());
  }
 else {
    fail("Unexpected artifact name: " + updateEntity.getArtifactName());
  }
  assertEquals(foreignKeys,updateEntity.getForeignKeys());
  assertEquals(foreignKeys,updateEntity2.getForeignKeys());
  assertEquals(RequestStatus.Status.Complete,response.getStatus());
  verify(dao,em,controller,request,clusters,cluster,entity,entity2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.controller.internal.BlueprintConfigurationProcessorTest </h4><pre class="type-4 type-13 type-10 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDoUpdateForClusterWithNameNodeHAEnabledAndActiveNodeSet() throws Exception {
  final String expectedNameService="mynameservice";
  final String expectedHostName="serverThree";
  final String expectedHostNameTwo="serverFour";
  final String expectedPortNum="808080";
  final String expectedNodeOne="nn1";
  final String expectedNodeTwo="nn2";
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> hdfsSiteProperties=new HashMap<String,String>();
  Map<String,String> hadoopEnvProperties=new HashMap<String,String>();
  properties.put("hdfs-site",hdfsSiteProperties);
  properties.put("hadoop-env",hadoopEnvProperties);
  hdfsSiteProperties.put("dfs.nameservices",expectedNameService);
  hdfsSiteProperties.put("dfs.ha.namenodes.mynameservice",expectedNodeOne + ", " + expectedNodeTwo);
  hdfsSiteProperties.put("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeOne,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hdfsSiteProperties.put("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeTwo,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hdfsSiteProperties.put("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeOne,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hdfsSiteProperties.put("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeTwo,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hdfsSiteProperties.put("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeOne,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hdfsSiteProperties.put("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeTwo,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hadoopEnvProperties.put("dfs_ha_initial_namenode_active",expectedHostName);
  hadoopEnvProperties.put("dfs_ha_initial_namenode_standby",expectedHostNameTwo);
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  Collection<String> hosts=new ArrayList<String>();
  hosts.add(expectedHostName);
  hosts.add(expectedHostNameTwo);
  TestHostGroup group=new TestHostGroup(expectedHostGroupName,hgComponents,hosts);
  Collection<TestHostGroup> hostGroups=new ArrayList<TestHostGroup>();
  hostGroups.add(group);
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  String expectedPropertyValue=hdfsSiteProperties.get("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeOne);
  if (!expectedPropertyValue.equals(expectedHostName + ":" + expectedPortNum) && !expectedPropertyValue.equals(expectedHostNameTwo + ":" + expectedPortNum)) {
    fail("HTTPS address HA property not properly exported");
  }
  assertEquals("HTTPS address HA property not properly exported",expectedPropertyValue,hdfsSiteProperties.get("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeTwo));
  assertEquals("HTTPS address HA property not properly exported",expectedPropertyValue,hdfsSiteProperties.get("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",expectedPropertyValue,hdfsSiteProperties.get("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeTwo));
  assertEquals("HTTPS address HA property not properly exported",expectedPropertyValue,hdfsSiteProperties.get("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",expectedPropertyValue,hdfsSiteProperties.get("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeTwo));
  assertEquals("Active Namenode hostname was not set correctly",expectedHostName,hadoopEnvProperties.get("dfs_ha_initial_namenode_active"));
  assertEquals("Standby Namenode hostname was not set correctly",expectedHostNameTwo,hadoopEnvProperties.get("dfs_ha_initial_namenode_standby"));
}

</code></pre>

<br>
<pre class="type-4 type-13 type-10 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDoUpdateForClusterWithNameNodeHAEnabledSpecifyingHostNamesDirectly() throws Exception {
  final String expectedNameService="mynameservice";
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedHostNameTwo="serverTwo";
  final String expectedPortNum="808080";
  final String expectedNodeOne="nn1";
  final String expectedNodeTwo="nn2";
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> configProperties=new HashMap<String,Map<String,String>>();
  Map<String,String> hdfsSiteProperties=new HashMap<String,String>();
  Map<String,String> hbaseSiteProperties=new HashMap<String,String>();
  Map<String,String> hadoopEnvProperties=new HashMap<String,String>();
  Map<String,String> coreSiteProperties=new HashMap<String,String>();
  Map<String,String> accumuloSiteProperties=new HashMap<String,String>();
  configProperties.put("hdfs-site",hdfsSiteProperties);
  configProperties.put("hadoop-env",hadoopEnvProperties);
  configProperties.put("core-site",coreSiteProperties);
  configProperties.put("hbase-site",hbaseSiteProperties);
  configProperties.put("accumulo-site",accumuloSiteProperties);
  hdfsSiteProperties.put("dfs.nameservices",expectedNameService);
  hdfsSiteProperties.put("dfs.ha.namenodes.mynameservice",expectedNodeOne + ", " + expectedNodeTwo);
  hdfsSiteProperties.put("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeOne,createHostAddress(expectedHostName,expectedPortNum));
  hdfsSiteProperties.put("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeTwo,createHostAddress(expectedHostNameTwo,expectedPortNum));
  hdfsSiteProperties.put("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeOne,createHostAddress(expectedHostName,expectedPortNum));
  hdfsSiteProperties.put("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeTwo,createHostAddress(expectedHostNameTwo,expectedPortNum));
  hdfsSiteProperties.put("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeOne,createHostAddress(expectedHostName,expectedPortNum));
  hdfsSiteProperties.put("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeTwo,createHostAddress(expectedHostNameTwo,expectedPortNum));
  hdfsSiteProperties.put("dfs.secondary.http.address","localhost:8080");
  hdfsSiteProperties.put("dfs.namenode.secondary.http-address","localhost:8080");
  coreSiteProperties.put("fs.defaultFS","hdfs://" + expectedNameService);
  hbaseSiteProperties.put("hbase.rootdir","hdfs://" + expectedNameService + "/hbase/test/root/dir");
  accumuloSiteProperties.put("instance.volumes","hdfs://" + expectedNameService + "/accumulo/test/instance/volumes");
  Configuration clusterConfig=new Configuration(configProperties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,Collections.singleton(expectedHostName));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("NAMENODE");
  TestHostGroup group2=new TestHostGroup("host-group-2",hgComponents2,Collections.singleton(expectedHostNameTwo));
  Collection<TestHostGroup> hostGroups=new HashSet<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  expect(stack.getCardinality("NAMENODE")).andReturn(new Cardinality("1-2")).anyTimes();
  expect(stack.getCardinality("SECONDARY_NAMENODE")).andReturn(new Cardinality("1")).anyTimes();
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  updater.doUpdateForClusterCreate();
  assertEquals("HTTPS address HA property not properly exported",expectedHostName + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",expectedHostNameTwo + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeTwo));
  assertEquals("HTTPS address HA property not properly exported",expectedHostName + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",expectedHostNameTwo + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeTwo));
  assertEquals("HTTPS address HA property not properly exported",expectedHostName + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",expectedHostNameTwo + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeTwo));
  String activeHost=hadoopEnvProperties.get("dfs_ha_initial_namenode_active");
  if (activeHost.equals(expectedHostName)) {
    assertEquals("Standby Namenode hostname was not set correctly",expectedHostNameTwo,hadoopEnvProperties.get("dfs_ha_initial_namenode_standby"));
  }
 else   if (activeHost.equals(expectedHostNameTwo)) {
    assertEquals("Standby Namenode hostname was not set correctly",expectedHostName,hadoopEnvProperties.get("dfs_ha_initial_namenode_standby"));
  }
 else {
    fail("Active Namenode hostname was not set correctly: " + activeHost);
  }
  assertEquals("fs.defaultFS should not be modified by cluster update when NameNode HA is enabled.","hdfs://" + expectedNameService,coreSiteProperties.get("fs.defaultFS"));
  assertEquals("hbase.rootdir should not be modified by cluster update when NameNode HA is enabled.","hdfs://" + expectedNameService + "/hbase/test/root/dir",hbaseSiteProperties.get("hbase.rootdir"));
  assertEquals("instance.volumes should not be modified by cluster update when NameNode HA is enabled.","hdfs://" + expectedNameService + "/accumulo/test/instance/volumes",accumuloSiteProperties.get("instance.volumes"));
}

</code></pre>

<br>
<pre class="type-4 type-13 type-10 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDoUpdateForClusterWithNameNodeHAEnabled() throws Exception {
  final String expectedNameService="mynameservice";
  final String expectedHostName="c6401.apache.ambari.org";
  final String expectedHostNameTwo="serverTwo";
  final String expectedPortNum="808080";
  final String expectedNodeOne="nn1";
  final String expectedNodeTwo="nn2";
  final String expectedHostGroupName="host_group_1";
  Map<String,Map<String,String>> properties=new HashMap<String,Map<String,String>>();
  Map<String,String> hdfsSiteProperties=new HashMap<String,String>();
  Map<String,String> hbaseSiteProperties=new HashMap<String,String>();
  Map<String,String> hadoopEnvProperties=new HashMap<String,String>();
  Map<String,String> coreSiteProperties=new HashMap<String,String>();
  Map<String,String> accumuloSiteProperties=new HashMap<String,String>();
  properties.put("hdfs-site",hdfsSiteProperties);
  properties.put("hadoop-env",hadoopEnvProperties);
  properties.put("core-site",coreSiteProperties);
  properties.put("hbase-site",hbaseSiteProperties);
  properties.put("accumulo-site",accumuloSiteProperties);
  hdfsSiteProperties.put("dfs.nameservices",expectedNameService);
  hdfsSiteProperties.put("dfs.ha.namenodes.mynameservice",expectedNodeOne + ", " + expectedNodeTwo);
  hdfsSiteProperties.put("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeOne,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hdfsSiteProperties.put("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeTwo,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hdfsSiteProperties.put("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeOne,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hdfsSiteProperties.put("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeTwo,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hdfsSiteProperties.put("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeOne,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hdfsSiteProperties.put("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeTwo,createExportedAddress(expectedPortNum,expectedHostGroupName));
  hdfsSiteProperties.put("dfs.secondary.http.address","localhost:8080");
  hdfsSiteProperties.put("dfs.namenode.secondary.http-address","localhost:8080");
  hdfsSiteProperties.put("dfs.namenode.http-address","localhost:8080");
  hdfsSiteProperties.put("dfs.namenode.https-address","localhost:8081");
  hdfsSiteProperties.put("dfs.namenode.rpc-address","localhost:8082");
  coreSiteProperties.put("fs.defaultFS","hdfs://" + expectedNameService);
  hbaseSiteProperties.put("hbase.rootdir","hdfs://" + expectedNameService + "/hbase/test/root/dir");
  accumuloSiteProperties.put("instance.volumes","hdfs://" + expectedNameService + "/accumulo/test/instance/volumes");
  Configuration clusterConfig=new Configuration(properties,Collections.<String,Map<String,Map<String,String>>>emptyMap());
  Collection<String> hgComponents=new HashSet<String>();
  hgComponents.add("NAMENODE");
  TestHostGroup group1=new TestHostGroup(expectedHostGroupName,hgComponents,Collections.singleton(expectedHostName));
  Collection<String> hgComponents2=new HashSet<String>();
  hgComponents2.add("NAMENODE");
  TestHostGroup group2=new TestHostGroup("host-group-2",hgComponents2,Collections.singleton(expectedHostNameTwo));
  Collection<TestHostGroup> hostGroups=new ArrayList<TestHostGroup>();
  hostGroups.add(group1);
  hostGroups.add(group2);
  expect(stack.getCardinality("NAMENODE")).andReturn(new Cardinality("1-2")).anyTimes();
  expect(stack.getCardinality("SECONDARY_NAMENODE")).andReturn(new Cardinality("1")).anyTimes();
  ClusterTopology topology=createClusterTopology(bp,clusterConfig,hostGroups);
  BlueprintConfigurationProcessor updater=new BlueprintConfigurationProcessor(topology);
  Set<String> updatedConfigTypes=updater.doUpdateForClusterCreate();
  assertEquals("HTTPS address HA property not properly exported",expectedHostName + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",expectedHostName + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.https-address." + expectedNameService + "."+ expectedNodeTwo));
  assertEquals("HTTPS address HA property not properly exported",expectedHostName + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",expectedHostName + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.http-address." + expectedNameService + "."+ expectedNodeTwo));
  assertEquals("HTTPS address HA property not properly exported",expectedHostName + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeOne));
  assertEquals("HTTPS address HA property not properly exported",expectedHostName + ":" + expectedPortNum,hdfsSiteProperties.get("dfs.namenode.rpc-address." + expectedNameService + "."+ expectedNodeTwo));
  String initialActiveHost=hadoopEnvProperties.get("dfs_ha_initial_namenode_active");
  String expectedStandbyHost=null;
  if (initialActiveHost.equals(expectedHostName)) {
    expectedStandbyHost=expectedHostNameTwo;
  }
 else   if (initialActiveHost.equals(expectedHostNameTwo)) {
    expectedStandbyHost=expectedHostName;
  }
 else {
    fail("Active Namenode hostname was not set correctly");
  }
  assertEquals("Standby Namenode hostname was not set correctly",expectedStandbyHost,hadoopEnvProperties.get("dfs_ha_initial_namenode_standby"));
  assertEquals("fs.defaultFS should not be modified by cluster update when NameNode HA is enabled.","hdfs://" + expectedNameService,coreSiteProperties.get("fs.defaultFS"));
  assertEquals("hbase.rootdir should not be modified by cluster update when NameNode HA is enabled.","hdfs://" + expectedNameService + "/hbase/test/root/dir",hbaseSiteProperties.get("hbase.rootdir"));
  assertEquals("instance.volumes should not be modified by cluster update when NameNode HA is enabled.","hdfs://" + expectedNameService + "/accumulo/test/instance/volumes",accumuloSiteProperties.get("instance.volumes"));
  assertFalse("dfs.namenode.http-address should have been filtered out of this HA configuration",hdfsSiteProperties.containsKey("dfs.namenode.http-address"));
  assertFalse("dfs.namenode.https-address should have been filtered out of this HA configuration",hdfsSiteProperties.containsKey("dfs.namenode.https-address"));
  assertFalse("dfs.namenode.rpc-address should have been filtered out of this HA configuration",hdfsSiteProperties.containsKey("dfs.namenode.rpc-address"));
  assertEquals("Incorrect number of updated config types returned, set = " + updatedConfigTypes,3,updatedConfigTypes.size());
  assertTrue("Expected config type not found in updated set",updatedConfigTypes.contains("cluster-env"));
  assertTrue("Expected config type not found in updated set",updatedConfigTypes.contains("hdfs-site"));
  assertTrue("Expected config type not found in updated set",updatedConfigTypes.contains("hadoop-env"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.controller.internal.ClusterControllerImplTest </h4><pre class="type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetResourcesCheckOrder() throws Exception {
  ClusterControllerImpl controller=new ClusterControllerImpl(new TestProviderModule());
  Set<String> propertyIds=new HashSet<String>();
  Request request=PropertyHelper.getReadRequest(propertyIds);
  Iterable<Resource> iterable=controller.getResourceIterable(Resource.Type.Host,request,null);
  String lastHostName=null;
  int cnt=0;
  for (  Resource resource : iterable) {
    Assert.assertEquals(Resource.Type.Host,resource.getType());
    String hostName=(String)resource.getPropertyValue(PropertyHelper.getPropertyId("Hosts","host_name"));
    if (lastHostName != null) {
      Assert.assertTrue(hostName.compareTo(lastHostName) > 0);
    }
    lastHostName=hostName;
    ++cnt;
  }
  Assert.assertEquals(4,cnt);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.controller.internal.ExportBlueprintRequestTest </h4><pre class="type-4 type-13 type-10 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExport_noConfigs() throws Exception {
  Resource clusterResource=new ResourceImpl(Resource.Type.Cluster);
  clusterResource.setProperty(ClusterResourceProvider.CLUSTER_NAME_PROPERTY_ID,CLUSTER_NAME);
  clusterResource.setProperty(ClusterResourceProvider.CLUSTER_ID_PROPERTY_ID,CLUSTER_ID);
  clusterResource.setProperty(ClusterResourceProvider.CLUSTER_VERSION_PROPERTY_ID,"TEST-1.0");
  TreeNode<Resource> clusterNode=new TreeNodeImpl<Resource>(null,clusterResource,"cluster");
  Resource configResource=new ResourceImpl(Resource.Type.Configuration);
  clusterNode.addChild(configResource,"configurations");
  Resource hostsResource=new ResourceImpl(Resource.Type.Host);
  Resource host1Resource=new ResourceImpl(Resource.Type.Host);
  Resource host2Resource=new ResourceImpl(Resource.Type.Host);
  Resource host3Resource=new ResourceImpl(Resource.Type.Host);
  TreeNode<Resource> hostsNode=clusterNode.addChild(hostsResource,"hosts");
  TreeNode<Resource> host1Node=hostsNode.addChild(host1Resource,"host_1");
  TreeNode<Resource> host2Node=hostsNode.addChild(host2Resource,"host_2");
  TreeNode<Resource> host3Node=hostsNode.addChild(host3Resource,"host_3");
  host1Resource.setProperty("Hosts/host_name","host1");
  host2Resource.setProperty("Hosts/host_name","host2");
  host3Resource.setProperty("Hosts/host_name","host3");
  List<String> host1ComponentsList=Arrays.asList("NAMENODE","HDFS_CLIENT","ZOOKEEPER_SERVER","SECONDARY_NAMENODE");
  List<String> host2ComponentsList=Arrays.asList("DATANODE","HDFS_CLIENT","ZOOKEEPER_SERVER");
  List<String> host3ComponentsList=Arrays.asList("DATANODE","HDFS_CLIENT","ZOOKEEPER_SERVER");
  processHostGroupComponents(host1Node,host1ComponentsList);
  processHostGroupComponents(host2Node,host2ComponentsList);
  processHostGroupComponents(host3Node,host3ComponentsList);
  ExportBlueprintRequest exportBlueprintRequest=new ExportBlueprintRequest(clusterNode);
  assertEquals(CLUSTER_NAME,exportBlueprintRequest.getClusterName());
  Blueprint bp=exportBlueprintRequest.getBlueprint();
  assertEquals("exported-blueprint",bp.getName());
  Map<String,HostGroup> hostGroups=bp.getHostGroups();
  assertEquals(2,hostGroups.size());
  String hg1Name=null;
  String hg2Name=null;
  for (  HostGroup group : hostGroups.values()) {
    Collection<String> components=group.getComponentNames();
    if (components.containsAll(host1ComponentsList)) {
      assertEquals(host1ComponentsList.size(),components.size());
      assertEquals("1",group.getCardinality());
      hg1Name=group.getName();
    }
 else     if (components.containsAll(host2ComponentsList)) {
      assertEquals(host2ComponentsList.size(),components.size());
      assertEquals("2",group.getCardinality());
      hg2Name=group.getName();
    }
 else {
      fail("Host group contained invalid components");
    }
  }
  assertNotNull(hg1Name);
  assertNotNull(hg2Name);
  HostGroupInfo host1Info=exportBlueprintRequest.getHostGroupInfo().get(hg1Name);
  assertEquals(1,host1Info.getHostNames().size());
  assertEquals("host1",host1Info.getHostNames().iterator().next());
  HostGroupInfo host2Info=exportBlueprintRequest.getHostGroupInfo().get(hg2Name);
  assertEquals(2,host2Info.getHostNames().size());
  assertTrue(host2Info.getHostNames().contains("host2") && host2Info.getHostNames().contains("host3"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.controller.internal.HostKerberosIdentityResourceProviderTest </h4><pre class="type-4 type-13 type-10 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetResources() throws Exception {
  AmbariManagementController managementController=createMock(AmbariManagementController.class);
  KerberosPrincipalDescriptor principalDescriptor1=createStrictMock(KerberosPrincipalDescriptor.class);
  expect(principalDescriptor1.getValue()).andReturn("principal1@EXAMPLE.COM");
  expect(principalDescriptor1.getType()).andReturn(KerberosPrincipalType.USER).times(1);
  expect(principalDescriptor1.getLocalUsername()).andReturn("principal1");
  KerberosKeytabDescriptor keytabDescriptor1=createStrictMock(KerberosKeytabDescriptor.class);
  expect(keytabDescriptor1.getOwnerAccess()).andReturn("rw").times(1);
  expect(keytabDescriptor1.getGroupAccess()).andReturn("r").times(1);
  expect(keytabDescriptor1.getFile()).andReturn("/etc/security/keytabs/principal1.headless.keytab").times(1);
  expect(keytabDescriptor1.getOwnerName()).andReturn("principal1").times(1);
  expect(keytabDescriptor1.getGroupName()).andReturn("principal1").times(1);
  KerberosIdentityDescriptor identity1=createStrictMock(KerberosIdentityDescriptor.class);
  expect(identity1.getPrincipalDescriptor()).andReturn(principalDescriptor1).times(1);
  expect(identity1.getKeytabDescriptor()).andReturn(keytabDescriptor1).times(1);
  expect(identity1.getName()).andReturn("identity1").times(1);
  KerberosPrincipalDescriptor principalDescriptor2=createStrictMock(KerberosPrincipalDescriptor.class);
  expect(principalDescriptor2.getValue()).andReturn("principal2/Host100@EXAMPLE.COM");
  expect(principalDescriptor2.getType()).andReturn(KerberosPrincipalType.SERVICE).times(1);
  expect(principalDescriptor2.getLocalUsername()).andReturn("principal2");
  KerberosIdentityDescriptor identity2=createStrictMock(KerberosIdentityDescriptor.class);
  expect(identity2.getPrincipalDescriptor()).andReturn(principalDescriptor2).times(1);
  expect(identity2.getKeytabDescriptor()).andReturn(null).times(1);
  expect(identity2.getName()).andReturn("identity2").times(1);
  KerberosIdentityDescriptor identity3=createStrictMock(KerberosIdentityDescriptor.class);
  expect(identity3.getPrincipalDescriptor()).andReturn(null).times(1);
  KerberosIdentityDescriptor identity4=createStrictMock(KerberosIdentityDescriptor.class);
  expect(identity4.getPrincipalDescriptor()).andReturn(null).times(1);
  KerberosPrincipalDescriptor principalDescriptor5=createStrictMock(KerberosPrincipalDescriptor.class);
  expect(principalDescriptor5.getValue()).andReturn("principal5@EXAMPLE.COM");
  expect(principalDescriptor5.getType()).andReturn(KerberosPrincipalType.USER).times(1);
  expect(principalDescriptor5.getLocalUsername()).andReturn("principal5");
  KerberosKeytabDescriptor keytabDescriptor5=createStrictMock(KerberosKeytabDescriptor.class);
  expect(keytabDescriptor5.getOwnerAccess()).andReturn("r").times(1);
  expect(keytabDescriptor5.getGroupAccess()).andReturn("r").times(1);
  expect(keytabDescriptor5.getFile()).andReturn("/etc/security/keytabs/principal5.headless.keytab").times(1);
  expect(keytabDescriptor5.getOwnerName()).andReturn("principal5").times(1);
  expect(keytabDescriptor5.getGroupName()).andReturn("hadoop").times(1);
  KerberosIdentityDescriptor identity5=createStrictMock(KerberosIdentityDescriptor.class);
  expect(identity5.getPrincipalDescriptor()).andReturn(principalDescriptor5).times(1);
  expect(identity5.getKeytabDescriptor()).andReturn(keytabDescriptor5).times(1);
  expect(identity5.getName()).andReturn("identity5").times(1);
  KerberosPrincipalDAO kerberosPrincipalDAO=createStrictMock(KerberosPrincipalDAO.class);
  expect(kerberosPrincipalDAO.exists("principal1@EXAMPLE.COM")).andReturn(true).times(1);
  expect(kerberosPrincipalDAO.exists("principal2/Host100@EXAMPLE.COM")).andReturn(true).times(1);
  expect(kerberosPrincipalDAO.exists("principal5@EXAMPLE.COM")).andReturn(false).times(1);
  KerberosPrincipalHostDAO kerberosPrincipalHostDAO=createStrictMock(KerberosPrincipalHostDAO.class);
  expect(kerberosPrincipalHostDAO.exists("principal1@EXAMPLE.COM",100L)).andReturn(true).times(1);
  expect(kerberosPrincipalHostDAO.exists("principal2/Host100@EXAMPLE.COM",100L)).andReturn(false).times(1);
  HostEntity host100=createStrictMock(HostEntity.class);
  expect(host100.getHostId()).andReturn(100L).times(1);
  HostDAO hostDAO=createStrictMock(HostDAO.class);
  expect(hostDAO.findByName("Host100")).andReturn(host100).times(1);
  Collection<KerberosIdentityDescriptor> identities=new ArrayList<KerberosIdentityDescriptor>();
  identities.add(identity1);
  identities.add(identity2);
  identities.add(identity3);
  identities.add(identity4);
  identities.add(identity5);
  Map<String,Collection<KerberosIdentityDescriptor>> activeIdentities=new HashMap<String,Collection<KerberosIdentityDescriptor>>();
  activeIdentities.put("Host100",identities);
  KerberosHelper kerberosHelper=createStrictMock(KerberosHelper.class);
  expect(kerberosHelper.getActiveIdentities("Cluster100","Host100",null,null,true)).andReturn(activeIdentities).times(1);
  replayAll();
  ResourceProvider provider=new HostKerberosIdentityResourceProvider(managementController);
  Field field;
  field=HostKerberosIdentityResourceProvider.class.getDeclaredField("kerberosHelper");
  field.setAccessible(true);
  field.set(provider,kerberosHelper);
  field=HostKerberosIdentityResourceProvider.class.getDeclaredField("kerberosPrincipalDAO");
  field.setAccessible(true);
  field.set(provider,kerberosPrincipalDAO);
  field=HostKerberosIdentityResourceProvider.class.getDeclaredField("kerberosPrincipalHostDAO");
  field.setAccessible(true);
  field.set(provider,kerberosPrincipalHostDAO);
  field=HostKerberosIdentityResourceProvider.class.getDeclaredField("hostDAO");
  field.setAccessible(true);
  field.set(provider,hostDAO);
  Set<String> propertyIds=new HashSet<String>();
  propertyIds.add(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_CLUSTER_NAME_PROPERTY_ID);
  propertyIds.add(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_HOST_NAME_PROPERTY_ID);
  propertyIds.add(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_DESCRIPTION_PROPERTY_ID);
  propertyIds.add(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_PRINCIPAL_NAME_PROPERTY_ID);
  propertyIds.add(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_PRINCIPAL_TYPE_PROPERTY_ID);
  propertyIds.add(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_PRINCIPAL_LOCAL_USERNAME_PROPERTY_ID);
  propertyIds.add(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_PATH_PROPERTY_ID);
  propertyIds.add(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_OWNER_PROPERTY_ID);
  propertyIds.add(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_OWNER_ACCESS_PROPERTY_ID);
  propertyIds.add(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_GROUP_PROPERTY_ID);
  propertyIds.add(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_GROUP_ACCESS_PROPERTY_ID);
  propertyIds.add(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_MODE_PROPERTY_ID);
  propertyIds.add(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_INSTALLED_PROPERTY_ID);
  Predicate predicate=new PredicateBuilder().property(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_CLUSTER_NAME_PROPERTY_ID).equals("Cluster100").and().property(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_HOST_NAME_PROPERTY_ID).equals("Host100").toPredicate();
  Request request=PropertyHelper.getReadRequest(propertyIds);
  Set<Resource> resources=provider.getResources(request,predicate);
  Assert.assertEquals(3,resources.size());
  for (  Resource resource : resources) {
    Assert.assertEquals("Cluster100",resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_CLUSTER_NAME_PROPERTY_ID));
    Assert.assertEquals("Host100",resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_HOST_NAME_PROPERTY_ID));
    String principal=(String)resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_PRINCIPAL_NAME_PROPERTY_ID);
    if ("principal1@EXAMPLE.COM".equals(principal)) {
      Assert.assertEquals("identity1",resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_DESCRIPTION_PROPERTY_ID));
      Assert.assertEquals(KerberosPrincipalType.USER,resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_PRINCIPAL_TYPE_PROPERTY_ID));
      Assert.assertEquals("principal1",resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_PRINCIPAL_LOCAL_USERNAME_PROPERTY_ID));
      Assert.assertEquals("/etc/security/keytabs/principal1.headless.keytab",resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_PATH_PROPERTY_ID));
      Assert.assertEquals("principal1",resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_OWNER_PROPERTY_ID));
      Assert.assertEquals("rw",resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_OWNER_ACCESS_PROPERTY_ID));
      Assert.assertEquals("principal1",resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_GROUP_PROPERTY_ID));
      Assert.assertEquals("r",resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_GROUP_ACCESS_PROPERTY_ID));
      Assert.assertEquals("640",resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_MODE_PROPERTY_ID));
      Assert.assertEquals("true",resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_INSTALLED_PROPERTY_ID));
    }
 else     if ("principal2/Host100@EXAMPLE.COM".equals(principal)) {
      Assert.assertEquals("identity2",resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_DESCRIPTION_PROPERTY_ID));
      Assert.assertEquals(KerberosPrincipalType.SERVICE,resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_PRINCIPAL_TYPE_PROPERTY_ID));
      Assert.assertEquals("principal2",resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_PRINCIPAL_LOCAL_USERNAME_PROPERTY_ID));
      Assert.assertNull(resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_PATH_PROPERTY_ID));
      Assert.assertNull(resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_OWNER_PROPERTY_ID));
      Assert.assertNull(resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_OWNER_ACCESS_PROPERTY_ID));
      Assert.assertNull(resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_GROUP_PROPERTY_ID));
      Assert.assertNull(resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_GROUP_ACCESS_PROPERTY_ID));
      Assert.assertNull(resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_MODE_PROPERTY_ID));
      Assert.assertEquals("false",resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_INSTALLED_PROPERTY_ID));
    }
 else     if ("principal5@EXAMPLE.COM".equals(principal)) {
      Assert.assertEquals("identity5",resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_DESCRIPTION_PROPERTY_ID));
      Assert.assertEquals(KerberosPrincipalType.USER,resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_PRINCIPAL_TYPE_PROPERTY_ID));
      Assert.assertEquals("principal5",resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_PRINCIPAL_LOCAL_USERNAME_PROPERTY_ID));
      Assert.assertEquals("/etc/security/keytabs/principal5.headless.keytab",resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_PATH_PROPERTY_ID));
      Assert.assertEquals("principal5",resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_OWNER_PROPERTY_ID));
      Assert.assertEquals("r",resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_OWNER_ACCESS_PROPERTY_ID));
      Assert.assertEquals("hadoop",resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_GROUP_PROPERTY_ID));
      Assert.assertEquals("r",resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_GROUP_ACCESS_PROPERTY_ID));
      Assert.assertEquals("440",resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_MODE_PROPERTY_ID));
      Assert.assertEquals("unknown",resource.getPropertyValue(HostKerberosIdentityResourceProvider.KERBEROS_IDENTITY_KEYTAB_FILE_INSTALLED_PROPERTY_ID));
    }
 else {
      Assert.fail("Unexpected principal: " + principal);
    }
  }
  verifyAll();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.controller.internal.RequestResourceProviderTest </h4><pre class="type-13 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testUpdateResources_CancelRequest() throws Exception {
  Resource.Type type=Resource.Type.Request;
  AmbariManagementController managementController=createMock(AmbariManagementController.class);
  ActionManager actionManager=createNiceMock(ActionManager.class);
  HostRoleCommand hostRoleCommand=createNiceMock(HostRoleCommand.class);
  Stage stage=createNiceMock(Stage.class);
  Clusters clusters=createNiceMock(Clusters.class);
  List<HostRoleCommand> hostRoleCommands=new LinkedList<HostRoleCommand>();
  hostRoleCommands.add(hostRoleCommand);
  Collection<Stage> stages=new HashSet<Stage>();
  stages.add(stage);
  org.apache.ambari.server.actionmanager.Request requestMock=createNiceMock(org.apache.ambari.server.actionmanager.Request.class);
  expect(requestMock.getCommands()).andReturn(hostRoleCommands).anyTimes();
  expect(requestMock.getStages()).andReturn(stages).anyTimes();
  expect(stage.getOrderedHostRoleCommands()).andReturn(hostRoleCommands).anyTimes();
  Capture<Collection<Long>> requestIdsCapture=newCapture();
  expect(managementController.getActionManager()).andReturn(actionManager).anyTimes();
  expect(actionManager.getRequests(capture(requestIdsCapture))).andReturn(Collections.singletonList(requestMock)).anyTimes();
  expect(hostRoleCommand.getStatus()).andReturn(HostRoleStatus.IN_PROGRESS).anyTimes();
  RequestStatusResponse response=createNiceMock(RequestStatusResponse.class);
  replay(managementController,actionManager,hostRoleCommand,clusters,requestMock,response,stage);
  ResourceProvider provider=AbstractControllerResourceProvider.getResourceProvider(type,PropertyHelper.getPropertyIds(type),PropertyHelper.getKeyPropertyIds(type),managementController);
  Map<String,Object> properties=new LinkedHashMap<String,Object>();
  Request request=PropertyHelper.getUpdateRequest(properties,null);
  Predicate predicate=new PredicateBuilder().property(RequestResourceProvider.REQUEST_ID_PROPERTY_ID).equals("100").toPredicate();
  try {
    provider.updateResources(request,predicate);
    Assert.fail("Expected an java.lang.IllegalArgumentException: Abort reason can not be empty.");
  }
 catch (  IllegalArgumentException e) {
  }
  properties.put(RequestResourceProvider.REQUEST_ABORT_REASON_PROPERTY_ID,"Some reason");
  request=PropertyHelper.getUpdateRequest(properties,null);
  try {
    provider.updateResources(request,predicate);
    Assert.fail("Expected an java.lang.IllegalArgumentException: null is wrong value.");
  }
 catch (  IllegalArgumentException e) {
  }
  properties.put(RequestResourceProvider.REQUEST_STATUS_PROPERTY_ID,"COMPLETED");
  request=PropertyHelper.getUpdateRequest(properties,null);
  try {
    provider.updateResources(request,predicate);
    Assert.fail("Expected an java.lang.IllegalArgumentException: COMPLETED is wrong value. " + "The only allowed value for updating request status is ABORTED");
  }
 catch (  IllegalArgumentException e) {
  }
  properties.put(RequestResourceProvider.REQUEST_STATUS_PROPERTY_ID,"ABORTED");
  for (  HostRoleStatus status : HostRoleStatus.values()) {
    reset(hostRoleCommand);
    expect(hostRoleCommand.getStatus()).andReturn(status).anyTimes();
    replay(hostRoleCommand);
    request=PropertyHelper.getUpdateRequest(properties,null);
    if (status == HostRoleStatus.IN_PROGRESS || status == HostRoleStatus.PENDING || status == HostRoleStatus.HOLDING || status == HostRoleStatus.HOLDING_FAILED || status == HostRoleStatus.HOLDING_TIMEDOUT || status == HostRoleStatus.COMPLETED || status == HostRoleStatus.ABORTED || status == HostRoleStatus.FAILED || status == HostRoleStatus.TIMEDOUT || status == HostRoleStatus.QUEUED || status == HostRoleStatus.SKIPPED_FAILED) {
      provider.updateResources(request,predicate);
    }
 else {
      try {
        provider.updateResources(request,predicate);
        Assert.fail("Expected an java.lang.IllegalArgumentException");
      }
 catch (      IllegalArgumentException e) {
      }
    }
  }
  verify(managementController,response,stage);
}

</code></pre>

<br>
<pre class="type-4 type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetResourcesInProgress() throws Exception {
  Resource.Type type=Resource.Type.Request;
  AmbariManagementController managementController=createMock(AmbariManagementController.class);
  ActionManager actionManager=createNiceMock(ActionManager.class);
  RequestEntity requestMock0=createNiceMock(RequestEntity.class);
  expect(requestMock0.getRequestContext()).andReturn("this is a context").anyTimes();
  expect(requestMock0.getRequestId()).andReturn(100L).anyTimes();
  RequestEntity requestMock1=createNiceMock(RequestEntity.class);
  expect(requestMock1.getRequestContext()).andReturn("this is a context").anyTimes();
  expect(requestMock1.getRequestId()).andReturn(101L).anyTimes();
  Capture<Collection<Long>> requestIdsCapture=new Capture<Collection<Long>>();
  expect(managementController.getActionManager()).andReturn(actionManager).anyTimes();
  expect(requestDAO.findByPks(capture(requestIdsCapture),eq(true))).andReturn(Arrays.asList(requestMock0));
  expect(requestDAO.findByPks(capture(requestIdsCapture),eq(true))).andReturn(Arrays.asList(requestMock1));
  expect(hrcDAO.findAggregateCounts(100L)).andReturn(new HashMap<Long,HostRoleCommandStatusSummaryDTO>(){
{
      put(1L,HostRoleCommandStatusSummaryDTO.create().inProgress(1).pending(1));
    }
  }
).once();
  expect(hrcDAO.findAggregateCounts(101L)).andReturn(new HashMap<Long,HostRoleCommandStatusSummaryDTO>(){
{
      put(1L,HostRoleCommandStatusSummaryDTO.create().inProgress(1).queued(1));
    }
  }
).once();
  replay(managementController,actionManager,requestMock0,requestMock1,requestDAO,hrcDAO);
  ResourceProvider provider=AbstractControllerResourceProvider.getResourceProvider(type,PropertyHelper.getPropertyIds(type),PropertyHelper.getKeyPropertyIds(type),managementController);
  Set<String> propertyIds=new HashSet<String>();
  propertyIds.add(RequestResourceProvider.REQUEST_ID_PROPERTY_ID);
  propertyIds.add(RequestResourceProvider.REQUEST_STATUS_PROPERTY_ID);
  propertyIds.add(RequestResourceProvider.REQUEST_TASK_CNT_ID);
  propertyIds.add(RequestResourceProvider.REQUEST_COMPLETED_TASK_CNT_ID);
  propertyIds.add(RequestResourceProvider.REQUEST_FAILED_TASK_CNT_ID);
  propertyIds.add(RequestResourceProvider.REQUEST_QUEUED_TASK_CNT_ID);
  propertyIds.add(RequestResourceProvider.REQUEST_PROGRESS_PERCENT_ID);
  Predicate predicate=new PredicateBuilder().property(RequestResourceProvider.REQUEST_ID_PROPERTY_ID).equals("100").or().property(RequestResourceProvider.REQUEST_ID_PROPERTY_ID).equals("101").toPredicate();
  Request request=PropertyHelper.getReadRequest(propertyIds);
  Set<Resource> resources=provider.getResources(request,predicate);
  Assert.assertEquals(2,resources.size());
  for (  Resource resource : resources) {
    long id=(Long)resource.getPropertyValue(RequestResourceProvider.REQUEST_ID_PROPERTY_ID);
    Assert.assertTrue(id == 100L || id == 101L);
    Assert.assertEquals("IN_PROGRESS",resource.getPropertyValue(RequestResourceProvider.REQUEST_STATUS_PROPERTY_ID));
    Assert.assertEquals(2,resource.getPropertyValue(RequestResourceProvider.REQUEST_TASK_CNT_ID));
    Assert.assertEquals(0,resource.getPropertyValue(RequestResourceProvider.REQUEST_FAILED_TASK_CNT_ID));
    if (id == 100L) {
      Assert.assertEquals(0,resource.getPropertyValue(RequestResourceProvider.REQUEST_QUEUED_TASK_CNT_ID));
      int progressPercent=((Double)resource.getPropertyValue(RequestResourceProvider.REQUEST_PROGRESS_PERCENT_ID)).intValue();
      Assert.assertEquals(17,progressPercent);
    }
 else {
      Assert.assertEquals(1,resource.getPropertyValue(RequestResourceProvider.REQUEST_QUEUED_TASK_CNT_ID));
      int progressPercent=((Double)resource.getPropertyValue(RequestResourceProvider.REQUEST_PROGRESS_PERCENT_ID)).intValue();
      Assert.assertEquals(21,progressPercent);
    }
    Assert.assertEquals(0,resource.getPropertyValue(RequestResourceProvider.REQUEST_COMPLETED_TASK_CNT_ID));
  }
  verify(managementController,actionManager,requestMock0,requestMock1,requestDAO,hrcDAO);
}

</code></pre>

<br>
<pre class="type-4 type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetResourcesFailed() throws Exception {
  Resource.Type type=Resource.Type.Request;
  AmbariManagementController managementController=createMock(AmbariManagementController.class);
  ActionManager actionManager=createNiceMock(ActionManager.class);
  RequestEntity requestMock0=createNiceMock(RequestEntity.class);
  expect(requestMock0.getRequestContext()).andReturn("this is a context").anyTimes();
  expect(requestMock0.getRequestId()).andReturn(100L).anyTimes();
  RequestEntity requestMock1=createNiceMock(RequestEntity.class);
  expect(requestMock1.getRequestContext()).andReturn("this is a context").anyTimes();
  expect(requestMock1.getRequestId()).andReturn(101L).anyTimes();
  Capture<Collection<Long>> requestIdsCapture=new Capture<Collection<Long>>();
  expect(managementController.getActionManager()).andReturn(actionManager).anyTimes();
  expect(requestDAO.findByPks(capture(requestIdsCapture),eq(true))).andReturn(Arrays.asList(requestMock0));
  expect(requestDAO.findByPks(capture(requestIdsCapture),eq(true))).andReturn(Arrays.asList(requestMock1));
  expect(hrcDAO.findAggregateCounts(100L)).andReturn(new HashMap<Long,HostRoleCommandStatusSummaryDTO>(){
{
      put(1L,HostRoleCommandStatusSummaryDTO.create().failed(1).completed(1));
    }
  }
).once();
  expect(hrcDAO.findAggregateCounts(101L)).andReturn(new HashMap<Long,HostRoleCommandStatusSummaryDTO>(){
{
      put(1L,HostRoleCommandStatusSummaryDTO.create().aborted(1).timedout(1));
    }
  }
).once();
  replay(managementController,actionManager,requestMock0,requestMock1,requestDAO,hrcDAO);
  ResourceProvider provider=AbstractControllerResourceProvider.getResourceProvider(type,PropertyHelper.getPropertyIds(type),PropertyHelper.getKeyPropertyIds(type),managementController);
  Set<String> propertyIds=new HashSet<String>();
  propertyIds.add(RequestResourceProvider.REQUEST_ID_PROPERTY_ID);
  propertyIds.add(RequestResourceProvider.REQUEST_STATUS_PROPERTY_ID);
  propertyIds.add(RequestResourceProvider.REQUEST_TASK_CNT_ID);
  propertyIds.add(RequestResourceProvider.REQUEST_COMPLETED_TASK_CNT_ID);
  propertyIds.add(RequestResourceProvider.REQUEST_FAILED_TASK_CNT_ID);
  propertyIds.add(RequestResourceProvider.REQUEST_ABORTED_TASK_CNT_ID);
  propertyIds.add(RequestResourceProvider.REQUEST_TIMED_OUT_TASK_CNT_ID);
  propertyIds.add(RequestResourceProvider.REQUEST_PROGRESS_PERCENT_ID);
  Predicate predicate=new PredicateBuilder().property(RequestResourceProvider.REQUEST_ID_PROPERTY_ID).equals("100").or().property(RequestResourceProvider.REQUEST_ID_PROPERTY_ID).equals("101").toPredicate();
  Request request=PropertyHelper.getReadRequest(propertyIds);
  Set<Resource> resources=provider.getResources(request,predicate);
  Assert.assertEquals(2,resources.size());
  for (  Resource resource : resources) {
    long id=(Long)resource.getPropertyValue(RequestResourceProvider.REQUEST_ID_PROPERTY_ID);
    Assert.assertTrue(id == 100L || id == 101L);
    Assert.assertEquals(2,resource.getPropertyValue(RequestResourceProvider.REQUEST_TASK_CNT_ID));
    if (id == 100L) {
      Assert.assertEquals("FAILED",resource.getPropertyValue(RequestResourceProvider.REQUEST_STATUS_PROPERTY_ID));
      Assert.assertEquals(1,resource.getPropertyValue(RequestResourceProvider.REQUEST_FAILED_TASK_CNT_ID));
      Assert.assertEquals(0,resource.getPropertyValue(RequestResourceProvider.REQUEST_ABORTED_TASK_CNT_ID));
      Assert.assertEquals(0,resource.getPropertyValue(RequestResourceProvider.REQUEST_TIMED_OUT_TASK_CNT_ID));
    }
 else {
      Assert.assertEquals("ABORTED",resource.getPropertyValue(RequestResourceProvider.REQUEST_STATUS_PROPERTY_ID));
      Assert.assertEquals(0,resource.getPropertyValue(RequestResourceProvider.REQUEST_FAILED_TASK_CNT_ID));
      Assert.assertEquals(1,resource.getPropertyValue(RequestResourceProvider.REQUEST_ABORTED_TASK_CNT_ID));
      Assert.assertEquals(1,resource.getPropertyValue(RequestResourceProvider.REQUEST_TIMED_OUT_TASK_CNT_ID));
    }
    Assert.assertEquals(2,resource.getPropertyValue(RequestResourceProvider.REQUEST_COMPLETED_TASK_CNT_ID));
    Assert.assertEquals(100.0,resource.getPropertyValue(RequestResourceProvider.REQUEST_PROGRESS_PERCENT_ID));
  }
  verify(managementController,actionManager,requestMock0,requestMock1,requestDAO,hrcDAO);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.controller.internal.ResourceImplTest </h4><pre class="type-4 type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetPropertiesMap(){
  Resource resource=new ResourceImpl(Resource.Type.Cluster);
  String p1=PropertyHelper.getPropertyId(null,"p1");
  String p2=PropertyHelper.getPropertyId("c1","p2");
  String p3=PropertyHelper.getPropertyId("c1/c2","p3");
  String p4=PropertyHelper.getPropertyId("c1/c2/c3","p4");
  String p5=PropertyHelper.getPropertyId("c1","p5");
  resource.setProperty(p1,"foo");
  resource.setProperty(p2,1);
  resource.setProperty(p3,(float)1.99);
  resource.setProperty(p4,1.99);
  resource.setProperty(p5,65L);
  Map<String,Map<String,Object>> map=resource.getPropertiesMap();
  Assert.assertEquals(4,map.keySet().size());
  Assert.assertTrue(map.containsKey(""));
  Assert.assertTrue(map.containsKey("c1"));
  Assert.assertTrue(map.containsKey("c1/c2"));
  Assert.assertTrue(map.containsKey("c1/c2/c3"));
  String lastCategory=null;
  for (  Map.Entry<String,Map<String,Object>> entry : map.entrySet()) {
    String category=entry.getKey();
    if (lastCategory != null) {
      Assert.assertTrue(category.compareTo(lastCategory) > 0);
    }
    lastCategory=category;
    String lastProperty=null;
    for (    String property : entry.getValue().keySet()) {
      if (lastProperty != null) {
        Assert.assertTrue(property.compareTo(lastProperty) > 0);
      }
      lastProperty=property;
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.controller.internal.RootServiceComponentResourceProviderTest </h4><pre class="type-4 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetResources() throws Exception {
  Resource.Type type=Resource.Type.RootServiceComponent;
  AmbariManagementController managementController=createMock(AmbariManagementController.class);
  Set<RootServiceComponentResponse> allResponse=new HashSet<RootServiceComponentResponse>();
  allResponse.add(new RootServiceComponentResponse("component1","1.1.1",Collections.<String,String>emptyMap()));
  allResponse.add(new RootServiceComponentResponse("component2","1.1.1",Collections.<String,String>emptyMap()));
  allResponse.add(new RootServiceComponentResponse("component3","1.1.1",Collections.<String,String>emptyMap()));
  allResponse.add(new RootServiceComponentResponse(RootServiceResponseFactory.Components.AMBARI_SERVER.name(),"1.1.1",Collections.<String,String>emptyMap()));
  Set<RootServiceComponentResponse> nameResponse=new HashSet<RootServiceComponentResponse>();
  nameResponse.add(new RootServiceComponentResponse("component4","1.1.1",Collections.<String,String>emptyMap()));
  expect(managementController.getRootServiceComponents(EasyMock.<Set<RootServiceComponentRequest>>anyObject())).andReturn(allResponse).once();
  expect(managementController.getRootServiceComponents(EasyMock.<Set<RootServiceComponentRequest>>anyObject())).andReturn(nameResponse).once();
  replay(managementController);
  ResourceProvider provider=AbstractControllerResourceProvider.getResourceProvider(type,PropertyHelper.getPropertyIds(type),PropertyHelper.getKeyPropertyIds(type),managementController);
  Set<String> propertyIds=new HashSet<String>();
  propertyIds.add(RootServiceComponentResourceProvider.SERVICE_NAME_PROPERTY_ID);
  propertyIds.add(RootServiceComponentResourceProvider.COMPONENT_NAME_PROPERTY_ID);
  propertyIds.add(RootServiceComponentResourceProvider.PROPERTIES_PROPERTY_ID);
  propertyIds.add(RootServiceComponentResourceProvider.COMPONENT_VERSION_PROPERTY_ID);
  propertyIds.add(RootServiceComponentResourceProvider.PROPERTIES_SERVER_CLOCK);
  Request request=PropertyHelper.getReadRequest(propertyIds);
  Set<Resource> resources=provider.getResources(request,null);
  Assert.assertEquals(allResponse.size(),resources.size());
  for (  Resource resource : resources) {
    String componentName=(String)resource.getPropertyValue(RootServiceComponentResourceProvider.COMPONENT_NAME_PROPERTY_ID);
    String componentVersion=(String)resource.getPropertyValue(RootServiceComponentResourceProvider.COMPONENT_VERSION_PROPERTY_ID);
    Long server_clock=(Long)resource.getPropertyValue(RootServiceComponentResourceProvider.PROPERTIES_SERVER_CLOCK);
    if (componentName.equals(RootServiceResponseFactory.Components.AMBARI_SERVER.name())) {
      Assert.assertNotNull(server_clock);
    }
 else {
      Assert.assertNull(server_clock);
    }
    Assert.assertTrue(allResponse.contains(new RootServiceComponentResponse(componentName,componentVersion,Collections.<String,String>emptyMap())));
  }
  Predicate predicate=new PredicateBuilder().property(RootServiceComponentResourceProvider.COMPONENT_NAME_PROPERTY_ID).equals("component4").toPredicate();
  resources=provider.getResources(request,predicate);
  Assert.assertEquals(1,resources.size());
  Assert.assertEquals("component4",resources.iterator().next().getPropertyValue(RootServiceComponentResourceProvider.COMPONENT_NAME_PROPERTY_ID));
  verify(managementController);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.controller.internal.UpgradeResourceProviderHDP22Test </h4><pre class="type-4 type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests upgrades from HDP-2.2.x to HDP-2.2.y
 * @throws Exception
 */
@SuppressWarnings("serial") @Test public void testCreateIntraStackUpgrade() throws Exception {
  Cluster cluster=clusters.getCluster("c1");
  StackId oldStack=cluster.getDesiredStackVersion();
  for (  Service s : cluster.getServices().values()) {
    assertEquals(oldStack,s.getDesiredStackVersion());
    for (    ServiceComponent sc : s.getServiceComponents().values()) {
      assertEquals(oldStack,sc.getDesiredStackVersion());
      for (      ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
        assertEquals(oldStack,sch.getDesiredStackVersion());
      }
    }
  }
  Config config=new ConfigImpl("hive-site");
  config.setProperties(configTagVersion1Properties);
  config.setTag(configTagVersion1);
  cluster.addConfig(config);
  cluster.addDesiredConfig("admin",Collections.singleton(config));
  Map<String,Object> requestProps=new HashMap<String,Object>();
  requestProps.put(UpgradeResourceProvider.UPGRADE_CLUSTER_NAME,"c1");
  requestProps.put(UpgradeResourceProvider.UPGRADE_VERSION,"2.2.4.2");
  requestProps.put(UpgradeResourceProvider.UPGRADE_SKIP_PREREQUISITE_CHECKS,"true");
  ResourceProvider upgradeResourceProvider=createProvider(amc);
  Request request=PropertyHelper.getCreateRequest(Collections.singleton(requestProps),null);
  upgradeResourceProvider.createResources(request);
  List<UpgradeEntity> upgrades=upgradeDao.findUpgrades(cluster.getClusterId());
  assertEquals(1,upgrades.size());
  UpgradeEntity upgrade=upgrades.get(0);
  assertEquals("upgrade_test",upgrade.getUpgradePackage());
  assertEquals(3,upgrade.getUpgradeGroups().size());
  UpgradeGroupEntity group=upgrade.getUpgradeGroups().get(2);
  assertEquals(3,group.getItems().size());
  group=upgrade.getUpgradeGroups().get(0);
  assertEquals(2,group.getItems().size());
  UpgradeItemEntity item=group.getItems().get(1);
  assertEquals("Value is set for the source stack upgrade pack","Goo",item.getText());
  assertTrue(cluster.getDesiredConfigs().containsKey("hive-site"));
  StackId newStack=cluster.getDesiredStackVersion();
  assertTrue(oldStack.equals(newStack));
  for (  Service s : cluster.getServices().values()) {
    assertEquals(newStack,s.getDesiredStackVersion());
    for (    ServiceComponent sc : s.getServiceComponents().values()) {
      assertEquals(newStack,sc.getDesiredStackVersion());
      for (      ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
        assertEquals(newStack,sch.getDesiredStackVersion());
      }
    }
  }
  assertEquals(configTagVersion1,cluster.getDesiredConfigByType("hive-site").getTag());
  final Config newConfig=new ConfigImpl("hive-site");
  newConfig.setProperties(configTagVersion2Properties);
  newConfig.setTag(configTagVersion2);
  Set<Config> desiredConfigs=new HashSet<Config>(){
{
      add(newConfig);
    }
  }
;
  cluster.addConfig(newConfig);
  cluster.addDesiredConfig("admin",desiredConfigs);
  assertEquals(configTagVersion2,cluster.getDesiredConfigByType("hive-site").getTag());
  Gson gson=new Gson();
  List<ExecutionCommandEntity> currentExecutionCommands=injector.getInstance(ExecutionCommandDAO.class).findAll();
  for (  ExecutionCommandEntity ece : currentExecutionCommands) {
    String executionCommandJson=new String(ece.getCommand());
    Map<String,Object> commandMap=gson.<Map<String,Object>>fromJson(executionCommandJson,Map.class);
    Set<String> roleCommandsThatMustHaveRefresh=new HashSet<String>();
    roleCommandsThatMustHaveRefresh.add("SERVICE_CHECK");
    roleCommandsThatMustHaveRefresh.add("RESTART");
    roleCommandsThatMustHaveRefresh.add("ACTIONEXECUTE");
    String roleCommand=(String)commandMap.get("roleCommand");
    if (roleCommandsThatMustHaveRefresh.contains(roleCommand)) {
      assertTrue(commandMap.containsKey(KeyNames.REFRESH_CONFIG_TAGS_BEFORE_EXECUTION));
      Object object=commandMap.get(KeyNames.REFRESH_CONFIG_TAGS_BEFORE_EXECUTION);
      assertTrue(object instanceof List);
      @SuppressWarnings("unchecked") List<String> tags=(List<String>)commandMap.get(KeyNames.REFRESH_CONFIG_TAGS_BEFORE_EXECUTION);
      assertEquals(1,tags.size());
      assertEquals("*",tags.get(0));
      ExecutionCommandWrapper executionCommandWrapper=new ExecutionCommandWrapper(executionCommandJson);
      ExecutionCommand executionCommand=executionCommandWrapper.getExecutionCommand();
      Map<String,Map<String,String>> configurationTags=executionCommand.getConfigurationTags();
      assertEquals(configTagVersion2,configurationTags.get("hive-site").get("tag"));
      Map<String,Map<String,String>> configurations=executionCommand.getConfigurations();
      assertEquals("10010",configurations.get("hive-site").get("hive.server2.thrift.port"));
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.controller.internal.UpgradeResourceProviderTest </h4><pre class="type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpdateSkipFailures() throws Exception {
  testCreateResourcesWithAutoSkipFailures();
  List<UpgradeEntity> upgrades=upgradeDao.findUpgrades(1);
  assertEquals(1,upgrades.size());
  UpgradeEntity entity=upgrades.get(0);
  HostRoleCommandDAO dao=injector.getInstance(HostRoleCommandDAO.class);
  List<HostRoleCommandEntity> tasks=dao.findByRequest(entity.getRequestId());
  for (  HostRoleCommandEntity task : tasks) {
    StageEntity stage=task.getStage();
    if (stage.isSkippable() && stage.isAutoSkipOnFailureSupported()) {
      assertTrue(task.isFailureAutoSkipped());
    }
 else {
      assertFalse(task.isFailureAutoSkipped());
    }
  }
  Map<String,Object> requestProps=new HashMap<String,Object>();
  requestProps.put(UpgradeResourceProvider.UPGRADE_CLUSTER_NAME,"c1");
  requestProps.put(UpgradeResourceProvider.UPGRADE_VERSION,"2.2.0.0");
  requestProps.put(UpgradeResourceProvider.UPGRADE_SKIP_FAILURES,Boolean.TRUE.toString());
  requestProps.put(UpgradeResourceProvider.UPGRADE_SKIP_SC_FAILURES,Boolean.FALSE.toString());
  requestProps.put(UpgradeResourceProvider.UPGRADE_REQUEST_ID,"" + entity.getRequestId());
  ResourceProvider upgradeResourceProvider=createProvider(amc);
  Request request=PropertyHelper.getUpdateRequest(requestProps,null);
  upgradeResourceProvider.updateResources(request,null);
  tasks=dao.findByRequest(entity.getRequestId());
  for (  HostRoleCommandEntity task : tasks) {
    if (task.getRoleCommand() == RoleCommand.SERVICE_CHECK) {
      assertFalse(task.isFailureAutoSkipped());
    }
 else {
      StageEntity stage=task.getStage();
      if (stage.isSkippable() && stage.isAutoSkipOnFailureSupported()) {
        assertTrue(task.isFailureAutoSkipped());
      }
 else {
        assertFalse(task.isFailureAutoSkipped());
      }
    }
  }
  requestProps=new HashMap<String,Object>();
  requestProps.put(UpgradeResourceProvider.UPGRADE_CLUSTER_NAME,"c1");
  requestProps.put(UpgradeResourceProvider.UPGRADE_VERSION,"2.2.0.0");
  requestProps.put(UpgradeResourceProvider.UPGRADE_SKIP_FAILURES,Boolean.FALSE.toString());
  requestProps.put(UpgradeResourceProvider.UPGRADE_SKIP_SC_FAILURES,Boolean.TRUE.toString());
  requestProps.put(UpgradeResourceProvider.UPGRADE_REQUEST_ID,"" + entity.getRequestId());
  request=PropertyHelper.getUpdateRequest(requestProps,null);
  upgradeResourceProvider.updateResources(request,null);
  tasks=dao.findByRequest(entity.getRequestId());
  for (  HostRoleCommandEntity task : tasks) {
    if (task.getRoleCommand() == RoleCommand.SERVICE_CHECK) {
      StageEntity stage=task.getStage();
      if (stage.isSkippable() && stage.isAutoSkipOnFailureSupported()) {
        assertTrue(task.isFailureAutoSkipped());
      }
 else {
        assertFalse(task.isFailureAutoSkipped());
      }
    }
 else {
      assertFalse(task.isFailureAutoSkipped());
    }
  }
  requestProps=new HashMap<String,Object>();
  requestProps.put(UpgradeResourceProvider.UPGRADE_CLUSTER_NAME,"c1");
  requestProps.put(UpgradeResourceProvider.UPGRADE_VERSION,"2.2.0.0");
  requestProps.put(UpgradeResourceProvider.UPGRADE_SKIP_FAILURES,Boolean.FALSE.toString());
  requestProps.put(UpgradeResourceProvider.UPGRADE_SKIP_SC_FAILURES,Boolean.FALSE.toString());
  requestProps.put(UpgradeResourceProvider.UPGRADE_REQUEST_ID,"" + entity.getRequestId());
  request=PropertyHelper.getUpdateRequest(requestProps,null);
  upgradeResourceProvider.updateResources(request,null);
  tasks=dao.findByRequest(entity.getRequestId());
  for (  HostRoleCommandEntity task : tasks) {
    assertFalse(task.isFailureAutoSkipped());
  }
}

</code></pre>

<br>
<pre class="type-4 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRetry() throws Exception {
  RequestStatus status=testCreateResources();
  Set<Resource> createdResources=status.getAssociatedResources();
  assertEquals(1,createdResources.size());
  Resource res=createdResources.iterator().next();
  Long id=(Long)res.getPropertyValue("Upgrade/request_id");
  assertNotNull(id);
  assertEquals(Long.valueOf(1),id);
  Map<String,Object> requestProps=new HashMap<String,Object>();
  requestProps.put(UpgradeResourceProvider.UPGRADE_REQUEST_ID,id.toString());
  requestProps.put(UpgradeResourceProvider.UPGRADE_REQUEST_STATUS,"ABORTED");
  UpgradeResourceProvider urp=createProvider(amc);
  Request req=PropertyHelper.getUpdateRequest(requestProps,null);
  urp.updateResources(req,null);
  ActionManager am=injector.getInstance(ActionManager.class);
  List<HostRoleCommand> commands=am.getRequestTasks(id);
  boolean foundOne=false;
  for (  HostRoleCommand hrc : commands) {
    if (hrc.getRole().equals(Role.AMBARI_SERVER_ACTION)) {
      assertEquals(-1L,hrc.getHostId());
      assertNull(hrc.getHostName());
      foundOne=true;
    }
  }
  assertTrue("Expected at least one server-side action",foundOne);
  HostRoleCommand cmd=commands.get(commands.size() - 1);
  HostRoleCommandDAO dao=injector.getInstance(HostRoleCommandDAO.class);
  HostRoleCommandEntity entity=dao.findByPK(cmd.getTaskId());
  entity.setStatus(HostRoleStatus.ABORTED);
  dao.merge(entity);
  requestProps=new HashMap<String,Object>();
  requestProps.put(UpgradeResourceProvider.UPGRADE_REQUEST_ID,id.toString());
  requestProps.put(UpgradeResourceProvider.UPGRADE_REQUEST_STATUS,"PENDING");
  req=PropertyHelper.getUpdateRequest(requestProps,null);
  urp.updateResources(req,null);
}

</code></pre>

<br>
<pre class="type-4 type-13 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPercents() throws Exception {
  RequestStatus status=testCreateResources();
  Set<Resource> createdResources=status.getAssociatedResources();
  assertEquals(1,createdResources.size());
  Resource res=createdResources.iterator().next();
  Long id=(Long)res.getPropertyValue("Upgrade/request_id");
  assertNotNull(id);
  assertEquals(Long.valueOf(1),id);
  StageDAO stageDao=injector.getInstance(StageDAO.class);
  HostRoleCommandDAO hrcDao=injector.getInstance(HostRoleCommandDAO.class);
  List<StageEntity> stages=stageDao.findByRequestId(id);
  List<HostRoleCommandEntity> tasks=hrcDao.findByRequest(id);
  Set<Long> stageIds=new HashSet<Long>();
  for (  StageEntity se : stages) {
    stageIds.add(se.getStageId());
  }
  CalculatedStatus calc=null;
  int i=0;
  for (  HostRoleCommandEntity hrce : tasks) {
    hrce.setStatus(HostRoleStatus.IN_PROGRESS);
    hrcDao.merge(hrce);
    calc=CalculatedStatus.statusFromStageSummary(hrcDao.findAggregateCounts(id),stageIds);
    assertEquals(((i++) + 1) * 4.375d,calc.getPercent(),0.01d);
    assertEquals(HostRoleStatus.IN_PROGRESS,calc.getStatus());
  }
  i=0;
  for (  HostRoleCommandEntity hrce : tasks) {
    hrce.setStatus(HostRoleStatus.COMPLETED);
    hrcDao.merge(hrce);
    calc=CalculatedStatus.statusFromStageSummary(hrcDao.findAggregateCounts(id),stageIds);
    assertEquals(35 + (((i++) + 1) * 8.125),calc.getPercent(),0.01d);
    if (i < 8) {
      assertEquals(HostRoleStatus.IN_PROGRESS,calc.getStatus());
    }
  }
  calc=CalculatedStatus.statusFromStageSummary(hrcDao.findAggregateCounts(id),stageIds);
  assertEquals(HostRoleStatus.COMPLETED,calc.getStatus());
  assertEquals(100d,calc.getPercent(),0.01d);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.controller.utilities.PropertyHelperTest </h4><pre class="type-13 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testDuplicatePointInTimeMetrics(){
  TreeSet<String> set=new TreeSet<String>();
  for (  Resource.Type type : Resource.Type.values()) {
    Map<String,Map<String,PropertyInfo>> gids=PropertyHelper.getMetricPropertyIds(type);
    Map<String,Map<String,PropertyInfo>> jids=PropertyHelper.getJMXPropertyIds(type);
    if (gids != null && jids != null) {
      gids=normalizeMetricNames(gids);
      jids=normalizeMetricNames(jids);
      for (      Map.Entry<String,Map<String,PropertyInfo>> gComponentEntry : gids.entrySet()) {
        String gComponent=gComponentEntry.getKey();
        Set<Map.Entry<String,PropertyInfo>> gComponentEntries=gComponentEntry.getValue().entrySet();
        for (        Map.Entry<String,PropertyInfo> gMetricEntry : gComponentEntries) {
          Map<String,PropertyInfo> jMetrics=jids.get(gComponent);
          if (jMetrics != null) {
            String gMetric=gMetricEntry.getKey();
            PropertyInfo jProperty=jMetrics.get(gMetric);
            if (jProperty != null) {
              PropertyInfo gProperty=gMetricEntry.getValue();
              if (gProperty.isPointInTime()) {
                String s=type + " : " + gComponent+ " : "+ gMetric+ " : "+ gProperty.getPropertyId();
                set.add(s);
              }
            }
          }
        }
      }
    }
  }
  if (set.size() > 0) {
    System.out.println("The following point in time metrics are defined for both JMX and Ganglia.");
    System.out.println("The preference is to get point in time metrics from JMX only if possible.");
    System.out.println("If the metric can be obtained from JMX then set \"pointInTime\" : false for ");
    System.out.println("the metric in the Ganglia properties definition, otherwise remove the metric ");
    System.out.println("from the JMX properties definition.\n");
    for (    String s : set) {
      System.out.println(s);
    }
    Assert.fail("Found duplicate point in time metrics.");
  }
}

</code></pre>

<br>
<pre class="type-13 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testJMXTemporal(){
  TreeSet<String> set=new TreeSet<String>();
  for (  Resource.Type type : Resource.Type.values()) {
    Map<String,Map<String,PropertyInfo>> jids=PropertyHelper.getJMXPropertyIds(type);
    if (jids != null) {
      for (      Map.Entry<String,Map<String,PropertyInfo>> jComponentEntry : jids.entrySet()) {
        String jComponent=jComponentEntry.getKey();
        Set<Map.Entry<String,PropertyInfo>> jComponentEntries=jComponentEntry.getValue().entrySet();
        for (        Map.Entry<String,PropertyInfo> jMetricEntry : jComponentEntries) {
          String jMetric=jMetricEntry.getKey();
          PropertyInfo jProperty=jMetricEntry.getValue();
          if (jProperty.isTemporal()) {
            String s=type + " : " + jComponent+ " : "+ jMetric+ " : "+ jProperty.getPropertyId();
            set.add(s);
          }
        }
      }
    }
  }
  if (set.size() > 0) {
    System.out.println("The following metrics are marked as temporal JMX.");
    System.out.println("JMX can provide point in time metrics only.\n");
    for (    String s : set) {
      System.out.println(s);
    }
    Assert.fail("Found temporal JMX metrics.");
  }
}

</code></pre>

<br>
<pre class="type-13 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testTemporalOnlyMetrics(){
  TreeSet<String> set=new TreeSet<String>();
  for (  Resource.Type type : Resource.Type.values()) {
    Map<String,Map<String,PropertyInfo>> gids=PropertyHelper.getMetricPropertyIds(type);
    Map<String,Map<String,PropertyInfo>> jids=PropertyHelper.getJMXPropertyIds(type);
    if (gids != null && jids != null) {
      gids=normalizeMetricNames(gids);
      jids=normalizeMetricNames(jids);
      for (      Map.Entry<String,Map<String,PropertyInfo>> gComponentEntry : gids.entrySet()) {
        String gComponent=gComponentEntry.getKey();
        Set<Map.Entry<String,PropertyInfo>> gComponentEntries=gComponentEntry.getValue().entrySet();
        for (        Map.Entry<String,PropertyInfo> gMetricEntry : gComponentEntries) {
          Map<String,PropertyInfo> jMetrics=jids.get(gComponent);
          if (jMetrics != null) {
            String gMetric=gMetricEntry.getKey();
            PropertyInfo gProperty=gMetricEntry.getValue();
            if (!gProperty.isPointInTime()) {
              PropertyInfo jProperty=jMetrics.get(gMetric);
              if (jProperty == null || !jProperty.isPointInTime()) {
                String s=type + " : " + gComponent+ " : "+ gMetric+ " : "+ gProperty.getPropertyId();
                set.add(s);
              }
            }
          }
        }
      }
    }
  }
  if (set.size() > 0) {
    System.out.println("The following metrics are marked as temporal only for Ganglia ");
    System.out.println("but are not defined for JMX.");
    System.out.println("The preference is to get point in time metrics from JMX if possible.");
    System.out.println("If the metric can be obtained from JMX then add it to the JMX properties");
    System.out.println("definition, otherwise set set \"pointInTime\" : true for the metric in ");
    System.out.println("the Ganglia properties definition.\n");
    for (    String s : set) {
      System.out.println(s);
    }
    Assert.fail("Found temporal only metrics.");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.events.listeners.upgrade.HostVersionOutOfSyncListenerTest </h4><pre class="type-13 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * When a host is added to a cluster that has non-CURRENT cluster_version records,
 * then Ambari needs to insert host_verion record for each one of
 * those stack versions with a state of OUT_OF_SYNC
 */
@Test public void testOnHostEvent() throws AmbariException {
  Host h1=clusters.getHost("h1");
  h1.setState(HostState.HEALTHY);
  StackId stackId=new StackId(this.stackId);
  StackId yaStackId=new StackId(yetAnotherStackId);
  RepositoryVersionEntity repositoryVersionEntity=helper.getOrCreateRepositoryVersion(stackId,"2.2.0-1000");
  RepositoryVersionEntity repositoryVersionEntity2=helper.getOrCreateRepositoryVersion(stackId,"2.2.0-2000");
  c1.createClusterVersion(stackId,"2.2.0-1000","admin",RepositoryVersionState.INSTALLING);
  c1.setCurrentStackVersion(stackId);
  c1.recalculateAllClusterVersionStates();
  assertRepoVersionState(stackId.getStackId(),"2.2.0-1000",RepositoryVersionState.INSTALLING);
  assertRepoVersionState(stackId.getStackId(),"2.2.0-2086",RepositoryVersionState.CURRENT);
  HostVersionEntity hv1=helper.createHostVersion("h1",repositoryVersionEntity,RepositoryVersionState.INSTALLED);
  HostVersionEntity hv2=helper.createHostVersion("h1",repositoryVersionEntity2,RepositoryVersionState.INSTALLED);
  c1.recalculateAllClusterVersionStates();
  assertRepoVersionState(stackId.getStackId(),"2.2.0-1000",RepositoryVersionState.INSTALLED);
  assertRepoVersionState(stackId.getStackId(),"2.2.0-2000",RepositoryVersionState.INSTALLED);
  assertRepoVersionState(stackId.getStackId(),"2.2.0-2086",RepositoryVersionState.CURRENT);
  addHost("h2");
  clusters.mapHostToCluster("h2","c1");
  List<HostVersionEntity> h2Versions=hostVersionDAO.findByHost("h2");
  for (  HostVersionEntity hostVersionEntity : h2Versions) {
    if (hostVersionEntity.getRepositoryVersion().toString().equals("2.2.0-2086")) {
      assertEquals(hostVersionEntity.getState(),RepositoryVersionState.CURRENT);
    }
 else {
      assertEquals(hostVersionEntity.getState(),RepositoryVersionState.OUT_OF_SYNC);
    }
  }
}

</code></pre>

<br>
<pre class="type-13 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * When a service is added to a cluster, all non-CURRENT host versions on
 * all affected hosts (where host new components are installed)
 * should transition to OUT_OF_SYNC state
 */
@Test public void testOnServiceEvent() throws AmbariException {
  String INSTALLED_VERSION="2.2.0-1000";
  String INSTALLED_VERSION_2="2.1.1-2000";
  StackId stackId=new StackId(this.stackId);
  StackId yaStackId=new StackId(yetAnotherStackId);
  createClusterAndHosts(INSTALLED_VERSION,stackId);
  addRepoVersion(INSTALLED_VERSION_2,yaStackId);
  List<String> hostList=new ArrayList<String>();
  hostList.add("h1");
  hostList.add("h2");
  hostList.add("h3");
  Map<String,List<Integer>> hdfsTopology=new HashMap<String,List<Integer>>();
  hdfsTopology.put("NAMENODE",Collections.singletonList(0));
  hdfsTopology.put("SECONDARY_NAMENODE",Collections.singletonList(1));
  List<Integer> datanodeHosts=Arrays.asList(0,1);
  hdfsTopology.put("DATANODE",new ArrayList<Integer>(datanodeHosts));
  addService(c1,hostList,hdfsTopology,"HDFS");
  Set<String> changedHosts=new HashSet<String>();
  changedHosts.add("h1");
  changedHosts.add("h2");
  List<HostVersionEntity> hostVersions=hostVersionDAO.findAll();
  assertRepoVersionState(stackId.getStackId(),INSTALLED_VERSION,RepositoryVersionState.INSTALLED);
  assertRepoVersionState(yaStackId.getStackId(),INSTALLED_VERSION_2,RepositoryVersionState.INSTALLED);
  for (  HostVersionEntity hostVersionEntity : hostVersions) {
    if (hostVersionEntity.getRepositoryVersion().getVersion().equals(INSTALLED_VERSION) || hostVersionEntity.getRepositoryVersion().getVersion().equals(INSTALLED_VERSION_2)) {
      if (changedHosts.contains(hostVersionEntity.getHostName())) {
        assertEquals(hostVersionEntity.getState(),RepositoryVersionState.OUT_OF_SYNC);
      }
 else {
        assertEquals(hostVersionEntity.getState(),RepositoryVersionState.INSTALLED);
      }
    }
  }
}

</code></pre>

<br>
<pre class="type-13 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * When a new service is added to a cluster with components, all INSTALLED host versions on
 * all affected hosts (where host new components are installed)
 * should transition to OUT_OF_SYNC state.
 */
@Test public void testOnServiceComponentEvent() throws AmbariException {
  String INSTALLED_VERSION="2.2.0-1000";
  String INSTALLED_VERSION_2="2.1.1-2000";
  StackId stackId=new StackId(this.stackId);
  StackId yaStackId=new StackId(yetAnotherStackId);
  createClusterAndHosts(INSTALLED_VERSION,stackId);
  addRepoVersion(INSTALLED_VERSION_2,yaStackId);
  List<String> hostList=new ArrayList<String>();
  hostList.add("h1");
  hostList.add("h2");
  hostList.add("h3");
  addServiceComponent(c1,hostList,"ZOOKEEPER","ZOOKEEPER_CLIENT");
  Set<String> changedHosts=new HashSet<String>();
  changedHosts.add("h1");
  changedHosts.add("h2");
  changedHosts.add("h3");
  assertRepoVersionState(stackId.getStackId(),INSTALLED_VERSION,RepositoryVersionState.INSTALLED);
  List<HostVersionEntity> hostVersions=hostVersionDAO.findAll();
  for (  HostVersionEntity hostVersionEntity : hostVersions) {
    RepositoryVersionEntity repoVersion=hostVersionEntity.getRepositoryVersion();
    if (repoVersion.getVersion().equals(INSTALLED_VERSION) || repoVersion.getVersion().equals(INSTALLED_VERSION_2)) {
      if (changedHosts.contains(hostVersionEntity.getHostName())) {
        assertEquals(hostVersionEntity.getState(),RepositoryVersionState.OUT_OF_SYNC);
      }
 else {
        assertEquals(hostVersionEntity.getState(),RepositoryVersionState.INSTALLED);
      }
    }
  }
}

</code></pre>

<br>
<pre class="type-13 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * When a service with components that don't advertise their versions
 * is added to a cluster, all non-CURRENT host versions on
 * all affected hosts (where host new components are installed)
 * should NOT transition to OUT_OF_SYNC state
 */
@Test public void testOnServiceEvent_component_does_not_advertise_version() throws AmbariException {
  String INSTALLED_VERSION="2.2.0-1000";
  StackId stackId=new StackId(this.stackId);
  createClusterAndHosts(INSTALLED_VERSION,stackId);
  List<String> hostList=new ArrayList<String>();
  hostList.add("h1");
  hostList.add("h2");
  hostList.add("h3");
  Map<String,List<Integer>> hdfsTopology=new HashMap<String,List<Integer>>();
  hdfsTopology.put("GANGLIA_SERVER",Collections.singletonList(0));
  List<Integer> monitorHosts=Arrays.asList(0,1);
  hdfsTopology.put("GANGLIA_MONITOR",new ArrayList<Integer>(monitorHosts));
  addService(c1,hostList,hdfsTopology,"GANGLIA");
  Set<String> changedHosts=new HashSet<String>();
  changedHosts.add("h1");
  changedHosts.add("h2");
  List<HostVersionEntity> hostVersions=hostVersionDAO.findAll();
  assertRepoVersionState(stackId.getStackId(),INSTALLED_VERSION,RepositoryVersionState.INSTALLED);
  for (  HostVersionEntity hostVersionEntity : hostVersions) {
    if (hostVersionEntity.getRepositoryVersion().getVersion().equals(INSTALLED_VERSION)) {
      assertEquals(hostVersionEntity.getState(),RepositoryVersionState.INSTALLED);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.metadata.RoleCommandOrderTest </h4><pre class="type-4 type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAddDependencies() throws IOException {
  RoleCommandOrder rco=injector.getInstance(RoleCommandOrder.class);
  InputStream testJsonIS=getClass().getClassLoader().getResourceAsStream(TEST_RCO_DATA_FILE);
  ObjectMapper mapper=new ObjectMapper();
  Map<String,Object> testData=mapper.readValue(testJsonIS,new TypeReference<Map<String,Object>>(){
  }
);
  rco.addDependencies(testData);
  mapper.setVisibility(JsonMethod.ALL,JsonAutoDetect.Visibility.ANY);
  String dump=mapper.writeValueAsString(rco.getDependencies());
  List<String> parts=Arrays.asList(dump.substring(1,522).split(Pattern.quote("],")));
  assertEquals(3,parts.size());
  assertTrue(parts.contains("\"RoleCommandPair{role=SECONDARY_NAMENODE, cmd=UPGRADE}\":[{\"role\":{\"name\":\"NAMENODE\"},\"cmd\":\"UPGRADE\"}"));
  assertTrue(parts.contains("\"RoleCommandPair{role=SECONDARY_NAMENODE, cmd=START}\":[{\"role\":{\"name\":\"NAMENODE\"},\"cmd\":\"START\"}"));
  boolean datanodeCommandExists=false;
  for (  String part : parts) {
    if (part.contains("RoleCommandPair{role=DATANODE, cmd=STOP}")) {
      datanodeCommandExists=true;
      String[] parts2=part.split(Pattern.quote(":["));
      assertEquals(2,parts2.length);
      assertEquals("\"RoleCommandPair{role=DATANODE, cmd=STOP}\"",parts2[0]);
      List<String> components=Arrays.asList(new String[]{"\"role\":{\"name\":\"HBASE_MASTER\"},\"cmd\":\"STOP\"","\"role\":{\"name\":\"RESOURCEMANAGER\"},\"cmd\":\"STOP\"","\"role\":{\"name\":\"TASKTRACKER\"},\"cmd\":\"STOP\"","\"role\":{\"name\":\"NODEMANAGER\"},\"cmd\":\"STOP\"","\"role\":{\"name\":\"HISTORYSERVER\"},\"cmd\":\"STOP\"","\"role\":{\"name\":\"JOBTRACKER\"},\"cmd\":\"STOP\""});
      Assert.assertTrue(CollectionPresentationUtils.isStringPermutationOfCollection(parts2[1],components,"},{",1,1));
    }
  }
  assertTrue(datanodeCommandExists);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.orm.dao.AlertsDAOTest </h4><pre class="type-13 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that maintenance mode is set correctly on notices.
 * @throws Exception
 */
@Test public void testMaintenanceMode() throws Exception {
  m_helper.installHdfsService(m_cluster,m_serviceFactory,m_componentFactory,m_schFactory,HOSTNAME);
  List<AlertCurrentEntity> currents=m_dao.findCurrent();
  for (  AlertCurrentEntity current : currents) {
    m_dao.remove(current);
  }
  AlertDefinitionEntity namenode=new AlertDefinitionEntity();
  namenode.setDefinitionName("NAMENODE");
  namenode.setServiceName("HDFS");
  namenode.setComponentName("NAMENODE");
  namenode.setClusterId(m_cluster.getClusterId());
  namenode.setHash(UUID.randomUUID().toString());
  namenode.setScheduleInterval(Integer.valueOf(60));
  namenode.setScope(Scope.ANY);
  namenode.setSource("{\"type\" : \"SCRIPT\"}");
  namenode.setSourceType(SourceType.SCRIPT);
  m_definitionDao.create(namenode);
  AlertDefinitionEntity datanode=new AlertDefinitionEntity();
  datanode.setDefinitionName("DATANODE");
  datanode.setServiceName("HDFS");
  datanode.setComponentName("DATANODE");
  datanode.setClusterId(m_cluster.getClusterId());
  datanode.setHash(UUID.randomUUID().toString());
  datanode.setScheduleInterval(Integer.valueOf(60));
  datanode.setScope(Scope.HOST);
  datanode.setSource("{\"type\" : \"SCRIPT\"}");
  datanode.setSourceType(SourceType.SCRIPT);
  m_definitionDao.create(datanode);
  AlertDefinitionEntity aggregate=new AlertDefinitionEntity();
  aggregate.setDefinitionName("DATANODE_UP");
  aggregate.setServiceName("HDFS");
  aggregate.setComponentName(null);
  aggregate.setClusterId(m_cluster.getClusterId());
  aggregate.setHash(UUID.randomUUID().toString());
  aggregate.setScheduleInterval(Integer.valueOf(60));
  aggregate.setScope(Scope.SERVICE);
  aggregate.setSource("{\"type\" : \"SCRIPT\"}");
  aggregate.setSourceType(SourceType.SCRIPT);
  m_definitionDao.create(aggregate);
  AlertHistoryEntity nnHistory=new AlertHistoryEntity();
  nnHistory.setAlertState(AlertState.OK);
  nnHistory.setServiceName(namenode.getServiceName());
  nnHistory.setComponentName(namenode.getComponentName());
  nnHistory.setClusterId(m_cluster.getClusterId());
  nnHistory.setAlertDefinition(namenode);
  nnHistory.setAlertLabel(namenode.getDefinitionName());
  nnHistory.setAlertText(namenode.getDefinitionName());
  nnHistory.setAlertTimestamp(calendar.getTimeInMillis());
  nnHistory.setHostName(HOSTNAME);
  m_dao.create(nnHistory);
  AlertCurrentEntity nnCurrent=new AlertCurrentEntity();
  nnCurrent.setAlertHistory(nnHistory);
  nnCurrent.setLatestText(nnHistory.getAlertText());
  nnCurrent.setMaintenanceState(MaintenanceState.OFF);
  nnCurrent.setOriginalTimestamp(System.currentTimeMillis());
  nnCurrent.setLatestTimestamp(System.currentTimeMillis());
  m_dao.create(nnCurrent);
  AlertHistoryEntity dnHistory=new AlertHistoryEntity();
  dnHistory.setAlertState(AlertState.WARNING);
  dnHistory.setServiceName(datanode.getServiceName());
  dnHistory.setComponentName(datanode.getComponentName());
  dnHistory.setClusterId(m_cluster.getClusterId());
  dnHistory.setAlertDefinition(datanode);
  dnHistory.setAlertLabel(datanode.getDefinitionName());
  dnHistory.setAlertText(datanode.getDefinitionName());
  dnHistory.setAlertTimestamp(calendar.getTimeInMillis());
  dnHistory.setHostName(HOSTNAME);
  m_dao.create(dnHistory);
  AlertCurrentEntity dnCurrent=new AlertCurrentEntity();
  dnCurrent.setAlertHistory(dnHistory);
  dnCurrent.setLatestText(dnHistory.getAlertText());
  dnCurrent.setMaintenanceState(MaintenanceState.OFF);
  dnCurrent.setOriginalTimestamp(System.currentTimeMillis());
  dnCurrent.setLatestTimestamp(System.currentTimeMillis());
  m_dao.create(dnCurrent);
  AlertHistoryEntity aggregateHistory=new AlertHistoryEntity();
  aggregateHistory.setAlertState(AlertState.CRITICAL);
  aggregateHistory.setServiceName(aggregate.getServiceName());
  aggregateHistory.setComponentName(aggregate.getComponentName());
  aggregateHistory.setClusterId(m_cluster.getClusterId());
  aggregateHistory.setAlertDefinition(aggregate);
  aggregateHistory.setAlertLabel(aggregate.getDefinitionName());
  aggregateHistory.setAlertText(aggregate.getDefinitionName());
  aggregateHistory.setAlertTimestamp(calendar.getTimeInMillis());
  m_dao.create(aggregateHistory);
  AlertCurrentEntity aggregateCurrent=new AlertCurrentEntity();
  aggregateCurrent.setAlertHistory(aggregateHistory);
  aggregateCurrent.setLatestText(aggregateHistory.getAlertText());
  aggregateCurrent.setMaintenanceState(MaintenanceState.OFF);
  aggregateCurrent.setOriginalTimestamp(System.currentTimeMillis());
  aggregateCurrent.setLatestTimestamp(System.currentTimeMillis());
  m_dao.create(aggregateCurrent);
  currents=m_dao.findCurrent();
  assertEquals(3,currents.size());
  for (  AlertCurrentEntity current : currents) {
    assertEquals(MaintenanceState.OFF,current.getMaintenanceState());
  }
  Service hdfs=m_clusters.getClusterById(m_cluster.getClusterId()).getService("HDFS");
  hdfs.setMaintenanceState(MaintenanceState.ON);
  currents=m_dao.findCurrent();
  assertEquals(3,currents.size());
  for (  AlertCurrentEntity current : currents) {
    assertEquals(MaintenanceState.ON,current.getMaintenanceState());
  }
  hdfs.setMaintenanceState(MaintenanceState.OFF);
  currents=m_dao.findCurrent();
  assertEquals(3,currents.size());
  for (  AlertCurrentEntity current : currents) {
    assertEquals(MaintenanceState.OFF,current.getMaintenanceState());
  }
  Host host=m_clusters.getHost(HOSTNAME);
  host.setMaintenanceState(m_cluster.getClusterId(),MaintenanceState.ON);
  currents=m_dao.findCurrent();
  assertEquals(3,currents.size());
  for (  AlertCurrentEntity current : currents) {
    if (current.getAlertHistory().getComponentName() != null) {
      assertEquals(MaintenanceState.ON,current.getMaintenanceState());
    }
 else {
      assertEquals(MaintenanceState.OFF,current.getMaintenanceState());
    }
  }
  host.setMaintenanceState(m_cluster.getClusterId(),MaintenanceState.OFF);
  currents=m_dao.findCurrent();
  assertEquals(3,currents.size());
  for (  AlertCurrentEntity current : currents) {
    assertEquals(MaintenanceState.OFF,current.getMaintenanceState());
  }
  ServiceComponentHost nnComponent=null;
  List<ServiceComponentHost> schs=m_cluster.getServiceComponentHosts(HOSTNAME);
  for (  ServiceComponentHost sch : schs) {
    if ("NAMENODE".equals(sch.getServiceComponentName())) {
      sch.setMaintenanceState(MaintenanceState.ON);
      nnComponent=sch;
    }
  }
  assertNotNull(nnComponent);
  currents=m_dao.findCurrent();
  assertEquals(3,currents.size());
  for (  AlertCurrentEntity current : currents) {
    if ("NAMENODE".equals(current.getAlertHistory().getComponentName())) {
      assertEquals(MaintenanceState.ON,current.getMaintenanceState());
    }
 else {
      assertEquals(MaintenanceState.OFF,current.getMaintenanceState());
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.orm.dao.HostRoleCommandDAOTest </h4><pre class="type-13 type-2 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * Tests that setting the auto-skip feature of a {@link HostRoleCommandEntity}is somewhat dependenant on the {@link StageEntity}'s support for it.
 */
@Test public void testAutoSkipSupport(){
  OrmTestHelper helper=m_injector.getInstance(OrmTestHelper.class);
  helper.createDefaultData();
  Long requestId=Long.valueOf(100L);
  ClusterEntity clusterEntity=m_clusterDAO.findByName("test_cluster1");
  RequestEntity requestEntity=new RequestEntity();
  requestEntity.setRequestId(requestId);
  requestEntity.setClusterId(clusterEntity.getClusterId());
  requestEntity.setStages(new ArrayList<StageEntity>());
  m_requestDAO.create(requestEntity);
  AtomicLong stageId=new AtomicLong(1);
  HostEntity host=m_hostDAO.findByName("test_host1");
  host.setHostRoleCommandEntities(new ArrayList<HostRoleCommandEntity>());
  long stageIdAutoSkipAll=stageId.getAndIncrement();
  createStage(stageIdAutoSkipAll,3,host,requestEntity,HostRoleStatus.PENDING,true,true,true);
  List<HostRoleCommandEntity> tasks=m_hostRoleCommandDAO.findByRequest(requestId);
  for (  HostRoleCommandEntity task : tasks) {
    Assert.assertTrue(task.isFailureAutoSkipped());
  }
  long stageIdSkippableButNoAutoSkip=stageId.getAndIncrement();
  createStage(stageIdSkippableButNoAutoSkip,3,host,requestEntity,HostRoleStatus.PENDING,true,false,true);
  tasks=m_hostRoleCommandDAO.findByRequest(requestId);
  for (  HostRoleCommandEntity task : tasks) {
    StageEntity stage=task.getStage();
    if (stage.getStageId() == stageIdAutoSkipAll) {
      Assert.assertTrue(task.isFailureAutoSkipped());
    }
 else     if (stage.getStageId() == stageIdSkippableButNoAutoSkip) {
      Assert.assertFalse(task.isFailureAutoSkipped());
    }
  }
  m_hostRoleCommandDAO.updateAutomaticSkipOnFailure(requestId,false,false);
  tasks=m_hostRoleCommandDAO.findByRequest(requestId);
  for (  HostRoleCommandEntity task : tasks) {
    Assert.assertFalse(task.isFailureAutoSkipped());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.orm.dao.ServiceConfigDAOTest </h4><pre class="type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetLastServiceConfigs() throws Exception {
  createServiceConfig("HDFS","admin",1L,1L,1111L,null);
  createServiceConfig("HDFS","admin",2L,2L,2222L,null);
  createServiceConfig("YARN","admin",1L,3L,3333L,null);
  List<ServiceConfigEntity> serviceConfigEntities=serviceConfigDAO.getLastServiceConfigs(clusterDAO.findByName("c1").getClusterId());
  Assert.assertNotNull(serviceConfigEntities);
  Assert.assertEquals(2,serviceConfigEntities.size());
  for (  ServiceConfigEntity sce : serviceConfigEntities) {
    if ("HDFS".equals(sce.getServiceName())) {
      Assert.assertEquals("c1",sce.getClusterEntity().getClusterName());
      Assert.assertEquals(Long.valueOf(1),sce.getClusterEntity().getClusterId());
      Assert.assertEquals(Long.valueOf(2222L),sce.getCreateTimestamp());
      Assert.assertEquals(Long.valueOf(2),sce.getVersion());
      Assert.assertTrue(sce.getClusterConfigEntities().isEmpty());
      Assert.assertNotNull(sce.getServiceConfigId());
    }
    if ("YARN".equals(sce.getServiceName())) {
      Assert.assertEquals("c1",sce.getClusterEntity().getClusterName());
      Assert.assertEquals(Long.valueOf(1),sce.getClusterEntity().getClusterId());
      Assert.assertEquals(Long.valueOf(3333L),sce.getCreateTimestamp());
      Assert.assertEquals(Long.valueOf(1),sce.getVersion());
      Assert.assertTrue(sce.getClusterConfigEntities().isEmpty());
      Assert.assertNotNull(sce.getServiceConfigId());
    }
    Assert.assertEquals("admin",sce.getUser());
  }
}

</code></pre>

<br>
<pre class="type-13 type-10 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetServiceConfigs() throws Exception {
  createServiceConfig("HDFS","admin",1L,1L,1111L,null);
  createServiceConfig("HDFS","admin",2L,2L,2222L,null);
  createServiceConfig("YARN","admin",1L,3L,3333L,null);
  List<ServiceConfigEntity> serviceConfigEntities=serviceConfigDAO.getServiceConfigs(clusterDAO.findByName("c1").getClusterId());
  Assert.assertNotNull(serviceConfigEntities);
  Assert.assertEquals(3,serviceConfigEntities.size());
  for (  ServiceConfigEntity sce : serviceConfigEntities) {
    if ("HDFS".equals(sce.getServiceName()) && (sce.getVersion() == 1)) {
      Assert.assertEquals("c1",sce.getClusterEntity().getClusterName());
      Assert.assertEquals(Long.valueOf(1),sce.getClusterEntity().getClusterId());
      Assert.assertEquals(Long.valueOf(1111L),sce.getCreateTimestamp());
      Assert.assertTrue(sce.getClusterConfigEntities().isEmpty());
      Assert.assertNotNull(sce.getServiceConfigId());
    }
 else     if ("HDFS".equals(sce.getServiceName()) && (sce.getVersion() == 2)) {
      Assert.assertEquals("c1",sce.getClusterEntity().getClusterName());
      Assert.assertEquals(Long.valueOf(1),sce.getClusterEntity().getClusterId());
      Assert.assertEquals(Long.valueOf(2222L),sce.getCreateTimestamp());
      Assert.assertTrue(sce.getClusterConfigEntities().isEmpty());
      Assert.assertNotNull(sce.getServiceConfigId());
    }
 else     if ("YARN".equals(sce.getServiceName())) {
      Assert.assertEquals("c1",sce.getClusterEntity().getClusterName());
      Assert.assertEquals(Long.valueOf(1),sce.getClusterEntity().getClusterId());
      Assert.assertEquals(Long.valueOf(3333L),sce.getCreateTimestamp());
      Assert.assertEquals(Long.valueOf(1),sce.getVersion());
      Assert.assertTrue(sce.getClusterConfigEntities().isEmpty());
      Assert.assertNotNull(sce.getServiceConfigId());
    }
 else {
      Assert.fail();
    }
    Assert.assertEquals("admin",sce.getUser());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.security.CertGenerationTest </h4><pre class="type-4 type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPassFileGen() throws Exception {
  File passFile=new File(temp.getRoot().getAbsolutePath() + File.separator + passFileName);
  Assert.assertTrue(passFile.exists());
  String pass=FileUtils.readFileToString(passFile);
  Assert.assertEquals(pass.length(),passLen);
  if (ShellCommandUtil.LINUX) {
    String permissions=ShellCommandUtil.getUnixFilePermissions(passFile.getAbsolutePath());
    Assert.assertEquals(ShellCommandUtil.MASK_OWNER_ONLY_RW,permissions);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.serveraction.kerberos.KerberosConfigDataFileTest </h4><pre class="type-4 type-12 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKerberosConfigDataFile() throws Exception {
  File file=folder.newFile();
  Assert.assertNotNull(file);
  KerberosConfigDataFileWriter writer=kerberosConfigDataFileWriterFactory.createKerberosConfigDataFileWriter(file);
  Assert.assertFalse(writer.isClosed());
  for (int i=0; i < 10; i++) {
    writer.addRecord("config-type" + i,"key" + i,"value" + i,KerberosConfigDataFileWriter.OPERATION_TYPE_SET);
  }
  for (int i=10; i < 15; i++) {
    writer.addRecord("config-type" + i,"key" + i,"value" + i,KerberosConfigDataFileWriter.OPERATION_TYPE_REMOVE);
  }
  writer.close();
  Assert.assertTrue(writer.isClosed());
  KerberosConfigDataFileReader reader=kerberosConfigDataFileReaderFactory.createKerberosConfigDataFileReader(file);
  Assert.assertFalse(reader.isClosed());
  Iterator<Map<String,String>> iterator=reader.iterator();
  Assert.assertNotNull(iterator);
  int i=0;
  while (iterator.hasNext()) {
    Map<String,String> record=iterator.next();
    if (i < 15) {
      Assert.assertEquals("config-type" + i,record.get(KerberosConfigDataFileReader.CONFIGURATION_TYPE));
      Assert.assertEquals("key" + i,record.get(KerberosConfigDataFileReader.KEY));
      Assert.assertEquals("value" + i,record.get(KerberosConfigDataFileReader.VALUE));
      if (i < 10) {
        Assert.assertEquals("SET",record.get(KerberosConfigDataFileReader.OPERATION));
      }
 else {
        Assert.assertEquals("REMOVE",record.get(KerberosConfigDataFileReader.OPERATION));
      }
    }
    i++;
  }
  Assert.assertEquals(15,i);
  reader.close();
  Assert.assertTrue(reader.isClosed());
  reader.open();
  Assert.assertFalse(reader.isClosed());
  i=0;
  for (  Map<String,String> record : reader) {
    if (i < 10) {
      Assert.assertEquals("config-type" + i,record.get(KerberosConfigDataFileReader.CONFIGURATION_TYPE));
      Assert.assertEquals("key" + i,record.get(KerberosConfigDataFileReader.KEY));
      Assert.assertEquals("value" + i,record.get(KerberosConfigDataFileReader.VALUE));
    }
    i++;
  }
  Assert.assertEquals(15,i);
  reader.close();
  Assert.assertTrue(reader.isClosed());
  writer.open();
  Assert.assertFalse(writer.isClosed());
  writer.addRecord("config-type","key","value",KerberosConfigDataFileReader.OPERATION_TYPE_SET);
  writer.close();
  Assert.assertTrue(writer.isClosed());
  reader=kerberosConfigDataFileReaderFactory.createKerberosConfigDataFileReader(file);
  Assert.assertFalse(reader.isClosed());
  i=0;
  for (  Map<String,String> record : reader) {
    i++;
  }
  Assert.assertEquals(16,i);
  reader.close();
  Assert.assertTrue(reader.isClosed());
  writer=kerberosConfigDataFileWriterFactory.createKerberosConfigDataFileWriter(file);
  Assert.assertFalse(writer.isClosed());
  writer.addRecord("config-type","key","value",KerberosConfigDataFileReader.OPERATION_TYPE_REMOVE);
  writer.close();
  Assert.assertTrue(writer.isClosed());
  reader.open();
  Assert.assertFalse(reader.isClosed());
  i=0;
  for (  Map<String,String> record : reader) {
    i++;
  }
  Assert.assertEquals(17,i);
  reader.close();
  Assert.assertTrue(reader.isClosed());
  i=0;
  for (  Map<String,String> record : reader) {
    i++;
  }
  Assert.assertEquals(0,i);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.serveraction.kerberos.KerberosIdentityDataFileTest </h4><pre class="type-4 type-12 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKerberosIdentityDataFile() throws Exception {
  File file=folder.newFile();
  Assert.assertNotNull(file);
  KerberosIdentityDataFileWriter writer=kerberosIdentityDataFileWriterFactory.createKerberosIdentityDataFileWriter(file);
  Assert.assertFalse(writer.isClosed());
  for (int i=0; i < 10; i++) {
    writer.writeRecord("hostName" + i,"serviceName" + i,"serviceComponentName" + i,"principal" + i,"principal_type" + i,"keytabFilePath" + i,"keytabFileOwnerName" + i,"keytabFileOwnerAccess" + i,"keytabFileGroupName" + i,"keytabFileGroupAccess" + i,"false");
  }
  writer.writeRecord("hostName's","serviceName#","serviceComponentName\"","principal","principal_type","keytabFilePath","'keytabFileOwnerName'","<keytabFileOwnerAccess>","\"keytabFileGroupName\"","keytab,File,Group,Access","false");
  writer.close();
  Assert.assertTrue(writer.isClosed());
  KerberosIdentityDataFileReader reader=kerberosIdentityDataFileReaderFactory.createKerberosIdentityDataFileReader(file);
  Assert.assertFalse(reader.isClosed());
  Iterator<Map<String,String>> iterator=reader.iterator();
  Assert.assertNotNull(iterator);
  int i=0;
  while (iterator.hasNext()) {
    Map<String,String> record=iterator.next();
    if (i < 10) {
      Assert.assertEquals("hostName" + i,record.get(KerberosIdentityDataFileReader.HOSTNAME));
      Assert.assertEquals("serviceName" + i,record.get(KerberosIdentityDataFileReader.SERVICE));
      Assert.assertEquals("serviceComponentName" + i,record.get(KerberosIdentityDataFileReader.COMPONENT));
      Assert.assertEquals("principal" + i,record.get(KerberosIdentityDataFileReader.PRINCIPAL));
      Assert.assertEquals("principal_type" + i,record.get(KerberosIdentityDataFileReader.PRINCIPAL_TYPE));
      Assert.assertEquals("keytabFilePath" + i,record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_PATH));
      Assert.assertEquals("keytabFileOwnerName" + i,record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_OWNER_NAME));
      Assert.assertEquals("keytabFileOwnerAccess" + i,record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_OWNER_ACCESS));
      Assert.assertEquals("keytabFileGroupName" + i,record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_GROUP_NAME));
      Assert.assertEquals("keytabFileGroupAccess" + i,record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_GROUP_ACCESS));
      Assert.assertEquals("false",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_IS_CACHABLE));
    }
 else {
      Assert.assertEquals("hostName's",record.get(KerberosIdentityDataFileReader.HOSTNAME));
      Assert.assertEquals("serviceName#",record.get(KerberosIdentityDataFileReader.SERVICE));
      Assert.assertEquals("serviceComponentName\"",record.get(KerberosIdentityDataFileReader.COMPONENT));
      Assert.assertEquals("principal",record.get(KerberosIdentityDataFileReader.PRINCIPAL));
      Assert.assertEquals("principal_type",record.get(KerberosIdentityDataFileReader.PRINCIPAL_TYPE));
      Assert.assertEquals("keytabFilePath",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_PATH));
      Assert.assertEquals("'keytabFileOwnerName'",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_OWNER_NAME));
      Assert.assertEquals("<keytabFileOwnerAccess>",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_OWNER_ACCESS));
      Assert.assertEquals("\"keytabFileGroupName\"",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_GROUP_NAME));
      Assert.assertEquals("keytab,File,Group,Access",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_GROUP_ACCESS));
      Assert.assertEquals("false",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_IS_CACHABLE));
    }
    i++;
  }
  reader.close();
  Assert.assertTrue(reader.isClosed());
  reader.open();
  Assert.assertFalse(reader.isClosed());
  i=0;
  for (  Map<String,String> record : reader) {
    if (i < 10) {
      Assert.assertEquals("hostName" + i,record.get(KerberosIdentityDataFileReader.HOSTNAME));
      Assert.assertEquals("serviceName" + i,record.get(KerberosIdentityDataFileReader.SERVICE));
      Assert.assertEquals("serviceComponentName" + i,record.get(KerberosIdentityDataFileReader.COMPONENT));
      Assert.assertEquals("principal" + i,record.get(KerberosIdentityDataFileReader.PRINCIPAL));
      Assert.assertEquals("principal_type" + i,record.get(KerberosIdentityDataFileReader.PRINCIPAL_TYPE));
      Assert.assertEquals("keytabFilePath" + i,record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_PATH));
      Assert.assertEquals("keytabFileOwnerName" + i,record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_OWNER_NAME));
      Assert.assertEquals("keytabFileOwnerAccess" + i,record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_OWNER_ACCESS));
      Assert.assertEquals("keytabFileGroupName" + i,record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_GROUP_NAME));
      Assert.assertEquals("keytabFileGroupAccess" + i,record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_GROUP_ACCESS));
    }
 else {
      Assert.assertEquals("hostName's",record.get(KerberosIdentityDataFileReader.HOSTNAME));
      Assert.assertEquals("serviceName#",record.get(KerberosIdentityDataFileReader.SERVICE));
      Assert.assertEquals("serviceComponentName\"",record.get(KerberosIdentityDataFileReader.COMPONENT));
      Assert.assertEquals("principal",record.get(KerberosIdentityDataFileReader.PRINCIPAL));
      Assert.assertEquals("principal_type",record.get(KerberosIdentityDataFileReader.PRINCIPAL_TYPE));
      Assert.assertEquals("keytabFilePath",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_PATH));
      Assert.assertEquals("'keytabFileOwnerName'",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_OWNER_NAME));
      Assert.assertEquals("<keytabFileOwnerAccess>",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_OWNER_ACCESS));
      Assert.assertEquals("\"keytabFileGroupName\"",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_GROUP_NAME));
      Assert.assertEquals("keytab,File,Group,Access",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_GROUP_ACCESS));
    }
    i++;
  }
  reader.close();
  Assert.assertTrue(reader.isClosed());
  writer.open();
  Assert.assertFalse(writer.isClosed());
  writer.writeRecord("hostName","serviceName","serviceComponentName","principal","principal_type","keytabFilePath","keytabFileOwnerName","keytabFileOwnerAccess","keytabFileGroupName","keytabFileGroupAccess","true");
  writer.close();
  Assert.assertTrue(writer.isClosed());
  reader=kerberosIdentityDataFileReaderFactory.createKerberosIdentityDataFileReader(file);
  Assert.assertFalse(reader.isClosed());
  i=0;
  for (  Map<String,String> record : reader) {
    i++;
  }
  Assert.assertEquals(12,i);
  reader.close();
  Assert.assertTrue(reader.isClosed());
  writer=kerberosIdentityDataFileWriterFactory.createKerberosIdentityDataFileWriter(file);
  Assert.assertFalse(writer.isClosed());
  writer.writeRecord("hostName","serviceName","serviceComponentName","principal","principal_type","keytabFilePath","keytabFileOwnerName","keytabFileOwnerAccess","keytabFileGroupName","keytabFileGroupAccess","true");
  writer.close();
  Assert.assertTrue(writer.isClosed());
  reader.open();
  Assert.assertFalse(reader.isClosed());
  i=0;
  for (  Map<String,String> record : reader) {
    i++;
  }
  Assert.assertEquals(13,i);
  reader.close();
  Assert.assertTrue(reader.isClosed());
  i=0;
  for (  Map<String,String> record : reader) {
    i++;
  }
  Assert.assertEquals(0,i);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.serveraction.kerberos.KerberosOperationHandlerTest </h4><pre class="type-4 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateKeytabFileFromBase64EncodedData() throws Exception {
  KerberosOperationHandler handler=createHandler();
  File file=folder.newFile();
  final String principal="principal@REALM.COM";
  Assert.assertTrue(handler.createKeytabFile(principal,"some password",0,file));
  FileInputStream fis=new FileInputStream(file);
  byte[] data=new byte[(int)file.length()];
  Assert.assertEquals(data.length,fis.read(data));
  fis.close();
  File f=handler.createKeytabFile(Base64.encodeBase64String(data));
  if (f != null) {
    try {
      Keytab keytab=Keytab.read(f);
      Assert.assertNotNull(keytab);
      List<KeytabEntry> entries=keytab.getEntries();
      Assert.assertNotNull(entries);
      Assert.assertFalse(entries.isEmpty());
      for (      KeytabEntry entry : entries) {
        Assert.assertEquals(principal,entry.getPrincipalName());
      }
    }
  finally {
      if (!f.delete()) {
        f.deleteOnExit();
      }
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.serveraction.upgrades.UpgradeActionTest </h4><pre class="type-13 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFinalizeDowngrade() throws Exception {
  StackId sourceStack=HDP_21_STACK;
  StackId targetStack=HDP_21_STACK;
  String sourceRepo=HDP_2_1_1_0;
  String targetRepo=HDP_2_1_1_1;
  makeDowngradeCluster(sourceStack,sourceRepo,targetStack,targetRepo);
  Map<String,String> commandParams=new HashMap<String,String>();
  commandParams.put(FinalizeUpgradeAction.UPGRADE_DIRECTION_KEY,"downgrade");
  commandParams.put(FinalizeUpgradeAction.VERSION_KEY,sourceRepo);
  commandParams.put(FinalizeUpgradeAction.ORIGINAL_STACK_KEY,sourceStack.getStackId());
  commandParams.put(FinalizeUpgradeAction.TARGET_STACK_KEY,targetStack.getStackId());
  ExecutionCommand executionCommand=new ExecutionCommand();
  executionCommand.setCommandParams(commandParams);
  executionCommand.setClusterName(clusterName);
  HostRoleCommand hostRoleCommand=hostRoleCommandFactory.create(null,null,null,null);
  hostRoleCommand.setExecutionCommandWrapper(new ExecutionCommandWrapper(executionCommand));
  FinalizeUpgradeAction action=m_injector.getInstance(FinalizeUpgradeAction.class);
  action.setExecutionCommand(executionCommand);
  action.setHostRoleCommand(hostRoleCommand);
  CommandReport report=action.execute(null);
  assertNotNull(report);
  assertEquals(HostRoleStatus.COMPLETED.name(),report.getStatus());
  for (  HostVersionEntity entity : hostVersionDAO.findByClusterAndHost(clusterName,"h1")) {
    if (entity.getRepositoryVersion().getVersion().equals(sourceRepo)) {
      assertEquals(RepositoryVersionState.CURRENT,entity.getState());
    }
 else     if (entity.getRepositoryVersion().getVersion().equals(targetRepo)) {
      assertEquals(RepositoryVersionState.INSTALLED,entity.getState());
    }
  }
  for (  ClusterVersionEntity entity : clusterVersionDAO.findByCluster(clusterName)) {
    if (entity.getRepositoryVersion().getVersion().equals(sourceRepo)) {
      assertEquals(RepositoryVersionState.CURRENT,entity.getState());
    }
 else     if (entity.getRepositoryVersion().getVersion().equals(targetRepo)) {
      assertEquals(RepositoryVersionState.INSTALLED,entity.getState());
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.stack.QuickLinksConfigurationModuleTest </h4><pre class="type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testResolveOverride() throws Exception {
  QuickLinks[] results=resolveQuickLinks("parent_quicklinks.json","child_quicklinks_to_override.json");
  QuickLinks parentQuickLinks=results[0];
  QuickLinks childQuickLinks=results[1];
  QuickLinksConfiguration childQuickLinksConfig=childQuickLinks.getQuickLinksConfiguration();
  assertNotNull(childQuickLinksConfig);
  List<Link> links=childQuickLinksConfig.getLinks();
  assertNotNull(links);
  assertEquals(7,links.size());
  assertEquals(4,parentQuickLinks.getQuickLinksConfiguration().getLinks().size());
  boolean hasLink=false;
  for (  Link link : links) {
    String name=link.getName();
    if ("thread_stacks".equals(name)) {
      hasLink=true;
      Port port=link.getPort();
      assertEquals("mapred-site",port.getSite());
    }
  }
  assertTrue(hasLink);
  Protocol protocol=childQuickLinksConfig.getProtocol();
  assertNotNull(protocol);
  assertEquals("http",protocol.getType());
  assertEquals(3,protocol.getChecks().size());
  List<Check> checks=protocol.getChecks();
  for (  Check check : checks) {
    assertEquals("mapred-site",check.getSite());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.stack.StackManagerCommonServicesTest </h4><pre class="type-4 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetStack(){
  StackInfo stack=stackManager.getStack("HDP","0.1");
  assertNotNull(stack);
  assertEquals("HDP",stack.getName());
  assertEquals("0.1",stack.getVersion());
  Collection<ServiceInfo> services=stack.getServices();
  assertEquals(3,services.size());
  Map<String,ServiceInfo> serviceMap=new HashMap<String,ServiceInfo>();
  for (  ServiceInfo service : services) {
    serviceMap.put(service.getName(),service);
  }
  ServiceInfo hdfsService=serviceMap.get("HDFS");
  assertNotNull(hdfsService);
  List<ComponentInfo> components=hdfsService.getComponents();
  assertEquals(6,components.size());
  List<PropertyInfo> properties=hdfsService.getProperties();
  assertEquals(62,properties.size());
  boolean hdfsPropFound=false;
  boolean hbasePropFound=false;
  for (  PropertyInfo p : properties) {
    if (p.getName().equals("hbase.regionserver.msginterval")) {
      assertEquals("hbase-site.xml",p.getFilename());
      hbasePropFound=true;
    }
 else     if (p.getName().equals("dfs.name.dir")) {
      assertEquals("hdfs-site.xml",p.getFilename());
      hdfsPropFound=true;
    }
  }
  assertTrue(hbasePropFound);
  assertTrue(hdfsPropFound);
  ServiceInfo mrService=serviceMap.get("MAPREDUCE");
  assertNotNull(mrService);
  components=mrService.getComponents();
  assertEquals(3,components.size());
  ServiceInfo pigService=serviceMap.get("PIG");
  assertNotNull(pigService);
  assertEquals("PIG",pigService.getName());
  assertEquals("1.0",pigService.getVersion());
  assertEquals("This is comment for PIG service",pigService.getComment());
  components=pigService.getComponents();
  assertEquals(1,components.size());
  CommandScriptDefinition commandScript=pigService.getCommandScript();
  assertEquals("scripts/service_check.py",commandScript.getScript());
  assertEquals(CommandScriptDefinition.Type.PYTHON,commandScript.getScriptType());
  assertEquals(300,commandScript.getTimeout());
  List<String> configDependencies=pigService.getConfigDependencies();
  assertEquals(1,configDependencies.size());
  assertEquals("global",configDependencies.get(0));
  assertEquals("global",pigService.getConfigDependenciesWithComponents().get(0));
  ComponentInfo client=pigService.getClientComponent();
  assertNotNull(client);
  assertEquals("PIG",client.getName());
  assertEquals("0+",client.getCardinality());
  assertEquals("CLIENT",client.getCategory());
  assertEquals("configuration",pigService.getConfigDir());
  assertEquals("2.0",pigService.getSchemaVersion());
  Map<String,ServiceOsSpecific> osInfoMap=pigService.getOsSpecifics();
  assertEquals(1,osInfoMap.size());
  ServiceOsSpecific osSpecific=osInfoMap.get("centos6");
  assertNotNull(osSpecific);
  assertEquals("centos6",osSpecific.getOsFamily());
  assertNull(osSpecific.getRepo());
  List<ServiceOsSpecific.Package> packages=osSpecific.getPackages();
  assertEquals(2,packages.size());
  ServiceOsSpecific.Package pkg=packages.get(0);
  assertEquals("pig",pkg.getName());
  assertFalse(pkg.getSkipUpgrade());
  ServiceOsSpecific.Package lzoPackage=packages.get(1);
  assertEquals("lzo",lzoPackage.getName());
  assertTrue(lzoPackage.getSkipUpgrade());
  assertEquals(pigService.getParent(),"common-services/PIG/1.0");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.stack.StackManagerTest </h4><pre class="type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMonitoringServicePropertyInheritance() throws Exception {
  StackInfo stack=stackManager.getStack("HDP","2.0.8");
  Collection<ServiceInfo> allServices=stack.getServices();
  assertEquals(13,allServices.size());
  boolean monitoringServiceFound=false;
  for (  ServiceInfo serviceInfo : allServices) {
    if (serviceInfo.getName().equals("FAKENAGIOS")) {
      monitoringServiceFound=true;
      assertTrue(serviceInfo.isMonitoringService());
    }
 else {
      assertNull(serviceInfo.isMonitoringService());
    }
  }
  assertTrue(monitoringServiceFound);
}

</code></pre>

<br>
<pre class="type-4 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetStack(){
  StackInfo stack=stackManager.getStack("HDP","0.1");
  assertNotNull(stack);
  assertEquals("HDP",stack.getName());
  assertEquals("0.1",stack.getVersion());
  Collection<ServiceInfo> services=stack.getServices();
  assertEquals(3,services.size());
  Map<String,ServiceInfo> serviceMap=new HashMap<String,ServiceInfo>();
  for (  ServiceInfo service : services) {
    serviceMap.put(service.getName(),service);
  }
  ServiceInfo hdfsService=serviceMap.get("HDFS");
  assertNotNull(hdfsService);
  List<ComponentInfo> components=hdfsService.getComponents();
  assertEquals(6,components.size());
  List<PropertyInfo> properties=hdfsService.getProperties();
  assertEquals(62,properties.size());
  boolean hdfsPropFound=false;
  boolean hbasePropFound=false;
  for (  PropertyInfo p : properties) {
    if (p.getName().equals("hbase.regionserver.msginterval")) {
      assertEquals("hbase-site.xml",p.getFilename());
      hbasePropFound=true;
    }
 else     if (p.getName().equals("dfs.name.dir")) {
      assertEquals("hdfs-site.xml",p.getFilename());
      hdfsPropFound=true;
    }
  }
  assertTrue(hbasePropFound);
  assertTrue(hdfsPropFound);
  ServiceInfo mrService=serviceMap.get("MAPREDUCE");
  assertNotNull(mrService);
  components=mrService.getComponents();
  assertEquals(3,components.size());
  ServiceInfo pigService=serviceMap.get("PIG");
  assertNotNull(pigService);
  assertEquals("PIG",pigService.getName());
  assertEquals("1.0",pigService.getVersion());
  assertEquals("This is comment for PIG service",pigService.getComment());
  components=pigService.getComponents();
  assertEquals(1,components.size());
  CommandScriptDefinition commandScript=pigService.getCommandScript();
  assertEquals("scripts/service_check.py",commandScript.getScript());
  assertEquals(CommandScriptDefinition.Type.PYTHON,commandScript.getScriptType());
  assertEquals(300,commandScript.getTimeout());
  List<String> configDependencies=pigService.getConfigDependencies();
  assertEquals(1,configDependencies.size());
  assertEquals("global",configDependencies.get(0));
  assertEquals("global",pigService.getConfigDependenciesWithComponents().get(0));
  ComponentInfo client=pigService.getClientComponent();
  assertNotNull(client);
  assertEquals("PIG",client.getName());
  assertEquals("0+",client.getCardinality());
  assertEquals("CLIENT",client.getCategory());
  assertEquals("configuration",pigService.getConfigDir());
  assertEquals("2.0",pigService.getSchemaVersion());
  Map<String,ServiceOsSpecific> osInfoMap=pigService.getOsSpecifics();
  assertEquals(1,osInfoMap.size());
  ServiceOsSpecific osSpecific=osInfoMap.get("centos6");
  assertNotNull(osSpecific);
  assertEquals("centos6",osSpecific.getOsFamily());
  assertNull(osSpecific.getRepo());
  List<ServiceOsSpecific.Package> packages=osSpecific.getPackages();
  assertEquals(1,packages.size());
  ServiceOsSpecific.Package pkg=packages.get(0);
  assertEquals("pig",pkg.getName());
  assertNull(pigService.getParent());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.state.ConfigMergeHelperTest </h4><pre class="type-4 type-13 type-10 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetConflicts() throws Exception {
  Cluster clusterMock=createNiceMock(Cluster.class);
  expect(clustersMock.getCluster(anyString())).andReturn(clusterMock);
  expect(clusterMock.getCurrentStackVersion()).andReturn(currentStackId);
  expect(clusterMock.getServices()).andReturn(new HashMap<String,Service>(){
{
      put("HDFS",createNiceMock(Service.class));
      put("ZK",createNiceMock(Service.class));
    }
  }
);
  Set<PropertyInfo> currentHDFSProperties=new HashSet<PropertyInfo>(){
{
      add(createPropertyInfo("hdfs-env.xml","equal.key","equal-value"));
    }
  }
;
  Set<PropertyInfo> currentZKProperties=new HashSet<PropertyInfo>(){
{
      add(createPropertyInfo("zk-env.xml","different.key","different-value-1"));
    }
  }
;
  Set<PropertyInfo> currentStackProperties=new HashSet<PropertyInfo>(){
{
      add(createPropertyInfo("hadoop-env.xml","equal.key","modified.value"));
    }
  }
;
  expect(ambariMetaInfoMock.getServiceProperties(currentStackId.getStackName(),currentStackId.getStackVersion(),"HDFS")).andReturn(currentHDFSProperties);
  expect(ambariMetaInfoMock.getServiceProperties(currentStackId.getStackName(),currentStackId.getStackVersion(),"ZK")).andReturn(currentZKProperties);
  expect(ambariMetaInfoMock.getStackProperties(currentStackId.getStackName(),currentStackId.getStackVersion())).andReturn(currentStackProperties);
  Set<PropertyInfo> newHDFSProperties=new HashSet<PropertyInfo>(){
{
      add(createPropertyInfo("hdfs-env.xml","equal.key","equal-value"));
      add(createPropertyInfo("new-hdfs-config.xml","equal.key","equal-value"));
    }
  }
;
  Set<PropertyInfo> newZKProperties=new HashSet<PropertyInfo>(){
{
      add(createPropertyInfo("zk-env.xml","equal.key","different-value-2"));
      add(createPropertyInfo("zk-env.xml","new.key","new-value-2"));
    }
  }
;
  Set<PropertyInfo> newStackProperties=new HashSet<PropertyInfo>(){
{
      add(createPropertyInfo("hadoop-env.xml","equal.key","another.value"));
    }
  }
;
  expect(ambariMetaInfoMock.getServiceProperties(newStackId.getStackName(),newStackId.getStackVersion(),"HDFS")).andReturn(newHDFSProperties);
  expect(ambariMetaInfoMock.getServiceProperties(newStackId.getStackName(),newStackId.getStackVersion(),"ZK")).andReturn(newZKProperties);
  expect(ambariMetaInfoMock.getStackProperties(newStackId.getStackName(),newStackId.getStackVersion())).andReturn(newStackProperties);
  Map<String,String> desiredHdfsEnvProperties=new HashMap<String,String>(){
{
    }
  }
;
  expect(clusterMock.getDesiredConfigByType("hdfs-env.xml")).andReturn(createConfigMock(desiredHdfsEnvProperties));
  Map<String,String> desiredZkEnvProperties=new HashMap<String,String>(){
{
    }
  }
;
  expect(clusterMock.getDesiredConfigByType("hdfs-env.xml")).andReturn(createConfigMock(desiredZkEnvProperties));
  Map<String,String> desiredHadoopEnvProperties=new HashMap<String,String>(){
{
    }
  }
;
  expect(clusterMock.getDesiredConfigByType("hadoop-env.xml")).andReturn(createConfigMock(desiredHadoopEnvProperties));
  replay(clusterMock,clustersMock,ambariMetaInfoMock);
  ConfigMergeHelper configMergeHelper=injector.getInstance(ConfigMergeHelper.class);
  Map<String,Map<String,ThreeWayValue>> conflicts=configMergeHelper.getConflicts("clustername",newStackId);
  assertNotNull(conflicts);
  assertEquals(2,conflicts.size());
  for (  String key : conflicts.keySet()) {
    if (key.equals("hdfs-env")) {
      Map<String,ThreeWayValue> stringThreeWayValueMap=conflicts.get(key);
      assertEquals(1,stringThreeWayValueMap.size());
      assertEquals("equal-value",stringThreeWayValueMap.get("equal.key").oldStackValue);
      assertEquals("equal-value",stringThreeWayValueMap.get("equal.key").newStackValue);
      assertEquals("",stringThreeWayValueMap.get("equal.key").savedValue);
    }
 else     if (key.equals("hadoop-env")) {
      Map<String,ThreeWayValue> stringThreeWayValueMap=conflicts.get(key);
      assertEquals(1,stringThreeWayValueMap.size());
      assertEquals("modified.value",stringThreeWayValueMap.get("equal.key").oldStackValue);
      assertEquals("another.value",stringThreeWayValueMap.get("equal.key").newStackValue);
      assertEquals("",stringThreeWayValueMap.get("equal.key").savedValue);
    }
 else {
      fail("Unexpected key");
    }
  }
  assertEquals(2,conflicts.size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.state.ServiceComponentTest </h4><pre class="type-13 type-2 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testCanBeRemoved() throws Exception {
  String componentName="NAMENODE";
  ServiceComponent component=serviceComponentFactory.createNew(service,componentName);
  for (  State state : State.values()) {
    component.setDesiredState(state);
    if (state.isRemovableState()) {
      org.junit.Assert.assertTrue(component.canBeRemoved());
    }
 else {
      org.junit.Assert.assertFalse(component.canBeRemoved());
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.state.UpgradeHelperTest </h4><pre class="type-4 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that multiple execute tasks with an annotation of synchronized="true" each run in their own stage.
 */
@Test public void testUpgradeWithMultipleTasksInOwnStage() throws Exception {
  Map<String,UpgradePack> upgrades=ambariMetaInfo.getUpgradePacks("HDP","2.1.1");
  assertTrue(upgrades.containsKey("upgrade_test"));
  UpgradePack upgrade=upgrades.get("upgrade_test");
  assertNotNull(upgrade);
  assertTrue(upgrade.getType() == UpgradeType.ROLLING);
  List<Grouping> upgradePackGroups=upgrade.getGroups(Direction.UPGRADE);
  boolean foundService=false;
  for (  Grouping group : upgradePackGroups) {
    if (group.title.equals("Oozie")) {
      foundService=true;
    }
  }
  assertTrue(foundService);
  makeCluster();
  UpgradeContext context=new UpgradeContext(m_masterHostResolver,HDP_21,HDP_21,UPGRADE_VERSION,Direction.UPGRADE,UpgradeType.ROLLING);
  List<UpgradeGroupHolder> groups=m_upgradeHelper.createSequence(upgrade,context);
  int numPrepareStages=0;
  for (  UpgradeGroupHolder group : groups) {
    if (group.name.equals("OOZIE")) {
      assertTrue(group.items.size() > 0);
      for (      StageWrapper sw : group.items) {
        if (sw.getText().equalsIgnoreCase("Preparing Oozie Server on h2 (Batch 1 of 2)") || sw.getText().equalsIgnoreCase("Preparing Oozie Server on h3 (Batch 2 of 2)")) {
          numPrepareStages++;
          List<TaskWrapper> taskWrappers=sw.getTasks();
          assertEquals(1,taskWrappers.size());
          List<Task> tasks=taskWrappers.get(0).getTasks();
          assertEquals(1,taskWrappers.get(0).getHosts().size());
          assertEquals(1,tasks.size());
          ExecuteTask task=(ExecuteTask)tasks.get(0);
          assertTrue("scripts/oozie_server.py".equalsIgnoreCase(task.script));
          assertTrue("stop".equalsIgnoreCase(task.function));
        }
        if (sw.getText().equalsIgnoreCase("Preparing Oozie Server on h2")) {
          numPrepareStages++;
          List<TaskWrapper> taskWrappers=sw.getTasks();
          assertEquals(1,taskWrappers.size());
          List<Task> tasks=taskWrappers.get(0).getTasks();
          assertEquals(1,taskWrappers.get(0).getHosts().size());
          assertEquals(1,tasks.size());
          ExecuteTask task=(ExecuteTask)tasks.get(0);
          assertTrue("scripts/oozie_server_upgrade.py".equalsIgnoreCase(task.script));
          assertTrue("upgrade_oozie_database_and_sharelib".equalsIgnoreCase(task.function));
        }
      }
    }
  }
  assertEquals(3,numPrepareStages);
}

</code></pre>

<br>
<pre class="type-4 type-13 type-2 type-5 type-1 type-11 type-17 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values related to public fields.">PublicFieldVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Verifies values related to public fields.
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testServiceCheckUpgradeStages() throws Exception {
  Map<String,UpgradePack> upgrades=ambariMetaInfo.getUpgradePacks("HDP","2.2.0");
  assertTrue(upgrades.containsKey("upgrade_test_checks"));
  UpgradePack upgrade=upgrades.get("upgrade_test_checks");
  assertNotNull(upgrade);
  Cluster c=makeCluster();
  Set<String> additionalServices=new HashSet<String>(){
{
      add("HBASE");
      add("PIG");
      add("TEZ");
      add("AMBARI_METRICS");
    }
  }
;
  for (  String service : additionalServices) {
    c.addService(service);
  }
  int numServiceChecksExpected=0;
  Collection<Service> services=c.getServices().values();
  for (  Service service : services) {
    ServiceInfo si=ambariMetaInfo.getService(c.getCurrentStackVersion().getStackName(),c.getCurrentStackVersion().getStackVersion(),service.getName());
    if (null == si.getCommandScript()) {
      continue;
    }
    if (service.getName().equalsIgnoreCase("TEZ")) {
      assertTrue("Expect Tez to not have any service checks",false);
    }
    if (service.getName().equalsIgnoreCase("AMBARI_METRICS")) {
      continue;
    }
    numServiceChecksExpected++;
  }
  UpgradeContext context=new UpgradeContext(m_masterHostResolver,HDP_21,HDP_22,UPGRADE_VERSION,Direction.UPGRADE,UpgradeType.ROLLING);
  List<UpgradeGroupHolder> groups=m_upgradeHelper.createSequence(upgrade,context);
  assertEquals(7,groups.size());
  UpgradeGroupHolder holder=groups.get(3);
  assertEquals(holder.name,"SERVICE_CHECK_1");
  assertEquals(7,holder.items.size());
  int numServiceChecksActual=0;
  for (  StageWrapper sw : holder.items) {
    for (    Service service : services) {
      Pattern p=Pattern.compile(".*" + service.getName(),Pattern.CASE_INSENSITIVE);
      Matcher matcher=p.matcher(sw.getText());
      if (matcher.matches()) {
        numServiceChecksActual++;
        continue;
      }
    }
  }
  assertEquals(numServiceChecksActual,numServiceChecksExpected);
  UpgradeGroupHolder zookeeperGroup=groups.get(1);
  assertEquals("ZOOKEEPER",zookeeperGroup.name);
  ManualTask manualTask=(ManualTask)zookeeperGroup.items.get(0).getTasks().get(0).getTasks().get(0);
  assertEquals("This is a manual task with a placeholder of placeholder-rendered-properly",manualTask.message);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.state.cluster.ClusterDeadlockTest </h4><pre class="type-13 type-2 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * Tests that while serializing a service component, writes to that service
 * component do not cause a deadlock with the global cluster lock.
 * @throws Exception
 */
@Test() public void testAddingHostComponentsWhileReading() throws Exception {
  Service service=cluster.getService("HDFS");
  ServiceComponent nameNodeComponent=service.getServiceComponent("NAMENODE");
  ServiceComponent dataNodeComponent=service.getServiceComponent("DATANODE");
  List<Thread> threads=new ArrayList<Thread>();
  for (int i=0; i < 5; i++) {
    ServiceComponentReaderWriterThread thread=new ServiceComponentReaderWriterThread();
    thread.setDataNodeComponent(dataNodeComponent);
    thread.setNameNodeComponent(nameNodeComponent);
    thread.start();
    threads.add(thread);
  }
  DeadlockWarningThread wt=new DeadlockWarningThread(threads);
  while (true) {
    if (!wt.isAlive()) {
      break;
    }
  }
  if (wt.isDeadlocked()) {
    Assert.assertFalse(wt.getErrorMessages().toString(),wt.isDeadlocked());
  }
 else {
    Assert.assertFalse(wt.isDeadlocked());
  }
}

</code></pre>

<br>
<pre class="type-13 type-2 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * Tests that concurrent impl serialization and impl writing doesn't cause a
 * deadlock.
 * @throws Exception
 */
@Test() public void testDeadlockBetweenImplementations() throws Exception {
  Service service=cluster.getService("HDFS");
  ServiceComponent nameNodeComponent=service.getServiceComponent("NAMENODE");
  ServiceComponent dataNodeComponent=service.getServiceComponent("DATANODE");
  ServiceComponentHost nameNodeSCH=createNewServiceComponentHost("HDFS","NAMENODE","c64-0");
  ServiceComponentHost dataNodeSCH=createNewServiceComponentHost("HDFS","DATANODE","c64-0");
  List<Thread> threads=new ArrayList<Thread>();
  for (int i=0; i < NUMBER_OF_THREADS; i++) {
    DeadlockExerciserThread thread=new DeadlockExerciserThread();
    thread.setCluster(cluster);
    thread.setService(service);
    thread.setDataNodeComponent(dataNodeComponent);
    thread.setNameNodeComponent(nameNodeComponent);
    thread.setNameNodeSCH(nameNodeSCH);
    thread.setDataNodeSCH(dataNodeSCH);
    thread.start();
    threads.add(thread);
  }
  DeadlockWarningThread wt=new DeadlockWarningThread(threads);
  while (true) {
    if (!wt.isAlive()) {
      break;
    }
  }
  if (wt.isDeadlocked()) {
    Assert.assertFalse(wt.getErrorMessages().toString(),wt.isDeadlocked());
  }
 else {
    Assert.assertFalse(wt.isDeadlocked());
  }
}

</code></pre>

<br>
<pre class="type-13 type-2 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * Tests that no deadlock exists while restarting components and reading from
 * the cluster.
 * @throws Exception
 */
@Test() public void testDeadlockWhileRestartingComponents() throws Exception {
  List<ServiceComponentHost> serviceComponentHosts=new ArrayList<ServiceComponentHost>();
  for (  String hostName : hostNames) {
    serviceComponentHosts.add(createNewServiceComponentHost("HDFS","NAMENODE",hostName));
    serviceComponentHosts.add(createNewServiceComponentHost("HDFS","DATANODE",hostName));
  }
  ((ClusterImpl)cluster).loadServiceHostComponents();
  List<Thread> threads=new ArrayList<Thread>();
  for (int i=0; i < NUMBER_OF_THREADS; i++) {
    ClusterReaderThread clusterReaderThread=new ClusterReaderThread();
    ClusterWriterThread clusterWriterThread=new ClusterWriterThread();
    ServiceComponentRestartThread schWriterThread=new ServiceComponentRestartThread(serviceComponentHosts);
    threads.add(clusterReaderThread);
    threads.add(clusterWriterThread);
    threads.add(schWriterThread);
    clusterReaderThread.start();
    clusterWriterThread.start();
    schWriterThread.start();
  }
  DeadlockWarningThread wt=new DeadlockWarningThread(threads);
  while (true) {
    if (!wt.isAlive()) {
      break;
    }
  }
  if (wt.isDeadlocked()) {
    Assert.assertFalse(wt.getErrorMessages().toString(),wt.isDeadlocked());
  }
 else {
    Assert.assertFalse(wt.isDeadlocked());
  }
}

</code></pre>

<br>
<pre class="type-13 type-2 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDeadlockWithConfigsUpdate() throws Exception {
  List<Thread> threads=new ArrayList<Thread>();
  for (int i=0; i < NUMBER_OF_THREADS; i++) {
    ClusterDesiredConfigsReaderThread readerThread=null;
    for (int j=0; j < NUMBER_OF_THREADS; j++) {
      readerThread=new ClusterDesiredConfigsReaderThread();
      threads.add(readerThread);
    }
    for (    Config config : cluster.getAllConfigs()) {
      ConfigUpdaterThread configUpdaterThread=new ConfigUpdaterThread(config);
      threads.add(configUpdaterThread);
    }
  }
  for (  Thread thread : threads) {
    thread.start();
  }
  DeadlockWarningThread wt=new DeadlockWarningThread(threads);
  while (true) {
    if (!wt.isAlive()) {
      break;
    }
  }
  if (wt.isDeadlocked()) {
    Assert.assertFalse(wt.getErrorMessages().toString(),wt.isDeadlocked());
  }
 else {
    Assert.assertFalse(wt.isDeadlocked());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.state.cluster.ClusterTest </h4><pre class="type-13 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDeleteServiceWithConfigHistory() throws Exception {
  createDefaultCluster();
  c1.addService("HDFS").persist();
  Config config1=configFactory.createNew(c1,"hdfs-site",new HashMap<String,String>(){
{
      put("a","b");
    }
  }
,new HashMap<String,Map<String,String>>());
  config1.setTag("version1");
  Config config2=configFactory.createNew(c1,"core-site",new HashMap<String,String>(){
{
      put("x","y");
    }
  }
,new HashMap<String,Map<String,String>>());
  config2.setTag("version2");
  config1.persist();
  c1.addConfig(config1);
  config2.persist();
  c1.addConfig(config2);
  Set<Config> configs=new HashSet<Config>();
  configs.add(config1);
  configs.add(config2);
  c1.addDesiredConfig("admin",configs);
  List<ServiceConfigVersionResponse> serviceConfigVersions=c1.getServiceConfigVersions();
  Assert.assertNotNull(serviceConfigVersions);
  Assert.assertEquals(1,serviceConfigVersions.size());
  Assert.assertEquals(Long.valueOf(1),serviceConfigVersions.get(0).getVersion());
  Assert.assertEquals(2,c1.getDesiredConfigs().size());
  Assert.assertEquals("version1",c1.getDesiredConfigByType("hdfs-site").getTag());
  Assert.assertEquals("version2",c1.getDesiredConfigByType("core-site").getTag());
  Map<String,Collection<ServiceConfigVersionResponse>> activeServiceConfigVersions=c1.getActiveServiceConfigVersions();
  Assert.assertEquals(1,activeServiceConfigVersions.size());
  c1.deleteService("HDFS");
  Assert.assertEquals(0,c1.getServices().size());
  Assert.assertEquals(0,c1.getServiceConfigVersions().size());
  EntityManager em=injector.getProvider(EntityManager.class).get();
  Assert.assertEquals(0,em.createQuery("SELECT serviceConfig from ServiceConfigEntity serviceConfig").getResultList().size());
  Assert.assertEquals(2,em.createQuery("SELECT config from ClusterConfigEntity config").getResultList().size());
  List<ClusterConfigMappingEntity> configMappingEntities=em.createQuery("SELECT configmapping from ClusterConfigMappingEntity configmapping",ClusterConfigMappingEntity.class).getResultList();
  Assert.assertEquals(2,configMappingEntities.size());
  for (  ClusterConfigMappingEntity configMappingEntity : configMappingEntities) {
    if (StringUtils.equals(configMappingEntity.getType(),"core-site")) {
      assertEquals("core-site is not part of HDFS in test stack, should remain mapped to cluster",1,configMappingEntity.isSelected());
    }
    if (StringUtils.equals(configMappingEntity.getType(),"hdfs-site")) {
      assertEquals("hdfs-site should be unmapped from cluster when HDFS service is removed",0,configMappingEntity.isSelected());
    }
  }
  Assert.assertEquals(0,em.createNativeQuery("SELECT * from serviceconfigmapping").getResultList().size());
}

</code></pre>

<br>
<pre class="type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that hosts can be correctly transitioned into the "INSTALLING" state.
 * This method also tests that hosts in MM will not be transitioned, as per
 * the contract of{@link Cluster#transitionHostsToInstalling(ClusterVersionEntity)}.
 * @throws Exception
 */
@Test public void testTransitionHostVersions() throws Exception {
  createDefaultCluster();
  StackId stackId=new StackId("HDP","0.2");
  helper.getOrCreateRepositoryVersion(stackId,stackId.getStackVersion());
  c1.createClusterVersion(stackId,"0.2","admin",RepositoryVersionState.INSTALLING);
  ClusterVersionEntity entityHDP2=null;
  for (  ClusterVersionEntity entity : c1.getAllClusterVersions()) {
    StackEntity repoVersionStackEntity=entity.getRepositoryVersion().getStack();
    StackId repoVersionStackId=new StackId(repoVersionStackEntity);
    if (repoVersionStackId.getStackName().equals("HDP") && repoVersionStackId.getStackVersion().equals("0.2")) {
      entityHDP2=entity;
      break;
    }
  }
  assertNotNull(entityHDP2);
  List<HostVersionEntity> hostVersionsH1Before=hostVersionDAO.findByClusterAndHost("c1","h1");
  assertEquals(1,hostVersionsH1Before.size());
  c1.transitionHostsToInstalling(entityHDP2);
  List<HostVersionEntity> hostVersionsH1After=hostVersionDAO.findByClusterAndHost("c1","h1");
  assertEquals(2,hostVersionsH1After.size());
  boolean checked=false;
  for (  HostVersionEntity entity : hostVersionsH1After) {
    StackEntity repoVersionStackEntity=entity.getRepositoryVersion().getStack();
    if (repoVersionStackEntity.getStackName().equals("HDP") && repoVersionStackEntity.getStackVersion().equals("0.2")) {
      assertEquals(RepositoryVersionState.INSTALLING,entity.getState());
      checked=true;
      break;
    }
  }
  assertTrue(checked);
  c1.transitionHostsToInstalling(entityHDP2);
  hostVersionsH1After=hostVersionDAO.findByClusterAndHost("c1","h1");
  assertEquals(2,hostVersionsH1After.size());
  checked=false;
  for (  HostVersionEntity entity : hostVersionsH1After) {
    StackEntity repoVersionStackEntity=entity.getRepositoryVersion().getStack();
    if (repoVersionStackEntity.getStackName().equals("HDP") && repoVersionStackEntity.getStackVersion().equals("0.2")) {
      assertEquals(RepositoryVersionState.INSTALLING,entity.getState());
      checked=true;
      break;
    }
  }
  assertTrue(checked);
  List<HostVersionEntity> hostVersionEntities=hostVersionDAO.findAll();
  for (  HostVersionEntity hostVersionEntity : hostVersionEntities) {
    hostVersionEntity.setState(RepositoryVersionState.INSTALL_FAILED);
    hostVersionDAO.merge(hostVersionEntity);
  }
  hostVersionEntities=hostVersionDAO.findAll();
  for (  HostVersionEntity hostVersionEntity : hostVersionEntities) {
    assertEquals(RepositoryVersionState.INSTALL_FAILED,hostVersionEntity.getState());
  }
  Collection<Host> hosts=c1.getHosts();
  Iterator<Host> iterator=hosts.iterator();
  Host hostInMaintenanceMode=iterator.next();
  Host hostNotInMaintenanceMode=iterator.next();
  hostInMaintenanceMode.setMaintenanceState(c1.getClusterId(),MaintenanceState.ON);
  c1.transitionHostsToInstalling(entityHDP2);
  List<HostVersionEntity> hostInMaintModeVersions=hostVersionDAO.findByClusterAndHost("c1",hostInMaintenanceMode.getHostName());
  List<HostVersionEntity> otherHostVersions=hostVersionDAO.findByClusterAndHost("c1",hostNotInMaintenanceMode.getHostName());
  for (  HostVersionEntity hostVersionEntity : hostInMaintModeVersions) {
    StackEntity repoVersionStackEntity=hostVersionEntity.getRepositoryVersion().getStack();
    if (repoVersionStackEntity.getStackName().equals("HDP") && repoVersionStackEntity.getStackVersion().equals("0.2")) {
      assertEquals(RepositoryVersionState.OUT_OF_SYNC,hostVersionEntity.getState());
    }
  }
  for (  HostVersionEntity hostVersionEntity : otherHostVersions) {
    StackEntity repoVersionStackEntity=hostVersionEntity.getRepositoryVersion().getStack();
    if (repoVersionStackEntity.getStackName().equals("HDP") && repoVersionStackEntity.getStackVersion().equals("0.2")) {
      assertEquals(RepositoryVersionState.INSTALLING,hostVersionEntity.getState());
    }
  }
}

</code></pre>

<br>
<pre class="type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that {@link Cluster#applyLatestConfigurations(StackId)} sets the
 * right configs to enabled.
 * @throws Exception
 */
@Test public void testApplyLatestConfigurations() throws Exception {
  createDefaultCluster();
  Cluster cluster=clusters.getCluster("c1");
  ClusterEntity clusterEntity=clusterDAO.findByName("c1");
  StackId stackId=cluster.getCurrentStackVersion();
  StackId newStackId=new StackId("HDP-2.0.6");
  StackEntity currentStack=stackDAO.find(stackId.getStackName(),stackId.getStackVersion());
  StackEntity newStack=stackDAO.find(newStackId.getStackName(),newStackId.getStackVersion());
  Assert.assertFalse(stackId.equals(newStackId));
  String configType="foo-type";
  ClusterConfigEntity clusterConfig=new ClusterConfigEntity();
  clusterConfig.setClusterEntity(clusterEntity);
  clusterConfig.setConfigId(1L);
  clusterConfig.setStack(currentStack);
  clusterConfig.setTag("version-1");
  clusterConfig.setData("{}");
  clusterConfig.setType(configType);
  clusterConfig.setTimestamp(1L);
  clusterConfig.setVersion(1L);
  clusterDAO.createConfig(clusterConfig);
  clusterEntity.getClusterConfigEntities().add(clusterConfig);
  clusterEntity=clusterDAO.merge(clusterEntity);
  ClusterConfigEntity newClusterConfig=new ClusterConfigEntity();
  newClusterConfig.setClusterEntity(clusterEntity);
  newClusterConfig.setConfigId(2L);
  newClusterConfig.setStack(newStack);
  newClusterConfig.setTag("version-2");
  newClusterConfig.setData("{}");
  newClusterConfig.setType(configType);
  newClusterConfig.setTimestamp(2L);
  newClusterConfig.setVersion(2L);
  clusterDAO.createConfig(newClusterConfig);
  clusterEntity.getClusterConfigEntities().add(newClusterConfig);
  clusterEntity=clusterDAO.merge(clusterEntity);
  ClusterConfigMappingEntity configMapping=new ClusterConfigMappingEntity();
  configMapping.setClusterEntity(clusterEntity);
  configMapping.setCreateTimestamp(1L);
  configMapping.setSelected(1);
  configMapping.setTag("version-1");
  configMapping.setType(configType);
  configMapping.setUser("admin");
  ClusterConfigMappingEntity newConfigMapping=new ClusterConfigMappingEntity();
  newConfigMapping.setClusterEntity(clusterEntity);
  newConfigMapping.setCreateTimestamp(2L);
  newConfigMapping.setSelected(0);
  newConfigMapping.setTag("version-2");
  newConfigMapping.setType(configType);
  newConfigMapping.setUser("admin");
  clusterDAO.persistConfigMapping(configMapping);
  clusterDAO.persistConfigMapping(newConfigMapping);
  clusterEntity.getConfigMappingEntities().add(configMapping);
  clusterEntity.getConfigMappingEntities().add(newConfigMapping);
  clusterEntity=clusterDAO.merge(clusterEntity);
  Collection<ClusterConfigMappingEntity> clusterConfigMappings=clusterEntity.getConfigMappingEntities();
  Assert.assertEquals(2,clusterConfigMappings.size());
  for (  ClusterConfigMappingEntity clusterConfigMapping : clusterConfigMappings) {
    if (clusterConfigMapping.getTag().equals("version-1")) {
      Assert.assertEquals(1,clusterConfigMapping.isSelected());
    }
 else {
      Assert.assertEquals(0,clusterConfigMapping.isSelected());
    }
  }
  cluster.applyLatestConfigurations(newStackId);
  clusterEntity=clusterDAO.findByName("c1");
  clusterConfigMappings=clusterEntity.getConfigMappingEntities();
  Assert.assertEquals(2,clusterConfigMappings.size());
  for (  ClusterConfigMappingEntity clusterConfigMapping : clusterConfigMappings) {
    if (clusterConfigMapping.getTag().equals("version-1")) {
      Assert.assertEquals(0,clusterConfigMapping.isSelected());
    }
 else {
      Assert.assertEquals(1,clusterConfigMapping.isSelected());
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-12 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBootstrapHostVersion() throws Exception {
  String clusterName="c1";
  String v1="2.2.0-123";
  StackId stackId=new StackId("HDP-2.2.0");
  RepositoryVersionEntity rv1=helper.getOrCreateRepositoryVersion(stackId,v1);
  Map<String,String> hostAttributes=new HashMap<String,String>();
  hostAttributes.put("os_family","redhat");
  hostAttributes.put("os_release_version","5.9");
  Cluster cluster=createClusterForRU(clusterName,stackId,hostAttributes);
  Host deadHost=cluster.getHosts().iterator().next();
  deadHost.setState(HostState.UNHEALTHY);
  int versionedComponentCount=0;
  List<HostComponentStateEntity> hostComponentStates=hostComponentStateDAO.findAll();
  for (int i=0; i < hostComponentStates.size(); i++) {
    HostComponentStateEntity hce=hostComponentStates.get(i);
    ComponentInfo compInfo=metaInfo.getComponent(stackId.getStackName(),stackId.getStackVersion(),hce.getServiceName(),hce.getComponentName());
    if (hce.getHostName().equals(deadHost.getHostName())) {
      continue;
    }
    if (compInfo.isVersionAdvertised()) {
      hce.setVersion(v1);
      hostComponentStateDAO.merge(hce);
      versionedComponentCount++;
    }
    Service svc=cluster.getService(hce.getServiceName());
    ServiceComponent svcComp=svc.getServiceComponent(hce.getComponentName());
    ServiceComponentHost scHost=svcComp.getServiceComponentHost(hce.getHostName());
    scHost.recalculateHostVersionState();
    cluster.recalculateClusterVersionState(rv1);
    Collection<ClusterVersionEntity> clusterVersions=cluster.getAllClusterVersions();
    if (versionedComponentCount > 0) {
      RepositoryVersionEntity repositoryVersion=repositoryVersionDAO.findByStackAndVersion(stackId,v1);
      Assert.assertNotNull(repositoryVersion);
      Assert.assertTrue(clusterVersions != null && clusterVersions.size() == 1);
      if (versionedComponentCount == 1 && i < (hostComponentStates.size() - 1)) {
        Assert.assertEquals(clusterVersions.iterator().next().getState(),RepositoryVersionState.CURRENT);
      }
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-12 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Comprehensive test for transitionHostVersion and recalculateClusterVersion.
 * It creates a cluster with 3 hosts and 3 services, one of which does not advertise a version.
 * It then verifies that all 3 hosts have a version of CURRENT, and so does the cluster.
 * It then adds one more host with a component, so its HostVersion will initialize in CURRENT.
 * Next, it distributes a repo so that it is INSTALLED on the 4 hosts.
 * It then adds one more host, whose HostVersion will be OUT_OF_SYNC for the new repo.
 * After redistributing bits again, it simulates an RU.
 * Finally, some of the hosts will end up with a HostVersion in UPGRADED, and others still in INSTALLED.
 * @throws Exception
 */
@Test public void testTransitionHostVersionAdvanced() throws Exception {
  String clusterName="c1";
  String v1="2.2.0-123";
  StackId stackId=new StackId("HDP-2.2.0");
  RepositoryVersionEntity rv1=helper.getOrCreateRepositoryVersion(stackId,v1);
  Map<String,String> hostAttributes=new HashMap<String,String>();
  hostAttributes.put("os_family","redhat");
  hostAttributes.put("os_release_version","5.9");
  Cluster cluster=createClusterForRU(clusterName,stackId,hostAttributes);
  int versionedComponentCount=0;
  List<HostComponentStateEntity> hostComponentStates=hostComponentStateDAO.findAll();
  for (int i=0; i < hostComponentStates.size(); i++) {
    HostComponentStateEntity hce=hostComponentStates.get(i);
    ComponentInfo compInfo=metaInfo.getComponent(stackId.getStackName(),stackId.getStackVersion(),hce.getServiceName(),hce.getComponentName());
    if (compInfo.isVersionAdvertised()) {
      hce.setVersion(v1);
      hostComponentStateDAO.merge(hce);
      versionedComponentCount++;
    }
    Service svc=cluster.getService(hce.getServiceName());
    ServiceComponent svcComp=svc.getServiceComponent(hce.getComponentName());
    ServiceComponentHost scHost=svcComp.getServiceComponentHost(hce.getHostName());
    scHost.recalculateHostVersionState();
    cluster.recalculateClusterVersionState(rv1);
    Collection<ClusterVersionEntity> clusterVersions=cluster.getAllClusterVersions();
    if (versionedComponentCount > 0) {
      RepositoryVersionEntity repositoryVersion=repositoryVersionDAO.findByStackAndVersion(stackId,v1);
      Assert.assertNotNull(repositoryVersion);
      Assert.assertTrue(clusterVersions != null && clusterVersions.size() == 1);
      if (versionedComponentCount == 1 && i < (hostComponentStates.size() - 1)) {
        Assert.assertEquals(clusterVersions.iterator().next().getState(),RepositoryVersionState.UPGRADING);
      }
      if (i == hostComponentStates.size() - 1) {
        Assert.assertEquals(clusterVersions.iterator().next().getState(),RepositoryVersionState.CURRENT);
      }
    }
  }
  addHost("h-4",hostAttributes);
  clusters.mapHostToCluster("h-4",clusterName);
  Service svc2=cluster.getService("ZOOKEEPER");
  Service svc3=cluster.getService("GANGLIA");
  ServiceComponent sc2CompA=svc2.getServiceComponent("ZOOKEEPER_SERVER");
  ServiceComponent sc2CompB=svc2.getServiceComponent("ZOOKEEPER_CLIENT");
  ServiceComponent sc3CompB=svc3.getServiceComponent("GANGLIA_MONITOR");
  ServiceComponentHost schHost4Serv2CompA=serviceComponentHostFactory.createNew(sc2CompA,"h-4");
  ServiceComponentHost schHost4Serv2CompB=serviceComponentHostFactory.createNew(sc2CompB,"h-4");
  ServiceComponentHost schHost4Serv3CompB=serviceComponentHostFactory.createNew(sc3CompB,"h-4");
  sc2CompA.addServiceComponentHost(schHost4Serv2CompA);
  sc2CompB.addServiceComponentHost(schHost4Serv2CompB);
  sc3CompB.addServiceComponentHost(schHost4Serv3CompB);
  schHost4Serv2CompA.persist();
  schHost4Serv2CompB.persist();
  schHost4Serv3CompB.persist();
  simulateStackVersionListener(stackId,v1,cluster,hostComponentStateDAO.findByHost("h-4"));
  Collection<HostVersionEntity> hostVersions=hostVersionDAO.findAll();
  Assert.assertEquals(hostVersions.size(),clusters.getHosts().size());
  HostVersionEntity h4Version1=hostVersionDAO.findByClusterStackVersionAndHost(clusterName,stackId,v1,"h-4");
  Assert.assertNotNull(h4Version1);
  Assert.assertEquals(h4Version1.getState(),RepositoryVersionState.CURRENT);
  String v2="2.2.0-456";
  RepositoryVersionEntity rv2=helper.getOrCreateRepositoryVersion(stackId,v2);
  for (  String hostName : clusters.getHostsForCluster(clusterName).keySet()) {
    HostEntity host=hostDAO.findByName(hostName);
    HostVersionEntity hve=new HostVersionEntity(host,rv2,RepositoryVersionState.INSTALLED);
    hostVersionDAO.create(hve);
  }
  cluster.createClusterVersion(stackId,v2,"admin",RepositoryVersionState.INSTALLING);
  cluster.transitionClusterVersion(stackId,v2,RepositoryVersionState.INSTALLED);
  ClusterVersionEntity cv2=clusterVersionDAO.findByClusterAndStackAndVersion(clusterName,stackId,v2);
  Assert.assertNotNull(cv2);
  Assert.assertEquals(cv2.getState(),RepositoryVersionState.INSTALLED);
  addHost("h-5",hostAttributes);
  clusters.mapHostToCluster("h-5",clusterName);
  ServiceComponentHost schHost5Serv3CompB=serviceComponentHostFactory.createNew(sc3CompB,"h-5");
  sc3CompB.addServiceComponentHost(schHost5Serv3CompB);
  schHost5Serv3CompB.persist();
  HostVersionEntity h5Version2=hostVersionDAO.findByClusterStackVersionAndHost(clusterName,stackId,v2,"h-5");
  Assert.assertNotNull(h5Version2);
  Assert.assertEquals(h5Version2.getState(),RepositoryVersionState.OUT_OF_SYNC);
  h5Version2.setState(RepositoryVersionState.INSTALLED);
  hostVersionDAO.merge(h5Version2);
  versionedComponentCount=0;
  hostComponentStates=hostComponentStateDAO.findAll();
  for (int i=0; i < hostComponentStates.size(); i++) {
    HostComponentStateEntity hce=hostComponentStates.get(i);
    ComponentInfo compInfo=metaInfo.getComponent(stackId.getStackName(),stackId.getStackVersion(),hce.getServiceName(),hce.getComponentName());
    if (compInfo.isVersionAdvertised()) {
      hce.setVersion(v2);
      hostComponentStateDAO.merge(hce);
      versionedComponentCount++;
    }
    Service svc=cluster.getService(hce.getServiceName());
    ServiceComponent svcComp=svc.getServiceComponent(hce.getComponentName());
    ServiceComponentHost scHost=svcComp.getServiceComponentHost(hce.getHostName());
    scHost.recalculateHostVersionState();
    cluster.recalculateClusterVersionState(rv2);
    Collection<ClusterVersionEntity> clusterVersions=cluster.getAllClusterVersions();
    if (versionedComponentCount > 0) {
      RepositoryVersionEntity repositoryVersion=repositoryVersionDAO.findByStackAndVersion(stackId,v2);
      Assert.assertNotNull(repositoryVersion);
      Assert.assertTrue(clusterVersions != null && clusterVersions.size() == 2);
      if (versionedComponentCount == 1 && i < (hostComponentStates.size() - 1)) {
        cv2=clusterVersionDAO.findByClusterAndStackAndVersion(clusterName,stackId,v2);
        Assert.assertEquals(cv2.getState(),RepositoryVersionState.UPGRADING);
      }
    }
  }
  cv2=clusterVersionDAO.findByClusterAndStackAndVersion(clusterName,stackId,v2);
  Assert.assertEquals(cv2.getState(),RepositoryVersionState.UPGRADING);
  Collection<HostVersionEntity> v2HostVersions=hostVersionDAO.findByClusterStackAndVersion(clusterName,stackId,v2);
  Assert.assertEquals(v2HostVersions.size(),clusters.getHostsForCluster(clusterName).size());
  for (  HostVersionEntity hve : v2HostVersions) {
    if (hve.getHostName().equals("h-3") || hve.getHostName().equals("h-5")) {
      Assert.assertEquals(hve.getState(),RepositoryVersionState.INSTALLED);
    }
 else {
      Assert.assertEquals(hve.getState(),RepositoryVersionState.UPGRADED);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.state.cluster.ServiceComponentHostConcurrentWriteDeadlockTest </h4><pre class="type-13 type-2 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 */
@Test() public void testConcurrentWriteDeadlock() throws Exception {
  ServiceComponentHost nameNodeSCH=createNewServiceComponentHost("HDFS","NAMENODE","c6401");
  ServiceComponentHost dataNodeSCH=createNewServiceComponentHost("HDFS","DATANODE","c6401");
  List<ServiceComponentHost> serviceComponentHosts=new ArrayList<ServiceComponentHost>();
  serviceComponentHosts.add(nameNodeSCH);
  serviceComponentHosts.add(dataNodeSCH);
  List<Thread> threads=new ArrayList<Thread>();
  for (int i=0; i < NUMBER_OF_THREADS; i++) {
    ServiceComponentHostDeadlockWriter thread=new ServiceComponentHostDeadlockWriter();
    thread.setServiceComponentHosts(serviceComponentHosts);
    thread.start();
    threads.add(thread);
  }
  DeadlockWarningThread wt=new DeadlockWarningThread(threads);
  while (true) {
    if (!wt.isAlive()) {
      break;
    }
  }
  if (wt.isDeadlocked()) {
    Assert.assertFalse(wt.getErrorMessages().toString(),wt.isDeadlocked());
  }
 else {
    Assert.assertFalse(wt.isDeadlocked());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.state.host.HostTest </h4><pre class="type-13 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testHostRegistrationFlow() throws Exception {
  clusters.addHost("foo");
  Host host=clusters.getHost("foo");
  registerHost(host);
  verifyHostState(host,HostState.WAITING_FOR_HOST_STATUS_UPDATES);
  boolean exceptionThrown=false;
  try {
    registerHost(host);
  }
 catch (  Exception e) {
    exceptionThrown=true;
  }
  if (!exceptionThrown) {
    fail("Expected invalid transition exception to be thrown");
  }
  ensureHostUpdatesReceived(host);
  verifyHostState(host,HostState.HEALTHY);
  exceptionThrown=false;
  try {
    ensureHostUpdatesReceived(host);
  }
 catch (  Exception e) {
    exceptionThrown=true;
  }
  if (!exceptionThrown) {
    fail("Expected invalid transition exception to be thrown");
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.state.kerberos.KerberosConfigurationDescriptorTest </h4><pre class="type-13 type-10 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testJSONDeserializeMultiple(){
  List<Map<String,Object>> jsonData=new Gson().fromJson(JSON_MULTIPLE_VALUE,new TypeToken<List<Map<String,Object>>>(){
  }
.getType());
  List<KerberosConfigurationDescriptor> configurations=new ArrayList<KerberosConfigurationDescriptor>();
  for (  Map<String,Object> item : jsonData) {
    configurations.add(new KerberosConfigurationDescriptor(item));
  }
  Assert.assertNotNull(configurations);
  Assert.assertEquals(2,configurations.size());
  for (  KerberosConfigurationDescriptor configuration : configurations) {
    Assert.assertFalse(configuration.isContainer());
    String type=configuration.getType();
    Assert.assertEquals(2,configurations.size());
    Map<String,String> properties=configuration.getProperties();
    if ("configuration-type".equals(type)) {
      Assert.assertNotNull(properties);
      Assert.assertEquals(2,properties.size());
      Assert.assertEquals("value1",properties.get("property1"));
      Assert.assertEquals("value2",properties.get("property2"));
    }
 else     if ("configuration-type2".equals(type)) {
      Assert.assertNotNull(properties);
      Assert.assertEquals(3,properties.size());
      Assert.assertEquals("value1",properties.get("property1"));
      Assert.assertEquals("value2",properties.get("property2"));
      Assert.assertEquals("value3",properties.get("property3"));
      Assert.assertEquals("value1",configuration.getProperty("property1"));
      Assert.assertEquals("value2",configuration.getProperty("property2"));
      Assert.assertEquals("value3",configuration.getProperty("property3"));
    }
 else {
      Assert.fail("Missing expected configuration type");
    }
  }
}

</code></pre>

<br>
<pre class="type-13 type-10 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMapDeserializeMultiple(){
  List<KerberosConfigurationDescriptor> configurations=new ArrayList<KerberosConfigurationDescriptor>();
  for (  Map<String,Map<String,Object>> item : MAP_MULTIPLE_VALUES) {
    configurations.add(new KerberosConfigurationDescriptor(item));
  }
  Assert.assertNotNull(configurations);
  Assert.assertEquals(2,configurations.size());
  for (  KerberosConfigurationDescriptor configuration : configurations) {
    Assert.assertFalse(configuration.isContainer());
    String type=configuration.getType();
    Map<String,String> properties=configuration.getProperties();
    if ("configuration-type".equals(type)) {
      Assert.assertNotNull(properties);
      Assert.assertEquals(2,properties.size());
      Assert.assertEquals("black",properties.get("property1"));
      Assert.assertEquals("white",properties.get("property2"));
      Assert.assertEquals("black",configuration.getProperty("property1"));
      Assert.assertEquals("white",configuration.getProperty("property2"));
    }
 else     if ("configuration-type2".equals(type)) {
      Assert.assertNotNull(properties);
      Assert.assertEquals(3,properties.size());
      Assert.assertEquals("red",properties.get("property1"));
      Assert.assertEquals("yellow",properties.get("property2"));
      Assert.assertEquals("green",properties.get("property3"));
      Assert.assertEquals("red",configuration.getProperty("property1"));
      Assert.assertEquals("yellow",configuration.getProperty("property2"));
      Assert.assertEquals("green",configuration.getProperty("property3"));
    }
 else {
      Assert.fail("Missing expected configuration type");
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.state.stack.UpgradePackTest </h4><pre class="type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies boolean conditions
"></span><br>
/** 
 * Tests that the XML for not auto skipping skippable failures works.
 * @throws Exception
 */
@Test public void testNoAutoSkipFailure() throws Exception {
  Map<String,UpgradePack> upgrades=ambariMetaInfo.getUpgradePacks("HDP","2.2.0");
  UpgradePack upgradePack=upgrades.get("upgrade_test_skip_failures");
  List<Grouping> groups=upgradePack.getGroups(Direction.UPGRADE);
  for (  Grouping grouping : groups) {
    if (grouping.name.equals("SKIPPABLE_BUT_NOT_AUTO_SKIPPABLE")) {
      Assert.assertFalse(grouping.supportsAutoSkipOnFailure);
    }
 else {
      Assert.assertTrue(grouping.supportsAutoSkipOnFailure);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.state.svccomphost.ServiceComponentHostTest </h4><pre class="type-4 type-13 type-2 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testCanBeRemoved() throws Exception {
  ServiceComponentHostImpl impl=(ServiceComponentHostImpl)createNewServiceComponentHost(clusterName,"HDFS","HDFS_CLIENT",hostName1,true);
  for (  State state : State.values()) {
    impl.setState(state);
    if (state.isRemovableState()) {
      Assert.assertTrue(impl.canBeRemoved());
    }
 else {
      Assert.assertFalse(impl.canBeRemoved());
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.upgrade.StackUpgradeUtilTest </h4><pre class="type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpgradeStack() throws Exception {
  StackUpgradeUtil stackUpgradeUtil=injector.getInstance(StackUpgradeUtil.class);
  String stackName="HDP";
  String stackVersion="1.3.0";
  String localRepoUrl="http://foo.bar";
  stackUpgradeUtil.updateLocalRepo(stackName,stackVersion,localRepoUrl,null);
  MetainfoDAO dao=injector.getInstance(MetainfoDAO.class);
  Collection<MetainfoEntity> entities=dao.findAll();
  Assert.assertTrue(entities.size() > 0);
  for (  MetainfoEntity entity : entities) {
    Assert.assertTrue(entity.getMetainfoName().startsWith("repo:/HDP/1.3.0/"));
    Assert.assertEquals(localRepoUrl,entity.getMetainfoValue());
  }
  reset(stackName,stackVersion);
  entities=dao.findAll();
  Assert.assertEquals(0,entities.size());
  stackUpgradeUtil.updateLocalRepo(stackName,stackVersion,localRepoUrl,"centos6");
  entities=dao.findAll();
  for (  MetainfoEntity entity : entities) {
    Assert.assertTrue(entity.getMetainfoName().startsWith("repo:/HDP/1.3.0/centos6") || entity.getMetainfoName().startsWith("repo:/HDP/1.3.0/redhat6"));
    Assert.assertEquals(localRepoUrl,entity.getMetainfoValue());
  }
  reset(stackName,stackVersion);
  entities=dao.findAll();
  Assert.assertTrue(0 == entities.size());
  stackUpgradeUtil.updateLocalRepo(stackName,stackVersion,localRepoUrl,"centos6,centos5");
  entities=dao.findAll();
  for (  MetainfoEntity entity : entities) {
    Assert.assertTrue(entity.getMetainfoName().startsWith("repo:/HDP/1.3.0/centos6") || entity.getMetainfoName().startsWith("repo:/HDP/1.3.0/redhat6") || entity.getMetainfoName().startsWith("repo:/HDP/1.3.0/redhat5")|| entity.getMetainfoName().startsWith("repo:/HDP/1.3.0/centos5"));
    Assert.assertEquals(localRepoUrl,entity.getMetainfoValue());
  }
  localRepoUrl="http://newfoo.bar";
  stackUpgradeUtil.updateLocalRepo(stackName,stackVersion,localRepoUrl,"centos6");
  entities=dao.findAll();
  boolean foundCentos6=false;
  boolean foundRedhat6=false;
  for (  MetainfoEntity entity : entities) {
    if (-1 != entity.getMetainfoName().indexOf("centos6")) {
      foundCentos6=true;
      Assert.assertEquals(localRepoUrl,entity.getMetainfoValue());
    }
 else     if (-1 != entity.getMetainfoName().indexOf("redhat6")) {
      foundRedhat6=true;
      Assert.assertEquals(localRepoUrl,entity.getMetainfoValue());
    }
 else {
      Assert.assertFalse(localRepoUrl.equals(entity.getMetainfoValue()));
    }
  }
  Assert.assertTrue(foundCentos6);
  Assert.assertTrue(foundRedhat6);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.upgrade.UpgradeCatalog150Test </h4><pre class="type-13 type-10 type-2 type-5 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAddMissingLog4jConfigs() throws Exception {
  ClusterDAO clusterDAO=injector.getInstance(ClusterDAO.class);
  ClusterEntity clusterEntity=upgradeCatalogHelper.createCluster(injector,CLUSTER_NAME,desiredStackEntity);
  ClusterServiceEntity clusterServiceEntityMR=upgradeCatalogHelper.addService(injector,clusterEntity,"HDFS",desiredStackEntity);
  Long clusterId=clusterEntity.getClusterId();
  ClusterConfigEntity configEntity=clusterDAO.findConfig(clusterId,"hdfs-log4j","version1");
  Assert.assertNull(configEntity);
  for (  ClusterConfigMappingEntity ccme : clusterEntity.getConfigMappingEntities()) {
    if ("hdfs-log4j".equals(ccme.getType())) {
      Assert.fail();
    }
  }
  UpgradeCatalog150 upgradeCatalog150=injector.getInstance(UpgradeCatalog150.class);
  upgradeCatalog150.addMissingLog4jConfigs();
  configEntity=clusterDAO.findConfig(clusterId,"hdfs-log4j","version1");
  Assert.assertNotNull(configEntity);
  clusterEntity=clusterDAO.findById(1L);
  boolean failFlag=true;
  for (  ClusterConfigMappingEntity ccme : clusterEntity.getConfigMappingEntities()) {
    if ("hdfs-log4j".equals(ccme.getType())) {
      failFlag=false;
    }
  }
  Assert.assertFalse(failFlag);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.upgrade.UpgradeCatalog170Test </h4><pre class="type-13 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testExecuteDDLUpdates_DBAccessor() throws Exception {
  final DBAccessor dbAccessor=createNiceMock(DBAccessor.class);
  Statement statement=createNiceMock(Statement.class);
  Connection connection=createNiceMock(Connection.class);
  PreparedStatement stmt=createNiceMock(PreparedStatement.class);
  Configuration configuration=createNiceMock(Configuration.class);
  ResultSet resultSet=createNiceMock(ResultSet.class);
  expect(configuration.getDatabaseUrl()).andReturn(Configuration.JDBC_IN_MEMORY_URL).anyTimes();
  expect(dbAccessor.getNewConnection()).andReturn(connection);
  expect(connection.prepareStatement("SELECT config_id FROM clusterconfig " + "WHERE type_name = ? ORDER BY create_timestamp")).andReturn(stmt);
  expect(connection.prepareStatement("UPDATE clusterconfig SET version = ? " + "WHERE config_id = ?")).andReturn(stmt);
  stmt.close();
  expectLastCall().times(2);
  connection.close();
  expectLastCall();
  Capture<DBAccessor.DBColumnInfo> clusterConfigAttributesColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> hostgroupConfigAttributesColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> blueprintConfigAttributesColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> maskColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> systemColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> maskedColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> stageCommandParamsColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> stageHostParamsColumnCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<List<DBAccessor.DBColumnInfo>> groupsCapture=new Capture<List<DBAccessor.DBColumnInfo>>();
  Capture<List<DBAccessor.DBColumnInfo>> alertDefinitionColumnCapture=new Capture<List<DBAccessor.DBColumnInfo>>();
  Capture<List<DBAccessor.DBColumnInfo>> alertHistoryColumnCapture=new Capture<List<DBAccessor.DBColumnInfo>>();
  Capture<List<DBAccessor.DBColumnInfo>> alertCurrentColumnCapture=new Capture<List<DBAccessor.DBColumnInfo>>();
  Capture<List<DBAccessor.DBColumnInfo>> alertGroupColumnCapture=new Capture<List<DBAccessor.DBColumnInfo>>();
  Capture<List<DBAccessor.DBColumnInfo>> alertTargetCapture=new Capture<List<DBAccessor.DBColumnInfo>>();
  Capture<List<DBAccessor.DBColumnInfo>> alertGroupTargetCapture=new Capture<List<DBAccessor.DBColumnInfo>>();
  Capture<List<DBAccessor.DBColumnInfo>> alertGroupingCapture=new Capture<List<DBAccessor.DBColumnInfo>>();
  Capture<List<DBAccessor.DBColumnInfo>> alertNoticeCapture=new Capture<List<DBAccessor.DBColumnInfo>>();
  Capture<List<DBAccessor.DBColumnInfo>> serviceConfigCapture=new Capture<List<DBAccessor.DBColumnInfo>>();
  Capture<List<DBAccessor.DBColumnInfo>> serviceConfigMappingCapture=new Capture<List<DBAccessor.DBColumnInfo>>();
  Capture<DBAccessor.DBColumnInfo> configDataClusterConfigCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> configDataBlueprintConfigurationCapture=new Capture<DBAccessor.DBColumnInfo>();
  Capture<DBAccessor.DBColumnInfo> configDataHostGroupConfigurationCapture=new Capture<DBAccessor.DBColumnInfo>();
  dbAccessor.createTable(eq("groups"),capture(groupsCapture),eq("group_id"));
  setViewExpectations(dbAccessor,maskColumnCapture,systemColumnCapture);
  setViewParameterExpectations(dbAccessor,maskedColumnCapture);
  setConfigAttributesColumnExpectations(dbAccessor,clusterConfigAttributesColumnCapture,"clusterconfig");
  setConfigAttributesColumnExpectations(dbAccessor,hostgroupConfigAttributesColumnCapture,"hostgroup_configuration");
  setConfigAttributesColumnExpectations(dbAccessor,blueprintConfigAttributesColumnCapture,"blueprint_configuration");
  setStageExpectations(dbAccessor,stageCommandParamsColumnCapture,stageHostParamsColumnCapture);
  dbAccessor.createTable(eq("alert_definition"),capture(alertDefinitionColumnCapture),eq("definition_id"));
  dbAccessor.createTable(eq("alert_history"),capture(alertHistoryColumnCapture),eq("alert_id"));
  dbAccessor.createTable(eq("alert_current"),capture(alertCurrentColumnCapture),eq("alert_id"));
  dbAccessor.createTable(eq("alert_group"),capture(alertGroupColumnCapture),eq("group_id"));
  dbAccessor.createTable(eq("alert_target"),capture(alertTargetCapture),eq("target_id"));
  dbAccessor.createTable(eq("alert_group_target"),capture(alertGroupTargetCapture),eq("group_id"),eq("target_id"));
  dbAccessor.createTable(eq("alert_grouping"),capture(alertGroupingCapture),eq("group_id"),eq("definition_id"));
  dbAccessor.createTable(eq("alert_notice"),capture(alertNoticeCapture),eq("notification_id"));
  dbAccessor.alterColumn(eq("clusterconfig"),capture(configDataClusterConfigCapture));
  dbAccessor.alterColumn(eq("blueprint_configuration"),capture(configDataBlueprintConfigurationCapture));
  dbAccessor.alterColumn(eq("hostgroup_configuration"),capture(configDataHostGroupConfigurationCapture));
  dbAccessor.createTable(eq("serviceconfig"),capture(serviceConfigCapture),eq("service_config_id"));
  dbAccessor.createTable(eq("serviceconfigmapping"),capture(serviceConfigMappingCapture),eq("service_config_id"),eq("config_id"));
  dbAccessor.getConnection();
  expectLastCall().andReturn(connection).anyTimes();
  connection.createStatement();
  expectLastCall().andReturn(statement).anyTimes();
  statement.executeQuery(anyObject(String.class));
  expectLastCall().andReturn(resultSet).anyTimes();
  resultSet.next();
  expectLastCall().andReturn(false).anyTimes();
  resultSet.close();
  expectLastCall().anyTimes();
  replay(dbAccessor,configuration,resultSet,connection,stmt,statement);
  AbstractUpgradeCatalog upgradeCatalog=getUpgradeCatalog(dbAccessor);
  Class<?> c=AbstractUpgradeCatalog.class;
  Field f=c.getDeclaredField("configuration");
  f.setAccessible(true);
  f.set(upgradeCatalog,configuration);
  upgradeCatalog.executeDDLUpdates();
  verify(dbAccessor,configuration,resultSet,connection,stmt,statement);
  assertClusterConfigColumns(clusterConfigAttributesColumnCapture);
  assertHostgroupConfigColumns(hostgroupConfigAttributesColumnCapture);
  assertBlueprintConfigColumns(blueprintConfigAttributesColumnCapture);
  assertViewColumns(maskColumnCapture,systemColumnCapture);
  assertViewParameterColumns(maskedColumnCapture);
  assertStageColumns(stageCommandParamsColumnCapture,stageHostParamsColumnCapture);
  assertEquals(4,groupsCapture.getValue().size());
  List<DBAccessor.DBColumnInfo> columnInfoList=groupsCapture.getValue();
  for (  DBAccessor.DBColumnInfo info : columnInfoList) {
    if (info.getName().equals("group_name")) {
      assertEquals(Integer.valueOf(255),info.getLength());
      break;
    }
  }
  assertEquals(12,alertDefinitionColumnCapture.getValue().size());
  assertEquals(11,alertHistoryColumnCapture.getValue().size());
  assertEquals(7,alertCurrentColumnCapture.getValue().size());
  assertEquals(5,alertGroupColumnCapture.getValue().size());
  assertEquals(5,alertTargetCapture.getValue().size());
  assertEquals(2,alertGroupTargetCapture.getValue().size());
  assertEquals(2,alertGroupingCapture.getValue().size());
  assertEquals(5,alertNoticeCapture.getValue().size());
  assertEquals(2,serviceConfigCapture.getValue().size());
  assertEquals(2,serviceConfigMappingCapture.getValue().size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.upgrade.UpgradeCatalog211Test </h4><pre class="type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUpdateKerberosConfiguration() throws Exception {
  final AmbariManagementController controller=createNiceMock(AmbariManagementController.class);
  final DBAccessor dbAccessor=createNiceMock(DBAccessor.class);
  final OsFamily osFamily=createNiceMock(OsFamily.class);
  final Map<String,String> propertiesKerberosEnv=new HashMap<String,String>(){
{
      put("create_attributes_template","create_attributes_template content");
      put("realm","EXAMPLE.COM");
      put("container_dn","");
      put("ldap_url","");
      put("encryption_types","aes des3-cbc-sha1 rc4 des-cbc-md5");
      put("kdc_host","c6407.ambari.apache.org");
      put("admin_server_host","c6407.ambari.apache.org");
      put("kdc_type","mit-kdc");
    }
  }
;
  final Config configKerberosEnv=createNiceMock(Config.class);
  expect(configKerberosEnv.getProperties()).andReturn(propertiesKerberosEnv).anyTimes();
  expect(configKerberosEnv.getTag()).andReturn("tag1").anyTimes();
  final Cluster cluster=createNiceMock(Cluster.class);
  expect(cluster.getDesiredConfigByType("kerberos-env")).andReturn(configKerberosEnv).once();
  final Injector injector=Guice.createInjector(new AbstractModule(){
    @Override protected void configure(){
      bind(AmbariManagementController.class).toInstance(controller);
      bind(DBAccessor.class).toInstance(dbAccessor);
      bind(OsFamily.class).toInstance(osFamily);
    }
  }
);
  expect(cluster.getConfigsByType("kerberos-env")).andReturn(Collections.singletonMap("tag1",configKerberosEnv)).once();
  expect(cluster.getDesiredConfigByType("kerberos-env")).andReturn(configKerberosEnv).once();
  Capture<ConfigurationRequest> captureCR=new Capture<ConfigurationRequest>();
  Capture<Cluster> clusterCapture=newCapture();
  Capture<String> typeCapture=newCapture();
  Capture<Map> propertiesCapture=newCapture();
  Capture<String> tagCapture=newCapture();
  Capture<Map> attributesCapture=newCapture();
  expect(controller.createConfig(capture(clusterCapture),capture(typeCapture),capture(propertiesCapture),capture(tagCapture),capture(attributesCapture))).andReturn(createNiceMock(Config.class)).once();
  replayAll();
  injector.getInstance(UpgradeCatalog211.class).updateKerberosConfigurations(cluster);
  verifyAll();
  Map<String,String> capturedCRProperties=propertiesCapture.getValue();
  Assert.assertNotNull(capturedCRProperties);
  Assert.assertFalse(capturedCRProperties.containsKey("create_attributes_template"));
  Assert.assertTrue(capturedCRProperties.containsKey("ad_create_attributes_template"));
  for (  String property : propertiesKerberosEnv.keySet()) {
    if ("create_attributes_template".equals(property)) {
      Assert.assertEquals("create_attributes_template/ad_create_attributes_template",propertiesKerberosEnv.get(property),capturedCRProperties.get("ad_create_attributes_template"));
    }
 else {
      Assert.assertEquals(property,propertiesKerberosEnv.get(property),capturedCRProperties.get(property));
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.utils.StageUtilsTest </h4><pre class="type-4 type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetClusterHostInfo() throws Exception {
  final HashMap<String,String> hostAttributes=new HashMap<String,String>(){
{
      put("os_family","redhat");
      put("os_release_version","5.9");
    }
  }
;
  final Clusters clusters=createNiceMock(Clusters.class);
  List<Host> hosts=new ArrayList<Host>();
  List<String> hostNames=new ArrayList<String>();
  List<Integer> pingPorts=Arrays.asList(StageUtils.DEFAULT_PING_PORT,StageUtils.DEFAULT_PING_PORT,StageUtils.DEFAULT_PING_PORT,8671,8671,null,8672,8672,null,8673);
  for (int i=0; i < 10; i++) {
    String hostname=String.format("h%d",i);
    Host host=createNiceMock(Host.class);
    expect(host.getHostName()).andReturn(hostname).anyTimes();
    expect(host.getHostAttributes()).andReturn(hostAttributes).anyTimes();
    expect(host.getCurrentPingPort()).andReturn(pingPorts.get(i)).anyTimes();
    hosts.add(host);
    hostNames.add(hostname);
    expect(clusters.getHost(hostname)).andReturn(host).anyTimes();
  }
  final ServiceComponentHost nnh0ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(nnh0ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.INSERVICE).anyTimes();
  final ServiceComponentHost snnh1ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(snnh1ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.INSERVICE).anyTimes();
  final ServiceComponentHost dnh0ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(dnh0ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.INSERVICE).anyTimes();
  final ServiceComponentHost dnh1ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(dnh1ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.INSERVICE).anyTimes();
  final ServiceComponentHost dnh2ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(dnh2ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.INSERVICE).anyTimes();
  final ServiceComponentHost dnh3ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(dnh3ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.INSERVICE).anyTimes();
  final ServiceComponentHost dnh5ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(dnh5ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.INSERVICE).anyTimes();
  final ServiceComponentHost dnh7ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(dnh7ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.INSERVICE).anyTimes();
  final ServiceComponentHost dnh8ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(dnh8ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.INSERVICE).anyTimes();
  final ServiceComponentHost dnh9ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(dnh9ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.INSERVICE).anyTimes();
  final ServiceComponentHost hbm5ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(hbm5ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.INSERVICE).anyTimes();
  final ServiceComponentHost hbrs1ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(hbrs1ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.INSERVICE).anyTimes();
  final ServiceComponentHost hbrs3ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(hbrs3ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.INSERVICE).anyTimes();
  final ServiceComponentHost hbrs5ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(hbrs5ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.INSERVICE).anyTimes();
  final ServiceComponentHost hbrs8ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(hbrs8ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.INSERVICE).anyTimes();
  final ServiceComponentHost hbrs9ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(hbrs9ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.INSERVICE).anyTimes();
  final ServiceComponentHost mrjt5ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(mrjt5ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.INSERVICE).anyTimes();
  final ServiceComponentHost mrtt1ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(mrtt1ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.INSERVICE).anyTimes();
  final ServiceComponentHost mrtt2ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(mrtt2ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.DECOMMISSIONED).anyTimes();
  final ServiceComponentHost mrtt3ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(mrtt3ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.DECOMMISSIONED).anyTimes();
  final ServiceComponentHost mrtt4ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(mrtt4ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.INSERVICE).anyTimes();
  final ServiceComponentHost mrtt5ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(mrtt5ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.INSERVICE).anyTimes();
  final ServiceComponentHost mrtt7ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(mrtt7ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.INSERVICE).anyTimes();
  final ServiceComponentHost mrtt9ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(mrtt9ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.INSERVICE).anyTimes();
  final ServiceComponentHost nns7ServiceComponentHost=createMock(ServiceComponentHost.class);
  expect(nns7ServiceComponentHost.getComponentAdminState()).andReturn(HostComponentAdminState.INSERVICE).anyTimes();
  Map<String,Collection<String>> projectedTopology=new HashMap<String,Collection<String>>();
  final HashMap<String,ServiceComponentHost> nnServiceComponentHosts=new HashMap<String,ServiceComponentHost>(){
{
      put("h0",nnh0ServiceComponentHost);
    }
  }
;
  insertTopology(projectedTopology,"NAMENODE",nnServiceComponentHosts.keySet());
  final HashMap<String,ServiceComponentHost> snnServiceComponentHosts=new HashMap<String,ServiceComponentHost>(){
{
      put("h1",snnh1ServiceComponentHost);
    }
  }
;
  insertTopology(projectedTopology,"SECONDARY_NAMENODE",snnServiceComponentHosts.keySet());
  final Map<String,ServiceComponentHost> dnServiceComponentHosts=new HashMap<String,ServiceComponentHost>(){
{
      put("h0",dnh0ServiceComponentHost);
      put("h1",dnh1ServiceComponentHost);
      put("h2",dnh2ServiceComponentHost);
      put("h3",dnh3ServiceComponentHost);
      put("h5",dnh5ServiceComponentHost);
      put("h7",dnh7ServiceComponentHost);
      put("h8",dnh8ServiceComponentHost);
      put("h9",dnh9ServiceComponentHost);
    }
  }
;
  insertTopology(projectedTopology,"DATANODE",dnServiceComponentHosts.keySet());
  final Map<String,ServiceComponentHost> hbmServiceComponentHosts=new HashMap<String,ServiceComponentHost>(){
{
      put("h5",hbm5ServiceComponentHost);
    }
  }
;
  insertTopology(projectedTopology,"HBASE_MASTER",hbmServiceComponentHosts.keySet());
  final Map<String,ServiceComponentHost> hbrsServiceComponentHosts=new HashMap<String,ServiceComponentHost>(){
{
      put("h1",hbrs1ServiceComponentHost);
      put("h3",hbrs3ServiceComponentHost);
      put("h5",hbrs5ServiceComponentHost);
      put("h8",hbrs8ServiceComponentHost);
      put("h9",hbrs9ServiceComponentHost);
    }
  }
;
  insertTopology(projectedTopology,"HBASE_REGIONSERVER",hbrsServiceComponentHosts.keySet());
  final Map<String,ServiceComponentHost> mrjtServiceComponentHosts=new HashMap<String,ServiceComponentHost>(){
{
      put("h5",mrjt5ServiceComponentHost);
    }
  }
;
  insertTopology(projectedTopology,"JOBTRACKER",mrjtServiceComponentHosts.keySet());
  final Map<String,ServiceComponentHost> mrttServiceComponentHosts=new HashMap<String,ServiceComponentHost>(){
{
      put("h1",mrtt1ServiceComponentHost);
      put("h2",mrtt2ServiceComponentHost);
      put("h3",mrtt3ServiceComponentHost);
      put("h4",mrtt4ServiceComponentHost);
      put("h5",mrtt5ServiceComponentHost);
      put("h7",mrtt7ServiceComponentHost);
      put("h9",mrtt9ServiceComponentHost);
    }
  }
;
  insertTopology(projectedTopology,"TASKTRACKER",mrttServiceComponentHosts.keySet());
  final Map<String,ServiceComponentHost> nnsServiceComponentHosts=new HashMap<String,ServiceComponentHost>(){
{
      put("h7",nns7ServiceComponentHost);
    }
  }
;
  insertTopology(projectedTopology,"NONAME_SERVER",nnsServiceComponentHosts.keySet());
  final ServiceComponent nnComponent=createMock(ServiceComponent.class);
  expect(nnComponent.getName()).andReturn("NAMENODE").anyTimes();
  expect(nnComponent.getServiceComponentHost(anyObject(String.class))).andAnswer(new IAnswer<ServiceComponentHost>(){
    @Override public ServiceComponentHost answer() throws Throwable {
      Object[] args=getCurrentArguments();
      return nnServiceComponentHosts.get((String)args[0]);
    }
  }
).anyTimes();
  expect(nnComponent.getServiceComponentHosts()).andReturn(nnServiceComponentHosts).anyTimes();
  expect(nnComponent.isClientComponent()).andReturn(false).anyTimes();
  final ServiceComponent snnComponent=createMock(ServiceComponent.class);
  expect(snnComponent.getName()).andReturn("SECONDARY_NAMENODE").anyTimes();
  expect(snnComponent.getServiceComponentHost(anyObject(String.class))).andAnswer(new IAnswer<ServiceComponentHost>(){
    @Override public ServiceComponentHost answer() throws Throwable {
      Object[] args=getCurrentArguments();
      return snnServiceComponentHosts.get((String)args[0]);
    }
  }
).anyTimes();
  expect(snnComponent.getServiceComponentHosts()).andReturn(snnServiceComponentHosts).anyTimes();
  expect(snnComponent.isClientComponent()).andReturn(false).anyTimes();
  final ServiceComponent dnComponent=createMock(ServiceComponent.class);
  expect(dnComponent.getName()).andReturn("DATANODE").anyTimes();
  expect(dnComponent.getServiceComponentHost(anyObject(String.class))).andAnswer(new IAnswer<ServiceComponentHost>(){
    @Override public ServiceComponentHost answer() throws Throwable {
      Object[] args=getCurrentArguments();
      return dnServiceComponentHosts.get((String)args[0]);
    }
  }
).anyTimes();
  expect(dnComponent.getServiceComponentHosts()).andReturn(dnServiceComponentHosts).anyTimes();
  expect(dnComponent.isClientComponent()).andReturn(false).anyTimes();
  final ServiceComponent hbmComponent=createMock(ServiceComponent.class);
  expect(hbmComponent.getName()).andReturn("HBASE_MASTER").anyTimes();
  expect(hbmComponent.getServiceComponentHost(anyObject(String.class))).andAnswer(new IAnswer<ServiceComponentHost>(){
    @Override public ServiceComponentHost answer() throws Throwable {
      Object[] args=getCurrentArguments();
      return hbmServiceComponentHosts.get((String)args[0]);
    }
  }
).anyTimes();
  expect(hbmComponent.getServiceComponentHosts()).andReturn(hbmServiceComponentHosts).anyTimes();
  expect(hbmComponent.isClientComponent()).andReturn(false).anyTimes();
  final ServiceComponent hbrsComponent=createMock(ServiceComponent.class);
  expect(hbrsComponent.getName()).andReturn("HBASE_REGIONSERVER").anyTimes();
  expect(hbrsComponent.getServiceComponentHost(anyObject(String.class))).andAnswer(new IAnswer<ServiceComponentHost>(){
    @Override public ServiceComponentHost answer() throws Throwable {
      Object[] args=getCurrentArguments();
      return hbrsServiceComponentHosts.get((String)args[0]);
    }
  }
).anyTimes();
  Map<String,ServiceComponentHost> hbrsHosts=Maps.filterKeys(hbrsServiceComponentHosts,new Predicate<String>(){
    @Override public boolean apply(    String s){
      return s.equals("h1");
    }
  }
);
  expect(hbrsComponent.getServiceComponentHosts()).andReturn(hbrsServiceComponentHosts).anyTimes();
  expect(hbrsComponent.isClientComponent()).andReturn(false).anyTimes();
  final ServiceComponent mrjtComponent=createMock(ServiceComponent.class);
  expect(mrjtComponent.getName()).andReturn("JOBTRACKER").anyTimes();
  expect(mrjtComponent.getServiceComponentHost(anyObject(String.class))).andAnswer(new IAnswer<ServiceComponentHost>(){
    @Override public ServiceComponentHost answer() throws Throwable {
      Object[] args=getCurrentArguments();
      return mrjtServiceComponentHosts.get((String)args[0]);
    }
  }
).anyTimes();
  expect(mrjtComponent.getServiceComponentHosts()).andReturn(mrjtServiceComponentHosts).anyTimes();
  expect(mrjtComponent.isClientComponent()).andReturn(false).anyTimes();
  final ServiceComponent mrttCompomnent=createMock(ServiceComponent.class);
  expect(mrttCompomnent.getName()).andReturn("TASKTRACKER").anyTimes();
  expect(mrttCompomnent.getServiceComponentHost(anyObject(String.class))).andAnswer(new IAnswer<ServiceComponentHost>(){
    @Override public ServiceComponentHost answer() throws Throwable {
      Object[] args=getCurrentArguments();
      return mrttServiceComponentHosts.get((String)args[0]);
    }
  }
).anyTimes();
  expect(mrttCompomnent.getServiceComponentHosts()).andReturn(mrttServiceComponentHosts).anyTimes();
  expect(mrttCompomnent.isClientComponent()).andReturn(false).anyTimes();
  final ServiceComponent nnsComponent=createMock(ServiceComponent.class);
  expect(nnsComponent.getName()).andReturn("NONAME_SERVER").anyTimes();
  expect(nnsComponent.getServiceComponentHost(anyObject(String.class))).andAnswer(new IAnswer<ServiceComponentHost>(){
    @Override public ServiceComponentHost answer() throws Throwable {
      Object[] args=getCurrentArguments();
      return nnsServiceComponentHosts.get((String)args[0]);
    }
  }
).anyTimes();
  expect(nnsComponent.getServiceComponentHosts()).andReturn(nnsServiceComponentHosts).anyTimes();
  expect(nnsComponent.isClientComponent()).andReturn(false).anyTimes();
  final Service hdfsService=createMock(Service.class);
  expect(hdfsService.getServiceComponents()).andReturn(new HashMap<String,ServiceComponent>(){
{
      put("NAMENODE",nnComponent);
      put("SECONDARY_NAMENODE",snnComponent);
      put("DATANODE",dnComponent);
    }
  }
).anyTimes();
  final Service hbaseService=createMock(Service.class);
  expect(hbaseService.getServiceComponents()).andReturn(new HashMap<String,ServiceComponent>(){
{
      put("HBASE_MASTER",hbmComponent);
      put("HBASE_REGIONSERVER",hbrsComponent);
    }
  }
).anyTimes();
  final Service mrService=createMock(Service.class);
  expect(mrService.getServiceComponents()).andReturn(new HashMap<String,ServiceComponent>(){
{
      put("JOBTRACKER",mrjtComponent);
      put("TASKTRACKER",mrttCompomnent);
    }
  }
).anyTimes();
  final Service nnService=createMock(Service.class);
  expect(nnService.getServiceComponents()).andReturn(new HashMap<String,ServiceComponent>(){
{
      put("NONAME_SERVER",nnsComponent);
    }
  }
).anyTimes();
  Cluster cluster=createMock(Cluster.class);
  expect(cluster.getHosts()).andReturn(hosts).anyTimes();
  expect(cluster.getServices()).andReturn(new HashMap<String,Service>(){
{
      put("HDFS",hdfsService);
      put("HBASE",hbaseService);
      put("MAPREDUCE",mrService);
      put("NONAME",nnService);
    }
  }
).anyTimes();
  final TopologyManager topologyManager=injector.getInstance(TopologyManager.class);
  topologyManager.getPendingHostComponents();
  expectLastCall().andReturn(projectedTopology).once();
  replayAll();
  injector.getInstance(AmbariMetaInfo.class).init();
  Map<String,Set<String>> info=StageUtils.getClusterHostInfo(cluster);
  verifyAll();
  Set<String> allHosts=info.get(StageUtils.HOSTS_LIST);
  assertEquals(hosts.size(),allHosts.size());
  for (  Host host : hosts) {
    assertTrue(allHosts.contains(host.getHostName()));
  }
  checkServiceHostIndexes(info,"DATANODE","slave_hosts",projectedTopology,hostNames);
  checkServiceHostIndexes(info,"NAMENODE","namenode_host",projectedTopology,hostNames);
  checkServiceHostIndexes(info,"SECONDARY_NAMENODE","snamenode_host",projectedTopology,hostNames);
  checkServiceHostIndexes(info,"HBASE_MASTER","hbase_master_hosts",projectedTopology,hostNames);
  checkServiceHostIndexes(info,"HBASE_REGIONSERVER","hbase_rs_hosts",projectedTopology,hostNames);
  checkServiceHostIndexes(info,"JOBTRACKER","jtnode_host",projectedTopology,hostNames);
  checkServiceHostIndexes(info,"TASKTRACKER","mapred_tt_hosts",projectedTopology,hostNames);
  checkServiceHostIndexes(info,"NONAME_SERVER","noname_server_hosts",projectedTopology,hostNames);
  Set<String> actualPingPorts=info.get(StageUtils.PORTS);
  if (pingPorts.contains(null)) {
    assertEquals(new HashSet<Integer>(pingPorts).size(),actualPingPorts.size() + 1);
  }
 else {
    assertEquals(new HashSet<Integer>(pingPorts).size(),actualPingPorts.size());
  }
  List<Integer> pingPortsActual=getRangeMappedDecompressedSet(actualPingPorts);
  List<Integer> reindexedPorts=getReindexedList(pingPortsActual,new ArrayList<String>(allHosts),hostNames);
  List<Integer> expectedPingPorts=new ArrayList<Integer>(pingPorts);
  for (int i=0; i < expectedPingPorts.size(); i++) {
    if (expectedPingPorts.get(i) == null) {
      expectedPingPorts.set(i,StageUtils.DEFAULT_PING_PORT);
    }
  }
  assertEquals(expectedPingPorts,reindexedPorts);
  assertTrue(info.containsKey("decom_tt_hosts"));
  Set<String> decommissionedHosts=info.get("decom_tt_hosts");
  assertEquals(2,decommissionedHosts.toString().split(",").length);
  assertTrue(info.containsKey(StageUtils.AMBARI_SERVER_HOST));
  Set<String> serverHost=info.get(StageUtils.AMBARI_SERVER_HOST);
  assertEquals(1,serverHost.size());
  assertEquals(StageUtils.getHostName(),serverHost.iterator().next());
  assertTrue(getDecompressedSet(info.get("hbase_rs_hosts")).contains(9));
  info=StageUtils.substituteHostIndexes(info);
  checkServiceHostNames(info,"DATANODE","slave_hosts",projectedTopology);
  checkServiceHostNames(info,"NAMENODE","namenode_host",projectedTopology);
  checkServiceHostNames(info,"SECONDARY_NAMENODE","snamenode_host",projectedTopology);
  checkServiceHostNames(info,"HBASE_MASTER","hbase_master_hosts",projectedTopology);
  checkServiceHostNames(info,"HBASE_REGIONSERVER","hbase_rs_hosts",projectedTopology);
  checkServiceHostNames(info,"JOBTRACKER","jtnode_host",projectedTopology);
  checkServiceHostNames(info,"TASKTRACKER","mapred_tt_hosts",projectedTopology);
  checkServiceHostNames(info,"NONAME_SERVER","noname_server_hosts",projectedTopology);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.utils.TestParallel </h4><pre class="type-4 type-12 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests {@link org.apache.ambari.server.utils.Parallel} forLoop iteration exceptions
 * @throws Exception
 */
@Test public void testParallelForLoopIterationExceptions() throws Exception {
  final List<Integer> input=new LinkedList<Integer>();
  for (int i=0; i < 10; i++) {
    input.add(i);
  }
  final List<Integer> failForList=Arrays.asList(new Integer[]{2,5,7});
  ParallelLoopResult<Integer> loopResult=Parallel.forLoop(input,new LoopBody<Integer,Integer>(){
    @Override public Integer run(    Integer in1){
      if (failForList.contains(in1)) {
        throw new RuntimeException("Ignore this exception");
      }
      return in1 * in1;
    }
  }
);
  Assert.assertFalse(loopResult.getIsCompleted());
  Assert.assertNotNull(loopResult.getResult());
  List<Integer> output=loopResult.getResult();
  Assert.assertEquals(input.size(),output.size());
  for (int i=0; i < input.size(); i++) {
    if (failForList.contains(i)) {
      Assert.assertNull(output.get(i));
      output.set(i,i * i);
    }
 else {
      Assert.assertEquals(i * i,(int)output.get(i));
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-12 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests {@link org.apache.ambari.server.utils.Parallel} forLoop iteration failures
 * @throws Exception
 */
@Test public void testParallelForLoopIterationFailures() throws Exception {
  final List<Integer> input=new LinkedList<Integer>();
  for (int i=0; i < 10; i++) {
    input.add(i);
  }
  final List<Integer> failForList=Arrays.asList(new Integer[]{2,5,7});
  ParallelLoopResult<Integer> loopResult=Parallel.forLoop(input,new LoopBody<Integer,Integer>(){
    @Override public Integer run(    Integer in1){
      if (failForList.contains(in1)) {
        return null;
      }
      return in1 * in1;
    }
  }
);
  Assert.assertFalse(loopResult.getIsCompleted());
  Assert.assertNotNull(loopResult.getResult());
  List<Integer> output=loopResult.getResult();
  Assert.assertEquals(input.size(),output.size());
  for (int i=0; i < input.size(); i++) {
    if (failForList.contains(i)) {
      Assert.assertNull(output.get(i));
      output.set(i,i * i);
    }
 else {
      Assert.assertEquals(i * i,(int)output.get(i));
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.utils.TestShellCommandUtil </h4><pre class="type-4 type-13 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUnixFilePermissions() throws Exception {
  File dummyFile=new File(temp.getRoot() + File.separator + "dummy");
  new FileOutputStream(dummyFile).close();
  if (ShellCommandUtil.LINUX) {
    ShellCommandUtil.setUnixFilePermissions("600",dummyFile.getAbsolutePath());
    String p=ShellCommandUtil.getUnixFilePermissions(dummyFile.getAbsolutePath());
    assertEquals("600",p);
    ShellCommandUtil.setUnixFilePermissions("444",dummyFile.getAbsolutePath());
    p=ShellCommandUtil.getUnixFilePermissions(dummyFile.getAbsolutePath());
    assertEquals("444",p);
    ShellCommandUtil.setUnixFilePermissions("777",dummyFile.getAbsolutePath());
    p=ShellCommandUtil.getUnixFilePermissions(dummyFile.getAbsolutePath());
    assertEquals("777",p);
  }
 else {
    ShellCommandUtil.setUnixFilePermissions(ShellCommandUtil.MASK_OWNER_ONLY_RW,dummyFile.getAbsolutePath());
    String p=ShellCommandUtil.getUnixFilePermissions(dummyFile.getAbsolutePath());
    assertEquals(p,ShellCommandUtil.MASK_EVERYBODY_RWX);
  }
}

</code></pre>

<br>
<pre class="type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRunCommand() throws Exception {
  ShellCommandUtil.Result result=null;
  if (ShellCommandUtil.LINUX) {
    result=ShellCommandUtil.runCommand(new String[]{"echo","dummy"});
    assertEquals(0,result.getExitCode());
    assertEquals("dummy\n",result.getStdout());
    assertEquals("",result.getStderr());
    assertTrue(result.isSuccessful());
    result=ShellCommandUtil.runCommand(new String[]{"false"});
    assertEquals(1,result.getExitCode());
    assertFalse(result.isSuccessful());
  }
 else {
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.view.ViewExtractorTest </h4><pre class="type-4 type-13 type-2 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testEnsureExtractedArchiveDirectory() throws Exception {
  ResourceTypeEntity resourceTypeEntity=new ResourceTypeEntity();
  resourceTypeEntity.setId(10);
  resourceTypeEntity.setName("MY_VIEW{1.0.0}");
  ViewEntity viewDefinition=ViewEntityTest.getViewEntity();
  viewDefinition.setResourceType(resourceTypeEntity);
  expect(extractedArchiveDir.exists()).andReturn(true);
  replay(extractedArchiveDir,viewArchive,archiveDir,entryFile,classesDir,libDir,metaInfDir,viewJarFile,jarEntry,fos,configuration,viewDir,fileEntry,viewDAO);
  ViewExtractor viewExtractor=getViewExtractor(viewDefinition);
  if (System.getProperty("os.name").contains("Windows")) {
    Assert.assertTrue(viewExtractor.ensureExtractedArchiveDirectory("\\var\\lib\\ambari-server\\resources\\views\\work"));
  }
 else {
    Assert.assertTrue(viewExtractor.ensureExtractedArchiveDirectory("/var/lib/ambari-server/resources/views/work"));
  }
  verify(extractedArchiveDir,viewArchive,archiveDir,entryFile,classesDir,libDir,metaInfDir,viewJarFile,jarEntry,fos,configuration,viewDir,fileEntry,viewDAO);
  reset(extractedArchiveDir);
  expect(extractedArchiveDir.exists()).andReturn(false);
  expect(extractedArchiveDir.mkdir()).andReturn(true);
  replay(extractedArchiveDir);
  viewExtractor=getViewExtractor(viewDefinition);
  if (System.getProperty("os.name").contains("Windows")) {
    Assert.assertTrue(viewExtractor.ensureExtractedArchiveDirectory("\\var\\lib\\ambari-server\\resources\\views\\work"));
  }
 else {
    Assert.assertTrue(viewExtractor.ensureExtractedArchiveDirectory("/var/lib/ambari-server/resources/views/work"));
  }
  verify(extractedArchiveDir);
  reset(extractedArchiveDir);
  expect(extractedArchiveDir.exists()).andReturn(false);
  expect(extractedArchiveDir.mkdir()).andReturn(false);
  replay(extractedArchiveDir);
  viewExtractor=getViewExtractor(viewDefinition);
  if (System.getProperty("os.name").contains("Windows")) {
    Assert.assertFalse(viewExtractor.ensureExtractedArchiveDirectory("\\var\\lib\\ambari-server\\resources\\views\\work"));
  }
 else {
    Assert.assertFalse(viewExtractor.ensureExtractedArchiveDirectory("/var/lib/ambari-server/resources/views/work"));
  }
  verify(extractedArchiveDir);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.view.ViewRegistryTest </h4><pre class="type-4 type-13 type-2 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testExtractViewArchive() throws Exception {
  File viewDir=createNiceMock(File.class);
  File extractedArchiveDir=createNiceMock(File.class);
  File viewArchive=createNiceMock(File.class);
  File archiveDir=createNiceMock(File.class);
  File entryFile=createNiceMock(File.class);
  File classesDir=createNiceMock(File.class);
  File libDir=createNiceMock(File.class);
  File metaInfDir=createNiceMock(File.class);
  File fileEntry=createNiceMock(File.class);
  JarInputStream viewJarFile=createNiceMock(JarInputStream.class);
  JarEntry jarEntry=createNiceMock(JarEntry.class);
  InputStream is=createMock(InputStream.class);
  FileOutputStream fos=createMock(FileOutputStream.class);
  ViewExtractor viewExtractor=createMock(ViewExtractor.class);
  ResourceTypeEntity resourceTypeEntity=new ResourceTypeEntity();
  resourceTypeEntity.setId(10);
  resourceTypeEntity.setName("MY_VIEW{1.0.0}");
  ViewEntity viewDefinition=ViewEntityTest.getViewEntity();
  viewDefinition.setResourceType(resourceTypeEntity);
  Set<ViewInstanceEntity> viewInstanceEntities=ViewInstanceEntityTest.getViewInstanceEntities(viewDefinition);
  viewDefinition.setInstances(viewInstanceEntities);
  Map<File,ViewConfig> viewConfigs=Collections.singletonMap(viewArchive,viewDefinition.getConfiguration());
  long resourceId=99L;
  for (  ViewInstanceEntity viewInstanceEntity : viewInstanceEntities) {
    ResourceEntity resourceEntity=new ResourceEntity();
    resourceEntity.setId(resourceId);
    resourceEntity.setResourceType(resourceTypeEntity);
    viewInstanceEntity.setResource(resourceEntity);
  }
  Map<String,File> files=new HashMap<String,File>();
  if (System.getProperty("os.name").contains("Windows")) {
    files.put("\\var\\lib\\ambari-server\\resources\\views\\my_view-1.0.0.jar",viewArchive);
    files.put("\\var\\lib\\ambari-server\\resources\\views\\work",extractedArchiveDir);
    files.put("\\var\\lib\\ambari-server\\resources\\views\\work\\MY_VIEW{1.0.0}",archiveDir);
    files.put("\\var\\lib\\ambari-server\\resources\\views\\work\\MY_VIEW{1.0.0}\\view.xml",entryFile);
    files.put("\\var\\lib\\ambari-server\\resources\\views\\work\\MY_VIEW{1.0.0}\\WEB-INF\\classes",classesDir);
    files.put("\\var\\lib\\ambari-server\\resources\\views\\work\\MY_VIEW{1.0.0}\\WEB-INF\\lib",libDir);
    files.put("\\var\\lib\\ambari-server\\resources\\views\\work\\MY_VIEW{1.0.0}\\META-INF",metaInfDir);
  }
 else {
    files.put("/var/lib/ambari-server/resources/views/my_view-1.0.0.jar",viewArchive);
    files.put("/var/lib/ambari-server/resources/views/work",extractedArchiveDir);
    files.put("/var/lib/ambari-server/resources/views/work/MY_VIEW{1.0.0}",archiveDir);
    files.put("/var/lib/ambari-server/resources/views/work/MY_VIEW{1.0.0}/view.xml",entryFile);
    files.put("/var/lib/ambari-server/resources/views/work/MY_VIEW{1.0.0}/WEB-INF/classes",classesDir);
    files.put("/var/lib/ambari-server/resources/views/work/MY_VIEW{1.0.0}/WEB-INF/lib",libDir);
    files.put("/var/lib/ambari-server/resources/views/work/MY_VIEW{1.0.0}/META-INF",metaInfDir);
  }
  Map<File,FileOutputStream> outputStreams=new HashMap<File,FileOutputStream>();
  outputStreams.put(entryFile,fos);
  Map<File,JarInputStream> jarFiles=new HashMap<File,JarInputStream>();
  jarFiles.put(viewArchive,viewJarFile);
  expect(configuration.getViewsDir()).andReturn(viewDir);
  if (System.getProperty("os.name").contains("Windows")) {
    expect(viewDir.getAbsolutePath()).andReturn("\\var\\lib\\ambari-server\\resources\\views");
  }
 else {
    expect(viewDir.getAbsolutePath()).andReturn("/var/lib/ambari-server/resources/views");
  }
  expect(configuration.getViewExtractionThreadPoolCoreSize()).andReturn(2).anyTimes();
  expect(configuration.getViewExtractionThreadPoolMaxSize()).andReturn(3).anyTimes();
  expect(configuration.getViewExtractionThreadPoolTimeout()).andReturn(10000L).anyTimes();
  if (System.getProperty("os.name").contains("Windows")) {
    expect(viewArchive.getAbsolutePath()).andReturn("\\var\\lib\\ambari-server\\resources\\views\\work\\MY_VIEW{1.0.0}").anyTimes();
  }
 else {
    expect(viewArchive.getAbsolutePath()).andReturn("/var/lib/ambari-server/resources/views/work/MY_VIEW{1.0.0}").anyTimes();
  }
  expect(archiveDir.exists()).andReturn(false);
  if (System.getProperty("os.name").contains("Windows")) {
    expect(archiveDir.getAbsolutePath()).andReturn("\\var\\lib\\ambari-server\\resources\\views\\work\\MY_VIEW{1.0.0}").anyTimes();
  }
 else {
    expect(archiveDir.getAbsolutePath()).andReturn("/var/lib/ambari-server/resources/views/work/MY_VIEW{1.0.0}").anyTimes();
  }
  Capture<ViewEntity> viewEntityCapture=new Capture<ViewEntity>();
  if (System.getProperty("os.name").contains("Windows")) {
    expect(viewExtractor.ensureExtractedArchiveDirectory("\\var\\lib\\ambari-server\\resources\\views\\work")).andReturn(true);
  }
 else {
    expect(viewExtractor.ensureExtractedArchiveDirectory("/var/lib/ambari-server/resources/views/work")).andReturn(true);
  }
  expect(viewExtractor.extractViewArchive(capture(viewEntityCapture),eq(viewArchive),eq(archiveDir))).andReturn(null);
  replay(configuration,viewDir,extractedArchiveDir,viewArchive,archiveDir,entryFile,classesDir,libDir,metaInfDir,fileEntry,viewJarFile,jarEntry,is,fos,viewExtractor,resourceDAO,viewDAO,viewInstanceDAO);
  TestViewArchiveUtility archiveUtility=new TestViewArchiveUtility(viewConfigs,files,outputStreams,jarFiles,false);
  TestViewModule module=new TestViewModule(viewExtractor,archiveUtility,configuration);
  if (System.getProperty("os.name").contains("Windows")) {
    Assert.assertTrue(ViewRegistry.extractViewArchive("\\var\\lib\\ambari-server\\resources\\views\\my_view-1.0.0.jar",module,true));
  }
 else {
    Assert.assertTrue(ViewRegistry.extractViewArchive("/var/lib/ambari-server/resources/views/my_view-1.0.0.jar",module,true));
  }
  verify(configuration,viewDir,extractedArchiveDir,viewArchive,archiveDir,entryFile,classesDir,libDir,metaInfDir,fileEntry,viewJarFile,jarEntry,is,fos,viewExtractor,resourceDAO,viewDAO,viewInstanceDAO);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.view.configuration.PropertyConfigTest </h4><pre class="type-13 type-2 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testGetValue() throws Exception {
  List<InstanceConfig> instanceConfigs=InstanceConfigTest.getInstanceConfigs();
  for (  InstanceConfig instanceConfig : instanceConfigs) {
    List<PropertyConfig> propertyConfigs=instanceConfig.getProperties();
    Assert.assertTrue(propertyConfigs.size() <= 2);
    Assert.assertTrue(propertyConfigs.get(0).getValue().startsWith("v1-"));
    if (propertyConfigs.size() == 2) {
      Assert.assertTrue(propertyConfigs.get(1).getValue().startsWith("v2-"));
    }
  }
}

</code></pre>

<br>
<pre class="type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetKey() throws Exception {
  List<InstanceConfig> instanceConfigs=InstanceConfigTest.getInstanceConfigs();
  for (  InstanceConfig instanceConfig : instanceConfigs) {
    List<PropertyConfig> propertyConfigs=instanceConfig.getProperties();
    Assert.assertTrue(propertyConfigs.size() <= 2);
    Assert.assertEquals("p1",propertyConfigs.get(0).getKey());
    if (propertyConfigs.size() == 2) {
      Assert.assertEquals("p2",propertyConfigs.get(1).getKey());
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.applicationhistoryservice.metrics.timeline.aggregators.ITClusterAggregator </h4><pre class="type-12 type-13 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testShouldAggregateDifferentMetricsOnHourProperly() throws Exception {
  TimelineMetricAggregator agg=TimelineMetricAggregatorFactory.createTimelineClusterAggregatorHourly(hdb,getConfigurationForTest(false));
  long startTime=System.currentTimeMillis();
  long ctime=startTime;
  long minute=60 * 1000;
  Map<TimelineClusterMetric,MetricClusterAggregate> records=new HashMap<TimelineClusterMetric,MetricClusterAggregate>();
  records.put(createEmptyTimelineClusterMetric("disk_used",ctime),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric("disk_free",ctime),new MetricClusterAggregate(1.0,2,0.0,1.0,1.0));
  records.put(createEmptyTimelineClusterMetric("disk_used",ctime+=minute),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric("disk_free",ctime),new MetricClusterAggregate(1.0,2,0.0,1.0,1.0));
  records.put(createEmptyTimelineClusterMetric("disk_used",ctime+=minute),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric("disk_free",ctime),new MetricClusterAggregate(1.0,2,0.0,1.0,1.0));
  records.put(createEmptyTimelineClusterMetric("disk_used",ctime+=minute),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric("disk_free",ctime),new MetricClusterAggregate(1.0,2,0.0,1.0,1.0));
  hdb.saveClusterAggregateRecords(records);
  agg.doWork(startTime,ctime + minute);
  ResultSet rs=executeQuery("SELECT * FROM METRIC_AGGREGATE_HOURLY");
  int count=0;
  while (rs.next()) {
    if ("disk_used".equals(rs.getString("METRIC_NAME"))) {
      assertEquals("APP_ID","test_app",rs.getString("APP_ID"));
      assertEquals("METRIC_SUM",16.0,rs.getDouble("METRIC_SUM"));
      assertEquals("METRIC_COUNT",8,rs.getLong("METRIC_COUNT"));
      assertEquals("METRIC_MAX",4.0,rs.getDouble("METRIC_MAX"));
      assertEquals("METRIC_MIN",0.0,rs.getDouble("METRIC_MIN"));
    }
 else     if ("disk_free".equals(rs.getString("METRIC_NAME"))) {
      assertEquals("APP_ID","test_app",rs.getString("APP_ID"));
      assertEquals("METRIC_SUM",4.0,rs.getDouble("METRIC_SUM"));
      assertEquals("METRIC_COUNT",8,rs.getLong("METRIC_COUNT"));
      assertEquals("METRIC_MAX",1.0,rs.getDouble("METRIC_MAX"));
      assertEquals("METRIC_MIN",1.0,rs.getDouble("METRIC_MIN"));
    }
    count++;
  }
  assertEquals("Two hourly aggregated row expected ",2,count);
}

</code></pre>

<br>
<pre class="type-12 type-13 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAggregationUsingGroupByQuery() throws Exception {
  TimelineMetricAggregator agg=TimelineMetricAggregatorFactory.createTimelineClusterAggregatorHourly(hdb,getConfigurationForTest(true));
  long startTime=System.currentTimeMillis();
  long ctime=startTime;
  long minute=60 * 1000;
  Map<TimelineClusterMetric,MetricClusterAggregate> records=new HashMap<TimelineClusterMetric,MetricClusterAggregate>();
  records.put(createEmptyTimelineClusterMetric("disk_used",ctime+=minute),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric("disk_free",ctime),new MetricClusterAggregate(1.0,2,0.0,1.0,1.0));
  records.put(createEmptyTimelineClusterMetric("disk_used",ctime+=minute),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric("disk_free",ctime),new MetricClusterAggregate(1.0,2,0.0,1.0,1.0));
  records.put(createEmptyTimelineClusterMetric("disk_used",ctime+=minute),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric("disk_free",ctime),new MetricClusterAggregate(1.0,2,0.0,1.0,1.0));
  records.put(createEmptyTimelineClusterMetric("disk_used",ctime+=minute),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric("disk_free",ctime),new MetricClusterAggregate(1.0,2,0.0,1.0,1.0));
  hdb.saveClusterAggregateRecords(records);
  agg.doWork(startTime,ctime + minute);
  ResultSet rs=executeQuery("SELECT * FROM METRIC_AGGREGATE_HOURLY");
  int count=0;
  while (rs.next()) {
    if ("disk_used".equals(rs.getString("METRIC_NAME"))) {
      assertEquals("APP_ID","test_app",rs.getString("APP_ID"));
      assertEquals("METRIC_SUM",16.0,rs.getDouble("METRIC_SUM"));
      assertEquals("METRIC_COUNT",8,rs.getLong("METRIC_COUNT"));
      assertEquals("METRIC_MAX",4.0,rs.getDouble("METRIC_MAX"));
      assertEquals("METRIC_MIN",0.0,rs.getDouble("METRIC_MIN"));
    }
 else     if ("disk_free".equals(rs.getString("METRIC_NAME"))) {
      assertEquals("APP_ID","test_app",rs.getString("APP_ID"));
      assertEquals("METRIC_SUM",4.0,rs.getDouble("METRIC_SUM"));
      assertEquals("METRIC_COUNT",8,rs.getLong("METRIC_COUNT"));
      assertEquals("METRIC_MAX",1.0,rs.getDouble("METRIC_MAX"));
      assertEquals("METRIC_MIN",1.0,rs.getDouble("METRIC_MIN"));
    }
    count++;
  }
  assertEquals("Two hourly aggregated row expected ",2,count);
}

</code></pre>

<br>
<pre class="type-12 type-13 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShouldAggregateClusterOnMinuteProperly() throws Exception {
  TimelineMetricAggregator agg=TimelineMetricAggregatorFactory.createTimelineClusterAggregatorMinute(hdb,getConfigurationForTest(false));
  long startTime=System.currentTimeMillis();
  long ctime=startTime;
  long second=1000;
  long minute=60 * second;
  Map<TimelineClusterMetric,MetricClusterAggregate> records=new HashMap<TimelineClusterMetric,MetricClusterAggregate>();
  records.put(createEmptyTimelineClusterMetric(ctime),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric(ctime+=second),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric(ctime+=second),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric(ctime+=second),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  hdb.saveClusterAggregateRecords(records);
  agg.doWork(startTime,ctime + second);
  long oldCtime=ctime + second;
  ctime=startTime + minute;
  records.put(createEmptyTimelineClusterMetric(ctime),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric(ctime+=second),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric(ctime+=second),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric(ctime+=second),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  hdb.saveClusterAggregateRecords(records);
  agg.doWork(oldCtime,ctime + second);
  ResultSet rs=executeQuery("SELECT * FROM METRIC_AGGREGATE_MINUTE");
  int count=0;
  long diff=0;
  while (rs.next()) {
    assertEquals("METRIC_NAME","disk_used",rs.getString("METRIC_NAME"));
    assertEquals("APP_ID","test_app",rs.getString("APP_ID"));
    assertEquals("METRIC_SUM",16.0,rs.getDouble("METRIC_SUM"));
    assertEquals("METRIC_COUNT",8,rs.getLong("METRIC_COUNT"));
    assertEquals("METRIC_MAX",4.0,rs.getDouble("METRIC_MAX"));
    assertEquals("METRIC_MIN",0.0,rs.getDouble("METRIC_MIN"));
    if (count == 0) {
      diff+=rs.getLong("SERVER_TIME");
    }
 else {
      diff-=rs.getLong("SERVER_TIME");
      if (diff < 0) {
        diff*=-1;
      }
      assertTrue(diff == minute);
    }
    count++;
  }
  assertEquals("One hourly aggregated row expected ",2,count);
}

</code></pre>

<br>
<pre class="type-4 type-12 type-13 type-10 type-2 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testClusterAggregateMetricNormalization() throws Exception {
  TimelineMetricAggregator agg=TimelineMetricAggregatorFactory.createTimelineClusterAggregatorSecond(hdb,getConfigurationForTest(false),new TimelineMetricMetadataManager(hdb,new Configuration()));
  TimelineMetricReadHelper readHelper=new TimelineMetricReadHelper(false);
  TimelineMetric metric1=new TimelineMetric();
  metric1.setMetricName("yarn.ClusterMetrics.NumActiveNMs");
  metric1.setAppId("resourcemanager");
  metric1.setHostName("h1");
  metric1.setStartTime(1431372311811l);
  metric1.setMetricValues(new TreeMap<Long,Double>(){
{
      put(1431372311811l,1.0);
      put(1431372321811l,1.0);
      put(1431372331811l,1.0);
      put(1431372341811l,1.0);
      put(1431372351811l,1.0);
      put(1431372361811l,1.0);
      put(1431372371810l,1.0);
    }
  }
);
  TimelineMetric metric2=new TimelineMetric();
  metric2.setMetricName("yarn.ClusterMetrics.NumActiveNMs");
  metric2.setAppId("resourcemanager");
  metric2.setHostName("h1");
  metric2.setStartTime(1431372381810l);
  metric2.setMetricValues(new TreeMap<Long,Double>(){
{
      put(1431372381810l,1.0);
      put(1431372391811l,1.0);
      put(1431372401811l,1.0);
      put(1431372411811l,1.0);
      put(1431372421811l,1.0);
      put(1431372431811l,1.0);
      put(1431372441810l,1.0);
    }
  }
);
  TimelineMetrics metrics=new TimelineMetrics();
  metrics.setMetrics(Collections.singletonList(metric1));
  insertMetricRecords(conn,metrics,1431372371810l);
  metrics.setMetrics(Collections.singletonList(metric2));
  insertMetricRecords(conn,metrics,1431372441810l);
  long startTime=1431372055000l;
  long endTime=1431372655000l;
  agg.doWork(startTime,endTime);
  Condition condition=new DefaultCondition(null,null,null,null,startTime,endTime,null,null,true);
  condition.setStatement(String.format(GET_CLUSTER_AGGREGATE_SQL,PhoenixTransactSQL.getNaiveTimeRangeHint(startTime,NATIVE_TIME_RANGE_DELTA),METRICS_CLUSTER_AGGREGATE_TABLE_NAME));
  PreparedStatement pstmt=PhoenixTransactSQL.prepareGetMetricsSqlStmt(conn,condition);
  ResultSet rs=pstmt.executeQuery();
  int recordCount=0;
  while (rs.next()) {
    TimelineClusterMetric currentMetric=metricReader.fromResultSet(rs);
    MetricClusterAggregate currentHostAggregate=readHelper.getMetricClusterAggregateFromResultSet(rs);
    if ("yarn.ClusterMetrics.NumActiveNMs".equals(currentMetric.getMetricName())) {
      assertEquals(1,currentHostAggregate.getNumberOfHosts());
      assertEquals(1.0,currentHostAggregate.getMax());
      assertEquals(1.0,currentHostAggregate.getMin());
      assertEquals(1.0,currentHostAggregate.getSum());
      recordCount++;
    }
 else {
      fail("Unexpected entry");
    }
  }
  Assert.assertEquals(5,recordCount);
}

</code></pre>

<br>
<pre class="type-4 type-12 type-13 type-10 type-2 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShouldAggregateClusterIgnoringInstance() throws Exception {
  TimelineMetricAggregator agg=TimelineMetricAggregatorFactory.createTimelineClusterAggregatorSecond(hdb,getConfigurationForTest(false),new TimelineMetricMetadataManager(hdb,new Configuration()));
  TimelineMetricReadHelper readHelper=new TimelineMetricReadHelper(false);
  long startTime=System.currentTimeMillis();
  long ctime=startTime;
  long minute=60 * 1000 * 2;
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime - 100,"local1","i1","disk_free",1));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime - 100,"local2","i1","disk_free",2));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime + 100,"local1","i2","disk_free",3));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime + 100,"local2","i2","disk_free",4));
  ctime+=minute;
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime - 100,"local1","i1","disk_free",1));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime - 100,"local2","i1","disk_free",3));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime + 100,"local1","i2","disk_free",2));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime + 100,"local2","i2","disk_free",4));
  long endTime=ctime + minute;
  boolean success=agg.doWork(startTime - 1000,endTime + 1000);
  Condition condition=new DefaultCondition(null,null,null,null,startTime,endTime,null,null,true);
  condition.setStatement(String.format(GET_CLUSTER_AGGREGATE_SQL,PhoenixTransactSQL.getNaiveTimeRangeHint(startTime,NATIVE_TIME_RANGE_DELTA),METRICS_CLUSTER_AGGREGATE_TABLE_NAME));
  PreparedStatement pstmt=PhoenixTransactSQL.prepareGetMetricsSqlStmt(conn,condition);
  ResultSet rs=pstmt.executeQuery();
  int recordCount=0;
  while (rs.next()) {
    TimelineClusterMetric currentMetric=metricReader.fromResultSet(rs);
    MetricClusterAggregate currentHostAggregate=readHelper.getMetricClusterAggregateFromResultSet(rs);
    if ("disk_free".equals(currentMetric.getMetricName())) {
      System.out.println("OUTPUT: " + currentMetric + " - "+ currentHostAggregate);
      assertEquals(2,currentHostAggregate.getNumberOfHosts());
      assertEquals(5.0,Math.floor(currentHostAggregate.getSum()));
      recordCount++;
    }
 else {
      fail("Unexpected entry");
    }
  }
  Assert.assertEquals(5,recordCount);
}

</code></pre>

<br>
<pre class="type-4 type-12 type-13 type-10 type-2 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShouldAggregateDifferentMetricsOnClusterProperly() throws Exception {
  TimelineMetricAggregator agg=TimelineMetricAggregatorFactory.createTimelineClusterAggregatorSecond(hdb,getConfigurationForTest(false),new TimelineMetricMetadataManager(hdb,new Configuration()));
  TimelineMetricReadHelper readHelper=new TimelineMetricReadHelper(false);
  long startTime=System.currentTimeMillis();
  long ctime=startTime;
  long minute=60 * 1000;
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime,"local1","disk_free",1));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime,"local2","disk_free",2));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime,"local1","disk_used",1));
  ctime+=2 * minute;
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime,"local1","disk_free",2));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime,"local2","disk_free",1));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime,"local1","disk_used",1));
  long endTime=ctime + minute;
  boolean success=agg.doWork(startTime,endTime);
  Condition condition=new DefaultCondition(null,null,null,null,startTime,endTime,null,null,true);
  condition.setStatement(String.format(GET_CLUSTER_AGGREGATE_SQL,PhoenixTransactSQL.getNaiveTimeRangeHint(startTime,NATIVE_TIME_RANGE_DELTA),METRICS_CLUSTER_AGGREGATE_TABLE_NAME));
  PreparedStatement pstmt=PhoenixTransactSQL.prepareGetMetricsSqlStmt(conn,condition);
  ResultSet rs=pstmt.executeQuery();
  int recordCount=0;
  while (rs.next()) {
    TimelineClusterMetric currentMetric=metricReader.fromResultSet(rs);
    MetricClusterAggregate currentHostAggregate=readHelper.getMetricClusterAggregateFromResultSet(rs);
    if ("disk_free".equals(currentMetric.getMetricName())) {
      assertEquals(2,currentHostAggregate.getNumberOfHosts());
      assertEquals(2.0,currentHostAggregate.getMax());
      assertEquals(1.0,currentHostAggregate.getMin());
      assertEquals(3.0,currentHostAggregate.getSum());
      recordCount++;
    }
 else     if ("disk_used".equals(currentMetric.getMetricName())) {
      assertEquals(1,currentHostAggregate.getNumberOfHosts());
      assertEquals(1.0,currentHostAggregate.getMax());
      assertEquals(1.0,currentHostAggregate.getMin());
      assertEquals(1.0,currentHostAggregate.getSum());
      recordCount++;
    }
 else {
      fail("Unexpected entry");
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-12 type-13 type-10 type-2 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShouldAggregateClusterProperly() throws Exception {
  TimelineMetricAggregator agg=TimelineMetricAggregatorFactory.createTimelineClusterAggregatorSecond(hdb,getConfigurationForTest(false),new TimelineMetricMetadataManager(hdb,new Configuration()));
  TimelineMetricReadHelper readHelper=new TimelineMetricReadHelper(false);
  long startTime=System.currentTimeMillis();
  long ctime=startTime;
  long minute=60 * 1000;
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime,"local1","disk_free",1));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime,"local2","disk_free",2));
  ctime+=2 * minute;
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime,"local1","disk_free",2));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime,"local2","disk_free",1));
  long endTime=ctime + minute;
  boolean success=agg.doWork(startTime,endTime);
  Condition condition=new DefaultCondition(null,null,null,null,startTime,endTime,null,null,true);
  condition.setStatement(String.format(GET_CLUSTER_AGGREGATE_SQL,PhoenixTransactSQL.getNaiveTimeRangeHint(startTime,NATIVE_TIME_RANGE_DELTA),METRICS_CLUSTER_AGGREGATE_TABLE_NAME));
  PreparedStatement pstmt=PhoenixTransactSQL.prepareGetMetricsSqlStmt(conn,condition);
  ResultSet rs=pstmt.executeQuery();
  int recordCount=0;
  while (rs.next()) {
    TimelineClusterMetric currentMetric=metricReader.fromResultSet(rs);
    MetricClusterAggregate currentHostAggregate=readHelper.getMetricClusterAggregateFromResultSet(rs);
    if ("disk_free".equals(currentMetric.getMetricName())) {
      assertEquals(2,currentHostAggregate.getNumberOfHosts());
      assertEquals(2.0,currentHostAggregate.getMax());
      assertEquals(1.0,currentHostAggregate.getMin());
      assertEquals(3.0,currentHostAggregate.getSum());
      recordCount++;
    }
 else {
      fail("Unexpected entry");
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.applicationhistoryservice.metrics.timeline.aggregators.ITMetricAggregator </h4><pre class="type-4 type-12 type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShouldAggregateHourProperly() throws Exception {
  TimelineMetricAggregator aggregator=TimelineMetricAggregatorFactory.createTimelineMetricAggregatorHourly(hdb,getConfigurationForTest(false));
  TimelineMetricReadHelper readHelper=new TimelineMetricReadHelper(false);
  long startTime=System.currentTimeMillis();
  MetricHostAggregate expectedAggregate=MetricTestHelper.createMetricHostAggregate(2.0,0.0,20,15.0);
  Map<TimelineMetric,MetricHostAggregate> aggMap=new HashMap<TimelineMetric,MetricHostAggregate>();
  int min_5=5 * 60 * 1000;
  long ctime=startTime - min_5;
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  hdb.saveHostAggregateRecords(aggMap,METRICS_AGGREGATE_MINUTE_TABLE_NAME);
  long endTime=ctime + min_5;
  boolean success=aggregator.doWork(startTime,endTime);
  assertTrue(success);
  Condition condition=new DefaultCondition(null,null,null,null,startTime,endTime,null,null,true);
  condition.setStatement(String.format(GET_METRIC_AGGREGATE_ONLY_SQL,PhoenixTransactSQL.getNaiveTimeRangeHint(startTime,NATIVE_TIME_RANGE_DELTA),METRICS_AGGREGATE_HOURLY_TABLE_NAME));
  PreparedStatement pstmt=PhoenixTransactSQL.prepareGetMetricsSqlStmt(conn,condition);
  ResultSet rs=pstmt.executeQuery();
  while (rs.next()) {
    TimelineMetric currentMetric=readHelper.getTimelineMetricKeyFromResultSet(rs);
    MetricHostAggregate currentHostAggregate=readHelper.getMetricHostAggregateFromResultSet(rs);
    if ("disk_used".equals(currentMetric.getMetricName())) {
      assertEquals(2.0,currentHostAggregate.getMax());
      assertEquals(0.0,currentHostAggregate.getMin());
      assertEquals(12 * 20,currentHostAggregate.getNumberOfSamples());
      assertEquals(12 * 15.0,currentHostAggregate.getSum());
      assertEquals(15.0 / 20,currentHostAggregate.getAvg());
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-12 type-13 type-10 type-2 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShouldAggregateMinuteProperly() throws Exception {
  TimelineMetricAggregator aggregatorMinute=TimelineMetricAggregatorFactory.createTimelineMetricAggregatorMinute(hdb,getConfigurationForTest(false));
  TimelineMetricReadHelper readHelper=new TimelineMetricReadHelper(false);
  long startTime=System.currentTimeMillis();
  long ctime=startTime;
  long minute=60 * 1000;
  hdb.insertMetricRecords(prepareTimelineMetrics(startTime,"local"));
  hdb.insertMetricRecords(prepareTimelineMetrics(ctime+=minute,"local"));
  hdb.insertMetricRecords(prepareTimelineMetrics(ctime+=minute,"local"));
  hdb.insertMetricRecords(prepareTimelineMetrics(ctime+=minute,"local"));
  hdb.insertMetricRecords(prepareTimelineMetrics(ctime+=minute,"local"));
  long endTime=startTime + 1000 * 60 * 4;
  boolean success=aggregatorMinute.doWork(startTime,endTime);
  Condition condition=new DefaultCondition(null,null,null,null,startTime,endTime,null,null,true);
  condition.setStatement(String.format(GET_METRIC_AGGREGATE_ONLY_SQL,PhoenixTransactSQL.getNaiveTimeRangeHint(startTime,NATIVE_TIME_RANGE_DELTA),METRICS_AGGREGATE_MINUTE_TABLE_NAME));
  PreparedStatement pstmt=PhoenixTransactSQL.prepareGetMetricsSqlStmt(conn,condition);
  ResultSet rs=pstmt.executeQuery();
  MetricHostAggregate expectedAggregate=MetricTestHelper.createMetricHostAggregate(2.0,0.0,20,15.0);
  int count=0;
  while (rs.next()) {
    TimelineMetric currentMetric=readHelper.getTimelineMetricKeyFromResultSet(rs);
    MetricHostAggregate currentHostAggregate=readHelper.getMetricHostAggregateFromResultSet(rs);
    if ("disk_free".equals(currentMetric.getMetricName())) {
      assertEquals(2.0,currentHostAggregate.getMax());
      assertEquals(0.0,currentHostAggregate.getMin());
      assertEquals(20,currentHostAggregate.getNumberOfSamples());
      assertEquals(15.0,currentHostAggregate.getSum());
      assertEquals(15.0 / 20,currentHostAggregate.getAvg());
      count++;
    }
 else     if ("mem_free".equals(currentMetric.getMetricName())) {
      assertEquals(2.0,currentHostAggregate.getMax());
      assertEquals(0.0,currentHostAggregate.getMin());
      assertEquals(20,currentHostAggregate.getNumberOfSamples());
      assertEquals(15.0,currentHostAggregate.getSum());
      assertEquals(15.0 / 20,currentHostAggregate.getAvg());
      count++;
    }
 else {
      fail("Unexpected entry");
    }
  }
  assertEquals("Two aggregated entries expected",2,count);
}

</code></pre>

<br>
<pre class="type-4 type-12 type-13 type-10 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAggregationUsingGroupByQuery() throws Exception {
  TimelineMetricAggregator aggregatorMinute=TimelineMetricAggregatorFactory.createTimelineMetricAggregatorMinute(hdb,getConfigurationForTest(true));
  TimelineMetricReadHelper readHelper=new TimelineMetricReadHelper(false);
  long startTime=System.currentTimeMillis();
  long ctime=startTime;
  long minute=60 * 1000;
  hdb.insertMetricRecords(prepareTimelineMetrics(startTime,"local"));
  hdb.insertMetricRecords(prepareTimelineMetrics(ctime+=minute,"local"));
  hdb.insertMetricRecords(prepareTimelineMetrics(ctime+=minute,"local"));
  hdb.insertMetricRecords(prepareTimelineMetrics(ctime+=minute,"local"));
  hdb.insertMetricRecords(prepareTimelineMetrics(ctime+=minute,"local"));
  long endTime=startTime + 1000 * 60 * 4;
  boolean success=aggregatorMinute.doWork(startTime,endTime);
  assertTrue(success);
  Condition condition=new DefaultCondition(null,null,null,null,startTime,endTime,null,null,true);
  condition.setStatement(String.format(GET_METRIC_AGGREGATE_ONLY_SQL,PhoenixTransactSQL.getNaiveTimeRangeHint(startTime,NATIVE_TIME_RANGE_DELTA),METRICS_AGGREGATE_MINUTE_TABLE_NAME));
  PreparedStatement pstmt=PhoenixTransactSQL.prepareGetMetricsSqlStmt(conn,condition);
  ResultSet rs=pstmt.executeQuery();
  MetricHostAggregate expectedAggregate=MetricTestHelper.createMetricHostAggregate(2.0,0.0,20,15.0);
  int count=0;
  while (rs.next()) {
    TimelineMetric currentMetric=readHelper.getTimelineMetricKeyFromResultSet(rs);
    MetricHostAggregate currentHostAggregate=readHelper.getMetricHostAggregateFromResultSet(rs);
    if ("disk_free".equals(currentMetric.getMetricName())) {
      assertEquals(2.0,currentHostAggregate.getMax());
      assertEquals(0.0,currentHostAggregate.getMin());
      assertEquals(20,currentHostAggregate.getNumberOfSamples());
      assertEquals(15.0,currentHostAggregate.getSum());
      assertEquals(15.0 / 20,currentHostAggregate.getAvg());
      count++;
    }
 else     if ("mem_free".equals(currentMetric.getMetricName())) {
      assertEquals(2.0,currentHostAggregate.getMax());
      assertEquals(0.0,currentHostAggregate.getMin());
      assertEquals(20,currentHostAggregate.getNumberOfSamples());
      assertEquals(15.0,currentHostAggregate.getSum());
      assertEquals(15.0 / 20,currentHostAggregate.getAvg());
      count++;
    }
 else {
      fail("Unexpected entry");
    }
  }
  assertEquals("Two aggregated entries expected",2,count);
}

</code></pre>

<br>
<pre class="type-4 type-12 type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMetricAggregateDaily() throws Exception {
  TimelineMetricAggregator aggregator=TimelineMetricAggregatorFactory.createTimelineMetricAggregatorDaily(hdb,getConfigurationForTest(false));
  TimelineMetricReadHelper readHelper=new TimelineMetricReadHelper(false);
  long startTime=System.currentTimeMillis();
  MetricHostAggregate expectedAggregate=MetricTestHelper.createMetricHostAggregate(2.0,0.0,20,15.0);
  Map<TimelineMetric,MetricHostAggregate> aggMap=new HashMap<TimelineMetric,MetricHostAggregate>();
  int min_5=5 * 60 * 1000;
  long ctime=startTime - min_5;
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  hdb.saveHostAggregateRecords(aggMap,METRICS_AGGREGATE_HOURLY_TABLE_NAME);
  long endTime=ctime + min_5;
  boolean success=aggregator.doWork(startTime,endTime);
  assertTrue(success);
  Condition condition=new DefaultCondition(null,null,null,null,startTime,endTime,null,null,true);
  condition.setStatement(String.format(GET_METRIC_AGGREGATE_ONLY_SQL,PhoenixTransactSQL.getNaiveTimeRangeHint(startTime,NATIVE_TIME_RANGE_DELTA),METRICS_AGGREGATE_DAILY_TABLE_NAME));
  PreparedStatement pstmt=PhoenixTransactSQL.prepareGetMetricsSqlStmt(conn,condition);
  ResultSet rs=pstmt.executeQuery();
  while (rs.next()) {
    TimelineMetric currentMetric=readHelper.getTimelineMetricKeyFromResultSet(rs);
    MetricHostAggregate currentHostAggregate=readHelper.getMetricHostAggregateFromResultSet(rs);
    if ("disk_used".equals(currentMetric.getMetricName())) {
      assertEquals(2.0,currentHostAggregate.getMax());
      assertEquals(0.0,currentHostAggregate.getMin());
      assertEquals(12 * 20,currentHostAggregate.getNumberOfSamples());
      assertEquals(12 * 15.0,currentHostAggregate.getSum());
      assertEquals(15.0 / 20,currentHostAggregate.getAvg());
    }
  }
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
