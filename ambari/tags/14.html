<h3><span class=" glyphicon glyphicon-tag"/>&nbspIgnoredMethod</h3><kbd>Is not executed with the test suite</kbd><br><br><br><h4 style="margin:0px">Class: org.apache.ambari.server.actionmanager.TestActionManager </h4><pre class="type-2 type-1 type-14 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Ignore @Test public void testCascadeDeleteStages() throws Exception {
  ActionDBAccessor db=injector.getInstance(ActionDBAccessorImpl.class);
  ActionManager am=injector.getInstance(ActionManager.class);
  populateActionDB(db,hostname);
  assertEquals(1,clusters.getClusters().size());
  clusters.getCluster(clusterName);
  clusters.deleteCluster(clusterName);
  assertEquals(0,clusters.getClusters().size());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.api.rest.KdcServerConnectionVerificationTest </h4><pre class="type-2 type-5 type-14 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test @Ignore public void testValidate__Live() throws Exception {
  KdcServerConnectionVerification kdcConnVerifier=new KdcServerConnectionVerification(configuration);
  boolean result=kdcConnVerifier.isKdcReachable("c6501:88");
  assertTrue(result);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.controller.AmbariManagementControllerImplTest </h4><pre class="type-2 type-15 type-14 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Ensure that processing update request does not fail on configuration
 * properties with no value specified (no value = null reference value)
 * TODO disabled for now as tests nothing, check what exactly should be tested here
 * updateCluster request was noop due to equality on cluster and request configs (both contained null)
 * mocks are too limited to pass further these base checks
 */
@Test @Ignore public void testUpdateClustersWithNullConfigPropertyValues() throws Exception {
  Capture<AmbariManagementController> controllerCapture=new Capture<AmbariManagementController>();
  Injector injector=createStrictMock(Injector.class);
  Cluster cluster=createNiceMock(Cluster.class);
  ActionManager actionManager=createNiceMock(ActionManager.class);
  ClusterRequest clusterRequest=createNiceMock(ClusterRequest.class);
  Set<ClusterRequest> setRequests=Collections.singleton(clusterRequest);
  KerberosHelper kerberosHelper=createStrictMock(KerberosHelper.class);
  injector.injectMembers(capture(controllerCapture));
  expect(injector.getInstance(Gson.class)).andReturn(null);
  expect(injector.getInstance(MaintenanceStateHelper.class)).andReturn(null);
  expect(injector.getInstance(KerberosHelper.class)).andReturn(kerberosHelper);
  expect(clusterRequest.getClusterName()).andReturn("clusterNew").anyTimes();
  expect(clusterRequest.getClusterId()).andReturn(1L).anyTimes();
  ConfigurationRequest configReq=new ConfigurationRequest();
  final Map<String,String> configReqProps=Maps.newHashMap();
  configReqProps.put("p1",null);
  configReq.setProperties(configReqProps);
  expect(clusterRequest.getDesiredConfig()).andReturn(ImmutableList.of(configReq)).anyTimes();
  expect(clusters.getClusterById(1L)).andReturn(cluster).anyTimes();
  expect(cluster.getClusterName()).andReturn("clusterOld").anyTimes();
  expect(cluster.getConfigPropertiesTypes(anyObject(String.class))).andReturn(Maps.<PropertyInfo.PropertyType,Set<String>>newHashMap()).anyTimes();
  expect(cluster.getDesiredConfigByType(anyObject(String.class))).andReturn(new ConfigImpl("config-type"){
    @Override public Map<String,Map<String,String>> getPropertiesAttributes(){
      return Maps.newHashMap();
    }
    @Override public Map<String,String> getProperties(){
      return configReqProps;
    }
  }
).anyTimes();
  cluster.addSessionAttributes(anyObject(Map.class));
  expectLastCall().once();
  cluster.setClusterName("clusterNew");
  expectLastCall();
  replay(actionManager,cluster,clusters,injector,clusterRequest,sessionManager);
  AmbariManagementController controller=new AmbariManagementControllerImpl(actionManager,clusters,injector);
  controller.updateClusters(setRequests,null);
  assertSame(controller,controllerCapture.getValue());
  verify(actionManager,cluster,clusters,injector,clusterRequest,sessionManager);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.controller.AmbariManagementControllerTest </h4><pre class="type-13 type-2 type-1 type-14 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test @Ignore("Unsuported feature !") public void testConfigsAttachedToServiceNotCluster() throws AmbariException, AuthorizationException {
  String clusterName="foo1";
  createCluster(clusterName);
  clusters.getCluster(clusterName).setDesiredStackVersion(new StackId("HDP-0.1"));
  String serviceName="HDFS";
  createService(clusterName,serviceName,null);
  String componentName1="NAMENODE";
  String componentName2="DATANODE";
  String componentName3="HDFS_CLIENT";
  createServiceComponent(clusterName,serviceName,componentName1,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName2,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName3,State.INIT);
  String host1="h1";
  String host2="h2";
  addHostToCluster(host1,clusterName);
  addHostToCluster(host2,clusterName);
  createServiceComponentHost(clusterName,null,componentName1,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName2,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName2,host2,null);
  createServiceComponentHost(clusterName,serviceName,componentName3,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName3,host2,null);
  Map<String,String> configs=new HashMap<String,String>();
  configs.put("a","b");
  ConfigurationRequest cr1, cr2;
  cr1=new ConfigurationRequest(clusterName,"core-site","version1",configs,null);
  cr2=new ConfigurationRequest(clusterName,"hdfs-site","version1",configs,null);
  controller.createConfiguration(cr1);
  controller.createConfiguration(cr2);
  Map<String,String> configVersions=new HashMap<String,String>(){
{
      put("core-site","version1");
      put("hdfs-site","version1");
    }
  }
;
  ServiceRequest sr=new ServiceRequest(clusterName,serviceName,null);
  ServiceResourceProviderTest.updateServices(controller,Collections.singleton(sr),new HashMap<String,String>(),false,false);
  installService(clusterName,serviceName,false,false);
  long requestId=startService(clusterName,serviceName,true,false);
  Assert.assertEquals(0,clusters.getCluster(clusterName).getDesiredConfigs().size());
  List<Stage> stages=actionDB.getAllStages(requestId);
  boolean serviceCheckFound=false;
  for (  Stage stage : stages) {
    for (    HostRoleCommand hrc : stage.getOrderedHostRoleCommands()) {
      if (hrc.getRole().equals(Role.HDFS_SERVICE_CHECK)) {
        serviceCheckFound=true;
        Assert.assertEquals(2,hrc.getExecutionCommandWrapper().getExecutionCommand().getConfigurationTags().size());
      }
    }
  }
  Assert.assertEquals(true,serviceCheckFound);
}

</code></pre>

<br>
<pre class="type-4 type-10 type-2 type-5 type-1 type-14 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Ignore @Test public void testUpdateClusterVersionBasic() throws AmbariException, AuthorizationException {
  String clusterName="foo1";
  String serviceName="MAPREDUCE";
  String host1="h1";
  String host2="h2";
  String componentName="JOBTRACKER";
  StackId currentStackId=new StackId("HDP-0.1");
  Map<String,String> mapRequestProps=new HashMap<String,String>();
  mapRequestProps.put("context","Called from a test");
  createCluster(clusterName);
  Cluster c=clusters.getCluster(clusterName);
  c.setDesiredStackVersion(currentStackId);
  createService(clusterName,serviceName,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName,null);
  addHostToCluster(host1,clusterName);
  addHostToCluster(host2,clusterName);
  createServiceComponentHost(clusterName,null,componentName,host1,null);
  createServiceComponentHost(clusterName,null,componentName,host2,null);
  c.getService(serviceName).setDesiredState(State.INSTALLED);
  c.getService(serviceName).getServiceComponent(componentName).setDesiredState(State.INSTALLED);
  c.getService(serviceName).getServiceComponent(componentName).getServiceComponentHost(host1).setDesiredState(State.INSTALLED);
  c.getService(serviceName).getServiceComponent(componentName).getServiceComponentHost(host2).setDesiredState(State.STARTED);
  c.getService(serviceName).getServiceComponent(componentName).getServiceComponentHost(host1).setState(State.INSTALLED);
  c.getService(serviceName).getServiceComponent(componentName).getServiceComponentHost(host2).setState(State.STARTED);
  c.getService(serviceName).getServiceComponent(componentName).getServiceComponentHost(host1).setStackVersion(currentStackId);
  c.getService(serviceName).getServiceComponent(componentName).getServiceComponentHost(host2).setStackVersion(currentStackId);
  ClusterRequest r=new ClusterRequest(c.getClusterId(),clusterName,"HDP-0.0.1",null);
  try {
    controller.updateClusters(Collections.singleton(r),mapRequestProps);
    fail("Update cluster should fail");
  }
 catch (  AmbariException e) {
    Assert.assertTrue(e.getMessage().contains("must be greater than current version"));
  }
  r=new ClusterRequest(c.getClusterId(),clusterName,"HDPLocal-1.2.2",null);
  try {
    controller.updateClusters(Collections.singleton(r),mapRequestProps);
    fail("Update cluster should fail");
  }
 catch (  AmbariException e) {
    Assert.assertTrue(e.getMessage().contains("Upgrade not possible between different stacks"));
  }
  r=new ClusterRequest(c.getClusterId(),clusterName,"HDP-0.2",null);
  try {
    controller.updateClusters(Collections.singleton(r),mapRequestProps);
    fail("Update cluster should fail");
  }
 catch (  AmbariException e) {
    Assert.assertTrue(e.getMessage().contains("Upgrade needs all services to be stopped"));
    Assert.assertTrue(e.getMessage().contains(serviceName));
  }
  c.getService(serviceName).getServiceComponent(componentName).getServiceComponentHost(host2).setDesiredState(State.INSTALLED);
  r=new ClusterRequest(c.getClusterId(),clusterName,"HDP-0.2",null);
  try {
    controller.updateClusters(Collections.singleton(r),mapRequestProps);
    fail("Update cluster should fail");
  }
 catch (  AmbariException e) {
    Assert.assertTrue(e.getMessage().contains("Upgrade needs all services to be stopped"));
    Assert.assertTrue(e.getMessage().contains(componentName));
  }
  c.getService(serviceName).getServiceComponent(componentName).getServiceComponentHost(host2).setState(State.INSTALLED);
  controller.updateClusters(Collections.singleton(r),mapRequestProps);
  StackId expectedStackId=new StackId("HDP-0.2");
  Assert.assertTrue(expectedStackId.equals(c.getDesiredStackVersion()));
  Assert.assertTrue(expectedStackId.equals(c.getService(serviceName).getDesiredStackVersion()));
  Assert.assertTrue(expectedStackId.equals(c.getService(serviceName).getServiceComponent(componentName).getDesiredStackVersion()));
  Assert.assertTrue(expectedStackId.equals(c.getService(serviceName).getServiceComponent(componentName).getServiceComponentHost(host1).getDesiredStackVersion()));
  Assert.assertTrue(expectedStackId.equals(c.getService(serviceName).getServiceComponent(componentName).getServiceComponentHost(host2).getDesiredStackVersion()));
  Assert.assertTrue(currentStackId.equals(c.getService(serviceName).getServiceComponent(componentName).getServiceComponentHost(host1).getStackVersion()));
  Assert.assertTrue(currentStackId.equals(c.getService(serviceName).getServiceComponent(componentName).getServiceComponentHost(host2).getStackVersion()));
  ServiceComponent sc=c.getService(serviceName).getServiceComponent(componentName);
  Assert.assertEquals(State.UPGRADING,sc.getServiceComponentHost(host1).getState());
  Assert.assertEquals(State.UPGRADING,sc.getServiceComponentHost(host2).getState());
  try {
    controller.updateClusters(Collections.singleton(r),mapRequestProps);
    fail("Update cluster should fail");
  }
 catch (  AmbariException e) {
    Assert.assertTrue(e.getMessage().contains("A prior upgrade request with id"));
  }
  c.getService(serviceName).getServiceComponent(componentName).getServiceComponentHost(host1).setDesiredState(State.INSTALLED);
  c.getService(serviceName).getServiceComponent(componentName).getServiceComponentHost(host2).setDesiredState(State.INSTALLED);
  c.getService(serviceName).getServiceComponent(componentName).getServiceComponentHost(host1).setState(State.INSTALLED);
  c.getService(serviceName).getServiceComponent(componentName).getServiceComponentHost(host2).setState(State.INSTALLED);
  c.setCurrentStackVersion(expectedStackId);
  r=new ClusterRequest(c.getClusterId(),clusterName,"",null);
  controller.updateClusters(Collections.singleton(r),mapRequestProps);
  Assert.assertEquals(State.INSTALLED,sc.getServiceComponentHost(host1).getState());
  Assert.assertEquals(State.INSTALLED,sc.getServiceComponentHost(host2).getState());
  r=new ClusterRequest(c.getClusterId(),clusterName,null,null);
  controller.updateClusters(Collections.singleton(r),mapRequestProps);
  Assert.assertEquals(State.INSTALLED,sc.getServiceComponentHost(host1).getState());
  Assert.assertEquals(State.INSTALLED,sc.getServiceComponentHost(host2).getState());
  r=new ClusterRequest(c.getClusterId(),clusterName,"HDP-0.2",null);
  controller.updateClusters(Collections.singleton(r),mapRequestProps);
  Assert.assertEquals(State.INSTALLED,sc.getServiceComponentHost(host1).getState());
  Assert.assertEquals(State.INSTALLED,sc.getServiceComponentHost(host2).getState());
}

</code></pre>

<br>
<pre class="type-2 type-1 type-14 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@SuppressWarnings("serial") @Ignore @Test public void testDeleteUsers() throws Exception {
  createUser("user1");
  UserRequest request=new UserRequest("user1");
  controller.updateUsers(Collections.singleton(request));
  request=new UserRequest("user1");
  controller.deleteUsers(Collections.singleton(request));
  Set<UserResponse> responses=controller.getUsers(Collections.singleton(new UserRequest(null)));
  Assert.assertEquals(0,responses.size());
}

</code></pre>

<br>
<pre class="type-14 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Is not executed with the test suite
- Executes methods or other tests from the same test unit
"></span><br>
@Ignore @Test public void testUpdateClusterVersionCombinations() throws AmbariException, AuthorizationException {
  String clusterName="foo1";
  String pigServiceName="PIG";
  String mrServiceName="MAPREDUCE";
  String host1="h1";
  String host2="h2";
  String pigComponentName="PIG";
  String mrJobTrackerComp="JOBTRACKER";
  String mrTaskTrackerComp="TASKTRACKER";
  String mrClientComp="MAPREDUCE_CLIENT";
  String hdfsService="HDFS";
  String hdfsNameNode="NAMENODE";
  String hdfsDataNode="DATANODE";
  String hdfsClient="HDFS_CLIENT";
  StackId currentStackId=new StackId("HDP-0.1");
  StackId desiredStackId=new StackId("HDP-0.2");
  List<String> hosts=new ArrayList<String>();
  hosts.add(host1);
  hosts.add(host2);
  Map<String,String> mapRequestProps=new HashMap<String,String>();
  mapRequestProps.put("context","Called from a test");
  createCluster(clusterName);
  Cluster c=clusters.getCluster(clusterName);
  c.setDesiredStackVersion(currentStackId);
  createService(clusterName,pigServiceName,State.INIT);
  createServiceComponent(clusterName,pigServiceName,pigComponentName,null);
  addHostToCluster(host1,clusterName);
  addHostToCluster(host2,clusterName);
  createServiceComponentHost(clusterName,null,pigComponentName,host1,null);
  createServiceComponentHost(clusterName,null,pigComponentName,host2,null);
  resetServiceState(pigServiceName,currentStackId,c);
  ClusterRequest r=new ClusterRequest(c.getClusterId(),clusterName,"HDP-0.2",null);
  RequestStatusResponse trackAction=controller.updateClusters(Collections.singleton(r),mapRequestProps);
  List<Stage> stages=actionDB.getAllStages(trackAction.getRequestId());
  ExpectedUpgradeTasks expectedTasks=new ExpectedUpgradeTasks(hosts);
  expectedTasks.expectTask(Role.PIG,host1);
  expectedTasks.expectTask(Role.PIG,host2);
  expectedTasks.expectTask(Role.AMBARI_SERVER_ACTION);
  validateGeneratedStages(stages,2,expectedTasks);
  resetCluster(c,currentStackId);
  createService(clusterName,mrServiceName,State.INIT);
  createServiceComponent(clusterName,mrServiceName,mrJobTrackerComp,null);
  createServiceComponent(clusterName,mrServiceName,mrTaskTrackerComp,null);
  createServiceComponent(clusterName,mrServiceName,mrClientComp,null);
  createServiceComponentHost(clusterName,null,mrJobTrackerComp,host1,null);
  createServiceComponentHost(clusterName,null,mrTaskTrackerComp,host2,null);
  createServiceComponentHost(clusterName,null,mrClientComp,host2,null);
  resetServiceState(mrServiceName,currentStackId,c);
  actionDB.abortOperation(trackAction.getRequestId());
  r=new ClusterRequest(c.getClusterId(),clusterName,"HDP-0.2",null);
  trackAction=controller.updateClusters(Collections.singleton(r),mapRequestProps);
  stages=actionDB.getAllStages(trackAction.getRequestId());
  expectedTasks.expectTask(Role.JOBTRACKER,host1);
  expectedTasks.expectTask(Role.TASKTRACKER,host2);
  expectedTasks.expectTask(Role.MAPREDUCE_CLIENT,host2);
  validateGeneratedStages(stages,5,expectedTasks);
  actionDB.abortOperation(trackAction.getRequestId());
  trackAction=controller.updateClusters(Collections.singleton(r),mapRequestProps);
  stages=actionDB.getAllStages(trackAction.getRequestId());
  validateGeneratedStages(stages,5,expectedTasks);
  c.getService(pigServiceName).getServiceComponent(pigComponentName).getServiceComponentHost(host1).setState(State.INSTALLED);
  c.getService(pigServiceName).getServiceComponent(pigComponentName).getServiceComponentHost(host2).setState(State.INSTALLED);
  c.getService(pigServiceName).getServiceComponent(pigComponentName).getServiceComponentHost(host1).setStackVersion(desiredStackId);
  c.getService(pigServiceName).getServiceComponent(pigComponentName).getServiceComponentHost(host2).setStackVersion(desiredStackId);
  actionDB.abortOperation(trackAction.getRequestId());
  trackAction=controller.updateClusters(Collections.singleton(r),mapRequestProps);
  stages=actionDB.getAllStages(trackAction.getRequestId());
  validateGeneratedStages(stages,5,expectedTasks);
  c.getService(mrServiceName).getServiceComponent(mrJobTrackerComp).getServiceComponentHost(host1).setState(State.UPGRADING);
  c.getService(mrServiceName).getServiceComponent(mrTaskTrackerComp).getServiceComponentHost(host2).setState(State.UPGRADING);
  actionDB.abortOperation(trackAction.getRequestId());
  trackAction=controller.updateClusters(Collections.singleton(r),mapRequestProps);
  stages=actionDB.getAllStages(trackAction.getRequestId());
  validateGeneratedStages(stages,5,expectedTasks);
  createService(clusterName,hdfsService,State.INIT);
  createServiceComponent(clusterName,hdfsService,hdfsNameNode,null);
  createServiceComponent(clusterName,hdfsService,hdfsDataNode,null);
  createServiceComponent(clusterName,hdfsService,hdfsClient,null);
  createServiceComponentHost(clusterName,null,hdfsNameNode,host1,null);
  createServiceComponentHost(clusterName,null,hdfsDataNode,host1,null);
  createServiceComponentHost(clusterName,null,hdfsDataNode,host2,null);
  createServiceComponentHost(clusterName,null,hdfsClient,host2,null);
  resetServiceState(hdfsService,currentStackId,c);
  resetServiceState(mrServiceName,currentStackId,c);
  resetServiceState(pigServiceName,currentStackId,c);
  actionDB.abortOperation(trackAction.getRequestId());
  trackAction=controller.updateClusters(Collections.singleton(r),mapRequestProps);
  stages=actionDB.getAllStages(trackAction.getRequestId());
  expectedTasks.resetAll();
  expectedTasks.expectTask(Role.PIG,host1);
  expectedTasks.expectTask(Role.PIG,host2);
  expectedTasks.expectTask(Role.JOBTRACKER,host1);
  expectedTasks.expectTask(Role.TASKTRACKER,host2);
  expectedTasks.expectTask(Role.MAPREDUCE_CLIENT,host2);
  expectedTasks.expectTask(Role.DATANODE,host1);
  expectedTasks.expectTask(Role.DATANODE,host2);
  expectedTasks.expectTask(Role.NAMENODE,host1);
  expectedTasks.expectTask(Role.HDFS_CLIENT,host2);
  expectedTasks.expectTask(Role.AMBARI_SERVER_ACTION);
  validateGeneratedStages(stages,8,expectedTasks);
}

</code></pre>

<br>
<pre class="type-4 type-2 type-5 type-1 type-14 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Ignore @Test public void testServiceComponentHostUpdateStackId() throws Exception {
  String clusterName="foo1";
  createCluster(clusterName);
  String serviceName1="HDFS";
  createService(clusterName,serviceName1,null);
  String componentName1="NAMENODE";
  String componentName2="DATANODE";
  createServiceComponent(clusterName,serviceName1,componentName1,State.INIT);
  createServiceComponent(clusterName,serviceName1,componentName2,State.INIT);
  String host1="h1";
  String host2="h2";
  addHostToCluster(host1,clusterName);
  addHostToCluster(host2,clusterName);
  Set<ServiceComponentHostRequest> set1=new HashSet<ServiceComponentHostRequest>();
  ServiceComponentHostRequest r1=new ServiceComponentHostRequest(clusterName,serviceName1,componentName1,host1,State.INIT.toString());
  ServiceComponentHostRequest r2=new ServiceComponentHostRequest(clusterName,serviceName1,componentName1,host2,State.INIT.toString());
  ServiceComponentHostRequest r3=new ServiceComponentHostRequest(clusterName,serviceName1,componentName2,host1,State.INIT.toString());
  set1.add(r1);
  set1.add(r2);
  set1.add(r3);
  controller.createHostComponents(set1);
  Cluster c1=clusters.getCluster(clusterName);
  Service s1=c1.getService(serviceName1);
  ServiceComponent sc1=s1.getServiceComponent(componentName1);
  ServiceComponent sc2=s1.getServiceComponent(componentName2);
  ServiceComponentHost sch1=sc1.getServiceComponentHost(host1);
  ServiceComponentHost sch2=sc1.getServiceComponentHost(host2);
  ServiceComponentHost sch3=sc2.getServiceComponentHost(host1);
  s1.setDesiredState(State.INSTALLED);
  sc1.setDesiredState(State.INSTALLED);
  sc2.setDesiredState(State.INSTALLED);
  ServiceComponentHostRequest req1;
  ServiceComponentHostRequest req2;
  ServiceComponentHostRequest req3;
  Set<ServiceComponentHostRequest> reqs=new HashSet<ServiceComponentHostRequest>();
  StackId newStack=new StackId("HDP-0.2");
  StackId oldStack=new StackId("HDP-0.1");
  c1.setCurrentStackVersion(newStack);
  c1.setDesiredStackVersion(newStack);
  sch1.setState(State.INSTALLED);
  sch2.setState(State.UPGRADING);
  sch1.setDesiredState(State.INSTALLED);
  sch2.setDesiredState(State.INSTALLED);
  sch1.setStackVersion(oldStack);
  sch2.setStackVersion(oldStack);
  sch1.setDesiredStackVersion(newStack);
  sch2.setDesiredStackVersion(oldStack);
  reqs.clear();
  req1=new ServiceComponentHostRequest(clusterName,serviceName1,componentName1,host1,State.INSTALLED.toString());
  req1.setDesiredStackId("HDP-0.2");
  reqs.add(req1);
  req2=new ServiceComponentHostRequest(clusterName,serviceName1,componentName1,host2,State.INSTALLED.toString());
  req2.setDesiredStackId("HDP-0.2");
  reqs.add(req2);
  Map<String,String> mapRequestProps=new HashMap<String,String>();
  mapRequestProps.put("context","testServiceComponentHostUpdateStackId");
  RequestStatusResponse resp=updateHostComponents(reqs,mapRequestProps,true);
  List<Stage> stages=actionDB.getAllStages(resp.getRequestId());
  Assert.assertEquals(1,stages.size());
  Assert.assertEquals(2,stages.get(0).getOrderedHostRoleCommands().size());
  Assert.assertEquals("testServiceComponentHostUpdateStackId",stages.get(0).getRequestContext());
  Assert.assertEquals(State.UPGRADING,sch1.getState());
  Assert.assertEquals(State.UPGRADING,sch2.getState());
  sch1.refresh();
  Assert.assertTrue(sch1.getDesiredStackVersion().compareTo(newStack) == 0);
  sch2.refresh();
  Assert.assertTrue(sch2.getDesiredStackVersion().compareTo(newStack) == 0);
  for (  HostRoleCommand command : stages.get(0).getOrderedHostRoleCommands()) {
    ExecutionCommand execCommand=command.getExecutionCommandWrapper().getExecutionCommand();
    Assert.assertTrue(execCommand.getCommandParams().containsKey("source_stack_version"));
    Assert.assertTrue(execCommand.getCommandParams().containsKey("target_stack_version"));
    Assert.assertEquals(RoleCommand.UPGRADE,execCommand.getRoleCommand());
  }
  sch1.setState(State.INSTALLED);
  sch1.setDesiredState(State.INSTALLED);
  sch2.setState(State.UPGRADING);
  sch2.setDesiredState(State.INSTALLED);
  sch3.setState(State.UPGRADING);
  sch3.setDesiredState(State.INSTALLED);
  sch3.setStackVersion(oldStack);
  sch3.setDesiredStackVersion(newStack);
  reqs.clear();
  req1=new ServiceComponentHostRequest(clusterName,serviceName1,componentName1,host1,State.INSTALLED.toString());
  req1.setDesiredStackId("HDP-0.2");
  reqs.add(req1);
  req2=new ServiceComponentHostRequest(clusterName,serviceName1,componentName1,host2,State.INSTALLED.toString());
  req2.setDesiredStackId("HDP-0.2");
  reqs.add(req2);
  req3=new ServiceComponentHostRequest(clusterName,serviceName1,componentName2,host1,State.INSTALLED.toString());
  req3.setDesiredStackId("HDP-0.2");
  reqs.add(req3);
  resp=updateHostComponents(reqs,Collections.<String,String>emptyMap(),true);
  stages=actionDB.getAllStages(resp.getRequestId());
  Assert.assertEquals(2,stages.size());
  Assert.assertEquals(2,stages.get(0).getOrderedHostRoleCommands().size());
  Assert.assertEquals("",stages.get(0).getRequestContext());
  Assert.assertEquals(State.UPGRADING,sch1.getState());
  Assert.assertEquals(State.UPGRADING,sch2.getState());
  Assert.assertEquals(State.UPGRADING,sch3.getState());
  sch1.refresh();
  Assert.assertTrue(sch1.getDesiredStackVersion().compareTo(newStack) == 0);
  sch2.refresh();
  Assert.assertTrue(sch2.getDesiredStackVersion().compareTo(newStack) == 0);
  sch3.refresh();
  Assert.assertTrue(sch3.getDesiredStackVersion().compareTo(newStack) == 0);
  for (  Stage stage : stages) {
    for (    HostRoleCommand command : stage.getOrderedHostRoleCommands()) {
      ExecutionCommand execCommand=command.getExecutionCommandWrapper().getExecutionCommand();
      Assert.assertTrue(execCommand.getCommandParams().containsKey("source_stack_version"));
      Assert.assertTrue(execCommand.getCommandParams().containsKey("target_stack_version"));
      Assert.assertEquals("{\"stackName\":\"HDP\",\"stackVersion\":\"0.2\"}",execCommand.getCommandParams().get("target_stack_version"));
      Assert.assertEquals(RoleCommand.UPGRADE,execCommand.getRoleCommand());
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-2 type-5 type-1 type-11 type-14 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test @Ignore public void testDisableAndDeleteStates() throws Exception {
  Map<String,String> mapRequestProps=new HashMap<String,String>();
  Injector injector=Guice.createInjector(new AbstractModule(){
    @Override protected void configure(){
      Properties properties=new Properties();
      properties.setProperty(Configuration.SERVER_PERSISTENCE_TYPE_KEY,"in-memory");
      properties.setProperty(Configuration.METADATA_DIR_PATH,"src/test/resources/stacks");
      properties.setProperty(Configuration.SERVER_VERSION_FILE,"src/test/resources/version");
      properties.setProperty(Configuration.OS_VERSION_KEY,"centos5");
      properties.setProperty(Configuration.SHARED_RESOURCES_DIR_KEY,"src/test/resources/");
      try {
        install(new ControllerModule(properties));
        bind(AmbariEventPublisher.class).toInstance(EasyMock.createMock(AmbariEventPublisher.class));
      }
 catch (      Exception e) {
        throw new RuntimeException(e);
      }
    }
  }
);
  injector.getInstance(GuiceJpaInitializer.class);
  try {
    AmbariManagementController amc=injector.getInstance(AmbariManagementController.class);
    Clusters clusters=injector.getInstance(Clusters.class);
    Gson gson=new Gson();
    clusters.addHost("host1");
    clusters.addHost("host2");
    clusters.addHost("host3");
    Host host=clusters.getHost("host1");
    setOsFamily(host,"redhat","5.9");
    host.persist();
    host=clusters.getHost("host2");
    setOsFamily(host,"redhat","5.9");
    host.persist();
    host=clusters.getHost("host3");
    setOsFamily(host,"redhat","5.9");
    host.persist();
    ClusterRequest clusterRequest=new ClusterRequest(null,"c1","HDP-1.2.0",null);
    amc.createCluster(clusterRequest);
    Set<ServiceRequest> serviceRequests=new HashSet<ServiceRequest>();
    serviceRequests.add(new ServiceRequest("c1","HDFS",null));
    serviceRequests.add(new ServiceRequest("c1","HIVE",null));
    ServiceResourceProviderTest.createServices(amc,serviceRequests);
    Type confType=new TypeToken<Map<String,String>>(){
    }
.getType();
    ConfigurationRequest configurationRequest=new ConfigurationRequest("c1","core-site","version1",gson.<Map<String,String>>fromJson("{ \"fs.default.name\" : \"localhost:8020\"}",confType),null);
    amc.createConfiguration(configurationRequest);
    configurationRequest=new ConfigurationRequest("c1","hdfs-site","version1",gson.<Map<String,String>>fromJson("{ \"dfs.datanode.data.dir.perm\" : \"750\"}",confType),null);
    amc.createConfiguration(configurationRequest);
    configurationRequest=new ConfigurationRequest("c1","global","version1",gson.<Map<String,String>>fromJson("{ \"hive.server2.enable.doAs\" : \"true\"}",confType),null);
    amc.createConfiguration(configurationRequest);
    Assert.assertTrue(clusters.getCluster("c1").getDesiredConfigs().containsKey("hive-site"));
    serviceRequests.clear();
    serviceRequests.add(new ServiceRequest("c1","HDFS",null));
    ServiceResourceProviderTest.updateServices(amc,serviceRequests,mapRequestProps,true,false);
    Set<ServiceComponentRequest> serviceComponentRequests=new HashSet<ServiceComponentRequest>();
    serviceComponentRequests.add(new ServiceComponentRequest("c1","HDFS","NAMENODE",null));
    serviceComponentRequests.add(new ServiceComponentRequest("c1","HDFS","SECONDARY_NAMENODE",null));
    serviceComponentRequests.add(new ServiceComponentRequest("c1","HDFS","DATANODE",null));
    serviceComponentRequests.add(new ServiceComponentRequest("c1","HDFS","HDFS_CLIENT",null));
    ComponentResourceProviderTest.createComponents(amc,serviceComponentRequests);
    Set<HostRequest> hostRequests=new HashSet<HostRequest>();
    hostRequests.add(new HostRequest("host1","c1",null));
    hostRequests.add(new HostRequest("host2","c1",null));
    hostRequests.add(new HostRequest("host3","c1",null));
    HostResourceProviderTest.createHosts(amc,hostRequests);
    Set<ServiceComponentHostRequest> componentHostRequests=new HashSet<ServiceComponentHostRequest>();
    componentHostRequests.add(new ServiceComponentHostRequest("c1",null,"DATANODE","host1",null));
    componentHostRequests.add(new ServiceComponentHostRequest("c1",null,"NAMENODE","host1",null));
    componentHostRequests.add(new ServiceComponentHostRequest("c1",null,"SECONDARY_NAMENODE","host1",null));
    componentHostRequests.add(new ServiceComponentHostRequest("c1",null,"DATANODE","host2",null));
    componentHostRequests.add(new ServiceComponentHostRequest("c1",null,"DATANODE","host3",null));
    amc.createHostComponents(componentHostRequests);
    serviceRequests.clear();
    serviceRequests.add(new ServiceRequest("c1","HDFS","INSTALLED"));
    ServiceResourceProviderTest.updateServices(amc,serviceRequests,mapRequestProps,true,false);
    Cluster cluster=clusters.getCluster("c1");
    Map<String,ServiceComponentHost> namenodes=cluster.getService("HDFS").getServiceComponent("NAMENODE").getServiceComponentHosts();
    org.junit.Assert.assertEquals(1,namenodes.size());
    ServiceComponentHost componentHost=namenodes.get("host1");
    Map<String,ServiceComponentHost> hostComponents=cluster.getService("HDFS").getServiceComponent("DATANODE").getServiceComponentHosts();
    for (    Map.Entry<String,ServiceComponentHost> entry : hostComponents.entrySet()) {
      ServiceComponentHost cHost=entry.getValue();
      cHost.handleEvent(new ServiceComponentHostInstallEvent(cHost.getServiceComponentName(),cHost.getHostName(),System.currentTimeMillis(),"HDP-1.2.0"));
      cHost.handleEvent(new ServiceComponentHostOpSucceededEvent(cHost.getServiceComponentName(),cHost.getHostName(),System.currentTimeMillis()));
    }
    hostComponents=cluster.getService("HDFS").getServiceComponent("NAMENODE").getServiceComponentHosts();
    for (    Map.Entry<String,ServiceComponentHost> entry : hostComponents.entrySet()) {
      ServiceComponentHost cHost=entry.getValue();
      cHost.handleEvent(new ServiceComponentHostInstallEvent(cHost.getServiceComponentName(),cHost.getHostName(),System.currentTimeMillis(),"HDP-1.2.0"));
      cHost.handleEvent(new ServiceComponentHostOpSucceededEvent(cHost.getServiceComponentName(),cHost.getHostName(),System.currentTimeMillis()));
    }
    hostComponents=cluster.getService("HDFS").getServiceComponent("SECONDARY_NAMENODE").getServiceComponentHosts();
    for (    Map.Entry<String,ServiceComponentHost> entry : hostComponents.entrySet()) {
      ServiceComponentHost cHost=entry.getValue();
      cHost.handleEvent(new ServiceComponentHostInstallEvent(cHost.getServiceComponentName(),cHost.getHostName(),System.currentTimeMillis(),"HDP-1.2.0"));
      cHost.handleEvent(new ServiceComponentHostOpSucceededEvent(cHost.getServiceComponentName(),cHost.getHostName(),System.currentTimeMillis()));
    }
    componentHostRequests.clear();
    componentHostRequests.add(new ServiceComponentHostRequest("c1",null,"NAMENODE","host1","DISABLED"));
    updateHostComponents(amc,componentHostRequests,mapRequestProps,true);
    Assert.assertEquals(State.DISABLED,componentHost.getState());
    componentHostRequests.clear();
    componentHostRequests.add(new ServiceComponentHostRequest("c1",null,"NAMENODE","host1","INSTALLED"));
    updateHostComponents(amc,componentHostRequests,mapRequestProps,true);
    Assert.assertEquals(State.INSTALLED,componentHost.getState());
    componentHostRequests.clear();
    componentHostRequests.add(new ServiceComponentHostRequest("c1",null,"NAMENODE","host1","DISABLED"));
    updateHostComponents(amc,componentHostRequests,mapRequestProps,true);
    Assert.assertEquals(State.DISABLED,componentHost.getState());
    componentHostRequests.clear();
    componentHostRequests.add(new ServiceComponentHostRequest("c1",null,"NAMENODE","host2",null));
    amc.createHostComponents(componentHostRequests);
    componentHostRequests.clear();
    componentHostRequests.add(new ServiceComponentHostRequest("c1",null,"NAMENODE","host2","INSTALLED"));
    updateHostComponents(amc,componentHostRequests,mapRequestProps,true);
    namenodes=cluster.getService("HDFS").getServiceComponent("NAMENODE").getServiceComponentHosts();
    Assert.assertEquals(2,namenodes.size());
    componentHost=namenodes.get("host2");
    componentHost.handleEvent(new ServiceComponentHostInstallEvent(componentHost.getServiceComponentName(),componentHost.getHostName(),System.currentTimeMillis(),"HDP-1.2.0"));
    componentHost.handleEvent(new ServiceComponentHostOpSucceededEvent(componentHost.getServiceComponentName(),componentHost.getHostName(),System.currentTimeMillis()));
    serviceRequests.clear();
    serviceRequests.add(new ServiceRequest("c1","HDFS","STARTED"));
    RequestStatusResponse response=ServiceResourceProviderTest.updateServices(amc,serviceRequests,mapRequestProps,true,false);
    for (    ShortTaskStatus shortTaskStatus : response.getTasks()) {
      assertFalse("host1".equals(shortTaskStatus.getHostName()) && "NAMENODE".equals(shortTaskStatus.getRole()));
    }
    componentHostRequests.clear();
    componentHostRequests.add(new ServiceComponentHostRequest("c1",null,"NAMENODE","host1",null));
    amc.deleteHostComponents(componentHostRequests);
    namenodes=cluster.getService("HDFS").getServiceComponent("NAMENODE").getServiceComponentHosts();
    org.junit.Assert.assertEquals(1,namenodes.size());
    testRunSmokeTestFlag(mapRequestProps,amc,serviceRequests);
    componentHostRequests.clear();
    componentHostRequests.add(new ServiceComponentHostRequest("c1",null,"NAMENODE","host1",null));
    amc.createHostComponents(componentHostRequests);
    namenodes=cluster.getService("HDFS").getServiceComponent("NAMENODE").getServiceComponentHosts();
    assertEquals(2,namenodes.size());
    componentHost=namenodes.get("host1");
    componentHost.handleEvent(new ServiceComponentHostInstallEvent(componentHost.getServiceComponentName(),componentHost.getHostName(),System.currentTimeMillis(),"HDP-1.2.0"));
    componentHost.handleEvent(new ServiceComponentHostOpSucceededEvent(componentHost.getServiceComponentName(),componentHost.getHostName(),System.currentTimeMillis()));
    componentHostRequests.clear();
    componentHostRequests.add(new ServiceComponentHostRequest("c1",null,"NAMENODE","host1","INSTALLED"));
    updateHostComponents(amc,componentHostRequests,mapRequestProps,true);
    assertEquals(State.INSTALLED,namenodes.get("host1").getState());
    ServiceComponentHost sch=null;
    for (    ServiceComponentHost tmp : cluster.getServiceComponentHosts("host2")) {
      if (tmp.getServiceComponentName().equals("DATANODE")) {
        tmp.setState(State.UNKNOWN);
        sch=tmp;
      }
    }
    assertNotNull(sch);
    componentHostRequests.clear();
    componentHostRequests.add(new ServiceComponentHostRequest("c1",null,"DATANODE","host2","DISABLED"));
    updateHostComponents(amc,componentHostRequests,mapRequestProps,false);
    org.junit.Assert.assertEquals(State.DISABLED,sch.getState());
    componentHostRequests.clear();
    mapRequestProps.put(RequestOperationLevel.OPERATION_CLUSTER_ID,"c1");
    updateHostComponents(amc,componentHostRequests,mapRequestProps,false);
    org.junit.Assert.assertEquals(State.DISABLED,sch.getState());
    mapRequestProps.clear();
    assertEquals(sch.getServiceComponentName(),"DATANODE");
    serviceRequests.clear();
    serviceRequests.add(new ServiceRequest("c1","HDFS","INSTALLED"));
    ServiceResourceProviderTest.updateServices(amc,serviceRequests,mapRequestProps,true,false);
    assertEquals(State.DISABLED,sch.getState());
    serviceRequests.clear();
    serviceRequests.add(new ServiceRequest("c1","HDFS","STARTED"));
    ServiceResourceProviderTest.updateServices(amc,serviceRequests,mapRequestProps,true,false);
    assertEquals(State.DISABLED,sch.getState());
    componentHostRequests.clear();
    componentHostRequests.add(new ServiceComponentHostRequest("c1",null,"DATANODE","host2",null));
    amc.deleteHostComponents(componentHostRequests);
    sch=null;
    for (    ServiceComponentHost tmp : cluster.getServiceComponentHosts("host2")) {
      if (tmp.getServiceComponentName().equals("DATANODE")) {
        sch=tmp;
      }
    }
    org.junit.Assert.assertNull(sch);
    serviceRequests.clear();
    serviceRequests.add(new ServiceRequest("c1","HDFS","INSTALLED"));
    ServiceResourceProviderTest.updateServices(amc,serviceRequests,mapRequestProps,true,false);
    serviceRequests.clear();
    serviceRequests.add(new ServiceRequest("c1",null,null));
    org.junit.Assert.assertEquals(2,ServiceResourceProviderTest.getServices(amc,serviceRequests).size());
    serviceRequests.clear();
    serviceRequests.add(new ServiceRequest("c1","HDFS",null));
    serviceRequests.add(new ServiceRequest("c1","HIVE",null));
    ServiceResourceProviderTest.deleteServices(amc,serviceRequests);
    serviceRequests.clear();
    serviceRequests.add(new ServiceRequest("c1",null,null));
    org.junit.Assert.assertEquals(0,ServiceResourceProviderTest.getServices(amc,serviceRequests).size());
    serviceRequests.clear();
    serviceRequests.add(new ServiceRequest("c1","HDFS",null));
    ServiceResourceProviderTest.createServices(amc,serviceRequests);
    org.junit.Assert.assertEquals(1,ServiceResourceProviderTest.getServices(amc,serviceRequests).size());
    configurationRequest=new ConfigurationRequest("c1","core-site","version2",gson.<Map<String,String>>fromJson("{ \"fs.default.name\" : \"localhost:8020\"}",confType),null);
    amc.createConfiguration(configurationRequest);
    configurationRequest=new ConfigurationRequest("c1","hdfs-site","version2",gson.<Map<String,String>>fromJson("{ \"dfs.datanode.data.dir.perm\" : \"750\"}",confType),null);
    amc.createConfiguration(configurationRequest);
    configurationRequest=new ConfigurationRequest("c1","global","version2",gson.<Map<String,String>>fromJson("{ \"hbase_hdfs_root_dir\" : \"/apps/hbase/\"}",confType),null);
    amc.createConfiguration(configurationRequest);
    serviceRequests.clear();
    serviceRequests.add(new ServiceRequest("c1","HDFS",null));
    ServiceResourceProviderTest.updateServices(amc,serviceRequests,mapRequestProps,true,false);
    serviceComponentRequests=new HashSet<ServiceComponentRequest>();
    serviceComponentRequests.add(new ServiceComponentRequest("c1","HDFS","NAMENODE",null));
    serviceComponentRequests.add(new ServiceComponentRequest("c1","HDFS","SECONDARY_NAMENODE",null));
    serviceComponentRequests.add(new ServiceComponentRequest("c1","HDFS","DATANODE",null));
    serviceComponentRequests.add(new ServiceComponentRequest("c1","HDFS","HDFS_CLIENT",null));
    ComponentResourceProviderTest.createComponents(amc,serviceComponentRequests);
    componentHostRequests=new HashSet<ServiceComponentHostRequest>();
    componentHostRequests.add(new ServiceComponentHostRequest("c1",null,"DATANODE","host1",null));
    componentHostRequests.add(new ServiceComponentHostRequest("c1",null,"NAMENODE","host1",null));
    componentHostRequests.add(new ServiceComponentHostRequest("c1",null,"SECONDARY_NAMENODE","host1",null));
    componentHostRequests.add(new ServiceComponentHostRequest("c1",null,"DATANODE","host2",null));
    componentHostRequests.add(new ServiceComponentHostRequest("c1",null,"DATANODE","host3",null));
    amc.createHostComponents(componentHostRequests);
    namenodes=cluster.getService("HDFS").getServiceComponent("NAMENODE").getServiceComponentHosts();
    org.junit.Assert.assertEquals(1,namenodes.size());
    Map<String,ServiceComponentHost> datanodes=cluster.getService("HDFS").getServiceComponent("DATANODE").getServiceComponentHosts();
    org.junit.Assert.assertEquals(3,datanodes.size());
    Map<String,ServiceComponentHost> namenodes2=cluster.getService("HDFS").getServiceComponent("SECONDARY_NAMENODE").getServiceComponentHosts();
    org.junit.Assert.assertEquals(1,namenodes2.size());
  }
  finally {
    injector.getInstance(PersistService.class).stop();
  }
}

</code></pre>

<br>
<pre class="type-4 type-11 type-14 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Ignore @Test public void testServiceComponentHostUpdateStackIdError() throws Exception {
  String clusterName="foo1";
  createCluster(clusterName);
  String serviceName1="HDFS";
  createService(clusterName,serviceName1,null);
  String componentName1="NAMENODE";
  createServiceComponent(clusterName,serviceName1,componentName1,State.INIT);
  String host1="h1";
  String host2="h2";
  addHostToCluster(host1,clusterName);
  addHostToCluster(host2,clusterName);
  Set<ServiceComponentHostRequest> set1=new HashSet<ServiceComponentHostRequest>();
  ServiceComponentHostRequest r1=new ServiceComponentHostRequest(clusterName,serviceName1,componentName1,host1,State.INIT.toString());
  ServiceComponentHostRequest r2=new ServiceComponentHostRequest(clusterName,serviceName1,componentName1,host2,State.INIT.toString());
  set1.add(r1);
  set1.add(r2);
  controller.createHostComponents(set1);
  Cluster c1=clusters.getCluster(clusterName);
  Service s1=c1.getService(serviceName1);
  ServiceComponent sc1=s1.getServiceComponent(componentName1);
  ServiceComponentHost sch1=sc1.getServiceComponentHost(host1);
  ServiceComponentHost sch2=sc1.getServiceComponentHost(host2);
  s1.setDesiredState(State.INIT);
  sc1.setDesiredState(State.INIT);
  ServiceComponentHostRequest req1;
  ServiceComponentHostRequest req2;
  Set<ServiceComponentHostRequest> reqs=new HashSet<ServiceComponentHostRequest>();
  reqs.clear();
  req1=new ServiceComponentHostRequest(clusterName,serviceName1,componentName1,host1,State.STARTED.toString());
  req1.setDesiredStackId("invalid stack id");
  reqs.add(req1);
  updateHostAndCompareExpectedFailure(reqs,"Invalid desired stack id");
  c1.setCurrentStackVersion(new StackId("HDP-0.0"));
  sch1.setStackVersion(new StackId("HDP-0.1"));
  reqs.clear();
  req1=new ServiceComponentHostRequest(clusterName,serviceName1,componentName1,host1,State.STARTED.toString());
  req1.setDesiredStackId("HDP-0.2");
  reqs.add(req1);
  updateHostAndCompareExpectedFailure(reqs,"Cluster has not been upgraded yet");
  c1.setCurrentStackVersion(new StackId("HDP2-0.1"));
  reqs.clear();
  req1=new ServiceComponentHostRequest(clusterName,serviceName1,componentName1,host1,State.STARTED.toString());
  req1.setDesiredStackId("HDP-0.2");
  reqs.add(req1);
  updateHostAndCompareExpectedFailure(reqs,"Deployed stack name and requested stack names");
  c1.setCurrentStackVersion(new StackId("HDP-0.2"));
  reqs.clear();
  req1=new ServiceComponentHostRequest(clusterName,serviceName1,componentName1,host1,State.STARTED.toString());
  req1.setDesiredStackId("HDP-0.3");
  reqs.add(req1);
  updateHostAndCompareExpectedFailure(reqs,"Component host can only be upgraded to the same version");
  c1.setCurrentStackVersion(new StackId("HDP-0.2"));
  sch1.setState(State.STARTED);
  reqs.clear();
  req1=new ServiceComponentHostRequest(clusterName,serviceName1,componentName1,host1,State.STARTED.toString());
  req1.setDesiredStackId("HDP-0.2");
  reqs.add(req1);
  updateHostAndCompareExpectedFailure(reqs,"Component host is in an invalid state for upgrade");
  c1.setCurrentStackVersion(new StackId("HDP-0.2"));
  sch1.setState(State.UPGRADING);
  reqs.clear();
  req1=new ServiceComponentHostRequest(clusterName,serviceName1,componentName1,host1,State.STARTED.toString());
  req1.setDesiredStackId("HDP-0.2");
  reqs.add(req1);
  updateHostAndCompareExpectedFailure(reqs,"The desired state for an upgrade request must be");
  c1.setCurrentStackVersion(new StackId("HDP-0.2"));
  sch1.setState(State.UPGRADING);
  reqs.clear();
  req1=new ServiceComponentHostRequest(clusterName,serviceName1,componentName1,host1,null);
  req1.setDesiredStackId("HDP-0.2");
  reqs.add(req1);
  updateHostAndCompareExpectedFailure(reqs,"The desired state for an upgrade request must be");
  c1.setCurrentStackVersion(new StackId("HDP-0.2"));
  sch1.setState(State.INSTALLED);
  sch1.setDesiredState(State.INSTALLED);
  sch2.setState(State.INSTALLED);
  sch2.setDesiredState(State.INSTALLED);
  reqs.clear();
  req1=new ServiceComponentHostRequest(clusterName,serviceName1,componentName1,host1,State.INSTALLED.toString());
  req1.setDesiredStackId("HDP-0.2");
  reqs.add(req1);
  req2=new ServiceComponentHostRequest(clusterName,serviceName1,componentName1,host2,State.STARTED.toString());
  reqs.add(req2);
  updateHostAndCompareExpectedFailure(reqs,"An upgrade request cannot be combined with other");
  c1.setCurrentStackVersion(new StackId("HDP-0.2"));
  sch1.setState(State.INSTALLED);
  sch1.setStackVersion(new StackId("HDP-0.2"));
  reqs.clear();
  req1=new ServiceComponentHostRequest(clusterName,serviceName1,componentName1,host1,null);
  req1.setDesiredStackId("HDP-0.2");
  reqs.add(req1);
  RequestStatusResponse resp=updateHostComponents(reqs,Collections.<String,String>emptyMap(),true);
  Assert.assertNull(resp);
  c1.setCurrentStackVersion(new StackId("HDP-0.2"));
  sch1.setState(State.INSTALLED);
  sch1.setStackVersion(new StackId("HDP-0.2"));
  reqs.clear();
  req1=new ServiceComponentHostRequest(clusterName,serviceName1,componentName1,host1,State.INSTALLED.toString());
  req1.setDesiredStackId("HDP-0.2");
  reqs.add(req1);
  resp=updateHostComponents(reqs,Collections.<String,String>emptyMap(),true);
  Assert.assertNull(resp);
}

</code></pre>

<br>
<pre class="type-4 type-2 type-5 type-1 type-11 type-14 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test @Ignore public void testGetExecutionCommandWithClusterEnvForRetry() throws Exception {
  String clusterName="foo1";
  createCluster(clusterName);
  Cluster cluster=clusters.getCluster(clusterName);
  clusters.getCluster(clusterName).setDesiredStackVersion(new StackId("HDP-0.1"));
  String serviceName="HDFS";
  createService(clusterName,serviceName,null);
  String componentName1="NAMENODE";
  String componentName2="DATANODE";
  String componentName3="HDFS_CLIENT";
  createServiceComponent(clusterName,serviceName,componentName1,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName2,State.INIT);
  createServiceComponent(clusterName,serviceName,componentName3,State.INIT);
  String host1="h1";
  String host2="h2";
  addHostToCluster(host1,clusterName);
  addHostToCluster(host2,clusterName);
  Map<String,String> configs=new HashMap<String,String>();
  configs.put("a","b");
  configs.put("command_retry_enabled","true");
  configs.put("command_retry_max_time_in_sec","5");
  configs.put("commands_to_retry","INSTALL");
  ConfigurationRequest cr1;
  cr1=new ConfigurationRequest(clusterName,"cluster-env","version1",configs,null);
  ClusterRequest crReq=new ClusterRequest(cluster.getClusterId(),clusterName,null,null);
  crReq.setDesiredConfig(Collections.singletonList(cr1));
  controller.updateClusters(Collections.singleton(crReq),null);
  Map<String,String> mapRequestProps=new HashMap<String,String>();
  mapRequestProps.put("context","Called from a test");
  createServiceComponentHost(clusterName,serviceName,componentName2,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName2,host2,null);
  createServiceComponentHost(clusterName,serviceName,componentName3,host1,null);
  createServiceComponentHost(clusterName,serviceName,componentName3,host2,null);
  ServiceComponentHostRequest schr=new ServiceComponentHostRequest(clusterName,"HDFS","DATANODE",host2,"INSTALLED");
  Map<String,String> requestProps=new HashMap<String,String>();
  requestProps.put("phase","INITIAL_INSTALL");
  RequestStatusResponse rsr=updateHostComponents(Collections.singleton(schr),requestProps,false);
  List<Stage> stages=actionDB.getAllStages(rsr.getRequestId());
  Assert.assertEquals(1,stages.size());
  Stage stage=stages.iterator().next();
  List<ExecutionCommandWrapper> execWrappers=stage.getExecutionCommands(host2);
  Assert.assertEquals(1,execWrappers.size());
  ExecutionCommandWrapper execWrapper=execWrappers.iterator().next();
  ExecutionCommand ec=execWrapper.getExecutionCommand();
  Map<String,Map<String,String>> configurations=ec.getConfigurations();
  assertNotNull(configurations);
  assertEquals(1,configurations.size());
  assertTrue(configurations.containsKey("cluster-env"));
  assertTrue(ec.getCommandParams().containsKey("max_duration_for_retries"));
  assertEquals("5",ec.getCommandParams().get("max_duration_for_retries"));
  assertTrue(ec.getCommandParams().containsKey("command_retry_enabled"));
  assertEquals("true",ec.getCommandParams().get("command_retry_enabled"));
  for (  ServiceComponentHost sch : clusters.getCluster(clusterName).getServiceComponentHosts(host2)) {
    sch.setState(State.INSTALLED);
  }
  schr=new ServiceComponentHostRequest(clusterName,"HDFS","DATANODE",host2,"STARTED");
  rsr=updateHostComponents(Collections.singleton(schr),requestProps,false);
  stages=actionDB.getAllStages(rsr.getRequestId());
  Assert.assertEquals(1,stages.size());
  stage=stages.iterator().next();
  execWrappers=stage.getExecutionCommands(host2);
  Assert.assertEquals(1,execWrappers.size());
  execWrapper=execWrappers.iterator().next();
  ec=execWrapper.getExecutionCommand();
  configurations=ec.getConfigurations();
  assertNotNull(configurations);
  assertEquals(1,configurations.size());
  assertTrue(configurations.containsKey("cluster-env"));
  assertTrue(ec.getCommandParams().containsKey("max_duration_for_retries"));
  assertEquals("5",ec.getCommandParams().get("max_duration_for_retries"));
  assertTrue(ec.getCommandParams().containsKey("command_retry_enabled"));
  assertEquals("false",ec.getCommandParams().get("command_retry_enabled"));
  configs.put("command_retry_enabled","true");
  configs.put("command_retry_max_time_in_sec","12");
  configs.put("commands_to_retry","START");
  cr1=new ConfigurationRequest(clusterName,"cluster-env","version2",configs,null);
  crReq=new ClusterRequest(cluster.getClusterId(),clusterName,null,null);
  crReq.setDesiredConfig(Collections.singletonList(cr1));
  controller.updateClusters(Collections.singleton(crReq),null);
  requestProps.put("phase","INITIAL_START");
  schr=new ServiceComponentHostRequest(clusterName,"HDFS","DATANODE",host2,"STARTED");
  rsr=updateHostComponents(Collections.singleton(schr),requestProps,false);
  stages=actionDB.getAllStages(rsr.getRequestId());
  Assert.assertEquals(1,stages.size());
  stage=stages.iterator().next();
  execWrappers=stage.getExecutionCommands(host2);
  Assert.assertEquals(1,execWrappers.size());
  execWrapper=execWrappers.iterator().next();
  ec=execWrapper.getExecutionCommand();
  configurations=ec.getConfigurations();
  assertNotNull(configurations);
  assertEquals(1,configurations.size());
  assertTrue(configurations.containsKey("cluster-env"));
  assertTrue(ec.getCommandParams().containsKey("max_duration_for_retries"));
  assertEquals("12",ec.getCommandParams().get("max_duration_for_retries"));
  assertTrue(ec.getCommandParams().containsKey("command_retry_enabled"));
  assertEquals("true",ec.getCommandParams().get("command_retry_enabled"));
  configs.put("command_retry_enabled","asdf");
  configs.put("command_retry_max_time_in_sec","-5");
  configs.put("commands_to_retry2","START");
  cr1=new ConfigurationRequest(clusterName,"cluster-env","version3",configs,null);
  crReq=new ClusterRequest(cluster.getClusterId(),clusterName,null,null);
  crReq.setDesiredConfig(Collections.singletonList(cr1));
  controller.updateClusters(Collections.singleton(crReq),null);
  requestProps.put("phase","INITIAL_START");
  schr=new ServiceComponentHostRequest(clusterName,"HDFS","DATANODE",host2,"STARTED");
  rsr=updateHostComponents(Collections.singleton(schr),requestProps,false);
  stages=actionDB.getAllStages(rsr.getRequestId());
  Assert.assertEquals(1,stages.size());
  stage=stages.iterator().next();
  execWrappers=stage.getExecutionCommands(host2);
  Assert.assertEquals(1,execWrappers.size());
  execWrapper=execWrappers.iterator().next();
  ec=execWrapper.getExecutionCommand();
  configurations=ec.getConfigurations();
  assertNotNull(configurations);
  assertEquals(1,configurations.size());
  assertTrue(configurations.containsKey("cluster-env"));
  assertTrue(ec.getCommandParams().containsKey("max_duration_for_retries"));
  assertEquals("0",ec.getCommandParams().get("max_duration_for_retries"));
  assertTrue(ec.getCommandParams().containsKey("command_retry_enabled"));
  assertEquals("false",ec.getCommandParams().get("command_retry_enabled"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.controller.internal.StageResourceProviderTest </h4><pre class="type-2 type-5 type-1 type-14 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test @Ignore public void testQueryForResources() throws Exception {
  StageResourceProvider provider=new StageResourceProvider(managementController);
  Request request=createNiceMock(Request.class);
  Predicate predicate=createNiceMock(Predicate.class);
  List<StageEntity> entities=getStageEntities(HostRoleStatus.COMPLETED);
  expect(dao.findAll(request,predicate)).andReturn(entities);
  expect(clusters.getClusterById(anyLong())).andReturn(cluster).anyTimes();
  expect(cluster.getClusterName()).andReturn("c1").anyTimes();
  replay(dao,clusters,cluster,request,predicate);
  QueryResponse response=provider.queryForResources(request,predicate);
  Set<Resource> resources=response.getResources();
  Assert.assertEquals(1,resources.size());
  Assert.assertFalse(response.isSortedResponse());
  Assert.assertFalse(response.isPagedResponse());
  Assert.assertEquals(1,response.getTotalResourceCount());
  verify(dao,clusters,cluster);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.controller.internal.UpgradeResourceProviderTest </h4><pre class="type-4 type-2 type-5 type-1 type-14 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test @Ignore public void testCreateCrossStackUpgrade() throws Exception {
  Cluster cluster=clusters.getCluster("c1");
  StackId oldStack=cluster.getDesiredStackVersion();
  for (  Service s : cluster.getServices().values()) {
    assertEquals(oldStack,s.getDesiredStackVersion());
    for (    ServiceComponent sc : s.getServiceComponents().values()) {
      assertEquals(oldStack,sc.getDesiredStackVersion());
      for (      ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
        assertEquals(oldStack,sch.getDesiredStackVersion());
      }
    }
  }
  Config config=new ConfigImpl("zoo.cfg");
  config.setProperties(new HashMap<String,String>(){
{
      put("a","b");
    }
  }
);
  config.setTag("abcdefg");
  cluster.addConfig(config);
  cluster.addDesiredConfig("admin",Collections.singleton(config));
  Map<String,Object> requestProps=new HashMap<String,Object>();
  requestProps.put(UpgradeResourceProvider.UPGRADE_CLUSTER_NAME,"c1");
  requestProps.put(UpgradeResourceProvider.UPGRADE_VERSION,"2.2.0.0");
  requestProps.put(UpgradeResourceProvider.UPGRADE_PACK,"upgrade_test_nonrolling");
  requestProps.put(UpgradeResourceProvider.UPGRADE_SKIP_PREREQUISITE_CHECKS,"true");
  ResourceProvider upgradeResourceProvider=createProvider(amc);
  Request request=PropertyHelper.getCreateRequest(Collections.singleton(requestProps),null);
  upgradeResourceProvider.createResources(request);
  List<UpgradeEntity> upgrades=upgradeDao.findUpgrades(cluster.getClusterId());
  assertEquals(1,upgrades.size());
  UpgradeEntity upgrade=upgrades.get(0);
  assertEquals(5,upgrade.getUpgradeGroups().size());
  UpgradeGroupEntity group=upgrade.getUpgradeGroups().get(2);
  assertEquals(1,group.getItems().size());
  group=upgrade.getUpgradeGroups().get(0);
  assertEquals(1,group.getItems().size());
  assertTrue(cluster.getDesiredConfigs().containsKey("zoo.cfg"));
  StackId newStack=cluster.getDesiredStackVersion();
  assertFalse(oldStack.equals(newStack));
  for (  Service s : cluster.getServices().values()) {
    assertEquals(newStack,s.getDesiredStackVersion());
    for (    ServiceComponent sc : s.getServiceComponents().values()) {
      assertEquals(newStack,sc.getDesiredStackVersion());
      for (      ServiceComponentHost sch : sc.getServiceComponentHosts().values()) {
        assertEquals(newStack,sch.getDesiredStackVersion());
      }
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.orm.dao.TopologyLogicalRequestDAOTest </h4><pre class="type-4 type-2 type-1 type-11 type-14 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test @Ignore public void testFindAll() throws Exception {
  create();
  List<TopologyLogicalRequestEntity> logicalRequestEntities=logicalRequestDAO.findAll();
  Assert.assertEquals(1,logicalRequestEntities.size());
  TopologyLogicalRequestEntity logicalRequestEntity=logicalRequestEntities.iterator().next();
  Assert.assertNotNull(logicalRequestEntity.getTopologyRequestId());
  Assert.assertEquals(Long.valueOf(1),logicalRequestEntity.getId());
  Assert.assertEquals("description",logicalRequestEntity.getDescription());
  Assert.assertNotNull(logicalRequestEntity.getTopologyRequestEntity());
  Collection<TopologyHostRequestEntity> hostRequestEntities=logicalRequestEntity.getTopologyHostRequestEntities();
  Assert.assertEquals(1,hostRequestEntities.size());
  TopologyHostRequestEntity hostRequestEntity=hostRequestEntities.iterator().next();
  Assert.assertNotNull(hostRequestEntity.getTopologyHostGroupEntity());
  Assert.assertEquals(hostRequestEntity.getTopologyHostGroupEntity().getId(),hostRequestEntity.getHostGroupId());
  Collection<TopologyHostTaskEntity> taskEntities=hostRequestEntity.getTopologyHostTaskEntities();
  Assert.assertEquals(1,taskEntities.size());
  TopologyHostTaskEntity taskEntity=taskEntities.iterator().next();
  Assert.assertNotNull(taskEntity.getTopologyHostRequestEntity());
  Assert.assertNotNull(taskEntity.getTopologyLogicalTaskEntities());
  Assert.assertEquals(1,taskEntity.getTopologyLogicalTaskEntities().size());
  Assert.assertNotNull(taskEntity.getTopologyLogicalTaskEntities().iterator().next().getTopologyHostTaskEntity());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.security.CertGenerationTest </h4><pre class="type-2 type-5 type-14 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Ignore @Test public void testServerCertGen() throws Exception {
  File serverCrt=new File(temp.getRoot().getAbsoluteFile() + File.separator + Configuration.SRVR_CRT_NAME_DEFAULT);
  Assert.assertTrue(serverCrt.exists());
}

</code></pre>

<br>
<pre class="type-2 type-5 type-14 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Ignore @Test public void testRevokeExistingAgentCert() throws Exception {
  Map<String,String> config=certMan.configs.getConfigsMap();
  config.put(Configuration.PASSPHRASE_KEY,"passphrase");
  String agentHostname="agent_hostname";
  SignCertResponse scr=certMan.signAgentCrt(agentHostname,"incorrect_agentCrtReqContent","passphrase");
  Assert.assertFalse(scr.getMessage().contains("-revoke"));
  File fakeAgentCertFile=new File(temp.getRoot().getAbsoluteFile() + File.separator + agentHostname+ ".crt");
  Assert.assertTrue(fakeAgentCertFile.exists());
  scr=certMan.signAgentCrt(agentHostname,"incorrect_agentCrtReqContent","passphrase");
  Assert.assertTrue(scr.getMessage().contains("-revoke"));
}

</code></pre>

<br>
<pre class="type-2 type-5 type-14 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Ignore @Test public void testServerKeystoreGen() throws Exception {
  File serverKeyStrore=new File(temp.getRoot().getAbsoluteFile() + File.separator + Configuration.KSTR_NAME_DEFAULT);
  Assert.assertTrue(serverKeyStrore.exists());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.security.authorization.TestUsers </h4><pre class="type-14 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Is not executed with the test suite
- Executes methods or other tests from the same test unit
"></span><br>
@Test @Ignore public void testCreateUserDefaultParams() throws Exception {
  final Users spy=Mockito.spy(users);
  spy.createUser("user","user");
  Mockito.verify(spy).createUser("user","user",true,false,false);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.serveraction.kerberos.ADKerberosOperationHandlerTest </h4><pre class="type-14 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Is not executed with the test suite
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Implementation to illustrate the use of operations on this class
 * @throws Throwable
 */
@Test @Ignore public void testLive() throws Throwable {
  ADKerberosOperationHandler handler=new ADKerberosOperationHandler();
  String principal=System.getProperty("principal");
  String password=System.getProperty("password");
  String realm=System.getProperty("realm");
  String ldapUrl=System.getProperty("ldap_url");
  String containerDN=System.getProperty("container_dn");
  if (principal == null) {
    principal=DEFAULT_ADMIN_PRINCIPAL;
  }
  if (password == null) {
    password=DEFAULT_ADMIN_PASSWORD;
  }
  if (realm == null) {
    realm=DEFAULT_REALM;
  }
  if (ldapUrl == null) {
    ldapUrl=DEFAULT_LDAP_URL;
  }
  if (containerDN == null) {
    containerDN=DEFAULT_PRINCIPAL_CONTAINER_DN;
  }
  PrincipalKeyCredential credentials=new PrincipalKeyCredential(principal,password);
  Map<String,String> kerberosEnvMap=new HashMap<String,String>();
  kerberosEnvMap.put(ADKerberosOperationHandler.KERBEROS_ENV_LDAP_URL,ldapUrl);
  kerberosEnvMap.put(ADKerberosOperationHandler.KERBEROS_ENV_PRINCIPAL_CONTAINER_DN,containerDN);
  handler.open(credentials,realm,kerberosEnvMap);
  System.out.println("Test Admin Credentials: " + handler.testAdministratorCredentials());
  System.out.println("Principal exists: " + handler.principalExists("nn/c1508.ambari.apache.org"));
  handler.close();
  handler.open(credentials,realm,kerberosEnvMap);
  String evaluatedPrincipal;
  evaluatedPrincipal="nn/c6501.ambari.apache.org@" + DEFAULT_REALM;
  if (handler.principalExists(evaluatedPrincipal)) {
    handler.setPrincipalPassword(evaluatedPrincipal,"some password");
  }
 else {
    handler.createPrincipal(evaluatedPrincipal,"some password",true);
  }
  evaluatedPrincipal="hdfs@" + DEFAULT_REALM;
  if (handler.principalExists(evaluatedPrincipal)) {
    handler.setPrincipalPassword(evaluatedPrincipal,"some password");
  }
 else {
    handler.createPrincipal(evaluatedPrincipal,"some password",true);
  }
  kerberosEnvMap.put(ADKerberosOperationHandler.KERBEROS_ENV_AD_CREATE_ATTRIBUTES_TEMPLATE,"#set( $user = \"${principal_primary}-${principal_digest}\" )" + "{" + "  \"objectClass\": ["+ "    \"top\","+ "    \"person\","+ "    \"organizationalPerson\","+ "    \"user\""+ "  ],"+ "  \"cn\": \"$user\","+ "  \"sAMAccountName\": \"$user.substring(0,20)\","+ "  #if( $is_service )"+ "  \"servicePrincipalName\": \"$principal_name\","+ "  #end"+ "  \"userPrincipalName\": \"$normalized_principal\","+ "  \"unicodePwd\": \"$password\","+ "  \"accountExpires\": \"0\","+ "  \"userAccountControl\": \"66048\""+ "}");
  handler.close();
  handler.open(credentials,realm,kerberosEnvMap);
  handler.removePrincipal("abcdefg");
  handler.removePrincipal("abcdefg/c1509.ambari.apache.org@" + DEFAULT_REALM);
  handler.createPrincipal("abcdefg/c1509.ambari.apache.org@" + DEFAULT_REALM,"some password",true);
  handler.createPrincipal("abcdefg@" + DEFAULT_REALM,"some password",false);
  handler.setPrincipalPassword("abcdefg/c1509.ambari.apache.org@" + DEFAULT_REALM,"some password");
  handler.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.serveraction.kerberos.MITKerberosOperationHandlerTest </h4><pre class="type-14 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Is not executed with the test suite
- Executes methods or other tests from the same test unit
"></span><br>
@Test @Ignore public void testTestAdministratorCredentialsLive() throws KerberosOperationException {
  MITKerberosOperationHandler handler=new MITKerberosOperationHandler();
  String principal=System.getProperty("principal");
  String password=System.getProperty("password");
  String realm=System.getProperty("realm");
  if (principal == null) {
    principal=DEFAULT_ADMIN_PRINCIPAL;
  }
  if (password == null) {
    password=DEFAULT_ADMIN_PASSWORD;
  }
  if (realm == null) {
    realm=DEFAULT_REALM;
  }
  PrincipalKeyCredential credentials=new PrincipalKeyCredential(principal,password);
  handler.open(credentials,realm,KERBEROS_ENV_MAP);
  handler.testAdministratorCredentials();
  handler.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.state.cluster.ClusterTest </h4><pre class="type-2 type-1 type-11 type-14 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test @Ignore public void testClusterRecovery() throws AmbariException {
  ClusterEntity entity=createDummyData();
  ClusterStateEntity clusterStateEntity=new ClusterStateEntity();
  clusterStateEntity.setCurrentStack(entity.getDesiredStack());
  entity.setClusterStateEntity(clusterStateEntity);
  ClusterImpl cluster=new ClusterImpl(entity,injector);
  Service service=cluster.getService("HDFS");
  Assert.assertEquals("HDFS",service.getName());
  Map<String,Service> services=cluster.getServices();
  Assert.assertNotNull(services.get("HDFS"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.testing.DBInconsistencyTests </h4><pre class="type-2 type-1 type-11 type-14 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Ignore @Test public void testRefreshInSameTxn() throws Exception {
  Long clusterId=helper.createCluster();
  Assert.assertNotNull(clusterId);
  Cluster cluster=clusters.getCluster(OrmTestHelper.CLUSTER_NAME);
  Assert.assertNotNull(cluster);
  EntityManager em=helper.getEntityManager();
  final EntityTransaction txn=em.getTransaction();
  txn.begin();
  ClusterEntity entity=clusterDAO.findById(clusterId);
  entity.setProvisioningState(State.DISABLED);
  clusterDAO.merge(entity);
  Assert.assertEquals(State.DISABLED,entity.getProvisioningState());
  entity=clusterDAO.findById(clusterId);
  Assert.assertEquals(State.DISABLED,entity.getProvisioningState());
  entity.setProvisioningState(State.INIT);
  txn.commit();
  entity=clusterDAO.findById(clusterId);
  Assert.assertEquals(State.INIT,entity.getProvisioningState());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.upgrade.UpgradeTest </h4><pre class="type-14 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Is not executed with the test suite
- Executes methods or other tests from the same test unit
"></span><br>
@Test @Ignore public void testUpgrade() throws Exception {
  try {
    dropDatabase();
  }
 catch (  SQLException ignored) {
  }
  String targetVersion=getLastVersion();
  injector=Guice.createInjector(new ControllerModule(properties));
  LOG.info("Testing upgrade from version {} to {}",sourceVersion,targetVersion);
  createSourceDatabase(sourceVersion);
  performUpgrade(targetVersion);
  testUpgradedSchema();
  dropDatabase();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.applicationhistoryservice.TestApplicationHistoryManagerImpl </h4><pre class="type-4 type-2 type-1 type-11 type-14 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test @Ignore public void testApplicationReport() throws IOException, YarnException {
  ApplicationId appId=null;
  appId=ApplicationId.newInstance(0,1);
  writeApplicationStartData(appId);
  writeApplicationFinishData(appId);
  ApplicationAttemptId appAttemptId=ApplicationAttemptId.newInstance(appId,1);
  writeApplicationAttemptStartData(appAttemptId);
  writeApplicationAttemptFinishData(appAttemptId);
  ApplicationReport appReport=applicationHistoryManagerImpl.getApplication(appId);
  Assert.assertNotNull(appReport);
  Assert.assertEquals(appId,appReport.getApplicationId());
  Assert.assertEquals(appAttemptId,appReport.getCurrentApplicationAttemptId());
  Assert.assertEquals(appAttemptId.toString(),appReport.getHost());
  Assert.assertEquals("test type",appReport.getApplicationType().toString());
  Assert.assertEquals("test queue",appReport.getQueue().toString());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.applicationhistoryservice.TestApplicationHistoryServer </h4><pre class="type-10 type-1 type-14 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Ignore @Test(timeout=60000) public void testLaunch() throws Exception {
  UserGroupInformation ugi=UserGroupInformation.createUserForTesting("ambari",new String[]{"ambari"});
  mockStatic(UserGroupInformation.class);
  expect(UserGroupInformation.getCurrentUser()).andReturn(ugi).anyTimes();
  expect(UserGroupInformation.isSecurityEnabled()).andReturn(false).anyTimes();
  ExitUtil.disableSystemExit();
  try {
    historyServer=ApplicationHistoryServer.launchAppHistoryServer(new String[0]);
  }
 catch (  ExitUtil.ExitException e) {
    assertEquals(0,e.status);
    ExitUtil.resetFirstExitException();
    fail();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.applicationhistoryservice.TestMemoryApplicationHistoryStore </h4><pre class="type-4 type-5 type-14 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test @Ignore public void testMassiveWriteContainerHistory() throws IOException {
  long mb=1024 * 1024;
  Runtime runtime=Runtime.getRuntime();
  long usedMemoryBefore=(runtime.totalMemory() - runtime.freeMemory()) / mb;
  int numContainers=100000;
  ApplicationId appId=ApplicationId.newInstance(0,1);
  ApplicationAttemptId appAttemptId=ApplicationAttemptId.newInstance(appId,1);
  for (int i=1; i <= numContainers; ++i) {
    ContainerId containerId=ContainerId.newInstance(appAttemptId,i);
    writeContainerStartData(containerId);
    writeContainerFinishData(containerId);
  }
  long usedMemoryAfter=(runtime.totalMemory() - runtime.freeMemory()) / mb;
  Assert.assertTrue((usedMemoryAfter - usedMemoryBefore) < 200);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.applicationhistoryservice.metrics.timeline.FunctionTest </h4><pre class="type-16 type-14 type-3 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
- Executes methods or other tests from the same test unit
"></span><br>
@Ignore @Test(expected=Function.FunctionFormatException.class) public void testNotAFunction() throws Exception {
  fromMetricName("bytes._not._afunction");
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
