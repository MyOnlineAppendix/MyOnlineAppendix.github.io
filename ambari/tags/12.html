<h3><span class=" glyphicon glyphicon-tag"/>&nbspIterativeVerifier</h3><kbd>Verifies assertions in iterations</kbd><br><br><br><h4 style="margin:0px">Class: org.apache.ambari.scom.SQLPropertyProviderTest </h4><pre class="type-4 type-12 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPopulateResources_multi() throws Exception {
  ConnectionFactory connectionFactory=createNiceMock(ConnectionFactory.class);
  Connection connection=createNiceMock(Connection.class);
  Statement statement=createNiceMock(Statement.class);
  ResultSet resultSet=createNiceMock(ResultSet.class);
  expect(connectionFactory.getConnection()).andReturn(connection).once();
  expect(connection.createStatement()).andReturn(statement).once();
  expect(statement.executeQuery(anyObject(String.class))).andReturn(resultSet).once();
  expect(resultSet.next()).andReturn(true);
  expect(resultSet.getString("RecordTypeContext")).andReturn("rpc");
  expect(resultSet.getString("RecordTypeName")).andReturn("rpc");
  expect(resultSet.getString("TagPairs")).andReturn("");
  expect(resultSet.getString("MetricName")).andReturn("RpcQueueTime_avg_time");
  expect(resultSet.getString("ServiceName")).andReturn("datanode");
  expect(resultSet.getString("NodeName")).andReturn("host1");
  expect(resultSet.getLong("RecordTimeStamp")).andReturn(999990L);
  expect(resultSet.getNString("MetricValue")).andReturn("0");
  expect(resultSet.next()).andReturn(true);
  expect(resultSet.getString("RecordTypeContext")).andReturn("rpc");
  expect(resultSet.getString("RecordTypeName")).andReturn("rpc");
  expect(resultSet.getString("TagPairs")).andReturn("");
  expect(resultSet.getString("MetricName")).andReturn("RpcQueueTime_avg_time");
  expect(resultSet.getString("ServiceName")).andReturn("datanode");
  expect(resultSet.getString("NodeName")).andReturn("host1");
  expect(resultSet.getLong("RecordTimeStamp")).andReturn(999991L);
  expect(resultSet.getNString("MetricValue")).andReturn("1");
  expect(resultSet.next()).andReturn(true);
  expect(resultSet.getString("RecordTypeContext")).andReturn("rpc");
  expect(resultSet.getString("RecordTypeName")).andReturn("rpc");
  expect(resultSet.getString("TagPairs")).andReturn("");
  expect(resultSet.getString("MetricName")).andReturn("RpcSlowResponse_num_ops");
  expect(resultSet.getString("ServiceName")).andReturn("datanode");
  expect(resultSet.getString("NodeName")).andReturn("host1");
  expect(resultSet.getLong("RecordTimeStamp")).andReturn(999992L);
  expect(resultSet.getNString("MetricValue")).andReturn("2");
  expect(resultSet.next()).andReturn(true);
  expect(resultSet.getString("RecordTypeContext")).andReturn("rpc");
  expect(resultSet.getString("RecordTypeName")).andReturn("rpc");
  expect(resultSet.getString("TagPairs")).andReturn("");
  expect(resultSet.getString("MetricName")).andReturn("RpcSlowResponse_num_ops");
  expect(resultSet.getString("ServiceName")).andReturn("datanode");
  expect(resultSet.getString("NodeName")).andReturn("host1");
  expect(resultSet.getLong("RecordTimeStamp")).andReturn(999993L);
  expect(resultSet.getNString("MetricValue")).andReturn("3");
  expect(resultSet.next()).andReturn(false);
  replay(connectionFactory,connection,statement,resultSet);
  SQLPropertyProvider provider=new SQLPropertyProvider(PropertyHelper.getGangliaPropertyIds(Resource.Type.HostComponent),new TestHostInfoProvider(),CLUSTER_NAME_PROPERTY_ID,HOST_NAME_PROPERTY_ID,COMPONENT_NAME_PROPERTY_ID,SERVICE_NAME_PROPERTY_ID,connectionFactory);
  Resource resource=new ResourceImpl(Resource.Type.HostComponent);
  resource.setProperty(CLUSTER_NAME_PROPERTY_ID,"c1");
  resource.setProperty(HOST_NAME_PROPERTY_ID,"domU-12-31-39-0E-34-E1.compute-1.internal");
  resource.setProperty(COMPONENT_NAME_PROPERTY_ID,"DATANODE");
  resource.setProperty(SERVICE_NAME_PROPERTY_ID,"HDFS");
  Map<String,TemporalInfo> temporalInfoMap=new HashMap<String,TemporalInfo>();
  temporalInfoMap.put(PROPERTY_ID_1,new TemporalInfoImpl(10L,20L,1L));
  Set<String> propertyIds=new LinkedHashSet<String>();
  propertyIds.add(PROPERTY_ID_1);
  propertyIds.add(PROPERTY_ID_2);
  Request request=PropertyHelper.getReadRequest(propertyIds,temporalInfoMap);
  Assert.assertEquals(1,provider.populateResources(Collections.singleton(resource),request,null).size());
  Assert.assertTrue(resource.getPropertyValue(PROPERTY_ID_1) instanceof Number[][]);
  Number[][] datapoints=(Number[][])resource.getPropertyValue(PROPERTY_ID_1);
  for (int i=0; i < datapoints.length; ++i) {
    Assert.assertEquals((long)i,datapoints[i][0]);
    Assert.assertEquals((999990L + i) / 1000,datapoints[i][1]);
  }
  Assert.assertEquals(3L,resource.getPropertyValue(PROPERTY_ID_2));
  verify(connectionFactory,connection,statement,resultSet);
}

</code></pre>

<br>
<pre class="type-4 type-12 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPopulateResources() throws Exception {
  ConnectionFactory connectionFactory=createNiceMock(ConnectionFactory.class);
  Connection connection=createNiceMock(Connection.class);
  Statement statement=createNiceMock(Statement.class);
  ResultSet resultSet=createNiceMock(ResultSet.class);
  expect(connectionFactory.getConnection()).andReturn(connection).once();
  expect(connection.createStatement()).andReturn(statement).once();
  expect(statement.executeQuery(anyObject(String.class))).andReturn(resultSet).once();
  expect(resultSet.next()).andReturn(true);
  expect(resultSet.getLong("RecordTimeStamp")).andReturn(999990L);
  expect(resultSet.getNString("MetricValue")).andReturn("0");
  expect(resultSet.next()).andReturn(true);
  expect(resultSet.getLong("RecordTimeStamp")).andReturn(999991L);
  expect(resultSet.getNString("MetricValue")).andReturn("1");
  expect(resultSet.next()).andReturn(true);
  expect(resultSet.getLong("RecordTimeStamp")).andReturn(999992L);
  expect(resultSet.getNString("MetricValue")).andReturn("2");
  expect(resultSet.next()).andReturn(true);
  expect(resultSet.getLong("RecordTimeStamp")).andReturn(999993L);
  expect(resultSet.getNString("MetricValue")).andReturn("3");
  expect(resultSet.next()).andReturn(false);
  replay(connectionFactory,connection,statement,resultSet);
  SQLPropertyProvider provider=new SQLPropertyProvider(PropertyHelper.getGangliaPropertyIds(Resource.Type.HostComponent),new TestHostInfoProvider(),CLUSTER_NAME_PROPERTY_ID,HOST_NAME_PROPERTY_ID,COMPONENT_NAME_PROPERTY_ID,SERVICE_NAME_PROPERTY_ID,connectionFactory);
  Resource resource=new ResourceImpl(Resource.Type.HostComponent);
  resource.setProperty(CLUSTER_NAME_PROPERTY_ID,"c1");
  resource.setProperty(HOST_NAME_PROPERTY_ID,"domU-12-31-39-0E-34-E1.compute-1.internal");
  resource.setProperty(COMPONENT_NAME_PROPERTY_ID,"DATANODE");
  resource.setProperty(SERVICE_NAME_PROPERTY_ID,"HDFS");
  Map<String,TemporalInfo> temporalInfoMap=new HashMap<String,TemporalInfo>();
  temporalInfoMap.put(PROPERTY_ID_1,new TemporalInfoImpl(10L,20L,1L));
  Request request=PropertyHelper.getReadRequest(Collections.singleton(PROPERTY_ID_1),temporalInfoMap);
  Assert.assertEquals(1,provider.populateResources(Collections.singleton(resource),request,null).size());
  Assert.assertTrue(resource.getPropertyValue(PROPERTY_ID_1) instanceof Number[][]);
  Number[][] datapoints=(Number[][])resource.getPropertyValue(PROPERTY_ID_1);
  for (int i=0; i < datapoints.length; ++i) {
    Assert.assertEquals((long)i,datapoints[i][0]);
    Assert.assertEquals((999990L + i) / 1000,datapoints[i][1]);
  }
  verify(connectionFactory,connection,statement,resultSet);
}

</code></pre>

<br>
<pre class="type-4 type-12 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPopulateResources_temporalStartTimeOnly() throws Exception {
  ConnectionFactory connectionFactory=createNiceMock(ConnectionFactory.class);
  Connection connection=createNiceMock(Connection.class);
  Statement statement=createNiceMock(Statement.class);
  ResultSet resultSet=createNiceMock(ResultSet.class);
  expect(connectionFactory.getConnection()).andReturn(connection).once();
  expect(connection.createStatement()).andReturn(statement).once();
  expect(statement.executeQuery(anyObject(String.class))).andReturn(resultSet).once();
  expect(resultSet.next()).andReturn(true);
  expect(resultSet.getLong("RecordTimeStamp")).andReturn(999990L);
  expect(resultSet.getNString("MetricValue")).andReturn("0");
  expect(resultSet.next()).andReturn(true);
  expect(resultSet.getLong("RecordTimeStamp")).andReturn(999991L);
  expect(resultSet.getNString("MetricValue")).andReturn("1");
  expect(resultSet.next()).andReturn(true);
  expect(resultSet.getLong("RecordTimeStamp")).andReturn(999992L);
  expect(resultSet.getNString("MetricValue")).andReturn("2");
  expect(resultSet.next()).andReturn(true);
  expect(resultSet.getLong("RecordTimeStamp")).andReturn(999993L);
  expect(resultSet.getNString("MetricValue")).andReturn("3");
  expect(resultSet.next()).andReturn(false);
  replay(connectionFactory,connection,statement,resultSet);
  TestHostInfoProvider hostProvider=new TestHostInfoProvider();
  SQLPropertyProvider provider=new SQLPropertyProvider(PropertyHelper.getGangliaPropertyIds(Resource.Type.HostComponent),hostProvider,CLUSTER_NAME_PROPERTY_ID,HOST_NAME_PROPERTY_ID,COMPONENT_NAME_PROPERTY_ID,SERVICE_NAME_PROPERTY_ID,connectionFactory);
  Resource resource=new ResourceImpl(Resource.Type.HostComponent);
  resource.setProperty(CLUSTER_NAME_PROPERTY_ID,"c1");
  resource.setProperty(HOST_NAME_PROPERTY_ID,"domU-12-31-39-0E-34-E1.compute-1.internal");
  resource.setProperty(COMPONENT_NAME_PROPERTY_ID,"DATANODE");
  resource.setProperty(SERVICE_NAME_PROPERTY_ID,"HDFS");
  Map<String,TemporalInfo> temporalInfoMap=new HashMap<String,TemporalInfo>();
  temporalInfoMap.put(PROPERTY_ID_1,new TemporalInfoImpl(10L,-1L,-1L));
  Request request=PropertyHelper.getReadRequest(Collections.singleton(PROPERTY_ID_1),temporalInfoMap);
  Assert.assertEquals(1,provider.populateResources(Collections.singleton(resource),request,null).size());
  Assert.assertTrue(resource.getPropertyValue(PROPERTY_ID_1) instanceof Number[][]);
  Number[][] datapoints=(Number[][])resource.getPropertyValue(PROPERTY_ID_1);
  for (int i=0; i < datapoints.length; ++i) {
    Assert.assertEquals((long)i,datapoints[i][0]);
    Assert.assertEquals((999990L + i) / 1000,datapoints[i][1]);
  }
  verify(connectionFactory,connection,statement,resultSet);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.actionmanager.TestActionScheduler </h4><pre class="type-12 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Tests that the whole request is aborted when there are no QUEUED tasks for a role and
 * success factor is not met. As long as there is one QUEUED task the request is not
 * aborted.
 * @throws Exception
 */
@Test public void testRequestAbortsOnlyWhenNoQueuedTaskAndSuccessFactorUnmet() throws Exception {
  ActionQueue aq=new ActionQueue();
  Clusters fsm=mock(Clusters.class);
  Cluster oneClusterMock=mock(Cluster.class);
  Service serviceObj=mock(Service.class);
  ServiceComponent scomp=mock(ServiceComponent.class);
  ServiceComponentHost sch=mock(ServiceComponentHost.class);
  UnitOfWork unitOfWork=mock(UnitOfWork.class);
  when(fsm.getCluster(anyString())).thenReturn(oneClusterMock);
  when(oneClusterMock.getService(anyString())).thenReturn(serviceObj);
  when(serviceObj.getServiceComponent(anyString())).thenReturn(scomp);
  when(scomp.getServiceComponentHost(anyString())).thenReturn(sch);
  when(serviceObj.getCluster()).thenReturn(oneClusterMock);
  String host1="host1";
  String host2="host2";
  Host host=mock(Host.class);
  HashMap<String,ServiceComponentHost> hosts=new HashMap<String,ServiceComponentHost>();
  hosts.put(host1,sch);
  hosts.put(host2,sch);
  when(scomp.getServiceComponentHosts()).thenReturn(hosts);
  when(fsm.getHost(anyString())).thenReturn(host);
  when(host.getState()).thenReturn(HostState.HEALTHY);
  when(host.getHostName()).thenReturn(host1);
  HostEntity hostEntity1=new HostEntity();
  HostEntity hostEntity2=new HostEntity();
  hostEntity1.setHostName(host1);
  hostEntity2.setHostName(host2);
  hostDAO.create(hostEntity1);
  hostDAO.create(hostEntity2);
  final List<Stage> stages=new ArrayList<Stage>();
  long now=System.currentTimeMillis();
  Stage stage=stageFactory.createNew(1,"/tmp","cluster1",1L,"testRequestFailureBasedOnSuccessFactor",CLUSTER_HOST_INFO,"","");
  stage.setStageId(1);
  addHostRoleExecutionCommand(now,stage,Role.SQOOP,Service.Type.SQOOP,RoleCommand.INSTALL,host1,"cluster1");
  addHostRoleExecutionCommand(now,stage,Role.OOZIE_CLIENT,Service.Type.OOZIE,RoleCommand.INSTALL,host1,"cluster1");
  addHostRoleExecutionCommand(now,stage,Role.MAPREDUCE_CLIENT,Service.Type.MAPREDUCE,RoleCommand.INSTALL,host1,"cluster1");
  addHostRoleExecutionCommand(now,stage,Role.HBASE_CLIENT,Service.Type.HBASE,RoleCommand.INSTALL,host1,"cluster1");
  addHostRoleExecutionCommand(now,stage,Role.GANGLIA_MONITOR,Service.Type.GANGLIA,RoleCommand.INSTALL,host1,"cluster1");
  addHostRoleExecutionCommand(now,stage,Role.HBASE_CLIENT,Service.Type.HBASE,RoleCommand.INSTALL,host2,"cluster1");
  addHostRoleExecutionCommand(now,stage,Role.GANGLIA_MONITOR,Service.Type.GANGLIA,RoleCommand.INSTALL,host2,"cluster1");
  stages.add(stage);
  HostRoleStatus[] statusesAtIterOne={HostRoleStatus.QUEUED,HostRoleStatus.QUEUED,HostRoleStatus.QUEUED,HostRoleStatus.QUEUED,HostRoleStatus.FAILED,HostRoleStatus.FAILED,HostRoleStatus.QUEUED,HostRoleStatus.QUEUED};
  for (int index=0; index < stage.getOrderedHostRoleCommands().size(); index++) {
    stage.getOrderedHostRoleCommands().get(index).setTaskId(index + 1);
    stage.getOrderedHostRoleCommands().get(index).setStatus(statusesAtIterOne[index]);
  }
  stage.setLastAttemptTime(host1,Role.SQOOP.toString(),now);
  stage.setLastAttemptTime(host1,Role.MAPREDUCE_CLIENT.toString(),now);
  stage.setLastAttemptTime(host1,Role.OOZIE_CLIENT.toString(),now);
  stage.setLastAttemptTime(host1,Role.GANGLIA_MONITOR.toString(),now);
  stage.setLastAttemptTime(host1,Role.HBASE_CLIENT.toString(),now);
  stage.setLastAttemptTime(host2,Role.GANGLIA_MONITOR.toString(),now);
  stage.setLastAttemptTime(host2,Role.HBASE_CLIENT.toString(),now);
  ActionDBAccessor db=mock(ActionDBAccessor.class);
  RequestEntity request=mock(RequestEntity.class);
  when(request.isExclusive()).thenReturn(false);
  when(db.getRequestEntity(anyLong())).thenReturn(request);
  when(db.getCommandsInProgressCount()).thenReturn(stages.size());
  when(db.getStagesInProgress()).thenReturn(stages);
  doAnswer(new Answer<Void>(){
    @Override public Void answer(    InvocationOnMock invocation) throws Throwable {
      String host=(String)invocation.getArguments()[0];
      Long requestId=(Long)invocation.getArguments()[1];
      Long stageId=(Long)invocation.getArguments()[2];
      String role=(String)invocation.getArguments()[3];
      CommandReport commandReport=(CommandReport)invocation.getArguments()[4];
      for (      Stage stage : stages) {
        if (requestId.equals(stage.getRequestId()) && stageId.equals(stage.getStageId())) {
          HostRoleCommand command=stage.getHostRoleCommand(host,role);
          command.setStatus(HostRoleStatus.valueOf(commandReport.getStatus()));
        }
      }
      return null;
    }
  }
).when(db).updateHostRoleState(anyString(),anyLong(),anyLong(),anyString(),any(CommandReport.class));
  when(db.getTask(anyLong())).thenAnswer(new Answer(){
    @Override public Object answer(    InvocationOnMock invocation) throws Throwable {
      Long taskId=(Long)invocation.getArguments()[0];
      for (      Stage stage : stages) {
        for (        HostRoleCommand command : stage.getOrderedHostRoleCommands()) {
          if (taskId.equals(command.getTaskId())) {
            return command;
          }
        }
      }
      return null;
    }
  }
);
  doAnswer(new Answer<Void>(){
    @Override public Void answer(    InvocationOnMock invocation) throws Throwable {
      Long requestId=(Long)invocation.getArguments()[0];
      for (      Stage stage : stages) {
        if (requestId.equals(stage.getRequestId())) {
          for (          HostRoleCommand command : stage.getOrderedHostRoleCommands()) {
            if (command.getStatus() == HostRoleStatus.QUEUED || command.getStatus() == HostRoleStatus.IN_PROGRESS || command.getStatus() == HostRoleStatus.PENDING) {
              command.setStatus(HostRoleStatus.ABORTED);
            }
          }
        }
      }
      return null;
    }
  }
).when(db).abortOperation(anyLong());
  Properties properties=new Properties();
  Configuration conf=new Configuration(properties);
  ActionScheduler scheduler=new ActionScheduler(100,10000,db,aq,fsm,3,new HostsMap((String)null),unitOfWork,null,conf);
  scheduler.doWork();
  HostRoleStatus[] expectedStatusesAtIterOne={HostRoleStatus.QUEUED,HostRoleStatus.QUEUED,HostRoleStatus.QUEUED,HostRoleStatus.QUEUED,HostRoleStatus.FAILED,HostRoleStatus.FAILED,HostRoleStatus.QUEUED,HostRoleStatus.QUEUED};
  for (int index=0; index < stage.getOrderedHostRoleCommands().size(); index++) {
    log.info(stage.getOrderedHostRoleCommands().get(index).toString());
    Assert.assertEquals(expectedStatusesAtIterOne[index],stage.getOrderedHostRoleCommands().get(index).getStatus());
  }
  HostRoleStatus[] statusesAtIterTwo={HostRoleStatus.QUEUED,HostRoleStatus.QUEUED,HostRoleStatus.QUEUED,HostRoleStatus.QUEUED,HostRoleStatus.FAILED,HostRoleStatus.FAILED,HostRoleStatus.QUEUED,HostRoleStatus.COMPLETED};
  for (int index=0; index < stage.getOrderedHostRoleCommands().size(); index++) {
    stage.getOrderedHostRoleCommands().get(index).setStatus(statusesAtIterTwo[index]);
  }
  scheduler.doWork();
  HostRoleStatus[] expectedStatusesAtIterTwo={HostRoleStatus.QUEUED,HostRoleStatus.QUEUED,HostRoleStatus.QUEUED,HostRoleStatus.QUEUED,HostRoleStatus.FAILED,HostRoleStatus.FAILED,HostRoleStatus.QUEUED,HostRoleStatus.COMPLETED};
  for (int index=0; index < stage.getOrderedHostRoleCommands().size(); index++) {
    log.info(stage.getOrderedHostRoleCommands().get(index).toString());
    Assert.assertEquals(expectedStatusesAtIterTwo[index],stage.getOrderedHostRoleCommands().get(index).getStatus());
  }
  HostRoleStatus[] statusesAtIterThree={HostRoleStatus.QUEUED,HostRoleStatus.QUEUED,HostRoleStatus.QUEUED,HostRoleStatus.QUEUED,HostRoleStatus.FAILED,HostRoleStatus.FAILED,HostRoleStatus.FAILED,HostRoleStatus.COMPLETED};
  for (int index=0; index < stage.getOrderedHostRoleCommands().size(); index++) {
    stage.getOrderedHostRoleCommands().get(index).setStatus(statusesAtIterThree[index]);
  }
  scheduler.doWork();
  HostRoleStatus[] expectedStatusesAtIterThree={HostRoleStatus.ABORTED,HostRoleStatus.ABORTED,HostRoleStatus.ABORTED,HostRoleStatus.ABORTED,HostRoleStatus.FAILED,HostRoleStatus.FAILED,HostRoleStatus.FAILED,HostRoleStatus.COMPLETED};
  for (int index=0; index < stage.getOrderedHostRoleCommands().size(); index++) {
    log.info(stage.getOrderedHostRoleCommands().get(index).toString());
    Assert.assertEquals(expectedStatusesAtIterThree[index],stage.getOrderedHostRoleCommands().get(index).getStatus());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.agent.TestActionQueue </h4><pre class="type-12 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testConcurrentOperations() throws InterruptedException {
  ActionQueue aq=new ActionQueue();
  String[] hosts=new String[]{"h0","h1","h2","h3","h4","h5","h6","h7","h8","h9"};
  ActionQueueOperation[] enqueOperators=new ActionQueueOperation[threadCount];
  ActionQueueOperation[] dequeOperators=new ActionQueueOperation[threadCount];
  ActionQueueOperation[] dequeAllOperators=new ActionQueueOperation[threadCount];
  List<Thread> producers=new ArrayList<Thread>();
  List<Thread> consumers=new ArrayList<Thread>();
  for (int i=0; i < threadCount; i++) {
    dequeOperators[i]=new ActionQueueOperation(aq,hosts,ActionQueueOperation.OpType.DEQUEUE);
    Thread t=new Thread(dequeOperators[i]);
    consumers.add(t);
    t.start();
  }
  for (int i=0; i < threadCount; i++) {
    enqueOperators[i]=new ActionQueueOperation(aq,hosts,ActionQueueOperation.OpType.ENQUEUE);
    Thread t=new Thread(enqueOperators[i]);
    producers.add(t);
    t.start();
  }
  for (int i=0; i < threadCount; i++) {
    dequeAllOperators[i]=new ActionQueueOperation(aq,hosts,ActionQueueOperation.OpType.DEQUEUEALL);
    Thread t=new Thread(dequeAllOperators[i]);
    consumers.add(t);
    t.start();
  }
  Thread.sleep(100);
  for (int i=0; i < threadCount; i++) {
    enqueOperators[i].stop();
  }
  for (  Thread producer : producers) {
    producer.join();
  }
  boolean allDequeued=false;
  while (!allDequeued) {
    Thread.sleep(10);
    allDequeued=true;
    for (    String host : hosts) {
      if (aq.size(host) > 0) {
        allDequeued=false;
        break;
      }
    }
  }
  for (int i=0; i < threadCount; i++) {
    dequeOperators[i].stop();
    dequeAllOperators[i].stop();
  }
  for (  Thread consumer : consumers) {
    consumer.join();
  }
  for (int h=0; h < hosts.length; h++) {
    long opsEnqueued=0;
    long opsDequeued=0;
    for (int i=0; i < threadCount; i++) {
      opsEnqueued+=enqueOperators[i].getOpCounts()[h];
      opsDequeued+=dequeOperators[i].getOpCounts()[h];
      opsDequeued+=dequeAllOperators[i].getOpCounts()[h];
    }
    assertTrue(opsEnqueued != 0);
    assertEquals(0,aq.size(hosts[h]));
    LOG.info("Host: " + hosts[h] + ", opsEnqueued: "+ opsEnqueued+ ", opsDequeued: "+ opsDequeued);
    assertEquals(opsDequeued,opsEnqueued);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.agent.TestHeartbeatMonitor </h4><pre class="type-12 type-13 type-10 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testHeartbeatStateCommandsEnqueueing() throws AmbariException, InterruptedException, InvalidStateTransitionException {
  StackId stackId=new StackId("HDP-0.1");
  Clusters clusters=injector.getInstance(Clusters.class);
  clusters.addHost(hostname1);
  setOsFamily(clusters.getHost(hostname1),"redhat","5.9");
  clusters.getHost(hostname1).persist();
  clusters.addCluster(clusterName,stackId);
  Cluster cluster=clusters.getCluster(clusterName);
  helper.getOrCreateRepositoryVersion(stackId,stackId.getStackVersion());
  cluster.createClusterVersion(stackId,stackId.getStackVersion(),"admin",RepositoryVersionState.UPGRADING);
  Set<String> hostNames=new HashSet<String>(){
{
      add(hostname1);
    }
  }
;
  clusters.mapHostsToCluster(hostNames,clusterName);
  Service hdfs=cluster.addService(serviceName);
  hdfs.persist();
  hdfs.addServiceComponent(Role.DATANODE.name()).persist();
  hdfs.getServiceComponent(Role.DATANODE.name()).addServiceComponentHost(hostname1).persist();
  hdfs.addServiceComponent(Role.NAMENODE.name()).persist();
  hdfs.getServiceComponent(Role.NAMENODE.name()).addServiceComponentHost(hostname1).persist();
  hdfs.addServiceComponent(Role.SECONDARY_NAMENODE.name()).persist();
  hdfs.getServiceComponent(Role.SECONDARY_NAMENODE.name()).addServiceComponentHost(hostname1).persist();
  hdfs.getServiceComponent(Role.DATANODE.name()).getServiceComponentHost(hostname1).setState(State.INSTALLED);
  hdfs.getServiceComponent(Role.NAMENODE.name()).getServiceComponentHost(hostname1).setState(State.INSTALLED);
  hdfs.getServiceComponent(Role.SECONDARY_NAMENODE.name()).getServiceComponentHost(hostname1).setState(State.INSTALLED);
  ActionQueue aqMock=mock(ActionQueue.class);
  ArgumentCaptor<AgentCommand> commandCaptor=ArgumentCaptor.forClass(AgentCommand.class);
  ActionManager am=mock(ActionManager.class);
  HeartbeatMonitor hm=new HeartbeatMonitor(clusters,aqMock,am,heartbeatMonitorWakeupIntervalMS,injector);
  HeartBeatHandler handler=new HeartBeatHandler(clusters,aqMock,am,injector);
  Register reg=new Register();
  reg.setHostname(hostname1);
  reg.setResponseId(12);
  reg.setTimestamp(System.currentTimeMillis() - 15);
  reg.setAgentVersion(ambariMetaInfo.getServerVersion());
  HostInfo hi=new HostInfo();
  hi.setOS("Centos5");
  reg.setHardwareProfile(hi);
  handler.handleRegistration(reg);
  HeartBeat hb=new HeartBeat();
  hb.setHostname(hostname1);
  hb.setNodeStatus(new HostStatus(HostStatus.Status.HEALTHY,"cool"));
  hb.setTimestamp(System.currentTimeMillis());
  hb.setResponseId(13);
  handler.handleHeartBeat(hb);
  LOG.info("YYY");
  clusters.getHost(hostname1).setLastHeartbeatTime(System.currentTimeMillis() - 15);
  hm.start();
  Thread.sleep(3 * heartbeatMonitorWakeupIntervalMS);
  hm.shutdown();
  int tryNumber=0;
  while (hm.isAlive()) {
    hm.join(2 * heartbeatMonitorWakeupIntervalMS);
    tryNumber++;
    if (tryNumber >= 5) {
      fail("HeartbeatMonitor should be already stopped");
    }
  }
  verify(aqMock,atLeast(2)).enqueue(eq(hostname1),commandCaptor.capture());
  List<AgentCommand> cmds=commandCaptor.getAllValues();
  assertTrue("HeartbeatMonitor should generate StatusCommands for host1",cmds.size() >= 2);
  for (  AgentCommand command : cmds) {
    assertEquals("HDFS",((StatusCommand)command).getServiceName());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.controller.RootServiceResponseFactoryTest </h4><pre class="type-12 type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetRootServiceComponents() throws Exception {
  RootServiceComponentRequest request=new RootServiceComponentRequest(null,null);
  Set<RootServiceComponentResponse> rootServiceComponents;
  try {
    rootServiceComponents=responseFactory.getRootServiceComponents(request);
  }
 catch (  Exception e) {
    assertTrue(e instanceof ObjectNotFoundException);
  }
  RootServiceResponseFactory.Components ambariServerComponent=RootServiceResponseFactory.Components.AMBARI_SERVER;
  request=new RootServiceComponentRequest(null,ambariServerComponent.name());
  try {
    rootServiceComponents=responseFactory.getRootServiceComponents(request);
  }
 catch (  Exception e) {
    assertTrue(e instanceof ObjectNotFoundException);
  }
  request=new RootServiceComponentRequest(RootServiceResponseFactory.Services.AMBARI.name(),null);
  rootServiceComponents=responseFactory.getRootServiceComponents(request);
  assertEquals(RootServiceResponseFactory.Services.AMBARI.getComponents().length,rootServiceComponents.size());
  String ambariVersion=ambariMetaInfo.getServerVersion();
  for (int i=0; i < RootServiceResponseFactory.Services.AMBARI.getComponents().length; i++) {
    Components component=RootServiceResponseFactory.Services.AMBARI.getComponents()[i];
    if (component.name().equals(ambariServerComponent.name())) {
      for (      RootServiceComponentResponse response : rootServiceComponents) {
        if (response.getComponentName().equals(ambariServerComponent.name())) {
          assertEquals(ambariVersion,response.getComponentVersion());
          assertEquals(1,response.getProperties().size(),1);
          assertTrue(response.getProperties().containsKey("jdk_location"));
        }
      }
    }
 else {
      assertTrue(rootServiceComponents.contains(new RootServiceComponentResponse(component.name(),RootServiceResponseFactory.NOT_APPLICABLE,Collections.<String,String>emptyMap())));
    }
  }
  request=new RootServiceComponentRequest(RootServiceResponseFactory.Services.AMBARI.name(),RootServiceResponseFactory.Services.AMBARI.getComponents()[0].name());
  rootServiceComponents=responseFactory.getRootServiceComponents(request);
  assertEquals(1,rootServiceComponents.size());
  for (  RootServiceComponentResponse response : rootServiceComponents) {
    if (response.getComponentName().equals(RootServiceResponseFactory.Services.AMBARI.getComponents()[0].name())) {
      assertEquals(ambariVersion,response.getComponentVersion());
      assertEquals(2,response.getProperties().size());
      assertTrue(response.getProperties().containsKey("jdk_location"));
      assertTrue(response.getProperties().containsKey("java.version"));
    }
  }
  request=new RootServiceComponentRequest(RootServiceResponseFactory.Services.AMBARI.name(),"XXX");
  try {
    rootServiceComponents=responseFactory.getRootServiceComponents(request);
  }
 catch (  Exception e) {
    assertTrue(e instanceof ObjectNotFoundException);
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.controller.test.BufferedThreadPoolExecutorCompletionServiceTest </h4><pre class="type-12 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that when unbounded queue provided to executor, only{@link ThreadPoolExecutor#getCorePoolSize()} threads are launched
 * @throws InterruptedException
 */
@Test public void testOnlyCorePoolThreadsLaunchedForUnboundedQueue() throws InterruptedException {
  int CORE_POOL_SIZE=2;
  int MAX_POOL_SIZE=5;
  int TASKS_COUNT=8;
  LinkedBlockingQueue<Runnable> queue=new LinkedBlockingQueue<Runnable>();
  ThreadPoolExecutor threadPoolExecutor=new ThreadPoolExecutor(CORE_POOL_SIZE,MAX_POOL_SIZE,30000,TimeUnit.MILLISECONDS,queue);
  BufferedThreadPoolExecutorCompletionService<Runnable> service=new BufferedThreadPoolExecutorCompletionService<>(threadPoolExecutor);
  for (int tc=0; tc < TASKS_COUNT; tc++) {
    service.submit(new Runnable(){
      @Override public void run(){
        try {
          longOp();
        }
 catch (        InterruptedException e) {
          e.printStackTrace();
        }
      }
    }
,null);
  }
  Thread.sleep(500);
  Assert.assertEquals(CORE_POOL_SIZE,threadPoolExecutor.getActiveCount());
  for (int tc=0; tc < TASKS_COUNT; tc++) {
    Future<Runnable> take=service.take();
    Assert.assertTrue(take.isDone());
    Assert.assertTrue("No more than CORE_POOL_SIZE threads should be launched",threadPoolExecutor.getActiveCount() <= CORE_POOL_SIZE);
  }
  threadPoolExecutor.shutdown();
}

</code></pre>

<br>
<pre class="type-12 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that when load is more than max-pool-size, the number of threads
 * scales up.
 * @throws InterruptedException
 */
@Test public void testMaxPoolSizeThreadsLaunched() throws InterruptedException {
  int CORE_POOL_SIZE=2;
  int MAX_POOL_SIZE=10;
  int TASKS_COUNT=24;
  LinkedBlockingQueue<Runnable> queue=new LinkedBlockingQueue<Runnable>(CORE_POOL_SIZE);
  ThreadPoolExecutor threadPoolExecutor=new ThreadPoolExecutor(CORE_POOL_SIZE,MAX_POOL_SIZE,30000,TimeUnit.MILLISECONDS,queue);
  BufferedThreadPoolExecutorCompletionService<Runnable> service=new BufferedThreadPoolExecutorCompletionService<>(threadPoolExecutor);
  for (int tc=0; tc < TASKS_COUNT; tc++) {
    service.submit(new Runnable(){
      @Override public void run(){
        try {
          longOp();
        }
 catch (        InterruptedException e) {
          e.printStackTrace();
        }
      }
    }
,null);
  }
  Thread.sleep(500);
  Assert.assertEquals(MAX_POOL_SIZE,threadPoolExecutor.getActiveCount());
  for (int tc=0; tc < TASKS_COUNT; tc++) {
    Future<Runnable> take=service.take();
    Assert.assertTrue(take.isDone());
    Assert.assertTrue("No more than MAX_POOL_SIZE threads should be launched",threadPoolExecutor.getActiveCount() <= MAX_POOL_SIZE);
  }
  threadPoolExecutor.shutdown();
}

</code></pre>

<br>
<pre class="type-12 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that when load is more than core-pool-size and less than
 * max-pool-size, the number of threads scales up.
 * @throws InterruptedException
 */
@Test public void testLessThanMaxPoolSizeThreadsLaunched() throws InterruptedException {
  int CORE_POOL_SIZE=2;
  int MAX_POOL_SIZE=10;
  int TASKS_COUNT=8;
  LinkedBlockingQueue<Runnable> queue=new LinkedBlockingQueue<Runnable>(CORE_POOL_SIZE);
  ThreadPoolExecutor threadPoolExecutor=new ThreadPoolExecutor(CORE_POOL_SIZE,MAX_POOL_SIZE,30000,TimeUnit.MILLISECONDS,queue);
  BufferedThreadPoolExecutorCompletionService<Runnable> service=new BufferedThreadPoolExecutorCompletionService<>(threadPoolExecutor);
  for (int tc=0; tc < TASKS_COUNT; tc++) {
    service.submit(new Runnable(){
      @Override public void run(){
        try {
          longOp();
        }
 catch (        InterruptedException e) {
          e.printStackTrace();
        }
      }
    }
,null);
  }
  Thread.sleep(500);
  Assert.assertEquals(TASKS_COUNT - CORE_POOL_SIZE,threadPoolExecutor.getActiveCount());
  for (int tc=0; tc < TASKS_COUNT; tc++) {
    Future<Runnable> take=service.take();
    Assert.assertTrue(take.isDone());
    Assert.assertTrue("No more than TASKS_COUNT threads should be launched",threadPoolExecutor.getActiveCount() <= TASKS_COUNT);
  }
  threadPoolExecutor.shutdown();
}

</code></pre>

<br>
<pre class="type-12 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that when load is more than max-pool-size, the number of threads
 * scales up.
 * @throws InterruptedException
 */
@Test public void testScalingThreadPoolExecutor() throws InterruptedException {
  int CORE_POOL_SIZE=2;
  int MAX_POOL_SIZE=10;
  int TASKS_COUNT=24;
  ThreadPoolExecutor threadPoolExecutor=new ScalingThreadPoolExecutor(CORE_POOL_SIZE,MAX_POOL_SIZE,30000,TimeUnit.MILLISECONDS);
  BufferedThreadPoolExecutorCompletionService<Runnable> service=new BufferedThreadPoolExecutorCompletionService<>(threadPoolExecutor);
  for (int tc=0; tc < TASKS_COUNT; tc++) {
    service.submit(new Runnable(){
      @Override public void run(){
        try {
          longOp();
        }
 catch (        InterruptedException e) {
          e.printStackTrace();
        }
      }
    }
,null);
  }
  Thread.sleep(500);
  Assert.assertEquals(MAX_POOL_SIZE,threadPoolExecutor.getActiveCount());
  for (int tc=0; tc < TASKS_COUNT; tc++) {
    Future<Runnable> take=service.take();
    Assert.assertTrue(take.isDone());
    Assert.assertTrue("No more than MAX_POOL_SIZE threads should be launched",threadPoolExecutor.getActiveCount() <= MAX_POOL_SIZE);
  }
  threadPoolExecutor.shutdown();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.orm.DBAccessorImplTest </h4><pre class="type-4 type-12 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testUpdateTable() throws Exception {
  String tableName=getFreeTableName();
  createMyTable(tableName);
  DBAccessorImpl dbAccessor=injector.getInstance(DBAccessorImpl.class);
  dbAccessor.updateTable(tableName,"name","blah","where id = 1");
  Statement statement=dbAccessor.getConnection().createStatement();
  ResultSet resultSet=statement.executeQuery("select name from " + tableName);
  while (resultSet.next()) {
    assertEquals(resultSet.getString("name"),"blah");
  }
  resultSet.close();
}

</code></pre>

<br>
<pre class="type-4 type-12 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAddColumnWithDefault() throws Exception {
  String tableName=getFreeTableName();
  createMyTable(tableName);
  DBAccessorImpl dbAccessor=injector.getInstance(DBAccessorImpl.class);
  dbAccessor.executeQuery("insert into " + tableName + "(id, name, time) values(1, 'Bob', 1234567)");
  dbAccessor.addColumn(tableName,new DBColumnInfo("test",String.class,1000,"test",false));
  Statement statement=dbAccessor.getConnection().createStatement();
  ResultSet resultSet=statement.executeQuery("select * from " + tableName);
  int count=0;
  while (resultSet.next()) {
    assertEquals(resultSet.getString("test"),"test");
    count++;
  }
  assertEquals(count,1);
}

</code></pre>

<br>
<pre class="type-4 type-12 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAddColumn() throws Exception {
  String tableName=getFreeTableName();
  createMyTable(tableName);
  DBAccessorImpl dbAccessor=injector.getInstance(DBAccessorImpl.class);
  DBColumnInfo dbColumnInfo=new DBColumnInfo("description",String.class,null,null,true);
  dbAccessor.addColumn(tableName,dbColumnInfo);
  Statement statement=dbAccessor.getConnection().createStatement();
  statement.execute("update " + tableName + " set description = 'blah' where id = 1");
  ResultSet resultSet=statement.executeQuery("select description from " + tableName);
  while (resultSet.next()) {
    assertEquals(resultSet.getString("description"),"blah");
  }
  resultSet.close();
}

</code></pre>

<br>
<pre class="type-4 type-12 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAddFKConstraint() throws Exception {
  String tableName=getFreeTableName();
  createMyTable(tableName);
  DBAccessorImpl dbAccessor=injector.getInstance(DBAccessorImpl.class);
  List<DBColumnInfo> columns=new ArrayList<DBColumnInfo>();
  columns.add(new DBColumnInfo("fid",Long.class,null,null,false));
  columns.add(new DBColumnInfo("fname",String.class,null,null,false));
  String foreignTableName=getFreeTableName();
  dbAccessor.createTable(foreignTableName,columns,"fid");
  dbAccessor.addFKConstraint(foreignTableName,"MYFKCONSTRAINT","fid",tableName,"id",false);
  Statement statement=dbAccessor.getConnection().createStatement();
  statement.execute("insert into " + tableName + "(id, name) values(1,'hello')");
  statement.execute("insert into " + foreignTableName + "(fid, fname) values(1,'howdy')");
  ResultSet resultSet=statement.executeQuery("select * from " + foreignTableName);
  int count=0;
  while (resultSet.next()) {
    assertEquals(resultSet.getString("fname"),"howdy");
    count++;
  }
  resultSet.close();
  assertEquals(count,1);
  exception.expect(SQLException.class);
  exception.expectMessage(containsString("MYFKCONSTRAINT"));
  dbAccessor.dropTable(tableName);
}

</code></pre>

<br>
<pre class="type-4 type-12 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAlterColumn() throws Exception {
  String tableName=getFreeTableName();
  createMyTable(tableName);
  DBAccessorImpl dbAccessor=injector.getInstance(DBAccessorImpl.class);
  ResultSet rs;
  DBColumnInfo fromColumn;
  DBColumnInfo toColumn;
  Statement statement=dbAccessor.getConnection().createStatement();
  final String dataString="Data for inserting column.";
  toColumn=new DBColumnInfo("name",String.class,500,null,true);
  statement.execute(String.format("INSERT INTO %s(id, name) VALUES (1, '%s')",tableName,dataString));
  dbAccessor.alterColumn(tableName,toColumn);
  rs=statement.executeQuery(String.format("SELECT name FROM %s",tableName));
  while (rs.next()) {
    ResultSetMetaData rsm=rs.getMetaData();
    assertEquals(rs.getString(toColumn.getName()),dataString);
    assertEquals(rsm.getColumnTypeName(1),"VARCHAR");
    assertEquals(rsm.getColumnDisplaySize(1),500);
  }
  rs.close();
  toColumn=new DBColumnInfo("name",char[].class,999,null,true);
  dbAccessor.alterColumn(tableName,toColumn);
  rs=statement.executeQuery(String.format("SELECT name FROM %s",tableName));
  while (rs.next()) {
    ResultSetMetaData rsm=rs.getMetaData();
    Clob clob=rs.getClob(toColumn.getName());
    assertEquals(clob.getSubString(1,(int)clob.length()),dataString);
    assertEquals(rsm.getColumnTypeName(1),"CLOB");
    assertEquals(rsm.getColumnDisplaySize(1),999);
  }
  rs.close();
  toColumn=new DBColumnInfo("name_blob_to_clob",char[].class,567,null,true);
  fromColumn=new DBColumnInfo("name_blob_to_clob",byte[].class,20000,null,true);
  dbAccessor.addColumn(tableName,fromColumn);
  String sql=String.format("insert into %s(id, name_blob_to_clob) values (2, ?)",tableName);
  PreparedStatement preparedStatement=dbAccessor.getConnection().prepareStatement(sql);
  preparedStatement.setBinaryStream(1,new ByteArrayInputStream(dataString.getBytes()),dataString.getBytes().length);
  preparedStatement.executeUpdate();
  preparedStatement.close();
  dbAccessor.alterColumn(tableName,toColumn);
  rs=statement.executeQuery(String.format("SELECT name_blob_to_clob FROM %s WHERE id=2",tableName));
  while (rs.next()) {
    ResultSetMetaData rsm=rs.getMetaData();
    Clob clob=rs.getClob(toColumn.getName());
    assertEquals(clob.getSubString(1,(int)clob.length()),dataString);
    assertEquals(rsm.getColumnTypeName(1),"CLOB");
    assertEquals(rsm.getColumnDisplaySize(1),567);
  }
  rs.close();
  toColumn=new DBColumnInfo("name_blob_to_clob",char[].class,1500,null,true);
  dbAccessor.alterColumn(tableName,toColumn);
  rs=statement.executeQuery(String.format("SELECT name_blob_to_clob FROM %s WHERE id=2",tableName));
  while (rs.next()) {
    ResultSetMetaData rsm=rs.getMetaData();
    Clob clob=rs.getClob(toColumn.getName());
    assertEquals(clob.getSubString(1,(int)clob.length()),dataString);
    assertEquals(rsm.getColumnTypeName(1),"CLOB");
    assertEquals(rsm.getColumnDisplaySize(1),1500);
  }
  rs.close();
  dbAccessor.dropTable(tableName);
}

</code></pre>

<br>
<pre class="type-4 type-12 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRenameColumn() throws Exception {
  String tableName=getFreeTableName();
  createMyTable(tableName);
  DBAccessorImpl dbAccessor=injector.getInstance(DBAccessorImpl.class);
  dbAccessor.executeQuery("insert into " + tableName + "(id, name, time) values(1, 'Bob', 1234567)");
  dbAccessor.renameColumn(tableName,"time",new DBColumnInfo("new_time",Long.class,0,null,true));
  Statement statement=dbAccessor.getConnection().createStatement();
  ResultSet resultSet=statement.executeQuery("select new_time from " + tableName + " where id=1");
  int count=0;
  while (resultSet.next()) {
    count++;
    long newTime=resultSet.getLong("new_time");
    assertEquals(newTime,1234567L);
  }
  assertEquals(count,1);
}

</code></pre>

<br>
<pre class="type-4 type-12 type-2 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCreateTable() throws Exception {
  String tableName=getFreeTableName();
  createMyTable(tableName);
  DBAccessorImpl dbAccessor=injector.getInstance(DBAccessorImpl.class);
  Statement statement=dbAccessor.getConnection().createStatement();
  statement.execute(String.format("insert into %s(id, name) values(1,'hello')",tableName));
  ResultSet resultSet=statement.executeQuery(String.format("select * from %s",tableName));
  int count=0;
  while (resultSet.next()) {
    assertEquals(resultSet.getString("name"),"hello");
    count++;
  }
  assertEquals(count,1);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.serveraction.kerberos.ADKerberosOperationHandlerTest </h4><pre class="type-12 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testProcessCreateTemplateCustom() throws Exception {
  PrincipalKeyCredential kc=new PrincipalKeyCredential(DEFAULT_ADMIN_PRINCIPAL,DEFAULT_ADMIN_PASSWORD);
  Map<String,String> kerberosEnvMap=new HashMap<String,String>(){
{
      put(ADKerberosOperationHandler.KERBEROS_ENV_LDAP_URL,DEFAULT_LDAP_URL);
      put(ADKerberosOperationHandler.KERBEROS_ENV_PRINCIPAL_CONTAINER_DN,DEFAULT_PRINCIPAL_CONTAINER_DN);
      put(ADKerberosOperationHandler.KERBEROS_ENV_AD_CREATE_ATTRIBUTES_TEMPLATE,"" + "#set( $user = \"${principal_primary}-${principal_digest}\" )" + "{"+ "  \"objectClass\": ["+ "    \"top\","+ "    \"person\","+ "    \"organizationalPerson\","+ "    \"user\""+ "  ],"+ "  \"cn\": \"$user\","+ "  \"sAMAccountName\": \"$user.substring(0,20)\","+ "  #if( $is_service )"+ "  \"servicePrincipalName\": \"$principal_name\","+ "  #end"+ "  \"userPrincipalName\": \"$normalized_principal\","+ "  \"unicodePwd\": \"$password\","+ "  \"accountExpires\": \"0\","+ "  \"userAccountControl\": \"66048\""+ "}");
    }
  }
;
  Capture<Name> capturedName=new Capture<Name>();
  Capture<Attributes> capturedAttributes=new Capture<Attributes>();
  ADKerberosOperationHandler handler=createMockBuilder(ADKerberosOperationHandler.class).addMockedMethod(ADKerberosOperationHandler.class.getDeclaredMethod("createInitialLdapContext",Properties.class,Control[].class)).addMockedMethod(ADKerberosOperationHandler.class.getDeclaredMethod("createSearchControls")).createNiceMock();
  NamingEnumeration<SearchResult> searchResult=createNiceMock(NamingEnumeration.class);
  expect(searchResult.hasMore()).andReturn(false).once();
  LdapContext ldapContext=createNiceMock(LdapContext.class);
  expect(ldapContext.search(anyObject(String.class),anyObject(String.class),anyObject(SearchControls.class))).andReturn(searchResult).once();
  expect(ldapContext.createSubcontext(capture(capturedName),capture(capturedAttributes))).andReturn(createNiceMock(DirContext.class)).once();
  expect(handler.createInitialLdapContext(anyObject(Properties.class),anyObject(Control[].class))).andReturn(ldapContext).once();
  expect(handler.createSearchControls()).andAnswer(new IAnswer<SearchControls>(){
    @Override public SearchControls answer() throws Throwable {
      SearchControls searchControls=createNiceMock(SearchControls.class);
      replay(searchControls);
      return searchControls;
    }
  }
).once();
  replayAll();
  handler.open(kc,DEFAULT_REALM,kerberosEnvMap);
  handler.createPrincipal("nn/c6501.ambari.apache.org","secret",true);
  handler.close();
  Attributes attributes=capturedAttributes.getValue();
  String[] objectClasses=new String[]{"top","person","organizationalPerson","user"};
  Assert.assertNotNull(attributes);
  Assert.assertEquals(8,attributes.size());
  Assert.assertNotNull(attributes.get("objectClass"));
  Assert.assertEquals(objectClasses.length,attributes.get("objectClass").size());
  for (int i=0; i < objectClasses.length; i++) {
    Assert.assertEquals(objectClasses[i],attributes.get("objectClass").get(i));
  }
  Assert.assertNotNull(attributes.get("cn"));
  Assert.assertEquals("nn-995e1580db28198e7fda1417ab5d894c877937d2",attributes.get("cn").get());
  Assert.assertNotNull(attributes.get("servicePrincipalName"));
  Assert.assertEquals("nn/c6501.ambari.apache.org",attributes.get("servicePrincipalName").get());
  Assert.assertNotNull(attributes.get("userPrincipalName"));
  Assert.assertEquals("nn/c6501.ambari.apache.org@HDP01.LOCAL",attributes.get("userPrincipalName").get());
  Assert.assertNotNull(attributes.get("sAMAccountName"));
  Assert.assertTrue(attributes.get("sAMAccountName").get().toString().length() <= 20);
  Assert.assertEquals("nn-995e1580db28198e7",attributes.get("sAMAccountName").get());
  Assert.assertNotNull(attributes.get("unicodePwd"));
  Assert.assertEquals("\"secret\"",new String((byte[])attributes.get("unicodePwd").get(),Charset.forName("UTF-16LE")));
  Assert.assertNotNull(attributes.get("accountExpires"));
  Assert.assertEquals("0",attributes.get("accountExpires").get());
  Assert.assertNotNull(attributes.get("userAccountControl"));
  Assert.assertEquals("66048",attributes.get("userAccountControl").get());
}

</code></pre>

<br>
<pre class="type-4 type-12 type-2 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testProcessCreateTemplateDefault() throws Exception {
  PrincipalKeyCredential kc=new PrincipalKeyCredential(DEFAULT_ADMIN_PRINCIPAL,DEFAULT_ADMIN_PASSWORD);
  Map<String,String> kerberosEnvMap=new HashMap<String,String>(){
{
      put(ADKerberosOperationHandler.KERBEROS_ENV_LDAP_URL,DEFAULT_LDAP_URL);
      put(ADKerberosOperationHandler.KERBEROS_ENV_PRINCIPAL_CONTAINER_DN,DEFAULT_PRINCIPAL_CONTAINER_DN);
    }
  }
;
  Capture<Name> capturedName=new Capture<Name>(CaptureType.ALL);
  Capture<Attributes> capturedAttributes=new Capture<Attributes>(CaptureType.ALL);
  ADKerberosOperationHandler handler=createMockBuilder(ADKerberosOperationHandler.class).addMockedMethod(ADKerberosOperationHandler.class.getDeclaredMethod("createInitialLdapContext",Properties.class,Control[].class)).addMockedMethod(ADKerberosOperationHandler.class.getDeclaredMethod("createSearchControls")).createNiceMock();
  NamingEnumeration<SearchResult> searchResult=createNiceMock(NamingEnumeration.class);
  expect(searchResult.hasMore()).andReturn(false).once();
  LdapContext ldapContext=createNiceMock(LdapContext.class);
  expect(ldapContext.search(anyObject(String.class),anyObject(String.class),anyObject(SearchControls.class))).andReturn(searchResult).once();
  expect(ldapContext.createSubcontext(capture(capturedName),capture(capturedAttributes))).andReturn(createNiceMock(DirContext.class)).anyTimes();
  expect(handler.createInitialLdapContext(anyObject(Properties.class),anyObject(Control[].class))).andReturn(ldapContext).once();
  expect(handler.createSearchControls()).andAnswer(new IAnswer<SearchControls>(){
    @Override public SearchControls answer() throws Throwable {
      SearchControls searchControls=createNiceMock(SearchControls.class);
      replay(searchControls);
      return searchControls;
    }
  }
).once();
  replayAll();
  handler.open(kc,DEFAULT_REALM,kerberosEnvMap);
  handler.createPrincipal("nn/c6501.ambari.apache.org","secret",true);
  handler.createPrincipal("hdfs@" + DEFAULT_REALM,"secret",false);
  handler.close();
  List<Attributes> attributesList=capturedAttributes.getValues();
  Attributes attributes;
  attributes=attributesList.get(0);
  String[] objectClasses=new String[]{"top","person","organizationalPerson","user"};
  Assert.assertNotNull(attributes);
  Assert.assertEquals(7,attributes.size());
  Assert.assertNotNull(attributes.get("objectClass"));
  Assert.assertEquals(objectClasses.length,attributes.get("objectClass").size());
  for (int i=0; i < objectClasses.length; i++) {
    Assert.assertEquals(objectClasses[i],attributes.get("objectClass").get(i));
  }
  Assert.assertNotNull(attributes.get("cn"));
  Assert.assertEquals("nn/c6501.ambari.apache.org",attributes.get("cn").get());
  Assert.assertNotNull(attributes.get("servicePrincipalName"));
  Assert.assertEquals("nn/c6501.ambari.apache.org",attributes.get("servicePrincipalName").get());
  Assert.assertNotNull(attributes.get("userPrincipalName"));
  Assert.assertEquals("nn/c6501.ambari.apache.org@HDP01.LOCAL",attributes.get("userPrincipalName").get());
  Assert.assertNotNull(attributes.get("unicodePwd"));
  Assert.assertEquals("\"secret\"",new String((byte[])attributes.get("unicodePwd").get(),Charset.forName("UTF-16LE")));
  Assert.assertNotNull(attributes.get("accountExpires"));
  Assert.assertEquals("0",attributes.get("accountExpires").get());
  Assert.assertNotNull(attributes.get("userAccountControl"));
  Assert.assertEquals("66048",attributes.get("userAccountControl").get());
  attributes=attributesList.get(1);
  Assert.assertNotNull(attributes);
  Assert.assertEquals(6,attributes.size());
  Assert.assertNotNull(attributes.get("objectClass"));
  Assert.assertEquals(objectClasses.length,attributes.get("objectClass").size());
  for (int i=0; i < objectClasses.length; i++) {
    Assert.assertEquals(objectClasses[i],attributes.get("objectClass").get(i));
  }
  Assert.assertNotNull(attributes.get("cn"));
  Assert.assertEquals("hdfs",attributes.get("cn").get());
  Assert.assertNotNull(attributes.get("userPrincipalName"));
  Assert.assertEquals("hdfs@HDP01.LOCAL",attributes.get("userPrincipalName").get());
  Assert.assertNotNull(attributes.get("unicodePwd"));
  Assert.assertEquals("\"secret\"",new String((byte[])attributes.get("unicodePwd").get(),Charset.forName("UTF-16LE")));
  Assert.assertNotNull(attributes.get("accountExpires"));
  Assert.assertEquals("0",attributes.get("accountExpires").get());
  Assert.assertNotNull(attributes.get("userAccountControl"));
  Assert.assertEquals("66048",attributes.get("userAccountControl").get());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.serveraction.kerberos.KerberosConfigDataFileTest </h4><pre class="type-4 type-12 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKerberosConfigDataFile() throws Exception {
  File file=folder.newFile();
  Assert.assertNotNull(file);
  KerberosConfigDataFileWriter writer=kerberosConfigDataFileWriterFactory.createKerberosConfigDataFileWriter(file);
  Assert.assertFalse(writer.isClosed());
  for (int i=0; i < 10; i++) {
    writer.addRecord("config-type" + i,"key" + i,"value" + i,KerberosConfigDataFileWriter.OPERATION_TYPE_SET);
  }
  for (int i=10; i < 15; i++) {
    writer.addRecord("config-type" + i,"key" + i,"value" + i,KerberosConfigDataFileWriter.OPERATION_TYPE_REMOVE);
  }
  writer.close();
  Assert.assertTrue(writer.isClosed());
  KerberosConfigDataFileReader reader=kerberosConfigDataFileReaderFactory.createKerberosConfigDataFileReader(file);
  Assert.assertFalse(reader.isClosed());
  Iterator<Map<String,String>> iterator=reader.iterator();
  Assert.assertNotNull(iterator);
  int i=0;
  while (iterator.hasNext()) {
    Map<String,String> record=iterator.next();
    if (i < 15) {
      Assert.assertEquals("config-type" + i,record.get(KerberosConfigDataFileReader.CONFIGURATION_TYPE));
      Assert.assertEquals("key" + i,record.get(KerberosConfigDataFileReader.KEY));
      Assert.assertEquals("value" + i,record.get(KerberosConfigDataFileReader.VALUE));
      if (i < 10) {
        Assert.assertEquals("SET",record.get(KerberosConfigDataFileReader.OPERATION));
      }
 else {
        Assert.assertEquals("REMOVE",record.get(KerberosConfigDataFileReader.OPERATION));
      }
    }
    i++;
  }
  Assert.assertEquals(15,i);
  reader.close();
  Assert.assertTrue(reader.isClosed());
  reader.open();
  Assert.assertFalse(reader.isClosed());
  i=0;
  for (  Map<String,String> record : reader) {
    if (i < 10) {
      Assert.assertEquals("config-type" + i,record.get(KerberosConfigDataFileReader.CONFIGURATION_TYPE));
      Assert.assertEquals("key" + i,record.get(KerberosConfigDataFileReader.KEY));
      Assert.assertEquals("value" + i,record.get(KerberosConfigDataFileReader.VALUE));
    }
    i++;
  }
  Assert.assertEquals(15,i);
  reader.close();
  Assert.assertTrue(reader.isClosed());
  writer.open();
  Assert.assertFalse(writer.isClosed());
  writer.addRecord("config-type","key","value",KerberosConfigDataFileReader.OPERATION_TYPE_SET);
  writer.close();
  Assert.assertTrue(writer.isClosed());
  reader=kerberosConfigDataFileReaderFactory.createKerberosConfigDataFileReader(file);
  Assert.assertFalse(reader.isClosed());
  i=0;
  for (  Map<String,String> record : reader) {
    i++;
  }
  Assert.assertEquals(16,i);
  reader.close();
  Assert.assertTrue(reader.isClosed());
  writer=kerberosConfigDataFileWriterFactory.createKerberosConfigDataFileWriter(file);
  Assert.assertFalse(writer.isClosed());
  writer.addRecord("config-type","key","value",KerberosConfigDataFileReader.OPERATION_TYPE_REMOVE);
  writer.close();
  Assert.assertTrue(writer.isClosed());
  reader.open();
  Assert.assertFalse(reader.isClosed());
  i=0;
  for (  Map<String,String> record : reader) {
    i++;
  }
  Assert.assertEquals(17,i);
  reader.close();
  Assert.assertTrue(reader.isClosed());
  i=0;
  for (  Map<String,String> record : reader) {
    i++;
  }
  Assert.assertEquals(0,i);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.serveraction.kerberos.KerberosIdentityDataFileTest </h4><pre class="type-4 type-12 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testKerberosIdentityDataFile() throws Exception {
  File file=folder.newFile();
  Assert.assertNotNull(file);
  KerberosIdentityDataFileWriter writer=kerberosIdentityDataFileWriterFactory.createKerberosIdentityDataFileWriter(file);
  Assert.assertFalse(writer.isClosed());
  for (int i=0; i < 10; i++) {
    writer.writeRecord("hostName" + i,"serviceName" + i,"serviceComponentName" + i,"principal" + i,"principal_type" + i,"keytabFilePath" + i,"keytabFileOwnerName" + i,"keytabFileOwnerAccess" + i,"keytabFileGroupName" + i,"keytabFileGroupAccess" + i,"false");
  }
  writer.writeRecord("hostName's","serviceName#","serviceComponentName\"","principal","principal_type","keytabFilePath","'keytabFileOwnerName'","<keytabFileOwnerAccess>","\"keytabFileGroupName\"","keytab,File,Group,Access","false");
  writer.close();
  Assert.assertTrue(writer.isClosed());
  KerberosIdentityDataFileReader reader=kerberosIdentityDataFileReaderFactory.createKerberosIdentityDataFileReader(file);
  Assert.assertFalse(reader.isClosed());
  Iterator<Map<String,String>> iterator=reader.iterator();
  Assert.assertNotNull(iterator);
  int i=0;
  while (iterator.hasNext()) {
    Map<String,String> record=iterator.next();
    if (i < 10) {
      Assert.assertEquals("hostName" + i,record.get(KerberosIdentityDataFileReader.HOSTNAME));
      Assert.assertEquals("serviceName" + i,record.get(KerberosIdentityDataFileReader.SERVICE));
      Assert.assertEquals("serviceComponentName" + i,record.get(KerberosIdentityDataFileReader.COMPONENT));
      Assert.assertEquals("principal" + i,record.get(KerberosIdentityDataFileReader.PRINCIPAL));
      Assert.assertEquals("principal_type" + i,record.get(KerberosIdentityDataFileReader.PRINCIPAL_TYPE));
      Assert.assertEquals("keytabFilePath" + i,record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_PATH));
      Assert.assertEquals("keytabFileOwnerName" + i,record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_OWNER_NAME));
      Assert.assertEquals("keytabFileOwnerAccess" + i,record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_OWNER_ACCESS));
      Assert.assertEquals("keytabFileGroupName" + i,record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_GROUP_NAME));
      Assert.assertEquals("keytabFileGroupAccess" + i,record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_GROUP_ACCESS));
      Assert.assertEquals("false",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_IS_CACHABLE));
    }
 else {
      Assert.assertEquals("hostName's",record.get(KerberosIdentityDataFileReader.HOSTNAME));
      Assert.assertEquals("serviceName#",record.get(KerberosIdentityDataFileReader.SERVICE));
      Assert.assertEquals("serviceComponentName\"",record.get(KerberosIdentityDataFileReader.COMPONENT));
      Assert.assertEquals("principal",record.get(KerberosIdentityDataFileReader.PRINCIPAL));
      Assert.assertEquals("principal_type",record.get(KerberosIdentityDataFileReader.PRINCIPAL_TYPE));
      Assert.assertEquals("keytabFilePath",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_PATH));
      Assert.assertEquals("'keytabFileOwnerName'",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_OWNER_NAME));
      Assert.assertEquals("<keytabFileOwnerAccess>",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_OWNER_ACCESS));
      Assert.assertEquals("\"keytabFileGroupName\"",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_GROUP_NAME));
      Assert.assertEquals("keytab,File,Group,Access",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_GROUP_ACCESS));
      Assert.assertEquals("false",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_IS_CACHABLE));
    }
    i++;
  }
  reader.close();
  Assert.assertTrue(reader.isClosed());
  reader.open();
  Assert.assertFalse(reader.isClosed());
  i=0;
  for (  Map<String,String> record : reader) {
    if (i < 10) {
      Assert.assertEquals("hostName" + i,record.get(KerberosIdentityDataFileReader.HOSTNAME));
      Assert.assertEquals("serviceName" + i,record.get(KerberosIdentityDataFileReader.SERVICE));
      Assert.assertEquals("serviceComponentName" + i,record.get(KerberosIdentityDataFileReader.COMPONENT));
      Assert.assertEquals("principal" + i,record.get(KerberosIdentityDataFileReader.PRINCIPAL));
      Assert.assertEquals("principal_type" + i,record.get(KerberosIdentityDataFileReader.PRINCIPAL_TYPE));
      Assert.assertEquals("keytabFilePath" + i,record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_PATH));
      Assert.assertEquals("keytabFileOwnerName" + i,record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_OWNER_NAME));
      Assert.assertEquals("keytabFileOwnerAccess" + i,record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_OWNER_ACCESS));
      Assert.assertEquals("keytabFileGroupName" + i,record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_GROUP_NAME));
      Assert.assertEquals("keytabFileGroupAccess" + i,record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_GROUP_ACCESS));
    }
 else {
      Assert.assertEquals("hostName's",record.get(KerberosIdentityDataFileReader.HOSTNAME));
      Assert.assertEquals("serviceName#",record.get(KerberosIdentityDataFileReader.SERVICE));
      Assert.assertEquals("serviceComponentName\"",record.get(KerberosIdentityDataFileReader.COMPONENT));
      Assert.assertEquals("principal",record.get(KerberosIdentityDataFileReader.PRINCIPAL));
      Assert.assertEquals("principal_type",record.get(KerberosIdentityDataFileReader.PRINCIPAL_TYPE));
      Assert.assertEquals("keytabFilePath",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_PATH));
      Assert.assertEquals("'keytabFileOwnerName'",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_OWNER_NAME));
      Assert.assertEquals("<keytabFileOwnerAccess>",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_OWNER_ACCESS));
      Assert.assertEquals("\"keytabFileGroupName\"",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_GROUP_NAME));
      Assert.assertEquals("keytab,File,Group,Access",record.get(KerberosIdentityDataFileReader.KEYTAB_FILE_GROUP_ACCESS));
    }
    i++;
  }
  reader.close();
  Assert.assertTrue(reader.isClosed());
  writer.open();
  Assert.assertFalse(writer.isClosed());
  writer.writeRecord("hostName","serviceName","serviceComponentName","principal","principal_type","keytabFilePath","keytabFileOwnerName","keytabFileOwnerAccess","keytabFileGroupName","keytabFileGroupAccess","true");
  writer.close();
  Assert.assertTrue(writer.isClosed());
  reader=kerberosIdentityDataFileReaderFactory.createKerberosIdentityDataFileReader(file);
  Assert.assertFalse(reader.isClosed());
  i=0;
  for (  Map<String,String> record : reader) {
    i++;
  }
  Assert.assertEquals(12,i);
  reader.close();
  Assert.assertTrue(reader.isClosed());
  writer=kerberosIdentityDataFileWriterFactory.createKerberosIdentityDataFileWriter(file);
  Assert.assertFalse(writer.isClosed());
  writer.writeRecord("hostName","serviceName","serviceComponentName","principal","principal_type","keytabFilePath","keytabFileOwnerName","keytabFileOwnerAccess","keytabFileGroupName","keytabFileGroupAccess","true");
  writer.close();
  Assert.assertTrue(writer.isClosed());
  reader.open();
  Assert.assertFalse(reader.isClosed());
  i=0;
  for (  Map<String,String> record : reader) {
    i++;
  }
  Assert.assertEquals(13,i);
  reader.close();
  Assert.assertTrue(reader.isClosed());
  i=0;
  for (  Map<String,String> record : reader) {
    i++;
  }
  Assert.assertEquals(0,i);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.state.cluster.ClusterTest </h4><pre class="type-4 type-12 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBootstrapHostVersion() throws Exception {
  String clusterName="c1";
  String v1="2.2.0-123";
  StackId stackId=new StackId("HDP-2.2.0");
  RepositoryVersionEntity rv1=helper.getOrCreateRepositoryVersion(stackId,v1);
  Map<String,String> hostAttributes=new HashMap<String,String>();
  hostAttributes.put("os_family","redhat");
  hostAttributes.put("os_release_version","5.9");
  Cluster cluster=createClusterForRU(clusterName,stackId,hostAttributes);
  Host deadHost=cluster.getHosts().iterator().next();
  deadHost.setState(HostState.UNHEALTHY);
  int versionedComponentCount=0;
  List<HostComponentStateEntity> hostComponentStates=hostComponentStateDAO.findAll();
  for (int i=0; i < hostComponentStates.size(); i++) {
    HostComponentStateEntity hce=hostComponentStates.get(i);
    ComponentInfo compInfo=metaInfo.getComponent(stackId.getStackName(),stackId.getStackVersion(),hce.getServiceName(),hce.getComponentName());
    if (hce.getHostName().equals(deadHost.getHostName())) {
      continue;
    }
    if (compInfo.isVersionAdvertised()) {
      hce.setVersion(v1);
      hostComponentStateDAO.merge(hce);
      versionedComponentCount++;
    }
    Service svc=cluster.getService(hce.getServiceName());
    ServiceComponent svcComp=svc.getServiceComponent(hce.getComponentName());
    ServiceComponentHost scHost=svcComp.getServiceComponentHost(hce.getHostName());
    scHost.recalculateHostVersionState();
    cluster.recalculateClusterVersionState(rv1);
    Collection<ClusterVersionEntity> clusterVersions=cluster.getAllClusterVersions();
    if (versionedComponentCount > 0) {
      RepositoryVersionEntity repositoryVersion=repositoryVersionDAO.findByStackAndVersion(stackId,v1);
      Assert.assertNotNull(repositoryVersion);
      Assert.assertTrue(clusterVersions != null && clusterVersions.size() == 1);
      if (versionedComponentCount == 1 && i < (hostComponentStates.size() - 1)) {
        Assert.assertEquals(clusterVersions.iterator().next().getState(),RepositoryVersionState.CURRENT);
      }
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-12 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Comprehensive test for transitionHostVersion and recalculateClusterVersion.
 * It creates a cluster with 3 hosts and 3 services, one of which does not advertise a version.
 * It then verifies that all 3 hosts have a version of CURRENT, and so does the cluster.
 * It then adds one more host with a component, so its HostVersion will initialize in CURRENT.
 * Next, it distributes a repo so that it is INSTALLED on the 4 hosts.
 * It then adds one more host, whose HostVersion will be OUT_OF_SYNC for the new repo.
 * After redistributing bits again, it simulates an RU.
 * Finally, some of the hosts will end up with a HostVersion in UPGRADED, and others still in INSTALLED.
 * @throws Exception
 */
@Test public void testTransitionHostVersionAdvanced() throws Exception {
  String clusterName="c1";
  String v1="2.2.0-123";
  StackId stackId=new StackId("HDP-2.2.0");
  RepositoryVersionEntity rv1=helper.getOrCreateRepositoryVersion(stackId,v1);
  Map<String,String> hostAttributes=new HashMap<String,String>();
  hostAttributes.put("os_family","redhat");
  hostAttributes.put("os_release_version","5.9");
  Cluster cluster=createClusterForRU(clusterName,stackId,hostAttributes);
  int versionedComponentCount=0;
  List<HostComponentStateEntity> hostComponentStates=hostComponentStateDAO.findAll();
  for (int i=0; i < hostComponentStates.size(); i++) {
    HostComponentStateEntity hce=hostComponentStates.get(i);
    ComponentInfo compInfo=metaInfo.getComponent(stackId.getStackName(),stackId.getStackVersion(),hce.getServiceName(),hce.getComponentName());
    if (compInfo.isVersionAdvertised()) {
      hce.setVersion(v1);
      hostComponentStateDAO.merge(hce);
      versionedComponentCount++;
    }
    Service svc=cluster.getService(hce.getServiceName());
    ServiceComponent svcComp=svc.getServiceComponent(hce.getComponentName());
    ServiceComponentHost scHost=svcComp.getServiceComponentHost(hce.getHostName());
    scHost.recalculateHostVersionState();
    cluster.recalculateClusterVersionState(rv1);
    Collection<ClusterVersionEntity> clusterVersions=cluster.getAllClusterVersions();
    if (versionedComponentCount > 0) {
      RepositoryVersionEntity repositoryVersion=repositoryVersionDAO.findByStackAndVersion(stackId,v1);
      Assert.assertNotNull(repositoryVersion);
      Assert.assertTrue(clusterVersions != null && clusterVersions.size() == 1);
      if (versionedComponentCount == 1 && i < (hostComponentStates.size() - 1)) {
        Assert.assertEquals(clusterVersions.iterator().next().getState(),RepositoryVersionState.UPGRADING);
      }
      if (i == hostComponentStates.size() - 1) {
        Assert.assertEquals(clusterVersions.iterator().next().getState(),RepositoryVersionState.CURRENT);
      }
    }
  }
  addHost("h-4",hostAttributes);
  clusters.mapHostToCluster("h-4",clusterName);
  Service svc2=cluster.getService("ZOOKEEPER");
  Service svc3=cluster.getService("GANGLIA");
  ServiceComponent sc2CompA=svc2.getServiceComponent("ZOOKEEPER_SERVER");
  ServiceComponent sc2CompB=svc2.getServiceComponent("ZOOKEEPER_CLIENT");
  ServiceComponent sc3CompB=svc3.getServiceComponent("GANGLIA_MONITOR");
  ServiceComponentHost schHost4Serv2CompA=serviceComponentHostFactory.createNew(sc2CompA,"h-4");
  ServiceComponentHost schHost4Serv2CompB=serviceComponentHostFactory.createNew(sc2CompB,"h-4");
  ServiceComponentHost schHost4Serv3CompB=serviceComponentHostFactory.createNew(sc3CompB,"h-4");
  sc2CompA.addServiceComponentHost(schHost4Serv2CompA);
  sc2CompB.addServiceComponentHost(schHost4Serv2CompB);
  sc3CompB.addServiceComponentHost(schHost4Serv3CompB);
  schHost4Serv2CompA.persist();
  schHost4Serv2CompB.persist();
  schHost4Serv3CompB.persist();
  simulateStackVersionListener(stackId,v1,cluster,hostComponentStateDAO.findByHost("h-4"));
  Collection<HostVersionEntity> hostVersions=hostVersionDAO.findAll();
  Assert.assertEquals(hostVersions.size(),clusters.getHosts().size());
  HostVersionEntity h4Version1=hostVersionDAO.findByClusterStackVersionAndHost(clusterName,stackId,v1,"h-4");
  Assert.assertNotNull(h4Version1);
  Assert.assertEquals(h4Version1.getState(),RepositoryVersionState.CURRENT);
  String v2="2.2.0-456";
  RepositoryVersionEntity rv2=helper.getOrCreateRepositoryVersion(stackId,v2);
  for (  String hostName : clusters.getHostsForCluster(clusterName).keySet()) {
    HostEntity host=hostDAO.findByName(hostName);
    HostVersionEntity hve=new HostVersionEntity(host,rv2,RepositoryVersionState.INSTALLED);
    hostVersionDAO.create(hve);
  }
  cluster.createClusterVersion(stackId,v2,"admin",RepositoryVersionState.INSTALLING);
  cluster.transitionClusterVersion(stackId,v2,RepositoryVersionState.INSTALLED);
  ClusterVersionEntity cv2=clusterVersionDAO.findByClusterAndStackAndVersion(clusterName,stackId,v2);
  Assert.assertNotNull(cv2);
  Assert.assertEquals(cv2.getState(),RepositoryVersionState.INSTALLED);
  addHost("h-5",hostAttributes);
  clusters.mapHostToCluster("h-5",clusterName);
  ServiceComponentHost schHost5Serv3CompB=serviceComponentHostFactory.createNew(sc3CompB,"h-5");
  sc3CompB.addServiceComponentHost(schHost5Serv3CompB);
  schHost5Serv3CompB.persist();
  HostVersionEntity h5Version2=hostVersionDAO.findByClusterStackVersionAndHost(clusterName,stackId,v2,"h-5");
  Assert.assertNotNull(h5Version2);
  Assert.assertEquals(h5Version2.getState(),RepositoryVersionState.OUT_OF_SYNC);
  h5Version2.setState(RepositoryVersionState.INSTALLED);
  hostVersionDAO.merge(h5Version2);
  versionedComponentCount=0;
  hostComponentStates=hostComponentStateDAO.findAll();
  for (int i=0; i < hostComponentStates.size(); i++) {
    HostComponentStateEntity hce=hostComponentStates.get(i);
    ComponentInfo compInfo=metaInfo.getComponent(stackId.getStackName(),stackId.getStackVersion(),hce.getServiceName(),hce.getComponentName());
    if (compInfo.isVersionAdvertised()) {
      hce.setVersion(v2);
      hostComponentStateDAO.merge(hce);
      versionedComponentCount++;
    }
    Service svc=cluster.getService(hce.getServiceName());
    ServiceComponent svcComp=svc.getServiceComponent(hce.getComponentName());
    ServiceComponentHost scHost=svcComp.getServiceComponentHost(hce.getHostName());
    scHost.recalculateHostVersionState();
    cluster.recalculateClusterVersionState(rv2);
    Collection<ClusterVersionEntity> clusterVersions=cluster.getAllClusterVersions();
    if (versionedComponentCount > 0) {
      RepositoryVersionEntity repositoryVersion=repositoryVersionDAO.findByStackAndVersion(stackId,v2);
      Assert.assertNotNull(repositoryVersion);
      Assert.assertTrue(clusterVersions != null && clusterVersions.size() == 2);
      if (versionedComponentCount == 1 && i < (hostComponentStates.size() - 1)) {
        cv2=clusterVersionDAO.findByClusterAndStackAndVersion(clusterName,stackId,v2);
        Assert.assertEquals(cv2.getState(),RepositoryVersionState.UPGRADING);
      }
    }
  }
  cv2=clusterVersionDAO.findByClusterAndStackAndVersion(clusterName,stackId,v2);
  Assert.assertEquals(cv2.getState(),RepositoryVersionState.UPGRADING);
  Collection<HostVersionEntity> v2HostVersions=hostVersionDAO.findByClusterStackAndVersion(clusterName,stackId,v2);
  Assert.assertEquals(v2HostVersions.size(),clusters.getHostsForCluster(clusterName).size());
  for (  HostVersionEntity hve : v2HostVersions) {
    if (hve.getHostName().equals("h-3") || hve.getHostName().equals("h-5")) {
      Assert.assertEquals(hve.getState(),RepositoryVersionState.INSTALLED);
    }
 else {
      Assert.assertEquals(hve.getState(),RepositoryVersionState.UPGRADED);
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.ambari.server.utils.TestParallel </h4><pre class="type-4 type-12 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests {@link org.apache.ambari.server.utils.Parallel} forLoop iteration exceptions
 * @throws Exception
 */
@Test public void testParallelForLoopIterationExceptions() throws Exception {
  final List<Integer> input=new LinkedList<Integer>();
  for (int i=0; i < 10; i++) {
    input.add(i);
  }
  final List<Integer> failForList=Arrays.asList(new Integer[]{2,5,7});
  ParallelLoopResult<Integer> loopResult=Parallel.forLoop(input,new LoopBody<Integer,Integer>(){
    @Override public Integer run(    Integer in1){
      if (failForList.contains(in1)) {
        throw new RuntimeException("Ignore this exception");
      }
      return in1 * in1;
    }
  }
);
  Assert.assertFalse(loopResult.getIsCompleted());
  Assert.assertNotNull(loopResult.getResult());
  List<Integer> output=loopResult.getResult();
  Assert.assertEquals(input.size(),output.size());
  for (int i=0; i < input.size(); i++) {
    if (failForList.contains(i)) {
      Assert.assertNull(output.get(i));
      output.set(i,i * i);
    }
 else {
      Assert.assertEquals(i * i,(int)output.get(i));
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-12 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests nested {@link org.apache.ambari.server.utils.Parallel} forLoop
 * @throws Exception
 */
@Test public void testNestedParallelForLoop() throws Exception {
  final List<Integer> input=new LinkedList<Integer>();
  for (int i=0; i < 10; i++) {
    input.add(i);
  }
  final ParallelLoopResult<Integer>[] innerLoopResults=new ParallelLoopResult[input.size()];
  ParallelLoopResult<Integer> loopResult=Parallel.forLoop(input,new LoopBody<Integer,Integer>(){
    @Override public Integer run(    final Integer in1){
      int sq=in1 * in1;
      ParallelLoopResult<Integer> innerLoopResult=Parallel.forLoop(input,new LoopBody<Integer,Integer>(){
        @Override public Integer run(        Integer in2){
          return in1 * in2;
        }
      }
);
      innerLoopResults[in1]=innerLoopResult;
      return in1 * in1;
    }
  }
);
  Assert.assertNotNull(loopResult);
  Assert.assertTrue(loopResult.getIsCompleted());
  List<Integer> output=loopResult.getResult();
  Assert.assertNotNull(output);
  Assert.assertEquals(input.size(),output.size());
  for (int i=0; i < input.size(); i++) {
    Assert.assertEquals(i * i,(int)output.get(i));
    ParallelLoopResult<Integer> innerLoopResult=innerLoopResults[i];
    Assert.assertNotNull(innerLoopResult);
    Assert.assertTrue(innerLoopResult.getIsCompleted());
    List<Integer> innerOutput=innerLoopResult.getResult();
    Assert.assertNotNull(innerOutput);
    Assert.assertEquals(input.size(),innerOutput.size());
    for (int j=0; j < input.size(); j++) {
      Assert.assertEquals(i * j,(int)innerOutput.get(j));
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-12 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests Parallel.forLoop
 * @throws Exception
 */
@Test public void testParallelForLoop() throws Exception {
  final List<Integer> input=new LinkedList<Integer>();
  for (int i=0; i < 10; i++) {
    input.add(i);
  }
  ParallelLoopResult<Integer> loopResult=Parallel.forLoop(input,new LoopBody<Integer,Integer>(){
    @Override public Integer run(    Integer in1){
      return in1 * in1;
    }
  }
);
  Assert.assertTrue(loopResult.getIsCompleted());
  Assert.assertNotNull(loopResult.getResult());
  List<Integer> output=loopResult.getResult();
  Assert.assertEquals(input.size(),output.size());
  for (int i=0; i < input.size(); i++) {
    Assert.assertEquals(i * i,(int)output.get(i));
  }
}

</code></pre>

<br>
<pre class="type-4 type-12 type-13 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests {@link org.apache.ambari.server.utils.Parallel} forLoop iteration failures
 * @throws Exception
 */
@Test public void testParallelForLoopIterationFailures() throws Exception {
  final List<Integer> input=new LinkedList<Integer>();
  for (int i=0; i < 10; i++) {
    input.add(i);
  }
  final List<Integer> failForList=Arrays.asList(new Integer[]{2,5,7});
  ParallelLoopResult<Integer> loopResult=Parallel.forLoop(input,new LoopBody<Integer,Integer>(){
    @Override public Integer run(    Integer in1){
      if (failForList.contains(in1)) {
        return null;
      }
      return in1 * in1;
    }
  }
);
  Assert.assertFalse(loopResult.getIsCompleted());
  Assert.assertNotNull(loopResult.getResult());
  List<Integer> output=loopResult.getResult();
  Assert.assertEquals(input.size(),output.size());
  for (int i=0; i < input.size(); i++) {
    if (failForList.contains(i)) {
      Assert.assertNull(output.get(i));
      output.set(i,i * i);
    }
 else {
      Assert.assertEquals(i * i,(int)output.get(i));
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.applicationhistoryservice.TestMemoryApplicationHistoryStore </h4><pre class="type-4 type-12 type-10 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReadWriteApplicationAttemptHistory() throws Exception {
  ApplicationId appId=ApplicationId.newInstance(0,1);
  ApplicationAttemptId appAttemptId=ApplicationAttemptId.newInstance(appId,1);
  try {
    writeApplicationAttemptFinishData(appAttemptId);
    Assert.fail();
  }
 catch (  IOException e) {
    Assert.assertTrue(e.getMessage().contains("is stored before the start information"));
  }
  int numAppAttempts=5;
  writeApplicationStartData(appId);
  for (int i=1; i <= numAppAttempts; ++i) {
    appAttemptId=ApplicationAttemptId.newInstance(appId,i);
    writeApplicationAttemptStartData(appAttemptId);
    writeApplicationAttemptFinishData(appAttemptId);
  }
  Assert.assertEquals(numAppAttempts,store.getApplicationAttempts(appId).size());
  for (int i=1; i <= numAppAttempts; ++i) {
    appAttemptId=ApplicationAttemptId.newInstance(appId,i);
    ApplicationAttemptHistoryData data=store.getApplicationAttempt(appAttemptId);
    Assert.assertNotNull(data);
    Assert.assertEquals(appAttemptId.toString(),data.getHost());
    Assert.assertEquals(appAttemptId.toString(),data.getDiagnosticsInfo());
  }
  writeApplicationFinishData(appId);
  appAttemptId=ApplicationAttemptId.newInstance(appId,1);
  try {
    writeApplicationAttemptStartData(appAttemptId);
    Assert.fail();
  }
 catch (  IOException e) {
    Assert.assertTrue(e.getMessage().contains("is already stored"));
  }
  try {
    writeApplicationAttemptFinishData(appAttemptId);
    Assert.fail();
  }
 catch (  IOException e) {
    Assert.assertTrue(e.getMessage().contains("is already stored"));
  }
}

</code></pre>

<br>
<pre class="type-4 type-12 type-10 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReadWriteApplicationHistory() throws Exception {
  ApplicationId appId=ApplicationId.newInstance(0,1);
  try {
    writeApplicationFinishData(appId);
    Assert.fail();
  }
 catch (  IOException e) {
    Assert.assertTrue(e.getMessage().contains("is stored before the start information"));
  }
  int numApps=5;
  for (int i=1; i <= numApps; ++i) {
    appId=ApplicationId.newInstance(0,i);
    writeApplicationStartData(appId);
    writeApplicationFinishData(appId);
  }
  Assert.assertEquals(numApps,store.getAllApplications().size());
  for (int i=1; i <= numApps; ++i) {
    appId=ApplicationId.newInstance(0,i);
    ApplicationHistoryData data=store.getApplication(appId);
    Assert.assertNotNull(data);
    Assert.assertEquals(appId.toString(),data.getApplicationName());
    Assert.assertEquals(appId.toString(),data.getDiagnosticsInfo());
  }
  appId=ApplicationId.newInstance(0,1);
  try {
    writeApplicationStartData(appId);
    Assert.fail();
  }
 catch (  IOException e) {
    Assert.assertTrue(e.getMessage().contains("is already stored"));
  }
  try {
    writeApplicationFinishData(appId);
    Assert.fail();
  }
 catch (  IOException e) {
    Assert.assertTrue(e.getMessage().contains("is already stored"));
  }
}

</code></pre>

<br>
<pre class="type-4 type-12 type-10 type-2 type-5 type-1 type-11 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testReadWriteContainerHistory() throws Exception {
  ApplicationId appId=ApplicationId.newInstance(0,1);
  ApplicationAttemptId appAttemptId=ApplicationAttemptId.newInstance(appId,1);
  ContainerId containerId=ContainerId.newInstance(appAttemptId,1);
  try {
    writeContainerFinishData(containerId);
    Assert.fail();
  }
 catch (  IOException e) {
    Assert.assertTrue(e.getMessage().contains("is stored before the start information"));
  }
  writeApplicationAttemptStartData(appAttemptId);
  int numContainers=5;
  for (int i=1; i <= numContainers; ++i) {
    containerId=ContainerId.newInstance(appAttemptId,i);
    writeContainerStartData(containerId);
    writeContainerFinishData(containerId);
  }
  Assert.assertEquals(numContainers,store.getContainers(appAttemptId).size());
  for (int i=1; i <= numContainers; ++i) {
    containerId=ContainerId.newInstance(appAttemptId,i);
    ContainerHistoryData data=store.getContainer(containerId);
    Assert.assertNotNull(data);
    Assert.assertEquals(Priority.newInstance(containerId.getId()),data.getPriority());
    Assert.assertEquals(containerId.toString(),data.getDiagnosticsInfo());
  }
  ContainerHistoryData masterContainer=store.getAMContainer(appAttemptId);
  Assert.assertNotNull(masterContainer);
  Assert.assertEquals(ContainerId.newInstance(appAttemptId,1),masterContainer.getContainerId());
  writeApplicationAttemptFinishData(appAttemptId);
  containerId=ContainerId.newInstance(appAttemptId,1);
  try {
    writeContainerStartData(containerId);
    Assert.fail();
  }
 catch (  IOException e) {
    Assert.assertTrue(e.getMessage().contains("is already stored"));
  }
  try {
    writeContainerFinishData(containerId);
    Assert.fail();
  }
 catch (  IOException e) {
    Assert.assertTrue(e.getMessage().contains("is already stored"));
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.applicationhistoryservice.metrics.timeline.aggregators.ITClusterAggregator </h4><pre class="type-12 type-13 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testShouldAggregateDifferentMetricsOnHourProperly() throws Exception {
  TimelineMetricAggregator agg=TimelineMetricAggregatorFactory.createTimelineClusterAggregatorHourly(hdb,getConfigurationForTest(false));
  long startTime=System.currentTimeMillis();
  long ctime=startTime;
  long minute=60 * 1000;
  Map<TimelineClusterMetric,MetricClusterAggregate> records=new HashMap<TimelineClusterMetric,MetricClusterAggregate>();
  records.put(createEmptyTimelineClusterMetric("disk_used",ctime),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric("disk_free",ctime),new MetricClusterAggregate(1.0,2,0.0,1.0,1.0));
  records.put(createEmptyTimelineClusterMetric("disk_used",ctime+=minute),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric("disk_free",ctime),new MetricClusterAggregate(1.0,2,0.0,1.0,1.0));
  records.put(createEmptyTimelineClusterMetric("disk_used",ctime+=minute),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric("disk_free",ctime),new MetricClusterAggregate(1.0,2,0.0,1.0,1.0));
  records.put(createEmptyTimelineClusterMetric("disk_used",ctime+=minute),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric("disk_free",ctime),new MetricClusterAggregate(1.0,2,0.0,1.0,1.0));
  hdb.saveClusterAggregateRecords(records);
  agg.doWork(startTime,ctime + minute);
  ResultSet rs=executeQuery("SELECT * FROM METRIC_AGGREGATE_HOURLY");
  int count=0;
  while (rs.next()) {
    if ("disk_used".equals(rs.getString("METRIC_NAME"))) {
      assertEquals("APP_ID","test_app",rs.getString("APP_ID"));
      assertEquals("METRIC_SUM",16.0,rs.getDouble("METRIC_SUM"));
      assertEquals("METRIC_COUNT",8,rs.getLong("METRIC_COUNT"));
      assertEquals("METRIC_MAX",4.0,rs.getDouble("METRIC_MAX"));
      assertEquals("METRIC_MIN",0.0,rs.getDouble("METRIC_MIN"));
    }
 else     if ("disk_free".equals(rs.getString("METRIC_NAME"))) {
      assertEquals("APP_ID","test_app",rs.getString("APP_ID"));
      assertEquals("METRIC_SUM",4.0,rs.getDouble("METRIC_SUM"));
      assertEquals("METRIC_COUNT",8,rs.getLong("METRIC_COUNT"));
      assertEquals("METRIC_MAX",1.0,rs.getDouble("METRIC_MAX"));
      assertEquals("METRIC_MIN",1.0,rs.getDouble("METRIC_MIN"));
    }
    count++;
  }
  assertEquals("Two hourly aggregated row expected ",2,count);
}

</code></pre>

<br>
<pre class="type-12 type-13 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAggregationUsingGroupByQuery() throws Exception {
  TimelineMetricAggregator agg=TimelineMetricAggregatorFactory.createTimelineClusterAggregatorHourly(hdb,getConfigurationForTest(true));
  long startTime=System.currentTimeMillis();
  long ctime=startTime;
  long minute=60 * 1000;
  Map<TimelineClusterMetric,MetricClusterAggregate> records=new HashMap<TimelineClusterMetric,MetricClusterAggregate>();
  records.put(createEmptyTimelineClusterMetric("disk_used",ctime+=minute),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric("disk_free",ctime),new MetricClusterAggregate(1.0,2,0.0,1.0,1.0));
  records.put(createEmptyTimelineClusterMetric("disk_used",ctime+=minute),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric("disk_free",ctime),new MetricClusterAggregate(1.0,2,0.0,1.0,1.0));
  records.put(createEmptyTimelineClusterMetric("disk_used",ctime+=minute),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric("disk_free",ctime),new MetricClusterAggregate(1.0,2,0.0,1.0,1.0));
  records.put(createEmptyTimelineClusterMetric("disk_used",ctime+=minute),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric("disk_free",ctime),new MetricClusterAggregate(1.0,2,0.0,1.0,1.0));
  hdb.saveClusterAggregateRecords(records);
  agg.doWork(startTime,ctime + minute);
  ResultSet rs=executeQuery("SELECT * FROM METRIC_AGGREGATE_HOURLY");
  int count=0;
  while (rs.next()) {
    if ("disk_used".equals(rs.getString("METRIC_NAME"))) {
      assertEquals("APP_ID","test_app",rs.getString("APP_ID"));
      assertEquals("METRIC_SUM",16.0,rs.getDouble("METRIC_SUM"));
      assertEquals("METRIC_COUNT",8,rs.getLong("METRIC_COUNT"));
      assertEquals("METRIC_MAX",4.0,rs.getDouble("METRIC_MAX"));
      assertEquals("METRIC_MIN",0.0,rs.getDouble("METRIC_MIN"));
    }
 else     if ("disk_free".equals(rs.getString("METRIC_NAME"))) {
      assertEquals("APP_ID","test_app",rs.getString("APP_ID"));
      assertEquals("METRIC_SUM",4.0,rs.getDouble("METRIC_SUM"));
      assertEquals("METRIC_COUNT",8,rs.getLong("METRIC_COUNT"));
      assertEquals("METRIC_MAX",1.0,rs.getDouble("METRIC_MAX"));
      assertEquals("METRIC_MIN",1.0,rs.getDouble("METRIC_MIN"));
    }
    count++;
  }
  assertEquals("Two hourly aggregated row expected ",2,count);
}

</code></pre>

<br>
<pre class="type-12 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testShouldAggregateClusterOnHourProperly() throws Exception {
  TimelineMetricAggregator agg=TimelineMetricAggregatorFactory.createTimelineClusterAggregatorHourly(hdb,getConfigurationForTest(false));
  long startTime=System.currentTimeMillis();
  long ctime=startTime;
  long minute=60 * 1000;
  Map<TimelineClusterMetric,MetricClusterAggregate> records=new HashMap<TimelineClusterMetric,MetricClusterAggregate>();
  records.put(createEmptyTimelineClusterMetric(ctime),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric(ctime+=minute),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric(ctime+=minute),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric(ctime+=minute),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  hdb.saveClusterAggregateRecords(records);
  agg.doWork(startTime,ctime + minute);
  ResultSet rs=executeQuery("SELECT * FROM METRIC_AGGREGATE_HOURLY");
  int count=0;
  while (rs.next()) {
    assertEquals("METRIC_NAME","disk_used",rs.getString("METRIC_NAME"));
    assertEquals("APP_ID","test_app",rs.getString("APP_ID"));
    assertEquals("METRIC_SUM",16.0,rs.getDouble("METRIC_SUM"));
    assertEquals("METRIC_COUNT",8,rs.getLong("METRIC_COUNT"));
    assertEquals("METRIC_MAX",4.0,rs.getDouble("METRIC_MAX"));
    assertEquals("METRIC_MIN",0.0,rs.getDouble("METRIC_MIN"));
    count++;
  }
  assertEquals("One hourly aggregated row expected ",1,count);
}

</code></pre>

<br>
<pre class="type-12 type-13 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShouldAggregateClusterOnMinuteProperly() throws Exception {
  TimelineMetricAggregator agg=TimelineMetricAggregatorFactory.createTimelineClusterAggregatorMinute(hdb,getConfigurationForTest(false));
  long startTime=System.currentTimeMillis();
  long ctime=startTime;
  long second=1000;
  long minute=60 * second;
  Map<TimelineClusterMetric,MetricClusterAggregate> records=new HashMap<TimelineClusterMetric,MetricClusterAggregate>();
  records.put(createEmptyTimelineClusterMetric(ctime),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric(ctime+=second),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric(ctime+=second),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric(ctime+=second),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  hdb.saveClusterAggregateRecords(records);
  agg.doWork(startTime,ctime + second);
  long oldCtime=ctime + second;
  ctime=startTime + minute;
  records.put(createEmptyTimelineClusterMetric(ctime),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric(ctime+=second),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric(ctime+=second),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  records.put(createEmptyTimelineClusterMetric(ctime+=second),new MetricClusterAggregate(4.0,2,0.0,4.0,0.0));
  hdb.saveClusterAggregateRecords(records);
  agg.doWork(oldCtime,ctime + second);
  ResultSet rs=executeQuery("SELECT * FROM METRIC_AGGREGATE_MINUTE");
  int count=0;
  long diff=0;
  while (rs.next()) {
    assertEquals("METRIC_NAME","disk_used",rs.getString("METRIC_NAME"));
    assertEquals("APP_ID","test_app",rs.getString("APP_ID"));
    assertEquals("METRIC_SUM",16.0,rs.getDouble("METRIC_SUM"));
    assertEquals("METRIC_COUNT",8,rs.getLong("METRIC_COUNT"));
    assertEquals("METRIC_MAX",4.0,rs.getDouble("METRIC_MAX"));
    assertEquals("METRIC_MIN",0.0,rs.getDouble("METRIC_MIN"));
    if (count == 0) {
      diff+=rs.getLong("SERVER_TIME");
    }
 else {
      diff-=rs.getLong("SERVER_TIME");
      if (diff < 0) {
        diff*=-1;
      }
      assertTrue(diff == minute);
    }
    count++;
  }
  assertEquals("One hourly aggregated row expected ",2,count);
}

</code></pre>

<br>
<pre class="type-4 type-12 type-13 type-10 type-2 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testClusterAggregateMetricNormalization() throws Exception {
  TimelineMetricAggregator agg=TimelineMetricAggregatorFactory.createTimelineClusterAggregatorSecond(hdb,getConfigurationForTest(false),new TimelineMetricMetadataManager(hdb,new Configuration()));
  TimelineMetricReadHelper readHelper=new TimelineMetricReadHelper(false);
  TimelineMetric metric1=new TimelineMetric();
  metric1.setMetricName("yarn.ClusterMetrics.NumActiveNMs");
  metric1.setAppId("resourcemanager");
  metric1.setHostName("h1");
  metric1.setStartTime(1431372311811l);
  metric1.setMetricValues(new TreeMap<Long,Double>(){
{
      put(1431372311811l,1.0);
      put(1431372321811l,1.0);
      put(1431372331811l,1.0);
      put(1431372341811l,1.0);
      put(1431372351811l,1.0);
      put(1431372361811l,1.0);
      put(1431372371810l,1.0);
    }
  }
);
  TimelineMetric metric2=new TimelineMetric();
  metric2.setMetricName("yarn.ClusterMetrics.NumActiveNMs");
  metric2.setAppId("resourcemanager");
  metric2.setHostName("h1");
  metric2.setStartTime(1431372381810l);
  metric2.setMetricValues(new TreeMap<Long,Double>(){
{
      put(1431372381810l,1.0);
      put(1431372391811l,1.0);
      put(1431372401811l,1.0);
      put(1431372411811l,1.0);
      put(1431372421811l,1.0);
      put(1431372431811l,1.0);
      put(1431372441810l,1.0);
    }
  }
);
  TimelineMetrics metrics=new TimelineMetrics();
  metrics.setMetrics(Collections.singletonList(metric1));
  insertMetricRecords(conn,metrics,1431372371810l);
  metrics.setMetrics(Collections.singletonList(metric2));
  insertMetricRecords(conn,metrics,1431372441810l);
  long startTime=1431372055000l;
  long endTime=1431372655000l;
  agg.doWork(startTime,endTime);
  Condition condition=new DefaultCondition(null,null,null,null,startTime,endTime,null,null,true);
  condition.setStatement(String.format(GET_CLUSTER_AGGREGATE_SQL,PhoenixTransactSQL.getNaiveTimeRangeHint(startTime,NATIVE_TIME_RANGE_DELTA),METRICS_CLUSTER_AGGREGATE_TABLE_NAME));
  PreparedStatement pstmt=PhoenixTransactSQL.prepareGetMetricsSqlStmt(conn,condition);
  ResultSet rs=pstmt.executeQuery();
  int recordCount=0;
  while (rs.next()) {
    TimelineClusterMetric currentMetric=metricReader.fromResultSet(rs);
    MetricClusterAggregate currentHostAggregate=readHelper.getMetricClusterAggregateFromResultSet(rs);
    if ("yarn.ClusterMetrics.NumActiveNMs".equals(currentMetric.getMetricName())) {
      assertEquals(1,currentHostAggregate.getNumberOfHosts());
      assertEquals(1.0,currentHostAggregate.getMax());
      assertEquals(1.0,currentHostAggregate.getMin());
      assertEquals(1.0,currentHostAggregate.getSum());
      recordCount++;
    }
 else {
      fail("Unexpected entry");
    }
  }
  Assert.assertEquals(5,recordCount);
}

</code></pre>

<br>
<pre class="type-12 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAggregateDailyClusterMetrics() throws Exception {
  TimelineMetricAggregator agg=TimelineMetricAggregatorFactory.createTimelineClusterAggregatorDaily(hdb,getConfigurationForTest(false));
  long startTime=System.currentTimeMillis();
  long ctime=startTime;
  long hour=3600 * 1000;
  Map<TimelineClusterMetric,MetricHostAggregate> records=new HashMap<TimelineClusterMetric,MetricHostAggregate>();
  records.put(createEmptyTimelineClusterMetric(ctime),MetricTestHelper.createMetricHostAggregate(4.0,0.0,2,4.0));
  records.put(createEmptyTimelineClusterMetric(ctime+=hour),MetricTestHelper.createMetricHostAggregate(4.0,0.0,2,4.0));
  records.put(createEmptyTimelineClusterMetric(ctime+=hour),MetricTestHelper.createMetricHostAggregate(4.0,0.0,2,4.0));
  records.put(createEmptyTimelineClusterMetric(ctime+=hour),MetricTestHelper.createMetricHostAggregate(4.0,0.0,2,4.0));
  hdb.saveClusterTimeAggregateRecords(records,METRICS_CLUSTER_AGGREGATE_HOURLY_TABLE_NAME);
  agg.doWork(startTime,ctime + hour + 1000);
  ResultSet rs=executeQuery("SELECT * FROM METRIC_AGGREGATE_DAILY");
  int count=0;
  while (rs.next()) {
    assertEquals("METRIC_NAME","disk_used",rs.getString("METRIC_NAME"));
    assertEquals("APP_ID","test_app",rs.getString("APP_ID"));
    assertEquals("METRIC_SUM",16.0,rs.getDouble("METRIC_SUM"));
    assertEquals("METRIC_COUNT",8,rs.getLong("METRIC_COUNT"));
    assertEquals("METRIC_MAX",4.0,rs.getDouble("METRIC_MAX"));
    assertEquals("METRIC_MIN",0.0,rs.getDouble("METRIC_MIN"));
    count++;
  }
  assertEquals("Day aggregated row expected ",1,count);
}

</code></pre>

<br>
<pre class="type-4 type-12 type-13 type-10 type-2 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShouldAggregateClusterIgnoringInstance() throws Exception {
  TimelineMetricAggregator agg=TimelineMetricAggregatorFactory.createTimelineClusterAggregatorSecond(hdb,getConfigurationForTest(false),new TimelineMetricMetadataManager(hdb,new Configuration()));
  TimelineMetricReadHelper readHelper=new TimelineMetricReadHelper(false);
  long startTime=System.currentTimeMillis();
  long ctime=startTime;
  long minute=60 * 1000 * 2;
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime - 100,"local1","i1","disk_free",1));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime - 100,"local2","i1","disk_free",2));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime + 100,"local1","i2","disk_free",3));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime + 100,"local2","i2","disk_free",4));
  ctime+=minute;
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime - 100,"local1","i1","disk_free",1));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime - 100,"local2","i1","disk_free",3));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime + 100,"local1","i2","disk_free",2));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime + 100,"local2","i2","disk_free",4));
  long endTime=ctime + minute;
  boolean success=agg.doWork(startTime - 1000,endTime + 1000);
  Condition condition=new DefaultCondition(null,null,null,null,startTime,endTime,null,null,true);
  condition.setStatement(String.format(GET_CLUSTER_AGGREGATE_SQL,PhoenixTransactSQL.getNaiveTimeRangeHint(startTime,NATIVE_TIME_RANGE_DELTA),METRICS_CLUSTER_AGGREGATE_TABLE_NAME));
  PreparedStatement pstmt=PhoenixTransactSQL.prepareGetMetricsSqlStmt(conn,condition);
  ResultSet rs=pstmt.executeQuery();
  int recordCount=0;
  while (rs.next()) {
    TimelineClusterMetric currentMetric=metricReader.fromResultSet(rs);
    MetricClusterAggregate currentHostAggregate=readHelper.getMetricClusterAggregateFromResultSet(rs);
    if ("disk_free".equals(currentMetric.getMetricName())) {
      System.out.println("OUTPUT: " + currentMetric + " - "+ currentHostAggregate);
      assertEquals(2,currentHostAggregate.getNumberOfHosts());
      assertEquals(5.0,Math.floor(currentHostAggregate.getSum()));
      recordCount++;
    }
 else {
      fail("Unexpected entry");
    }
  }
  Assert.assertEquals(5,recordCount);
}

</code></pre>

<br>
<pre class="type-4 type-12 type-13 type-10 type-2 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShouldAggregateDifferentMetricsOnClusterProperly() throws Exception {
  TimelineMetricAggregator agg=TimelineMetricAggregatorFactory.createTimelineClusterAggregatorSecond(hdb,getConfigurationForTest(false),new TimelineMetricMetadataManager(hdb,new Configuration()));
  TimelineMetricReadHelper readHelper=new TimelineMetricReadHelper(false);
  long startTime=System.currentTimeMillis();
  long ctime=startTime;
  long minute=60 * 1000;
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime,"local1","disk_free",1));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime,"local2","disk_free",2));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime,"local1","disk_used",1));
  ctime+=2 * minute;
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime,"local1","disk_free",2));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime,"local2","disk_free",1));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime,"local1","disk_used",1));
  long endTime=ctime + minute;
  boolean success=agg.doWork(startTime,endTime);
  Condition condition=new DefaultCondition(null,null,null,null,startTime,endTime,null,null,true);
  condition.setStatement(String.format(GET_CLUSTER_AGGREGATE_SQL,PhoenixTransactSQL.getNaiveTimeRangeHint(startTime,NATIVE_TIME_RANGE_DELTA),METRICS_CLUSTER_AGGREGATE_TABLE_NAME));
  PreparedStatement pstmt=PhoenixTransactSQL.prepareGetMetricsSqlStmt(conn,condition);
  ResultSet rs=pstmt.executeQuery();
  int recordCount=0;
  while (rs.next()) {
    TimelineClusterMetric currentMetric=metricReader.fromResultSet(rs);
    MetricClusterAggregate currentHostAggregate=readHelper.getMetricClusterAggregateFromResultSet(rs);
    if ("disk_free".equals(currentMetric.getMetricName())) {
      assertEquals(2,currentHostAggregate.getNumberOfHosts());
      assertEquals(2.0,currentHostAggregate.getMax());
      assertEquals(1.0,currentHostAggregate.getMin());
      assertEquals(3.0,currentHostAggregate.getSum());
      recordCount++;
    }
 else     if ("disk_used".equals(currentMetric.getMetricName())) {
      assertEquals(1,currentHostAggregate.getNumberOfHosts());
      assertEquals(1.0,currentHostAggregate.getMax());
      assertEquals(1.0,currentHostAggregate.getMin());
      assertEquals(1.0,currentHostAggregate.getSum());
      recordCount++;
    }
 else {
      fail("Unexpected entry");
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-12 type-13 type-10 type-2 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShouldAggregateClusterProperly() throws Exception {
  TimelineMetricAggregator agg=TimelineMetricAggregatorFactory.createTimelineClusterAggregatorSecond(hdb,getConfigurationForTest(false),new TimelineMetricMetadataManager(hdb,new Configuration()));
  TimelineMetricReadHelper readHelper=new TimelineMetricReadHelper(false);
  long startTime=System.currentTimeMillis();
  long ctime=startTime;
  long minute=60 * 1000;
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime,"local1","disk_free",1));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime,"local2","disk_free",2));
  ctime+=2 * minute;
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime,"local1","disk_free",2));
  hdb.insertMetricRecords(prepareSingleTimelineMetric(ctime,"local2","disk_free",1));
  long endTime=ctime + minute;
  boolean success=agg.doWork(startTime,endTime);
  Condition condition=new DefaultCondition(null,null,null,null,startTime,endTime,null,null,true);
  condition.setStatement(String.format(GET_CLUSTER_AGGREGATE_SQL,PhoenixTransactSQL.getNaiveTimeRangeHint(startTime,NATIVE_TIME_RANGE_DELTA),METRICS_CLUSTER_AGGREGATE_TABLE_NAME));
  PreparedStatement pstmt=PhoenixTransactSQL.prepareGetMetricsSqlStmt(conn,condition);
  ResultSet rs=pstmt.executeQuery();
  int recordCount=0;
  while (rs.next()) {
    TimelineClusterMetric currentMetric=metricReader.fromResultSet(rs);
    MetricClusterAggregate currentHostAggregate=readHelper.getMetricClusterAggregateFromResultSet(rs);
    if ("disk_free".equals(currentMetric.getMetricName())) {
      assertEquals(2,currentHostAggregate.getNumberOfHosts());
      assertEquals(2.0,currentHostAggregate.getMax());
      assertEquals(1.0,currentHostAggregate.getMin());
      assertEquals(3.0,currentHostAggregate.getSum());
      recordCount++;
    }
 else {
      fail("Unexpected entry");
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hadoop.yarn.server.applicationhistoryservice.metrics.timeline.aggregators.ITMetricAggregator </h4><pre class="type-4 type-12 type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShouldAggregateHourProperly() throws Exception {
  TimelineMetricAggregator aggregator=TimelineMetricAggregatorFactory.createTimelineMetricAggregatorHourly(hdb,getConfigurationForTest(false));
  TimelineMetricReadHelper readHelper=new TimelineMetricReadHelper(false);
  long startTime=System.currentTimeMillis();
  MetricHostAggregate expectedAggregate=MetricTestHelper.createMetricHostAggregate(2.0,0.0,20,15.0);
  Map<TimelineMetric,MetricHostAggregate> aggMap=new HashMap<TimelineMetric,MetricHostAggregate>();
  int min_5=5 * 60 * 1000;
  long ctime=startTime - min_5;
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  hdb.saveHostAggregateRecords(aggMap,METRICS_AGGREGATE_MINUTE_TABLE_NAME);
  long endTime=ctime + min_5;
  boolean success=aggregator.doWork(startTime,endTime);
  assertTrue(success);
  Condition condition=new DefaultCondition(null,null,null,null,startTime,endTime,null,null,true);
  condition.setStatement(String.format(GET_METRIC_AGGREGATE_ONLY_SQL,PhoenixTransactSQL.getNaiveTimeRangeHint(startTime,NATIVE_TIME_RANGE_DELTA),METRICS_AGGREGATE_HOURLY_TABLE_NAME));
  PreparedStatement pstmt=PhoenixTransactSQL.prepareGetMetricsSqlStmt(conn,condition);
  ResultSet rs=pstmt.executeQuery();
  while (rs.next()) {
    TimelineMetric currentMetric=readHelper.getTimelineMetricKeyFromResultSet(rs);
    MetricHostAggregate currentHostAggregate=readHelper.getMetricHostAggregateFromResultSet(rs);
    if ("disk_used".equals(currentMetric.getMetricName())) {
      assertEquals(2.0,currentHostAggregate.getMax());
      assertEquals(0.0,currentHostAggregate.getMin());
      assertEquals(12 * 20,currentHostAggregate.getNumberOfSamples());
      assertEquals(12 * 15.0,currentHostAggregate.getSum());
      assertEquals(15.0 / 20,currentHostAggregate.getAvg());
    }
  }
}

</code></pre>

<br>
<pre class="type-4 type-12 type-13 type-10 type-2 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testShouldAggregateMinuteProperly() throws Exception {
  TimelineMetricAggregator aggregatorMinute=TimelineMetricAggregatorFactory.createTimelineMetricAggregatorMinute(hdb,getConfigurationForTest(false));
  TimelineMetricReadHelper readHelper=new TimelineMetricReadHelper(false);
  long startTime=System.currentTimeMillis();
  long ctime=startTime;
  long minute=60 * 1000;
  hdb.insertMetricRecords(prepareTimelineMetrics(startTime,"local"));
  hdb.insertMetricRecords(prepareTimelineMetrics(ctime+=minute,"local"));
  hdb.insertMetricRecords(prepareTimelineMetrics(ctime+=minute,"local"));
  hdb.insertMetricRecords(prepareTimelineMetrics(ctime+=minute,"local"));
  hdb.insertMetricRecords(prepareTimelineMetrics(ctime+=minute,"local"));
  long endTime=startTime + 1000 * 60 * 4;
  boolean success=aggregatorMinute.doWork(startTime,endTime);
  Condition condition=new DefaultCondition(null,null,null,null,startTime,endTime,null,null,true);
  condition.setStatement(String.format(GET_METRIC_AGGREGATE_ONLY_SQL,PhoenixTransactSQL.getNaiveTimeRangeHint(startTime,NATIVE_TIME_RANGE_DELTA),METRICS_AGGREGATE_MINUTE_TABLE_NAME));
  PreparedStatement pstmt=PhoenixTransactSQL.prepareGetMetricsSqlStmt(conn,condition);
  ResultSet rs=pstmt.executeQuery();
  MetricHostAggregate expectedAggregate=MetricTestHelper.createMetricHostAggregate(2.0,0.0,20,15.0);
  int count=0;
  while (rs.next()) {
    TimelineMetric currentMetric=readHelper.getTimelineMetricKeyFromResultSet(rs);
    MetricHostAggregate currentHostAggregate=readHelper.getMetricHostAggregateFromResultSet(rs);
    if ("disk_free".equals(currentMetric.getMetricName())) {
      assertEquals(2.0,currentHostAggregate.getMax());
      assertEquals(0.0,currentHostAggregate.getMin());
      assertEquals(20,currentHostAggregate.getNumberOfSamples());
      assertEquals(15.0,currentHostAggregate.getSum());
      assertEquals(15.0 / 20,currentHostAggregate.getAvg());
      count++;
    }
 else     if ("mem_free".equals(currentMetric.getMetricName())) {
      assertEquals(2.0,currentHostAggregate.getMax());
      assertEquals(0.0,currentHostAggregate.getMin());
      assertEquals(20,currentHostAggregate.getNumberOfSamples());
      assertEquals(15.0,currentHostAggregate.getSum());
      assertEquals(15.0 / 20,currentHostAggregate.getAvg());
      count++;
    }
 else {
      fail("Unexpected entry");
    }
  }
  assertEquals("Two aggregated entries expected",2,count);
}

</code></pre>

<br>
<pre class="type-4 type-12 type-13 type-10 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAggregationUsingGroupByQuery() throws Exception {
  TimelineMetricAggregator aggregatorMinute=TimelineMetricAggregatorFactory.createTimelineMetricAggregatorMinute(hdb,getConfigurationForTest(true));
  TimelineMetricReadHelper readHelper=new TimelineMetricReadHelper(false);
  long startTime=System.currentTimeMillis();
  long ctime=startTime;
  long minute=60 * 1000;
  hdb.insertMetricRecords(prepareTimelineMetrics(startTime,"local"));
  hdb.insertMetricRecords(prepareTimelineMetrics(ctime+=minute,"local"));
  hdb.insertMetricRecords(prepareTimelineMetrics(ctime+=minute,"local"));
  hdb.insertMetricRecords(prepareTimelineMetrics(ctime+=minute,"local"));
  hdb.insertMetricRecords(prepareTimelineMetrics(ctime+=minute,"local"));
  long endTime=startTime + 1000 * 60 * 4;
  boolean success=aggregatorMinute.doWork(startTime,endTime);
  assertTrue(success);
  Condition condition=new DefaultCondition(null,null,null,null,startTime,endTime,null,null,true);
  condition.setStatement(String.format(GET_METRIC_AGGREGATE_ONLY_SQL,PhoenixTransactSQL.getNaiveTimeRangeHint(startTime,NATIVE_TIME_RANGE_DELTA),METRICS_AGGREGATE_MINUTE_TABLE_NAME));
  PreparedStatement pstmt=PhoenixTransactSQL.prepareGetMetricsSqlStmt(conn,condition);
  ResultSet rs=pstmt.executeQuery();
  MetricHostAggregate expectedAggregate=MetricTestHelper.createMetricHostAggregate(2.0,0.0,20,15.0);
  int count=0;
  while (rs.next()) {
    TimelineMetric currentMetric=readHelper.getTimelineMetricKeyFromResultSet(rs);
    MetricHostAggregate currentHostAggregate=readHelper.getMetricHostAggregateFromResultSet(rs);
    if ("disk_free".equals(currentMetric.getMetricName())) {
      assertEquals(2.0,currentHostAggregate.getMax());
      assertEquals(0.0,currentHostAggregate.getMin());
      assertEquals(20,currentHostAggregate.getNumberOfSamples());
      assertEquals(15.0,currentHostAggregate.getSum());
      assertEquals(15.0 / 20,currentHostAggregate.getAvg());
      count++;
    }
 else     if ("mem_free".equals(currentMetric.getMetricName())) {
      assertEquals(2.0,currentHostAggregate.getMax());
      assertEquals(0.0,currentHostAggregate.getMin());
      assertEquals(20,currentHostAggregate.getNumberOfSamples());
      assertEquals(15.0,currentHostAggregate.getSum());
      assertEquals(15.0 / 20,currentHostAggregate.getAvg());
      count++;
    }
 else {
      fail("Unexpected entry");
    }
  }
  assertEquals("Two aggregated entries expected",2,count);
}

</code></pre>

<br>
<pre class="type-4 type-12 type-13 type-2 type-5 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMetricAggregateDaily() throws Exception {
  TimelineMetricAggregator aggregator=TimelineMetricAggregatorFactory.createTimelineMetricAggregatorDaily(hdb,getConfigurationForTest(false));
  TimelineMetricReadHelper readHelper=new TimelineMetricReadHelper(false);
  long startTime=System.currentTimeMillis();
  MetricHostAggregate expectedAggregate=MetricTestHelper.createMetricHostAggregate(2.0,0.0,20,15.0);
  Map<TimelineMetric,MetricHostAggregate> aggMap=new HashMap<TimelineMetric,MetricHostAggregate>();
  int min_5=5 * 60 * 1000;
  long ctime=startTime - min_5;
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  aggMap.put(createEmptyTimelineMetric(ctime+=min_5),expectedAggregate);
  hdb.saveHostAggregateRecords(aggMap,METRICS_AGGREGATE_HOURLY_TABLE_NAME);
  long endTime=ctime + min_5;
  boolean success=aggregator.doWork(startTime,endTime);
  assertTrue(success);
  Condition condition=new DefaultCondition(null,null,null,null,startTime,endTime,null,null,true);
  condition.setStatement(String.format(GET_METRIC_AGGREGATE_ONLY_SQL,PhoenixTransactSQL.getNaiveTimeRangeHint(startTime,NATIVE_TIME_RANGE_DELTA),METRICS_AGGREGATE_DAILY_TABLE_NAME));
  PreparedStatement pstmt=PhoenixTransactSQL.prepareGetMetricsSqlStmt(conn,condition);
  ResultSet rs=pstmt.executeQuery();
  while (rs.next()) {
    TimelineMetric currentMetric=readHelper.getTimelineMetricKeyFromResultSet(rs);
    MetricHostAggregate currentHostAggregate=readHelper.getMetricHostAggregateFromResultSet(rs);
    if ("disk_used".equals(currentMetric.getMetricName())) {
      assertEquals(2.0,currentHostAggregate.getMax());
      assertEquals(0.0,currentHostAggregate.getMin());
      assertEquals(12 * 20,currentHostAggregate.getNumberOfSamples());
      assertEquals(12 * 15.0,currentHostAggregate.getSum());
      assertEquals(15.0 / 20,currentHostAggregate.getAvg());
    }
  }
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
