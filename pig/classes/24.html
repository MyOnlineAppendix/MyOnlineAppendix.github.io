<h3 style="margin:0px">Class: org.apache.pig.builtin.TestOrcStorage (10 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(7)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(6)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="14"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('14')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-14"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-6 type-4 type-5 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNullMapKey() throws Exception {
  pigServer.registerQuery("A = load '" + basedir + "nullmapkey.orc'"+ " using OrcStorage();");
  Iterator<Tuple> iter=pigServer.openIterator("A");
  assertEquals(iter.next().toString(),"([hello#world])");
  assertEquals(iter.next().toString(),"([])");
  assertFalse(iter.hasNext());
}

</code></pre>

<pre class="type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSimpleLoad() throws Exception {
  pigServer.registerQuery("A = load '" + basedir + "orc-file-11-format.orc'"+ " using OrcStorage();");
  Schema s=pigServer.dumpSchema("A");
  assertEquals(s.toString(),"{boolean1: boolean,byte1: int,short1: int,int1: int,long1: long," + "float1: float,double1: double,bytes1: bytearray,string1: chararray," + "middle: (list: {(int1: int,string1: chararray)}),list: {(int1: int,string1: chararray)},"+ "map: map[(int1: int,string1: chararray)],ts: datetime,decimal1: bigdecimal}");
  Iterator<Tuple> iter=pigServer.openIterator("A");
  verifyData(new Path(basedir + "orc-file-11-format.orc"),iter,fs,7500);
}

</code></pre>

<pre class="type-13 type-7 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testJoinWithPruning() throws Exception {
  pigServer.registerQuery("A = load '" + basedir + "orc-file-11-format.orc'"+ " using OrcStorage();");
  pigServer.registerQuery("B = foreach A generate int1, string1;");
  pigServer.registerQuery("C = order B by int1;");
  pigServer.registerQuery("D = limit C 10;");
  pigServer.registerQuery("E = load '" + INPUT1 + "' as (e0:int, e1:chararray);");
  pigServer.registerQuery("F = join D by int1, E by e0;");
  Iterator<Tuple> iter=pigServer.openIterator("F");
  int count=0;
  Tuple t=null;
  while (iter.hasNext()) {
    t=iter.next();
    assertEquals(t.size(),4);
    count++;
  }
  assertEquals(count,10);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testLoadStoreMoreDataType() throws Exception {
  pigServer.registerQuery("A = load '" + basedir + "orc-file-11-format.orc'"+ " using OrcStorage();");
  pigServer.registerQuery("B = foreach A generate boolean1..double1, '' as bytes1, string1..;");
  pigServer.store("B",OUTPUT4,"OrcStorage");
  fs.delete(new Path(OUTPUT4,"_SUCCESS"),true);
  pigServer.registerQuery("A = load '" + OUTPUT4 + "' using OrcStorage();");
  Iterator<Tuple> iter=pigServer.openIterator("A");
  Tuple t=iter.next();
  assertTrue(t.toString().startsWith("(false,1,1024,65536,9223372036854775807,1.0,-15.0," + ",hi,({(1,bye),(2,sigh)}),{(3,good),(4,bad)},[],"));
  assertTrue(t.get(12).toString().matches("2000-03-12T15:00:00.000.*"));
  assertTrue(t.toString().endsWith(",12345678.6547456)"));
}

</code></pre>

<pre class="type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@After public void teardown() throws IOException {
  if (pigServer != null) {
    pigServer.shutdown();
  }
  deleteTestFiles();
}

</code></pre>

<pre class="type-13 type-7 type-6 type-4 type-5 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCharVarchar() throws Exception {
  pigServer.registerQuery("A = load '" + basedir + "charvarchar.orc'"+ " using OrcStorage();");
  Schema schema=pigServer.dumpSchema("A");
  assertEquals(schema.size(),4);
  assertEquals(schema.getField(0).type,DataType.CHARARRAY);
  assertEquals(schema.getField(1).type,DataType.CHARARRAY);
  Iterator<Tuple> iter=pigServer.openIterator("A");
  int count=0;
  Tuple t=null;
  while (iter.hasNext()) {
    t=iter.next();
    assertEquals(t.size(),4);
    assertTrue(t.get(0) instanceof String);
    assertTrue(t.get(1) instanceof String);
    assertEquals(((String)t.get(1)).length(),20);
    count++;
  }
  assertEquals(count,10000);
}

</code></pre>

<pre class="type-7 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMultiStore() throws Exception {
  pigServer.setBatchOn();
  pigServer.registerQuery("A = load '" + INPUT1 + "' as (a0:int, a1:chararray);");
  pigServer.registerQuery("B = order A by a0;");
  pigServer.registerQuery("store B into '" + OUTPUT2 + "' using OrcStorage();");
  pigServer.registerQuery("store B into '" + OUTPUT3 + "' using OrcStorage('-c SNAPPY');");
  pigServer.executeBatch();
  Path outputFilePath=Util.getFirstPartFile(new Path(OUTPUT2));
  Reader reader=OrcFile.createReader(fs,outputFilePath);
  assertEquals(reader.getNumberOfRows(),2);
  assertEquals(reader.getCompression(),CompressionKind.ZLIB);
  Path outputFilePath2=Util.getFirstPartFile(new Path(OUTPUT3));
  reader=OrcFile.createReader(fs,outputFilePath2);
  assertEquals(reader.getNumberOfRows(),2);
  assertEquals(reader.getCompression(),CompressionKind.SNAPPY);
  verifyData(outputFilePath,outputFilePath2,fs,2);
}

</code></pre>

<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void setup() throws Exception {
  pigServer=new PigServer(Util.getLocalTestMode());
  fs=FileSystem.get(ConfigurationUtil.toConfiguration(pigServer.getPigContext().getProperties()));
  deleteTestFiles();
  pigServer.mkdirs(outbasedir);
  generateInputFiles();
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMultipleLoadStore() throws Exception {
  pigServer.registerQuery("A = load '" + basedir + "orc-file-11-format.orc'"+ " using OrcStorage();");
  pigServer.registerQuery("store A into '" + OUTPUT1 + "' using OrcStorage();");
  pigServer.registerQuery("B = load '" + OUTPUT1 + "' using OrcStorage();");
  verifyData(new Path(basedir + "orc-file-11-format.orc"),pigServer.openIterator("B"),fs,7500);
}

</code></pre>

<pre class="type-7 type-6 type-4 type-5 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSimpleStore() throws Exception {
  pigServer.registerQuery("A = load '" + INPUT1 + "' as (a0:int, a1:chararray);");
  pigServer.store("A",OUTPUT1,"OrcStorage");
  Reader reader=OrcFile.createReader(fs,Util.getFirstPartFile(new Path(OUTPUT1)));
  assertEquals(reader.getNumberOfRows(),2);
  RecordReader rows=reader.rows(null);
  Object row=rows.next(null);
  StructObjectInspector soi=(StructObjectInspector)reader.getObjectInspector();
  IntWritable intWritable=(IntWritable)soi.getStructFieldData(row,soi.getAllStructFieldRefs().get(0));
  Text text=(Text)soi.getStructFieldData(row,soi.getAllStructFieldRefs().get(1));
  assertEquals(intWritable.get(),65536);
  assertEquals(text.toString(),"world");
  row=rows.next(null);
  intWritable=(IntWritable)soi.getStructFieldData(row,soi.getAllStructFieldRefs().get(0));
  text=(Text)soi.getStructFieldData(row,soi.getAllStructFieldRefs().get(1));
  assertEquals(intWritable.get(),1);
  assertEquals(text.toString(),"hello");
  fs.delete(new Path(OUTPUT1,"_SUCCESS"),true);
  pigServer.registerQuery("A = load '" + OUTPUT1 + "' using OrcStorage();");
  Schema s=pigServer.dumpSchema("A");
  assertEquals(s.toString(),"{a0: int,a1: chararray}");
  Iterator<Tuple> iter=pigServer.openIterator("A");
  Tuple t=iter.next();
  assertEquals(t.size(),2);
  assertEquals(t.get(0),65536);
  assertEquals(t.get(1),"world");
  t=iter.next();
  assertEquals(t.size(),2);
  assertEquals(t.get(0),1);
  assertEquals(t.get(1),"hello");
  assertFalse(iter.hasNext());
  rows.close();
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
