<h3 style="margin:0px">Class: org.apache.pig.test.TestNewPlanPushDownForeachFlatten (45 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(44)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(43)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(43)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachFRJoin2() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa:(letter_grade, point_score));" + "B = foreach A generate $0, $1, flatten($2);" + "C = load 'anotherfile' as (name, age, preference:(course_name, instructor));"+ "D = foreach C generate $0, $1, flatten($2);"+ "E = join B by $0, D by $0 using 'replicated';"+ "F = limit E 10;"+ "store F into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator store=newLogicalPlan.getSinks().get(0);
  Operator limit=newLogicalPlan.getPredecessors(store).get(0);
  Operator join=newLogicalPlan.getPredecessors(limit).get(0);
  Assert.assertTrue(join instanceof LOJoin);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachCross() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa:(letter_grade, point_score));" + "B = foreach A generate $0, $1, flatten($2);" + "C = load 'anotherfile' as (name, age, preference);"+ "D = cross B, C;"+ "E = limit D 10;"+ "store E into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  List<Operator> loads=newLogicalPlan.getSources();
  Assert.assertTrue(loads.size() == 2);
  Assert.assertTrue(loads.get(0) instanceof LOLoad);
  Assert.assertTrue(loads.get(1) instanceof LOLoad);
  Operator op=null;
  if (((LOLoad)loads.get(0)).getAlias().equals("A"))   op=loads.get(0);
 else   op=loads.get(1);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(!OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOCross);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOLimit);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * No foreach in the plan, no effect.
 */
@Test public void testErrorNonForeachInput() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa);" + "store A into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator load=newLogicalPlan.getSources().get(0);
  Assert.assertTrue(load instanceof LOLoad);
  List<Operator> nexts=newLogicalPlan.getSuccessors(load);
  Assert.assertTrue(nexts != null && nexts.size() == 1);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachInnerJoin1() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa:(letter_grade, point_score));" + "B = load 'anotherfile' as (name, age, preference:(course_name, instructor));" + "C = foreach B generate $0, $1, flatten($2);"+ "D = join A by $0, C by $0;"+ "E = limit D 10;"+ "store E into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  List<Operator> loads=newLogicalPlan.getSources();
  Assert.assertTrue(loads.size() == 2);
  Assert.assertTrue(loads.get(0) instanceof LOLoad);
  Assert.assertTrue(loads.get(1) instanceof LOLoad);
  Operator op=null;
  if (((LOLoad)loads.get(0)).getAlias().equals("B"))   op=loads.get(0);
 else   op=loads.get(1);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(!OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOJoin);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOLimit);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * This is actually a valid, positive test case. Cast doesn't prevent optimization.
 * @throws Exception
 */
@Test public void testForeachCastFRJoin() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa:(letter_grade, point_score));" + "B = foreach A generate $0, (int)$1, flatten($2);" + "C = load 'anotherfile' as (name, age, preference:(course_name, instructor));"+ "D = join B by $0, C by $0 using 'replicated';"+ "E = limit D 10;"+ "store E into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  List<Operator> loads=newLogicalPlan.getSources();
  Assert.assertTrue(loads.size() == 2);
  Assert.assertTrue(loads.get(0) instanceof LOLoad);
  Assert.assertTrue(loads.get(1) instanceof LOLoad);
  Operator op=null;
  if (((LOLoad)loads.get(0)).getAlias().equals("A"))   op=loads.get(0);
 else   op=loads.get(1);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(!OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOJoin);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOLimit);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachRequiredField() throws Exception {
  String query="A = load 'myfile' as (b:bag{t:tuple(a0:chararray,a1:int)});" + "B = foreach A generate flatten($0);" + "C = order B by $1 desc;"+ "store C into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator load=newLogicalPlan.getSources().get(0);
  Assert.assertTrue(load instanceof LOLoad);
  Operator foreach=newLogicalPlan.getSuccessors(load).get(0);
  Assert.assertTrue(foreach instanceof LOForEach);
  Operator foreach1=newLogicalPlan.getSuccessors(foreach).get(0);
  Assert.assertTrue(foreach1 instanceof LOForEach);
  Operator sort=newLogicalPlan.getSuccessors(foreach1).get(0);
  Assert.assertTrue(sort instanceof LOSort);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachWithUserDefinedSchema() throws Exception {
  String query="a = load '1.txt' as (a0:int, a1, a2:bag{t:(i1:int, i2:int)});" + "b = load '2.txt' as (b0:int, b1);" + "c = foreach a generate a0, flatten(a2) as (q1, q2);"+ "d = join c by a0, b by b0;"+ "store d into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator store=newLogicalPlan.getSinks().get(0);
  LOForEach foreach=(LOForEach)newLogicalPlan.getPredecessors(store).get(0);
  Assert.assertTrue(foreach.getSchema().getField(1).alias.equals("q1"));
  Assert.assertTrue(foreach.getSchema().getField(2).alias.equals("q2"));
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachUnion() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa);" + "B = foreach A generate $0, $1, flatten($2);" + "C = load 'anotherfile' as (name, age, preference);"+ "D = union B, C;"+ "store D into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  List<Operator> loads=newLogicalPlan.getSources();
  Assert.assertTrue(loads.size() == 2);
  Assert.assertTrue(loads.get(0) instanceof LOLoad);
  Assert.assertTrue(loads.get(1) instanceof LOLoad);
  Operator load=null;
  if (((LOLoad)loads.get(0)).getAlias().equals("A"))   load=loads.get(0);
 else   load=loads.get(1);
  Assert.assertTrue(load instanceof LOLoad);
  Operator foreach=newLogicalPlan.getSuccessors(load).get(0);
  Assert.assertTrue(foreach instanceof LOForEach);
  Assert.assertTrue(OptimizerUtils.hasFlatten((LOForEach)foreach));
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachCogroup() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa);" + "B = foreach A generate $0, $1, flatten($2);" + "C = load 'anotherfile' as (name, age, preference);"+ "D = cogroup B by $0, C by $0;"+ "store D into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  List<Operator> loads=newLogicalPlan.getSources();
  Assert.assertTrue(loads.size() == 2);
  Assert.assertTrue(loads.get(0) instanceof LOLoad);
  Assert.assertTrue(loads.get(1) instanceof LOLoad);
  Operator load=null;
  if (((LOLoad)loads.get(0)).getAlias().equals("A"))   load=loads.get(0);
 else   load=loads.get(1);
  Assert.assertTrue(load instanceof LOLoad);
  Operator foreach=newLogicalPlan.getSuccessors(load).get(0);
  Assert.assertTrue(foreach instanceof LOForEach);
  Assert.assertTrue(OptimizerUtils.hasFlatten((LOForEach)foreach));
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachForeach() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa);" + "B = foreach A generate $0, $1, flatten(1);" + "C = foreach B generate $0;"+ "store C into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator load=newLogicalPlan.getSources().get(0);
  Assert.assertTrue(load instanceof LOLoad);
  Operator foreach=newLogicalPlan.getSuccessors(load).get(0);
  Assert.assertTrue(foreach instanceof LOForEach);
  Assert.assertTrue(OptimizerUtils.hasFlatten((LOForEach)foreach));
  foreach=newLogicalPlan.getSuccessors(foreach).get(0);
  Assert.assertTrue(foreach instanceof LOForEach);
  Assert.assertTrue(!OptimizerUtils.hasFlatten((LOForEach)foreach));
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachNoFlatten() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa);" + "B = foreach A generate $0, $1, $2;" + "C = order B by $0, $1;"+ "D = store C into 'dummy';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator load=newLogicalPlan.getSources().get(0);
  Assert.assertTrue(load instanceof LOLoad);
  Operator foreach=newLogicalPlan.getSuccessors(load).get(0);
  Assert.assertTrue(foreach instanceof LOForEach);
  Operator sort=newLogicalPlan.getSuccessors(foreach).get(0);
  Assert.assertTrue(sort instanceof LOSort);
}

</code></pre>

<pre class="type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Old plan is empty, so is the optimized new plan.
 */
@Test public void testErrorEmptyInput() throws Exception {
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan("");
  Assert.assertTrue(newLogicalPlan.getOperators().hasNext() == false);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachNoSuccessors() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa);" + "B = foreach A generate flatten($1);" + "Store B into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator load=newLogicalPlan.getSources().get(0);
  Assert.assertTrue(load instanceof LOLoad);
  Operator foreach=newLogicalPlan.getSuccessors(load).get(0);
  Assert.assertTrue(foreach instanceof LOForEach);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachDistinct() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa);" + "B = foreach A generate flatten($1);" + "C = distinct B;"+ "store C into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator load=newLogicalPlan.getSources().get(0);
  Assert.assertTrue(load instanceof LOLoad);
  Operator foreach=newLogicalPlan.getSuccessors(load).get(0);
  Assert.assertTrue(foreach instanceof LOForEach);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachJoinRequiredField() throws Exception {
  String query="A = load 'myfile' as (bg:bag{t:tuple(a0,a1)});" + "B = FOREACH A generate flatten($0);" + "C = load '3.txt' AS (c0, c1);"+ "D = JOIN B by a1, C by c1;"+ "E = limit D 10;"+ "store E into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator store=newLogicalPlan.getSinks().get(0);
  Operator limit=newLogicalPlan.getPredecessors(store).get(0);
  Operator join=newLogicalPlan.getPredecessors(limit).get(0);
  Assert.assertTrue(join instanceof LOJoin);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachInnerJoin2() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa:(letter_grade, point_score));" + "B = foreach A generate $0, $1, flatten($2);" + "C = load 'anotherfile' as (name, age, preference:(course_name, instructor));"+ "D = foreach C generate $0, $1, flatten($2);"+ "E = join B by $0, D by $0;"+ "F = limit E 10;"+ "store F into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator store=newLogicalPlan.getSinks().get(0);
  Operator limit=newLogicalPlan.getPredecessors(store).get(0);
  Operator join=newLogicalPlan.getPredecessors(limit).get(0);
  Assert.assertTrue(join instanceof LOJoin);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachWithUserDefinedSchema2() throws Exception {
  String query="a = load '1.txt' as (a0:chararray);" + "b = load '2.txt' as (b0:chararray);" + "c = foreach b generate flatten(STRSPLIT(b0)) as c0;"+ "d = join c by (chararray)c0, a by a0;"+ "store d into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator store=newLogicalPlan.getSinks().get(0);
  Operator op=newLogicalPlan.getPredecessors(store).get(0);
  Assert.assertTrue(op instanceof LOJoin);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * Cast should NOT matter to cross. This is a valid positive test case.
 */
@Test public void testForeachCastCross() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa:(letter_grade, point_score));" + "B = foreach A generate $0, (int)$1, flatten( $2 );" + "C = load 'anotherfile' as (name, age, preference:(course_name, instructor));"+ "D = cross B, C;"+ "E = limit D 10;"+ "store E into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  List<Operator> loads=newLogicalPlan.getSources();
  Assert.assertTrue(loads.size() == 2);
  Assert.assertTrue(loads.get(0) instanceof LOLoad);
  Assert.assertTrue(loads.get(1) instanceof LOLoad);
  Operator op=null;
  if (((LOLoad)loads.get(0)).getAlias().equals("A"))   op=loads.get(0);
 else   op=loads.get(1);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(!OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOCross);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOLimit);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * UDF doesn't prevent optimization.
 */
@Test public void testForeachUDFInnerJoin() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa:(letter_grade, point_score));" + "B = foreach A generate $0, flatten($1), " + Identity.class.getName() + "($2) ;"+ "C = load 'anotherfile' as (name, age, preference:(course_name, instructor));"+ "D = join B by $0, C by $0;"+ "E = limit D 10;"+ "store E into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  List<Operator> loads=newLogicalPlan.getSources();
  Assert.assertTrue(loads.size() == 2);
  Assert.assertTrue(loads.get(0) instanceof LOLoad);
  Assert.assertTrue(loads.get(1) instanceof LOLoad);
  Operator op=null;
  if (((LOLoad)loads.get(0)).getAlias().equals("A"))   op=loads.get(0);
 else   op=loads.get(1);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(!OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOJoin);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOLimit);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachFRJoin() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa:(letter_grade, point_score));" + "B = foreach A generate $0, $1, flatten($2);" + "C = load 'anotherfile' as (name, age, preference);"+ "D = join B by $0, C by $0 using 'replicated';"+ "E = limit D 10;"+ "store E into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  List<Operator> loads=newLogicalPlan.getSources();
  Assert.assertTrue(loads.size() == 2);
  Assert.assertTrue(loads.get(0) instanceof LOLoad);
  Assert.assertTrue(loads.get(1) instanceof LOLoad);
  Operator op=null;
  if (((LOLoad)loads.get(0)).getAlias().equals("A"))   op=loads.get(0);
 else   op=loads.get(1);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(!OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOJoin);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOLimit);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachCross2() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa:(letter_grade, point_score));" + "B = foreach A generate $0, $1, flatten($2);" + "C = load 'anotherfile' as (name, age, preference:(course_name, instructor));"+ "D = foreach C generate $0, $1, flatten($2);"+ "E = cross B, D;"+ "F = limit E 10;"+ "store F into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator store=newLogicalPlan.getSinks().get(0);
  Operator limit=newLogicalPlan.getPredecessors(store).get(0);
  Operator cross=newLogicalPlan.getPredecessors(limit).get(0);
  Assert.assertTrue(cross instanceof LOCross);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachSortWithUserDefinedSchema() throws Exception {
  String query="a = load '1.txt' as (a0:int, a1:bag{t:(i1:int, i2:int)});" + "b = foreach a generate a0, flatten(a1) as (q1, q2);" + "c = order b by a0;"+ "store c into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlanWithPruning(query);
  Operator load=newLogicalPlan.getSources().get(0);
  Assert.assertTrue(load instanceof LOLoad);
  Assert.assertTrue("Field \"a1\" is dropped by ColumnMapKeyPrune" + "even though it should be stored",((LOLoad)load).getSchema().getField("a1") != null);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachLimit() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa);" + "B = foreach A generate $0, $1, flatten($2);" + "C = limit B 10;"+ "store C into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator load=newLogicalPlan.getSources().get(0);
  Assert.assertTrue(load instanceof LOLoad);
  Operator foreach=newLogicalPlan.getSuccessors(load).get(0);
  Assert.assertTrue(foreach instanceof LOForEach);
  Assert.assertTrue(OptimizerUtils.hasFlatten((LOForEach)foreach));
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * If the flattened field is referenced in the sort condition, then no optimization can be done.
 */
@Test public void testForeachSortNegative2() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa:tuple(x,y));" + "B = foreach A generate $0, $1, flatten($2);" + "C = order B by $0, $3;"+ "D = store C into 'dummy';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator load=newLogicalPlan.getSources().get(0);
  Assert.assertTrue(load instanceof LOLoad);
  Operator foreach=newLogicalPlan.getSuccessors(load).get(0);
  Assert.assertTrue(foreach instanceof LOForEach);
  Operator foreach1=newLogicalPlan.getSuccessors(foreach).get(0);
  Assert.assertTrue(foreach1 instanceof LOForEach);
  Operator sort=newLogicalPlan.getSuccessors(foreach1).get(0);
  Assert.assertTrue(sort instanceof LOSort);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testForeachJoinWithUserDefinedSchemaAndPruning() throws Exception {
  String query="a = load '1.txt' as (a0:int, a1, a2:bag{});" + "b = load '2.txt' as (b0:int, b1);" + "c = foreach a generate a0, flatten(a2) as (q1, q2);"+ "d = join c by a0, b by b0;"+ "e = foreach d generate a0, q1, q2;"+ "f = foreach e generate a0, (int)q1, (int)q2;"+ "store f into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlanWithPruning(query);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachCross1() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa:(letter_grade, point_score));" + "B = load 'anotherfile' as (name, age, preference:(course_name, instructor));" + "C = foreach B generate $0, $1, flatten($2);"+ "D = cross A, C;"+ "E = limit D 10;"+ "store E into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  List<Operator> loads=newLogicalPlan.getSources();
  Assert.assertTrue(loads.size() == 2);
  Assert.assertTrue(loads.get(0) instanceof LOLoad);
  Assert.assertTrue(loads.get(1) instanceof LOLoad);
  Operator op=null;
  if (((LOLoad)loads.get(0)).getAlias().equals("B"))   op=loads.get(0);
 else   op=loads.get(1);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(!OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOCross);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOLimit);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * Valid positive test case, even though the benefit from the optimization is questionable. However, putting in additinal check for
 * this condition requires extra coding.
 */
@Test public void testForeachFlattenAddedColumnFRJoin() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa:(letter_grade, point_score));" + "B = foreach A generate $0, $1, flatten(1);" + "C = load 'anotherfile' as (name, age, preference:(course_name, instructor));"+ "D = join B by $0, C by $0 using 'replicated';"+ "E = limit D 10;"+ "store E into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  List<Operator> loads=newLogicalPlan.getSources();
  Assert.assertTrue(loads.size() == 2);
  Assert.assertTrue(loads.get(0) instanceof LOLoad);
  Assert.assertTrue(loads.get(1) instanceof LOLoad);
  Operator op=null;
  if (((LOLoad)loads.get(0)).getAlias().equals("A"))   op=loads.get(0);
 else   op=loads.get(1);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(!OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOJoin);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOLimit);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachStreaming() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa);" + "B = foreach A generate flatten($1);" + "C = stream B through `"+ "pc -l"+ "`;"+ "Store C into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator load=newLogicalPlan.getSources().get(0);
  Assert.assertTrue(load instanceof LOLoad);
  Operator foreach=newLogicalPlan.getSuccessors(load).get(0);
  Assert.assertTrue(foreach instanceof LOForEach);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * This is actually a valid, positive test case. UDF doesn't prevent optimization.
 * @throws Exception
 */
@Test public void testForeachUDFFRJoin() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa:(letter_grade, point_score));" + "B = foreach A generate $0, flatten($1), " + Identity.class.getName() + "($2) ;"+ "C = load 'anotherfile' as (name, age, preference:(course_name, instructor));"+ "D = join B by $0, C by $0 using 'replicated';"+ "E = limit D 10;"+ "store E into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  List<Operator> loads=newLogicalPlan.getSources();
  Assert.assertTrue(loads.size() == 2);
  Assert.assertTrue(loads.get(0) instanceof LOLoad);
  Assert.assertTrue(loads.get(1) instanceof LOLoad);
  Operator op=null;
  if (((LOLoad)loads.get(0)).getAlias().equals("A"))   op=loads.get(0);
 else   op=loads.get(1);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(!OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOJoin);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOLimit);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * Non-pure-projection, not optimizable.
 */
@Test public void testForeachSortNegative1() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa);" + "B = foreach A generate $0 + 5, $1, flatten($2);" + "C = order B by $0, $1;"+ "D = store C into 'dummy';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator load=newLogicalPlan.getSources().get(0);
  Assert.assertTrue(load instanceof LOLoad);
  Operator foreach=newLogicalPlan.getSuccessors(load).get(0);
  Assert.assertTrue(foreach instanceof LOForEach);
  Operator sort=newLogicalPlan.getSuccessors(foreach).get(0);
  Assert.assertTrue(sort instanceof LOSort);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachInnerJoin() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa:(letter_grade, point_score));" + "B = foreach A generate $0, $1, flatten($2);" + "C = load 'anotherfile' as (name, age, preference:(course_name, instructor));"+ "D = join B by $0, C by $0;"+ "E = limit D 10;"+ "store E into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  List<Operator> loads=newLogicalPlan.getSources();
  Assert.assertTrue(loads.size() == 2);
  Assert.assertTrue(loads.get(0) instanceof LOLoad);
  Assert.assertTrue(loads.get(1) instanceof LOLoad);
  Operator op=null;
  if (((LOLoad)loads.get(0)).getAlias().equals("A"))   op=loads.get(0);
 else   op=loads.get(1);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(!OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOJoin);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOLimit);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachFilter() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa);" + "B = foreach A generate $0, $1, flatten($2);" + "C = filter B by $1 < 18;"+ "store C into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator load=newLogicalPlan.getSources().get(0);
  Assert.assertTrue(load instanceof LOLoad);
  Operator foreach=newLogicalPlan.getSuccessors(load).get(0);
  Assert.assertTrue(foreach instanceof LOForEach);
  Assert.assertTrue(OptimizerUtils.hasFlatten((LOForEach)foreach));
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testOuterJoin() throws Exception {
  String query="A = load 'A.txt' as (id:chararray, value:double);" + "B = load 'B.txt' as (id:chararray, name:chararray);" + "t1 = group A by id;"+ "t2 = foreach t1 { r1 = filter $1 by (value>1); r2 = limit r1 1; generate group as id, FLATTEN(r2.value) as value; }"+ "t3 = join B by id LEFT OUTER, t2 by id;"+ "store t3 into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator store=newLogicalPlan.getSinks().get(0);
  Operator join=newLogicalPlan.getPredecessors(store).get(0);
  Assert.assertTrue(join instanceof LOJoin);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachSplitOutput() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa);" + "B = foreach A generate $0, $1, flatten($2);" + "split B into C if $1 < 18, D if $1 >= 18;"+ "store C into 'output1';"+ "store D into 'output2';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator load=newLogicalPlan.getSources().get(0);
  Assert.assertTrue(load instanceof LOLoad);
  Operator foreach=newLogicalPlan.getSuccessors(load).get(0);
  Assert.assertTrue(foreach instanceof LOForEach);
  Assert.assertTrue(OptimizerUtils.hasFlatten((LOForEach)foreach));
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachSort() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa);" + "B = foreach A generate $0, $1, flatten($2);" + "C = order B by $0, $1;"+ "D = store C into 'dummy';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator load=newLogicalPlan.getSources().get(0);
  Assert.assertTrue(load instanceof LOLoad);
  Operator sort=newLogicalPlan.getSuccessors(load).get(0);
  Assert.assertTrue(sort instanceof LOSort);
  Operator foreach=newLogicalPlan.getSuccessors(sort).get(0);
  Assert.assertTrue(foreach instanceof LOForEach);
  Assert.assertTrue(OptimizerUtils.hasFlatten((LOForEach)foreach));
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachCastSort() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa);" + "B = foreach A generate (chararray)$0, $1, flatten($2);" + "C = order B by $0, $1;"+ "store C into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator load=newLogicalPlan.getSources().get(0);
  Assert.assertTrue(load instanceof LOLoad);
  Operator foreach=newLogicalPlan.getSuccessors(load).get(0);
  Assert.assertTrue(foreach instanceof LOForEach);
  Operator sort=newLogicalPlan.getSuccessors(foreach).get(0);
  Assert.assertTrue(sort instanceof LOSort);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * This is a valid, positive test case. Optimization should go thru.
 */
@Test public void testForeachUDFCross() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa:(letter_grade, point_score));" + "B = foreach A generate $0, flatten($1), " + Identity.class.getName() + "($2) ;"+ "C = load 'anotherfile' as (name, age, preference:(course_name, instructor));"+ "D = cross B, C;"+ "E = limit D 10;"+ "store E into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  List<Operator> loads=newLogicalPlan.getSources();
  Assert.assertTrue(loads.size() == 2);
  Assert.assertTrue(loads.get(0) instanceof LOLoad);
  Assert.assertTrue(loads.get(1) instanceof LOLoad);
  Operator op=null;
  if (((LOLoad)loads.get(0)).getAlias().equals("A"))   op=loads.get(0);
 else   op=loads.get(1);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(!OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOCross);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOLimit);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachUDFSort() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa);" + "B = foreach A generate $0, $1, " + Identity.class.getName() + "($2) ;"+ "C = order B by $0, $1;"+ "store C into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator load=newLogicalPlan.getSources().get(0);
  Assert.assertTrue(load instanceof LOLoad);
  Operator foreach=newLogicalPlan.getSuccessors(load).get(0);
  Assert.assertTrue(foreach instanceof LOForEach);
  Operator sort=newLogicalPlan.getSuccessors(foreach).get(0);
  Assert.assertTrue(sort instanceof LOSort);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * This actually is a valid case, even though the optimization may not provide any performance benefit. However, detecting 
 * such a case requires more coding. Thus, we allow optimization to go thru in this case.
 */
@Test public void testForeachFlattenAddedColumnCross() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa:(letter_grade, point_score));" + "B = foreach A generate $0, $1, flatten(1);" + "C = load 'anotherfile' as (name, age, preference:(course_name, instructor));"+ "D = cross B, C;"+ "E = limit D 10;"+ "store E into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  List<Operator> loads=newLogicalPlan.getSources();
  Assert.assertTrue(loads.size() == 2);
  Assert.assertTrue(loads.get(0) instanceof LOLoad);
  Assert.assertTrue(loads.get(1) instanceof LOLoad);
  Operator op=null;
  if (((LOLoad)loads.get(0)).getAlias().equals("A"))   op=loads.get(0);
 else   op=loads.get(1);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(!OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOCross);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOLimit);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachFRJoin1() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa:(letter_grade, point_score));" + "B = load 'anotherfile' as (name, age, preference:(course_name, instructor));" + "C = foreach B generate $0, $1, flatten($2);"+ "D = join A by $0, C by $0 using 'replicated';"+ "E = limit D 10;"+ "store E into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  List<Operator> loads=newLogicalPlan.getSources();
  Assert.assertTrue(loads.size() == 2);
  Assert.assertTrue(loads.get(0) instanceof LOLoad);
  Assert.assertTrue(loads.get(1) instanceof LOLoad);
  Operator op=null;
  if (((LOLoad)loads.get(0)).getAlias().equals("B"))   op=loads.get(0);
 else   op=loads.get(1);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(!OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOJoin);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOLimit);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * Cast doesn't prevent optimization.
 */
@Test public void testForeachCastInnerJoin() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa:(letter_grade, point_score));" + "B = foreach A generate $0, (int)$1, flatten($2);" + "C = load 'anotherfile' as (name, age, preference:(course_name, instructor));"+ "D = join B by $0, C by $0;"+ "E = limit D 10;"+ "store E into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  List<Operator> loads=newLogicalPlan.getSources();
  Assert.assertTrue(loads.size() == 2);
  Assert.assertTrue(loads.get(0) instanceof LOLoad);
  Assert.assertTrue(loads.get(1) instanceof LOLoad);
  Operator op=null;
  if (((LOLoad)loads.get(0)).getAlias().equals("A"))   op=loads.get(0);
 else   op=loads.get(1);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(!OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOJoin);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOLimit);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachGroupBy() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa);" + "B = foreach A generate $0, $1, flatten($2);" + "C = group B by $0;"+ "store C into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator load=newLogicalPlan.getSources().get(0);
  Assert.assertTrue(load instanceof LOLoad);
  Operator foreach=newLogicalPlan.getSuccessors(load).get(0);
  Assert.assertTrue(foreach instanceof LOForEach);
  Assert.assertTrue(OptimizerUtils.hasFlatten((LOForEach)foreach));
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testNonDeterministicUdf() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa);" + "B = foreach A generate $0, RANDOM(), flatten($2);" + "C = order B by $0, $1;"+ "D = store C into 'dummy';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator load=newLogicalPlan.getSources().get(0);
  Assert.assertTrue(load instanceof LOLoad);
  Operator foreach=newLogicalPlan.getSuccessors(load).get(0);
  Assert.assertTrue(foreach instanceof LOForEach);
  Operator sort=newLogicalPlan.getSuccessors(foreach).get(0);
  Assert.assertTrue(sort instanceof LOSort);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testForeachFlattenAddedColumnSort() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa);" + "B = foreach A generate $0, $1, flatten(1);" + "C = order B by $0, $1;"+ "store C into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  Operator load=newLogicalPlan.getSources().get(0);
  Assert.assertTrue(load instanceof LOLoad);
  Operator foreach=newLogicalPlan.getSuccessors(load).get(0);
  Assert.assertTrue(foreach instanceof LOForEach);
  Operator sort=newLogicalPlan.getSuccessors(foreach).get(0);
  Assert.assertTrue(sort instanceof LOSort);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
/** 
 * This is actually a valid positive test case, even though the benefit of such optimization is questionable. However, 
 * checking for such condition requires additional coding effort.
 */
@Test public void testForeachFlattenAddedColumnInnerJoin() throws Exception {
  String query="A = load 'myfile' as (name, age, gpa:(letter_grade, point_score));" + "B = foreach A generate $0, $1, flatten(1);" + "C = load 'anotherfile' as (name, age, preference:(course_name, instructor));"+ "D = join B by $0, C by $0;"+ "E = limit D 10;"+ "store E into 'output';";
  LogicalPlan newLogicalPlan=migrateAndOptimizePlan(query);
  List<Operator> loads=newLogicalPlan.getSources();
  Assert.assertTrue(loads.size() == 2);
  Assert.assertTrue(loads.get(0) instanceof LOLoad);
  Assert.assertTrue(loads.get(1) instanceof LOLoad);
  Operator op=null;
  if (((LOLoad)loads.get(0)).getAlias().equals("A"))   op=loads.get(0);
 else   op=loads.get(1);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(!OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOJoin);
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOForEach);
  Assert.assertTrue(OptimizerUtils.hasFlatten((LOForEach)op));
  op=newLogicalPlan.getSuccessors(op).get(0);
  Assert.assertTrue(op instanceof LOLimit);
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
