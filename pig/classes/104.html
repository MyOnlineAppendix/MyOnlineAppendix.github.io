<h3 style="margin:0px">Class: org.apache.pig.piggybank.test.storage.avro.TestAvroStorage (46 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(37)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="14"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('14')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-14"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGlob4() throws IOException {
  String output=outbasedir + "testGlob4";
  String expected=basedir + "expected_test_dir_1_2.avro";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testDir12AllFiles) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ "   'schema', '{\"type\":\"array\",\"items\":\"float\"}'  );"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-9 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRecursiveRecordWithData() throws IOException {
  String output=outbasedir + "testRecursiveWithData";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testRecursiveRecordInUnion) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ " 'no_schema_check',"+ " 'data', '"+ Util.encodeEscape(testRecursiveRecordInUnion)+ "' );"};
  try {
    testAvroStorage(queries);
    Assert.fail("Negative test to test an exception. Should not be succeeding!");
  }
 catch (  FrontendException e) {
    assertTrue(e.getMessage().contains("could not instantiate 'org.apache.pig.piggybank.storage.avro.AvroStorage'"));
  }
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUserDefinedLoadSchema() throws IOException {
  PigSchema2Avro.setTupleIndex(2);
  String output=outbasedir + "testUserDefinedLoadSchema";
  String expected=basedir + "expected_testUserDefinedLoadSchema.avro";
  String customSchema="{\"type\": \"record\", \"name\": \"employee\", \"fields\": [ " + "{ \"default\": \"***\", \"type\": \"string\", \"name\": \"name\" }, " + "{ \"name\": \"address\", \"type\": { "+ "\"type\": \"record\", \"name\": \"addressDetails\", \"fields\": [ "+ "{ \"default\": 0, \"type\": \"int\", \"name\": \"customField1\" }, "+ "{ \"default\": 0, \"type\": \"int\", \"name\": \"customField2\" }, "+ "{ \"default\": 0, \"type\": \"int\", \"name\": \"customField3\" } "+ "] "+ "} } "+ "] } ";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + testUserDefinedLoadSchemaFile + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ('schema', '"+ customSchema+ "');"," o = ORDER in BY name;"," STORE o INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCorruptedFile1() throws IOException {
  String output=outbasedir + "testCorruptedFile1";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testCorruptedFile) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"};
  testAvroStorage(true,queries);
}

</code></pre>

<pre class="type-7 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testLoadwithNullValues() throws IOException {
  PigSchema2Avro.setTupleIndex(0);
  Data data=resetData(pigServerLocal);
  String output=outbasedir + "testLoadwithNulls";
  deleteDirectory(new File(output));
  String[] queries={" A = load '" + testLoadwithNullValues + "' USING "+ " org.apache.pig.piggybank.storage.avro.AvroStorage(); "," B = order A by name;"," store B into '" + output + "' USING mock.Storage();"};
  testAvroStorage(queries);
  List<Tuple> out=data.get(output);
  assertEquals(out + " size",4,out.size());
  assertEquals(schema("name:chararray,age:int,gpa:double"),data.getSchema(output));
  assertEquals(tuple((String)null),out.get(0));
  assertEquals(tuple((String)null),out.get(1));
  assertEquals(tuple("calvin ellison",24,0.71),out.get(2));
  assertEquals(tuple("wendy johnson",60,0.07),out.get(3));
}

</code></pre>

<pre class="type-9 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGenericUnion() throws IOException {
  String output=outbasedir + "testGenericUnion";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testGenericUnionFile) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"};
  try {
    testAvroStorage(queries);
    Assert.fail("Negative test to test an exception. Should not be succeeding!");
  }
 catch (  FrontendException e) {
    assertTrue(e.getMessage().contains("Cannot get schema"));
  }
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGlob5() throws IOException {
  String output=outbasedir + "testGlob5";
  String expected=basedir + "expected_test_dir_1_2.avro";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testDir21AllFiles) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ "   'schema', '{\"type\":\"array\",\"items\":\"float\"}'  );"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMultipleSchemas2() throws IOException {
  String output=outbasedir + "testMultipleSchemas2";
  String expected=basedir + "expected_testMultipleSchemas2.avro";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testMultipleSchemas2File) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ('multiple_schemas');"," f = FOREACH in GENERATE ($0 is not null ? (chararray)$0 : '')," + "                         ($1 is not null ? (chararray)$1 : '')," + "                         ($2 is not null ? (chararray)$2 : ''),"+ "                         ($3 is not null ? (chararray)$3 : ''),"+ "                         ($4 is not null ? (chararray)$4 : ''),"+ "                         ($5 is not null ? (chararray)$5 : '');"," c = FOREACH f GENERATE StringConcat( $0, $1, $2, $3, $4, $5 );"," o = ORDER c BY $0;"," STORE o INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ('schema', '\"string\"');"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testRecursiveRecordInMap() throws IOException {
  String output=outbasedir + "testRecursiveRecordInMap";
  String expected=testRecursiveRecordInMap;
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testRecursiveRecordInMap) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ " 'no_schema_check',"+ " 'schema', '"+ recursiveRecordInMap+ "' );"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCorruptedFile2() throws IOException {
  String output=outbasedir + "testCorruptedFile2";
  String expected=basedir + "expected_testCorruptedFile.avro";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testCorruptedFile) + "'"+ " USING org.apache.pig.piggybank.storage.avro.AvroStorage ('ignore_bad_files');"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testFileWithNoExtension() throws IOException {
  PigSchema2Avro.setTupleIndex(4);
  String output=outbasedir + "testFileWithNoExtension";
  String expected=basedir + "expected_testFileWithNoExtension.avro";
  deleteDirectory(new File(output));
  String[] queries={" avro = LOAD '" + Util.encodeEscape(testNoExtensionFile) + " ' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," avro1 = FILTER avro BY member_id > 1211;"," avro2 = FOREACH avro1 GENERATE member_id, browser_id, tracking_time, act_content ;"," STORE avro2 INTO '" + output + "' "+ " USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ "'{\"data\":  \""+ Util.encodeEscape(testNoExtensionFile)+ "\" ,"+ "  \"field0\": \"int\", "+ " \"field1\":  \"def:browser_id\", "+ "  \"field3\": \"def:act_content\" "+ " }');"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGlob2() throws IOException {
  String output=outbasedir + "testGlob2";
  String expected=basedir + "expected_test_dir_1.avro";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testDir1Files123) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ "   'schema', '{\"type\":\"array\",\"items\":\"float\"}'  );"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMultipleSchemas1() throws IOException {
  String output=outbasedir + "testMultipleSchemas1";
  String expected=basedir + "expected_testMultipleSchemas1.avro";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testMultipleSchemas1File) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ('multiple_schemas');"," s = FOREACH in GENERATE StringConcat($0);"," o = ORDER s BY $0;"," STORE o INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ('schema', '\"string\"');"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testArrayWithSchemaURI() throws IOException {
  String output=outbasedir + "testArrayWithSchemaURI";
  String expected=basedir + "expected_testArrayWithSchemaURI.avro";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testArrayFile) + " ' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ( "+ "   'schema_uri', '"+ Util.encodeEscape(testArraySchema)+ "'  );"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testArrayWithSame() throws IOException {
  String output=outbasedir + "testArrayWithSame";
  String expected=basedir + "expected_testArrayWithSchema.avro";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testArrayFile) + " ' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ( "+ "   'same', '"+ Util.encodeEscape(testArrayFile)+ "'  );"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-14 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
"></span><br>
@AfterClass public static void teardown(){
  if (pigServerLocal != null)   pigServerLocal.shutdown();
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testRecursiveRecordWithNoAvroSchema() throws IOException {
  String output=outbasedir + "testRecursiveRecordWithNoAvroSchema";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testRecursiveRecordInUnion) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ " 'no_schema_check' );"};
  testAvroStorage(true,queries);
}

</code></pre>

<pre class="type-7 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMultipleSchemasWithDefaultValue() throws IOException {
  Data data=resetData(pigServerLocal);
  String output=outbasedir + "testMultipleSchemasWithDefaultValue";
  deleteDirectory(new File(output));
  String expected=basedir + "expected_testMultipleSchemasWithDefaultValue.avro";
  String[] queries={" a = LOAD '" + testMultipleSchemasWithDefaultValue + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ('multiple_schemas');"," b = foreach a generate name,age,dept,office,lastname,salary;"," c = filter b by age < 40 ;"," d = order c by  name;"," STORE d INTO '" + output + "' using mock.Storage();"};
  testAvroStorage(queries);
  List<Tuple> out=data.get(output);
  assertEquals(out + " size",5,out.size());
  assertEquals(schema("name: chararray,age: int,dept: chararray,office: chararray,lastname: chararray,salary: int"),data.getSchema(output));
  assertEquals(tuple("Asmya",34,"PQ","OU","LNU",0),out.get(0));
  assertEquals(tuple("Baljit",23,"RS","OU","LNU",0),out.get(1));
  assertEquals(tuple("Milo",30,"DH","OU","LNU",0),out.get(2));
  assertEquals(tuple("Mumbai",20,"Applied Math","UAH","Indians",4468),out.get(3));
  assertEquals(tuple("Rajsathan",20,"Biochemistry","Stanford","Royals",1378),out.get(4));
}

</code></pre>

<pre class="type-9 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRecursiveRecordWithSchemaFile() throws IOException {
  String output=outbasedir + "testRecursiveWithSchemaFile";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testRecursiveRecordInUnion) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ " 'no_schema_check',"+ " 'schema_file', '"+ Util.encodeEscape(testRecursiveRecordInUnionSchema)+ "' );"};
  try {
    testAvroStorage(queries);
    Assert.fail("Negative test to test an exception. Should not be succeeding!");
  }
 catch (  FrontendException e) {
    assertTrue(e.getMessage().contains("could not instantiate 'org.apache.pig.piggybank.storage.avro.AvroStorage'"));
  }
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGlob3() throws IOException {
  String output=outbasedir + "testGlob3";
  String expected=basedir + "expected_test_dir_1.avro";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testDir1Files321) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ "   'schema', '{\"type\":\"array\",\"items\":\"float\"}'  );"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testArrayWithSnappyCompression() throws IOException {
  String output=outbasedir + "testArrayWithSnappyCompression";
  String expected=basedir + "expected_testArrayDefault.avro";
  deleteDirectory(new File(output));
  Properties properties=new Properties();
  properties.setProperty(MRConfiguration.OUTPUT_COMPRESS,"true");
  properties.setProperty(MRConfiguration.OUTPUT_COMPRESSION_CODEC,"org.apache.hadoop.io.compress.SnappyCodec");
  properties.setProperty("avro.output.codec","snappy");
  PigServer pigServer=new PigServer(ExecType.LOCAL,properties);
  pigServer.setBatchOn();
  String[] queries={" in = LOAD '" + Util.encodeEscape(testArrayFile) + " ' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"};
  for (  String query : queries) {
    pigServer.registerQuery(query);
  }
  pigServer.executeBatch();
  verifyResults(output,expected,"snappy");
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testComma2() throws IOException {
  String output=outbasedir + "testComma2";
  String expected=basedir + "expected_test_dir_1_2.avro";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testCommaSeparated2) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ "   'schema', '{\"type\":\"array\",\"items\":\"float\"}'  );"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testRecordWithFieldSchemaFromTextWithSchemaFile2() throws IOException {
  PigSchema2Avro.setTupleIndex(1);
  String output=outbasedir + "testRecordWithFieldSchemaFromTextWithSchemaFile2";
  String expected=basedir + "expected_testRecordWithFieldSchema.avro";
  deleteDirectory(new File(output));
  String[] queries={" avro = LOAD '" + Util.encodeEscape(testTextFile) + "' AS (member_id:int, browser_id:chararray, tracking_time:long, act_content:bag{inner:tuple(key:chararray, value:chararray)});"," avro1 = FILTER avro BY member_id > 1211;"," avro2 = FOREACH avro1 GENERATE member_id, browser_id, tracking_time, act_content ;"," STORE avro2 INTO '" + output + "' "+ " USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ "'schema_file', '"+ Util.encodeEscape(testRecordSchema)+ "',"+ "'field0','int',"+ "'field1','def:browser_id',"+ "'field3','def:act_content'"+ ");"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testArrayDefault() throws IOException {
  String output=outbasedir + "testArrayDefault";
  String expected=basedir + "expected_testArrayDefault.avro";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testArrayFile) + " ' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-9 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRecursiveRecordWithSchemaCheck() throws IOException {
  String output=outbasedir + "testRecursiveWithSchemaCheck";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testRecursiveRecordInUnion) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ " 'schema', '"+ recursiveRecordInUnion+ "' );"};
  try {
    testAvroStorage(queries);
    Assert.fail("Negative test to test an exception. Should not be succeeding!");
  }
 catch (  IOException e) {
    assertTrue(e.getMessage().contains("bytearray is not compatible with avro"));
  }
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSingleFieldTuples() throws IOException {
  String output=outbasedir + "testSingleFieldTuples";
  String expected=basedir + "expected_testSingleFieldTuples.avro";
  deleteDirectory(new File(output));
  String[] queries={" messages = LOAD '" + Util.encodeEscape(testSingleTupleBagFile) + " ' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," a = foreach (group messages by user_id) { sorted = order messages by message_id DESC; GENERATE group AS user_id, sorted AS messages; };"," STORE a INTO '" + output + "' "+ " USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"};
  testAvroStorage(queries);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testComma1() throws IOException {
  String output=outbasedir + "testComma1";
  String expected=basedir + "expected_test_dir_1.avro";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testCommaSeparated1) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ "   'schema', '{\"type\":\"array\",\"items\":\"float\"}'  );"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testRecursiveRecordReference3() throws IOException {
  String output=outbasedir + "testRecursiveRecordReference3";
  String expected=basedir + "expected_testRecursiveRecordReference3.avro";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testRecursiveRecordInUnion) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," third = FOREACH in GENERATE $1.$1.$0 AS value;"," filtered = FILTER third BY value is not null;"," STORE filtered INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ " 'no_schema_check',"+ " 'schema', '\"int\"' );"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDir() throws IOException {
  String output=outbasedir + "testDir";
  String expected=basedir + "expected_testDir.avro";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testDir1) + " ' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ "   'schema', '{\"type\":\"array\",\"items\":\"float\"}'  );"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGlob1() throws IOException {
  String output=outbasedir + "testGlob1";
  String expected=basedir + "expected_testDir.avro";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testDir1AllFiles) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ "   'schema', '{\"type\":\"array\",\"items\":\"float\"}'  );"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testRecordWithSplitFromText() throws IOException {
  PigSchema2Avro.setTupleIndex(0);
  String output1=outbasedir + "testRecordSplitFromText1";
  String output2=outbasedir + "testRecordSplitFromText2";
  String expected1=basedir + "expected_testRecordSplitFromText1.avro";
  String expected2=basedir + "expected_testRecordSplitFromText2.avro";
  deleteDirectory(new File(output1));
  deleteDirectory(new File(output2));
  String[] queries={" avro = LOAD '" + Util.encodeEscape(testTextFile) + "' AS (member_id:int, browser_id:chararray, tracking_time:long, act_content:bag{inner:tuple(key:chararray, value:chararray)});"," groups = GROUP avro BY member_id;"," sc = FOREACH groups GENERATE group AS key, COUNT(avro) AS cnt;"," STORE sc INTO '" + output1 + "' "+ " USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ "'{\"index\": 1, "+ "  \"schema\": {\"type\":\"record\", "+ " \"name\":\"result\", "+ " \"fields\":[ {\"name\":\"member_id\",\"type\":\"int\"}, "+ "{\"name\":\"count\", \"type\":\"long\"} "+ "]"+ "}"+ " }');"," STORE sc INTO '" + output2 + " 'USING org.apache.pig.piggybank.storage.avro.AvroStorage ('index', '2');"};
  testAvroStorage(queries);
  verifyResults(output1,expected1);
  verifyResults(output2,expected2);
}

</code></pre>

<pre class="type-7 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testMultipleLoadStore() throws Exception {
  PigSchema2Avro.setTupleIndex(0);
  Data data=resetData(pigServerLocal);
  data.set("foo",tuple(1,2,3),tuple(4,5,6),tuple(7,8,9));
  data.set("bar",tuple("a","b","c"),tuple("d","e","f"),tuple("g","h","i"));
  String output=outbasedir + "testMultipleLoadStore";
  deleteDirectory(new File(output));
  String[] storeQuery={"A = LOAD 'foo' USING " + "mock.Storage() as (a1:int, a2:int, a3:int);","B = LOAD 'bar' USING " + "mock.Storage() as (b1:chararray, b2:chararray, b3:chararray);","STORE A into '" + output + "/A' USING "+ "org.apache.pig.piggybank.storage.avro.AvroStorage();","STORE B into '" + output + "/B' USING "+ "org.apache.pig.piggybank.storage.avro.AvroStorage();"};
  testAvroStorage(storeQuery);
  String[] loadQuery={"C = LOAD '" + output + "/A' USING "+ "org.apache.pig.piggybank.storage.avro.AvroStorage();","D = LOAD '" + output + "/B' USING "+ "org.apache.pig.piggybank.storage.avro.AvroStorage();","STORE C into 'foo-actual' USING mock.Storage();","STORE D into 'bar-actual' USING mock.Storage();"};
  testAvroStorage(loadQuery);
  assertEquals(data.get("foo"),data.get("foo-actual"));
  assertEquals(data.get("bar"),data.get("bar-actual"));
  assertEquals("{a1: int,a2: int,a3: int}",data.getSchema("foo-actual").toString());
  assertEquals("{b1: chararray,b2: chararray,b3: chararray}",data.getSchema("bar-actual").toString());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testRecursiveRecordInRecord() throws IOException {
  String output=outbasedir + "testRecursiveRecordInRecord";
  String expected=testRecursiveRecordInRecord;
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testRecursiveRecordInRecord) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ " 'no_schema_check',"+ " 'schema', '"+ Util.encodeEscape(recursiveRecordInRecord)+ "' );"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-9 type-5 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGlob6() throws IOException {
  String output=outbasedir + "testGlob6";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testNoMatchedFiles) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ "   'schema', '{\"type\":\"array\",\"items\":\"float\"}'  );"};
  try {
    testAvroStorage(queries);
    Assert.fail("Negative test to test an exception. Should not be succeeding!");
  }
 catch (  JobCreationException e) {
    assertEquals(e.getMessage(),"Internal error creating job configuration.");
  }
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testRecursiveRecordReference2() throws IOException {
  String output=outbasedir + "testRecursiveRecordReference2";
  String expected=basedir + "expected_testRecursiveRecordReference2.avro";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testRecursiveRecordInUnion) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," second = FOREACH in GENERATE $1.$0 AS value;"," filtered = FILTER second BY value is not null;"," STORE filtered INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ " 'no_schema_check',"+ " 'schema', '\"int\"' );"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testRecursiveRecordInArray() throws IOException {
  String output=outbasedir + "testRecursiveRecordInArray";
  String expected=testRecursiveRecordInArray;
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testRecursiveRecordInArray) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ " 'no_schema_check',"+ " 'schema', '"+ recursiveRecordInArray+ "' );"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testArrayWithNotNull() throws IOException {
  String output=outbasedir + "testArrayWithNotNull";
  String expected=basedir + "expected_testArrayWithSchema.avro";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testArrayFile) + " ' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ( "+ "   '{\"nullable\": false }'  );"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testRecordWithSplit() throws IOException {
  PigSchema2Avro.setTupleIndex(0);
  String output1=outbasedir + "testRecordSplit1";
  String output2=outbasedir + "testRecordSplit2";
  String expected1=basedir + "expected_testRecordSplit1.avro";
  String expected2=basedir + "expected_testRecordSplit2.avro";
  deleteDirectory(new File(output1));
  deleteDirectory(new File(output2));
  String[] queries={" avro = LOAD '" + Util.encodeEscape(testRecordFile) + " ' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," groups = GROUP avro BY member_id;"," sc = FOREACH groups GENERATE group AS key, COUNT(avro) AS cnt;"," STORE sc INTO '" + output1 + "' "+ " USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ "'{\"index\": 1, "+ "  \"schema\": {\"type\":\"record\", "+ " \"name\":\"result\", "+ "  \"fields\":[ {\"name\":\"member_id\",\"type\":\"int\"}, "+ "{\"name\":\"count\", \"type\":\"long\"} "+ "]"+ "}"+ " }');"," STORE sc INTO '" + output2 + " 'USING org.apache.pig.piggybank.storage.avro.AvroStorage ('index', '2');"};
  testAvroStorage(queries);
  verifyResults(output1,expected1);
  verifyResults(output2,expected2);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testRecordWithFieldSchema() throws IOException {
  PigSchema2Avro.setTupleIndex(1);
  String output=outbasedir + "testRecordWithFieldSchema";
  String expected=basedir + "expected_testRecordWithFieldSchema.avro";
  deleteDirectory(new File(output));
  String[] queries={" avro = LOAD '" + Util.encodeEscape(testRecordFile) + " ' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," avro1 = FILTER avro BY member_id > 1211;"," avro2 = FOREACH avro1 GENERATE member_id, browser_id, tracking_time, act_content ;"," STORE avro2 INTO '" + output + "' "+ " USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ "'{\"data\":  \""+ Util.encodeEscape(testRecordFile)+ "\" ,"+ "  \"field0\": \"int\", "+ " \"field1\":  \"def:browser_id\", "+ "  \"field3\": \"def:act_content\" "+ " }');"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testRecursiveRecordReference1() throws IOException {
  String output=outbasedir + "testRecursiveRecordReference1";
  String expected=basedir + "expected_testRecursiveRecordReference1.avro";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testRecursiveRecordInUnion) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," first = FOREACH in GENERATE $0 AS value;"," filtered = FILTER first BY value is not null;"," STORE filtered INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ " 'no_schema_check',"+ " 'schema', '\"int\"' );"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testRecursiveRecordInUnion() throws IOException {
  String output=outbasedir + "testRecursiveRecordInUnion";
  String expected=testRecursiveRecordInUnion;
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testRecursiveRecordInUnion) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ " 'no_schema_check',"+ " 'schema', '"+ recursiveRecordInUnion+ "' );"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testRecursiveRecordWithSame() throws IOException {
  String output=outbasedir + "testRecursiveRecordWithSame";
  String expected=testRecursiveRecordInUnion;
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testRecursiveRecordInUnion) + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ " 'no_schema_check',"+ " 'same', '"+ Util.encodeEscape(testRecursiveRecordInUnion)+ "' );"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testArrayWithSchema() throws IOException {
  String output=outbasedir + "testArrayWithSchema";
  String expected=basedir + "expected_testArrayWithSchema.avro";
  deleteDirectory(new File(output));
  String[] queries={" in = LOAD '" + Util.encodeEscape(testArrayFile) + " ' USING org.apache.pig.piggybank.storage.avro.AvroStorage ();"," STORE in INTO '" + output + "' USING org.apache.pig.piggybank.storage.avro.AvroStorage ( "+ "   'schema', '{\"type\":\"array\",\"items\":\"float\"}'  );"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testRecordWithFieldSchemaFromTextWithSchemaFile() throws IOException {
  PigSchema2Avro.setTupleIndex(1);
  String output=outbasedir + "testRecordWithFieldSchemaFromTextWithSchemaFile";
  String expected=basedir + "expected_testRecordWithFieldSchema.avro";
  deleteDirectory(new File(output));
  String[] queries={" avro = LOAD '" + Util.encodeEscape(testTextFile) + "' AS (member_id:int, browser_id:chararray, tracking_time:long, act_content:bag{inner:tuple(key:chararray, value:chararray)});"," avro1 = FILTER avro BY member_id > 1211;"," avro2 = FOREACH avro1 GENERATE member_id, browser_id, tracking_time, act_content ;"," STORE avro2 INTO '" + output + "' "+ " USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ "'{\"schema_file\":  \""+ Util.encodeEscape(testRecordSchema)+ "\" ,"+ "  \"field0\": \"int\", "+ " \"field1\":  \"def:browser_id\", "+ "  \"field3\": \"def:act_content\" "+ " }');"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDefaultValueSchemaWrite() throws IOException {
  String output=outbasedir + "testDefaultValueSchemaWrite";
  String expected=basedir + "expected_testDefaultSchemaWrite.avro";
  Data data=resetData(pigServerLocal);
  data.set("testDefaultValueSchemaWrite",tuple(0,115,115000,115000.1),tuple(1,116,116000,116000.1),tuple(2,117,117000,117000.1),tuple(3,118,118000,118000.1),tuple(4,119,119000,119000.1));
  deleteDirectory(new File(output));
  String[] queries={" a = LOAD 'testDefaultValueSchemaWrite' USING mock.Storage as  " + " (id: int, intval:int, longval:long, floatval:float);"," b = foreach a generate id, longval, floatval;"," c = order b by id;"," STORE c INTO '" + output + "' USING "+ " org.apache.pig.piggybank.storage.avro.AvroStorage (' { \"debug\" : 5, \"schema\" : "+ " {  \"name\" : \"rmyrecord\", \"type\" : \"record\",  \"fields\" : [ { \"name\" : \"id\", "+ " \"type\" : \"int\" , \"default\" : 0 }, {  \"name\" : \"longval\",  \"type\" : \"long\","+ " \"default\" : 0 }, { \"name\" : \"floatval\", \"type\" : \"float\", \"default\" : 1.0 } ] } } "+ " ');"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testRecordWithFieldSchemaFromText() throws IOException {
  PigSchema2Avro.setTupleIndex(1);
  String output=outbasedir + "testRecordWithFieldSchemaFromText";
  String expected=basedir + "expected_testRecordWithFieldSchema.avro";
  deleteDirectory(new File(output));
  String[] queries={" avro = LOAD '" + Util.encodeEscape(testTextFile) + "' AS (member_id:int, browser_id:chararray, tracking_time:long, act_content:bag{inner:tuple(key:chararray, value:chararray)});"," avro1 = FILTER avro BY member_id > 1211;"," avro2 = FOREACH avro1 GENERATE member_id, browser_id, tracking_time, act_content ;"," STORE avro2 INTO '" + output + "' "+ " USING org.apache.pig.piggybank.storage.avro.AvroStorage ("+ "'{\"data\":  \""+ Util.encodeEscape(testRecordFile)+ "\" ,"+ "  \"field0\": \"int\", "+ " \"field1\":  \"def:browser_id\", "+ "  \"field3\": \"def:act_content\" "+ " }');"};
  testAvroStorage(queries);
  verifyResults(output,expected);
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
