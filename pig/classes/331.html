<h3 style="margin:0px">Class: org.apache.pig.test.TestTypeCheckingValidatorNewLP (142 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(96)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(30)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(29)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(13)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(11)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(10)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(9)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="12"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('12')" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution"><kbd id="tag-12"class="label-info"style="display: inline-block;font-size:7pt" >ExceptionVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGroupLineageStar() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (name, age, gpa);" + "b = group a by *;" + "c = foreach b generate flatten(group);"+ "d = foreach c generate $0 + 1;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')");
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupProjectStarLineageNoSchema() throws Throwable {
  String query="a = load 'a' using PigStorage('a');" + "b = load 'b' using org.apache.pig.test.PigStorageWithDifferentCaster('b');" + "c = cogroup a by $0, b by $0;"+ "d = foreach c generate *;"+ "f = foreach d generate group, flatten(a), flatten(b) ;"+ "g = foreach f generate $0, $1 + 1, $2 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,null,1);
  checkLastForeachCastLoadFunc(query,null,2);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUnionLineageNoSchemaDiffLoadFunc() throws Throwable {
  String query="a = load 'a' using PigStorage('a');" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b');" + "c = union a , b;"+ "d = foreach c generate $1 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,null);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupLineageFail() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b') as (field4, field5, field6: chararray );" + "c = cogroup a by field1, b by field4;"+ "d = foreach c generate group, flatten(a), flatten(b) ;"+ "e = foreach d generate group + 1, field1 + 1, field4 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,null,0);
  checkLastForeachCastLoadFunc(query,"PigStorage('a')",1);
  checkLastForeachCastLoadFunc(query,"org.apache.pig.test.PigStorageWithDifferentCaster('b')",2);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMapLookupLineage3() throws Throwable {
  String query="a= load 'a' as (s, m, l);" + "b = foreach a generate flatten(l#'viewinfo') as viewinfo;" + "c = foreach b generate viewinfo#'pos' as position;";
  checkLastForeachCastLoadFunc(query,"org.apache.pig.builtin.PigStorage",0);
  query+="d = foreach c generate (chararray)position;";
  checkLastForeachCastLoadFunc(query,"org.apache.pig.builtin.PigStorage",0);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testJoinLineageNoSchema() throws Throwable {
  String query="a = load 'a' using PigStorage('a');" + "b = load 'a' using PigStorage('a');" + "c = join a by $0, b by $0;"+ "d = foreach c generate $1 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')",0);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMapCastLineage() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1 : map[], field2: float );" + "b = foreach a generate (map[int])field1;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')");
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test nested foreach with sort
 * @throws Throwable
 */
@Test public void testNestedSort() throws Throwable {
  String query="a = load 'x';" + "b = group a by $0;" + "c = foreach b "+ "       {c1 = order $1 by $1; generate $0 + 1, flatten(c1); };";
  checkLastForeachCastLoadFunc(query,"org.apache.pig.builtin.PigStorage");
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGroupLineageStarNoSchema() throws Throwable {
  String query="a = load 'a' using PigStorage('a');" + "b = group a by *;" + "c = foreach b generate flatten(group);"+ "d = foreach c generate $0 + 1;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')");
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCompareEqualityMapIntegerFail() throws Throwable {
  String query="a = load 'a' as (t1 :map[], t2 : int);" + "b = filter a by t1 == t2;";
  String exMsg="In alias b, incompatible types in Equal " + "Operator left hand side:map right hand side:int";
  checkExceptionMessage(query,"b",exMsg);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCrossLineageNoSchemaFail() throws Throwable {
  String query="a = load 'a' using PigStorage('a');" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b');" + "c = cross a , b;"+ "d = foreach c generate $1 + 2.0 ;";
  checkWarning(query,CAST_LOAD_NOT_FOUND);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testStreamingLineage1() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1: int, field2: float, field3: chararray );" + "b = stream a through `" + simpleEchoStreamingCommand + "`;"+ "c = foreach b generate $1 + 1.0;";
  checkLastForeachCastLoadFunc(query,"org.apache.pig.builtin.PigStreaming",0);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testFilterWithInnerPlan3() throws Throwable {
  printCurrentMethodName();
  LogicalPlan plan=new LogicalPlan();
  String pigStorage=PigStorage.class.getName();
  LOLoad load1=newLOLoad(new FileSpec("pi",new FuncSpec(pigStorage)),null,plan,new Configuration(ConfigurationUtil.toConfiguration(pc.getFs().getConfiguration())));
  Schema inputSchema1=null;
{
    List<FieldSchema> fsList1=new ArrayList<FieldSchema>();
    fsList1.add(new FieldSchema("field1",DataType.INTEGER));
    fsList1.add(new FieldSchema("field2",DataType.LONG));
    inputSchema1=new Schema(fsList1);
  }
  load1.setScriptSchema(org.apache.pig.newplan.logical.Util.translateSchema((inputSchema1)));
  LogicalExpressionPlan innerPlan=new LogicalExpressionPlan();
  LOFilter filter1=new LOFilter(plan);
  filter1.setFilterPlan(innerPlan);
  ProjectExpression project1=new ProjectExpression(innerPlan,0,0,filter1);
  ProjectExpression project2=new ProjectExpression(innerPlan,0,1,filter1);
  AddExpression add1=new AddExpression(innerPlan,project1,project2);
  plan.add(load1);
  plan.add(filter1);
  plan.connect(load1,filter1);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingRelVisitor typeChecker=new TypeCheckingRelVisitor(plan,collector);
  try {
    typeChecker.visit();
  }
 catch (  Exception t) {
  }
  printMessageCollector(collector);
  if (!collector.hasError()) {
    throw new AssertionError("Expect error");
  }
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUnionLineageDifferentSchemaFail() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b') as (field4, field5, field6: chararray, field7 );" + "c = union a , b;"+ "d = foreach c generate $3 + 2.0 ;";
  checkWarning(query,CAST_LOAD_NOT_FOUND);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testSortWithInnerPlan3() throws Throwable {
  printCurrentMethodName();
  LogicalPlan plan=new LogicalPlan();
  String pigStorage=PigStorage.class.getName();
  LOLoad load1=newLOLoad(new FileSpec("pi",new FuncSpec(pigStorage)),null,plan,new Configuration(ConfigurationUtil.toConfiguration(pc.getFs().getConfiguration())));
  Schema inputSchema1=null;
{
    List<FieldSchema> fsList1=new ArrayList<FieldSchema>();
    fsList1.add(new FieldSchema("field1",DataType.BYTEARRAY));
    fsList1.add(new FieldSchema("field2",DataType.INTEGER));
    inputSchema1=new Schema(fsList1);
  }
  load1.setScriptSchema(org.apache.pig.newplan.logical.Util.translateSchema((inputSchema1)));
  ;
  LOSort sort1=new LOSort(plan);
  LogicalExpressionPlan innerPlan1=new LogicalExpressionPlan();
  ProjectExpression project11=new ProjectExpression(innerPlan1,0,0,sort1);
  ProjectExpression project12=new ProjectExpression(innerPlan1,0,1,sort1);
  MultiplyExpression mul1=new MultiplyExpression(innerPlan1,project11,project12);
  LogicalExpressionPlan innerPlan2=new LogicalExpressionPlan();
  ProjectExpression project21=new ProjectExpression(innerPlan2,0,0,sort1);
  ConstantExpression const21=new ConstantExpression(innerPlan2,"26");
  ModExpression mod21=new ModExpression(innerPlan2,project21,const21);
  List<LogicalExpressionPlan> innerPlans=new ArrayList<LogicalExpressionPlan>();
  innerPlans.add(innerPlan1);
  innerPlans.add(innerPlan2);
  List<Boolean> ascList=new ArrayList<Boolean>();
  ascList.add(true);
  ascList.add(true);
  sort1.setAscendingCols(ascList);
  sort1.setSortColPlans(innerPlans);
  plan.add(load1);
  plan.add(sort1);
  plan.connect(load1,sort1);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingRelVisitor typeChecker=new TypeCheckingRelVisitor(plan,collector);
  try {
    typeChecker.visit();
    fail("Error expected");
  }
 catch (  Exception t) {
  }
  printMessageCollector(collector);
  if (!collector.hasError()) {
    throw new AssertionError("Error expected");
  }
}

</code></pre>

<pre class="type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testExpressionTypeChecking8() throws Throwable {
  LogicalExpressionPlan plan=new LogicalExpressionPlan();
  TupleFactory tupleFactory=TupleFactory.getInstance();
  ArrayList innerObjList=new ArrayList();
  ArrayList objList=new ArrayList();
  innerObjList.add(10);
  innerObjList.add(3);
  innerObjList.add(7);
  innerObjList.add(17);
  Tuple innerTuple=tupleFactory.newTuple(innerObjList);
  objList.add("World");
  objList.add(42);
  objList.add(innerTuple);
  Tuple tuple=tupleFactory.newTuple(objList);
  ArrayList<Schema.FieldSchema> innerFss=new ArrayList<Schema.FieldSchema>();
  ArrayList<Schema.FieldSchema> fss=new ArrayList<Schema.FieldSchema>();
  ArrayList<Schema.FieldSchema> castFss=new ArrayList<Schema.FieldSchema>();
  Schema.FieldSchema stringFs=new Schema.FieldSchema(null,DataType.CHARARRAY);
  Schema.FieldSchema intFs=new Schema.FieldSchema(null,DataType.INTEGER);
  for (int i=0; i < innerObjList.size(); ++i) {
    innerFss.add(intFs);
  }
  Schema innerTupleSchema=new Schema(innerFss);
  fss.add(stringFs);
  fss.add(intFs);
  fss.add(new Schema.FieldSchema(null,innerTupleSchema,DataType.TUPLE));
  Schema tupleSchema=new Schema(fss);
  Schema.FieldSchema byteArrayFs=new Schema.FieldSchema(null,DataType.BYTEARRAY);
  for (int i=0; i < 4; ++i) {
    castFss.add(byteArrayFs);
  }
  Schema castSchema=new Schema(castFss);
  ConstantExpression constant1=new ConstantExpression(plan,innerTuple);
  ConstantExpression constant2=new ConstantExpression(plan,tuple);
  CastExpression cast1=new CastExpression(plan,constant1,org.apache.pig.newplan.logical.Util.translateFieldSchema(new FieldSchema(null,castSchema,DataType.TUPLE)));
  EqualExpression equal1=new EqualExpression(plan,cast1,constant2);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  LogicalRelationalOperator dummyRelOp=createDummyRelOpWithAlias();
  TypeCheckingExpVisitor expTypeChecker=new TypeCheckingExpVisitor(plan,collector,dummyRelOp);
  expTypeChecker.visit();
  printMessageCollector(collector);
  if (collector.hasError()) {
    throw new Exception("Error during type checking");
  }
  assertEquals(DataType.BOOLEAN,equal1.getType());
  assertEquals(DataType.TUPLE,equal1.getRhs().getType());
  assertEquals(DataType.TUPLE,equal1.getLhs().getType());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupStreamingLineage() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = stream a through `" + simpleEchoStreamingCommand + "` as (field4, field5, field6: chararray);"+ "c = cogroup a by field1, b by field4;"+ "d = foreach c generate group, flatten(a), flatten(b) ;"+ "e = foreach d generate group, field1 + 1, field4 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')",1);
  checkLastForeachCastLoadFunc(query,"org.apache.pig.builtin.PigStreaming",2);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUnionLineageMixSchema() throws Throwable {
  String query="a = load 'a' using PigStorage('x') as (field1, field2: float, field3: chararray );" + "b = load 'a' using PigStorage('x');" + "c = union a , b;"+ "d = foreach c generate $3 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,"PigStorage('x')");
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testExpressionTypeCheckingFail11() throws Throwable {
  LogicalExpressionPlan plan=new LogicalExpressionPlan();
  ConstantExpression constant0=new ConstantExpression(plan,new DateTime(0L));
  ConstantExpression constant1=new ConstantExpression(plan,new String("1970-01-01T00:00:00.000Z"));
  CastExpression cast1=new CastExpression(plan,constant1,createFS(DataType.CHARARRAY));
  EqualExpression eq1=new EqualExpression(plan,constant0,cast1);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingExpVisitor expTypeChecker=new TypeCheckingExpVisitor(plan,collector,null);
  try {
    expTypeChecker.visit();
    fail("Exception expected");
  }
 catch (  TypeCheckerException pve) {
  }
  printMessageCollector(collector);
  if (!collector.hasError()) {
    throw new Exception("Error during type checking");
  }
}

</code></pre>

<pre class="type-8 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testExpressionTypeCheckingFail4() throws Throwable {
  LogicalExpressionPlan plan=new LogicalExpressionPlan();
  ConstantExpression constant1=new ConstantExpression(plan,10);
  ConstantExpression constant2=new ConstantExpression(plan,20D);
  ConstantExpression constant3=new ConstantExpression(plan,"123");
  DivideExpression div1=new DivideExpression(plan,constant1,constant2);
  CastExpression cast1=new CastExpression(plan,constant3,createFS(DataType.BYTEARRAY));
  NotEqualExpression notequal1=new NotEqualExpression(plan,div1,cast1);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingExpVisitor expTypeChecker=new TypeCheckingExpVisitor(plan,collector,null);
  try {
    expTypeChecker.visit();
    fail("Exception expected");
  }
 catch (  TypeCheckerException pve) {
  }
  printMessageCollector(collector);
  if (!collector.hasError()) {
    fail("Error during type checking");
  }
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testDistinct1() throws Throwable {
  printCurrentMethodName();
  LogicalPlan plan=new LogicalPlan();
  String pigStorage=PigStorage.class.getName();
  LOLoad load1=newLOLoad(new FileSpec("pi",new FuncSpec(pigStorage)),null,plan,new Configuration(ConfigurationUtil.toConfiguration(pc.getFs().getConfiguration())));
  Schema inputSchema1=null;
{
    List<FieldSchema> innerList=new ArrayList<FieldSchema>();
    innerList.add(new FieldSchema("innerfield1",DataType.BAG));
    innerList.add(new FieldSchema("innerfield2",DataType.FLOAT));
    Schema innerSchema=new Schema(innerList);
    List<FieldSchema> fsList1=new ArrayList<FieldSchema>();
    fsList1.add(new FieldSchema("field1",DataType.INTEGER));
    fsList1.add(new FieldSchema("field2",DataType.BYTEARRAY));
    fsList1.add(new FieldSchema("field3",innerSchema));
    fsList1.add(new FieldSchema("field4",DataType.BAG));
    inputSchema1=new Schema(fsList1);
  }
  load1.setSchema(org.apache.pig.newplan.logical.Util.translateSchema(inputSchema1));
  LODistinct distinct1=new LODistinct(plan);
  plan.add(load1);
  plan.add(distinct1);
  plan.connect(load1,distinct1);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingRelVisitor typeChecker=new TypeCheckingRelVisitor(plan,collector);
  typeChecker.visit();
  printMessageCollector(collector);
  LogicalSchema outputSchema=distinct1.getSchema();
  assertTrue(load1.getSchema().isEqual(outputSchema));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testBagDereference() throws FrontendException {
  String query="a= load '1.txt' as (a0);" + "b = foreach a generate flatten((bag{tuple(map[])})a0) as b0:map[];" + "c = foreach b generate (long)b0#'key1';";
  LogicalPlan plan=createAndProcessLPlan(query);
  checkLoaderInCasts(plan,PigStorage.class.getName());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupProjectStarLineageMixSchema() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = load 'b' using org.apache.pig.test.PigStorageWithDifferentCaster();" + "c = cogroup a by field1, b by $0;"+ "d = foreach c generate *;"+ "f = foreach d generate group, flatten(a), flatten(b) ;"+ "g = foreach f generate $0, $1 + 1, $4 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,null,1);
  checkLastForeachCastLoadFunc(query,null,2);
}

</code></pre>

<pre class="type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testLineage1NoSchema() throws Throwable {
  String query="a = load 'a';" + "b = foreach a generate $1 + 1.0;";
  CastExpression cast=getCastFromLastForeach(query);
  assertTrue(cast.getFuncSpec().getClassName().startsWith("org.apache.pig.builtin.PigStorage"));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupDistinctLineage() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b') as (field4, field5, field6: chararray );" + "c = cogroup a by field1, b by field4;"+ "d = foreach c generate group, flatten(a), flatten(b) ;"+ "e = distinct d;"+ "f = foreach e generate group, field1 + 1, field4 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')",1);
  checkLastForeachCastLoadFunc(query,"org.apache.pig.test.PigStorageWithDifferentCaster('b')",2);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupStarLineageNoSchemaFail() throws Throwable {
  String query="a = load 'a' using PigStorage('x');" + "b = load 'b' using PigStorage('x');" + "c = cogroup a by *, b by *;";
  String exMsg="Cogroup/Group by '*' or 'x..' " + "(range of columns to the end) " + "is only allowed if the input has a schema";
  checkExceptionMessage(query,"c",exMsg);
}

</code></pre>

<pre class="type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testExpressionTypeChecking1() throws Throwable {
  LogicalExpressionPlan expPlan=new LogicalExpressionPlan();
  ConstantExpression constant1=new ConstantExpression(expPlan,10);
  ConstantExpression constant2=new ConstantExpression(expPlan,20D);
  ConstantExpression constant3=new ConstantExpression(expPlan,123f);
  AddExpression add1=new AddExpression(expPlan,constant1,constant2);
  CastExpression cast1=new CastExpression(expPlan,constant3,createFS(DataType.DOUBLE));
  MultiplyExpression mul1=new MultiplyExpression(expPlan,add1,cast1);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingExpVisitor expTypeChecker=new TypeCheckingExpVisitor(expPlan,collector,null);
  expTypeChecker.visit();
  printMessageCollector(collector);
  if (collector.hasError()) {
    throw new Exception("Error during type checking");
  }
  assertEquals(DataType.DOUBLE,add1.getType());
  assertEquals(DataType.DOUBLE,mul1.getType());
  assertEquals(DataType.DOUBLE,add1.getLhs().getType());
  assertEquals(DataType.DOUBLE,mul1.getRhs().getType());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupLimitLineageNoSchema() throws Throwable {
  String query="a = load 'a' using PigStorage('a');" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b');" + "c = cogroup a by $0, b by $0;"+ "d = foreach c generate group, flatten(a), flatten(b) ;"+ "e = limit d 100;"+ "f = foreach e generate $0, $1 + 1, $2 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,null,1);
  checkLastForeachCastLoadFunc(query,null,2);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupTopKLineageNoSchema() throws Throwable {
  String query="a = load 'a' using PigStorage('a');" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b');" + "c = cogroup a by $0, b by $0;"+ "d = foreach c generate group, flatten(a), flatten(b) ;"+ "e = order d by $2 desc;"+ "f = limit e 100;"+ "g = foreach f generate $0, $1 + 1, $2 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,null,1);
  checkLastForeachCastLoadFunc(query,null,2);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCompareMapFail() throws Throwable {
  String query="a = load 'a' as (t1 :map[], t2 : map[]);" + "b = filter a by t1 <= t2;";
  String exMsg="In alias b, incompatible types in LessThanEqual " + "Operator left hand side:map right hand side:map";
  checkExceptionMessage(query,"b",exMsg);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupSortStarLineageNoSchema() throws Throwable {
  String query="a = load 'a' using PigStorage('a');" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b');" + "c = cogroup a by $0, b by $0;"+ "d = foreach c generate group, flatten(a), flatten(b) ;"+ "e = order d by * desc;"+ "f = foreach e generate $0, $1 + 1, $2 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,null,1);
  checkLastForeachCastLoadFunc(query,null,2);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupLineage2NoSchema() throws Throwable {
  String query="a = load 'a' using PigStorage('a');" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b');" + "c = cogroup a by $0, b by $0;"+ "d = foreach c generate group, flatten(a), flatten(b) ;"+ "e = foreach d generate $0, $1 + 1, $2 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,null,1);
  checkLastForeachCastLoadFunc(query,null,2);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testFilterWithInnerPlan2() throws Throwable {
  testFilterWithInnerPlan(DataType.INTEGER,DataType.BYTEARRAY);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupStreamingLineageNoSchema() throws Throwable {
  String query="a = load 'a' using PigStorage('a');" + "b = stream a through `" + simpleEchoStreamingCommand + "`;"+ "c = cogroup a by $0, b by $0;"+ "d = foreach c generate group, flatten(a), flatten(b) ;"+ "e = foreach d generate $0, $1 + 1, $2 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')",1);
  checkLastForeachCastLoadFunc(query,"PigStorage('a')",2);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUDFNoInnerSchema() throws FrontendException {
  String query="a= load '1.txt';" + "b = foreach a generate " + TestUDFTupleNullInnerSchema.class.getName() + "($0);"+ "c = foreach b generate flatten($0);"+ "d = foreach c generate $0 + 1;";
  checkLastForeachCastLoadFunc(query,null,0);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupSortLineageNoSchema() throws Throwable {
  String query="a = load 'a' using PigStorage('a');" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b');" + "c = cogroup a by $0, b by $0;"+ "d = foreach c generate group, flatten(a), flatten(b) ;"+ "e = order d by $2 desc;"+ "f = foreach e generate $0, $1 + 1, $2 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,null,1);
  checkLastForeachCastLoadFunc(query,null,2);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testExpressionTypeCheckingFail10() throws Throwable {
  LogicalExpressionPlan plan=new LogicalExpressionPlan();
  ConstantExpression constant1=new ConstantExpression(plan,10);
  ConstantExpression constant2=new ConstantExpression(plan,20L);
  ConstantExpression constant3=new ConstantExpression(plan,"true");
  GreaterThanExpression gt1=new GreaterThanExpression(plan,constant1,constant2);
  CastExpression cast1=new CastExpression(plan,constant3,createFS(DataType.BYTEARRAY));
  EqualExpression equal1=new EqualExpression(plan,gt1,cast1);
  NotEqualExpression nq1=new NotEqualExpression(plan,gt1,cast1);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingExpVisitor expTypeChecker=new TypeCheckingExpVisitor(plan,collector,null);
  try {
    expTypeChecker.visit();
    fail("Exception expected");
  }
 catch (  TypeCheckerException pve) {
  }
  printMessageCollector(collector);
  if (!collector.hasError()) {
    throw new Exception("Error during type checking");
  }
}

</code></pre>

<pre class="type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSortWithInnerPlan2() throws Throwable {
  printCurrentMethodName();
  LogicalPlan plan=new LogicalPlan();
  String pigStorage=PigStorage.class.getName();
  LOLoad load1=newLOLoad(new FileSpec("pi",new FuncSpec(pigStorage)),null,plan,new Configuration(ConfigurationUtil.toConfiguration(pc.getFs().getConfiguration())));
  Schema inputSchema1=null;
{
    List<FieldSchema> fsList1=new ArrayList<FieldSchema>();
    fsList1.add(new FieldSchema("field1",DataType.BYTEARRAY));
    fsList1.add(new FieldSchema("field2",DataType.INTEGER));
    inputSchema1=new Schema(fsList1);
  }
  load1.setScriptSchema(org.apache.pig.newplan.logical.Util.translateSchema((inputSchema1)));
  ;
  LOSort sort1=new LOSort(plan);
  LogicalExpressionPlan innerPlan1=new LogicalExpressionPlan();
  ProjectExpression project11=new ProjectExpression(innerPlan1,0,0,sort1);
  ProjectExpression project12=new ProjectExpression(innerPlan1,0,1,sort1);
  MultiplyExpression mul1=new MultiplyExpression(innerPlan1,project11,project12);
  LogicalExpressionPlan innerPlan2=new LogicalExpressionPlan();
  ProjectExpression project21=new ProjectExpression(innerPlan2,0,0,sort1);
  ConstantExpression const21=new ConstantExpression(innerPlan2,26L);
  ModExpression mod21=new ModExpression(innerPlan2,project21,const21);
  List<LogicalExpressionPlan> innerPlans=new ArrayList<LogicalExpressionPlan>();
  innerPlans.add(innerPlan1);
  innerPlans.add(innerPlan2);
  List<Boolean> ascList=new ArrayList<Boolean>();
  ascList.add(true);
  ascList.add(true);
  sort1.setAscendingCols(ascList);
  sort1.setSortColPlans(innerPlans);
  plan.add(load1);
  plan.add(sort1);
  plan.connect(load1,sort1);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingRelVisitor typeChecker=new TypeCheckingRelVisitor(plan,collector);
  typeChecker.visit();
  printMessageCollector(collector);
  if (collector.hasError()) {
    throw new AssertionError("Expect no error");
  }
  LogicalSchema endResultSchema=sort1.getSchema();
  assertEquals(DataType.BYTEARRAY,endResultSchema.getField(0).type);
  assertEquals(DataType.INTEGER,endResultSchema.getField(1).type);
  assertEquals(DataType.INTEGER,getSingleOutput(innerPlan1).getType());
  assertEquals(DataType.LONG,getSingleOutput(innerPlan2).getType());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testExpressionTypeChecking9() throws Throwable {
  LogicalExpressionPlan plan=new LogicalExpressionPlan();
  TupleFactory tupleFactory=TupleFactory.getInstance();
  ArrayList innerObjList=new ArrayList();
  ArrayList objList=new ArrayList();
  innerObjList.add("10");
  innerObjList.add("3");
  innerObjList.add(7);
  innerObjList.add("17");
  Tuple innerTuple=tupleFactory.newTuple(innerObjList);
  objList.add("World");
  objList.add(42);
  objList.add(innerTuple);
  Tuple tuple=tupleFactory.newTuple(objList);
  ArrayList<Schema.FieldSchema> innerFss=new ArrayList<Schema.FieldSchema>();
  ArrayList<Schema.FieldSchema> fss=new ArrayList<Schema.FieldSchema>();
  ArrayList<Schema.FieldSchema> castFss=new ArrayList<Schema.FieldSchema>();
  Schema.FieldSchema stringFs=new Schema.FieldSchema(null,DataType.CHARARRAY);
  Schema.FieldSchema intFs=new Schema.FieldSchema(null,DataType.INTEGER);
  Schema.FieldSchema doubleFs=new Schema.FieldSchema(null,DataType.DOUBLE);
  innerFss.add(stringFs);
  innerFss.add(stringFs);
  innerFss.add(intFs);
  innerFss.add(stringFs);
  Schema innerTupleSchema=new Schema(innerFss);
  fss.add(stringFs);
  fss.add(intFs);
  fss.add(new Schema.FieldSchema(null,innerTupleSchema,DataType.TUPLE));
  Schema tupleSchema=new Schema(fss);
  castFss.add(stringFs);
  castFss.add(stringFs);
  castFss.add(doubleFs);
  castFss.add(intFs);
  Schema castSchema=new Schema(castFss);
  ConstantExpression constant1=new ConstantExpression(plan,innerTuple);
  ConstantExpression constant2=new ConstantExpression(plan,tuple);
  CastExpression cast1=new CastExpression(plan,constant1,org.apache.pig.newplan.logical.Util.translateFieldSchema(new FieldSchema(null,castSchema,DataType.TUPLE)));
  EqualExpression equal1=new EqualExpression(plan,cast1,constant2);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  LogicalRelationalOperator dummyRelOp=createDummyRelOpWithAlias();
  TypeCheckingExpVisitor expTypeChecker=new TypeCheckingExpVisitor(plan,collector,dummyRelOp);
  expTypeChecker.visit();
  printMessageCollector(collector);
  if (collector.hasError()) {
    throw new Exception("Error expected");
  }
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCoGroupComplex() throws Exception {
  String query="l1 = load 'x' using PigStorage(':') as (a : (i : int),b,c);" + "l2 = load 'x' as (a,b,c);" + "cg = cogroup l1 by a, l2 by a;";
  createAndProcessLPlan(query);
}

</code></pre>

<pre class="type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testForEachGenerate1() throws Throwable {
  printCurrentMethodName();
  LogicalPlan plan=new LogicalPlan();
  LOLoad load1=genDummyLOLoadNewLP(plan);
  Schema inputSchema1=null;
{
    List<FieldSchema> fsList1=new ArrayList<FieldSchema>();
    fsList1.add(new FieldSchema("field1a",DataType.INTEGER));
    fsList1.add(new FieldSchema("field2a",DataType.LONG));
    inputSchema1=new Schema(fsList1);
  }
  load1.setScriptSchema(org.apache.pig.newplan.logical.Util.translateSchema((inputSchema1)));
  ;
  LogicalPlan innerRelPlan=new LogicalPlan();
  LOForEach foreach1=new LOForEach(plan);
  foreach1.setInnerPlan(innerRelPlan);
  LOGenerate loGen=new LOGenerate(innerRelPlan);
  innerRelPlan.add(loGen);
  LOInnerLoad innerLoad1=new LOInnerLoad(innerRelPlan,foreach1,0);
  innerRelPlan.add(innerLoad1);
  innerRelPlan.connect(innerLoad1,loGen);
  LogicalExpressionPlan innerPlan1=new LogicalExpressionPlan();
  ProjectExpression project11=new ProjectExpression(innerPlan1,0,0,loGen);
  ConstantExpression const11=new ConstantExpression(innerPlan1,26F);
  SubtractExpression subtract11=new SubtractExpression(innerPlan1,project11,const11);
  LogicalExpressionPlan innerPlan2=new LogicalExpressionPlan();
  LOInnerLoad innerLoad2=new LOInnerLoad(innerRelPlan,foreach1,0);
  innerRelPlan.add(innerLoad2);
  innerRelPlan.connect(innerLoad2,loGen);
  ProjectExpression project21=new ProjectExpression(innerPlan2,1,0,loGen);
  LOInnerLoad innerLoad3=new LOInnerLoad(innerRelPlan,foreach1,1);
  innerRelPlan.add(innerLoad3);
  innerRelPlan.connect(innerLoad3,loGen);
  ProjectExpression project22=new ProjectExpression(innerPlan2,2,0,loGen);
  AddExpression add21=new AddExpression(innerPlan2,project21,project22);
  ArrayList<LogicalExpressionPlan> generatePlans=new ArrayList<LogicalExpressionPlan>();
  generatePlans.add(innerPlan1);
  generatePlans.add(innerPlan2);
  boolean[] flattens={true,false};
  loGen.setFlattenFlags(flattens);
  loGen.setOutputPlans(generatePlans);
  plan.add(load1);
  plan.add(foreach1);
  plan.connect(load1,foreach1);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingRelVisitor typeChecker=new TypeCheckingRelVisitor(plan,collector);
  typeChecker.visit();
  printMessageCollector(collector);
  if (collector.hasError()) {
    throw new AssertionError("Expect no error");
  }
  LogicalSchema endResultSchema=foreach1.getSchema();
  assertEquals(DataType.FLOAT,endResultSchema.getField(0).type);
  assertEquals(DataType.LONG,endResultSchema.getField(1).type);
}

</code></pre>

<pre class="type-7 type-6 type-4 type-5 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUnionCastingInsert2() throws Throwable {
  printCurrentMethodName();
  LogicalPlan plan=new LogicalPlan();
  String pigStorage=PigStorage.class.getName();
  LOLoad load1=newLOLoad(new FileSpec("pi",new FuncSpec(pigStorage)),null,plan,new Configuration(ConfigurationUtil.toConfiguration(pc.getFs().getConfiguration())));
  LOLoad load2=newLOLoad(new FileSpec("pi",new FuncSpec(pigStorage)),null,plan,new Configuration(ConfigurationUtil.toConfiguration(pc.getFs().getConfiguration())));
  Schema inputSchema1=null;
{
    List<FieldSchema> fsList1=new ArrayList<FieldSchema>();
    fsList1.add(new FieldSchema("field1a",DataType.INTEGER));
    fsList1.add(new FieldSchema("field2a",DataType.BYTEARRAY));
    inputSchema1=new Schema(fsList1);
  }
  Schema inputSchema2=null;
{
    List<FieldSchema> fsList2=new ArrayList<FieldSchema>();
    fsList2.add(new FieldSchema("field1b",DataType.DOUBLE));
    fsList2.add(new FieldSchema("field2b",DataType.DOUBLE));
    inputSchema2=new Schema(fsList2);
  }
  load1.setScriptSchema(org.apache.pig.newplan.logical.Util.translateSchema(inputSchema1));
  load2.setScriptSchema(org.apache.pig.newplan.logical.Util.translateSchema(inputSchema2));
  ArrayList<LogicalRelationalOperator> inputList=new ArrayList<LogicalRelationalOperator>();
  inputList.add(load1);
  inputList.add(load2);
  LOUnion union=new LOUnion(plan,false);
  plan.add(load1);
  plan.add(load2);
  plan.add(union);
  plan.connect(load1,union);
  plan.connect(load2,union);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingRelVisitor typeChecker=new TypeCheckingRelVisitor(plan,collector);
  typeChecker.visit();
  printMessageCollector(collector);
  Schema outputSchema=org.apache.pig.newplan.logical.Util.translateSchema(union.getSchema());
  Schema expectedSchema=null;
{
    List<FieldSchema> fsListExpected=new ArrayList<FieldSchema>();
    fsListExpected.add(new FieldSchema("field1a",DataType.DOUBLE));
    fsListExpected.add(new FieldSchema("field2a",DataType.DOUBLE));
    expectedSchema=new Schema(fsListExpected);
  }
  assertTrue(Schema.equals(outputSchema,expectedSchema,true,false));
{
    List<Operator> sucList1=plan.getSuccessors(load1);
    assertEquals(1,sucList1.size());
    LOForEach foreach=(LOForEach)sucList1.get(0);
    assertTrue(foreach instanceof LOForEach);
    List<Operator> sucList2=plan.getSuccessors(foreach);
    assertEquals(1,sucList2.size());
    assertTrue(sucList2.get(0) instanceof LOUnion);
    checkForEachCasting(foreach,0,true,DataType.DOUBLE);
    checkForEachCasting(foreach,1,true,DataType.DOUBLE);
  }
{
    List<Operator> sucList1=plan.getSuccessors(load2);
    assertEquals(1,sucList1.size());
    assertTrue(sucList1.get(0) instanceof LOUnion);
  }
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUnionLineageMixSchemaFail() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b');" + "c = union a , b;"+ "d = foreach c generate $3 + 2.0 ;";
  checkWarning(query,CAST_LOAD_NOT_FOUND);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSplitLineage1NoSchema() throws Throwable {
  String query="a = load 'a';" + "split a into b if $0 > 1.0, c if $1 <= 1.0;" + "d = foreach b generate $1 + 1.0;"+ "e = foreach c generate $1 + 1.0;";
  LogicalPlan plan=createAndProcessLPlan(query);
  checkLoaderInCasts(plan,"org.apache.pig.builtin.PigStorage");
}

</code></pre>

<pre class="type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testExpressionTypeChecking2() throws Throwable {
  LogicalExpressionPlan plan=new LogicalExpressionPlan();
  ConstantExpression constant1=new ConstantExpression(plan,10);
  ConstantExpression constant2=new ConstantExpression(plan,new DataByteArray());
  ConstantExpression constant3=new ConstantExpression(plan,123L);
  ConstantExpression constant4=new ConstantExpression(plan,true);
  SubtractExpression sub1=new SubtractExpression(plan,constant1,constant2);
  GreaterThanExpression gt1=new GreaterThanExpression(plan,sub1,constant3);
  AndExpression and1=new AndExpression(plan,gt1,constant4);
  NotExpression not1=new NotExpression(plan,and1);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingExpVisitor expTypeChecker=new TypeCheckingExpVisitor(plan,collector,null);
  expTypeChecker.visit();
  printMessageCollector(collector);
  if (collector.hasError()) {
    throw new Exception("Error not expected during type checking");
  }
  assertEquals(DataType.INTEGER,sub1.getType());
  assertEquals(DataType.BOOLEAN,gt1.getType());
  assertEquals(DataType.BOOLEAN,and1.getType());
  assertEquals(DataType.BOOLEAN,not1.getType());
  assertEquals(DataType.INTEGER,sub1.getRhs().getType());
  assertEquals(DataType.LONG,gt1.getLhs().getType());
}

</code></pre>

<pre class="type-12 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=TypeCheckerException.class) public void testRegexTypeChecking3() throws Throwable {
  LogicalExpressionPlan plan=new LogicalExpressionPlan();
  ConstantExpression constant1=new ConstantExpression(plan,10);
  ConstantExpression constant2=new ConstantExpression(plan,"Regex");
  RegexExpression regex=new RegexExpression(plan,constant1,constant2);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingExpVisitor expTypeChecker=new TypeCheckingExpVisitor(plan,collector,null);
  expTypeChecker.visit();
  printMessageCollector(collector);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testTupleCastLineage() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1 : tuple(i), field2: float);" + "b = foreach a generate (tuple(int))field1;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')");
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupSortLineage() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b') as (field4, field5, field6: chararray );" + "c = cogroup a by field1, b by field4;"+ "d = foreach c generate group, flatten(a), flatten(b) ;"+ "e = order d by field4 desc;"+ "f = foreach e generate group, field1 + 1, field4 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')",1);
  checkLastForeachCastLoadFunc(query,"org.apache.pig.test.PigStorageWithDifferentCaster('b')",2);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupLineage() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = load 'a'  using org.apache.pig.test.PigStorageWithDifferentCaster('b') as (field4, field5, field6: chararray );" + "c = cogroup a by field1, b by field4;"+ "d = foreach c generate group, flatten(a), flatten(b) ;"+ "e = foreach d generate group, field1 + 1, field4 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')",1);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSplitLineage() throws Throwable {
  String query="a = load 'a' as (field1, field2: float, field3: chararray );" + "split a into b if field1 > 1.0, c if field1 <= 1.0;";
  checkSplitLineage(query,"org.apache.pig.builtin.PigStorage","org.apache.pig.builtin.PigStorage");
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGroupLineageNoSchema() throws Throwable {
  String query="a = load 'a' using PigStorage('a');" + "b = group a by $0;" + "c = foreach b generate flatten(a);"+ "d = foreach c generate $0 + 1.0;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')");
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testFilterWithInnerPlan1() throws Throwable {
  testFilterWithInnerPlan(DataType.INTEGER,DataType.LONG);
}

</code></pre>

<pre class="type-7 type-2 type-5 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCompareNULL() throws Throwable {
{
    String query="a = load 'a' as (t1 : int);" + "b = filter a by null == t1;";
    CastExpression castExp=getCastFromLastFilter(query);
    assertNotNull("cast ",castExp);
    assertEquals("cast type",DataType.INTEGER,castExp.getType());
  }
{
    String query="a = load 'a' as (t1 : (i : int));" + "b = filter a by null == t1;";
    CastExpression castExp=getCastFromLastFilter(query);
    assertNotNull("cast ",castExp);
    assertEquals("cast type",DataType.TUPLE,castExp.getType());
  }
{
    String query="a = load 'a' as (t1 : int);" + "b = filter a by t1 <= null;";
    CastExpression castExp=getCastFromLastFilter(query);
    assertNotNull("cast ",castExp);
    assertEquals("cast type",DataType.INTEGER,castExp.getType());
  }
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testLimitLineageNoSchema() throws Throwable {
  String query="a = load 'a';" + "b = limit a 100;" + "c = foreach b generate $1 + 1.0;";
  checkLastForeachCastLoadFunc(query,"org.apache.pig.builtin.PigStorage",0);
}

</code></pre>

<pre class="type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSplitWithInnerPlan1() throws Throwable {
  printCurrentMethodName();
  LogicalPlan plan=new LogicalPlan();
  String pigStorage=PigStorage.class.getName();
  LOLoad load1=newLOLoad(new FileSpec("pi",new FuncSpec(pigStorage)),null,plan,new Configuration(ConfigurationUtil.toConfiguration(pc.getFs().getConfiguration())));
  Schema inputSchema1=null;
{
    List<FieldSchema> fsList1=new ArrayList<FieldSchema>();
    fsList1.add(new FieldSchema("field1",DataType.BYTEARRAY));
    fsList1.add(new FieldSchema("field2",DataType.INTEGER));
    inputSchema1=new Schema(fsList1);
  }
  load1.setScriptSchema(org.apache.pig.newplan.logical.Util.translateSchema((inputSchema1)));
  ;
  LOSplit split1=new LOSplit(plan);
  LOSplitOutput splitOutput1=new LOSplitOutput(plan);
  LOSplitOutput splitOutput2=new LOSplitOutput(plan);
  LogicalExpressionPlan innerPlan1=new LogicalExpressionPlan();
  ProjectExpression project11=new ProjectExpression(innerPlan1,0,0,splitOutput1);
  ProjectExpression project12=new ProjectExpression(innerPlan1,0,1,splitOutput1);
  NotEqualExpression notequal1=new NotEqualExpression(innerPlan1,project11,project12);
  LogicalExpressionPlan innerPlan2=new LogicalExpressionPlan();
  ProjectExpression project21=new ProjectExpression(innerPlan2,0,0,splitOutput2);
  ConstantExpression const21=new ConstantExpression(innerPlan2,26L);
  LessThanEqualExpression lesser21=new LessThanEqualExpression(innerPlan2,project21,const21);
  splitOutput1.setFilterPlan(innerPlan1);
  splitOutput2.setFilterPlan(innerPlan2);
  plan.add(load1);
  plan.add(split1);
  plan.add(splitOutput1);
  plan.add(splitOutput2);
  plan.connect(load1,split1);
  plan.connect(split1,splitOutput1);
  plan.connect(split1,splitOutput2);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingRelVisitor typeChecker=new TypeCheckingRelVisitor(plan,collector);
  typeChecker.visit();
  printMessageCollector(collector);
  if (collector.hasError()) {
    throw new AssertionError("Expect no error");
  }
{
    LogicalSchema endResultSchema1=split1.getSchema();
    assertEquals(DataType.BYTEARRAY,endResultSchema1.getField(0).type);
    assertEquals(DataType.INTEGER,endResultSchema1.getField(1).type);
  }
{
    LogicalSchema endResultSchema1=splitOutput1.getSchema();
    assertEquals(DataType.BYTEARRAY,endResultSchema1.getField(0).type);
    assertEquals(DataType.INTEGER,endResultSchema1.getField(1).type);
  }
{
    LogicalSchema endResultSchema2=splitOutput2.getSchema();
    assertEquals(DataType.BYTEARRAY,endResultSchema2.getField(0).type);
    assertEquals(DataType.INTEGER,endResultSchema2.getField(1).type);
  }
  assertEquals(DataType.BOOLEAN,getSingleOutput(innerPlan1).getType());
  assertEquals(DataType.BOOLEAN,getSingleOutput(innerPlan2).getType());
}

</code></pre>

<pre class="type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testDereferenceTypeSet() throws IOException, ParserException {
  String query="a = load 'a' as (i : int, j : int);" + " b = foreach a generate i, j/10.1 as jd;" + " c = group b by i;"+ " d = foreach c generate MAX(b.jd) as mx;";
  PigServer pig=new PigServer(ExecType.LOCAL);
  Util.registerMultiLineQuery(pig,query);
  Schema expectedSch=Utils.getSchemaFromString("mx: double");
  Schema sch=pig.dumpSchema("d");
  assertEquals("Checking expected schema",expectedSch,sch);
}

</code></pre>

<pre class="type-7 type-9 type-6 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBincond() throws Throwable {
  String query="a= load 'a' as (name: chararray, age: int, gpa: float);" + "b = group a by name;" + "c = foreach b generate (IsEmpty(a) ? " + TestBinCondFieldSchema.class.getName() + "(*): a);";
  LOForEach foreach=getForeachFromPlan(query);
  Schema.FieldSchema charFs=new FieldSchema(null,DataType.CHARARRAY);
  Schema.FieldSchema intFs=new FieldSchema(null,DataType.INTEGER);
  Schema.FieldSchema floatFs=new FieldSchema(null,DataType.FLOAT);
  Schema tupleSchema=new Schema();
  tupleSchema.add(charFs);
  tupleSchema.add(intFs);
  tupleSchema.add(floatFs);
  Schema.FieldSchema bagFs=null;
  Schema bagSchema=new Schema();
  bagSchema.add(new FieldSchema(null,tupleSchema,DataType.TUPLE));
  try {
    bagFs=new Schema.FieldSchema(null,bagSchema,DataType.BAG);
  }
 catch (  FrontendException fee) {
    fail("Did not expect an error");
  }
  Schema expectedSchema=new Schema(bagFs);
  Schema foreachSch=org.apache.pig.newplan.logical.Util.translateSchema(foreach.getSchema());
  assertTrue(Schema.equals(foreachSch,expectedSchema,false,true));
}

</code></pre>

<pre class="type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSortWithInnerPlan1() throws Throwable {
  printCurrentMethodName();
  LogicalPlan plan=new LogicalPlan();
  String pigStorage=PigStorage.class.getName();
  LOLoad load1=newLOLoad(new FileSpec("pi",new FuncSpec(pigStorage)),null,plan,new Configuration(ConfigurationUtil.toConfiguration(pc.getFs().getConfiguration())));
  Schema inputSchema1=null;
{
    List<FieldSchema> fsList1=new ArrayList<FieldSchema>();
    fsList1.add(new FieldSchema("field1",DataType.LONG));
    fsList1.add(new FieldSchema("field2",DataType.INTEGER));
    inputSchema1=new Schema(fsList1);
  }
  load1.setScriptSchema(org.apache.pig.newplan.logical.Util.translateSchema((inputSchema1)));
  ;
  LogicalExpressionPlan innerPlan1=new LogicalExpressionPlan();
  LOSort sort1=new LOSort(plan);
  ProjectExpression project1=new ProjectExpression(innerPlan1,0,1,sort1);
  innerPlan1.add(project1);
  LogicalExpressionPlan innerPlan2=new LogicalExpressionPlan();
  ProjectExpression project2=new ProjectExpression(innerPlan2,0,0,sort1);
  innerPlan2.add(project2);
  List<LogicalExpressionPlan> innerPlans=new ArrayList<LogicalExpressionPlan>();
  innerPlans.add(innerPlan1);
  innerPlans.add(innerPlan2);
  List<Boolean> ascList=new ArrayList<Boolean>();
  ascList.add(true);
  ascList.add(true);
  sort1.setAscendingCols(ascList);
  sort1.setSortColPlans(innerPlans);
  plan.add(load1);
  plan.add(sort1);
  plan.connect(load1,sort1);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingRelVisitor typeChecker=new TypeCheckingRelVisitor(plan,collector);
  typeChecker.visit();
  printMessageCollector(collector);
  if (collector.hasError()) {
    throw new AssertionError("Expect no error");
  }
  LogicalSchema endResultSchema=sort1.getSchema();
  assertEquals(DataType.LONG,endResultSchema.getField(0).type);
  assertEquals(DataType.INTEGER,endResultSchema.getField(1).type);
  assertEquals(DataType.INTEGER,getSingleOutput(innerPlan1).getType());
  assertEquals(DataType.LONG,getSingleOutput(innerPlan2).getType());
}

</code></pre>

<pre class="type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCOGroupWithInnerPlan1GroupByIncompatibleAtom1() throws Throwable {
  printCurrentMethodName();
  LogicalPlan plan=new LogicalPlan();
  String pigStorage=PigStorage.class.getName() + "('\\t','-noschema')";
  LOLoad load1=newLOLoad(new FileSpec("pi",new FuncSpec(pigStorage)),null,plan,new Configuration(ConfigurationUtil.toConfiguration(pc.getFs().getConfiguration())));
  LOLoad load2=newLOLoad(new FileSpec("pi",new FuncSpec(pigStorage)),null,plan,new Configuration(ConfigurationUtil.toConfiguration(pc.getFs().getConfiguration())));
  Schema inputSchema1=null;
{
    List<FieldSchema> fsList1=new ArrayList<FieldSchema>();
    fsList1.add(new FieldSchema("field1a",DataType.INTEGER));
    fsList1.add(new FieldSchema("field2a",DataType.LONG));
    inputSchema1=new Schema(fsList1);
  }
  Schema inputSchema2=null;
{
    List<FieldSchema> fsList2=new ArrayList<FieldSchema>();
    fsList2.add(new FieldSchema("field1b",DataType.DOUBLE));
    fsList2.add(new FieldSchema(null,DataType.INTEGER));
    inputSchema2=new Schema(fsList2);
  }
  load1.setScriptSchema(org.apache.pig.newplan.logical.Util.translateSchema((inputSchema1)));
  load2.setScriptSchema(org.apache.pig.newplan.logical.Util.translateSchema((inputSchema2)));
  LOCogroup cogroup1=new LOCogroup(plan);
  LogicalExpressionPlan innerPlan11=new LogicalExpressionPlan();
  ProjectExpression project111=new ProjectExpression(innerPlan11,0,0,cogroup1);
  ConstantExpression const111=new ConstantExpression(innerPlan11,26F);
  SubtractExpression subtract111=new SubtractExpression(innerPlan11,project111,const111);
  LogicalExpressionPlan innerPlan12=new LogicalExpressionPlan();
  ConstantExpression const121=new ConstantExpression(innerPlan12,26);
  ArrayList<LogicalRelationalOperator> inputs=new ArrayList<LogicalRelationalOperator>();
  inputs.add(load1);
  inputs.add(load2);
  MultiMap<Integer,LogicalExpressionPlan> maps=new MultiMap<Integer,LogicalExpressionPlan>();
  maps.put(0,innerPlan11);
  maps.put(1,innerPlan12);
  boolean[] isInner=new boolean[inputs.size()];
  for (int i=0; i < isInner.length; i++) {
    isInner[i]=false;
  }
  cogroup1.setInnerFlags(isInner);
  cogroup1.setExpressionPlans(maps);
  plan.add(load1);
  plan.add(load2);
  plan.add(cogroup1);
  plan.connect(load1,cogroup1);
  plan.connect(load2,cogroup1);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingRelVisitor typeChecker=new TypeCheckingRelVisitor(plan,collector);
  typeChecker.visit();
  printMessageCollector(collector);
  if (collector.hasError()) {
    throw new AssertionError("Expect no error");
  }
  LogicalSchema endResultSchema=cogroup1.getSchema();
  assertEquals(DataType.FLOAT,endResultSchema.getField(0).type);
  assertEquals(DataType.BAG,endResultSchema.getField(1).type);
  assertEquals(DataType.BAG,endResultSchema.getField(2).type);
  LogicalSchema innerSchema1=endResultSchema.getField(1).schema.getField(0).schema;
  assertEquals(DataType.INTEGER,innerSchema1.getField(0).type);
  assertEquals(DataType.LONG,innerSchema1.getField(1).type);
  LogicalSchema innerSchema2=endResultSchema.getField(2).schema.getField(0).schema;
  assertEquals(DataType.DOUBLE,innerSchema2.getField(0).type);
  assertEquals(DataType.INTEGER,innerSchema2.getField(1).type);
  assertEquals(DataType.FLOAT,getSingleOutput(innerPlan11).getType());
  assertEquals(DataType.FLOAT,getSingleOutput(innerPlan12).getType());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupLimitLineage() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b') as (field4, field5, field6: chararray );" + "c = cogroup a by field1, b by field4;"+ "d = foreach c generate group, flatten(a), flatten(b) ;"+ "e = limit d 100;"+ "f = foreach e generate group, field1 + 1, field4 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')",1);
  checkLastForeachCastLoadFunc(query,"org.apache.pig.test.PigStorageWithDifferentCaster('b')",2);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testColumnWithinNonTupleBag() throws IOException {
{
    String query=" l = load 'x' as (i : int);" + " f = foreach l generate i.$0; ";
    Util.checkExceptionMessage(query,"f","Referring to column(s) within a column of type " + "int is not allowed");
  }
{
    String query=" l = load 'x' as (i : map[]);" + " f = foreach l generate i.$0; ";
    Util.checkExceptionMessage(query,"f","Referring to column(s) within a column of type " + "map is not allowed");
  }
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testFilterLineage() throws Throwable {
  String query="a = load 'a' as (field1, field2: float, field3: chararray );" + "b = filter a by field1 > 1.0;";
  checkLastFilterCast(query,"org.apache.pig.builtin.PigStorage");
}

</code></pre>

<pre class="type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testExpressionTypeChecking3() throws Throwable {
  LogicalExpressionPlan plan=new LogicalExpressionPlan();
  ConstantExpression constant1=new ConstantExpression(plan,10);
  ConstantExpression constant2=new ConstantExpression(plan,20L);
  ConstantExpression constant3=new ConstantExpression(plan,123);
  ModExpression mod1=new ModExpression(plan,constant1,constant2);
  EqualExpression equal1=new EqualExpression(plan,mod1,constant3);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingExpVisitor expTypeChecker=new TypeCheckingExpVisitor(plan,collector,null);
  expTypeChecker.visit();
  plan.explain(System.out,"text",true);
  printMessageCollector(collector);
  if (collector.hasError()) {
    throw new Exception("Error during type checking");
  }
  assertEquals(DataType.LONG,mod1.getType());
  assertEquals(DataType.BOOLEAN,equal1.getType());
  assertEquals(DataType.LONG,mod1.getLhs().getType());
  assertEquals(DataType.LONG,equal1.getRhs().getType());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testLineageExpressionCasting() throws FrontendException {
  String query="A= LOAD 'data1' USING PigStorage() AS (u:int, v);" + "B = FILTER A by u < 50;" + "C = FOREACH B generate u + v;";
  LogicalPlan plan=createAndProcessLPlan(query);
  checkLoaderInCasts(plan,"PigStorage");
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMapLookupLineageNoSchema() throws Throwable {
  String query="a = load 'a' using PigStorage('a');" + "b = foreach a generate $0#'key1';" + "c = foreach b generate $0#'key2';";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')",0);
  query+="d = foreach c generate $0 + 1;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')",0);
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testMapLookupLineage2() throws Throwable {
  String query="a = load 'a' as (s, m, l);" + "b = foreach a generate s#'x' as f1, s#'y' as f2, s#'z' as f3;" + "c = group b by f1;"+ "d = foreach c {fil = filter b by f2 == 1; generate flatten(group), SUM(fil.f3);};";
  LOForEach foreach=getForeachFromPlan(query);
  LogicalPlan innerPlan=foreach.getInnerPlan();
  LOFilter filter=null;
  Iterator<Operator> iter=innerPlan.getOperators();
  while (iter.hasNext()) {
    Operator op=iter.next();
    if (op instanceof LOFilter)     filter=(LOFilter)op;
  }
  LogicalExpressionPlan filterPlan=filter.getFilterPlan();
  CastExpression cast=getCastFromExpPlan(filterPlan);
  assertTrue(cast.getFuncSpec().getClassName().startsWith("org.apache.pig.builtin.PigStorage"));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupMapLookupLineage() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b') as (field4, field5, field6: chararray );" + "c = cogroup a by field1, b by field4;"+ "d = foreach c generate group, flatten(a), flatten(b) ;"+ "e = foreach d generate group, field1#'key' + 1, field4 + 2.0 ;";
  LogicalPlan plan=createAndProcessLPlan(query);
  LOForEach foreach=(LOForEach)plan.getSinks().get(0);
  LogicalExpressionPlan foreachPlan=((LOGenerate)foreach.getInnerPlan().getSinks().get(0)).getOutputPlans().get(1);
  LogicalExpression exOp=(LogicalExpression)foreachPlan.getSinks().get(0);
  if (!(exOp instanceof ProjectExpression))   exOp=(LogicalExpression)foreachPlan.getSinks().get(1);
  CastExpression cast1=(CastExpression)foreachPlan.getPredecessors(exOp).get(0);
  MapLookupExpression map=(MapLookupExpression)foreachPlan.getPredecessors(cast1).get(0);
  checkCastLoadFunc(cast1,"PigStorage('a')");
  CastExpression cast2=(CastExpression)foreachPlan.getPredecessors(map).get(0);
  checkCastLoadFunc(cast1,"PigStorage('a')");
  foreachPlan=((LOGenerate)foreach.getInnerPlan().getSinks().get(0)).getOutputPlans().get(2);
  exOp=(LogicalExpression)foreachPlan.getSinks().get(0);
  if (!(exOp instanceof ProjectExpression))   exOp=(LogicalExpression)foreachPlan.getSinks().get(1);
  CastExpression cast=(CastExpression)foreachPlan.getPredecessors(exOp).get(0);
  checkCastLoadFunc(cast,"org.apache.pig.test.PigStorageWithDifferentCaster('b')");
}

</code></pre>

<pre class="type-7 type-6 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testBinCondForOuterJoin() throws Throwable {
  String query="a= LOAD 'student_data' AS (name: chararray, age: int, gpa: float);" + "b = LOAD 'voter_data' AS (name: chararray, age: int, registration: chararray, contributions: float);" + "c = COGROUP a BY name, b BY name;"+ "d = FOREACH c GENERATE group, "+ "flatten((not IsEmpty(a) ? a : (bag{tuple(chararray, int, float)}){(null, null, null)})),"+ " flatten((not IsEmpty(b) ? b : (bag{tuple(chararray, int, chararray, float)}){(null,null,null, null)}));";
  LOForEach foreach=getForeachFromPlan(query);
  String expectedSchemaString="mygroup: chararray,A::name: chararray,A::age: int," + "A::gpa: float,B::name: chararray,B::age: int," + "B::registration: chararray,B::contributions: float";
  Schema expectedSchema=Utils.getSchemaFromString(expectedSchemaString);
  Schema foreachSch=org.apache.pig.newplan.logical.Util.translateSchema(foreach.getSchema());
  assertTrue(Schema.equals(foreachSch,expectedSchema,false,true));
}

</code></pre>

<pre class="type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCOGroupWithInnerPlan1GroupByTuple1() throws Throwable {
  printCurrentMethodName();
  LogicalPlan plan=new LogicalPlan();
  String pigStorage=PigStorage.class.getName();
  LOLoad load1=newLOLoad(new FileSpec("pi",new FuncSpec(pigStorage)),null,plan,new Configuration(ConfigurationUtil.toConfiguration(pc.getFs().getConfiguration())));
  LOLoad load2=newLOLoad(new FileSpec("pi",new FuncSpec(pigStorage)),null,plan,new Configuration(ConfigurationUtil.toConfiguration(pc.getFs().getConfiguration())));
  Schema inputSchema1=null;
{
    List<FieldSchema> fsList1=new ArrayList<FieldSchema>();
    fsList1.add(new FieldSchema("field1a",DataType.INTEGER));
    fsList1.add(new FieldSchema("field2a",DataType.LONG));
    inputSchema1=new Schema(fsList1);
  }
  Schema inputSchema2=null;
{
    List<FieldSchema> fsList2=new ArrayList<FieldSchema>();
    fsList2.add(new FieldSchema("field1b",DataType.DOUBLE));
    fsList2.add(new FieldSchema(null,DataType.INTEGER));
    inputSchema2=new Schema(fsList2);
  }
  load1.setScriptSchema(org.apache.pig.newplan.logical.Util.translateSchema((inputSchema1)));
  load2.setScriptSchema(org.apache.pig.newplan.logical.Util.translateSchema((inputSchema2)));
  load2.setScriptSchema(org.apache.pig.newplan.logical.Util.translateSchema((inputSchema2)));
  LOCogroup cogroup1=new LOCogroup(plan);
  LogicalExpressionPlan innerPlan11=new LogicalExpressionPlan();
  ProjectExpression project111=new ProjectExpression(innerPlan11,0,0,cogroup1);
  ConstantExpression const111=new ConstantExpression(innerPlan11,26F);
  SubtractExpression subtract111=new SubtractExpression(innerPlan11,project111,const111);
  LogicalExpressionPlan innerPlan21=new LogicalExpressionPlan();
  ProjectExpression project211=new ProjectExpression(innerPlan21,0,0,cogroup1);
  ProjectExpression project212=new ProjectExpression(innerPlan21,0,1,cogroup1);
  AddExpression add211=new AddExpression(innerPlan21,project211,project212);
  LogicalExpressionPlan innerPlan12=new LogicalExpressionPlan();
  ProjectExpression project121=new ProjectExpression(innerPlan12,1,0,cogroup1);
  ConstantExpression const121=new ConstantExpression(innerPlan12,26);
  SubtractExpression subtract121=new SubtractExpression(innerPlan12,project121,const121);
  LogicalExpressionPlan innerPlan22=new LogicalExpressionPlan();
  ConstantExpression const122=new ConstantExpression(innerPlan22,26);
  ArrayList<LogicalRelationalOperator> inputs=new ArrayList<LogicalRelationalOperator>();
  inputs.add(load1);
  inputs.add(load2);
  MultiMap<Integer,LogicalExpressionPlan> maps=new MultiMap<Integer,LogicalExpressionPlan>();
  maps.put(0,innerPlan11);
  maps.put(0,innerPlan21);
  maps.put(1,innerPlan12);
  maps.put(1,innerPlan22);
  boolean[] isInner=new boolean[inputs.size()];
  for (int i=0; i < isInner.length; i++) {
    isInner[i]=false;
  }
  cogroup1.setInnerFlags(isInner);
  cogroup1.setExpressionPlans(maps);
  plan.add(load1);
  plan.add(load2);
  plan.add(cogroup1);
  plan.connect(load1,cogroup1);
  plan.connect(load2,cogroup1);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingRelVisitor typeChecker=new TypeCheckingRelVisitor(plan,collector);
  typeChecker.visit();
  printMessageCollector(collector);
  if (collector.hasError()) {
    throw new AssertionError("Expect no error");
  }
  LogicalSchema endResultSchema=cogroup1.getSchema();
  assertEquals(DataType.TUPLE,endResultSchema.getField(0).type);
  assertEquals(DataType.DOUBLE,endResultSchema.getField(0).schema.getField(0).type);
  assertEquals(DataType.LONG,endResultSchema.getField(0).schema.getField(1).type);
  assertEquals(DataType.BAG,endResultSchema.getField(1).type);
  assertEquals(DataType.BAG,endResultSchema.getField(2).type);
  LogicalSchema innerSchema1=endResultSchema.getField(1).schema.getField(0).schema;
  assertEquals(DataType.INTEGER,innerSchema1.getField(0).type);
  assertEquals(DataType.LONG,innerSchema1.getField(1).type);
  LogicalSchema innerSchema2=endResultSchema.getField(2).schema.getField(0).schema;
  assertEquals(DataType.DOUBLE,innerSchema2.getField(0).type);
  assertEquals(DataType.INTEGER,innerSchema2.getField(1).type);
  assertEquals(DataType.DOUBLE,getSingleOutput(innerPlan11).getType());
  assertEquals(DataType.LONG,getSingleOutput(innerPlan21).getType());
  assertEquals(DataType.DOUBLE,getSingleOutput(innerPlan12).getType());
  assertEquals(DataType.LONG,getSingleOutput(innerPlan22).getType());
}

</code></pre>

<pre class="type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCross1() throws Throwable {
  printCurrentMethodName();
  LogicalPlan plan=new LogicalPlan();
  LOLoad load1=genDummyLOLoadNewLP(plan);
  LOLoad load2=genDummyLOLoadNewLP(plan);
  String[] aliases1=new String[]{"a","b","c"};
  byte[] types1=new byte[]{DataType.INTEGER,DataType.LONG,DataType.BYTEARRAY};
  Schema schema1=genFlatSchema(aliases1,types1);
  String[] aliases2=new String[]{"e","f"};
  byte[] types2=new byte[]{DataType.FLOAT,DataType.DOUBLE};
  Schema schema2=genFlatSchema(aliases2,types2);
  load1.setScriptSchema(org.apache.pig.newplan.logical.Util.translateSchema(schema1));
  load2.setScriptSchema(org.apache.pig.newplan.logical.Util.translateSchema(schema2));
  LOCross cross=new LOCross(plan);
  plan.add(load1);
  plan.add(load2);
  plan.add(cross);
  plan.connect(load1,cross);
  plan.connect(load2,cross);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingRelVisitor typeChecker=new TypeCheckingRelVisitor(plan,collector);
  typeChecker.visit();
  printMessageCollector(collector);
  assertEquals(5,cross.getSchema().size());
  assertEquals(DataType.INTEGER,cross.getSchema().getField(0).type);
  assertEquals(DataType.LONG,cross.getSchema().getField(1).type);
  assertEquals(DataType.BYTEARRAY,cross.getSchema().getField(2).type);
  assertEquals(DataType.FLOAT,cross.getSchema().getField(3).type);
  assertEquals(DataType.DOUBLE,cross.getSchema().getField(4).type);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSortLineageNoSchema() throws Throwable {
  String query="a = load 'a';" + "b = order a by $1;" + "c = foreach b generate $1 + 1.0;";
  checkLastForeachCastLoadFunc(query,"org.apache.pig.builtin.PigStorage");
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testFilterLineage1() throws Throwable {
  String query="a = load 'a' as (field1, field2: float, field3: chararray );" + "b = filter a by field2 > 1.0;" + "c = foreach b generate field1 + 1.0;";
  checkLastForeachCastLoadFunc(query,"org.apache.pig.builtin.PigStorage");
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testExpressionTypeCheckingFail1() throws Throwable {
  LogicalExpressionPlan plan=new LogicalExpressionPlan();
  ConstantExpression constant1=new ConstantExpression(plan,10);
  ConstantExpression constant2=new ConstantExpression(plan,20D);
  ConstantExpression constant3=new ConstantExpression(plan,"123");
  AddExpression add1=new AddExpression(plan,constant1,constant2);
  CastExpression cast1=new CastExpression(plan,constant3,createFS(DataType.BYTEARRAY));
  MultiplyExpression mul1=new MultiplyExpression(plan,add1,cast1);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingExpVisitor expTypeChecker=new TypeCheckingExpVisitor(plan,collector,null);
  try {
    expTypeChecker.visit();
    fail("Exception expected");
  }
 catch (  TypeCheckerException pve) {
  }
  printMessageCollector(collector);
  if (!collector.hasError()) {
    throw new Exception("Error during type checking");
  }
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * test various scenarios with two level map lookup
 */
@Test public void testTwolevelMapLookupLineage() throws Exception {
  List<String[]> queries=new ArrayList<String[]>();
  queries.add(new String[]{"sds = LOAD '/my/data/location' " + "AS (simpleFields:map[], mapFields:map[], listMapFields:map[]);","queries = FILTER sds BY mapFields#'page_params'#'query' " + "is NOT NULL;","queries_rand = FOREACH queries GENERATE " + "(CHARARRAY) (mapFields#'page_params'#'query') AS query_string;","queries_limit = LIMIT queries_rand 100;","STORE queries_limit INTO 'out';"});
  queries.add(new String[]{"sds = LOAD '/my/data/location'  " + "AS (simpleFields:map[], mapFields:map[], listMapFields:map[]);","queries_rand = FOREACH sds GENERATE " + "(CHARARRAY) (mapFields#'page_params'#'query') AS query_string;","queries = FILTER queries_rand BY query_string IS NOT null;","queries_limit = LIMIT queries 100;","STORE queries_limit INTO 'out';"});
  queries.add(new String[]{"sds = LOAD '/my/data/location'  " + "AS (simpleFields:map[], mapFields:map[], listMapFields:map[]);","params = FOREACH sds GENERATE " + "(map[]) (mapFields#'page_params') AS params;","queries = FOREACH params " + "GENERATE (CHARARRAY) (params#'query') AS query_string;","queries_filtered = FILTER queries BY query_string IS NOT null;","queries_limit = LIMIT queries_filtered 100;","STORE queries_limit INTO 'out';"});
  queries.add(new String[]{"sds = LOAD '/my/data/location'  " + "AS (simpleFields:map[], mapFields:map[], listMapFields:map[]);","params = FOREACH sds GENERATE" + " (map[]) (mapFields#'page_params') AS params;","queries = FOREACH params GENERATE " + "(CHARARRAY) (params#'query') AS query_string;","queries_limit = LIMIT queries 100;","STORE queries_limit INTO 'out';"});
  queries.add(new String[]{"sds = LOAD '/my/data/location'  " + "AS (simpleFields:map[], mapFields:map[], listMapFields:map[]);","params = FOREACH sds GENERATE " + "(map[]) (mapFields#'page_params') AS params;","queries = FOREACH params GENERATE " + "(CHARARRAY) (params#'query') AS query_string;","rand_queries = FOREACH queries GENERATE query_string as query;","queries_limit = LIMIT rand_queries 100;","STORE rand_queries INTO 'out';"});
  for (  String[] query : queries) {
    String fullQuery="";
    for (    String queryLine : query) {
      fullQuery+=" " + queryLine;
    }
    LogicalPlan lp=createAndProcessLPlan(fullQuery);
    checkLoaderInCasts(lp,"org.apache.pig.builtin.PigStorage");
  }
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSplitWithInnerPlan2() throws Throwable {
  printCurrentMethodName();
  LogicalPlan plan=new LogicalPlan();
  String pigStorage=PigStorage.class.getName();
  LOLoad load1=newLOLoad(new FileSpec("pi",new FuncSpec(pigStorage)),null,plan,new Configuration(ConfigurationUtil.toConfiguration(pc.getFs().getConfiguration())));
  Schema inputSchema1=null;
{
    List<FieldSchema> fsList1=new ArrayList<FieldSchema>();
    fsList1.add(new FieldSchema("field1",DataType.BYTEARRAY));
    fsList1.add(new FieldSchema("field2",DataType.INTEGER));
    inputSchema1=new Schema(fsList1);
  }
  load1.setScriptSchema(org.apache.pig.newplan.logical.Util.translateSchema((inputSchema1)));
  ;
  LOSplit split1=new LOSplit(plan);
  LOSplitOutput splitOutput1=new LOSplitOutput(plan);
  LOSplitOutput splitOutput2=new LOSplitOutput(plan);
  LogicalExpressionPlan innerPlan1=new LogicalExpressionPlan();
  ProjectExpression project11=new ProjectExpression(innerPlan1,0,0,splitOutput1);
  ProjectExpression project12=new ProjectExpression(innerPlan1,0,1,splitOutput1);
  NotEqualExpression notequal1=new NotEqualExpression(innerPlan1,project11,project12);
  LogicalExpressionPlan innerPlan2=new LogicalExpressionPlan();
  ProjectExpression project21=new ProjectExpression(innerPlan2,0,0,splitOutput1);
  ConstantExpression const21=new ConstantExpression(innerPlan2,26L);
  SubtractExpression subtract21=new SubtractExpression(innerPlan2,project21,const21);
  splitOutput1.setFilterPlan(innerPlan1);
  splitOutput2.setFilterPlan(innerPlan2);
  plan.add(load1);
  plan.add(split1);
  plan.add(splitOutput1);
  plan.add(splitOutput2);
  plan.connect(load1,split1);
  plan.connect(split1,splitOutput1);
  plan.connect(split1,splitOutput2);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingRelVisitor typeChecker=new TypeCheckingRelVisitor(plan,collector);
  try {
    typeChecker.visit();
  }
 catch (  Exception t) {
  }
  printMessageCollector(collector);
  if (!collector.hasError()) {
    throw new AssertionError("Error expected");
  }
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testBagCastLineage() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1 : bag{ t : tuple (i)}, field2: float);" + "b = foreach a generate (bag{tuple(int)})field1;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')");
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCrossLineage() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b') as (field4, field5, field6: chararray );" + "c = cross a, b;"+ "d = foreach c generate field1 + 1, field4 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')",0);
  checkLastForeachCastLoadFunc(query,"org.apache.pig.test.PigStorageWithDifferentCaster('b')",1);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCompareTupleFail() throws Throwable {
  String query="a = load 'a' as (t : (i : int, j : int));" + "b = filter a by t > (1,2);";
  String exMsg="In alias b, incompatible types in GreaterThan Operator" + " left hand side:tuple i:int,j:int " + " right hand side:tuple :int,:int";
  checkExceptionMessage(query,"b",exMsg);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testJoinLineageMixSchema() throws Throwable {
  String query="a = load 'a' using PigStorage() as (field1, field2: float, field3: chararray );" + "b = load 'a' using PigStorage();" + "c = join a by field1, b by $0;"+ "d = foreach c generate $3 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,"PigStorage",0);
}

</code></pre>

<pre class="type-7 type-2 type-5 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCompareEqualityMapCast() throws Throwable {
  String query="a = load 'a' as (t : map[], col);" + "b = filter a by t != col;";
  CastExpression castExp=getCastFromLastFilter(query);
  assertNotNull("cast ",castExp);
  assertEquals("cast type",DataType.MAP,castExp.getType());
}

</code></pre>

<pre class="type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testExpressionTypeChecking11() throws Throwable {
  LogicalExpressionPlan plan=new LogicalExpressionPlan();
  ConstantExpression constant0=new ConstantExpression(plan,new DateTime(0L));
  ConstantExpression constant1=new ConstantExpression(plan,new DateTime("1970-01-01T00:00:00.000Z"));
  ConstantExpression constant2=new ConstantExpression(plan,new DateTime(1L));
  ConstantExpression constant3=new ConstantExpression(plan,new DateTime(2L));
  ConstantExpression constant4=new ConstantExpression(plan,new DataByteArray("1970-01-01T00:00:00.003Z"));
  LessThanExpression lt1=new LessThanExpression(plan,constant1,constant2);
  LessThanEqualExpression lte1=new LessThanEqualExpression(plan,constant1,constant2);
  GreaterThanExpression gt1=new GreaterThanExpression(plan,constant3,constant4);
  GreaterThanEqualExpression gte1=new GreaterThanEqualExpression(plan,constant3,constant4);
  EqualExpression eq1=new EqualExpression(plan,constant0,constant1);
  NotEqualExpression neq1=new NotEqualExpression(plan,constant0,constant2);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingExpVisitor expTypeChecker=new TypeCheckingExpVisitor(plan,collector,null);
  expTypeChecker.visit();
  plan.explain(System.out,"text",true);
  printMessageCollector(collector);
  if (collector.hasError()) {
    throw new Exception("Error during type checking");
  }
  assertEquals(DataType.BOOLEAN,lt1.getType());
  assertEquals(DataType.BOOLEAN,lte1.getType());
  assertEquals(DataType.BOOLEAN,gt1.getType());
  assertEquals(DataType.BOOLEAN,gte1.getType());
  assertEquals(DataType.BOOLEAN,eq1.getType());
  assertEquals(DataType.BOOLEAN,neq1.getType());
  assertEquals(DataType.DATETIME,gt1.getRhs().getType());
  assertEquals(DataType.DATETIME,gte1.getRhs().getType());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * Test nested foreach with distinct
 * @throws Throwable
 */
@Test public void testNestedDistinct() throws Throwable {
  String query="a = load '/user/pig/tests/data/singlefile/studenttab10k' as (name, age, gpa);" + "b = group a by name; " + "c = foreach b { aa = distinct a.age; generate group + 1, COUNT(aa); }";
  checkLastForeachCastLoadFunc(query,"org.apache.pig.builtin.PigStorage");
}

</code></pre>

<pre class="type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testExpressionTypeChecking4() throws Throwable {
  LogicalExpressionPlan plan=new LogicalExpressionPlan();
  ConstantExpression constant1=new ConstantExpression(plan,10);
  ConstantExpression constant2=new ConstantExpression(plan,20D);
  ConstantExpression constant3=new ConstantExpression(plan,123f);
  DivideExpression div1=new DivideExpression(plan,constant1,constant2);
  CastExpression cast1=new CastExpression(plan,constant3,createFS(DataType.DOUBLE));
  NotEqualExpression notequal1=new NotEqualExpression(plan,div1,cast1);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingExpVisitor expTypeChecker=new TypeCheckingExpVisitor(plan,collector,null);
  expTypeChecker.visit();
  printMessageCollector(collector);
  if (collector.hasError()) {
    throw new Exception("Error during type checking");
  }
  assertEquals(DataType.DOUBLE,div1.getType());
  assertEquals(DataType.BOOLEAN,notequal1.getType());
  assertEquals(DataType.DOUBLE,div1.getLhs().getType());
  assertEquals(DataType.DOUBLE,notequal1.getRhs().getType());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUnionLineageDifferentSchema() throws Throwable {
  String query="a = load 'a' using PigStorage('\u0001') as (field1, field2: float, field3: chararray );" + "b = load 'a' using PigStorage('\u0001') as (field4, field5, field6: chararray, field7 );" + "c = union a , b;"+ "d = foreach c generate $3 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,"PigStorage('\u0001')");
}

</code></pre>

<pre class="type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRegexTypeChecking1() throws Throwable {
  LogicalExpressionPlan plan=new LogicalExpressionPlan();
  ConstantExpression constant1=new ConstantExpression(plan,"10");
  ConstantExpression constant2=new ConstantExpression(plan,"Regex");
  RegexExpression regex=new RegexExpression(plan,constant1,constant2);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingExpVisitor expTypeChecker=new TypeCheckingExpVisitor(plan,collector,null);
  expTypeChecker.visit();
  printMessageCollector(collector);
  System.out.println(DataType.findTypeName(regex.getType()));
  assertEquals(DataType.BOOLEAN,regex.getType());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupFilterLineage() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b') as (field4, field5, field6: chararray );" + "c = cogroup a by field1, b by field4;"+ "d = foreach c generate group, flatten(a), flatten(b) ;"+ "e = filter d by field4 > 5;"+ "f = foreach e generate group, field1 + 1, field4 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')",1);
  checkLastForeachCastLoadFunc(query,"org.apache.pig.test.PigStorageWithDifferentCaster('b')",2);
}

</code></pre>

<pre class="type-7 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
"></span><br>
@Test public void testLineage1() throws Throwable {
  String query="a = load 'a' as (field1: int, field2: float, field3: chararray );" + "b = foreach a generate field1 + 1.0;";
  CastExpression cast=getCastFromLastForeach(query);
  assertNull(cast.getFuncSpec());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testJoinLineageMixSchemaFail() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster();" + "c = join a by field1, b by $0;"+ "d = foreach c generate $3 + 2.0 ;";
  checkWarning(query,CAST_LOAD_NOT_FOUND);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testFilterLineageNoSchema() throws Throwable {
  String query="a = load 'a';" + "b = filter a by $0 > 1.0;";
  checkLastFilterCast(query,"org.apache.pig.builtin.PigStorage");
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSplitLineageNoSchema() throws Throwable {
  String query="a = load 'a';" + "split a into b if $0 > 1.0, c if $1 <= 1.0;";
  checkSplitLineage(query,"org.apache.pig.builtin.PigStorage","org.apache.pig.builtin.PigStorage");
}

</code></pre>

<pre class="type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testExpressionTypeChecking10() throws Throwable {
  LogicalExpressionPlan plan=new LogicalExpressionPlan();
  ConstantExpression constant1=new ConstantExpression(plan,10);
  ConstantExpression constant2=new ConstantExpression(plan,20L);
  ConstantExpression constant3=new ConstantExpression(plan,Boolean.TRUE);
  GreaterThanExpression gt1=new GreaterThanExpression(plan,constant1,constant2);
  EqualExpression equal1=new EqualExpression(plan,gt1,constant3);
  NotEqualExpression nq1=new NotEqualExpression(plan,gt1,constant3);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingExpVisitor expTypeChecker=new TypeCheckingExpVisitor(plan,collector,null);
  expTypeChecker.visit();
  plan.explain(System.out,"text",true);
  printMessageCollector(collector);
  if (collector.hasError()) {
    throw new Exception("Error during type checking");
  }
  assertEquals(DataType.BOOLEAN,gt1.getType());
  assertEquals(DataType.BOOLEAN,equal1.getType());
  assertEquals(DataType.BOOLEAN,nq1.getType());
  assertEquals(DataType.LONG,gt1.getLhs().getType());
  assertEquals(DataType.BOOLEAN,equal1.getRhs().getType());
  assertEquals(DataType.BOOLEAN,nq1.getRhs().getType());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupTopKLineage() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b') as (field4, field5, field6: chararray );" + "c = cogroup a by field1, b by field4;"+ "d = foreach c generate group, flatten(a), flatten(b) ;"+ "e = order d by field1 desc;"+ "f = limit e 100;"+ "g = foreach f generate group, field1 + 1, field4 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')",1);
  checkLastForeachCastLoadFunc(query,"org.apache.pig.test.PigStorageWithDifferentCaster('b')",2);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testForEachGenerate2() throws Throwable {
  printCurrentMethodName();
  LogicalPlan plan=new LogicalPlan();
  LOLoad load1=genDummyLOLoadNewLP(plan);
  Schema inputSchema1=null;
{
    List<FieldSchema> fsList1=new ArrayList<FieldSchema>();
    fsList1.add(new FieldSchema("field1a",DataType.INTEGER));
    fsList1.add(new FieldSchema("field2a",DataType.LONG));
    inputSchema1=new Schema(fsList1);
  }
  load1.setScriptSchema(org.apache.pig.newplan.logical.Util.translateSchema((inputSchema1)));
  ;
  LogicalPlan innerRelPlan=new LogicalPlan();
  LOForEach foreach1=new LOForEach(plan);
  foreach1.setInnerPlan(innerRelPlan);
  LOGenerate loGen=new LOGenerate(innerRelPlan);
  innerRelPlan.add(loGen);
  LOInnerLoad innerLoad1=new LOInnerLoad(innerRelPlan,foreach1,0);
  innerRelPlan.add(innerLoad1);
  innerRelPlan.connect(innerLoad1,loGen);
  LogicalExpressionPlan innerPlan1=new LogicalExpressionPlan();
  ProjectExpression project11=new ProjectExpression(innerPlan1,0,0,loGen);
  ConstantExpression const11=new ConstantExpression(innerPlan1,"26F");
  SubtractExpression subtract11=new SubtractExpression(innerPlan1,project11,const11);
  LogicalExpressionPlan innerPlan2=new LogicalExpressionPlan();
  innerLoad1=new LOInnerLoad(innerRelPlan,foreach1,0);
  innerRelPlan.add(innerLoad1);
  innerRelPlan.connect(innerLoad1,loGen);
  ProjectExpression project21=new ProjectExpression(innerPlan2,1,0,loGen);
  innerLoad1=new LOInnerLoad(innerRelPlan,foreach1,0);
  innerRelPlan.add(innerLoad1);
  innerRelPlan.connect(innerLoad1,loGen);
  ProjectExpression project22=new ProjectExpression(innerPlan2,2,1,loGen);
  AddExpression add21=new AddExpression(innerPlan2,project21,project22);
  ArrayList<LogicalExpressionPlan> generatePlans=new ArrayList<LogicalExpressionPlan>();
  generatePlans.add(innerPlan1);
  generatePlans.add(innerPlan2);
  boolean[] flattens={true,false};
  loGen.setFlattenFlags(flattens);
  loGen.setOutputPlans(generatePlans);
  plan.add(load1);
  plan.add(foreach1);
  plan.connect(load1,foreach1);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingRelVisitor typeChecker=new TypeCheckingRelVisitor(plan,collector);
  try {
    typeChecker.visit();
    fail("Exception expected");
  }
 catch (  TypeCheckerException pve) {
  }
  printMessageCollector(collector);
  if (!collector.hasError()) {
    throw new AssertionError("Expect error");
  }
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGroupLineage() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1 , field2: float, field3: chararray );" + " b = group a by field1;" + " c = foreach b generate flatten(a);"+ " d = foreach c generate field1 + 1.0;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')");
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testLimitLineage() throws Throwable {
  String query="a = load 'a' as (field1, field2: float, field3: chararray );" + "b = limit a 100;" + "c = foreach b generate field1 + 1.0;";
  checkLastForeachCastLoadFunc(query,"org.apache.pig.builtin.PigStorage",0);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupMultiColumnProjectLineage() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = load 'b' using org.apache.pig.test.PigStorageWithDifferentCaster('b') as (field4, field5, field6: chararray );" + "c = cogroup a by field1, b by field4;"+ "d = foreach c generate group, a.(field1, field2), b.(field4);"+ "e = foreach d generate group, flatten($1), flatten($2);"+ "f = foreach e generate group, field1 + 1, field4 + 2.0;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')",1);
  checkLastForeachCastLoadFunc(query,"org.apache.pig.test.PigStorageWithDifferentCaster('b')",2);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGroupLineage2NoSchema() throws Throwable {
  String query="a = load 'a' using PigStorage('a');" + "b = group a by $0;" + "c = foreach b generate group + 1.0;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')");
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCrossLineageMixSchemaFail() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b');" + "c = cross a , b;"+ "d = foreach c generate $3 + 2.0 ;";
  checkWarning(query,CAST_LOAD_NOT_FOUND);
}

</code></pre>

<pre class="type-7 type-6 type-4 type-5 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUnionCastingInsert1() throws Throwable {
  printCurrentMethodName();
  LogicalPlan plan=new LogicalPlan();
  String pigStorage=PigStorage.class.getName();
  LOLoad load1=newLOLoad(new FileSpec("pi",new FuncSpec(pigStorage)),null,plan,new Configuration(ConfigurationUtil.toConfiguration(pc.getFs().getConfiguration())));
  LOLoad load2=newLOLoad(new FileSpec("pi",new FuncSpec(pigStorage)),null,plan,new Configuration(ConfigurationUtil.toConfiguration(pc.getFs().getConfiguration())));
  Schema inputSchema1=null;
{
    List<FieldSchema> fsList1=new ArrayList<FieldSchema>();
    fsList1.add(new FieldSchema("field1a",DataType.INTEGER));
    fsList1.add(new FieldSchema("field2a",DataType.LONG));
    fsList1.add(new FieldSchema(null,DataType.BYTEARRAY));
    fsList1.add(new FieldSchema(null,DataType.CHARARRAY));
    inputSchema1=new Schema(fsList1);
  }
  Schema inputSchema2=null;
{
    List<FieldSchema> fsList2=new ArrayList<FieldSchema>();
    fsList2.add(new FieldSchema("field1b",DataType.DOUBLE));
    fsList2.add(new FieldSchema(null,DataType.INTEGER));
    fsList2.add(new FieldSchema("field3b",DataType.FLOAT));
    fsList2.add(new FieldSchema("field4b",DataType.CHARARRAY));
    inputSchema2=new Schema(fsList2);
  }
  load1.setScriptSchema(org.apache.pig.newplan.logical.Util.translateSchema(inputSchema1));
  load2.setScriptSchema(org.apache.pig.newplan.logical.Util.translateSchema(inputSchema2));
  ArrayList<LogicalRelationalOperator> inputList=new ArrayList<LogicalRelationalOperator>();
  inputList.add(load1);
  inputList.add(load2);
  LOUnion union=new LOUnion(plan,false);
  plan.add(load1);
  plan.add(load2);
  plan.add(union);
  plan.connect(load1,union);
  plan.connect(load2,union);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingRelVisitor typeChecker=new TypeCheckingRelVisitor(plan,collector);
  typeChecker.visit();
  printMessageCollector(collector);
  Schema outputSchema=org.apache.pig.newplan.logical.Util.translateSchema(union.getSchema());
  Schema expectedSchema=null;
{
    List<FieldSchema> fsListExpected=new ArrayList<FieldSchema>();
    fsListExpected.add(new FieldSchema("field1a",DataType.DOUBLE));
    fsListExpected.add(new FieldSchema("field2a",DataType.LONG));
    fsListExpected.add(new FieldSchema("field3b",DataType.FLOAT));
    fsListExpected.add(new FieldSchema("field4b",DataType.CHARARRAY));
    expectedSchema=new Schema(fsListExpected);
  }
  assertTrue(Schema.equals(outputSchema,expectedSchema,true,false));
{
    List<Operator> sucList1=plan.getSuccessors(load1);
    assertEquals(1,sucList1.size());
    LOForEach foreach=(LOForEach)sucList1.get(0);
    assertTrue(foreach instanceof LOForEach);
    List<Operator> sucList2=plan.getSuccessors(foreach);
    assertEquals(1,sucList2.size());
    assertTrue(sucList2.get(0) instanceof LOUnion);
    checkForEachCasting(foreach,0,true,DataType.DOUBLE);
    checkForEachCasting(foreach,1,false,DataType.UNKNOWN);
    checkForEachCasting(foreach,2,true,DataType.FLOAT);
    checkForEachCasting(foreach,3,false,DataType.UNKNOWN);
  }
{
    List<Operator> sucList1=plan.getSuccessors(load2);
    assertEquals(1,sucList1.size());
    LOForEach foreach=(LOForEach)sucList1.get(0);
    assertTrue(foreach instanceof LOForEach);
    List<Operator> sucList2=plan.getSuccessors(foreach);
    assertEquals(1,sucList2.size());
    assertTrue(sucList2.get(0) instanceof LOUnion);
    checkForEachCasting(foreach,0,false,DataType.UNKNOWN);
    checkForEachCasting(foreach,1,true,DataType.LONG);
    checkForEachCasting(foreach,2,false,DataType.UNKNOWN);
    checkForEachCasting(foreach,3,false,DataType.UNKNOWN);
  }
}

</code></pre>

<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void setUp() throws Exception {
  pc.connect();
}

</code></pre>

<pre class="type-6 type-4 type-5 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testArithmeticOpCastInsert2() throws Throwable {
  LogicalExpressionPlan plan=new LogicalExpressionPlan();
  ConstantExpression constant1=new ConstantExpression(plan,10);
  ConstantExpression constant2=new ConstantExpression(plan,20L);
  NegativeExpression neg1=new NegativeExpression(plan,constant1);
  SubtractExpression subtract1=new SubtractExpression(plan,neg1,constant2);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingExpVisitor expTypeChecker=new TypeCheckingExpVisitor(plan,collector,null);
  expTypeChecker.visit();
  printMessageCollector(collector);
  System.out.println(DataType.findTypeName(subtract1.getType()));
  assertEquals(DataType.LONG,subtract1.getType());
  assertTrue(subtract1.getLhs() instanceof CastExpression);
  assertEquals(DataType.LONG,((CastExpression)subtract1.getLhs()).getType());
  assertEquals(neg1,((CastExpression)subtract1.getLhs()).getExpression());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testLineageMultipleLoader1() throws FrontendException {
  String query="A = LOAD 'data1' USING PigStorage() AS (u, v, w);" + "B = LOAD 'data2' USING TextLoader() AS (x, y);" + "C = JOIN A BY u, B BY x USING 'replicated';"+ "D = GROUP C BY (u, x);"+ "E = FOREACH D GENERATE (chararray)group.u, (int)group.x;";
  checkLastForeachCastLoadFunc(query,"PigStorage",0);
  checkLastForeachCastLoadFunc(query,"TextLoader",1);
}

</code></pre>

<pre class="type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testArithmeticOpCastInsert1() throws Throwable {
  LogicalExpressionPlan plan=new LogicalExpressionPlan();
  ConstantExpression constant1=new ConstantExpression(plan,10);
  ConstantExpression constant2=new ConstantExpression(plan,20D);
  MultiplyExpression mul1=new MultiplyExpression(plan,constant1,constant2);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingExpVisitor expTypeChecker=new TypeCheckingExpVisitor(plan,collector,null);
  expTypeChecker.visit();
  printMessageCollector(collector);
  System.out.println(DataType.findTypeName(mul1.getType()));
  assertEquals(DataType.DOUBLE,mul1.getType());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testMapLookupLineage() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = foreach a generate field1#'key1' as map1;" + "c = foreach b generate map1#'key2' as keyval;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')",0);
  query+="d = foreach c generate keyval + 1;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')",0);
}

</code></pre>

<pre class="type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testExpressionTypeChecking5() throws Throwable {
  LogicalExpressionPlan plan=new LogicalExpressionPlan();
  ConstantExpression constant1=new ConstantExpression(plan,10F);
  ConstantExpression constant2=new ConstantExpression(plan,20L);
  ConstantExpression constant3=new ConstantExpression(plan,123F);
  ConstantExpression constant4=new ConstantExpression(plan,123D);
  LessThanEqualExpression lesser1=new LessThanEqualExpression(plan,constant1,constant2);
  BinCondExpression bincond1=new BinCondExpression(plan,lesser1,constant3,constant4);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingExpVisitor expTypeChecker=new TypeCheckingExpVisitor(plan,collector,null);
  expTypeChecker.visit();
  printMessageCollector(collector);
  if (collector.hasError()) {
    throw new Exception("Error during type checking");
  }
  assertEquals(DataType.BOOLEAN,lesser1.getType());
  assertEquals(DataType.DOUBLE,bincond1.getType());
  assertEquals(DataType.FLOAT,lesser1.getLhs().getType());
  assertEquals(DataType.FLOAT,lesser1.getRhs().getType());
  assertEquals(DataType.DOUBLE,bincond1.getLhs().getType());
  assertEquals(DataType.DOUBLE,bincond1.getRhs().getType());
}

</code></pre>

<pre class="type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testRegexTypeChecking2() throws Throwable {
  LogicalExpressionPlan plan=new LogicalExpressionPlan();
  ConstantExpression constant1=new ConstantExpression(plan,new DataByteArray());
  ConstantExpression constant2=new ConstantExpression(plan,"Regex");
  RegexExpression regex=new RegexExpression(plan,constant1,constant2);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingExpVisitor expTypeChecker=new TypeCheckingExpVisitor(plan,collector,null);
  expTypeChecker.visit();
  printMessageCollector(collector);
  if (collector.hasError()) {
    throw new Exception("Error not expected during type checking");
  }
  System.out.println(DataType.findTypeName(regex.getType()));
  assertEquals(DataType.BOOLEAN,regex.getType());
  CastExpression cast=(CastExpression)regex.getLhs();
  assertEquals(cast.getType(),DataType.CHARARRAY);
  assertEquals(cast.getExpression(),constant1);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDistinctLineageNoSchema() throws Throwable {
  String query="a = load 'a';" + "b = distinct a;" + "c = foreach b generate $1 + 1.0;";
  checkLastForeachCastLoadFunc(query,"org.apache.pig.builtin.PigStorage");
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testGroupLineage2() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + " b = group a by field1;" + " c = foreach b generate group + 1.0;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')");
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCrossLineageMixSchema() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = load 'a' using PigStorage('a');" + "c = cross a , b;"+ "d = foreach c generate $3 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')");
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupSortStarLineage() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b') as (field4, field5, field6: chararray );" + "c = cogroup a by field1, b by field4;"+ "d = foreach c generate group, flatten(a), flatten(b) ;"+ "e = order d by * desc;"+ "f = foreach e generate group, field1 + 1, field4 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')",1);
  checkLastForeachCastLoadFunc(query,"org.apache.pig.test.PigStorageWithDifferentCaster('b')",2);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSortLineage() throws Throwable {
  String query="a = load 'a' as (field1, field2: float, field3: chararray );" + "b = order a by field1;" + "c = foreach b generate field1 + 1.0;";
  checkLastForeachCastLoadFunc(query,"org.apache.pig.builtin.PigStorage");
}

</code></pre>

<pre class="type-6 type-4 type-5 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testModCastInsert1() throws Throwable {
  LogicalExpressionPlan plan=new LogicalExpressionPlan();
  ConstantExpression constant1=new ConstantExpression(plan,10);
  ConstantExpression constant2=new ConstantExpression(plan,20L);
  ModExpression mod1=new ModExpression(plan,constant1,constant2);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingExpVisitor expTypeChecker=new TypeCheckingExpVisitor(plan,collector,null);
  expTypeChecker.visit();
  printMessageCollector(collector);
  System.out.println(DataType.findTypeName(mod1.getType()));
  assertEquals(DataType.LONG,mod1.getType());
  assertTrue(mod1.getLhs() instanceof CastExpression);
  assertEquals(DataType.LONG,((CastExpression)mod1.getLhs()).getType());
  assertEquals(constant1,((CastExpression)mod1.getLhs()).getExpression());
}

</code></pre>

<pre class="type-13 type-7 type-6 type-4 type-5 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testMapLookupCast() throws Exception {
  String input[]={"[k1#hello,k2#bye]","[k1#good,k2#morning]"};
  PigServer ps=new PigServer(ExecType.LOCAL);
  File f=org.apache.pig.test.Util.createInputFile("test",".txt",input);
  String inputFileName=Util.generateURI(f.getAbsolutePath(),ps.getPigContext());
  String query="a= load '" + inputFileName + "' as (m);"+ " b = foreach a generate m#'k1';";
  checkLastForeachCastLoadFunc(query,"org.apache.pig.builtin.PigStorage",0);
  query="a= load '" + inputFileName + "' as (m:[]);"+ "b = foreach a generate m#'k1';";
  LOForEach foreach=getForeachFromPlan(query);
  LOGenerate loGen=(LOGenerate)foreach.getInnerPlan().getSinks().get(0);
  Operator outExp=loGen.getOutputPlans().get(0).getSources().get(0);
  assertFalse("outExp is not cast",outExp instanceof CastExpression);
  ps.registerQuery("a = load '" + inputFileName + "' as (m);");
  ps.registerQuery("b = foreach a generate m#'k1';");
  Iterator<Tuple> it=ps.openIterator("b");
  String[] expectedResults=new String[]{"(hello)","(good)"};
  int i=0;
  while (it.hasNext()) {
    assertEquals(expectedResults[i++],it.next().toString());
  }
  ps.registerQuery("a = load '" + inputFileName + "' as (m:[]);");
  ps.registerQuery("b = foreach a generate m#'k1';");
  it=ps.openIterator("b");
  expectedResults=new String[]{"(hello)","(good)"};
  i=0;
  while (it.hasNext()) {
    assertEquals(expectedResults[i++],it.next().toString());
  }
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * From JIRA 1482
 * @throws FrontendException
 */
@Test public void testLineageMultipleLoader2() throws FrontendException {
  String query="A = LOAD 'data1' USING PigStorage() AS (s, m, l);" + "B = FOREACH A GENERATE s#'k1' as v1, m#'k2' as v2, l#'k3' as v3;" + "C = FOREACH B GENERATE v1, (v2 == 'v2' ? 1L : 0L) as v2:long, (v3 == 'v3' ? 1 :0) as v3:int;"+ "D = LOAD 'data2' USING TextLoader() AS (a);"+ "E = JOIN C BY v1, D BY a USING 'replicated';"+ "F = GROUP E BY (v1, a);"+ "G = FOREACH F GENERATE (chararray)group.v1, group.a;";
  checkLastForeachCastLoadFunc(query,"PigStorage",0);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testCogroupStarLineageFail() throws Throwable {
  String query="a = load 'a' using PigStorage('x') as (field1, field2: float, field3: chararray );" + "b = load 'b' using PigStorage('x') as (field4, field5, field6: chararray );" + "c = cogroup a by *, b by *;"+ "d = foreach c generate group, flatten($1), flatten($2);"+ "e = foreach d generate group + 1, field1 + 1, field4 + 2.0;";
  LogicalPlan plan=generateLogicalPlan(query);
  new ColumnAliasConversionVisitor(plan).visit();
  CompilationMessageCollector collector=new CompilationMessageCollector();
  try {
    TypeCheckingRelVisitor typeChecker=new TypeCheckingRelVisitor(plan,collector);
    typeChecker.visit();
    fail("exception expected");
  }
 catch (  TypeCheckerException pve) {
  }
  printMessageCollector(collector);
  if (!collector.hasError()) {
    throw new AssertionError("Expect error");
  }
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupProjectStarLineage() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = load 'b' using org.apache.pig.test.PigStorageWithDifferentCaster('b') as (field4, field5, field6: chararray );" + "c = cogroup a by field1, b by field4;"+ "d = foreach c generate *;"+ "f = foreach d generate group, flatten(a), flatten(b) ;"+ "g = foreach f generate group, field1 + 1, field4 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')",1);
  checkLastForeachCastLoadFunc(query,"org.apache.pig.test.PigStorageWithDifferentCaster('b')",2);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testExpressionTypeChecking6() throws Throwable {
  LogicalExpressionPlan plan=new LogicalExpressionPlan();
  ConstantExpression constant1=new ConstantExpression(plan,"10");
  ConstantExpression constant2=new ConstantExpression(plan,20L);
  AddExpression add1=new AddExpression(plan,constant1,constant2);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  LogicalRelationalOperator dummyRelOp=createDummyRelOpWithAlias();
  TypeCheckingExpVisitor expTypeChecker=new TypeCheckingExpVisitor(plan,collector,dummyRelOp);
  try {
    expTypeChecker.visit();
    fail("Exception expected");
  }
 catch (  TypeCheckerException pve) {
    String msg="In alias dummy, incompatible types in " + "Add Operator left hand side:chararray right hand side:long";
    checkMessageInException(pve,msg);
  }
  printMessageCollector(collector);
  if (!collector.hasError()) {
    throw new AssertionError("Error expected");
  }
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupFilterLineageNoSchema() throws Throwable {
  String query="a = load 'a' using PigStorage('a');" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b');" + "c = cogroup a by $0, b by $0;"+ "d = foreach c generate group, flatten(a), flatten(b) ;"+ "e = filter d by $2 > 5;"+ "f = foreach e generate $1, $1 + 1, $2 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,null,1);
  checkLastForeachCastLoadFunc(query,null,2);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testJoinLineage() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b') as (field4, field5, field6: chararray );" + "c = join a by field1, b by field4;"+ "d = foreach c generate field1 + 1, field4 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')",0);
  checkLastForeachCastLoadFunc(query,"org.apache.pig.test.PigStorageWithDifferentCaster('b')",1);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testJoinLineageNoSchemaFail() throws Throwable {
  String query="a = load 'a' using PigStorage('a');" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster();" + "c = join a by $0, b by $0;"+ "d = foreach c generate $1 + 2.0 ;";
  checkWarning(query,CAST_LOAD_NOT_FOUND);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCrossLineageNoSchema() throws Throwable {
  String query="a = load 'a' using PigStorage('a');" + "b = load 'a' using PigStorage('a');" + "c = cross a , b;"+ "d = foreach c generate $1 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')");
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testSplitLineage1() throws Throwable {
  String query="a = load 'a' as (field1, field2, field3: chararray );" + "split a into b if field2 > 1.0, c if field2 <= 1.0;" + "d = foreach b generate field1 + 1.0;"+ "e = foreach c generate field1 + 1.0;";
  LogicalPlan plan=createAndProcessLPlan(query);
  checkLoaderInCasts(plan,"org.apache.pig.builtin.PigStorage");
}

</code></pre>

<pre class="type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCOGroupWithInnerPlan1GroupByAtom1() throws Throwable {
  printCurrentMethodName();
  LogicalPlan plan=new LogicalPlan();
  String pigStorage=PigStorage.class.getName();
  LOLoad load1=newLOLoad(new FileSpec("pi",new FuncSpec(pigStorage)),null,plan,new Configuration(ConfigurationUtil.toConfiguration(pc.getFs().getConfiguration())));
  LOLoad load2=newLOLoad(new FileSpec("pi",new FuncSpec(pigStorage)),null,plan,new Configuration(ConfigurationUtil.toConfiguration(pc.getFs().getConfiguration())));
  Schema inputSchema1=null;
{
    List<FieldSchema> fsList1=new ArrayList<FieldSchema>();
    fsList1.add(new FieldSchema("field1a",DataType.INTEGER));
    fsList1.add(new FieldSchema("field2a",DataType.LONG));
    inputSchema1=new Schema(fsList1);
  }
  Schema inputSchema2=null;
{
    List<FieldSchema> fsList2=new ArrayList<FieldSchema>();
    fsList2.add(new FieldSchema("field1b",DataType.DOUBLE));
    fsList2.add(new FieldSchema(null,DataType.INTEGER));
    inputSchema2=new Schema(fsList2);
  }
  load1.setScriptSchema(org.apache.pig.newplan.logical.Util.translateSchema((inputSchema1)));
  ;
  load2.setScriptSchema(org.apache.pig.newplan.logical.Util.translateSchema((inputSchema2)));
  LOCogroup cogroup1=new LOCogroup(plan);
  LogicalExpressionPlan innerPlan11=new LogicalExpressionPlan();
  ProjectExpression project111=new ProjectExpression(innerPlan11,0,0,cogroup1);
  ConstantExpression const111=new ConstantExpression(innerPlan11,26F);
  SubtractExpression subtract111=new SubtractExpression(innerPlan11,project111,const111);
  LogicalExpressionPlan innerPlan12=new LogicalExpressionPlan();
  ProjectExpression project121=new ProjectExpression(innerPlan12,1,0,cogroup1);
  ConstantExpression const121=new ConstantExpression(innerPlan12,26);
  SubtractExpression subtract121=new SubtractExpression(innerPlan12,project121,const121);
  ArrayList<LogicalRelationalOperator> inputs=new ArrayList<LogicalRelationalOperator>();
  inputs.add(load1);
  inputs.add(load2);
  MultiMap<Integer,LogicalExpressionPlan> maps=new MultiMap<Integer,LogicalExpressionPlan>();
  maps.put(0,innerPlan11);
  maps.put(1,innerPlan12);
  boolean[] isInner=new boolean[inputs.size()];
  for (int i=0; i < isInner.length; i++) {
    isInner[i]=false;
  }
  cogroup1.setInnerFlags(isInner);
  cogroup1.setExpressionPlans(maps);
  plan.add(load1);
  plan.add(load2);
  plan.add(cogroup1);
  plan.connect(load1,cogroup1);
  plan.connect(load2,cogroup1);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingRelVisitor typeChecker=new TypeCheckingRelVisitor(plan,collector);
  typeChecker.visit();
  printMessageCollector(collector);
  if (collector.hasError()) {
    throw new AssertionError("Expect no error");
  }
  LogicalSchema endResultSchema=cogroup1.getSchema();
  assertEquals(DataType.DOUBLE,endResultSchema.getField(0).type);
  assertEquals(DataType.BAG,endResultSchema.getField(1).type);
  assertEquals(DataType.BAG,endResultSchema.getField(2).type);
  LogicalSchema innerSchema1=endResultSchema.getField(1).schema.getField(0).schema;
  assertEquals(DataType.INTEGER,innerSchema1.getField(0).type);
  assertEquals(DataType.LONG,innerSchema1.getField(1).type);
  LogicalSchema innerSchema2=endResultSchema.getField(2).schema.getField(0).schema;
  assertEquals(DataType.DOUBLE,innerSchema2.getField(0).type);
  assertEquals(DataType.INTEGER,innerSchema2.getField(1).type);
  assertEquals(DataType.DOUBLE,getSingleOutput(innerPlan11).getType());
  assertEquals(DataType.DOUBLE,getSingleOutput(innerPlan12).getType());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testFilterLineage1NoSchema() throws Throwable {
  String query="a = load 'a';" + "b = filter a by $0 > 1.0;" + "c = foreach b generate $1 + 1.0;";
  checkLastForeachCastLoadFunc(query,"org.apache.pig.builtin.PigStorage");
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupSplitLineage() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b') as (field4, field5, field6: chararray );" + "c = cogroup a by field1, b by field4;"+ "d = foreach c generate group, flatten(a), flatten(b) ;"+ "split d into e if field4 > 'm', f if field6 > 'm' ;"+ "g = foreach e generate group, field1 + 1, field4 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')",1);
  checkLastForeachCastLoadFunc(query,"org.apache.pig.test.PigStorageWithDifferentCaster('b')",2);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUnionLineageNoSchema() throws Throwable {
  String query="a = load 'a' using PigStorage('a');" + "b = load 'a' using PigStorage('a');" + "c = union a , b;"+ "d = foreach c generate $1 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')");
}

</code></pre>

<pre class="type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testForEachGenerate4() throws Throwable {
  printCurrentMethodName();
  LogicalPlan plan=new LogicalPlan();
  LOLoad load1=genDummyLOLoadNewLP(plan);
  String[] aliases=new String[]{"a","b","c"};
  byte[] types=new byte[]{DataType.INTEGER,DataType.LONG,DataType.BYTEARRAY};
  Schema innerSchema1=genFlatSchemaInTuple(aliases,types);
  Schema inputSchema1=null;
{
    List<FieldSchema> fsList1=new ArrayList<FieldSchema>();
    fsList1.add(new FieldSchema("field1a",DataType.INTEGER));
    fsList1.add(new FieldSchema("field2a",DataType.LONG));
    fsList1.add(new FieldSchema("field3a",innerSchema1,DataType.BAG));
    inputSchema1=new Schema(fsList1);
  }
  load1.setScriptSchema(org.apache.pig.newplan.logical.Util.translateSchema((inputSchema1)));
  ;
  LogicalPlan innerRelPlan=new LogicalPlan();
  LOForEach foreach1=new LOForEach(plan);
  foreach1.setInnerPlan(innerRelPlan);
  LOGenerate loGen=new LOGenerate(innerRelPlan);
  innerRelPlan.add(loGen);
  LOInnerLoad innerLoad1=new LOInnerLoad(innerRelPlan,foreach1,2);
  innerRelPlan.add(innerLoad1);
  innerRelPlan.connect(innerLoad1,loGen);
  LogicalExpressionPlan innerPlan1=new LogicalExpressionPlan();
  ProjectExpression project11=new ProjectExpression(innerPlan1,0,2,loGen);
  List<Integer> projections1=new ArrayList<Integer>();
  projections1.add(1);
  projections1.add(2);
  DereferenceExpression project12=new DereferenceExpression(innerPlan1,projections1);
  innerPlan1.connect(project12,project11);
  LogicalExpressionPlan innerPlan2=new LogicalExpressionPlan();
  innerLoad1=new LOInnerLoad(innerRelPlan,foreach1,0);
  innerRelPlan.add(innerLoad1);
  innerRelPlan.connect(innerLoad1,loGen);
  ProjectExpression project21=new ProjectExpression(innerPlan2,1,0,loGen);
  innerLoad1=new LOInnerLoad(innerRelPlan,foreach1,1);
  innerRelPlan.add(innerLoad1);
  innerRelPlan.connect(innerLoad1,loGen);
  ProjectExpression project22=new ProjectExpression(innerPlan2,2,0,loGen);
  AddExpression add21=new AddExpression(innerPlan2,project21,project22);
  ArrayList<LogicalExpressionPlan> generatePlans=new ArrayList<LogicalExpressionPlan>();
  generatePlans.add(innerPlan1);
  generatePlans.add(innerPlan2);
  boolean[] flattens={true,false};
  loGen.setFlattenFlags(flattens);
  loGen.setOutputPlans(generatePlans);
  plan.add(load1);
  plan.add(foreach1);
  plan.connect(load1,foreach1);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  TypeCheckingRelVisitor typeChecker=new TypeCheckingRelVisitor(plan,collector);
  typeChecker.visit();
  printMessageCollector(collector);
  if (collector.hasError()) {
    throw new AssertionError("Expect no  error");
  }
  LogicalSchema endResultSchema=foreach1.getSchema();
  assertEquals(DataType.LONG,endResultSchema.getField(0).type);
  assertEquals(DataType.BYTEARRAY,endResultSchema.getField(1).type);
  assertEquals(DataType.LONG,endResultSchema.getField(2).type);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupStarLineage1() throws Throwable {
  String query="a = load 'a' using PigStorage('x') as (field1, field2: float, field3: chararray );" + "b = load 'b' using PigStorage('x') as (field4, field5, field6: chararray );" + "c = cogroup a by *, b by *;"+ "d = foreach c generate flatten(group), flatten($1), flatten($2);"+ "e = foreach d generate $0 + 1, a::field1 + 1, field4 + 2.0;";
  checkLastForeachCastLoadFunc(query,"PigStorage('x')",0);
  checkLastForeachCastLoadFunc(query,"PigStorage('x')",1);
  checkLastForeachCastLoadFunc(query,"PigStorage('x')",2);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupStarLineage() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = load 'b' using org.apache.pig.test.PigStorageWithDifferentCaster('b') as (field4, field5, field6: chararray );" + "c = cogroup a by *, b by *;"+ "d = foreach c generate group, flatten($1), flatten($2);"+ "e = foreach d generate group, field1 + 1, field4 + 2.0;";
  checkLastForeachCastLoadFunc(query,"PigStorage('a')",1);
  checkLastForeachCastLoadFunc(query,"org.apache.pig.test.PigStorageWithDifferentCaster('b')",2);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCompareBagFail() throws Throwable {
  String query="a = load 'a' as (t1 :bag{()}, t2 : bag{()});" + "b = filter a by t1 <= t2;";
  String exMsg="In alias b, incompatible types in LessThanEqual " + "Operator left hand side:bag :tuple()  right hand side:bag :tuple()";
  checkExceptionMessage(query,"b",exMsg);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testDistinctLineage() throws Throwable {
  String query="a = load 'a' as (field1, field2: float, field3: chararray );" + "b = distinct a;" + "c = foreach b generate field1 + 1.0;";
  checkLastForeachCastLoadFunc(query,"org.apache.pig.builtin.PigStorage");
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testStreamingLineage2() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1: int, field2: float, field3: chararray );" + "b = stream a through `" + simpleEchoStreamingCommand + "` as (f1, f2: float);"+ "c = foreach b generate f1 + 1.0, f2 + 4;";
  checkLastForeachCastLoadFunc(query,"org.apache.pig.builtin.PigStreaming",0);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testUnionLineage() throws Throwable {
  String query="a = load 'a' using PigStorage('a') as (field1, field2: float, field3: chararray );" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b') as (field4, field5, field6: chararray );" + "c = union a , b;"+ "d = foreach c generate field2 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,null);
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testExpressionTypeChecking7() throws Throwable {
  LogicalExpressionPlan plan=new LogicalExpressionPlan();
  ConstantExpression constant1=new ConstantExpression(plan,10);
  ConstantExpression constant2=new ConstantExpression(plan,20D);
  ConstantExpression constant3=new ConstantExpression(plan,123L);
  GreaterThanExpression gt1=new GreaterThanExpression(plan,constant1,constant2);
  EqualExpression equal1=new EqualExpression(plan,gt1,constant3);
  CompilationMessageCollector collector=new CompilationMessageCollector();
  LogicalRelationalOperator dummyRelOp=createDummyRelOpWithAlias();
  TypeCheckingExpVisitor expTypeChecker=new TypeCheckingExpVisitor(plan,collector,dummyRelOp);
  try {
    expTypeChecker.visit();
    fail("Exception expected");
  }
 catch (  TypeCheckerException pve) {
  }
  printMessageCollector(collector);
  if (!collector.hasError()) {
    throw new AssertionError("Error expected");
  }
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupSplitLineageNoSchema() throws Throwable {
  String query="a = load 'a' using PigStorage('a');" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster('b');" + "c = cogroup a by $0, b by $0;"+ "d = foreach c generate group, flatten(a), flatten(b) ;"+ "split d into e if $1 > 'm', f if $1 > 'm' ;"+ "g = foreach d generate $0, $1 + 1, $2 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,null,1);
  checkLastForeachCastLoadFunc(query,null,2);
}

</code></pre>

<pre class="type-7 type-2 type-5 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCompareEqualityTupleCast() throws Throwable {
  String query="a = load 'a' as (t : (i : int, j : int), col);" + "b = filter a by t == col;";
  CastExpression castExp=getCastFromLastFilter(query);
  assertNotNull("cast ",castExp);
  assertEquals("cast type",DataType.TUPLE,castExp.getType());
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testJoinIncompatType() throws IOException {
  String query="a = load '1.txt' as (a0:map [], a1:int);" + "b = load '2.txt' as (a0:int, a1:int);" + "c = join a by (a0, a1), b by (a0,a1);";
  String msg="join column no. 1 in relation no. 2 of  join statement" + " has datatype int which is incompatible with type of" + " corresponding column in earlier relation(s) in the statement";
  Util.checkExceptionMessage(query,"c",msg);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * In case of filter with tuple type
 */
@Test public void testLineageFilterWithTuple() throws FrontendException {
  String query="A= LOAD 'data1' USING PigStorage() AS (u, v, w:tuple(a,b));" + "B = FOREACH A generate v, w;" + "C = FILTER B by v < 50;"+ "D = FOREACH C generate (int)w.a;";
  checkLastForeachCastLoadFunc(query,"PigStorage",0);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
/** 
 * A special invalid case.
 */
@Test public void testLineageMultipleLoader3() throws FrontendException {
  String query="A = LOAD 'data1' USING PigStorage() AS (u, v, w);" + "B = LOAD 'data2' USING TextLoader() AS (x, y);" + "C = COGROUP A BY u, B by x;"+ "D = FOREACH C GENERATE (chararray)group;";
  checkWarning(query,CAST_LOAD_NOT_FOUND);
}

</code></pre>

<pre class="type-7 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testLineage2() throws Throwable {
  String query="a = load 'a' as (field1, field2: float, field3: chararray );" + "b = foreach a generate field1 + 1.0;";
  CastExpression cast=getCastFromLastForeach(query);
  assertTrue(cast.getFuncSpec().getClassName().startsWith("org.apache.pig.builtin.PigStorage"));
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCogroupDistinctLineageNoSchema() throws Throwable {
  String query="a = load 'a' using PigStorage('a');" + "b = load 'a' using org.apache.pig.test.PigStorageWithDifferentCaster();" + "c = cogroup a by $0, b by $0;"+ "d = foreach c generate group, flatten(a), flatten(b) ;"+ "e = distinct d;"+ "f = foreach e generate $0, $1 + 1, $2 + 2.0 ;";
  checkLastForeachCastLoadFunc(query,null,1);
  checkLastForeachCastLoadFunc(query,null,2);
}

</code></pre>

<pre class="type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCastEmptyInnerSchema() throws IOException, ParserException {
  final String INP_FILE="testCastEmptyInnerSchema.txt";
  PrintWriter w=new PrintWriter(new FileWriter(INP_FILE));
  w.println("(1,2)");
  w.println("(2,3)");
  w.close();
  PigServer pigServer=new PigServer(LOCAL);
  String query="a = load '" + INP_FILE + "' as (t:tuple());"+ "b = foreach a generate (tuple(int, long))t;"+ "c = foreach b generate t.$0 + t.$1;";
  Util.registerMultiLineQuery(pigServer,query);
  List<Tuple> expectedRes=Util.getTuplesFromConstantTupleStrings(new String[]{"(3L)","(5L)"});
  Iterator<Tuple> it=pigServer.openIterator("c");
  Util.checkQueryOutputs(it,expectedRes);
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
