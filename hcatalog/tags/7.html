<h3><span class=" glyphicon glyphicon-tag"/>&nbspAPIUtilityVerifier</h3><kbd>Verifies values of objects/variables related to API calls (Java or TPL) </kbd><br><br><br><h4 style="margin:0px">Class: org.apache.hcatalog.cli.TestSemanticAnalysis </h4><pre class="type-7 type-1 type-2 type-4 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCreateTableIfNotExists() throws MetaException, TException, NoSuchObjectException, CommandNeedRetryException {
  hcatDriver.run("drop table " + TBL_NAME);
  hcatDriver.run("create table junit_sem_analysis (a int) stored as RCFILE");
  Table tbl=client.getTable(MetaStoreUtils.DEFAULT_DATABASE_NAME,TBL_NAME);
  List<FieldSchema> cols=tbl.getSd().getCols();
  assertEquals(1,cols.size());
  assertTrue(cols.get(0).equals(new FieldSchema("a","int",null)));
  assertEquals(RCFileInputFormat.class.getName(),tbl.getSd().getInputFormat());
  assertEquals(RCFileOutputFormat.class.getName(),tbl.getSd().getOutputFormat());
  CommandProcessorResponse resp=hcatDriver.run("create table if not exists junit_sem_analysis (a int) stored as RCFILE");
  assertEquals(0,resp.getResponseCode());
  assertNull(resp.getErrorMessage());
  tbl=client.getTable(MetaStoreUtils.DEFAULT_DATABASE_NAME,TBL_NAME);
  cols=tbl.getSd().getCols();
  assertEquals(1,cols.size());
  assertTrue(cols.get(0).equals(new FieldSchema("a","int",null)));
  assertEquals(RCFileInputFormat.class.getName(),tbl.getSd().getInputFormat());
  assertEquals(RCFileOutputFormat.class.getName(),tbl.getSd().getOutputFormat());
  hcatDriver.run("drop table junit_sem_analysis");
}

</code></pre>

<br>
<pre class="type-7 type-2 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCreateTblWithLowerCasePartNames() throws CommandNeedRetryException, MetaException, TException, NoSuchObjectException {
  driver.run("drop table junit_sem_analysis");
  CommandProcessorResponse resp=driver.run("create table junit_sem_analysis (a int) partitioned by (B string) stored as TEXTFILE");
  assertEquals(resp.getResponseCode(),0);
  assertEquals(null,resp.getErrorMessage());
  Table tbl=client.getTable(MetaStoreUtils.DEFAULT_DATABASE_NAME,TBL_NAME);
  assertEquals("Partition key name case problem","b",tbl.getPartitionKeys().get(0).getName());
  driver.run("drop table junit_sem_analysis");
}

</code></pre>

<br>
<pre class="type-7 type-2 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAlterTblFFpart() throws MetaException, TException, NoSuchObjectException, CommandNeedRetryException {
  driver.run("drop table junit_sem_analysis");
  driver.run("create table junit_sem_analysis (a int) partitioned by (b string) stored as TEXTFILE");
  driver.run("alter table junit_sem_analysis add partition (b='2010-10-10')");
  hcatDriver.run("alter table junit_sem_analysis partition (b='2010-10-10') set fileformat RCFILE");
  Table tbl=client.getTable(MetaStoreUtils.DEFAULT_DATABASE_NAME,TBL_NAME);
  assertEquals(TextInputFormat.class.getName(),tbl.getSd().getInputFormat());
  assertEquals(HiveIgnoreKeyTextOutputFormat.class.getName(),tbl.getSd().getOutputFormat());
  List<String> partVals=new ArrayList<String>(1);
  partVals.add("2010-10-10");
  Partition part=client.getPartition(MetaStoreUtils.DEFAULT_DATABASE_NAME,TBL_NAME,partVals);
  assertEquals(RCFileInputFormat.class.getName(),part.getSd().getInputFormat());
  assertEquals(RCFileOutputFormat.class.getName(),part.getSd().getOutputFormat());
  hcatDriver.run("drop table junit_sem_analysis");
}

</code></pre>

<br>
<pre class="type-7 type-1 type-2 type-4 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testAddReplaceCols() throws IOException, MetaException, TException, NoSuchObjectException, CommandNeedRetryException {
  hcatDriver.run("drop table junit_sem_analysis");
  hcatDriver.run("create table junit_sem_analysis (a int, c string) partitioned by (b string) stored as RCFILE");
  CommandProcessorResponse response=hcatDriver.run("alter table junit_sem_analysis replace columns (a1 tinyint)");
  assertEquals(0,response.getResponseCode());
  response=hcatDriver.run("alter table junit_sem_analysis add columns (d tinyint)");
  assertEquals(0,response.getResponseCode());
  assertNull(response.getErrorMessage());
  response=hcatDriver.run("describe extended junit_sem_analysis");
  assertEquals(0,response.getResponseCode());
  Table tbl=client.getTable(MetaStoreUtils.DEFAULT_DATABASE_NAME,TBL_NAME);
  List<FieldSchema> cols=tbl.getSd().getCols();
  assertEquals(2,cols.size());
  assertTrue(cols.get(0).equals(new FieldSchema("a1","tinyint",null)));
  assertTrue(cols.get(1).equals(new FieldSchema("d","tinyint",null)));
  hcatDriver.run("drop table junit_sem_analysis");
}

</code></pre>

<br>
<pre class="type-7 type-2 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAlterTableSetFF() throws IOException, MetaException, TException, NoSuchObjectException, CommandNeedRetryException {
  hcatDriver.run("drop table junit_sem_analysis");
  hcatDriver.run("create table junit_sem_analysis (a int) partitioned by (b string) stored as RCFILE");
  Table tbl=client.getTable(MetaStoreUtils.DEFAULT_DATABASE_NAME,TBL_NAME);
  assertEquals(RCFileInputFormat.class.getName(),tbl.getSd().getInputFormat());
  assertEquals(RCFileOutputFormat.class.getName(),tbl.getSd().getOutputFormat());
  hcatDriver.run("alter table junit_sem_analysis set fileformat INPUTFORMAT 'org.apache.hadoop.hive.ql.io.RCFileInputFormat' OUTPUTFORMAT " + "'org.apache.hadoop.hive.ql.io.RCFileOutputFormat' inputdriver 'mydriver' outputdriver 'yourdriver'");
  hcatDriver.run("desc extended junit_sem_analysis");
  tbl=client.getTable(MetaStoreUtils.DEFAULT_DATABASE_NAME,TBL_NAME);
  assertEquals(RCFileInputFormat.class.getName(),tbl.getSd().getInputFormat());
  assertEquals(RCFileOutputFormat.class.getName(),tbl.getSd().getOutputFormat());
  hcatDriver.run("drop table junit_sem_analysis");
}

</code></pre>

<br>
<pre class="type-7 type-2 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAddDriverInfo() throws IOException, MetaException, TException, NoSuchObjectException, CommandNeedRetryException {
  hcatDriver.run("drop table junit_sem_analysis");
  query="create table junit_sem_analysis (a int) partitioned by (b string)  stored as " + "INPUTFORMAT 'org.apache.hadoop.hive.ql.io.RCFileInputFormat' OUTPUTFORMAT " + "'org.apache.hadoop.hive.ql.io.RCFileOutputFormat' inputdriver 'mydriver' outputdriver 'yourdriver' ";
  assertEquals(0,hcatDriver.run(query).getResponseCode());
  Table tbl=client.getTable(MetaStoreUtils.DEFAULT_DATABASE_NAME,TBL_NAME);
  assertEquals(RCFileInputFormat.class.getName(),tbl.getSd().getInputFormat());
  assertEquals(RCFileOutputFormat.class.getName(),tbl.getSd().getOutputFormat());
  hcatDriver.run("drop table junit_sem_analysis");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hcatalog.common.TestHCatUtil </h4><pre class="type-7 type-11 type-9 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testFsPermissionOperation(){
  HashMap<String,Integer> permsCode=new HashMap<String,Integer>();
  for (int i=0; i < 8; i++) {
    for (int j=0; j < 8; j++) {
      for (int k=0; k < 8; k++) {
        StringBuilder sb=new StringBuilder();
        sb.append("0");
        sb.append(i);
        sb.append(j);
        sb.append(k);
        Integer code=(((i * 8) + j) * 8) + k;
        String perms=(new FsPermission(Short.decode(sb.toString()))).toString();
        if (permsCode.containsKey(perms)) {
          Assert.assertEquals("permissions(" + perms + ") mapped to multiple codes",code,permsCode.get(perms));
        }
        permsCode.put(perms,code);
        assertFsPermissionTransformationIsGood(perms);
      }
    }
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hcatalog.common.TestHiveClientCache </h4><pre class="type-7 type-12 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether two objects/variables are the same
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Check that a *new* client is created if asked from different threads even with
 * the same hive configuration
 * @throws ExecutionException
 * @throws InterruptedException
 */
@Test public void testMultipleThreadAccess() throws ExecutionException, InterruptedException {
  final HiveClientCache cache=new HiveClientCache(1000);
class GetHiveClient implements Callable<HiveMetaStoreClient> {
    @Override public HiveMetaStoreClient call() throws IOException, MetaException, LoginException {
      return cache.get(hiveConf);
    }
  }
  ExecutorService executor=Executors.newFixedThreadPool(2);
  Callable<HiveMetaStoreClient> worker1=new GetHiveClient();
  Callable<HiveMetaStoreClient> worker2=new GetHiveClient();
  Future<HiveMetaStoreClient> clientFuture1=executor.submit(worker1);
  Future<HiveMetaStoreClient> clientFuture2=executor.submit(worker2);
  HiveMetaStoreClient client1=clientFuture1.get();
  HiveMetaStoreClient client2=clientFuture2.get();
  assertNotNull(client1);
  assertNotNull(client2);
  assertNotSame(client1,client2);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hcatalog.data.TestLazyHCatRecord </h4><pre class="type-7 type-2 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetWithName() throws Exception {
  TypeInfo ti=getTypeInfo();
  HCatRecord r=new LazyHCatRecord(getHCatRecord(),getObjectInspector(ti));
  HCatSchema schema=HCatSchemaUtils.getHCatSchema(ti).get(0).getStructSubSchema();
  Assert.assertEquals(INT_CONST,((Integer)r.get("an_int",schema)).intValue());
  Assert.assertEquals(LONG_CONST,((Long)r.get("a_long",schema)).longValue());
  Assert.assertEquals(DOUBLE_CONST,((Double)r.get("a_double",schema)).doubleValue(),0);
  Assert.assertEquals(STRING_CONST,(String)r.get("a_string",schema));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hcatalog.hbase.TestHBaseBulkOutputFormat </h4><pre class="type-7 type-11 type-1 type-2 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void importSequenceFileTest() throws IOException, ClassNotFoundException, InterruptedException {
  String testName="importSequenceFileTest";
  Path methodTestDir=new Path(getTestDir(),testName);
  LOG.info("starting: " + testName);
  String tableName=newTableName(testName).toLowerCase();
  String familyName="my_family";
  byte[] familyNameBytes=Bytes.toBytes(familyName);
  Configuration conf=new Configuration(allConf);
  createTable(tableName,new String[]{familyName});
  String data[]={"1,english:one,spanish:uno","2,english:two,spanish:dos","3,english:three,spanish:tres"};
  Path inputPath=new Path(methodTestDir,"mr_input");
  getFileSystem().mkdirs(inputPath);
  FSDataOutputStream os=getFileSystem().create(new Path(inputPath,"inputFile.txt"));
  for (  String line : data)   os.write(Bytes.toBytes(line + "\n"));
  os.close();
  Path interPath=new Path(methodTestDir,"inter");
  Path scratchPath=new Path(methodTestDir,"scratch");
  Job job=new Job(conf,testName);
  job.setWorkingDirectory(new Path(methodTestDir,"mr_work"));
  job.setJarByClass(this.getClass());
  job.setMapperClass(MapWrite.class);
  job.setInputFormatClass(TextInputFormat.class);
  TextInputFormat.setInputPaths(job,inputPath);
  job.setOutputFormatClass(SequenceFileOutputFormat.class);
  SequenceFileOutputFormat.setOutputPath(job,interPath);
  job.setMapOutputKeyClass(ImmutableBytesWritable.class);
  job.setMapOutputValueClass(Put.class);
  job.setOutputKeyClass(ImmutableBytesWritable.class);
  job.setOutputValueClass(Put.class);
  job.setNumReduceTasks(0);
  assertTrue(job.waitForCompletion(true));
  job=new Job(new Configuration(allConf),testName + "_importer");
  assertTrue(ImportSequenceFile.runJob(job,tableName,interPath,scratchPath));
  HTable table=new HTable(conf,tableName);
  Scan scan=new Scan();
  scan.addFamily(familyNameBytes);
  ResultScanner scanner=table.getScanner(scan);
  int index=0;
  for (  Result result : scanner) {
    String vals[]=data[index].toString().split(",");
    for (int i=1; i < vals.length; i++) {
      String pair[]=vals[i].split(":");
      assertTrue(result.containsColumn(familyNameBytes,Bytes.toBytes(pair[0])));
      assertEquals(pair[1],Bytes.toString(result.getValue(familyNameBytes,Bytes.toBytes(pair[0]))));
    }
    index++;
  }
  assertEquals(data.length,index);
  assertFalse(FileSystem.get(job.getConfiguration()).exists(scratchPath));
}

</code></pre>

<br>
<pre class="type-7 type-11 type-1 type-2 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void bulkModeHCatOutputFormatTest() throws Exception {
  String testName="bulkModeHCatOutputFormatTest";
  Path methodTestDir=new Path(getTestDir(),testName);
  LOG.info("starting: " + testName);
  String databaseName=testName.toLowerCase();
  String dbDir=new Path(methodTestDir,"DB_" + testName).toString();
  String tableName=newTableName(testName).toLowerCase();
  String familyName="my_family";
  byte[] familyNameBytes=Bytes.toBytes(familyName);
  Configuration conf=new Configuration(allConf);
  conf.set(HCatConstants.HCAT_KEY_HIVE_CONF,HCatUtil.serialize(allConf.getAllProperties()));
  String dbquery="CREATE DATABASE IF NOT EXISTS " + databaseName + " LOCATION '"+ dbDir+ "'";
  String tableQuery="CREATE TABLE " + databaseName + "."+ tableName+ "(key int, english string, spanish string) STORED BY "+ "'org.apache.hcatalog.hbase.HBaseHCatStorageHandler'"+ "TBLPROPERTIES ('"+ HBaseConstants.PROPERTY_BULK_OUTPUT_MODE_KEY+ "'='true',"+ "'hbase.columns.mapping'=':key,"+ familyName+ ":english,"+ familyName+ ":spanish')";
  assertEquals(0,hcatDriver.run(dbquery).getResponseCode());
  assertEquals(0,hcatDriver.run(tableQuery).getResponseCode());
  String data[]={"1,english:ONE,spanish:UNO","2,english:TWO,spanish:DOS","3,english:THREE,spanish:TRES"};
  Path inputPath=new Path(methodTestDir,"mr_input");
  getFileSystem().mkdirs(inputPath);
  for (int i=0; i < data.length; i++) {
    FSDataOutputStream os=getFileSystem().create(new Path(inputPath,"inputFile" + i + ".txt"));
    os.write(Bytes.toBytes(data[i] + "\n"));
    os.close();
  }
  Job job=new Job(conf,testName);
  job.setWorkingDirectory(new Path(methodTestDir,"mr_work"));
  job.setJarByClass(this.getClass());
  job.setMapperClass(MapHCatWrite.class);
  job.setInputFormatClass(TextInputFormat.class);
  TextInputFormat.setInputPaths(job,inputPath);
  job.setOutputFormatClass(HCatOutputFormat.class);
  OutputJobInfo outputJobInfo=OutputJobInfo.create(databaseName,tableName,null);
  HCatOutputFormat.setOutput(job,outputJobInfo);
  job.setMapOutputKeyClass(BytesWritable.class);
  job.setMapOutputValueClass(HCatRecord.class);
  job.setOutputKeyClass(BytesWritable.class);
  job.setOutputValueClass(HCatRecord.class);
  job.setNumReduceTasks(0);
  assertTrue(job.waitForCompletion(true));
  RevisionManager rm=HBaseRevisionManagerUtil.getOpenedRevisionManager(conf);
  try {
    TableSnapshot snapshot=rm.createSnapshot(databaseName + "." + tableName);
    for (    String el : snapshot.getColumnFamilies()) {
      assertEquals(1,snapshot.getRevision(el));
    }
  }
  finally {
    rm.close();
  }
  HTable table=new HTable(conf,databaseName + "." + tableName);
  Scan scan=new Scan();
  scan.addFamily(familyNameBytes);
  ResultScanner scanner=table.getScanner(scan);
  int index=0;
  for (  Result result : scanner) {
    String vals[]=data[index].toString().split(",");
    for (int i=1; i < vals.length; i++) {
      String pair[]=vals[i].split(":");
      assertTrue(result.containsColumn(familyNameBytes,Bytes.toBytes(pair[0])));
      assertEquals(pair[1],Bytes.toString(result.getValue(familyNameBytes,Bytes.toBytes(pair[0]))));
      assertEquals(1l,result.getColumn(familyNameBytes,Bytes.toBytes(pair[0])).get(0).getTimestamp());
    }
    index++;
  }
  assertEquals(data.length,index);
}

</code></pre>

<br>
<pre class="type-7 type-11 type-1 type-2 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void hbaseBulkOutputFormatTest() throws IOException, ClassNotFoundException, InterruptedException {
  String testName="hbaseBulkOutputFormatTest";
  Path methodTestDir=new Path(getTestDir(),testName);
  LOG.info("starting: " + testName);
  String tableName=newTableName(testName).toLowerCase();
  String familyName="my_family";
  byte[] familyNameBytes=Bytes.toBytes(familyName);
  Configuration conf=new Configuration(allConf);
  conf.set(HBaseConstants.PROPERTY_OUTPUT_TABLE_NAME_KEY,tableName);
  conf.set("yarn.scheduler.capacity.root.queues","default");
  conf.set("yarn.scheduler.capacity.root.default.capacity","100");
  createTable(tableName,new String[]{familyName});
  String data[]={"1,english:one,spanish:uno","2,english:two,spanish:dos","3,english:three,spanish:tres"};
  Path inputPath=new Path(methodTestDir,"mr_input");
  FSDataOutputStream os=getFileSystem().create(new Path(inputPath,"inputFile.txt"));
  for (  String line : data)   os.write(Bytes.toBytes(line + "\n"));
  os.close();
  Path interPath=new Path(methodTestDir,"inter");
  JobConf job=new JobConf(conf);
  job.setWorkingDirectory(new Path(methodTestDir,"mr_work"));
  job.setJarByClass(this.getClass());
  job.setMapperClass(MapWriteOldMapper.class);
  job.setInputFormat(org.apache.hadoop.mapred.TextInputFormat.class);
  org.apache.hadoop.mapred.TextInputFormat.setInputPaths(job,inputPath);
  job.setOutputFormat(HBaseBulkOutputFormat.class);
  org.apache.hadoop.mapred.SequenceFileOutputFormat.setOutputPath(job,interPath);
  job.setOutputCommitter(HBaseBulkOutputCommitter.class);
  RevisionManager rm=HBaseRevisionManagerUtil.getOpenedRevisionManager(conf);
  try {
    OutputJobInfo outputJobInfo=OutputJobInfo.create("default",tableName,null);
    Transaction txn=rm.beginWriteTransaction(tableName,Arrays.asList(familyName));
    outputJobInfo.getProperties().setProperty(HBaseConstants.PROPERTY_WRITE_TXN_KEY,HCatUtil.serialize(txn));
    job.set(HCatConstants.HCAT_KEY_OUTPUT_INFO,HCatUtil.serialize(outputJobInfo));
  }
  finally {
    rm.close();
  }
  job.setMapOutputKeyClass(ImmutableBytesWritable.class);
  job.setMapOutputValueClass(HCatRecord.class);
  job.setOutputKeyClass(ImmutableBytesWritable.class);
  job.setOutputValueClass(HCatRecord.class);
  job.setNumReduceTasks(0);
  RunningJob runJob=JobClient.runJob(job);
  runJob.waitForCompletion();
  assertTrue(runJob.isSuccessful());
  HTable table=new HTable(conf,tableName);
  Scan scan=new Scan();
  scan.addFamily(familyNameBytes);
  ResultScanner scanner=table.getScanner(scan);
  int index=0;
  for (  Result result : scanner) {
    String vals[]=data[index].toString().split(",");
    for (int i=1; i < vals.length; i++) {
      String pair[]=vals[i].split(":");
      assertTrue(result.containsColumn(familyNameBytes,Bytes.toBytes(pair[0])));
      assertEquals(pair[1],Bytes.toString(result.getValue(familyNameBytes,Bytes.toBytes(pair[0]))));
    }
    index++;
  }
  assertEquals(data.length,index);
  assertFalse(FileSystem.get(job).exists(interPath));
}

</code></pre>

<br>
<pre class="type-7 type-11 type-1 type-2 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void bulkModeHCatOutputFormatTestWithDefaultDB() throws Exception {
  String testName="bulkModeHCatOutputFormatTestWithDefaultDB";
  Path methodTestDir=new Path(getTestDir(),testName);
  String databaseName="default";
  String dbDir=new Path(methodTestDir,"DB_" + testName).toString();
  String tableName=newTableName(testName).toLowerCase();
  String familyName="my_family";
  byte[] familyNameBytes=Bytes.toBytes(familyName);
  Configuration conf=new Configuration(allConf);
  conf.set(HCatConstants.HCAT_KEY_HIVE_CONF,HCatUtil.serialize(allConf.getAllProperties()));
  String dbquery="CREATE DATABASE IF NOT EXISTS " + databaseName + " LOCATION '"+ dbDir+ "'";
  String tableQuery="CREATE TABLE " + databaseName + "."+ tableName+ "(key int, english string, spanish string) STORED BY "+ "'org.apache.hcatalog.hbase.HBaseHCatStorageHandler'"+ "TBLPROPERTIES ('"+ HBaseConstants.PROPERTY_BULK_OUTPUT_MODE_KEY+ "'='true',"+ "'hbase.columns.mapping'=':key,"+ familyName+ ":english,"+ familyName+ ":spanish')";
  assertEquals(0,hcatDriver.run(dbquery).getResponseCode());
  assertEquals(0,hcatDriver.run(tableQuery).getResponseCode());
  String data[]={"1,english:ONE,spanish:UNO","2,english:TWO,spanish:DOS","3,english:THREE,spanish:TRES"};
  Path inputPath=new Path(methodTestDir,"mr_input");
  getFileSystem().mkdirs(inputPath);
  FSDataOutputStream os=getFileSystem().create(new Path(inputPath,"inputFile.txt"));
  for (  String line : data)   os.write(Bytes.toBytes(line + "\n"));
  os.close();
  Job job=new Job(conf,testName);
  job.setWorkingDirectory(new Path(methodTestDir,"mr_work"));
  job.setJarByClass(this.getClass());
  job.setMapperClass(MapHCatWrite.class);
  job.setInputFormatClass(TextInputFormat.class);
  TextInputFormat.setInputPaths(job,inputPath);
  job.setOutputFormatClass(HCatOutputFormat.class);
  OutputJobInfo outputJobInfo=OutputJobInfo.create(databaseName,tableName,null);
  HCatOutputFormat.setOutput(job,outputJobInfo);
  job.setMapOutputKeyClass(BytesWritable.class);
  job.setMapOutputValueClass(HCatRecord.class);
  job.setOutputKeyClass(BytesWritable.class);
  job.setOutputValueClass(HCatRecord.class);
  job.setNumReduceTasks(0);
  assertTrue(job.waitForCompletion(true));
  HTable table=new HTable(conf,tableName);
  Scan scan=new Scan();
  scan.addFamily(familyNameBytes);
  ResultScanner scanner=table.getScanner(scan);
  int index=0;
  for (  Result result : scanner) {
    String vals[]=data[index].toString().split(",");
    for (int i=1; i < vals.length; i++) {
      String pair[]=vals[i].split(":");
      assertTrue(result.containsColumn(familyNameBytes,Bytes.toBytes(pair[0])));
      assertEquals(pair[1],Bytes.toString(result.getValue(familyNameBytes,Bytes.toBytes(pair[0]))));
    }
    index++;
  }
  assertEquals(data.length,index);
}

</code></pre>

<br>
<pre class="type-7 type-1 type-2 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void bulkModeAbortTest() throws Exception {
  String testName="bulkModeAbortTest";
  Path methodTestDir=new Path(getTestDir(),testName);
  String databaseName=testName.toLowerCase();
  String dbDir=new Path(methodTestDir,"DB_" + testName).toString();
  String tableName=newTableName(testName).toLowerCase();
  String familyName="my_family";
  Configuration conf=new Configuration(allConf);
  conf.set(HCatConstants.HCAT_KEY_HIVE_CONF,HCatUtil.serialize(allConf.getAllProperties()));
  String dbquery="CREATE DATABASE IF NOT EXISTS " + databaseName + " LOCATION '"+ dbDir+ "'";
  String tableQuery="CREATE TABLE " + databaseName + "."+ tableName+ "(key int, english string, spanish string) STORED BY "+ "'org.apache.hcatalog.hbase.HBaseHCatStorageHandler'"+ "TBLPROPERTIES ('"+ HBaseConstants.PROPERTY_BULK_OUTPUT_MODE_KEY+ "'='true',"+ "'hbase.columns.mapping'=':key,"+ familyName+ ":english,"+ familyName+ ":spanish')";
  assertEquals(0,hcatDriver.run(dbquery).getResponseCode());
  assertEquals(0,hcatDriver.run(tableQuery).getResponseCode());
  String data[]={"1,english:ONE,spanish:UNO","2,english:TWO,spanish:DOS","3,english:THREE,spanish:TRES"};
  Path inputPath=new Path(methodTestDir,"mr_input");
  getFileSystem().mkdirs(inputPath);
  for (int i=0; i < data.length; i++) {
    FSDataOutputStream os=getFileSystem().create(new Path(inputPath,"inputFile" + i + ".txt"));
    os.write(Bytes.toBytes(data[i] + "\n"));
    os.close();
  }
  Path workingDir=new Path(methodTestDir,"mr_abort");
  OutputJobInfo outputJobInfo=OutputJobInfo.create(databaseName,tableName,null);
  Job job=configureJob(testName,conf,workingDir,MapWriteAbortTransaction.class,outputJobInfo,inputPath);
  assertFalse(job.waitForCompletion(true));
  RevisionManager rm=HBaseRevisionManagerUtil.getOpenedRevisionManager(conf);
  try {
    TableSnapshot snapshot=rm.createSnapshot(databaseName + "." + tableName);
    for (    String family : snapshot.getColumnFamilies()) {
      assertEquals(1,snapshot.getRevision(family));
      List<FamilyRevision> abortedWriteTransactions=rm.getAbortedWriteTransactions(databaseName + "." + tableName,family);
      assertEquals(1,abortedWriteTransactions.size());
      assertEquals(1,abortedWriteTransactions.get(0).getRevision());
    }
  }
  finally {
    rm.close();
  }
  HTable table=new HTable(conf,databaseName + "." + tableName);
  Scan scan=new Scan();
  scan.addFamily(Bytes.toBytes(familyName));
  ResultScanner scanner=table.getScanner(scan);
  assertFalse(scanner.iterator().hasNext());
  Path outputDir=new Path(getTestDir(),"mapred/testHBaseTableBulkIgnoreAbortedTransactions");
  FileSystem fs=getFileSystem();
  if (fs.exists(outputDir)) {
    fs.delete(outputDir,true);
  }
  job=new Job(conf,"hbase-bulk-aborted-transaction");
  job.setJarByClass(this.getClass());
  job.setMapperClass(MapReadAbortedTransaction.class);
  job.setInputFormatClass(HCatInputFormat.class);
  HCatInputFormat.setInput(job,databaseName,tableName);
  job.setOutputFormatClass(TextOutputFormat.class);
  TextOutputFormat.setOutputPath(job,outputDir);
  job.setMapOutputKeyClass(BytesWritable.class);
  job.setMapOutputValueClass(Text.class);
  job.setOutputKeyClass(BytesWritable.class);
  job.setOutputValueClass(Text.class);
  job.setNumReduceTasks(0);
  assertTrue(job.waitForCompletion(true));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hcatalog.hbase.TestHBaseDirectOutputFormat </h4><pre class="type-7 type-11 type-1 type-2 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void directOutputFormatTest() throws IOException, ClassNotFoundException, InterruptedException {
  String testName="directOutputFormatTest";
  Path methodTestDir=new Path(getTestDir(),testName);
  String tableName=newTableName(testName).toLowerCase();
  String familyName="my_family";
  byte[] familyNameBytes=Bytes.toBytes(familyName);
  Configuration conf=new Configuration(allConf);
  conf.set(HCatConstants.HCAT_KEY_HIVE_CONF,HCatUtil.serialize(allConf.getAllProperties()));
  createTable(tableName,new String[]{familyName});
  String data[]={"1,english:ONE,spanish:UNO","2,english:ONE,spanish:DOS","3,english:ONE,spanish:TRES"};
  Path inputPath=new Path(methodTestDir,"mr_input");
  getFileSystem().mkdirs(inputPath);
  FSDataOutputStream os=getFileSystem().create(new Path(inputPath,"inputFile.txt"));
  for (  String line : data)   os.write(Bytes.toBytes(line + "\n"));
  os.close();
  JobConf job=new JobConf(conf);
  job.setJobName(testName);
  job.setWorkingDirectory(new Path(methodTestDir,"mr_work"));
  job.setJarByClass(this.getClass());
  job.setMapperClass(MapWrite.class);
  job.setInputFormat(org.apache.hadoop.mapred.TextInputFormat.class);
  org.apache.hadoop.mapred.TextInputFormat.setInputPaths(job,inputPath);
  job.setOutputFormat(HBaseDirectOutputFormat.class);
  job.set(TableOutputFormat.OUTPUT_TABLE,tableName);
  job.set(HBaseConstants.PROPERTY_OUTPUT_TABLE_NAME_KEY,tableName);
  RevisionManager rm=HBaseRevisionManagerUtil.getOpenedRevisionManager(conf);
  try {
    OutputJobInfo outputJobInfo=OutputJobInfo.create("default",tableName,null);
    Transaction txn=rm.beginWriteTransaction(tableName,Arrays.asList(familyName));
    outputJobInfo.getProperties().setProperty(HBaseConstants.PROPERTY_WRITE_TXN_KEY,HCatUtil.serialize(txn));
    job.set(HCatConstants.HCAT_KEY_OUTPUT_INFO,HCatUtil.serialize(outputJobInfo));
  }
  finally {
    rm.close();
  }
  job.setMapOutputKeyClass(BytesWritable.class);
  job.setMapOutputValueClass(HCatRecord.class);
  job.setOutputKeyClass(BytesWritable.class);
  job.setOutputValueClass(HCatRecord.class);
  job.setNumReduceTasks(0);
  RunningJob runJob=JobClient.runJob(job);
  runJob.waitForCompletion();
  assertTrue(runJob.isSuccessful());
  HTable table=new HTable(conf,tableName);
  Scan scan=new Scan();
  scan.addFamily(familyNameBytes);
  ResultScanner scanner=table.getScanner(scan);
  int index=0;
  for (  Result result : scanner) {
    String vals[]=data[index].toString().split(",");
    for (int i=1; i < vals.length; i++) {
      String pair[]=vals[i].split(":");
      assertTrue(result.containsColumn(familyNameBytes,Bytes.toBytes(pair[0])));
      assertEquals(pair[1],Bytes.toString(result.getValue(familyNameBytes,Bytes.toBytes(pair[0]))));
    }
    index++;
  }
  assertEquals(data.length,index);
}

</code></pre>

<br>
<pre class="type-7 type-11 type-1 type-2 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void directHCatOutputFormatTest() throws Exception {
  String testName="directHCatOutputFormatTest";
  Path methodTestDir=new Path(getTestDir(),testName);
  String databaseName=testName;
  String dbDir=new Path(methodTestDir,"DB_" + testName).toString();
  String tableName=newTableName(testName);
  String familyName="my_family";
  byte[] familyNameBytes=Bytes.toBytes(familyName);
  String hbaseTableName=(databaseName + "." + tableName).toLowerCase();
  Configuration conf=new Configuration(allConf);
  conf.set(HCatConstants.HCAT_KEY_HIVE_CONF,HCatUtil.serialize(allConf.getAllProperties()));
  String dbquery="CREATE DATABASE IF NOT EXISTS " + databaseName + " LOCATION '"+ dbDir+ "'";
  String tableQuery="CREATE TABLE " + databaseName + "."+ tableName+ "(key int, english string, spanish string) STORED BY "+ "'org.apache.hcatalog.hbase.HBaseHCatStorageHandler'"+ "TBLPROPERTIES ("+ "'hbase.columns.mapping'=':key,"+ familyName+ ":english,"+ familyName+ ":spanish')";
  assertEquals(0,hcatDriver.run(dbquery).getResponseCode());
  assertEquals(0,hcatDriver.run(tableQuery).getResponseCode());
  String data[]={"1,english:ONE,spanish:UNO","2,english:ONE,spanish:DOS","3,english:ONE,spanish:TRES"};
  Path inputPath=new Path(methodTestDir,"mr_input");
  getFileSystem().mkdirs(inputPath);
  for (int i=0; i < data.length; i++) {
    FSDataOutputStream os=getFileSystem().create(new Path(inputPath,"inputFile" + i + ".txt"));
    os.write(Bytes.toBytes(data[i] + "\n"));
    os.close();
  }
  Path workingDir=new Path(methodTestDir,"mr_work");
  OutputJobInfo outputJobInfo=OutputJobInfo.create(databaseName,tableName,null);
  Job job=configureJob(testName,conf,workingDir,MapHCatWrite.class,outputJobInfo,inputPath);
  assertTrue(job.waitForCompletion(true));
  RevisionManager rm=HBaseRevisionManagerUtil.getOpenedRevisionManager(conf);
  try {
    TableSnapshot snapshot=rm.createSnapshot(hbaseTableName);
    for (    String el : snapshot.getColumnFamilies()) {
      assertEquals(1,snapshot.getRevision(el));
    }
  }
  finally {
    rm.close();
  }
  HTable table=new HTable(conf,hbaseTableName);
  Scan scan=new Scan();
  scan.addFamily(familyNameBytes);
  ResultScanner scanner=table.getScanner(scan);
  int index=0;
  for (  Result result : scanner) {
    String vals[]=data[index].toString().split(",");
    for (int i=1; i < vals.length; i++) {
      String pair[]=vals[i].split(":");
      assertTrue(result.containsColumn(familyNameBytes,Bytes.toBytes(pair[0])));
      assertEquals(pair[1],Bytes.toString(result.getValue(familyNameBytes,Bytes.toBytes(pair[0]))));
      assertEquals(1l,result.getColumn(familyNameBytes,Bytes.toBytes(pair[0])).get(0).getTimestamp());
    }
    index++;
  }
  assertEquals(data.length,index);
}

</code></pre>

<br>
<pre class="type-7 type-11 type-1 type-2 type-12 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void directModeAbortTest() throws Exception {
  String testName="directModeAbortTest";
  Path methodTestDir=new Path(getTestDir(),testName);
  String databaseName=testName;
  String dbDir=new Path(methodTestDir,"DB_" + testName).toString();
  String tableName=newTableName(testName);
  String familyName="my_family";
  byte[] familyNameBytes=Bytes.toBytes(familyName);
  String hbaseTableName=tableName;
  Configuration conf=new Configuration(allConf);
  conf.set(HCatConstants.HCAT_KEY_HIVE_CONF,HCatUtil.serialize(allConf.getAllProperties()));
  String dbquery="CREATE DATABASE IF NOT EXISTS " + databaseName + " LOCATION '"+ dbDir+ "'";
  String tableQuery="CREATE TABLE " + databaseName + "."+ tableName+ "(key int, english string, spanish string) STORED BY "+ "'org.apache.hcatalog.hbase.HBaseHCatStorageHandler'"+ "TBLPROPERTIES ("+ "'hbase.columns.mapping'=':key,"+ familyName+ ":english,"+ familyName+ ":spanish','hbase.table.name'='"+ hbaseTableName+ "')";
  assertEquals(0,hcatDriver.run(dbquery).getResponseCode());
  assertEquals(0,hcatDriver.run(tableQuery).getResponseCode());
  String data[]={"1,english:ONE,spanish:UNO","2,english:TWO,spanish:DOS","3,english:THREE,spanish:TRES"};
  Path inputPath=new Path(methodTestDir,"mr_input");
  getFileSystem().mkdirs(inputPath);
  for (int i=0; i < data.length; i++) {
    FSDataOutputStream os=getFileSystem().create(new Path(inputPath,"inputFile" + i + ".txt"));
    os.write(Bytes.toBytes(data[i] + "\n"));
    os.close();
  }
  Path workingDir=new Path(methodTestDir,"mr_abort");
  OutputJobInfo outputJobInfo=OutputJobInfo.create(databaseName,tableName,null);
  Job job=configureJob(testName,conf,workingDir,MapWriteAbortTransaction.class,outputJobInfo,inputPath);
  assertFalse(job.waitForCompletion(true));
  RevisionManager rm=HBaseRevisionManagerUtil.getOpenedRevisionManager(conf);
  try {
    TableSnapshot snapshot=rm.createSnapshot(hbaseTableName);
    for (    String family : snapshot.getColumnFamilies()) {
      assertEquals(1,snapshot.getRevision(family));
      List<FamilyRevision> abortedWriteTransactions=rm.getAbortedWriteTransactions(hbaseTableName,family);
      assertEquals(1,abortedWriteTransactions.size());
      assertEquals(1,abortedWriteTransactions.get(0).getRevision());
    }
  }
  finally {
    rm.close();
  }
  HTable table=new HTable(conf,hbaseTableName);
  Scan scan=new Scan();
  scan.addFamily(familyNameBytes);
  ResultScanner scanner=table.getScanner(scan);
  int count=0;
  for (  Result result : scanner) {
    String key=Bytes.toString(result.getRow());
    assertNotSame(MapWriteAbortTransaction.failedKey,key);
    int index=Integer.parseInt(key) - 1;
    String vals[]=data[index].toString().split(",");
    for (int i=1; i < vals.length; i++) {
      String pair[]=vals[i].split(":");
      assertTrue(result.containsColumn(familyNameBytes,Bytes.toBytes(pair[0])));
      assertEquals(pair[1],Bytes.toString(result.getValue(familyNameBytes,Bytes.toBytes(pair[0]))));
      assertEquals(1l,result.getColumn(familyNameBytes,Bytes.toBytes(pair[0])).get(0).getTimestamp());
    }
    count++;
  }
  assertEquals(data.length - 1,count);
  Path outputDir=new Path(getTestDir(),"mapred/testHBaseTableIgnoreAbortedTransactions");
  FileSystem fs=getFileSystem();
  if (fs.exists(outputDir)) {
    fs.delete(outputDir,true);
  }
  job=new Job(conf,"hbase-aborted-transaction");
  job.setJarByClass(this.getClass());
  job.setMapperClass(MapReadAbortedTransaction.class);
  job.setInputFormatClass(HCatInputFormat.class);
  HCatInputFormat.setInput(job,databaseName,tableName);
  job.setOutputFormatClass(TextOutputFormat.class);
  TextOutputFormat.setOutputPath(job,outputDir);
  job.setMapOutputKeyClass(BytesWritable.class);
  job.setMapOutputValueClass(Text.class);
  job.setOutputKeyClass(BytesWritable.class);
  job.setOutputValueClass(Text.class);
  job.setNumReduceTasks(0);
  assertTrue(job.waitForCompletion(true));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hcatalog.hbase.TestHBaseInputFormat </h4><pre class="type-7 type-1 type-2 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void TestHBaseInputFormatProjectionReadMR() throws Exception {
  String tableName=newTableName("mytable");
  String tableQuery="CREATE TABLE " + tableName + "(key string, testqualifier1 string, testqualifier2 string) STORED BY "+ "'org.apache.hcatalog.hbase.HBaseHCatStorageHandler'"+ "TBLPROPERTIES ('hbase.columns.mapping'=':key,"+ "testFamily:testQualifier1,testFamily:testQualifier2')";
  CommandProcessorResponse responseTwo=hcatDriver.run(tableQuery);
  assertEquals(0,responseTwo.getResponseCode());
  HBaseAdmin hAdmin=new HBaseAdmin(getHbaseConf());
  boolean doesTableExist=hAdmin.tableExists(tableName);
  assertTrue(doesTableExist);
  populateHBaseTable(tableName,5);
  Configuration conf=new Configuration(hcatConf);
  conf.set(HCatConstants.HCAT_KEY_HIVE_CONF,HCatUtil.serialize(getHiveConf().getAllProperties()));
  Path outputDir=new Path(getTestDir(),"mapred/testHBaseTableProjectionReadMR");
  FileSystem fs=getFileSystem();
  if (fs.exists(outputDir)) {
    fs.delete(outputDir,true);
  }
  JobConf job=new JobConf(conf);
  job.setJobName("hbase-scan-column");
  job.setJarByClass(this.getClass());
  job.setMapperClass(MapReadProjectionHTable.class);
  job.setInputFormat(HBaseInputFormat.class);
  job.set(HCatConstants.HCAT_KEY_OUTPUT_SCHEMA,HCatUtil.serialize(getProjectionSchema()));
  Job newJob=new Job(job);
  HCatInputFormat.setInput(newJob,MetaStoreUtils.DEFAULT_DATABASE_NAME,tableName);
  String inputJobString=newJob.getConfiguration().get(HCatConstants.HCAT_KEY_JOB_INFO);
  InputJobInfo info=(InputJobInfo)HCatUtil.deserialize(inputJobString);
  job.set(HCatConstants.HCAT_KEY_JOB_INFO,inputJobString);
  for (  PartInfo partinfo : info.getPartitions()) {
    for (    Entry<String,String> entry : partinfo.getJobProperties().entrySet())     job.set(entry.getKey(),entry.getValue());
  }
  assertEquals("testFamily:testQualifier1",job.get(TableInputFormat.SCAN_COLUMNS));
  job.setOutputFormat(org.apache.hadoop.mapred.TextOutputFormat.class);
  org.apache.hadoop.mapred.TextOutputFormat.setOutputPath(job,outputDir);
  job.setMapOutputKeyClass(BytesWritable.class);
  job.setMapOutputValueClass(Text.class);
  job.setOutputKeyClass(BytesWritable.class);
  job.setOutputValueClass(Text.class);
  job.setNumReduceTasks(0);
  RunningJob runJob=JobClient.runJob(job);
  runJob.waitForCompletion();
  assertTrue(runJob.isSuccessful());
  assertFalse(MapReadProjHTable.error);
  assertEquals(MapReadProjHTable.count,1);
  String dropTableQuery="DROP TABLE " + tableName;
  CommandProcessorResponse responseThree=hcatDriver.run(dropTableQuery);
  assertEquals(0,responseThree.getResponseCode());
  boolean isHbaseTableThere=hAdmin.tableExists(tableName);
  assertFalse(isHbaseTableThere);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hcatalog.hbase.TestSnapshots </h4><pre class="type-7 type-2 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void TestSnapshotConversion() throws Exception {
  Initialize();
  String tableName=newTableName("mytableOne");
  String databaseName=newTableName("mydatabase");
  String fullyQualTableName=databaseName + "." + tableName;
  String db_dir=getTestDir() + "/hbasedb";
  String dbquery="CREATE DATABASE IF NOT EXISTS " + databaseName + " LOCATION '"+ db_dir+ "'";
  String tableQuery="CREATE TABLE " + fullyQualTableName + "(key string, value1 string, value2 string) STORED BY "+ "'org.apache.hcatalog.hbase.HBaseHCatStorageHandler'"+ "TBLPROPERTIES ('hbase.columns.mapping'=':key,cf1:q1,cf2:q2')";
  CommandProcessorResponse cmdResponse=hcatDriver.run(dbquery);
  assertEquals(0,cmdResponse.getResponseCode());
  cmdResponse=hcatDriver.run(tableQuery);
  assertEquals(0,cmdResponse.getResponseCode());
  Configuration conf=new Configuration(hcatConf);
  conf.set(HCatConstants.HCAT_KEY_HIVE_CONF,HCatUtil.serialize(getHiveConf().getAllProperties()));
  Job job=new Job(conf);
  Properties properties=new Properties();
  properties.setProperty(HBaseConstants.PROPERTY_TABLE_SNAPSHOT_KEY,"dummysnapshot");
  HCatInputFormat.setInput(job,databaseName,tableName).setProperties(properties);
  String modifiedInputInfo=job.getConfiguration().get(HCatConstants.HCAT_KEY_JOB_INFO);
  InputJobInfo inputInfo=(InputJobInfo)HCatUtil.deserialize(modifiedInputInfo);
  Map<String,Long> revMap=new HashMap<String,Long>();
  revMap.put("cf1",3L);
  revMap.put("cf2",5L);
  TableSnapshot hbaseSnapshot=new TableSnapshot(fullyQualTableName,revMap,-1);
  HCatTableSnapshot hcatSnapshot=HBaseRevisionManagerUtil.convertSnapshot(hbaseSnapshot,inputInfo.getTableInfo());
  assertEquals(hcatSnapshot.getRevision("value1"),3);
  assertEquals(hcatSnapshot.getRevision("value2"),5);
  String dropTable="DROP TABLE " + fullyQualTableName;
  cmdResponse=hcatDriver.run(dropTable);
  assertEquals(0,cmdResponse.getResponseCode());
  tableName=newTableName("mytableTwo");
  fullyQualTableName=databaseName + "." + tableName;
  tableQuery="CREATE TABLE " + fullyQualTableName + "(key string, value1 string, value2 string) STORED BY "+ "'org.apache.hcatalog.hbase.HBaseHCatStorageHandler'"+ "TBLPROPERTIES ('hbase.columns.mapping'=':key,cf1:q1,cf1:q2')";
  cmdResponse=hcatDriver.run(tableQuery);
  assertEquals(0,cmdResponse.getResponseCode());
  revMap.clear();
  revMap.put("cf1",3L);
  hbaseSnapshot=new TableSnapshot(fullyQualTableName,revMap,-1);
  HCatInputFormat.setInput(job,databaseName,tableName).setProperties(properties);
  modifiedInputInfo=job.getConfiguration().get(HCatConstants.HCAT_KEY_JOB_INFO);
  inputInfo=(InputJobInfo)HCatUtil.deserialize(modifiedInputInfo);
  hcatSnapshot=HBaseRevisionManagerUtil.convertSnapshot(hbaseSnapshot,inputInfo.getTableInfo());
  assertEquals(hcatSnapshot.getRevision("value1"),3);
  assertEquals(hcatSnapshot.getRevision("value2"),3);
  dropTable="DROP TABLE " + fullyQualTableName;
  cmdResponse=hcatDriver.run(dropTable);
  assertEquals(0,cmdResponse.getResponseCode());
  String dropDatabase="DROP DATABASE IF EXISTS " + databaseName + "CASCADE";
  cmdResponse=hcatDriver.run(dropDatabase);
  assertEquals(0,cmdResponse.getResponseCode());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hcatalog.hbase.snapshot.TestIDGenerator </h4><pre class="type-7 type-11 type-2 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testIDGeneration() throws Exception {
  int port=getHbaseConf().getInt("hbase.zookeeper.property.clientPort",2181);
  String servers=getHbaseConf().get("hbase.zookeeper.quorum");
  String[] splits=servers.split(",");
  StringBuffer sb=new StringBuffer();
  for (  String split : splits) {
    sb.append(split);
    sb.append(':');
    sb.append(port);
  }
  ZKUtil zkutil=new ZKUtil(sb.toString(),"/rm_base");
  String tableName="myTable";
  long initId=zkutil.nextId(tableName);
  for (int i=0; i < 10; i++) {
    long id=zkutil.nextId(tableName);
    Assert.assertEquals(initId + (i + 1),id);
  }
}

</code></pre>

<br>
<pre class="type-7 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testMultipleClients() throws InterruptedException {
  int port=getHbaseConf().getInt("hbase.zookeeper.property.clientPort",2181);
  String servers=getHbaseConf().get("hbase.zookeeper.quorum");
  String[] splits=servers.split(",");
  StringBuffer sb=new StringBuffer();
  for (  String split : splits) {
    sb.append(split);
    sb.append(':');
    sb.append(port);
  }
  ArrayList<IDGenClient> clients=new ArrayList<IDGenClient>();
  for (int i=0; i < 5; i++) {
    IDGenClient idClient=new IDGenClient(sb.toString(),"/rm_base",10,"testTable");
    clients.add(idClient);
  }
  for (  IDGenClient idClient : clients) {
    idClient.run();
  }
  for (  IDGenClient idClient : clients) {
    idClient.join();
  }
  HashMap<Long,Long> idMap=new HashMap<Long,Long>();
  for (  IDGenClient idClient : clients) {
    idMap.putAll(idClient.getIdMap());
  }
  ArrayList<Long> keys=new ArrayList<Long>(idMap.keySet());
  Collections.sort(keys);
  int startId=1;
  for (  Long key : keys) {
    Long id=idMap.get(key);
    System.out.println("Key: " + key + " Value "+ id);
    assertTrue(id == startId);
    startId++;
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hcatalog.hbase.snapshot.TestRevisionManager </h4><pre class="type-7 type-1 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testBasicZNodeCreation() throws IOException, KeeperException, InterruptedException {
  int port=getHbaseConf().getInt("hbase.zookeeper.property.clientPort",2181);
  String servers=getHbaseConf().get("hbase.zookeeper.quorum");
  String[] splits=servers.split(",");
  StringBuffer sb=new StringBuffer();
  for (  String split : splits) {
    sb.append(split);
    sb.append(':');
    sb.append(port);
  }
  ZKUtil zkutil=new ZKUtil(sb.toString(),"/rm_base");
  String tableName=newTableName("testTable");
  List<String> columnFamilies=Arrays.asList("cf001","cf002","cf003");
  zkutil.createRootZNodes();
  ZooKeeper zk=zkutil.getSession();
  Stat tempTwo=zk.exists("/rm_base" + PathUtil.DATA_DIR,false);
  assertTrue(tempTwo != null);
  Stat tempThree=zk.exists("/rm_base" + PathUtil.CLOCK_NODE,false);
  assertTrue(tempThree != null);
  zkutil.setUpZnodesForTable(tableName,columnFamilies);
  String transactionDataTablePath="/rm_base" + PathUtil.DATA_DIR + "/"+ tableName;
  Stat result=zk.exists(transactionDataTablePath,false);
  assertTrue(result != null);
  for (  String colFamiliy : columnFamilies) {
    String cfPath=transactionDataTablePath + "/" + colFamiliy;
    Stat resultTwo=zk.exists(cfPath,false);
    assertTrue(resultTwo != null);
  }
}

</code></pre>

<br>
<pre class="type-7 type-1 type-2 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testCommitTransaction() throws IOException {
  int port=getHbaseConf().getInt("hbase.zookeeper.property.clientPort",2181);
  String servers=getHbaseConf().get("hbase.zookeeper.quorum");
  String[] splits=servers.split(",");
  StringBuffer sb=new StringBuffer();
  for (  String split : splits) {
    sb.append(split);
    sb.append(':');
    sb.append(port);
  }
  Configuration conf=RevisionManagerConfiguration.create(getHbaseConf());
  conf.set(RMConstants.ZOOKEEPER_DATADIR,"/rm_base");
  ZKBasedRevisionManager manager=new ZKBasedRevisionManager();
  manager.initialize(conf);
  manager.open();
  ZKUtil zkutil=new ZKUtil(sb.toString(),"/rm_base");
  String tableName=newTableName("testTable");
  List<String> columnFamilies=Arrays.asList("cf1","cf2","cf3");
  Transaction txn=manager.beginWriteTransaction(tableName,columnFamilies);
  List<String> cfs=zkutil.getColumnFamiliesOfTable(tableName);
  assertTrue(cfs.size() == columnFamilies.size());
  for (  String cf : cfs) {
    assertTrue(columnFamilies.contains(cf));
  }
  for (  String colFamily : columnFamilies) {
    String path=PathUtil.getRunningTxnInfoPath("/rm_base",tableName,colFamily);
    byte[] data=zkutil.getRawData(path,null);
    StoreFamilyRevisionList list=new StoreFamilyRevisionList();
    ZKUtil.deserialize(list,data);
    assertEquals(list.getRevisionListSize(),1);
    StoreFamilyRevision lightTxn=list.getRevisionList().get(0);
    assertEquals(lightTxn.timestamp,txn.getTransactionExpireTimeStamp());
    assertEquals(lightTxn.revision,txn.getRevisionNumber());
  }
  manager.commitWriteTransaction(txn);
  for (  String colFamiliy : columnFamilies) {
    String path=PathUtil.getRunningTxnInfoPath("/rm_base",tableName,colFamiliy);
    byte[] data=zkutil.getRawData(path,null);
    StoreFamilyRevisionList list=new StoreFamilyRevisionList();
    ZKUtil.deserialize(list,data);
    assertEquals(list.getRevisionListSize(),0);
  }
  manager.close();
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hcatalog.hbase.snapshot.TestThriftSerialization </h4><pre class="type-7 type-11 type-1 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
"></span><br>
@Test public void testWriteTransactionList(){
  List<StoreFamilyRevision> txnList=new ArrayList<StoreFamilyRevision>();
  long version;
  long timestamp;
  for (int i=0; i < 10; i++) {
    version=i;
    timestamp=1000 + i;
    StoreFamilyRevision wtx=new StoreFamilyRevision(version,timestamp);
    txnList.add(wtx);
  }
  StoreFamilyRevisionList wList=new StoreFamilyRevisionList(txnList);
  try {
    byte[] data=ZKUtil.serialize(wList);
    StoreFamilyRevisionList newList=new StoreFamilyRevisionList();
    ZKUtil.deserialize(newList,data);
    assertTrue(newList.getRevisionListSize() == wList.getRevisionListSize());
    Iterator<StoreFamilyRevision> itr=newList.getRevisionListIterator();
    int i=0;
    while (itr.hasNext()) {
      StoreFamilyRevision txn=itr.next();
      assertTrue(txn.getRevision() == i);
      assertTrue(txn.getTimestamp() == (i + 1000));
      i++;
    }
  }
 catch (  IOException e) {
    e.printStackTrace();
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hcatalog.hbase.snapshot.TestZNodeSetUp </h4><pre class="type-7 type-1 type-2 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBasicZNodeCreation() throws Exception {
  Initialize();
  int port=getHbaseConf().getInt("hbase.zookeeper.property.clientPort",2181);
  String servers=getHbaseConf().get("hbase.zookeeper.quorum");
  String[] splits=servers.split(",");
  StringBuffer sb=new StringBuffer();
  for (  String split : splits) {
    sb.append(split);
    sb.append(':');
    sb.append(port);
  }
  hcatDriver.run("drop table test_table");
  CommandProcessorResponse response=hcatDriver.run("create table test_table(key int, value string) STORED BY " + "'org.apache.hcatalog.hbase.HBaseHCatStorageHandler'" + "TBLPROPERTIES ('hbase.columns.mapping'=':key,cf1:val')");
  assertEquals(0,response.getResponseCode());
  HBaseAdmin hAdmin=new HBaseAdmin(getHbaseConf());
  boolean doesTableExist=hAdmin.tableExists("test_table");
  assertTrue(doesTableExist);
  ZKUtil zkutil=new ZKUtil(sb.toString(),"/rm_base");
  ZooKeeper zk=zkutil.getSession();
  String tablePath=PathUtil.getTxnDataPath("/rm_base","test_table");
  Stat tempTwo=zk.exists(tablePath,false);
  assertTrue(tempTwo != null);
  String cfPath=PathUtil.getTxnDataPath("/rm_base","test_table") + "/cf1";
  Stat tempThree=zk.exists(cfPath,false);
  assertTrue(tempThree != null);
  hcatDriver.run("drop table test_table");
  System.out.println("Table path : " + tablePath);
  Stat tempFour=zk.exists(tablePath,false);
  assertTrue(tempFour == null);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hcatalog.mapreduce.TestHCatHiveCompatibility </h4><pre class="type-7 type-11 type-1 type-2 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUnpartedReadWrite() throws Exception {
  driver.run("drop table if exists junit_unparted_noisd");
  String createTable="create table junit_unparted_noisd(a int) stored as RCFILE";
  Assert.assertEquals(0,driver.run(createTable).getResponseCode());
  Table table=client.getTable("default","junit_unparted_noisd");
  Assert.assertTrue(table.getSd().getInputFormat().equals(HCatConstants.HIVE_RCFILE_IF_CLASS));
  PigServer server=new PigServer(ExecType.LOCAL);
  logAndRegister(server,"A = load '" + INPUT_FILE_NAME + "' as (a:int);");
  logAndRegister(server,"store A into 'default.junit_unparted_noisd' using org.apache.hcatalog.pig.HCatStorer();");
  logAndRegister(server,"B = load 'default.junit_unparted_noisd' using org.apache.hcatalog.pig.HCatLoader();");
  Iterator<Tuple> itr=server.openIterator("B");
  int i=0;
  while (itr.hasNext()) {
    Tuple t=itr.next();
    Assert.assertEquals(1,t.size());
    Assert.assertEquals(t.get(0),i);
    i++;
  }
  Assert.assertFalse(itr.hasNext());
  Assert.assertEquals(11,i);
  Table table2=client.getTable("default","junit_unparted_noisd");
  Assert.assertTrue(table2.getSd().getInputFormat().equals(HCatConstants.HIVE_RCFILE_IF_CLASS));
  driver.run("drop table junit_unparted_noisd");
}

</code></pre>

<br>
<pre class="type-7 type-11 type-1 type-2 type-4 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPartedRead() throws Exception {
  driver.run("drop table if exists junit_parted_noisd");
  String createTable="create table junit_parted_noisd(a int) partitioned by (b string) stored as RCFILE";
  Assert.assertEquals(0,driver.run(createTable).getResponseCode());
  Table table=client.getTable("default","junit_parted_noisd");
  Assert.assertTrue(table.getSd().getInputFormat().equals(HCatConstants.HIVE_RCFILE_IF_CLASS));
  PigServer server=new PigServer(ExecType.LOCAL);
  logAndRegister(server,"A = load '" + INPUT_FILE_NAME + "' as (a:int);");
  logAndRegister(server,"store A into 'default.junit_parted_noisd' using org.apache.hcatalog.pig.HCatStorer('b=42');");
  logAndRegister(server,"B = load 'default.junit_parted_noisd' using org.apache.hcatalog.pig.HCatLoader();");
  Iterator<Tuple> itr=server.openIterator("B");
  int i=0;
  while (itr.hasNext()) {
    Tuple t=itr.next();
    Assert.assertEquals(2,t.size());
    Assert.assertEquals(t.get(0),i);
    Assert.assertEquals(t.get(1),"42");
    i++;
  }
  Assert.assertFalse(itr.hasNext());
  Assert.assertEquals(11,i);
  Table table2=client.getTable("default","junit_parted_noisd");
  Assert.assertTrue(table2.getSd().getInputFormat().equals(HCatConstants.HIVE_RCFILE_IF_CLASS));
  Partition ptn=client.getPartition("default","junit_parted_noisd",Arrays.asList("42"));
  Assert.assertNotNull(ptn);
  Assert.assertTrue(ptn.getSd().getInputFormat().equals(HCatConstants.HIVE_RCFILE_IF_CLASS));
  driver.run("drop table junit_unparted_noisd");
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hcatalog.mapreduce.TestHCatHiveThriftCompatibility </h4><pre class="type-7 type-1 type-2 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Create a table with no explicit schema and ensure its correctly
 * discovered from the thrift struct.
 */
@Test public void testDynamicCols() throws Exception {
  Assert.assertEquals(0,driver.run("drop table if exists test_thrift").getResponseCode());
  Assert.assertEquals(0,driver.run("create external table test_thrift " + "partitioned by (year string) " + "row format serde 'org.apache.hadoop.hive.serde2.thrift.ThriftDeserializer' "+ "with serdeproperties ( "+ "  'serialization.class'='org.apache.hadoop.hive.serde2.thrift.test.IntString', "+ "  'serialization.format'='org.apache.thrift.protocol.TBinaryProtocol') "+ "stored as"+ "  inputformat 'org.apache.hadoop.mapred.SequenceFileInputFormat'"+ "  outputformat 'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat'").getResponseCode());
  Assert.assertEquals(0,driver.run("alter table test_thrift add partition (year = '2012') location '" + intStringSeq.getParent() + "'").getResponseCode());
  PigServer pigServer=new PigServer(ExecType.LOCAL);
  pigServer.registerQuery("A = load 'test_thrift' using org.apache.hcatalog.pig.HCatLoader();");
  Schema expectedSchema=new Schema();
  expectedSchema.add(new Schema.FieldSchema("myint",DataType.INTEGER));
  expectedSchema.add(new Schema.FieldSchema("mystring",DataType.CHARARRAY));
  expectedSchema.add(new Schema.FieldSchema("underscore_int",DataType.INTEGER));
  expectedSchema.add(new Schema.FieldSchema("year",DataType.CHARARRAY));
  Assert.assertEquals(expectedSchema,pigServer.dumpSchema("A"));
  Iterator<Tuple> iterator=pigServer.openIterator("A");
  Tuple t=iterator.next();
  Assert.assertEquals(1,t.get(0));
  Assert.assertEquals("one",t.get(1));
  Assert.assertEquals(1,t.get(2));
  Assert.assertEquals("2012",t.get(3));
  Assert.assertFalse(iterator.hasNext());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hcatalog.mapreduce.TestInputJobInfo </h4><pre class="type-7 type-2 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void test4ArgCreate() throws Exception {
  Properties p=new Properties();
  p.setProperty("key","value");
  InputJobInfo jobInfo=InputJobInfo.create("Db","Table","Filter",p);
  Assert.assertEquals("Db",jobInfo.getDatabaseName());
  Assert.assertEquals("Table",jobInfo.getTableName());
  Assert.assertEquals("Filter",jobInfo.getFilter());
  Assert.assertEquals("value",jobInfo.getProperties().getProperty("key"));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hcatalog.mapreduce.TestMultiOutputFormat </h4><pre class="type-7 type-11 type-1 type-2 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * A test job that reads a input file and outputs each word and the index of
 * the word encountered to a text file and sequence file with different key
 * values.
 */
@Test public void testMultiOutputFormatWithoutReduce() throws Throwable {
  Job job=new Job(mrConf,"MultiOutNoReduce");
  job.setMapperClass(MultiOutWordIndexMapper.class);
  job.setJarByClass(this.getClass());
  job.setInputFormatClass(TextInputFormat.class);
  job.setOutputFormatClass(MultiOutputFormat.class);
  job.setNumReduceTasks(0);
  JobConfigurer configurer=MultiOutputFormat.createConfigurer(job);
  configurer.addOutputFormat("out1",TextOutputFormat.class,IntWritable.class,Text.class);
  configurer.addOutputFormat("out2",SequenceFileOutputFormat.class,Text.class,IntWritable.class);
  Path outDir=new Path(workDir.getPath(),job.getJobName());
  FileOutputFormat.setOutputPath(configurer.getJob("out1"),new Path(outDir,"out1"));
  FileOutputFormat.setOutputPath(configurer.getJob("out2"),new Path(outDir,"out2"));
  String fileContent="Hello World";
  String inputFile=createInputFile(fileContent);
  FileInputFormat.setInputPaths(job,new Path(inputFile));
  DistributedCache.addFileToClassPath(new Path(inputFile),job.getConfiguration(),fs);
  String dummyFile=createInputFile("dummy file");
  DistributedCache.addFileToClassPath(new Path(dummyFile),configurer.getJob("out1").getConfiguration(),fs);
  DistributedCache.addFileToClassPath(new Path(inputFile),configurer.getJob("out2").getConfiguration(),fs);
  configurer.configure();
  Path[] fileClassPaths=DistributedCache.getFileClassPaths(job.getConfiguration());
  List<Path> fileClassPathsList=Arrays.asList(fileClassPaths);
  Assert.assertTrue(fileClassPathsList.contains(new Path(inputFile)));
  Assert.assertTrue(fileClassPathsList.contains(new Path(dummyFile)));
  URI[] cacheFiles=DistributedCache.getCacheFiles(job.getConfiguration());
  List<URI> cacheFilesList=Arrays.asList(cacheFiles);
  Assert.assertTrue(cacheFilesList.contains(new Path(inputFile).makeQualified(fs).toUri()));
  Assert.assertTrue(cacheFilesList.contains(new Path(dummyFile).makeQualified(fs).toUri()));
  Assert.assertTrue(job.waitForCompletion(true));
  Path textOutPath=new Path(outDir,"out1/part-m-00000");
  String[] textOutput=readFully(textOutPath).split("\n");
  Path seqOutPath=new Path(outDir,"out2/part-m-00000");
  SequenceFile.Reader reader=new SequenceFile.Reader(fs,seqOutPath,mrConf);
  Text key=new Text();
  IntWritable value=new IntWritable();
  String[] words=fileContent.split(" ");
  Assert.assertEquals(words.length,textOutput.length);
  LOG.info("Verifying file contents");
  for (int i=0; i < words.length; i++) {
    Assert.assertEquals((i + 1) + "\t" + words[i],textOutput[i]);
    reader.next(key,value);
    Assert.assertEquals(words[i],key.toString());
    Assert.assertEquals((i + 1),value.get());
  }
  Assert.assertFalse(reader.next(key,value));
}

</code></pre>

<br>
<pre class="type-7 type-11 type-1 type-2 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * A word count test job that reads a input file and outputs the count of
 * words to a text file and sequence file with different key values.
 */
@Test public void testMultiOutputFormatWithReduce() throws Throwable {
  Job job=new Job(mrConf,"MultiOutWithReduce");
  job.setMapperClass(WordCountMapper.class);
  job.setReducerClass(MultiOutWordCountReducer.class);
  job.setJarByClass(this.getClass());
  job.setInputFormatClass(TextInputFormat.class);
  job.setOutputFormatClass(MultiOutputFormat.class);
  job.setMapOutputKeyClass(Text.class);
  job.setMapOutputValueClass(IntWritable.class);
  JobConfigurer configurer=MultiOutputFormat.createConfigurer(job);
  configurer.addOutputFormat("out1",TextOutputFormat.class,IntWritable.class,Text.class);
  configurer.addOutputFormat("out2",SequenceFileOutputFormat.class,Text.class,IntWritable.class);
  configurer.addOutputFormat("out3",NullOutputFormat.class,Text.class,IntWritable.class);
  Path outDir=new Path(workDir.getPath(),job.getJobName());
  FileOutputFormat.setOutputPath(configurer.getJob("out1"),new Path(outDir,"out1"));
  FileOutputFormat.setOutputPath(configurer.getJob("out2"),new Path(outDir,"out2"));
  configurer.configure();
  String fileContent="Hello World Hello World World";
  String inputFile=createInputFile(fileContent);
  FileInputFormat.setInputPaths(job,new Path(inputFile));
  Assert.assertTrue(job.waitForCompletion(true));
  Path textOutPath=new Path(outDir,"out1/part-r-00000");
  String[] textOutput=readFully(textOutPath).split("\n");
  Path seqOutPath=new Path(outDir,"out2/part-r-00000");
  SequenceFile.Reader reader=new SequenceFile.Reader(fs,seqOutPath,mrConf);
  Text key=new Text();
  IntWritable value=new IntWritable();
  String[] words="Hello World".split(" ");
  Assert.assertEquals(words.length,textOutput.length);
  for (int i=0; i < words.length; i++) {
    Assert.assertEquals((i + 2) + "\t" + words[i],textOutput[i]);
    reader.next(key,value);
    Assert.assertEquals(words[i],key.toString());
    Assert.assertEquals((i + 2),value.get());
  }
  Assert.assertFalse(reader.next(key,value));
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hcatalog.mapreduce.TestSequenceFileReadWrite </h4><pre class="type-7 type-11 type-1 type-2 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSequenceTableWriteRead() throws Exception {
  Initialize();
  String createTable="CREATE TABLE demo_table(a0 int, a1 String, a2 String) STORED AS SEQUENCEFILE";
  driver.run("drop table demo_table");
  int retCode1=driver.run(createTable).getResponseCode();
  assertTrue(retCode1 == 0);
  server.setBatchOn();
  server.registerQuery("A = load '" + INPUT_FILE_NAME + "' using PigStorage(',') as (a0:int,a1:chararray,a2:chararray);");
  server.registerQuery("store A into 'demo_table' using org.apache.hcatalog.pig.HCatStorer();");
  server.executeBatch();
  server.registerQuery("B = load 'demo_table' using org.apache.hcatalog.pig.HCatLoader();");
  Iterator<Tuple> XIter=server.openIterator("B");
  int numTuplesRead=0;
  while (XIter.hasNext()) {
    Tuple t=XIter.next();
    assertEquals(3,t.size());
    assertEquals(t.get(0).toString(),"" + numTuplesRead);
    assertEquals(t.get(1).toString(),"a" + numTuplesRead);
    assertEquals(t.get(2).toString(),"b" + numTuplesRead);
    numTuplesRead++;
  }
  assertEquals(input.length,numTuplesRead);
}

</code></pre>

<br>
<pre class="type-7 type-11 type-1 type-2 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTextTableWriteRead() throws Exception {
  Initialize();
  String createTable="CREATE TABLE demo_table_1(a0 int, a1 String, a2 String) STORED AS TEXTFILE";
  driver.run("drop table demo_table_1");
  int retCode1=driver.run(createTable).getResponseCode();
  assertTrue(retCode1 == 0);
  server.setBatchOn();
  server.registerQuery("A = load '" + INPUT_FILE_NAME + "' using PigStorage(',') as (a0:int,a1:chararray,a2:chararray);");
  server.registerQuery("store A into 'demo_table_1' using org.apache.hcatalog.pig.HCatStorer();");
  server.executeBatch();
  server.registerQuery("B = load 'demo_table_1' using org.apache.hcatalog.pig.HCatLoader();");
  Iterator<Tuple> XIter=server.openIterator("B");
  int numTuplesRead=0;
  while (XIter.hasNext()) {
    Tuple t=XIter.next();
    assertEquals(3,t.size());
    assertEquals(t.get(0).toString(),"" + numTuplesRead);
    assertEquals(t.get(1).toString(),"a" + numTuplesRead);
    assertEquals(t.get(2).toString(),"b" + numTuplesRead);
    numTuplesRead++;
  }
  assertEquals(input.length,numTuplesRead);
}

</code></pre>

<br>
<pre class="type-7 type-11 type-1 type-2 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testTextTableWriteReadMR() throws Exception {
  Initialize();
  String createTable="CREATE TABLE demo_table_3(a0 int, a1 String, a2 String) STORED AS TEXTFILE";
  driver.run("drop table demo_table_3");
  int retCode1=driver.run(createTable).getResponseCode();
  assertTrue(retCode1 == 0);
  Configuration conf=new Configuration();
  conf.set(HCatConstants.HCAT_KEY_HIVE_CONF,HCatUtil.serialize(hiveConf.getAllProperties()));
  Job job=new Job(conf,"Write-hcat-text-table");
  job.setJarByClass(TestSequenceFileReadWrite.class);
  job.setMapperClass(Map.class);
  job.setOutputKeyClass(NullWritable.class);
  job.setOutputValueClass(DefaultHCatRecord.class);
  job.setInputFormatClass(TextInputFormat.class);
  job.setNumReduceTasks(0);
  TextInputFormat.setInputPaths(job,INPUT_FILE_NAME);
  HCatOutputFormat.setOutput(job,OutputJobInfo.create(MetaStoreUtils.DEFAULT_DATABASE_NAME,"demo_table_3",null));
  job.setOutputFormatClass(HCatOutputFormat.class);
  HCatOutputFormat.setSchema(job,getSchema());
  assertTrue(job.waitForCompletion(true));
  if (!HCatUtil.isHadoop23()) {
    new FileOutputCommitterContainer(job,null).commitJob(job);
  }
  assertTrue(job.isSuccessful());
  server.setBatchOn();
  server.registerQuery("D = load 'default.demo_table_3' using org.apache.hcatalog.pig.HCatLoader();");
  server.executeBatch();
  Iterator<Tuple> XIter=server.openIterator("D");
  int numTuplesRead=0;
  while (XIter.hasNext()) {
    Tuple t=XIter.next();
    assertEquals(3,t.size());
    assertEquals(t.get(0).toString(),"" + numTuplesRead);
    assertEquals(t.get(1).toString(),"a" + numTuplesRead);
    assertEquals(t.get(2).toString(),"b" + numTuplesRead);
    numTuplesRead++;
  }
  assertEquals(input.length,numTuplesRead);
}

</code></pre>

<br>
<pre class="type-7 type-11 type-1 type-2 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSequenceTableWriteReadMR() throws Exception {
  Initialize();
  String createTable="CREATE TABLE demo_table_2(a0 int, a1 String, a2 String) STORED AS SEQUENCEFILE";
  driver.run("drop table demo_table_2");
  int retCode1=driver.run(createTable).getResponseCode();
  assertTrue(retCode1 == 0);
  Configuration conf=new Configuration();
  conf.set(HCatConstants.HCAT_KEY_HIVE_CONF,HCatUtil.serialize(hiveConf.getAllProperties()));
  Job job=new Job(conf,"Write-hcat-seq-table");
  job.setJarByClass(TestSequenceFileReadWrite.class);
  job.setMapperClass(Map.class);
  job.setOutputKeyClass(NullWritable.class);
  job.setOutputValueClass(DefaultHCatRecord.class);
  job.setInputFormatClass(TextInputFormat.class);
  TextInputFormat.setInputPaths(job,INPUT_FILE_NAME);
  HCatOutputFormat.setOutput(job,OutputJobInfo.create(MetaStoreUtils.DEFAULT_DATABASE_NAME,"demo_table_2",null));
  job.setOutputFormatClass(HCatOutputFormat.class);
  HCatOutputFormat.setSchema(job,getSchema());
  job.setNumReduceTasks(0);
  assertTrue(job.waitForCompletion(true));
  if (!HCatUtil.isHadoop23()) {
    new FileOutputCommitterContainer(job,null).commitJob(job);
  }
  assertTrue(job.isSuccessful());
  server.setBatchOn();
  server.registerQuery("C = load 'default.demo_table_2' using org.apache.hcatalog.pig.HCatLoader();");
  server.executeBatch();
  Iterator<Tuple> XIter=server.openIterator("C");
  int numTuplesRead=0;
  while (XIter.hasNext()) {
    Tuple t=XIter.next();
    assertEquals(3,t.size());
    assertEquals(t.get(0).toString(),"" + numTuplesRead);
    assertEquals(t.get(1).toString(),"a" + numTuplesRead);
    assertEquals(t.get(2).toString(),"b" + numTuplesRead);
    numTuplesRead++;
  }
  assertEquals(input.length,numTuplesRead);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hcatalog.pig.TestHCatLoaderStorer </h4><pre class="type-7 type-1 type-2 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Ensure Pig can read/write tinyint/smallint columns.
 */
@Test public void testSmallTinyInt() throws Exception {
  String readTblName="test_small_tiny_int";
  File dataDir=new File(TEST_DATA_DIR + "/testSmallTinyIntData");
  File dataFile=new File(dataDir,"testSmallTinyInt.tsv");
  String writeTblName="test_small_tiny_int_write";
  File writeDataFile=new File(TEST_DATA_DIR,writeTblName + ".tsv");
  FileUtil.fullyDelete(dataDir);
  Assert.assertTrue(dataDir.mkdir());
  HcatTestUtils.createTestDataFile(dataFile.getAbsolutePath(),new String[]{String.format("%d\t%d",Short.MIN_VALUE,Byte.MIN_VALUE),String.format("%d\t%d",Short.MAX_VALUE,Byte.MAX_VALUE)});
  Assert.assertEquals(0,driver.run("drop table if exists " + readTblName).getResponseCode());
  Assert.assertEquals(0,driver.run("create external table " + readTblName + " (my_small_int smallint, my_tiny_int tinyint)"+ " row format delimited fields terminated by '\t' stored as textfile").getResponseCode());
  Assert.assertEquals(0,driver.run("load data local inpath '" + dataDir.getAbsolutePath() + "' into table "+ readTblName).getResponseCode());
  PigServer server=new PigServer(ExecType.LOCAL);
  server.registerQuery("data = load '" + readTblName + "' using org.apache.hcatalog.pig.HCatLoader();");
  Schema schema=server.dumpSchema("data");
  Assert.assertEquals(2,schema.getFields().size());
  Assert.assertEquals("my_small_int",schema.getField(0).alias);
  Assert.assertEquals(DataType.INTEGER,schema.getField(0).type);
  Assert.assertEquals("my_tiny_int",schema.getField(1).alias);
  Assert.assertEquals(DataType.INTEGER,schema.getField(1).type);
  Iterator<Tuple> it=server.openIterator("data");
  Tuple t=it.next();
  Assert.assertEquals(new Integer(Short.MIN_VALUE),t.get(0));
  Assert.assertEquals(new Integer(Byte.MIN_VALUE),t.get(1));
  t=it.next();
  Assert.assertEquals(new Integer(Short.MAX_VALUE),t.get(0));
  Assert.assertEquals(new Integer(Byte.MAX_VALUE),t.get(1));
  Assert.assertFalse(it.hasNext());
  Assert.assertEquals(0,driver.run("drop table if exists " + writeTblName).getResponseCode());
  Assert.assertEquals(0,driver.run("create table " + writeTblName + " (my_small_int smallint, my_tiny_int tinyint) stored as rcfile").getResponseCode());
  HcatTestUtils.createTestDataFile(writeDataFile.getAbsolutePath(),new String[]{String.format("%d\t%d",Short.MIN_VALUE,Byte.MIN_VALUE),String.format("%d\t%d",Short.MAX_VALUE,Byte.MAX_VALUE)});
  smallTinyIntBoundsCheckHelper(writeDataFile.getAbsolutePath(),ExecJob.JOB_STATUS.COMPLETED);
  HcatTestUtils.createTestDataFile(TEST_DATA_DIR + "/shortTooSmall.tsv",new String[]{String.format("%d\t%d",Short.MIN_VALUE - 1,0)});
  smallTinyIntBoundsCheckHelper(TEST_DATA_DIR + "/shortTooSmall.tsv",ExecJob.JOB_STATUS.FAILED);
  HcatTestUtils.createTestDataFile(TEST_DATA_DIR + "/shortTooBig.tsv",new String[]{String.format("%d\t%d",Short.MAX_VALUE + 1,0)});
  smallTinyIntBoundsCheckHelper(TEST_DATA_DIR + "/shortTooBig.tsv",ExecJob.JOB_STATUS.FAILED);
  HcatTestUtils.createTestDataFile(TEST_DATA_DIR + "/byteTooSmall.tsv",new String[]{String.format("%d\t%d",0,Byte.MIN_VALUE - 1)});
  smallTinyIntBoundsCheckHelper(TEST_DATA_DIR + "/byteTooSmall.tsv",ExecJob.JOB_STATUS.FAILED);
  HcatTestUtils.createTestDataFile(TEST_DATA_DIR + "/byteTooBig.tsv",new String[]{String.format("%d\t%d",0,Byte.MAX_VALUE + 1)});
  smallTinyIntBoundsCheckHelper(TEST_DATA_DIR + "/byteTooBig.tsv",ExecJob.JOB_STATUS.FAILED);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hcatalog.pig.TestHCatStorer </h4><pre class="type-7 type-11 type-1 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testStoreWithNoSchema() throws IOException, CommandNeedRetryException {
  driver.run("drop table junit_unparted");
  String createTable="create table junit_unparted(a int, b string) stored as RCFILE";
  int retCode=driver.run(createTable).getResponseCode();
  if (retCode != 0) {
    throw new IOException("Failed to create table.");
  }
  int LOOP_SIZE=3;
  String[] input=new String[LOOP_SIZE * LOOP_SIZE];
  int k=0;
  for (int i=1; i <= LOOP_SIZE; i++) {
    String si=i + "";
    for (int j=1; j <= LOOP_SIZE; j++) {
      input[k++]=si + "\t" + j;
    }
  }
  HcatTestUtils.createTestDataFile(INPUT_FILE_NAME,input);
  PigServer server=new PigServer(ExecType.LOCAL);
  server.setBatchOn();
  server.registerQuery("A = load '" + INPUT_FILE_NAME + "' as (a:int, b:chararray);");
  server.registerQuery("store A into 'default.junit_unparted' using " + HCatStorer.class.getName() + "('');");
  server.executeBatch();
  driver.run("select * from junit_unparted");
  ArrayList<String> res=new ArrayList<String>();
  driver.getResults(res);
  driver.run("drop table junit_unparted");
  Iterator<String> itr=res.iterator();
  for (int i=0; i < LOOP_SIZE * LOOP_SIZE; i++) {
    Assert.assertEquals(input[i],itr.next());
  }
  Assert.assertFalse(itr.hasNext());
}

</code></pre>

<br>
<pre class="type-7 type-11 type-1 type-2 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPartColsInData() throws IOException, CommandNeedRetryException {
  driver.run("drop table junit_unparted");
  String createTable="create table junit_unparted(a int) partitioned by (b string) stored as RCFILE";
  int retCode=driver.run(createTable).getResponseCode();
  if (retCode != 0) {
    throw new IOException("Failed to create table.");
  }
  int LOOP_SIZE=11;
  String[] input=new String[LOOP_SIZE];
  for (int i=0; i < LOOP_SIZE; i++) {
    input[i]=i + "\t1";
  }
  HcatTestUtils.createTestDataFile(INPUT_FILE_NAME,input);
  PigServer server=new PigServer(ExecType.LOCAL);
  server.registerQuery("A = load '" + INPUT_FILE_NAME + "' as (a:int, b:chararray);");
  server.registerQuery("store A into 'default.junit_unparted' using " + HCatStorer.class.getName() + "('b=1');");
  server.registerQuery("B = load 'default.junit_unparted' using " + HCatLoader.class.getName() + "();");
  Iterator<Tuple> itr=server.openIterator("B");
  int i=0;
  while (itr.hasNext()) {
    Tuple t=itr.next();
    Assert.assertEquals(2,t.size());
    Assert.assertEquals(t.get(0),i);
    Assert.assertEquals(t.get(1),"1");
    i++;
  }
  Assert.assertFalse(itr.hasNext());
  Assert.assertEquals(11,i);
}

</code></pre>

<br>
<pre class="type-7 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
"></span><br>
@Test public void testEmptyStore() throws IOException, CommandNeedRetryException {
  driver.run("drop table junit_unparted");
  String createTable="create table junit_unparted(a int, b string) stored as RCFILE";
  int retCode=driver.run(createTable).getResponseCode();
  if (retCode != 0) {
    throw new IOException("Failed to create table.");
  }
  int LOOP_SIZE=3;
  String[] input=new String[LOOP_SIZE * LOOP_SIZE];
  int k=0;
  for (int i=1; i <= LOOP_SIZE; i++) {
    String si=i + "";
    for (int j=1; j <= LOOP_SIZE; j++) {
      input[k++]=si + "\t" + j;
    }
  }
  HcatTestUtils.createTestDataFile(INPUT_FILE_NAME,input);
  PigServer server=new PigServer(ExecType.LOCAL);
  server.setBatchOn();
  server.registerQuery("A = load '" + INPUT_FILE_NAME + "' as (a:int, b:chararray);");
  server.registerQuery("B = filter A by a > 100;");
  server.registerQuery("store B into 'default.junit_unparted' using " + HCatStorer.class.getName() + "('','a:int,b:chararray');");
  server.executeBatch();
  driver.run("select * from junit_unparted");
  ArrayList<String> res=new ArrayList<String>();
  driver.getResults(res);
  driver.run("drop table junit_unparted");
  Iterator<String> itr=res.iterator();
  Assert.assertFalse(itr.hasNext());
}

</code></pre>

<br>
<pre class="type-7 type-1 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBagNStruct() throws IOException, CommandNeedRetryException {
  driver.run("drop table junit_unparted");
  String createTable="create table junit_unparted(b string,a struct<a1:int>,  arr_of_struct array<string>, " + "arr_of_struct2 array<struct<s1:string,s2:string>>,  arr_of_struct3 array<struct<s3:string>>) stored as RCFILE";
  int retCode=driver.run(createTable).getResponseCode();
  if (retCode != 0) {
    throw new IOException("Failed to create table.");
  }
  String[] inputData=new String[]{"zookeeper\t(2)\t{(pig)}\t{(pnuts,hdfs)}\t{(hadoop),(hcat)}","chubby\t(2)\t{(sawzall)}\t{(bigtable,gfs)}\t{(mapreduce),(hcat)}"};
  HcatTestUtils.createTestDataFile(INPUT_FILE_NAME,inputData);
  PigServer server=new PigServer(ExecType.LOCAL);
  server.setBatchOn();
  server.registerQuery("A = load '" + INPUT_FILE_NAME + "' as (b:chararray, a:tuple(a1:int), arr_of_struct:bag{mytup:tuple(s1:chararray)}, arr_of_struct2:bag{mytup:tuple(s1:chararray,s2:chararray)}, arr_of_struct3:bag{t3:tuple(s3:chararray)});");
  server.registerQuery("store A into 'default.junit_unparted' using " + HCatStorer.class.getName() + "('','b:chararray, a:tuple(a1:int),"+ " arr_of_struct:bag{mytup:tuple(s1:chararray)}, arr_of_struct2:bag{mytup:tuple(s1:chararray,s2:chararray)}, arr_of_struct3:bag{t3:tuple(s3:chararray)}');");
  server.executeBatch();
  driver.run("select * from junit_unparted");
  ArrayList<String> res=new ArrayList<String>();
  driver.getResults(res);
  driver.run("drop table junit_unparted");
  Iterator<String> itr=res.iterator();
  Assert.assertEquals("zookeeper\t{\"a1\":2}\t[\"pig\"]\t[{\"s1\":\"pnuts\",\"s2\":\"hdfs\"}]\t[{\"s3\":\"hadoop\"},{\"s3\":\"hcat\"}]",itr.next());
  Assert.assertEquals("chubby\t{\"a1\":2}\t[\"sawzall\"]\t[{\"s1\":\"bigtable\",\"s2\":\"gfs\"}]\t[{\"s3\":\"mapreduce\"},{\"s3\":\"hcat\"}]",itr.next());
  Assert.assertFalse(itr.hasNext());
}

</code></pre>

<br>
<pre class="type-7 type-11 type-1 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testStoreFuncSimple() throws IOException, CommandNeedRetryException {
  driver.run("drop table junit_unparted");
  String createTable="create table junit_unparted(a int, b string) stored as RCFILE";
  int retCode=driver.run(createTable).getResponseCode();
  if (retCode != 0) {
    throw new IOException("Failed to create table.");
  }
  int LOOP_SIZE=3;
  String[] inputData=new String[LOOP_SIZE * LOOP_SIZE];
  int k=0;
  for (int i=1; i <= LOOP_SIZE; i++) {
    String si=i + "";
    for (int j=1; j <= LOOP_SIZE; j++) {
      inputData[k++]=si + "\t" + j;
    }
  }
  HcatTestUtils.createTestDataFile(INPUT_FILE_NAME,inputData);
  PigServer server=new PigServer(ExecType.LOCAL);
  server.setBatchOn();
  server.registerQuery("A = load '" + INPUT_FILE_NAME + "' as (a:int, b:chararray);");
  server.registerQuery("store A into 'default.junit_unparted' using " + HCatStorer.class.getName() + "('','a:int,b:chararray');");
  server.executeBatch();
  driver.run("select * from junit_unparted");
  ArrayList<String> res=new ArrayList<String>();
  driver.getResults(res);
  driver.run("drop table junit_unparted");
  Iterator<String> itr=res.iterator();
  for (int i=1; i <= LOOP_SIZE; i++) {
    String si=i + "";
    for (int j=1; j <= LOOP_SIZE; j++) {
      Assert.assertEquals(si + "\t" + j,itr.next());
    }
  }
  Assert.assertFalse(itr.hasNext());
}

</code></pre>

<br>
<pre class="type-7 type-11 type-1 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testStoreWithNoCtorArgs() throws IOException, CommandNeedRetryException {
  driver.run("drop table junit_unparted");
  String createTable="create table junit_unparted(a int, b string) stored as RCFILE";
  int retCode=driver.run(createTable).getResponseCode();
  if (retCode != 0) {
    throw new IOException("Failed to create table.");
  }
  int LOOP_SIZE=3;
  String[] input=new String[LOOP_SIZE * LOOP_SIZE];
  int k=0;
  for (int i=1; i <= LOOP_SIZE; i++) {
    String si=i + "";
    for (int j=1; j <= LOOP_SIZE; j++) {
      input[k++]=si + "\t" + j;
    }
  }
  HcatTestUtils.createTestDataFile(INPUT_FILE_NAME,input);
  PigServer server=new PigServer(ExecType.LOCAL);
  server.setBatchOn();
  server.registerQuery("A = load '" + INPUT_FILE_NAME + "' as (a:int, b:chararray);");
  server.registerQuery("store A into 'junit_unparted' using " + HCatStorer.class.getName() + "();");
  server.executeBatch();
  driver.run("select * from junit_unparted");
  ArrayList<String> res=new ArrayList<String>();
  driver.getResults(res);
  driver.run("drop table junit_unparted");
  Iterator<String> itr=res.iterator();
  for (int i=0; i < LOOP_SIZE * LOOP_SIZE; i++) {
    Assert.assertEquals(input[i],itr.next());
  }
  Assert.assertFalse(itr.hasNext());
}

</code></pre>

<br>
<pre class="type-7 type-11 type-9 type-1 type-2 type-4 type-6 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies assertions inside branch conditions
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testStoreFuncAllSimpleTypes() throws IOException, CommandNeedRetryException {
  driver.run("drop table junit_unparted");
  String createTable="create table junit_unparted(a int, b float, c double, d bigint, e string, f binary, g binary) stored as RCFILE";
  int retCode=driver.run(createTable).getResponseCode();
  if (retCode != 0) {
    throw new IOException("Failed to create table.");
  }
  int i=0;
  String[] input=new String[3];
  input[i++]="0\t\t\t\t\t\t";
  input[i++]="\t" + i * 2.1f + "\t" + i * 1.1d + "\t" + i * 2L + "\t" + "lets hcat" + "\tbinary-data";
  input[i++]=i + "\t" + i * 2.1f + "\t" + i * 1.1d + "\t" + i * 2L + "\t" + "lets hcat" + "\tbinary-data";
  HcatTestUtils.createTestDataFile(INPUT_FILE_NAME,input);
  PigServer server=new PigServer(ExecType.LOCAL);
  server.setBatchOn();
  server.registerQuery("A = load '" + INPUT_FILE_NAME + "' as (a:int, b:float, c:double, d:long, e:chararray, f:bytearray);");
  server.registerQuery("store A into 'default.junit_unparted' using " + HCatStorer.class.getName() + "('','a:int, b:float, c:double, d:long, e:chararray,f:bytearray');");
  server.executeBatch();
  driver.run("select * from junit_unparted");
  ArrayList<String> res=new ArrayList<String>();
  driver.getResults(res);
  Iterator<String> itr=res.iterator();
  Assert.assertEquals("0\tNULL\tNULL\tNULL\tNULL\tnull\tnull",itr.next());
  Assert.assertEquals("NULL\t4.2\t2.2\t4\tlets hcat\tbinary-data\tnull",itr.next());
  Assert.assertEquals("3\t6.2999997\t3.3000000000000003\t6\tlets hcat\tbinary-data\tnull",itr.next());
  Assert.assertFalse(itr.hasNext());
  server.registerQuery("B = load 'junit_unparted' using " + HCatLoader.class.getName() + ";");
  Iterator<Tuple> iter=server.openIterator("B");
  int count=0;
  int num5nulls=0;
  while (iter.hasNext()) {
    Tuple t=iter.next();
    if (t.get(5) == null) {
      num5nulls++;
    }
 else {
      Assert.assertTrue(t.get(5) instanceof DataByteArray);
    }
    Assert.assertNull(t.get(6));
    count++;
  }
  Assert.assertEquals(3,count);
  Assert.assertEquals(1,num5nulls);
  driver.run("drop table junit_unparted");
}

</code></pre>

<br>
<pre class="type-7 type-11 type-1 type-2 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testStoreInPartiitonedTbl() throws IOException, CommandNeedRetryException {
  driver.run("drop table junit_unparted");
  String createTable="create table junit_unparted(a int) partitioned by (b string) stored as RCFILE";
  int retCode=driver.run(createTable).getResponseCode();
  if (retCode != 0) {
    throw new IOException("Failed to create table.");
  }
  int LOOP_SIZE=11;
  String[] input=new String[LOOP_SIZE];
  for (int i=0; i < LOOP_SIZE; i++) {
    input[i]=i + "";
  }
  HcatTestUtils.createTestDataFile(INPUT_FILE_NAME,input);
  PigServer server=new PigServer(ExecType.LOCAL);
  server.registerQuery("A = load '" + INPUT_FILE_NAME + "' as (a:int);");
  server.registerQuery("store A into 'default.junit_unparted' using " + HCatStorer.class.getName() + "('b=1');");
  server.registerQuery("B = load 'default.junit_unparted' using " + HCatLoader.class.getName() + "();");
  Iterator<Tuple> itr=server.openIterator("B");
  int i=0;
  while (itr.hasNext()) {
    Tuple t=itr.next();
    Assert.assertEquals(2,t.size());
    Assert.assertEquals(t.get(0),i);
    Assert.assertEquals(t.get(1),"1");
    i++;
  }
  Assert.assertFalse(itr.hasNext());
  Assert.assertEquals(11,i);
}

</code></pre>

<br>
<pre class="type-7 type-11 type-1 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testStoreMultiTables() throws IOException, CommandNeedRetryException {
  driver.run("drop table junit_unparted");
  String createTable="create table junit_unparted(a int, b string) stored as RCFILE";
  int retCode=driver.run(createTable).getResponseCode();
  if (retCode != 0) {
    throw new IOException("Failed to create table.");
  }
  driver.run("drop table junit_unparted2");
  createTable="create table junit_unparted2(a int, b string) stored as RCFILE";
  retCode=driver.run(createTable).getResponseCode();
  if (retCode != 0) {
    throw new IOException("Failed to create table.");
  }
  int LOOP_SIZE=3;
  String[] input=new String[LOOP_SIZE * LOOP_SIZE];
  int k=0;
  for (int i=1; i <= LOOP_SIZE; i++) {
    String si=i + "";
    for (int j=1; j <= LOOP_SIZE; j++) {
      input[k++]=si + "\t" + j;
    }
  }
  HcatTestUtils.createTestDataFile(INPUT_FILE_NAME,input);
  PigServer server=new PigServer(ExecType.LOCAL);
  server.setBatchOn();
  server.registerQuery("A = load '" + INPUT_FILE_NAME + "' as (a:int, b:chararray);");
  server.registerQuery("B = filter A by a < 2;");
  server.registerQuery("store B into 'junit_unparted' using " + HCatStorer.class.getName() + "();");
  server.registerQuery("C = filter A by a >= 2;");
  server.registerQuery("store C into 'junit_unparted2' using " + HCatStorer.class.getName() + "();");
  server.executeBatch();
  driver.run("select * from junit_unparted");
  ArrayList<String> res=new ArrayList<String>();
  driver.getResults(res);
  driver.run("select * from junit_unparted2");
  ArrayList<String> res2=new ArrayList<String>();
  driver.getResults(res2);
  res.addAll(res2);
  driver.run("drop table junit_unparted");
  driver.run("drop table junit_unparted2");
  Iterator<String> itr=res.iterator();
  for (int i=0; i < LOOP_SIZE * LOOP_SIZE; i++) {
    Assert.assertEquals(input[i],itr.next());
  }
  Assert.assertFalse(itr.hasNext());
}

</code></pre>

<br>
<pre class="type-7 type-1 type-2 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testNoAlias() throws IOException, CommandNeedRetryException {
  driver.run("drop table junit_parted");
  String createTable="create table junit_parted(a int, b string) partitioned by (ds string) stored as RCFILE";
  int retCode=driver.run(createTable).getResponseCode();
  if (retCode != 0) {
    throw new IOException("Failed to create table.");
  }
  PigServer server=new PigServer(ExecType.LOCAL);
  boolean errCaught=false;
  try {
    server.setBatchOn();
    server.registerQuery("A = load '" + INPUT_FILE_NAME + "' as (a:int, b:chararray);");
    server.registerQuery("B = foreach A generate a+10, b;");
    server.registerQuery("store B into 'junit_parted' using " + HCatStorer.class.getName() + "('ds=20100101');");
    server.executeBatch();
  }
 catch (  PigException fe) {
    PigException pe=LogUtils.getPigException(fe);
    Assert.assertTrue(pe instanceof FrontendException);
    Assert.assertEquals(PigHCatUtil.PIG_EXCEPTION_CODE,pe.getErrorCode());
    Assert.assertTrue(pe.getMessage().contains("Column name for a field is not specified. Please provide the full schema as an argument to HCatStorer."));
    errCaught=true;
  }
  Assert.assertTrue(errCaught);
  errCaught=false;
  try {
    server.setBatchOn();
    server.registerQuery("A = load '" + INPUT_FILE_NAME + "' as (a:int, B:chararray);");
    server.registerQuery("B = foreach A generate a, B;");
    server.registerQuery("store B into 'junit_parted' using " + HCatStorer.class.getName() + "('ds=20100101');");
    server.executeBatch();
  }
 catch (  PigException fe) {
    PigException pe=LogUtils.getPigException(fe);
    Assert.assertTrue(pe instanceof FrontendException);
    Assert.assertEquals(PigHCatUtil.PIG_EXCEPTION_CODE,pe.getErrorCode());
    Assert.assertTrue(pe.getMessage().contains("Column names should all be in lowercase. Invalid name found: B"));
    errCaught=true;
  }
  driver.run("drop table junit_parted");
  Assert.assertTrue(errCaught);
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hcatalog.pig.TestHCatStorerWrapper </h4><pre class="type-7 type-11 type-1 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testStoreExternalTableWithExternalDir() throws IOException, CommandNeedRetryException {
  File tmpExternalDir=new File(SystemUtils.getJavaIoTmpDir(),UUID.randomUUID().toString());
  tmpExternalDir.deleteOnExit();
  String part_val="100";
  driver.run("drop table junit_external");
  String createTable="create external table junit_external(a int, b string) partitioned by (c string) stored as RCFILE";
  Assert.assertEquals(0,driver.run(createTable).getResponseCode());
  int LOOP_SIZE=3;
  String[] inputData=new String[LOOP_SIZE * LOOP_SIZE];
  int k=0;
  for (int i=1; i <= LOOP_SIZE; i++) {
    String si=i + "";
    for (int j=1; j <= LOOP_SIZE; j++) {
      inputData[k++]=si + "\t" + j;
    }
  }
  HcatTestUtils.createTestDataFile(INPUT_FILE_NAME,inputData);
  PigServer server=new PigServer(ExecType.LOCAL);
  server.setBatchOn();
  logAndRegister(server,"A = load '" + INPUT_FILE_NAME + "' as (a:int, b:chararray);");
  logAndRegister(server,"store A into 'default.junit_external' using " + HCatStorerWrapper.class.getName() + "('c="+ part_val+ "','"+ tmpExternalDir.getAbsolutePath()+ "');");
  server.executeBatch();
  Assert.assertTrue(tmpExternalDir.exists());
  Assert.assertTrue(new File(tmpExternalDir.getAbsoluteFile() + "/" + "part-m-00000").exists());
  driver.run("select * from junit_external");
  ArrayList<String> res=new ArrayList<String>();
  driver.getResults(res);
  driver.run("drop table junit_external");
  Iterator<String> itr=res.iterator();
  for (int i=1; i <= LOOP_SIZE; i++) {
    String si=i + "";
    for (int j=1; j <= LOOP_SIZE; j++) {
      Assert.assertEquals(si + "\t" + j+ "\t"+ part_val,itr.next());
    }
  }
  Assert.assertFalse(itr.hasNext());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hcatalog.pig.TestPigHCatUtil </h4><pre class="type-7 type-2 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetBagSubSchemaConfigured() throws Exception {
  System.setProperty(HCatConstants.HCAT_PIG_INNER_TUPLE_NAME,"t");
  System.setProperty(HCatConstants.HCAT_PIG_INNER_FIELD_NAME,"FIELDNAME_tuple");
  UDFContext.getUDFContext().setClientSystemProps(System.getProperties());
  ResourceFieldSchema[] bagSubFieldSchemas=new ResourceFieldSchema[1];
  bagSubFieldSchemas[0]=new ResourceFieldSchema().setName("t").setDescription("The tuple in the bag").setType(DataType.TUPLE);
  ResourceFieldSchema[] innerTupleFieldSchemas=new ResourceFieldSchema[1];
  innerTupleFieldSchemas[0]=new ResourceFieldSchema().setName("llama_tuple").setType(DataType.CHARARRAY);
  bagSubFieldSchemas[0].setSchema(new ResourceSchema().setFields(innerTupleFieldSchemas));
  ResourceSchema expected=new ResourceSchema().setFields(bagSubFieldSchemas);
  HCatSchema actualHCatSchema=new HCatSchema(Lists.newArrayList(new HCatFieldSchema("innerLlama",HCatFieldSchema.Type.STRING,null)));
  HCatFieldSchema actualHCatFieldSchema=new HCatFieldSchema("llama",HCatFieldSchema.Type.ARRAY,actualHCatSchema,null);
  ResourceSchema actual=PigHCatUtil.getBagSubSchema(actualHCatFieldSchema);
  Assert.assertEquals(expected.toString(),actual.toString());
}

</code></pre>

<br>
<pre class="type-7 type-2 type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetBagSubSchema() throws Exception {
  ResourceFieldSchema[] bagSubFieldSchemas=new ResourceFieldSchema[1];
  bagSubFieldSchemas[0]=new ResourceFieldSchema().setName("innertuple").setDescription("The tuple in the bag").setType(DataType.TUPLE);
  ResourceFieldSchema[] innerTupleFieldSchemas=new ResourceFieldSchema[1];
  innerTupleFieldSchemas[0]=new ResourceFieldSchema().setName("innerfield").setType(DataType.CHARARRAY);
  bagSubFieldSchemas[0].setSchema(new ResourceSchema().setFields(innerTupleFieldSchemas));
  ResourceSchema expected=new ResourceSchema().setFields(bagSubFieldSchemas);
  HCatSchema hCatSchema=new HCatSchema(Lists.newArrayList(new HCatFieldSchema("innerLlama",HCatFieldSchema.Type.STRING,null)));
  HCatFieldSchema hCatFieldSchema=new HCatFieldSchema("llama",HCatFieldSchema.Type.ARRAY,hCatSchema,null);
  ResourceSchema actual=PigHCatUtil.getBagSubSchema(hCatFieldSchema);
  Assert.assertEquals(expected.toString(),actual.toString());
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hcatalog.templeton.tool.TestTempletonUtils </h4><pre class="type-7 type-11 type-15 type-1 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDecodeArray(){
  Assert.assertTrue(TempletonUtils.encodeArray((String[])null) == null);
  String[] tmp=new String[3];
  tmp[0]="fred";
  tmp[1]=null;
  tmp[2]="peter,lisa,, barney";
  String[] tmp2=TempletonUtils.decodeArray(TempletonUtils.encodeArray(tmp));
  try {
    for (int i=0; i < tmp.length; i++) {
      Assert.assertEquals((String)tmp[i],(String)tmp2[i]);
    }
  }
 catch (  Exception e) {
    Assert.fail("Arrays were not equal" + e.getMessage());
  }
}

</code></pre>

<br>
<h4 style="margin:0px">Class: org.apache.hcatalog.templeton.tool.TestTrivialExecService </h4><pre class="type-7 type-11 type-15 type-4 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void test(){
  ArrayList<String> list=new ArrayList<String>();
  list.add("echo");
  list.add("success");
  BufferedReader out=null;
  BufferedReader err=null;
  try {
    Process process=TrivialExecService.getInstance().run(list,new ArrayList<String>(),new HashMap<String,String>());
    out=new BufferedReader(new InputStreamReader(process.getInputStream()));
    err=new BufferedReader(new InputStreamReader(process.getErrorStream()));
    Assert.assertEquals("success",out.readLine());
    out.close();
    String line;
    while ((line=err.readLine()) != null) {
      Assert.fail(line);
    }
    process.waitFor();
  }
 catch (  Exception e) {
    e.printStackTrace();
    Assert.fail("Process caused exception.");
  }
 finally {
    try {
      out.close();
    }
 catch (    Exception ex) {
    }
    try {
      err.close();
    }
 catch (    Exception ex) {
    }
  }
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
