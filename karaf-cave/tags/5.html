<h3><span class=" glyphicon glyphicon-tag"/>&nbspInternalCallVerifier</h3><kbd>Verifies values of objects/variables related to AUT calls</kbd><br><br><br><h4 style="margin:0px">Class: org.apache.karaf.cave.server.maven.MavenProxyServletTest </h4><pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testConvertNormalPath() throws InvalidMavenArtifactRequest {
  CaveMavenServlet servlet=new CaveMavenServlet(createResolver(),5,null,null,null);
  assertEquals("groupId:artifactId:extension:version",servlet.convertArtifactPathToCoord("groupId/artifactId/version/artifactId-version.extension").toString());
  assertEquals("group.id:artifactId:extension:version",servlet.convertArtifactPathToCoord("group/id/artifactId/version/artifactId-version.extension").toString());
  assertEquals("group.id:artifact.id:extension:version",servlet.convertArtifactPathToCoord("group/id/artifact.id/version/artifact.id-version.extension").toString());
  assertEquals("group-id:artifactId:extension:version",servlet.convertArtifactPathToCoord("group-id/artifactId/version/artifactId-version.extension").toString());
  assertEquals("group-id:artifact-id:extension:version",servlet.convertArtifactPathToCoord("group-id/artifact-id/version/artifact-id-version.extension").toString());
  assertEquals("group-id:my-artifact-id:extension:version",servlet.convertArtifactPathToCoord("group-id/my-artifact-id/version/my-artifact-id-version.extension").toString());
  assertEquals("org.apache.camel.karaf:apache-camel:jar:LATEST",servlet.convertArtifactPathToCoord("org/apache/camel/karaf/apache-camel/LATEST/apache-camel-LATEST.jar").toString());
  assertEquals("org.apache.cxf.karaf:apache-cxf:jar:LATEST",servlet.convertArtifactPathToCoord("org/apache/cxf/karaf/apache-cxf/LATEST/apache-cxf-LATEST.jar").toString());
}

</code></pre>

<br>
<pre class="type-8 type-1 type-5 type-2 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testDownloadMetadata() throws Exception {
  final String old=System.getProperty("karaf.data");
  System.setProperty("karaf.data",new File("target").getCanonicalPath());
  FileUtils.deleteDirectory(new File("target/tmp"));
  Server server=new Server(0);
  server.setHandler(new AbstractHandler(){
    @Override public void handle(    String target,    Request baseRequest,    HttpServletRequest request,    HttpServletResponse response) throws IOException, ServletException {
      String result=null;
      if ("/repo1/org/apache/camel/camel-core/maven-metadata.xml".equals(target)) {
        result="<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n" + "<metadata>\n" + "  <groupId>org.apache.camel</groupId>\n"+ "  <artifactId>camel-core</artifactId>\n"+ "  <versioning>\n"+ "    <latest>2.14.0</latest>\n"+ "    <release>2.14.0</release>\n"+ "    <versions>\n"+ "      <version>1.6.1</version>\n"+ "      <version>1.6.2</version>\n"+ "      <version>1.6.3</version>\n"+ "      <version>1.6.4</version>\n"+ "      <version>2.0-M2</version>\n"+ "      <version>2.0-M3</version>\n"+ "      <version>2.0.0</version>\n"+ "      <version>2.1.0</version>\n"+ "      <version>2.2.0</version>\n"+ "      <version>2.3.0</version>\n"+ "      <version>2.4.0</version>\n"+ "      <version>2.5.0</version>\n"+ "      <version>2.6.0</version>\n"+ "      <version>2.7.0</version>\n"+ "      <version>2.7.1</version>\n"+ "      <version>2.7.2</version>\n"+ "      <version>2.7.3</version>\n"+ "      <version>2.7.4</version>\n"+ "      <version>2.7.5</version>\n"+ "      <version>2.8.0</version>\n"+ "      <version>2.8.1</version>\n"+ "      <version>2.8.2</version>\n"+ "      <version>2.8.3</version>\n"+ "      <version>2.8.4</version>\n"+ "      <version>2.8.5</version>\n"+ "      <version>2.8.6</version>\n"+ "      <version>2.9.0-RC1</version>\n"+ "      <version>2.9.0</version>\n"+ "      <version>2.9.1</version>\n"+ "      <version>2.9.2</version>\n"+ "      <version>2.9.3</version>\n"+ "      <version>2.9.4</version>\n"+ "      <version>2.9.5</version>\n"+ "      <version>2.9.6</version>\n"+ "      <version>2.9.7</version>\n"+ "      <version>2.9.8</version>\n"+ "      <version>2.10.0</version>\n"+ "      <version>2.10.1</version>\n"+ "      <version>2.10.2</version>\n"+ "      <version>2.10.3</version>\n"+ "      <version>2.10.4</version>\n"+ "      <version>2.10.5</version>\n"+ "      <version>2.10.6</version>\n"+ "      <version>2.10.7</version>\n"+ "      <version>2.11.0</version>\n"+ "      <version>2.11.1</version>\n"+ "      <version>2.11.2</version>\n"+ "      <version>2.11.3</version>\n"+ "      <version>2.11.4</version>\n"+ "      <version>2.12.0</version>\n"+ "      <version>2.12.1</version>\n"+ "      <version>2.12.2</version>\n"+ "      <version>2.12.3</version>\n"+ "      <version>2.12.4</version>\n"+ "      <version>2.13.0</version>\n"+ "      <version>2.13.1</version>\n"+ "      <version>2.13.2</version>\n"+ "      <version>2.14.0</version>\n"+ "    </versions>\n"+ "    <lastUpdated>20140918132816</lastUpdated>\n"+ "  </versioning>\n"+ "</metadata>\n"+ "\n";
      }
 else       if ("/repo2/org/apache/camel/camel-core/maven-metadata.xml".equals(target)) {
        result="<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n" + "<metadata modelVersion=\"1.1.0\">\n" + "  <groupId>org.apache.camel</groupId>\n"+ "  <artifactId>camel-core</artifactId>\n"+ "  <versioning>\n"+ "    <latest>2.14.0.redhat-620034</latest>\n"+ "    <release>2.14.0.redhat-620034</release>\n"+ "    <versions>\n"+ "      <version>2.10.0.redhat-60074</version>\n"+ "      <version>2.12.0.redhat-610312</version>\n"+ "      <version>2.12.0.redhat-610328</version>\n"+ "      <version>2.12.0.redhat-610355</version>\n"+ "      <version>2.12.0.redhat-610378</version>\n"+ "      <version>2.12.0.redhat-610396</version>\n"+ "      <version>2.12.0.redhat-610399</version>\n"+ "      <version>2.12.0.redhat-610401</version>\n"+ "      <version>2.12.0.redhat-610402</version>\n"+ "      <version>2.12.0.redhat-611403</version>\n"+ "      <version>2.12.0.redhat-611405</version>\n"+ "      <version>2.12.0.redhat-611406</version>\n"+ "      <version>2.12.0.redhat-611408</version>\n"+ "      <version>2.12.0.redhat-611409</version>\n"+ "      <version>2.12.0.redhat-611410</version>\n"+ "      <version>2.12.0.redhat-611411</version>\n"+ "      <version>2.12.0.redhat-611412</version>\n"+ "      <version>2.14.0.redhat-620031</version>\n"+ "      <version>2.14.0.redhat-620033</version>\n"+ "      <version>2.14.0.redhat-620034</version>\n"+ "    </versions>\n"+ "    <lastUpdated>20141019130841</lastUpdated>\n"+ "  </versioning>\n"+ "</metadata>\n"+ "\n";
      }
      if (result == null) {
        response.setStatus(HttpServletResponse.SC_NOT_FOUND);
        baseRequest.setHandled(true);
        response.getOutputStream().close();
      }
 else {
        response.setStatus(HttpServletResponse.SC_OK);
        baseRequest.setHandled(true);
        response.getOutputStream().write(result.getBytes());
        response.getOutputStream().close();
      }
    }
  }
);
  server.start();
  try {
    int localPort=((NetworkConnector)server.getConnectors()[0]).getLocalPort();
    MavenResolver resolver=createResolver("target/tmp","http://relevant.not/repo1@id=repo1,http://relevant.not/repo2@id=repo2","http","localhost",localPort,"fuse","fuse",null);
    CaveMavenServlet servlet=new CaveMavenServlet(resolver,5,null,null,null);
    AsyncContext context=EasyMock.createMock(AsyncContext.class);
    HttpServletRequest request=EasyMock.createMock(HttpServletRequest.class);
    EasyMock.expect(request.getPathInfo()).andReturn("org/apache/camel/camel-core/maven-metadata.xml");
    EasyMock.expect(request.startAsync()).andReturn(context);
    context.setTimeout(EasyMock.anyInt());
    EasyMock.expectLastCall();
    HttpServletResponse response=EasyMock.createMock(HttpServletResponse.class);
    final ByteArrayOutputStream baos=new ByteArrayOutputStream();
    EasyMock.expect(response.getOutputStream()).andReturn(new ServletOutputStream(){
      @Override public void write(      int b) throws IOException {
        baos.write(b);
      }
      @Override public void write(      byte[] b,      int off,      int len) throws IOException {
        baos.write(b,off,len);
      }
      @Override public boolean isReady(){
        return true;
      }
      @Override public void setWriteListener(      WriteListener writeListener){
      }
    }
).anyTimes();
    response.setStatus(EasyMock.anyInt());
    EasyMock.expectLastCall().anyTimes();
    response.setContentLength(EasyMock.anyInt());
    EasyMock.expectLastCall().anyTimes();
    response.setContentType((String)EasyMock.anyObject());
    EasyMock.expectLastCall().anyTimes();
    response.setDateHeader((String)EasyMock.anyObject(),EasyMock.anyLong());
    EasyMock.expectLastCall().anyTimes();
    response.setHeader((String)EasyMock.anyObject(),(String)EasyMock.anyObject());
    EasyMock.expectLastCall().anyTimes();
    final CountDownLatch latch=new CountDownLatch(1);
    context.complete();
    EasyMock.expectLastCall().andAnswer(new IAnswer(){
      @Override public Object answer() throws Throwable {
        latch.countDown();
        return null;
      }
    }
);
    EasyMock.makeThreadSafe(context,true);
    EasyMock.replay(request,response,context);
    servlet.init();
    servlet.doGet(request,response);
    latch.await();
    shaded.org.apache.maven.artifact.repository.metadata.Metadata m=new MetadataXpp3Reader().read(new ByteArrayInputStream(baos.toByteArray()),false);
    assertEquals("2.14.0.redhat-620034",m.getVersioning().getLatest());
    assertTrue(m.getVersioning().getVersions().contains("2.10.4"));
    assertTrue(m.getVersioning().getVersions().contains("2.12.0.redhat-610399"));
    EasyMock.verify(request,response,context);
  }
  finally {
    server.stop();
    if (old != null) {
      System.setProperty("karaf.data",old);
    }
  }
}

</code></pre>

<br>
<pre class="type-5 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testConvertNormalPathWithClassifier() throws InvalidMavenArtifactRequest {
  CaveMavenServlet servlet=new CaveMavenServlet(createResolver(),5,null,null,null);
  assertEquals("groupId:artifactId:extension:classifier:version",servlet.convertArtifactPathToCoord("groupId/artifactId/version/artifactId-version-classifier.extension").toString());
  assertEquals("group.id:artifactId:extension:classifier:version",servlet.convertArtifactPathToCoord("group/id/artifactId/version/artifactId-version-classifier.extension").toString());
  assertEquals("group.id:artifact.id:extension:classifier:version",servlet.convertArtifactPathToCoord("group/id/artifact.id/version/artifact.id-version-classifier.extension").toString());
  assertEquals("group.id:artifact.id:extension.sha1:classifier:version",servlet.convertArtifactPathToCoord("group/id/artifact.id/version/artifact.id-version-classifier.extension.sha1").toString());
  assertEquals("group.id:artifact.id:extension.md5:classifier:version",servlet.convertArtifactPathToCoord("group/id/artifact.id/version/artifact.id-version-classifier.extension.md5").toString());
  assertEquals("group-id:artifactId:extension:classifier:version",servlet.convertArtifactPathToCoord("group-id/artifactId/version/artifactId-version-classifier.extension").toString());
  assertEquals("group-id:artifact-id:extension:classifier:version",servlet.convertArtifactPathToCoord("group-id/artifact-id/version/artifact-id-version-classifier.extension").toString());
  assertEquals("group-id:my-artifact-id:extension:classifier:version",servlet.convertArtifactPathToCoord("group-id/my-artifact-id/version/my-artifact-id-version-classifier.extension").toString());
  assertEquals("org.apache.camel.karaf:apache-camel:xml:features:LATEST",servlet.convertArtifactPathToCoord("org/apache/camel/karaf/apache-camel/LATEST/apache-camel-LATEST-features.xml").toString());
  assertEquals("org.apache.cxf.karaf:apache-cxf:xml:features:LATEST",servlet.convertArtifactPathToCoord("org/apache/cxf/karaf/apache-cxf/LATEST/apache-cxf-LATEST-features.xml").toString());
}

</code></pre>

<br>
<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
