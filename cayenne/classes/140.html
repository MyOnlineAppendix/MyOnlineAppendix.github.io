<h3 style="margin:0px">Class: org.apache.cayenne.access.DataContextSharedCacheIT (17 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(16)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(16)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(16)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(14)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(8)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies whether two objects/variables are the same"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >IdentityVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-1 type-7 type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSnapshotEvictedForDeleted() throws Exception {
  ObjectId id=artist.getObjectId();
  assertEquals(PersistenceState.COMMITTED,artist.getPersistenceState());
  context.deleteObjects(artist);
  context.getObjectStore().getDataRowCache().forgetSnapshot(id);
  assertNull(context.getObjectStore().getDataRowCache().getCachedSnapshot(id));
  context.commitChanges();
  assertEquals(PersistenceState.TRANSIENT,artist.getPersistenceState());
  assertNull(context.getObjectStore().getDataRowCache().getCachedSnapshot(id));
}

</code></pre>

<pre class="type-1 type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test case to prove that changes made to an object in one ObjectStore and committed
 * to the database will be reflected in the peer ObjectStore using the same
 * DataRowCache.
 */
@Test public void testSnapshotChangePropagation() throws Exception {
  String originalName=artist.getArtistName();
  final String newName="version2";
  final Artist altArtist=context1.localObject(artist);
  assertFalse(altArtist == artist);
  assertEquals(originalName,altArtist.getArtistName());
  assertEquals(PersistenceState.COMMITTED,altArtist.getPersistenceState());
  artist.setArtistName(newName);
  assertEquals(originalName,altArtist.getArtistName());
  context.commitChanges();
  DataRow freshSnapshot=context.getObjectStore().getDataRowCache().getCachedSnapshot(altArtist.getObjectId());
  assertEquals(newName,freshSnapshot.get("ARTIST_NAME"));
  ParallelTestContainer helper=new ParallelTestContainer(){
    @Override protected void assertResult() throws Exception {
      assertEquals(newName,altArtist.getArtistName());
    }
  }
;
  helper.runTest(3000);
}

</code></pre>

<pre class="type-1 type-3 type-7 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test case to prove that inserting an object in one ObjectStore and committing to
 * the database will be reflected in the peer ObjectStore using the same DataRowCache.
 * This would mean refreshing to-many collections.
 * @throws Exception
 */
@Test public void testSnapshotInsertPropagationToManyRefresh() throws Exception {
  Painting painting1=(Painting)context.newObject("Painting");
  painting1.setPaintingTitle("p1");
  painting1.setToArtist(artist);
  context.commitChanges();
  final Artist altArtist=context1.localObject(artist);
  final Painting altPainting1=context1.localObject(painting1);
  assertEquals(artist.getArtistName(),altArtist.getArtistName());
  assertEquals(painting1.getPaintingTitle(),altPainting1.getPaintingTitle());
  assertEquals(1,altArtist.getPaintingArray().size());
  assertEquals(PersistenceState.COMMITTED,altArtist.getPersistenceState());
  assertEquals(PersistenceState.COMMITTED,altPainting1.getPersistenceState());
  Painting painting2=(Painting)context.newObject("Painting");
  painting2.setPaintingTitle("p2");
  painting2.setToArtist(artist);
  context.commitChanges();
  ParallelTestContainer helper=new ParallelTestContainer(){
    @Override protected void assertResult() throws Exception {
      Object value=altArtist.readPropertyDirectly("paintingArray");
      assertTrue("Unexpected: " + value,value instanceof ToManyList);
      assertTrue(((ToManyList)value).isFault());
    }
  }
;
  helper.runTest(2000);
  List<Painting> list=altArtist.getPaintingArray();
  assertEquals(2,list.size());
}

</code></pre>

<pre class="type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void setUp() throws Exception {
  artist=(Artist)context.newObject("Artist");
  artist.setArtistName("version1");
  artist.setDateOfBirth(new Date());
  context.commitChanges();
}

</code></pre>

<pre class="type-1 type-7 type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSnapshotEvictedForCommitted() throws Exception {
  String newName="version2";
  assertEquals(PersistenceState.COMMITTED,artist.getPersistenceState());
  context.getObjectStore().getDataRowCache().forgetSnapshot(artist.getObjectId());
  assertNull(context.getObjectStore().getDataRowCache().getCachedSnapshot(artist.getObjectId()));
  artist.setArtistName(newName);
  context.commitChanges();
  assertEquals(newName,artist.getArtistName());
  DataRow freshSnapshot=context.getObjectStore().getDataRowCache().getCachedSnapshot(artist.getObjectId());
  assertNotNull(freshSnapshot);
  assertEquals(newName,freshSnapshot.get("ARTIST_NAME"));
}

</code></pre>

<pre class="type-8 type-1 type-3 type-7 type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test case to prove that changes made to an object in one ObjectStore and committed
 * to the database will be correctly merged in the peer ObjectStore using the same
 * DataRowCache. E.g. modified objects will be merged so that no new changes are lost.
 * @throws Exception
 */
@Test public void testSnapshotChangePropagationToModifiedObjects() throws Exception {
  String originalName=artist.getArtistName();
  Date originalDate=artist.getDateOfBirth();
  String newName="version2";
  final Date newDate=new Date(originalDate.getTime() - 10000);
  final String newAltName="version3";
  final Artist altArtist=context1.localObject(artist);
  assertNotNull(altArtist);
  assertFalse(altArtist == artist);
  assertEquals(originalName,altArtist.getArtistName());
  assertEquals(PersistenceState.COMMITTED,altArtist.getPersistenceState());
  artist.setArtistName(newName);
  artist.setDateOfBirth(newDate);
  altArtist.setArtistName(newAltName);
  context.commitChanges();
  DataRow freshSnapshot=context.getObjectStore().getDataRowCache().getCachedSnapshot(altArtist.getObjectId());
  assertEquals(newName,freshSnapshot.get("ARTIST_NAME"));
  assertEquals(newDate,freshSnapshot.get("DATE_OF_BIRTH"));
  ParallelTestContainer helper=new ParallelTestContainer(){
    @Override protected void assertResult() throws Exception {
      assertEquals(newAltName,altArtist.getArtistName());
      assertEquals(newDate,altArtist.getDateOfBirth());
      assertEquals(PersistenceState.MODIFIED,altArtist.getPersistenceState());
    }
  }
;
  helper.runTest(3000);
}

</code></pre>

<pre class="type-1 type-3 type-7 type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test case to prove that deleting an object in one ObjectStore and committing to the
 * database will be reflected in the peer ObjectStore using the same DataRowCache. By
 * default COMMITTED objects will be changed to TRANSIENT.
 */
@Test public void testSnapshotDeletePropagationToCommitted() throws Exception {
  final Artist altArtist=context1.localObject(artist);
  assertNotNull(altArtist);
  assertFalse(altArtist == artist);
  assertEquals(artist.getArtistName(),altArtist.getArtistName());
  assertEquals(PersistenceState.COMMITTED,altArtist.getPersistenceState());
  context.deleteObjects(artist);
  context.commitChanges();
  assertNull(context.getObjectStore().getDataRowCache().getCachedSnapshot(altArtist.getObjectId()));
  ParallelTestContainer helper=new ParallelTestContainer(){
    @Override protected void assertResult() throws Exception {
      assertEquals(PersistenceState.TRANSIENT,altArtist.getPersistenceState());
      assertNull(altArtist.getObjectContext());
    }
  }
;
  helper.runTest(3000);
}

</code></pre>

<pre class="type-1 type-3 type-7 type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test case to prove that deleting an object in one ObjectStore and committing to the
 * database will be reflected in the peer ObjectStore using the same DataRowCache. By
 * default DELETED objects will be changed to TRANSIENT.
 * @throws Exception
 */
@Test public void testSnapshotDeletePropagationToDeleted() throws Exception {
  final Artist altArtist=context1.localObject(artist);
  altArtist.getArtistName();
  assertNotNull(altArtist);
  assertFalse(altArtist == artist);
  context1.deleteObjects(altArtist);
  context.deleteObjects(artist);
  context.commitChanges();
  assertNull(context.getObjectStore().getDataRowCache().getCachedSnapshot(altArtist.getObjectId()));
  ParallelTestContainer helper=new ParallelTestContainer(){
    @Override protected void assertResult() throws Exception {
      assertEquals(PersistenceState.TRANSIENT,altArtist.getPersistenceState());
      assertNull(altArtist.getObjectContext());
    }
  }
;
  helper.runTest(3000);
  assertFalse(context1.hasChanges());
}

</code></pre>

<pre class="type-1 type-7 type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSnapshotEvictedForModified() throws Exception {
  String newName="version2";
  assertEquals(PersistenceState.COMMITTED,artist.getPersistenceState());
  artist.setArtistName(newName);
  context.getObjectStore().getDataRowCache().forgetSnapshot(artist.getObjectId());
  assertNull(context.getObjectStore().getDataRowCache().getCachedSnapshot(artist.getObjectId()));
  context.commitChanges();
  assertEquals(newName,artist.getArtistName());
  DataRow freshSnapshot=context.getObjectStore().getDataRowCache().getCachedSnapshot(artist.getObjectId());
  assertNotNull(freshSnapshot);
  assertEquals(newName,freshSnapshot.get("ARTIST_NAME"));
}

</code></pre>

<pre class="type-1 type-3 type-7 type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test case to prove that deleting an object in one ObjectStore and committed to the
 * database will be reflected in the peer ObjectStore using the same DataRowCache. By
 * default HOLLOW objects will be changed to TRANSIENT.
 * @throws Exception
 */
@Test public void testSnapshotDeletePropagationToHollow() throws Exception {
  final Artist altArtist=context1.localObject(artist);
  assertNotNull(altArtist);
  assertFalse(altArtist == artist);
  assertEquals(PersistenceState.HOLLOW,altArtist.getPersistenceState());
  context.deleteObjects(artist);
  context.commitChanges();
  assertNull(context.getObjectStore().getDataRowCache().getCachedSnapshot(altArtist.getObjectId()));
  ParallelTestContainer helper=new ParallelTestContainer(){
    @Override protected void assertResult() throws Exception {
      assertEquals(PersistenceState.TRANSIENT,altArtist.getPersistenceState());
      assertNull(altArtist.getObjectContext());
    }
  }
;
  helper.runTest(3000);
}

</code></pre>

<pre class="type-8 type-1 type-7 type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test case to prove that refreshing snapshots as a result of the database fetch will
 * be propagated across DataContexts.
 */
@Test public void testSnapshotChangePropagationOnSelect() throws Exception {
  String originalName=artist.getArtistName();
  final String newName="version2";
  SQLTemplate query=sqlTemplateCustomizer.createSQLTemplate(Artist.class,"UPDATE ARTIST SET ARTIST_NAME = #bind($newName) " + "WHERE ARTIST_NAME = #bind($oldName)");
  Map map=new HashMap(3);
  map.put("newName",newName);
  map.put("oldName",originalName);
  query.setParameters(map);
  context.performNonSelectingQuery(query);
  Expression qual=ExpressionFactory.matchExp("artistName",newName);
  List artists=context1.performQuery(new SelectQuery(Artist.class,qual));
  assertEquals(1,artists.size());
  Artist altArtist=(Artist)artists.get(0);
  DataRow freshSnapshot=context.getObjectStore().getDataRowCache().getCachedSnapshot(altArtist.getObjectId());
  assertNotNull(freshSnapshot);
  assertEquals(newName,freshSnapshot.get("ARTIST_NAME"));
  assertEquals(newName,altArtist.getArtistName());
  ParallelTestContainer helper=new ParallelTestContainer(){
    @Override protected void assertResult() throws Exception {
      assertEquals("Peer object state wasn't refreshed on fetch",newName,artist.getArtistName());
    }
  }
;
  helper.runTest(3000);
}

</code></pre>

<pre class="type-1 type-3 type-2 type-7 type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test case to prove that deleting an object in one ObjectStore and committing to the
 * database will be reflected in the peer ObjectStore using the same DataRowCache,
 * including proper processing of deleted object being held in to-many collections.
 */
@Test public void testSnapshotDeletePropagationToManyRefresh() throws Exception {
  Painting painting1=(Painting)context.newObject("Painting");
  painting1.setPaintingTitle("p1");
  painting1.setToArtist(artist);
  Painting painting2=(Painting)context.newObject("Painting");
  painting2.setPaintingTitle("p2");
  painting2.setToArtist(artist);
  context.commitChanges();
  final Artist altArtist=context1.localObject(artist);
  final Painting altPainting1=context1.localObject(painting1);
  final Painting altPainting2=context1.localObject(painting2);
  assertEquals(artist.getArtistName(),altArtist.getArtistName());
  assertEquals(painting1.getPaintingTitle(),altPainting1.getPaintingTitle());
  assertEquals(painting2.getPaintingTitle(),altPainting2.getPaintingTitle());
  assertEquals(2,altArtist.getPaintingArray().size());
  assertEquals(PersistenceState.COMMITTED,altArtist.getPersistenceState());
  assertEquals(PersistenceState.COMMITTED,altPainting1.getPersistenceState());
  assertEquals(PersistenceState.COMMITTED,altPainting2.getPersistenceState());
  altPainting1.getToArtist();
  altPainting2.getToArtist();
  assertSame(altArtist,altPainting1.readPropertyDirectly("toArtist"));
  assertSame(altArtist,altPainting2.readPropertyDirectly("toArtist"));
  context.deleteObjects(painting1);
  context.commitChanges();
  assertNull(context.getObjectStore().getDataRowCache().getCachedSnapshot(painting1.getObjectId()));
  ParallelTestContainer helper=new ParallelTestContainer(){
    @Override protected void assertResult() throws Exception {
      assertEquals(PersistenceState.TRANSIENT,altPainting1.getPersistenceState());
      assertEquals(PersistenceState.COMMITTED,altArtist.getPersistenceState());
      Collection<Painting> list=altArtist.getPaintingArray();
      assertEquals(1,list.size());
      assertFalse(list.contains(altPainting1));
    }
  }
;
  helper.runTest(3000);
}

</code></pre>

<pre class="type-1 type-3 type-7 type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test case to prove that deleting an object in one ObjectStore and committed to the
 * database will be reflected in the peer ObjectStore using the same DataRowCache. By
 * default MODIFIED objects will be changed to NEW.
 */
@Test public void testSnapshotDeletePropagationToModified() throws Exception {
  final Artist altArtist=context1.localObject(artist);
  altArtist.getArtistName();
  assertNotNull(altArtist);
  assertFalse(altArtist == artist);
  altArtist.setArtistName("version2");
  assertEquals(PersistenceState.MODIFIED,altArtist.getPersistenceState());
  context.deleteObjects(artist);
  context.commitChanges();
  assertNull(context.getObjectStore().getDataRowCache().getCachedSnapshot(altArtist.getObjectId()));
  ParallelTestContainer helper=new ParallelTestContainer(){
    @Override protected void assertResult() throws Exception {
      assertEquals(PersistenceState.NEW,altArtist.getPersistenceState());
    }
  }
;
  helper.runTest(3000);
  ObjectId id=altArtist.getObjectId();
  assertNotNull(id);
  assertNotNull(id.getIdSnapshot().get(Artist.ARTIST_ID_PK_COLUMN));
  assertFalse(id.isTemporary());
  context1.commitChanges();
  assertEquals(PersistenceState.COMMITTED,altArtist.getPersistenceState());
}

</code></pre>

<pre class="type-1 type-7 type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSnapshotEvictedAndObjectsHollowedForInvalidate() throws Exception {
  String originalName=artist.getArtistName();
  final Artist altArtist=context1.localObject(artist);
  context1.prepareForAccess(altArtist,null,false);
  assertEquals(PersistenceState.COMMITTED,altArtist.getPersistenceState());
  context.invalidateObjects(artist);
  assertEquals(PersistenceState.HOLLOW,artist.getPersistenceState());
  assertNull(context.getObjectStore().getDataRowCache().getCachedSnapshot(artist.getObjectId()));
  new ParallelTestContainer(){
    @Override protected void assertResult() throws Exception {
      assertEquals(PersistenceState.HOLLOW,altArtist.getPersistenceState());
      assertNull(context1.getObjectStore().getDataRowCache().getCachedSnapshot(altArtist.getObjectId()));
    }
  }
.runTest(5000);
  assertEquals(originalName,altArtist.getArtistName());
  DataRow altFreshSnapshot=context1.getObjectStore().getDataRowCache().getCachedSnapshot(altArtist.getObjectId());
  assertNotNull(altFreshSnapshot);
  assertEquals(originalName,altFreshSnapshot.get("ARTIST_NAME"));
}

</code></pre>

<pre class="type-1 type-7 type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSnapshotEvictedForHollow() throws Exception {
  String originalName=artist.getArtistName();
  context.invalidateObjects(artist);
  assertEquals(PersistenceState.HOLLOW,artist.getPersistenceState());
  assertNull(context.getObjectStore().getDataRowCache().getCachedSnapshot(artist.getObjectId()));
  assertEquals(originalName,artist.getArtistName());
  DataRow freshSnapshot=context.getObjectStore().getDataRowCache().getCachedSnapshot(artist.getObjectId());
  assertNotNull(freshSnapshot);
  assertEquals(originalName,freshSnapshot.get("ARTIST_NAME"));
}

</code></pre>

<pre class="type-1 type-7 type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSnapshotEvictedAndChangedForModified() throws Exception {
  String originalName=artist.getArtistName();
  String newName="version2";
  String backendName="version3";
  assertEquals(PersistenceState.COMMITTED,artist.getPersistenceState());
  artist.setArtistName(newName);
  context.getObjectStore().getDataRowCache().forgetSnapshot(artist.getObjectId());
  assertNull(context.getObjectStore().getDataRowCache().getCachedSnapshot(artist.getObjectId()));
  String template="UPDATE ARTIST SET ARTIST_NAME = #bind($newName) WHERE ARTIST_NAME = #bind($oldName)";
  SQLTemplate update=new SQLTemplate(Artist.class,template);
  Map map=new HashMap(3);
  map.put("newName",backendName);
  map.put("oldName",originalName);
  update.setParameters(map);
  context.performNonSelectingQuery(update);
  context.commitChanges();
  assertEquals(newName,artist.getArtistName());
  DataRow freshSnapshot=context.getObjectStore().getDataRowCache().getCachedSnapshot(artist.getObjectId());
  assertNotNull(freshSnapshot);
  assertEquals(newName,freshSnapshot.get("ARTIST_NAME"));
}

</code></pre>

<pre class="type-8 type-1 type-2 type-7 type-4 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Checks that cache is refreshed when a query "refreshingObjects" property is set to
 * true.
 */
@Test public void testCacheRefreshingOnSelect() throws Exception {
  String originalName=artist.getArtistName();
  final String newName="version2";
  DataContext context=(DataContext)artist.getObjectContext();
  DataRow oldSnapshot=context.getObjectStore().getDataRowCache().getCachedSnapshot(artist.getObjectId());
  assertNotNull(oldSnapshot);
  assertEquals(originalName,oldSnapshot.get("ARTIST_NAME"));
  SQLTemplate update=sqlTemplateCustomizer.createSQLTemplate(Artist.class,"UPDATE ARTIST SET ARTIST_NAME = #bind($newName) WHERE ARTIST_NAME = #bind($oldName)");
  Map map=new HashMap(3);
  map.put("newName",newName);
  map.put("oldName",originalName);
  update.setParameters(map);
  context.performNonSelectingQuery(update);
  Expression qual=ExpressionFactory.matchExp("artistName",newName);
  SelectQuery query=new SelectQuery(Artist.class,qual);
  List artists=context.performQuery(query);
  assertEquals(1,artists.size());
  artist=(Artist)artists.get(0);
  DataRow freshSnapshot=context.getObjectStore().getDataRowCache().getCachedSnapshot(artist.getObjectId());
  assertNotSame(oldSnapshot,freshSnapshot);
  assertEquals(newName,freshSnapshot.get("ARTIST_NAME"));
  assertEquals(newName,artist.getArtistName());
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
