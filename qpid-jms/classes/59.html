<h3 style="margin:0px">Class: org.apache.qpid.jms.integration.SessionIntegrationTest (52 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(33)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(11)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(10)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(9)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(8)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(2)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-4 type-5 type-9 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=20000) public void testCreateDurableTopicSubscriber() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    connection.start();
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    String topicName="myTopic";
    Topic dest=session.createTopic(topicName);
    String subscriptionName="mySubscription";
    testPeer.expectDurableSubscriberAttach(topicName,subscriptionName);
    testPeer.expectLinkFlow();
    TopicSubscriber subscriber=session.createDurableSubscriber(dest,subscriptionName);
    assertNotNull("TopicSubscriber object was null",subscriber);
    assertFalse("TopicSubscriber should not be no-local",subscriber.getNoLocal());
    assertNull("TopicSubscriber should not have a selector",subscriber.getMessageSelector());
    testPeer.waitForAllHandlersToComplete(1000);
  }
 }

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateConsumer() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    connection.start();
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    testPeer.expectReceiverAttach();
    testPeer.expectLinkFlow();
    Queue queue=session.createQueue("myQueue");
    session.createConsumer(queue);
    testPeer.waitForAllHandlersToComplete(3000);
  }
 }

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCloseSessionWithConsumerThatRemoteDetachesWithUnackedMessages() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    connection.start();
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    testPeer.expectReceiverAttach();
    testPeer.expectLinkFlow();
    Queue queue=session.createQueue("myQueue");
    session.createConsumer(queue);
    testPeer.expectEnd(false);
    testPeer.sendTransferToLastOpenedLinkOnLastOpenedSession(null,null,null,null,new AmqpValueDescribedType("content"),1);
    testPeer.remotelyDetachLastOpenedLinkOnLastOpenedSession(false,true);
    testPeer.remotelyEndLastOpenedSession(false,200);
    session.close();
    testPeer.expectClose();
    connection.close();
  }
 }

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testSessionHasExpectedConfiguredOutgoingWindow() throws Exception {
  int windowSize=13579;
  doSessionHasExpectedOutgoingWindowTestImpl(windowSize,"?amqp.sessionOutgoingWindow=" + windowSize);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testSessionHasExpectedDefaultOutgoingWindow() throws Exception {
  doSessionHasExpectedOutgoingWindowTestImpl(Integer.MAX_VALUE,null);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateAndDeleteTemporaryQueue() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    connection.start();
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    String dynamicAddress="myTempQueueAddress";
    testPeer.expectTempQueueCreationAttach(dynamicAddress);
    TemporaryQueue tempQueue=session.createTemporaryQueue();
    testPeer.expectDetach(true,true,true);
    tempQueue.delete();
    testPeer.waitForAllHandlersToComplete(1000);
  }
 }

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateTemporaryQueueFailsWhenLinkRefusedAndAttachResponseWriteIsDeferred() throws Exception {
  doCreateTemporaryDestinationFailsWhenLinkRefusedTestImpl(false,true);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateProducerTargetContainsTempTopicCapability() throws Exception {
  doCreateProducerTargetContainsCapabilityTestImpl(TemporaryTopic.class);
}

</code></pre>

<pre class="type-5 type-7 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=20000) public void testAsyncDeliveryOrder() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    connection.start();
    testPeer.expectBegin();
    testPeer.expectCoordinatorAttach();
    Binary txnId=new Binary(new byte[]{(byte)5,(byte)6,(byte)7,(byte)8});
    TransferPayloadCompositeMatcher declareMatcher=new TransferPayloadCompositeMatcher();
    declareMatcher.setMessageContentMatcher(new EncodedAmqpValueMatcher(new Declare()));
    testPeer.expectTransfer(declareMatcher,nullValue(),false,new Declared().setTxnId(txnId),true);
    Session session=connection.createSession(true,Session.SESSION_TRANSACTED);
    testPeer.expectReceiverAttach();
    int messageCount=10;
    testPeer.expectLinkFlowRespondWithTransfer(null,null,null,null,new AmqpValueDescribedType("content"),messageCount,false,false,equalTo(UnsignedInteger.valueOf(JmsPrefetchPolicy.DEFAULT_QUEUE_PREFETCH)),1,true);
    Queue queue=session.createQueue("myQueue");
    MessageConsumer consumer=session.createConsumer(queue);
    testPeer.waitForAllHandlersToComplete(3000);
    for (int i=1; i <= messageCount; i++) {
      TransactionalStateMatcher stateMatcher=new TransactionalStateMatcher();
      stateMatcher.withTxnId(equalTo(txnId));
      stateMatcher.withOutcome(new AcceptedMatcher());
      testPeer.expectDisposition(true,stateMatcher);
    }
    final CountDownLatch done=new CountDownLatch(messageCount);
    final AtomicInteger index=new AtomicInteger(-1);
    consumer.setMessageListener(new DeliveryOrderListener(done,index));
    testPeer.waitForAllHandlersToComplete(3000);
    assertTrue("Not all messages received in given time",done.await(10,TimeUnit.SECONDS));
    assertEquals("Messages were not in expected order, final index was wrong",messageCount - 1,index.get());
  }
 }

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCloseSessionWithConsumerThatRemoteDetaches() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.CLIENT_ACKNOWLEDGE);
    testPeer.expectReceiverAttach();
    testPeer.expectLinkFlow();
    testPeer.expectEnd(false);
    testPeer.remotelyDetachLastOpenedLinkOnLastOpenedSession(false,true);
    testPeer.remotelyEndLastOpenedSession(false);
    Queue queue=session.createQueue("myQueue");
    session.createConsumer(queue);
    session.close();
  }
 }

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateAndDeleteTemporaryTopic() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    connection.start();
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    String dynamicAddress="myTempTopicAddress";
    testPeer.expectTempTopicCreationAttach(dynamicAddress);
    TemporaryTopic tempTopic=session.createTemporaryTopic();
    testPeer.expectDetach(true,true,true);
    tempTopic.delete();
    testPeer.waitForAllHandlersToComplete(1000);
  }
 }

</code></pre>

<pre class="type-4 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test(timeout=20000) public void testCreateAnonymousProducerTargetContainsNoTypeCapabilityWhenAnonymousRelayNodeIsSupported() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Symbol[] serverCapabilities=new Symbol[]{ANONYMOUS_RELAY};
    Connection connection=testFixture.establishConnecton(testPeer,serverCapabilities);
    connection.start();
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    TargetMatcher targetMatcher=new TargetMatcher();
    targetMatcher.withAddress(nullValue());
    targetMatcher.withDynamic(nullValue());
    targetMatcher.withDurable(nullValue());
    targetMatcher.withCapabilities(nullValue());
    testPeer.expectSenderAttach(targetMatcher,false,false);
    MessageProducer producer=session.createProducer(null);
    assertNotNull("Producer object was null",producer);
    testPeer.waitForAllHandlersToComplete(1000);
  }
 }

</code></pre>

<pre class="type-4 type-7 type-9 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=20000) public void testCreateTemporaryTopic() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    connection.start();
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    String dynamicAddress="myTempTopicAddress";
    testPeer.expectTempTopicCreationAttach(dynamicAddress);
    TemporaryTopic tempTopic=session.createTemporaryTopic();
    assertNotNull("TemporaryTopic object was null",tempTopic);
    assertNotNull("TemporaryTopic name was null",tempTopic.getTopicName());
    assertEquals("TemporaryTopic name not as expected",dynamicAddress,tempTopic.getTopicName());
    testPeer.waitForAllHandlersToComplete(1000);
  }
 }

</code></pre>

<pre class="type-11 type-4 type-9 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=20000) public void testDurableSubscriptionUnsubscribeInUseThrowsJMSEx() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    connection.start();
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    String topicName="myTopic";
    Topic dest=session.createTopic(topicName);
    String subscriptionName="mySubscription";
    testPeer.expectDurableSubscriberAttach(topicName,subscriptionName);
    testPeer.expectLinkFlow();
    TopicSubscriber subscriber=session.createDurableSubscriber(dest,subscriptionName);
    assertNotNull("TopicSubscriber object was null",subscriber);
    try {
      session.unsubscribe(subscriptionName);
      fail("Should have thrown a JMSException");
    }
 catch (    JMSException ex) {
    }
    testPeer.expectDetach(false,true,false);
    subscriber.close();
    testPeer.waitForAllHandlersToComplete(1000);
  }
 }

</code></pre>

<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=20000) public void testProducerNotAuthorized() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    connection.start();
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    String topicName="myTopic";
    Topic destination=session.createTopic(topicName);
    testPeer.expectSenderAttach(notNullValue(),notNullValue(),true,false,true,0L,AmqpError.UNAUTHORIZED_ACCESS,"Destination is not readable");
    testPeer.expectDetach(true,true,true);
    try {
      session.createProducer(destination);
      fail("Should have thrown a security exception");
    }
 catch (    JMSSecurityException jmsse) {
    }
    testPeer.waitForAllHandlersToComplete(1000);
  }
 }

</code></pre>

<pre class="type-4 type-5 type-7 type-9 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=20000) public void testIncomingMessageExceedsMaxRedeliveries() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    final int COUNT=5;
    Connection connection=testFixture.establishConnecton(testPeer);
    connection.start();
    ((JmsConnection)connection).getRedeliveryPolicy().setMaxRedeliveries(1);
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    Queue queue=session.createQueue("myQueue");
    HeaderDescribedType header=new HeaderDescribedType();
    header.setDeliveryCount(new UnsignedInteger(2));
    testPeer.expectReceiverAttach();
    testPeer.expectLinkFlowRespondWithTransfer(header,null,null,null,new AmqpValueDescribedType("redelivered-content"),COUNT);
    String expectedContent="not-redelivered";
    testPeer.sendTransferToLastOpenedLinkOnLastOpenedSession(null,null,null,null,new AmqpValueDescribedType(expectedContent),COUNT + 1);
    for (int i=0; i < COUNT; i++) {
      ModifiedMatcher modified=new ModifiedMatcher();
      modified.withDeliveryFailed(equalTo(true));
      modified.withUndeliverableHere(equalTo(true));
      testPeer.expectDisposition(true,modified);
    }
    testPeer.expectDisposition(true,new AcceptedMatcher());
    final MessageConsumer consumer=session.createConsumer(queue);
    Message m=consumer.receive(6000);
    assertNotNull("Should have reiceved the final message",m);
    assertTrue("Should have received the final message",m instanceof TextMessage);
    assertEquals("Unexpected content",expectedContent,((TextMessage)m).getText());
    testPeer.waitForAllHandlersToComplete(2000);
  }
 }

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateAnonymousProducerTargetContainsTempTopicCapabilityWhenAnonymousRelayNodeIsNotSupported() throws Exception {
  doCreateAnonymousProducerTargetContainsCapabilityWhenAnonymousRelayNodeIsNotSupportedTestImpl(TemporaryQueue.class);
}

</code></pre>

<pre class="type-4 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test(timeout=20000) public void testCloseSession() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    assertNotNull("Session should not be null",session);
    testPeer.expectEnd();
    session.close();
    session.close();
  }
 }

</code></pre>

<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=20000) public void testCreateProducerFailsWhenLinkRefusedNoDetachSent() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    ((JmsConnection)connection).setRequestTimeout(500);
    connection.start();
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    String topicName="myTopic";
    Topic dest=session.createTopic(topicName);
    TargetMatcher targetMatcher=new TargetMatcher();
    targetMatcher.withAddress(equalTo(topicName));
    targetMatcher.withDynamic(equalTo(false));
    targetMatcher.withDurable(equalTo(TerminusDurability.NONE));
    testPeer.expectSenderAttach(notNullValue(),targetMatcher,true,true,false,0,null,null);
    testPeer.expectDetach(true,false,false);
    try {
      session.createProducer(dest);
      fail("Producer creation should have failed when link was refused");
    }
 catch (    JMSException ex) {
      LOG.info("Caught expected exception on create: {}",ex.getMessage());
    }
    testPeer.waitForAllHandlersToComplete(1000);
  }
 }

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testPrefetchPolicyInfluencesCreditFlow() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    int newPrefetch=263;
    ((JmsConnection)connection).getPrefetchPolicy().setAll(newPrefetch);
    connection.start();
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    Queue queue=session.createQueue("myQueue");
    testPeer.expectReceiverAttach();
    testPeer.expectLinkFlow(false,false,equalTo(UnsignedInteger.valueOf(newPrefetch)));
    session.createConsumer(queue);
    testPeer.waitForAllHandlersToComplete(1000);
  }
 }

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCloseDurableTopicSubscriberDetachesWithCloseFalse() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    connection.start();
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    String topicName="myTopic";
    Topic dest=session.createTopic(topicName);
    String subscriptionName="mySubscription";
    testPeer.expectDurableSubscriberAttach(topicName,subscriptionName);
    testPeer.expectLinkFlow();
    TopicSubscriber subscriber=session.createDurableSubscriber(dest,subscriptionName);
    testPeer.expectDetach(false,true,false);
    subscriber.close();
    testPeer.waitForAllHandlersToComplete(1000);
  }
 }

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateTemporaryQueueFailsWhenLinkRefusedAndAttachResponseWriteIsNotDeferred() throws Exception {
  doCreateTemporaryDestinationFailsWhenLinkRefusedTestImpl(false,false);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateConsumerFailsWhenLinkRefusedAndAttachResponseWriteIsDeferred() throws Exception {
  doCreateConsumerFailsWhenLinkRefusedTestImpl(true);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateConsumerSourceContainsTempTopicCapability() throws Exception {
  doCreateConsumerSourceContainsCapabilityTestImpl(TemporaryTopic.class);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateAnonymousProducerTargetContainsQueueCapabilityWhenAnonymousRelayNodeIsNotSupported() throws Exception {
  doCreateAnonymousProducerTargetContainsCapabilityWhenAnonymousRelayNodeIsNotSupportedTestImpl(Queue.class);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateProducerFailsWhenLinkRefusedAndAttachResponseWriteIsNotDeferred() throws Exception {
  doCreateProducerFailsWhenLinkRefusedTestImpl(false);
}

</code></pre>

<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=20000) public void testConsumerNotAuthorized() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    connection.start();
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    String topicName="myTopic";
    Topic destination=session.createTopic(topicName);
    testPeer.expectReceiverAttach(notNullValue(),notNullValue(),false,true,false,false,AmqpError.UNAUTHORIZED_ACCESS,"Destination is not readable");
    testPeer.expectDetach(true,true,true);
    try {
      session.createConsumer(destination);
      fail("Should have thrown a security exception");
    }
 catch (    JMSSecurityException jmsse) {
    }
    testPeer.waitForAllHandlersToComplete(1000);
  }
 }

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateAnonymousProducerFailsWhenAnonymousRelayNodeIsSupportedButLinkRefusedAndAttachResponseWriteIsNotDeferred() throws Exception {
  doCreateAnonymousProducerFailsWhenAnonymousRelayNodeIsSupportedButLinkRefusedTestImpl(false);
}

</code></pre>

<pre class="type-4 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test(timeout=20000) public void testCreateAnonymousProducerWhenAnonymousRelayNodeIsSupported() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Symbol[] serverCapabilities=new Symbol[]{ANONYMOUS_RELAY};
    Connection connection=testFixture.establishConnecton(testPeer,serverCapabilities);
    connection.start();
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    String topicName="myTopic";
    Topic dest=session.createTopic(topicName);
    TargetMatcher targetMatcher=new TargetMatcher();
    targetMatcher.withAddress(nullValue());
    targetMatcher.withDynamic(nullValue());
    targetMatcher.withDurable(nullValue());
    testPeer.expectSenderAttach(targetMatcher,false,false);
    MessageProducer producer=session.createProducer(null);
    assertNotNull("Producer object was null",producer);
    MessageHeaderSectionMatcher headersMatcher=new MessageHeaderSectionMatcher(true);
    MessageAnnotationsSectionMatcher msgAnnotationsMatcher=new MessageAnnotationsSectionMatcher(true);
    TransferPayloadCompositeMatcher messageMatcher=new TransferPayloadCompositeMatcher();
    messageMatcher.setHeadersMatcher(headersMatcher);
    messageMatcher.setMessageAnnotationsMatcher(msgAnnotationsMatcher);
    testPeer.expectTransfer(messageMatcher);
    Message message=session.createMessage();
    producer.send(dest,message);
    testPeer.expectTransfer(messageMatcher);
    producer.send(dest,message);
    testPeer.waitForAllHandlersToComplete(1000);
  }
 }

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateProducerTargetContainsTopicCapability() throws Exception {
  doCreateProducerTargetContainsCapabilityTestImpl(Topic.class);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateTemporaryTopicFailsWhenLinkRefusedAndAttachResponseWriteIsDeferred() throws Exception {
  doCreateTemporaryDestinationFailsWhenLinkRefusedTestImpl(true,true);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateConsumerFailsWhenLinkRefusedAndAttachResponseWriteIsNotDeferred() throws Exception {
  doCreateConsumerFailsWhenLinkRefusedTestImpl(false);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateConsumerSourceContainsQueueCapability() throws Exception {
  doCreateConsumerSourceContainsCapabilityTestImpl(Queue.class);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateTemporaryTopicFailsWhenLinkRefusedAndAttachResponseWriteIsNotDeferred() throws Exception {
  doCreateTemporaryDestinationFailsWhenLinkRefusedTestImpl(true,false);
}

</code></pre>

<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=20000) public void testCreateConsumerFailsWhenLinkRefusalResponseNotSent() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    ((JmsConnection)connection).setRequestTimeout(500);
    connection.start();
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    String topicName="myTopic";
    Topic dest=session.createTopic(topicName);
    SourceMatcher targetMatcher=new SourceMatcher();
    targetMatcher.withAddress(equalTo(topicName));
    targetMatcher.withDynamic(equalTo(false));
    targetMatcher.withDurable(equalTo(TerminusDurability.NONE));
    testPeer.expectReceiverAttach(notNullValue(),targetMatcher,false,true,true,false,null,null);
    testPeer.expectDetach(true,false,false);
    try {
      session.createConsumer(dest);
      fail("Consumer creation should have failed when link was refused");
    }
 catch (    JMSException ex) {
      LOG.info("Caught expected error on consumer create: {}",ex.getMessage());
    }
    testPeer.waitForAllHandlersToComplete(1000);
  }
 }

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateProducerTargetContainsTempQueueCapability() throws Exception {
  doCreateProducerTargetContainsCapabilityTestImpl(TemporaryQueue.class);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateProducerFailsWhenLinkRefusedAndAttachResponseWriteIsDeferred() throws Exception {
  doCreateProducerFailsWhenLinkRefusedTestImpl(true);
}

</code></pre>

<pre class="type-6 type-11 type-4 type-5 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=20000) public void testRemotelyEndSessionWithConsumer() throws Exception {
  final String BREAD_CRUMB="ErrorMessage";
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    testPeer.expectReceiverAttach();
    testPeer.expectLinkFlow();
    testPeer.remotelyEndLastOpenedSession(true,0,AmqpError.RESOURCE_DELETED,BREAD_CRUMB);
    Queue queue=session.createQueue("myQueue");
    final MessageConsumer consumer=session.createConsumer(queue);
    testPeer.waitForAllHandlersToComplete(1000);
    assertTrue("consumer never closed.",Wait.waitFor(new Wait.Condition(){
      @Override public boolean isSatisified() throws Exception {
        try {
          consumer.getMessageListener();
        }
 catch (        IllegalStateException jmsise) {
          if (jmsise.getCause() != null) {
            String message=jmsise.getCause().getMessage();
            return message.contains(AmqpError.RESOURCE_DELETED.toString()) && message.contains(BREAD_CRUMB);
          }
 else {
            return false;
          }
        }
        return false;
      }
    }
,15000,10));
    try {
      session.getAcknowledgeMode();
      fail("Expected ISE to be thrown due to being closed");
    }
 catch (    IllegalStateException jmsise) {
      String message=jmsise.getCause().getMessage();
      assertTrue(message.contains(AmqpError.RESOURCE_DELETED.toString()));
      assertTrue(message.contains(BREAD_CRUMB));
    }
    consumer.close();
  }
 }

</code></pre>

<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=20000) public void testCreateDurableTopicSubscriberFailsIfConnectionDoesntHaveExplicitClientID() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer,false,null,null,null,false);
    connection.start();
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    String topicName="myTopic";
    Topic dest=session.createTopic(topicName);
    String subscriptionName="mySubscription";
    try {
      session.createDurableSubscriber(dest,subscriptionName);
      fail("expected exception to be thrown due to lack of explicit clientID");
    }
 catch (    IllegalStateException ise) {
    }
    testPeer.waitForAllHandlersToComplete(1000);
  }
 }

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateConsumerSourceContainsTempQueueCapability() throws Exception {
  doCreateConsumerSourceContainsCapabilityTestImpl(TemporaryQueue.class);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateAnonymousProducerTargetContainsTempQueueCapabilityWhenAnonymousRelayNodeIsNotSupported() throws Exception {
  doCreateAnonymousProducerTargetContainsCapabilityWhenAnonymousRelayNodeIsNotSupportedTestImpl(TemporaryQueue.class);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateAnonymousProducerFailsWhenAnonymousRelayNodeIsSupportedButLinkRefusedAndAttachResponseWriteIsDeferred() throws Exception {
  doCreateAnonymousProducerFailsWhenAnonymousRelayNodeIsSupportedButLinkRefusedTestImpl(true);
}

</code></pre>

<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=20000) public void testInvalidSelector() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    connection.start();
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    String topicName="myTopic";
    Topic destination=session.createTopic(topicName);
    try {
      session.createConsumer(destination,"3+5");
      fail("Should have thrown a invalid selector exception");
    }
 catch (    InvalidSelectorException jmsse) {
    }
    testPeer.waitForAllHandlersToComplete(1000);
  }
 }

</code></pre>

<pre class="type-4 type-9 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test(timeout=20000) public void testCreateAnonymousProducerWhenAnonymousRelayNodeIsNotSupported() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    connection.start();
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    String topicName="myTopic";
    Topic dest=session.createTopic(topicName);
    MessageProducer producer=session.createProducer(null);
    assertNotNull("Producer object was null",producer);
    TargetMatcher targetMatcher=new TargetMatcher();
    targetMatcher.withAddress(equalTo(topicName));
    targetMatcher.withDynamic(equalTo(false));
    targetMatcher.withDurable(equalTo(TerminusDurability.NONE));
    MessageHeaderSectionMatcher headersMatcher=new MessageHeaderSectionMatcher(true);
    MessageAnnotationsSectionMatcher msgAnnotationsMatcher=new MessageAnnotationsSectionMatcher(true);
    TransferPayloadCompositeMatcher messageMatcher=new TransferPayloadCompositeMatcher();
    messageMatcher.setHeadersMatcher(headersMatcher);
    messageMatcher.setMessageAnnotationsMatcher(msgAnnotationsMatcher);
    testPeer.expectSenderAttach(targetMatcher,false,false);
    testPeer.expectTransfer(messageMatcher);
    testPeer.expectDetach(true,true,true);
    Message message=session.createMessage();
    producer.send(dest,message);
    testPeer.expectSenderAttach(targetMatcher,false,false);
    testPeer.expectTransfer(messageMatcher);
    testPeer.expectDetach(true,true,true);
    producer.send(dest,message);
    testPeer.waitForAllHandlersToComplete(1000);
  }
 }

</code></pre>

<pre class="type-11 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test(timeout=20000) public void testCreateBrowserFailsWhenLinkRefusalResponseNotSent() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    ((JmsConnection)connection).setRequestTimeout(500);
    connection.start();
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    String queueName="myQueue";
    Queue dest=session.createQueue(queueName);
    testPeer.expectReceiverAttach(notNullValue(),notNullValue(),true,true,true,false,null,null);
    testPeer.expectDetach(true,false,false);
    try {
      QueueBrowser browser=session.createBrowser(dest);
      browser.getEnumeration();
      fail("Consumer creation should have failed when link was refused");
    }
 catch (    JMSException ex) {
      LOG.info("Caught expected error on browser create: {}",ex.getMessage());
    }
    testPeer.waitForAllHandlersToComplete(1000);
  }
 }

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateProducerLinkSupportsAcceptedAndRejectedOutcomes() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    String queueName="myQueue";
    SourceMatcher sourceMatcher=new SourceMatcher();
    sourceMatcher.withOutcomes(arrayContaining(Accepted.DESCRIPTOR_SYMBOL,Rejected.DESCRIPTOR_SYMBOL));
    TargetMatcher targetMatcher=new TargetMatcher();
    targetMatcher.withAddress(equalTo(queueName));
    testPeer.expectSenderAttach(sourceMatcher,targetMatcher,false,false);
    Queue queue=session.createQueue(queueName);
    session.createProducer(queue);
  }
 }

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateAnonymousProducerTargetContainsTopicCapabilityWhenAnonymousRelayNodeIsNotSupported() throws Exception {
  doCreateAnonymousProducerTargetContainsCapabilityWhenAnonymousRelayNodeIsNotSupportedTestImpl(Topic.class);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateProducer() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    testPeer.expectSenderAttach();
    Queue queue=session.createQueue("myQueue");
    session.createProducer(queue);
  }
 }

</code></pre>

<pre class="type-6 type-11 type-4 type-5 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=20000) @Repeat(repetitions=1) public void testRemotelyEndSessionWithProducer() throws Exception {
  final String BREAD_CRUMB="ErrorMessage";
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    testPeer.expectSenderAttach();
    testPeer.remotelyEndLastOpenedSession(true,0,AmqpError.RESOURCE_DELETED,BREAD_CRUMB);
    Queue queue=session.createQueue("myQueue");
    final MessageProducer producer=session.createProducer(queue);
    testPeer.waitForAllHandlersToComplete(1000);
    assertTrue("producer never closed.",Wait.waitFor(new Wait.Condition(){
      @Override public boolean isSatisified() throws Exception {
        try {
          producer.getDestination();
        }
 catch (        IllegalStateException jmsise) {
          if (jmsise.getCause() != null) {
            String message=jmsise.getCause().getMessage();
            return message.contains(AmqpError.RESOURCE_DELETED.toString()) && message.contains(BREAD_CRUMB);
          }
 else {
            return false;
          }
        }
        return false;
      }
    }
,15000,10));
    try {
      session.getAcknowledgeMode();
      fail("Expected ISE to be thrown due to being closed");
    }
 catch (    IllegalStateException jmsise) {
      String message=jmsise.getCause().getMessage();
      assertTrue(message.contains(AmqpError.RESOURCE_DELETED.toString()));
      assertTrue(message.contains(BREAD_CRUMB));
    }
    producer.close();
  }
 }

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateProducerTargetContainsQueueCapability() throws Exception {
  doCreateProducerTargetContainsCapabilityTestImpl(Queue.class);
}

</code></pre>

<pre class="type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test(timeout=20000) public void testCreateConsumerSourceContainsTopicCapability() throws Exception {
  doCreateConsumerSourceContainsCapabilityTestImpl(Topic.class);
}

</code></pre>

<pre class="type-4 type-7 type-9 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(timeout=20000) public void testCreateTemporaryQueue() throws Exception {
  try (TestAmqpPeer testPeer=new TestAmqpPeer()){
    Connection connection=testFixture.establishConnecton(testPeer);
    connection.start();
    testPeer.expectBegin();
    Session session=connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    String dynamicAddress="myTempQueueAddress";
    testPeer.expectTempQueueCreationAttach(dynamicAddress);
    TemporaryQueue tempQueue=session.createTemporaryQueue();
    assertNotNull("TemporaryQueue object was null",tempQueue);
    assertNotNull("TemporaryQueue queue name was null",tempQueue.getQueueName());
    assertEquals("TemporaryQueue name not as expected",dynamicAddress,tempQueue.getQueueName());
    testPeer.waitForAllHandlersToComplete(1000);
  }
 }

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
