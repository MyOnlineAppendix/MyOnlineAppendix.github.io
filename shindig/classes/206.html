<h3 style="margin:0px">Class: org.apache.shindig.gadgets.servlet.GadgetsHandlerServiceTest (37 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(18)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(18)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(17)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >ExceptionVerifier&nbsp;(16)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(13)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(11)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(9)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="11"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('11')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-11"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=ProcessingException.class) public void testGetMetadataNoFields() throws Exception {
  GadgetsHandlerApi.MetadataRequest request=createMetadataRequest(FakeProcessor.SPEC_URL,CONTAINER,null,createAuthContext(null,null),null);
  replay();
  gadgetHandler.getMetadata(request);
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testFeatureAdminAllowedGadget() throws Exception {
  GadgetsHandlerApi.MetadataRequest request=createMetadataRequest(FakeProcessor.SPEC_URL4,CONTAINER,"default",createAuthContext(null,null),ImmutableList.of("*"));
  setupMockGadgetAdminStore(true);
  setupMockRegistry(Lists.newArrayList("example-feature","example-feature2"));
  GadgetsHandlerApi.MetadataResponse response=gadgetHandlerWithAdmin.getMetadata(request);
  assertEquals(FakeIframeUriManager.IFRAME_URIS_STRINGS,response.getIframeUrls());
  assertEquals(1,response.getViews().size());
  assertEquals(FakeProcessor.SPEC_TITLE,response.getModulePrefs().getTitle());
  assertEquals(FakeProcessor.LINK_HREF,response.getModulePrefs().getLinks().get(FakeProcessor.LINK_REL).getHref().toString());
  assertEquals(FakeProcessor.LINK_REL,response.getModulePrefs().getLinks().get(FakeProcessor.LINK_REL).getRel());
  assertEquals(1,response.getUserPrefs().size());
  assertEquals("up_one",response.getUserPrefs().get("up_one").getDisplayName());
  assertEquals(4,response.getUserPrefs().get("up_one").getOrderedEnumValues().size());
  assertEquals(CURRENT_TIME_MS,response.getResponseTimeMs());
  assertEquals(METADATA_EXPIRY_TIME_MS,response.getExpireTimeMs());
  assertEquals(Sets.newHashSet(RPC_SERVICE_1,RPC_SERVICE_2,RPC_SERVICE_3),response.getRpcServiceIds());
  verify();
}

</code></pre>

<pre class="type-11 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCreateCajaResponse() throws Exception {
  String goldenEntries[][]={{"name1","LINT","msg1"},{"name2","LINT","msg2"}};
  List<GadgetsHandlerApi.Message> goldenMessages=Lists.newArrayList();
  for (  String[] goldenEntry : goldenEntries) {
    GadgetsHandlerApi.Message m=mock(GadgetsHandlerApi.Message.class);
    expect(m.getName()).andReturn(goldenEntry[0]);
    expect(m.getLevel()).andReturn(GadgetsHandlerApi.MessageLevel.valueOf(goldenEntry[1]));
    expect(m.getMessage()).andReturn(goldenEntry[2]);
    goldenMessages.add(m);
  }
  replay();
  Uri jsUri=Uri.parse("http://www.shindig.com/js");
  GadgetsHandlerApi.CajaResponse jsResponse=gadgetHandler.createCajaResponse(jsUri,"html","js",goldenMessages,ImmutableSet.of("*"),null);
  BeanDelegator.validateDelegator(jsResponse);
  assertEquals("html",jsResponse.getHtml());
  assertEquals("js",jsResponse.getJs());
  List<GadgetsHandlerApi.Message> response=jsResponse.getMessages();
  assertEquals(goldenMessages.size(),response.size());
  for (int i=0; i < response.size(); i++) {
    assertEquals(goldenEntries[i][0],response.get(i).getName());
    assertEquals(goldenEntries[i][1],response.get(i).getLevel().name());
    assertEquals(goldenEntries[i][2],response.get(i).getMessage());
  }
}

</code></pre>

<pre class="type-9 type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetTokenNoToken() throws Exception {
  GadgetsHandlerApi.TokenRequest request=createTokenRequest(FakeProcessor.SPEC_URL,CONTAINER,null,ImmutableList.of("*"));
  replay();
  tokenCodec.encodedToken=TOKEN;
  GadgetsHandlerApi.TokenResponse response=gadgetHandler.getToken(request);
  assertEquals(TOKEN,response.getToken());
  assertNull(CONTAINER,tokenCodec.authContext);
  verify();
}

</code></pre>

<pre class="type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=ProcessingException.class) public void testJsNoContainer() throws Exception {
  List<String> fields=ImmutableList.of("*");
  GadgetsHandlerApi.JsRequest request=createJsRequest(null,null,fields,ImmutableList.of("rpc"),null);
  gadgetHandler.getJs(request);
}

</code></pre>

<pre class="type-9 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testGetMetadataWithalwaysAppendST() throws Exception {
  GadgetsHandlerApi.MetadataRequest request=createMetadataRequest(FakeProcessor.SPEC_URL,CONTAINER,"default",createAuthContext(null,null),ImmutableList.of("*"));
  setupMockGadgetAdminStore(true);
  setupMockRegistry(ImmutableList.<String>of(""));
  expect(config.getBool(CONTAINER,DefaultIframeUriManager.SECURITY_TOKEN_ALWAYS_KEY)).andReturn(true).once();
  replay(config);
  GadgetsHandlerApi.MetadataResponse response=gadgetHandler.getMetadata(request);
  assertTrue(response.getNeedsTokenRefresh());
  verify();
}

</code></pre>

<pre class="type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCreateProxyUri() throws Exception {
  GadgetsHandlerApi.ImageParams image=mock(GadgetsHandlerApi.ImageParams.class);
  expect(image.getDoNotExpand()).andStubReturn(true);
  expect(image.getHeight()).andStubReturn(120);
  expect(image.getWidth()).andStubReturn(210);
  expect(image.getQuality()).andStubReturn(77);
  GadgetsHandlerApi.ProxyRequest request=mock(GadgetsHandlerApi.ProxyRequest.class);
  expect(request.getContainer()).andStubReturn(CONTAINER);
  expect(request.getUrl()).andStubReturn(RESOURCE);
  expect(request.getRefresh()).andStubReturn(new Integer(333));
  expect(request.getDebug()).andStubReturn(true);
  expect(request.getFallbackUrl()).andStubReturn(FALLBACK);
  expect(request.getGadget()).andStubReturn(FakeProcessor.SPEC_URL.toString());
  expect(request.getIgnoreCache()).andStubReturn(true);
  expect(request.getImageParams()).andStubReturn(image);
  expect(request.getRewriteMimeType()).andStubReturn("image/png");
  expect(request.getSanitize()).andStubReturn(true);
  replay();
  ProxyUri pUri=gadgetHandler.createProxyUri(request);
  ProxyUri expectedUri=new ProxyUri(333,true,true,CONTAINER,FakeProcessor.SPEC_URL.toString(),RESOURCE);
  expectedUri.setRewriteMimeType("image/png").setSanitizeContent(true);
  expectedUri.setResize(210,120,77,true).setFallbackUrl(FALLBACK);
  assertEquals(pUri,expectedUri);
  verify();
}

</code></pre>

<pre class="type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void setUp(){
  tokenCodec=new FakeSecurityTokenCodec();
  featureRegistryProvider=new FeatureRegistryProvider(){
    public FeatureRegistry get(    String repository) throws GadgetException {
      return mockRegistry;
    }
  }
;
  config=createMock(ContainerConfig.class);
  gadgetHandler=new GadgetsHandlerService(timeSource,processor,urlGenerator,tokenCodec,proxyUriManager,jsUriManager,proxyHandler,jsPipeline,jsRequestBuilder,SPEC_REFRESH_INTERVAL_MS,new BeanFilter(),cajaContentRewriter,gadgetAdminStore,featureRegistryProvider,new ModuleIdManagerImpl(),config);
  gadgetHandlerWithAdmin=new GadgetsHandlerService(timeSource,processor,urlGenerator,tokenCodec,proxyUriManager,jsUriManager,proxyHandler,jsPipeline,jsRequestBuilder,SPEC_REFRESH_INTERVAL_MS,new BeanFilter(),cajaContentRewriter,gadgetAdminStore,featureRegistryProvider,new ModuleIdManagerImpl(),config);
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testHandlerDataDelegation() throws Exception {
  delegator.validate();
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetToken() throws Exception {
  GadgetsHandlerApi.TokenRequest request=createTokenRequest(FakeProcessor.SPEC_URL,CONTAINER,createAuthContext(OWNER,VIEWER),ImmutableList.of("*"));
  replay();
  tokenCodec.encodedToken=TOKEN;
  GadgetsHandlerApi.TokenResponse response=gadgetHandler.getToken(request);
  assertEquals(TOKEN,response.getToken());
  assertEquals(CURRENT_TIME_MS,response.getResponseTimeMs());
  assertEquals(TOKEN_EXPIRY_TIME_MS,response.getExpireTimeMs());
  assertEquals(OWNER,tokenCodec.authContext.getOwnerId());
  assertEquals(VIEWER,tokenCodec.authContext.getViewerId());
  assertEquals(CONTAINER,tokenCodec.authContext.getContainer());
  verify();
}

</code></pre>

<pre class="type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=ProcessingException.class) public void testGetProxyNoContainer() throws Exception {
  List<String> fields=ImmutableList.of("*");
  GadgetsHandlerApi.ProxyRequest request=createProxyRequest(RESOURCE,null,fields);
  gadgetHandler.getProxy(request);
}

</code></pre>

<pre class="type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=ProcessingException.class) public void testGetTokenNoContainer() throws Exception {
  GadgetsHandlerApi.TokenRequest request=createTokenRequest(FakeProcessor.SPEC_URL,null,createAuthContext(OWNER,VIEWER),ImmutableList.of("*"));
  replay();
  gadgetHandler.getToken(request);
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetMetadataNoToken() throws Exception {
  GadgetsHandlerApi.MetadataRequest request=createMetadataRequest(FakeProcessor.SPEC_URL,CONTAINER,"default",null,ImmutableList.of("*"));
  setupMockGadgetAdminStore(true);
  setupMockRegistry(Lists.newArrayList("auth-refresh"));
  GadgetsHandlerApi.MetadataResponse response=gadgetHandler.getMetadata(request);
  assertEquals(FakeIframeUriManager.IFRAME_URIS_STRINGS,response.getIframeUrls());
  verify();
}

</code></pre>

<pre class="type-9 type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetProxyEmptyData() throws Exception {
  List<String> fields=ImmutableList.of("proxycontent.*");
  Uri resUri=Uri.parse("server.com/gadgets/proxy?url=" + RESOURCE);
  GadgetsHandlerApi.ProxyRequest request=createProxyRequest(RESOURCE,CONTAINER,fields);
  Capture<List<ProxyUri>> uriCapture=new Capture<List<ProxyUri>>();
  expect(proxyUriManager.make(capture(uriCapture),EasyMock.anyInt())).andReturn(ImmutableList.of(resUri));
  HttpResponse httpResponse=new HttpResponseBuilder().setHttpStatusCode(504).create();
  expect(proxyHandler.fetch(EasyMock.isA(ProxyUri.class))).andReturn(httpResponse);
  replay();
  GadgetsHandlerApi.ProxyResponse response=gadgetHandler.getProxy(request);
  assertEquals(1,uriCapture.getValue().size());
  ProxyUri pUri=uriCapture.getValue().get(0);
  assertEquals(CONTAINER,pUri.getContainer());
  assertNull(response.getProxyUrl());
  assertEquals("",response.getProxyContent().getContentBase64());
  assertEquals(504,response.getProxyContent().getCode());
  verify();
}

</code></pre>

<pre class="type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=ProcessingException.class) public void testGetMetadataNoContainer() throws Exception {
  GadgetsHandlerApi.MetadataRequest request=createMetadataRequest(FakeProcessor.SPEC_URL,null,null,createAuthContext(null,null),ImmutableList.of("*"));
  replay();
  gadgetHandler.getMetadata(request);
}

</code></pre>

<pre class="type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=ProcessingException.class) public void testGetMetadataNoUrl() throws Exception {
  GadgetsHandlerApi.MetadataRequest request=createMetadataRequest(null,CONTAINER,null,createAuthContext(null,null),ImmutableList.of("*"));
  replay();
  gadgetHandler.getMetadata(request);
}

</code></pre>

<pre class="type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=ProcessingException.class) public void testGetProxyNoFields() throws Exception {
  GadgetsHandlerApi.ProxyRequest request=createProxyRequest(RESOURCE,CONTAINER,null);
  gadgetHandler.getProxy(request);
}

</code></pre>

<pre class="type-9 type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetProxySimple() throws Exception {
  List<String> fields=ImmutableList.of("proxyurl");
  Uri resUri=Uri.parse("server.com/gadgets/proxy?url=" + RESOURCE);
  GadgetsHandlerApi.ProxyRequest request=createProxyRequest(RESOURCE,CONTAINER,fields);
  Capture<List<ProxyUri>> uriCapture=new Capture<List<ProxyUri>>();
  expect(proxyUriManager.make(capture(uriCapture),EasyMock.anyInt())).andReturn(ImmutableList.of(resUri));
  replay();
  GadgetsHandlerApi.ProxyResponse response=gadgetHandler.getProxy(request);
  assertEquals(1,uriCapture.getValue().size());
  ProxyUri pUri=uriCapture.getValue().get(0);
  assertEquals(CONTAINER,pUri.getContainer());
  assertEquals(resUri,response.getProxyUrl());
  assertNull(response.getProxyContent());
  assertEquals(timeSource.currentTimeMillis() + HttpUtil.getDefaultTtl() * 1000,response.getExpireTimeMs().longValue());
  verify();
}

</code></pre>

<pre class="type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testFilterProxyResponse() throws Exception {
  HttpResponse httpResponse=new HttpResponse("data");
  GadgetsHandlerApi.ProxyResponse response=gadgetHandler.createProxyResponse(RESOURCE,httpResponse,ImmutableSet.<String>of("proxyurl"),1000001L);
  assertNull(response.getProxyContent());
  assertEquals(RESOURCE,response.getProxyUrl());
}

</code></pre>

<pre class="type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=SecurityTokenException.class) public void testGetTokenException() throws Exception {
  GadgetsHandlerApi.TokenRequest request=createTokenRequest(FakeProcessor.SPEC_URL,CONTAINER,createAuthContext(OWNER,VIEWER),ImmutableList.of("*"));
  replay();
  tokenCodec.exc=new SecurityTokenException("bad data");
  gadgetHandler.getToken(request);
}

</code></pre>

<pre class="type-9 type-5 type-6 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetMetadata() throws Exception {
  GadgetsHandlerApi.MetadataRequest request=createMetadataRequest(FakeProcessor.SPEC_URL,CONTAINER,"default",createAuthContext(null,null),ImmutableList.of("*"));
  setupMockGadgetAdminStore(true);
  setupMockRegistry(ImmutableList.<String>of("auth-refresh"));
  GadgetsHandlerApi.MetadataResponse response=gadgetHandler.getMetadata(request);
  assertEquals(FakeIframeUriManager.IFRAME_URIS_STRINGS,response.getIframeUrls());
  assertTrue(response.getNeedsTokenRefresh());
  assertEquals(1,response.getViews().size());
  assertEquals(FakeProcessor.SPEC_TITLE,response.getModulePrefs().getTitle());
  assertEquals(FakeProcessor.LINK_HREF,response.getModulePrefs().getLinks().get(FakeProcessor.LINK_REL).getHref().toString());
  assertEquals(FakeProcessor.LINK_REL,response.getModulePrefs().getLinks().get(FakeProcessor.LINK_REL).getRel());
  assertEquals(1,response.getUserPrefs().size());
  assertEquals("up_one",response.getUserPrefs().get("up_one").getDisplayName());
  assertEquals(4,response.getUserPrefs().get("up_one").getOrderedEnumValues().size());
  assertEquals(CURRENT_TIME_MS,response.getResponseTimeMs());
  assertEquals(METADATA_EXPIRY_TIME_MS,response.getExpireTimeMs());
  assertEquals(Sets.newHashSet(RPC_SERVICE_1,RPC_SERVICE_2,RPC_SERVICE_3),response.getRpcServiceIds());
  verify();
}

</code></pre>

<pre class="type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=ProcessingException.class) public void testGetJsDataWithException() throws Exception {
  List<String> fields=ImmutableList.of("jscontent");
  List<String> features=ImmutableList.of("unknown");
  Uri resUri=Uri.parse("http://server.com/gadgets/js/foo");
  Capture<JsUri> uriCapture=new Capture<JsUri>();
  expect(jsUriManager.makeExternJsUri(capture(uriCapture))).andReturn(resUri);
  expect(jsPipeline.execute(EasyMock.isA(JsRequest.class))).andThrow(new JsException(404,"error"));
  GadgetsHandlerApi.JsRequest request=createJsRequest(FakeProcessor.SPEC_URL.toString(),CONTAINER,fields,features,null);
  expect(request.getOnload()).andStubReturn("do this");
  expect(request.getContext()).andStubReturn(GadgetsHandlerApi.RenderingContext.CONTAINER);
  replay();
  gadgetHandler.getJs(request);
}

</code></pre>

<pre class="type-9 type-5 type-6 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetMetadataWithParams() throws Exception {
  GadgetsHandlerApi.MetadataRequest request=createMetadataRequest(FakeProcessor.SPEC_URL4,CONTAINER,"default",createAuthContext(null,null),ImmutableList.of("*"));
  setupMockGadgetAdminStore(true);
  setupMockRegistry(Lists.newArrayList("auth-refresh"));
  GadgetsHandlerApi.MetadataResponse response=gadgetHandler.getMetadata(request);
  Map<String,Feature> features=response.getModulePrefs().getFeatures();
  assertTrue(features.containsKey(FakeProcessor.FEATURE1) && features.containsKey(FakeProcessor.FEATURE2) && features.containsKey(FakeProcessor.FEATURE3)&& features.size() == 3);
  Multimap<String,String> params1=features.get(FakeProcessor.FEATURE2).getParams();
  assertEquals(ImmutableList.of(FakeProcessor.PARAM_VALUE,FakeProcessor.PARAM_VALUE2),params1.get(FakeProcessor.PARAM_NAME));
  Multimap<String,String> params2=features.get(FakeProcessor.FEATURE3).getParams();
  assertEquals(ImmutableList.of(FakeProcessor.PARAM_VALUE3),params2.get(FakeProcessor.PARAM_NAME2));
  verify();
}

</code></pre>

<pre class="type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=ProcessingException.class) public void testGetMetadataBadGadget() throws Exception {
  GadgetsHandlerApi.MetadataRequest request=createMetadataRequest(Uri.parse("unknown"),CONTAINER,null,createAuthContext(null,null),null);
  replay();
  gadgetHandler.getMetadata(request);
}

</code></pre>

<pre class="type-9 type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetJsData() throws Exception {
  List<String> fields=ImmutableList.of("jscontent");
  List<String> features=ImmutableList.of("rpc");
  Uri resUri=Uri.parse("http://server.com/gadgets/js/rpc");
  Capture<JsUri> uriCapture=new Capture<JsUri>();
  String jsContent="var a;";
  String onload="do this";
  String repository="v01";
  expect(jsUriManager.makeExternJsUri(capture(uriCapture))).andReturn(resUri);
  expect(jsPipeline.execute(EasyMock.isA(JsRequest.class))).andReturn(new JsResponseBuilder().appendJs(jsContent,"js").setProxyCacheable(true).build());
  GadgetsHandlerApi.JsRequest request=createJsRequest(FakeProcessor.SPEC_URL.toString(),CONTAINER,fields,features,repository);
  expect(request.getOnload()).andStubReturn(onload);
  expect(request.getContext()).andStubReturn(GadgetsHandlerApi.RenderingContext.CONTAINER);
  replay();
  GadgetsHandlerApi.JsResponse response=gadgetHandler.getJs(request);
  JsUri expectedUri=new JsUri(null,false,false,CONTAINER,FakeProcessor.SPEC_URL.toString(),features,null,onload,false,false,RenderingContext.CONTAINER,null,repository);
  assertEquals(expectedUri,uriCapture.getValue());
  assertNull(response.getJsUrl());
  assertEquals(jsContent,response.getJsContent());
  assertEquals(timeSource.currentTimeMillis() + HttpUtil.getDefaultTtl() * 1000,response.getExpireTimeMs().longValue());
  verify();
}

</code></pre>

<pre class="type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testValidateProxyResponse() throws Exception {
  GadgetsHandlerApi.ProxyResponse response=gadgetHandler.createProxyResponse(RESOURCE,null,ImmutableSet.<String>of("*"),1000001L);
  BeanDelegator.validateDelegator(response);
  assertEquals(RESOURCE,response.getProxyUrl());
  assertNull(response.getProxyContent());
}

</code></pre>

<pre class="type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=ProcessingException.class) public void testGetProxyDataFail() throws Exception {
  List<String> fields=ImmutableList.of("proxycontent.*");
  Uri resUri=Uri.parse("server.com/gadgets/proxy?url=" + RESOURCE);
  GadgetsHandlerApi.ProxyRequest request=createProxyRequest(RESOURCE,CONTAINER,fields);
  Capture<List<ProxyUri>> uriCapture=new Capture<List<ProxyUri>>();
  expect(proxyUriManager.make(capture(uriCapture),EasyMock.anyInt())).andReturn(ImmutableList.of(resUri));
  new HttpResponse("response");
  expect(proxyHandler.fetch(EasyMock.isA(ProxyUri.class))).andThrow(new GadgetException(Code.FAILED_TO_RETRIEVE_CONTENT));
  replay();
  gadgetHandler.getProxy(request);
}

</code></pre>

<pre class="type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=ProcessingException.class) public void testGetTokenNoFields() throws Exception {
  GadgetsHandlerApi.TokenRequest request=createTokenRequest(FakeProcessor.SPEC_URL,CONTAINER,createAuthContext(OWNER,VIEWER),null);
  replay();
  gadgetHandler.getToken(request);
}

</code></pre>

<pre class="type-9 type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetProxyData() throws Exception {
  List<String> fields=ImmutableList.of("proxycontent.*");
  Uri resUri=Uri.parse("server.com/gadgets/proxy?url=" + RESOURCE);
  GadgetsHandlerApi.ProxyRequest request=createProxyRequest(RESOURCE,CONTAINER,fields);
  Capture<List<ProxyUri>> uriCapture=new Capture<List<ProxyUri>>();
  expect(proxyUriManager.make(capture(uriCapture),EasyMock.anyInt())).andReturn(ImmutableList.of(resUri));
  HttpResponseBuilder builder=new HttpResponseBuilder();
  builder.setExpirationTime(20000).setContent("response");
  HttpResponse httpResponse=builder.create();
  expect(proxyHandler.fetch(EasyMock.isA(ProxyUri.class))).andReturn(httpResponse);
  replay();
  GadgetsHandlerApi.ProxyResponse response=gadgetHandler.getProxy(request);
  assertEquals(1,uriCapture.getValue().size());
  ProxyUri pUri=uriCapture.getValue().get(0);
  assertEquals(CONTAINER,pUri.getContainer());
  assertNull(response.getProxyUrl());
  assertEquals("response",new String(Base64.decodeBase64(response.getProxyContent().getContentBase64())));
  assertEquals(20000L,response.getExpireTimeMs().longValue());
  verify();
}

</code></pre>

<pre class="type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCreateProxyResponse() throws Exception {
  HttpResponseBuilder httpResponse=new HttpResponseBuilder();
  httpResponse.setContent("Content");
  httpResponse.addHeader("header","hval");
  httpResponse.setEncoding(Charset.forName("UTF8"));
  httpResponse.setHttpStatusCode(404);
  GadgetsHandlerApi.ProxyResponse response=gadgetHandler.createProxyResponse(RESOURCE,httpResponse.create(),ImmutableSet.<String>of("*"),1000001L);
  BeanDelegator.validateDelegator(response);
  assertEquals("Content",new String(Base64.decodeBase64(response.getProxyContent().getContentBase64())));
  assertEquals(404,response.getProxyContent().getCode());
  assertEquals(2,response.getProxyContent().getHeaders().size());
  assertEquals("Date",response.getProxyContent().getHeaders().get(0).getName());
  assertEquals("header",response.getProxyContent().getHeaders().get(1).getName());
  assertEquals("hval",response.getProxyContent().getHeaders().get(1).getValue());
  assertEquals(1000001L,response.getExpireTimeMs().longValue());
}

</code></pre>

<pre class="type-9 type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetMetadataOnlyView() throws Exception {
  GadgetsHandlerApi.MetadataRequest request=createMetadataRequest(FakeProcessor.SPEC_URL,CONTAINER,null,createAuthContext(null,null),ImmutableList.of("views.*"));
  setupMockGadgetAdminStore(false);
  setupMockRegistry(new ArrayList<String>());
  GadgetsHandlerApi.MetadataResponse response=gadgetHandler.getMetadata(request);
  assertNull(response.getIframeUrls());
  assertNull(response.getUserPrefs());
  assertNull(response.getModulePrefs());
  assertNull(response.getUrl());
  assertEquals(1,response.getViews().size());
  verify();
}

</code></pre>

<pre class="type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=ProcessingException.class) public void testGetMetadataNoView() throws Exception {
  GadgetsHandlerApi.MetadataRequest request=createMetadataRequest(FakeProcessor.SPEC_URL3,CONTAINER,"invalid_view",createAuthContext(null,null),ImmutableList.of("*"));
  replay();
  gadgetHandler.getMetadata(request);
}

</code></pre>

<pre class="type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=ProcessingException.class) public void testGetProxyNoResource() throws Exception {
  List<String> fields=ImmutableList.of("*");
  GadgetsHandlerApi.ProxyRequest request=createProxyRequest(null,CONTAINER,fields);
  gadgetHandler.getProxy(request);
}

</code></pre>

<pre class="type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void testCreateJsResponse() throws Exception {
  Uri jsUri=Uri.parse("http://www.shindig.com/js");
  String content="content";
  GadgetsHandlerApi.JsResponse jsResponse=gadgetHandler.createJsResponse(null,jsUri,content,ImmutableSet.of("*"),null);
  BeanDelegator.validateDelegator(jsResponse);
}

</code></pre>

<pre class="type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=ProcessingException.class) public void testGetTokenNoUrl() throws Exception {
  GadgetsHandlerApi.TokenRequest request=createTokenRequest(null,CONTAINER,createAuthContext(OWNER,VIEWER),ImmutableList.of("*"));
  replay();
  gadgetHandler.getToken(request);
}

</code></pre>

<pre class="type-3 type-2 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=ProcessingException.class) public void testFeatureAdminDeniedGadget() throws Exception {
  GadgetsHandlerApi.MetadataRequest request=createMetadataRequest(FakeProcessor.SPEC_URL4,CONTAINER,"default",createAuthContext(null,null),ImmutableList.of("*"));
  setupMockGadgetAdminStore(false);
  setupMockRegistry(Lists.newArrayList("example-feature","example-feature2"));
  gadgetHandlerWithAdmin.getMetadata(request);
}

</code></pre>

<pre class="type-9 type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testGetJsUri() throws Exception {
  List<String> fields=ImmutableList.of("jsurl");
  List<String> features=ImmutableList.of("rpc");
  Uri resUri=Uri.parse("server.com/gadgets/js/rpc");
  GadgetsHandlerApi.JsRequest request=createJsRequest(null,CONTAINER,fields,features,null);
  Capture<JsUri> uriCapture=new Capture<JsUri>();
  expect(jsUriManager.makeExternJsUri(capture(uriCapture))).andReturn(resUri);
  replay();
  GadgetsHandlerApi.JsResponse response=gadgetHandler.getJs(request);
  JsUri expectedUri=new JsUri(null,false,false,CONTAINER,null,features,null,null,false,false,RenderingContext.GADGET,null,null);
  assertEquals(expectedUri,uriCapture.getValue());
  assertEquals(resUri,response.getJsUrl());
  assertNull(response.getJsContent());
  assertEquals(timeSource.currentTimeMillis() + HttpUtil.getDefaultTtl() * 1000,response.getExpireTimeMs().longValue());
  verify();
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
