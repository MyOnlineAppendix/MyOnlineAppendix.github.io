<h3 style="margin:0px">Class: org.apache.shindig.gadgets.oauth.OAuthRequestTest (90 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(81)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(68)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(56)</kbd></button>&nbsp;<button id="8"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('8')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-8"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(33)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(23)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(17)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(8)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >ExceptionVerifier&nbsp;(6)</kbd></button>&nbsp;<button id="12"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('12')" data-toggle="tooltip" title="Verifies whether two objects/variables are the same"><kbd id="tag-12"class="label-info"style="display: inline-block;font-size:7pt" >IdentityVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="16"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('16')" data-toggle="tooltip" title="Is an empty test case"><kbd id="tag-16"class="label-info"style="display: inline-block;font-size:7pt" >EmptyTester&nbsp;(1)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Allocates resources before the execution of the test cases"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >TestInitializer&nbsp;(1)</kbd></button>&nbsp;<button id="15"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('15')" data-toggle="tooltip" title="Releases resources used by the test cases"><kbd id="tag-15"class="label-info"style="display: inline-block;font-size:7pt" >TestCleaner&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-5 type-6 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPostWithQueryWithData() throws Exception {
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  HttpResponse resp=client.sendFormPost(FakeOAuthServiceProvider.RESOURCE_URL + "?queryName=queryValue","name=value");
  List<Parameter> queryParams=OAuth.decodeForm(resp.getResponseAsString());
  assertTrue(contains(queryParams,"queryName","queryValue"));
  assertEquals("name=value",resp.getHeader(FakeOAuthServiceProvider.BODY_ECHO_HEADER));
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test different behaviors of trusted parameters.
 * 1) pass two parameters with same name, the latter will win.
 * 2) parameter name starting with 'oauth' 'oauth' or 'opensocial'.
 * 3) trusted parameter can override existing parameter.
 */
@Test public void testTrustedParamsMisc() throws Exception {
  serviceProvider.setCheckTrustedParams(true);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  client.setTrustedParam("oauth_magic","foo");
  client.setTrustedParam("opensocial_magic","bar");
  client.setTrustedParam("xoauth_magic","quux_overridden");
  client.setTrustedParam("xoauth_magic","quux");
  client.setTrustedParam("opensocial_owner_id","overridden_opensocial_owner_id");
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  assertEquals(12,serviceProvider.getTrustedParamCount());
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAccessTokenData_noOAuthParams() throws Exception {
  serviceProvider.setReturnAccessTokenData(true);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.ACCESS_TOKEN_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.ACCESS_TOKEN_URL);
  JSONObject json=new JSONObject(response.getResponseAsString());
  assertEquals("userid value",json.get("userid"));
  assertEquals("xoauth_stuff value",json.get("xoauth_stuff"));
  assertEquals(2,json.length());
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
}

</code></pre>

<pre class="type-9 type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testUnknownConsumerKey() throws Exception {
  SecurityToken securityToken=getSecurityToken("owner","owner",GADGET_URL_NO_KEY);
  MakeRequestClient client=new MakeRequestClient(securityToken,fetcherConfig,serviceProvider,FakeGadgetSpecFactory.SERVICE_NAME_NO_KEY);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  Map<String,String> metadata=response.getMetadata();
  assertNotNull(metadata);
  assertEquals("consumer_key_unknown",metadata.get("oauthError"));
  String errorText=response.getMetadata().get("oauthErrorText");
  checkStringContains("oauthErrorText mismatch",errorText,"Service provider rejected request");
  checkStringContains("oauthErrorText mismatch",errorText,"oauth_problem_advice=\"invalid%20consumer%3A%20garbage_key\"");
  checkStringContains("should return original request",errorText,"GET /data\n");
  checkStringContains("should return request token request",errorText,"GET /request?param=foo&");
}

</code></pre>

<pre class="type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testNextFetchThrowsRuntimeException() throws Exception {
  serviceProvider.setThrow(new RuntimeException("very, very wrong"));
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  try {
    client.sendGet(FakeOAuthServiceProvider.ACCESS_TOKEN_URL);
    fail("Should have thrown");
  }
 catch (  RuntimeException e) {
  }
  checkLogContains("GET /request?param=foo&opensocial_owner_id=owner");
  checkLogContains("OAuth error [very, very wrong] for " + "application http://www.example.com/gadget.xml");
  checkLogContains("RuntimeException");
  checkLogContains("very, very wrong");
}

</code></pre>

<pre class="type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testSignedFetch_unnamedConsumerKey() throws Exception {
  BasicOAuthStoreConsumerKeyAndSecret defaultKey=new BasicOAuthStoreConsumerKeyAndSecret(null,FakeOAuthServiceProvider.PRIVATE_KEY_TEXT,KeyType.RSA_PRIVATE,"foo",null);
  base.setDefaultKey(defaultKey);
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  HttpResponse resp=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  List<Parameter> queryParams=OAuth.decodeForm(resp.getResponseAsString());
  assertTrue(contains(queryParams,"opensocial_owner_id","o"));
  assertTrue(contains(queryParams,"opensocial_viewer_id","v"));
  assertTrue(contains(queryParams,"opensocial_app_id","app"));
  assertTrue(contains(queryParams,OAuth.OAUTH_CONSUMER_KEY,"container.com"));
  assertTrue(contains(queryParams,"xoauth_signature_publickey","foo"));
  assertTrue(contains(queryParams,"xoauth_public_key","foo"));
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testBadSessionHandle() throws Exception {
  serviceProvider.setSessionExtension(true);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(1,serviceProvider.getAccessTokenCount());
  assertEquals(1,serviceProvider.getResourceAccessCount());
  clock.incrementSeconds(FakeOAuthServiceProvider.TOKEN_EXPIRATION_SECONDS + 1);
  serviceProvider.changeAllSessionHandles();
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cb=1");
  assertEquals("",response.getResponseAsString());
  assertEquals(2,serviceProvider.getRequestTokenCount());
  assertEquals(2,serviceProvider.getAccessTokenCount());
  assertEquals(1,serviceProvider.getResourceAccessCount());
  client.approveToken("user_data=renewed");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cb=1");
  assertEquals(2,serviceProvider.getRequestTokenCount());
  assertEquals(3,serviceProvider.getAccessTokenCount());
  assertEquals(2,serviceProvider.getResourceAccessCount());
  assertEquals("User data is renewed",response.getResponseAsString());
  checkLogContains("oauth_session_handle=REMOVED");
}

</code></pre>

<pre class="type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetWithRawBody() throws Exception {
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  HttpResponse resp=client.sendGetWithBody(FakeOAuthServiceProvider.RESOURCE_URL,"application/json","war=peace&yes=no".getBytes());
  assertEquals("war=peace&yes=no",resp.getHeader(FakeOAuthServiceProvider.BODY_ECHO_HEADER));
  List<Parameter> queryParams=OAuth.decodeForm(resp.getResponseAsString());
  checkContains(queryParams,"oauth_body_hash","MfhwxPN6ns5CwQAZN9OcJXu3Jv4=");
}

</code></pre>

<pre class="type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testStripOAuthParamsFromQuery() throws Exception {
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  HttpResponse resp=client.sendFormPost(FakeOAuthServiceProvider.RESOURCE_URL + "?oauth_foo=bar","name=value");
  assertEquals(OAuthError.INVALID_PARAMETER.name(),resp.getMetadata().get(OAuthResponseParams.ERROR_CODE));
  checkStringContains("Wrong error text",resp.getMetadata().get("oauthErrorText"),"Invalid parameter name oauth_foo");
}

</code></pre>

<pre class="type-7 type-3 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(expected=RuntimeException.class) public void testGetTamperedFormContent() throws Exception {
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  client.setNextFetcher(new HttpFetcher(){
    public HttpResponse fetch(    HttpRequest request) throws GadgetException {
      request.setPostBody("foo=quux".getBytes());
      return serviceProvider.fetch(request);
    }
  }
);
  client.sendGetWithBody(FakeOAuthServiceProvider.RESOURCE_URL,OAuth.FORM_ENCODED,"foo=bar".getBytes());
  fail("Should have thrown with oauth signature mismatch");
}

</code></pre>

<pre class="type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testSignedFetchParametersSetProxiedContent() throws Exception {
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  client.getBaseArgs().setProxiedContentRequest(true);
  HttpResponse resp=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  List<Parameter> queryParams=OAuth.decodeForm(resp.getResponseAsString());
  assertTrue(contains(queryParams,"opensocial_owner_id","o"));
  assertTrue(contains(queryParams,"opensocial_viewer_id","v"));
  assertTrue(contains(queryParams,"opensocial_app_id","app"));
  assertTrue(contains(queryParams,OAuth.OAUTH_CONSUMER_KEY,"signedfetch"));
  assertTrue(contains(queryParams,"xoauth_signature_publickey","foo"));
  assertTrue(contains(queryParams,"xoauth_public_key","foo"));
  assertTrue(contains(queryParams,"opensocial_proxied_content","1"));
}

</code></pre>

<pre class="type-7 type-3 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(expected=RuntimeException.class) public void testPostTamperedFormContent() throws Exception {
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  client.setNextFetcher(new HttpFetcher(){
    public HttpResponse fetch(    HttpRequest request) throws GadgetException {
      request.setPostBody("foo=quux".getBytes());
      return serviceProvider.fetch(request);
    }
  }
);
  client.sendFormPost(FakeOAuthServiceProvider.RESOURCE_URL,"foo=bar");
  fail("Should have thrown with oauth signature mismatch");
}

</code></pre>

<pre class="type-5 type-6 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPostNoQueryNoData() throws Exception {
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  HttpResponse resp=client.sendFormPost(FakeOAuthServiceProvider.RESOURCE_URL,null);
  List<Parameter> queryParams=OAuth.decodeForm(resp.getResponseAsString());
  assertTrue(contains(queryParams,"opensocial_owner_id","o"));
  assertEquals("",resp.getHeader(FakeOAuthServiceProvider.BODY_ECHO_HEADER));
}

</code></pre>

<pre class="type-9 type-5 type-12 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testParamsInBody() throws Exception {
  serviceProvider.setParamLocation(OAuthParamLocation.POST_BODY);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL_BODY);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendFormPost(FakeOAuthServiceProvider.RESOURCE_URL,"");
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  String echoedBody=response.getHeader(FakeOAuthServiceProvider.BODY_ECHO_HEADER);
  assertNotNull(echoedBody);
  Assert.assertNotSame("body: " + echoedBody,echoedBody.indexOf("oauth_consumer_key="),-1);
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testPreapprovedToken_invalid() throws Exception {
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  client.getBaseArgs().setRequestToken("garbage");
  client.getBaseArgs().setRequestTokenSecret("garbage");
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(1,serviceProvider.getAccessTokenCount());
  assertEquals(0,serviceProvider.getResourceAccessCount());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(2,serviceProvider.getAccessTokenCount());
  assertEquals(1,serviceProvider.getResourceAccessCount());
}

</code></pre>

<pre class="type-9 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testPostWeirdContentType() throws Exception {
  byte[] raw={0,1,2,3,4,5};
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  HttpResponse resp=client.sendRawPost(FakeOAuthServiceProvider.RESOURCE_URL,"funky-content",raw);
  List<Parameter> queryParams=OAuth.decodeForm(resp.getResponseAsString());
  assertTrue(contains(queryParams,"opensocial_owner_id","o"));
  assertTrue(contains(queryParams,OAuth.OAUTH_CONSUMER_KEY,"signedfetch"));
  String echoed=resp.getHeader(FakeOAuthServiceProvider.RAW_BODY_ECHO_HEADER);
  byte[] echoedBytes=Base64.decodeBase64(CharsetUtil.getUtf8Bytes(echoed));
  assertTrue(Arrays.equals(raw,echoedBytes));
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testError400() throws Exception {
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cachebust=1");
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  response=client.sendGet(FakeOAuthServiceProvider.ERROR_400);
  assertEquals("bad request",response.getResponseAsString());
  assertEquals(400,response.getHttpStatusCode());
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cachebust=3");
  assertEquals("User data is hello-oauth",response.getResponseAsString());
}

</code></pre>

<pre class="type-7 type-3 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(expected=RuntimeException.class) public void testPostTamperedRemoveRawContent() throws Exception {
  byte[] raw={0,1,2,3,4,5};
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  client.setNextFetcher(new HttpFetcher(){
    public HttpResponse fetch(    HttpRequest request) throws GadgetException {
      request.setPostBody(ArrayUtils.EMPTY_BYTE_ARRAY);
      request.setHeader("Content-Type","application/x-www-form-urlencoded");
      return serviceProvider.fetch(request);
    }
  }
);
  client.sendRawPost(FakeOAuthServiceProvider.RESOURCE_URL,"funky-content",raw);
  fail("Should have thrown with body hash in form encoded request");
}

</code></pre>

<pre class="type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testSignedFetchParametersSet() throws Exception {
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  HttpResponse resp=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  List<Parameter> queryParams=OAuth.decodeForm(resp.getResponseAsString());
  assertTrue(contains(queryParams,"opensocial_owner_id","o"));
  assertTrue(contains(queryParams,"opensocial_viewer_id","v"));
  assertTrue(contains(queryParams,"opensocial_app_id","app"));
  assertTrue(contains(queryParams,OAuth.OAUTH_CONSUMER_KEY,"signedfetch"));
  assertTrue(contains(queryParams,"xoauth_signature_publickey","foo"));
  assertTrue(contains(queryParams,"xoauth_public_key","foo"));
  assertFalse(contains(queryParams,"opensocial_proxied_content","1"));
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testOAuthFlow_noSpec() throws Exception {
  fetcherConfig=new OAuthFetcherConfig(new BasicBlobCrypter("abcdefghijklmnop".getBytes()),getOAuthStore(base,null),clock,callbackGenerator,false);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  setNoSpecOptions(client);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  checkEmptyLog();
}

</code></pre>

<pre class="type-9 type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOAuthFlow_noSpecInvalidUrl() throws Exception {
  fetcherConfig=new OAuthFetcherConfig(new BasicBlobCrypter("abcdefghijklmnop".getBytes()),getOAuthStore(base,null),clock,null,false);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  setNoSpecOptions(client);
  client.getBaseArgs().setRequestOption(OAuthArguments.REQUEST_TOKEN_URL_PARAM,"foo");
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  assertEquals(403,response.getHttpStatusCode());
  assertEquals(OAuthError.INVALID_URL.name(),response.getMetadata().get("oauthError"));
  String errorText=response.getMetadata().get("oauthErrorText");
  assertNotNull(errorText);
  checkStringContains("should report invalid url",errorText,"Invalid URL: foo");
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAccessTokenExpires_onServer() throws Exception {
  serviceProvider.setSessionExtension(true);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(1,serviceProvider.getAccessTokenCount());
  assertEquals(1,serviceProvider.getResourceAccessCount());
  client=makeNonSocialClient("owner","owner",GADGET_URL);
  clock.incrementSeconds(FakeOAuthServiceProvider.TOKEN_EXPIRATION_SECONDS + 1);
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cb=1");
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(2,serviceProvider.getAccessTokenCount());
  assertEquals(2,serviceProvider.getResourceAccessCount());
}

</code></pre>

<pre class="type-9 type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOAuthFlow_noSpecNoAccessTokenUrl() throws Exception {
  fetcherConfig=new OAuthFetcherConfig(new BasicBlobCrypter("abcdefghijklmnop".getBytes()),getOAuthStore(base,null),clock,callbackGenerator,false);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  setNoSpecOptions(client);
  client.getBaseArgs().removeRequestOption(OAuthArguments.ACCESS_TOKEN_URL_PARAM);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  assertEquals(403,response.getHttpStatusCode());
  assertEquals(OAuthError.BAD_OAUTH_TOKEN_URL.name(),response.getMetadata().get("oauthError"));
  String errorText=response.getMetadata().get("oauthErrorText");
  assertNotNull(errorText);
  checkStringContains("should report no access token url",errorText,"No access token URL specified");
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testOAuthFlow_noSpecAuthHeader() throws Exception {
  serviceProvider.setParamLocation(OAuthParamLocation.AUTH_HEADER);
  fetcherConfig=new OAuthFetcherConfig(new BasicBlobCrypter("abcdefghijklmnop".getBytes()),getOAuthStore(base,null),clock,callbackGenerator,false);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  setNoSpecOptions(client);
  client.getBaseArgs().setRequestOption(OAuthArguments.PARAM_LOCATION_PARAM,"auth-header");
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  checkEmptyLog();
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testExtraParamsRejected() throws Exception {
  serviceProvider.setRejectExtraParams(true);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("parameter_rejected",response.getMetadata().get("oauthError"));
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testOAuthFlow_tokenReused() throws Exception {
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  MakeRequestClient client2=makeNonSocialClient("owner","owner",GADGET_URL);
  response=client2.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
}

</code></pre>

<pre class="type-9 type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testParamsInBody_forGetRequestStrictSp() throws Exception {
  serviceProvider.setParamLocation(OAuthParamLocation.POST_BODY);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL_BODY);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  assertEquals(HttpResponse.SC_FORBIDDEN,response.getHttpStatusCode());
  assertEquals("parameter_absent",response.getMetadata().get("oauthError"));
  assertNull(response.getMetadata().get("oauthApprovalUrl"));
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test invalid trusted parameters which are not prefixed with 'oauth' 'xoauth' or 'opensocial'.
 */
@Test public void testTrustedParamsInvalidParameter() throws Exception {
  serviceProvider.setCheckTrustedParams(true);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  client.setTrustedParam("oauth_magic","foo");
  client.setTrustedParam("opensocial_magic","bar");
  client.setTrustedParam("xoauth_magic","quux");
  client.setTrustedParam("opensocial_owner_id","overridden_opensocial_owner_id");
  client.setTrustedParam("invalid_trusted_parameter","invalid");
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals(HttpResponse.SC_FORBIDDEN,response.getHttpStatusCode());
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testPreapprovedToken_notUsedIfAccessTokenExists() throws Exception {
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  TokenPair reqToken=serviceProvider.getPreapprovedToken("preapproved");
  client.getBaseArgs().setRequestToken(reqToken.token);
  client.getBaseArgs().setRequestTokenSecret(reqToken.secret);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is preapproved",response.getResponseAsString());
  assertEquals(0,serviceProvider.getRequestTokenCount());
  assertEquals(1,serviceProvider.getAccessTokenCount());
  assertEquals(1,serviceProvider.getResourceAccessCount());
  MakeRequestClient client2=makeNonSocialClient("owner","owner",GADGET_URL);
  response=client2.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cachebust=1");
  assertEquals("User data is preapproved",response.getResponseAsString());
  assertEquals(0,serviceProvider.getRequestTokenCount());
  assertEquals(1,serviceProvider.getAccessTokenCount());
  assertEquals(2,serviceProvider.getResourceAccessCount());
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testCanRetrieveAccessTokenData() throws Exception {
  serviceProvider.setReturnAccessTokenData(true);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.ACCESS_TOKEN_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.ACCESS_TOKEN_URL);
  assertEquals("application/json; charset=UTF-8",response.getHeader("Content-Type"));
  JSONObject json=new JSONObject(response.getResponseAsString());
  assertEquals("userid value",json.get("userid"));
  assertEquals("xoauth_stuff value",json.get("xoauth_stuff"));
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
}

</code></pre>

<pre class="type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testValidParameterCharacters() throws Exception {
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  String weird="~!@$*()-_[]:,./";
  HttpResponse resp=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + '?' + weird+ "=foo");
  List<Parameter> queryParams=OAuth.decodeForm(resp.getResponseAsString());
  assertTrue(contains(queryParams,weird,"foo"));
}

</code></pre>

<pre class="type-7 type-3 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(expected=RuntimeException.class) public void testGetTamperedRemoveRawContent() throws Exception {
  byte[] raw={0,1,2,3,4,5};
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  client.setNextFetcher(new HttpFetcher(){
    public HttpResponse fetch(    HttpRequest request) throws GadgetException {
      request.setPostBody(ArrayUtils.EMPTY_BYTE_ARRAY);
      request.setHeader("Content-Type","application/x-www-form-urlencoded");
      return serviceProvider.fetch(request);
    }
  }
);
  client.sendGetWithBody(FakeOAuthServiceProvider.RESOURCE_URL,"funky-content",raw);
  fail("Should have thrown with body hash in form encoded request");
}

</code></pre>

<pre class="type-5 type-6 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPostWithQueryNoData() throws Exception {
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  HttpResponse resp=client.sendFormPost(FakeOAuthServiceProvider.RESOURCE_URL + "?name=value",null);
  List<Parameter> queryParams=OAuth.decodeForm(resp.getResponseAsString());
  assertTrue(contains(queryParams,"name","value"));
  assertEquals("",resp.getHeader(FakeOAuthServiceProvider.BODY_ECHO_HEADER));
}

</code></pre>

<pre class="type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testGetWithFormEncodedBody() throws Exception {
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  HttpResponse resp=client.sendGetWithBody(FakeOAuthServiceProvider.RESOURCE_URL,OAuth.FORM_ENCODED,"war=peace&yes=no".getBytes());
  assertEquals("war=peace&yes=no",resp.getHeader(FakeOAuthServiceProvider.BODY_ECHO_HEADER));
}

</code></pre>

<pre class="type-9 type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOAuthFlow_badCallbackVerifier() throws Exception {
  fetcherConfig=new OAuthFetcherConfig(new BasicBlobCrypter("abcdefghijklmnop".getBytes()),getOAuthStore(base),clock,createRealCallbackGenerator(),false);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  client.setReceivedCallbackUrl("nonsense");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  assertNotNull(response.getMetadata().get("oauthErrorText"));
  client.approveToken("user_data=try-again");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is try-again",response.getResponseAsString());
}

</code></pre>

<pre class="type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignedFetch_error403() throws Exception {
  assertEquals(0,base.getAccessTokenRemoveCount());
  serviceProvider.setConsumersThrottled(true);
  serviceProvider.setVagueErrors(true);
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertNull(response.getMetadata().get("oauthError"));
  String errorText=response.getMetadata().get("oauthErrorText");
  checkStringContains("Should return sent request",errorText,"GET /data");
  checkStringContains("Should return response",errorText,"HTTP/1.1 403");
  checkStringContains("Should return response",errorText,"some vague error");
  assertEquals(0,base.getAccessTokenRemoveCount());
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test trusted parameters will always be sent when signOwner and signViewer
 * are false.
 */
@Test public void testAlwaysAppendTrustedParams() throws Exception {
  serviceProvider.setCheckTrustedParams(true);
  MakeRequestClient client=makeStrictNonSocialClient("owner","owner",GADGET_URL);
  client.setTrustedParam("oauth_magic","foo");
  client.setTrustedParam("opensocial_magic","bar");
  client.setTrustedParam("xoauth_magic","quux");
  client.setTrustedParam("opensocial_owner_id","overridden_opensocial_owner_id");
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  assertEquals(12,serviceProvider.getTrustedParamCount());
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAccessTokenExpired_andRevoked() throws Exception {
  serviceProvider.setSessionExtension(true);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(1,serviceProvider.getAccessTokenCount());
  assertEquals(1,serviceProvider.getResourceAccessCount());
  clock.incrementSeconds(FakeOAuthServiceProvider.TOKEN_EXPIRATION_SECONDS + 1);
  serviceProvider.revokeAllAccessTokens();
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cb=1");
  assertEquals("",response.getResponseAsString());
  assertEquals(2,serviceProvider.getRequestTokenCount());
  assertEquals(2,serviceProvider.getAccessTokenCount());
  assertEquals(1,serviceProvider.getResourceAccessCount());
  client.approveToken("user_data=renewed");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cb=1");
  assertEquals(2,serviceProvider.getRequestTokenCount());
  assertEquals(3,serviceProvider.getAccessTokenCount());
  assertEquals(2,serviceProvider.getResourceAccessCount());
  assertEquals("User data is renewed",response.getResponseAsString());
  checkLogContains("oauth_token_secret=REMOVED");
}

</code></pre>

<pre class="type-9 type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOAuthFlow_noSpecNoApprovalUrl() throws Exception {
  fetcherConfig=new OAuthFetcherConfig(new BasicBlobCrypter("abcdefghijklmnop".getBytes()),getOAuthStore(base,null),clock,callbackGenerator,false);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  setNoSpecOptions(client);
  client.getBaseArgs().removeRequestOption(OAuthArguments.AUTHORIZATION_URL_PARAM);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  assertEquals(403,response.getHttpStatusCode());
  assertEquals(OAuthError.BAD_OAUTH_TOKEN_URL.name(),response.getMetadata().get("oauthError"));
  String errorText=response.getMetadata().get("oauthErrorText");
  assertNotNull(errorText);
  checkStringContains("should report no authorization url",errorText,"No authorization URL specified");
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testOAuthFlow() throws Exception {
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  checkEmptyLog();
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAccessTokenExpires_onClientNoPredictedExpiration() throws Exception {
  serviceProvider.setSessionExtension(true);
  serviceProvider.setReportExpirationTimes(false);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(1,serviceProvider.getAccessTokenCount());
  assertEquals(1,serviceProvider.getResourceAccessCount());
  clock.incrementSeconds(FakeOAuthServiceProvider.TOKEN_EXPIRATION_SECONDS + 1);
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cb=1");
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(2,serviceProvider.getAccessTokenCount());
  assertEquals(3,serviceProvider.getResourceAccessCount());
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cb=3");
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(2,serviceProvider.getAccessTokenCount());
  assertEquals(4,serviceProvider.getResourceAccessCount());
  clock.incrementSeconds(FakeOAuthServiceProvider.TOKEN_EXPIRATION_SECONDS + 1);
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cb=4");
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(3,serviceProvider.getAccessTokenCount());
  assertEquals(6,serviceProvider.getResourceAccessCount());
}

</code></pre>

<pre class="type-15 type-16 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Releases resources used by the test cases">TestCleaner</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is an empty test case">EmptyTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Releases resources used by the test cases
- Is an empty test case
"></span><br>
@After public void tearDown() throws Exception {
}

</code></pre>

<pre class="type-9 type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testError401() throws Exception {
  serviceProvider.setVagueErrors(true);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cachebust=1");
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  serviceProvider.revokeAllAccessTokens();
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cachebust=2");
  checkLogContains("GET /data?cachebust=2");
  checkLogContains("HTTP/1.1 401");
  assertEquals("",response.getResponseAsString());
  assertNotNull(response.getMetadata().get("oauthApprovalUrl"));
  client.approveToken("user_data=reapproved");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cachebust=3");
  assertEquals("User data is reapproved",response.getResponseAsString());
}

</code></pre>

<pre class="type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testStripOAuthParamsFromBody() throws Exception {
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  HttpResponse resp=client.sendFormPost(FakeOAuthServiceProvider.RESOURCE_URL,"oauth_foo=bar");
  assertEquals(OAuthError.INVALID_PARAMETER.name(),resp.getMetadata().get(OAuthResponseParams.ERROR_CODE));
  checkStringContains("Wrong error text",resp.getMetadata().get("oauthErrorText"),"Invalid parameter name oauth_foo");
}

</code></pre>

<pre class="type-9 type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testError403() throws Exception {
  serviceProvider.setVagueErrors(true);
  SecurityToken securityToken=getSecurityToken("owner","owner",GADGET_URL_NO_KEY);
  MakeRequestClient client=new MakeRequestClient(securityToken,fetcherConfig,serviceProvider,FakeGadgetSpecFactory.SERVICE_NAME_NO_KEY);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  Map<String,String> metadata=response.getMetadata();
  assertNotNull(metadata);
  assertEquals("MISSING_OAUTH_PARAMETER",metadata.get("oauthError"));
  checkStringContains("oauthErrorText mismatch",metadata.get("oauthErrorText"),"some vague error");
  checkStringContains("oauthErrorText mismatch",metadata.get("oauthErrorText"),"HTTP/1.1 403");
  checkLogContains("HTTP/1.1 403");
  checkLogContains("GET /request");
  checkLogContains("some vague error");
}

</code></pre>

<pre class="type-9 type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testPostBinaryData() throws Exception {
  byte[] raw={0,1,2,3,4,5};
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  HttpResponse resp=client.sendRawPost(FakeOAuthServiceProvider.RESOURCE_URL,null,raw);
  List<Parameter> queryParams=OAuth.decodeForm(resp.getResponseAsString());
  assertTrue(contains(queryParams,"opensocial_owner_id","o"));
  assertTrue(contains(queryParams,OAuth.OAUTH_CONSUMER_KEY,"signedfetch"));
  String echoed=resp.getHeader(FakeOAuthServiceProvider.RAW_BODY_ECHO_HEADER);
  byte[] echoedBytes=Base64.decodeBase64(CharsetUtil.getUtf8Bytes(echoed));
  assertTrue(Arrays.equals(raw,echoedBytes));
}

</code></pre>

<pre class="type-7 type-3 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(expected=RuntimeException.class) public void testPostTamperedRawContent() throws Exception {
  byte[] raw={0,1,2,3,4,5};
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  client.setNextFetcher(new HttpFetcher(){
    public HttpResponse fetch(    HttpRequest request) throws GadgetException {
      request.setPostBody("yo momma".getBytes());
      return serviceProvider.fetch(request);
    }
  }
);
  client.sendRawPost(FakeOAuthServiceProvider.RESOURCE_URL,"funky-content",raw);
  fail("Should have thrown with oauth_body_hash mismatch");
}

</code></pre>

<pre class="type-9 type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testRevokedAccessToken() throws Exception {
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cachebust=1");
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  serviceProvider.revokeAllAccessTokens();
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cachebust=2");
  assertEquals("",response.getResponseAsString());
  assertNotNull(response.getMetadata().get("oauthApprovalUrl"));
  assertNull("Should not return oauthError for revoked token",response.getMetadata().get("oauthError"));
  String errorText=response.getMetadata().get("oauthErrorText");
  assertNotNull(errorText);
  checkStringContains("should return original request",errorText,"GET /data?cachebust=2\n");
  checkStringContains("should return signed request",errorText,"GET /data?cachebust=2&");
  checkStringContains("should remove secret",errorText,"oauth_token_secret=REMOVED");
  checkStringContains("should return response",errorText,"HTTP/1.1 401");
  checkStringContains("should return response",errorText,"oauth_problem=\"token_revoked\"");
  client.approveToken("user_data=reapproved");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cachebust=3");
  assertEquals("User data is reapproved",response.getResponseAsString());
}

</code></pre>

<pre class="type-4 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Allocates resources before the execution of the test cases">TestInitializer</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Allocates resources before the execution of the test cases
"></span><br>
@Before public void setUp() throws Exception {
  base=new BasicOAuthStore();
  base.setDefaultCallbackUrl(GadgetTokenStoreTest.DEFAULT_CALLBACK);
  serviceProvider=new FakeOAuthServiceProvider(clock);
  callbackGenerator=createNullCallbackGenerator();
  fetcherConfig=new OAuthFetcherConfig(new BasicBlobCrypter("abcdefghijklmnop".getBytes()),getOAuthStore(base),clock,callbackGenerator,false);
  logger=Logger.getLogger(OAuthResponseParams.class.getName());
  logger.addHandler(new Handler(){
    @Override public void close() throws SecurityException {
    }
    @Override public void flush(){
    }
    @Override public void publish(    LogRecord arg0){
      logRecords.add(arg0);
    }
  }
);
  logger.setLevel(Level.FINE);
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testOAuthFlow_withCallbackVerifier() throws Exception {
  fetcherConfig=new OAuthFetcherConfig(new BasicBlobCrypter("abcdefghijklmnop".getBytes()),getOAuthStore(base),clock,createRealCallbackGenerator(),false);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  checkEmptyLog();
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testNextFetchReturnsNull() throws Exception {
  serviceProvider.setReturnNull(true);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.ACCESS_TOKEN_URL);
  assertEquals("MISSING_SERVER_RESPONSE",response.getMetadata().get("oauthError"));
  assertEquals("",response.getResponseAsString());
  String oauthErrorText=response.getMetadata().get("oauthErrorText");
  checkStringContains("should say no response",oauthErrorText,"No response from server");
  checkStringContains("should show request",oauthErrorText,"GET /request?param=foo&opensocial_owner_id=owner");
  checkStringContains("should log empty response",oauthErrorText,"Received response 1:\n\n");
  checkLogContains("No response from server");
  checkLogContains("GET /request?param=foo&opensocial_owner_id=owner");
  checkLogContains("OAuth error [MISSING_SERVER_RESPONSE, No response from server] for " + "application http://www.example.com/gadget.xml");
}

</code></pre>

<pre class="type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testSignedFetch_error401() throws Exception {
  assertEquals(0,base.getAccessTokenRemoveCount());
  serviceProvider.setConsumerUnauthorized(true);
  serviceProvider.setVagueErrors(true);
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertNull(response.getMetadata().get("oauthError"));
  String errorText=response.getMetadata().get("oauthErrorText");
  checkStringContains("Should return sent request",errorText,"GET /data");
  checkStringContains("Should return response",errorText,"HTTP/1.1 401");
  checkStringContains("Should return response",errorText,"some vague error");
  assertEquals(0,base.getAccessTokenRemoveCount());
}

</code></pre>

<pre class="type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testSignedFetch_extraQueryParameters() throws Exception {
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  HttpResponse resp=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?foo=bar&foo=baz");
  List<Parameter> queryParams=OAuth.decodeForm(resp.getResponseAsString());
  assertTrue(contains(queryParams,"opensocial_owner_id","o"));
  assertTrue(contains(queryParams,"opensocial_viewer_id","v"));
  assertTrue(contains(queryParams,"opensocial_app_id","app"));
  assertTrue(contains(queryParams,OAuth.OAUTH_CONSUMER_KEY,"signedfetch"));
  assertTrue(contains(queryParams,"xoauth_signature_publickey","foo"));
  assertTrue(contains(queryParams,"xoauth_public_key","foo"));
}

</code></pre>

<pre class="type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testTrickyParametersInBody() throws Exception {
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  String tricky="%6fpensocial_owner_id=gotcha";
  HttpResponse resp=client.sendFormPost(FakeOAuthServiceProvider.RESOURCE_URL,tricky);
  assertEquals(OAuthError.INVALID_PARAMETER.name(),resp.getMetadata().get(OAuthResponseParams.ERROR_CODE));
  checkStringContains("Wrong error text",resp.getMetadata().get("oauthErrorText"),"Invalid parameter name opensocial_owner_id, applications may not override " + "oauth, xoauth, or opensocial parameters");
}

</code></pre>

<pre class="type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testGetNoQuery() throws Exception {
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  HttpResponse resp=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  List<Parameter> queryParams=OAuth.decodeForm(resp.getResponseAsString());
  assertTrue(contains(queryParams,"opensocial_owner_id","o"));
  assertTrue(contains(queryParams,"opensocial_viewer_id","v"));
}

</code></pre>

<pre class="type-9 type-5 type-12 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testParamsInHeader() throws Exception {
  serviceProvider.setParamLocation(OAuthParamLocation.AUTH_HEADER);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL_HEADER);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  String aznHeader=response.getHeader(FakeOAuthServiceProvider.AUTHZ_ECHO_HEADER);
  assertNotNull(aznHeader);
  Assert.assertNotSame("azn header: " + aznHeader,aznHeader.indexOf("OAuth"),-1);
}

</code></pre>

<pre class="type-5 type-10 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
"></span><br>
@Test public void testSignedFetch_authHeader() throws Exception {
  serviceProvider.setParamLocation(OAuthParamLocation.AUTH_HEADER);
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  client.getBaseArgs().setRequestOption(OAuthArguments.PROGRAMMATIC_CONFIG_PARAM,"true");
  client.getBaseArgs().setRequestOption(OAuthArguments.PARAM_LOCATION_PARAM,"auth-header");
  HttpResponse resp=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  String auth=resp.getHeader(FakeOAuthServiceProvider.AUTHZ_ECHO_HEADER);
  assertNotNull("Should have echoed authz header",auth);
  checkStringContains("should have opensocial params in header",auth,"opensocial_owner_id=\"o\"");
}

</code></pre>

<pre class="type-9 type-7 type-5 type-1 type-3 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies that exceptions are thrown during the test case execution
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test(expected=RuntimeException.class) public void testAccessTokenData_noDirectRequest() throws Exception {
  serviceProvider.setReturnAccessTokenData(true);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.ACCESS_TOKEN_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  client.sendGet(FakeOAuthServiceProvider.ACCESS_TOKEN_URL);
  fail("Service provider should have rejected bogus request to access token URL");
}

</code></pre>

<pre class="type-5 type-6 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testPostNoQueryWithData() throws Exception {
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  HttpResponse resp=client.sendFormPost(FakeOAuthServiceProvider.RESOURCE_URL,"name=value");
  List<Parameter> queryParams=OAuth.decodeForm(resp.getResponseAsString());
  assertFalse(contains(queryParams,"name","value"));
  assertEquals("name=value",resp.getHeader(FakeOAuthServiceProvider.BODY_ECHO_HEADER));
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testOAuthFlow_noSpecPostBodyAndHeader() throws Exception {
  serviceProvider.setParamLocation(OAuthParamLocation.POST_BODY);
  serviceProvider.addParamLocation(OAuthParamLocation.AUTH_HEADER);
  fetcherConfig=new OAuthFetcherConfig(new BasicBlobCrypter("abcdefghijklmnop".getBytes()),getOAuthStore(base,null),clock,callbackGenerator,false);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  setNoSpecOptions(client);
  client.getBaseArgs().setRequestOption(OAuthArguments.REQUEST_METHOD_PARAM,"POST");
  client.getBaseArgs().setRequestOption(OAuthArguments.PARAM_LOCATION_PARAM,"post-body");
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  checkEmptyLog();
}

</code></pre>

<pre class="type-9 type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testConsumerThrottled() throws Exception {
  assertEquals(0,serviceProvider.getRequestTokenCount());
  assertEquals(0,serviceProvider.getAccessTokenCount());
  assertEquals(0,serviceProvider.getResourceAccessCount());
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(0,serviceProvider.getAccessTokenCount());
  assertEquals(0,serviceProvider.getResourceAccessCount());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(1,serviceProvider.getAccessTokenCount());
  assertEquals(1,serviceProvider.getResourceAccessCount());
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cachebust=1");
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(1,serviceProvider.getAccessTokenCount());
  assertEquals(2,serviceProvider.getResourceAccessCount());
  serviceProvider.setConsumersThrottled(true);
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cachebust=2");
  assertEquals("",response.getResponseAsString());
  Map<String,String> metadata=response.getMetadata();
  assertNotNull(metadata);
  assertEquals("consumer_key_refused",metadata.get("oauthError"));
  checkStringContains("oauthErrorText mismatch",metadata.get("oauthErrorText"),"Service provider rejected request");
  checkStringContains("oauthErrorText missing request entry",metadata.get("oauthErrorText"),"GET /data?cachebust=2\n");
  checkStringContains("oauthErrorText missing request entry",metadata.get("oauthErrorText"),"GET /data?cachebust=2&oauth_body_hash=2jm");
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(1,serviceProvider.getAccessTokenCount());
  assertEquals(3,serviceProvider.getResourceAccessCount());
  serviceProvider.setConsumersThrottled(false);
  client.clearState();
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cachebust=3");
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(1,serviceProvider.getAccessTokenCount());
  assertEquals(4,serviceProvider.getResourceAccessCount());
}

</code></pre>

<pre class="type-9 type-5 type-12 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testParamsInBody_withExtraParams() throws Exception {
  serviceProvider.setParamLocation(OAuthParamLocation.POST_BODY);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL_BODY);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendFormPost(FakeOAuthServiceProvider.RESOURCE_URL,"foo=bar&foo=baz");
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  String echoedBody=response.getHeader(FakeOAuthServiceProvider.BODY_ECHO_HEADER);
  assertNotNull(echoedBody);
  Assert.assertNotSame("body: " + echoedBody,echoedBody.indexOf("oauth_consumer_key="),-1);
  Assert.assertNotSame("body: " + echoedBody,echoedBody.indexOf("foo=bar&foo=baz"),-1);
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAccessTokenOkForSecureOwnerPage() throws Exception {
  fetcherConfig=new OAuthFetcherConfig(new BasicBlobCrypter("abcdefghijklmnop".getBytes()),getOAuthStore(base),clock,callbackGenerator,true);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  MakeRequestClient friend=makeNonSocialClient("owner","friend",GADGET_URL);
  response=friend.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  assertEquals(200,response.getHttpStatusCode());
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testOAuthFlow_noSpecPostBody() throws Exception {
  serviceProvider.setParamLocation(OAuthParamLocation.POST_BODY);
  fetcherConfig=new OAuthFetcherConfig(new BasicBlobCrypter("abcdefghijklmnop".getBytes()),getOAuthStore(base,null),clock,callbackGenerator,false);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  setNoSpecOptions(client);
  client.getBaseArgs().setRequestOption(OAuthArguments.REQUEST_METHOD_PARAM,"POST");
  client.getBaseArgs().setRequestOption(OAuthArguments.PARAM_LOCATION_PARAM,"post-body");
  HttpResponse response=client.sendFormPost(FakeOAuthServiceProvider.RESOURCE_URL,"");
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendFormPost(FakeOAuthServiceProvider.RESOURCE_URL,"");
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  checkEmptyLog();
}

</code></pre>

<pre class="type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testGetWithQuery() throws Exception {
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  HttpResponse resp=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?a=b");
  List<Parameter> queryParams=OAuth.decodeForm(resp.getResponseAsString());
  assertTrue(contains(queryParams,"a","b"));
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testTrustedParams() throws Exception {
  serviceProvider.setCheckTrustedParams(true);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  client.setTrustedParam("oauth_magic","foo");
  client.setTrustedParam("opensocial_magic","bar");
  client.setTrustedParam("xoauth_magic","quux");
  client.setTrustedParam("opensocial_owner_id","overridden_opensocial_owner_id");
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  assertEquals(12,serviceProvider.getTrustedParamCount());
}

</code></pre>

<pre class="type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testGetWithQueryMultiParam() throws Exception {
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  HttpResponse resp=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?a=b&a=c");
  List<Parameter> queryParams=OAuth.decodeForm(resp.getResponseAsString());
  assertTrue(contains(queryParams,"a","b"));
  assertTrue(contains(queryParams,"a","c"));
}

</code></pre>

<pre class="type-9 type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testConsumerThrottled_vagueErrors() throws Exception {
  serviceProvider.setVagueErrors(true);
  assertEquals(0,serviceProvider.getRequestTokenCount());
  assertEquals(0,serviceProvider.getAccessTokenCount());
  assertEquals(0,serviceProvider.getResourceAccessCount());
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(0,serviceProvider.getAccessTokenCount());
  assertEquals(0,serviceProvider.getResourceAccessCount());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(1,serviceProvider.getAccessTokenCount());
  assertEquals(1,serviceProvider.getResourceAccessCount());
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cachebust=1");
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(1,serviceProvider.getAccessTokenCount());
  assertEquals(2,serviceProvider.getResourceAccessCount());
  serviceProvider.setConsumersThrottled(true);
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cachebust=2");
  assertEquals(403,response.getHttpStatusCode());
  assertEquals("some vague error",response.getResponseAsString());
  Map<String,String> metadata=response.getMetadata();
  assertNotNull(metadata);
  assertNull(metadata.get("oauthError"));
  checkStringContains("oauthErrorText missing request entry",metadata.get("oauthErrorText"),"GET /data?cachebust=2\n");
  checkStringContains("oauthErrorText missing request entry",metadata.get("oauthErrorText"),"GET /data?cachebust=2&oauth_body_hash=2jm");
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(1,serviceProvider.getAccessTokenCount());
  assertEquals(3,serviceProvider.getResourceAccessCount());
  serviceProvider.setConsumersThrottled(false);
  client.clearState();
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cachebust=3");
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(1,serviceProvider.getAccessTokenCount());
  assertEquals(4,serviceProvider.getResourceAccessCount());
}

</code></pre>

<pre class="type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testStripOpenSocialParamsFromQuery() throws Exception {
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  HttpResponse resp=client.sendFormPost(FakeOAuthServiceProvider.RESOURCE_URL + "?opensocial_foo=bar",null);
  assertEquals(OAuthError.INVALID_PARAMETER.name(),resp.getMetadata().get(OAuthResponseParams.ERROR_CODE));
  checkStringContains("Wrong error text",resp.getMetadata().get("oauthErrorText"),"Invalid parameter name opensocial_foo");
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testPreapprovedToken() throws Exception {
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  TokenPair reqToken=serviceProvider.getPreapprovedToken("preapproved");
  client.getBaseArgs().setRequestToken(reqToken.token);
  client.getBaseArgs().setRequestTokenSecret(reqToken.secret);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is preapproved",response.getResponseAsString());
  assertEquals(0,serviceProvider.getRequestTokenCount());
  assertEquals(1,serviceProvider.getAccessTokenCount());
  assertEquals(1,serviceProvider.getResourceAccessCount());
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cachebust=1");
  assertEquals("User data is preapproved",response.getResponseAsString());
  assertEquals(0,serviceProvider.getRequestTokenCount());
  assertEquals(1,serviceProvider.getAccessTokenCount());
  assertEquals(2,serviceProvider.getResourceAccessCount());
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cachebust=2");
  assertEquals("User data is preapproved",response.getResponseAsString());
  assertEquals(0,serviceProvider.getRequestTokenCount());
  assertEquals(1,serviceProvider.getAccessTokenCount());
  assertEquals(3,serviceProvider.getResourceAccessCount());
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testOAuthFlow_noViewer() throws Exception {
  for (  boolean secureOwner : Arrays.asList(true,false)) {
    fetcherConfig=new OAuthFetcherConfig(new BasicBlobCrypter("abcdefghijklmnop".getBytes()),getOAuthStore(base),clock,callbackGenerator,secureOwner);
    MakeRequestClient client=makeNonSocialClient("owner",null,GADGET_URL);
    HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
    assertEquals("",response.getResponseAsString());
    assertEquals(403,response.getHttpStatusCode());
    assertEquals(-1,response.getCacheTtl());
    assertEquals(OAuthError.UNAUTHENTICATED.name(),response.getMetadata().get("oauthError"));
  }
}

</code></pre>

<pre class="type-9 type-5 type-12 type-1 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testExtraApprovalParams() throws Exception {
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL_APPROVAL_PARAMS);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  String approvalUrl=response.getMetadata().get("oauthApprovalUrl");
  Assert.assertSame(approvalUrl,0,approvalUrl.indexOf("http://www.example.com/authorize?oauth_callback=foo&oauth_token="));
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  checkEmptyLog();
}

</code></pre>

<pre class="type-9 type-5 type-12 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether two objects/variables are the same">IdentityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether two objects/variables are the same
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testParamsInBody_forGetRequest() throws Exception {
  serviceProvider.setParamLocation(OAuthParamLocation.POST_BODY);
  serviceProvider.addParamLocation(OAuthParamLocation.AUTH_HEADER);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL_BODY);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  String aznHeader=response.getHeader(FakeOAuthServiceProvider.AUTHZ_ECHO_HEADER);
  assertNotNull(aznHeader);
  Assert.assertNotSame("azn header: " + aznHeader,aznHeader.indexOf("OAuth"),-1);
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testError404() throws Exception {
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cachebust=1");
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  response=client.sendGet(FakeOAuthServiceProvider.NOT_FOUND_URL);
  assertEquals("not found",response.getResponseAsString());
  assertEquals(404,response.getHttpStatusCode());
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cachebust=3");
  assertEquals("User data is hello-oauth",response.getResponseAsString());
}

</code></pre>

<pre class="type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testNoSignViewer() throws Exception {
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  client.getBaseArgs().setSignViewer(false);
  HttpResponse resp=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  List<Parameter> queryParams=OAuth.decodeForm(resp.getResponseAsString());
  assertTrue(contains(queryParams,"opensocial_owner_id","o"));
  assertFalse(contains(queryParams,"opensocial_viewer_id","v"));
}

</code></pre>

<pre class="type-9 type-5 type-6 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testWrongServiceName() throws Exception {
  SecurityToken securityToken=getSecurityToken("owner","owner",GADGET_URL);
  MakeRequestClient client=new MakeRequestClient(securityToken,fetcherConfig,serviceProvider,"nosuchservice");
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  Map<String,String> metadata=response.getMetadata();
  assertNull(metadata.get("oauthApprovalUrl"));
  assertEquals("BAD_OAUTH_CONFIGURATION",metadata.get("oauthError"));
  String errorText=metadata.get("oauthErrorText");
  assertTrue(errorText,errorText.startsWith("Failed to retrieve OAuth URLs, spec for gadget does " + "not contain OAuth service nosuchservice.  Known services: testservice"));
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testNextFetchThrowsGadgetException() throws Exception {
  serviceProvider.setThrow(new GadgetException(GadgetException.Code.FAILED_TO_RETRIEVE_CONTENT,"mildly wrong"));
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.ACCESS_TOKEN_URL);
  assertEquals("MISSING_SERVER_RESPONSE",response.getMetadata().get("oauthError"));
  assertEquals("",response.getResponseAsString());
  String oauthErrorText=response.getMetadata().get("oauthErrorText");
  checkStringContains("should say no response",oauthErrorText,"No response from server");
  checkStringContains("should show request",oauthErrorText,"GET /request?param=foo&opensocial_owner_id=owner");
  checkStringContains("should log empty response",oauthErrorText,"Received response 1:\n\n");
  checkLogContains("No response from server");
  checkLogContains("GET /request?param=foo&opensocial_owner_id=owner");
  checkLogContains("OAuth error [MISSING_SERVER_RESPONSE, No response from server] for " + "application http://www.example.com/gadget.xml");
  checkLogContains("GadgetException");
  checkLogContains("mildly wrong");
}

</code></pre>

<pre class="type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
"></span><br>
@Test public void testGetTamperedRawContent() throws Exception {
  byte[] raw={0,1,2,3,4,5};
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  client.setNextFetcher(new HttpFetcher(){
    public HttpResponse fetch(    HttpRequest request) throws GadgetException {
      request.setPostBody("yo momma".getBytes());
      return serviceProvider.fetch(request);
    }
  }
);
  try {
    client.sendGetWithBody(FakeOAuthServiceProvider.RESOURCE_URL,"funky-content",raw);
    fail("Should have thrown with oauth_body_hash mismatch");
  }
 catch (  RuntimeException e) {
  }
}

</code></pre>

<pre class="type-9 type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBrokenRequestTokenResponse() throws Exception {
  SecurityToken securityToken=getSecurityToken("owner","owner",GADGET_URL_BAD_OAUTH_URL);
  MakeRequestClient client=new MakeRequestClient(securityToken,fetcherConfig,serviceProvider,FakeGadgetSpecFactory.SERVICE_NAME);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals(403,response.getHttpStatusCode());
  assertEquals("",response.getResponseAsString());
  Map<String,String> metadata=response.getMetadata();
  assertNotNull(metadata);
  assertEquals("MISSING_OAUTH_PARAMETER",metadata.get("oauthError"));
  String errorText=response.getMetadata().get("oauthErrorText");
  checkStringContains("oauthErrorText mismatch",errorText,"No oauth_token returned from service provider");
  checkStringContains("oauthErrorText mismatch",errorText,"GET /echo?mary_had_a_little_lamb");
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testOAuthFlow_unauthUser() throws Exception {
  MakeRequestClient client=makeNonSocialClient(null,null,GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  assertEquals(403,response.getHttpStatusCode());
  assertEquals(-1,response.getCacheTtl());
  assertEquals(OAuthError.UNAUTHENTICATED.name(),response.getMetadata().get("oauthError"));
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testExtraParamsSuppressed() throws Exception {
  serviceProvider.setRejectExtraParams(true);
  MakeRequestClient client=makeStrictNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
}

</code></pre>

<pre class="type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testStripOpenSocialParamsFromBody() throws Exception {
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  HttpResponse resp=client.sendFormPost(FakeOAuthServiceProvider.RESOURCE_URL,"opensocial_foo=bar");
  assertEquals(OAuthError.INVALID_PARAMETER.name(),resp.getMetadata().get(OAuthResponseParams.ERROR_CODE));
  checkStringContains("Wrong error text",resp.getMetadata().get("oauthErrorText"),"Invalid parameter name opensocial_foo");
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAccessTokenNotUsedForSocialPage() throws Exception {
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  MakeRequestClient friend=makeNonSocialClient("owner","friend",GADGET_URL);
  response=friend.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  assertEquals(403,response.getHttpStatusCode());
  assertEquals(OAuthError.NOT_OWNER.name(),response.getMetadata().get("oauthError"));
}

</code></pre>

<pre class="type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testTrickyParametersInQuery() throws Exception {
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  String tricky="%6fpensocial_owner_id=gotcha";
  HttpResponse resp=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + '?' + tricky);
  assertEquals(OAuthError.INVALID_PARAMETER.name(),resp.getMetadata().get(OAuthResponseParams.ERROR_CODE));
  checkStringContains("Wrong error text",resp.getMetadata().get("oauthErrorText"),"Invalid parameter name opensocial_owner_id, applications may not override " + "oauth, xoauth, or opensocial parameters");
}

</code></pre>

<pre class="type-9 type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testBrokenAccessTokenResponse() throws Exception {
  SecurityToken securityToken=getSecurityToken("owner","owner",GADGET_URL_BAD_OAUTH_URL);
  MakeRequestClient client=new MakeRequestClient(securityToken,fetcherConfig,serviceProvider,FakeGadgetSpecFactory.SERVICE_NAME);
  client.getBaseArgs().setRequestToken("reqtoken");
  client.getBaseArgs().setRequestTokenSecret("reqtokensecret");
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals(403,response.getHttpStatusCode());
  assertEquals("",response.getResponseAsString());
  Map<String,String> metadata=response.getMetadata();
  assertNotNull(metadata);
  assertEquals("MISSING_OAUTH_PARAMETER",metadata.get("oauthError"));
  String errorText=response.getMetadata().get("oauthErrorText");
  checkStringContains("oauthErrorText mismatch",errorText,"No oauth_token_secret returned from service provider");
  checkStringContains("oauthErrorText mismatch",errorText,"with_fleece_as_white_as_snow");
}

</code></pre>

<pre class="type-5 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void testNoSignOwner() throws Exception {
  MakeRequestClient client=makeSignedFetchClient("o","v","http://www.example.com/app");
  client.getBaseArgs().setSignOwner(false);
  HttpResponse resp=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  List<Parameter> queryParams=OAuth.decodeForm(resp.getResponseAsString());
  assertFalse(contains(queryParams,"opensocial_owner_id","o"));
  assertTrue(contains(queryParams,"opensocial_viewer_id","v"));
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testAccessTokenExpires_onClient() throws Exception {
  serviceProvider.setSessionExtension(true);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(1,serviceProvider.getAccessTokenCount());
  assertEquals(1,serviceProvider.getResourceAccessCount());
  clock.incrementSeconds(FakeOAuthServiceProvider.TOKEN_EXPIRATION_SECONDS + 1);
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cb=1");
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(2,serviceProvider.getAccessTokenCount());
  assertEquals(2,serviceProvider.getResourceAccessCount());
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cb=3");
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(2,serviceProvider.getAccessTokenCount());
  assertEquals(3,serviceProvider.getResourceAccessCount());
  clock.incrementSeconds(FakeOAuthServiceProvider.TOKEN_EXPIRATION_SECONDS + 1);
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cb=4");
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  assertEquals(1,serviceProvider.getRequestTokenCount());
  assertEquals(3,serviceProvider.getAccessTokenCount());
  assertEquals(4,serviceProvider.getResourceAccessCount());
  checkEmptyLog();
}

</code></pre>

<pre class="type-9 type-5 type-1 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void testSocialOAuth_tokenRevoked() throws Exception {
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  client.approveToken("user_data=hello-oauth");
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("User data is hello-oauth",response.getResponseAsString());
  serviceProvider.revokeAllAccessTokens();
  assertEquals(0,base.getAccessTokenRemoveCount());
  client=makeSocialOAuthClient("owner","owner",GADGET_URL);
  response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL + "?cb=1");
  assertEquals("",response.getResponseAsString());
  assertEquals(1,base.getAccessTokenRemoveCount());
}

</code></pre>

<pre class="type-9 type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOAuthFlow_noSpecNoRequestTokenUrl() throws Exception {
  fetcherConfig=new OAuthFetcherConfig(new BasicBlobCrypter("abcdefghijklmnop".getBytes()),getOAuthStore(base,null),clock,null,false);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  setNoSpecOptions(client);
  client.getBaseArgs().removeRequestOption(OAuthArguments.REQUEST_TOKEN_URL_PARAM);
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  assertEquals(403,response.getHttpStatusCode());
  assertEquals(OAuthError.BAD_OAUTH_TOKEN_URL.name(),response.getMetadata().get("oauthError"));
  String errorText=response.getMetadata().get("oauthErrorText");
  assertNotNull(errorText);
  checkStringContains("should report no request token url",errorText,"No request token URL specified");
}

</code></pre>

<pre class="type-9 type-5 type-1 type-10 type-8 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies whether objects are null
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void testOAuthFlow_noSpecBlankUrl() throws Exception {
  fetcherConfig=new OAuthFetcherConfig(new BasicBlobCrypter("abcdefghijklmnop".getBytes()),getOAuthStore(base,null),clock,null,false);
  MakeRequestClient client=makeNonSocialClient("owner","owner",GADGET_URL);
  setNoSpecOptions(client);
  client.getBaseArgs().setRequestOption(OAuthArguments.REQUEST_TOKEN_URL_PARAM,"");
  HttpResponse response=client.sendGet(FakeOAuthServiceProvider.RESOURCE_URL);
  assertEquals("",response.getResponseAsString());
  assertEquals(403,response.getHttpStatusCode());
  assertEquals(OAuthError.INVALID_URL.name(),response.getMetadata().get("oauthError"));
  String errorText=response.getMetadata().get("oauthErrorText");
  assertNotNull(errorText);
  checkStringContains("should report invalid url",errorText,"Invalid URL: ");
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
