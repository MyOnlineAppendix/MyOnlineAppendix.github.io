<h3 style="margin:0px">Class: org.apache.poi.poifs.filesystem.TestNPOIFSFileSystem (14 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(13)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(13)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(8)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="12"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('12')" data-toggle="tooltip" title="Verifies assertions in iterations"><kbd id="tag-12"class="label-info"style="display: inline-block;font-size:7pt" >IterativeVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="13"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('13')" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements"><kbd id="tag-13"class="label-info"style="display: inline-block;font-size:7pt" >ConditionMatcher&nbsp;(2)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-2 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Tests that we can get the correct contents for
 * a document in the filesystem 
 */
@Test public void getDocumentEntry() throws Exception {
  for (  NPOIFSFileSystem fs : get512and4kFileAndInput()) {
    DirectoryEntry root=fs.getRoot();
    Entry si=root.getEntry("\u0005SummaryInformation");
    assertEquals(true,si.isDocumentEntry());
    DocumentNode doc=(DocumentNode)si;
    assertContentsMatches(null,doc);
    DocumentInputStream inp=new NDocumentInputStream(doc);
    PropertySet ps=PropertySetFactory.create(inp);
    SummaryInformation inf=(SummaryInformation)ps;
    assertEquals(null,inf.getApplicationName());
    assertEquals(null,inf.getAuthor());
    assertEquals(null,inf.getSubject());
    assertEquals(131333,inf.getOSVersion());
    inp.close();
    si=root.getEntry("\u0005DocumentSummaryInformation");
    assertEquals(true,si.isDocumentEntry());
    doc=(DocumentNode)si;
    assertContentsMatches(null,doc);
    inp=new NDocumentInputStream(doc);
    ps=PropertySetFactory.create(inp);
    DocumentSummaryInformation dinf=(DocumentSummaryInformation)ps;
    assertEquals(131333,dinf.getOSVersion());
    fs.close();
  }
}

</code></pre>

<pre class="type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void basicOpen() throws Exception {
  NPOIFSFileSystem fsA, fsB;
  fsA=new NPOIFSFileSystem(_inst.getFile("BlockSize512.zvi"));
  fsB=new NPOIFSFileSystem(_inst.openResourceAsStream("BlockSize512.zvi"));
  for (  NPOIFSFileSystem fs : new NPOIFSFileSystem[]{fsA,fsB}) {
    assertEquals(512,fs.getBigBlockSize());
  }
  fsA.close();
  fsB.close();
  fsA=new NPOIFSFileSystem(_inst.getFile("BlockSize4096.zvi"));
  fsB=new NPOIFSFileSystem(_inst.openResourceAsStream("BlockSize4096.zvi"));
  for (  NPOIFSFileSystem fs : new NPOIFSFileSystem[]{fsA,fsB}) {
    assertEquals(4096,fs.getBigBlockSize());
  }
  fsA.close();
  fsB.close();
}

</code></pre>

<pre class="type-2 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void addBeforeWrite() throws Exception {
  NPOIFSFileSystem fs=new NPOIFSFileSystem();
  DocumentEntry miniDoc;
  DocumentEntry normDoc;
  HeaderBlock hdr;
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(0));
  assertEquals(POIFSConstants.FAT_SECTOR_BLOCK,fs.getNextBlock(1));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(2));
  hdr=writeOutAndReadHeader(fs);
  assertEquals(1,hdr.getBATCount());
  assertEquals(1,hdr.getBATArray()[0]);
  assertEquals(0,hdr.getPropertyStart());
  assertEquals(POIFSConstants.END_OF_CHAIN,hdr.getSBATStart());
  assertEquals(POIFSConstants.END_OF_CHAIN,hdr.getXBATIndex());
  assertEquals(POIFSConstants.SMALLER_BIG_BLOCK_SIZE * 3,fs.size());
  fs=new NPOIFSFileSystem();
  DirectoryEntry parentDir=fs.createDirectory("Parent Directory");
  DirectoryEntry testDir=parentDir.createDirectory("Test Directory");
  byte[] mini=new byte[]{42,0,1,2,3,4,42};
  testDir.createDocument("Mini",new ByteArrayInputStream(mini));
  byte[] main4096=new byte[4096];
  main4096[0]=-10;
  main4096[4095]=-11;
  testDir.createDocument("Normal4096",new ByteArrayInputStream(main4096));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(0));
  assertEquals(POIFSConstants.FAT_SECTOR_BLOCK,fs.getNextBlock(1));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(2));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(3));
  assertEquals(5,fs.getNextBlock(4));
  assertEquals(6,fs.getNextBlock(5));
  assertEquals(7,fs.getNextBlock(6));
  assertEquals(8,fs.getNextBlock(7));
  assertEquals(9,fs.getNextBlock(8));
  assertEquals(10,fs.getNextBlock(9));
  assertEquals(11,fs.getNextBlock(10));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(11));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(12));
  assertEquals(POIFSConstants.SMALLER_BIG_BLOCK_SIZE * 13,fs.size());
  miniDoc=(DocumentEntry)testDir.getEntry("Mini");
  assertContentsMatches(mini,miniDoc);
  normDoc=(DocumentEntry)testDir.getEntry("Normal4096");
  assertContentsMatches(main4096,normDoc);
  hdr=writeOutAndReadHeader(fs);
  fs=writeOutAndReadBack(fs);
  assertEquals(1,hdr.getBATCount());
  assertEquals(1,hdr.getBATArray()[0]);
  assertEquals(2,hdr.getSBATStart());
  assertEquals(0,hdr.getPropertyStart());
  assertEquals(POIFSConstants.END_OF_CHAIN,hdr.getXBATIndex());
  assertEquals(12,fs.getNextBlock(0));
  assertEquals(POIFSConstants.FAT_SECTOR_BLOCK,fs.getNextBlock(1));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(2));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(3));
  assertEquals(5,fs.getNextBlock(4));
  assertEquals(6,fs.getNextBlock(5));
  assertEquals(7,fs.getNextBlock(6));
  assertEquals(8,fs.getNextBlock(7));
  assertEquals(9,fs.getNextBlock(8));
  assertEquals(10,fs.getNextBlock(9));
  assertEquals(11,fs.getNextBlock(10));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(11));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(12));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(13));
  assertEquals(POIFSConstants.SMALLER_BIG_BLOCK_SIZE * 14,fs.size());
  DirectoryEntry fsRoot=fs.getRoot();
  assertEquals(1,fsRoot.getEntryCount());
  parentDir=(DirectoryEntry)fsRoot.getEntry("Parent Directory");
  assertEquals(1,parentDir.getEntryCount());
  testDir=(DirectoryEntry)parentDir.getEntry("Test Directory");
  assertEquals(2,testDir.getEntryCount());
  miniDoc=(DocumentEntry)testDir.getEntry("Mini");
  assertContentsMatches(mini,miniDoc);
  normDoc=(DocumentEntry)testDir.getEntry("Normal4096");
  assertContentsMatches(main4096,normDoc);
  byte[] mini2=new byte[]{-42,0,-1,-2,-3,-4,-42};
  testDir.createDocument("Mini2",new ByteArrayInputStream(mini2));
  byte[] main4106=new byte[4106];
  main4106[0]=41;
  main4106[4105]=42;
  testDir.createDocument("Normal4106",new ByteArrayInputStream(main4106));
  fs=writeOutAndReadBack(fs);
  fsRoot=fs.getRoot();
  assertEquals(1,fsRoot.getEntryCount());
  parentDir=(DirectoryEntry)fsRoot.getEntry("Parent Directory");
  assertEquals(1,parentDir.getEntryCount());
  testDir=(DirectoryEntry)parentDir.getEntry("Test Directory");
  assertEquals(4,testDir.getEntryCount());
  miniDoc=(DocumentEntry)testDir.getEntry("Mini");
  assertContentsMatches(mini,miniDoc);
  miniDoc=(DocumentEntry)testDir.getEntry("Mini2");
  assertContentsMatches(mini2,miniDoc);
  normDoc=(DocumentEntry)testDir.getEntry("Normal4106");
  assertContentsMatches(main4106,normDoc);
  fs.close();
}

</code></pre>

<pre class="type-12 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions in iterations
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Check that for a given block, we can correctly figure
 * out what the next one is
 */
@Test public void nextBlock() throws Exception {
  NPOIFSFileSystem fsA=new NPOIFSFileSystem(_inst.getFile("BlockSize512.zvi"));
  NPOIFSFileSystem fsB=new NPOIFSFileSystem(_inst.openResourceAsStream("BlockSize512.zvi"));
  for (  NPOIFSFileSystem fs : new NPOIFSFileSystem[]{fsA,fsB}) {
    for (int i=0; i < 21; i++) {
      assertEquals(i + 1,fs.getNextBlock(i));
    }
    assertEquals(89,fs.getNextBlock(21));
    assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(89));
    for (int i=22; i < 88; i++) {
      assertEquals(i + 1,fs.getNextBlock(i));
    }
    assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(88));
    for (int i=90; i < 96; i++) {
      assertEquals(i + 1,fs.getNextBlock(i));
    }
    assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(96));
    assertEquals(98,fs.getNextBlock(97));
    assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(98));
    assertEquals(POIFSConstants.FAT_SECTOR_BLOCK,fs.getNextBlock(99));
    for (int i=100; i < fs.getBigBlockSizeDetails().getBATEntriesPerBlock(); i++) {
      assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(i));
    }
    fs.close();
  }
  fsA=new NPOIFSFileSystem(_inst.getFile("BlockSize4096.zvi"));
  fsB=new NPOIFSFileSystem(_inst.openResourceAsStream("BlockSize4096.zvi"));
  for (  NPOIFSFileSystem fs : new NPOIFSFileSystem[]{fsA,fsB}) {
    assertEquals(1,fs.getNextBlock(0));
    assertEquals(2,fs.getNextBlock(1));
    assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(2));
    for (int i=4; i < 11; i++) {
      assertEquals(i + 1,fs.getNextBlock(i));
    }
    assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(11));
    fs.close();
  }
}

</code></pre>

<pre class="type-2 type-1 type-6 type-13 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Verifies logic rules using matcher-style statements
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Read a file, write it and read it again.
 * Then, alter+add some streams, write and read
 */
@Test public void readWriteRead() throws Exception {
  SummaryInformation sinf=null;
  DocumentSummaryInformation dinf=null;
  DirectoryEntry root=null, testDir=null;
  for (  NPOIFSFileSystem fs : get512and4kFileAndInput()) {
    root=fs.getRoot();
    assertEquals(5,root.getEntryCount());
    assertThat(root.getEntryNames(),hasItem("Thumbnail"));
    assertThat(root.getEntryNames(),hasItem("Image"));
    assertThat(root.getEntryNames(),hasItem("Tags"));
    assertThat(root.getEntryNames(),hasItem("\u0005DocumentSummaryInformation"));
    assertThat(root.getEntryNames(),hasItem("\u0005SummaryInformation"));
    fs=writeOutAndReadBack(fs);
    root=fs.getRoot();
    assertEquals(5,root.getEntryCount());
    assertThat(root.getEntryNames(),hasItem("Thumbnail"));
    assertThat(root.getEntryNames(),hasItem("Image"));
    assertThat(root.getEntryNames(),hasItem("Tags"));
    assertThat(root.getEntryNames(),hasItem("\u0005DocumentSummaryInformation"));
    assertThat(root.getEntryNames(),hasItem("\u0005SummaryInformation"));
    sinf=(SummaryInformation)PropertySetFactory.create(new NDocumentInputStream((DocumentEntry)root.getEntry(SummaryInformation.DEFAULT_STREAM_NAME)));
    assertEquals(131333,sinf.getOSVersion());
    dinf=(DocumentSummaryInformation)PropertySetFactory.create(new NDocumentInputStream((DocumentEntry)root.getEntry(DocumentSummaryInformation.DEFAULT_STREAM_NAME)));
    assertEquals(131333,dinf.getOSVersion());
    testDir=root.createDirectory("Testing 123");
    testDir.createDirectory("Testing 456");
    testDir.createDirectory("Testing 789");
    byte[] mini=new byte[]{42,0,1,2,3,4,42};
    testDir.createDocument("Mini",new ByteArrayInputStream(mini));
    fs=writeOutAndReadBack(fs);
    root=fs.getRoot();
    testDir=(DirectoryEntry)root.getEntry("Testing 123");
    assertEquals(6,root.getEntryCount());
    assertThat(root.getEntryNames(),hasItem("Thumbnail"));
    assertThat(root.getEntryNames(),hasItem("Image"));
    assertThat(root.getEntryNames(),hasItem("Tags"));
    assertThat(root.getEntryNames(),hasItem("Testing 123"));
    assertThat(root.getEntryNames(),hasItem("\u0005DocumentSummaryInformation"));
    assertThat(root.getEntryNames(),hasItem("\u0005SummaryInformation"));
    sinf=(SummaryInformation)PropertySetFactory.create(new NDocumentInputStream((DocumentEntry)root.getEntry(SummaryInformation.DEFAULT_STREAM_NAME)));
    assertEquals(131333,sinf.getOSVersion());
    dinf=(DocumentSummaryInformation)PropertySetFactory.create(new NDocumentInputStream((DocumentEntry)root.getEntry(DocumentSummaryInformation.DEFAULT_STREAM_NAME)));
    assertEquals(131333,dinf.getOSVersion());
    assertContentsMatches(mini,(DocumentEntry)testDir.getEntry("Mini"));
    fs=writeOutAndReadBack(fs);
    root=fs.getRoot();
    testDir=(DirectoryEntry)root.getEntry("Testing 123");
    assertEquals(6,root.getEntryCount());
    assertThat(root.getEntryNames(),hasItem("Thumbnail"));
    assertThat(root.getEntryNames(),hasItem("Image"));
    assertThat(root.getEntryNames(),hasItem("Tags"));
    assertThat(root.getEntryNames(),hasItem("Testing 123"));
    assertThat(root.getEntryNames(),hasItem("\u0005DocumentSummaryInformation"));
    assertThat(root.getEntryNames(),hasItem("\u0005SummaryInformation"));
    sinf=(SummaryInformation)PropertySetFactory.create(new NDocumentInputStream((DocumentEntry)root.getEntry(SummaryInformation.DEFAULT_STREAM_NAME)));
    assertEquals(131333,sinf.getOSVersion());
    dinf=(DocumentSummaryInformation)PropertySetFactory.create(new NDocumentInputStream((DocumentEntry)root.getEntry(DocumentSummaryInformation.DEFAULT_STREAM_NAME)));
    assertEquals(131333,dinf.getOSVersion());
    assertContentsMatches(mini,(DocumentEntry)testDir.getEntry("Mini"));
    byte[] main4096=new byte[4096];
    main4096[0]=-10;
    main4096[4095]=-11;
    testDir.createDocument("Normal4096",new ByteArrayInputStream(main4096));
    root.getEntry("Tags").delete();
    fs=writeOutAndReadBack(fs);
    root=fs.getRoot();
    testDir=(DirectoryEntry)root.getEntry("Testing 123");
    assertEquals(5,root.getEntryCount());
    assertThat(root.getEntryNames(),hasItem("Thumbnail"));
    assertThat(root.getEntryNames(),hasItem("Image"));
    assertThat(root.getEntryNames(),hasItem("Testing 123"));
    assertThat(root.getEntryNames(),hasItem("\u0005DocumentSummaryInformation"));
    assertThat(root.getEntryNames(),hasItem("\u0005SummaryInformation"));
    sinf=(SummaryInformation)PropertySetFactory.create(new NDocumentInputStream((DocumentEntry)root.getEntry(SummaryInformation.DEFAULT_STREAM_NAME)));
    assertEquals(131333,sinf.getOSVersion());
    dinf=(DocumentSummaryInformation)PropertySetFactory.create(new NDocumentInputStream((DocumentEntry)root.getEntry(DocumentSummaryInformation.DEFAULT_STREAM_NAME)));
    assertEquals(131333,dinf.getOSVersion());
    assertContentsMatches(mini,(DocumentEntry)testDir.getEntry("Mini"));
    assertContentsMatches(main4096,(DocumentEntry)testDir.getEntry("Normal4096"));
    testDir.getEntry("Testing 456").delete();
    testDir.createDirectory("Testing ABC");
    fs=writeOutAndReadBack(fs);
    root=fs.getRoot();
    testDir=(DirectoryEntry)root.getEntry("Testing 123");
    assertEquals(5,root.getEntryCount());
    assertThat(root.getEntryNames(),hasItem("Thumbnail"));
    assertThat(root.getEntryNames(),hasItem("Image"));
    assertThat(root.getEntryNames(),hasItem("Testing 123"));
    assertThat(root.getEntryNames(),hasItem("\u0005DocumentSummaryInformation"));
    assertThat(root.getEntryNames(),hasItem("\u0005SummaryInformation"));
    assertEquals(4,testDir.getEntryCount());
    assertThat(testDir.getEntryNames(),hasItem("Mini"));
    assertThat(testDir.getEntryNames(),hasItem("Normal4096"));
    assertThat(testDir.getEntryNames(),hasItem("Testing 789"));
    assertThat(testDir.getEntryNames(),hasItem("Testing ABC"));
    byte[] mini2=new byte[]{-42,0,-1,-2,-3,-4,-42};
    testDir.createDocument("Mini2",new ByteArrayInputStream(mini2));
    fs=writeOutAndReadBack(fs);
    root=fs.getRoot();
    testDir=(DirectoryEntry)root.getEntry("Testing 123");
    assertEquals(5,root.getEntryCount());
    assertThat(root.getEntryNames(),hasItem("Thumbnail"));
    assertThat(root.getEntryNames(),hasItem("Image"));
    assertThat(root.getEntryNames(),hasItem("Testing 123"));
    assertThat(root.getEntryNames(),hasItem("\u0005DocumentSummaryInformation"));
    assertThat(root.getEntryNames(),hasItem("\u0005SummaryInformation"));
    assertEquals(5,testDir.getEntryCount());
    assertThat(testDir.getEntryNames(),hasItem("Mini"));
    assertThat(testDir.getEntryNames(),hasItem("Mini2"));
    assertThat(testDir.getEntryNames(),hasItem("Normal4096"));
    assertThat(testDir.getEntryNames(),hasItem("Testing 789"));
    assertThat(testDir.getEntryNames(),hasItem("Testing ABC"));
    assertContentsMatches(mini,(DocumentEntry)testDir.getEntry("Mini"));
    assertContentsMatches(mini2,(DocumentEntry)testDir.getEntry("Mini2"));
    assertContentsMatches(main4096,(DocumentEntry)testDir.getEntry("Normal4096"));
    testDir.getEntry("Mini").delete();
    byte[] mini3=new byte[]{42,0,42,0,42,0,42};
    testDir.createDocument("Mini3",new ByteArrayInputStream(mini3));
    fs=writeOutAndReadBack(fs);
    root=fs.getRoot();
    testDir=(DirectoryEntry)root.getEntry("Testing 123");
    assertEquals(5,root.getEntryCount());
    assertThat(root.getEntryNames(),hasItem("Thumbnail"));
    assertThat(root.getEntryNames(),hasItem("Image"));
    assertThat(root.getEntryNames(),hasItem("Testing 123"));
    assertThat(root.getEntryNames(),hasItem("\u0005DocumentSummaryInformation"));
    assertThat(root.getEntryNames(),hasItem("\u0005SummaryInformation"));
    assertEquals(5,testDir.getEntryCount());
    assertThat(testDir.getEntryNames(),hasItem("Mini2"));
    assertThat(testDir.getEntryNames(),hasItem("Mini3"));
    assertThat(testDir.getEntryNames(),hasItem("Normal4096"));
    assertThat(testDir.getEntryNames(),hasItem("Testing 789"));
    assertThat(testDir.getEntryNames(),hasItem("Testing ABC"));
    assertContentsMatches(mini2,(DocumentEntry)testDir.getEntry("Mini2"));
    assertContentsMatches(mini3,(DocumentEntry)testDir.getEntry("Mini3"));
    assertContentsMatches(main4096,(DocumentEntry)testDir.getEntry("Normal4096"));
    NPOIFSDocument mini2Doc=new NPOIFSDocument((DocumentNode)testDir.getEntry("Mini2"));
    mini2Doc.replaceContents(new ByteArrayInputStream(mini));
    byte[] main4106=new byte[4106];
    main4106[0]=41;
    main4106[4105]=42;
    NPOIFSDocument mainDoc=new NPOIFSDocument((DocumentNode)testDir.getEntry("Normal4096"));
    mainDoc.replaceContents(new ByteArrayInputStream(main4106));
    fs=writeOutAndReadBack(fs);
    root=fs.getRoot();
    testDir=(DirectoryEntry)root.getEntry("Testing 123");
    assertEquals(5,root.getEntryCount());
    assertThat(root.getEntryNames(),hasItem("Thumbnail"));
    assertThat(root.getEntryNames(),hasItem("Image"));
    assertThat(root.getEntryNames(),hasItem("Testing 123"));
    assertThat(root.getEntryNames(),hasItem("\u0005DocumentSummaryInformation"));
    assertThat(root.getEntryNames(),hasItem("\u0005SummaryInformation"));
    assertEquals(5,testDir.getEntryCount());
    assertThat(testDir.getEntryNames(),hasItem("Mini2"));
    assertThat(testDir.getEntryNames(),hasItem("Mini3"));
    assertThat(testDir.getEntryNames(),hasItem("Normal4096"));
    assertThat(testDir.getEntryNames(),hasItem("Testing 789"));
    assertThat(testDir.getEntryNames(),hasItem("Testing ABC"));
    assertContentsMatches(mini,(DocumentEntry)testDir.getEntry("Mini2"));
    assertContentsMatches(mini3,(DocumentEntry)testDir.getEntry("Mini3"));
    assertContentsMatches(main4106,(DocumentEntry)testDir.getEntry("Normal4096"));
    fs.close();
  }
}

</code></pre>

<pre class="type-2 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Create a new file, write it and read it again
 * Then, add some streams, write and read
 */
@Test @SuppressWarnings("resource") public void createWriteRead() throws Exception {
  NPOIFSFileSystem fs=new NPOIFSFileSystem();
  DocumentEntry miniDoc;
  DocumentEntry normDoc;
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(0));
  assertEquals(POIFSConstants.FAT_SECTOR_BLOCK,fs.getNextBlock(1));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(2));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getRoot().getProperty().getStartBlock());
  assertEquals(0,fs._get_property_table().getStartBlock());
  fs=writeOutAndReadBack(fs);
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(0));
  assertEquals(POIFSConstants.FAT_SECTOR_BLOCK,fs.getNextBlock(1));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(2));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(3));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getRoot().getProperty().getStartBlock());
  assertEquals(0,fs._get_property_table().getStartBlock());
  DirectoryEntry testDir=fs.createDirectory("Test Directory");
  byte[] main4096=new byte[4096];
  main4096[0]=-10;
  main4096[4095]=-11;
  testDir.createDocument("Normal4096",new ByteArrayInputStream(main4096));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(0));
  assertEquals(POIFSConstants.FAT_SECTOR_BLOCK,fs.getNextBlock(1));
  assertEquals(3,fs.getNextBlock(2));
  assertEquals(4,fs.getNextBlock(3));
  assertEquals(5,fs.getNextBlock(4));
  assertEquals(6,fs.getNextBlock(5));
  assertEquals(7,fs.getNextBlock(6));
  assertEquals(8,fs.getNextBlock(7));
  assertEquals(9,fs.getNextBlock(8));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(9));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(10));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(11));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getRoot().getProperty().getStartBlock());
  byte[] main5124=new byte[5124];
  main5124[0]=-22;
  main5124[5123]=-33;
  testDir.createDocument("Normal5124",new ByteArrayInputStream(main5124));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(0));
  assertEquals(POIFSConstants.FAT_SECTOR_BLOCK,fs.getNextBlock(1));
  assertEquals(3,fs.getNextBlock(2));
  assertEquals(4,fs.getNextBlock(3));
  assertEquals(5,fs.getNextBlock(4));
  assertEquals(6,fs.getNextBlock(5));
  assertEquals(7,fs.getNextBlock(6));
  assertEquals(8,fs.getNextBlock(7));
  assertEquals(9,fs.getNextBlock(8));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(9));
  assertEquals(11,fs.getNextBlock(10));
  assertEquals(12,fs.getNextBlock(11));
  assertEquals(13,fs.getNextBlock(12));
  assertEquals(14,fs.getNextBlock(13));
  assertEquals(15,fs.getNextBlock(14));
  assertEquals(16,fs.getNextBlock(15));
  assertEquals(17,fs.getNextBlock(16));
  assertEquals(18,fs.getNextBlock(17));
  assertEquals(19,fs.getNextBlock(18));
  assertEquals(20,fs.getNextBlock(19));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(20));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(21));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(22));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getRoot().getProperty().getStartBlock());
  byte[] mini=new byte[]{42,0,1,2,3,4,42};
  testDir.createDocument("Mini",new ByteArrayInputStream(mini));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(0));
  assertEquals(POIFSConstants.FAT_SECTOR_BLOCK,fs.getNextBlock(1));
  assertEquals(3,fs.getNextBlock(2));
  assertEquals(4,fs.getNextBlock(3));
  assertEquals(5,fs.getNextBlock(4));
  assertEquals(6,fs.getNextBlock(5));
  assertEquals(7,fs.getNextBlock(6));
  assertEquals(8,fs.getNextBlock(7));
  assertEquals(9,fs.getNextBlock(8));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(9));
  assertEquals(11,fs.getNextBlock(10));
  assertEquals(12,fs.getNextBlock(11));
  assertEquals(13,fs.getNextBlock(12));
  assertEquals(14,fs.getNextBlock(13));
  assertEquals(15,fs.getNextBlock(14));
  assertEquals(16,fs.getNextBlock(15));
  assertEquals(17,fs.getNextBlock(16));
  assertEquals(18,fs.getNextBlock(17));
  assertEquals(19,fs.getNextBlock(18));
  assertEquals(20,fs.getNextBlock(19));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(20));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(21));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(22));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(23));
  assertEquals(22,fs.getRoot().getProperty().getStartBlock());
  fs=writeOutAndReadBack(fs);
  HeaderBlock header=writeOutAndReadHeader(fs);
  assertEquals(1,header.getBATCount());
  assertEquals(1,header.getBATArray()[0]);
  assertEquals(0,header.getPropertyStart());
  assertEquals(1,header.getSBATCount());
  assertEquals(21,header.getSBATStart());
  assertEquals(22,fs._get_property_table().getRoot().getStartBlock());
  assertEquals(23,fs.getNextBlock(0));
  assertEquals(POIFSConstants.FAT_SECTOR_BLOCK,fs.getNextBlock(1));
  assertEquals(3,fs.getNextBlock(2));
  assertEquals(4,fs.getNextBlock(3));
  assertEquals(5,fs.getNextBlock(4));
  assertEquals(6,fs.getNextBlock(5));
  assertEquals(7,fs.getNextBlock(6));
  assertEquals(8,fs.getNextBlock(7));
  assertEquals(9,fs.getNextBlock(8));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(9));
  assertEquals(11,fs.getNextBlock(10));
  assertEquals(12,fs.getNextBlock(11));
  assertEquals(13,fs.getNextBlock(12));
  assertEquals(14,fs.getNextBlock(13));
  assertEquals(15,fs.getNextBlock(14));
  assertEquals(16,fs.getNextBlock(15));
  assertEquals(17,fs.getNextBlock(16));
  assertEquals(18,fs.getNextBlock(17));
  assertEquals(19,fs.getNextBlock(18));
  assertEquals(20,fs.getNextBlock(19));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(20));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(21));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(22));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(23));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(24));
  assertEquals(1,fs.getRoot().getEntryCount());
  testDir=(DirectoryEntry)fs.getRoot().getEntry("Test Directory");
  assertEquals(3,testDir.getEntryCount());
  miniDoc=(DocumentEntry)testDir.getEntry("Mini");
  assertContentsMatches(mini,miniDoc);
  normDoc=(DocumentEntry)testDir.getEntry("Normal4096");
  assertContentsMatches(main4096,normDoc);
  normDoc=(DocumentEntry)testDir.getEntry("Normal5124");
  assertContentsMatches(main5124,normDoc);
  miniDoc.delete();
  normDoc.delete();
  fs=writeOutAndReadBack(fs);
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(0));
  assertEquals(POIFSConstants.FAT_SECTOR_BLOCK,fs.getNextBlock(1));
  assertEquals(3,fs.getNextBlock(2));
  assertEquals(4,fs.getNextBlock(3));
  assertEquals(5,fs.getNextBlock(4));
  assertEquals(6,fs.getNextBlock(5));
  assertEquals(7,fs.getNextBlock(6));
  assertEquals(8,fs.getNextBlock(7));
  assertEquals(9,fs.getNextBlock(8));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(9));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(10));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(11));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(12));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(13));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(14));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(15));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(16));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(17));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(18));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(19));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(20));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(21));
  assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(22));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(23));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(24));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(25));
  fs.close();
}

</code></pre>

<pre class="type-1 type-4 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void readZeroLengthEntries() throws Exception {
  NPOIFSFileSystem fs=new NPOIFSFileSystem(_inst.getFile("only-zero-byte-streams.ole2"));
  DirectoryNode testDir=fs.getRoot();
  assertEquals(3,testDir.getEntryCount());
  DocumentEntry entry;
  entry=(DocumentEntry)testDir.getEntry("test-zero-1");
  assertNotNull(entry);
  assertEquals(0,entry.getSize());
  entry=(DocumentEntry)testDir.getEntry("test-zero-2");
  assertNotNull(entry);
  assertEquals(0,entry.getSize());
  entry=(DocumentEntry)testDir.getEntry("test-zero-3");
  assertNotNull(entry);
  assertEquals(0,entry.getSize());
  NPropertyTable props=fs._get_property_table();
  assertEquals(POIFSConstants.END_OF_CHAIN,props.getRoot().getStartBlock());
  for (  Property prop : props.getRoot()) {
    assertEquals("test-zero-",prop.getName().substring(0,10));
    assertEquals(POIFSConstants.END_OF_CHAIN,prop.getStartBlock());
  }
  fs.close();
}

</code></pre>

<pre class="type-2 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void writeZeroLengthEntries() throws Exception {
  NPOIFSFileSystem fs=new NPOIFSFileSystem();
  DirectoryNode testDir=fs.getRoot();
  DocumentEntry miniDoc;
  DocumentEntry normDoc;
  DocumentEntry emptyDoc;
  byte[] mini2=new byte[]{-42,0,-1,-2,-3,-4,-42};
  testDir.createDocument("Mini2",new ByteArrayInputStream(mini2));
  byte[] main4106=new byte[4106];
  main4106[0]=41;
  main4106[4105]=42;
  testDir.createDocument("Normal4106",new ByteArrayInputStream(main4106));
  byte[] empty=new byte[0];
  testDir.createDocument("empty-1",new ByteArrayInputStream(empty));
  testDir.createDocument("empty-2",new ByteArrayInputStream(empty));
  testDir.createDocument("empty-3",new ByteArrayInputStream(empty));
  miniDoc=(DocumentEntry)testDir.getEntry("Mini2");
  assertContentsMatches(mini2,miniDoc);
  normDoc=(DocumentEntry)testDir.getEntry("Normal4106");
  assertContentsMatches(main4106,normDoc);
  emptyDoc=(DocumentEntry)testDir.getEntry("empty-1");
  assertContentsMatches(empty,emptyDoc);
  emptyDoc=(DocumentEntry)testDir.getEntry("empty-2");
  assertContentsMatches(empty,emptyDoc);
  emptyDoc=(DocumentEntry)testDir.getEntry("empty-3");
  assertContentsMatches(empty,emptyDoc);
  NPropertyTable props=fs._get_property_table();
  Iterator<Property> propsIt=props.getRoot().getChildren();
  Property prop=propsIt.next();
  assertEquals("Mini2",prop.getName());
  assertEquals(0,prop.getStartBlock());
  assertEquals(7,prop.getSize());
  prop=propsIt.next();
  assertEquals("Normal4106",prop.getName());
  assertEquals(4,prop.getStartBlock());
  assertEquals(4106,prop.getSize());
  prop=propsIt.next();
  assertEquals("empty-1",prop.getName());
  assertEquals(POIFSConstants.END_OF_CHAIN,prop.getStartBlock());
  assertEquals(0,prop.getSize());
  prop=propsIt.next();
  assertEquals("empty-2",prop.getName());
  assertEquals(POIFSConstants.END_OF_CHAIN,prop.getStartBlock());
  assertEquals(0,prop.getSize());
  prop=propsIt.next();
  assertEquals("empty-3",prop.getName());
  assertEquals(POIFSConstants.END_OF_CHAIN,prop.getStartBlock());
  assertEquals(0,prop.getSize());
  fs=writeOutAndReadBack(fs);
  testDir=fs.getRoot();
  miniDoc=(DocumentEntry)testDir.getEntry("Mini2");
  assertContentsMatches(mini2,miniDoc);
  normDoc=(DocumentEntry)testDir.getEntry("Normal4106");
  assertContentsMatches(main4106,normDoc);
  emptyDoc=(DocumentEntry)testDir.getEntry("empty-1");
  assertContentsMatches(empty,emptyDoc);
  emptyDoc=(DocumentEntry)testDir.getEntry("empty-2");
  assertContentsMatches(empty,emptyDoc);
  emptyDoc=(DocumentEntry)testDir.getEntry("empty-3");
  assertContentsMatches(empty,emptyDoc);
  assertEquals(3,testDir.getProperty().getStartBlock());
  assertEquals(64,testDir.getProperty().getSize());
  fs.close();
}

</code></pre>

<pre class="type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Check we get the right data back for each block
 */
@Test public void getBlock() throws Exception {
  NPOIFSFileSystem fsA=new NPOIFSFileSystem(_inst.getFile("BlockSize512.zvi"));
  NPOIFSFileSystem fsB=new NPOIFSFileSystem(_inst.openResourceAsStream("BlockSize512.zvi"));
  for (  NPOIFSFileSystem fs : new NPOIFSFileSystem[]{fsA,fsB}) {
    ByteBuffer b;
    b=fs.getBlockAt(0);
    assertEquals((byte)0x9e,b.get());
    assertEquals((byte)0x75,b.get());
    assertEquals((byte)0x97,b.get());
    assertEquals((byte)0xf6,b.get());
    b=fs.getBlockAt(1);
    assertEquals((byte)0x86,b.get());
    assertEquals((byte)0x09,b.get());
    assertEquals((byte)0x22,b.get());
    assertEquals((byte)0xfb,b.get());
    b=fs.getBlockAt(99);
    assertEquals((byte)0x01,b.get());
    assertEquals((byte)0x00,b.get());
    assertEquals((byte)0x00,b.get());
    assertEquals((byte)0x00,b.get());
    assertEquals((byte)0x02,b.get());
    assertEquals((byte)0x00,b.get());
    assertEquals((byte)0x00,b.get());
    assertEquals((byte)0x00,b.get());
    fs.close();
  }
  fsA=new NPOIFSFileSystem(_inst.getFile("BlockSize4096.zvi"));
  fsB=new NPOIFSFileSystem(_inst.openResourceAsStream("BlockSize4096.zvi"));
  for (  NPOIFSFileSystem fs : new NPOIFSFileSystem[]{fsA,fsB}) {
    ByteBuffer b;
    b=fs.getBlockAt(0);
    assertEquals((byte)0x9e,b.get());
    assertEquals((byte)0x75,b.get());
    assertEquals((byte)0x97,b.get());
    assertEquals((byte)0xf6,b.get());
    b=fs.getBlockAt(1);
    assertEquals((byte)0x00,b.get());
    assertEquals((byte)0x00,b.get());
    assertEquals((byte)0x03,b.get());
    assertEquals((byte)0x00,b.get());
    b=fs.getBlockAt(14);
    assertEquals((byte)0x01,b.get());
    assertEquals((byte)0x00,b.get());
    assertEquals((byte)0x00,b.get());
    assertEquals((byte)0x00,b.get());
    assertEquals((byte)0x02,b.get());
    assertEquals((byte)0x00,b.get());
    assertEquals((byte)0x00,b.get());
    assertEquals((byte)0x00,b.get());
    fs.close();
  }
}

</code></pre>

<pre class="type-2 type-1 type-13 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies logic rules using matcher-style statements">ConditionMatcher</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies logic rules using matcher-style statements
"></span><br>
/** 
 * Test that we can read a file with NPOIFS, create a new NPOIFS instance,
 * write it out, read it with POIFS, and see the original data
 */
@Test public void NPOIFSReadCopyWritePOIFSRead() throws Exception {
  File testFile=POIDataSamples.getSpreadSheetInstance().getFile("Simple.xls");
  NPOIFSFileSystem src=new NPOIFSFileSystem(testFile);
  byte wbDataExp[]=IOUtils.toByteArray(src.createDocumentInputStream("Workbook"));
  NPOIFSFileSystem nfs=new NPOIFSFileSystem();
  EntryUtils.copyNodes(src.getRoot(),nfs.getRoot());
  src.close();
  ByteArrayOutputStream bos=new ByteArrayOutputStream();
  nfs.writeFilesystem(bos);
  nfs.close();
  POIFSFileSystem pfs=new POIFSFileSystem(new ByteArrayInputStream(bos.toByteArray()));
  byte wbDataAct[]=IOUtils.toByteArray(pfs.createDocumentInputStream("Workbook"));
  assertThat(wbDataExp,equalTo(wbDataAct));
}

</code></pre>

<pre class="type-2 type-12 type-10 type-1 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Ask for free blocks where no free ones exist, and so the
 * file needs to be extended and another BAT/XBAT added
 */
@Test public void getFreeBlockWithNoneSpare() throws Exception {
  NPOIFSFileSystem fs=new NPOIFSFileSystem(_inst.openResourceAsStream("BlockSize512.zvi"));
  int free;
  assertEquals(POIFSConstants.FAT_SECTOR_BLOCK,fs.getNextBlock(99));
  assertBATCount(fs,1,0);
  for (int i=100; i < 128; i++) {
    assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(i));
  }
  assertEquals(true,fs.getBATBlockAndIndex(0).getBlock().hasFreeSectors());
  for (int i=100; i < 128; i++) {
    fs.setNextBlock(i,POIFSConstants.END_OF_CHAIN);
  }
  assertEquals(false,fs.getBATBlockAndIndex(0).getBlock().hasFreeSectors());
  try {
    assertEquals(false,fs.getBATBlockAndIndex(128).getBlock().hasFreeSectors());
    fail("Should only be one BAT");
  }
 catch (  IndexOutOfBoundsException e) {
  }
  assertBATCount(fs,1,0);
  assertEquals(129,fs.getFreeBlock());
  assertEquals(false,fs.getBATBlockAndIndex(0).getBlock().hasFreeSectors());
  assertEquals(true,fs.getBATBlockAndIndex(128).getBlock().hasFreeSectors());
  assertEquals(POIFSConstants.FAT_SECTOR_BLOCK,fs.getNextBlock(128));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(129));
  assertBATCount(fs,2,0);
  for (int i=0; i < 109; i++) {
    fs.getFreeBlock();
    int startOffset=i * 128;
    while (fs.getBATBlockAndIndex(startOffset).getBlock().hasFreeSectors()) {
      free=fs.getFreeBlock();
      fs.setNextBlock(free,POIFSConstants.END_OF_CHAIN);
    }
  }
  assertEquals(false,fs.getBATBlockAndIndex(109 * 128 - 1).getBlock().hasFreeSectors());
  try {
    assertEquals(false,fs.getBATBlockAndIndex(109 * 128).getBlock().hasFreeSectors());
    fail("Should only be 109 BATs");
  }
 catch (  IndexOutOfBoundsException e) {
  }
  assertBATCount(fs,109,0);
  HeaderBlock header=writeOutAndReadHeader(fs);
  assertEquals(109,header.getBATCount());
  assertEquals(0,header.getXBATCount());
  free=fs.getFreeBlock();
  assertEquals(false,fs.getBATBlockAndIndex(109 * 128 - 1).getBlock().hasFreeSectors());
  assertEquals(true,fs.getBATBlockAndIndex(110 * 128 - 1).getBlock().hasFreeSectors());
  try {
    assertEquals(false,fs.getBATBlockAndIndex(110 * 128).getBlock().hasFreeSectors());
    fail("Should only be 110 BATs");
  }
 catch (  IndexOutOfBoundsException e) {
  }
  assertBATCount(fs,110,1);
  header=writeOutAndReadHeader(fs);
  assertEquals(110,header.getBATCount());
  assertEquals(1,header.getXBATCount());
  for (int i=109; i < 109 + 127; i++) {
    fs.getFreeBlock();
    int startOffset=i * 128;
    while (fs.getBATBlockAndIndex(startOffset).getBlock().hasFreeSectors()) {
      free=fs.getFreeBlock();
      fs.setNextBlock(free,POIFSConstants.END_OF_CHAIN);
    }
    assertBATCount(fs,i + 1,1);
  }
  assertEquals(false,fs.getBATBlockAndIndex(236 * 128 - 1).getBlock().hasFreeSectors());
  try {
    assertEquals(false,fs.getBATBlockAndIndex(236 * 128).getBlock().hasFreeSectors());
    fail("Should only be 236 BATs");
  }
 catch (  IndexOutOfBoundsException e) {
  }
  assertBATCount(fs,236,1);
  free=fs.getFreeBlock();
  assertEquals(false,fs.getBATBlockAndIndex(236 * 128 - 1).getBlock().hasFreeSectors());
  assertEquals(true,fs.getBATBlockAndIndex(237 * 128 - 1).getBlock().hasFreeSectors());
  try {
    assertEquals(false,fs.getBATBlockAndIndex(237 * 128).getBlock().hasFreeSectors());
    fail("Should only be 237 BATs");
  }
 catch (  IndexOutOfBoundsException e) {
  }
  assertBATCount(fs,237,2);
  header=writeOutAndReadHeader(fs);
  fs=writeOutAndReadBack(fs);
  assertBATCount(fs,237,2);
  assertEquals(false,fs.getBATBlockAndIndex(236 * 128 - 1).getBlock().hasFreeSectors());
  assertEquals(true,fs.getBATBlockAndIndex(237 * 128 - 1).getBlock().hasFreeSectors());
  try {
    assertEquals(false,fs.getBATBlockAndIndex(237 * 128).getBlock().hasFreeSectors());
    fail("Should only be 237 BATs");
  }
 catch (  IndexOutOfBoundsException e) {
  }
  fs.close();
}

</code></pre>

<pre class="type-2 type-12 type-10 type-1 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions in iterations">IterativeVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions in iterations
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void propertiesAndFatOnRead() throws Exception {
  NPOIFSFileSystem fsA, fsB;
  fsA=new NPOIFSFileSystem(_inst.getFile("BlockSize512.zvi"));
  fsB=new NPOIFSFileSystem(_inst.openResourceAsStream("BlockSize512.zvi"));
  for (  NPOIFSFileSystem fs : new NPOIFSFileSystem[]{fsA,fsB}) {
    fs.getBATBlockAndIndex(0);
    fs.getBATBlockAndIndex(1);
    try {
      fs.getBATBlockAndIndex(140);
      fail("Should only be one BAT, but a 2nd was found");
    }
 catch (    IndexOutOfBoundsException e) {
    }
    assertEquals(98,fs.getNextBlock(97));
    assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(98));
    NPropertyTable props=fs._get_property_table();
    assertEquals(90,props.getStartBlock());
    assertEquals(7,props.countBlocks());
    RootProperty root=props.getRoot();
    assertEquals("Root Entry",root.getName());
    assertEquals(11564,root.getSize());
    assertEquals(0,root.getStartBlock());
    Property prop;
    Iterator<Property> pi=root.getChildren();
    prop=pi.next();
    assertEquals("Thumbnail",prop.getName());
    prop=pi.next();
    assertEquals("\u0005DocumentSummaryInformation",prop.getName());
    prop=pi.next();
    assertEquals("\u0005SummaryInformation",prop.getName());
    prop=pi.next();
    assertEquals("Image",prop.getName());
    prop=pi.next();
    assertEquals("Tags",prop.getName());
    assertEquals(false,pi.hasNext());
    NPOIFSMiniStore ministore=fs.getMiniStore();
    ministore.getBATBlockAndIndex(0);
    ministore.getBATBlockAndIndex(128);
    try {
      ministore.getBATBlockAndIndex(256);
      fail("Should only be two SBATs, but a 3rd was found");
    }
 catch (    IndexOutOfBoundsException e) {
    }
    for (int i=0; i < 50; i++) {
      assertEquals(i + 1,ministore.getNextBlock(i));
    }
    assertEquals(POIFSConstants.END_OF_CHAIN,ministore.getNextBlock(50));
    fs.close();
  }
  fsA=new NPOIFSFileSystem(_inst.getFile("BlockSize4096.zvi"));
  fsB=new NPOIFSFileSystem(_inst.openResourceAsStream("BlockSize4096.zvi"));
  for (  NPOIFSFileSystem fs : new NPOIFSFileSystem[]{fsA,fsB}) {
    fs.getBATBlockAndIndex(0);
    fs.getBATBlockAndIndex(1);
    try {
      fs.getBATBlockAndIndex(1040);
      fail("Should only be one BAT, but a 2nd was found");
    }
 catch (    IndexOutOfBoundsException e) {
    }
    assertEquals(1,fs.getNextBlock(0));
    assertEquals(2,fs.getNextBlock(1));
    assertEquals(POIFSConstants.END_OF_CHAIN,fs.getNextBlock(2));
    NPropertyTable props=fs._get_property_table();
    assertEquals(12,props.getStartBlock());
    assertEquals(1,props.countBlocks());
    RootProperty root=props.getRoot();
    assertEquals("Root Entry",root.getName());
    assertEquals(11564,root.getSize());
    assertEquals(0,root.getStartBlock());
    Property prop;
    Iterator<Property> pi=root.getChildren();
    prop=pi.next();
    assertEquals("Thumbnail",prop.getName());
    prop=pi.next();
    assertEquals("\u0005DocumentSummaryInformation",prop.getName());
    prop=pi.next();
    assertEquals("\u0005SummaryInformation",prop.getName());
    prop=pi.next();
    assertEquals("Image",prop.getName());
    prop=pi.next();
    assertEquals("Tags",prop.getName());
    assertEquals(false,pi.hasNext());
    NPOIFSMiniStore ministore=fs.getMiniStore();
    ministore.getBATBlockAndIndex(0);
    ministore.getBATBlockAndIndex(128);
    ministore.getBATBlockAndIndex(1023);
    try {
      ministore.getBATBlockAndIndex(1024);
      fail("Should only be one SBAT, but a 2nd was found");
    }
 catch (    IndexOutOfBoundsException e) {
    }
    for (int i=0; i < 50; i++) {
      assertEquals(i + 1,ministore.getNextBlock(i));
    }
    assertEquals(POIFSConstants.END_OF_CHAIN,ministore.getNextBlock(50));
    fs.close();
  }
}

</code></pre>

<pre class="type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Test that we can correctly get the list of directory
 * entries, and the details on the files in them
 */
@Test public void listEntries() throws Exception {
  for (  NPOIFSFileSystem fs : get512and4kFileAndInput()) {
    DirectoryEntry root=fs.getRoot();
    assertEquals(5,root.getEntryCount());
    Entry thumbnail=root.getEntry("Thumbnail");
    Entry dsi=root.getEntry("\u0005DocumentSummaryInformation");
    Entry si=root.getEntry("\u0005SummaryInformation");
    Entry image=root.getEntry("Image");
    Entry tags=root.getEntry("Tags");
    assertEquals(false,thumbnail.isDirectoryEntry());
    assertEquals(false,dsi.isDirectoryEntry());
    assertEquals(false,si.isDirectoryEntry());
    assertEquals(true,image.isDirectoryEntry());
    assertEquals(false,tags.isDirectoryEntry());
    Iterator<Entry> it=root.getEntries();
    assertEquals(thumbnail.getName(),it.next().getName());
    assertEquals(dsi.getName(),it.next().getName());
    assertEquals(si.getName(),it.next().getName());
    assertEquals(image.getName(),it.next().getName());
    assertEquals(tags.getName(),it.next().getName());
    DirectoryEntry imageD=(DirectoryEntry)image;
    assertEquals(7,imageD.getEntryCount());
    fs.close();
  }
}

</code></pre>

<pre class="type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
/** 
 * Ask for free blocks where there are some already
 * to be had from the FAT
 */
@Test public void getFreeBlockWithSpare() throws Exception {
  NPOIFSFileSystem fs=new NPOIFSFileSystem(_inst.getFile("BlockSize512.zvi"));
  assertEquals(true,fs.getBATBlockAndIndex(0).getBlock().hasFreeSectors());
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(100));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(101));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(102));
  assertEquals(POIFSConstants.UNUSED_BLOCK,fs.getNextBlock(103));
  assertEquals(100,fs.getFreeBlock());
  assertEquals(100,fs.getFreeBlock());
  fs.setNextBlock(100,POIFSConstants.END_OF_CHAIN);
  assertEquals(101,fs.getFreeBlock());
  fs.close();
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
