<h3 style="margin:0px">Class: org.apache.poi.xssf.usermodel.TestXSSFFormulaParser (6 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(6)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(6)</kbd></button>&nbsp;<button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(3)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="14"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('14')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-14"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-2 type-3 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void builtInFormulas(){
  XSSFWorkbook wb=new XSSFWorkbook();
  XSSFEvaluationWorkbook fpb=XSSFEvaluationWorkbook.create(wb);
  Ptg[] ptgs;
  ptgs=parse(fpb,"LOG10");
  assertEquals(1,ptgs.length);
  assertTrue("",(ptgs[0] instanceof RefPtg));
  ptgs=parse(fpb,"LOG10(100)");
  assertEquals(2,ptgs.length);
  assertTrue("",ptgs[0] instanceof IntPtg);
  assertTrue("",ptgs[1] instanceof FuncPtg);
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void formaulReferncesSameWorkbook(){
  XSSFWorkbook wb=XSSFTestDataSamples.openSampleWorkbook("56737.xlsx");
  XSSFEvaluationWorkbook fpb=XSSFEvaluationWorkbook.create(wb);
  Ptg[] ptgs;
  ptgs=parse(fpb,"[0]!NR_Global_B2");
  assertEquals(1,ptgs.length);
  assertEquals(NameXPxg.class,ptgs[0].getClass());
  assertEquals(0,((NameXPxg)ptgs[0]).getExternalWorkbookNumber());
  assertEquals(null,((NameXPxg)ptgs[0]).getSheetName());
  assertEquals("NR_Global_B2",((NameXPxg)ptgs[0]).getNameName());
  assertEquals("[0]!NR_Global_B2",((NameXPxg)ptgs[0]).toFormulaString());
}

</code></pre>

<pre class="type-2 type-10 type-3 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void basicParsing(){
  XSSFWorkbook wb=new XSSFWorkbook();
  XSSFEvaluationWorkbook fpb=XSSFEvaluationWorkbook.create(wb);
  Ptg[] ptgs;
  ptgs=parse(fpb,"ABC10");
  assertEquals(1,ptgs.length);
  assertTrue("",ptgs[0] instanceof RefPtg);
  ptgs=parse(fpb,"A500000");
  assertEquals(1,ptgs.length);
  assertTrue("",ptgs[0] instanceof RefPtg);
  ptgs=parse(fpb,"ABC500000");
  assertEquals(1,ptgs.length);
  assertTrue("",ptgs[0] instanceof RefPtg);
  ptgs=parse(fpb,"XFD1048576");
  assertEquals(1,ptgs.length);
  assertTrue("",ptgs[0] instanceof RefPtg);
  try {
    ptgs=parse(fpb,"XFE10");
    fail("expected exception");
  }
 catch (  FormulaParseException e) {
    assertEquals("Specified named range 'XFE10' does not exist in the current workbook.",e.getMessage());
  }
  try {
    ptgs=parse(fpb,"XFD1048577");
    fail("expected exception");
  }
 catch (  FormulaParseException e) {
    assertEquals("Specified named range 'XFD1048577' does not exist in the current workbook.",e.getMessage());
  }
  ptgs=parse(fpb,"ISEVEN(A1)");
  assertEquals(3,ptgs.length);
  assertEquals(NameXPxg.class,ptgs[0].getClass());
  assertEquals(RefPtg.class,ptgs[1].getClass());
  assertEquals(FuncVarPtg.class,ptgs[2].getClass());
  assertEquals("ISEVEN",ptgs[0].toFormulaString());
  assertEquals("A1",ptgs[1].toFormulaString());
  assertEquals("#external#",ptgs[2].toFormulaString());
  ptgs=parse(fpb,"SUM(A1:B3)");
  assertEquals(2,ptgs.length);
  assertEquals(AreaPtg.class,ptgs[0].getClass());
  assertEquals(AttrPtg.class,ptgs[1].getClass());
  assertEquals("A1:B3",ptgs[0].toFormulaString());
  assertEquals("SUM",ptgs[1].toFormulaString());
  ptgs=parse(fpb,"SUM(Sheet1!A1)");
  assertEquals(2,ptgs.length);
  assertEquals(Ref3DPxg.class,ptgs[0].getClass());
  assertEquals(AttrPtg.class,ptgs[1].getClass());
  assertEquals("Sheet1!A1",ptgs[0].toFormulaString());
  assertEquals("SUM",ptgs[1].toFormulaString());
  ptgs=parse(fpb,"SUM(Sheet1!A1:B3)");
  assertEquals(2,ptgs.length);
  assertEquals(Area3DPxg.class,ptgs[0].getClass());
  assertEquals(AttrPtg.class,ptgs[1].getClass());
  assertEquals("Sheet1!A1:B3",ptgs[0].toFormulaString());
  assertEquals("SUM",ptgs[1].toFormulaString());
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void formulaReferencesOtherSheets(){
  XSSFWorkbook wb=XSSFTestDataSamples.openSampleWorkbook("56737.xlsx");
  XSSFEvaluationWorkbook fpb=XSSFEvaluationWorkbook.create(wb);
  Ptg[] ptgs;
  ptgs=parse(fpb,"Uses!A1");
  assertEquals(1,ptgs.length);
  assertEquals(Ref3DPxg.class,ptgs[0].getClass());
  assertEquals(-1,((Ref3DPxg)ptgs[0]).getExternalWorkbookNumber());
  assertEquals("A1",((Ref3DPxg)ptgs[0]).format2DRefAsString());
  assertEquals("Uses!A1",((Ref3DPxg)ptgs[0]).toFormulaString());
  ptgs=parse(fpb,"'Testing 47100'!A1");
  assertEquals(1,ptgs.length);
  assertEquals(Ref3DPxg.class,ptgs[0].getClass());
  assertEquals(-1,((Ref3DPxg)ptgs[0]).getExternalWorkbookNumber());
  assertEquals("Testing 47100",((Ref3DPxg)ptgs[0]).getSheetName());
  assertEquals("A1",((Ref3DPxg)ptgs[0]).format2DRefAsString());
  assertEquals("'Testing 47100'!A1",((Ref3DPxg)ptgs[0]).toFormulaString());
  ptgs=parse(fpb,"Defines!NR_To_A1");
  assertEquals(1,ptgs.length);
  assertEquals(NameXPxg.class,ptgs[0].getClass());
  assertEquals(-1,((NameXPxg)ptgs[0]).getExternalWorkbookNumber());
  assertEquals("Defines",((NameXPxg)ptgs[0]).getSheetName());
  assertEquals("NR_To_A1",((NameXPxg)ptgs[0]).getNameName());
  assertEquals("Defines!NR_To_A1",((NameXPxg)ptgs[0]).toFormulaString());
  ptgs=parse(fpb,"NR_Global_B2");
  assertEquals(1,ptgs.length);
  assertEquals(NamePtg.class,ptgs[0].getClass());
  assertEquals("NR_Global_B2",((NamePtg)ptgs[0]).toFormulaString(fpb));
}

</code></pre>

<pre class="type-2 type-14 type-1 type-4 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * A handful of functions (such as SUM, COUNTA, MIN) support
 * multi-sheet references (eg Sheet1:Sheet3!A1 = Cell A1 from
 * Sheets 1 through Sheet 3) and multi-sheet area references 
 * (eg Sheet1:Sheet3!A1:B2 = Cells A1 through B2 from Sheets
 * 1 through Sheet 3).
 * This test, based on common test files for HSSF and XSSF, checks
 * that we can read and parse these kinds of references 
 * (but not evaluate - that's elsewhere in the test suite)
 */
@Test public void multiSheetReferencesHSSFandXSSF() throws Exception {
  Workbook[] wbs=new Workbook[]{HSSFTestDataSamples.openSampleWorkbook("55906-MultiSheetRefs.xls"),XSSFTestDataSamples.openSampleWorkbook("55906-MultiSheetRefs.xlsx")};
  for (  Workbook wb : wbs) {
    Sheet s1=wb.getSheetAt(0);
    Ptg[] ptgs;
    Cell sumF=s1.getRow(2).getCell(0);
    assertNotNull(sumF);
    assertEquals("SUM(Sheet1:Sheet3!A1)",sumF.getCellFormula());
    Cell avgF=s1.getRow(2).getCell(1);
    assertNotNull(avgF);
    assertEquals("AVERAGE(Sheet1:Sheet3!A1)",avgF.getCellFormula());
    Cell countAF=s1.getRow(2).getCell(2);
    assertNotNull(countAF);
    assertEquals("COUNTA(Sheet1:Sheet3!C1)",countAF.getCellFormula());
    Cell maxF=s1.getRow(4).getCell(1);
    assertNotNull(maxF);
    assertEquals("MAX(Sheet1:Sheet3!A$1)",maxF.getCellFormula());
    Cell sumFA=s1.getRow(2).getCell(7);
    assertNotNull(sumFA);
    assertEquals("SUM(Sheet1:Sheet3!A1:B2)",sumFA.getCellFormula());
    Cell avgFA=s1.getRow(2).getCell(8);
    assertNotNull(avgFA);
    assertEquals("AVERAGE(Sheet1:Sheet3!A1:B2)",avgFA.getCellFormula());
    Cell maxFA=s1.getRow(4).getCell(8);
    assertNotNull(maxFA);
    assertEquals("MAX(Sheet1:Sheet3!A$1:B$2)",maxFA.getCellFormula());
    Cell countFA=s1.getRow(5).getCell(8);
    assertNotNull(countFA);
    assertEquals("COUNT(Sheet1:Sheet3!$A$1:$B$2)",countFA.getCellFormula());
    FormulaParsingWorkbook fpb=null;
    if (wb instanceof HSSFWorkbook)     fpb=HSSFEvaluationWorkbook.create((HSSFWorkbook)wb);
 else     fpb=XSSFEvaluationWorkbook.create((XSSFWorkbook)wb);
    ptgs=parse(fpb,"SUM(Sheet1:Sheet3!A1)");
    assertEquals(2,ptgs.length);
    if (wb instanceof HSSFWorkbook) {
      assertEquals(Ref3DPtg.class,ptgs[0].getClass());
    }
 else {
      assertEquals(Ref3DPxg.class,ptgs[0].getClass());
    }
    assertEquals("Sheet1:Sheet3!A1",toFormulaString(ptgs[0],fpb));
    assertEquals(AttrPtg.class,ptgs[1].getClass());
    assertEquals("SUM",toFormulaString(ptgs[1],fpb));
    ptgs=parse(fpb,"MAX(Sheet1:Sheet3!A$1)");
    assertEquals(2,ptgs.length);
    if (wb instanceof HSSFWorkbook) {
      assertEquals(Ref3DPtg.class,ptgs[0].getClass());
    }
 else {
      assertEquals(Ref3DPxg.class,ptgs[0].getClass());
    }
    assertEquals("Sheet1:Sheet3!A$1",toFormulaString(ptgs[0],fpb));
    assertEquals(FuncVarPtg.class,ptgs[1].getClass());
    assertEquals("MAX",toFormulaString(ptgs[1],fpb));
    ptgs=parse(fpb,"MIN(Sheet1:Sheet3!$A$1)");
    assertEquals(2,ptgs.length);
    if (wb instanceof HSSFWorkbook) {
      assertEquals(Ref3DPtg.class,ptgs[0].getClass());
    }
 else {
      assertEquals(Ref3DPxg.class,ptgs[0].getClass());
    }
    assertEquals("Sheet1:Sheet3!$A$1",toFormulaString(ptgs[0],fpb));
    assertEquals(FuncVarPtg.class,ptgs[1].getClass());
    assertEquals("MIN",toFormulaString(ptgs[1],fpb));
    ptgs=parse(fpb,"SUM(Sheet1:Sheet3!A1:B2)");
    assertEquals(2,ptgs.length);
    if (wb instanceof HSSFWorkbook) {
      assertEquals(Area3DPtg.class,ptgs[0].getClass());
    }
 else {
      assertEquals(Area3DPxg.class,ptgs[0].getClass());
    }
    assertEquals("Sheet1:Sheet3!A1:B2",toFormulaString(ptgs[0],fpb));
    assertEquals(AttrPtg.class,ptgs[1].getClass());
    assertEquals("SUM",toFormulaString(ptgs[1],fpb));
    ptgs=parse(fpb,"MIN(Sheet1:Sheet3!$A$1:$B$2)");
    assertEquals(2,ptgs.length);
    if (wb instanceof HSSFWorkbook) {
      assertEquals(Area3DPtg.class,ptgs[0].getClass());
    }
 else {
      assertEquals(Area3DPxg.class,ptgs[0].getClass());
    }
    assertEquals("Sheet1:Sheet3!$A$1:$B$2",toFormulaString(ptgs[0],fpb));
    assertEquals(FuncVarPtg.class,ptgs[1].getClass());
    assertEquals("MIN",toFormulaString(ptgs[1],fpb));
    Cell newF=s1.getRow(0).createCell(10,Cell.CELL_TYPE_FORMULA);
    newF.setCellFormula("SUM(Sheet2:Sheet3!A1)");
    assertEquals("SUM(Sheet2:Sheet3!A1)",newF.getCellFormula());
    newF=s1.getRow(0).createCell(11,Cell.CELL_TYPE_FORMULA);
    newF.setCellFormula("MIN(Sheet1:Sheet2!A1:B2)");
    assertEquals("MIN(Sheet1:Sheet2!A1:B2)",newF.getCellFormula());
  }
}

</code></pre>

<pre class="type-2 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void formulaReferencesOtherWorkbook(){
  XSSFWorkbook wb=XSSFTestDataSamples.openSampleWorkbook("ref-56737.xlsx");
  XSSFEvaluationWorkbook fpb=XSSFEvaluationWorkbook.create(wb);
  Ptg[] ptgs;
  ptgs=parse(fpb,"[1]Uses!$A$1");
  assertEquals(1,ptgs.length);
  assertEquals(Ref3DPxg.class,ptgs[0].getClass());
  assertEquals(1,((Ref3DPxg)ptgs[0]).getExternalWorkbookNumber());
  assertEquals("Uses",((Ref3DPxg)ptgs[0]).getSheetName());
  assertEquals("$A$1",((Ref3DPxg)ptgs[0]).format2DRefAsString());
  assertEquals("[1]Uses!$A$1",((Ref3DPxg)ptgs[0]).toFormulaString());
  ptgs=parse(fpb,"[1]Defines!NR_To_A1");
  assertEquals(1,ptgs.length);
  assertEquals(NameXPxg.class,ptgs[0].getClass());
  assertEquals(1,((NameXPxg)ptgs[0]).getExternalWorkbookNumber());
  assertEquals("Defines",((NameXPxg)ptgs[0]).getSheetName());
  assertEquals("NR_To_A1",((NameXPxg)ptgs[0]).getNameName());
  assertEquals("[1]Defines!NR_To_A1",((NameXPxg)ptgs[0]).toFormulaString());
  ptgs=parse(fpb,"[1]!NR_Global_B2");
  assertEquals(1,ptgs.length);
  assertEquals(NameXPxg.class,ptgs[0].getClass());
  assertEquals(1,((NameXPxg)ptgs[0]).getExternalWorkbookNumber());
  assertEquals(null,((NameXPxg)ptgs[0]).getSheetName());
  assertEquals("NR_Global_B2",((NameXPxg)ptgs[0]).getNameName());
  assertEquals("[1]!NR_Global_B2",((NameXPxg)ptgs[0]).toFormulaString());
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
