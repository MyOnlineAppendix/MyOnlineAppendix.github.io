<h3 style="margin:0px">Class: org.apache.poi.openxml4j.opc.TestPackage (17 methods) </h3><br><pre style="padding:0"><code class="html"><div id="tags"><button id="5"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('5')" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes"><kbd id="tag-5"class="label-info"style="display: inline-block;font-size:7pt" >HybridVerifier&nbsp;(12)</kbd></button>&nbsp;<button id="6"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('6')" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value "><kbd id="tag-6"class="label-info"style="display: inline-block;font-size:7pt" >EqualityVerifier&nbsp;(12)</kbd></button>&nbsp;<button id="3"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('3')" data-toggle="tooltip" title="Verifies boolean conditions"><kbd id="tag-3"class="label-info"style="display: inline-block;font-size:7pt" >BooleanVerifier&nbsp;(10)</kbd></button>&nbsp;<button id="1"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('1')" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls"><kbd id="tag-1"class="label-info"style="display: inline-block;font-size:7pt" >InternalCallVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="4"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('4')" data-toggle="tooltip" title="Verifies whether objects are null"><kbd id="tag-4"class="label-info"style="display: inline-block;font-size:7pt" >NullVerifier&nbsp;(5)</kbd></button>&nbsp;<button id="2"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('2')" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) "><kbd id="tag-2"class="label-info"style="display: inline-block;font-size:7pt" >APIUtilityVerifier&nbsp;(4)</kbd></button>&nbsp;<button id="7"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('7')" data-toggle="tooltip" title="Executes methods or other tests from the same test unit"><kbd id="tag-7"class="label-info"style="display: inline-block;font-size:7pt" >ExecutionTester&nbsp;(2)</kbd></button>&nbsp;<button id="10"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('10')" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure"><kbd id="tag-10"class="label-info"style="display: inline-block;font-size:7pt" >UtilityVerifier&nbsp;(2)</kbd></button>&nbsp;<button id="14"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('14')" data-toggle="tooltip" title="Verifies assertions inside branch conditions"><kbd id="tag-14"class="label-info"style="display: inline-block;font-size:7pt" >BranchVerifier&nbsp;(1)</kbd></button>&nbsp;<button id="18"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('18')" data-toggle="tooltip" title="Is not executed with the test suite"><kbd id="tag-18"class="label-info"style="display: inline-block;font-size:7pt" >IgnoredMethod&nbsp;(1)</kbd></button>&nbsp;<button id="9"style="border-width:0;padding:0;background:#282B2E"  onclick="filter('9')" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution"><kbd id="tag-9"class="label-info"style="display: inline-block;font-size:7pt" >ExceptionVerifier&nbsp;(1)</kbd></button>&nbsp;</div></code></pre><center><button onclick="showBlocks()" style="margin:6px">Update filter <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> </button></center><br>
<pre class="type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Executes methods or other tests from the same test unit
"></span><br>
@Test public void zipBombCheckSizes() throws IOException, EncryptedDocumentException, InvalidFormatException {
  File file=OpenXML4JTestDataSamples.getSampleFile("sample.xlsx");
  try {
    double min_ratio=Double.MAX_VALUE;
    long max_size=0;
    ZipFile zf=ZipHelper.openZipFile(file);
    Enumeration<? extends ZipEntry> entries=zf.entries();
    while (entries.hasMoreElements()) {
      ZipEntry ze=entries.nextElement();
      double ratio=(double)ze.getCompressedSize() / (double)ze.getSize();
      min_ratio=Math.min(min_ratio,ratio);
      max_size=Math.max(max_size,ze.getSize());
    }
    zf.close();
    ZipSecureFile.setMinInflateRatio(min_ratio - 0.002);
    ZipSecureFile.setMaxEntrySize(max_size + 1);
    WorkbookFactory.create(file,null,true).close();
    ZipSecureFile.setMinInflateRatio(min_ratio + 0.002);
    try {
      WorkbookFactory.create(file,null,true).close();
    }
 catch (    InvalidFormatException e) {
      checkForZipBombException(e);
    }
catch (    POIXMLException e) {
      checkForZipBombException(e);
    }
    ZipSecureFile.setMinInflateRatio(min_ratio - 0.002);
    ZipSecureFile.setMaxEntrySize(max_size - 1);
    try {
      WorkbookFactory.create(file,null,true).close();
    }
 catch (    InvalidFormatException e) {
      checkForZipBombException(e);
    }
catch (    POIXMLException e) {
      checkForZipBombException(e);
    }
  }
  finally {
    ZipSecureFile.setMinInflateRatio(0.01d);
    ZipSecureFile.setMaxEntrySize(0xFFFFFFFFl);
  }
}

</code></pre>

<pre class="type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
"></span><br>
/** 
 * Test that we can open a file by path, save it
 * to another file, then delete both
 */
@Test public void openFileThenSaveDelete() throws IOException, InvalidFormatException {
  File tempFile=TempFile.createTempFile("poiTesting","tmp");
  File tempFile2=TempFile.createTempFile("poiTesting","tmp");
  File origFile=OpenXML4JTestDataSamples.getSampleFile("TestPackageCommon.docx");
  FileHelper.copyFile(origFile,tempFile);
  OPCPackage p=OPCPackage.open(tempFile.toString(),PackageAccess.READ_WRITE);
  p.save(tempFile2);
  p.close();
  assertTrue(tempFile.delete());
  assertTrue(tempFile2.delete());
}

</code></pre>

<pre class="type-4 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void deletePartRecursive() throws InvalidFormatException {
  TreeMap<PackagePartName,String> expectedValues;
  TreeMap<PackagePartName,String> values;
  values=new TreeMap<PackagePartName,String>();
  expectedValues=new TreeMap<PackagePartName,String>();
  expectedValues.put(PackagingURIHelper.createPartName("/_rels/.rels"),"application/vnd.openxmlformats-package.relationships+xml");
  expectedValues.put(PackagingURIHelper.createPartName("/docProps/app.xml"),"application/vnd.openxmlformats-officedocument.extended-properties+xml");
  expectedValues.put(PackagingURIHelper.createPartName("/docProps/core.xml"),"application/vnd.openxmlformats-package.core-properties+xml");
  String filepath=OpenXML4JTestDataSamples.getSampleFileName("sample.docx");
  @SuppressWarnings("resource") OPCPackage p=OPCPackage.open(filepath,PackageAccess.READ_WRITE);
  p.deletePartRecursive(PackagingURIHelper.createPartName("/word/document.xml"));
  for (  PackagePart part : p.getParts()) {
    values.put(part.getPartName(),part.getContentType());
    logger.log(POILogger.DEBUG,part.getPartName());
  }
  for (  PackagePartName partName : expectedValues.keySet()) {
    assertNotNull(values.get(partName));
    assertEquals(expectedValues.get(partName),values.get(partName));
  }
  p.revert();
}

</code></pre>

<pre class="type-10 type-3 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that we can open a file by path, and then
 * write changes to it.
 */
@Test public void openFileThenOverwrite() throws IOException, InvalidFormatException {
  File tempFile=TempFile.createTempFile("poiTesting","tmp");
  File origFile=OpenXML4JTestDataSamples.getSampleFile("TestPackageCommon.docx");
  FileHelper.copyFile(origFile,tempFile);
  OPCPackage p=OPCPackage.open(tempFile.toString(),PackageAccess.READ_WRITE);
  p.close();
  assertTrue(tempFile.delete());
  FileHelper.copyFile(origFile,tempFile);
  p=OPCPackage.open(tempFile.toString(),PackageAccess.READ_WRITE);
  try {
    p.save(tempFile);
    fail("You shouldn't be able to call save(File) to overwrite the current file");
  }
 catch (  InvalidOperationException e) {
  }
  p.close();
  assertTrue(tempFile.delete());
  FileHelper.copyFile(origFile,tempFile);
  p=OPCPackage.open(tempFile.toString(),PackageAccess.READ);
  p.close();
  assertTrue(tempFile.delete());
}

</code></pre>

<pre class="type-3 type-6 type-18 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Is not executed with the test suite">IgnoredMethod</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Is not executed with the test suite
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * TODO: fix and enable
 * @throws URISyntaxException 
 */
@Test @Ignore public void removePartRecursive() throws IOException, InvalidFormatException, URISyntaxException {
  String originalFile=OpenXML4JTestDataSamples.getSampleFileName("TestPackageCommon.docx");
  File targetFile=OpenXML4JTestDataSamples.getOutputFile("TestPackageRemovePartRecursiveOUTPUT.docx");
  File tempFile=OpenXML4JTestDataSamples.getOutputFile("TestPackageRemovePartRecursiveTMP.docx");
  @SuppressWarnings("resource") OPCPackage p=OPCPackage.open(originalFile,PackageAccess.READ_WRITE);
  p.removePartRecursive(PackagingURIHelper.createPartName(new URI("/word/document.xml")));
  p.save(tempFile.getAbsoluteFile());
  assertTrue(targetFile.exists());
  ZipFileAssert.assertEquals(targetFile,tempFile);
  assertTrue(targetFile.delete());
  p.revert();
}

</code></pre>

<pre class="type-10 type-3 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies (un)successful execution of the test case by reporting explicitly a failure">UtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies (un)successful execution of the test case by reporting explicitly a failure
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test package opening.
 */
@Test public void openPackage() throws IOException, InvalidFormatException {
  File targetFile=OpenXML4JTestDataSamples.getOutputFile("TestOpenPackageTMP.docx");
  File inputFile=OpenXML4JTestDataSamples.getSampleFile("TestOpenPackageINPUT.docx");
  File expectedFile=OpenXML4JTestDataSamples.getSampleFile("TestOpenPackageOUTPUT.docx");
  FileHelper.copyFile(inputFile,targetFile);
  OPCPackage pkg=OPCPackage.open(targetFile.getAbsolutePath());
  PackagePartName corePartName=PackagingURIHelper.createPartName("/word/document.xml");
  PackagePart corePart=pkg.getPart(corePartName);
  for (  PackageRelationship rel : corePart.getRelationships()) {
    corePart.removeRelationship(rel.getId());
    pkg.removePart(PackagingURIHelper.createPartName(PackagingURIHelper.resolvePartUri(corePart.getPartName().getURI(),rel.getTargetURI())));
  }
  Document doc=DocumentHelper.createDocument();
  Element elDocument=doc.createElementNS("http://schemas.openxmlformats.org/wordprocessingml/2006/main","w:document");
  doc.appendChild(elDocument);
  Element elBody=doc.createElementNS("http://schemas.openxmlformats.org/wordprocessingml/2006/main","w:body");
  elDocument.appendChild(elBody);
  Element elParagraph=doc.createElementNS("http://schemas.openxmlformats.org/wordprocessingml/2006/main","w:p");
  elBody.appendChild(elParagraph);
  Element elRun=doc.createElementNS("http://schemas.openxmlformats.org/wordprocessingml/2006/main","w:r");
  elParagraph.appendChild(elRun);
  Element elText=doc.createElementNS("http://schemas.openxmlformats.org/wordprocessingml/2006/main","w:t");
  elRun.appendChild(elText);
  elText.setTextContent("Hello Open XML !");
  StreamHelper.saveXmlInStream(doc,corePart.getOutputStream());
  try {
    pkg.close();
  }
 catch (  IOException e) {
    fail();
  }
  ZipFileAssert.assertEquals(expectedFile,targetFile);
  assertTrue(targetFile.delete());
}

</code></pre>

<pre class="type-3 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test package creation.
 */
@Test public void createPackageAddPart() throws IOException, InvalidFormatException {
  File targetFile=OpenXML4JTestDataSamples.getOutputFile("TestCreatePackageTMP.docx");
  File expectedFile=OpenXML4JTestDataSamples.getSampleFile("TestCreatePackageOUTPUT.docx");
  if (targetFile.exists())   targetFile.delete();
  OPCPackage pkg=OPCPackage.create(targetFile);
  PackagePartName corePartName=PackagingURIHelper.createPartName("/word/document.xml");
  pkg.addRelationship(corePartName,TargetMode.INTERNAL,PackageRelationshipTypes.CORE_DOCUMENT,"rId1");
  PackagePart corePart=pkg.createPart(corePartName,"application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml");
  Document doc=DocumentHelper.createDocument();
  Element elDocument=doc.createElementNS("http://schemas.openxmlformats.org/wordprocessingml/2006/main","w:document");
  doc.appendChild(elDocument);
  Element elBody=doc.createElementNS("http://schemas.openxmlformats.org/wordprocessingml/2006/main","w:body");
  elDocument.appendChild(elBody);
  Element elParagraph=doc.createElementNS("http://schemas.openxmlformats.org/wordprocessingml/2006/main","w:p");
  elBody.appendChild(elParagraph);
  Element elRun=doc.createElementNS("http://schemas.openxmlformats.org/wordprocessingml/2006/main","w:r");
  elParagraph.appendChild(elRun);
  Element elText=doc.createElementNS("http://schemas.openxmlformats.org/wordprocessingml/2006/main","w:t");
  elRun.appendChild(elText);
  elText.setTextContent("Hello Open XML !");
  StreamHelper.saveXmlInStream(doc,corePart.getOutputStream());
  pkg.close();
  ZipFileAssert.assertEquals(expectedFile,targetFile);
  assertTrue(targetFile.delete());
}

</code></pre>

<pre class="type-9 type-7 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies that exceptions are thrown during the test case execution">ExceptionVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Executes methods or other tests from the same test unit">ExecutionTester</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies that exceptions are thrown during the test case execution
- Executes methods or other tests from the same test unit
"></span><br>
@Test(expected=IOException.class) public void zipBombCreateAndHandle() throws IOException, EncryptedDocumentException, InvalidFormatException {
  ZipFile zipFile=ZipHelper.openZipFile(OpenXML4JTestDataSamples.getSampleFile("sample.xlsx"));
  ByteArrayOutputStream bos=new ByteArrayOutputStream();
  ZipOutputStream append=new ZipOutputStream(bos);
  Enumeration<? extends ZipEntry> entries=zipFile.entries();
  while (entries.hasMoreElements()) {
    ZipEntry e2=entries.nextElement();
    ZipEntry e=new ZipEntry(e2.getName());
    e.setTime(e2.getTime());
    e.setComment(e2.getComment());
    e.setSize(e2.getSize());
    append.putNextEntry(e);
    if (!e.isDirectory()) {
      InputStream is=zipFile.getInputStream(e);
      if (e.getName().equals("[Content_Types].xml")) {
        ByteArrayOutputStream bos2=new ByteArrayOutputStream();
        IOUtils.copy(is,bos2);
        long size=bos2.size() - "</Types>".length();
        append.write(bos2.toByteArray(),0,(int)size);
        byte spam[]=new byte[0x7FFF];
        for (int i=0; i < spam.length; i++)         spam[i]=' ';
        while (size < 0x7FFF0000) {
          append.write(spam);
          size+=spam.length;
        }
        append.write("</Types>".getBytes("UTF-8"));
        size+=8;
        e.setSize(size);
      }
 else {
        IOUtils.copy(is,append);
      }
      is.close();
    }
    append.closeEntry();
  }
  append.close();
  zipFile.close();
  byte buf[]=bos.toByteArray();
  bos=null;
  Workbook wb=WorkbookFactory.create(new ByteArrayInputStream(buf));
  wb.getSheetAt(0);
  wb.close();
  zipFile.close();
}

</code></pre>

<pre class="type-14 type-1 type-6 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies assertions inside branch conditions">BranchVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies assertions inside branch conditions
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects/variable are equal to an expected value 
"></span><br>
@Test public void getPartSize() throws IOException, InvalidFormatException {
  String filepath=OpenXML4JTestDataSamples.getSampleFileName("sample.docx");
  OPCPackage pkg=OPCPackage.open(filepath,PackageAccess.READ);
  try {
    int checked=0;
    for (    PackagePart part : pkg.getParts()) {
      if (part.getPartName().getName().equals("/word/document.xml")) {
        checked++;
        assertEquals(ZipPackagePart.class,part.getClass());
        assertEquals(6031l,part.getSize());
      }
      if (part.getPartName().getName().equals("/word/fontTable.xml")) {
        checked++;
        assertEquals(ZipPackagePart.class,part.getClass());
        assertEquals(1312l,part.getSize());
      }
      if (part.getPartName().getName().equals("/docProps/core.xml")) {
        checked++;
        assertEquals(PackagePropertiesPart.class,part.getClass());
        assertEquals(-1,part.getSize());
      }
    }
    assertEquals(3,checked);
  }
  finally {
    pkg.close();
  }
}

</code></pre>

<pre class="type-3 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Checks that we can write a package to a simple
 * OutputStream, in addition to the normal writing
 * to a file
 */
@Test public void saveToOutputStream() throws IOException, InvalidFormatException {
  String originalFile=OpenXML4JTestDataSamples.getSampleFileName("TestPackageCommon.docx");
  File targetFile=OpenXML4JTestDataSamples.getOutputFile("TestPackageOpenSaveTMP.docx");
  @SuppressWarnings("resource") OPCPackage p=OPCPackage.open(originalFile,PackageAccess.READ_WRITE);
  try {
    FileOutputStream fout=new FileOutputStream(targetFile);
    try {
      p.save(fout);
    }
  finally {
      fout.close();
    }
    assertTrue(targetFile.exists());
    ZipFileAssert.assertEquals(new File(originalFile),targetFile);
    assertTrue(targetFile.delete());
  }
  finally {
    p.revert();
  }
}

</code></pre>

<pre class="type-2 type-1 type-4 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that when we create a new Package, we give it
 * the correct default content types
 * @throws IllegalAccessException 
 * @throws NoSuchFieldException 
 * @throws IllegalArgumentException 
 * @throws SecurityException 
 */
@Test public void createGetsContentTypes() throws IOException, InvalidFormatException, SecurityException, IllegalArgumentException, NoSuchFieldException, IllegalAccessException {
  File targetFile=OpenXML4JTestDataSamples.getOutputFile("TestCreatePackageTMP.docx");
  if (targetFile.exists())   targetFile.delete();
  @SuppressWarnings("resource") OPCPackage pkg=OPCPackage.create(targetFile);
  ContentTypeManager ctm=getContentTypeManager(pkg);
  assertEquals("application/xml",ctm.getContentType(PackagingURIHelper.createPartName("/foo.xml")));
  assertEquals(ContentTypes.RELATIONSHIPS_PART,ctm.getContentType(PackagingURIHelper.createPartName("/foo.rels")));
  assertNull(ctm.getContentType(PackagingURIHelper.createPartName("/foo.txt")));
  pkg.revert();
}

</code></pre>

<pre class="type-4 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void deletePart() throws InvalidFormatException {
  TreeMap<PackagePartName,String> expectedValues;
  TreeMap<PackagePartName,String> values;
  values=new TreeMap<PackagePartName,String>();
  expectedValues=new TreeMap<PackagePartName,String>();
  expectedValues.put(PackagingURIHelper.createPartName("/_rels/.rels"),"application/vnd.openxmlformats-package.relationships+xml");
  expectedValues.put(PackagingURIHelper.createPartName("/docProps/app.xml"),"application/vnd.openxmlformats-officedocument.extended-properties+xml");
  expectedValues.put(PackagingURIHelper.createPartName("/docProps/core.xml"),"application/vnd.openxmlformats-package.core-properties+xml");
  expectedValues.put(PackagingURIHelper.createPartName("/word/fontTable.xml"),"application/vnd.openxmlformats-officedocument.wordprocessingml.fontTable+xml");
  expectedValues.put(PackagingURIHelper.createPartName("/word/media/image1.gif"),"image/gif");
  expectedValues.put(PackagingURIHelper.createPartName("/word/settings.xml"),"application/vnd.openxmlformats-officedocument.wordprocessingml.settings+xml");
  expectedValues.put(PackagingURIHelper.createPartName("/word/styles.xml"),"application/vnd.openxmlformats-officedocument.wordprocessingml.styles+xml");
  expectedValues.put(PackagingURIHelper.createPartName("/word/theme/theme1.xml"),"application/vnd.openxmlformats-officedocument.theme+xml");
  expectedValues.put(PackagingURIHelper.createPartName("/word/webSettings.xml"),"application/vnd.openxmlformats-officedocument.wordprocessingml.webSettings+xml");
  String filepath=OpenXML4JTestDataSamples.getSampleFileName("sample.docx");
  @SuppressWarnings("resource") OPCPackage p=OPCPackage.open(filepath,PackageAccess.READ_WRITE);
  p.deletePart(PackagingURIHelper.createPartName("/word/document.xml"));
  for (  PackagePart part : p.getParts()) {
    values.put(part.getPartName(),part.getContentType());
    logger.log(POILogger.DEBUG,part.getPartName());
  }
  for (  PackagePartName partName : expectedValues.keySet()) {
    assertNotNull(values.get(partName));
    assertEquals(expectedValues.get(partName),values.get(partName));
  }
  p.revert();
}

</code></pre>

<pre class="type-2 type-1 type-3 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
"></span><br>
@Test public void replaceContentType() throws IOException, InvalidFormatException, SecurityException, IllegalArgumentException, NoSuchFieldException, IllegalAccessException {
  InputStream is=OpenXML4JTestDataSamples.openSampleStream("sample.xlsx");
  @SuppressWarnings("resource") OPCPackage p=OPCPackage.open(is);
  ContentTypeManager mgr=getContentTypeManager(p);
  assertTrue(mgr.isContentTypeRegister("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml"));
  assertFalse(mgr.isContentTypeRegister("application/vnd.ms-excel.sheet.macroEnabled.main+xml"));
  assertTrue(p.replaceContentType("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml","application/vnd.ms-excel.sheet.macroEnabled.main+xml"));
  assertFalse(mgr.isContentTypeRegister("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml"));
  assertTrue(mgr.isContentTypeRegister("application/vnd.ms-excel.sheet.macroEnabled.main+xml"));
  p.revert();
  is.close();
}

</code></pre>

<pre class="type-2 type-1 type-4 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Tests that we can create a new package, add a core
 * document and another part, save and re-load and
 * have everything setup as expected
 * @throws SAXException 
 */
@Test public void createPackageWithCoreDocument() throws IOException, InvalidFormatException, URISyntaxException, SAXException {
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  OPCPackage pkg=OPCPackage.create(baos);
  PackagePartName corePartName=PackagingURIHelper.createPartName("/xl/workbook.xml");
  pkg.addRelationship(corePartName,TargetMode.INTERNAL,PackageRelationshipTypes.CORE_DOCUMENT,"rId1");
  PackagePart corePart=pkg.createPart(corePartName,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml");
  OutputStream coreOut=corePart.getOutputStream();
  coreOut.write("<dummy-xml />".getBytes("UTF-8"));
  coreOut.close();
  PackagePartName sheetPartName=PackagingURIHelper.createPartName("/xl/worksheets/sheet1.xml");
  PackageRelationship rel=corePart.addRelationship(sheetPartName,TargetMode.INTERNAL,"http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","rSheet1");
  PackagePart part=pkg.createPart(sheetPartName,"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml");
  assertNotNull(part);
  coreOut=corePart.getOutputStream();
  coreOut.write("<dummy-xml2 />".getBytes("UTF-8"));
  coreOut.close();
  corePart.addRelationship(new URI("#Sheet1!A1"),TargetMode.INTERNAL,"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink","rId2");
  PackageRelationshipCollection coreRels=pkg.getRelationshipsByType(PackageRelationshipTypes.CORE_DOCUMENT);
  assertEquals(1,coreRels.size());
  PackageRelationship coreRel=coreRels.getRelationship(0);
  assertEquals("/",coreRel.getSourceURI().toString());
  assertEquals("/xl/workbook.xml",coreRel.getTargetURI().toString());
  assertNotNull(pkg.getPart(coreRel));
  pkg.close();
  File tmp=TempFile.createTempFile("testCreatePackageWithCoreDocument",".zip");
  OutputStream fout=new FileOutputStream(tmp);
  try {
    fout.write(baos.toByteArray());
  }
  finally {
    fout.close();
  }
  pkg=OPCPackage.open(tmp.getPath());
  try {
    coreRels=pkg.getRelationshipsByType(PackageRelationshipTypes.CORE_DOCUMENT);
    assertEquals(1,coreRels.size());
    coreRel=coreRels.getRelationship(0);
    assertEquals("/",coreRel.getSourceURI().toString());
    assertEquals("/xl/workbook.xml",coreRel.getTargetURI().toString());
    corePart=pkg.getPart(coreRel);
    assertNotNull(corePart);
    PackageRelationshipCollection rels=corePart.getRelationshipsByType("http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink");
    assertEquals(1,rels.size());
    rel=rels.getRelationship(0);
    assertEquals("Sheet1!A1",rel.getTargetURI().getRawFragment());
    assertMSCompatibility(pkg);
  }
  finally {
    pkg.close();
  }
}

</code></pre>

<pre class="type-3 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Test that just opening and closing the file doesn't alter the document.
 */
@Test public void openSave() throws IOException, InvalidFormatException {
  String originalFile=OpenXML4JTestDataSamples.getSampleFileName("TestPackageCommon.docx");
  File targetFile=OpenXML4JTestDataSamples.getOutputFile("TestPackageOpenSaveTMP.docx");
  @SuppressWarnings("resource") OPCPackage p=OPCPackage.open(originalFile,PackageAccess.READ_WRITE);
  try {
    p.save(targetFile.getAbsoluteFile());
    assertTrue(targetFile.exists());
    ZipFileAssert.assertEquals(new File(originalFile),targetFile);
    assertTrue(targetFile.delete());
  }
  finally {
    p.revert();
  }
}

</code></pre>

<pre class="type-2 type-1 type-3 type-4 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to API calls (Java or TPL) ">APIUtilityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies values of objects/variables related to AUT calls">InternalCallVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects are null">NullVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies values of objects/variables related to API calls (Java or TPL) 
- Verifies values of objects/variables related to AUT calls
- Verifies boolean conditions
- Verifies whether objects are null
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
/** 
 * Checks that we can open+read a package from a
 * simple InputStream, in addition to the normal
 * reading from a file
 */
@Test public void openFromInputStream() throws IOException, InvalidFormatException {
  String originalFile=OpenXML4JTestDataSamples.getSampleFileName("TestPackageCommon.docx");
  FileInputStream finp=new FileInputStream(originalFile);
  @SuppressWarnings("resource") OPCPackage p=OPCPackage.open(finp);
  assertNotNull(p);
  assertNotNull(p.getRelationships());
  assertEquals(12,p.getParts().size());
  assertTrue(p.hasRelationships());
  assertTrue(p.containPart(PackagingURIHelper.createPartName("/_rels/.rels")));
  p.revert();
  finp.close();
}

</code></pre>

<pre class="type-3 type-6 type-5 "><code><span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies boolean conditions">BooleanVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Verifies whether objects/variable are equal to an expected value ">EqualityVerifier</span>&nbsp;<span class="label label-info" style="display: inline-block;" data-toggle="tooltip" title="Contains more than 2 JUnit-based stereotypes">HybridVerifier</span>&nbsp;<span class=" glyphicon glyphicon-comment" aria-hidden="true" label-info" data-toggle="tooltip" title="This method/test case: 
- Verifies boolean conditions
- Verifies whether objects/variable are equal to an expected value 
- Contains more than 2 JUnit-based stereotypes
"></span><br>
@Test public void getPartsByName() throws IOException, InvalidFormatException {
  String filepath=OpenXML4JTestDataSamples.getSampleFileName("sample.docx");
  @SuppressWarnings("resource") OPCPackage pkg=OPCPackage.open(filepath,PackageAccess.READ_WRITE);
  try {
    List<PackagePart> rs=pkg.getPartsByName(Pattern.compile("/word/.*?\\.xml"));
    HashMap<String,PackagePart> selected=new HashMap<String,PackagePart>();
    for (    PackagePart p : rs)     selected.put(p.getPartName().getName(),p);
    assertEquals(6,selected.size());
    assertTrue(selected.containsKey("/word/document.xml"));
    assertTrue(selected.containsKey("/word/fontTable.xml"));
    assertTrue(selected.containsKey("/word/settings.xml"));
    assertTrue(selected.containsKey("/word/styles.xml"));
    assertTrue(selected.containsKey("/word/theme/theme1.xml"));
    assertTrue(selected.containsKey("/word/webSettings.xml"));
  }
  finally {
    pkg.revert();
  }
}

</code></pre>

<script>$(document).ready(function() {
  $('pre code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});</script>
